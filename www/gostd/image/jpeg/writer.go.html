<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/jpeg</h2>
<ul>
<li><a href="/gostd/image/jpeg/dct_test.go.html">dct_test.go</a></li>
<li><a href="/gostd/image/jpeg/fdct.go.html">fdct.go</a></li>
<li><a href="/gostd/image/jpeg/huffman.go.html">huffman.go</a></li>
<li><a href="/gostd/image/jpeg/idct.go.html">idct.go</a></li>
<li><a href="/gostd/image/jpeg/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/jpeg/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/jpeg/scan.go.html">scan.go</a></li>
<li><a href="/gostd/image/jpeg/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/jpeg/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6387941">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6387996">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6388050">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6388101">package</span>&nbsp;<span class="ident" id="6388109">jpeg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388115">import</span>&nbsp;<span class="op" id="6388122">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6388125">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6388134">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6388144">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6388153">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6388168">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6388173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6388176">//&nbsp;min&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;of&nbsp;two&nbsp;integers.</span><br>
<span class="lineno"></span><span class="keyword" id="6388220">func</span>&nbsp;<span class="ident" id="6388225">min</span><span class="op" id="6388228">(</span><span class="ident" id="6388229">x</span><span class="op" id="6388230">,</span>&nbsp;<span class="ident" id="6388232">y</span>&nbsp;<span class="builtintype" id="6388234">int</span><span class="op" id="6388237">)</span>&nbsp;<span class="builtintype" id="6388239">int</span>&nbsp;<span class="op" id="6388243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388246">if</span>&nbsp;<span class="ident" id="6388249">x</span>&nbsp;<span class="op" id="6388251">&lt;</span>&nbsp;<span class="ident" id="6388253">y</span>&nbsp;<span class="op" id="6388255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388259">return</span>&nbsp;<span class="ident" id="6388266">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388269">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388272">return</span>&nbsp;<span class="ident" id="6388279">y</span><br>
<span class="lineno"></span><span class="op" id="6388281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388284">//&nbsp;div&nbsp;returns&nbsp;a/b&nbsp;rounded&nbsp;to&nbsp;the&nbsp;nearest&nbsp;integer,&nbsp;instead&nbsp;of&nbsp;rounded&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="6388363">func</span>&nbsp;<span class="ident" id="6388368">div</span><span class="op" id="6388371">(</span><span class="ident" id="6388372">a</span><span class="op" id="6388373">,</span>&nbsp;<span class="ident" id="6388375">b</span>&nbsp;<span class="builtintype" id="6388377">int32</span><span class="op" id="6388382">)</span>&nbsp;<span class="builtintype" id="6388384">int32</span>&nbsp;<span class="op" id="6388390">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388393">if</span>&nbsp;<span class="ident" id="6388396">a</span>&nbsp;<span class="op" id="6388398">&gt;=</span>&nbsp;<span class="num" id="6388401">0</span>&nbsp;<span class="op" id="6388403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388407">return</span>&nbsp;<span class="op" id="6388414">(</span><span class="ident" id="6388415">a</span>&nbsp;<span class="op" id="6388417">+</span>&nbsp;<span class="op" id="6388419">(</span><span class="ident" id="6388420">b</span>&nbsp;<span class="op" id="6388422">&gt;&gt;</span>&nbsp;<span class="num" id="6388425">1</span><span class="op" id="6388426">)</span><span class="op" id="6388427">)</span>&nbsp;<span class="op" id="6388429">/</span>&nbsp;<span class="ident" id="6388431">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388437">return</span>&nbsp;<span class="op" id="6388444">-</span><span class="op" id="6388445">(</span><span class="op" id="6388446">(</span><span class="op" id="6388447">-</span><span class="ident" id="6388448">a</span>&nbsp;<span class="op" id="6388450">+</span>&nbsp;<span class="op" id="6388452">(</span><span class="ident" id="6388453">b</span>&nbsp;<span class="op" id="6388455">&gt;&gt;</span>&nbsp;<span class="num" id="6388458">1</span><span class="op" id="6388459">)</span><span class="op" id="6388460">)</span>&nbsp;<span class="op" id="6388462">/</span>&nbsp;<span class="ident" id="6388464">b</span><span class="op" id="6388465">)</span><br>
<span class="lineno"></span><span class="op" id="6388467">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="6388470">//&nbsp;bitCount&nbsp;counts&nbsp;the&nbsp;number&nbsp;of&nbsp;bits&nbsp;needed&nbsp;to&nbsp;hold&nbsp;an&nbsp;integer.</span><br>
<span class="lineno"></span><span class="keyword" id="6388535">var</span>&nbsp;<span class="ident" id="6388539">bitCount</span>&nbsp;<span class="op" id="6388548">=</span>&nbsp;<span class="op" id="6388550">[</span><span class="num" id="6388551">256</span><span class="op" id="6388554">]</span><span class="builtintype" id="6388555">byte</span><span class="op" id="6388559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388562">0</span><span class="op" id="6388563">,</span>&nbsp;<span class="num" id="6388565">1</span><span class="op" id="6388566">,</span>&nbsp;<span class="num" id="6388568">2</span><span class="op" id="6388569">,</span>&nbsp;<span class="num" id="6388571">2</span><span class="op" id="6388572">,</span>&nbsp;<span class="num" id="6388574">3</span><span class="op" id="6388575">,</span>&nbsp;<span class="num" id="6388577">3</span><span class="op" id="6388578">,</span>&nbsp;<span class="num" id="6388580">3</span><span class="op" id="6388581">,</span>&nbsp;<span class="num" id="6388583">3</span><span class="op" id="6388584">,</span>&nbsp;<span class="num" id="6388586">4</span><span class="op" id="6388587">,</span>&nbsp;<span class="num" id="6388589">4</span><span class="op" id="6388590">,</span>&nbsp;<span class="num" id="6388592">4</span><span class="op" id="6388593">,</span>&nbsp;<span class="num" id="6388595">4</span><span class="op" id="6388596">,</span>&nbsp;<span class="num" id="6388598">4</span><span class="op" id="6388599">,</span>&nbsp;<span class="num" id="6388601">4</span><span class="op" id="6388602">,</span>&nbsp;<span class="num" id="6388604">4</span><span class="op" id="6388605">,</span>&nbsp;<span class="num" id="6388607">4</span><span class="op" id="6388608">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388611">5</span><span class="op" id="6388612">,</span>&nbsp;<span class="num" id="6388614">5</span><span class="op" id="6388615">,</span>&nbsp;<span class="num" id="6388617">5</span><span class="op" id="6388618">,</span>&nbsp;<span class="num" id="6388620">5</span><span class="op" id="6388621">,</span>&nbsp;<span class="num" id="6388623">5</span><span class="op" id="6388624">,</span>&nbsp;<span class="num" id="6388626">5</span><span class="op" id="6388627">,</span>&nbsp;<span class="num" id="6388629">5</span><span class="op" id="6388630">,</span>&nbsp;<span class="num" id="6388632">5</span><span class="op" id="6388633">,</span>&nbsp;<span class="num" id="6388635">5</span><span class="op" id="6388636">,</span>&nbsp;<span class="num" id="6388638">5</span><span class="op" id="6388639">,</span>&nbsp;<span class="num" id="6388641">5</span><span class="op" id="6388642">,</span>&nbsp;<span class="num" id="6388644">5</span><span class="op" id="6388645">,</span>&nbsp;<span class="num" id="6388647">5</span><span class="op" id="6388648">,</span>&nbsp;<span class="num" id="6388650">5</span><span class="op" id="6388651">,</span>&nbsp;<span class="num" id="6388653">5</span><span class="op" id="6388654">,</span>&nbsp;<span class="num" id="6388656">5</span><span class="op" id="6388657">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388660">6</span><span class="op" id="6388661">,</span>&nbsp;<span class="num" id="6388663">6</span><span class="op" id="6388664">,</span>&nbsp;<span class="num" id="6388666">6</span><span class="op" id="6388667">,</span>&nbsp;<span class="num" id="6388669">6</span><span class="op" id="6388670">,</span>&nbsp;<span class="num" id="6388672">6</span><span class="op" id="6388673">,</span>&nbsp;<span class="num" id="6388675">6</span><span class="op" id="6388676">,</span>&nbsp;<span class="num" id="6388678">6</span><span class="op" id="6388679">,</span>&nbsp;<span class="num" id="6388681">6</span><span class="op" id="6388682">,</span>&nbsp;<span class="num" id="6388684">6</span><span class="op" id="6388685">,</span>&nbsp;<span class="num" id="6388687">6</span><span class="op" id="6388688">,</span>&nbsp;<span class="num" id="6388690">6</span><span class="op" id="6388691">,</span>&nbsp;<span class="num" id="6388693">6</span><span class="op" id="6388694">,</span>&nbsp;<span class="num" id="6388696">6</span><span class="op" id="6388697">,</span>&nbsp;<span class="num" id="6388699">6</span><span class="op" id="6388700">,</span>&nbsp;<span class="num" id="6388702">6</span><span class="op" id="6388703">,</span>&nbsp;<span class="num" id="6388705">6</span><span class="op" id="6388706">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388709">6</span><span class="op" id="6388710">,</span>&nbsp;<span class="num" id="6388712">6</span><span class="op" id="6388713">,</span>&nbsp;<span class="num" id="6388715">6</span><span class="op" id="6388716">,</span>&nbsp;<span class="num" id="6388718">6</span><span class="op" id="6388719">,</span>&nbsp;<span class="num" id="6388721">6</span><span class="op" id="6388722">,</span>&nbsp;<span class="num" id="6388724">6</span><span class="op" id="6388725">,</span>&nbsp;<span class="num" id="6388727">6</span><span class="op" id="6388728">,</span>&nbsp;<span class="num" id="6388730">6</span><span class="op" id="6388731">,</span>&nbsp;<span class="num" id="6388733">6</span><span class="op" id="6388734">,</span>&nbsp;<span class="num" id="6388736">6</span><span class="op" id="6388737">,</span>&nbsp;<span class="num" id="6388739">6</span><span class="op" id="6388740">,</span>&nbsp;<span class="num" id="6388742">6</span><span class="op" id="6388743">,</span>&nbsp;<span class="num" id="6388745">6</span><span class="op" id="6388746">,</span>&nbsp;<span class="num" id="6388748">6</span><span class="op" id="6388749">,</span>&nbsp;<span class="num" id="6388751">6</span><span class="op" id="6388752">,</span>&nbsp;<span class="num" id="6388754">6</span><span class="op" id="6388755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388758">7</span><span class="op" id="6388759">,</span>&nbsp;<span class="num" id="6388761">7</span><span class="op" id="6388762">,</span>&nbsp;<span class="num" id="6388764">7</span><span class="op" id="6388765">,</span>&nbsp;<span class="num" id="6388767">7</span><span class="op" id="6388768">,</span>&nbsp;<span class="num" id="6388770">7</span><span class="op" id="6388771">,</span>&nbsp;<span class="num" id="6388773">7</span><span class="op" id="6388774">,</span>&nbsp;<span class="num" id="6388776">7</span><span class="op" id="6388777">,</span>&nbsp;<span class="num" id="6388779">7</span><span class="op" id="6388780">,</span>&nbsp;<span class="num" id="6388782">7</span><span class="op" id="6388783">,</span>&nbsp;<span class="num" id="6388785">7</span><span class="op" id="6388786">,</span>&nbsp;<span class="num" id="6388788">7</span><span class="op" id="6388789">,</span>&nbsp;<span class="num" id="6388791">7</span><span class="op" id="6388792">,</span>&nbsp;<span class="num" id="6388794">7</span><span class="op" id="6388795">,</span>&nbsp;<span class="num" id="6388797">7</span><span class="op" id="6388798">,</span>&nbsp;<span class="num" id="6388800">7</span><span class="op" id="6388801">,</span>&nbsp;<span class="num" id="6388803">7</span><span class="op" id="6388804">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388807">7</span><span class="op" id="6388808">,</span>&nbsp;<span class="num" id="6388810">7</span><span class="op" id="6388811">,</span>&nbsp;<span class="num" id="6388813">7</span><span class="op" id="6388814">,</span>&nbsp;<span class="num" id="6388816">7</span><span class="op" id="6388817">,</span>&nbsp;<span class="num" id="6388819">7</span><span class="op" id="6388820">,</span>&nbsp;<span class="num" id="6388822">7</span><span class="op" id="6388823">,</span>&nbsp;<span class="num" id="6388825">7</span><span class="op" id="6388826">,</span>&nbsp;<span class="num" id="6388828">7</span><span class="op" id="6388829">,</span>&nbsp;<span class="num" id="6388831">7</span><span class="op" id="6388832">,</span>&nbsp;<span class="num" id="6388834">7</span><span class="op" id="6388835">,</span>&nbsp;<span class="num" id="6388837">7</span><span class="op" id="6388838">,</span>&nbsp;<span class="num" id="6388840">7</span><span class="op" id="6388841">,</span>&nbsp;<span class="num" id="6388843">7</span><span class="op" id="6388844">,</span>&nbsp;<span class="num" id="6388846">7</span><span class="op" id="6388847">,</span>&nbsp;<span class="num" id="6388849">7</span><span class="op" id="6388850">,</span>&nbsp;<span class="num" id="6388852">7</span><span class="op" id="6388853">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388856">7</span><span class="op" id="6388857">,</span>&nbsp;<span class="num" id="6388859">7</span><span class="op" id="6388860">,</span>&nbsp;<span class="num" id="6388862">7</span><span class="op" id="6388863">,</span>&nbsp;<span class="num" id="6388865">7</span><span class="op" id="6388866">,</span>&nbsp;<span class="num" id="6388868">7</span><span class="op" id="6388869">,</span>&nbsp;<span class="num" id="6388871">7</span><span class="op" id="6388872">,</span>&nbsp;<span class="num" id="6388874">7</span><span class="op" id="6388875">,</span>&nbsp;<span class="num" id="6388877">7</span><span class="op" id="6388878">,</span>&nbsp;<span class="num" id="6388880">7</span><span class="op" id="6388881">,</span>&nbsp;<span class="num" id="6388883">7</span><span class="op" id="6388884">,</span>&nbsp;<span class="num" id="6388886">7</span><span class="op" id="6388887">,</span>&nbsp;<span class="num" id="6388889">7</span><span class="op" id="6388890">,</span>&nbsp;<span class="num" id="6388892">7</span><span class="op" id="6388893">,</span>&nbsp;<span class="num" id="6388895">7</span><span class="op" id="6388896">,</span>&nbsp;<span class="num" id="6388898">7</span><span class="op" id="6388899">,</span>&nbsp;<span class="num" id="6388901">7</span><span class="op" id="6388902">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388905">7</span><span class="op" id="6388906">,</span>&nbsp;<span class="num" id="6388908">7</span><span class="op" id="6388909">,</span>&nbsp;<span class="num" id="6388911">7</span><span class="op" id="6388912">,</span>&nbsp;<span class="num" id="6388914">7</span><span class="op" id="6388915">,</span>&nbsp;<span class="num" id="6388917">7</span><span class="op" id="6388918">,</span>&nbsp;<span class="num" id="6388920">7</span><span class="op" id="6388921">,</span>&nbsp;<span class="num" id="6388923">7</span><span class="op" id="6388924">,</span>&nbsp;<span class="num" id="6388926">7</span><span class="op" id="6388927">,</span>&nbsp;<span class="num" id="6388929">7</span><span class="op" id="6388930">,</span>&nbsp;<span class="num" id="6388932">7</span><span class="op" id="6388933">,</span>&nbsp;<span class="num" id="6388935">7</span><span class="op" id="6388936">,</span>&nbsp;<span class="num" id="6388938">7</span><span class="op" id="6388939">,</span>&nbsp;<span class="num" id="6388941">7</span><span class="op" id="6388942">,</span>&nbsp;<span class="num" id="6388944">7</span><span class="op" id="6388945">,</span>&nbsp;<span class="num" id="6388947">7</span><span class="op" id="6388948">,</span>&nbsp;<span class="num" id="6388950">7</span><span class="op" id="6388951">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6388954">8</span><span class="op" id="6388955">,</span>&nbsp;<span class="num" id="6388957">8</span><span class="op" id="6388958">,</span>&nbsp;<span class="num" id="6388960">8</span><span class="op" id="6388961">,</span>&nbsp;<span class="num" id="6388963">8</span><span class="op" id="6388964">,</span>&nbsp;<span class="num" id="6388966">8</span><span class="op" id="6388967">,</span>&nbsp;<span class="num" id="6388969">8</span><span class="op" id="6388970">,</span>&nbsp;<span class="num" id="6388972">8</span><span class="op" id="6388973">,</span>&nbsp;<span class="num" id="6388975">8</span><span class="op" id="6388976">,</span>&nbsp;<span class="num" id="6388978">8</span><span class="op" id="6388979">,</span>&nbsp;<span class="num" id="6388981">8</span><span class="op" id="6388982">,</span>&nbsp;<span class="num" id="6388984">8</span><span class="op" id="6388985">,</span>&nbsp;<span class="num" id="6388987">8</span><span class="op" id="6388988">,</span>&nbsp;<span class="num" id="6388990">8</span><span class="op" id="6388991">,</span>&nbsp;<span class="num" id="6388993">8</span><span class="op" id="6388994">,</span>&nbsp;<span class="num" id="6388996">8</span><span class="op" id="6388997">,</span>&nbsp;<span class="num" id="6388999">8</span><span class="op" id="6389000">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389003">8</span><span class="op" id="6389004">,</span>&nbsp;<span class="num" id="6389006">8</span><span class="op" id="6389007">,</span>&nbsp;<span class="num" id="6389009">8</span><span class="op" id="6389010">,</span>&nbsp;<span class="num" id="6389012">8</span><span class="op" id="6389013">,</span>&nbsp;<span class="num" id="6389015">8</span><span class="op" id="6389016">,</span>&nbsp;<span class="num" id="6389018">8</span><span class="op" id="6389019">,</span>&nbsp;<span class="num" id="6389021">8</span><span class="op" id="6389022">,</span>&nbsp;<span class="num" id="6389024">8</span><span class="op" id="6389025">,</span>&nbsp;<span class="num" id="6389027">8</span><span class="op" id="6389028">,</span>&nbsp;<span class="num" id="6389030">8</span><span class="op" id="6389031">,</span>&nbsp;<span class="num" id="6389033">8</span><span class="op" id="6389034">,</span>&nbsp;<span class="num" id="6389036">8</span><span class="op" id="6389037">,</span>&nbsp;<span class="num" id="6389039">8</span><span class="op" id="6389040">,</span>&nbsp;<span class="num" id="6389042">8</span><span class="op" id="6389043">,</span>&nbsp;<span class="num" id="6389045">8</span><span class="op" id="6389046">,</span>&nbsp;<span class="num" id="6389048">8</span><span class="op" id="6389049">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389052">8</span><span class="op" id="6389053">,</span>&nbsp;<span class="num" id="6389055">8</span><span class="op" id="6389056">,</span>&nbsp;<span class="num" id="6389058">8</span><span class="op" id="6389059">,</span>&nbsp;<span class="num" id="6389061">8</span><span class="op" id="6389062">,</span>&nbsp;<span class="num" id="6389064">8</span><span class="op" id="6389065">,</span>&nbsp;<span class="num" id="6389067">8</span><span class="op" id="6389068">,</span>&nbsp;<span class="num" id="6389070">8</span><span class="op" id="6389071">,</span>&nbsp;<span class="num" id="6389073">8</span><span class="op" id="6389074">,</span>&nbsp;<span class="num" id="6389076">8</span><span class="op" id="6389077">,</span>&nbsp;<span class="num" id="6389079">8</span><span class="op" id="6389080">,</span>&nbsp;<span class="num" id="6389082">8</span><span class="op" id="6389083">,</span>&nbsp;<span class="num" id="6389085">8</span><span class="op" id="6389086">,</span>&nbsp;<span class="num" id="6389088">8</span><span class="op" id="6389089">,</span>&nbsp;<span class="num" id="6389091">8</span><span class="op" id="6389092">,</span>&nbsp;<span class="num" id="6389094">8</span><span class="op" id="6389095">,</span>&nbsp;<span class="num" id="6389097">8</span><span class="op" id="6389098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389101">8</span><span class="op" id="6389102">,</span>&nbsp;<span class="num" id="6389104">8</span><span class="op" id="6389105">,</span>&nbsp;<span class="num" id="6389107">8</span><span class="op" id="6389108">,</span>&nbsp;<span class="num" id="6389110">8</span><span class="op" id="6389111">,</span>&nbsp;<span class="num" id="6389113">8</span><span class="op" id="6389114">,</span>&nbsp;<span class="num" id="6389116">8</span><span class="op" id="6389117">,</span>&nbsp;<span class="num" id="6389119">8</span><span class="op" id="6389120">,</span>&nbsp;<span class="num" id="6389122">8</span><span class="op" id="6389123">,</span>&nbsp;<span class="num" id="6389125">8</span><span class="op" id="6389126">,</span>&nbsp;<span class="num" id="6389128">8</span><span class="op" id="6389129">,</span>&nbsp;<span class="num" id="6389131">8</span><span class="op" id="6389132">,</span>&nbsp;<span class="num" id="6389134">8</span><span class="op" id="6389135">,</span>&nbsp;<span class="num" id="6389137">8</span><span class="op" id="6389138">,</span>&nbsp;<span class="num" id="6389140">8</span><span class="op" id="6389141">,</span>&nbsp;<span class="num" id="6389143">8</span><span class="op" id="6389144">,</span>&nbsp;<span class="num" id="6389146">8</span><span class="op" id="6389147">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389150">8</span><span class="op" id="6389151">,</span>&nbsp;<span class="num" id="6389153">8</span><span class="op" id="6389154">,</span>&nbsp;<span class="num" id="6389156">8</span><span class="op" id="6389157">,</span>&nbsp;<span class="num" id="6389159">8</span><span class="op" id="6389160">,</span>&nbsp;<span class="num" id="6389162">8</span><span class="op" id="6389163">,</span>&nbsp;<span class="num" id="6389165">8</span><span class="op" id="6389166">,</span>&nbsp;<span class="num" id="6389168">8</span><span class="op" id="6389169">,</span>&nbsp;<span class="num" id="6389171">8</span><span class="op" id="6389172">,</span>&nbsp;<span class="num" id="6389174">8</span><span class="op" id="6389175">,</span>&nbsp;<span class="num" id="6389177">8</span><span class="op" id="6389178">,</span>&nbsp;<span class="num" id="6389180">8</span><span class="op" id="6389181">,</span>&nbsp;<span class="num" id="6389183">8</span><span class="op" id="6389184">,</span>&nbsp;<span class="num" id="6389186">8</span><span class="op" id="6389187">,</span>&nbsp;<span class="num" id="6389189">8</span><span class="op" id="6389190">,</span>&nbsp;<span class="num" id="6389192">8</span><span class="op" id="6389193">,</span>&nbsp;<span class="num" id="6389195">8</span><span class="op" id="6389196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389199">8</span><span class="op" id="6389200">,</span>&nbsp;<span class="num" id="6389202">8</span><span class="op" id="6389203">,</span>&nbsp;<span class="num" id="6389205">8</span><span class="op" id="6389206">,</span>&nbsp;<span class="num" id="6389208">8</span><span class="op" id="6389209">,</span>&nbsp;<span class="num" id="6389211">8</span><span class="op" id="6389212">,</span>&nbsp;<span class="num" id="6389214">8</span><span class="op" id="6389215">,</span>&nbsp;<span class="num" id="6389217">8</span><span class="op" id="6389218">,</span>&nbsp;<span class="num" id="6389220">8</span><span class="op" id="6389221">,</span>&nbsp;<span class="num" id="6389223">8</span><span class="op" id="6389224">,</span>&nbsp;<span class="num" id="6389226">8</span><span class="op" id="6389227">,</span>&nbsp;<span class="num" id="6389229">8</span><span class="op" id="6389230">,</span>&nbsp;<span class="num" id="6389232">8</span><span class="op" id="6389233">,</span>&nbsp;<span class="num" id="6389235">8</span><span class="op" id="6389236">,</span>&nbsp;<span class="num" id="6389238">8</span><span class="op" id="6389239">,</span>&nbsp;<span class="num" id="6389241">8</span><span class="op" id="6389242">,</span>&nbsp;<span class="num" id="6389244">8</span><span class="op" id="6389245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389248">8</span><span class="op" id="6389249">,</span>&nbsp;<span class="num" id="6389251">8</span><span class="op" id="6389252">,</span>&nbsp;<span class="num" id="6389254">8</span><span class="op" id="6389255">,</span>&nbsp;<span class="num" id="6389257">8</span><span class="op" id="6389258">,</span>&nbsp;<span class="num" id="6389260">8</span><span class="op" id="6389261">,</span>&nbsp;<span class="num" id="6389263">8</span><span class="op" id="6389264">,</span>&nbsp;<span class="num" id="6389266">8</span><span class="op" id="6389267">,</span>&nbsp;<span class="num" id="6389269">8</span><span class="op" id="6389270">,</span>&nbsp;<span class="num" id="6389272">8</span><span class="op" id="6389273">,</span>&nbsp;<span class="num" id="6389275">8</span><span class="op" id="6389276">,</span>&nbsp;<span class="num" id="6389278">8</span><span class="op" id="6389279">,</span>&nbsp;<span class="num" id="6389281">8</span><span class="op" id="6389282">,</span>&nbsp;<span class="num" id="6389284">8</span><span class="op" id="6389285">,</span>&nbsp;<span class="num" id="6389287">8</span><span class="op" id="6389288">,</span>&nbsp;<span class="num" id="6389290">8</span><span class="op" id="6389291">,</span>&nbsp;<span class="num" id="6389293">8</span><span class="op" id="6389294">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389297">8</span><span class="op" id="6389298">,</span>&nbsp;<span class="num" id="6389300">8</span><span class="op" id="6389301">,</span>&nbsp;<span class="num" id="6389303">8</span><span class="op" id="6389304">,</span>&nbsp;<span class="num" id="6389306">8</span><span class="op" id="6389307">,</span>&nbsp;<span class="num" id="6389309">8</span><span class="op" id="6389310">,</span>&nbsp;<span class="num" id="6389312">8</span><span class="op" id="6389313">,</span>&nbsp;<span class="num" id="6389315">8</span><span class="op" id="6389316">,</span>&nbsp;<span class="num" id="6389318">8</span><span class="op" id="6389319">,</span>&nbsp;<span class="num" id="6389321">8</span><span class="op" id="6389322">,</span>&nbsp;<span class="num" id="6389324">8</span><span class="op" id="6389325">,</span>&nbsp;<span class="num" id="6389327">8</span><span class="op" id="6389328">,</span>&nbsp;<span class="num" id="6389330">8</span><span class="op" id="6389331">,</span>&nbsp;<span class="num" id="6389333">8</span><span class="op" id="6389334">,</span>&nbsp;<span class="num" id="6389336">8</span><span class="op" id="6389337">,</span>&nbsp;<span class="num" id="6389339">8</span><span class="op" id="6389340">,</span>&nbsp;<span class="num" id="6389342">8</span><span class="op" id="6389343">,</span><br>
<span class="lineno"></span><span class="op" id="6389345">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6389348">type</span>&nbsp;<span class="ident" id="6389353">quantIndex</span>&nbsp;<span class="builtintype" id="6389364">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6389369">const</span>&nbsp;<span class="op" id="6389375">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389378">quantIndexLuminance</span>&nbsp;<span class="ident" id="6389398">quantIndex</span>&nbsp;<span class="op" id="6389409">=</span>&nbsp;<span class="ident" id="6389411">iota</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389417">quantIndexChrominance</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389440">nQuantIndex</span><br>
<span class="lineno"></span><span class="op" id="6389452">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389455">//&nbsp;unscaledQuant&nbsp;are&nbsp;the&nbsp;unscaled&nbsp;quantization&nbsp;tables&nbsp;in&nbsp;zig-zag&nbsp;order.&nbsp;Each</span><br>
<span class="lineno">60</span><span class="comment" id="6389532">//&nbsp;encoder&nbsp;copies&nbsp;and&nbsp;scales&nbsp;the&nbsp;tables&nbsp;according&nbsp;to&nbsp;its&nbsp;quality&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6389608">//&nbsp;The&nbsp;values&nbsp;are&nbsp;derived&nbsp;from&nbsp;section&nbsp;K.1&nbsp;after&nbsp;converting&nbsp;from&nbsp;natural&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6389684">//&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6389702">var</span>&nbsp;<span class="ident" id="6389706">unscaledQuant</span>&nbsp;<span class="op" id="6389720">=</span>&nbsp;<span class="op" id="6389722">[</span><span class="ident" id="6389723">nQuantIndex</span><span class="op" id="6389734">]</span><span class="op" id="6389735">[</span><span class="ident" id="6389736">blockSize</span><span class="op" id="6389745">]</span><span class="builtintype" id="6389746">byte</span><span class="op" id="6389750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6389753">//&nbsp;Luminance.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389772">16</span><span class="op" id="6389774">,</span>&nbsp;<span class="num" id="6389776">11</span><span class="op" id="6389778">,</span>&nbsp;<span class="num" id="6389780">12</span><span class="op" id="6389782">,</span>&nbsp;<span class="num" id="6389784">14</span><span class="op" id="6389786">,</span>&nbsp;<span class="num" id="6389788">12</span><span class="op" id="6389790">,</span>&nbsp;<span class="num" id="6389792">10</span><span class="op" id="6389794">,</span>&nbsp;<span class="num" id="6389796">16</span><span class="op" id="6389798">,</span>&nbsp;<span class="num" id="6389800">14</span><span class="op" id="6389802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389806">13</span><span class="op" id="6389808">,</span>&nbsp;<span class="num" id="6389810">14</span><span class="op" id="6389812">,</span>&nbsp;<span class="num" id="6389814">18</span><span class="op" id="6389816">,</span>&nbsp;<span class="num" id="6389818">17</span><span class="op" id="6389820">,</span>&nbsp;<span class="num" id="6389822">16</span><span class="op" id="6389824">,</span>&nbsp;<span class="num" id="6389826">19</span><span class="op" id="6389828">,</span>&nbsp;<span class="num" id="6389830">24</span><span class="op" id="6389832">,</span>&nbsp;<span class="num" id="6389834">40</span><span class="op" id="6389836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389840">26</span><span class="op" id="6389842">,</span>&nbsp;<span class="num" id="6389844">24</span><span class="op" id="6389846">,</span>&nbsp;<span class="num" id="6389848">22</span><span class="op" id="6389850">,</span>&nbsp;<span class="num" id="6389852">22</span><span class="op" id="6389854">,</span>&nbsp;<span class="num" id="6389856">24</span><span class="op" id="6389858">,</span>&nbsp;<span class="num" id="6389860">49</span><span class="op" id="6389862">,</span>&nbsp;<span class="num" id="6389864">35</span><span class="op" id="6389866">,</span>&nbsp;<span class="num" id="6389868">37</span><span class="op" id="6389870">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389874">29</span><span class="op" id="6389876">,</span>&nbsp;<span class="num" id="6389878">40</span><span class="op" id="6389880">,</span>&nbsp;<span class="num" id="6389882">58</span><span class="op" id="6389884">,</span>&nbsp;<span class="num" id="6389886">51</span><span class="op" id="6389888">,</span>&nbsp;<span class="num" id="6389890">61</span><span class="op" id="6389892">,</span>&nbsp;<span class="num" id="6389894">60</span><span class="op" id="6389896">,</span>&nbsp;<span class="num" id="6389898">57</span><span class="op" id="6389900">,</span>&nbsp;<span class="num" id="6389902">51</span><span class="op" id="6389904">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389908">56</span><span class="op" id="6389910">,</span>&nbsp;<span class="num" id="6389912">55</span><span class="op" id="6389914">,</span>&nbsp;<span class="num" id="6389916">64</span><span class="op" id="6389918">,</span>&nbsp;<span class="num" id="6389920">72</span><span class="op" id="6389922">,</span>&nbsp;<span class="num" id="6389924">92</span><span class="op" id="6389926">,</span>&nbsp;<span class="num" id="6389928">78</span><span class="op" id="6389930">,</span>&nbsp;<span class="num" id="6389932">64</span><span class="op" id="6389934">,</span>&nbsp;<span class="num" id="6389936">68</span><span class="op" id="6389938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389942">87</span><span class="op" id="6389944">,</span>&nbsp;<span class="num" id="6389946">69</span><span class="op" id="6389948">,</span>&nbsp;<span class="num" id="6389950">55</span><span class="op" id="6389952">,</span>&nbsp;<span class="num" id="6389954">56</span><span class="op" id="6389956">,</span>&nbsp;<span class="num" id="6389958">80</span><span class="op" id="6389960">,</span>&nbsp;<span class="num" id="6389962">109</span><span class="op" id="6389965">,</span>&nbsp;<span class="num" id="6389967">81</span><span class="op" id="6389969">,</span>&nbsp;<span class="num" id="6389971">87</span><span class="op" id="6389973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6389977">95</span><span class="op" id="6389979">,</span>&nbsp;<span class="num" id="6389981">98</span><span class="op" id="6389983">,</span>&nbsp;<span class="num" id="6389985">103</span><span class="op" id="6389988">,</span>&nbsp;<span class="num" id="6389990">104</span><span class="op" id="6389993">,</span>&nbsp;<span class="num" id="6389995">103</span><span class="op" id="6389998">,</span>&nbsp;<span class="num" id="6390000">62</span><span class="op" id="6390002">,</span>&nbsp;<span class="num" id="6390004">77</span><span class="op" id="6390006">,</span>&nbsp;<span class="num" id="6390008">113</span><span class="op" id="6390011">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390015">121</span><span class="op" id="6390018">,</span>&nbsp;<span class="num" id="6390020">112</span><span class="op" id="6390023">,</span>&nbsp;<span class="num" id="6390025">100</span><span class="op" id="6390028">,</span>&nbsp;<span class="num" id="6390030">120</span><span class="op" id="6390033">,</span>&nbsp;<span class="num" id="6390035">92</span><span class="op" id="6390037">,</span>&nbsp;<span class="num" id="6390039">101</span><span class="op" id="6390042">,</span>&nbsp;<span class="num" id="6390044">103</span><span class="op" id="6390047">,</span>&nbsp;<span class="num" id="6390049">99</span><span class="op" id="6390051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390054">}</span><span class="op" id="6390055">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390058">//&nbsp;Chrominance.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390079">17</span><span class="op" id="6390081">,</span>&nbsp;<span class="num" id="6390083">18</span><span class="op" id="6390085">,</span>&nbsp;<span class="num" id="6390087">18</span><span class="op" id="6390089">,</span>&nbsp;<span class="num" id="6390091">24</span><span class="op" id="6390093">,</span>&nbsp;<span class="num" id="6390095">21</span><span class="op" id="6390097">,</span>&nbsp;<span class="num" id="6390099">24</span><span class="op" id="6390101">,</span>&nbsp;<span class="num" id="6390103">47</span><span class="op" id="6390105">,</span>&nbsp;<span class="num" id="6390107">26</span><span class="op" id="6390109">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390113">26</span><span class="op" id="6390115">,</span>&nbsp;<span class="num" id="6390117">47</span><span class="op" id="6390119">,</span>&nbsp;<span class="num" id="6390121">99</span><span class="op" id="6390123">,</span>&nbsp;<span class="num" id="6390125">66</span><span class="op" id="6390127">,</span>&nbsp;<span class="num" id="6390129">56</span><span class="op" id="6390131">,</span>&nbsp;<span class="num" id="6390133">66</span><span class="op" id="6390135">,</span>&nbsp;<span class="num" id="6390137">99</span><span class="op" id="6390139">,</span>&nbsp;<span class="num" id="6390141">99</span><span class="op" id="6390143">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390147">99</span><span class="op" id="6390149">,</span>&nbsp;<span class="num" id="6390151">99</span><span class="op" id="6390153">,</span>&nbsp;<span class="num" id="6390155">99</span><span class="op" id="6390157">,</span>&nbsp;<span class="num" id="6390159">99</span><span class="op" id="6390161">,</span>&nbsp;<span class="num" id="6390163">99</span><span class="op" id="6390165">,</span>&nbsp;<span class="num" id="6390167">99</span><span class="op" id="6390169">,</span>&nbsp;<span class="num" id="6390171">99</span><span class="op" id="6390173">,</span>&nbsp;<span class="num" id="6390175">99</span><span class="op" id="6390177">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390181">99</span><span class="op" id="6390183">,</span>&nbsp;<span class="num" id="6390185">99</span><span class="op" id="6390187">,</span>&nbsp;<span class="num" id="6390189">99</span><span class="op" id="6390191">,</span>&nbsp;<span class="num" id="6390193">99</span><span class="op" id="6390195">,</span>&nbsp;<span class="num" id="6390197">99</span><span class="op" id="6390199">,</span>&nbsp;<span class="num" id="6390201">99</span><span class="op" id="6390203">,</span>&nbsp;<span class="num" id="6390205">99</span><span class="op" id="6390207">,</span>&nbsp;<span class="num" id="6390209">99</span><span class="op" id="6390211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390215">99</span><span class="op" id="6390217">,</span>&nbsp;<span class="num" id="6390219">99</span><span class="op" id="6390221">,</span>&nbsp;<span class="num" id="6390223">99</span><span class="op" id="6390225">,</span>&nbsp;<span class="num" id="6390227">99</span><span class="op" id="6390229">,</span>&nbsp;<span class="num" id="6390231">99</span><span class="op" id="6390233">,</span>&nbsp;<span class="num" id="6390235">99</span><span class="op" id="6390237">,</span>&nbsp;<span class="num" id="6390239">99</span><span class="op" id="6390241">,</span>&nbsp;<span class="num" id="6390243">99</span><span class="op" id="6390245">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390249">99</span><span class="op" id="6390251">,</span>&nbsp;<span class="num" id="6390253">99</span><span class="op" id="6390255">,</span>&nbsp;<span class="num" id="6390257">99</span><span class="op" id="6390259">,</span>&nbsp;<span class="num" id="6390261">99</span><span class="op" id="6390263">,</span>&nbsp;<span class="num" id="6390265">99</span><span class="op" id="6390267">,</span>&nbsp;<span class="num" id="6390269">99</span><span class="op" id="6390271">,</span>&nbsp;<span class="num" id="6390273">99</span><span class="op" id="6390275">,</span>&nbsp;<span class="num" id="6390277">99</span><span class="op" id="6390279">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390283">99</span><span class="op" id="6390285">,</span>&nbsp;<span class="num" id="6390287">99</span><span class="op" id="6390289">,</span>&nbsp;<span class="num" id="6390291">99</span><span class="op" id="6390293">,</span>&nbsp;<span class="num" id="6390295">99</span><span class="op" id="6390297">,</span>&nbsp;<span class="num" id="6390299">99</span><span class="op" id="6390301">,</span>&nbsp;<span class="num" id="6390303">99</span><span class="op" id="6390305">,</span>&nbsp;<span class="num" id="6390307">99</span><span class="op" id="6390309">,</span>&nbsp;<span class="num" id="6390311">99</span><span class="op" id="6390313">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6390317">99</span><span class="op" id="6390319">,</span>&nbsp;<span class="num" id="6390321">99</span><span class="op" id="6390323">,</span>&nbsp;<span class="num" id="6390325">99</span><span class="op" id="6390327">,</span>&nbsp;<span class="num" id="6390329">99</span><span class="op" id="6390331">,</span>&nbsp;<span class="num" id="6390333">99</span><span class="op" id="6390335">,</span>&nbsp;<span class="num" id="6390337">99</span><span class="op" id="6390339">,</span>&nbsp;<span class="num" id="6390341">99</span><span class="op" id="6390343">,</span>&nbsp;<span class="num" id="6390345">99</span><span class="op" id="6390347">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390350">}</span><span class="op" id="6390351">,</span><br>
<span class="lineno"></span><span class="op" id="6390353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6390356">type</span>&nbsp;<span class="ident" id="6390361">huffIndex</span>&nbsp;<span class="builtintype" id="6390371">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="6390376">const</span>&nbsp;<span class="op" id="6390382">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390385">huffIndexLuminanceDC</span>&nbsp;<span class="ident" id="6390406">huffIndex</span>&nbsp;<span class="op" id="6390416">=</span>&nbsp;<span class="ident" id="6390418">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390424">huffIndexLuminanceAC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390446">huffIndexChrominanceDC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390470">huffIndexChrominanceAC</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390494">nHuffIndex</span><br>
<span class="lineno"></span><span class="op" id="6390505">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390508">//&nbsp;huffmanSpec&nbsp;specifies&nbsp;a&nbsp;Huffman&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="6390553">type</span>&nbsp;<span class="ident" id="6390558">huffmanSpec</span>&nbsp;<span class="keyword" id="6390570">struct</span>&nbsp;<span class="op" id="6390577">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390580">//&nbsp;count[i]&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;codes&nbsp;of&nbsp;length&nbsp;i&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390634">count</span>&nbsp;<span class="op" id="6390640">[</span><span class="num" id="6390641">16</span><span class="op" id="6390643">]</span><span class="builtintype" id="6390644">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390650">//&nbsp;value[i]&nbsp;is&nbsp;the&nbsp;decoded&nbsp;value&nbsp;of&nbsp;the&nbsp;i&#39;th&nbsp;codeword.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6390706">value</span>&nbsp;<span class="op" id="6390712">[</span><span class="op" id="6390713">]</span><span class="builtintype" id="6390714">byte</span><br>
<span class="lineno"></span><span class="op" id="6390719">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="6390722">//&nbsp;theHuffmanSpec&nbsp;is&nbsp;the&nbsp;Huffman&nbsp;encoding&nbsp;specifications.</span><br>
<span class="lineno"></span><span class="comment" id="6390780">//&nbsp;This&nbsp;encoder&nbsp;uses&nbsp;the&nbsp;same&nbsp;Huffman&nbsp;encoding&nbsp;for&nbsp;all&nbsp;images.</span><br>
<span class="lineno"></span><span class="keyword" id="6390843">var</span>&nbsp;<span class="ident" id="6390847">theHuffmanSpec</span>&nbsp;<span class="op" id="6390862">=</span>&nbsp;<span class="op" id="6390864">[</span><span class="ident" id="6390865">nHuffIndex</span><span class="op" id="6390875">]</span><span class="ident" id="6390876">huffmanSpec</span><span class="op" id="6390887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6390890">//&nbsp;Luminance&nbsp;DC.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390912">[</span><span class="num" id="6390913">16</span><span class="op" id="6390915">]</span><span class="builtintype" id="6390916">byte</span><span class="op" id="6390920">{</span><span class="num" id="6390921">0</span><span class="op" id="6390922">,</span>&nbsp;<span class="num" id="6390924">1</span><span class="op" id="6390925">,</span>&nbsp;<span class="num" id="6390927">5</span><span class="op" id="6390928">,</span>&nbsp;<span class="num" id="6390930">1</span><span class="op" id="6390931">,</span>&nbsp;<span class="num" id="6390933">1</span><span class="op" id="6390934">,</span>&nbsp;<span class="num" id="6390936">1</span><span class="op" id="6390937">,</span>&nbsp;<span class="num" id="6390939">1</span><span class="op" id="6390940">,</span>&nbsp;<span class="num" id="6390942">1</span><span class="op" id="6390943">,</span>&nbsp;<span class="num" id="6390945">1</span><span class="op" id="6390946">,</span>&nbsp;<span class="num" id="6390948">0</span><span class="op" id="6390949">,</span>&nbsp;<span class="num" id="6390951">0</span><span class="op" id="6390952">,</span>&nbsp;<span class="num" id="6390954">0</span><span class="op" id="6390955">,</span>&nbsp;<span class="num" id="6390957">0</span><span class="op" id="6390958">,</span>&nbsp;<span class="num" id="6390960">0</span><span class="op" id="6390961">,</span>&nbsp;<span class="num" id="6390963">0</span><span class="op" id="6390964">,</span>&nbsp;<span class="num" id="6390966">0</span><span class="op" id="6390967">}</span><span class="op" id="6390968">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390972">[</span><span class="op" id="6390973">]</span><span class="builtintype" id="6390974">byte</span><span class="op" id="6390978">{</span><span class="num" id="6390979">0</span><span class="op" id="6390980">,</span>&nbsp;<span class="num" id="6390982">1</span><span class="op" id="6390983">,</span>&nbsp;<span class="num" id="6390985">2</span><span class="op" id="6390986">,</span>&nbsp;<span class="num" id="6390988">3</span><span class="op" id="6390989">,</span>&nbsp;<span class="num" id="6390991">4</span><span class="op" id="6390992">,</span>&nbsp;<span class="num" id="6390994">5</span><span class="op" id="6390995">,</span>&nbsp;<span class="num" id="6390997">6</span><span class="op" id="6390998">,</span>&nbsp;<span class="num" id="6391000">7</span><span class="op" id="6391001">,</span>&nbsp;<span class="num" id="6391003">8</span><span class="op" id="6391004">,</span>&nbsp;<span class="num" id="6391006">9</span><span class="op" id="6391007">,</span>&nbsp;<span class="num" id="6391009">10</span><span class="op" id="6391011">,</span>&nbsp;<span class="num" id="6391013">11</span><span class="op" id="6391015">}</span><span class="op" id="6391016">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391019">}</span><span class="op" id="6391020">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391023">//&nbsp;Luminance&nbsp;AC.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391045">[</span><span class="num" id="6391046">16</span><span class="op" id="6391048">]</span><span class="builtintype" id="6391049">byte</span><span class="op" id="6391053">{</span><span class="num" id="6391054">0</span><span class="op" id="6391055">,</span>&nbsp;<span class="num" id="6391057">2</span><span class="op" id="6391058">,</span>&nbsp;<span class="num" id="6391060">1</span><span class="op" id="6391061">,</span>&nbsp;<span class="num" id="6391063">3</span><span class="op" id="6391064">,</span>&nbsp;<span class="num" id="6391066">3</span><span class="op" id="6391067">,</span>&nbsp;<span class="num" id="6391069">2</span><span class="op" id="6391070">,</span>&nbsp;<span class="num" id="6391072">4</span><span class="op" id="6391073">,</span>&nbsp;<span class="num" id="6391075">3</span><span class="op" id="6391076">,</span>&nbsp;<span class="num" id="6391078">5</span><span class="op" id="6391079">,</span>&nbsp;<span class="num" id="6391081">5</span><span class="op" id="6391082">,</span>&nbsp;<span class="num" id="6391084">4</span><span class="op" id="6391085">,</span>&nbsp;<span class="num" id="6391087">4</span><span class="op" id="6391088">,</span>&nbsp;<span class="num" id="6391090">0</span><span class="op" id="6391091">,</span>&nbsp;<span class="num" id="6391093">0</span><span class="op" id="6391094">,</span>&nbsp;<span class="num" id="6391096">1</span><span class="op" id="6391097">,</span>&nbsp;<span class="num" id="6391099">125</span><span class="op" id="6391102">}</span><span class="op" id="6391103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391107">[</span><span class="op" id="6391108">]</span><span class="builtintype" id="6391109">byte</span><span class="op" id="6391113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391118">0x01</span><span class="op" id="6391122">,</span>&nbsp;<span class="num" id="6391124">0x02</span><span class="op" id="6391128">,</span>&nbsp;<span class="num" id="6391130">0x03</span><span class="op" id="6391134">,</span>&nbsp;<span class="num" id="6391136">0x00</span><span class="op" id="6391140">,</span>&nbsp;<span class="num" id="6391142">0x04</span><span class="op" id="6391146">,</span>&nbsp;<span class="num" id="6391148">0x11</span><span class="op" id="6391152">,</span>&nbsp;<span class="num" id="6391154">0x05</span><span class="op" id="6391158">,</span>&nbsp;<span class="num" id="6391160">0x12</span><span class="op" id="6391164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391169">0x21</span><span class="op" id="6391173">,</span>&nbsp;<span class="num" id="6391175">0x31</span><span class="op" id="6391179">,</span>&nbsp;<span class="num" id="6391181">0x41</span><span class="op" id="6391185">,</span>&nbsp;<span class="num" id="6391187">0x06</span><span class="op" id="6391191">,</span>&nbsp;<span class="num" id="6391193">0x13</span><span class="op" id="6391197">,</span>&nbsp;<span class="num" id="6391199">0x51</span><span class="op" id="6391203">,</span>&nbsp;<span class="num" id="6391205">0x61</span><span class="op" id="6391209">,</span>&nbsp;<span class="num" id="6391211">0x07</span><span class="op" id="6391215">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391220">0x22</span><span class="op" id="6391224">,</span>&nbsp;<span class="num" id="6391226">0x71</span><span class="op" id="6391230">,</span>&nbsp;<span class="num" id="6391232">0x14</span><span class="op" id="6391236">,</span>&nbsp;<span class="num" id="6391238">0x32</span><span class="op" id="6391242">,</span>&nbsp;<span class="num" id="6391244">0x81</span><span class="op" id="6391248">,</span>&nbsp;<span class="num" id="6391250">0x91</span><span class="op" id="6391254">,</span>&nbsp;<span class="num" id="6391256">0xa1</span><span class="op" id="6391260">,</span>&nbsp;<span class="num" id="6391262">0x08</span><span class="op" id="6391266">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391271">0x23</span><span class="op" id="6391275">,</span>&nbsp;<span class="num" id="6391277">0x42</span><span class="op" id="6391281">,</span>&nbsp;<span class="num" id="6391283">0xb1</span><span class="op" id="6391287">,</span>&nbsp;<span class="num" id="6391289">0xc1</span><span class="op" id="6391293">,</span>&nbsp;<span class="num" id="6391295">0x15</span><span class="op" id="6391299">,</span>&nbsp;<span class="num" id="6391301">0x52</span><span class="op" id="6391305">,</span>&nbsp;<span class="num" id="6391307">0xd1</span><span class="op" id="6391311">,</span>&nbsp;<span class="num" id="6391313">0xf0</span><span class="op" id="6391317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391322">0x24</span><span class="op" id="6391326">,</span>&nbsp;<span class="num" id="6391328">0x33</span><span class="op" id="6391332">,</span>&nbsp;<span class="num" id="6391334">0x62</span><span class="op" id="6391338">,</span>&nbsp;<span class="num" id="6391340">0x72</span><span class="op" id="6391344">,</span>&nbsp;<span class="num" id="6391346">0x82</span><span class="op" id="6391350">,</span>&nbsp;<span class="num" id="6391352">0x09</span><span class="op" id="6391356">,</span>&nbsp;<span class="num" id="6391358">0x0a</span><span class="op" id="6391362">,</span>&nbsp;<span class="num" id="6391364">0x16</span><span class="op" id="6391368">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391373">0x17</span><span class="op" id="6391377">,</span>&nbsp;<span class="num" id="6391379">0x18</span><span class="op" id="6391383">,</span>&nbsp;<span class="num" id="6391385">0x19</span><span class="op" id="6391389">,</span>&nbsp;<span class="num" id="6391391">0x1a</span><span class="op" id="6391395">,</span>&nbsp;<span class="num" id="6391397">0x25</span><span class="op" id="6391401">,</span>&nbsp;<span class="num" id="6391403">0x26</span><span class="op" id="6391407">,</span>&nbsp;<span class="num" id="6391409">0x27</span><span class="op" id="6391413">,</span>&nbsp;<span class="num" id="6391415">0x28</span><span class="op" id="6391419">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391424">0x29</span><span class="op" id="6391428">,</span>&nbsp;<span class="num" id="6391430">0x2a</span><span class="op" id="6391434">,</span>&nbsp;<span class="num" id="6391436">0x34</span><span class="op" id="6391440">,</span>&nbsp;<span class="num" id="6391442">0x35</span><span class="op" id="6391446">,</span>&nbsp;<span class="num" id="6391448">0x36</span><span class="op" id="6391452">,</span>&nbsp;<span class="num" id="6391454">0x37</span><span class="op" id="6391458">,</span>&nbsp;<span class="num" id="6391460">0x38</span><span class="op" id="6391464">,</span>&nbsp;<span class="num" id="6391466">0x39</span><span class="op" id="6391470">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391475">0x3a</span><span class="op" id="6391479">,</span>&nbsp;<span class="num" id="6391481">0x43</span><span class="op" id="6391485">,</span>&nbsp;<span class="num" id="6391487">0x44</span><span class="op" id="6391491">,</span>&nbsp;<span class="num" id="6391493">0x45</span><span class="op" id="6391497">,</span>&nbsp;<span class="num" id="6391499">0x46</span><span class="op" id="6391503">,</span>&nbsp;<span class="num" id="6391505">0x47</span><span class="op" id="6391509">,</span>&nbsp;<span class="num" id="6391511">0x48</span><span class="op" id="6391515">,</span>&nbsp;<span class="num" id="6391517">0x49</span><span class="op" id="6391521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391526">0x4a</span><span class="op" id="6391530">,</span>&nbsp;<span class="num" id="6391532">0x53</span><span class="op" id="6391536">,</span>&nbsp;<span class="num" id="6391538">0x54</span><span class="op" id="6391542">,</span>&nbsp;<span class="num" id="6391544">0x55</span><span class="op" id="6391548">,</span>&nbsp;<span class="num" id="6391550">0x56</span><span class="op" id="6391554">,</span>&nbsp;<span class="num" id="6391556">0x57</span><span class="op" id="6391560">,</span>&nbsp;<span class="num" id="6391562">0x58</span><span class="op" id="6391566">,</span>&nbsp;<span class="num" id="6391568">0x59</span><span class="op" id="6391572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391577">0x5a</span><span class="op" id="6391581">,</span>&nbsp;<span class="num" id="6391583">0x63</span><span class="op" id="6391587">,</span>&nbsp;<span class="num" id="6391589">0x64</span><span class="op" id="6391593">,</span>&nbsp;<span class="num" id="6391595">0x65</span><span class="op" id="6391599">,</span>&nbsp;<span class="num" id="6391601">0x66</span><span class="op" id="6391605">,</span>&nbsp;<span class="num" id="6391607">0x67</span><span class="op" id="6391611">,</span>&nbsp;<span class="num" id="6391613">0x68</span><span class="op" id="6391617">,</span>&nbsp;<span class="num" id="6391619">0x69</span><span class="op" id="6391623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391628">0x6a</span><span class="op" id="6391632">,</span>&nbsp;<span class="num" id="6391634">0x73</span><span class="op" id="6391638">,</span>&nbsp;<span class="num" id="6391640">0x74</span><span class="op" id="6391644">,</span>&nbsp;<span class="num" id="6391646">0x75</span><span class="op" id="6391650">,</span>&nbsp;<span class="num" id="6391652">0x76</span><span class="op" id="6391656">,</span>&nbsp;<span class="num" id="6391658">0x77</span><span class="op" id="6391662">,</span>&nbsp;<span class="num" id="6391664">0x78</span><span class="op" id="6391668">,</span>&nbsp;<span class="num" id="6391670">0x79</span><span class="op" id="6391674">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391679">0x7a</span><span class="op" id="6391683">,</span>&nbsp;<span class="num" id="6391685">0x83</span><span class="op" id="6391689">,</span>&nbsp;<span class="num" id="6391691">0x84</span><span class="op" id="6391695">,</span>&nbsp;<span class="num" id="6391697">0x85</span><span class="op" id="6391701">,</span>&nbsp;<span class="num" id="6391703">0x86</span><span class="op" id="6391707">,</span>&nbsp;<span class="num" id="6391709">0x87</span><span class="op" id="6391713">,</span>&nbsp;<span class="num" id="6391715">0x88</span><span class="op" id="6391719">,</span>&nbsp;<span class="num" id="6391721">0x89</span><span class="op" id="6391725">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391730">0x8a</span><span class="op" id="6391734">,</span>&nbsp;<span class="num" id="6391736">0x92</span><span class="op" id="6391740">,</span>&nbsp;<span class="num" id="6391742">0x93</span><span class="op" id="6391746">,</span>&nbsp;<span class="num" id="6391748">0x94</span><span class="op" id="6391752">,</span>&nbsp;<span class="num" id="6391754">0x95</span><span class="op" id="6391758">,</span>&nbsp;<span class="num" id="6391760">0x96</span><span class="op" id="6391764">,</span>&nbsp;<span class="num" id="6391766">0x97</span><span class="op" id="6391770">,</span>&nbsp;<span class="num" id="6391772">0x98</span><span class="op" id="6391776">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391781">0x99</span><span class="op" id="6391785">,</span>&nbsp;<span class="num" id="6391787">0x9a</span><span class="op" id="6391791">,</span>&nbsp;<span class="num" id="6391793">0xa2</span><span class="op" id="6391797">,</span>&nbsp;<span class="num" id="6391799">0xa3</span><span class="op" id="6391803">,</span>&nbsp;<span class="num" id="6391805">0xa4</span><span class="op" id="6391809">,</span>&nbsp;<span class="num" id="6391811">0xa5</span><span class="op" id="6391815">,</span>&nbsp;<span class="num" id="6391817">0xa6</span><span class="op" id="6391821">,</span>&nbsp;<span class="num" id="6391823">0xa7</span><span class="op" id="6391827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391832">0xa8</span><span class="op" id="6391836">,</span>&nbsp;<span class="num" id="6391838">0xa9</span><span class="op" id="6391842">,</span>&nbsp;<span class="num" id="6391844">0xaa</span><span class="op" id="6391848">,</span>&nbsp;<span class="num" id="6391850">0xb2</span><span class="op" id="6391854">,</span>&nbsp;<span class="num" id="6391856">0xb3</span><span class="op" id="6391860">,</span>&nbsp;<span class="num" id="6391862">0xb4</span><span class="op" id="6391866">,</span>&nbsp;<span class="num" id="6391868">0xb5</span><span class="op" id="6391872">,</span>&nbsp;<span class="num" id="6391874">0xb6</span><span class="op" id="6391878">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391883">0xb7</span><span class="op" id="6391887">,</span>&nbsp;<span class="num" id="6391889">0xb8</span><span class="op" id="6391893">,</span>&nbsp;<span class="num" id="6391895">0xb9</span><span class="op" id="6391899">,</span>&nbsp;<span class="num" id="6391901">0xba</span><span class="op" id="6391905">,</span>&nbsp;<span class="num" id="6391907">0xc2</span><span class="op" id="6391911">,</span>&nbsp;<span class="num" id="6391913">0xc3</span><span class="op" id="6391917">,</span>&nbsp;<span class="num" id="6391919">0xc4</span><span class="op" id="6391923">,</span>&nbsp;<span class="num" id="6391925">0xc5</span><span class="op" id="6391929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391934">0xc6</span><span class="op" id="6391938">,</span>&nbsp;<span class="num" id="6391940">0xc7</span><span class="op" id="6391944">,</span>&nbsp;<span class="num" id="6391946">0xc8</span><span class="op" id="6391950">,</span>&nbsp;<span class="num" id="6391952">0xc9</span><span class="op" id="6391956">,</span>&nbsp;<span class="num" id="6391958">0xca</span><span class="op" id="6391962">,</span>&nbsp;<span class="num" id="6391964">0xd2</span><span class="op" id="6391968">,</span>&nbsp;<span class="num" id="6391970">0xd3</span><span class="op" id="6391974">,</span>&nbsp;<span class="num" id="6391976">0xd4</span><span class="op" id="6391980">,</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6391985">0xd5</span><span class="op" id="6391989">,</span>&nbsp;<span class="num" id="6391991">0xd6</span><span class="op" id="6391995">,</span>&nbsp;<span class="num" id="6391997">0xd7</span><span class="op" id="6392001">,</span>&nbsp;<span class="num" id="6392003">0xd8</span><span class="op" id="6392007">,</span>&nbsp;<span class="num" id="6392009">0xd9</span><span class="op" id="6392013">,</span>&nbsp;<span class="num" id="6392015">0xda</span><span class="op" id="6392019">,</span>&nbsp;<span class="num" id="6392021">0xe1</span><span class="op" id="6392025">,</span>&nbsp;<span class="num" id="6392027">0xe2</span><span class="op" id="6392031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392036">0xe3</span><span class="op" id="6392040">,</span>&nbsp;<span class="num" id="6392042">0xe4</span><span class="op" id="6392046">,</span>&nbsp;<span class="num" id="6392048">0xe5</span><span class="op" id="6392052">,</span>&nbsp;<span class="num" id="6392054">0xe6</span><span class="op" id="6392058">,</span>&nbsp;<span class="num" id="6392060">0xe7</span><span class="op" id="6392064">,</span>&nbsp;<span class="num" id="6392066">0xe8</span><span class="op" id="6392070">,</span>&nbsp;<span class="num" id="6392072">0xe9</span><span class="op" id="6392076">,</span>&nbsp;<span class="num" id="6392078">0xea</span><span class="op" id="6392082">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392087">0xf1</span><span class="op" id="6392091">,</span>&nbsp;<span class="num" id="6392093">0xf2</span><span class="op" id="6392097">,</span>&nbsp;<span class="num" id="6392099">0xf3</span><span class="op" id="6392103">,</span>&nbsp;<span class="num" id="6392105">0xf4</span><span class="op" id="6392109">,</span>&nbsp;<span class="num" id="6392111">0xf5</span><span class="op" id="6392115">,</span>&nbsp;<span class="num" id="6392117">0xf6</span><span class="op" id="6392121">,</span>&nbsp;<span class="num" id="6392123">0xf7</span><span class="op" id="6392127">,</span>&nbsp;<span class="num" id="6392129">0xf8</span><span class="op" id="6392133">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392138">0xf9</span><span class="op" id="6392142">,</span>&nbsp;<span class="num" id="6392144">0xfa</span><span class="op" id="6392148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392152">}</span><span class="op" id="6392153">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392156">}</span><span class="op" id="6392157">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392160">//&nbsp;Chrominance&nbsp;DC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392184">[</span><span class="num" id="6392185">16</span><span class="op" id="6392187">]</span><span class="builtintype" id="6392188">byte</span><span class="op" id="6392192">{</span><span class="num" id="6392193">0</span><span class="op" id="6392194">,</span>&nbsp;<span class="num" id="6392196">3</span><span class="op" id="6392197">,</span>&nbsp;<span class="num" id="6392199">1</span><span class="op" id="6392200">,</span>&nbsp;<span class="num" id="6392202">1</span><span class="op" id="6392203">,</span>&nbsp;<span class="num" id="6392205">1</span><span class="op" id="6392206">,</span>&nbsp;<span class="num" id="6392208">1</span><span class="op" id="6392209">,</span>&nbsp;<span class="num" id="6392211">1</span><span class="op" id="6392212">,</span>&nbsp;<span class="num" id="6392214">1</span><span class="op" id="6392215">,</span>&nbsp;<span class="num" id="6392217">1</span><span class="op" id="6392218">,</span>&nbsp;<span class="num" id="6392220">1</span><span class="op" id="6392221">,</span>&nbsp;<span class="num" id="6392223">1</span><span class="op" id="6392224">,</span>&nbsp;<span class="num" id="6392226">0</span><span class="op" id="6392227">,</span>&nbsp;<span class="num" id="6392229">0</span><span class="op" id="6392230">,</span>&nbsp;<span class="num" id="6392232">0</span><span class="op" id="6392233">,</span>&nbsp;<span class="num" id="6392235">0</span><span class="op" id="6392236">,</span>&nbsp;<span class="num" id="6392238">0</span><span class="op" id="6392239">}</span><span class="op" id="6392240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392244">[</span><span class="op" id="6392245">]</span><span class="builtintype" id="6392246">byte</span><span class="op" id="6392250">{</span><span class="num" id="6392251">0</span><span class="op" id="6392252">,</span>&nbsp;<span class="num" id="6392254">1</span><span class="op" id="6392255">,</span>&nbsp;<span class="num" id="6392257">2</span><span class="op" id="6392258">,</span>&nbsp;<span class="num" id="6392260">3</span><span class="op" id="6392261">,</span>&nbsp;<span class="num" id="6392263">4</span><span class="op" id="6392264">,</span>&nbsp;<span class="num" id="6392266">5</span><span class="op" id="6392267">,</span>&nbsp;<span class="num" id="6392269">6</span><span class="op" id="6392270">,</span>&nbsp;<span class="num" id="6392272">7</span><span class="op" id="6392273">,</span>&nbsp;<span class="num" id="6392275">8</span><span class="op" id="6392276">,</span>&nbsp;<span class="num" id="6392278">9</span><span class="op" id="6392279">,</span>&nbsp;<span class="num" id="6392281">10</span><span class="op" id="6392283">,</span>&nbsp;<span class="num" id="6392285">11</span><span class="op" id="6392287">}</span><span class="op" id="6392288">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392291">}</span><span class="op" id="6392292">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392295">//&nbsp;Chrominance&nbsp;AC.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392319">[</span><span class="num" id="6392320">16</span><span class="op" id="6392322">]</span><span class="builtintype" id="6392323">byte</span><span class="op" id="6392327">{</span><span class="num" id="6392328">0</span><span class="op" id="6392329">,</span>&nbsp;<span class="num" id="6392331">2</span><span class="op" id="6392332">,</span>&nbsp;<span class="num" id="6392334">1</span><span class="op" id="6392335">,</span>&nbsp;<span class="num" id="6392337">2</span><span class="op" id="6392338">,</span>&nbsp;<span class="num" id="6392340">4</span><span class="op" id="6392341">,</span>&nbsp;<span class="num" id="6392343">4</span><span class="op" id="6392344">,</span>&nbsp;<span class="num" id="6392346">3</span><span class="op" id="6392347">,</span>&nbsp;<span class="num" id="6392349">4</span><span class="op" id="6392350">,</span>&nbsp;<span class="num" id="6392352">7</span><span class="op" id="6392353">,</span>&nbsp;<span class="num" id="6392355">5</span><span class="op" id="6392356">,</span>&nbsp;<span class="num" id="6392358">4</span><span class="op" id="6392359">,</span>&nbsp;<span class="num" id="6392361">4</span><span class="op" id="6392362">,</span>&nbsp;<span class="num" id="6392364">0</span><span class="op" id="6392365">,</span>&nbsp;<span class="num" id="6392367">1</span><span class="op" id="6392368">,</span>&nbsp;<span class="num" id="6392370">2</span><span class="op" id="6392371">,</span>&nbsp;<span class="num" id="6392373">119</span><span class="op" id="6392376">}</span><span class="op" id="6392377">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392381">[</span><span class="op" id="6392382">]</span><span class="builtintype" id="6392383">byte</span><span class="op" id="6392387">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392392">0x00</span><span class="op" id="6392396">,</span>&nbsp;<span class="num" id="6392398">0x01</span><span class="op" id="6392402">,</span>&nbsp;<span class="num" id="6392404">0x02</span><span class="op" id="6392408">,</span>&nbsp;<span class="num" id="6392410">0x03</span><span class="op" id="6392414">,</span>&nbsp;<span class="num" id="6392416">0x11</span><span class="op" id="6392420">,</span>&nbsp;<span class="num" id="6392422">0x04</span><span class="op" id="6392426">,</span>&nbsp;<span class="num" id="6392428">0x05</span><span class="op" id="6392432">,</span>&nbsp;<span class="num" id="6392434">0x21</span><span class="op" id="6392438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392443">0x31</span><span class="op" id="6392447">,</span>&nbsp;<span class="num" id="6392449">0x06</span><span class="op" id="6392453">,</span>&nbsp;<span class="num" id="6392455">0x12</span><span class="op" id="6392459">,</span>&nbsp;<span class="num" id="6392461">0x41</span><span class="op" id="6392465">,</span>&nbsp;<span class="num" id="6392467">0x51</span><span class="op" id="6392471">,</span>&nbsp;<span class="num" id="6392473">0x07</span><span class="op" id="6392477">,</span>&nbsp;<span class="num" id="6392479">0x61</span><span class="op" id="6392483">,</span>&nbsp;<span class="num" id="6392485">0x71</span><span class="op" id="6392489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392494">0x13</span><span class="op" id="6392498">,</span>&nbsp;<span class="num" id="6392500">0x22</span><span class="op" id="6392504">,</span>&nbsp;<span class="num" id="6392506">0x32</span><span class="op" id="6392510">,</span>&nbsp;<span class="num" id="6392512">0x81</span><span class="op" id="6392516">,</span>&nbsp;<span class="num" id="6392518">0x08</span><span class="op" id="6392522">,</span>&nbsp;<span class="num" id="6392524">0x14</span><span class="op" id="6392528">,</span>&nbsp;<span class="num" id="6392530">0x42</span><span class="op" id="6392534">,</span>&nbsp;<span class="num" id="6392536">0x91</span><span class="op" id="6392540">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392545">0xa1</span><span class="op" id="6392549">,</span>&nbsp;<span class="num" id="6392551">0xb1</span><span class="op" id="6392555">,</span>&nbsp;<span class="num" id="6392557">0xc1</span><span class="op" id="6392561">,</span>&nbsp;<span class="num" id="6392563">0x09</span><span class="op" id="6392567">,</span>&nbsp;<span class="num" id="6392569">0x23</span><span class="op" id="6392573">,</span>&nbsp;<span class="num" id="6392575">0x33</span><span class="op" id="6392579">,</span>&nbsp;<span class="num" id="6392581">0x52</span><span class="op" id="6392585">,</span>&nbsp;<span class="num" id="6392587">0xf0</span><span class="op" id="6392591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392596">0x15</span><span class="op" id="6392600">,</span>&nbsp;<span class="num" id="6392602">0x62</span><span class="op" id="6392606">,</span>&nbsp;<span class="num" id="6392608">0x72</span><span class="op" id="6392612">,</span>&nbsp;<span class="num" id="6392614">0xd1</span><span class="op" id="6392618">,</span>&nbsp;<span class="num" id="6392620">0x0a</span><span class="op" id="6392624">,</span>&nbsp;<span class="num" id="6392626">0x16</span><span class="op" id="6392630">,</span>&nbsp;<span class="num" id="6392632">0x24</span><span class="op" id="6392636">,</span>&nbsp;<span class="num" id="6392638">0x34</span><span class="op" id="6392642">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392647">0xe1</span><span class="op" id="6392651">,</span>&nbsp;<span class="num" id="6392653">0x25</span><span class="op" id="6392657">,</span>&nbsp;<span class="num" id="6392659">0xf1</span><span class="op" id="6392663">,</span>&nbsp;<span class="num" id="6392665">0x17</span><span class="op" id="6392669">,</span>&nbsp;<span class="num" id="6392671">0x18</span><span class="op" id="6392675">,</span>&nbsp;<span class="num" id="6392677">0x19</span><span class="op" id="6392681">,</span>&nbsp;<span class="num" id="6392683">0x1a</span><span class="op" id="6392687">,</span>&nbsp;<span class="num" id="6392689">0x26</span><span class="op" id="6392693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392698">0x27</span><span class="op" id="6392702">,</span>&nbsp;<span class="num" id="6392704">0x28</span><span class="op" id="6392708">,</span>&nbsp;<span class="num" id="6392710">0x29</span><span class="op" id="6392714">,</span>&nbsp;<span class="num" id="6392716">0x2a</span><span class="op" id="6392720">,</span>&nbsp;<span class="num" id="6392722">0x35</span><span class="op" id="6392726">,</span>&nbsp;<span class="num" id="6392728">0x36</span><span class="op" id="6392732">,</span>&nbsp;<span class="num" id="6392734">0x37</span><span class="op" id="6392738">,</span>&nbsp;<span class="num" id="6392740">0x38</span><span class="op" id="6392744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392749">0x39</span><span class="op" id="6392753">,</span>&nbsp;<span class="num" id="6392755">0x3a</span><span class="op" id="6392759">,</span>&nbsp;<span class="num" id="6392761">0x43</span><span class="op" id="6392765">,</span>&nbsp;<span class="num" id="6392767">0x44</span><span class="op" id="6392771">,</span>&nbsp;<span class="num" id="6392773">0x45</span><span class="op" id="6392777">,</span>&nbsp;<span class="num" id="6392779">0x46</span><span class="op" id="6392783">,</span>&nbsp;<span class="num" id="6392785">0x47</span><span class="op" id="6392789">,</span>&nbsp;<span class="num" id="6392791">0x48</span><span class="op" id="6392795">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392800">0x49</span><span class="op" id="6392804">,</span>&nbsp;<span class="num" id="6392806">0x4a</span><span class="op" id="6392810">,</span>&nbsp;<span class="num" id="6392812">0x53</span><span class="op" id="6392816">,</span>&nbsp;<span class="num" id="6392818">0x54</span><span class="op" id="6392822">,</span>&nbsp;<span class="num" id="6392824">0x55</span><span class="op" id="6392828">,</span>&nbsp;<span class="num" id="6392830">0x56</span><span class="op" id="6392834">,</span>&nbsp;<span class="num" id="6392836">0x57</span><span class="op" id="6392840">,</span>&nbsp;<span class="num" id="6392842">0x58</span><span class="op" id="6392846">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392851">0x59</span><span class="op" id="6392855">,</span>&nbsp;<span class="num" id="6392857">0x5a</span><span class="op" id="6392861">,</span>&nbsp;<span class="num" id="6392863">0x63</span><span class="op" id="6392867">,</span>&nbsp;<span class="num" id="6392869">0x64</span><span class="op" id="6392873">,</span>&nbsp;<span class="num" id="6392875">0x65</span><span class="op" id="6392879">,</span>&nbsp;<span class="num" id="6392881">0x66</span><span class="op" id="6392885">,</span>&nbsp;<span class="num" id="6392887">0x67</span><span class="op" id="6392891">,</span>&nbsp;<span class="num" id="6392893">0x68</span><span class="op" id="6392897">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392902">0x69</span><span class="op" id="6392906">,</span>&nbsp;<span class="num" id="6392908">0x6a</span><span class="op" id="6392912">,</span>&nbsp;<span class="num" id="6392914">0x73</span><span class="op" id="6392918">,</span>&nbsp;<span class="num" id="6392920">0x74</span><span class="op" id="6392924">,</span>&nbsp;<span class="num" id="6392926">0x75</span><span class="op" id="6392930">,</span>&nbsp;<span class="num" id="6392932">0x76</span><span class="op" id="6392936">,</span>&nbsp;<span class="num" id="6392938">0x77</span><span class="op" id="6392942">,</span>&nbsp;<span class="num" id="6392944">0x78</span><span class="op" id="6392948">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6392953">0x79</span><span class="op" id="6392957">,</span>&nbsp;<span class="num" id="6392959">0x7a</span><span class="op" id="6392963">,</span>&nbsp;<span class="num" id="6392965">0x82</span><span class="op" id="6392969">,</span>&nbsp;<span class="num" id="6392971">0x83</span><span class="op" id="6392975">,</span>&nbsp;<span class="num" id="6392977">0x84</span><span class="op" id="6392981">,</span>&nbsp;<span class="num" id="6392983">0x85</span><span class="op" id="6392987">,</span>&nbsp;<span class="num" id="6392989">0x86</span><span class="op" id="6392993">,</span>&nbsp;<span class="num" id="6392995">0x87</span><span class="op" id="6392999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393004">0x88</span><span class="op" id="6393008">,</span>&nbsp;<span class="num" id="6393010">0x89</span><span class="op" id="6393014">,</span>&nbsp;<span class="num" id="6393016">0x8a</span><span class="op" id="6393020">,</span>&nbsp;<span class="num" id="6393022">0x92</span><span class="op" id="6393026">,</span>&nbsp;<span class="num" id="6393028">0x93</span><span class="op" id="6393032">,</span>&nbsp;<span class="num" id="6393034">0x94</span><span class="op" id="6393038">,</span>&nbsp;<span class="num" id="6393040">0x95</span><span class="op" id="6393044">,</span>&nbsp;<span class="num" id="6393046">0x96</span><span class="op" id="6393050">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393055">0x97</span><span class="op" id="6393059">,</span>&nbsp;<span class="num" id="6393061">0x98</span><span class="op" id="6393065">,</span>&nbsp;<span class="num" id="6393067">0x99</span><span class="op" id="6393071">,</span>&nbsp;<span class="num" id="6393073">0x9a</span><span class="op" id="6393077">,</span>&nbsp;<span class="num" id="6393079">0xa2</span><span class="op" id="6393083">,</span>&nbsp;<span class="num" id="6393085">0xa3</span><span class="op" id="6393089">,</span>&nbsp;<span class="num" id="6393091">0xa4</span><span class="op" id="6393095">,</span>&nbsp;<span class="num" id="6393097">0xa5</span><span class="op" id="6393101">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393106">0xa6</span><span class="op" id="6393110">,</span>&nbsp;<span class="num" id="6393112">0xa7</span><span class="op" id="6393116">,</span>&nbsp;<span class="num" id="6393118">0xa8</span><span class="op" id="6393122">,</span>&nbsp;<span class="num" id="6393124">0xa9</span><span class="op" id="6393128">,</span>&nbsp;<span class="num" id="6393130">0xaa</span><span class="op" id="6393134">,</span>&nbsp;<span class="num" id="6393136">0xb2</span><span class="op" id="6393140">,</span>&nbsp;<span class="num" id="6393142">0xb3</span><span class="op" id="6393146">,</span>&nbsp;<span class="num" id="6393148">0xb4</span><span class="op" id="6393152">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393157">0xb5</span><span class="op" id="6393161">,</span>&nbsp;<span class="num" id="6393163">0xb6</span><span class="op" id="6393167">,</span>&nbsp;<span class="num" id="6393169">0xb7</span><span class="op" id="6393173">,</span>&nbsp;<span class="num" id="6393175">0xb8</span><span class="op" id="6393179">,</span>&nbsp;<span class="num" id="6393181">0xb9</span><span class="op" id="6393185">,</span>&nbsp;<span class="num" id="6393187">0xba</span><span class="op" id="6393191">,</span>&nbsp;<span class="num" id="6393193">0xc2</span><span class="op" id="6393197">,</span>&nbsp;<span class="num" id="6393199">0xc3</span><span class="op" id="6393203">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393208">0xc4</span><span class="op" id="6393212">,</span>&nbsp;<span class="num" id="6393214">0xc5</span><span class="op" id="6393218">,</span>&nbsp;<span class="num" id="6393220">0xc6</span><span class="op" id="6393224">,</span>&nbsp;<span class="num" id="6393226">0xc7</span><span class="op" id="6393230">,</span>&nbsp;<span class="num" id="6393232">0xc8</span><span class="op" id="6393236">,</span>&nbsp;<span class="num" id="6393238">0xc9</span><span class="op" id="6393242">,</span>&nbsp;<span class="num" id="6393244">0xca</span><span class="op" id="6393248">,</span>&nbsp;<span class="num" id="6393250">0xd2</span><span class="op" id="6393254">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393259">0xd3</span><span class="op" id="6393263">,</span>&nbsp;<span class="num" id="6393265">0xd4</span><span class="op" id="6393269">,</span>&nbsp;<span class="num" id="6393271">0xd5</span><span class="op" id="6393275">,</span>&nbsp;<span class="num" id="6393277">0xd6</span><span class="op" id="6393281">,</span>&nbsp;<span class="num" id="6393283">0xd7</span><span class="op" id="6393287">,</span>&nbsp;<span class="num" id="6393289">0xd8</span><span class="op" id="6393293">,</span>&nbsp;<span class="num" id="6393295">0xd9</span><span class="op" id="6393299">,</span>&nbsp;<span class="num" id="6393301">0xda</span><span class="op" id="6393305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393310">0xe2</span><span class="op" id="6393314">,</span>&nbsp;<span class="num" id="6393316">0xe3</span><span class="op" id="6393320">,</span>&nbsp;<span class="num" id="6393322">0xe4</span><span class="op" id="6393326">,</span>&nbsp;<span class="num" id="6393328">0xe5</span><span class="op" id="6393332">,</span>&nbsp;<span class="num" id="6393334">0xe6</span><span class="op" id="6393338">,</span>&nbsp;<span class="num" id="6393340">0xe7</span><span class="op" id="6393344">,</span>&nbsp;<span class="num" id="6393346">0xe8</span><span class="op" id="6393350">,</span>&nbsp;<span class="num" id="6393352">0xe9</span><span class="op" id="6393356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393361">0xea</span><span class="op" id="6393365">,</span>&nbsp;<span class="num" id="6393367">0xf2</span><span class="op" id="6393371">,</span>&nbsp;<span class="num" id="6393373">0xf3</span><span class="op" id="6393377">,</span>&nbsp;<span class="num" id="6393379">0xf4</span><span class="op" id="6393383">,</span>&nbsp;<span class="num" id="6393385">0xf5</span><span class="op" id="6393389">,</span>&nbsp;<span class="num" id="6393391">0xf6</span><span class="op" id="6393395">,</span>&nbsp;<span class="num" id="6393397">0xf7</span><span class="op" id="6393401">,</span>&nbsp;<span class="num" id="6393403">0xf8</span><span class="op" id="6393407">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6393412">0xf9</span><span class="op" id="6393416">,</span>&nbsp;<span class="num" id="6393418">0xfa</span><span class="op" id="6393422">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393426">}</span><span class="op" id="6393427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393430">}</span><span class="op" id="6393431">,</span><br>
<span class="lineno"></span><span class="op" id="6393433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6393436">//&nbsp;huffmanLUT&nbsp;is&nbsp;a&nbsp;compiled&nbsp;look-up&nbsp;table&nbsp;representation&nbsp;of&nbsp;a&nbsp;huffmanSpec.</span><br>
<span class="lineno"></span><span class="comment" id="6393511">//&nbsp;Each&nbsp;value&nbsp;maps&nbsp;to&nbsp;a&nbsp;uint32&nbsp;of&nbsp;which&nbsp;the&nbsp;8&nbsp;most&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6393588">//&nbsp;codeword&nbsp;size&nbsp;in&nbsp;bits&nbsp;and&nbsp;the&nbsp;24&nbsp;least&nbsp;significant&nbsp;bits&nbsp;hold&nbsp;the&nbsp;codeword.</span><br>
<span class="lineno"></span><span class="comment" id="6393666">//&nbsp;The&nbsp;maximum&nbsp;codeword&nbsp;size&nbsp;is&nbsp;16&nbsp;bits.</span><br>
<span class="lineno"></span><span class="keyword" id="6393707">type</span>&nbsp;<span class="ident" id="6393712">huffmanLUT</span>&nbsp;<span class="op" id="6393723">[</span><span class="op" id="6393724">]</span><span class="builtintype" id="6393725">uint32</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="6393733">func</span>&nbsp;<span class="op" id="6393738">(</span><span class="ident" id="6393739">h</span>&nbsp;<span class="op" id="6393741">*</span><span class="ident" id="6393742">huffmanLUT</span><span class="op" id="6393752">)</span>&nbsp;<span class="ident" id="6393754">init</span><span class="op" id="6393758">(</span><span class="ident" id="6393759">s</span>&nbsp;<span class="ident" id="6393761">huffmanSpec</span><span class="op" id="6393772">)</span>&nbsp;<span class="op" id="6393774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393777">maxValue</span>&nbsp;<span class="op" id="6393786">:=</span>&nbsp;<span class="num" id="6393789">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393792">for</span>&nbsp;<span class="ident" id="6393796">_</span><span class="op" id="6393797">,</span>&nbsp;<span class="ident" id="6393799">v</span>&nbsp;<span class="op" id="6393801">:=</span>&nbsp;<span class="keyword" id="6393804">range</span>&nbsp;<span class="ident" id="6393810">s</span><span class="op" id="6393811">.</span><span class="ident" id="6393812">value</span>&nbsp;<span class="op" id="6393818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393822">if</span>&nbsp;<span class="builtintype" id="6393825">int</span><span class="op" id="6393828">(</span><span class="ident" id="6393829">v</span><span class="op" id="6393830">)</span>&nbsp;<span class="op" id="6393832">&gt;</span>&nbsp;<span class="ident" id="6393834">maxValue</span>&nbsp;<span class="op" id="6393843">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393848">maxValue</span>&nbsp;<span class="op" id="6393857">=</span>&nbsp;<span class="builtintype" id="6393859">int</span><span class="op" id="6393862">(</span><span class="ident" id="6393863">v</span><span class="op" id="6393864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393874">*</span><span class="ident" id="6393875">h</span>&nbsp;<span class="op" id="6393877">=</span>&nbsp;<span class="builtinfunc" id="6393879">make</span><span class="op" id="6393883">(</span><span class="op" id="6393884">[</span><span class="op" id="6393885">]</span><span class="builtintype" id="6393886">uint32</span><span class="op" id="6393892">,</span>&nbsp;<span class="ident" id="6393894">maxValue</span><span class="op" id="6393902">+</span><span class="num" id="6393903">1</span><span class="op" id="6393904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393907">code</span><span class="op" id="6393911">,</span>&nbsp;<span class="ident" id="6393913">k</span>&nbsp;<span class="op" id="6393915">:=</span>&nbsp;<span class="builtintype" id="6393918">uint32</span><span class="op" id="6393924">(</span><span class="num" id="6393925">0</span><span class="op" id="6393926">)</span><span class="op" id="6393927">,</span>&nbsp;<span class="num" id="6393929">0</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393932">for</span>&nbsp;<span class="ident" id="6393936">i</span>&nbsp;<span class="op" id="6393938">:=</span>&nbsp;<span class="num" id="6393941">0</span><span class="op" id="6393942">;</span>&nbsp;<span class="ident" id="6393944">i</span>&nbsp;<span class="op" id="6393946">&lt;</span>&nbsp;<span class="builtinfunc" id="6393948">len</span><span class="op" id="6393951">(</span><span class="ident" id="6393952">s</span><span class="op" id="6393953">.</span><span class="ident" id="6393954">count</span><span class="op" id="6393959">)</span><span class="op" id="6393960">;</span>&nbsp;<span class="ident" id="6393962">i</span><span class="op" id="6393963">++</span>&nbsp;<span class="op" id="6393966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393970">nBits</span>&nbsp;<span class="op" id="6393976">:=</span>&nbsp;<span class="builtintype" id="6393979">uint32</span><span class="op" id="6393985">(</span><span class="ident" id="6393986">i</span><span class="op" id="6393987">+</span><span class="num" id="6393988">1</span><span class="op" id="6393989">)</span>&nbsp;<span class="op" id="6393991">&lt;&lt;</span>&nbsp;<span class="num" id="6393994">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393999">for</span>&nbsp;<span class="ident" id="6394003">j</span>&nbsp;<span class="op" id="6394005">:=</span>&nbsp;<span class="builtintype" id="6394008">uint8</span><span class="op" id="6394013">(</span><span class="num" id="6394014">0</span><span class="op" id="6394015">)</span><span class="op" id="6394016">;</span>&nbsp;<span class="ident" id="6394018">j</span>&nbsp;<span class="op" id="6394020">&lt;</span>&nbsp;<span class="ident" id="6394022">s</span><span class="op" id="6394023">.</span><span class="ident" id="6394024">count</span><span class="op" id="6394029">[</span><span class="ident" id="6394030">i</span><span class="op" id="6394031">]</span><span class="op" id="6394032">;</span>&nbsp;<span class="ident" id="6394034">j</span><span class="op" id="6394035">++</span>&nbsp;<span class="op" id="6394038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394043">(</span><span class="op" id="6394044">*</span><span class="ident" id="6394045">h</span><span class="op" id="6394046">)</span><span class="op" id="6394047">[</span><span class="ident" id="6394048">s</span><span class="op" id="6394049">.</span><span class="ident" id="6394050">value</span><span class="op" id="6394055">[</span><span class="ident" id="6394056">k</span><span class="op" id="6394057">]</span><span class="op" id="6394058">]</span>&nbsp;<span class="op" id="6394060">=</span>&nbsp;<span class="ident" id="6394062">nBits</span>&nbsp;<span class="op" id="6394068">|</span>&nbsp;<span class="ident" id="6394070">code</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394078">code</span><span class="op" id="6394082">++</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394088">k</span><span class="op" id="6394089">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394098">code</span>&nbsp;<span class="op" id="6394103">&lt;&lt;=</span>&nbsp;<span class="num" id="6394107">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394110">}</span><br>
<span class="lineno"></span><span class="op" id="6394112">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="comment" id="6394115">//&nbsp;theHuffmanLUT&nbsp;are&nbsp;compiled&nbsp;representations&nbsp;of&nbsp;theHuffmanSpec.</span><br>
<span class="lineno"></span><span class="keyword" id="6394180">var</span>&nbsp;<span class="ident" id="6394184">theHuffmanLUT</span>&nbsp;<span class="op" id="6394198">[</span><span class="num" id="6394199">4</span><span class="op" id="6394200">]</span><span class="ident" id="6394201">huffmanLUT</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6394213">func</span>&nbsp;<span class="ident" id="6394218">init</span><span class="op" id="6394222">(</span><span class="op" id="6394223">)</span>&nbsp;<span class="op" id="6394225">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394228">for</span>&nbsp;<span class="ident" id="6394232">i</span><span class="op" id="6394233">,</span>&nbsp;<span class="ident" id="6394235">s</span>&nbsp;<span class="op" id="6394237">:=</span>&nbsp;<span class="keyword" id="6394240">range</span>&nbsp;<span class="ident" id="6394246">theHuffmanSpec</span>&nbsp;<span class="op" id="6394261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394265">theHuffmanLUT</span><span class="op" id="6394278">[</span><span class="ident" id="6394279">i</span><span class="op" id="6394280">]</span><span class="op" id="6394281">.</span><span class="ident" id="6394282">init</span><span class="op" id="6394286">(</span><span class="ident" id="6394287">s</span><span class="op" id="6394288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394291">}</span><br>
<span class="lineno"></span><span class="op" id="6394293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="comment" id="6394296">//&nbsp;writer&nbsp;is&nbsp;a&nbsp;buffered&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="6394328">type</span>&nbsp;<span class="ident" id="6394333">writer</span>&nbsp;<span class="keyword" id="6394340">interface</span>&nbsp;<span class="op" id="6394350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394353">Flush</span><span class="op" id="6394358">(</span><span class="op" id="6394359">)</span>&nbsp;<span class="builtintype" id="6394361">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394368">io</span><span class="op" id="6394370">.</span><span class="ident" id="6394371">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394379">io</span><span class="op" id="6394381">.</span><span class="ident" id="6394382">ByteWriter</span><br>
<span class="lineno">215</span><span class="op" id="6394393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6394396">//&nbsp;encoder&nbsp;encodes&nbsp;an&nbsp;image&nbsp;to&nbsp;the&nbsp;JPEG&nbsp;format.</span><br>
<span class="lineno"></span><span class="keyword" id="6394444">type</span>&nbsp;<span class="ident" id="6394449">encoder</span>&nbsp;<span class="keyword" id="6394457">struct</span>&nbsp;<span class="op" id="6394464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394467">//&nbsp;w&nbsp;is&nbsp;the&nbsp;writer&nbsp;to&nbsp;write&nbsp;to.&nbsp;err&nbsp;is&nbsp;the&nbsp;first&nbsp;error&nbsp;encountered&nbsp;during</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394542">//&nbsp;writing.&nbsp;All&nbsp;attempted&nbsp;writes&nbsp;after&nbsp;the&nbsp;first&nbsp;error&nbsp;become&nbsp;no-ops.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394613">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6394617">writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394625">err</span>&nbsp;<span class="builtintype" id="6394629">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394636">//&nbsp;buf&nbsp;is&nbsp;a&nbsp;scratch&nbsp;buffer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394665">buf</span>&nbsp;<span class="op" id="6394669">[</span><span class="num" id="6394670">16</span><span class="op" id="6394672">]</span><span class="builtintype" id="6394673">byte</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394679">//&nbsp;bits&nbsp;and&nbsp;nBits&nbsp;are&nbsp;accumulated&nbsp;bits&nbsp;to&nbsp;write&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394734">bits</span><span class="op" id="6394738">,</span>&nbsp;<span class="ident" id="6394740">nBits</span>&nbsp;<span class="builtintype" id="6394746">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6394754">//&nbsp;quant&nbsp;is&nbsp;the&nbsp;scaled&nbsp;quantization&nbsp;tables,&nbsp;in&nbsp;zig-zag&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394817">quant</span>&nbsp;<span class="op" id="6394823">[</span><span class="ident" id="6394824">nQuantIndex</span><span class="op" id="6394835">]</span><span class="op" id="6394836">[</span><span class="ident" id="6394837">blockSize</span><span class="op" id="6394846">]</span><span class="builtintype" id="6394847">byte</span><br>
<span class="lineno"></span><span class="op" id="6394852">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="keyword" id="6394855">func</span>&nbsp;<span class="op" id="6394860">(</span><span class="ident" id="6394861">e</span>&nbsp;<span class="op" id="6394863">*</span><span class="ident" id="6394864">encoder</span><span class="op" id="6394871">)</span>&nbsp;<span class="ident" id="6394873">flush</span><span class="op" id="6394878">(</span><span class="op" id="6394879">)</span>&nbsp;<span class="op" id="6394881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394884">if</span>&nbsp;<span class="ident" id="6394887">e</span><span class="op" id="6394888">.</span><span class="ident" id="6394889">err</span>&nbsp;<span class="op" id="6394893">!=</span>&nbsp;<span class="ident" id="6394896">nil</span>&nbsp;<span class="op" id="6394900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394904">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6394912">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394915">e</span><span class="op" id="6394916">.</span><span class="ident" id="6394917">err</span>&nbsp;<span class="op" id="6394921">=</span>&nbsp;<span class="ident" id="6394923">e</span><span class="op" id="6394924">.</span><span class="ident" id="6394925">w</span><span class="op" id="6394926">.</span><span class="ident" id="6394927">Flush</span><span class="op" id="6394932">(</span><span class="op" id="6394933">)</span><br>
<span class="lineno"></span><span class="op" id="6394935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6394938">func</span>&nbsp;<span class="op" id="6394943">(</span><span class="ident" id="6394944">e</span>&nbsp;<span class="op" id="6394946">*</span><span class="ident" id="6394947">encoder</span><span class="op" id="6394954">)</span>&nbsp;<span class="ident" id="6394956">write</span><span class="op" id="6394961">(</span><span class="ident" id="6394962">p</span>&nbsp;<span class="op" id="6394964">[</span><span class="op" id="6394965">]</span><span class="builtintype" id="6394966">byte</span><span class="op" id="6394970">)</span>&nbsp;<span class="op" id="6394972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394975">if</span>&nbsp;<span class="ident" id="6394978">e</span><span class="op" id="6394979">.</span><span class="ident" id="6394980">err</span>&nbsp;<span class="op" id="6394984">!=</span>&nbsp;<span class="ident" id="6394987">nil</span>&nbsp;<span class="op" id="6394991">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395006">_</span><span class="op" id="6395007">,</span>&nbsp;<span class="ident" id="6395009">e</span><span class="op" id="6395010">.</span><span class="ident" id="6395011">err</span>&nbsp;<span class="op" id="6395015">=</span>&nbsp;<span class="ident" id="6395017">e</span><span class="op" id="6395018">.</span><span class="ident" id="6395019">w</span><span class="op" id="6395020">.</span><span class="ident" id="6395021">Write</span><span class="op" id="6395026">(</span><span class="ident" id="6395027">p</span><span class="op" id="6395028">)</span><br>
<span class="lineno"></span><span class="op" id="6395030">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="keyword" id="6395033">func</span>&nbsp;<span class="op" id="6395038">(</span><span class="ident" id="6395039">e</span>&nbsp;<span class="op" id="6395041">*</span><span class="ident" id="6395042">encoder</span><span class="op" id="6395049">)</span>&nbsp;<span class="ident" id="6395051">writeByte</span><span class="op" id="6395060">(</span><span class="ident" id="6395061">b</span>&nbsp;<span class="builtintype" id="6395063">byte</span><span class="op" id="6395067">)</span>&nbsp;<span class="op" id="6395069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395072">if</span>&nbsp;<span class="ident" id="6395075">e</span><span class="op" id="6395076">.</span><span class="ident" id="6395077">err</span>&nbsp;<span class="op" id="6395081">!=</span>&nbsp;<span class="ident" id="6395084">nil</span>&nbsp;<span class="op" id="6395088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395092">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395103">e</span><span class="op" id="6395104">.</span><span class="ident" id="6395105">err</span>&nbsp;<span class="op" id="6395109">=</span>&nbsp;<span class="ident" id="6395111">e</span><span class="op" id="6395112">.</span><span class="ident" id="6395113">w</span><span class="op" id="6395114">.</span><span class="ident" id="6395115">WriteByte</span><span class="op" id="6395124">(</span><span class="ident" id="6395125">b</span><span class="op" id="6395126">)</span><br>
<span class="lineno">250</span><span class="op" id="6395128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6395131">//&nbsp;emit&nbsp;emits&nbsp;the&nbsp;least&nbsp;significant&nbsp;nBits&nbsp;bits&nbsp;of&nbsp;bits&nbsp;to&nbsp;the&nbsp;bit-stream.</span><br>
<span class="lineno"></span><span class="comment" id="6395205">//&nbsp;The&nbsp;precondition&nbsp;is&nbsp;bits&nbsp;&lt;&nbsp;1&lt;&lt;nBits&nbsp;&amp;&amp;&nbsp;nBits&nbsp;&lt;=&nbsp;16.</span><br>
<span class="lineno"></span><span class="keyword" id="6395260">func</span>&nbsp;<span class="op" id="6395265">(</span><span class="ident" id="6395266">e</span>&nbsp;<span class="op" id="6395268">*</span><span class="ident" id="6395269">encoder</span><span class="op" id="6395276">)</span>&nbsp;<span class="ident" id="6395278">emit</span><span class="op" id="6395282">(</span><span class="ident" id="6395283">bits</span><span class="op" id="6395287">,</span>&nbsp;<span class="ident" id="6395289">nBits</span>&nbsp;<span class="builtintype" id="6395295">uint32</span><span class="op" id="6395301">)</span>&nbsp;<span class="op" id="6395303">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395306">nBits</span>&nbsp;<span class="op" id="6395312">+=</span>&nbsp;<span class="ident" id="6395315">e</span><span class="op" id="6395316">.</span><span class="ident" id="6395317">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395324">bits</span>&nbsp;<span class="op" id="6395329">&lt;&lt;=</span>&nbsp;<span class="num" id="6395333">32</span>&nbsp;<span class="op" id="6395336">-</span>&nbsp;<span class="ident" id="6395338">nBits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395345">bits</span>&nbsp;<span class="op" id="6395350">|=</span>&nbsp;<span class="ident" id="6395353">e</span><span class="op" id="6395354">.</span><span class="ident" id="6395355">bits</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395361">for</span>&nbsp;<span class="ident" id="6395365">nBits</span>&nbsp;<span class="op" id="6395371">&gt;=</span>&nbsp;<span class="num" id="6395374">8</span>&nbsp;<span class="op" id="6395376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395380">b</span>&nbsp;<span class="op" id="6395382">:=</span>&nbsp;<span class="builtintype" id="6395385">uint8</span><span class="op" id="6395390">(</span><span class="ident" id="6395391">bits</span>&nbsp;<span class="op" id="6395396">&gt;&gt;</span>&nbsp;<span class="num" id="6395399">24</span><span class="op" id="6395401">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395405">e</span><span class="op" id="6395406">.</span><span class="ident" id="6395407">writeByte</span><span class="op" id="6395416">(</span><span class="ident" id="6395417">b</span><span class="op" id="6395418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395422">if</span>&nbsp;<span class="ident" id="6395425">b</span>&nbsp;<span class="op" id="6395427">==</span>&nbsp;<span class="num" id="6395430">0xff</span>&nbsp;<span class="op" id="6395435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395440">e</span><span class="op" id="6395441">.</span><span class="ident" id="6395442">writeByte</span><span class="op" id="6395451">(</span><span class="num" id="6395452">0x00</span><span class="op" id="6395456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395464">bits</span>&nbsp;<span class="op" id="6395469">&lt;&lt;=</span>&nbsp;<span class="num" id="6395473">8</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395477">nBits</span>&nbsp;<span class="op" id="6395483">-=</span>&nbsp;<span class="num" id="6395486">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395489">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395492">e</span><span class="op" id="6395493">.</span><span class="ident" id="6395494">bits</span><span class="op" id="6395498">,</span>&nbsp;<span class="ident" id="6395500">e</span><span class="op" id="6395501">.</span><span class="ident" id="6395502">nBits</span>&nbsp;<span class="op" id="6395508">=</span>&nbsp;<span class="ident" id="6395510">bits</span><span class="op" id="6395514">,</span>&nbsp;<span class="ident" id="6395516">nBits</span><br>
<span class="lineno"></span><span class="op" id="6395522">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="comment" id="6395525">//&nbsp;emitHuff&nbsp;emits&nbsp;the&nbsp;given&nbsp;value&nbsp;with&nbsp;the&nbsp;given&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6395591">func</span>&nbsp;<span class="op" id="6395596">(</span><span class="ident" id="6395597">e</span>&nbsp;<span class="op" id="6395599">*</span><span class="ident" id="6395600">encoder</span><span class="op" id="6395607">)</span>&nbsp;<span class="ident" id="6395609">emitHuff</span><span class="op" id="6395617">(</span><span class="ident" id="6395618">h</span>&nbsp;<span class="ident" id="6395620">huffIndex</span><span class="op" id="6395629">,</span>&nbsp;<span class="ident" id="6395631">value</span>&nbsp;<span class="builtintype" id="6395637">int32</span><span class="op" id="6395642">)</span>&nbsp;<span class="op" id="6395644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395647">x</span>&nbsp;<span class="op" id="6395649">:=</span>&nbsp;<span class="ident" id="6395652">theHuffmanLUT</span><span class="op" id="6395665">[</span><span class="ident" id="6395666">h</span><span class="op" id="6395667">]</span><span class="op" id="6395668">[</span><span class="ident" id="6395669">value</span><span class="op" id="6395674">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395677">e</span><span class="op" id="6395678">.</span><span class="ident" id="6395679">emit</span><span class="op" id="6395683">(</span><span class="ident" id="6395684">x</span><span class="op" id="6395685">&amp;</span><span class="op" id="6395686">(</span><span class="num" id="6395687">1</span><span class="op" id="6395688">&lt;&lt;</span><span class="num" id="6395690">24</span><span class="op" id="6395692">-</span><span class="num" id="6395693">1</span><span class="op" id="6395694">)</span><span class="op" id="6395695">,</span>&nbsp;<span class="ident" id="6395697">x</span><span class="op" id="6395698">&gt;&gt;</span><span class="num" id="6395700">24</span><span class="op" id="6395702">)</span><br>
<span class="lineno"></span><span class="op" id="6395704">}</span><br>
<span class="lineno">275</span><br>
<span class="lineno"></span><span class="comment" id="6395707">//&nbsp;emitHuffRLE&nbsp;emits&nbsp;a&nbsp;run&nbsp;of&nbsp;runLength&nbsp;copies&nbsp;of&nbsp;value&nbsp;encoded&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6395786">//&nbsp;Huffman&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6395806">func</span>&nbsp;<span class="op" id="6395811">(</span><span class="ident" id="6395812">e</span>&nbsp;<span class="op" id="6395814">*</span><span class="ident" id="6395815">encoder</span><span class="op" id="6395822">)</span>&nbsp;<span class="ident" id="6395824">emitHuffRLE</span><span class="op" id="6395835">(</span><span class="ident" id="6395836">h</span>&nbsp;<span class="ident" id="6395838">huffIndex</span><span class="op" id="6395847">,</span>&nbsp;<span class="ident" id="6395849">runLength</span><span class="op" id="6395858">,</span>&nbsp;<span class="ident" id="6395860">value</span>&nbsp;<span class="builtintype" id="6395866">int32</span><span class="op" id="6395871">)</span>&nbsp;<span class="op" id="6395873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395876">a</span><span class="op" id="6395877">,</span>&nbsp;<span class="ident" id="6395879">b</span>&nbsp;<span class="op" id="6395881">:=</span>&nbsp;<span class="ident" id="6395884">value</span><span class="op" id="6395889">,</span>&nbsp;<span class="ident" id="6395891">value</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395898">if</span>&nbsp;<span class="ident" id="6395901">a</span>&nbsp;<span class="op" id="6395903">&lt;</span>&nbsp;<span class="num" id="6395905">0</span>&nbsp;<span class="op" id="6395907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395911">a</span><span class="op" id="6395912">,</span>&nbsp;<span class="ident" id="6395914">b</span>&nbsp;<span class="op" id="6395916">=</span>&nbsp;<span class="op" id="6395918">-</span><span class="ident" id="6395919">value</span><span class="op" id="6395924">,</span>&nbsp;<span class="ident" id="6395926">value</span><span class="op" id="6395931">-</span><span class="num" id="6395932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6395935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395938">var</span>&nbsp;<span class="ident" id="6395942">nBits</span>&nbsp;<span class="builtintype" id="6395948">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6395956">if</span>&nbsp;<span class="ident" id="6395959">a</span>&nbsp;<span class="op" id="6395961">&lt;</span>&nbsp;<span class="num" id="6395963">0x100</span>&nbsp;<span class="op" id="6395969">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6395973">nBits</span>&nbsp;<span class="op" id="6395979">=</span>&nbsp;<span class="builtintype" id="6395981">uint32</span><span class="op" id="6395987">(</span><span class="ident" id="6395988">bitCount</span><span class="op" id="6395996">[</span><span class="ident" id="6395997">a</span><span class="op" id="6395998">]</span><span class="op" id="6395999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396002">}</span>&nbsp;<span class="keyword" id="6396004">else</span>&nbsp;<span class="op" id="6396009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396013">nBits</span>&nbsp;<span class="op" id="6396019">=</span>&nbsp;<span class="num" id="6396021">8</span>&nbsp;<span class="op" id="6396023">+</span>&nbsp;<span class="builtintype" id="6396025">uint32</span><span class="op" id="6396031">(</span><span class="ident" id="6396032">bitCount</span><span class="op" id="6396040">[</span><span class="ident" id="6396041">a</span><span class="op" id="6396042">&gt;&gt;</span><span class="num" id="6396044">8</span><span class="op" id="6396045">]</span><span class="op" id="6396046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396052">e</span><span class="op" id="6396053">.</span><span class="ident" id="6396054">emitHuff</span><span class="op" id="6396062">(</span><span class="ident" id="6396063">h</span><span class="op" id="6396064">,</span>&nbsp;<span class="ident" id="6396066">runLength</span><span class="op" id="6396075">&lt;&lt;</span><span class="num" id="6396077">4</span><span class="op" id="6396078">|</span><span class="builtintype" id="6396079">int32</span><span class="op" id="6396084">(</span><span class="ident" id="6396085">nBits</span><span class="op" id="6396090">)</span><span class="op" id="6396091">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396094">if</span>&nbsp;<span class="ident" id="6396097">nBits</span>&nbsp;<span class="op" id="6396103">&gt;</span>&nbsp;<span class="num" id="6396105">0</span>&nbsp;<span class="op" id="6396107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396111">e</span><span class="op" id="6396112">.</span><span class="ident" id="6396113">emit</span><span class="op" id="6396117">(</span><span class="builtintype" id="6396118">uint32</span><span class="op" id="6396124">(</span><span class="ident" id="6396125">b</span><span class="op" id="6396126">)</span><span class="op" id="6396127">&amp;</span><span class="op" id="6396128">(</span><span class="num" id="6396129">1</span><span class="op" id="6396130">&lt;&lt;</span><span class="ident" id="6396132">nBits</span><span class="op" id="6396137">-</span><span class="num" id="6396138">1</span><span class="op" id="6396139">)</span><span class="op" id="6396140">,</span>&nbsp;<span class="ident" id="6396142">nBits</span><span class="op" id="6396147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396150">}</span><br>
<span class="lineno"></span><span class="op" id="6396152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">295</span><span class="comment" id="6396155">//&nbsp;writeMarkerHeader&nbsp;writes&nbsp;the&nbsp;header&nbsp;for&nbsp;a&nbsp;marker&nbsp;with&nbsp;the&nbsp;given&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="6396230">func</span>&nbsp;<span class="op" id="6396235">(</span><span class="ident" id="6396236">e</span>&nbsp;<span class="op" id="6396238">*</span><span class="ident" id="6396239">encoder</span><span class="op" id="6396246">)</span>&nbsp;<span class="ident" id="6396248">writeMarkerHeader</span><span class="op" id="6396265">(</span><span class="ident" id="6396266">marker</span>&nbsp;<span class="builtintype" id="6396273">uint8</span><span class="op" id="6396278">,</span>&nbsp;<span class="ident" id="6396280">markerlen</span>&nbsp;<span class="builtintype" id="6396290">int</span><span class="op" id="6396293">)</span>&nbsp;<span class="op" id="6396295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396298">e</span><span class="op" id="6396299">.</span><span class="ident" id="6396300">buf</span><span class="op" id="6396303">[</span><span class="num" id="6396304">0</span><span class="op" id="6396305">]</span>&nbsp;<span class="op" id="6396307">=</span>&nbsp;<span class="num" id="6396309">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396315">e</span><span class="op" id="6396316">.</span><span class="ident" id="6396317">buf</span><span class="op" id="6396320">[</span><span class="num" id="6396321">1</span><span class="op" id="6396322">]</span>&nbsp;<span class="op" id="6396324">=</span>&nbsp;<span class="ident" id="6396326">marker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396334">e</span><span class="op" id="6396335">.</span><span class="ident" id="6396336">buf</span><span class="op" id="6396339">[</span><span class="num" id="6396340">2</span><span class="op" id="6396341">]</span>&nbsp;<span class="op" id="6396343">=</span>&nbsp;<span class="builtintype" id="6396345">uint8</span><span class="op" id="6396350">(</span><span class="ident" id="6396351">markerlen</span>&nbsp;<span class="op" id="6396361">&gt;&gt;</span>&nbsp;<span class="num" id="6396364">8</span><span class="op" id="6396365">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396368">e</span><span class="op" id="6396369">.</span><span class="ident" id="6396370">buf</span><span class="op" id="6396373">[</span><span class="num" id="6396374">3</span><span class="op" id="6396375">]</span>&nbsp;<span class="op" id="6396377">=</span>&nbsp;<span class="builtintype" id="6396379">uint8</span><span class="op" id="6396384">(</span><span class="ident" id="6396385">markerlen</span>&nbsp;<span class="op" id="6396395">&amp;</span>&nbsp;<span class="num" id="6396397">0xff</span><span class="op" id="6396401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396404">e</span><span class="op" id="6396405">.</span><span class="ident" id="6396406">write</span><span class="op" id="6396411">(</span><span class="ident" id="6396412">e</span><span class="op" id="6396413">.</span><span class="ident" id="6396414">buf</span><span class="op" id="6396417">[</span><span class="op" id="6396418">:</span><span class="num" id="6396419">4</span><span class="op" id="6396420">]</span><span class="op" id="6396421">)</span><br>
<span class="lineno"></span><span class="op" id="6396423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6396426">//&nbsp;writeDQT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Quantization&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno">305</span><span class="keyword" id="6396483">func</span>&nbsp;<span class="op" id="6396488">(</span><span class="ident" id="6396489">e</span>&nbsp;<span class="op" id="6396491">*</span><span class="ident" id="6396492">encoder</span><span class="op" id="6396499">)</span>&nbsp;<span class="ident" id="6396501">writeDQT</span><span class="op" id="6396509">(</span><span class="op" id="6396510">)</span>&nbsp;<span class="op" id="6396512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396515">const</span>&nbsp;<span class="ident" id="6396521">markerlen</span>&nbsp;<span class="op" id="6396531">=</span>&nbsp;<span class="num" id="6396533">2</span>&nbsp;<span class="op" id="6396535">+</span>&nbsp;<span class="builtintype" id="6396537">int</span><span class="op" id="6396540">(</span><span class="ident" id="6396541">nQuantIndex</span><span class="op" id="6396552">)</span><span class="op" id="6396553">*</span><span class="op" id="6396554">(</span><span class="num" id="6396555">1</span><span class="op" id="6396556">+</span><span class="ident" id="6396557">blockSize</span><span class="op" id="6396566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396569">e</span><span class="op" id="6396570">.</span><span class="ident" id="6396571">writeMarkerHeader</span><span class="op" id="6396588">(</span><span class="ident" id="6396589">dqtMarker</span><span class="op" id="6396598">,</span>&nbsp;<span class="ident" id="6396600">markerlen</span><span class="op" id="6396609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6396612">for</span>&nbsp;<span class="ident" id="6396616">i</span>&nbsp;<span class="op" id="6396618">:=</span>&nbsp;<span class="keyword" id="6396621">range</span>&nbsp;<span class="ident" id="6396627">e</span><span class="op" id="6396628">.</span><span class="ident" id="6396629">quant</span>&nbsp;<span class="op" id="6396635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396639">e</span><span class="op" id="6396640">.</span><span class="ident" id="6396641">writeByte</span><span class="op" id="6396650">(</span><span class="builtintype" id="6396651">uint8</span><span class="op" id="6396656">(</span><span class="ident" id="6396657">i</span><span class="op" id="6396658">)</span><span class="op" id="6396659">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396663">e</span><span class="op" id="6396664">.</span><span class="ident" id="6396665">write</span><span class="op" id="6396670">(</span><span class="ident" id="6396671">e</span><span class="op" id="6396672">.</span><span class="ident" id="6396673">quant</span><span class="op" id="6396678">[</span><span class="ident" id="6396679">i</span><span class="op" id="6396680">]</span><span class="op" id="6396681">[</span><span class="op" id="6396682">:</span><span class="op" id="6396683">]</span><span class="op" id="6396684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6396687">}</span><br>
<span class="lineno"></span><span class="op" id="6396689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6396692">//&nbsp;writeSOF0&nbsp;writes&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Frame&nbsp;(Baseline)&nbsp;marker.</span><br>
<span class="lineno">315</span><span class="keyword" id="6396750">func</span>&nbsp;<span class="op" id="6396755">(</span><span class="ident" id="6396756">e</span>&nbsp;<span class="op" id="6396758">*</span><span class="ident" id="6396759">encoder</span><span class="op" id="6396766">)</span>&nbsp;<span class="ident" id="6396768">writeSOF0</span><span class="op" id="6396777">(</span><span class="ident" id="6396778">size</span>&nbsp;<span class="ident" id="6396783">image</span><span class="op" id="6396788">.</span><span class="ident" id="6396789">Point</span><span class="op" id="6396794">,</span>&nbsp;<span class="ident" id="6396796">nComponent</span>&nbsp;<span class="builtintype" id="6396807">int</span><span class="op" id="6396810">)</span>&nbsp;<span class="op" id="6396812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396815">markerlen</span>&nbsp;<span class="op" id="6396825">:=</span>&nbsp;<span class="num" id="6396828">8</span>&nbsp;<span class="op" id="6396830">+</span>&nbsp;<span class="num" id="6396832">3</span><span class="op" id="6396833">*</span><span class="ident" id="6396834">nComponent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396846">e</span><span class="op" id="6396847">.</span><span class="ident" id="6396848">writeMarkerHeader</span><span class="op" id="6396865">(</span><span class="ident" id="6396866">sof0Marker</span><span class="op" id="6396876">,</span>&nbsp;<span class="ident" id="6396878">markerlen</span><span class="op" id="6396887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396890">e</span><span class="op" id="6396891">.</span><span class="ident" id="6396892">buf</span><span class="op" id="6396895">[</span><span class="num" id="6396896">0</span><span class="op" id="6396897">]</span>&nbsp;<span class="op" id="6396899">=</span>&nbsp;<span class="num" id="6396901">8</span>&nbsp;<span class="comment" id="6396903">//&nbsp;8-bit&nbsp;color.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396920">e</span><span class="op" id="6396921">.</span><span class="ident" id="6396922">buf</span><span class="op" id="6396925">[</span><span class="num" id="6396926">1</span><span class="op" id="6396927">]</span>&nbsp;<span class="op" id="6396929">=</span>&nbsp;<span class="builtintype" id="6396931">uint8</span><span class="op" id="6396936">(</span><span class="ident" id="6396937">size</span><span class="op" id="6396941">.</span><span class="ident" id="6396942">Y</span>&nbsp;<span class="op" id="6396944">&gt;&gt;</span>&nbsp;<span class="num" id="6396947">8</span><span class="op" id="6396948">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396951">e</span><span class="op" id="6396952">.</span><span class="ident" id="6396953">buf</span><span class="op" id="6396956">[</span><span class="num" id="6396957">2</span><span class="op" id="6396958">]</span>&nbsp;<span class="op" id="6396960">=</span>&nbsp;<span class="builtintype" id="6396962">uint8</span><span class="op" id="6396967">(</span><span class="ident" id="6396968">size</span><span class="op" id="6396972">.</span><span class="ident" id="6396973">Y</span>&nbsp;<span class="op" id="6396975">&amp;</span>&nbsp;<span class="num" id="6396977">0xff</span><span class="op" id="6396981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6396984">e</span><span class="op" id="6396985">.</span><span class="ident" id="6396986">buf</span><span class="op" id="6396989">[</span><span class="num" id="6396990">3</span><span class="op" id="6396991">]</span>&nbsp;<span class="op" id="6396993">=</span>&nbsp;<span class="builtintype" id="6396995">uint8</span><span class="op" id="6397000">(</span><span class="ident" id="6397001">size</span><span class="op" id="6397005">.</span><span class="ident" id="6397006">X</span>&nbsp;<span class="op" id="6397008">&gt;&gt;</span>&nbsp;<span class="num" id="6397011">8</span><span class="op" id="6397012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397015">e</span><span class="op" id="6397016">.</span><span class="ident" id="6397017">buf</span><span class="op" id="6397020">[</span><span class="num" id="6397021">4</span><span class="op" id="6397022">]</span>&nbsp;<span class="op" id="6397024">=</span>&nbsp;<span class="builtintype" id="6397026">uint8</span><span class="op" id="6397031">(</span><span class="ident" id="6397032">size</span><span class="op" id="6397036">.</span><span class="ident" id="6397037">X</span>&nbsp;<span class="op" id="6397039">&amp;</span>&nbsp;<span class="num" id="6397041">0xff</span><span class="op" id="6397045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397048">e</span><span class="op" id="6397049">.</span><span class="ident" id="6397050">buf</span><span class="op" id="6397053">[</span><span class="num" id="6397054">5</span><span class="op" id="6397055">]</span>&nbsp;<span class="op" id="6397057">=</span>&nbsp;<span class="builtintype" id="6397059">uint8</span><span class="op" id="6397064">(</span><span class="ident" id="6397065">nComponent</span><span class="op" id="6397075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397078">if</span>&nbsp;<span class="ident" id="6397081">nComponent</span>&nbsp;<span class="op" id="6397092">==</span>&nbsp;<span class="num" id="6397095">1</span>&nbsp;<span class="op" id="6397097">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397101">e</span><span class="op" id="6397102">.</span><span class="ident" id="6397103">buf</span><span class="op" id="6397106">[</span><span class="num" id="6397107">6</span><span class="op" id="6397108">]</span>&nbsp;<span class="op" id="6397110">=</span>&nbsp;<span class="num" id="6397112">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397116">//&nbsp;No&nbsp;subsampling&nbsp;for&nbsp;grayscale&nbsp;image.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397157">e</span><span class="op" id="6397158">.</span><span class="ident" id="6397159">buf</span><span class="op" id="6397162">[</span><span class="num" id="6397163">7</span><span class="op" id="6397164">]</span>&nbsp;<span class="op" id="6397166">=</span>&nbsp;<span class="num" id="6397168">0x11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397175">e</span><span class="op" id="6397176">.</span><span class="ident" id="6397177">buf</span><span class="op" id="6397180">[</span><span class="num" id="6397181">8</span><span class="op" id="6397182">]</span>&nbsp;<span class="op" id="6397184">=</span>&nbsp;<span class="num" id="6397186">0x00</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397192">}</span>&nbsp;<span class="keyword" id="6397194">else</span>&nbsp;<span class="op" id="6397199">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397203">for</span>&nbsp;<span class="ident" id="6397207">i</span>&nbsp;<span class="op" id="6397209">:=</span>&nbsp;<span class="num" id="6397212">0</span><span class="op" id="6397213">;</span>&nbsp;<span class="ident" id="6397215">i</span>&nbsp;<span class="op" id="6397217">&lt;</span>&nbsp;<span class="ident" id="6397219">nComponent</span><span class="op" id="6397229">;</span>&nbsp;<span class="ident" id="6397231">i</span><span class="op" id="6397232">++</span>&nbsp;<span class="op" id="6397235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397240">e</span><span class="op" id="6397241">.</span><span class="ident" id="6397242">buf</span><span class="op" id="6397245">[</span><span class="num" id="6397246">3</span><span class="op" id="6397247">*</span><span class="ident" id="6397248">i</span><span class="op" id="6397249">+</span><span class="num" id="6397250">6</span><span class="op" id="6397251">]</span>&nbsp;<span class="op" id="6397253">=</span>&nbsp;<span class="builtintype" id="6397255">uint8</span><span class="op" id="6397260">(</span><span class="ident" id="6397261">i</span>&nbsp;<span class="op" id="6397263">+</span>&nbsp;<span class="num" id="6397265">1</span><span class="op" id="6397266">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397271">//&nbsp;We&nbsp;use&nbsp;4:2:0&nbsp;chroma&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397310">e</span><span class="op" id="6397311">.</span><span class="ident" id="6397312">buf</span><span class="op" id="6397315">[</span><span class="num" id="6397316">3</span><span class="op" id="6397317">*</span><span class="ident" id="6397318">i</span><span class="op" id="6397319">+</span><span class="num" id="6397320">7</span><span class="op" id="6397321">]</span>&nbsp;<span class="op" id="6397323">=</span>&nbsp;<span class="string" id="6397325">&#34;\x22\x11\x11&#34;</span><span class="op" id="6397339">[</span><span class="ident" id="6397340">i</span><span class="op" id="6397341">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397346">e</span><span class="op" id="6397347">.</span><span class="ident" id="6397348">buf</span><span class="op" id="6397351">[</span><span class="num" id="6397352">3</span><span class="op" id="6397353">*</span><span class="ident" id="6397354">i</span><span class="op" id="6397355">+</span><span class="num" id="6397356">8</span><span class="op" id="6397357">]</span>&nbsp;<span class="op" id="6397359">=</span>&nbsp;<span class="string" id="6397361">&#34;\x00\x01\x01&#34;</span><span class="op" id="6397375">[</span><span class="ident" id="6397376">i</span><span class="op" id="6397377">]</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397381">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397387">e</span><span class="op" id="6397388">.</span><span class="ident" id="6397389">write</span><span class="op" id="6397394">(</span><span class="ident" id="6397395">e</span><span class="op" id="6397396">.</span><span class="ident" id="6397397">buf</span><span class="op" id="6397400">[</span><span class="op" id="6397401">:</span><span class="num" id="6397402">3</span><span class="op" id="6397403">*</span><span class="op" id="6397404">(</span><span class="ident" id="6397405">nComponent</span><span class="op" id="6397415">-</span><span class="num" id="6397416">1</span><span class="op" id="6397417">)</span><span class="op" id="6397418">+</span><span class="num" id="6397419">9</span><span class="op" id="6397420">]</span><span class="op" id="6397421">)</span><br>
<span class="lineno"></span><span class="op" id="6397423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="6397426">//&nbsp;writeDHT&nbsp;writes&nbsp;the&nbsp;Define&nbsp;Huffman&nbsp;Table&nbsp;marker.</span><br>
<span class="lineno"></span><span class="keyword" id="6397478">func</span>&nbsp;<span class="op" id="6397483">(</span><span class="ident" id="6397484">e</span>&nbsp;<span class="op" id="6397486">*</span><span class="ident" id="6397487">encoder</span><span class="op" id="6397494">)</span>&nbsp;<span class="ident" id="6397496">writeDHT</span><span class="op" id="6397504">(</span><span class="ident" id="6397505">nComponent</span>&nbsp;<span class="builtintype" id="6397516">int</span><span class="op" id="6397519">)</span>&nbsp;<span class="op" id="6397521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397524">markerlen</span>&nbsp;<span class="op" id="6397534">:=</span>&nbsp;<span class="num" id="6397537">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397540">specs</span>&nbsp;<span class="op" id="6397546">:=</span>&nbsp;<span class="ident" id="6397549">theHuffmanSpec</span><span class="op" id="6397563">[</span><span class="op" id="6397564">:</span><span class="op" id="6397565">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397568">if</span>&nbsp;<span class="ident" id="6397571">nComponent</span>&nbsp;<span class="op" id="6397582">==</span>&nbsp;<span class="num" id="6397585">1</span>&nbsp;<span class="op" id="6397587">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6397591">//&nbsp;Drop&nbsp;the&nbsp;Chrominance&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397625">specs</span>&nbsp;<span class="op" id="6397631">=</span>&nbsp;<span class="ident" id="6397633">specs</span><span class="op" id="6397638">[</span><span class="op" id="6397639">:</span><span class="num" id="6397640">2</span><span class="op" id="6397641">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397647">for</span>&nbsp;<span class="ident" id="6397651">_</span><span class="op" id="6397652">,</span>&nbsp;<span class="ident" id="6397654">s</span>&nbsp;<span class="op" id="6397656">:=</span>&nbsp;<span class="keyword" id="6397659">range</span>&nbsp;<span class="ident" id="6397665">specs</span>&nbsp;<span class="op" id="6397671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397675">markerlen</span>&nbsp;<span class="op" id="6397685">+=</span>&nbsp;<span class="num" id="6397688">1</span>&nbsp;<span class="op" id="6397690">+</span>&nbsp;<span class="num" id="6397692">16</span>&nbsp;<span class="op" id="6397695">+</span>&nbsp;<span class="builtinfunc" id="6397697">len</span><span class="op" id="6397700">(</span><span class="ident" id="6397701">s</span><span class="op" id="6397702">.</span><span class="ident" id="6397703">value</span><span class="op" id="6397708">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397714">e</span><span class="op" id="6397715">.</span><span class="ident" id="6397716">writeMarkerHeader</span><span class="op" id="6397733">(</span><span class="ident" id="6397734">dhtMarker</span><span class="op" id="6397743">,</span>&nbsp;<span class="ident" id="6397745">markerlen</span><span class="op" id="6397754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6397757">for</span>&nbsp;<span class="ident" id="6397761">i</span><span class="op" id="6397762">,</span>&nbsp;<span class="ident" id="6397764">s</span>&nbsp;<span class="op" id="6397766">:=</span>&nbsp;<span class="keyword" id="6397769">range</span>&nbsp;<span class="ident" id="6397775">specs</span>&nbsp;<span class="op" id="6397781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397785">e</span><span class="op" id="6397786">.</span><span class="ident" id="6397787">writeByte</span><span class="op" id="6397796">(</span><span class="string" id="6397797">&#34;\x00\x10\x01\x11&#34;</span><span class="op" id="6397815">[</span><span class="ident" id="6397816">i</span><span class="op" id="6397817">]</span><span class="op" id="6397818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397822">e</span><span class="op" id="6397823">.</span><span class="ident" id="6397824">write</span><span class="op" id="6397829">(</span><span class="ident" id="6397830">s</span><span class="op" id="6397831">.</span><span class="ident" id="6397832">count</span><span class="op" id="6397837">[</span><span class="op" id="6397838">:</span><span class="op" id="6397839">]</span><span class="op" id="6397840">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6397844">e</span><span class="op" id="6397845">.</span><span class="ident" id="6397846">write</span><span class="op" id="6397851">(</span><span class="ident" id="6397852">s</span><span class="op" id="6397853">.</span><span class="ident" id="6397854">value</span><span class="op" id="6397859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6397862">}</span><br>
<span class="lineno"></span><span class="op" id="6397864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6397867">//&nbsp;writeBlock&nbsp;writes&nbsp;a&nbsp;block&nbsp;of&nbsp;pixel&nbsp;data&nbsp;using&nbsp;the&nbsp;given&nbsp;quantization&nbsp;table,</span><br>
<span class="lineno">360</span><span class="comment" id="6397946">//&nbsp;returning&nbsp;the&nbsp;post-quantized&nbsp;DC&nbsp;value&nbsp;of&nbsp;the&nbsp;DCT-transformed&nbsp;block.&nbsp;b&nbsp;is&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="6398025">//&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno"></span><span class="keyword" id="6398057">func</span>&nbsp;<span class="op" id="6398062">(</span><span class="ident" id="6398063">e</span>&nbsp;<span class="op" id="6398065">*</span><span class="ident" id="6398066">encoder</span><span class="op" id="6398073">)</span>&nbsp;<span class="ident" id="6398075">writeBlock</span><span class="op" id="6398085">(</span><span class="ident" id="6398086">b</span>&nbsp;<span class="op" id="6398088">*</span><span class="ident" id="6398089">block</span><span class="op" id="6398094">,</span>&nbsp;<span class="ident" id="6398096">q</span>&nbsp;<span class="ident" id="6398098">quantIndex</span><span class="op" id="6398108">,</span>&nbsp;<span class="ident" id="6398110">prevDC</span>&nbsp;<span class="builtintype" id="6398117">int32</span><span class="op" id="6398122">)</span>&nbsp;<span class="builtintype" id="6398124">int32</span>&nbsp;<span class="op" id="6398130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398133">fdct</span><span class="op" id="6398137">(</span><span class="ident" id="6398138">b</span><span class="op" id="6398139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398142">//&nbsp;Emit&nbsp;the&nbsp;DC&nbsp;delta.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398165">dc</span>&nbsp;<span class="op" id="6398168">:=</span>&nbsp;<span class="ident" id="6398171">div</span><span class="op" id="6398174">(</span><span class="ident" id="6398175">b</span><span class="op" id="6398176">[</span><span class="num" id="6398177">0</span><span class="op" id="6398178">]</span><span class="op" id="6398179">,</span>&nbsp;<span class="num" id="6398181">8</span><span class="op" id="6398182">*</span><span class="builtintype" id="6398183">int32</span><span class="op" id="6398188">(</span><span class="ident" id="6398189">e</span><span class="op" id="6398190">.</span><span class="ident" id="6398191">quant</span><span class="op" id="6398196">[</span><span class="ident" id="6398197">q</span><span class="op" id="6398198">]</span><span class="op" id="6398199">[</span><span class="num" id="6398200">0</span><span class="op" id="6398201">]</span><span class="op" id="6398202">)</span><span class="op" id="6398203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398206">e</span><span class="op" id="6398207">.</span><span class="ident" id="6398208">emitHuffRLE</span><span class="op" id="6398219">(</span><span class="ident" id="6398220">huffIndex</span><span class="op" id="6398229">(</span><span class="num" id="6398230">2</span><span class="op" id="6398231">*</span><span class="ident" id="6398232">q</span><span class="op" id="6398233">+</span><span class="num" id="6398234">0</span><span class="op" id="6398235">)</span><span class="op" id="6398236">,</span>&nbsp;<span class="num" id="6398238">0</span><span class="op" id="6398239">,</span>&nbsp;<span class="ident" id="6398241">dc</span><span class="op" id="6398243">-</span><span class="ident" id="6398244">prevDC</span><span class="op" id="6398250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6398253">//&nbsp;Emit&nbsp;the&nbsp;AC&nbsp;components.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398281">h</span><span class="op" id="6398282">,</span>&nbsp;<span class="ident" id="6398284">runLength</span>&nbsp;<span class="op" id="6398294">:=</span>&nbsp;<span class="ident" id="6398297">huffIndex</span><span class="op" id="6398306">(</span><span class="num" id="6398307">2</span><span class="op" id="6398308">*</span><span class="ident" id="6398309">q</span><span class="op" id="6398310">+</span><span class="num" id="6398311">1</span><span class="op" id="6398312">)</span><span class="op" id="6398313">,</span>&nbsp;<span class="builtintype" id="6398315">int32</span><span class="op" id="6398320">(</span><span class="num" id="6398321">0</span><span class="op" id="6398322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398325">for</span>&nbsp;<span class="ident" id="6398329">zig</span>&nbsp;<span class="op" id="6398333">:=</span>&nbsp;<span class="num" id="6398336">1</span><span class="op" id="6398337">;</span>&nbsp;<span class="ident" id="6398339">zig</span>&nbsp;<span class="op" id="6398343">&lt;</span>&nbsp;<span class="ident" id="6398345">blockSize</span><span class="op" id="6398354">;</span>&nbsp;<span class="ident" id="6398356">zig</span><span class="op" id="6398359">++</span>&nbsp;<span class="op" id="6398362">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398366">ac</span>&nbsp;<span class="op" id="6398369">:=</span>&nbsp;<span class="ident" id="6398372">div</span><span class="op" id="6398375">(</span><span class="ident" id="6398376">b</span><span class="op" id="6398377">[</span><span class="ident" id="6398378">unzig</span><span class="op" id="6398383">[</span><span class="ident" id="6398384">zig</span><span class="op" id="6398387">]</span><span class="op" id="6398388">]</span><span class="op" id="6398389">,</span>&nbsp;<span class="num" id="6398391">8</span><span class="op" id="6398392">*</span><span class="builtintype" id="6398393">int32</span><span class="op" id="6398398">(</span><span class="ident" id="6398399">e</span><span class="op" id="6398400">.</span><span class="ident" id="6398401">quant</span><span class="op" id="6398406">[</span><span class="ident" id="6398407">q</span><span class="op" id="6398408">]</span><span class="op" id="6398409">[</span><span class="ident" id="6398410">zig</span><span class="op" id="6398413">]</span><span class="op" id="6398414">)</span><span class="op" id="6398415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398419">if</span>&nbsp;<span class="ident" id="6398422">ac</span>&nbsp;<span class="op" id="6398425">==</span>&nbsp;<span class="num" id="6398428">0</span>&nbsp;<span class="op" id="6398430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398435">runLength</span><span class="op" id="6398444">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398449">}</span>&nbsp;<span class="keyword" id="6398451">else</span>&nbsp;<span class="op" id="6398456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398461">for</span>&nbsp;<span class="ident" id="6398465">runLength</span>&nbsp;<span class="op" id="6398475">&gt;</span>&nbsp;<span class="num" id="6398477">15</span>&nbsp;<span class="op" id="6398480">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398486">e</span><span class="op" id="6398487">.</span><span class="ident" id="6398488">emitHuff</span><span class="op" id="6398496">(</span><span class="ident" id="6398497">h</span><span class="op" id="6398498">,</span>&nbsp;<span class="num" id="6398500">0xf0</span><span class="op" id="6398504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398510">runLength</span>&nbsp;<span class="op" id="6398520">-=</span>&nbsp;<span class="num" id="6398523">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398534">e</span><span class="op" id="6398535">.</span><span class="ident" id="6398536">emitHuffRLE</span><span class="op" id="6398547">(</span><span class="ident" id="6398548">h</span><span class="op" id="6398549">,</span>&nbsp;<span class="ident" id="6398551">runLength</span><span class="op" id="6398560">,</span>&nbsp;<span class="ident" id="6398562">ac</span><span class="op" id="6398564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398569">runLength</span>&nbsp;<span class="op" id="6398579">=</span>&nbsp;<span class="num" id="6398581">0</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398591">if</span>&nbsp;<span class="ident" id="6398594">runLength</span>&nbsp;<span class="op" id="6398604">&gt;</span>&nbsp;<span class="num" id="6398606">0</span>&nbsp;<span class="op" id="6398608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398612">e</span><span class="op" id="6398613">.</span><span class="ident" id="6398614">emitHuff</span><span class="op" id="6398622">(</span><span class="ident" id="6398623">h</span><span class="op" id="6398624">,</span>&nbsp;<span class="num" id="6398626">0x00</span><span class="op" id="6398630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6398633">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398636">return</span>&nbsp;<span class="ident" id="6398643">dc</span><br>
<span class="lineno"></span><span class="op" id="6398646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6398649">//&nbsp;toYCbCr&nbsp;converts&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;to&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6398723">//&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno">390</span><span class="keyword" id="6398740">func</span>&nbsp;<span class="ident" id="6398745">toYCbCr</span><span class="op" id="6398752">(</span><span class="ident" id="6398753">m</span>&nbsp;<span class="ident" id="6398755">image</span><span class="op" id="6398760">.</span><span class="ident" id="6398761">Image</span><span class="op" id="6398766">,</span>&nbsp;<span class="ident" id="6398768">p</span>&nbsp;<span class="ident" id="6398770">image</span><span class="op" id="6398775">.</span><span class="ident" id="6398776">Point</span><span class="op" id="6398781">,</span>&nbsp;<span class="ident" id="6398783">yBlock</span><span class="op" id="6398789">,</span>&nbsp;<span class="ident" id="6398791">cbBlock</span><span class="op" id="6398798">,</span>&nbsp;<span class="ident" id="6398800">crBlock</span>&nbsp;<span class="op" id="6398808">*</span><span class="ident" id="6398809">block</span><span class="op" id="6398814">)</span>&nbsp;<span class="op" id="6398816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398819">b</span>&nbsp;<span class="op" id="6398821">:=</span>&nbsp;<span class="ident" id="6398824">m</span><span class="op" id="6398825">.</span><span class="ident" id="6398826">Bounds</span><span class="op" id="6398832">(</span><span class="op" id="6398833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398836">xmax</span>&nbsp;<span class="op" id="6398841">:=</span>&nbsp;<span class="ident" id="6398844">b</span><span class="op" id="6398845">.</span><span class="ident" id="6398846">Max</span><span class="op" id="6398849">.</span><span class="ident" id="6398850">X</span>&nbsp;<span class="op" id="6398852">-</span>&nbsp;<span class="num" id="6398854">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398857">ymax</span>&nbsp;<span class="op" id="6398862">:=</span>&nbsp;<span class="ident" id="6398865">b</span><span class="op" id="6398866">.</span><span class="ident" id="6398867">Max</span><span class="op" id="6398870">.</span><span class="ident" id="6398871">Y</span>&nbsp;<span class="op" id="6398873">-</span>&nbsp;<span class="num" id="6398875">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398878">for</span>&nbsp;<span class="ident" id="6398882">j</span>&nbsp;<span class="op" id="6398884">:=</span>&nbsp;<span class="num" id="6398887">0</span><span class="op" id="6398888">;</span>&nbsp;<span class="ident" id="6398890">j</span>&nbsp;<span class="op" id="6398892">&lt;</span>&nbsp;<span class="num" id="6398894">8</span><span class="op" id="6398895">;</span>&nbsp;<span class="ident" id="6398897">j</span><span class="op" id="6398898">++</span>&nbsp;<span class="op" id="6398901">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6398905">for</span>&nbsp;<span class="ident" id="6398909">i</span>&nbsp;<span class="op" id="6398911">:=</span>&nbsp;<span class="num" id="6398914">0</span><span class="op" id="6398915">;</span>&nbsp;<span class="ident" id="6398917">i</span>&nbsp;<span class="op" id="6398919">&lt;</span>&nbsp;<span class="num" id="6398921">8</span><span class="op" id="6398922">;</span>&nbsp;<span class="ident" id="6398924">i</span><span class="op" id="6398925">++</span>&nbsp;<span class="op" id="6398928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398933">r</span><span class="op" id="6398934">,</span>&nbsp;<span class="ident" id="6398936">g</span><span class="op" id="6398937">,</span>&nbsp;<span class="ident" id="6398939">b</span><span class="op" id="6398940">,</span>&nbsp;<span class="ident" id="6398942">_</span>&nbsp;<span class="op" id="6398944">:=</span>&nbsp;<span class="ident" id="6398947">m</span><span class="op" id="6398948">.</span><span class="ident" id="6398949">At</span><span class="op" id="6398951">(</span><span class="ident" id="6398952">min</span><span class="op" id="6398955">(</span><span class="ident" id="6398956">p</span><span class="op" id="6398957">.</span><span class="ident" id="6398958">X</span><span class="op" id="6398959">+</span><span class="ident" id="6398960">i</span><span class="op" id="6398961">,</span>&nbsp;<span class="ident" id="6398963">xmax</span><span class="op" id="6398967">)</span><span class="op" id="6398968">,</span>&nbsp;<span class="ident" id="6398970">min</span><span class="op" id="6398973">(</span><span class="ident" id="6398974">p</span><span class="op" id="6398975">.</span><span class="ident" id="6398976">Y</span><span class="op" id="6398977">+</span><span class="ident" id="6398978">j</span><span class="op" id="6398979">,</span>&nbsp;<span class="ident" id="6398981">ymax</span><span class="op" id="6398985">)</span><span class="op" id="6398986">)</span><span class="op" id="6398987">.</span><span class="ident" id="6398988">RGBA</span><span class="op" id="6398992">(</span><span class="op" id="6398993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6398998">yy</span><span class="op" id="6399000">,</span>&nbsp;<span class="ident" id="6399002">cb</span><span class="op" id="6399004">,</span>&nbsp;<span class="ident" id="6399006">cr</span>&nbsp;<span class="op" id="6399009">:=</span>&nbsp;<span class="ident" id="6399012">color</span><span class="op" id="6399017">.</span><span class="ident" id="6399018">RGBToYCbCr</span><span class="op" id="6399028">(</span><span class="builtintype" id="6399029">uint8</span><span class="op" id="6399034">(</span><span class="ident" id="6399035">r</span><span class="op" id="6399036">&gt;&gt;</span><span class="num" id="6399038">8</span><span class="op" id="6399039">)</span><span class="op" id="6399040">,</span>&nbsp;<span class="builtintype" id="6399042">uint8</span><span class="op" id="6399047">(</span><span class="ident" id="6399048">g</span><span class="op" id="6399049">&gt;&gt;</span><span class="num" id="6399051">8</span><span class="op" id="6399052">)</span><span class="op" id="6399053">,</span>&nbsp;<span class="builtintype" id="6399055">uint8</span><span class="op" id="6399060">(</span><span class="ident" id="6399061">b</span><span class="op" id="6399062">&gt;&gt;</span><span class="num" id="6399064">8</span><span class="op" id="6399065">)</span><span class="op" id="6399066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399071">yBlock</span><span class="op" id="6399077">[</span><span class="num" id="6399078">8</span><span class="op" id="6399079">*</span><span class="ident" id="6399080">j</span><span class="op" id="6399081">+</span><span class="ident" id="6399082">i</span><span class="op" id="6399083">]</span>&nbsp;<span class="op" id="6399085">=</span>&nbsp;<span class="builtintype" id="6399087">int32</span><span class="op" id="6399092">(</span><span class="ident" id="6399093">yy</span><span class="op" id="6399095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399100">cbBlock</span><span class="op" id="6399107">[</span><span class="num" id="6399108">8</span><span class="op" id="6399109">*</span><span class="ident" id="6399110">j</span><span class="op" id="6399111">+</span><span class="ident" id="6399112">i</span><span class="op" id="6399113">]</span>&nbsp;<span class="op" id="6399115">=</span>&nbsp;<span class="builtintype" id="6399117">int32</span><span class="op" id="6399122">(</span><span class="ident" id="6399123">cb</span><span class="op" id="6399125">)</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399130">crBlock</span><span class="op" id="6399137">[</span><span class="num" id="6399138">8</span><span class="op" id="6399139">*</span><span class="ident" id="6399140">j</span><span class="op" id="6399141">+</span><span class="ident" id="6399142">i</span><span class="op" id="6399143">]</span>&nbsp;<span class="op" id="6399145">=</span>&nbsp;<span class="builtintype" id="6399147">int32</span><span class="op" id="6399152">(</span><span class="ident" id="6399153">cr</span><span class="op" id="6399155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399162">}</span><br>
<span class="lineno"></span><span class="op" id="6399164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span><span class="comment" id="6399167">//&nbsp;grayToY&nbsp;stores&nbsp;the&nbsp;8x8&nbsp;region&nbsp;of&nbsp;m&nbsp;whose&nbsp;top-left&nbsp;corner&nbsp;is&nbsp;p&nbsp;in&nbsp;yBlock.</span><br>
<span class="lineno"></span><span class="keyword" id="6399243">func</span>&nbsp;<span class="ident" id="6399248">grayToY</span><span class="op" id="6399255">(</span><span class="ident" id="6399256">m</span>&nbsp;<span class="op" id="6399258">*</span><span class="ident" id="6399259">image</span><span class="op" id="6399264">.</span><span class="ident" id="6399265">Gray</span><span class="op" id="6399269">,</span>&nbsp;<span class="ident" id="6399271">p</span>&nbsp;<span class="ident" id="6399273">image</span><span class="op" id="6399278">.</span><span class="ident" id="6399279">Point</span><span class="op" id="6399284">,</span>&nbsp;<span class="ident" id="6399286">yBlock</span>&nbsp;<span class="op" id="6399293">*</span><span class="ident" id="6399294">block</span><span class="op" id="6399299">)</span>&nbsp;<span class="op" id="6399301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399304">b</span>&nbsp;<span class="op" id="6399306">:=</span>&nbsp;<span class="ident" id="6399309">m</span><span class="op" id="6399310">.</span><span class="ident" id="6399311">Bounds</span><span class="op" id="6399317">(</span><span class="op" id="6399318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399321">xmax</span>&nbsp;<span class="op" id="6399326">:=</span>&nbsp;<span class="ident" id="6399329">b</span><span class="op" id="6399330">.</span><span class="ident" id="6399331">Max</span><span class="op" id="6399334">.</span><span class="ident" id="6399335">X</span>&nbsp;<span class="op" id="6399337">-</span>&nbsp;<span class="num" id="6399339">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399342">ymax</span>&nbsp;<span class="op" id="6399347">:=</span>&nbsp;<span class="ident" id="6399350">b</span><span class="op" id="6399351">.</span><span class="ident" id="6399352">Max</span><span class="op" id="6399355">.</span><span class="ident" id="6399356">Y</span>&nbsp;<span class="op" id="6399358">-</span>&nbsp;<span class="num" id="6399360">1</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399363">pix</span>&nbsp;<span class="op" id="6399367">:=</span>&nbsp;<span class="ident" id="6399370">m</span><span class="op" id="6399371">.</span><span class="ident" id="6399372">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399377">for</span>&nbsp;<span class="ident" id="6399381">j</span>&nbsp;<span class="op" id="6399383">:=</span>&nbsp;<span class="num" id="6399386">0</span><span class="op" id="6399387">;</span>&nbsp;<span class="ident" id="6399389">j</span>&nbsp;<span class="op" id="6399391">&lt;</span>&nbsp;<span class="num" id="6399393">8</span><span class="op" id="6399394">;</span>&nbsp;<span class="ident" id="6399396">j</span><span class="op" id="6399397">++</span>&nbsp;<span class="op" id="6399400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399404">for</span>&nbsp;<span class="ident" id="6399408">i</span>&nbsp;<span class="op" id="6399410">:=</span>&nbsp;<span class="num" id="6399413">0</span><span class="op" id="6399414">;</span>&nbsp;<span class="ident" id="6399416">i</span>&nbsp;<span class="op" id="6399418">&lt;</span>&nbsp;<span class="num" id="6399420">8</span><span class="op" id="6399421">;</span>&nbsp;<span class="ident" id="6399423">i</span><span class="op" id="6399424">++</span>&nbsp;<span class="op" id="6399427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399432">idx</span>&nbsp;<span class="op" id="6399436">:=</span>&nbsp;<span class="ident" id="6399439">m</span><span class="op" id="6399440">.</span><span class="ident" id="6399441">PixOffset</span><span class="op" id="6399450">(</span><span class="ident" id="6399451">min</span><span class="op" id="6399454">(</span><span class="ident" id="6399455">p</span><span class="op" id="6399456">.</span><span class="ident" id="6399457">X</span><span class="op" id="6399458">+</span><span class="ident" id="6399459">i</span><span class="op" id="6399460">,</span>&nbsp;<span class="ident" id="6399462">xmax</span><span class="op" id="6399466">)</span><span class="op" id="6399467">,</span>&nbsp;<span class="ident" id="6399469">min</span><span class="op" id="6399472">(</span><span class="ident" id="6399473">p</span><span class="op" id="6399474">.</span><span class="ident" id="6399475">Y</span><span class="op" id="6399476">+</span><span class="ident" id="6399477">j</span><span class="op" id="6399478">,</span>&nbsp;<span class="ident" id="6399480">ymax</span><span class="op" id="6399484">)</span><span class="op" id="6399485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399490">yBlock</span><span class="op" id="6399496">[</span><span class="num" id="6399497">8</span><span class="op" id="6399498">*</span><span class="ident" id="6399499">j</span><span class="op" id="6399500">+</span><span class="ident" id="6399501">i</span><span class="op" id="6399502">]</span>&nbsp;<span class="op" id="6399504">=</span>&nbsp;<span class="builtintype" id="6399506">int32</span><span class="op" id="6399511">(</span><span class="ident" id="6399512">pix</span><span class="op" id="6399515">[</span><span class="ident" id="6399516">idx</span><span class="op" id="6399519">]</span><span class="op" id="6399520">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399527">}</span><br>
<span class="lineno"></span><span class="op" id="6399529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6399532">//&nbsp;rgbaToYCbCr&nbsp;is&nbsp;a&nbsp;specialized&nbsp;version&nbsp;of&nbsp;toYCbCr&nbsp;for&nbsp;image.RGBA&nbsp;images.</span><br>
<span class="lineno">420</span><span class="keyword" id="6399606">func</span>&nbsp;<span class="ident" id="6399611">rgbaToYCbCr</span><span class="op" id="6399622">(</span><span class="ident" id="6399623">m</span>&nbsp;<span class="op" id="6399625">*</span><span class="ident" id="6399626">image</span><span class="op" id="6399631">.</span><span class="ident" id="6399632">RGBA</span><span class="op" id="6399636">,</span>&nbsp;<span class="ident" id="6399638">p</span>&nbsp;<span class="ident" id="6399640">image</span><span class="op" id="6399645">.</span><span class="ident" id="6399646">Point</span><span class="op" id="6399651">,</span>&nbsp;<span class="ident" id="6399653">yBlock</span><span class="op" id="6399659">,</span>&nbsp;<span class="ident" id="6399661">cbBlock</span><span class="op" id="6399668">,</span>&nbsp;<span class="ident" id="6399670">crBlock</span>&nbsp;<span class="op" id="6399678">*</span><span class="ident" id="6399679">block</span><span class="op" id="6399684">)</span>&nbsp;<span class="op" id="6399686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399689">b</span>&nbsp;<span class="op" id="6399691">:=</span>&nbsp;<span class="ident" id="6399694">m</span><span class="op" id="6399695">.</span><span class="ident" id="6399696">Bounds</span><span class="op" id="6399702">(</span><span class="op" id="6399703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399706">xmax</span>&nbsp;<span class="op" id="6399711">:=</span>&nbsp;<span class="ident" id="6399714">b</span><span class="op" id="6399715">.</span><span class="ident" id="6399716">Max</span><span class="op" id="6399719">.</span><span class="ident" id="6399720">X</span>&nbsp;<span class="op" id="6399722">-</span>&nbsp;<span class="num" id="6399724">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399727">ymax</span>&nbsp;<span class="op" id="6399732">:=</span>&nbsp;<span class="ident" id="6399735">b</span><span class="op" id="6399736">.</span><span class="ident" id="6399737">Max</span><span class="op" id="6399740">.</span><span class="ident" id="6399741">Y</span>&nbsp;<span class="op" id="6399743">-</span>&nbsp;<span class="num" id="6399745">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399748">for</span>&nbsp;<span class="ident" id="6399752">j</span>&nbsp;<span class="op" id="6399754">:=</span>&nbsp;<span class="num" id="6399757">0</span><span class="op" id="6399758">;</span>&nbsp;<span class="ident" id="6399760">j</span>&nbsp;<span class="op" id="6399762">&lt;</span>&nbsp;<span class="num" id="6399764">8</span><span class="op" id="6399765">;</span>&nbsp;<span class="ident" id="6399767">j</span><span class="op" id="6399768">++</span>&nbsp;<span class="op" id="6399771">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399775">sj</span>&nbsp;<span class="op" id="6399778">:=</span>&nbsp;<span class="ident" id="6399781">p</span><span class="op" id="6399782">.</span><span class="ident" id="6399783">Y</span>&nbsp;<span class="op" id="6399785">+</span>&nbsp;<span class="ident" id="6399787">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399791">if</span>&nbsp;<span class="ident" id="6399794">sj</span>&nbsp;<span class="op" id="6399797">&gt;</span>&nbsp;<span class="ident" id="6399799">ymax</span>&nbsp;<span class="op" id="6399804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399809">sj</span>&nbsp;<span class="op" id="6399812">=</span>&nbsp;<span class="ident" id="6399814">ymax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399825">offset</span>&nbsp;<span class="op" id="6399832">:=</span>&nbsp;<span class="op" id="6399835">(</span><span class="ident" id="6399836">sj</span><span class="op" id="6399838">-</span><span class="ident" id="6399839">b</span><span class="op" id="6399840">.</span><span class="ident" id="6399841">Min</span><span class="op" id="6399844">.</span><span class="ident" id="6399845">Y</span><span class="op" id="6399846">)</span><span class="op" id="6399847">*</span><span class="ident" id="6399848">m</span><span class="op" id="6399849">.</span><span class="ident" id="6399850">Stride</span>&nbsp;<span class="op" id="6399857">-</span>&nbsp;<span class="ident" id="6399859">b</span><span class="op" id="6399860">.</span><span class="ident" id="6399861">Min</span><span class="op" id="6399864">.</span><span class="ident" id="6399865">X</span><span class="op" id="6399866">*</span><span class="num" id="6399867">4</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399871">for</span>&nbsp;<span class="ident" id="6399875">i</span>&nbsp;<span class="op" id="6399877">:=</span>&nbsp;<span class="num" id="6399880">0</span><span class="op" id="6399881">;</span>&nbsp;<span class="ident" id="6399883">i</span>&nbsp;<span class="op" id="6399885">&lt;</span>&nbsp;<span class="num" id="6399887">8</span><span class="op" id="6399888">;</span>&nbsp;<span class="ident" id="6399890">i</span><span class="op" id="6399891">++</span>&nbsp;<span class="op" id="6399894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399899">sx</span>&nbsp;<span class="op" id="6399902">:=</span>&nbsp;<span class="ident" id="6399905">p</span><span class="op" id="6399906">.</span><span class="ident" id="6399907">X</span>&nbsp;<span class="op" id="6399909">+</span>&nbsp;<span class="ident" id="6399911">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6399916">if</span>&nbsp;<span class="ident" id="6399919">sx</span>&nbsp;<span class="op" id="6399922">&gt;</span>&nbsp;<span class="ident" id="6399924">xmax</span>&nbsp;<span class="op" id="6399929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399935">sx</span>&nbsp;<span class="op" id="6399938">=</span>&nbsp;<span class="ident" id="6399940">xmax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6399948">}</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399953">pix</span>&nbsp;<span class="op" id="6399957">:=</span>&nbsp;<span class="ident" id="6399960">m</span><span class="op" id="6399961">.</span><span class="ident" id="6399962">Pix</span><span class="op" id="6399965">[</span><span class="ident" id="6399966">offset</span><span class="op" id="6399972">+</span><span class="ident" id="6399973">sx</span><span class="op" id="6399975">*</span><span class="num" id="6399976">4</span><span class="op" id="6399977">:</span><span class="op" id="6399978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6399983">yy</span><span class="op" id="6399985">,</span>&nbsp;<span class="ident" id="6399987">cb</span><span class="op" id="6399989">,</span>&nbsp;<span class="ident" id="6399991">cr</span>&nbsp;<span class="op" id="6399994">:=</span>&nbsp;<span class="ident" id="6399997">color</span><span class="op" id="6400002">.</span><span class="ident" id="6400003">RGBToYCbCr</span><span class="op" id="6400013">(</span><span class="ident" id="6400014">pix</span><span class="op" id="6400017">[</span><span class="num" id="6400018">0</span><span class="op" id="6400019">]</span><span class="op" id="6400020">,</span>&nbsp;<span class="ident" id="6400022">pix</span><span class="op" id="6400025">[</span><span class="num" id="6400026">1</span><span class="op" id="6400027">]</span><span class="op" id="6400028">,</span>&nbsp;<span class="ident" id="6400030">pix</span><span class="op" id="6400033">[</span><span class="num" id="6400034">2</span><span class="op" id="6400035">]</span><span class="op" id="6400036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400041">yBlock</span><span class="op" id="6400047">[</span><span class="num" id="6400048">8</span><span class="op" id="6400049">*</span><span class="ident" id="6400050">j</span><span class="op" id="6400051">+</span><span class="ident" id="6400052">i</span><span class="op" id="6400053">]</span>&nbsp;<span class="op" id="6400055">=</span>&nbsp;<span class="builtintype" id="6400057">int32</span><span class="op" id="6400062">(</span><span class="ident" id="6400063">yy</span><span class="op" id="6400065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400070">cbBlock</span><span class="op" id="6400077">[</span><span class="num" id="6400078">8</span><span class="op" id="6400079">*</span><span class="ident" id="6400080">j</span><span class="op" id="6400081">+</span><span class="ident" id="6400082">i</span><span class="op" id="6400083">]</span>&nbsp;<span class="op" id="6400085">=</span>&nbsp;<span class="builtintype" id="6400087">int32</span><span class="op" id="6400092">(</span><span class="ident" id="6400093">cb</span><span class="op" id="6400095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400100">crBlock</span><span class="op" id="6400107">[</span><span class="num" id="6400108">8</span><span class="op" id="6400109">*</span><span class="ident" id="6400110">j</span><span class="op" id="6400111">+</span><span class="ident" id="6400112">i</span><span class="op" id="6400113">]</span>&nbsp;<span class="op" id="6400115">=</span>&nbsp;<span class="builtintype" id="6400117">int32</span><span class="op" id="6400122">(</span><span class="ident" id="6400123">cr</span><span class="op" id="6400125">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400129">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400132">}</span><br>
<span class="lineno"></span><span class="op" id="6400134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6400137">//&nbsp;scale&nbsp;scales&nbsp;the&nbsp;16x16&nbsp;region&nbsp;represented&nbsp;by&nbsp;the&nbsp;4&nbsp;src&nbsp;blocks&nbsp;to&nbsp;the&nbsp;8x8</span><br>
<span class="lineno">445</span><span class="comment" id="6400213">//&nbsp;dst&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6400227">func</span>&nbsp;<span class="ident" id="6400232">scale</span><span class="op" id="6400237">(</span><span class="ident" id="6400238">dst</span>&nbsp;<span class="op" id="6400242">*</span><span class="ident" id="6400243">block</span><span class="op" id="6400248">,</span>&nbsp;<span class="ident" id="6400250">src</span>&nbsp;<span class="op" id="6400254">*</span><span class="op" id="6400255">[</span><span class="num" id="6400256">4</span><span class="op" id="6400257">]</span><span class="ident" id="6400258">block</span><span class="op" id="6400263">)</span>&nbsp;<span class="op" id="6400265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400268">for</span>&nbsp;<span class="ident" id="6400272">i</span>&nbsp;<span class="op" id="6400274">:=</span>&nbsp;<span class="num" id="6400277">0</span><span class="op" id="6400278">;</span>&nbsp;<span class="ident" id="6400280">i</span>&nbsp;<span class="op" id="6400282">&lt;</span>&nbsp;<span class="num" id="6400284">4</span><span class="op" id="6400285">;</span>&nbsp;<span class="ident" id="6400287">i</span><span class="op" id="6400288">++</span>&nbsp;<span class="op" id="6400291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400295">dstOff</span>&nbsp;<span class="op" id="6400302">:=</span>&nbsp;<span class="op" id="6400305">(</span><span class="ident" id="6400306">i</span><span class="op" id="6400307">&amp;</span><span class="num" id="6400308">2</span><span class="op" id="6400309">)</span><span class="op" id="6400310">&lt;&lt;</span><span class="num" id="6400312">4</span>&nbsp;<span class="op" id="6400314">|</span>&nbsp;<span class="op" id="6400316">(</span><span class="ident" id="6400317">i</span><span class="op" id="6400318">&amp;</span><span class="num" id="6400319">1</span><span class="op" id="6400320">)</span><span class="op" id="6400321">&lt;&lt;</span><span class="num" id="6400323">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400327">for</span>&nbsp;<span class="ident" id="6400331">y</span>&nbsp;<span class="op" id="6400333">:=</span>&nbsp;<span class="num" id="6400336">0</span><span class="op" id="6400337">;</span>&nbsp;<span class="ident" id="6400339">y</span>&nbsp;<span class="op" id="6400341">&lt;</span>&nbsp;<span class="num" id="6400343">4</span><span class="op" id="6400344">;</span>&nbsp;<span class="ident" id="6400346">y</span><span class="op" id="6400347">++</span>&nbsp;<span class="op" id="6400350">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6400355">for</span>&nbsp;<span class="ident" id="6400359">x</span>&nbsp;<span class="op" id="6400361">:=</span>&nbsp;<span class="num" id="6400364">0</span><span class="op" id="6400365">;</span>&nbsp;<span class="ident" id="6400367">x</span>&nbsp;<span class="op" id="6400369">&lt;</span>&nbsp;<span class="num" id="6400371">4</span><span class="op" id="6400372">;</span>&nbsp;<span class="ident" id="6400374">x</span><span class="op" id="6400375">++</span>&nbsp;<span class="op" id="6400378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400384">j</span>&nbsp;<span class="op" id="6400386">:=</span>&nbsp;<span class="num" id="6400389">16</span><span class="op" id="6400391">*</span><span class="ident" id="6400392">y</span>&nbsp;<span class="op" id="6400394">+</span>&nbsp;<span class="num" id="6400396">2</span><span class="op" id="6400397">*</span><span class="ident" id="6400398">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400404">sum</span>&nbsp;<span class="op" id="6400408">:=</span>&nbsp;<span class="ident" id="6400411">src</span><span class="op" id="6400414">[</span><span class="ident" id="6400415">i</span><span class="op" id="6400416">]</span><span class="op" id="6400417">[</span><span class="ident" id="6400418">j</span><span class="op" id="6400419">]</span>&nbsp;<span class="op" id="6400421">+</span>&nbsp;<span class="ident" id="6400423">src</span><span class="op" id="6400426">[</span><span class="ident" id="6400427">i</span><span class="op" id="6400428">]</span><span class="op" id="6400429">[</span><span class="ident" id="6400430">j</span><span class="op" id="6400431">+</span><span class="num" id="6400432">1</span><span class="op" id="6400433">]</span>&nbsp;<span class="op" id="6400435">+</span>&nbsp;<span class="ident" id="6400437">src</span><span class="op" id="6400440">[</span><span class="ident" id="6400441">i</span><span class="op" id="6400442">]</span><span class="op" id="6400443">[</span><span class="ident" id="6400444">j</span><span class="op" id="6400445">+</span><span class="num" id="6400446">8</span><span class="op" id="6400447">]</span>&nbsp;<span class="op" id="6400449">+</span>&nbsp;<span class="ident" id="6400451">src</span><span class="op" id="6400454">[</span><span class="ident" id="6400455">i</span><span class="op" id="6400456">]</span><span class="op" id="6400457">[</span><span class="ident" id="6400458">j</span><span class="op" id="6400459">+</span><span class="num" id="6400460">9</span><span class="op" id="6400461">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6400467">dst</span><span class="op" id="6400470">[</span><span class="num" id="6400471">8</span><span class="op" id="6400472">*</span><span class="ident" id="6400473">y</span><span class="op" id="6400474">+</span><span class="ident" id="6400475">x</span><span class="op" id="6400476">+</span><span class="ident" id="6400477">dstOff</span><span class="op" id="6400483">]</span>&nbsp;<span class="op" id="6400485">=</span>&nbsp;<span class="op" id="6400487">(</span><span class="ident" id="6400488">sum</span>&nbsp;<span class="op" id="6400492">+</span>&nbsp;<span class="num" id="6400494">2</span><span class="op" id="6400495">)</span>&nbsp;<span class="op" id="6400497">&gt;&gt;</span>&nbsp;<span class="num" id="6400500">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400505">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6400512">}</span><br>
<span class="lineno"></span><span class="op" id="6400514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6400517">//&nbsp;sosHeaderY&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;8&nbsp;bytes:</span><br>
<span class="lineno">460</span><span class="comment" id="6400581">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x08&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6400616">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x01&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6400654">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6400714">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6400785">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno">465</span><span class="comment" id="6400860">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6400903">var</span>&nbsp;<span class="ident" id="6400907">sosHeaderY</span>&nbsp;<span class="op" id="6400918">=</span>&nbsp;<span class="op" id="6400920">[</span><span class="op" id="6400921">]</span><span class="builtintype" id="6400922">byte</span><span class="op" id="6400926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6400929">0xff</span><span class="op" id="6400933">,</span>&nbsp;<span class="num" id="6400935">0xda</span><span class="op" id="6400939">,</span>&nbsp;<span class="num" id="6400941">0x00</span><span class="op" id="6400945">,</span>&nbsp;<span class="num" id="6400947">0x08</span><span class="op" id="6400951">,</span>&nbsp;<span class="num" id="6400953">0x01</span><span class="op" id="6400957">,</span>&nbsp;<span class="num" id="6400959">0x01</span><span class="op" id="6400963">,</span>&nbsp;<span class="num" id="6400965">0x00</span><span class="op" id="6400969">,</span>&nbsp;<span class="num" id="6400971">0x00</span><span class="op" id="6400975">,</span>&nbsp;<span class="num" id="6400977">0x3f</span><span class="op" id="6400981">,</span>&nbsp;<span class="num" id="6400983">0x00</span><span class="op" id="6400987">,</span><br>
<span class="lineno"></span><span class="op" id="6400989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6400992">//&nbsp;sosHeaderYCbCr&nbsp;is&nbsp;the&nbsp;SOS&nbsp;marker&nbsp;&#34;\xff\xda&#34;&nbsp;followed&nbsp;by&nbsp;12&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="6401061">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;marker&nbsp;length&nbsp;&#34;\x00\x0c&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6401096">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;number&nbsp;of&nbsp;components&nbsp;&#34;\x03&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6401134">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;1&nbsp;uses&nbsp;DC&nbsp;table&nbsp;0&nbsp;and&nbsp;AC&nbsp;table&nbsp;0&nbsp;&#34;\x01\x00&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6401194">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;2&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x02\x11&#34;,</span><br>
<span class="lineno">475</span><span class="comment" id="6401254">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;component&nbsp;3&nbsp;uses&nbsp;DC&nbsp;table&nbsp;1&nbsp;and&nbsp;AC&nbsp;table&nbsp;1&nbsp;&#34;\x03\x11&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="6401314">//&nbsp;&nbsp;&nbsp;&nbsp-&nbsp;the&nbsp;bytes&nbsp;&#34;\x00\x3f\x00&#34;.&nbsp;Section&nbsp;B.2.3&nbsp;of&nbsp;the&nbsp;spec&nbsp;says&nbsp;that&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6401385">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;sequential&nbsp;DCTs,&nbsp;those&nbsp;bytes&nbsp;(8-bit&nbsp;Ss,&nbsp;8-bit&nbsp;Se,&nbsp;4-bit&nbsp;Ah,&nbsp;4-bit&nbsp;Al)</span><br>
<span class="lineno"></span><span class="comment" id="6401460">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;should&nbsp;be&nbsp;0x00,&nbsp;0x3f,&nbsp;0x00&lt;&lt;4&nbsp;|&nbsp;0x00.</span><br>
<span class="lineno"></span><span class="keyword" id="6401503">var</span>&nbsp;<span class="ident" id="6401507">sosHeaderYCbCr</span>&nbsp;<span class="op" id="6401522">=</span>&nbsp;<span class="op" id="6401524">[</span><span class="op" id="6401525">]</span><span class="builtintype" id="6401526">byte</span><span class="op" id="6401530">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6401533">0xff</span><span class="op" id="6401537">,</span>&nbsp;<span class="num" id="6401539">0xda</span><span class="op" id="6401543">,</span>&nbsp;<span class="num" id="6401545">0x00</span><span class="op" id="6401549">,</span>&nbsp;<span class="num" id="6401551">0x0c</span><span class="op" id="6401555">,</span>&nbsp;<span class="num" id="6401557">0x03</span><span class="op" id="6401561">,</span>&nbsp;<span class="num" id="6401563">0x01</span><span class="op" id="6401567">,</span>&nbsp;<span class="num" id="6401569">0x00</span><span class="op" id="6401573">,</span>&nbsp;<span class="num" id="6401575">0x02</span><span class="op" id="6401579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6401582">0x11</span><span class="op" id="6401586">,</span>&nbsp;<span class="num" id="6401588">0x03</span><span class="op" id="6401592">,</span>&nbsp;<span class="num" id="6401594">0x11</span><span class="op" id="6401598">,</span>&nbsp;<span class="num" id="6401600">0x00</span><span class="op" id="6401604">,</span>&nbsp;<span class="num" id="6401606">0x3f</span><span class="op" id="6401610">,</span>&nbsp;<span class="num" id="6401612">0x00</span><span class="op" id="6401616">,</span><br>
<span class="lineno"></span><span class="op" id="6401618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6401621">//&nbsp;writeSOS&nbsp;writes&nbsp;the&nbsp;StartOfScan&nbsp;marker.</span><br>
<span class="lineno">485</span><span class="keyword" id="6401664">func</span>&nbsp;<span class="op" id="6401669">(</span><span class="ident" id="6401670">e</span>&nbsp;<span class="op" id="6401672">*</span><span class="ident" id="6401673">encoder</span><span class="op" id="6401680">)</span>&nbsp;<span class="ident" id="6401682">writeSOS</span><span class="op" id="6401690">(</span><span class="ident" id="6401691">m</span>&nbsp;<span class="ident" id="6401693">image</span><span class="op" id="6401698">.</span><span class="ident" id="6401699">Image</span><span class="op" id="6401704">)</span>&nbsp;<span class="op" id="6401706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401709">switch</span>&nbsp;<span class="ident" id="6401716">m</span><span class="op" id="6401717">.</span><span class="op" id="6401718">(</span><span class="keyword" id="6401719">type</span><span class="op" id="6401723">)</span>&nbsp;<span class="op" id="6401725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401728">case</span>&nbsp;<span class="op" id="6401733">*</span><span class="ident" id="6401734">image</span><span class="op" id="6401739">.</span><span class="ident" id="6401740">Gray</span><span class="op" id="6401744">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401748">e</span><span class="op" id="6401749">.</span><span class="ident" id="6401750">write</span><span class="op" id="6401755">(</span><span class="ident" id="6401756">sosHeaderY</span><span class="op" id="6401766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401769">default</span><span class="op" id="6401776">:</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401780">e</span><span class="op" id="6401781">.</span><span class="ident" id="6401782">write</span><span class="op" id="6401787">(</span><span class="ident" id="6401788">sosHeaderYCbCr</span><span class="op" id="6401802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6401805">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6401808">var</span>&nbsp;<span class="op" id="6401812">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6401816">//&nbsp;Scratch&nbsp;buffers&nbsp;to&nbsp;hold&nbsp;the&nbsp;YCbCr&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6401863">//&nbsp;The&nbsp;blocks&nbsp;are&nbsp;in&nbsp;natural&nbsp;(not&nbsp;zig-zag)&nbsp;order.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401915">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6401922">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401930">cb</span><span class="op" id="6401932">,</span>&nbsp;<span class="ident" id="6401934">cr</span>&nbsp;<span class="op" id="6401937">[</span><span class="num" id="6401938">4</span><span class="op" id="6401939">]</span><span class="ident" id="6401940">block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6401948">//&nbsp;DC&nbsp;components&nbsp;are&nbsp;delta-encoded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6401986">prevDCY</span><span class="op" id="6401993">,</span>&nbsp;<span class="ident" id="6401995">prevDCCb</span><span class="op" id="6402003">,</span>&nbsp;<span class="ident" id="6402005">prevDCCr</span>&nbsp;<span class="builtintype" id="6402014">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402021">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402024">bounds</span>&nbsp;<span class="op" id="6402031">:=</span>&nbsp;<span class="ident" id="6402034">m</span><span class="op" id="6402035">.</span><span class="ident" id="6402036">Bounds</span><span class="op" id="6402042">(</span><span class="op" id="6402043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402046">switch</span>&nbsp;<span class="ident" id="6402053">m</span>&nbsp;<span class="op" id="6402055">:=</span>&nbsp;<span class="ident" id="6402058">m</span><span class="op" id="6402059">.</span><span class="op" id="6402060">(</span><span class="keyword" id="6402061">type</span><span class="op" id="6402065">)</span>&nbsp;<span class="op" id="6402067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402070">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402132">case</span>&nbsp;<span class="op" id="6402137">*</span><span class="ident" id="6402138">image</span><span class="op" id="6402143">.</span><span class="ident" id="6402144">Gray</span><span class="op" id="6402148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402152">for</span>&nbsp;<span class="ident" id="6402156">y</span>&nbsp;<span class="op" id="6402158">:=</span>&nbsp;<span class="ident" id="6402161">bounds</span><span class="op" id="6402167">.</span><span class="ident" id="6402168">Min</span><span class="op" id="6402171">.</span><span class="ident" id="6402172">Y</span><span class="op" id="6402173">;</span>&nbsp;<span class="ident" id="6402175">y</span>&nbsp;<span class="op" id="6402177">&lt;</span>&nbsp;<span class="ident" id="6402179">bounds</span><span class="op" id="6402185">.</span><span class="ident" id="6402186">Max</span><span class="op" id="6402189">.</span><span class="ident" id="6402190">Y</span><span class="op" id="6402191">;</span>&nbsp;<span class="ident" id="6402193">y</span>&nbsp;<span class="op" id="6402195">+=</span>&nbsp;<span class="num" id="6402198">8</span>&nbsp;<span class="op" id="6402200">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402205">for</span>&nbsp;<span class="ident" id="6402209">x</span>&nbsp;<span class="op" id="6402211">:=</span>&nbsp;<span class="ident" id="6402214">bounds</span><span class="op" id="6402220">.</span><span class="ident" id="6402221">Min</span><span class="op" id="6402224">.</span><span class="ident" id="6402225">X</span><span class="op" id="6402226">;</span>&nbsp;<span class="ident" id="6402228">x</span>&nbsp;<span class="op" id="6402230">&lt;</span>&nbsp;<span class="ident" id="6402232">bounds</span><span class="op" id="6402238">.</span><span class="ident" id="6402239">Max</span><span class="op" id="6402242">.</span><span class="ident" id="6402243">X</span><span class="op" id="6402244">;</span>&nbsp;<span class="ident" id="6402246">x</span>&nbsp;<span class="op" id="6402248">+=</span>&nbsp;<span class="num" id="6402251">8</span>&nbsp;<span class="op" id="6402253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402259">p</span>&nbsp;<span class="op" id="6402261">:=</span>&nbsp;<span class="ident" id="6402264">image</span><span class="op" id="6402269">.</span><span class="ident" id="6402270">Pt</span><span class="op" id="6402272">(</span><span class="ident" id="6402273">x</span><span class="op" id="6402274">,</span>&nbsp;<span class="ident" id="6402276">y</span><span class="op" id="6402277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402283">grayToY</span><span class="op" id="6402290">(</span><span class="ident" id="6402291">m</span><span class="op" id="6402292">,</span>&nbsp;<span class="ident" id="6402294">p</span><span class="op" id="6402295">,</span>&nbsp;<span class="op" id="6402297">&amp;</span><span class="ident" id="6402298">b</span><span class="op" id="6402299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402305">prevDCY</span>&nbsp;<span class="op" id="6402313">=</span>&nbsp;<span class="ident" id="6402315">e</span><span class="op" id="6402316">.</span><span class="ident" id="6402317">writeBlock</span><span class="op" id="6402327">(</span><span class="op" id="6402328">&amp;</span><span class="ident" id="6402329">b</span><span class="op" id="6402330">,</span>&nbsp;<span class="num" id="6402332">0</span><span class="op" id="6402333">,</span>&nbsp;<span class="ident" id="6402335">prevDCY</span><span class="op" id="6402342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402347">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402354">default</span><span class="op" id="6402361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402365">rgba</span><span class="op" id="6402369">,</span>&nbsp;<span class="ident" id="6402371">_</span>&nbsp;<span class="op" id="6402373">:=</span>&nbsp;<span class="ident" id="6402376">m</span><span class="op" id="6402377">.</span><span class="op" id="6402378">(</span><span class="op" id="6402379">*</span><span class="ident" id="6402380">image</span><span class="op" id="6402385">.</span><span class="ident" id="6402386">RGBA</span><span class="op" id="6402390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402394">for</span>&nbsp;<span class="ident" id="6402398">y</span>&nbsp;<span class="op" id="6402400">:=</span>&nbsp;<span class="ident" id="6402403">bounds</span><span class="op" id="6402409">.</span><span class="ident" id="6402410">Min</span><span class="op" id="6402413">.</span><span class="ident" id="6402414">Y</span><span class="op" id="6402415">;</span>&nbsp;<span class="ident" id="6402417">y</span>&nbsp;<span class="op" id="6402419">&lt;</span>&nbsp;<span class="ident" id="6402421">bounds</span><span class="op" id="6402427">.</span><span class="ident" id="6402428">Max</span><span class="op" id="6402431">.</span><span class="ident" id="6402432">Y</span><span class="op" id="6402433">;</span>&nbsp;<span class="ident" id="6402435">y</span>&nbsp;<span class="op" id="6402437">+=</span>&nbsp;<span class="num" id="6402440">16</span>&nbsp;<span class="op" id="6402443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402448">for</span>&nbsp;<span class="ident" id="6402452">x</span>&nbsp;<span class="op" id="6402454">:=</span>&nbsp;<span class="ident" id="6402457">bounds</span><span class="op" id="6402463">.</span><span class="ident" id="6402464">Min</span><span class="op" id="6402467">.</span><span class="ident" id="6402468">X</span><span class="op" id="6402469">;</span>&nbsp;<span class="ident" id="6402471">x</span>&nbsp;<span class="op" id="6402473">&lt;</span>&nbsp;<span class="ident" id="6402475">bounds</span><span class="op" id="6402481">.</span><span class="ident" id="6402482">Max</span><span class="op" id="6402485">.</span><span class="ident" id="6402486">X</span><span class="op" id="6402487">;</span>&nbsp;<span class="ident" id="6402489">x</span>&nbsp;<span class="op" id="6402491">+=</span>&nbsp;<span class="num" id="6402494">16</span>&nbsp;<span class="op" id="6402497">{</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402503">for</span>&nbsp;<span class="ident" id="6402507">i</span>&nbsp;<span class="op" id="6402509">:=</span>&nbsp;<span class="num" id="6402512">0</span><span class="op" id="6402513">;</span>&nbsp;<span class="ident" id="6402515">i</span>&nbsp;<span class="op" id="6402517">&lt;</span>&nbsp;<span class="num" id="6402519">4</span><span class="op" id="6402520">;</span>&nbsp;<span class="ident" id="6402522">i</span><span class="op" id="6402523">++</span>&nbsp;<span class="op" id="6402526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402533">xOff</span>&nbsp;<span class="op" id="6402538">:=</span>&nbsp;<span class="op" id="6402541">(</span><span class="ident" id="6402542">i</span>&nbsp;<span class="op" id="6402544">&amp;</span>&nbsp;<span class="num" id="6402546">1</span><span class="op" id="6402547">)</span>&nbsp;<span class="op" id="6402549">*</span>&nbsp;<span class="num" id="6402551">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402558">yOff</span>&nbsp;<span class="op" id="6402563">:=</span>&nbsp;<span class="op" id="6402566">(</span><span class="ident" id="6402567">i</span>&nbsp;<span class="op" id="6402569">&amp;</span>&nbsp;<span class="num" id="6402571">2</span><span class="op" id="6402572">)</span>&nbsp;<span class="op" id="6402574">*</span>&nbsp;<span class="num" id="6402576">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402583">p</span>&nbsp;<span class="op" id="6402585">:=</span>&nbsp;<span class="ident" id="6402588">image</span><span class="op" id="6402593">.</span><span class="ident" id="6402594">Pt</span><span class="op" id="6402596">(</span><span class="ident" id="6402597">x</span><span class="op" id="6402598">+</span><span class="ident" id="6402599">xOff</span><span class="op" id="6402603">,</span>&nbsp;<span class="ident" id="6402605">y</span><span class="op" id="6402606">+</span><span class="ident" id="6402607">yOff</span><span class="op" id="6402611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6402618">if</span>&nbsp;<span class="ident" id="6402621">rgba</span>&nbsp;<span class="op" id="6402626">!=</span>&nbsp;<span class="ident" id="6402629">nil</span>&nbsp;<span class="op" id="6402633">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402641">rgbaToYCbCr</span><span class="op" id="6402652">(</span><span class="ident" id="6402653">rgba</span><span class="op" id="6402657">,</span>&nbsp;<span class="ident" id="6402659">p</span><span class="op" id="6402660">,</span>&nbsp;<span class="op" id="6402662">&amp;</span><span class="ident" id="6402663">b</span><span class="op" id="6402664">,</span>&nbsp;<span class="op" id="6402666">&amp;</span><span class="ident" id="6402667">cb</span><span class="op" id="6402669">[</span><span class="ident" id="6402670">i</span><span class="op" id="6402671">]</span><span class="op" id="6402672">,</span>&nbsp;<span class="op" id="6402674">&amp;</span><span class="ident" id="6402675">cr</span><span class="op" id="6402677">[</span><span class="ident" id="6402678">i</span><span class="op" id="6402679">]</span><span class="op" id="6402680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402687">}</span>&nbsp;<span class="keyword" id="6402689">else</span>&nbsp;<span class="op" id="6402694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402702">toYCbCr</span><span class="op" id="6402709">(</span><span class="ident" id="6402710">m</span><span class="op" id="6402711">,</span>&nbsp;<span class="ident" id="6402713">p</span><span class="op" id="6402714">,</span>&nbsp;<span class="op" id="6402716">&amp;</span><span class="ident" id="6402717">b</span><span class="op" id="6402718">,</span>&nbsp;<span class="op" id="6402720">&amp;</span><span class="ident" id="6402721">cb</span><span class="op" id="6402723">[</span><span class="ident" id="6402724">i</span><span class="op" id="6402725">]</span><span class="op" id="6402726">,</span>&nbsp;<span class="op" id="6402728">&amp;</span><span class="ident" id="6402729">cr</span><span class="op" id="6402731">[</span><span class="ident" id="6402732">i</span><span class="op" id="6402733">]</span><span class="op" id="6402734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402748">prevDCY</span>&nbsp;<span class="op" id="6402756">=</span>&nbsp;<span class="ident" id="6402758">e</span><span class="op" id="6402759">.</span><span class="ident" id="6402760">writeBlock</span><span class="op" id="6402770">(</span><span class="op" id="6402771">&amp;</span><span class="ident" id="6402772">b</span><span class="op" id="6402773">,</span>&nbsp;<span class="num" id="6402775">0</span><span class="op" id="6402776">,</span>&nbsp;<span class="ident" id="6402778">prevDCY</span><span class="op" id="6402785">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402797">scale</span><span class="op" id="6402802">(</span><span class="op" id="6402803">&amp;</span><span class="ident" id="6402804">b</span><span class="op" id="6402805">,</span>&nbsp;<span class="op" id="6402807">&amp;</span><span class="ident" id="6402808">cb</span><span class="op" id="6402810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402816">prevDCCb</span>&nbsp;<span class="op" id="6402825">=</span>&nbsp;<span class="ident" id="6402827">e</span><span class="op" id="6402828">.</span><span class="ident" id="6402829">writeBlock</span><span class="op" id="6402839">(</span><span class="op" id="6402840">&amp;</span><span class="ident" id="6402841">b</span><span class="op" id="6402842">,</span>&nbsp;<span class="num" id="6402844">1</span><span class="op" id="6402845">,</span>&nbsp;<span class="ident" id="6402847">prevDCCb</span><span class="op" id="6402855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402861">scale</span><span class="op" id="6402866">(</span><span class="op" id="6402867">&amp;</span><span class="ident" id="6402868">b</span><span class="op" id="6402869">,</span>&nbsp;<span class="op" id="6402871">&amp;</span><span class="ident" id="6402872">cr</span><span class="op" id="6402874">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402880">prevDCCr</span>&nbsp;<span class="op" id="6402889">=</span>&nbsp;<span class="ident" id="6402891">e</span><span class="op" id="6402892">.</span><span class="ident" id="6402893">writeBlock</span><span class="op" id="6402903">(</span><span class="op" id="6402904">&amp;</span><span class="ident" id="6402905">b</span><span class="op" id="6402906">,</span>&nbsp;<span class="num" id="6402908">1</span><span class="op" id="6402909">,</span>&nbsp;<span class="ident" id="6402911">prevDCCr</span><span class="op" id="6402919">)</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6402931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6402934">//&nbsp;Pad&nbsp;the&nbsp;last&nbsp;byte&nbsp;with&nbsp;1&#39;s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6402966">e</span><span class="op" id="6402967">.</span><span class="ident" id="6402968">emit</span><span class="op" id="6402972">(</span><span class="num" id="6402973">0x7f</span><span class="op" id="6402977">,</span>&nbsp;<span class="num" id="6402979">7</span><span class="op" id="6402980">)</span><br>
<span class="lineno">535</span><span class="op" id="6402982">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6402985">//&nbsp;DefaultQuality&nbsp;is&nbsp;the&nbsp;default&nbsp;quality&nbsp;encoding&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="keyword" id="6403046">const</span>&nbsp;<span class="ident" id="6403052">DefaultQuality</span>&nbsp;<span class="op" id="6403067">=</span>&nbsp;<span class="num" id="6403069">75</span><br>
<span class="lineno"></span><br>
<span class="lineno">540</span><span class="comment" id="6403073">//&nbsp;Options&nbsp;are&nbsp;the&nbsp;encoding&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="comment" id="6403113">//&nbsp;Quality&nbsp;ranges&nbsp;from&nbsp;1&nbsp;to&nbsp;100&nbsp;inclusive,&nbsp;higher&nbsp;is&nbsp;better.</span><br>
<span class="lineno"></span><span class="keyword" id="6403174">type</span>&nbsp;<span class="ident" id="6403179">Options</span>&nbsp;<span class="keyword" id="6403187">struct</span>&nbsp;<span class="op" id="6403194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403197">Quality</span>&nbsp;<span class="builtintype" id="6403205">int</span><br>
<span class="lineno"></span><span class="op" id="6403209">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span><span class="comment" id="6403212">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;Image&nbsp;m&nbsp;to&nbsp;w&nbsp;in&nbsp;JPEG&nbsp;4:2:0&nbsp;baseline&nbsp;format&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="6403291">//&nbsp;options.&nbsp;Default&nbsp;parameters&nbsp;are&nbsp;used&nbsp;if&nbsp;a&nbsp;nil&nbsp;*Options&nbsp;is&nbsp;passed.</span><br>
<span class="lineno"></span><span class="keyword" id="6403360">func</span>&nbsp;<span class="ident" id="6403365">Encode</span><span class="op" id="6403371">(</span><span class="ident" id="6403372">w</span>&nbsp;<span class="ident" id="6403374">io</span><span class="op" id="6403376">.</span><span class="ident" id="6403377">Writer</span><span class="op" id="6403383">,</span>&nbsp;<span class="ident" id="6403385">m</span>&nbsp;<span class="ident" id="6403387">image</span><span class="op" id="6403392">.</span><span class="ident" id="6403393">Image</span><span class="op" id="6403398">,</span>&nbsp;<span class="ident" id="6403400">o</span>&nbsp;<span class="op" id="6403402">*</span><span class="ident" id="6403403">Options</span><span class="op" id="6403410">)</span>&nbsp;<span class="builtintype" id="6403412">error</span>&nbsp;<span class="op" id="6403418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403421">b</span>&nbsp;<span class="op" id="6403423">:=</span>&nbsp;<span class="ident" id="6403426">m</span><span class="op" id="6403427">.</span><span class="ident" id="6403428">Bounds</span><span class="op" id="6403434">(</span><span class="op" id="6403435">)</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403438">if</span>&nbsp;<span class="ident" id="6403441">b</span><span class="op" id="6403442">.</span><span class="ident" id="6403443">Dx</span><span class="op" id="6403445">(</span><span class="op" id="6403446">)</span>&nbsp;<span class="op" id="6403448">&gt;=</span>&nbsp;<span class="num" id="6403451">1</span><span class="op" id="6403452">&lt;&lt;</span><span class="num" id="6403454">16</span>&nbsp;<span class="op" id="6403457">||</span>&nbsp;<span class="ident" id="6403460">b</span><span class="op" id="6403461">.</span><span class="ident" id="6403462">Dy</span><span class="op" id="6403464">(</span><span class="op" id="6403465">)</span>&nbsp;<span class="op" id="6403467">&gt;=</span>&nbsp;<span class="num" id="6403470">1</span><span class="op" id="6403471">&lt;&lt;</span><span class="num" id="6403473">16</span>&nbsp;<span class="op" id="6403476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403480">return</span>&nbsp;<span class="ident" id="6403487">errors</span><span class="op" id="6403493">.</span><span class="ident" id="6403494">New</span><span class="op" id="6403497">(</span><span class="string" id="6403498">&#34;jpeg:&nbsp;image&nbsp;is&nbsp;too&nbsp;large&nbsp;to&nbsp;encode&#34;</span><span class="op" id="6403534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403540">var</span>&nbsp;<span class="ident" id="6403544">e</span>&nbsp;<span class="ident" id="6403546">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403555">if</span>&nbsp;<span class="ident" id="6403558">ww</span><span class="op" id="6403560">,</span>&nbsp;<span class="ident" id="6403562">ok</span>&nbsp;<span class="op" id="6403565">:=</span>&nbsp;<span class="ident" id="6403568">w</span><span class="op" id="6403569">.</span><span class="op" id="6403570">(</span><span class="ident" id="6403571">writer</span><span class="op" id="6403577">)</span><span class="op" id="6403578">;</span>&nbsp;<span class="ident" id="6403580">ok</span>&nbsp;<span class="op" id="6403583">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403587">e</span><span class="op" id="6403588">.</span><span class="ident" id="6403589">w</span>&nbsp;<span class="op" id="6403591">=</span>&nbsp;<span class="ident" id="6403593">ww</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403597">}</span>&nbsp;<span class="keyword" id="6403599">else</span>&nbsp;<span class="op" id="6403604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403608">e</span><span class="op" id="6403609">.</span><span class="ident" id="6403610">w</span>&nbsp;<span class="op" id="6403612">=</span>&nbsp;<span class="ident" id="6403614">bufio</span><span class="op" id="6403619">.</span><span class="ident" id="6403620">NewWriter</span><span class="op" id="6403629">(</span><span class="ident" id="6403630">w</span><span class="op" id="6403631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403637">//&nbsp;Clip&nbsp;quality&nbsp;to&nbsp;[1,&nbsp;100].</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403667">quality</span>&nbsp;<span class="op" id="6403675">:=</span>&nbsp;<span class="ident" id="6403678">DefaultQuality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403694">if</span>&nbsp;<span class="ident" id="6403697">o</span>&nbsp;<span class="op" id="6403699">!=</span>&nbsp;<span class="ident" id="6403702">nil</span>&nbsp;<span class="op" id="6403706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403710">quality</span>&nbsp;<span class="op" id="6403718">=</span>&nbsp;<span class="ident" id="6403720">o</span><span class="op" id="6403721">.</span><span class="ident" id="6403722">Quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403732">if</span>&nbsp;<span class="ident" id="6403735">quality</span>&nbsp;<span class="op" id="6403743">&lt;</span>&nbsp;<span class="num" id="6403745">1</span>&nbsp;<span class="op" id="6403747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403752">quality</span>&nbsp;<span class="op" id="6403760">=</span>&nbsp;<span class="num" id="6403762">1</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403766">}</span>&nbsp;<span class="keyword" id="6403768">else</span>&nbsp;<span class="keyword" id="6403773">if</span>&nbsp;<span class="ident" id="6403776">quality</span>&nbsp;<span class="op" id="6403784">&gt;</span>&nbsp;<span class="num" id="6403786">100</span>&nbsp;<span class="op" id="6403790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403795">quality</span>&nbsp;<span class="op" id="6403803">=</span>&nbsp;<span class="num" id="6403805">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403817">//&nbsp;Convert&nbsp;from&nbsp;a&nbsp;quality&nbsp;rating&nbsp;to&nbsp;a&nbsp;scaling&nbsp;factor.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403872">var</span>&nbsp;<span class="ident" id="6403876">scale</span>&nbsp;<span class="builtintype" id="6403882">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6403887">if</span>&nbsp;<span class="ident" id="6403890">quality</span>&nbsp;<span class="op" id="6403898">&lt;</span>&nbsp;<span class="num" id="6403900">50</span>&nbsp;<span class="op" id="6403903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403907">scale</span>&nbsp;<span class="op" id="6403913">=</span>&nbsp;<span class="num" id="6403915">5000</span>&nbsp;<span class="op" id="6403920">/</span>&nbsp;<span class="ident" id="6403922">quality</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403931">}</span>&nbsp;<span class="keyword" id="6403933">else</span>&nbsp;<span class="op" id="6403938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6403942">scale</span>&nbsp;<span class="op" id="6403948">=</span>&nbsp;<span class="num" id="6403950">200</span>&nbsp;<span class="op" id="6403954">-</span>&nbsp;<span class="ident" id="6403956">quality</span><span class="op" id="6403963">*</span><span class="num" id="6403964">2</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6403967">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6403970">//&nbsp;Initialize&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404010">for</span>&nbsp;<span class="ident" id="6404014">i</span>&nbsp;<span class="op" id="6404016">:=</span>&nbsp;<span class="keyword" id="6404019">range</span>&nbsp;<span class="ident" id="6404025">e</span><span class="op" id="6404026">.</span><span class="ident" id="6404027">quant</span>&nbsp;<span class="op" id="6404033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404037">for</span>&nbsp;<span class="ident" id="6404041">j</span>&nbsp;<span class="op" id="6404043">:=</span>&nbsp;<span class="keyword" id="6404046">range</span>&nbsp;<span class="ident" id="6404052">e</span><span class="op" id="6404053">.</span><span class="ident" id="6404054">quant</span><span class="op" id="6404059">[</span><span class="ident" id="6404060">i</span><span class="op" id="6404061">]</span>&nbsp;<span class="op" id="6404063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404068">x</span>&nbsp;<span class="op" id="6404070">:=</span>&nbsp;<span class="builtintype" id="6404073">int</span><span class="op" id="6404076">(</span><span class="ident" id="6404077">unscaledQuant</span><span class="op" id="6404090">[</span><span class="ident" id="6404091">i</span><span class="op" id="6404092">]</span><span class="op" id="6404093">[</span><span class="ident" id="6404094">j</span><span class="op" id="6404095">]</span><span class="op" id="6404096">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404101">x</span>&nbsp;<span class="op" id="6404103">=</span>&nbsp;<span class="op" id="6404105">(</span><span class="ident" id="6404106">x</span><span class="op" id="6404107">*</span><span class="ident" id="6404108">scale</span>&nbsp;<span class="op" id="6404114">+</span>&nbsp;<span class="num" id="6404116">50</span><span class="op" id="6404118">)</span>&nbsp;<span class="op" id="6404120">/</span>&nbsp;<span class="num" id="6404122">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404129">if</span>&nbsp;<span class="ident" id="6404132">x</span>&nbsp;<span class="op" id="6404134">&lt;</span>&nbsp;<span class="num" id="6404136">1</span>&nbsp;<span class="op" id="6404138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404144">x</span>&nbsp;<span class="op" id="6404146">=</span>&nbsp;<span class="num" id="6404148">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404153">}</span>&nbsp;<span class="keyword" id="6404155">else</span>&nbsp;<span class="keyword" id="6404160">if</span>&nbsp;<span class="ident" id="6404163">x</span>&nbsp;<span class="op" id="6404165">&gt;</span>&nbsp;<span class="num" id="6404167">255</span>&nbsp;<span class="op" id="6404171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404177">x</span>&nbsp;<span class="op" id="6404179">=</span>&nbsp;<span class="num" id="6404181">255</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404193">e</span><span class="op" id="6404194">.</span><span class="ident" id="6404195">quant</span><span class="op" id="6404200">[</span><span class="ident" id="6404201">i</span><span class="op" id="6404202">]</span><span class="op" id="6404203">[</span><span class="ident" id="6404204">j</span><span class="op" id="6404205">]</span>&nbsp;<span class="op" id="6404207">=</span>&nbsp;<span class="builtintype" id="6404209">uint8</span><span class="op" id="6404214">(</span><span class="ident" id="6404215">x</span><span class="op" id="6404216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404226">//&nbsp;Compute&nbsp;number&nbsp;of&nbsp;components&nbsp;based&nbsp;on&nbsp;input&nbsp;image&nbsp;type.</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404286">nComponent</span>&nbsp;<span class="op" id="6404297">:=</span>&nbsp;<span class="num" id="6404300">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404303">switch</span>&nbsp;<span class="ident" id="6404310">m</span><span class="op" id="6404311">.</span><span class="op" id="6404312">(</span><span class="keyword" id="6404313">type</span><span class="op" id="6404317">)</span>&nbsp;<span class="op" id="6404319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404322">//&nbsp;TODO(wathiede):&nbsp;switch&nbsp;on&nbsp;m.ColorModel()&nbsp;instead&nbsp;of&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404384">case</span>&nbsp;<span class="op" id="6404389">*</span><span class="ident" id="6404390">image</span><span class="op" id="6404395">.</span><span class="ident" id="6404396">Gray</span><span class="op" id="6404400">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404404">nComponent</span>&nbsp;<span class="op" id="6404415">=</span>&nbsp;<span class="num" id="6404417">1</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6404420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404423">//&nbsp;Write&nbsp;the&nbsp;Start&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404460">e</span><span class="op" id="6404461">.</span><span class="ident" id="6404462">buf</span><span class="op" id="6404465">[</span><span class="num" id="6404466">0</span><span class="op" id="6404467">]</span>&nbsp;<span class="op" id="6404469">=</span>&nbsp;<span class="num" id="6404471">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404477">e</span><span class="op" id="6404478">.</span><span class="ident" id="6404479">buf</span><span class="op" id="6404482">[</span><span class="num" id="6404483">1</span><span class="op" id="6404484">]</span>&nbsp;<span class="op" id="6404486">=</span>&nbsp;<span class="num" id="6404488">0xd8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404494">e</span><span class="op" id="6404495">.</span><span class="ident" id="6404496">write</span><span class="op" id="6404501">(</span><span class="ident" id="6404502">e</span><span class="op" id="6404503">.</span><span class="ident" id="6404504">buf</span><span class="op" id="6404507">[</span><span class="op" id="6404508">:</span><span class="num" id="6404509">2</span><span class="op" id="6404510">]</span><span class="op" id="6404511">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404514">//&nbsp;Write&nbsp;the&nbsp;quantization&nbsp;tables.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404549">e</span><span class="op" id="6404550">.</span><span class="ident" id="6404551">writeDQT</span><span class="op" id="6404559">(</span><span class="op" id="6404560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404563">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;dimensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404595">e</span><span class="op" id="6404596">.</span><span class="ident" id="6404597">writeSOF0</span><span class="op" id="6404606">(</span><span class="ident" id="6404607">b</span><span class="op" id="6404608">.</span><span class="ident" id="6404609">Size</span><span class="op" id="6404613">(</span><span class="op" id="6404614">)</span><span class="op" id="6404615">,</span>&nbsp;<span class="ident" id="6404617">nComponent</span><span class="op" id="6404627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404630">//&nbsp;Write&nbsp;the&nbsp;Huffman&nbsp;tables.</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404660">e</span><span class="op" id="6404661">.</span><span class="ident" id="6404662">writeDHT</span><span class="op" id="6404670">(</span><span class="ident" id="6404671">nComponent</span><span class="op" id="6404681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404684">//&nbsp;Write&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404710">e</span><span class="op" id="6404711">.</span><span class="ident" id="6404712">writeSOS</span><span class="op" id="6404720">(</span><span class="ident" id="6404721">m</span><span class="op" id="6404722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6404725">//&nbsp;Write&nbsp;the&nbsp;End&nbsp;Of&nbsp;Image&nbsp;marker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404760">e</span><span class="op" id="6404761">.</span><span class="ident" id="6404762">buf</span><span class="op" id="6404765">[</span><span class="num" id="6404766">0</span><span class="op" id="6404767">]</span>&nbsp;<span class="op" id="6404769">=</span>&nbsp;<span class="num" id="6404771">0xff</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404777">e</span><span class="op" id="6404778">.</span><span class="ident" id="6404779">buf</span><span class="op" id="6404782">[</span><span class="num" id="6404783">1</span><span class="op" id="6404784">]</span>&nbsp;<span class="op" id="6404786">=</span>&nbsp;<span class="num" id="6404788">0xd9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404794">e</span><span class="op" id="6404795">.</span><span class="ident" id="6404796">write</span><span class="op" id="6404801">(</span><span class="ident" id="6404802">e</span><span class="op" id="6404803">.</span><span class="ident" id="6404804">buf</span><span class="op" id="6404807">[</span><span class="op" id="6404808">:</span><span class="num" id="6404809">2</span><span class="op" id="6404810">]</span><span class="op" id="6404811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6404814">e</span><span class="op" id="6404815">.</span><span class="ident" id="6404816">flush</span><span class="op" id="6404821">(</span><span class="op" id="6404822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6404825">return</span>&nbsp;<span class="ident" id="6404832">e</span><span class="op" id="6404833">.</span><span class="ident" id="6404834">err</span><br>
<span class="lineno"></span><span class="op" id="6404838">}</span>
</div>
</body>
</html>
