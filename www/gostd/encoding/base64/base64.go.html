<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3323317">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3323372">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3323426">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3323477">//&nbsp;Package&nbsp;base64&nbsp;implements&nbsp;base64&nbsp;encoding&nbsp;as&nbsp;specified&nbsp;by&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3323548">package</span>&nbsp;<span class="ident" id="3323556">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3323564">import</span>&nbsp;<span class="op" id="3323571">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3323574">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3323583">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3323589">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3323600">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3323610">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="3323613">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encodings<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3323634">//&nbsp;An&nbsp;Encoding&nbsp;is&nbsp;a&nbsp;radix&nbsp;64&nbsp;encoding/decoding&nbsp;scheme,&nbsp;defined&nbsp;by&nbsp;a</span><br>
<span class="lineno">20</span><span class="comment" id="3323702">//&nbsp;64-character&nbsp;alphabet.&nbsp;&nbsp;The&nbsp;most&nbsp;common&nbsp;encoding&nbsp;is&nbsp;the&nbsp;&#34;base64&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3323770">//&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648&nbsp;and&nbsp;used&nbsp;in&nbsp;MIME&nbsp;(RFC&nbsp;2045)&nbsp;and&nbsp;PEM</span><br>
<span class="lineno"></span><span class="comment" id="3323838">//&nbsp;(RFC&nbsp;1421).&nbsp;&nbsp;RFC&nbsp;4648&nbsp;also&nbsp;defines&nbsp;an&nbsp;alternate&nbsp;encoding,&nbsp;which&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3323908">//&nbsp;the&nbsp;standard&nbsp;encoding&nbsp;with&nbsp;-&nbsp;and&nbsp;_&nbsp;substituted&nbsp;for&nbsp;+&nbsp;and&nbsp;/.</span><br>
<span class="lineno"></span><span class="keyword" id="3323971">type</span>&nbsp;<span class="ident" id="3323976">Encoding</span>&nbsp;<span class="keyword" id="3323985">struct</span>&nbsp;<span class="op" id="3323992">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3323995">encode</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3324005">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324013">decodeMap</span>&nbsp;<span class="op" id="3324023">[</span><span class="num" id="3324024">256</span><span class="op" id="3324027">]</span><span class="builtintype" id="3324028">byte</span><br>
<span class="lineno"></span><span class="op" id="3324033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3324036">const</span>&nbsp;<span class="ident" id="3324042">encodeStd</span>&nbsp;<span class="op" id="3324052">=</span>&nbsp;<span class="string" id="3324054">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#34;</span><br>
<span class="lineno">30</span><span class="keyword" id="3324121">const</span>&nbsp;<span class="ident" id="3324127">encodeURL</span>&nbsp;<span class="op" id="3324137">=</span>&nbsp;<span class="string" id="3324139">&#34;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3324207">//&nbsp;NewEncoding&nbsp;returns&nbsp;a&nbsp;new&nbsp;Encoding&nbsp;defined&nbsp;by&nbsp;the&nbsp;given&nbsp;alphabet,</span><br>
<span class="lineno"></span><span class="comment" id="3324276">//&nbsp;which&nbsp;must&nbsp;be&nbsp;a&nbsp;64-byte&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="3324311">func</span>&nbsp;<span class="ident" id="3324316">NewEncoding</span><span class="op" id="3324327">(</span><span class="ident" id="3324328">encoder</span>&nbsp;<span class="builtintype" id="3324336">string</span><span class="op" id="3324342">)</span>&nbsp;<span class="op" id="3324344">*</span><span class="ident" id="3324345">Encoding</span>&nbsp;<span class="op" id="3324354">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324357">e</span>&nbsp;<span class="op" id="3324359">:=</span>&nbsp;<span class="builtinfunc" id="3324362">new</span><span class="op" id="3324365">(</span><span class="ident" id="3324366">Encoding</span><span class="op" id="3324374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324377">e</span><span class="op" id="3324378">.</span><span class="ident" id="3324379">encode</span>&nbsp;<span class="op" id="3324386">=</span>&nbsp;<span class="ident" id="3324388">encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324397">for</span>&nbsp;<span class="ident" id="3324401">i</span>&nbsp;<span class="op" id="3324403">:=</span>&nbsp;<span class="num" id="3324406">0</span><span class="op" id="3324407">;</span>&nbsp;<span class="ident" id="3324409">i</span>&nbsp;<span class="op" id="3324411">&lt;</span>&nbsp;<span class="builtinfunc" id="3324413">len</span><span class="op" id="3324416">(</span><span class="ident" id="3324417">e</span><span class="op" id="3324418">.</span><span class="ident" id="3324419">decodeMap</span><span class="op" id="3324428">)</span><span class="op" id="3324429">;</span>&nbsp;<span class="ident" id="3324431">i</span><span class="op" id="3324432">++</span>&nbsp;<span class="op" id="3324435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324439">e</span><span class="op" id="3324440">.</span><span class="ident" id="3324441">decodeMap</span><span class="op" id="3324450">[</span><span class="ident" id="3324451">i</span><span class="op" id="3324452">]</span>&nbsp;<span class="op" id="3324454">=</span>&nbsp;<span class="num" id="3324456">0xFF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324462">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324465">for</span>&nbsp;<span class="ident" id="3324469">i</span>&nbsp;<span class="op" id="3324471">:=</span>&nbsp;<span class="num" id="3324474">0</span><span class="op" id="3324475">;</span>&nbsp;<span class="ident" id="3324477">i</span>&nbsp;<span class="op" id="3324479">&lt;</span>&nbsp;<span class="builtinfunc" id="3324481">len</span><span class="op" id="3324484">(</span><span class="ident" id="3324485">encoder</span><span class="op" id="3324492">)</span><span class="op" id="3324493">;</span>&nbsp;<span class="ident" id="3324495">i</span><span class="op" id="3324496">++</span>&nbsp;<span class="op" id="3324499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3324503">e</span><span class="op" id="3324504">.</span><span class="ident" id="3324505">decodeMap</span><span class="op" id="3324514">[</span><span class="ident" id="3324515">encoder</span><span class="op" id="3324522">[</span><span class="ident" id="3324523">i</span><span class="op" id="3324524">]</span><span class="op" id="3324525">]</span>&nbsp;<span class="op" id="3324527">=</span>&nbsp;<span class="builtintype" id="3324529">byte</span><span class="op" id="3324533">(</span><span class="ident" id="3324534">i</span><span class="op" id="3324535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324541">return</span>&nbsp;<span class="ident" id="3324548">e</span><br>
<span class="lineno"></span><span class="op" id="3324550">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3324553">//&nbsp;StdEncoding&nbsp;is&nbsp;the&nbsp;standard&nbsp;base64&nbsp;encoding,&nbsp;as&nbsp;defined&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3324615">//&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="keyword" id="3324628">var</span>&nbsp;<span class="ident" id="3324632">StdEncoding</span>&nbsp;<span class="op" id="3324644">=</span>&nbsp;<span class="ident" id="3324646">NewEncoding</span><span class="op" id="3324657">(</span><span class="ident" id="3324658">encodeStd</span><span class="op" id="3324667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="3324670">//&nbsp;URLEncoding&nbsp;is&nbsp;the&nbsp;alternate&nbsp;base64&nbsp;encoding&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4648.</span><br>
<span class="lineno"></span><span class="comment" id="3324739">//&nbsp;It&nbsp;is&nbsp;typically&nbsp;used&nbsp;in&nbsp;URLs&nbsp;and&nbsp;file&nbsp;names.</span><br>
<span class="lineno"></span><span class="keyword" id="3324787">var</span>&nbsp;<span class="ident" id="3324791">URLEncoding</span>&nbsp;<span class="op" id="3324803">=</span>&nbsp;<span class="ident" id="3324805">NewEncoding</span><span class="op" id="3324816">(</span><span class="ident" id="3324817">encodeURL</span><span class="op" id="3324826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3324829">var</span>&nbsp;<span class="ident" id="3324833">removeNewlinesMapper</span>&nbsp;<span class="op" id="3324854">=</span>&nbsp;<span class="keyword" id="3324856">func</span><span class="op" id="3324860">(</span><span class="ident" id="3324861">r</span>&nbsp;<span class="builtintype" id="3324863">rune</span><span class="op" id="3324867">)</span>&nbsp;<span class="builtintype" id="3324869">rune</span>&nbsp;<span class="op" id="3324874">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324877">if</span>&nbsp;<span class="ident" id="3324880">r</span>&nbsp;<span class="op" id="3324882">==</span>&nbsp;<span class="string" id="3324885">&#39;\r&#39;</span>&nbsp;<span class="op" id="3324890">||</span>&nbsp;<span class="ident" id="3324893">r</span>&nbsp;<span class="op" id="3324895">==</span>&nbsp;<span class="string" id="3324898">&#39;\n&#39;</span>&nbsp;<span class="op" id="3324903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324907">return</span>&nbsp;<span class="op" id="3324914">-</span><span class="num" id="3324915">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3324918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3324921">return</span>&nbsp;<span class="ident" id="3324928">r</span><br>
<span class="lineno"></span><span class="op" id="3324930">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="3324933">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3324952">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc,&nbsp;writing</span><br>
<span class="lineno"></span><span class="comment" id="3325006">//&nbsp;EncodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst.</span><br>
<span class="lineno"></span><span class="comment" id="3325044">//</span><br>
<span class="lineno"></span><span class="comment" id="3325047">//&nbsp;The&nbsp;encoding&nbsp;pads&nbsp;the&nbsp;output&nbsp;to&nbsp;a&nbsp;multiple&nbsp;of&nbsp;4&nbsp;bytes,</span><br>
<span class="lineno"></span><span class="comment" id="3325105">//&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on&nbsp;individual&nbsp;blocks</span><br>
<span class="lineno">70</span><span class="comment" id="3325166">//&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3325220">func</span>&nbsp;<span class="op" id="3325225">(</span><span class="ident" id="3325226">enc</span>&nbsp;<span class="op" id="3325230">*</span><span class="ident" id="3325231">Encoding</span><span class="op" id="3325239">)</span>&nbsp;<span class="ident" id="3325241">Encode</span><span class="op" id="3325247">(</span><span class="ident" id="3325248">dst</span><span class="op" id="3325251">,</span>&nbsp;<span class="ident" id="3325253">src</span>&nbsp;<span class="op" id="3325257">[</span><span class="op" id="3325258">]</span><span class="builtintype" id="3325259">byte</span><span class="op" id="3325263">)</span>&nbsp;<span class="op" id="3325265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325268">if</span>&nbsp;<span class="builtinfunc" id="3325271">len</span><span class="op" id="3325274">(</span><span class="ident" id="3325275">src</span><span class="op" id="3325278">)</span>&nbsp;<span class="op" id="3325280">==</span>&nbsp;<span class="num" id="3325283">0</span>&nbsp;<span class="op" id="3325285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325289">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325297">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325301">for</span>&nbsp;<span class="builtinfunc" id="3325305">len</span><span class="op" id="3325308">(</span><span class="ident" id="3325309">src</span><span class="op" id="3325312">)</span>&nbsp;<span class="op" id="3325314">&gt;</span>&nbsp;<span class="num" id="3325316">0</span>&nbsp;<span class="op" id="3325318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325322">var</span>&nbsp;<span class="ident" id="3325326">b0</span><span class="op" id="3325328">,</span>&nbsp;<span class="ident" id="3325330">b1</span><span class="op" id="3325332">,</span>&nbsp;<span class="ident" id="3325334">b2</span><span class="op" id="3325336">,</span>&nbsp;<span class="ident" id="3325338">b3</span>&nbsp;<span class="builtintype" id="3325341">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3325349">//&nbsp;Unpack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;a&nbsp;4&nbsp;byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3325398">//&nbsp;destination&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325423">switch</span>&nbsp;<span class="builtinfunc" id="3325430">len</span><span class="op" id="3325433">(</span><span class="ident" id="3325434">src</span><span class="op" id="3325437">)</span>&nbsp;<span class="op" id="3325439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325443">default</span><span class="op" id="3325450">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325455">b3</span>&nbsp;<span class="op" id="3325458">=</span>&nbsp;<span class="ident" id="3325460">src</span><span class="op" id="3325463">[</span><span class="num" id="3325464">2</span><span class="op" id="3325465">]</span>&nbsp;<span class="op" id="3325467">&amp;</span>&nbsp;<span class="num" id="3325469">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325477">b2</span>&nbsp;<span class="op" id="3325480">=</span>&nbsp;<span class="ident" id="3325482">src</span><span class="op" id="3325485">[</span><span class="num" id="3325486">2</span><span class="op" id="3325487">]</span>&nbsp;<span class="op" id="3325489">&gt;&gt;</span>&nbsp;<span class="num" id="3325492">6</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325497">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325511">case</span>&nbsp;<span class="num" id="3325516">2</span><span class="op" id="3325517">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325522">b2</span>&nbsp;<span class="op" id="3325525">|=</span>&nbsp;<span class="op" id="3325528">(</span><span class="ident" id="3325529">src</span><span class="op" id="3325532">[</span><span class="num" id="3325533">1</span><span class="op" id="3325534">]</span>&nbsp;<span class="op" id="3325536">&lt;&lt;</span>&nbsp;<span class="num" id="3325539">2</span><span class="op" id="3325540">)</span>&nbsp;<span class="op" id="3325542">&amp;</span>&nbsp;<span class="num" id="3325544">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325552">b1</span>&nbsp;<span class="op" id="3325555">=</span>&nbsp;<span class="ident" id="3325557">src</span><span class="op" id="3325560">[</span><span class="num" id="3325561">1</span><span class="op" id="3325562">]</span>&nbsp;<span class="op" id="3325564">&gt;&gt;</span>&nbsp;<span class="num" id="3325567">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325572">fallthrough</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325586">case</span>&nbsp;<span class="num" id="3325591">1</span><span class="op" id="3325592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325597">b1</span>&nbsp;<span class="op" id="3325600">|=</span>&nbsp;<span class="op" id="3325603">(</span><span class="ident" id="3325604">src</span><span class="op" id="3325607">[</span><span class="num" id="3325608">0</span><span class="op" id="3325609">]</span>&nbsp;<span class="op" id="3325611">&lt;&lt;</span>&nbsp;<span class="num" id="3325614">4</span><span class="op" id="3325615">)</span>&nbsp;<span class="op" id="3325617">&amp;</span>&nbsp;<span class="num" id="3325619">0x3F</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325627">b0</span>&nbsp;<span class="op" id="3325630">=</span>&nbsp;<span class="ident" id="3325632">src</span><span class="op" id="3325635">[</span><span class="num" id="3325636">0</span><span class="op" id="3325637">]</span>&nbsp;<span class="op" id="3325639">&gt;&gt;</span>&nbsp;<span class="num" id="3325642">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3325651">//&nbsp;Encode&nbsp;6-bit&nbsp;blocks&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325702">dst</span><span class="op" id="3325705">[</span><span class="num" id="3325706">0</span><span class="op" id="3325707">]</span>&nbsp;<span class="op" id="3325709">=</span>&nbsp;<span class="ident" id="3325711">enc</span><span class="op" id="3325714">.</span><span class="ident" id="3325715">encode</span><span class="op" id="3325721">[</span><span class="ident" id="3325722">b0</span><span class="op" id="3325724">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325728">dst</span><span class="op" id="3325731">[</span><span class="num" id="3325732">1</span><span class="op" id="3325733">]</span>&nbsp;<span class="op" id="3325735">=</span>&nbsp;<span class="ident" id="3325737">enc</span><span class="op" id="3325740">.</span><span class="ident" id="3325741">encode</span><span class="op" id="3325747">[</span><span class="ident" id="3325748">b1</span><span class="op" id="3325750">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325754">dst</span><span class="op" id="3325757">[</span><span class="num" id="3325758">2</span><span class="op" id="3325759">]</span>&nbsp;<span class="op" id="3325761">=</span>&nbsp;<span class="ident" id="3325763">enc</span><span class="op" id="3325766">.</span><span class="ident" id="3325767">encode</span><span class="op" id="3325773">[</span><span class="ident" id="3325774">b2</span><span class="op" id="3325776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325780">dst</span><span class="op" id="3325783">[</span><span class="num" id="3325784">3</span><span class="op" id="3325785">]</span>&nbsp;<span class="op" id="3325787">=</span>&nbsp;<span class="ident" id="3325789">enc</span><span class="op" id="3325792">.</span><span class="ident" id="3325793">encode</span><span class="op" id="3325799">[</span><span class="ident" id="3325800">b3</span><span class="op" id="3325802">]</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3325807">//&nbsp;Pad&nbsp;the&nbsp;final&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325834">if</span>&nbsp;<span class="builtinfunc" id="3325837">len</span><span class="op" id="3325840">(</span><span class="ident" id="3325841">src</span><span class="op" id="3325844">)</span>&nbsp;<span class="op" id="3325846">&lt;</span>&nbsp;<span class="num" id="3325848">3</span>&nbsp;<span class="op" id="3325850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325855">dst</span><span class="op" id="3325858">[</span><span class="num" id="3325859">3</span><span class="op" id="3325860">]</span>&nbsp;<span class="op" id="3325862">=</span>&nbsp;<span class="string" id="3325864">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325871">if</span>&nbsp;<span class="builtinfunc" id="3325874">len</span><span class="op" id="3325877">(</span><span class="ident" id="3325878">src</span><span class="op" id="3325881">)</span>&nbsp;<span class="op" id="3325883">&lt;</span>&nbsp;<span class="num" id="3325885">2</span>&nbsp;<span class="op" id="3325887">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325893">dst</span><span class="op" id="3325896">[</span><span class="num" id="3325897">2</span><span class="op" id="3325898">]</span>&nbsp;<span class="op" id="3325900">=</span>&nbsp;<span class="string" id="3325902">&#39;=&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3325914">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325927">src</span>&nbsp;<span class="op" id="3325931">=</span>&nbsp;<span class="ident" id="3325933">src</span><span class="op" id="3325936">[</span><span class="num" id="3325937">3</span><span class="op" id="3325938">:</span><span class="op" id="3325939">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3325943">dst</span>&nbsp;<span class="op" id="3325947">=</span>&nbsp;<span class="ident" id="3325949">dst</span><span class="op" id="3325952">[</span><span class="num" id="3325953">4</span><span class="op" id="3325954">:</span><span class="op" id="3325955">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3325958">}</span><br>
<span class="lineno"></span><span class="op" id="3325960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="3325963">//&nbsp;EncodeToString&nbsp;returns&nbsp;the&nbsp;base64&nbsp;encoding&nbsp;of&nbsp;src.</span><br>
<span class="lineno"></span><span class="keyword" id="3326017">func</span>&nbsp;<span class="op" id="3326022">(</span><span class="ident" id="3326023">enc</span>&nbsp;<span class="op" id="3326027">*</span><span class="ident" id="3326028">Encoding</span><span class="op" id="3326036">)</span>&nbsp;<span class="ident" id="3326038">EncodeToString</span><span class="op" id="3326052">(</span><span class="ident" id="3326053">src</span>&nbsp;<span class="op" id="3326057">[</span><span class="op" id="3326058">]</span><span class="builtintype" id="3326059">byte</span><span class="op" id="3326063">)</span>&nbsp;<span class="builtintype" id="3326065">string</span>&nbsp;<span class="op" id="3326072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326075">buf</span>&nbsp;<span class="op" id="3326079">:=</span>&nbsp;<span class="builtinfunc" id="3326082">make</span><span class="op" id="3326086">(</span><span class="op" id="3326087">[</span><span class="op" id="3326088">]</span><span class="builtintype" id="3326089">byte</span><span class="op" id="3326093">,</span>&nbsp;<span class="ident" id="3326095">enc</span><span class="op" id="3326098">.</span><span class="ident" id="3326099">EncodedLen</span><span class="op" id="3326109">(</span><span class="builtinfunc" id="3326110">len</span><span class="op" id="3326113">(</span><span class="ident" id="3326114">src</span><span class="op" id="3326117">)</span><span class="op" id="3326118">)</span><span class="op" id="3326119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326122">enc</span><span class="op" id="3326125">.</span><span class="ident" id="3326126">Encode</span><span class="op" id="3326132">(</span><span class="ident" id="3326133">buf</span><span class="op" id="3326136">,</span>&nbsp;<span class="ident" id="3326138">src</span><span class="op" id="3326141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326144">return</span>&nbsp;<span class="builtintype" id="3326151">string</span><span class="op" id="3326157">(</span><span class="ident" id="3326158">buf</span><span class="op" id="3326161">)</span><br>
<span class="lineno">120</span><span class="op" id="3326163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3326166">type</span>&nbsp;<span class="ident" id="3326171">encoder</span>&nbsp;<span class="keyword" id="3326179">struct</span>&nbsp;<span class="op" id="3326186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326189">err</span>&nbsp;&nbsp;<span class="builtintype" id="3326194">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326201">enc</span>&nbsp;&nbsp;<span class="op" id="3326206">*</span><span class="ident" id="3326207">Encoding</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326217">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3326222">io</span><span class="op" id="3326224">.</span><span class="ident" id="3326225">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326233">buf</span>&nbsp;&nbsp;<span class="op" id="3326238">[</span><span class="num" id="3326239">3</span><span class="op" id="3326240">]</span><span class="builtintype" id="3326241">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3326249">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326289">nbuf</span>&nbsp;<span class="builtintype" id="3326294">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3326305">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326332">out</span>&nbsp;&nbsp;<span class="op" id="3326337">[</span><span class="num" id="3326338">1024</span><span class="op" id="3326342">]</span><span class="builtintype" id="3326343">byte</span>&nbsp;<span class="comment" id="3326348">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="3326365">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="3326368">func</span>&nbsp;<span class="op" id="3326373">(</span><span class="ident" id="3326374">e</span>&nbsp;<span class="op" id="3326376">*</span><span class="ident" id="3326377">encoder</span><span class="op" id="3326384">)</span>&nbsp;<span class="ident" id="3326386">Write</span><span class="op" id="3326391">(</span><span class="ident" id="3326392">p</span>&nbsp;<span class="op" id="3326394">[</span><span class="op" id="3326395">]</span><span class="builtintype" id="3326396">byte</span><span class="op" id="3326400">)</span>&nbsp;<span class="op" id="3326402">(</span><span class="ident" id="3326403">n</span>&nbsp;<span class="builtintype" id="3326405">int</span><span class="op" id="3326408">,</span>&nbsp;<span class="ident" id="3326410">err</span>&nbsp;<span class="builtintype" id="3326414">error</span><span class="op" id="3326419">)</span>&nbsp;<span class="op" id="3326421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326424">if</span>&nbsp;<span class="ident" id="3326427">e</span><span class="op" id="3326428">.</span><span class="ident" id="3326429">err</span>&nbsp;<span class="op" id="3326433">!=</span>&nbsp;<span class="ident" id="3326436">nil</span>&nbsp;<span class="op" id="3326440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326444">return</span>&nbsp;<span class="num" id="3326451">0</span><span class="op" id="3326452">,</span>&nbsp;<span class="ident" id="3326454">e</span><span class="op" id="3326455">.</span><span class="ident" id="3326456">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326461">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3326465">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326485">if</span>&nbsp;<span class="ident" id="3326488">e</span><span class="op" id="3326489">.</span><span class="ident" id="3326490">nbuf</span>&nbsp;<span class="op" id="3326495">&gt;</span>&nbsp;<span class="num" id="3326497">0</span>&nbsp;<span class="op" id="3326499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326503">var</span>&nbsp;<span class="ident" id="3326507">i</span>&nbsp;<span class="builtintype" id="3326509">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326515">for</span>&nbsp;<span class="ident" id="3326519">i</span>&nbsp;<span class="op" id="3326521">=</span>&nbsp;<span class="num" id="3326523">0</span><span class="op" id="3326524">;</span>&nbsp;<span class="ident" id="3326526">i</span>&nbsp;<span class="op" id="3326528">&lt;</span>&nbsp;<span class="builtinfunc" id="3326530">len</span><span class="op" id="3326533">(</span><span class="ident" id="3326534">p</span><span class="op" id="3326535">)</span>&nbsp;<span class="op" id="3326537">&amp;&amp;</span>&nbsp;<span class="ident" id="3326540">e</span><span class="op" id="3326541">.</span><span class="ident" id="3326542">nbuf</span>&nbsp;<span class="op" id="3326547">&lt;</span>&nbsp;<span class="num" id="3326549">3</span><span class="op" id="3326550">;</span>&nbsp;<span class="ident" id="3326552">i</span><span class="op" id="3326553">++</span>&nbsp;<span class="op" id="3326556">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326561">e</span><span class="op" id="3326562">.</span><span class="ident" id="3326563">buf</span><span class="op" id="3326566">[</span><span class="ident" id="3326567">e</span><span class="op" id="3326568">.</span><span class="ident" id="3326569">nbuf</span><span class="op" id="3326573">]</span>&nbsp;<span class="op" id="3326575">=</span>&nbsp;<span class="ident" id="3326577">p</span><span class="op" id="3326578">[</span><span class="ident" id="3326579">i</span><span class="op" id="3326580">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326585">e</span><span class="op" id="3326586">.</span><span class="ident" id="3326587">nbuf</span><span class="op" id="3326591">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326600">n</span>&nbsp;<span class="op" id="3326602">+=</span>&nbsp;<span class="ident" id="3326605">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326609">p</span>&nbsp;<span class="op" id="3326611">=</span>&nbsp;<span class="ident" id="3326613">p</span><span class="op" id="3326614">[</span><span class="ident" id="3326615">i</span><span class="op" id="3326616">:</span><span class="op" id="3326617">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326621">if</span>&nbsp;<span class="ident" id="3326624">e</span><span class="op" id="3326625">.</span><span class="ident" id="3326626">nbuf</span>&nbsp;<span class="op" id="3326631">&lt;</span>&nbsp;<span class="num" id="3326633">3</span>&nbsp;<span class="op" id="3326635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326640">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326649">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326653">e</span><span class="op" id="3326654">.</span><span class="ident" id="3326655">enc</span><span class="op" id="3326658">.</span><span class="ident" id="3326659">Encode</span><span class="op" id="3326665">(</span><span class="ident" id="3326666">e</span><span class="op" id="3326667">.</span><span class="ident" id="3326668">out</span><span class="op" id="3326671">[</span><span class="num" id="3326672">0</span><span class="op" id="3326673">:</span><span class="op" id="3326674">]</span><span class="op" id="3326675">,</span>&nbsp;<span class="ident" id="3326677">e</span><span class="op" id="3326678">.</span><span class="ident" id="3326679">buf</span><span class="op" id="3326682">[</span><span class="num" id="3326683">0</span><span class="op" id="3326684">:</span><span class="op" id="3326685">]</span><span class="op" id="3326686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326690">if</span>&nbsp;<span class="ident" id="3326693">_</span><span class="op" id="3326694">,</span>&nbsp;<span class="ident" id="3326696">e</span><span class="op" id="3326697">.</span><span class="ident" id="3326698">err</span>&nbsp;<span class="op" id="3326702">=</span>&nbsp;<span class="ident" id="3326704">e</span><span class="op" id="3326705">.</span><span class="ident" id="3326706">w</span><span class="op" id="3326707">.</span><span class="ident" id="3326708">Write</span><span class="op" id="3326713">(</span><span class="ident" id="3326714">e</span><span class="op" id="3326715">.</span><span class="ident" id="3326716">out</span><span class="op" id="3326719">[</span><span class="num" id="3326720">0</span><span class="op" id="3326721">:</span><span class="num" id="3326722">4</span><span class="op" id="3326723">]</span><span class="op" id="3326724">)</span><span class="op" id="3326725">;</span>&nbsp;<span class="ident" id="3326727">e</span><span class="op" id="3326728">.</span><span class="ident" id="3326729">err</span>&nbsp;<span class="op" id="3326733">!=</span>&nbsp;<span class="ident" id="3326736">nil</span>&nbsp;<span class="op" id="3326740">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326745">return</span>&nbsp;<span class="ident" id="3326752">n</span><span class="op" id="3326753">,</span>&nbsp;<span class="ident" id="3326755">e</span><span class="op" id="3326756">.</span><span class="ident" id="3326757">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326767">e</span><span class="op" id="3326768">.</span><span class="ident" id="3326769">nbuf</span>&nbsp;<span class="op" id="3326774">=</span>&nbsp;<span class="num" id="3326776">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326779">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3326783">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326810">for</span>&nbsp;<span class="builtinfunc" id="3326814">len</span><span class="op" id="3326817">(</span><span class="ident" id="3326818">p</span><span class="op" id="3326819">)</span>&nbsp;<span class="op" id="3326821">&gt;=</span>&nbsp;<span class="num" id="3326824">3</span>&nbsp;<span class="op" id="3326826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326830">nn</span>&nbsp;<span class="op" id="3326833">:=</span>&nbsp;<span class="builtinfunc" id="3326836">len</span><span class="op" id="3326839">(</span><span class="ident" id="3326840">e</span><span class="op" id="3326841">.</span><span class="ident" id="3326842">out</span><span class="op" id="3326845">)</span>&nbsp;<span class="op" id="3326847">/</span>&nbsp;<span class="num" id="3326849">4</span>&nbsp;<span class="op" id="3326851">*</span>&nbsp;<span class="num" id="3326853">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326857">if</span>&nbsp;<span class="ident" id="3326860">nn</span>&nbsp;<span class="op" id="3326863">&gt;</span>&nbsp;<span class="builtinfunc" id="3326865">len</span><span class="op" id="3326868">(</span><span class="ident" id="3326869">p</span><span class="op" id="3326870">)</span>&nbsp;<span class="op" id="3326872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326877">nn</span>&nbsp;<span class="op" id="3326880">=</span>&nbsp;<span class="builtinfunc" id="3326882">len</span><span class="op" id="3326885">(</span><span class="ident" id="3326886">p</span><span class="op" id="3326887">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326892">nn</span>&nbsp;<span class="op" id="3326895">-=</span>&nbsp;<span class="ident" id="3326898">nn</span>&nbsp;<span class="op" id="3326901">%</span>&nbsp;<span class="num" id="3326903">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3326907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3326911">e</span><span class="op" id="3326912">.</span><span class="ident" id="3326913">enc</span><span class="op" id="3326916">.</span><span class="ident" id="3326917">Encode</span><span class="op" id="3326923">(</span><span class="ident" id="3326924">e</span><span class="op" id="3326925">.</span><span class="ident" id="3326926">out</span><span class="op" id="3326929">[</span><span class="num" id="3326930">0</span><span class="op" id="3326931">:</span><span class="op" id="3326932">]</span><span class="op" id="3326933">,</span>&nbsp;<span class="ident" id="3326935">p</span><span class="op" id="3326936">[</span><span class="num" id="3326937">0</span><span class="op" id="3326938">:</span><span class="ident" id="3326939">nn</span><span class="op" id="3326941">]</span><span class="op" id="3326942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3326946">if</span>&nbsp;<span class="ident" id="3326949">_</span><span class="op" id="3326950">,</span>&nbsp;<span class="ident" id="3326952">e</span><span class="op" id="3326953">.</span><span class="ident" id="3326954">err</span>&nbsp;<span class="op" id="3326958">=</span>&nbsp;<span class="ident" id="3326960">e</span><span class="op" id="3326961">.</span><span class="ident" id="3326962">w</span><span class="op" id="3326963">.</span><span class="ident" id="3326964">Write</span><span class="op" id="3326969">(</span><span class="ident" id="3326970">e</span><span class="op" id="3326971">.</span><span class="ident" id="3326972">out</span><span class="op" id="3326975">[</span><span class="num" id="3326976">0</span>&nbsp;<span class="op" id="3326978">:</span>&nbsp;<span class="ident" id="3326980">nn</span><span class="op" id="3326982">/</span><span class="num" id="3326983">3</span><span class="op" id="3326984">*</span><span class="num" id="3326985">4</span><span class="op" id="3326986">]</span><span class="op" id="3326987">)</span><span class="op" id="3326988">;</span>&nbsp;<span class="ident" id="3326990">e</span><span class="op" id="3326991">.</span><span class="ident" id="3326992">err</span>&nbsp;<span class="op" id="3326996">!=</span>&nbsp;<span class="ident" id="3326999">nil</span>&nbsp;<span class="op" id="3327003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327008">return</span>&nbsp;<span class="ident" id="3327015">n</span><span class="op" id="3327016">,</span>&nbsp;<span class="ident" id="3327018">e</span><span class="op" id="3327019">.</span><span class="ident" id="3327020">err</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327030">n</span>&nbsp;<span class="op" id="3327032">+=</span>&nbsp;<span class="ident" id="3327035">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327040">p</span>&nbsp;<span class="op" id="3327042">=</span>&nbsp;<span class="ident" id="3327044">p</span><span class="op" id="3327045">[</span><span class="ident" id="3327046">nn</span><span class="op" id="3327048">:</span><span class="op" id="3327049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3327056">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327077">for</span>&nbsp;<span class="ident" id="3327081">i</span>&nbsp;<span class="op" id="3327083">:=</span>&nbsp;<span class="num" id="3327086">0</span><span class="op" id="3327087">;</span>&nbsp;<span class="ident" id="3327089">i</span>&nbsp;<span class="op" id="3327091">&lt;</span>&nbsp;<span class="builtinfunc" id="3327093">len</span><span class="op" id="3327096">(</span><span class="ident" id="3327097">p</span><span class="op" id="3327098">)</span><span class="op" id="3327099">;</span>&nbsp;<span class="ident" id="3327101">i</span><span class="op" id="3327102">++</span>&nbsp;<span class="op" id="3327105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327109">e</span><span class="op" id="3327110">.</span><span class="ident" id="3327111">buf</span><span class="op" id="3327114">[</span><span class="ident" id="3327115">i</span><span class="op" id="3327116">]</span>&nbsp;<span class="op" id="3327118">=</span>&nbsp;<span class="ident" id="3327120">p</span><span class="op" id="3327121">[</span><span class="ident" id="3327122">i</span><span class="op" id="3327123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327129">e</span><span class="op" id="3327130">.</span><span class="ident" id="3327131">nbuf</span>&nbsp;<span class="op" id="3327136">=</span>&nbsp;<span class="builtinfunc" id="3327138">len</span><span class="op" id="3327141">(</span><span class="ident" id="3327142">p</span><span class="op" id="3327143">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327146">n</span>&nbsp;<span class="op" id="3327148">+=</span>&nbsp;<span class="builtinfunc" id="3327151">len</span><span class="op" id="3327154">(</span><span class="ident" id="3327155">p</span><span class="op" id="3327156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327159">return</span><br>
<span class="lineno"></span><span class="op" id="3327166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3327169">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno">180</span><span class="comment" id="3327223">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3327276">func</span>&nbsp;<span class="op" id="3327281">(</span><span class="ident" id="3327282">e</span>&nbsp;<span class="op" id="3327284">*</span><span class="ident" id="3327285">encoder</span><span class="op" id="3327292">)</span>&nbsp;<span class="ident" id="3327294">Close</span><span class="op" id="3327299">(</span><span class="op" id="3327300">)</span>&nbsp;<span class="builtintype" id="3327302">error</span>&nbsp;<span class="op" id="3327308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3327311">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327368">if</span>&nbsp;<span class="ident" id="3327371">e</span><span class="op" id="3327372">.</span><span class="ident" id="3327373">err</span>&nbsp;<span class="op" id="3327377">==</span>&nbsp;<span class="ident" id="3327380">nil</span>&nbsp;<span class="op" id="3327384">&amp;&amp;</span>&nbsp;<span class="ident" id="3327387">e</span><span class="op" id="3327388">.</span><span class="ident" id="3327389">nbuf</span>&nbsp;<span class="op" id="3327394">&gt;</span>&nbsp;<span class="num" id="3327396">0</span>&nbsp;<span class="op" id="3327398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327402">e</span><span class="op" id="3327403">.</span><span class="ident" id="3327404">enc</span><span class="op" id="3327407">.</span><span class="ident" id="3327408">Encode</span><span class="op" id="3327414">(</span><span class="ident" id="3327415">e</span><span class="op" id="3327416">.</span><span class="ident" id="3327417">out</span><span class="op" id="3327420">[</span><span class="num" id="3327421">0</span><span class="op" id="3327422">:</span><span class="op" id="3327423">]</span><span class="op" id="3327424">,</span>&nbsp;<span class="ident" id="3327426">e</span><span class="op" id="3327427">.</span><span class="ident" id="3327428">buf</span><span class="op" id="3327431">[</span><span class="num" id="3327432">0</span><span class="op" id="3327433">:</span><span class="ident" id="3327434">e</span><span class="op" id="3327435">.</span><span class="ident" id="3327436">nbuf</span><span class="op" id="3327440">]</span><span class="op" id="3327441">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327445">e</span><span class="op" id="3327446">.</span><span class="ident" id="3327447">nbuf</span>&nbsp;<span class="op" id="3327452">=</span>&nbsp;<span class="num" id="3327454">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3327458">_</span><span class="op" id="3327459">,</span>&nbsp;<span class="ident" id="3327461">e</span><span class="op" id="3327462">.</span><span class="ident" id="3327463">err</span>&nbsp;<span class="op" id="3327467">=</span>&nbsp;<span class="ident" id="3327469">e</span><span class="op" id="3327470">.</span><span class="ident" id="3327471">w</span><span class="op" id="3327472">.</span><span class="ident" id="3327473">Write</span><span class="op" id="3327478">(</span><span class="ident" id="3327479">e</span><span class="op" id="3327480">.</span><span class="ident" id="3327481">out</span><span class="op" id="3327484">[</span><span class="num" id="3327485">0</span><span class="op" id="3327486">:</span><span class="num" id="3327487">4</span><span class="op" id="3327488">]</span><span class="op" id="3327489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3327492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327495">return</span>&nbsp;<span class="ident" id="3327502">e</span><span class="op" id="3327503">.</span><span class="ident" id="3327504">err</span><br>
<span class="lineno"></span><span class="op" id="3327508">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="comment" id="3327511">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3327579">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;using&nbsp;enc&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="3327651">//&nbsp;Base64&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;4-byte&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="3327711">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno">195</span><span class="comment" id="3327779">//&nbsp;partially&nbsp;written&nbsp;blocks.</span><br>
<span class="lineno"></span><span class="keyword" id="3327808">func</span>&nbsp;<span class="ident" id="3327813">NewEncoder</span><span class="op" id="3327823">(</span><span class="ident" id="3327824">enc</span>&nbsp;<span class="op" id="3327828">*</span><span class="ident" id="3327829">Encoding</span><span class="op" id="3327837">,</span>&nbsp;<span class="ident" id="3327839">w</span>&nbsp;<span class="ident" id="3327841">io</span><span class="op" id="3327843">.</span><span class="ident" id="3327844">Writer</span><span class="op" id="3327850">)</span>&nbsp;<span class="ident" id="3327852">io</span><span class="op" id="3327854">.</span><span class="ident" id="3327855">WriteCloser</span>&nbsp;<span class="op" id="3327867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3327870">return</span>&nbsp;<span class="op" id="3327877">&amp;</span><span class="ident" id="3327878">encoder</span><span class="op" id="3327885">{</span><span class="ident" id="3327886">enc</span><span class="op" id="3327889">:</span>&nbsp;<span class="ident" id="3327891">enc</span><span class="op" id="3327894">,</span>&nbsp;<span class="ident" id="3327896">w</span><span class="op" id="3327897">:</span>&nbsp;<span class="ident" id="3327899">w</span><span class="op" id="3327900">}</span><br>
<span class="lineno"></span><span class="op" id="3327902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3327905">//&nbsp;EncodedLen&nbsp;returns&nbsp;the&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;base64&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="3327970">//&nbsp;of&nbsp;an&nbsp;input&nbsp;buffer&nbsp;of&nbsp;length&nbsp;n.</span><br>
<span class="lineno"></span><span class="keyword" id="3328005">func</span>&nbsp;<span class="op" id="3328010">(</span><span class="ident" id="3328011">enc</span>&nbsp;<span class="op" id="3328015">*</span><span class="ident" id="3328016">Encoding</span><span class="op" id="3328024">)</span>&nbsp;<span class="ident" id="3328026">EncodedLen</span><span class="op" id="3328036">(</span><span class="ident" id="3328037">n</span>&nbsp;<span class="builtintype" id="3328039">int</span><span class="op" id="3328042">)</span>&nbsp;<span class="builtintype" id="3328044">int</span>&nbsp;<span class="op" id="3328048">{</span>&nbsp;<span class="keyword" id="3328050">return</span>&nbsp;<span class="op" id="3328057">(</span><span class="ident" id="3328058">n</span>&nbsp;<span class="op" id="3328060">+</span>&nbsp;<span class="num" id="3328062">2</span><span class="op" id="3328063">)</span>&nbsp;<span class="op" id="3328065">/</span>&nbsp;<span class="num" id="3328067">3</span>&nbsp;<span class="op" id="3328069">*</span>&nbsp;<span class="num" id="3328071">4</span>&nbsp;<span class="op" id="3328073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3328076">/*<br>
<span class="lineno">205</span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3328095">type</span>&nbsp;<span class="ident" id="3328100">CorruptInputError</span>&nbsp;<span class="ident" id="3328118">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3328125">func</span>&nbsp;<span class="op" id="3328130">(</span><span class="ident" id="3328131">e</span>&nbsp;<span class="ident" id="3328133">CorruptInputError</span><span class="op" id="3328150">)</span>&nbsp;<span class="ident" id="3328152">Error</span><span class="op" id="3328157">(</span><span class="op" id="3328158">)</span>&nbsp;<span class="builtintype" id="3328160">string</span>&nbsp;<span class="op" id="3328167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328170">return</span>&nbsp;<span class="string" id="3328177">&#34;illegal&nbsp;base64&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="3328214">+</span>&nbsp;<span class="ident" id="3328216">strconv</span><span class="op" id="3328223">.</span><span class="ident" id="3328224">FormatInt</span><span class="op" id="3328233">(</span><span class="ident" id="3328234">int64</span><span class="op" id="3328239">(</span><span class="ident" id="3328240">e</span><span class="op" id="3328241">)</span><span class="op" id="3328242">,</span>&nbsp;<span class="num" id="3328244">10</span><span class="op" id="3328246">)</span><br>
<span class="lineno"></span><span class="op" id="3328248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3328251">//&nbsp;decode&nbsp;is&nbsp;like&nbsp;Decode&nbsp;but&nbsp;returns&nbsp;an&nbsp;additional&nbsp;&#39;end&#39;&nbsp;value,&nbsp;which</span><br>
<span class="lineno">215</span><span class="comment" id="3328321">//&nbsp;indicates&nbsp;if&nbsp;end-of-message&nbsp;padding&nbsp;was&nbsp;encountered&nbsp;and&nbsp;thus&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="3328389">//&nbsp;additional&nbsp;data&nbsp;is&nbsp;an&nbsp;error.&nbsp;This&nbsp;method&nbsp;assumes&nbsp;that&nbsp;src&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span><span class="comment" id="3328459">//&nbsp;stripped&nbsp;of&nbsp;all&nbsp;supported&nbsp;whitespace&nbsp;(&#39;\r&#39;&nbsp;and&nbsp;&#39;\n&#39;).</span><br>
<span class="lineno"></span><span class="keyword" id="3328516">func</span>&nbsp;<span class="op" id="3328521">(</span><span class="ident" id="3328522">enc</span>&nbsp;<span class="op" id="3328526">*</span><span class="ident" id="3328527">Encoding</span><span class="op" id="3328535">)</span>&nbsp;<span class="ident" id="3328537">decode</span><span class="op" id="3328543">(</span><span class="ident" id="3328544">dst</span><span class="op" id="3328547">,</span>&nbsp;<span class="ident" id="3328549">src</span>&nbsp;<span class="op" id="3328553">[</span><span class="op" id="3328554">]</span><span class="builtintype" id="3328555">byte</span><span class="op" id="3328559">)</span>&nbsp;<span class="op" id="3328561">(</span><span class="ident" id="3328562">n</span>&nbsp;<span class="builtintype" id="3328564">int</span><span class="op" id="3328567">,</span>&nbsp;<span class="ident" id="3328569">end</span>&nbsp;<span class="builtintype" id="3328573">bool</span><span class="op" id="3328577">,</span>&nbsp;<span class="ident" id="3328579">err</span>&nbsp;<span class="builtintype" id="3328583">error</span><span class="op" id="3328588">)</span>&nbsp;<span class="op" id="3328590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328593">olen</span>&nbsp;<span class="op" id="3328598">:=</span>&nbsp;<span class="builtinfunc" id="3328601">len</span><span class="op" id="3328604">(</span><span class="ident" id="3328605">src</span><span class="op" id="3328608">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328611">for</span>&nbsp;<span class="builtinfunc" id="3328615">len</span><span class="op" id="3328618">(</span><span class="ident" id="3328619">src</span><span class="op" id="3328622">)</span>&nbsp;<span class="op" id="3328624">&gt;</span>&nbsp;<span class="num" id="3328626">0</span>&nbsp;<span class="op" id="3328628">&amp;&amp;</span>&nbsp;<span class="op" id="3328631">!</span><span class="ident" id="3328632">end</span>&nbsp;<span class="op" id="3328636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3328640">//&nbsp;Decode&nbsp;quantum&nbsp;using&nbsp;the&nbsp;base64&nbsp;alphabet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328686">var</span>&nbsp;<span class="ident" id="3328690">dbuf</span>&nbsp;<span class="op" id="3328695">[</span><span class="num" id="3328696">4</span><span class="op" id="3328697">]</span><span class="builtintype" id="3328698">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328705">dlen</span>&nbsp;<span class="op" id="3328710">:=</span>&nbsp;<span class="num" id="3328713">4</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328718">for</span>&nbsp;<span class="ident" id="3328722">j</span>&nbsp;<span class="op" id="3328724">:=</span>&nbsp;<span class="keyword" id="3328727">range</span>&nbsp;<span class="ident" id="3328733">dbuf</span>&nbsp;<span class="op" id="3328738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328743">if</span>&nbsp;<span class="builtinfunc" id="3328746">len</span><span class="op" id="3328749">(</span><span class="ident" id="3328750">src</span><span class="op" id="3328753">)</span>&nbsp;<span class="op" id="3328755">==</span>&nbsp;<span class="num" id="3328758">0</span>&nbsp;<span class="op" id="3328760">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328766">return</span>&nbsp;<span class="ident" id="3328773">n</span><span class="op" id="3328774">,</span>&nbsp;<span class="builtintype" id="3328776">false</span><span class="op" id="3328781">,</span>&nbsp;<span class="ident" id="3328783">CorruptInputError</span><span class="op" id="3328800">(</span><span class="ident" id="3328801">olen</span>&nbsp;<span class="op" id="3328806">-</span>&nbsp;<span class="builtinfunc" id="3328808">len</span><span class="op" id="3328811">(</span><span class="ident" id="3328812">src</span><span class="op" id="3328815">)</span>&nbsp;<span class="op" id="3328817">-</span>&nbsp;<span class="ident" id="3328819">j</span><span class="op" id="3328820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3328825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328830">in</span>&nbsp;<span class="op" id="3328833">:=</span>&nbsp;<span class="ident" id="3328836">src</span><span class="op" id="3328839">[</span><span class="num" id="3328840">0</span><span class="op" id="3328841">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3328846">src</span>&nbsp;<span class="op" id="3328850">=</span>&nbsp;<span class="ident" id="3328852">src</span><span class="op" id="3328855">[</span><span class="num" id="3328856">1</span><span class="op" id="3328857">:</span><span class="op" id="3328858">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328863">if</span>&nbsp;<span class="ident" id="3328866">in</span>&nbsp;<span class="op" id="3328869">==</span>&nbsp;<span class="string" id="3328872">&#39;=&#39;</span>&nbsp;<span class="op" id="3328876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3328882">//&nbsp;We&#39;ve&nbsp;reached&nbsp;the&nbsp;end&nbsp;and&nbsp;there&#39;s&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328931">switch</span>&nbsp;<span class="ident" id="3328938">j</span>&nbsp;<span class="op" id="3328940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328946">case</span>&nbsp;<span class="num" id="3328951">0</span><span class="op" id="3328952">,</span>&nbsp;<span class="num" id="3328954">1</span><span class="op" id="3328955">:</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3328962">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3328988">return</span>&nbsp;<span class="ident" id="3328995">n</span><span class="op" id="3328996">,</span>&nbsp;<span class="builtintype" id="3328998">false</span><span class="op" id="3329003">,</span>&nbsp;<span class="ident" id="3329005">CorruptInputError</span><span class="op" id="3329022">(</span><span class="ident" id="3329023">olen</span>&nbsp;<span class="op" id="3329028">-</span>&nbsp;<span class="builtinfunc" id="3329030">len</span><span class="op" id="3329033">(</span><span class="ident" id="3329034">src</span><span class="op" id="3329037">)</span>&nbsp;<span class="op" id="3329039">-</span>&nbsp;<span class="num" id="3329041">1</span><span class="op" id="3329042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329048">case</span>&nbsp;<span class="num" id="3329053">2</span><span class="op" id="3329054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329061">//&nbsp;&#34;==&#34;&nbsp;is&nbsp;expected,&nbsp;the&nbsp;first&nbsp;&#34;=&#34;&nbsp;is&nbsp;already&nbsp;consumed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329122">if</span>&nbsp;<span class="builtinfunc" id="3329125">len</span><span class="op" id="3329128">(</span><span class="ident" id="3329129">src</span><span class="op" id="3329132">)</span>&nbsp;<span class="op" id="3329134">==</span>&nbsp;<span class="num" id="3329137">0</span>&nbsp;<span class="op" id="3329139">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329147">//&nbsp;not&nbsp;enough&nbsp;padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329175">return</span>&nbsp;<span class="ident" id="3329182">n</span><span class="op" id="3329183">,</span>&nbsp;<span class="builtintype" id="3329185">false</span><span class="op" id="3329190">,</span>&nbsp;<span class="ident" id="3329192">CorruptInputError</span><span class="op" id="3329209">(</span><span class="ident" id="3329210">olen</span><span class="op" id="3329214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329228">if</span>&nbsp;<span class="ident" id="3329231">src</span><span class="op" id="3329234">[</span><span class="num" id="3329235">0</span><span class="op" id="3329236">]</span>&nbsp;<span class="op" id="3329238">!=</span>&nbsp;<span class="string" id="3329241">&#39;=&#39;</span>&nbsp;<span class="op" id="3329245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329253">//&nbsp;incorrect&nbsp;padding</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329280">return</span>&nbsp;<span class="ident" id="3329287">n</span><span class="op" id="3329288">,</span>&nbsp;<span class="builtintype" id="3329290">false</span><span class="op" id="3329295">,</span>&nbsp;<span class="ident" id="3329297">CorruptInputError</span><span class="op" id="3329314">(</span><span class="ident" id="3329315">olen</span>&nbsp;<span class="op" id="3329320">-</span>&nbsp;<span class="builtinfunc" id="3329322">len</span><span class="op" id="3329325">(</span><span class="ident" id="3329326">src</span><span class="op" id="3329329">)</span>&nbsp;<span class="op" id="3329331">-</span>&nbsp;<span class="num" id="3329333">1</span><span class="op" id="3329334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329348">src</span>&nbsp;<span class="op" id="3329352">=</span>&nbsp;<span class="ident" id="3329354">src</span><span class="op" id="3329357">[</span><span class="num" id="3329358">1</span><span class="op" id="3329359">:</span><span class="op" id="3329360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329372">if</span>&nbsp;<span class="builtinfunc" id="3329375">len</span><span class="op" id="3329378">(</span><span class="ident" id="3329379">src</span><span class="op" id="3329382">)</span>&nbsp;<span class="op" id="3329384">&gt;</span>&nbsp;<span class="num" id="3329386">0</span>&nbsp;<span class="op" id="3329388">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329395">//&nbsp;trailing&nbsp;garbage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329420">err</span>&nbsp;<span class="op" id="3329424">=</span>&nbsp;<span class="ident" id="3329426">CorruptInputError</span><span class="op" id="3329443">(</span><span class="ident" id="3329444">olen</span>&nbsp;<span class="op" id="3329449">-</span>&nbsp;<span class="builtinfunc" id="3329451">len</span><span class="op" id="3329454">(</span><span class="ident" id="3329455">src</span><span class="op" id="3329458">)</span><span class="op" id="3329459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329471">dlen</span><span class="op" id="3329475">,</span>&nbsp;<span class="ident" id="3329477">end</span>&nbsp;<span class="op" id="3329481">=</span>&nbsp;<span class="ident" id="3329483">j</span><span class="op" id="3329484">,</span>&nbsp;<span class="builtintype" id="3329486">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329495">break</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329509">dbuf</span><span class="op" id="3329513">[</span><span class="ident" id="3329514">j</span><span class="op" id="3329515">]</span>&nbsp;<span class="op" id="3329517">=</span>&nbsp;<span class="ident" id="3329519">enc</span><span class="op" id="3329522">.</span><span class="ident" id="3329523">decodeMap</span><span class="op" id="3329532">[</span><span class="ident" id="3329533">in</span><span class="op" id="3329535">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329540">if</span>&nbsp;<span class="ident" id="3329543">dbuf</span><span class="op" id="3329547">[</span><span class="ident" id="3329548">j</span><span class="op" id="3329549">]</span>&nbsp;<span class="op" id="3329551">==</span>&nbsp;<span class="num" id="3329554">0xFF</span>&nbsp;<span class="op" id="3329559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329565">return</span>&nbsp;<span class="ident" id="3329572">n</span><span class="op" id="3329573">,</span>&nbsp;<span class="builtintype" id="3329575">false</span><span class="op" id="3329580">,</span>&nbsp;<span class="ident" id="3329582">CorruptInputError</span><span class="op" id="3329599">(</span><span class="ident" id="3329600">olen</span>&nbsp;<span class="op" id="3329605">-</span>&nbsp;<span class="builtinfunc" id="3329607">len</span><span class="op" id="3329610">(</span><span class="ident" id="3329611">src</span><span class="op" id="3329614">)</span>&nbsp;<span class="op" id="3329616">-</span>&nbsp;<span class="num" id="3329618">1</span><span class="op" id="3329619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329624">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329633">//&nbsp;Pack&nbsp;4x&nbsp;6-bit&nbsp;source&nbsp;blocks&nbsp;into&nbsp;3&nbsp;byte&nbsp;destination</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3329690">//&nbsp;quantum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329703">switch</span>&nbsp;<span class="ident" id="3329710">dlen</span>&nbsp;<span class="op" id="3329715">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329719">case</span>&nbsp;<span class="num" id="3329724">4</span><span class="op" id="3329725">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329730">dst</span><span class="op" id="3329733">[</span><span class="num" id="3329734">2</span><span class="op" id="3329735">]</span>&nbsp;<span class="op" id="3329737">=</span>&nbsp;<span class="ident" id="3329739">dbuf</span><span class="op" id="3329743">[</span><span class="num" id="3329744">2</span><span class="op" id="3329745">]</span><span class="op" id="3329746">&lt;&lt;</span><span class="num" id="3329748">6</span>&nbsp;<span class="op" id="3329750">|</span>&nbsp;<span class="ident" id="3329752">dbuf</span><span class="op" id="3329756">[</span><span class="num" id="3329757">3</span><span class="op" id="3329758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329763">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329777">case</span>&nbsp;<span class="num" id="3329782">3</span><span class="op" id="3329783">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329788">dst</span><span class="op" id="3329791">[</span><span class="num" id="3329792">1</span><span class="op" id="3329793">]</span>&nbsp;<span class="op" id="3329795">=</span>&nbsp;<span class="ident" id="3329797">dbuf</span><span class="op" id="3329801">[</span><span class="num" id="3329802">1</span><span class="op" id="3329803">]</span><span class="op" id="3329804">&lt;&lt;</span><span class="num" id="3329806">4</span>&nbsp;<span class="op" id="3329808">|</span>&nbsp;<span class="ident" id="3329810">dbuf</span><span class="op" id="3329814">[</span><span class="num" id="3329815">2</span><span class="op" id="3329816">]</span><span class="op" id="3329817">&gt;&gt;</span><span class="num" id="3329819">2</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329824">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329838">case</span>&nbsp;<span class="num" id="3329843">2</span><span class="op" id="3329844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329849">dst</span><span class="op" id="3329852">[</span><span class="num" id="3329853">0</span><span class="op" id="3329854">]</span>&nbsp;<span class="op" id="3329856">=</span>&nbsp;<span class="ident" id="3329858">dbuf</span><span class="op" id="3329862">[</span><span class="num" id="3329863">0</span><span class="op" id="3329864">]</span><span class="op" id="3329865">&lt;&lt;</span><span class="num" id="3329867">2</span>&nbsp;<span class="op" id="3329869">|</span>&nbsp;<span class="ident" id="3329871">dbuf</span><span class="op" id="3329875">[</span><span class="num" id="3329876">1</span><span class="op" id="3329877">]</span><span class="op" id="3329878">&gt;&gt;</span><span class="num" id="3329880">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329888">dst</span>&nbsp;<span class="op" id="3329892">=</span>&nbsp;<span class="ident" id="3329894">dst</span><span class="op" id="3329897">[</span><span class="num" id="3329898">3</span><span class="op" id="3329899">:</span><span class="op" id="3329900">]</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3329904">n</span>&nbsp;<span class="op" id="3329906">+=</span>&nbsp;<span class="ident" id="3329909">dlen</span>&nbsp;<span class="op" id="3329914">-</span>&nbsp;<span class="num" id="3329916">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3329919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3329923">return</span>&nbsp;<span class="ident" id="3329930">n</span><span class="op" id="3329931">,</span>&nbsp;<span class="ident" id="3329933">end</span><span class="op" id="3329936">,</span>&nbsp;<span class="ident" id="3329938">err</span><br>
<span class="lineno"></span><span class="op" id="3329942">}</span><br>
<span class="lineno">280</span><br>
<span class="lineno"></span><span class="comment" id="3329945">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;using&nbsp;the&nbsp;encoding&nbsp;enc.&nbsp;&nbsp;It&nbsp;writes&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3330010">//&nbsp;DecodedLen(len(src))&nbsp;bytes&nbsp;to&nbsp;dst&nbsp;and&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes</span><br>
<span class="lineno"></span><span class="comment" id="3330079">//&nbsp;written.&nbsp;&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;base64&nbsp;data,&nbsp;it&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3330148">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;CorruptInputError.</span><br>
<span class="lineno">285</span><span class="comment" id="3330211">//&nbsp;New&nbsp;line&nbsp;characters&nbsp;(\r&nbsp;and&nbsp;\n)&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="keyword" id="3330259">func</span>&nbsp;<span class="op" id="3330264">(</span><span class="ident" id="3330265">enc</span>&nbsp;<span class="op" id="3330269">*</span><span class="ident" id="3330270">Encoding</span><span class="op" id="3330278">)</span>&nbsp;<span class="ident" id="3330280">Decode</span><span class="op" id="3330286">(</span><span class="ident" id="3330287">dst</span><span class="op" id="3330290">,</span>&nbsp;<span class="ident" id="3330292">src</span>&nbsp;<span class="op" id="3330296">[</span><span class="op" id="3330297">]</span><span class="builtintype" id="3330298">byte</span><span class="op" id="3330302">)</span>&nbsp;<span class="op" id="3330304">(</span><span class="ident" id="3330305">n</span>&nbsp;<span class="builtintype" id="3330307">int</span><span class="op" id="3330310">,</span>&nbsp;<span class="ident" id="3330312">err</span>&nbsp;<span class="builtintype" id="3330316">error</span><span class="op" id="3330321">)</span>&nbsp;<span class="op" id="3330323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330326">src</span>&nbsp;<span class="op" id="3330330">=</span>&nbsp;<span class="ident" id="3330332">bytes</span><span class="op" id="3330337">.</span><span class="ident" id="3330338">Map</span><span class="op" id="3330341">(</span><span class="ident" id="3330342">removeNewlinesMapper</span><span class="op" id="3330362">,</span>&nbsp;<span class="ident" id="3330364">src</span><span class="op" id="3330367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330370">n</span><span class="op" id="3330371">,</span>&nbsp;<span class="ident" id="3330373">_</span><span class="op" id="3330374">,</span>&nbsp;<span class="ident" id="3330376">err</span>&nbsp;<span class="op" id="3330380">=</span>&nbsp;<span class="ident" id="3330382">enc</span><span class="op" id="3330385">.</span><span class="ident" id="3330386">decode</span><span class="op" id="3330392">(</span><span class="ident" id="3330393">dst</span><span class="op" id="3330396">,</span>&nbsp;<span class="ident" id="3330398">src</span><span class="op" id="3330401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330404">return</span><br>
<span class="lineno">290</span><span class="op" id="3330411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3330414">//&nbsp;DecodeString&nbsp;returns&nbsp;the&nbsp;bytes&nbsp;represented&nbsp;by&nbsp;the&nbsp;base64&nbsp;string&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="3330484">func</span>&nbsp;<span class="op" id="3330489">(</span><span class="ident" id="3330490">enc</span>&nbsp;<span class="op" id="3330494">*</span><span class="ident" id="3330495">Encoding</span><span class="op" id="3330503">)</span>&nbsp;<span class="ident" id="3330505">DecodeString</span><span class="op" id="3330517">(</span><span class="ident" id="3330518">s</span>&nbsp;<span class="builtintype" id="3330520">string</span><span class="op" id="3330526">)</span>&nbsp;<span class="op" id="3330528">(</span><span class="op" id="3330529">[</span><span class="op" id="3330530">]</span><span class="builtintype" id="3330531">byte</span><span class="op" id="3330535">,</span>&nbsp;<span class="builtintype" id="3330537">error</span><span class="op" id="3330542">)</span>&nbsp;<span class="op" id="3330544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330547">s</span>&nbsp;<span class="op" id="3330549">=</span>&nbsp;<span class="ident" id="3330551">strings</span><span class="op" id="3330558">.</span><span class="ident" id="3330559">Map</span><span class="op" id="3330562">(</span><span class="ident" id="3330563">removeNewlinesMapper</span><span class="op" id="3330583">,</span>&nbsp;<span class="ident" id="3330585">s</span><span class="op" id="3330586">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330589">dbuf</span>&nbsp;<span class="op" id="3330594">:=</span>&nbsp;<span class="builtinfunc" id="3330597">make</span><span class="op" id="3330601">(</span><span class="op" id="3330602">[</span><span class="op" id="3330603">]</span><span class="builtintype" id="3330604">byte</span><span class="op" id="3330608">,</span>&nbsp;<span class="ident" id="3330610">enc</span><span class="op" id="3330613">.</span><span class="ident" id="3330614">DecodedLen</span><span class="op" id="3330624">(</span><span class="builtinfunc" id="3330625">len</span><span class="op" id="3330628">(</span><span class="ident" id="3330629">s</span><span class="op" id="3330630">)</span><span class="op" id="3330631">)</span><span class="op" id="3330632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330635">n</span><span class="op" id="3330636">,</span>&nbsp;<span class="ident" id="3330638">_</span><span class="op" id="3330639">,</span>&nbsp;<span class="ident" id="3330641">err</span>&nbsp;<span class="op" id="3330645">:=</span>&nbsp;<span class="ident" id="3330648">enc</span><span class="op" id="3330651">.</span><span class="ident" id="3330652">decode</span><span class="op" id="3330658">(</span><span class="ident" id="3330659">dbuf</span><span class="op" id="3330663">,</span>&nbsp;<span class="op" id="3330665">[</span><span class="op" id="3330666">]</span><span class="builtintype" id="3330667">byte</span><span class="op" id="3330671">(</span><span class="ident" id="3330672">s</span><span class="op" id="3330673">)</span><span class="op" id="3330674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330677">return</span>&nbsp;<span class="ident" id="3330684">dbuf</span><span class="op" id="3330688">[</span><span class="op" id="3330689">:</span><span class="ident" id="3330690">n</span><span class="op" id="3330691">]</span><span class="op" id="3330692">,</span>&nbsp;<span class="ident" id="3330694">err</span><br>
<span class="lineno"></span><span class="op" id="3330698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">300</span><span class="keyword" id="3330701">type</span>&nbsp;<span class="ident" id="3330706">decoder</span>&nbsp;<span class="keyword" id="3330714">struct</span>&nbsp;<span class="op" id="3330721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330724">err</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3330731">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330738">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3330745">*</span><span class="ident" id="3330746">Encoding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330756">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3330763">io</span><span class="op" id="3330765">.</span><span class="ident" id="3330766">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330774">end</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3330781">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3330792">//&nbsp;saw&nbsp;end&nbsp;of&nbsp;message</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330815">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3330822">[</span><span class="num" id="3330823">1024</span><span class="op" id="3330827">]</span><span class="builtintype" id="3330828">byte</span>&nbsp;<span class="comment" id="3330833">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330852">nbuf</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3330859">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330864">out</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3330871">[</span><span class="op" id="3330872">]</span><span class="builtintype" id="3330873">byte</span>&nbsp;<span class="comment" id="3330878">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3330906">outbuf</span>&nbsp;<span class="op" id="3330913">[</span><span class="num" id="3330914">1024</span>&nbsp;<span class="op" id="3330919">/</span>&nbsp;<span class="num" id="3330921">4</span>&nbsp;<span class="op" id="3330923">*</span>&nbsp;<span class="num" id="3330925">3</span><span class="op" id="3330926">]</span><span class="builtintype" id="3330927">byte</span><br>
<span class="lineno"></span><span class="op" id="3330932">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="3330935">func</span>&nbsp;<span class="op" id="3330940">(</span><span class="ident" id="3330941">d</span>&nbsp;<span class="op" id="3330943">*</span><span class="ident" id="3330944">decoder</span><span class="op" id="3330951">)</span>&nbsp;<span class="ident" id="3330953">Read</span><span class="op" id="3330957">(</span><span class="ident" id="3330958">p</span>&nbsp;<span class="op" id="3330960">[</span><span class="op" id="3330961">]</span><span class="builtintype" id="3330962">byte</span><span class="op" id="3330966">)</span>&nbsp;<span class="op" id="3330968">(</span><span class="ident" id="3330969">n</span>&nbsp;<span class="builtintype" id="3330971">int</span><span class="op" id="3330974">,</span>&nbsp;<span class="ident" id="3330976">err</span>&nbsp;<span class="builtintype" id="3330980">error</span><span class="op" id="3330985">)</span>&nbsp;<span class="op" id="3330987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3330990">if</span>&nbsp;<span class="ident" id="3330993">d</span><span class="op" id="3330994">.</span><span class="ident" id="3330995">err</span>&nbsp;<span class="op" id="3330999">!=</span>&nbsp;<span class="ident" id="3331002">nil</span>&nbsp;<span class="op" id="3331006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331010">return</span>&nbsp;<span class="num" id="3331017">0</span><span class="op" id="3331018">,</span>&nbsp;<span class="ident" id="3331020">d</span><span class="op" id="3331021">.</span><span class="ident" id="3331022">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331027">}</span><br>
<span class="lineno">315</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3331031">//&nbsp;Use&nbsp;leftover&nbsp;decoded&nbsp;output&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331079">if</span>&nbsp;<span class="builtinfunc" id="3331082">len</span><span class="op" id="3331085">(</span><span class="ident" id="3331086">d</span><span class="op" id="3331087">.</span><span class="ident" id="3331088">out</span><span class="op" id="3331091">)</span>&nbsp;<span class="op" id="3331093">&gt;</span>&nbsp;<span class="num" id="3331095">0</span>&nbsp;<span class="op" id="3331097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331101">n</span>&nbsp;<span class="op" id="3331103">=</span>&nbsp;<span class="builtinfunc" id="3331105">copy</span><span class="op" id="3331109">(</span><span class="ident" id="3331110">p</span><span class="op" id="3331111">,</span>&nbsp;<span class="ident" id="3331113">d</span><span class="op" id="3331114">.</span><span class="ident" id="3331115">out</span><span class="op" id="3331118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331122">d</span><span class="op" id="3331123">.</span><span class="ident" id="3331124">out</span>&nbsp;<span class="op" id="3331128">=</span>&nbsp;<span class="ident" id="3331130">d</span><span class="op" id="3331131">.</span><span class="ident" id="3331132">out</span><span class="op" id="3331135">[</span><span class="ident" id="3331136">n</span><span class="op" id="3331137">:</span><span class="op" id="3331138">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331142">return</span>&nbsp;<span class="ident" id="3331149">n</span><span class="op" id="3331150">,</span>&nbsp;<span class="ident" id="3331152">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3331161">//&nbsp;Read&nbsp;a&nbsp;chunk.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331179">nn</span>&nbsp;<span class="op" id="3331182">:=</span>&nbsp;<span class="builtinfunc" id="3331185">len</span><span class="op" id="3331188">(</span><span class="ident" id="3331189">p</span><span class="op" id="3331190">)</span>&nbsp;<span class="op" id="3331192">/</span>&nbsp;<span class="num" id="3331194">3</span>&nbsp;<span class="op" id="3331196">*</span>&nbsp;<span class="num" id="3331198">4</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331201">if</span>&nbsp;<span class="ident" id="3331204">nn</span>&nbsp;<span class="op" id="3331207">&lt;</span>&nbsp;<span class="num" id="3331209">4</span>&nbsp;<span class="op" id="3331211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331215">nn</span>&nbsp;<span class="op" id="3331218">=</span>&nbsp;<span class="num" id="3331220">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331226">if</span>&nbsp;<span class="ident" id="3331229">nn</span>&nbsp;<span class="op" id="3331232">&gt;</span>&nbsp;<span class="builtinfunc" id="3331234">len</span><span class="op" id="3331237">(</span><span class="ident" id="3331238">d</span><span class="op" id="3331239">.</span><span class="ident" id="3331240">buf</span><span class="op" id="3331243">)</span>&nbsp;<span class="op" id="3331245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331249">nn</span>&nbsp;<span class="op" id="3331252">=</span>&nbsp;<span class="builtinfunc" id="3331254">len</span><span class="op" id="3331257">(</span><span class="ident" id="3331258">d</span><span class="op" id="3331259">.</span><span class="ident" id="3331260">buf</span><span class="op" id="3331263">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331269">nn</span><span class="op" id="3331271">,</span>&nbsp;<span class="ident" id="3331273">d</span><span class="op" id="3331274">.</span><span class="ident" id="3331275">err</span>&nbsp;<span class="op" id="3331279">=</span>&nbsp;<span class="ident" id="3331281">io</span><span class="op" id="3331283">.</span><span class="ident" id="3331284">ReadAtLeast</span><span class="op" id="3331295">(</span><span class="ident" id="3331296">d</span><span class="op" id="3331297">.</span><span class="ident" id="3331298">r</span><span class="op" id="3331299">,</span>&nbsp;<span class="ident" id="3331301">d</span><span class="op" id="3331302">.</span><span class="ident" id="3331303">buf</span><span class="op" id="3331306">[</span><span class="ident" id="3331307">d</span><span class="op" id="3331308">.</span><span class="ident" id="3331309">nbuf</span><span class="op" id="3331313">:</span><span class="ident" id="3331314">nn</span><span class="op" id="3331316">]</span><span class="op" id="3331317">,</span>&nbsp;<span class="num" id="3331319">4</span><span class="op" id="3331320">-</span><span class="ident" id="3331321">d</span><span class="op" id="3331322">.</span><span class="ident" id="3331323">nbuf</span><span class="op" id="3331327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331330">d</span><span class="op" id="3331331">.</span><span class="ident" id="3331332">nbuf</span>&nbsp;<span class="op" id="3331337">+=</span>&nbsp;<span class="ident" id="3331340">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331344">if</span>&nbsp;<span class="ident" id="3331347">d</span><span class="op" id="3331348">.</span><span class="ident" id="3331349">err</span>&nbsp;<span class="op" id="3331353">!=</span>&nbsp;<span class="ident" id="3331356">nil</span>&nbsp;<span class="op" id="3331360">||</span>&nbsp;<span class="ident" id="3331363">d</span><span class="op" id="3331364">.</span><span class="ident" id="3331365">nbuf</span>&nbsp;<span class="op" id="3331370">&lt;</span>&nbsp;<span class="num" id="3331372">4</span>&nbsp;<span class="op" id="3331374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331378">return</span>&nbsp;<span class="num" id="3331385">0</span><span class="op" id="3331386">,</span>&nbsp;<span class="ident" id="3331388">d</span><span class="op" id="3331389">.</span><span class="ident" id="3331390">err</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3331399">//&nbsp;Decode&nbsp;chunk&nbsp;into&nbsp;p,&nbsp;or&nbsp;d.out&nbsp;and&nbsp;then&nbsp;p&nbsp;if&nbsp;p&nbsp;is&nbsp;too&nbsp;small.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331463">nr</span>&nbsp;<span class="op" id="3331466">:=</span>&nbsp;<span class="ident" id="3331469">d</span><span class="op" id="3331470">.</span><span class="ident" id="3331471">nbuf</span>&nbsp;<span class="op" id="3331476">/</span>&nbsp;<span class="num" id="3331478">4</span>&nbsp;<span class="op" id="3331480">*</span>&nbsp;<span class="num" id="3331482">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331485">nw</span>&nbsp;<span class="op" id="3331488">:=</span>&nbsp;<span class="ident" id="3331491">d</span><span class="op" id="3331492">.</span><span class="ident" id="3331493">nbuf</span>&nbsp;<span class="op" id="3331498">/</span>&nbsp;<span class="num" id="3331500">4</span>&nbsp;<span class="op" id="3331502">*</span>&nbsp;<span class="num" id="3331504">3</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331507">if</span>&nbsp;<span class="ident" id="3331510">nw</span>&nbsp;<span class="op" id="3331513">&gt;</span>&nbsp;<span class="builtinfunc" id="3331515">len</span><span class="op" id="3331518">(</span><span class="ident" id="3331519">p</span><span class="op" id="3331520">)</span>&nbsp;<span class="op" id="3331522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331526">nw</span><span class="op" id="3331528">,</span>&nbsp;<span class="ident" id="3331530">d</span><span class="op" id="3331531">.</span><span class="ident" id="3331532">end</span><span class="op" id="3331535">,</span>&nbsp;<span class="ident" id="3331537">d</span><span class="op" id="3331538">.</span><span class="ident" id="3331539">err</span>&nbsp;<span class="op" id="3331543">=</span>&nbsp;<span class="ident" id="3331545">d</span><span class="op" id="3331546">.</span><span class="ident" id="3331547">enc</span><span class="op" id="3331550">.</span><span class="ident" id="3331551">decode</span><span class="op" id="3331557">(</span><span class="ident" id="3331558">d</span><span class="op" id="3331559">.</span><span class="ident" id="3331560">outbuf</span><span class="op" id="3331566">[</span><span class="num" id="3331567">0</span><span class="op" id="3331568">:</span><span class="op" id="3331569">]</span><span class="op" id="3331570">,</span>&nbsp;<span class="ident" id="3331572">d</span><span class="op" id="3331573">.</span><span class="ident" id="3331574">buf</span><span class="op" id="3331577">[</span><span class="num" id="3331578">0</span><span class="op" id="3331579">:</span><span class="ident" id="3331580">nr</span><span class="op" id="3331582">]</span><span class="op" id="3331583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331587">d</span><span class="op" id="3331588">.</span><span class="ident" id="3331589">out</span>&nbsp;<span class="op" id="3331593">=</span>&nbsp;<span class="ident" id="3331595">d</span><span class="op" id="3331596">.</span><span class="ident" id="3331597">outbuf</span><span class="op" id="3331603">[</span><span class="num" id="3331604">0</span><span class="op" id="3331605">:</span><span class="ident" id="3331606">nw</span><span class="op" id="3331608">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331612">n</span>&nbsp;<span class="op" id="3331614">=</span>&nbsp;<span class="builtinfunc" id="3331616">copy</span><span class="op" id="3331620">(</span><span class="ident" id="3331621">p</span><span class="op" id="3331622">,</span>&nbsp;<span class="ident" id="3331624">d</span><span class="op" id="3331625">.</span><span class="ident" id="3331626">out</span><span class="op" id="3331629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331633">d</span><span class="op" id="3331634">.</span><span class="ident" id="3331635">out</span>&nbsp;<span class="op" id="3331639">=</span>&nbsp;<span class="ident" id="3331641">d</span><span class="op" id="3331642">.</span><span class="ident" id="3331643">out</span><span class="op" id="3331646">[</span><span class="ident" id="3331647">n</span><span class="op" id="3331648">:</span><span class="op" id="3331649">]</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331652">}</span>&nbsp;<span class="keyword" id="3331654">else</span>&nbsp;<span class="op" id="3331659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331663">n</span><span class="op" id="3331664">,</span>&nbsp;<span class="ident" id="3331666">d</span><span class="op" id="3331667">.</span><span class="ident" id="3331668">end</span><span class="op" id="3331671">,</span>&nbsp;<span class="ident" id="3331673">d</span><span class="op" id="3331674">.</span><span class="ident" id="3331675">err</span>&nbsp;<span class="op" id="3331679">=</span>&nbsp;<span class="ident" id="3331681">d</span><span class="op" id="3331682">.</span><span class="ident" id="3331683">enc</span><span class="op" id="3331686">.</span><span class="ident" id="3331687">decode</span><span class="op" id="3331693">(</span><span class="ident" id="3331694">p</span><span class="op" id="3331695">,</span>&nbsp;<span class="ident" id="3331697">d</span><span class="op" id="3331698">.</span><span class="ident" id="3331699">buf</span><span class="op" id="3331702">[</span><span class="num" id="3331703">0</span><span class="op" id="3331704">:</span><span class="ident" id="3331705">nr</span><span class="op" id="3331707">]</span><span class="op" id="3331708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331714">d</span><span class="op" id="3331715">.</span><span class="ident" id="3331716">nbuf</span>&nbsp;<span class="op" id="3331721">-=</span>&nbsp;<span class="ident" id="3331724">nr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331728">for</span>&nbsp;<span class="ident" id="3331732">i</span>&nbsp;<span class="op" id="3331734">:=</span>&nbsp;<span class="num" id="3331737">0</span><span class="op" id="3331738">;</span>&nbsp;<span class="ident" id="3331740">i</span>&nbsp;<span class="op" id="3331742">&lt;</span>&nbsp;<span class="ident" id="3331744">d</span><span class="op" id="3331745">.</span><span class="ident" id="3331746">nbuf</span><span class="op" id="3331750">;</span>&nbsp;<span class="ident" id="3331752">i</span><span class="op" id="3331753">++</span>&nbsp;<span class="op" id="3331756">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331760">d</span><span class="op" id="3331761">.</span><span class="ident" id="3331762">buf</span><span class="op" id="3331765">[</span><span class="ident" id="3331766">i</span><span class="op" id="3331767">]</span>&nbsp;<span class="op" id="3331769">=</span>&nbsp;<span class="ident" id="3331771">d</span><span class="op" id="3331772">.</span><span class="ident" id="3331773">buf</span><span class="op" id="3331776">[</span><span class="ident" id="3331777">i</span><span class="op" id="3331778">+</span><span class="ident" id="3331779">nr</span><span class="op" id="3331781">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331788">if</span>&nbsp;<span class="ident" id="3331791">d</span><span class="op" id="3331792">.</span><span class="ident" id="3331793">err</span>&nbsp;<span class="op" id="3331797">==</span>&nbsp;<span class="ident" id="3331800">nil</span>&nbsp;<span class="op" id="3331804">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331808">d</span><span class="op" id="3331809">.</span><span class="ident" id="3331810">err</span>&nbsp;<span class="op" id="3331814">=</span>&nbsp;<span class="ident" id="3331816">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3331821">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331824">return</span>&nbsp;<span class="ident" id="3331831">n</span><span class="op" id="3331832">,</span>&nbsp;<span class="ident" id="3331834">d</span><span class="op" id="3331835">.</span><span class="ident" id="3331836">err</span><br>
<span class="lineno"></span><span class="op" id="3331840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3331843">type</span>&nbsp;<span class="ident" id="3331848">newlineFilteringReader</span>&nbsp;<span class="keyword" id="3331871">struct</span>&nbsp;<span class="op" id="3331878">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331881">wrapped</span>&nbsp;<span class="ident" id="3331889">io</span><span class="op" id="3331891">.</span><span class="ident" id="3331892">Reader</span><br>
<span class="lineno"></span><span class="op" id="3331899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3331902">func</span>&nbsp;<span class="op" id="3331907">(</span><span class="ident" id="3331908">r</span>&nbsp;<span class="op" id="3331910">*</span><span class="ident" id="3331911">newlineFilteringReader</span><span class="op" id="3331933">)</span>&nbsp;<span class="ident" id="3331935">Read</span><span class="op" id="3331939">(</span><span class="ident" id="3331940">p</span>&nbsp;<span class="op" id="3331942">[</span><span class="op" id="3331943">]</span><span class="builtintype" id="3331944">byte</span><span class="op" id="3331948">)</span>&nbsp;<span class="op" id="3331950">(</span><span class="builtintype" id="3331951">int</span><span class="op" id="3331954">,</span>&nbsp;<span class="builtintype" id="3331956">error</span><span class="op" id="3331961">)</span>&nbsp;<span class="op" id="3331963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3331966">n</span><span class="op" id="3331967">,</span>&nbsp;<span class="ident" id="3331969">err</span>&nbsp;<span class="op" id="3331973">:=</span>&nbsp;<span class="ident" id="3331976">r</span><span class="op" id="3331977">.</span><span class="ident" id="3331978">wrapped</span><span class="op" id="3331985">.</span><span class="ident" id="3331986">Read</span><span class="op" id="3331990">(</span><span class="ident" id="3331991">p</span><span class="op" id="3331992">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3331995">for</span>&nbsp;<span class="ident" id="3331999">n</span>&nbsp;<span class="op" id="3332001">&gt;</span>&nbsp;<span class="num" id="3332003">0</span>&nbsp;<span class="op" id="3332005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332009">offset</span>&nbsp;<span class="op" id="3332016">:=</span>&nbsp;<span class="num" id="3332019">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332023">for</span>&nbsp;<span class="ident" id="3332027">i</span><span class="op" id="3332028">,</span>&nbsp;<span class="ident" id="3332030">b</span>&nbsp;<span class="op" id="3332032">:=</span>&nbsp;<span class="keyword" id="3332035">range</span>&nbsp;<span class="ident" id="3332041">p</span><span class="op" id="3332042">[</span><span class="num" id="3332043">0</span><span class="op" id="3332044">:</span><span class="ident" id="3332045">n</span><span class="op" id="3332046">]</span>&nbsp;<span class="op" id="3332048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332053">if</span>&nbsp;<span class="ident" id="3332056">b</span>&nbsp;<span class="op" id="3332058">!=</span>&nbsp;<span class="string" id="3332061">&#39;\r&#39;</span>&nbsp;<span class="op" id="3332066">&amp;&amp;</span>&nbsp;<span class="ident" id="3332069">b</span>&nbsp;<span class="op" id="3332071">!=</span>&nbsp;<span class="string" id="3332074">&#39;\n&#39;</span>&nbsp;<span class="op" id="3332079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332085">if</span>&nbsp;<span class="ident" id="3332088">i</span>&nbsp;<span class="op" id="3332090">!=</span>&nbsp;<span class="ident" id="3332093">offset</span>&nbsp;<span class="op" id="3332100">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332107">p</span><span class="op" id="3332108">[</span><span class="ident" id="3332109">offset</span><span class="op" id="3332115">]</span>&nbsp;<span class="op" id="3332117">=</span>&nbsp;<span class="ident" id="3332119">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332131">offset</span><span class="op" id="3332137">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332147">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332151">if</span>&nbsp;<span class="ident" id="3332154">offset</span>&nbsp;<span class="op" id="3332161">&gt;</span>&nbsp;<span class="num" id="3332163">0</span>&nbsp;<span class="op" id="3332165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332170">return</span>&nbsp;<span class="ident" id="3332177">offset</span><span class="op" id="3332183">,</span>&nbsp;<span class="ident" id="3332185">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3332195">//&nbsp;Previous&nbsp;buffer&nbsp;entirely&nbsp;whitespace,&nbsp;read&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3332248">n</span><span class="op" id="3332249">,</span>&nbsp;<span class="ident" id="3332251">err</span>&nbsp;<span class="op" id="3332255">=</span>&nbsp;<span class="ident" id="3332257">r</span><span class="op" id="3332258">.</span><span class="ident" id="3332259">wrapped</span><span class="op" id="3332266">.</span><span class="ident" id="3332267">Read</span><span class="op" id="3332271">(</span><span class="ident" id="3332272">p</span><span class="op" id="3332273">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3332276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332279">return</span>&nbsp;<span class="ident" id="3332286">n</span><span class="op" id="3332287">,</span>&nbsp;<span class="ident" id="3332289">err</span><br>
<span class="lineno"></span><span class="op" id="3332293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3332296">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;base64&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno">385</span><span class="keyword" id="3332350">func</span>&nbsp;<span class="ident" id="3332355">NewDecoder</span><span class="op" id="3332365">(</span><span class="ident" id="3332366">enc</span>&nbsp;<span class="op" id="3332370">*</span><span class="ident" id="3332371">Encoding</span><span class="op" id="3332379">,</span>&nbsp;<span class="ident" id="3332381">r</span>&nbsp;<span class="ident" id="3332383">io</span><span class="op" id="3332385">.</span><span class="ident" id="3332386">Reader</span><span class="op" id="3332392">)</span>&nbsp;<span class="ident" id="3332394">io</span><span class="op" id="3332396">.</span><span class="ident" id="3332397">Reader</span>&nbsp;<span class="op" id="3332404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3332407">return</span>&nbsp;<span class="op" id="3332414">&amp;</span><span class="ident" id="3332415">decoder</span><span class="op" id="3332422">{</span><span class="ident" id="3332423">enc</span><span class="op" id="3332426">:</span>&nbsp;<span class="ident" id="3332428">enc</span><span class="op" id="3332431">,</span>&nbsp;<span class="ident" id="3332433">r</span><span class="op" id="3332434">:</span>&nbsp;<span class="op" id="3332436">&amp;</span><span class="ident" id="3332437">newlineFilteringReader</span><span class="op" id="3332459">{</span><span class="ident" id="3332460">r</span><span class="op" id="3332461">}</span><span class="op" id="3332462">}</span><br>
<span class="lineno"></span><span class="op" id="3332464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3332467">//&nbsp;DecodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;in&nbsp;bytes&nbsp;of&nbsp;the&nbsp;decoded&nbsp;data</span><br>
<span class="lineno">390</span><span class="comment" id="3332537">//&nbsp;corresponding&nbsp;to&nbsp;n&nbsp;bytes&nbsp;of&nbsp;base64-encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="3332589">func</span>&nbsp;<span class="op" id="3332594">(</span><span class="ident" id="3332595">enc</span>&nbsp;<span class="op" id="3332599">*</span><span class="ident" id="3332600">Encoding</span><span class="op" id="3332608">)</span>&nbsp;<span class="ident" id="3332610">DecodedLen</span><span class="op" id="3332620">(</span><span class="ident" id="3332621">n</span>&nbsp;<span class="builtintype" id="3332623">int</span><span class="op" id="3332626">)</span>&nbsp;<span class="builtintype" id="3332628">int</span>&nbsp;<span class="op" id="3332632">{</span>&nbsp;<span class="keyword" id="3332634">return</span>&nbsp;<span class="ident" id="3332641">n</span>&nbsp;<span class="op" id="3332643">/</span>&nbsp;<span class="num" id="3332645">4</span>&nbsp;<span class="op" id="3332647">*</span>&nbsp;<span class="num" id="3332649">3</span>&nbsp;<span class="op" id="3332651">}</span>
</div>
</body>
</html>
