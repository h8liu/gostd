<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8087806">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8087861">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8087915">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8087966">package</span>&nbsp;<span class="ident" id="8087974">fcgi</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8087980">import</span>&nbsp;<span class="op" id="8087987">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8087990">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8087999">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8088009">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8088015">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8088025">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8088028">var</span>&nbsp;<span class="ident" id="8088032">sizeTests</span>&nbsp;<span class="op" id="8088042">=</span>&nbsp;<span class="op" id="8088044">[</span><span class="op" id="8088045">]</span><span class="keyword" id="8088046">struct</span>&nbsp;<span class="op" id="8088053">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088056">size</span>&nbsp;&nbsp;<span class="builtintype" id="8088062">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088070">bytes</span>&nbsp;<span class="op" id="8088076">[</span><span class="op" id="8088077">]</span><span class="builtintype" id="8088078">byte</span><br>
<span class="lineno"></span><span class="op" id="8088083">}</span><span class="op" id="8088084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088087">{</span><span class="num" id="8088088">0</span><span class="op" id="8088089">,</span>&nbsp;<span class="op" id="8088091">[</span><span class="op" id="8088092">]</span><span class="builtintype" id="8088093">byte</span><span class="op" id="8088097">{</span><span class="num" id="8088098">0x00</span><span class="op" id="8088102">}</span><span class="op" id="8088103">}</span><span class="op" id="8088104">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088107">{</span><span class="num" id="8088108">127</span><span class="op" id="8088111">,</span>&nbsp;<span class="op" id="8088113">[</span><span class="op" id="8088114">]</span><span class="builtintype" id="8088115">byte</span><span class="op" id="8088119">{</span><span class="num" id="8088120">0x7F</span><span class="op" id="8088124">}</span><span class="op" id="8088125">}</span><span class="op" id="8088126">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088129">{</span><span class="num" id="8088130">128</span><span class="op" id="8088133">,</span>&nbsp;<span class="op" id="8088135">[</span><span class="op" id="8088136">]</span><span class="builtintype" id="8088137">byte</span><span class="op" id="8088141">{</span><span class="num" id="8088142">0x80</span><span class="op" id="8088146">,</span>&nbsp;<span class="num" id="8088148">0x00</span><span class="op" id="8088152">,</span>&nbsp;<span class="num" id="8088154">0x00</span><span class="op" id="8088158">,</span>&nbsp;<span class="num" id="8088160">0x80</span><span class="op" id="8088164">}</span><span class="op" id="8088165">}</span><span class="op" id="8088166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088169">{</span><span class="num" id="8088170">1000</span><span class="op" id="8088174">,</span>&nbsp;<span class="op" id="8088176">[</span><span class="op" id="8088177">]</span><span class="builtintype" id="8088178">byte</span><span class="op" id="8088182">{</span><span class="num" id="8088183">0x80</span><span class="op" id="8088187">,</span>&nbsp;<span class="num" id="8088189">0x00</span><span class="op" id="8088193">,</span>&nbsp;<span class="num" id="8088195">0x03</span><span class="op" id="8088199">,</span>&nbsp;<span class="num" id="8088201">0xE8</span><span class="op" id="8088205">}</span><span class="op" id="8088206">}</span><span class="op" id="8088207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088210">{</span><span class="num" id="8088211">33554431</span><span class="op" id="8088219">,</span>&nbsp;<span class="op" id="8088221">[</span><span class="op" id="8088222">]</span><span class="builtintype" id="8088223">byte</span><span class="op" id="8088227">{</span><span class="num" id="8088228">0x81</span><span class="op" id="8088232">,</span>&nbsp;<span class="num" id="8088234">0xFF</span><span class="op" id="8088238">,</span>&nbsp;<span class="num" id="8088240">0xFF</span><span class="op" id="8088244">,</span>&nbsp;<span class="num" id="8088246">0xFF</span><span class="op" id="8088250">}</span><span class="op" id="8088251">}</span><span class="op" id="8088252">,</span><br>
<span class="lineno"></span><span class="op" id="8088254">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8088257">func</span>&nbsp;<span class="ident" id="8088262">TestSize</span><span class="op" id="8088270">(</span><span class="ident" id="8088271">t</span>&nbsp;<span class="op" id="8088273">*</span><span class="ident" id="8088274">testing</span><span class="op" id="8088281">.</span><span class="ident" id="8088282">T</span><span class="op" id="8088283">)</span>&nbsp;<span class="op" id="8088285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088288">b</span>&nbsp;<span class="op" id="8088290">:=</span>&nbsp;<span class="builtinfunc" id="8088293">make</span><span class="op" id="8088297">(</span><span class="op" id="8088298">[</span><span class="op" id="8088299">]</span><span class="builtintype" id="8088300">byte</span><span class="op" id="8088304">,</span>&nbsp;<span class="num" id="8088306">4</span><span class="op" id="8088307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088310">for</span>&nbsp;<span class="ident" id="8088314">i</span><span class="op" id="8088315">,</span>&nbsp;<span class="ident" id="8088317">test</span>&nbsp;<span class="op" id="8088322">:=</span>&nbsp;<span class="keyword" id="8088325">range</span>&nbsp;<span class="ident" id="8088331">sizeTests</span>&nbsp;<span class="op" id="8088341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088345">n</span>&nbsp;<span class="op" id="8088347">:=</span>&nbsp;<span class="ident" id="8088350">encodeSize</span><span class="op" id="8088360">(</span><span class="ident" id="8088361">b</span><span class="op" id="8088362">,</span>&nbsp;<span class="ident" id="8088364">test</span><span class="op" id="8088368">.</span><span class="ident" id="8088369">size</span><span class="op" id="8088373">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088377">if</span>&nbsp;<span class="op" id="8088380">!</span><span class="ident" id="8088381">bytes</span><span class="op" id="8088386">.</span><span class="ident" id="8088387">Equal</span><span class="op" id="8088392">(</span><span class="ident" id="8088393">b</span><span class="op" id="8088394">[</span><span class="op" id="8088395">:</span><span class="ident" id="8088396">n</span><span class="op" id="8088397">]</span><span class="op" id="8088398">,</span>&nbsp;<span class="ident" id="8088400">test</span><span class="op" id="8088404">.</span><span class="ident" id="8088405">bytes</span><span class="op" id="8088410">)</span>&nbsp;<span class="op" id="8088412">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088417">t</span><span class="op" id="8088418">.</span><span class="ident" id="8088419">Errorf</span><span class="op" id="8088425">(</span><span class="string" id="8088426">&#34;%d&nbsp;expected&nbsp;%x,&nbsp;encoded&nbsp;%x&#34;</span><span class="op" id="8088454">,</span>&nbsp;<span class="ident" id="8088456">i</span><span class="op" id="8088457">,</span>&nbsp;<span class="ident" id="8088459">test</span><span class="op" id="8088463">.</span><span class="ident" id="8088464">bytes</span><span class="op" id="8088469">,</span>&nbsp;<span class="ident" id="8088471">b</span><span class="op" id="8088472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088480">size</span><span class="op" id="8088484">,</span>&nbsp;<span class="ident" id="8088486">n</span>&nbsp;<span class="op" id="8088488">:=</span>&nbsp;<span class="ident" id="8088491">readSize</span><span class="op" id="8088499">(</span><span class="ident" id="8088500">test</span><span class="op" id="8088504">.</span><span class="ident" id="8088505">bytes</span><span class="op" id="8088510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088514">if</span>&nbsp;<span class="ident" id="8088517">size</span>&nbsp;<span class="op" id="8088522">!=</span>&nbsp;<span class="ident" id="8088525">test</span><span class="op" id="8088529">.</span><span class="ident" id="8088530">size</span>&nbsp;<span class="op" id="8088535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088540">t</span><span class="op" id="8088541">.</span><span class="ident" id="8088542">Errorf</span><span class="op" id="8088548">(</span><span class="string" id="8088549">&#34;%d&nbsp;expected&nbsp;%d,&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8088574">,</span>&nbsp;<span class="ident" id="8088576">i</span><span class="op" id="8088577">,</span>&nbsp;<span class="ident" id="8088579">test</span><span class="op" id="8088583">.</span><span class="ident" id="8088584">size</span><span class="op" id="8088588">,</span>&nbsp;<span class="ident" id="8088590">size</span><span class="op" id="8088594">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8088602">if</span>&nbsp;<span class="builtinfunc" id="8088605">len</span><span class="op" id="8088608">(</span><span class="ident" id="8088609">test</span><span class="op" id="8088613">.</span><span class="ident" id="8088614">bytes</span><span class="op" id="8088619">)</span>&nbsp;<span class="op" id="8088621">!=</span>&nbsp;<span class="ident" id="8088624">n</span>&nbsp;<span class="op" id="8088626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088631">t</span><span class="op" id="8088632">.</span><span class="ident" id="8088633">Errorf</span><span class="op" id="8088639">(</span><span class="string" id="8088640">&#34;%d&nbsp;did&nbsp;not&nbsp;consume&nbsp;all&nbsp;the&nbsp;bytes&#34;</span><span class="op" id="8088674">,</span>&nbsp;<span class="ident" id="8088676">i</span><span class="op" id="8088677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088684">}</span><br>
<span class="lineno">40</span><span class="op" id="8088686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8088689">var</span>&nbsp;<span class="ident" id="8088693">streamTests</span>&nbsp;<span class="op" id="8088705">=</span>&nbsp;<span class="op" id="8088707">[</span><span class="op" id="8088708">]</span><span class="keyword" id="8088709">struct</span>&nbsp;<span class="op" id="8088716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088719">desc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8088727">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088735">recType</span>&nbsp;<span class="ident" id="8088743">recType</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088752">reqId</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8088760">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088768">content</span>&nbsp;<span class="op" id="8088776">[</span><span class="op" id="8088777">]</span><span class="builtintype" id="8088778">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8088784">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8088792">[</span><span class="op" id="8088793">]</span><span class="builtintype" id="8088794">byte</span><br>
<span class="lineno"></span><span class="op" id="8088799">}</span><span class="op" id="8088800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088803">{</span><span class="string" id="8088804">&#34;single&nbsp;record&#34;</span><span class="op" id="8088819">,</span>&nbsp;<span class="ident" id="8088821">typeStdout</span><span class="op" id="8088831">,</span>&nbsp;<span class="num" id="8088833">1</span><span class="op" id="8088834">,</span>&nbsp;<span class="ident" id="8088836">nil</span><span class="op" id="8088839">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088843">[</span><span class="op" id="8088844">]</span><span class="builtintype" id="8088845">byte</span><span class="op" id="8088849">{</span><span class="num" id="8088850">1</span><span class="op" id="8088851">,</span>&nbsp;<span class="builtintype" id="8088853">byte</span><span class="op" id="8088857">(</span><span class="ident" id="8088858">typeStdout</span><span class="op" id="8088868">)</span><span class="op" id="8088869">,</span>&nbsp;<span class="num" id="8088871">0</span><span class="op" id="8088872">,</span>&nbsp;<span class="num" id="8088874">1</span><span class="op" id="8088875">,</span>&nbsp;<span class="num" id="8088877">0</span><span class="op" id="8088878">,</span>&nbsp;<span class="num" id="8088880">0</span><span class="op" id="8088881">,</span>&nbsp;<span class="num" id="8088883">0</span><span class="op" id="8088884">,</span>&nbsp;<span class="num" id="8088886">0</span><span class="op" id="8088887">}</span><span class="op" id="8088888">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088891">}</span><span class="op" id="8088892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8088895">//&nbsp;this&nbsp;data&nbsp;will&nbsp;have&nbsp;to&nbsp;be&nbsp;split&nbsp;into&nbsp;two&nbsp;records</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8088948">{</span><span class="string" id="8088949">&#34;two&nbsp;records&#34;</span><span class="op" id="8088962">,</span>&nbsp;<span class="ident" id="8088964">typeStdin</span><span class="op" id="8088973">,</span>&nbsp;<span class="num" id="8088975">300</span><span class="op" id="8088978">,</span>&nbsp;<span class="builtinfunc" id="8088980">make</span><span class="op" id="8088984">(</span><span class="op" id="8088985">[</span><span class="op" id="8088986">]</span><span class="builtintype" id="8088987">byte</span><span class="op" id="8088991">,</span>&nbsp;<span class="num" id="8088993">66000</span><span class="op" id="8088998">)</span><span class="op" id="8088999">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089003">bytes</span><span class="op" id="8089008">.</span><span class="ident" id="8089009">Join</span><span class="op" id="8089013">(</span><span class="op" id="8089014">[</span><span class="op" id="8089015">]</span><span class="op" id="8089016">[</span><span class="op" id="8089017">]</span><span class="builtintype" id="8089018">byte</span><span class="op" id="8089022">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8089027">//&nbsp;header&nbsp;for&nbsp;the&nbsp;first&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089061">{</span><span class="num" id="8089062">1</span><span class="op" id="8089063">,</span>&nbsp;<span class="builtintype" id="8089065">byte</span><span class="op" id="8089069">(</span><span class="ident" id="8089070">typeStdin</span><span class="op" id="8089079">)</span><span class="op" id="8089080">,</span>&nbsp;<span class="num" id="8089082">0x01</span><span class="op" id="8089086">,</span>&nbsp;<span class="num" id="8089088">0x2C</span><span class="op" id="8089092">,</span>&nbsp;<span class="num" id="8089094">0xFF</span><span class="op" id="8089098">,</span>&nbsp;<span class="num" id="8089100">0xFF</span><span class="op" id="8089104">,</span>&nbsp;<span class="num" id="8089106">1</span><span class="op" id="8089107">,</span>&nbsp;<span class="num" id="8089109">0</span><span class="op" id="8089110">}</span><span class="op" id="8089111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8089116">make</span><span class="op" id="8089120">(</span><span class="op" id="8089121">[</span><span class="op" id="8089122">]</span><span class="builtintype" id="8089123">byte</span><span class="op" id="8089127">,</span>&nbsp;<span class="num" id="8089129">65536</span><span class="op" id="8089134">)</span><span class="op" id="8089135">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8089140">//&nbsp;header&nbsp;for&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089168">{</span><span class="num" id="8089169">1</span><span class="op" id="8089170">,</span>&nbsp;<span class="builtintype" id="8089172">byte</span><span class="op" id="8089176">(</span><span class="ident" id="8089177">typeStdin</span><span class="op" id="8089186">)</span><span class="op" id="8089187">,</span>&nbsp;<span class="num" id="8089189">0x01</span><span class="op" id="8089193">,</span>&nbsp;<span class="num" id="8089195">0x2C</span><span class="op" id="8089199">,</span>&nbsp;<span class="num" id="8089201">0x01</span><span class="op" id="8089205">,</span>&nbsp;<span class="num" id="8089207">0xD1</span><span class="op" id="8089211">,</span>&nbsp;<span class="num" id="8089213">7</span><span class="op" id="8089214">,</span>&nbsp;<span class="num" id="8089216">0</span><span class="op" id="8089217">}</span><span class="op" id="8089218">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8089223">make</span><span class="op" id="8089227">(</span><span class="op" id="8089228">[</span><span class="op" id="8089229">]</span><span class="builtintype" id="8089230">byte</span><span class="op" id="8089234">,</span>&nbsp;<span class="num" id="8089236">472</span><span class="op" id="8089239">)</span><span class="op" id="8089240">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8089245">//&nbsp;header&nbsp;for&nbsp;the&nbsp;empty&nbsp;record</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089279">{</span><span class="num" id="8089280">1</span><span class="op" id="8089281">,</span>&nbsp;<span class="builtintype" id="8089283">byte</span><span class="op" id="8089287">(</span><span class="ident" id="8089288">typeStdin</span><span class="op" id="8089297">)</span><span class="op" id="8089298">,</span>&nbsp;<span class="num" id="8089300">0x01</span><span class="op" id="8089304">,</span>&nbsp;<span class="num" id="8089306">0x2C</span><span class="op" id="8089310">,</span>&nbsp;<span class="num" id="8089312">0</span><span class="op" id="8089313">,</span>&nbsp;<span class="num" id="8089315">0</span><span class="op" id="8089316">,</span>&nbsp;<span class="num" id="8089318">0</span><span class="op" id="8089319">,</span>&nbsp;<span class="num" id="8089321">0</span><span class="op" id="8089322">}</span><span class="op" id="8089323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089327">}</span><span class="op" id="8089328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089333">nil</span><span class="op" id="8089336">)</span><span class="op" id="8089337">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089340">}</span><span class="op" id="8089341">,</span><br>
<span class="lineno"></span><span class="op" id="8089343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8089346">type</span>&nbsp;<span class="ident" id="8089351">nilCloser</span>&nbsp;<span class="keyword" id="8089361">struct</span>&nbsp;<span class="op" id="8089368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089371">io</span><span class="op" id="8089373">.</span><span class="ident" id="8089374">ReadWriter</span><br>
<span class="lineno">70</span><span class="op" id="8089385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8089388">func</span>&nbsp;<span class="op" id="8089393">(</span><span class="ident" id="8089394">c</span>&nbsp;<span class="op" id="8089396">*</span><span class="ident" id="8089397">nilCloser</span><span class="op" id="8089406">)</span>&nbsp;<span class="ident" id="8089408">Close</span><span class="op" id="8089413">(</span><span class="op" id="8089414">)</span>&nbsp;<span class="builtintype" id="8089416">error</span>&nbsp;<span class="op" id="8089422">{</span>&nbsp;<span class="keyword" id="8089424">return</span>&nbsp;<span class="ident" id="8089431">nil</span>&nbsp;<span class="op" id="8089435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8089438">func</span>&nbsp;<span class="ident" id="8089443">TestStreams</span><span class="op" id="8089454">(</span><span class="ident" id="8089455">t</span>&nbsp;<span class="op" id="8089457">*</span><span class="ident" id="8089458">testing</span><span class="op" id="8089465">.</span><span class="ident" id="8089466">T</span><span class="op" id="8089467">)</span>&nbsp;<span class="op" id="8089469">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089472">var</span>&nbsp;<span class="ident" id="8089476">rec</span>&nbsp;<span class="ident" id="8089480">record</span><br>
<span class="lineno"></span><span class="ident" id="8089487">outer</span><span class="op" id="8089492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089495">for</span>&nbsp;<span class="ident" id="8089499">_</span><span class="op" id="8089500">,</span>&nbsp;<span class="ident" id="8089502">test</span>&nbsp;<span class="op" id="8089507">:=</span>&nbsp;<span class="keyword" id="8089510">range</span>&nbsp;<span class="ident" id="8089516">streamTests</span>&nbsp;<span class="op" id="8089528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089532">buf</span>&nbsp;<span class="op" id="8089536">:=</span>&nbsp;<span class="ident" id="8089539">bytes</span><span class="op" id="8089544">.</span><span class="ident" id="8089545">NewBuffer</span><span class="op" id="8089554">(</span><span class="ident" id="8089555">test</span><span class="op" id="8089559">.</span><span class="ident" id="8089560">raw</span><span class="op" id="8089563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089567">var</span>&nbsp;<span class="ident" id="8089571">content</span>&nbsp;<span class="op" id="8089579">[</span><span class="op" id="8089580">]</span><span class="builtintype" id="8089581">byte</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089588">for</span>&nbsp;<span class="ident" id="8089592">buf</span><span class="op" id="8089595">.</span><span class="ident" id="8089596">Len</span><span class="op" id="8089599">(</span><span class="op" id="8089600">)</span>&nbsp;<span class="op" id="8089602">&gt;</span>&nbsp;<span class="num" id="8089604">0</span>&nbsp;<span class="op" id="8089606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089611">if</span>&nbsp;<span class="ident" id="8089614">err</span>&nbsp;<span class="op" id="8089618">:=</span>&nbsp;<span class="ident" id="8089621">rec</span><span class="op" id="8089624">.</span><span class="ident" id="8089625">read</span><span class="op" id="8089629">(</span><span class="ident" id="8089630">buf</span><span class="op" id="8089633">)</span><span class="op" id="8089634">;</span>&nbsp;<span class="ident" id="8089636">err</span>&nbsp;<span class="op" id="8089640">!=</span>&nbsp;<span class="ident" id="8089643">nil</span>&nbsp;<span class="op" id="8089647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089653">t</span><span class="op" id="8089654">.</span><span class="ident" id="8089655">Errorf</span><span class="op" id="8089661">(</span><span class="string" id="8089662">&#34;%s:&nbsp;error&nbsp;reading&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8089692">,</span>&nbsp;<span class="ident" id="8089694">test</span><span class="op" id="8089698">.</span><span class="ident" id="8089699">desc</span><span class="op" id="8089703">,</span>&nbsp;<span class="ident" id="8089705">err</span><span class="op" id="8089708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089714">continue</span>&nbsp;<span class="ident" id="8089723">outer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089732">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089737">content</span>&nbsp;<span class="op" id="8089745">=</span>&nbsp;<span class="builtinfunc" id="8089747">append</span><span class="op" id="8089753">(</span><span class="ident" id="8089754">content</span><span class="op" id="8089761">,</span>&nbsp;<span class="ident" id="8089763">rec</span><span class="op" id="8089766">.</span><span class="ident" id="8089767">content</span><span class="op" id="8089774">(</span><span class="op" id="8089775">)</span><span class="op" id="8089776">...</span><span class="op" id="8089779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089787">if</span>&nbsp;<span class="ident" id="8089790">rec</span><span class="op" id="8089793">.</span><span class="ident" id="8089794">h</span><span class="op" id="8089795">.</span><span class="ident" id="8089796">Type</span>&nbsp;<span class="op" id="8089801">!=</span>&nbsp;<span class="ident" id="8089804">test</span><span class="op" id="8089808">.</span><span class="ident" id="8089809">recType</span>&nbsp;<span class="op" id="8089817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089822">t</span><span class="op" id="8089823">.</span><span class="ident" id="8089824">Errorf</span><span class="op" id="8089830">(</span><span class="string" id="8089831">&#34;%s:&nbsp;got&nbsp;type&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8089860">,</span>&nbsp;<span class="ident" id="8089862">test</span><span class="op" id="8089866">.</span><span class="ident" id="8089867">desc</span><span class="op" id="8089871">,</span>&nbsp;<span class="ident" id="8089873">rec</span><span class="op" id="8089876">.</span><span class="ident" id="8089877">h</span><span class="op" id="8089878">.</span><span class="ident" id="8089879">Type</span><span class="op" id="8089883">,</span>&nbsp;<span class="ident" id="8089885">test</span><span class="op" id="8089889">.</span><span class="ident" id="8089890">recType</span><span class="op" id="8089897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089902">continue</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8089913">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8089917">if</span>&nbsp;<span class="ident" id="8089920">rec</span><span class="op" id="8089923">.</span><span class="ident" id="8089924">h</span><span class="op" id="8089925">.</span><span class="ident" id="8089926">Id</span>&nbsp;<span class="op" id="8089929">!=</span>&nbsp;<span class="ident" id="8089932">test</span><span class="op" id="8089936">.</span><span class="ident" id="8089937">reqId</span>&nbsp;<span class="op" id="8089943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8089948">t</span><span class="op" id="8089949">.</span><span class="ident" id="8089950">Errorf</span><span class="op" id="8089956">(</span><span class="string" id="8089957">&#34;%s:&nbsp;got&nbsp;request&nbsp;ID&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8089992">,</span>&nbsp;<span class="ident" id="8089994">test</span><span class="op" id="8089998">.</span><span class="ident" id="8089999">desc</span><span class="op" id="8090003">,</span>&nbsp;<span class="ident" id="8090005">rec</span><span class="op" id="8090008">.</span><span class="ident" id="8090009">h</span><span class="op" id="8090010">.</span><span class="ident" id="8090011">Id</span><span class="op" id="8090013">,</span>&nbsp;<span class="ident" id="8090015">test</span><span class="op" id="8090019">.</span><span class="ident" id="8090020">reqId</span><span class="op" id="8090025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090030">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090041">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090045">if</span>&nbsp;<span class="op" id="8090048">!</span><span class="ident" id="8090049">bytes</span><span class="op" id="8090054">.</span><span class="ident" id="8090055">Equal</span><span class="op" id="8090060">(</span><span class="ident" id="8090061">content</span><span class="op" id="8090068">,</span>&nbsp;<span class="ident" id="8090070">test</span><span class="op" id="8090074">.</span><span class="ident" id="8090075">content</span><span class="op" id="8090082">)</span>&nbsp;<span class="op" id="8090084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090089">t</span><span class="op" id="8090090">.</span><span class="ident" id="8090091">Errorf</span><span class="op" id="8090097">(</span><span class="string" id="8090098">&#34;%s:&nbsp;read&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8090122">,</span>&nbsp;<span class="ident" id="8090124">test</span><span class="op" id="8090128">.</span><span class="ident" id="8090129">desc</span><span class="op" id="8090133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090138">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090153">buf</span><span class="op" id="8090156">.</span><span class="ident" id="8090157">Reset</span><span class="op" id="8090162">(</span><span class="op" id="8090163">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090167">c</span>&nbsp;<span class="op" id="8090169">:=</span>&nbsp;<span class="ident" id="8090172">newConn</span><span class="op" id="8090179">(</span><span class="op" id="8090180">&amp;</span><span class="ident" id="8090181">nilCloser</span><span class="op" id="8090190">{</span><span class="ident" id="8090191">buf</span><span class="op" id="8090194">}</span><span class="op" id="8090195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090199">w</span>&nbsp;<span class="op" id="8090201">:=</span>&nbsp;<span class="ident" id="8090204">newWriter</span><span class="op" id="8090213">(</span><span class="ident" id="8090214">c</span><span class="op" id="8090215">,</span>&nbsp;<span class="ident" id="8090217">test</span><span class="op" id="8090221">.</span><span class="ident" id="8090222">recType</span><span class="op" id="8090229">,</span>&nbsp;<span class="ident" id="8090231">test</span><span class="op" id="8090235">.</span><span class="ident" id="8090236">reqId</span><span class="op" id="8090241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090245">if</span>&nbsp;<span class="ident" id="8090248">_</span><span class="op" id="8090249">,</span>&nbsp;<span class="ident" id="8090251">err</span>&nbsp;<span class="op" id="8090255">:=</span>&nbsp;<span class="ident" id="8090258">w</span><span class="op" id="8090259">.</span><span class="ident" id="8090260">Write</span><span class="op" id="8090265">(</span><span class="ident" id="8090266">test</span><span class="op" id="8090270">.</span><span class="ident" id="8090271">content</span><span class="op" id="8090278">)</span><span class="op" id="8090279">;</span>&nbsp;<span class="ident" id="8090281">err</span>&nbsp;<span class="op" id="8090285">!=</span>&nbsp;<span class="ident" id="8090288">nil</span>&nbsp;<span class="op" id="8090292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090297">t</span><span class="op" id="8090298">.</span><span class="ident" id="8090299">Errorf</span><span class="op" id="8090305">(</span><span class="string" id="8090306">&#34;%s:&nbsp;error&nbsp;writing&nbsp;record:&nbsp;%v&#34;</span><span class="op" id="8090336">,</span>&nbsp;<span class="ident" id="8090338">test</span><span class="op" id="8090342">.</span><span class="ident" id="8090343">desc</span><span class="op" id="8090347">,</span>&nbsp;<span class="ident" id="8090349">err</span><span class="op" id="8090352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090357">continue</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090372">if</span>&nbsp;<span class="ident" id="8090375">err</span>&nbsp;<span class="op" id="8090379">:=</span>&nbsp;<span class="ident" id="8090382">w</span><span class="op" id="8090383">.</span><span class="ident" id="8090384">Close</span><span class="op" id="8090389">(</span><span class="op" id="8090390">)</span><span class="op" id="8090391">;</span>&nbsp;<span class="ident" id="8090393">err</span>&nbsp;<span class="op" id="8090397">!=</span>&nbsp;<span class="ident" id="8090400">nil</span>&nbsp;<span class="op" id="8090404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090409">t</span><span class="op" id="8090410">.</span><span class="ident" id="8090411">Errorf</span><span class="op" id="8090417">(</span><span class="string" id="8090418">&#34;%s:&nbsp;error&nbsp;closing&nbsp;stream:&nbsp;%v&#34;</span><span class="op" id="8090448">,</span>&nbsp;<span class="ident" id="8090450">test</span><span class="op" id="8090454">.</span><span class="ident" id="8090455">desc</span><span class="op" id="8090459">,</span>&nbsp;<span class="ident" id="8090461">err</span><span class="op" id="8090464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090469">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090480">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090484">if</span>&nbsp;<span class="op" id="8090487">!</span><span class="ident" id="8090488">bytes</span><span class="op" id="8090493">.</span><span class="ident" id="8090494">Equal</span><span class="op" id="8090499">(</span><span class="ident" id="8090500">buf</span><span class="op" id="8090503">.</span><span class="ident" id="8090504">Bytes</span><span class="op" id="8090509">(</span><span class="op" id="8090510">)</span><span class="op" id="8090511">,</span>&nbsp;<span class="ident" id="8090513">test</span><span class="op" id="8090517">.</span><span class="ident" id="8090518">raw</span><span class="op" id="8090521">)</span>&nbsp;<span class="op" id="8090523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090528">t</span><span class="op" id="8090529">.</span><span class="ident" id="8090530">Errorf</span><span class="op" id="8090536">(</span><span class="string" id="8090537">&#34;%s:&nbsp;wrote&nbsp;wrong&nbsp;content&#34;</span><span class="op" id="8090562">,</span>&nbsp;<span class="ident" id="8090564">test</span><span class="op" id="8090568">.</span><span class="ident" id="8090569">desc</span><span class="op" id="8090573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8090580">}</span><br>
<span class="lineno"></span><span class="op" id="8090582">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8090585">type</span>&nbsp;<span class="ident" id="8090590">writeOnlyConn</span>&nbsp;<span class="keyword" id="8090604">struct</span>&nbsp;<span class="op" id="8090611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090614">buf</span>&nbsp;<span class="op" id="8090618">[</span><span class="op" id="8090619">]</span><span class="builtintype" id="8090620">byte</span><br>
<span class="lineno"></span><span class="op" id="8090625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="8090628">func</span>&nbsp;<span class="op" id="8090633">(</span><span class="ident" id="8090634">c</span>&nbsp;<span class="op" id="8090636">*</span><span class="ident" id="8090637">writeOnlyConn</span><span class="op" id="8090650">)</span>&nbsp;<span class="ident" id="8090652">Write</span><span class="op" id="8090657">(</span><span class="ident" id="8090658">p</span>&nbsp;<span class="op" id="8090660">[</span><span class="op" id="8090661">]</span><span class="builtintype" id="8090662">byte</span><span class="op" id="8090666">)</span>&nbsp;<span class="op" id="8090668">(</span><span class="builtintype" id="8090669">int</span><span class="op" id="8090672">,</span>&nbsp;<span class="builtintype" id="8090674">error</span><span class="op" id="8090679">)</span>&nbsp;<span class="op" id="8090681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090684">c</span><span class="op" id="8090685">.</span><span class="ident" id="8090686">buf</span>&nbsp;<span class="op" id="8090690">=</span>&nbsp;<span class="builtinfunc" id="8090692">append</span><span class="op" id="8090698">(</span><span class="ident" id="8090699">c</span><span class="op" id="8090700">.</span><span class="ident" id="8090701">buf</span><span class="op" id="8090704">,</span>&nbsp;<span class="ident" id="8090706">p</span><span class="op" id="8090707">...</span><span class="op" id="8090710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090713">return</span>&nbsp;<span class="builtinfunc" id="8090720">len</span><span class="op" id="8090723">(</span><span class="ident" id="8090724">p</span><span class="op" id="8090725">)</span><span class="op" id="8090726">,</span>&nbsp;<span class="ident" id="8090728">nil</span><br>
<span class="lineno"></span><span class="op" id="8090732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="8090735">func</span>&nbsp;<span class="op" id="8090740">(</span><span class="ident" id="8090741">c</span>&nbsp;<span class="op" id="8090743">*</span><span class="ident" id="8090744">writeOnlyConn</span><span class="op" id="8090757">)</span>&nbsp;<span class="ident" id="8090759">Read</span><span class="op" id="8090763">(</span><span class="ident" id="8090764">p</span>&nbsp;<span class="op" id="8090766">[</span><span class="op" id="8090767">]</span><span class="builtintype" id="8090768">byte</span><span class="op" id="8090772">)</span>&nbsp;<span class="op" id="8090774">(</span><span class="builtintype" id="8090775">int</span><span class="op" id="8090778">,</span>&nbsp;<span class="builtintype" id="8090780">error</span><span class="op" id="8090785">)</span>&nbsp;<span class="op" id="8090787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090790">return</span>&nbsp;<span class="num" id="8090797">0</span><span class="op" id="8090798">,</span>&nbsp;<span class="ident" id="8090800">errors</span><span class="op" id="8090806">.</span><span class="ident" id="8090807">New</span><span class="op" id="8090810">(</span><span class="string" id="8090811">&#34;conn&nbsp;is&nbsp;write-only&#34;</span><span class="op" id="8090831">)</span><br>
<span class="lineno"></span><span class="op" id="8090833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8090836">func</span>&nbsp;<span class="op" id="8090841">(</span><span class="ident" id="8090842">c</span>&nbsp;<span class="op" id="8090844">*</span><span class="ident" id="8090845">writeOnlyConn</span><span class="op" id="8090858">)</span>&nbsp;<span class="ident" id="8090860">Close</span><span class="op" id="8090865">(</span><span class="op" id="8090866">)</span>&nbsp;<span class="builtintype" id="8090868">error</span>&nbsp;<span class="op" id="8090874">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090877">return</span>&nbsp;<span class="ident" id="8090884">nil</span><br>
<span class="lineno"></span><span class="op" id="8090888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8090891">func</span>&nbsp;<span class="ident" id="8090896">TestGetValues</span><span class="op" id="8090909">(</span><span class="ident" id="8090910">t</span>&nbsp;<span class="op" id="8090912">*</span><span class="ident" id="8090913">testing</span><span class="op" id="8090920">.</span><span class="ident" id="8090921">T</span><span class="op" id="8090922">)</span>&nbsp;<span class="op" id="8090924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8090927">var</span>&nbsp;<span class="ident" id="8090931">rec</span>&nbsp;<span class="ident" id="8090935">record</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090943">rec</span><span class="op" id="8090946">.</span><span class="ident" id="8090947">h</span><span class="op" id="8090948">.</span><span class="ident" id="8090949">Type</span>&nbsp;<span class="op" id="8090954">=</span>&nbsp;<span class="ident" id="8090956">typeGetValues</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090972">wc</span>&nbsp;<span class="op" id="8090975">:=</span>&nbsp;<span class="builtinfunc" id="8090978">new</span><span class="op" id="8090981">(</span><span class="ident" id="8090982">writeOnlyConn</span><span class="op" id="8090995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8090998">c</span>&nbsp;<span class="op" id="8091000">:=</span>&nbsp;<span class="ident" id="8091003">newChild</span><span class="op" id="8091011">(</span><span class="ident" id="8091012">wc</span><span class="op" id="8091014">,</span>&nbsp;<span class="ident" id="8091016">nil</span><span class="op" id="8091019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8091022">err</span>&nbsp;<span class="op" id="8091026">:=</span>&nbsp;<span class="ident" id="8091029">c</span><span class="op" id="8091030">.</span><span class="ident" id="8091031">handleRecord</span><span class="op" id="8091043">(</span><span class="op" id="8091044">&amp;</span><span class="ident" id="8091045">rec</span><span class="op" id="8091048">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8091051">if</span>&nbsp;<span class="ident" id="8091054">err</span>&nbsp;<span class="op" id="8091058">!=</span>&nbsp;<span class="ident" id="8091061">nil</span>&nbsp;<span class="op" id="8091065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8091069">t</span><span class="op" id="8091070">.</span><span class="ident" id="8091071">Fatalf</span><span class="op" id="8091077">(</span><span class="string" id="8091078">&#34;handleRecord:&nbsp;%v&#34;</span><span class="op" id="8091096">,</span>&nbsp;<span class="ident" id="8091098">err</span><span class="op" id="8091101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8091104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8091108">const</span>&nbsp;<span class="ident" id="8091114">want</span>&nbsp;<span class="op" id="8091119">=</span>&nbsp;<span class="string" id="8091121">&#34;\x01\n\x00\x00\x00\x12\x06\x00&#34;</span>&nbsp;<span class="op" id="8091154">+</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8091158">&#34;\x0f\x01FCGI_MPXS_CONNS1&#34;</span>&nbsp;<span class="op" id="8091185">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8091189">&#34;\x00\x00\x00\x00\x00\x00\x01\n\x00\x00\x00\x00\x00\x00&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8091247">if</span>&nbsp;<span class="ident" id="8091250">got</span>&nbsp;<span class="op" id="8091254">:=</span>&nbsp;<span class="builtintype" id="8091257">string</span><span class="op" id="8091263">(</span><span class="ident" id="8091264">wc</span><span class="op" id="8091266">.</span><span class="ident" id="8091267">buf</span><span class="op" id="8091270">)</span><span class="op" id="8091271">;</span>&nbsp;<span class="ident" id="8091273">got</span>&nbsp;<span class="op" id="8091277">!=</span>&nbsp;<span class="ident" id="8091280">want</span>&nbsp;<span class="op" id="8091285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8091289">t</span><span class="op" id="8091290">.</span><span class="ident" id="8091291">Errorf</span><span class="op" id="8091297">(</span><span class="string" id="8091298">&#34;&nbsp;got:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8091320">,</span>&nbsp;<span class="ident" id="8091322">got</span><span class="op" id="8091325">,</span>&nbsp;<span class="ident" id="8091327">want</span><span class="op" id="8091331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8091334">}</span><br>
<span class="lineno">150</span><span class="op" id="8091336">}</span>
</div>
</body>
</html>
