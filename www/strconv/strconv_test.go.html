<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1066117">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1066172">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1066226">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1066277">package</span>&nbsp;<span class="ident" id="1066285">strconv_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1066299">import</span>&nbsp;<span class="op" id="1066306">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1066309">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066320">.</span>&nbsp;<span class="string" id="1066322">&#34;strconv&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1066333">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="1066344">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="1066354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1066357">var</span>&nbsp;<span class="op" id="1066361">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066364">globalBuf</span>&nbsp;<span class="op" id="1066374">[</span><span class="num" id="1066375">64</span><span class="op" id="1066377">]</span><span class="builtintype" id="1066378">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066384">nextToOne</span>&nbsp;<span class="op" id="1066394">=</span>&nbsp;<span class="string" id="1066396">&#34;1.00000000000000011102230246251565404236316680908203125&#34;</span>&nbsp;<span class="op" id="1066454">+</span>&nbsp;<span class="ident" id="1066456"><a href="/strconv/strconv_test.go.html#1066333">strings</a></span><span class="op" id="1066463">.</span><span class="ident" id="1066464">Repeat</span><span class="op" id="1066470">(</span><span class="string" id="1066471">&#34;0&#34;</span><span class="op" id="1066474">,</span>&nbsp;<span class="num" id="1066476">10000</span><span class="op" id="1066481">)</span>&nbsp;<span class="op" id="1066483">+</span>&nbsp;<span class="string" id="1066485">&#34;1&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066491">mallocTest</span>&nbsp;<span class="op" id="1066502">=</span>&nbsp;<span class="op" id="1066504">[</span><span class="op" id="1066505">]</span><span class="keyword" id="1066506">struct</span>&nbsp;<span class="op" id="1066513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066517">count</span>&nbsp;<span class="builtintype" id="1066523">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066529">desc</span>&nbsp;&nbsp;<span class="builtintype" id="1066535">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066544">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1066550">func</span><span class="op" id="1066554">(</span><span class="op" id="1066555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066558">}</span><span class="op" id="1066559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066563">{</span><span class="num" id="1066564">0</span><span class="op" id="1066565">,</span>&nbsp;<span class="string" id="1066567">`AppendInt(localBuf[:0],&nbsp;123,&nbsp;10)`</span><span class="op" id="1066601">,</span>&nbsp;<span class="keyword" id="1066603">func</span><span class="op" id="1066607">(</span><span class="op" id="1066608">)</span>&nbsp;<span class="op" id="1066610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1066615">var</span>&nbsp;<span class="ident" id="1066619">localBuf</span>&nbsp;<span class="op" id="1066628">[</span><span class="num" id="1066629">64</span><span class="op" id="1066631">]</span><span class="builtintype" id="1066632">byte</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066640"><a href="/strconv/itoa.go.html#3012634">AppendInt</a></span><span class="op" id="1066649">(</span><span class="ident" id="1066650"><a href="/strconv/strconv_test.go.html#1066619">localBuf</a></span><span class="op" id="1066658">[</span><span class="op" id="1066659">:</span><span class="num" id="1066660">0</span><span class="op" id="1066661">]</span><span class="op" id="1066662">,</span>&nbsp;<span class="num" id="1066664">123</span><span class="op" id="1066667">,</span>&nbsp;<span class="num" id="1066669">10</span><span class="op" id="1066671">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066675">}</span><span class="op" id="1066676">}</span><span class="op" id="1066677">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066681">{</span><span class="num" id="1066682">0</span><span class="op" id="1066683">,</span>&nbsp;<span class="string" id="1066685">`AppendInt(globalBuf[:0],&nbsp;123,&nbsp;10)`</span><span class="op" id="1066720">,</span>&nbsp;<span class="keyword" id="1066722">func</span><span class="op" id="1066726">(</span><span class="op" id="1066727">)</span>&nbsp;<span class="op" id="1066729">{</span>&nbsp;<span class="ident" id="1066731"><a href="/strconv/itoa.go.html#3012634">AppendInt</a></span><span class="op" id="1066740">(</span><span class="ident" id="1066741"><a href="/strconv/strconv_test.go.html#1066364">globalBuf</a></span><span class="op" id="1066750">[</span><span class="op" id="1066751">:</span><span class="num" id="1066752">0</span><span class="op" id="1066753">]</span><span class="op" id="1066754">,</span>&nbsp;<span class="num" id="1066756">123</span><span class="op" id="1066759">,</span>&nbsp;<span class="num" id="1066761">10</span><span class="op" id="1066763">)</span>&nbsp;<span class="op" id="1066765">}</span><span class="op" id="1066766">}</span><span class="op" id="1066767">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066771">{</span><span class="num" id="1066772">0</span><span class="op" id="1066773">,</span>&nbsp;<span class="string" id="1066775">`AppendFloat(localBuf[:0],&nbsp;1.23,&nbsp;&#39;g&#39;,&nbsp;5,&nbsp;64)`</span><span class="op" id="1066820">,</span>&nbsp;<span class="keyword" id="1066822">func</span><span class="op" id="1066826">(</span><span class="op" id="1066827">)</span>&nbsp;<span class="op" id="1066829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1066834">var</span>&nbsp;<span class="ident" id="1066838">localBuf</span>&nbsp;<span class="op" id="1066847">[</span><span class="num" id="1066848">64</span><span class="op" id="1066850">]</span><span class="builtintype" id="1066851">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1066859"><a href="/strconv/ftoa.go.html#2992397">AppendFloat</a></span><span class="op" id="1066870">(</span><span class="ident" id="1066871"><a href="/strconv/strconv_test.go.html#1066838">localBuf</a></span><span class="op" id="1066879">[</span><span class="op" id="1066880">:</span><span class="num" id="1066881">0</span><span class="op" id="1066882">]</span><span class="op" id="1066883">,</span>&nbsp;<span class="num" id="1066885">1.23</span><span class="op" id="1066889">,</span>&nbsp;<span class="string" id="1066891">&#39;g&#39;</span><span class="op" id="1066894">,</span>&nbsp;<span class="num" id="1066896">5</span><span class="op" id="1066897">,</span>&nbsp;<span class="num" id="1066899">64</span><span class="op" id="1066901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066905">}</span><span class="op" id="1066906">}</span><span class="op" id="1066907">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1066911">{</span><span class="num" id="1066912">0</span><span class="op" id="1066913">,</span>&nbsp;<span class="string" id="1066915">`AppendFloat(globalBuf[:0],&nbsp;1.23,&nbsp;&#39;g&#39;,&nbsp;5,&nbsp;64)`</span><span class="op" id="1066961">,</span>&nbsp;<span class="keyword" id="1066963">func</span><span class="op" id="1066967">(</span><span class="op" id="1066968">)</span>&nbsp;<span class="op" id="1066970">{</span>&nbsp;<span class="ident" id="1066972"><a href="/strconv/ftoa.go.html#2992397">AppendFloat</a></span><span class="op" id="1066983">(</span><span class="ident" id="1066984"><a href="/strconv/strconv_test.go.html#1066364">globalBuf</a></span><span class="op" id="1066993">[</span><span class="op" id="1066994">:</span><span class="num" id="1066995">0</span><span class="op" id="1066996">]</span><span class="op" id="1066997">,</span>&nbsp;<span class="num" id="1066999">1.23</span><span class="op" id="1067003">,</span>&nbsp;<span class="string" id="1067005">&#39;g&#39;</span><span class="op" id="1067008">,</span>&nbsp;<span class="num" id="1067010">5</span><span class="op" id="1067011">,</span>&nbsp;<span class="num" id="1067013">64</span><span class="op" id="1067015">)</span>&nbsp;<span class="op" id="1067017">}</span><span class="op" id="1067018">}</span><span class="op" id="1067019">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067023">{</span><span class="num" id="1067024">0</span><span class="op" id="1067025">,</span>&nbsp;<span class="string" id="1067027">`ParseFloat(&#34;123.45&#34;,&nbsp;64)`</span><span class="op" id="1067053">,</span>&nbsp;<span class="keyword" id="1067055">func</span><span class="op" id="1067059">(</span><span class="op" id="1067060">)</span>&nbsp;<span class="op" id="1067062">{</span>&nbsp;<span class="ident" id="1067064"><a href="/strconv/atof.go.html#2957630">ParseFloat</a></span><span class="op" id="1067074">(</span><span class="string" id="1067075">&#34;123.45&#34;</span><span class="op" id="1067083">,</span>&nbsp;<span class="num" id="1067085">64</span><span class="op" id="1067087">)</span>&nbsp;<span class="op" id="1067089">}</span><span class="op" id="1067090">}</span><span class="op" id="1067091">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067095">{</span><span class="num" id="1067096">0</span><span class="op" id="1067097">,</span>&nbsp;<span class="string" id="1067099">`ParseFloat(&#34;123.456789123456789&#34;,&nbsp;64)`</span><span class="op" id="1067138">,</span>&nbsp;<span class="keyword" id="1067140">func</span><span class="op" id="1067144">(</span><span class="op" id="1067145">)</span>&nbsp;<span class="op" id="1067147">{</span>&nbsp;<span class="ident" id="1067149"><a href="/strconv/atof.go.html#2957630">ParseFloat</a></span><span class="op" id="1067159">(</span><span class="string" id="1067160">&#34;123.456789123456789&#34;</span><span class="op" id="1067181">,</span>&nbsp;<span class="num" id="1067183">64</span><span class="op" id="1067185">)</span>&nbsp;<span class="op" id="1067187">}</span><span class="op" id="1067188">}</span><span class="op" id="1067189">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067193">{</span><span class="num" id="1067194">0</span><span class="op" id="1067195">,</span>&nbsp;<span class="string" id="1067197">`ParseFloat(&#34;1.000000000000000111022302462515654042363166809082031251&#34;,&nbsp;64)`</span><span class="op" id="1067273">,</span>&nbsp;<span class="keyword" id="1067275">func</span><span class="op" id="1067279">(</span><span class="op" id="1067280">)</span>&nbsp;<span class="op" id="1067282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067287"><a href="/strconv/atof.go.html#2957630">ParseFloat</a></span><span class="op" id="1067297">(</span><span class="string" id="1067298">&#34;1.000000000000000111022302462515654042363166809082031251&#34;</span><span class="op" id="1067356">,</span>&nbsp;<span class="num" id="1067358">64</span><span class="op" id="1067360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067364">}</span><span class="op" id="1067365">}</span><span class="op" id="1067366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067370">{</span><span class="num" id="1067371">0</span><span class="op" id="1067372">,</span>&nbsp;<span class="string" id="1067374">`ParseFloat(&#34;1.0000000000000001110223024625156540423631668090820312500...001&#34;,&nbsp;64)`</span><span class="op" id="1067457">,</span>&nbsp;<span class="keyword" id="1067459">func</span><span class="op" id="1067463">(</span><span class="op" id="1067464">)</span>&nbsp;<span class="op" id="1067466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067471"><a href="/strconv/atof.go.html#2957630">ParseFloat</a></span><span class="op" id="1067481">(</span><span class="ident" id="1067482"><a href="/strconv/strconv_test.go.html#1066384">nextToOne</a></span><span class="op" id="1067491">,</span>&nbsp;<span class="num" id="1067493">64</span><span class="op" id="1067495">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067499">}</span><span class="op" id="1067500">}</span><span class="op" id="1067501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067504">}</span><br>
<span class="lineno"></span><span class="op" id="1067506">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1067509">func</span>&nbsp;<span class="ident" id="1067514">TestCountMallocs</span><span class="op" id="1067530">(</span><span class="ident" id="1067531">t</span>&nbsp;<span class="op" id="1067533">*</span><span class="ident" id="1067534"><a href="/strconv/strconv_test.go.html#1066344">testing</a></span><span class="op" id="1067541">.</span><span class="ident" id="1067542">T</span><span class="op" id="1067543">)</span>&nbsp;<span class="op" id="1067545">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1067548">if</span>&nbsp;<span class="ident" id="1067551"><a href="/strconv/strconv_test.go.html#1066344">testing</a></span><span class="op" id="1067558">.</span><span class="ident" id="1067559">Short</span><span class="op" id="1067564">(</span><span class="op" id="1067565">)</span>&nbsp;<span class="op" id="1067567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067571"><a href="/strconv/strconv_test.go.html#1067531">t</a></span><span class="op" id="1067572">.</span><span class="ident" id="1067573">Skip</span><span class="op" id="1067577">(</span><span class="string" id="1067578">&#34;skipping&nbsp;malloc&nbsp;count&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="1067615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1067621">if</span>&nbsp;<span class="ident" id="1067624"><a href="/strconv/strconv_test.go.html#1066309">runtime</a></span><span class="op" id="1067631">.</span><span class="ident" id="1067632">GOMAXPROCS</span><span class="op" id="1067642">(</span><span class="num" id="1067643">0</span><span class="op" id="1067644">)</span>&nbsp;<span class="op" id="1067646">&gt;</span>&nbsp;<span class="num" id="1067648">1</span>&nbsp;<span class="op" id="1067650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067654"><a href="/strconv/strconv_test.go.html#1067531">t</a></span><span class="op" id="1067655">.</span><span class="ident" id="1067656">Skip</span><span class="op" id="1067660">(</span><span class="string" id="1067661">&#34;skipping;&nbsp;GOMAXPROCS&gt;1&#34;</span><span class="op" id="1067685">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067688">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1067691">for</span>&nbsp;<span class="ident" id="1067695">_</span><span class="op" id="1067696">,</span>&nbsp;<span class="ident" id="1067698">mt</span>&nbsp;<span class="op" id="1067701">:=</span>&nbsp;<span class="keyword" id="1067704">range</span>&nbsp;<span class="ident" id="1067710"><a href="/strconv/strconv_test.go.html#1066491">mallocTest</a></span>&nbsp;<span class="op" id="1067721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067725">allocs</span>&nbsp;<span class="op" id="1067732">:=</span>&nbsp;<span class="ident" id="1067735"><a href="/strconv/strconv_test.go.html#1066344">testing</a></span><span class="op" id="1067742">.</span><span class="ident" id="1067743">AllocsPerRun</span><span class="op" id="1067755">(</span><span class="num" id="1067756">100</span><span class="op" id="1067759">,</span>&nbsp;<span class="ident" id="1067761"><a href="/strconv/strconv_test.go.html#1067698">mt</a></span><span class="op" id="1067763">.</span><span class="ident" id="1067764">fn</span><span class="op" id="1067766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1067770">if</span>&nbsp;<span class="ident" id="1067773">max</span>&nbsp;<span class="op" id="1067777">:=</span>&nbsp;<span class="builtintype" id="1067780">float64</span><span class="op" id="1067787">(</span><span class="ident" id="1067788"><a href="/strconv/strconv_test.go.html#1067698">mt</a></span><span class="op" id="1067790">.</span><span class="ident" id="1067791">count</span><span class="op" id="1067796">)</span><span class="op" id="1067797">;</span>&nbsp;<span class="ident" id="1067799"><a href="/strconv/strconv_test.go.html#1067725">allocs</a></span>&nbsp;<span class="op" id="1067806">&gt;</span>&nbsp;<span class="ident" id="1067808"><a href="/strconv/strconv_test.go.html#1067773">max</a></span>&nbsp;<span class="op" id="1067812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1067817"><a href="/strconv/strconv_test.go.html#1067531">t</a></span><span class="op" id="1067818">.</span><span class="ident" id="1067819">Errorf</span><span class="op" id="1067825">(</span><span class="string" id="1067826">&#34;%s:&nbsp;%v&nbsp;allocs,&nbsp;want&nbsp;&lt;=%v&#34;</span><span class="op" id="1067852">,</span>&nbsp;<span class="ident" id="1067854"><a href="/strconv/strconv_test.go.html#1067698">mt</a></span><span class="op" id="1067856">.</span><span class="ident" id="1067857">desc</span><span class="op" id="1067861">,</span>&nbsp;<span class="ident" id="1067863"><a href="/strconv/strconv_test.go.html#1067725">allocs</a></span><span class="op" id="1067869">,</span>&nbsp;<span class="ident" id="1067871"><a href="/strconv/strconv_test.go.html#1067773">max</a></span><span class="op" id="1067874">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1067881">}</span><br>
<span class="lineno"></span><span class="op" id="1067883">}</span>
</div>
</body>
</html>
