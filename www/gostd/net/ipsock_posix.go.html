<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html" class="current">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3317492">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3317548">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3317602">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3317653">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris&nbsp;windows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3317731">//&nbsp;Internet&nbsp;protocol&nbsp;family&nbsp;sockets&nbsp;for&nbsp;POSIX</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3317778">package</span>&nbsp;<span class="ident" id="3317786">net</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="3317791">import</span>&nbsp;<span class="op" id="3317798">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3317801">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="3317812">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3317819">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="3317822">func</span>&nbsp;<span class="ident" id="3317827">probeIPv4Stack</span><span class="op" id="3317841">(</span><span class="op" id="3317842">)</span>&nbsp;<span class="builtintype" id="3317844">bool</span>&nbsp;<span class="op" id="3317849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3317852">s</span><span class="op" id="3317853">,</span>&nbsp;<span class="ident" id="3317855">err</span>&nbsp;<span class="op" id="3317859">:=</span>&nbsp;<span class="ident" id="3317862"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317869">.</span><span class="ident" id="3317870"><a href="/gostd/syscall/syscall_unix.go.html#2549902">Socket</a></span><span class="op" id="3317876">(</span><span class="ident" id="3317877"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317884">.</span><span class="ident" id="3317885"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3317892">,</span>&nbsp;<span class="ident" id="3317894"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317901">.</span><span class="ident" id="3317902"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2592030">SOCK_STREAM</a></span><span class="op" id="3317913">,</span>&nbsp;<span class="ident" id="3317915"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317922">.</span><span class="ident" id="3317923"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2566616">IPPROTO_TCP</a></span><span class="op" id="3317934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317937">switch</span>&nbsp;<span class="ident" id="3317944"><a href="/gostd/net/ipsock_posix.go.html#3317855">err</a></span>&nbsp;<span class="op" id="3317948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3317951">case</span>&nbsp;<span class="ident" id="3317956"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317963">.</span><span class="ident" id="3317964"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2600282">EAFNOSUPPORT</a></span><span class="op" id="3317976">,</span>&nbsp;<span class="ident" id="3317978"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3317985">.</span><span class="ident" id="3317986"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2603432">EPROTONOSUPPORT</a></span><span class="op" id="3318001">:</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318005">return</span>&nbsp;<span class="builtintype" id="3318012">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318019">case</span>&nbsp;<span class="builtintype" id="3318024">nil</span><span class="op" id="3318027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318031"><a href="/gostd/net/fd_unix.go.html#3269191">closesocket</a></span><span class="op" id="3318042">(</span><span class="ident" id="3318043"><a href="/gostd/net/ipsock_posix.go.html#3317852">s</a></span><span class="op" id="3318044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318050">return</span>&nbsp;<span class="builtintype" id="3318057">true</span><br>
<span class="lineno">25</span><span class="op" id="3318062">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3318065">//&nbsp;Should&nbsp;we&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;IPv4&nbsp;socket&nbsp;interface&nbsp;if&nbsp;we&#39;re</span><br>
<span class="lineno"></span><span class="comment" id="3318124">//&nbsp;only&nbsp;dealing&nbsp;with&nbsp;IPv4&nbsp;sockets?&nbsp;&nbsp;As&nbsp;long&nbsp;as&nbsp;the&nbsp;host&nbsp;system</span><br>
<span class="lineno"></span><span class="comment" id="3318187">//&nbsp;understands&nbsp;IPv6,&nbsp;it&#39;s&nbsp;okay&nbsp;to&nbsp;pass&nbsp;IPv4&nbsp;addresses&nbsp;to&nbsp;the&nbsp;IPv6</span><br>
<span class="lineno">30</span><span class="comment" id="3318253">//&nbsp;interface.&nbsp;&nbsp;That&nbsp;simplifies&nbsp;our&nbsp;code&nbsp;and&nbsp;is&nbsp;most&nbsp;general.</span><br>
<span class="lineno"></span><span class="comment" id="3318314">//&nbsp;Unfortunately,&nbsp;we&nbsp;need&nbsp;to&nbsp;run&nbsp;on&nbsp;kernels&nbsp;built&nbsp;without&nbsp;IPv6</span><br>
<span class="lineno"></span><span class="comment" id="3318377">//&nbsp;support&nbsp;too.&nbsp;&nbsp;So&nbsp;probe&nbsp;the&nbsp;kernel&nbsp;to&nbsp;figure&nbsp;it&nbsp;out.</span><br>
<span class="lineno"></span><span class="comment" id="3318432">//</span><br>
<span class="lineno"></span><span class="comment" id="3318435">//&nbsp;probeIPv6Stack&nbsp;probes&nbsp;both&nbsp;basic&nbsp;IPv6&nbsp;capability&nbsp;and&nbsp;IPv6&nbsp;IPv4-</span><br>
<span class="lineno">35</span><span class="comment" id="3318502">//&nbsp;mapping&nbsp;capability&nbsp;which&nbsp;is&nbsp;controlled&nbsp;by&nbsp;IPV6_V6ONLY&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="3318566">//&nbsp;option&nbsp;and/or&nbsp;kernel&nbsp;state&nbsp;&#34;net.inet6.ip6.v6only&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3318620">//&nbsp;It&nbsp;returns&nbsp;two&nbsp;boolean&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;first&nbsp;boolean&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3318685">//&nbsp;true,&nbsp;kernel&nbsp;supports&nbsp;basic&nbsp;IPv6&nbsp;functionality.&nbsp;&nbsp;If&nbsp;the&nbsp;second</span><br>
<span class="lineno"></span><span class="comment" id="3318751">//&nbsp;boolean&nbsp;value&nbsp;is&nbsp;true,&nbsp;kernel&nbsp;supports&nbsp;IPv6&nbsp;IPv4-mapping.</span><br>
<span class="lineno">40</span><span class="keyword" id="3318812">func</span>&nbsp;<span class="ident" id="3318817">probeIPv6Stack</span><span class="op" id="3318831">(</span><span class="op" id="3318832">)</span>&nbsp;<span class="op" id="3318834">(</span><span class="ident" id="3318835">supportsIPv6</span><span class="op" id="3318847">,</span>&nbsp;<span class="ident" id="3318849">supportsIPv4map</span>&nbsp;<span class="builtintype" id="3318865">bool</span><span class="op" id="3318869">)</span>&nbsp;<span class="op" id="3318871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3318874">var</span>&nbsp;<span class="ident" id="3318878">probes</span>&nbsp;<span class="op" id="3318885">=</span>&nbsp;<span class="op" id="3318887">[</span><span class="op" id="3318888">]</span><span class="keyword" id="3318889">struct</span>&nbsp;<span class="op" id="3318896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318900">laddr</span>&nbsp;<span class="ident" id="3318906"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318916">value</span>&nbsp;<span class="builtintype" id="3318922">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3318928">ok</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3318934">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318940">}</span><span class="op" id="3318941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3318945">//&nbsp;IPv6&nbsp;communication&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3318980">{</span><span class="ident" id="3318981"><a href="/gostd/net/ipsock_posix.go.html#3318900">laddr</a></span><span class="op" id="3318986">:</span>&nbsp;<span class="ident" id="3318988"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="3318995">{</span><span class="ident" id="3318996"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="3318998">:</span>&nbsp;<span class="ident" id="3319000"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="3319007">(</span><span class="string" id="3319008">&#34;::1&#34;</span><span class="op" id="3319013">)</span><span class="op" id="3319014">}</span><span class="op" id="3319015">,</span>&nbsp;<span class="ident" id="3319017"><a href="/gostd/net/ipsock_posix.go.html#3318916">value</a></span><span class="op" id="3319022">:</span>&nbsp;<span class="num" id="3319024">1</span><span class="op" id="3319025">}</span><span class="op" id="3319026">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3319030">//&nbsp;IPv6&nbsp;IPv4-mapped&nbsp;address&nbsp;communication&nbsp;capability</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319085">{</span><span class="ident" id="3319086"><a href="/gostd/net/ipsock_posix.go.html#3318900">laddr</a></span><span class="op" id="3319091">:</span>&nbsp;<span class="ident" id="3319093"><a href="/gostd/net/tcpsock.go.html#3373469">TCPAddr</a></span><span class="op" id="3319100">{</span><span class="ident" id="3319101"><a href="/gostd/net/tcpsock.go.html#3373487">IP</a></span><span class="op" id="3319103">:</span>&nbsp;<span class="ident" id="3319105"><a href="/gostd/net/ip.go.html#3286541">IPv4</a></span><span class="op" id="3319109">(</span><span class="num" id="3319110">127</span><span class="op" id="3319113">,</span>&nbsp;<span class="num" id="3319115">0</span><span class="op" id="3319116">,</span>&nbsp;<span class="num" id="3319118">0</span><span class="op" id="3319119">,</span>&nbsp;<span class="num" id="3319121">1</span><span class="op" id="3319122">)</span><span class="op" id="3319123">}</span><span class="op" id="3319124">,</span>&nbsp;<span class="ident" id="3319126"><a href="/gostd/net/ipsock_posix.go.html#3318916">value</a></span><span class="op" id="3319131">:</span>&nbsp;<span class="num" id="3319133">0</span><span class="op" id="3319134">}</span><span class="op" id="3319135">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319142">for</span>&nbsp;<span class="ident" id="3319146">i</span>&nbsp;<span class="op" id="3319148">:=</span>&nbsp;<span class="keyword" id="3319151">range</span>&nbsp;<span class="ident" id="3319157"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span>&nbsp;<span class="op" id="3319164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319168">s</span><span class="op" id="3319169">,</span>&nbsp;<span class="ident" id="3319171">err</span>&nbsp;<span class="op" id="3319175">:=</span>&nbsp;<span class="ident" id="3319178"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319185">.</span><span class="ident" id="3319186"><a href="/gostd/syscall/syscall_unix.go.html#2549902">Socket</a></span><span class="op" id="3319192">(</span><span class="ident" id="3319193"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319200">.</span><span class="ident" id="3319201"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3319209">,</span>&nbsp;<span class="ident" id="3319211"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319218">.</span><span class="ident" id="3319219"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2592030">SOCK_STREAM</a></span><span class="op" id="3319230">,</span>&nbsp;<span class="ident" id="3319232"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319239">.</span><span class="ident" id="3319240"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2566616">IPPROTO_TCP</a></span><span class="op" id="3319251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319255">if</span>&nbsp;<span class="ident" id="3319258"><a href="/gostd/net/ipsock_posix.go.html#3319171">err</a></span>&nbsp;<span class="op" id="3319262">!=</span>&nbsp;<span class="builtintype" id="3319265">nil</span>&nbsp;<span class="op" id="3319269">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319274">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319289">defer</span>&nbsp;<span class="ident" id="3319295"><a href="/gostd/net/fd_unix.go.html#3269191">closesocket</a></span><span class="op" id="3319306">(</span><span class="ident" id="3319307"><a href="/gostd/net/ipsock_posix.go.html#3319168">s</a></span><span class="op" id="3319308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319312"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319319">.</span><span class="ident" id="3319320"><a href="/gostd/syscall/syscall_unix.go.html#2548721">SetsockoptInt</a></span><span class="op" id="3319333">(</span><span class="ident" id="3319334"><a href="/gostd/net/ipsock_posix.go.html#3319168">s</a></span><span class="op" id="3319335">,</span>&nbsp;<span class="ident" id="3319337"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319344">.</span><span class="ident" id="3319345"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2566248">IPPROTO_IPV6</a></span><span class="op" id="3319357">,</span>&nbsp;<span class="ident" id="3319359"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319366">.</span><span class="ident" id="3319367"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2568689">IPV6_V6ONLY</a></span><span class="op" id="3319378">,</span>&nbsp;<span class="ident" id="3319380"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span><span class="op" id="3319386">[</span><span class="ident" id="3319387"><a href="/gostd/net/ipsock_posix.go.html#3319146">i</a></span><span class="op" id="3319388">]</span><span class="op" id="3319389">.</span><span class="ident" id="3319390"><a href="/gostd/net/ipsock_posix.go.html#3318916">value</a></span><span class="op" id="3319395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319399">sa</span><span class="op" id="3319401">,</span>&nbsp;<span class="ident" id="3319403"><a href="/gostd/net/ipsock_posix.go.html#3319171">err</a></span>&nbsp;<span class="op" id="3319407">:=</span>&nbsp;<span class="ident" id="3319410"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span><span class="op" id="3319416">[</span><span class="ident" id="3319417"><a href="/gostd/net/ipsock_posix.go.html#3319146">i</a></span><span class="op" id="3319418">]</span><span class="op" id="3319419">.</span><span class="ident" id="3319420"><a href="/gostd/net/ipsock_posix.go.html#3318900">laddr</a></span><span class="op" id="3319425">.</span><span class="ident" id="3319426"><a href="/gostd/net/tcpsock_posix.go.html#3375871">sockaddr</a></span><span class="op" id="3319434">(</span><span class="ident" id="3319435"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319442">.</span><span class="ident" id="3319443"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3319451">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319455">if</span>&nbsp;<span class="ident" id="3319458"><a href="/gostd/net/ipsock_posix.go.html#3319171">err</a></span>&nbsp;<span class="op" id="3319462">!=</span>&nbsp;<span class="builtintype" id="3319465">nil</span>&nbsp;<span class="op" id="3319469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319474">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319489">if</span>&nbsp;<span class="ident" id="3319492">err</span>&nbsp;<span class="op" id="3319496">:=</span>&nbsp;<span class="ident" id="3319499"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3319506">.</span><span class="ident" id="3319507"><a href="/gostd/syscall/syscall_unix.go.html#2547448">Bind</a></span><span class="op" id="3319511">(</span><span class="ident" id="3319512"><a href="/gostd/net/ipsock_posix.go.html#3319168">s</a></span><span class="op" id="3319513">,</span>&nbsp;<span class="ident" id="3319515"><a href="/gostd/net/ipsock_posix.go.html#3319399">sa</a></span><span class="op" id="3319517">)</span><span class="op" id="3319518">;</span>&nbsp;<span class="ident" id="3319520"><a href="/gostd/net/ipsock_posix.go.html#3319492">err</a></span>&nbsp;<span class="op" id="3319524">!=</span>&nbsp;<span class="builtintype" id="3319527">nil</span>&nbsp;<span class="op" id="3319531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319536">continue</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3319551"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span><span class="op" id="3319557">[</span><span class="ident" id="3319558"><a href="/gostd/net/ipsock_posix.go.html#3319146">i</a></span><span class="op" id="3319559">]</span><span class="op" id="3319560">.</span><span class="ident" id="3319561"><a href="/gostd/net/ipsock_posix.go.html#3318928">ok</a></span>&nbsp;<span class="op" id="3319564">=</span>&nbsp;<span class="builtintype" id="3319566">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3319572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3319576">return</span>&nbsp;<span class="ident" id="3319583"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span><span class="op" id="3319589">[</span><span class="num" id="3319590">0</span><span class="op" id="3319591">]</span><span class="op" id="3319592">.</span><span class="ident" id="3319593"><a href="/gostd/net/ipsock_posix.go.html#3318928">ok</a></span><span class="op" id="3319595">,</span>&nbsp;<span class="ident" id="3319597"><a href="/gostd/net/ipsock_posix.go.html#3318878">probes</a></span><span class="op" id="3319603">[</span><span class="num" id="3319604">1</span><span class="op" id="3319605">]</span><span class="op" id="3319606">.</span><span class="ident" id="3319607"><a href="/gostd/net/ipsock_posix.go.html#3318928">ok</a></span><br>
<span class="lineno">70</span><span class="op" id="3319610">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3319613">//&nbsp;favoriteAddrFamily&nbsp;returns&nbsp;the&nbsp;appropriate&nbsp;address&nbsp;family&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3319677">//&nbsp;the&nbsp;given&nbsp;net,&nbsp;laddr,&nbsp;raddr&nbsp;and&nbsp;mode.&nbsp;&nbsp;At&nbsp;first&nbsp;it&nbsp;figures</span><br>
<span class="lineno"></span><span class="comment" id="3319739">//&nbsp;address&nbsp;family&nbsp;out&nbsp;from&nbsp;the&nbsp;net.&nbsp;&nbsp;If&nbsp;mode&nbsp;indicates&nbsp;&#34;listen&#34;</span><br>
<span class="lineno">75</span><span class="comment" id="3319803">//&nbsp;and&nbsp;laddr&nbsp;is&nbsp;a&nbsp;wildcard,&nbsp;it&nbsp;assumes&nbsp;that&nbsp;the&nbsp;user&nbsp;wants&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3319865">//&nbsp;make&nbsp;a&nbsp;passive&nbsp;connection&nbsp;with&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;family,&nbsp;both</span><br>
<span class="lineno"></span><span class="comment" id="3319931">//&nbsp;AF_INET&nbsp;and&nbsp;AF_INET6,&nbsp;and&nbsp;a&nbsp;wildcard&nbsp;address&nbsp;like&nbsp;following:</span><br>
<span class="lineno"></span><span class="comment" id="3319995">//</span><br>
<span class="lineno"></span><span class="comment" id="3319998">//&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;A&nbsp;wild-wild&nbsp;listen,&nbsp;&#34;tcp&#34;&nbsp;+&nbsp;&#34;&#34;</span><br>
<span class="lineno">80</span><span class="comment" id="3320035">//&nbsp;&nbsp;&nbsp;&nbsp;If&nbsp;the&nbsp;platform&nbsp;supports&nbsp;both&nbsp;IPv6&nbsp;and&nbsp;IPv6&nbsp;IPv4-mapping</span><br>
<span class="lineno"></span><span class="comment" id="3320095">//&nbsp;&nbsp;&nbsp;&nbsp;capabilities,&nbsp;we&nbsp;assume&nbsp;that&nbsp;the&nbsp;user&nbsp;want&nbsp;to&nbsp;listen&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="3320154">//&nbsp;&nbsp;&nbsp;&nbsp;both&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;wildcard&nbsp;address&nbsp;over&nbsp;an&nbsp;AF_INET6</span><br>
<span class="lineno"></span><span class="comment" id="3320210">//&nbsp;&nbsp;&nbsp;&nbsp;socket&nbsp;with&nbsp;IPV6_V6ONLY=0.&nbsp;&nbsp;Otherwise&nbsp;we&nbsp;prefer&nbsp;an&nbsp;IPv4</span><br>
<span class="lineno"></span><span class="comment" id="3320269">//&nbsp;&nbsp;&nbsp;&nbsp;wildcard&nbsp;address&nbsp;listen&nbsp;over&nbsp;an&nbsp;AF_INET&nbsp;socket.</span><br>
<span class="lineno">85</span><span class="comment" id="3320320">//</span><br>
<span class="lineno"></span><span class="comment" id="3320323">//&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;A&nbsp;wild-ipv4wild&nbsp;listen,&nbsp;&#34;tcp&#34;&nbsp;+&nbsp;&#34;0.0.0.0&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3320371">//&nbsp;&nbsp;&nbsp;&nbsp;Same&nbsp;as&nbsp;1.</span><br>
<span class="lineno"></span><span class="comment" id="3320385">//</span><br>
<span class="lineno"></span><span class="comment" id="3320388">//&nbsp;&nbsp;&nbsp;&nbsp;3.&nbsp;A&nbsp;wild-ipv6wild&nbsp;listen,&nbsp;&#34;tcp&#34;&nbsp;+&nbsp;&#34;[::]&#34;</span><br>
<span class="lineno">90</span><span class="comment" id="3320433">//&nbsp;&nbsp;&nbsp;&nbsp;Almost&nbsp;same&nbsp;as&nbsp;1&nbsp;but&nbsp;we&nbsp;prefer&nbsp;an&nbsp;IPv6&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="3320492">//&nbsp;&nbsp;&nbsp;&nbsp;listen&nbsp;over&nbsp;an&nbsp;AF_INET6&nbsp;socket&nbsp;with&nbsp;IPV6_V6ONLY=0&nbsp;when</span><br>
<span class="lineno"></span><span class="comment" id="3320550">//&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;platform&nbsp;supports&nbsp;IPv6&nbsp;capability&nbsp;but&nbsp;not&nbsp;IPv6&nbsp;IPv4-</span><br>
<span class="lineno"></span><span class="comment" id="3320610">//&nbsp;&nbsp;&nbsp;&nbsp;mapping&nbsp;capability.</span><br>
<span class="lineno"></span><span class="comment" id="3320633">//</span><br>
<span class="lineno">95</span><span class="comment" id="3320636">//&nbsp;&nbsp;&nbsp;&nbsp;4.&nbsp;A&nbsp;ipv4-ipv4wild&nbsp;listen,&nbsp;&#34;tcp4&#34;&nbsp;+&nbsp;&#34;&#34;&nbsp;or&nbsp;&#34;0.0.0.0&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3320691">//&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;an&nbsp;IPv4&nbsp;(AF_INET)&nbsp;wildcard&nbsp;address&nbsp;listen.</span><br>
<span class="lineno"></span><span class="comment" id="3320744">//</span><br>
<span class="lineno"></span><span class="comment" id="3320747">//&nbsp;&nbsp;&nbsp;&nbsp;5.&nbsp;A&nbsp;ipv6-ipv6wild&nbsp;listen,&nbsp;&#34;tcp6&#34;&nbsp;+&nbsp;&#34;&#34;&nbsp;or&nbsp;&#34;[::]&#34;</span><br>
<span class="lineno"></span><span class="comment" id="3320799">//&nbsp;&nbsp;&nbsp;&nbsp;We&nbsp;use&nbsp;an&nbsp;IPv6&nbsp;(AF_INET6,&nbsp;IPV6_V6ONLY=1)&nbsp;wildcard&nbsp;address</span><br>
<span class="lineno">100</span><span class="comment" id="3320860">//&nbsp;&nbsp;&nbsp;&nbsp;listen.</span><br>
<span class="lineno"></span><span class="comment" id="3320871">//</span><br>
<span class="lineno"></span><span class="comment" id="3320874">//&nbsp;Otherwise&nbsp;guess:&nbsp;if&nbsp;the&nbsp;addresses&nbsp;are&nbsp;IPv4&nbsp;then&nbsp;returns&nbsp;AF_INET,</span><br>
<span class="lineno"></span><span class="comment" id="3320942">//&nbsp;or&nbsp;else&nbsp;returns&nbsp;AF_INET6.&nbsp;&nbsp;It&nbsp;also&nbsp;returns&nbsp;a&nbsp;boolean&nbsp;value&nbsp;what</span><br>
<span class="lineno"></span><span class="comment" id="3321009">//&nbsp;designates&nbsp;IPV6_V6ONLY&nbsp;option.</span><br>
<span class="lineno">105</span><span class="comment" id="3321043">//</span><br>
<span class="lineno"></span><span class="comment" id="3321046">//&nbsp;Note&nbsp;that&nbsp;OpenBSD&nbsp;allows&nbsp;neither&nbsp;&#34;net.inet6.ip6.v6only=1&#34;&nbsp;change</span><br>
<span class="lineno"></span><span class="comment" id="3321114">//&nbsp;nor&nbsp;IPPROTO_IPV6&nbsp;level&nbsp;IPV6_V6ONLY&nbsp;socket&nbsp;option&nbsp;setting.</span><br>
<span class="lineno"></span><span class="keyword" id="3321175">func</span>&nbsp;<span class="ident" id="3321180">favoriteAddrFamily</span><span class="op" id="3321198">(</span><span class="ident" id="3321199">net</span>&nbsp;<span class="builtintype" id="3321203">string</span><span class="op" id="3321209">,</span>&nbsp;<span class="ident" id="3321211">laddr</span><span class="op" id="3321216">,</span>&nbsp;<span class="ident" id="3321218">raddr</span>&nbsp;<span class="ident" id="3321224"><a href="/gostd/net/sock_posix.go.html#3361249">sockaddr</a></span><span class="op" id="3321232">,</span>&nbsp;<span class="ident" id="3321234">mode</span>&nbsp;<span class="builtintype" id="3321239">string</span><span class="op" id="3321245">)</span>&nbsp;<span class="op" id="3321247">(</span><span class="ident" id="3321248">family</span>&nbsp;<span class="builtintype" id="3321255">int</span><span class="op" id="3321258">,</span>&nbsp;<span class="ident" id="3321260">ipv6only</span>&nbsp;<span class="builtintype" id="3321269">bool</span><span class="op" id="3321273">)</span>&nbsp;<span class="op" id="3321275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321278">switch</span>&nbsp;<span class="ident" id="3321285"><a href="/gostd/net/ipsock_posix.go.html#3321199">net</a></span><span class="op" id="3321288">[</span><span class="builtinfunc" id="3321289">len</span><span class="op" id="3321292">(</span><span class="ident" id="3321293"><a href="/gostd/net/ipsock_posix.go.html#3321199">net</a></span><span class="op" id="3321296">)</span><span class="op" id="3321297">-</span><span class="num" id="3321298">1</span><span class="op" id="3321299">]</span>&nbsp;<span class="op" id="3321301">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321304">case</span>&nbsp;<span class="string" id="3321309">&#39;4&#39;</span><span class="op" id="3321312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321316">return</span>&nbsp;<span class="ident" id="3321323"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321330">.</span><span class="ident" id="3321331"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3321338">,</span>&nbsp;<span class="builtintype" id="3321340">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321347">case</span>&nbsp;<span class="string" id="3321352">&#39;6&#39;</span><span class="op" id="3321355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321359">return</span>&nbsp;<span class="ident" id="3321366"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321373">.</span><span class="ident" id="3321374"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3321382">,</span>&nbsp;<span class="builtintype" id="3321384">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321390">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321394">if</span>&nbsp;<span class="ident" id="3321397"><a href="/gostd/net/ipsock_posix.go.html#3321234">mode</a></span>&nbsp;<span class="op" id="3321402">==</span>&nbsp;<span class="string" id="3321405">&#34;listen&#34;</span>&nbsp;<span class="op" id="3321414">&amp;&amp;</span>&nbsp;<span class="op" id="3321417">(</span><span class="ident" id="3321418"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span>&nbsp;<span class="op" id="3321424">==</span>&nbsp;<span class="builtintype" id="3321427">nil</span>&nbsp;<span class="op" id="3321431">||</span>&nbsp;<span class="ident" id="3321434"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span><span class="op" id="3321439">.</span><span class="ident" id="3321440"><a href="/gostd/net/sock_posix.go.html#3361446">isWildcard</a></span><span class="op" id="3321450">(</span><span class="op" id="3321451">)</span><span class="op" id="3321452">)</span>&nbsp;<span class="op" id="3321454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321458">if</span>&nbsp;<span class="ident" id="3321461"><a href="/gostd/net/ipsock.go.html#3309911">supportsIPv4map</a></span>&nbsp;<span class="op" id="3321477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321482">return</span>&nbsp;<span class="ident" id="3321489"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321496">.</span><span class="ident" id="3321497"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3321505">,</span>&nbsp;<span class="builtintype" id="3321507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321515">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321519">if</span>&nbsp;<span class="ident" id="3321522"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span>&nbsp;<span class="op" id="3321528">==</span>&nbsp;<span class="builtintype" id="3321531">nil</span>&nbsp;<span class="op" id="3321535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321540">return</span>&nbsp;<span class="ident" id="3321547"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321554">.</span><span class="ident" id="3321555"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3321562">,</span>&nbsp;<span class="builtintype" id="3321564">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321572">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321576">return</span>&nbsp;<span class="ident" id="3321583"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span><span class="op" id="3321588">.</span><span class="ident" id="3321589"><a href="/gostd/net/sock_posix.go.html#3361361">family</a></span><span class="op" id="3321595">(</span><span class="op" id="3321596">)</span><span class="op" id="3321597">,</span>&nbsp;<span class="builtintype" id="3321599">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321606">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321610">if</span>&nbsp;<span class="op" id="3321613">(</span><span class="ident" id="3321614"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span>&nbsp;<span class="op" id="3321620">==</span>&nbsp;<span class="builtintype" id="3321623">nil</span>&nbsp;<span class="op" id="3321627">||</span>&nbsp;<span class="ident" id="3321630"><a href="/gostd/net/ipsock_posix.go.html#3321211">laddr</a></span><span class="op" id="3321635">.</span><span class="ident" id="3321636"><a href="/gostd/net/sock_posix.go.html#3361361">family</a></span><span class="op" id="3321642">(</span><span class="op" id="3321643">)</span>&nbsp;<span class="op" id="3321645">==</span>&nbsp;<span class="ident" id="3321648"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321655">.</span><span class="ident" id="3321656"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3321663">)</span>&nbsp;<span class="op" id="3321665">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321670">(</span><span class="ident" id="3321671"><a href="/gostd/net/ipsock_posix.go.html#3321218">raddr</a></span>&nbsp;<span class="op" id="3321677">==</span>&nbsp;<span class="builtintype" id="3321680">nil</span>&nbsp;<span class="op" id="3321684">||</span>&nbsp;<span class="ident" id="3321687"><a href="/gostd/net/ipsock_posix.go.html#3321218">raddr</a></span><span class="op" id="3321692">.</span><span class="ident" id="3321693"><a href="/gostd/net/sock_posix.go.html#3361361">family</a></span><span class="op" id="3321699">(</span><span class="op" id="3321700">)</span>&nbsp;<span class="op" id="3321702">==</span>&nbsp;<span class="ident" id="3321705"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321712">.</span><span class="ident" id="3321713"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3321720">)</span>&nbsp;<span class="op" id="3321722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321726">return</span>&nbsp;<span class="ident" id="3321733"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321740">.</span><span class="ident" id="3321741"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3321748">,</span>&nbsp;<span class="builtintype" id="3321750">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3321757">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3321760">return</span>&nbsp;<span class="ident" id="3321767"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3321774">.</span><span class="ident" id="3321775"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3321783">,</span>&nbsp;<span class="builtintype" id="3321785">false</span><br>
<span class="lineno"></span><span class="op" id="3321791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3321794">//&nbsp;Internet&nbsp;sockets&nbsp;(TCP,&nbsp;UDP,&nbsp;IP)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="3321830">func</span>&nbsp;<span class="ident" id="3321835">internetSocket</span><span class="op" id="3321849">(</span><span class="ident" id="3321850">net</span>&nbsp;<span class="builtintype" id="3321854">string</span><span class="op" id="3321860">,</span>&nbsp;<span class="ident" id="3321862">laddr</span><span class="op" id="3321867">,</span>&nbsp;<span class="ident" id="3321869">raddr</span>&nbsp;<span class="ident" id="3321875"><a href="/gostd/net/sock_posix.go.html#3361249">sockaddr</a></span><span class="op" id="3321883">,</span>&nbsp;<span class="ident" id="3321885">deadline</span>&nbsp;<span class="ident" id="3321894"><a href="/gostd/net/ipsock_posix.go.html#3317812">time</a></span><span class="op" id="3321898">.</span><span class="ident" id="3321899"><a href="/gostd/time/time.go.html#2722087">Time</a></span><span class="op" id="3321903">,</span>&nbsp;<span class="ident" id="3321905">sotype</span><span class="op" id="3321911">,</span>&nbsp;<span class="ident" id="3321913">proto</span>&nbsp;<span class="builtintype" id="3321919">int</span><span class="op" id="3321922">,</span>&nbsp;<span class="ident" id="3321924">mode</span>&nbsp;<span class="builtintype" id="3321929">string</span><span class="op" id="3321935">)</span>&nbsp;<span class="op" id="3321937">(</span><span class="ident" id="3321938">fd</span>&nbsp;<span class="op" id="3321941">*</span><span class="ident" id="3321942"><a href="/gostd/net/fd_unix.go.html#3257361">netFD</a></span><span class="op" id="3321947">,</span>&nbsp;<span class="ident" id="3321949">err</span>&nbsp;<span class="builtintype" id="3321953">error</span><span class="op" id="3321958">)</span>&nbsp;<span class="op" id="3321960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3321963">family</span><span class="op" id="3321969">,</span>&nbsp;<span class="ident" id="3321971">ipv6only</span>&nbsp;<span class="op" id="3321980">:=</span>&nbsp;<span class="ident" id="3321983"><a href="/gostd/net/ipsock_posix.go.html#3321180">favoriteAddrFamily</a></span><span class="op" id="3322001">(</span><span class="ident" id="3322002"><a href="/gostd/net/ipsock_posix.go.html#3321850">net</a></span><span class="op" id="3322005">,</span>&nbsp;<span class="ident" id="3322007"><a href="/gostd/net/ipsock_posix.go.html#3321862">laddr</a></span><span class="op" id="3322012">,</span>&nbsp;<span class="ident" id="3322014"><a href="/gostd/net/ipsock_posix.go.html#3321869">raddr</a></span><span class="op" id="3322019">,</span>&nbsp;<span class="ident" id="3322021"><a href="/gostd/net/ipsock_posix.go.html#3321924">mode</a></span><span class="op" id="3322025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322028">return</span>&nbsp;<span class="ident" id="3322035"><a href="/gostd/net/sock_posix.go.html#3361809">socket</a></span><span class="op" id="3322041">(</span><span class="ident" id="3322042"><a href="/gostd/net/ipsock_posix.go.html#3321850">net</a></span><span class="op" id="3322045">,</span>&nbsp;<span class="ident" id="3322047"><a href="/gostd/net/ipsock_posix.go.html#3321963">family</a></span><span class="op" id="3322053">,</span>&nbsp;<span class="ident" id="3322055"><a href="/gostd/net/ipsock_posix.go.html#3321905">sotype</a></span><span class="op" id="3322061">,</span>&nbsp;<span class="ident" id="3322063"><a href="/gostd/net/ipsock_posix.go.html#3321913">proto</a></span><span class="op" id="3322068">,</span>&nbsp;<span class="ident" id="3322070"><a href="/gostd/net/ipsock_posix.go.html#3321971">ipv6only</a></span><span class="op" id="3322078">,</span>&nbsp;<span class="ident" id="3322080"><a href="/gostd/net/ipsock_posix.go.html#3321862">laddr</a></span><span class="op" id="3322085">,</span>&nbsp;<span class="ident" id="3322087"><a href="/gostd/net/ipsock_posix.go.html#3321869">raddr</a></span><span class="op" id="3322092">,</span>&nbsp;<span class="ident" id="3322094"><a href="/gostd/net/ipsock_posix.go.html#3321885">deadline</a></span><span class="op" id="3322102">)</span><br>
<span class="lineno"></span><span class="op" id="3322104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="keyword" id="3322107">func</span>&nbsp;<span class="ident" id="3322112">ipToSockaddr</span><span class="op" id="3322124">(</span><span class="ident" id="3322125">family</span>&nbsp;<span class="builtintype" id="3322132">int</span><span class="op" id="3322135">,</span>&nbsp;<span class="ident" id="3322137">ip</span>&nbsp;<span class="ident" id="3322140"><a href="/gostd/net/ip.go.html#3286271">IP</a></span><span class="op" id="3322142">,</span>&nbsp;<span class="ident" id="3322144">port</span>&nbsp;<span class="builtintype" id="3322149">int</span><span class="op" id="3322152">,</span>&nbsp;<span class="ident" id="3322154">zone</span>&nbsp;<span class="builtintype" id="3322159">string</span><span class="op" id="3322165">)</span>&nbsp;<span class="op" id="3322167">(</span><span class="ident" id="3322168"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3322175">.</span><span class="ident" id="3322176"><a href="/gostd/syscall/syscall_unix.go.html#2547075">Sockaddr</a></span><span class="op" id="3322184">,</span>&nbsp;<span class="builtintype" id="3322186">error</span><span class="op" id="3322191">)</span>&nbsp;<span class="op" id="3322193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322196">switch</span>&nbsp;<span class="ident" id="3322203"><a href="/gostd/net/ipsock_posix.go.html#3322125">family</a></span>&nbsp;<span class="op" id="3322210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322213">case</span>&nbsp;<span class="ident" id="3322218"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3322225">.</span><span class="ident" id="3322226"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551244">AF_INET</a></span><span class="op" id="3322233">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322237">if</span>&nbsp;<span class="builtinfunc" id="3322240">len</span><span class="op" id="3322243">(</span><span class="ident" id="3322244"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322246">)</span>&nbsp;<span class="op" id="3322248">==</span>&nbsp;<span class="num" id="3322251">0</span>&nbsp;<span class="op" id="3322253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322258"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322261">=</span>&nbsp;<span class="ident" id="3322263"><a href="/gostd/net/ip.go.html#3287657">IPv4zero</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322278">if</span>&nbsp;<span class="ident" id="3322281"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322284">=</span>&nbsp;<span class="ident" id="3322286"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322288">.</span><span class="ident" id="3322289"><a href="/gostd/net/ip.go.html#3290039">To4</a></span><span class="op" id="3322292">(</span><span class="op" id="3322293">)</span><span class="op" id="3322294">;</span>&nbsp;<span class="ident" id="3322296"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322299">==</span>&nbsp;<span class="builtintype" id="3322302">nil</span>&nbsp;<span class="op" id="3322306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322311">return</span>&nbsp;<span class="builtintype" id="3322318">nil</span><span class="op" id="3322321">,</span>&nbsp;<span class="ident" id="3322323"><a href="/gostd/net/net.go.html#3343197">InvalidAddrError</a></span><span class="op" id="3322339">(</span><span class="string" id="3322340">&#34;non-IPv4&nbsp;address&#34;</span><span class="op" id="3322358">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322362">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322366">sa</span>&nbsp;<span class="op" id="3322369">:=</span>&nbsp;<span class="builtinfunc" id="3322372">new</span><span class="op" id="3322375">(</span><span class="ident" id="3322376"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3322383">.</span><span class="ident" id="3322384"><a href="/gostd/syscall/syscall_unix.go.html#2547205">SockaddrInet4</a></span><span class="op" id="3322397">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322401">for</span>&nbsp;<span class="ident" id="3322405">i</span>&nbsp;<span class="op" id="3322407">:=</span>&nbsp;<span class="num" id="3322410">0</span><span class="op" id="3322411">;</span>&nbsp;<span class="ident" id="3322413"><a href="/gostd/net/ipsock_posix.go.html#3322405">i</a></span>&nbsp;<span class="op" id="3322415">&lt;</span>&nbsp;<span class="ident" id="3322417"><a href="/gostd/net/ip.go.html#3285851">IPv4len</a></span><span class="op" id="3322424">;</span>&nbsp;<span class="ident" id="3322426"><a href="/gostd/net/ipsock_posix.go.html#3322405">i</a></span><span class="op" id="3322427">++</span>&nbsp;<span class="op" id="3322430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322435"><a href="/gostd/net/ipsock_posix.go.html#3322366">sa</a></span><span class="op" id="3322437">.</span><span class="ident" id="3322438"><a href="/gostd/syscall/syscall_unix.go.html#2547239">Addr</a></span><span class="op" id="3322442">[</span><span class="ident" id="3322443"><a href="/gostd/net/ipsock_posix.go.html#3322405">i</a></span><span class="op" id="3322444">]</span>&nbsp;<span class="op" id="3322446">=</span>&nbsp;<span class="ident" id="3322448"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322450">[</span><span class="ident" id="3322451"><a href="/gostd/net/ipsock_posix.go.html#3322405">i</a></span><span class="op" id="3322452">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322460"><a href="/gostd/net/ipsock_posix.go.html#3322366">sa</a></span><span class="op" id="3322462">.</span><span class="ident" id="3322463"><a href="/gostd/syscall/syscall_unix.go.html#2547229">Port</a></span>&nbsp;<span class="op" id="3322468">=</span>&nbsp;<span class="ident" id="3322470"><a href="/gostd/net/ipsock_posix.go.html#3322144">port</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322477">return</span>&nbsp;<span class="ident" id="3322484"><a href="/gostd/net/ipsock_posix.go.html#3322366">sa</a></span><span class="op" id="3322486">,</span>&nbsp;<span class="builtintype" id="3322488">nil</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322493">case</span>&nbsp;<span class="ident" id="3322498"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3322505">.</span><span class="ident" id="3322506"><a href="/gostd/syscall/zerrors_linux_amd64.go.html#2551284">AF_INET6</a></span><span class="op" id="3322514">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322518">if</span>&nbsp;<span class="builtinfunc" id="3322521">len</span><span class="op" id="3322524">(</span><span class="ident" id="3322525"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322527">)</span>&nbsp;<span class="op" id="3322529">==</span>&nbsp;<span class="num" id="3322532">0</span>&nbsp;<span class="op" id="3322534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322539"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322542">=</span>&nbsp;<span class="ident" id="3322544"><a href="/gostd/net/ip.go.html#3287750">IPv6zero</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3322559">//&nbsp;IPv4&nbsp;callers&nbsp;use&nbsp;0.0.0.0&nbsp;to&nbsp;mean&nbsp;&#34;announce&nbsp;on&nbsp;any&nbsp;available&nbsp;address&#34;.</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3322634">//&nbsp;In&nbsp;IPv6&nbsp;mode,&nbsp;Linux&nbsp;treats&nbsp;that&nbsp;as&nbsp;meaning&nbsp;&#34;announce&nbsp;on&nbsp;0.0.0.0&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3322705">//&nbsp;which&nbsp;it&nbsp;refuses&nbsp;to&nbsp;do.&nbsp;&nbsp;Rewrite&nbsp;to&nbsp;the&nbsp;IPv6&nbsp;unspecified&nbsp;address.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322776">if</span>&nbsp;<span class="ident" id="3322779"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322781">.</span><span class="ident" id="3322782"><a href="/gostd/net/ip.go.html#3293893">Equal</a></span><span class="op" id="3322787">(</span><span class="ident" id="3322788"><a href="/gostd/net/ip.go.html#3287657">IPv4zero</a></span><span class="op" id="3322796">)</span>&nbsp;<span class="op" id="3322798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322803"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322806">=</span>&nbsp;<span class="ident" id="3322808"><a href="/gostd/net/ip.go.html#3287750">IPv6zero</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322819">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322823">if</span>&nbsp;<span class="ident" id="3322826"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322829">=</span>&nbsp;<span class="ident" id="3322831"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322833">.</span><span class="ident" id="3322834"><a href="/gostd/net/ip.go.html#3290366">To16</a></span><span class="op" id="3322838">(</span><span class="op" id="3322839">)</span><span class="op" id="3322840">;</span>&nbsp;<span class="ident" id="3322842"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span>&nbsp;<span class="op" id="3322845">==</span>&nbsp;<span class="builtintype" id="3322848">nil</span>&nbsp;<span class="op" id="3322852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322857">return</span>&nbsp;<span class="builtintype" id="3322864">nil</span><span class="op" id="3322867">,</span>&nbsp;<span class="ident" id="3322869"><a href="/gostd/net/net.go.html#3343197">InvalidAddrError</a></span><span class="op" id="3322885">(</span><span class="string" id="3322886">&#34;non-IPv6&nbsp;address&#34;</span><span class="op" id="3322904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3322908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322912">sa</span>&nbsp;<span class="op" id="3322915">:=</span>&nbsp;<span class="builtinfunc" id="3322918">new</span><span class="op" id="3322921">(</span><span class="ident" id="3322922"><a href="/gostd/net/ipsock_posix.go.html#3317801">syscall</a></span><span class="op" id="3322929">.</span><span class="ident" id="3322930"><a href="/gostd/syscall/syscall_unix.go.html#2547283">SockaddrInet6</a></span><span class="op" id="3322943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3322947">for</span>&nbsp;<span class="ident" id="3322951">i</span>&nbsp;<span class="op" id="3322953">:=</span>&nbsp;<span class="num" id="3322956">0</span><span class="op" id="3322957">;</span>&nbsp;<span class="ident" id="3322959"><a href="/gostd/net/ipsock_posix.go.html#3322951">i</a></span>&nbsp;<span class="op" id="3322961">&lt;</span>&nbsp;<span class="ident" id="3322963"><a href="/gostd/net/ip.go.html#3285864">IPv6len</a></span><span class="op" id="3322970">;</span>&nbsp;<span class="ident" id="3322972"><a href="/gostd/net/ipsock_posix.go.html#3322951">i</a></span><span class="op" id="3322973">++</span>&nbsp;<span class="op" id="3322976">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3322981"><a href="/gostd/net/ipsock_posix.go.html#3322912">sa</a></span><span class="op" id="3322983">.</span><span class="ident" id="3322984"><a href="/gostd/syscall/syscall_unix.go.html#2547334">Addr</a></span><span class="op" id="3322988">[</span><span class="ident" id="3322989"><a href="/gostd/net/ipsock_posix.go.html#3322951">i</a></span><span class="op" id="3322990">]</span>&nbsp;<span class="op" id="3322992">=</span>&nbsp;<span class="ident" id="3322994"><a href="/gostd/net/ipsock_posix.go.html#3322137">ip</a></span><span class="op" id="3322996">[</span><span class="ident" id="3322997"><a href="/gostd/net/ipsock_posix.go.html#3322951">i</a></span><span class="op" id="3322998">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3323002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323006"><a href="/gostd/net/ipsock_posix.go.html#3322912">sa</a></span><span class="op" id="3323008">.</span><span class="ident" id="3323009"><a href="/gostd/syscall/syscall_unix.go.html#2547307">Port</a></span>&nbsp;<span class="op" id="3323014">=</span>&nbsp;<span class="ident" id="3323016"><a href="/gostd/net/ipsock_posix.go.html#3322144">port</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3323023"><a href="/gostd/net/ipsock_posix.go.html#3322912">sa</a></span><span class="op" id="3323025">.</span><span class="ident" id="3323026"><a href="/gostd/syscall/syscall_unix.go.html#2547319">ZoneId</a></span>&nbsp;<span class="op" id="3323033">=</span>&nbsp;<span class="builtintype" id="3323035">uint32</span><span class="op" id="3323041">(</span><span class="ident" id="3323042"><a href="/gostd/net/ipsock.go.html#3317319">zoneToInt</a></span><span class="op" id="3323051">(</span><span class="ident" id="3323052"><a href="/gostd/net/ipsock_posix.go.html#3322154">zone</a></span><span class="op" id="3323056">)</span><span class="op" id="3323057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323061">return</span>&nbsp;<span class="ident" id="3323068"><a href="/gostd/net/ipsock_posix.go.html#3322912">sa</a></span><span class="op" id="3323070">,</span>&nbsp;<span class="builtintype" id="3323072">nil</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3323077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3323080">return</span>&nbsp;<span class="builtintype" id="3323087">nil</span><span class="op" id="3323090">,</span>&nbsp;<span class="ident" id="3323092"><a href="/gostd/net/net.go.html#3343197">InvalidAddrError</a></span><span class="op" id="3323108">(</span><span class="string" id="3323109">&#34;unexpected&nbsp;socket&nbsp;family&#34;</span><span class="op" id="3323135">)</span><br>
<span class="lineno"></span><span class="op" id="3323137">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
