<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html" class="current">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5041781">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5041836">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5041890">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5041941">package</span>&nbsp;<span class="ident" id="5041949">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5041956">import</span>&nbsp;<span class="op" id="5041963">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5041966">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5041973">&#34;sort&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5041981">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5041988">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5041991">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5042072">//&nbsp;Positions</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5042086">//&nbsp;Position&nbsp;describes&nbsp;an&nbsp;arbitrary&nbsp;source&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5042137">//&nbsp;including&nbsp;the&nbsp;file,&nbsp;line,&nbsp;and&nbsp;column&nbsp;location.</span><br>
<span class="lineno"></span><span class="comment" id="5042187">//&nbsp;A&nbsp;Position&nbsp;is&nbsp;valid&nbsp;if&nbsp;the&nbsp;line&nbsp;number&nbsp;is&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5042237">//</span><br>
<span class="lineno">20</span><span class="keyword" id="5042240">type</span>&nbsp;<span class="ident" id="5042245">Position</span>&nbsp;<span class="keyword" id="5042254">struct</span>&nbsp;<span class="op" id="5042261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042264">Filename</span>&nbsp;<span class="builtintype" id="5042273">string</span>&nbsp;<span class="comment" id="5042280">//&nbsp;filename,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042301">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5042310">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5042317">//&nbsp;offset,&nbsp;starting&nbsp;at&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042343">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5042352">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5042359">//&nbsp;line&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042390">Column</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5042399">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5042406">//&nbsp;column&nbsp;number,&nbsp;starting&nbsp;at&nbsp;1&nbsp;(character&nbsp;count)</span><br>
<span class="lineno">25</span><span class="op" id="5042456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5042459">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5042509">func</span>&nbsp;<span class="op" id="5042514">(</span><span class="ident" id="5042515">pos</span>&nbsp;<span class="op" id="5042519">*</span><span class="ident" id="5042520">Position</span><span class="op" id="5042528">)</span>&nbsp;<span class="ident" id="5042530">IsValid</span><span class="op" id="5042537">(</span><span class="op" id="5042538">)</span>&nbsp;<span class="builtintype" id="5042540">bool</span>&nbsp;<span class="op" id="5042545">{</span>&nbsp;<span class="keyword" id="5042547">return</span>&nbsp;<span class="ident" id="5042554">pos</span><span class="op" id="5042557">.</span><span class="ident" id="5042558">Line</span>&nbsp;<span class="op" id="5042563">&gt;</span>&nbsp;<span class="num" id="5042565">0</span>&nbsp;<span class="op" id="5042567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5042570">//&nbsp;String&nbsp;returns&nbsp;a&nbsp;string&nbsp;in&nbsp;one&nbsp;of&nbsp;several&nbsp;forms:</span><br>
<span class="lineno"></span><span class="comment" id="5042622">//</span><br>
<span class="lineno"></span><span class="comment" id="5042625">//&nbsp;&nbsp;&nbsp;&nbsp;file:line:column&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5042678">//&nbsp;&nbsp;&nbsp;&nbsp;line:column&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;valid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5042734">//&nbsp;&nbsp;&nbsp;&nbsp;file&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;with&nbsp;file&nbsp;name</span><br>
<span class="lineno">35</span><span class="comment" id="5042789">//&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;invalid&nbsp;position&nbsp;without&nbsp;file&nbsp;name</span><br>
<span class="lineno"></span><span class="comment" id="5042847">//</span><br>
<span class="lineno"></span><span class="keyword" id="5042850">func</span>&nbsp;<span class="op" id="5042855">(</span><span class="ident" id="5042856">pos</span>&nbsp;<span class="ident" id="5042860">Position</span><span class="op" id="5042868">)</span>&nbsp;<span class="ident" id="5042870">String</span><span class="op" id="5042876">(</span><span class="op" id="5042877">)</span>&nbsp;<span class="builtintype" id="5042879">string</span>&nbsp;<span class="op" id="5042886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042889">s</span>&nbsp;<span class="op" id="5042891">:=</span>&nbsp;<span class="ident" id="5042894">pos</span><span class="op" id="5042897">.</span><span class="ident" id="5042898">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5042908">if</span>&nbsp;<span class="ident" id="5042911">pos</span><span class="op" id="5042914">.</span><span class="ident" id="5042915">IsValid</span><span class="op" id="5042922">(</span><span class="op" id="5042923">)</span>&nbsp;<span class="op" id="5042925">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5042929">if</span>&nbsp;<span class="ident" id="5042932">s</span>&nbsp;<span class="op" id="5042934">!=</span>&nbsp;<span class="string" id="5042937">&#34;&#34;</span>&nbsp;<span class="op" id="5042940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042945">s</span>&nbsp;<span class="op" id="5042947">+=</span>&nbsp;<span class="string" id="5042950">&#34;:&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5042956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5042960">s</span>&nbsp;<span class="op" id="5042962">+=</span>&nbsp;<span class="ident" id="5042965">fmt</span><span class="op" id="5042968">.</span><span class="ident" id="5042969">Sprintf</span><span class="op" id="5042976">(</span><span class="string" id="5042977">&#34;%d:%d&#34;</span><span class="op" id="5042984">,</span>&nbsp;<span class="ident" id="5042986">pos</span><span class="op" id="5042989">.</span><span class="ident" id="5042990">Line</span><span class="op" id="5042994">,</span>&nbsp;<span class="ident" id="5042996">pos</span><span class="op" id="5042999">.</span><span class="ident" id="5043000">Column</span><span class="op" id="5043006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5043009">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5043012">if</span>&nbsp;<span class="ident" id="5043015">s</span>&nbsp;<span class="op" id="5043017">==</span>&nbsp;<span class="string" id="5043020">&#34;&#34;</span>&nbsp;<span class="op" id="5043023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5043027">s</span>&nbsp;<span class="op" id="5043029">=</span>&nbsp;<span class="string" id="5043031">&#34;-&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5043036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5043039">return</span>&nbsp;<span class="ident" id="5043046">s</span><br>
<span class="lineno"></span><span class="op" id="5043048">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="5043051">//&nbsp;Pos&nbsp;is&nbsp;a&nbsp;compact&nbsp;encoding&nbsp;of&nbsp;a&nbsp;source&nbsp;position&nbsp;within&nbsp;a&nbsp;file&nbsp;set.</span><br>
<span class="lineno"></span><span class="comment" id="5043120">//&nbsp;It&nbsp;can&nbsp;be&nbsp;converted&nbsp;into&nbsp;a&nbsp;Position&nbsp;for&nbsp;a&nbsp;more&nbsp;convenient,&nbsp;but&nbsp;much</span><br>
<span class="lineno"></span><span class="comment" id="5043191">//&nbsp;larger,&nbsp;representation.</span><br>
<span class="lineno"></span><span class="comment" id="5043218">//</span><br>
<span class="lineno">55</span><span class="comment" id="5043221">//&nbsp;The&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;is&nbsp;a&nbsp;number&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size],</span><br>
<span class="lineno"></span><span class="comment" id="5043299">//&nbsp;where&nbsp;base&nbsp;and&nbsp;size&nbsp;are&nbsp;specified&nbsp;when&nbsp;adding&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="5043377">//&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="comment" id="5043389">//</span><br>
<span class="lineno"></span><span class="comment" id="5043392">//&nbsp;To&nbsp;create&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;a&nbsp;specific&nbsp;source&nbsp;offset,&nbsp;first&nbsp;add</span><br>
<span class="lineno">60</span><span class="comment" id="5043459">//&nbsp;the&nbsp;respective&nbsp;file&nbsp;to&nbsp;the&nbsp;current&nbsp;file&nbsp;set&nbsp;(via&nbsp;FileSet.AddFile)</span><br>
<span class="lineno"></span><span class="comment" id="5043528">//&nbsp;and&nbsp;then&nbsp;call&nbsp;File.Pos(offset)&nbsp;for&nbsp;that&nbsp;file.&nbsp;Given&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p</span><br>
<span class="lineno"></span><span class="comment" id="5043597">//&nbsp;for&nbsp;a&nbsp;specific&nbsp;file&nbsp;set&nbsp;fset,&nbsp;the&nbsp;corresponding&nbsp;Position&nbsp;value&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5043666">//&nbsp;obtained&nbsp;by&nbsp;calling&nbsp;fset.Position(p).</span><br>
<span class="lineno"></span><span class="comment" id="5043707">//</span><br>
<span class="lineno">65</span><span class="comment" id="5043710">//&nbsp;Pos&nbsp;values&nbsp;can&nbsp;be&nbsp;compared&nbsp;directly&nbsp;with&nbsp;the&nbsp;usual&nbsp;comparison&nbsp;operators:</span><br>
<span class="lineno"></span><span class="comment" id="5043786">//&nbsp;If&nbsp;two&nbsp;Pos&nbsp;values&nbsp;p&nbsp;and&nbsp;q&nbsp;are&nbsp;in&nbsp;the&nbsp;same&nbsp;file,&nbsp;comparing&nbsp;p&nbsp;and&nbsp;q&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5043858">//&nbsp;equivalent&nbsp;to&nbsp;comparing&nbsp;the&nbsp;respective&nbsp;source&nbsp;file&nbsp;offsets.&nbsp;If&nbsp;p&nbsp;and&nbsp;q</span><br>
<span class="lineno"></span><span class="comment" id="5043932">//&nbsp;are&nbsp;in&nbsp;different&nbsp;files,&nbsp;p&nbsp;&lt;&nbsp;q&nbsp;is&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;p&nbsp;was&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5044008">//&nbsp;to&nbsp;the&nbsp;respective&nbsp;file&nbsp;set&nbsp;before&nbsp;the&nbsp;file&nbsp;implied&nbsp;by&nbsp;q.</span><br>
<span class="lineno">70</span><span class="comment" id="5044068">//</span><br>
<span class="lineno"></span><span class="keyword" id="5044071">type</span>&nbsp;<span class="ident" id="5044076">Pos</span>&nbsp;<span class="builtintype" id="5044080">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044085">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;Pos&nbsp;is&nbsp;NoPos;&nbsp;there&nbsp;is&nbsp;no&nbsp;file&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5044159">//&nbsp;associated&nbsp;with&nbsp;it,&nbsp;and&nbsp;NoPos().IsValid()&nbsp;is&nbsp;false.&nbsp;NoPos&nbsp;is&nbsp;always</span><br>
<span class="lineno">75</span><span class="comment" id="5044230">//&nbsp;smaller&nbsp;than&nbsp;any&nbsp;other&nbsp;Pos&nbsp;value.&nbsp;The&nbsp;corresponding&nbsp;Position&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="5044300">//&nbsp;for&nbsp;NoPos&nbsp;is&nbsp;the&nbsp;zero&nbsp;value&nbsp;for&nbsp;Position.</span><br>
<span class="lineno"></span><span class="comment" id="5044345">//</span><br>
<span class="lineno"></span><span class="keyword" id="5044348">const</span>&nbsp;<span class="ident" id="5044354">NoPos</span>&nbsp;<span class="ident" id="5044360">Pos</span>&nbsp;<span class="op" id="5044364">=</span>&nbsp;<span class="num" id="5044366">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="5044369">//&nbsp;IsValid&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;position&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5044419">func</span>&nbsp;<span class="op" id="5044424">(</span><span class="ident" id="5044425">p</span>&nbsp;<span class="ident" id="5044427">Pos</span><span class="op" id="5044430">)</span>&nbsp;<span class="ident" id="5044432">IsValid</span><span class="op" id="5044439">(</span><span class="op" id="5044440">)</span>&nbsp;<span class="builtintype" id="5044442">bool</span>&nbsp;<span class="op" id="5044447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5044450">return</span>&nbsp;<span class="ident" id="5044457">p</span>&nbsp;<span class="op" id="5044459">!=</span>&nbsp;<span class="ident" id="5044462">NoPos</span><br>
<span class="lineno"></span><span class="op" id="5044468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5044471">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5044552">//&nbsp;File</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5044561">//&nbsp;A&nbsp;File&nbsp;is&nbsp;a&nbsp;handle&nbsp;for&nbsp;a&nbsp;file&nbsp;belonging&nbsp;to&nbsp;a&nbsp;FileSet.</span><br>
<span class="lineno"></span><span class="comment" id="5044618">//&nbsp;A&nbsp;File&nbsp;has&nbsp;a&nbsp;name,&nbsp;size,&nbsp;and&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno">90</span><span class="comment" id="5044669">//</span><br>
<span class="lineno"></span><span class="keyword" id="5044672">type</span>&nbsp;<span class="ident" id="5044677">File</span>&nbsp;<span class="keyword" id="5044682">struct</span>&nbsp;<span class="op" id="5044689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5044692">set</span>&nbsp;&nbsp;<span class="op" id="5044697">*</span><span class="ident" id="5044698">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5044707">name</span>&nbsp;<span class="builtintype" id="5044712">string</span>&nbsp;<span class="comment" id="5044719">//&nbsp;file&nbsp;name&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5044756">base</span>&nbsp;<span class="builtintype" id="5044761">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044768">//&nbsp;Pos&nbsp;value&nbsp;range&nbsp;for&nbsp;this&nbsp;file&nbsp;is&nbsp;[base...base+size]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5044824">size</span>&nbsp;<span class="builtintype" id="5044829">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044836">//&nbsp;file&nbsp;size&nbsp;as&nbsp;provided&nbsp;to&nbsp;AddFile</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5044874">//&nbsp;lines&nbsp;and&nbsp;infos&nbsp;are&nbsp;protected&nbsp;by&nbsp;set.mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5044921">lines</span>&nbsp;<span class="op" id="5044927">[</span><span class="op" id="5044928">]</span><span class="builtintype" id="5044929">int</span>&nbsp;<span class="comment" id="5044933">//&nbsp;lines&nbsp;contains&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;for&nbsp;each&nbsp;line&nbsp;(the&nbsp;first&nbsp;entry&nbsp;is&nbsp;always&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045030">infos</span>&nbsp;<span class="op" id="5045036">[</span><span class="op" id="5045037">]</span><span class="ident" id="5045038">lineInfo</span><br>
<span class="lineno">100</span><span class="op" id="5045047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045050">//&nbsp;Name&nbsp;returns&nbsp;the&nbsp;file&nbsp;name&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5045118">func</span>&nbsp;<span class="op" id="5045123">(</span><span class="ident" id="5045124">f</span>&nbsp;<span class="op" id="5045126">*</span><span class="ident" id="5045127">File</span><span class="op" id="5045131">)</span>&nbsp;<span class="ident" id="5045133">Name</span><span class="op" id="5045137">(</span><span class="op" id="5045138">)</span>&nbsp;<span class="builtintype" id="5045140">string</span>&nbsp;<span class="op" id="5045147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5045150">return</span>&nbsp;<span class="ident" id="5045157">f</span><span class="op" id="5045158">.</span><span class="ident" id="5045159">name</span><br>
<span class="lineno">105</span><span class="op" id="5045164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045167">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;base&nbsp;offset&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5045237">func</span>&nbsp;<span class="op" id="5045242">(</span><span class="ident" id="5045243">f</span>&nbsp;<span class="op" id="5045245">*</span><span class="ident" id="5045246">File</span><span class="op" id="5045250">)</span>&nbsp;<span class="ident" id="5045252">Base</span><span class="op" id="5045256">(</span><span class="op" id="5045257">)</span>&nbsp;<span class="builtintype" id="5045259">int</span>&nbsp;<span class="op" id="5045263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5045266">return</span>&nbsp;<span class="ident" id="5045273">f</span><span class="op" id="5045274">.</span><span class="ident" id="5045275">base</span><br>
<span class="lineno">110</span><span class="op" id="5045280">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045283">//&nbsp;Size&nbsp;returns&nbsp;the&nbsp;size&nbsp;of&nbsp;file&nbsp;f&nbsp;as&nbsp;registered&nbsp;with&nbsp;AddFile.</span><br>
<span class="lineno"></span><span class="keyword" id="5045346">func</span>&nbsp;<span class="op" id="5045351">(</span><span class="ident" id="5045352">f</span>&nbsp;<span class="op" id="5045354">*</span><span class="ident" id="5045355">File</span><span class="op" id="5045359">)</span>&nbsp;<span class="ident" id="5045361">Size</span><span class="op" id="5045365">(</span><span class="op" id="5045366">)</span>&nbsp;<span class="builtintype" id="5045368">int</span>&nbsp;<span class="op" id="5045372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5045375">return</span>&nbsp;<span class="ident" id="5045382">f</span><span class="op" id="5045383">.</span><span class="ident" id="5045384">size</span><br>
<span class="lineno">115</span><span class="op" id="5045389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045392">//&nbsp;LineCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;lines&nbsp;in&nbsp;file&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="5045444">func</span>&nbsp;<span class="op" id="5045449">(</span><span class="ident" id="5045450">f</span>&nbsp;<span class="op" id="5045452">*</span><span class="ident" id="5045453">File</span><span class="op" id="5045457">)</span>&nbsp;<span class="ident" id="5045459">LineCount</span><span class="op" id="5045468">(</span><span class="op" id="5045469">)</span>&nbsp;<span class="builtintype" id="5045471">int</span>&nbsp;<span class="op" id="5045475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045478">f</span><span class="op" id="5045479">.</span><span class="ident" id="5045480">set</span><span class="op" id="5045483">.</span><span class="ident" id="5045484">mutex</span><span class="op" id="5045489">.</span><span class="ident" id="5045490">RLock</span><span class="op" id="5045495">(</span><span class="op" id="5045496">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045499">n</span>&nbsp;<span class="op" id="5045501">:=</span>&nbsp;<span class="builtinfunc" id="5045504">len</span><span class="op" id="5045507">(</span><span class="ident" id="5045508">f</span><span class="op" id="5045509">.</span><span class="ident" id="5045510">lines</span><span class="op" id="5045515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045518">f</span><span class="op" id="5045519">.</span><span class="ident" id="5045520">set</span><span class="op" id="5045523">.</span><span class="ident" id="5045524">mutex</span><span class="op" id="5045529">.</span><span class="ident" id="5045530">RUnlock</span><span class="op" id="5045537">(</span><span class="op" id="5045538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5045541">return</span>&nbsp;<span class="ident" id="5045548">n</span><br>
<span class="lineno"></span><span class="op" id="5045550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="comment" id="5045553">//&nbsp;AddLine&nbsp;adds&nbsp;the&nbsp;line&nbsp;offset&nbsp;for&nbsp;a&nbsp;new&nbsp;line.</span><br>
<span class="lineno"></span><span class="comment" id="5045601">//&nbsp;The&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5045673">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;line&nbsp;offset&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5045746">//</span><br>
<span class="lineno"></span><span class="keyword" id="5045749">func</span>&nbsp;<span class="op" id="5045754">(</span><span class="ident" id="5045755">f</span>&nbsp;<span class="op" id="5045757">*</span><span class="ident" id="5045758">File</span><span class="op" id="5045762">)</span>&nbsp;<span class="ident" id="5045764">AddLine</span><span class="op" id="5045771">(</span><span class="ident" id="5045772">offset</span>&nbsp;<span class="builtintype" id="5045779">int</span><span class="op" id="5045782">)</span>&nbsp;<span class="op" id="5045784">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045787">f</span><span class="op" id="5045788">.</span><span class="ident" id="5045789">set</span><span class="op" id="5045792">.</span><span class="ident" id="5045793">mutex</span><span class="op" id="5045798">.</span><span class="ident" id="5045799">Lock</span><span class="op" id="5045803">(</span><span class="op" id="5045804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5045807">if</span>&nbsp;<span class="ident" id="5045810">i</span>&nbsp;<span class="op" id="5045812">:=</span>&nbsp;<span class="builtinfunc" id="5045815">len</span><span class="op" id="5045818">(</span><span class="ident" id="5045819">f</span><span class="op" id="5045820">.</span><span class="ident" id="5045821">lines</span><span class="op" id="5045826">)</span><span class="op" id="5045827">;</span>&nbsp;<span class="op" id="5045829">(</span><span class="ident" id="5045830">i</span>&nbsp;<span class="op" id="5045832">==</span>&nbsp;<span class="num" id="5045835">0</span>&nbsp;<span class="op" id="5045837">||</span>&nbsp;<span class="ident" id="5045840">f</span><span class="op" id="5045841">.</span><span class="ident" id="5045842">lines</span><span class="op" id="5045847">[</span><span class="ident" id="5045848">i</span><span class="op" id="5045849">-</span><span class="num" id="5045850">1</span><span class="op" id="5045851">]</span>&nbsp;<span class="op" id="5045853">&lt;</span>&nbsp;<span class="ident" id="5045855">offset</span><span class="op" id="5045861">)</span>&nbsp;<span class="op" id="5045863">&amp;&amp;</span>&nbsp;<span class="ident" id="5045866">offset</span>&nbsp;<span class="op" id="5045873">&lt;</span>&nbsp;<span class="ident" id="5045875">f</span><span class="op" id="5045876">.</span><span class="ident" id="5045877">size</span>&nbsp;<span class="op" id="5045882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045886">f</span><span class="op" id="5045887">.</span><span class="ident" id="5045888">lines</span>&nbsp;<span class="op" id="5045894">=</span>&nbsp;<span class="builtinfunc" id="5045896">append</span><span class="op" id="5045902">(</span><span class="ident" id="5045903">f</span><span class="op" id="5045904">.</span><span class="ident" id="5045905">lines</span><span class="op" id="5045910">,</span>&nbsp;<span class="ident" id="5045912">offset</span><span class="op" id="5045918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5045921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5045924">f</span><span class="op" id="5045925">.</span><span class="ident" id="5045926">set</span><span class="op" id="5045929">.</span><span class="ident" id="5045930">mutex</span><span class="op" id="5045935">.</span><span class="ident" id="5045936">Unlock</span><span class="op" id="5045942">(</span><span class="op" id="5045943">)</span><br>
<span class="lineno">135</span><span class="op" id="5045945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5045948">//&nbsp;MergeLine&nbsp;merges&nbsp;a&nbsp;line&nbsp;with&nbsp;the&nbsp;following&nbsp;line.&nbsp;It&nbsp;is&nbsp;akin&nbsp;to&nbsp;replacing</span><br>
<span class="lineno"></span><span class="comment" id="5046024">//&nbsp;the&nbsp;newline&nbsp;character&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;line&nbsp;with&nbsp;a&nbsp;space&nbsp;(to&nbsp;not&nbsp;change&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5046104">//&nbsp;remaining&nbsp;offsets).&nbsp;To&nbsp;obtain&nbsp;the&nbsp;line&nbsp;number,&nbsp;consult&nbsp;e.g.&nbsp;Position.Line.</span><br>
<span class="lineno">140</span><span class="comment" id="5046182">//&nbsp;MergeLine&nbsp;will&nbsp;panic&nbsp;if&nbsp;given&nbsp;an&nbsp;invalid&nbsp;line&nbsp;number.</span><br>
<span class="lineno"></span><span class="comment" id="5046239">//</span><br>
<span class="lineno"></span><span class="keyword" id="5046242">func</span>&nbsp;<span class="op" id="5046247">(</span><span class="ident" id="5046248">f</span>&nbsp;<span class="op" id="5046250">*</span><span class="ident" id="5046251">File</span><span class="op" id="5046255">)</span>&nbsp;<span class="ident" id="5046257">MergeLine</span><span class="op" id="5046266">(</span><span class="ident" id="5046267">line</span>&nbsp;<span class="builtintype" id="5046272">int</span><span class="op" id="5046275">)</span>&nbsp;<span class="op" id="5046277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5046280">if</span>&nbsp;<span class="ident" id="5046283">line</span>&nbsp;<span class="op" id="5046288">&lt;=</span>&nbsp;<span class="num" id="5046291">0</span>&nbsp;<span class="op" id="5046293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5046297">panic</span><span class="op" id="5046302">(</span><span class="string" id="5046303">&#34;illegal&nbsp;line&nbsp;number&nbsp;(line&nbsp;numbering&nbsp;starts&nbsp;at&nbsp;1)&#34;</span><span class="op" id="5046353">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5046356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5046359">f</span><span class="op" id="5046360">.</span><span class="ident" id="5046361">set</span><span class="op" id="5046364">.</span><span class="ident" id="5046365">mutex</span><span class="op" id="5046370">.</span><span class="ident" id="5046371">Lock</span><span class="op" id="5046375">(</span><span class="op" id="5046376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5046379">defer</span>&nbsp;<span class="ident" id="5046385">f</span><span class="op" id="5046386">.</span><span class="ident" id="5046387">set</span><span class="op" id="5046390">.</span><span class="ident" id="5046391">mutex</span><span class="op" id="5046396">.</span><span class="ident" id="5046397">Unlock</span><span class="op" id="5046403">(</span><span class="op" id="5046404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5046407">if</span>&nbsp;<span class="ident" id="5046410">line</span>&nbsp;<span class="op" id="5046415">&gt;=</span>&nbsp;<span class="builtinfunc" id="5046418">len</span><span class="op" id="5046421">(</span><span class="ident" id="5046422">f</span><span class="op" id="5046423">.</span><span class="ident" id="5046424">lines</span><span class="op" id="5046429">)</span>&nbsp;<span class="op" id="5046431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5046435">panic</span><span class="op" id="5046440">(</span><span class="string" id="5046441">&#34;illegal&nbsp;line&nbsp;number&#34;</span><span class="op" id="5046462">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5046465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5046468">//&nbsp;To&nbsp;merge&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line&gt;&nbsp;with&nbsp;the&nbsp;line&nbsp;numbered&nbsp;&lt;line+1&gt;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5046539">//&nbsp;we&nbsp;need&nbsp;to&nbsp;remove&nbsp;the&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5046606">//&nbsp;numbered&nbsp;&lt;line+1&gt;.&nbsp;The&nbsp;entry&nbsp;in&nbsp;lines&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5046674">//&nbsp;numbered&nbsp;&lt;line+1&gt;&nbsp;is&nbsp;located&nbsp;at&nbsp;index&nbsp;&lt;line&gt;,&nbsp;since&nbsp;indices&nbsp;in&nbsp;lines</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5046747">//&nbsp;are&nbsp;0-based&nbsp;and&nbsp;line&nbsp;numbers&nbsp;are&nbsp;1-based.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5046793">copy</span><span class="op" id="5046797">(</span><span class="ident" id="5046798">f</span><span class="op" id="5046799">.</span><span class="ident" id="5046800">lines</span><span class="op" id="5046805">[</span><span class="ident" id="5046806">line</span><span class="op" id="5046810">:</span><span class="op" id="5046811">]</span><span class="op" id="5046812">,</span>&nbsp;<span class="ident" id="5046814">f</span><span class="op" id="5046815">.</span><span class="ident" id="5046816">lines</span><span class="op" id="5046821">[</span><span class="ident" id="5046822">line</span><span class="op" id="5046826">+</span><span class="num" id="5046827">1</span><span class="op" id="5046828">:</span><span class="op" id="5046829">]</span><span class="op" id="5046830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5046833">f</span><span class="op" id="5046834">.</span><span class="ident" id="5046835">lines</span>&nbsp;<span class="op" id="5046841">=</span>&nbsp;<span class="ident" id="5046843">f</span><span class="op" id="5046844">.</span><span class="ident" id="5046845">lines</span><span class="op" id="5046850">[</span><span class="op" id="5046851">:</span><span class="builtinfunc" id="5046852">len</span><span class="op" id="5046855">(</span><span class="ident" id="5046856">f</span><span class="op" id="5046857">.</span><span class="ident" id="5046858">lines</span><span class="op" id="5046863">)</span><span class="op" id="5046864">-</span><span class="num" id="5046865">1</span><span class="op" id="5046866">]</span><br>
<span class="lineno"></span><span class="op" id="5046868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5046871">//&nbsp;SetLines&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;a&nbsp;file&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;successful.</span><br>
<span class="lineno"></span><span class="comment" id="5046948">//&nbsp;The&nbsp;line&nbsp;offsets&nbsp;are&nbsp;the&nbsp;offsets&nbsp;of&nbsp;the&nbsp;first&nbsp;character&nbsp;of&nbsp;each&nbsp;line;</span><br>
<span class="lineno"></span><span class="comment" id="5047021">//&nbsp;for&nbsp;instance&nbsp;for&nbsp;the&nbsp;content&nbsp;&#34;ab\nc\n&#34;&nbsp;the&nbsp;line&nbsp;offsets&nbsp;are&nbsp;{0,&nbsp;3}.</span><br>
<span class="lineno"></span><span class="comment" id="5047092">//&nbsp;An&nbsp;empty&nbsp;file&nbsp;has&nbsp;an&nbsp;empty&nbsp;line&nbsp;offset&nbsp;table.</span><br>
<span class="lineno"></span><span class="comment" id="5047141">//&nbsp;Each&nbsp;line&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;previous&nbsp;line</span><br>
<span class="lineno">165</span><span class="comment" id="5047214">//&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;SetLines&nbsp;fails&nbsp;and&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="5047286">//&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5047296">//</span><br>
<span class="lineno"></span><span class="keyword" id="5047299">func</span>&nbsp;<span class="op" id="5047304">(</span><span class="ident" id="5047305">f</span>&nbsp;<span class="op" id="5047307">*</span><span class="ident" id="5047308">File</span><span class="op" id="5047312">)</span>&nbsp;<span class="ident" id="5047314">SetLines</span><span class="op" id="5047322">(</span><span class="ident" id="5047323">lines</span>&nbsp;<span class="op" id="5047329">[</span><span class="op" id="5047330">]</span><span class="builtintype" id="5047331">int</span><span class="op" id="5047334">)</span>&nbsp;<span class="builtintype" id="5047336">bool</span>&nbsp;<span class="op" id="5047341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5047344">//&nbsp;verify&nbsp;validity&nbsp;of&nbsp;lines&nbsp;table</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047379">size</span>&nbsp;<span class="op" id="5047384">:=</span>&nbsp;<span class="ident" id="5047387">f</span><span class="op" id="5047388">.</span><span class="ident" id="5047389">size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047395">for</span>&nbsp;<span class="ident" id="5047399">i</span><span class="op" id="5047400">,</span>&nbsp;<span class="ident" id="5047402">offset</span>&nbsp;<span class="op" id="5047409">:=</span>&nbsp;<span class="keyword" id="5047412">range</span>&nbsp;<span class="ident" id="5047418">lines</span>&nbsp;<span class="op" id="5047424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047428">if</span>&nbsp;<span class="ident" id="5047431">i</span>&nbsp;<span class="op" id="5047433">&gt;</span>&nbsp;<span class="num" id="5047435">0</span>&nbsp;<span class="op" id="5047437">&amp;&amp;</span>&nbsp;<span class="ident" id="5047440">offset</span>&nbsp;<span class="op" id="5047447">&lt;=</span>&nbsp;<span class="ident" id="5047450">lines</span><span class="op" id="5047455">[</span><span class="ident" id="5047456">i</span><span class="op" id="5047457">-</span><span class="num" id="5047458">1</span><span class="op" id="5047459">]</span>&nbsp;<span class="op" id="5047461">||</span>&nbsp;<span class="ident" id="5047464">size</span>&nbsp;<span class="op" id="5047469">&lt;=</span>&nbsp;<span class="ident" id="5047472">offset</span>&nbsp;<span class="op" id="5047479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047484">return</span>&nbsp;<span class="builtintype" id="5047491">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047499">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5047506">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047526">f</span><span class="op" id="5047527">.</span><span class="ident" id="5047528">set</span><span class="op" id="5047531">.</span><span class="ident" id="5047532">mutex</span><span class="op" id="5047537">.</span><span class="ident" id="5047538">Lock</span><span class="op" id="5047542">(</span><span class="op" id="5047543">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047546">f</span><span class="op" id="5047547">.</span><span class="ident" id="5047548">lines</span>&nbsp;<span class="op" id="5047554">=</span>&nbsp;<span class="ident" id="5047556">lines</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047563">f</span><span class="op" id="5047564">.</span><span class="ident" id="5047565">set</span><span class="op" id="5047568">.</span><span class="ident" id="5047569">mutex</span><span class="op" id="5047574">.</span><span class="ident" id="5047575">Unlock</span><span class="op" id="5047581">(</span><span class="op" id="5047582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047585">return</span>&nbsp;<span class="builtintype" id="5047592">true</span><br>
<span class="lineno"></span><span class="op" id="5047597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5047600">//&nbsp;SetLinesForContent&nbsp;sets&nbsp;the&nbsp;line&nbsp;offsets&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;content.</span><br>
<span class="lineno">185</span><span class="comment" id="5047672">//&nbsp;It&nbsp;ignores&nbsp;position-altering&nbsp;//line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="keyword" id="5047721">func</span>&nbsp;<span class="op" id="5047726">(</span><span class="ident" id="5047727">f</span>&nbsp;<span class="op" id="5047729">*</span><span class="ident" id="5047730">File</span><span class="op" id="5047734">)</span>&nbsp;<span class="ident" id="5047736">SetLinesForContent</span><span class="op" id="5047754">(</span><span class="ident" id="5047755">content</span>&nbsp;<span class="op" id="5047763">[</span><span class="op" id="5047764">]</span><span class="builtintype" id="5047765">byte</span><span class="op" id="5047769">)</span>&nbsp;<span class="op" id="5047771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047774">var</span>&nbsp;<span class="ident" id="5047778">lines</span>&nbsp;<span class="op" id="5047784">[</span><span class="op" id="5047785">]</span><span class="builtintype" id="5047786">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047791">line</span>&nbsp;<span class="op" id="5047796">:=</span>&nbsp;<span class="num" id="5047799">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047802">for</span>&nbsp;<span class="ident" id="5047806">offset</span><span class="op" id="5047812">,</span>&nbsp;<span class="ident" id="5047814">b</span>&nbsp;<span class="op" id="5047816">:=</span>&nbsp;<span class="keyword" id="5047819">range</span>&nbsp;<span class="ident" id="5047825">content</span>&nbsp;<span class="op" id="5047833">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047837">if</span>&nbsp;<span class="ident" id="5047840">line</span>&nbsp;<span class="op" id="5047845">&gt;=</span>&nbsp;<span class="num" id="5047848">0</span>&nbsp;<span class="op" id="5047850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047855">lines</span>&nbsp;<span class="op" id="5047861">=</span>&nbsp;<span class="builtinfunc" id="5047863">append</span><span class="op" id="5047869">(</span><span class="ident" id="5047870">lines</span><span class="op" id="5047875">,</span>&nbsp;<span class="ident" id="5047877">line</span><span class="op" id="5047881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047889">line</span>&nbsp;<span class="op" id="5047894">=</span>&nbsp;<span class="op" id="5047896">-</span><span class="num" id="5047897">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5047901">if</span>&nbsp;<span class="ident" id="5047904">b</span>&nbsp;<span class="op" id="5047906">==</span>&nbsp;<span class="string" id="5047909">&#39;\n&#39;</span>&nbsp;<span class="op" id="5047914">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047919">line</span>&nbsp;<span class="op" id="5047924">=</span>&nbsp;<span class="ident" id="5047926">offset</span>&nbsp;<span class="op" id="5047933">+</span>&nbsp;<span class="num" id="5047935">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5047942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5047946">//&nbsp;set&nbsp;lines&nbsp;table</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047966">f</span><span class="op" id="5047967">.</span><span class="ident" id="5047968">set</span><span class="op" id="5047971">.</span><span class="ident" id="5047972">mutex</span><span class="op" id="5047977">.</span><span class="ident" id="5047978">Lock</span><span class="op" id="5047982">(</span><span class="op" id="5047983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5047986">f</span><span class="op" id="5047987">.</span><span class="ident" id="5047988">lines</span>&nbsp;<span class="op" id="5047994">=</span>&nbsp;<span class="ident" id="5047996">lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048003">f</span><span class="op" id="5048004">.</span><span class="ident" id="5048005">set</span><span class="op" id="5048008">.</span><span class="ident" id="5048009">mutex</span><span class="op" id="5048014">.</span><span class="ident" id="5048015">Unlock</span><span class="op" id="5048021">(</span><span class="op" id="5048022">)</span><br>
<span class="lineno"></span><span class="op" id="5048024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5048027">//&nbsp;A&nbsp;lineInfo&nbsp;object&nbsp;describes&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="5048091">//&nbsp;information&nbsp;(such&nbsp;as&nbsp;provided&nbsp;via&nbsp;a&nbsp;//line&nbsp;comment&nbsp;in&nbsp;a&nbsp;.go</span><br>
<span class="lineno"></span><span class="comment" id="5048154">//&nbsp;file)&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="5048188">type</span>&nbsp;<span class="ident" id="5048193">lineInfo</span>&nbsp;<span class="keyword" id="5048202">struct</span>&nbsp;<span class="op" id="5048209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5048212">//&nbsp;fields&nbsp;are&nbsp;exported&nbsp;to&nbsp;make&nbsp;them&nbsp;accessible&nbsp;to&nbsp;gob</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048267">Offset</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5048276">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048281">Filename</span>&nbsp;<span class="builtintype" id="5048290">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048298">Line</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5048307">int</span><br>
<span class="lineno"></span><span class="op" id="5048311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="comment" id="5048314">//&nbsp;AddLineInfo&nbsp;adds&nbsp;alternative&nbsp;file&nbsp;and&nbsp;line&nbsp;number&nbsp;information&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5048383">//&nbsp;a&nbsp;given&nbsp;file&nbsp;offset.&nbsp;The&nbsp;offset&nbsp;must&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;offset&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5048453">//&nbsp;the&nbsp;previously&nbsp;added&nbsp;alternative&nbsp;line&nbsp;info&nbsp;and&nbsp;smaller&nbsp;than&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5048520">//&nbsp;file&nbsp;size;&nbsp;otherwise&nbsp;the&nbsp;information&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5048572">//</span><br>
<span class="lineno">220</span><span class="comment" id="5048575">//&nbsp;AddLineInfo&nbsp;is&nbsp;typically&nbsp;used&nbsp;to&nbsp;register&nbsp;alternative&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5048641">//&nbsp;information&nbsp;for&nbsp;//line&nbsp;filename:line&nbsp;comments&nbsp;in&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5048707">//</span><br>
<span class="lineno"></span><span class="keyword" id="5048710">func</span>&nbsp;<span class="op" id="5048715">(</span><span class="ident" id="5048716">f</span>&nbsp;<span class="op" id="5048718">*</span><span class="ident" id="5048719">File</span><span class="op" id="5048723">)</span>&nbsp;<span class="ident" id="5048725">AddLineInfo</span><span class="op" id="5048736">(</span><span class="ident" id="5048737">offset</span>&nbsp;<span class="builtintype" id="5048744">int</span><span class="op" id="5048747">,</span>&nbsp;<span class="ident" id="5048749">filename</span>&nbsp;<span class="builtintype" id="5048758">string</span><span class="op" id="5048764">,</span>&nbsp;<span class="ident" id="5048766">line</span>&nbsp;<span class="builtintype" id="5048771">int</span><span class="op" id="5048774">)</span>&nbsp;<span class="op" id="5048776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048779">f</span><span class="op" id="5048780">.</span><span class="ident" id="5048781">set</span><span class="op" id="5048784">.</span><span class="ident" id="5048785">mutex</span><span class="op" id="5048790">.</span><span class="ident" id="5048791">Lock</span><span class="op" id="5048795">(</span><span class="op" id="5048796">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5048799">if</span>&nbsp;<span class="ident" id="5048802">i</span>&nbsp;<span class="op" id="5048804">:=</span>&nbsp;<span class="builtinfunc" id="5048807">len</span><span class="op" id="5048810">(</span><span class="ident" id="5048811">f</span><span class="op" id="5048812">.</span><span class="ident" id="5048813">infos</span><span class="op" id="5048818">)</span><span class="op" id="5048819">;</span>&nbsp;<span class="ident" id="5048821">i</span>&nbsp;<span class="op" id="5048823">==</span>&nbsp;<span class="num" id="5048826">0</span>&nbsp;<span class="op" id="5048828">||</span>&nbsp;<span class="ident" id="5048831">f</span><span class="op" id="5048832">.</span><span class="ident" id="5048833">infos</span><span class="op" id="5048838">[</span><span class="ident" id="5048839">i</span><span class="op" id="5048840">-</span><span class="num" id="5048841">1</span><span class="op" id="5048842">]</span><span class="op" id="5048843">.</span><span class="ident" id="5048844">Offset</span>&nbsp;<span class="op" id="5048851">&lt;</span>&nbsp;<span class="ident" id="5048853">offset</span>&nbsp;<span class="op" id="5048860">&amp;&amp;</span>&nbsp;<span class="ident" id="5048863">offset</span>&nbsp;<span class="op" id="5048870">&lt;</span>&nbsp;<span class="ident" id="5048872">f</span><span class="op" id="5048873">.</span><span class="ident" id="5048874">size</span>&nbsp;<span class="op" id="5048879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048883">f</span><span class="op" id="5048884">.</span><span class="ident" id="5048885">infos</span>&nbsp;<span class="op" id="5048891">=</span>&nbsp;<span class="builtinfunc" id="5048893">append</span><span class="op" id="5048899">(</span><span class="ident" id="5048900">f</span><span class="op" id="5048901">.</span><span class="ident" id="5048902">infos</span><span class="op" id="5048907">,</span>&nbsp;<span class="ident" id="5048909">lineInfo</span><span class="op" id="5048917">{</span><span class="ident" id="5048918">offset</span><span class="op" id="5048924">,</span>&nbsp;<span class="ident" id="5048926">filename</span><span class="op" id="5048934">,</span>&nbsp;<span class="ident" id="5048936">line</span><span class="op" id="5048940">}</span><span class="op" id="5048941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5048944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5048947">f</span><span class="op" id="5048948">.</span><span class="ident" id="5048949">set</span><span class="op" id="5048952">.</span><span class="ident" id="5048953">mutex</span><span class="op" id="5048958">.</span><span class="ident" id="5048959">Unlock</span><span class="op" id="5048965">(</span><span class="op" id="5048966">)</span><br>
<span class="lineno"></span><span class="op" id="5048968">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="5048971">//&nbsp;Pos&nbsp;returns&nbsp;the&nbsp;Pos&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;offset;</span><br>
<span class="lineno"></span><span class="comment" id="5049027">//&nbsp;the&nbsp;offset&nbsp;must&nbsp;be&nbsp;&lt;=&nbsp;f.Size().</span><br>
<span class="lineno"></span><span class="comment" id="5049062">//&nbsp;f.Pos(f.Offset(p))&nbsp;==&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5049090">//</span><br>
<span class="lineno">235</span><span class="keyword" id="5049093">func</span>&nbsp;<span class="op" id="5049098">(</span><span class="ident" id="5049099">f</span>&nbsp;<span class="op" id="5049101">*</span><span class="ident" id="5049102">File</span><span class="op" id="5049106">)</span>&nbsp;<span class="ident" id="5049108">Pos</span><span class="op" id="5049111">(</span><span class="ident" id="5049112">offset</span>&nbsp;<span class="builtintype" id="5049119">int</span><span class="op" id="5049122">)</span>&nbsp;<span class="ident" id="5049124">Pos</span>&nbsp;<span class="op" id="5049128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049131">if</span>&nbsp;<span class="ident" id="5049134">offset</span>&nbsp;<span class="op" id="5049141">&gt;</span>&nbsp;<span class="ident" id="5049143">f</span><span class="op" id="5049144">.</span><span class="ident" id="5049145">size</span>&nbsp;<span class="op" id="5049150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5049154">panic</span><span class="op" id="5049159">(</span><span class="string" id="5049160">&#34;illegal&nbsp;file&nbsp;offset&#34;</span><span class="op" id="5049181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5049184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049187">return</span>&nbsp;<span class="ident" id="5049194">Pos</span><span class="op" id="5049197">(</span><span class="ident" id="5049198">f</span><span class="op" id="5049199">.</span><span class="ident" id="5049200">base</span>&nbsp;<span class="op" id="5049205">+</span>&nbsp;<span class="ident" id="5049207">offset</span><span class="op" id="5049213">)</span><br>
<span class="lineno">240</span><span class="op" id="5049215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049218">//&nbsp;Offset&nbsp;returns&nbsp;the&nbsp;offset&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5049278">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;valid&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5049323">//&nbsp;f.Offset(f.Pos(offset))&nbsp;==&nbsp;offset.</span><br>
<span class="lineno">245</span><span class="comment" id="5049361">//</span><br>
<span class="lineno"></span><span class="keyword" id="5049364">func</span>&nbsp;<span class="op" id="5049369">(</span><span class="ident" id="5049370">f</span>&nbsp;<span class="op" id="5049372">*</span><span class="ident" id="5049373">File</span><span class="op" id="5049377">)</span>&nbsp;<span class="ident" id="5049379">Offset</span><span class="op" id="5049385">(</span><span class="ident" id="5049386">p</span>&nbsp;<span class="ident" id="5049388">Pos</span><span class="op" id="5049391">)</span>&nbsp;<span class="builtintype" id="5049393">int</span>&nbsp;<span class="op" id="5049397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049400">if</span>&nbsp;<span class="builtintype" id="5049403">int</span><span class="op" id="5049406">(</span><span class="ident" id="5049407">p</span><span class="op" id="5049408">)</span>&nbsp;<span class="op" id="5049410">&lt;</span>&nbsp;<span class="ident" id="5049412">f</span><span class="op" id="5049413">.</span><span class="ident" id="5049414">base</span>&nbsp;<span class="op" id="5049419">||</span>&nbsp;<span class="builtintype" id="5049422">int</span><span class="op" id="5049425">(</span><span class="ident" id="5049426">p</span><span class="op" id="5049427">)</span>&nbsp;<span class="op" id="5049429">&gt;</span>&nbsp;<span class="ident" id="5049431">f</span><span class="op" id="5049432">.</span><span class="ident" id="5049433">base</span><span class="op" id="5049437">+</span><span class="ident" id="5049438">f</span><span class="op" id="5049439">.</span><span class="ident" id="5049440">size</span>&nbsp;<span class="op" id="5049445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5049449">panic</span><span class="op" id="5049454">(</span><span class="string" id="5049455">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5049474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5049477">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049480">return</span>&nbsp;<span class="builtintype" id="5049487">int</span><span class="op" id="5049490">(</span><span class="ident" id="5049491">p</span><span class="op" id="5049492">)</span>&nbsp;<span class="op" id="5049494">-</span>&nbsp;<span class="ident" id="5049496">f</span><span class="op" id="5049497">.</span><span class="ident" id="5049498">base</span><br>
<span class="lineno"></span><span class="op" id="5049503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049506">//&nbsp;Line&nbsp;returns&nbsp;the&nbsp;line&nbsp;number&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p;</span><br>
<span class="lineno"></span><span class="comment" id="5049569">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;that&nbsp;file&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno">255</span><span class="comment" id="5049617">//</span><br>
<span class="lineno"></span><span class="keyword" id="5049620">func</span>&nbsp;<span class="op" id="5049625">(</span><span class="ident" id="5049626">f</span>&nbsp;<span class="op" id="5049628">*</span><span class="ident" id="5049629">File</span><span class="op" id="5049633">)</span>&nbsp;<span class="ident" id="5049635">Line</span><span class="op" id="5049639">(</span><span class="ident" id="5049640">p</span>&nbsp;<span class="ident" id="5049642">Pos</span><span class="op" id="5049645">)</span>&nbsp;<span class="builtintype" id="5049647">int</span>&nbsp;<span class="op" id="5049651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049654">return</span>&nbsp;<span class="ident" id="5049661">f</span><span class="op" id="5049662">.</span><span class="ident" id="5049663">Position</span><span class="op" id="5049671">(</span><span class="ident" id="5049672">p</span><span class="op" id="5049673">)</span><span class="op" id="5049674">.</span><span class="ident" id="5049675">Line</span><br>
<span class="lineno"></span><span class="op" id="5049680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="5049683">func</span>&nbsp;<span class="ident" id="5049688">searchLineInfos</span><span class="op" id="5049703">(</span><span class="ident" id="5049704">a</span>&nbsp;<span class="op" id="5049706">[</span><span class="op" id="5049707">]</span><span class="ident" id="5049708">lineInfo</span><span class="op" id="5049716">,</span>&nbsp;<span class="ident" id="5049718">x</span>&nbsp;<span class="builtintype" id="5049720">int</span><span class="op" id="5049723">)</span>&nbsp;<span class="builtintype" id="5049725">int</span>&nbsp;<span class="op" id="5049729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5049732">return</span>&nbsp;<span class="ident" id="5049739">sort</span><span class="op" id="5049743">.</span><span class="ident" id="5049744">Search</span><span class="op" id="5049750">(</span><span class="builtinfunc" id="5049751">len</span><span class="op" id="5049754">(</span><span class="ident" id="5049755">a</span><span class="op" id="5049756">)</span><span class="op" id="5049757">,</span>&nbsp;<span class="keyword" id="5049759">func</span><span class="op" id="5049763">(</span><span class="ident" id="5049764">i</span>&nbsp;<span class="builtintype" id="5049766">int</span><span class="op" id="5049769">)</span>&nbsp;<span class="builtintype" id="5049771">bool</span>&nbsp;<span class="op" id="5049776">{</span>&nbsp;<span class="keyword" id="5049778">return</span>&nbsp;<span class="ident" id="5049785">a</span><span class="op" id="5049786">[</span><span class="ident" id="5049787">i</span><span class="op" id="5049788">]</span><span class="op" id="5049789">.</span><span class="ident" id="5049790">Offset</span>&nbsp;<span class="op" id="5049797">&gt;</span>&nbsp;<span class="ident" id="5049799">x</span>&nbsp;<span class="op" id="5049801">}</span><span class="op" id="5049802">)</span>&nbsp;<span class="op" id="5049804">-</span>&nbsp;<span class="num" id="5049806">1</span><br>
<span class="lineno"></span><span class="op" id="5049808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5049811">//&nbsp;unpack&nbsp;returns&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;and&nbsp;column&nbsp;number&nbsp;for&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno">265</span><span class="comment" id="5049888">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;unpack&nbsp;will&nbsp;return&nbsp;the&nbsp;filename&nbsp;and&nbsp;line&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="5049964">//&nbsp;possibly&nbsp;adjusted&nbsp;by&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5050043">//</span><br>
<span class="lineno"></span><span class="keyword" id="5050046">func</span>&nbsp;<span class="op" id="5050051">(</span><span class="ident" id="5050052">f</span>&nbsp;<span class="op" id="5050054">*</span><span class="ident" id="5050055">File</span><span class="op" id="5050059">)</span>&nbsp;<span class="ident" id="5050061">unpack</span><span class="op" id="5050067">(</span><span class="ident" id="5050068">offset</span>&nbsp;<span class="builtintype" id="5050075">int</span><span class="op" id="5050078">,</span>&nbsp;<span class="ident" id="5050080">adjusted</span>&nbsp;<span class="builtintype" id="5050089">bool</span><span class="op" id="5050093">)</span>&nbsp;<span class="op" id="5050095">(</span><span class="ident" id="5050096">filename</span>&nbsp;<span class="builtintype" id="5050105">string</span><span class="op" id="5050111">,</span>&nbsp;<span class="ident" id="5050113">line</span><span class="op" id="5050117">,</span>&nbsp;<span class="ident" id="5050119">column</span>&nbsp;<span class="builtintype" id="5050126">int</span><span class="op" id="5050129">)</span>&nbsp;<span class="op" id="5050131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050134">filename</span>&nbsp;<span class="op" id="5050143">=</span>&nbsp;<span class="ident" id="5050145">f</span><span class="op" id="5050146">.</span><span class="ident" id="5050147">name</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050153">if</span>&nbsp;<span class="ident" id="5050156">i</span>&nbsp;<span class="op" id="5050158">:=</span>&nbsp;<span class="ident" id="5050161">searchInts</span><span class="op" id="5050171">(</span><span class="ident" id="5050172">f</span><span class="op" id="5050173">.</span><span class="ident" id="5050174">lines</span><span class="op" id="5050179">,</span>&nbsp;<span class="ident" id="5050181">offset</span><span class="op" id="5050187">)</span><span class="op" id="5050188">;</span>&nbsp;<span class="ident" id="5050190">i</span>&nbsp;<span class="op" id="5050192">&gt;=</span>&nbsp;<span class="num" id="5050195">0</span>&nbsp;<span class="op" id="5050197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050201">line</span><span class="op" id="5050205">,</span>&nbsp;<span class="ident" id="5050207">column</span>&nbsp;<span class="op" id="5050214">=</span>&nbsp;<span class="ident" id="5050216">i</span><span class="op" id="5050217">+</span><span class="num" id="5050218">1</span><span class="op" id="5050219">,</span>&nbsp;<span class="ident" id="5050221">offset</span><span class="op" id="5050227">-</span><span class="ident" id="5050228">f</span><span class="op" id="5050229">.</span><span class="ident" id="5050230">lines</span><span class="op" id="5050235">[</span><span class="ident" id="5050236">i</span><span class="op" id="5050237">]</span><span class="op" id="5050238">+</span><span class="num" id="5050239">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5050242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050245">if</span>&nbsp;<span class="ident" id="5050248">adjusted</span>&nbsp;<span class="op" id="5050257">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5050260">len</span><span class="op" id="5050263">(</span><span class="ident" id="5050264">f</span><span class="op" id="5050265">.</span><span class="ident" id="5050266">infos</span><span class="op" id="5050271">)</span>&nbsp;<span class="op" id="5050273">&gt;</span>&nbsp;<span class="num" id="5050275">0</span>&nbsp;<span class="op" id="5050277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5050281">//&nbsp;almost&nbsp;no&nbsp;files&nbsp;have&nbsp;extra&nbsp;line&nbsp;infos</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050324">if</span>&nbsp;<span class="ident" id="5050327">i</span>&nbsp;<span class="op" id="5050329">:=</span>&nbsp;<span class="ident" id="5050332">searchLineInfos</span><span class="op" id="5050347">(</span><span class="ident" id="5050348">f</span><span class="op" id="5050349">.</span><span class="ident" id="5050350">infos</span><span class="op" id="5050355">,</span>&nbsp;<span class="ident" id="5050357">offset</span><span class="op" id="5050363">)</span><span class="op" id="5050364">;</span>&nbsp;<span class="ident" id="5050366">i</span>&nbsp;<span class="op" id="5050368">&gt;=</span>&nbsp;<span class="num" id="5050371">0</span>&nbsp;<span class="op" id="5050373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050378">alt</span>&nbsp;<span class="op" id="5050382">:=</span>&nbsp;<span class="op" id="5050385">&amp;</span><span class="ident" id="5050386">f</span><span class="op" id="5050387">.</span><span class="ident" id="5050388">infos</span><span class="op" id="5050393">[</span><span class="ident" id="5050394">i</span><span class="op" id="5050395">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050400">filename</span>&nbsp;<span class="op" id="5050409">=</span>&nbsp;<span class="ident" id="5050411">alt</span><span class="op" id="5050414">.</span><span class="ident" id="5050415">Filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050427">if</span>&nbsp;<span class="ident" id="5050430">i</span>&nbsp;<span class="op" id="5050432">:=</span>&nbsp;<span class="ident" id="5050435">searchInts</span><span class="op" id="5050445">(</span><span class="ident" id="5050446">f</span><span class="op" id="5050447">.</span><span class="ident" id="5050448">lines</span><span class="op" id="5050453">,</span>&nbsp;<span class="ident" id="5050455">alt</span><span class="op" id="5050458">.</span><span class="ident" id="5050459">Offset</span><span class="op" id="5050465">)</span><span class="op" id="5050466">;</span>&nbsp;<span class="ident" id="5050468">i</span>&nbsp;<span class="op" id="5050470">&gt;=</span>&nbsp;<span class="num" id="5050473">0</span>&nbsp;<span class="op" id="5050475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050481">line</span>&nbsp;<span class="op" id="5050486">+=</span>&nbsp;<span class="ident" id="5050489">alt</span><span class="op" id="5050492">.</span><span class="ident" id="5050493">Line</span>&nbsp;<span class="op" id="5050498">-</span>&nbsp;<span class="ident" id="5050500">i</span>&nbsp;<span class="op" id="5050502">-</span>&nbsp;<span class="num" id="5050504">1</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5050509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5050513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5050516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050519">return</span><br>
<span class="lineno"></span><span class="op" id="5050526">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="5050529">func</span>&nbsp;<span class="op" id="5050534">(</span><span class="ident" id="5050535">f</span>&nbsp;<span class="op" id="5050537">*</span><span class="ident" id="5050538">File</span><span class="op" id="5050542">)</span>&nbsp;<span class="ident" id="5050544">position</span><span class="op" id="5050552">(</span><span class="ident" id="5050553">p</span>&nbsp;<span class="ident" id="5050555">Pos</span><span class="op" id="5050558">,</span>&nbsp;<span class="ident" id="5050560">adjusted</span>&nbsp;<span class="builtintype" id="5050569">bool</span><span class="op" id="5050573">)</span>&nbsp;<span class="op" id="5050575">(</span><span class="ident" id="5050576">pos</span>&nbsp;<span class="ident" id="5050580">Position</span><span class="op" id="5050588">)</span>&nbsp;<span class="op" id="5050590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050593">offset</span>&nbsp;<span class="op" id="5050600">:=</span>&nbsp;<span class="builtintype" id="5050603">int</span><span class="op" id="5050606">(</span><span class="ident" id="5050607">p</span><span class="op" id="5050608">)</span>&nbsp;<span class="op" id="5050610">-</span>&nbsp;<span class="ident" id="5050612">f</span><span class="op" id="5050613">.</span><span class="ident" id="5050614">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050620">pos</span><span class="op" id="5050623">.</span><span class="ident" id="5050624">Offset</span>&nbsp;<span class="op" id="5050631">=</span>&nbsp;<span class="ident" id="5050633">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5050641">pos</span><span class="op" id="5050644">.</span><span class="ident" id="5050645">Filename</span><span class="op" id="5050653">,</span>&nbsp;<span class="ident" id="5050655">pos</span><span class="op" id="5050658">.</span><span class="ident" id="5050659">Line</span><span class="op" id="5050663">,</span>&nbsp;<span class="ident" id="5050665">pos</span><span class="op" id="5050668">.</span><span class="ident" id="5050669">Column</span>&nbsp;<span class="op" id="5050676">=</span>&nbsp;<span class="ident" id="5050678">f</span><span class="op" id="5050679">.</span><span class="ident" id="5050680">unpack</span><span class="op" id="5050686">(</span><span class="ident" id="5050687">offset</span><span class="op" id="5050693">,</span>&nbsp;<span class="ident" id="5050695">adjusted</span><span class="op" id="5050703">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5050706">return</span><br>
<span class="lineno"></span><span class="op" id="5050713">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5050716">//&nbsp;PositionFor&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5050789">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno">295</span><span class="comment" id="5050862">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5050920">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;f&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5050960">//</span><br>
<span class="lineno"></span><span class="keyword" id="5050963">func</span>&nbsp;<span class="op" id="5050968">(</span><span class="ident" id="5050969">f</span>&nbsp;<span class="op" id="5050971">*</span><span class="ident" id="5050972">File</span><span class="op" id="5050976">)</span>&nbsp;<span class="ident" id="5050978">PositionFor</span><span class="op" id="5050989">(</span><span class="ident" id="5050990">p</span>&nbsp;<span class="ident" id="5050992">Pos</span><span class="op" id="5050995">,</span>&nbsp;<span class="ident" id="5050997">adjusted</span>&nbsp;<span class="builtintype" id="5051006">bool</span><span class="op" id="5051010">)</span>&nbsp;<span class="op" id="5051012">(</span><span class="ident" id="5051013">pos</span>&nbsp;<span class="ident" id="5051017">Position</span><span class="op" id="5051025">)</span>&nbsp;<span class="op" id="5051027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5051030">if</span>&nbsp;<span class="ident" id="5051033">p</span>&nbsp;<span class="op" id="5051035">!=</span>&nbsp;<span class="ident" id="5051038">NoPos</span>&nbsp;<span class="op" id="5051044">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5051048">if</span>&nbsp;<span class="builtintype" id="5051051">int</span><span class="op" id="5051054">(</span><span class="ident" id="5051055">p</span><span class="op" id="5051056">)</span>&nbsp;<span class="op" id="5051058">&lt;</span>&nbsp;<span class="ident" id="5051060">f</span><span class="op" id="5051061">.</span><span class="ident" id="5051062">base</span>&nbsp;<span class="op" id="5051067">||</span>&nbsp;<span class="builtintype" id="5051070">int</span><span class="op" id="5051073">(</span><span class="ident" id="5051074">p</span><span class="op" id="5051075">)</span>&nbsp;<span class="op" id="5051077">&gt;</span>&nbsp;<span class="ident" id="5051079">f</span><span class="op" id="5051080">.</span><span class="ident" id="5051081">base</span><span class="op" id="5051085">+</span><span class="ident" id="5051086">f</span><span class="op" id="5051087">.</span><span class="ident" id="5051088">size</span>&nbsp;<span class="op" id="5051093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5051098">panic</span><span class="op" id="5051103">(</span><span class="string" id="5051104">&#34;illegal&nbsp;Pos&nbsp;value&#34;</span><span class="op" id="5051123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5051127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051131">pos</span>&nbsp;<span class="op" id="5051135">=</span>&nbsp;<span class="ident" id="5051137">f</span><span class="op" id="5051138">.</span><span class="ident" id="5051139">position</span><span class="op" id="5051147">(</span><span class="ident" id="5051148">p</span><span class="op" id="5051149">,</span>&nbsp;<span class="ident" id="5051151">adjusted</span><span class="op" id="5051159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5051162">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5051165">return</span><br>
<span class="lineno"></span><span class="op" id="5051172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5051175">//&nbsp;Position&nbsp;returns&nbsp;the&nbsp;Position&nbsp;value&nbsp;for&nbsp;the&nbsp;given&nbsp;file&nbsp;position&nbsp;p.</span><br>
<span class="lineno"></span><span class="comment" id="5051245">//&nbsp;Calling&nbsp;f.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;f.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno">310</span><span class="comment" id="5051319">//</span><br>
<span class="lineno"></span><span class="keyword" id="5051322">func</span>&nbsp;<span class="op" id="5051327">(</span><span class="ident" id="5051328">f</span>&nbsp;<span class="op" id="5051330">*</span><span class="ident" id="5051331">File</span><span class="op" id="5051335">)</span>&nbsp;<span class="ident" id="5051337">Position</span><span class="op" id="5051345">(</span><span class="ident" id="5051346">p</span>&nbsp;<span class="ident" id="5051348">Pos</span><span class="op" id="5051351">)</span>&nbsp;<span class="op" id="5051353">(</span><span class="ident" id="5051354">pos</span>&nbsp;<span class="ident" id="5051358">Position</span><span class="op" id="5051366">)</span>&nbsp;<span class="op" id="5051368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5051371">return</span>&nbsp;<span class="ident" id="5051378">f</span><span class="op" id="5051379">.</span><span class="ident" id="5051380">PositionFor</span><span class="op" id="5051391">(</span><span class="ident" id="5051392">p</span><span class="op" id="5051393">,</span>&nbsp;<span class="builtintype" id="5051395">true</span><span class="op" id="5051399">)</span><br>
<span class="lineno"></span><span class="op" id="5051401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="comment" id="5051404">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5051485">//&nbsp;FileSet</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5051497">//&nbsp;A&nbsp;FileSet&nbsp;represents&nbsp;a&nbsp;set&nbsp;of&nbsp;source&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5051544">//&nbsp;Methods&nbsp;of&nbsp;file&nbsp;sets&nbsp;are&nbsp;synchronized;&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno">320</span><span class="comment" id="5051606">//&nbsp;may&nbsp;invoke&nbsp;them&nbsp;concurrently.</span><br>
<span class="lineno"></span><span class="comment" id="5051639">//</span><br>
<span class="lineno"></span><span class="keyword" id="5051642">type</span>&nbsp;<span class="ident" id="5051647">FileSet</span>&nbsp;<span class="keyword" id="5051655">struct</span>&nbsp;<span class="op" id="5051662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051665">mutex</span>&nbsp;<span class="ident" id="5051671">sync</span><span class="op" id="5051675">.</span><span class="ident" id="5051676">RWMutex</span>&nbsp;<span class="comment" id="5051684">//&nbsp;protects&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051710">base</span>&nbsp;&nbsp;<span class="builtintype" id="5051716">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5051729">//&nbsp;base&nbsp;offset&nbsp;for&nbsp;the&nbsp;next&nbsp;file</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051763">files</span>&nbsp;<span class="op" id="5051769">[</span><span class="op" id="5051770">]</span><span class="op" id="5051771">*</span><span class="ident" id="5051772">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5051782">//&nbsp;list&nbsp;of&nbsp;files&nbsp;in&nbsp;the&nbsp;order&nbsp;added&nbsp;to&nbsp;the&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051830">last</span>&nbsp;&nbsp;<span class="op" id="5051836">*</span><span class="ident" id="5051837">File</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5051849">//&nbsp;cache&nbsp;of&nbsp;last&nbsp;file&nbsp;looked&nbsp;up</span><br>
<span class="lineno"></span><span class="op" id="5051881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5051884">//&nbsp;NewFileSet&nbsp;creates&nbsp;a&nbsp;new&nbsp;file&nbsp;set.</span><br>
<span class="lineno">330</span><span class="keyword" id="5051922">func</span>&nbsp;<span class="ident" id="5051927">NewFileSet</span><span class="op" id="5051937">(</span><span class="op" id="5051938">)</span>&nbsp;<span class="op" id="5051940">*</span><span class="ident" id="5051941">FileSet</span>&nbsp;<span class="op" id="5051949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5051952">return</span>&nbsp;<span class="op" id="5051959">&amp;</span><span class="ident" id="5051960">FileSet</span><span class="op" id="5051967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5051971">base</span><span class="op" id="5051975">:</span>&nbsp;<span class="num" id="5051977">1</span><span class="op" id="5051978">,</span>&nbsp;<span class="comment" id="5051980">//&nbsp;0&nbsp;==&nbsp;NoPos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5051995">}</span><br>
<span class="lineno"></span><span class="op" id="5051997">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span><span class="comment" id="5052000">//&nbsp;Base&nbsp;returns&nbsp;the&nbsp;minimum&nbsp;base&nbsp;offset&nbsp;that&nbsp;must&nbsp;be&nbsp;provided&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5052065">//&nbsp;AddFile&nbsp;when&nbsp;adding&nbsp;the&nbsp;next&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="5052103">//</span><br>
<span class="lineno"></span><span class="keyword" id="5052106">func</span>&nbsp;<span class="op" id="5052111">(</span><span class="ident" id="5052112">s</span>&nbsp;<span class="op" id="5052114">*</span><span class="ident" id="5052115">FileSet</span><span class="op" id="5052122">)</span>&nbsp;<span class="ident" id="5052124">Base</span><span class="op" id="5052128">(</span><span class="op" id="5052129">)</span>&nbsp;<span class="builtintype" id="5052131">int</span>&nbsp;<span class="op" id="5052135">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5052138">s</span><span class="op" id="5052139">.</span><span class="ident" id="5052140">mutex</span><span class="op" id="5052145">.</span><span class="ident" id="5052146">RLock</span><span class="op" id="5052151">(</span><span class="op" id="5052152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5052155">b</span>&nbsp;<span class="op" id="5052157">:=</span>&nbsp;<span class="ident" id="5052160">s</span><span class="op" id="5052161">.</span><span class="ident" id="5052162">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5052168">s</span><span class="op" id="5052169">.</span><span class="ident" id="5052170">mutex</span><span class="op" id="5052175">.</span><span class="ident" id="5052176">RUnlock</span><span class="op" id="5052183">(</span><span class="op" id="5052184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5052187">return</span>&nbsp;<span class="ident" id="5052194">b</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="op" id="5052197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5052200">//&nbsp;AddFile&nbsp;adds&nbsp;a&nbsp;new&nbsp;file&nbsp;with&nbsp;a&nbsp;given&nbsp;filename,&nbsp;base&nbsp;offset,&nbsp;and&nbsp;file&nbsp;size</span><br>
<span class="lineno"></span><span class="comment" id="5052277">//&nbsp;to&nbsp;the&nbsp;file&nbsp;set&nbsp;s&nbsp;and&nbsp;returns&nbsp;the&nbsp;file.&nbsp;Multiple&nbsp;files&nbsp;may&nbsp;have&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span><span class="comment" id="5052353">//&nbsp;name.&nbsp;The&nbsp;base&nbsp;offset&nbsp;must&nbsp;not&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base(),&nbsp;and</span><br>
<span class="lineno">350</span><span class="comment" id="5052429">//&nbsp;size&nbsp;must&nbsp;not&nbsp;be&nbsp;negative.&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;a&nbsp;negative&nbsp;base&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span><span class="comment" id="5052510">//&nbsp;the&nbsp;current&nbsp;value&nbsp;of&nbsp;the&nbsp;FileSet&#39;s&nbsp;Base()&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="5052572">//</span><br>
<span class="lineno"></span><span class="comment" id="5052575">//&nbsp;Adding&nbsp;the&nbsp;file&nbsp;will&nbsp;set&nbsp;the&nbsp;file&nbsp;set&#39;s&nbsp;Base()&nbsp;value&nbsp;to&nbsp;base&nbsp;+&nbsp;size&nbsp;+&nbsp;1</span><br>
<span class="lineno"></span><span class="comment" id="5052650">//&nbsp;as&nbsp;the&nbsp;minimum&nbsp;base&nbsp;value&nbsp;for&nbsp;the&nbsp;next&nbsp;file.&nbsp;The&nbsp;following&nbsp;relationship</span><br>
<span class="lineno">355</span><span class="comment" id="5052725">//&nbsp;exists&nbsp;between&nbsp;a&nbsp;Pos&nbsp;value&nbsp;p&nbsp;for&nbsp;a&nbsp;given&nbsp;file&nbsp;offset&nbsp;offs:</span><br>
<span class="lineno"></span><span class="comment" id="5052787">//</span><br>
<span class="lineno"></span><span class="comment" id="5052790">//&nbsp;&nbsp;&nbsp;&nbsp;int(p)&nbsp;=&nbsp;base&nbsp;+&nbsp;offs</span><br>
<span class="lineno"></span><span class="comment" id="5052814">//</span><br>
<span class="lineno"></span><span class="comment" id="5052817">//&nbsp;with&nbsp;offs&nbsp;in&nbsp;the&nbsp;range&nbsp;[0,&nbsp;size]&nbsp;and&nbsp;thus&nbsp;p&nbsp;in&nbsp;the&nbsp;range&nbsp;[base,&nbsp;base+size].</span><br>
<span class="lineno">360</span><span class="comment" id="5052896">//&nbsp;For&nbsp;convenience,&nbsp;File.Pos&nbsp;may&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;file-specific&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5052970">//&nbsp;values&nbsp;from&nbsp;a&nbsp;file&nbsp;offset.</span><br>
<span class="lineno"></span><span class="comment" id="5053000">//</span><br>
<span class="lineno"></span><span class="keyword" id="5053003">func</span>&nbsp;<span class="op" id="5053008">(</span><span class="ident" id="5053009">s</span>&nbsp;<span class="op" id="5053011">*</span><span class="ident" id="5053012">FileSet</span><span class="op" id="5053019">)</span>&nbsp;<span class="ident" id="5053021">AddFile</span><span class="op" id="5053028">(</span><span class="ident" id="5053029">filename</span>&nbsp;<span class="builtintype" id="5053038">string</span><span class="op" id="5053044">,</span>&nbsp;<span class="ident" id="5053046">base</span><span class="op" id="5053050">,</span>&nbsp;<span class="ident" id="5053052">size</span>&nbsp;<span class="builtintype" id="5053057">int</span><span class="op" id="5053060">)</span>&nbsp;<span class="op" id="5053062">*</span><span class="ident" id="5053063">File</span>&nbsp;<span class="op" id="5053068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053071">s</span><span class="op" id="5053072">.</span><span class="ident" id="5053073">mutex</span><span class="op" id="5053078">.</span><span class="ident" id="5053079">Lock</span><span class="op" id="5053083">(</span><span class="op" id="5053084">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053087">defer</span>&nbsp;<span class="ident" id="5053093">s</span><span class="op" id="5053094">.</span><span class="ident" id="5053095">mutex</span><span class="op" id="5053100">.</span><span class="ident" id="5053101">Unlock</span><span class="op" id="5053107">(</span><span class="op" id="5053108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053111">if</span>&nbsp;<span class="ident" id="5053114">base</span>&nbsp;<span class="op" id="5053119">&lt;</span>&nbsp;<span class="num" id="5053121">0</span>&nbsp;<span class="op" id="5053123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053127">base</span>&nbsp;<span class="op" id="5053132">=</span>&nbsp;<span class="ident" id="5053134">s</span><span class="op" id="5053135">.</span><span class="ident" id="5053136">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053145">if</span>&nbsp;<span class="ident" id="5053148">base</span>&nbsp;<span class="op" id="5053153">&lt;</span>&nbsp;<span class="ident" id="5053155">s</span><span class="op" id="5053156">.</span><span class="ident" id="5053157">base</span>&nbsp;<span class="op" id="5053162">||</span>&nbsp;<span class="ident" id="5053165">size</span>&nbsp;<span class="op" id="5053170">&lt;</span>&nbsp;<span class="num" id="5053172">0</span>&nbsp;<span class="op" id="5053174">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5053178">panic</span><span class="op" id="5053183">(</span><span class="string" id="5053184">&#34;illegal&nbsp;base&nbsp;or&nbsp;size&#34;</span><span class="op" id="5053206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5053212">//&nbsp;base&nbsp;&gt;=&nbsp;s.base&nbsp;&amp;&amp;&nbsp;size&nbsp;&gt;=&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053244">f</span>&nbsp;<span class="op" id="5053246">:=</span>&nbsp;<span class="op" id="5053249">&amp;</span><span class="ident" id="5053250">File</span><span class="op" id="5053254">{</span><span class="ident" id="5053255">s</span><span class="op" id="5053256">,</span>&nbsp;<span class="ident" id="5053258">filename</span><span class="op" id="5053266">,</span>&nbsp;<span class="ident" id="5053268">base</span><span class="op" id="5053272">,</span>&nbsp;<span class="ident" id="5053274">size</span><span class="op" id="5053278">,</span>&nbsp;<span class="op" id="5053280">[</span><span class="op" id="5053281">]</span><span class="builtintype" id="5053282">int</span><span class="op" id="5053285">{</span><span class="num" id="5053286">0</span><span class="op" id="5053287">}</span><span class="op" id="5053288">,</span>&nbsp;<span class="builtintype" id="5053290">nil</span><span class="op" id="5053293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053296">base</span>&nbsp;<span class="op" id="5053301">+=</span>&nbsp;<span class="ident" id="5053304">size</span>&nbsp;<span class="op" id="5053309">+</span>&nbsp;<span class="num" id="5053311">1</span>&nbsp;<span class="comment" id="5053313">//&nbsp;+1&nbsp;because&nbsp;EOF&nbsp;also&nbsp;has&nbsp;a&nbsp;position</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053352">if</span>&nbsp;<span class="ident" id="5053355">base</span>&nbsp;<span class="op" id="5053360">&lt;</span>&nbsp;<span class="num" id="5053362">0</span>&nbsp;<span class="op" id="5053364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5053368">panic</span><span class="op" id="5053373">(</span><span class="string" id="5053374">&#34;token.Pos&nbsp;offset&nbsp;overflow&nbsp;(&gt;&nbsp;2G&nbsp;of&nbsp;source&nbsp;code&nbsp;in&nbsp;file&nbsp;set)&#34;</span><span class="op" id="5053435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5053441">//&nbsp;add&nbsp;the&nbsp;file&nbsp;to&nbsp;the&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053474">s</span><span class="op" id="5053475">.</span><span class="ident" id="5053476">base</span>&nbsp;<span class="op" id="5053481">=</span>&nbsp;<span class="ident" id="5053483">base</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053489">s</span><span class="op" id="5053490">.</span><span class="ident" id="5053491">files</span>&nbsp;<span class="op" id="5053497">=</span>&nbsp;<span class="builtinfunc" id="5053499">append</span><span class="op" id="5053505">(</span><span class="ident" id="5053506">s</span><span class="op" id="5053507">.</span><span class="ident" id="5053508">files</span><span class="op" id="5053513">,</span>&nbsp;<span class="ident" id="5053515">f</span><span class="op" id="5053516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053519">s</span><span class="op" id="5053520">.</span><span class="ident" id="5053521">last</span>&nbsp;<span class="op" id="5053526">=</span>&nbsp;<span class="ident" id="5053528">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053531">return</span>&nbsp;<span class="ident" id="5053538">f</span><br>
<span class="lineno"></span><span class="op" id="5053540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span><span class="comment" id="5053543">//&nbsp;Iterate&nbsp;calls&nbsp;f&nbsp;for&nbsp;the&nbsp;files&nbsp;in&nbsp;the&nbsp;file&nbsp;set&nbsp;in&nbsp;the&nbsp;order&nbsp;they&nbsp;were&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5053621">//&nbsp;until&nbsp;f&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5053647">//</span><br>
<span class="lineno"></span><span class="keyword" id="5053650">func</span>&nbsp;<span class="op" id="5053655">(</span><span class="ident" id="5053656">s</span>&nbsp;<span class="op" id="5053658">*</span><span class="ident" id="5053659">FileSet</span><span class="op" id="5053666">)</span>&nbsp;<span class="ident" id="5053668">Iterate</span><span class="op" id="5053675">(</span><span class="ident" id="5053676">f</span>&nbsp;<span class="keyword" id="5053678">func</span><span class="op" id="5053682">(</span><span class="op" id="5053683">*</span><span class="ident" id="5053684">File</span><span class="op" id="5053688">)</span>&nbsp;<span class="builtintype" id="5053690">bool</span><span class="op" id="5053694">)</span>&nbsp;<span class="op" id="5053696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053699">for</span>&nbsp;<span class="ident" id="5053703">i</span>&nbsp;<span class="op" id="5053705">:=</span>&nbsp;<span class="num" id="5053708">0</span><span class="op" id="5053709">;</span>&nbsp;<span class="op" id="5053711">;</span>&nbsp;<span class="ident" id="5053713">i</span><span class="op" id="5053714">++</span>&nbsp;<span class="op" id="5053717">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053721">var</span>&nbsp;<span class="ident" id="5053725">file</span>&nbsp;<span class="op" id="5053730">*</span><span class="ident" id="5053731">File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053738">s</span><span class="op" id="5053739">.</span><span class="ident" id="5053740">mutex</span><span class="op" id="5053745">.</span><span class="ident" id="5053746">RLock</span><span class="op" id="5053751">(</span><span class="op" id="5053752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053756">if</span>&nbsp;<span class="ident" id="5053759">i</span>&nbsp;<span class="op" id="5053761">&lt;</span>&nbsp;<span class="builtinfunc" id="5053763">len</span><span class="op" id="5053766">(</span><span class="ident" id="5053767">s</span><span class="op" id="5053768">.</span><span class="ident" id="5053769">files</span><span class="op" id="5053774">)</span>&nbsp;<span class="op" id="5053776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053781">file</span>&nbsp;<span class="op" id="5053786">=</span>&nbsp;<span class="ident" id="5053788">s</span><span class="op" id="5053789">.</span><span class="ident" id="5053790">files</span><span class="op" id="5053795">[</span><span class="ident" id="5053796">i</span><span class="op" id="5053797">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053801">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5053805">s</span><span class="op" id="5053806">.</span><span class="ident" id="5053807">mutex</span><span class="op" id="5053812">.</span><span class="ident" id="5053813">RUnlock</span><span class="op" id="5053820">(</span><span class="op" id="5053821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053825">if</span>&nbsp;<span class="ident" id="5053828">file</span>&nbsp;<span class="op" id="5053833">==</span>&nbsp;<span class="builtintype" id="5053836">nil</span>&nbsp;<span class="op" id="5053840">||</span>&nbsp;<span class="op" id="5053843">!</span><span class="ident" id="5053844">f</span><span class="op" id="5053845">(</span><span class="ident" id="5053846">file</span><span class="op" id="5053850">)</span>&nbsp;<span class="op" id="5053852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053857">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053865">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5053868">}</span><br>
<span class="lineno">400</span><span class="op" id="5053870">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5053873">func</span>&nbsp;<span class="ident" id="5053878">searchFiles</span><span class="op" id="5053889">(</span><span class="ident" id="5053890">a</span>&nbsp;<span class="op" id="5053892">[</span><span class="op" id="5053893">]</span><span class="op" id="5053894">*</span><span class="ident" id="5053895">File</span><span class="op" id="5053899">,</span>&nbsp;<span class="ident" id="5053901">x</span>&nbsp;<span class="builtintype" id="5053903">int</span><span class="op" id="5053906">)</span>&nbsp;<span class="builtintype" id="5053908">int</span>&nbsp;<span class="op" id="5053912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5053915">return</span>&nbsp;<span class="ident" id="5053922">sort</span><span class="op" id="5053926">.</span><span class="ident" id="5053927">Search</span><span class="op" id="5053933">(</span><span class="builtinfunc" id="5053934">len</span><span class="op" id="5053937">(</span><span class="ident" id="5053938">a</span><span class="op" id="5053939">)</span><span class="op" id="5053940">,</span>&nbsp;<span class="keyword" id="5053942">func</span><span class="op" id="5053946">(</span><span class="ident" id="5053947">i</span>&nbsp;<span class="builtintype" id="5053949">int</span><span class="op" id="5053952">)</span>&nbsp;<span class="builtintype" id="5053954">bool</span>&nbsp;<span class="op" id="5053959">{</span>&nbsp;<span class="keyword" id="5053961">return</span>&nbsp;<span class="ident" id="5053968">a</span><span class="op" id="5053969">[</span><span class="ident" id="5053970">i</span><span class="op" id="5053971">]</span><span class="op" id="5053972">.</span><span class="ident" id="5053973">base</span>&nbsp;<span class="op" id="5053978">&gt;</span>&nbsp;<span class="ident" id="5053980">x</span>&nbsp;<span class="op" id="5053982">}</span><span class="op" id="5053983">)</span>&nbsp;<span class="op" id="5053985">-</span>&nbsp;<span class="num" id="5053987">1</span><br>
<span class="lineno"></span><span class="op" id="5053989">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="5053992">func</span>&nbsp;<span class="op" id="5053997">(</span><span class="ident" id="5053998">s</span>&nbsp;<span class="op" id="5054000">*</span><span class="ident" id="5054001">FileSet</span><span class="op" id="5054008">)</span>&nbsp;<span class="ident" id="5054010">file</span><span class="op" id="5054014">(</span><span class="ident" id="5054015">p</span>&nbsp;<span class="ident" id="5054017">Pos</span><span class="op" id="5054020">)</span>&nbsp;<span class="op" id="5054022">*</span><span class="ident" id="5054023">File</span>&nbsp;<span class="op" id="5054028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054031">s</span><span class="op" id="5054032">.</span><span class="ident" id="5054033">mutex</span><span class="op" id="5054038">.</span><span class="ident" id="5054039">RLock</span><span class="op" id="5054044">(</span><span class="op" id="5054045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054048">//&nbsp;common&nbsp;case:&nbsp;p&nbsp;is&nbsp;in&nbsp;last&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054083">if</span>&nbsp;<span class="ident" id="5054086">f</span>&nbsp;<span class="op" id="5054088">:=</span>&nbsp;<span class="ident" id="5054091">s</span><span class="op" id="5054092">.</span><span class="ident" id="5054093">last</span><span class="op" id="5054097">;</span>&nbsp;<span class="ident" id="5054099">f</span>&nbsp;<span class="op" id="5054101">!=</span>&nbsp;<span class="builtintype" id="5054104">nil</span>&nbsp;<span class="op" id="5054108">&amp;&amp;</span>&nbsp;<span class="ident" id="5054111">f</span><span class="op" id="5054112">.</span><span class="ident" id="5054113">base</span>&nbsp;<span class="op" id="5054118">&lt;=</span>&nbsp;<span class="builtintype" id="5054121">int</span><span class="op" id="5054124">(</span><span class="ident" id="5054125">p</span><span class="op" id="5054126">)</span>&nbsp;<span class="op" id="5054128">&amp;&amp;</span>&nbsp;<span class="builtintype" id="5054131">int</span><span class="op" id="5054134">(</span><span class="ident" id="5054135">p</span><span class="op" id="5054136">)</span>&nbsp;<span class="op" id="5054138">&lt;=</span>&nbsp;<span class="ident" id="5054141">f</span><span class="op" id="5054142">.</span><span class="ident" id="5054143">base</span><span class="op" id="5054147">+</span><span class="ident" id="5054148">f</span><span class="op" id="5054149">.</span><span class="ident" id="5054150">size</span>&nbsp;<span class="op" id="5054155">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054159">s</span><span class="op" id="5054160">.</span><span class="ident" id="5054161">mutex</span><span class="op" id="5054166">.</span><span class="ident" id="5054167">RUnlock</span><span class="op" id="5054174">(</span><span class="op" id="5054175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054179">return</span>&nbsp;<span class="ident" id="5054186">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5054189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054192">//&nbsp;p&nbsp;is&nbsp;not&nbsp;in&nbsp;last&nbsp;file&nbsp;-&nbsp;search&nbsp;all&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054237">if</span>&nbsp;<span class="ident" id="5054240">i</span>&nbsp;<span class="op" id="5054242">:=</span>&nbsp;<span class="ident" id="5054245">searchFiles</span><span class="op" id="5054256">(</span><span class="ident" id="5054257">s</span><span class="op" id="5054258">.</span><span class="ident" id="5054259">files</span><span class="op" id="5054264">,</span>&nbsp;<span class="builtintype" id="5054266">int</span><span class="op" id="5054269">(</span><span class="ident" id="5054270">p</span><span class="op" id="5054271">)</span><span class="op" id="5054272">)</span><span class="op" id="5054273">;</span>&nbsp;<span class="ident" id="5054275">i</span>&nbsp;<span class="op" id="5054277">&gt;=</span>&nbsp;<span class="num" id="5054280">0</span>&nbsp;<span class="op" id="5054282">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054286">f</span>&nbsp;<span class="op" id="5054288">:=</span>&nbsp;<span class="ident" id="5054291">s</span><span class="op" id="5054292">.</span><span class="ident" id="5054293">files</span><span class="op" id="5054298">[</span><span class="ident" id="5054299">i</span><span class="op" id="5054300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5054304">//&nbsp;f.base&nbsp;&lt;=&nbsp;int(p)&nbsp;by&nbsp;definition&nbsp;of&nbsp;searchFiles</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054355">if</span>&nbsp;<span class="builtintype" id="5054358">int</span><span class="op" id="5054361">(</span><span class="ident" id="5054362">p</span><span class="op" id="5054363">)</span>&nbsp;<span class="op" id="5054365">&lt;=</span>&nbsp;<span class="ident" id="5054368">f</span><span class="op" id="5054369">.</span><span class="ident" id="5054370">base</span><span class="op" id="5054374">+</span><span class="ident" id="5054375">f</span><span class="op" id="5054376">.</span><span class="ident" id="5054377">size</span>&nbsp;<span class="op" id="5054382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054387">s</span><span class="op" id="5054388">.</span><span class="ident" id="5054389">mutex</span><span class="op" id="5054394">.</span><span class="ident" id="5054395">RUnlock</span><span class="op" id="5054402">(</span><span class="op" id="5054403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054408">s</span><span class="op" id="5054409">.</span><span class="ident" id="5054410">mutex</span><span class="op" id="5054415">.</span><span class="ident" id="5054416">Lock</span><span class="op" id="5054420">(</span><span class="op" id="5054421">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054426">s</span><span class="op" id="5054427">.</span><span class="ident" id="5054428">last</span>&nbsp;<span class="op" id="5054433">=</span>&nbsp;<span class="ident" id="5054435">f</span>&nbsp;<span class="comment" id="5054437">//&nbsp;race&nbsp;is&nbsp;ok&nbsp;-&nbsp;s.last&nbsp;is&nbsp;only&nbsp;a&nbsp;cache</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054479">s</span><span class="op" id="5054480">.</span><span class="ident" id="5054481">mutex</span><span class="op" id="5054486">.</span><span class="ident" id="5054487">Unlock</span><span class="op" id="5054493">(</span><span class="op" id="5054494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054499">return</span>&nbsp;<span class="ident" id="5054506">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5054510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5054513">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054516">s</span><span class="op" id="5054517">.</span><span class="ident" id="5054518">mutex</span><span class="op" id="5054523">.</span><span class="ident" id="5054524">RUnlock</span><span class="op" id="5054531">(</span><span class="op" id="5054532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054535">return</span>&nbsp;<span class="builtintype" id="5054542">nil</span><br>
<span class="lineno"></span><span class="op" id="5054546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5054549">//&nbsp;File&nbsp;returns&nbsp;the&nbsp;file&nbsp;that&nbsp;contains&nbsp;the&nbsp;position&nbsp;p.</span><br>
<span class="lineno">430</span><span class="comment" id="5054604">//&nbsp;If&nbsp;no&nbsp;such&nbsp;file&nbsp;is&nbsp;found&nbsp;(for&nbsp;instance&nbsp;for&nbsp;p&nbsp;==&nbsp;NoPos),</span><br>
<span class="lineno"></span><span class="comment" id="5054663">//&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="5054685">//</span><br>
<span class="lineno"></span><span class="keyword" id="5054688">func</span>&nbsp;<span class="op" id="5054693">(</span><span class="ident" id="5054694">s</span>&nbsp;<span class="op" id="5054696">*</span><span class="ident" id="5054697">FileSet</span><span class="op" id="5054704">)</span>&nbsp;<span class="ident" id="5054706">File</span><span class="op" id="5054710">(</span><span class="ident" id="5054711">p</span>&nbsp;<span class="ident" id="5054713">Pos</span><span class="op" id="5054716">)</span>&nbsp;<span class="op" id="5054718">(</span><span class="ident" id="5054719">f</span>&nbsp;<span class="op" id="5054721">*</span><span class="ident" id="5054722">File</span><span class="op" id="5054726">)</span>&nbsp;<span class="op" id="5054728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054731">if</span>&nbsp;<span class="ident" id="5054734">p</span>&nbsp;<span class="op" id="5054736">!=</span>&nbsp;<span class="ident" id="5054739">NoPos</span>&nbsp;<span class="op" id="5054745">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5054749">f</span>&nbsp;<span class="op" id="5054751">=</span>&nbsp;<span class="ident" id="5054753">s</span><span class="op" id="5054754">.</span><span class="ident" id="5054755">file</span><span class="op" id="5054759">(</span><span class="ident" id="5054760">p</span><span class="op" id="5054761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5054764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5054767">return</span><br>
<span class="lineno"></span><span class="op" id="5054774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="comment" id="5054777">//&nbsp;PositionFor&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="5054847">//&nbsp;If&nbsp;adjusted&nbsp;is&nbsp;set,&nbsp;the&nbsp;position&nbsp;may&nbsp;be&nbsp;adjusted&nbsp;by&nbsp;position-altering</span><br>
<span class="lineno"></span><span class="comment" id="5054920">//&nbsp;//line&nbsp;comments;&nbsp;otherwise&nbsp;those&nbsp;comments&nbsp;are&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5054978">//&nbsp;p&nbsp;must&nbsp;be&nbsp;a&nbsp;Pos&nbsp;value&nbsp;in&nbsp;s&nbsp;or&nbsp;NoPos.</span><br>
<span class="lineno"></span><span class="comment" id="5055018">//</span><br>
<span class="lineno">445</span><span class="keyword" id="5055021">func</span>&nbsp;<span class="op" id="5055026">(</span><span class="ident" id="5055027">s</span>&nbsp;<span class="op" id="5055029">*</span><span class="ident" id="5055030">FileSet</span><span class="op" id="5055037">)</span>&nbsp;<span class="ident" id="5055039">PositionFor</span><span class="op" id="5055050">(</span><span class="ident" id="5055051">p</span>&nbsp;<span class="ident" id="5055053">Pos</span><span class="op" id="5055056">,</span>&nbsp;<span class="ident" id="5055058">adjusted</span>&nbsp;<span class="builtintype" id="5055067">bool</span><span class="op" id="5055071">)</span>&nbsp;<span class="op" id="5055073">(</span><span class="ident" id="5055074">pos</span>&nbsp;<span class="ident" id="5055078">Position</span><span class="op" id="5055086">)</span>&nbsp;<span class="op" id="5055088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5055091">if</span>&nbsp;<span class="ident" id="5055094">p</span>&nbsp;<span class="op" id="5055096">!=</span>&nbsp;<span class="ident" id="5055099">NoPos</span>&nbsp;<span class="op" id="5055105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5055109">if</span>&nbsp;<span class="ident" id="5055112">f</span>&nbsp;<span class="op" id="5055114">:=</span>&nbsp;<span class="ident" id="5055117">s</span><span class="op" id="5055118">.</span><span class="ident" id="5055119">file</span><span class="op" id="5055123">(</span><span class="ident" id="5055124">p</span><span class="op" id="5055125">)</span><span class="op" id="5055126">;</span>&nbsp;<span class="ident" id="5055128">f</span>&nbsp;<span class="op" id="5055130">!=</span>&nbsp;<span class="builtintype" id="5055133">nil</span>&nbsp;<span class="op" id="5055137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5055142">pos</span>&nbsp;<span class="op" id="5055146">=</span>&nbsp;<span class="ident" id="5055148">f</span><span class="op" id="5055149">.</span><span class="ident" id="5055150">position</span><span class="op" id="5055158">(</span><span class="ident" id="5055159">p</span><span class="op" id="5055160">,</span>&nbsp;<span class="ident" id="5055162">adjusted</span><span class="op" id="5055170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5055174">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5055177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5055180">return</span><br>
<span class="lineno"></span><span class="op" id="5055187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5055190">//&nbsp;Position&nbsp;converts&nbsp;a&nbsp;Pos&nbsp;p&nbsp;in&nbsp;the&nbsp;fileset&nbsp;into&nbsp;a&nbsp;Position&nbsp;value.</span><br>
<span class="lineno">455</span><span class="comment" id="5055257">//&nbsp;Calling&nbsp;s.Position(p)&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;calling&nbsp;s.PositionFor(p,&nbsp;true).</span><br>
<span class="lineno"></span><span class="comment" id="5055331">//</span><br>
<span class="lineno"></span><span class="keyword" id="5055334">func</span>&nbsp;<span class="op" id="5055339">(</span><span class="ident" id="5055340">s</span>&nbsp;<span class="op" id="5055342">*</span><span class="ident" id="5055343">FileSet</span><span class="op" id="5055350">)</span>&nbsp;<span class="ident" id="5055352">Position</span><span class="op" id="5055360">(</span><span class="ident" id="5055361">p</span>&nbsp;<span class="ident" id="5055363">Pos</span><span class="op" id="5055366">)</span>&nbsp;<span class="op" id="5055368">(</span><span class="ident" id="5055369">pos</span>&nbsp;<span class="ident" id="5055373">Position</span><span class="op" id="5055381">)</span>&nbsp;<span class="op" id="5055383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5055386">return</span>&nbsp;<span class="ident" id="5055393">s</span><span class="op" id="5055394">.</span><span class="ident" id="5055395">PositionFor</span><span class="op" id="5055406">(</span><span class="ident" id="5055407">p</span><span class="op" id="5055408">,</span>&nbsp;<span class="builtintype" id="5055410">true</span><span class="op" id="5055414">)</span><br>
<span class="lineno"></span><span class="op" id="5055416">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span><span class="comment" id="5055419">//&nbsp;-----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5055500">//&nbsp;Helper&nbsp;functions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5055521">func</span>&nbsp;<span class="ident" id="5055526">searchInts</span><span class="op" id="5055536">(</span><span class="ident" id="5055537">a</span>&nbsp;<span class="op" id="5055539">[</span><span class="op" id="5055540">]</span><span class="builtintype" id="5055541">int</span><span class="op" id="5055544">,</span>&nbsp;<span class="ident" id="5055546">x</span>&nbsp;<span class="builtintype" id="5055548">int</span><span class="op" id="5055551">)</span>&nbsp;<span class="builtintype" id="5055553">int</span>&nbsp;<span class="op" id="5055557">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055560">//&nbsp;This&nbsp;function&nbsp;body&nbsp;is&nbsp;a&nbsp;manually&nbsp;inlined&nbsp;version&nbsp;of:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055617">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055621">//&nbsp;&nbsp;&nbsp;return&nbsp;sort.Search(len(a),&nbsp;func(i&nbsp;int)&nbsp;bool&nbsp;{&nbsp;return&nbsp;a[i]&nbsp;&gt;&nbsp;x&nbsp;})&nbsp;-&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055696">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055700">//&nbsp;With&nbsp;better&nbsp;compiler&nbsp;optimizations,&nbsp;this&nbsp;may&nbsp;not&nbsp;be&nbsp;needed&nbsp;in&nbsp;the</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055770">//&nbsp;future,&nbsp;but&nbsp;at&nbsp;the&nbsp;moment&nbsp;this&nbsp;change&nbsp;improves&nbsp;the&nbsp;go/printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055836">//&nbsp;benchmark&nbsp;performance&nbsp;by&nbsp;~30%.&nbsp;This&nbsp;has&nbsp;a&nbsp;direct&nbsp;impact&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055903">//&nbsp;speed&nbsp;of&nbsp;gofmt&nbsp;and&nbsp;thus&nbsp;seems&nbsp;worthwhile&nbsp;(2011-04-29).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5055962">//&nbsp;TODO(gri):&nbsp;Remove&nbsp;this&nbsp;when&nbsp;compilers&nbsp;have&nbsp;caught&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056020">i</span><span class="op" id="5056021">,</span>&nbsp;<span class="ident" id="5056023">j</span>&nbsp;<span class="op" id="5056025">:=</span>&nbsp;<span class="num" id="5056028">0</span><span class="op" id="5056029">,</span>&nbsp;<span class="builtinfunc" id="5056031">len</span><span class="op" id="5056034">(</span><span class="ident" id="5056035">a</span><span class="op" id="5056036">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056039">for</span>&nbsp;<span class="ident" id="5056043">i</span>&nbsp;<span class="op" id="5056045">&lt;</span>&nbsp;<span class="ident" id="5056047">j</span>&nbsp;<span class="op" id="5056049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056053">h</span>&nbsp;<span class="op" id="5056055">:=</span>&nbsp;<span class="ident" id="5056058">i</span>&nbsp;<span class="op" id="5056060">+</span>&nbsp;<span class="op" id="5056062">(</span><span class="ident" id="5056063">j</span><span class="op" id="5056064">-</span><span class="ident" id="5056065">i</span><span class="op" id="5056066">)</span><span class="op" id="5056067">/</span><span class="num" id="5056068">2</span>&nbsp;<span class="comment" id="5056070">//&nbsp;avoid&nbsp;overflow&nbsp;when&nbsp;computing&nbsp;h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5056107">//&nbsp;i&nbsp;≤&nbsp;h&nbsp;&lt;&nbsp;j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056124">if</span>&nbsp;<span class="ident" id="5056127">a</span><span class="op" id="5056128">[</span><span class="ident" id="5056129">h</span><span class="op" id="5056130">]</span>&nbsp;<span class="op" id="5056132">&lt;=</span>&nbsp;<span class="ident" id="5056135">x</span>&nbsp;<span class="op" id="5056137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056142">i</span>&nbsp;<span class="op" id="5056144">=</span>&nbsp;<span class="ident" id="5056146">h</span>&nbsp;<span class="op" id="5056148">+</span>&nbsp;<span class="num" id="5056150">1</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5056154">}</span>&nbsp;<span class="keyword" id="5056156">else</span>&nbsp;<span class="op" id="5056161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5056166">j</span>&nbsp;<span class="op" id="5056168">=</span>&nbsp;<span class="ident" id="5056170">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5056174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5056177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5056180">return</span>&nbsp;<span class="ident" id="5056187">i</span>&nbsp;<span class="op" id="5056189">-</span>&nbsp;<span class="num" id="5056191">1</span><br>
<span class="lineno">485</span><span class="op" id="5056193">}</span>
</div>
</body>
</html>
