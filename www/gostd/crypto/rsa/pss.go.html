<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html" class="current">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4468180">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4468235">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4468289">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4468340">package</span>&nbsp;<span class="ident" id="4468348">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4468353">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4468407">//</span><br>
<span class="lineno"></span><span class="comment" id="4468410">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4468507">import</span>&nbsp;<span class="op" id="4468514">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468517">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468526">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468536">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468546">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468554">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4468560">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4468571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4468574">func</span>&nbsp;<span class="ident" id="4468579">emsaPSSEncode</span><span class="op" id="4468592">(</span><span class="ident" id="4468593">mHash</span>&nbsp;<span class="op" id="4468599">[</span><span class="op" id="4468600">]</span><span class="builtintype" id="4468601">byte</span><span class="op" id="4468605">,</span>&nbsp;<span class="ident" id="4468607">emBits</span>&nbsp;<span class="builtintype" id="4468614">int</span><span class="op" id="4468617">,</span>&nbsp;<span class="ident" id="4468619">salt</span>&nbsp;<span class="op" id="4468624">[</span><span class="op" id="4468625">]</span><span class="builtintype" id="4468626">byte</span><span class="op" id="4468630">,</span>&nbsp;<span class="ident" id="4468632">hash</span>&nbsp;<span class="ident" id="4468637">hash</span><span class="op" id="4468641">.</span><span class="ident" id="4468642">Hash</span><span class="op" id="4468646">)</span>&nbsp;<span class="op" id="4468648">(</span><span class="op" id="4468649">[</span><span class="op" id="4468650">]</span><span class="builtintype" id="4468651">byte</span><span class="op" id="4468655">,</span>&nbsp;<span class="builtintype" id="4468657">error</span><span class="op" id="4468662">)</span>&nbsp;<span class="op" id="4468664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468667">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468694">hLen</span>&nbsp;<span class="op" id="4468699">:=</span>&nbsp;<span class="ident" id="4468702">hash</span><span class="op" id="4468706">.</span><span class="ident" id="4468707">Size</span><span class="op" id="4468711">(</span><span class="op" id="4468712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468715">sLen</span>&nbsp;<span class="op" id="4468720">:=</span>&nbsp;<span class="builtinfunc" id="4468723">len</span><span class="op" id="4468726">(</span><span class="ident" id="4468727">salt</span><span class="op" id="4468731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4468734">emLen</span>&nbsp;<span class="op" id="4468740">:=</span>&nbsp;<span class="op" id="4468743">(</span><span class="ident" id="4468744">emBits</span>&nbsp;<span class="op" id="4468751">+</span>&nbsp;<span class="num" id="4468753">7</span><span class="op" id="4468754">)</span>&nbsp;<span class="op" id="4468756">/</span>&nbsp;<span class="num" id="4468758">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468762">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468834">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468905">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468929">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4468933">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4468995">if</span>&nbsp;<span class="builtinfunc" id="4468998">len</span><span class="op" id="4469001">(</span><span class="ident" id="4469002">mHash</span><span class="op" id="4469007">)</span>&nbsp;<span class="op" id="4469009">!=</span>&nbsp;<span class="ident" id="4469012">hLen</span>&nbsp;<span class="op" id="4469017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469021">return</span>&nbsp;<span class="builtintype" id="4469028">nil</span><span class="op" id="4469031">,</span>&nbsp;<span class="ident" id="4469033">errors</span><span class="op" id="4469039">.</span><span class="ident" id="4469040">New</span><span class="op" id="4469043">(</span><span class="string" id="4469044">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4469086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469089">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469093">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469164">if</span>&nbsp;<span class="ident" id="4469167">emLen</span>&nbsp;<span class="op" id="4469173">&lt;</span>&nbsp;<span class="ident" id="4469175">hLen</span><span class="op" id="4469179">+</span><span class="ident" id="4469180">sLen</span><span class="op" id="4469184">+</span><span class="num" id="4469185">2</span>&nbsp;<span class="op" id="4469187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469191">return</span>&nbsp;<span class="builtintype" id="4469198">nil</span><span class="op" id="4469201">,</span>&nbsp;<span class="ident" id="4469203">errors</span><span class="op" id="4469209">.</span><span class="ident" id="4469210">New</span><span class="op" id="4469213">(</span><span class="string" id="4469214">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="4469242">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4469245">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469249">em</span>&nbsp;<span class="op" id="4469252">:=</span>&nbsp;<span class="builtinfunc" id="4469255">make</span><span class="op" id="4469259">(</span><span class="op" id="4469260">[</span><span class="op" id="4469261">]</span><span class="builtintype" id="4469262">byte</span><span class="op" id="4469266">,</span>&nbsp;<span class="ident" id="4469268">emLen</span><span class="op" id="4469273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469276">db</span>&nbsp;<span class="op" id="4469279">:=</span>&nbsp;<span class="ident" id="4469282">em</span><span class="op" id="4469284">[</span><span class="op" id="4469285">:</span><span class="ident" id="4469286">emLen</span><span class="op" id="4469291">-</span><span class="ident" id="4469292">sLen</span><span class="op" id="4469296">-</span><span class="ident" id="4469297">hLen</span><span class="op" id="4469301">-</span><span class="num" id="4469302">2</span><span class="op" id="4469303">+</span><span class="num" id="4469304">1</span><span class="op" id="4469305">+</span><span class="ident" id="4469306">sLen</span><span class="op" id="4469310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469313">h</span>&nbsp;<span class="op" id="4469315">:=</span>&nbsp;<span class="ident" id="4469318">em</span><span class="op" id="4469320">[</span><span class="ident" id="4469321">emLen</span><span class="op" id="4469326">-</span><span class="ident" id="4469327">sLen</span><span class="op" id="4469331">-</span><span class="ident" id="4469332">hLen</span><span class="op" id="4469336">-</span><span class="num" id="4469337">2</span><span class="op" id="4469338">+</span><span class="num" id="4469339">1</span><span class="op" id="4469340">+</span><span class="ident" id="4469341">sLen</span>&nbsp;<span class="op" id="4469346">:</span>&nbsp;<span class="ident" id="4469348">emLen</span><span class="op" id="4469353">-</span><span class="num" id="4469354">1</span><span class="op" id="4469355">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469359">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469432">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469471">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469475">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469487">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469548">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469552">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469619">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469648">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469652">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4469711">var</span>&nbsp;<span class="ident" id="4469715">prefix</span>&nbsp;<span class="op" id="4469722">[</span><span class="num" id="4469723">8</span><span class="op" id="4469724">]</span><span class="builtintype" id="4469725">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469732">hash</span><span class="op" id="4469736">.</span><span class="ident" id="4469737">Write</span><span class="op" id="4469742">(</span><span class="ident" id="4469743">prefix</span><span class="op" id="4469749">[</span><span class="op" id="4469750">:</span><span class="op" id="4469751">]</span><span class="op" id="4469752">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469755">hash</span><span class="op" id="4469759">.</span><span class="ident" id="4469760">Write</span><span class="op" id="4469765">(</span><span class="ident" id="4469766">mHash</span><span class="op" id="4469771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469774">hash</span><span class="op" id="4469778">.</span><span class="ident" id="4469779">Write</span><span class="op" id="4469784">(</span><span class="ident" id="4469785">salt</span><span class="op" id="4469789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469793">h</span>&nbsp;<span class="op" id="4469795">=</span>&nbsp;<span class="ident" id="4469797">hash</span><span class="op" id="4469801">.</span><span class="ident" id="4469802">Sum</span><span class="op" id="4469805">(</span><span class="ident" id="4469806">h</span><span class="op" id="4469807">[</span><span class="op" id="4469808">:</span><span class="num" id="4469809">0</span><span class="op" id="4469810">]</span><span class="op" id="4469811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4469814">hash</span><span class="op" id="4469818">.</span><span class="ident" id="4469819">Reset</span><span class="op" id="4469824">(</span><span class="op" id="4469825">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469829">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469903">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469952">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4469956">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470025">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470052">db</span><span class="op" id="4470054">[</span><span class="ident" id="4470055">emLen</span><span class="op" id="4470060">-</span><span class="ident" id="4470061">sLen</span><span class="op" id="4470065">-</span><span class="ident" id="4470066">hLen</span><span class="op" id="4470070">-</span><span class="num" id="4470071">2</span><span class="op" id="4470072">]</span>&nbsp;<span class="op" id="4470074">=</span>&nbsp;<span class="num" id="4470076">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4470082">copy</span><span class="op" id="4470086">(</span><span class="ident" id="4470087">db</span><span class="op" id="4470089">[</span><span class="ident" id="4470090">emLen</span><span class="op" id="4470095">-</span><span class="ident" id="4470096">sLen</span><span class="op" id="4470100">-</span><span class="ident" id="4470101">hLen</span><span class="op" id="4470105">-</span><span class="num" id="4470106">1</span><span class="op" id="4470107">:</span><span class="op" id="4470108">]</span><span class="op" id="4470109">,</span>&nbsp;<span class="ident" id="4470111">salt</span><span class="op" id="4470115">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470119">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470166">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470170">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470210">mgf1XOR</span><span class="op" id="4470217">(</span><span class="ident" id="4470218">db</span><span class="op" id="4470220">,</span>&nbsp;<span class="ident" id="4470222">hash</span><span class="op" id="4470226">,</span>&nbsp;<span class="ident" id="4470228">h</span><span class="op" id="4470229">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470233">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470307">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470334">db</span><span class="op" id="4470336">[</span><span class="num" id="4470337">0</span><span class="op" id="4470338">]</span>&nbsp;<span class="op" id="4470340">&amp;=</span>&nbsp;<span class="op" id="4470343">(</span><span class="num" id="4470344">0xFF</span>&nbsp;<span class="op" id="4470349">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4470352">uint</span><span class="op" id="4470356">(</span><span class="num" id="4470357">8</span><span class="op" id="4470358">*</span><span class="ident" id="4470359">emLen</span><span class="op" id="4470364">-</span><span class="ident" id="4470365">emBits</span><span class="op" id="4470371">)</span><span class="op" id="4470372">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470376">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470416">em</span><span class="op" id="4470418">[</span><span class="ident" id="4470419">emLen</span><span class="op" id="4470424">-</span><span class="num" id="4470425">1</span><span class="op" id="4470426">]</span>&nbsp;<span class="op" id="4470428">=</span>&nbsp;<span class="num" id="4470430">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470437">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470456">return</span>&nbsp;<span class="ident" id="4470463">em</span><span class="op" id="4470465">,</span>&nbsp;<span class="builtintype" id="4470467">nil</span><br>
<span class="lineno"></span><span class="op" id="4470471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4470474">func</span>&nbsp;<span class="ident" id="4470479">emsaPSSVerify</span><span class="op" id="4470492">(</span><span class="ident" id="4470493">mHash</span><span class="op" id="4470498">,</span>&nbsp;<span class="ident" id="4470500">em</span>&nbsp;<span class="op" id="4470503">[</span><span class="op" id="4470504">]</span><span class="builtintype" id="4470505">byte</span><span class="op" id="4470509">,</span>&nbsp;<span class="ident" id="4470511">emBits</span><span class="op" id="4470517">,</span>&nbsp;<span class="ident" id="4470519">sLen</span>&nbsp;<span class="builtintype" id="4470524">int</span><span class="op" id="4470527">,</span>&nbsp;<span class="ident" id="4470529">hash</span>&nbsp;<span class="ident" id="4470534">hash</span><span class="op" id="4470538">.</span><span class="ident" id="4470539">Hash</span><span class="op" id="4470543">)</span>&nbsp;<span class="builtintype" id="4470545">error</span>&nbsp;<span class="op" id="4470551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470554">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470626">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470699">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470717">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470721">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470782">hLen</span>&nbsp;<span class="op" id="4470787">:=</span>&nbsp;<span class="ident" id="4470790">hash</span><span class="op" id="4470794">.</span><span class="ident" id="4470795">Size</span><span class="op" id="4470799">(</span><span class="op" id="4470800">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470803">if</span>&nbsp;<span class="ident" id="4470806">hLen</span>&nbsp;<span class="op" id="4470811">!=</span>&nbsp;<span class="builtinfunc" id="4470814">len</span><span class="op" id="4470817">(</span><span class="ident" id="4470818">mHash</span><span class="op" id="4470823">)</span>&nbsp;<span class="op" id="4470825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470829">return</span>&nbsp;<span class="ident" id="4470836">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4470853">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4470857">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4470925">emLen</span>&nbsp;<span class="op" id="4470931">:=</span>&nbsp;<span class="op" id="4470934">(</span><span class="ident" id="4470935">emBits</span>&nbsp;<span class="op" id="4470942">+</span>&nbsp;<span class="num" id="4470944">7</span><span class="op" id="4470945">)</span>&nbsp;<span class="op" id="4470947">/</span>&nbsp;<span class="num" id="4470949">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470952">if</span>&nbsp;<span class="ident" id="4470955">emLen</span>&nbsp;<span class="op" id="4470961">&lt;</span>&nbsp;<span class="ident" id="4470963">hLen</span><span class="op" id="4470967">+</span><span class="ident" id="4470968">sLen</span><span class="op" id="4470972">+</span><span class="num" id="4470973">2</span>&nbsp;<span class="op" id="4470975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4470979">return</span>&nbsp;<span class="ident" id="4470986">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471007">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471076">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471122">if</span>&nbsp;<span class="ident" id="4471125">em</span><span class="op" id="4471127">[</span><span class="builtinfunc" id="4471128">len</span><span class="op" id="4471131">(</span><span class="ident" id="4471132">em</span><span class="op" id="4471134">)</span><span class="op" id="4471135">-</span><span class="num" id="4471136">1</span><span class="op" id="4471137">]</span>&nbsp;<span class="op" id="4471139">!=</span>&nbsp;<span class="num" id="4471142">0xBC</span>&nbsp;<span class="op" id="4471147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471151">return</span>&nbsp;<span class="ident" id="4471158">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471175">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471179">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471251">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471290">db</span>&nbsp;<span class="op" id="4471293">:=</span>&nbsp;<span class="ident" id="4471296">em</span><span class="op" id="4471298">[</span><span class="op" id="4471299">:</span><span class="ident" id="4471300">emLen</span><span class="op" id="4471305">-</span><span class="ident" id="4471306">hLen</span><span class="op" id="4471310">-</span><span class="num" id="4471311">1</span><span class="op" id="4471312">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471315">h</span>&nbsp;<span class="op" id="4471317">:=</span>&nbsp;<span class="ident" id="4471320">em</span><span class="op" id="4471322">[</span><span class="ident" id="4471323">emLen</span><span class="op" id="4471328">-</span><span class="ident" id="4471329">hLen</span><span class="op" id="4471333">-</span><span class="num" id="4471334">1</span>&nbsp;<span class="op" id="4471336">:</span>&nbsp;<span class="builtinfunc" id="4471338">len</span><span class="op" id="4471341">(</span><span class="ident" id="4471342">em</span><span class="op" id="4471344">)</span><span class="op" id="4471345">-</span><span class="num" id="4471346">1</span><span class="op" id="4471347">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471351">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471424">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471494">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471508">if</span>&nbsp;<span class="ident" id="4471511">em</span><span class="op" id="4471513">[</span><span class="num" id="4471514">0</span><span class="op" id="4471515">]</span><span class="op" id="4471516">&amp;</span><span class="op" id="4471517">(</span><span class="num" id="4471518">0xFF</span><span class="op" id="4471522">&lt;&lt;</span><span class="builtintype" id="4471524">uint</span><span class="op" id="4471528">(</span><span class="num" id="4471529">8</span><span class="op" id="4471530">-</span><span class="op" id="4471531">(</span><span class="num" id="4471532">8</span><span class="op" id="4471533">*</span><span class="ident" id="4471534">emLen</span><span class="op" id="4471539">-</span><span class="ident" id="4471540">emBits</span><span class="op" id="4471546">)</span><span class="op" id="4471547">)</span><span class="op" id="4471548">)</span>&nbsp;<span class="op" id="4471550">!=</span>&nbsp;<span class="num" id="4471553">0</span>&nbsp;<span class="op" id="4471555">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471559">return</span>&nbsp;<span class="ident" id="4471566">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4471583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471587">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471634">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471638">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471677">mgf1XOR</span><span class="op" id="4471684">(</span><span class="ident" id="4471685">db</span><span class="op" id="4471687">,</span>&nbsp;<span class="ident" id="4471689">hash</span><span class="op" id="4471693">,</span>&nbsp;<span class="ident" id="4471695">h</span><span class="op" id="4471696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471700">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4471777">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471794">db</span><span class="op" id="4471796">[</span><span class="num" id="4471797">0</span><span class="op" id="4471798">]</span>&nbsp;<span class="op" id="4471800">&amp;=</span>&nbsp;<span class="op" id="4471803">(</span><span class="num" id="4471804">0xFF</span>&nbsp;<span class="op" id="4471809">&gt;&gt;</span>&nbsp;<span class="builtintype" id="4471812">uint</span><span class="op" id="4471816">(</span><span class="num" id="4471817">8</span><span class="op" id="4471818">*</span><span class="ident" id="4471819">emLen</span><span class="op" id="4471824">-</span><span class="ident" id="4471825">emBits</span><span class="op" id="4471831">)</span><span class="op" id="4471832">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471836">if</span>&nbsp;<span class="ident" id="4471839">sLen</span>&nbsp;<span class="op" id="4471844">==</span>&nbsp;<span class="ident" id="4471847">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4471865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4471868">FindSaltLength</span><span class="op" id="4471882">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471886">for</span>&nbsp;<span class="ident" id="4471890">sLen</span>&nbsp;<span class="op" id="4471895">=</span>&nbsp;<span class="ident" id="4471897">emLen</span>&nbsp;<span class="op" id="4471903">-</span>&nbsp;<span class="op" id="4471905">(</span><span class="ident" id="4471906">hLen</span>&nbsp;<span class="op" id="4471911">+</span>&nbsp;<span class="num" id="4471913">2</span><span class="op" id="4471914">)</span><span class="op" id="4471915">;</span>&nbsp;<span class="ident" id="4471917">sLen</span>&nbsp;<span class="op" id="4471922">&gt;=</span>&nbsp;<span class="num" id="4471925">0</span><span class="op" id="4471926">;</span>&nbsp;<span class="ident" id="4471928">sLen</span><span class="op" id="4471932">--</span>&nbsp;<span class="op" id="4471935">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471940">switch</span>&nbsp;<span class="ident" id="4471947">db</span><span class="op" id="4471949">[</span><span class="ident" id="4471950">emLen</span><span class="op" id="4471955">-</span><span class="ident" id="4471956">hLen</span><span class="op" id="4471960">-</span><span class="ident" id="4471961">sLen</span><span class="op" id="4471965">-</span><span class="num" id="4471966">2</span><span class="op" id="4471967">]</span>&nbsp;<span class="op" id="4471969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471974">case</span>&nbsp;<span class="num" id="4471979">1</span><span class="op" id="4471980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4471986">break</span>&nbsp;<span class="ident" id="4471992">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472010">case</span>&nbsp;<span class="num" id="4472015">0</span><span class="op" id="4472016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472022">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472034">default</span><span class="op" id="4472041">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472047">return</span>&nbsp;<span class="ident" id="4472054">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472081">if</span>&nbsp;<span class="ident" id="4472084">sLen</span>&nbsp;<span class="op" id="4472089">&lt;</span>&nbsp;<span class="num" id="4472091">0</span>&nbsp;<span class="op" id="4472093">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472098">return</span>&nbsp;<span class="ident" id="4472105">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472126">}</span>&nbsp;<span class="keyword" id="4472128">else</span>&nbsp;<span class="op" id="4472133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472137">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472212">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472287">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472360">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472401">for</span>&nbsp;<span class="ident" id="4472405">_</span><span class="op" id="4472406">,</span>&nbsp;<span class="ident" id="4472408">e</span>&nbsp;<span class="op" id="4472410">:=</span>&nbsp;<span class="keyword" id="4472413">range</span>&nbsp;<span class="ident" id="4472419">db</span><span class="op" id="4472421">[</span><span class="op" id="4472422">:</span><span class="ident" id="4472423">emLen</span><span class="op" id="4472428">-</span><span class="ident" id="4472429">hLen</span><span class="op" id="4472433">-</span><span class="ident" id="4472434">sLen</span><span class="op" id="4472438">-</span><span class="num" id="4472439">2</span><span class="op" id="4472440">]</span>&nbsp;<span class="op" id="4472442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472447">if</span>&nbsp;<span class="ident" id="4472450">e</span>&nbsp;<span class="op" id="4472452">!=</span>&nbsp;<span class="num" id="4472455">0x00</span>&nbsp;<span class="op" id="4472460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472466">return</span>&nbsp;<span class="ident" id="4472473">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472500">if</span>&nbsp;<span class="ident" id="4472503">db</span><span class="op" id="4472505">[</span><span class="ident" id="4472506">emLen</span><span class="op" id="4472511">-</span><span class="ident" id="4472512">hLen</span><span class="op" id="4472516">-</span><span class="ident" id="4472517">sLen</span><span class="op" id="4472521">-</span><span class="num" id="4472522">2</span><span class="op" id="4472523">]</span>&nbsp;<span class="op" id="4472525">!=</span>&nbsp;<span class="num" id="4472528">0x01</span>&nbsp;<span class="op" id="4472533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472538">return</span>&nbsp;<span class="ident" id="4472545">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472563">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4472566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472570">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472619">salt</span>&nbsp;<span class="op" id="4472624">:=</span>&nbsp;<span class="ident" id="4472627">db</span><span class="op" id="4472629">[</span><span class="builtinfunc" id="4472630">len</span><span class="op" id="4472633">(</span><span class="ident" id="4472634">db</span><span class="op" id="4472636">)</span><span class="op" id="4472637">-</span><span class="ident" id="4472638">sLen</span><span class="op" id="4472642">:</span><span class="op" id="4472643">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472647">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472660">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472725">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472792">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472821">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472825">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4472884">var</span>&nbsp;<span class="ident" id="4472888">prefix</span>&nbsp;<span class="op" id="4472895">[</span><span class="num" id="4472896">8</span><span class="op" id="4472897">]</span><span class="builtintype" id="4472898">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472904">hash</span><span class="op" id="4472908">.</span><span class="ident" id="4472909">Write</span><span class="op" id="4472914">(</span><span class="ident" id="4472915">prefix</span><span class="op" id="4472921">[</span><span class="op" id="4472922">:</span><span class="op" id="4472923">]</span><span class="op" id="4472924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472927">hash</span><span class="op" id="4472931">.</span><span class="ident" id="4472932">Write</span><span class="op" id="4472937">(</span><span class="ident" id="4472938">mHash</span><span class="op" id="4472943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472946">hash</span><span class="op" id="4472950">.</span><span class="ident" id="4472951">Write</span><span class="op" id="4472956">(</span><span class="ident" id="4472957">salt</span><span class="op" id="4472961">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4472965">h0</span>&nbsp;<span class="op" id="4472968">:=</span>&nbsp;<span class="ident" id="4472971">hash</span><span class="op" id="4472975">.</span><span class="ident" id="4472976">Sum</span><span class="op" id="4472979">(</span><span class="builtintype" id="4472980">nil</span><span class="op" id="4472983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4472987">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473061">if</span>&nbsp;<span class="op" id="4473064">!</span><span class="ident" id="4473065">bytes</span><span class="op" id="4473070">.</span><span class="ident" id="4473071">Equal</span><span class="op" id="4473076">(</span><span class="ident" id="4473077">h0</span><span class="op" id="4473079">,</span>&nbsp;<span class="ident" id="4473081">h</span><span class="op" id="4473082">)</span>&nbsp;<span class="op" id="4473084">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473088">return</span>&nbsp;<span class="ident" id="4473095">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473115">return</span>&nbsp;<span class="builtintype" id="4473122">nil</span><br>
<span class="lineno"></span><span class="op" id="4473126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4473129">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="4473218">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4473296">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4473376">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="4473415">func</span>&nbsp;<span class="ident" id="4473420">signPSSWithSalt</span><span class="op" id="4473435">(</span><span class="ident" id="4473436">rand</span>&nbsp;<span class="ident" id="4473441">io</span><span class="op" id="4473443">.</span><span class="ident" id="4473444">Reader</span><span class="op" id="4473450">,</span>&nbsp;<span class="ident" id="4473452">priv</span>&nbsp;<span class="op" id="4473457">*</span><span class="ident" id="4473458">PrivateKey</span><span class="op" id="4473468">,</span>&nbsp;<span class="ident" id="4473470">hash</span>&nbsp;<span class="ident" id="4473475">crypto</span><span class="op" id="4473481">.</span><span class="ident" id="4473482">Hash</span><span class="op" id="4473486">,</span>&nbsp;<span class="ident" id="4473488">hashed</span><span class="op" id="4473494">,</span>&nbsp;<span class="ident" id="4473496">salt</span>&nbsp;<span class="op" id="4473501">[</span><span class="op" id="4473502">]</span><span class="builtintype" id="4473503">byte</span><span class="op" id="4473507">)</span>&nbsp;<span class="op" id="4473509">(</span><span class="ident" id="4473510">s</span>&nbsp;<span class="op" id="4473512">[</span><span class="op" id="4473513">]</span><span class="builtintype" id="4473514">byte</span><span class="op" id="4473518">,</span>&nbsp;<span class="ident" id="4473520">err</span>&nbsp;<span class="builtintype" id="4473524">error</span><span class="op" id="4473529">)</span>&nbsp;<span class="op" id="4473531">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473534">nBits</span>&nbsp;<span class="op" id="4473540">:=</span>&nbsp;<span class="ident" id="4473543">priv</span><span class="op" id="4473547">.</span><span class="ident" id="4473548">N</span><span class="op" id="4473549">.</span><span class="ident" id="4473550">BitLen</span><span class="op" id="4473556">(</span><span class="op" id="4473557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473560">em</span><span class="op" id="4473562">,</span>&nbsp;<span class="ident" id="4473564">err</span>&nbsp;<span class="op" id="4473568">:=</span>&nbsp;<span class="ident" id="4473571">emsaPSSEncode</span><span class="op" id="4473584">(</span><span class="ident" id="4473585">hashed</span><span class="op" id="4473591">,</span>&nbsp;<span class="ident" id="4473593">nBits</span><span class="op" id="4473598">-</span><span class="num" id="4473599">1</span><span class="op" id="4473600">,</span>&nbsp;<span class="ident" id="4473602">salt</span><span class="op" id="4473606">,</span>&nbsp;<span class="ident" id="4473608">hash</span><span class="op" id="4473612">.</span><span class="ident" id="4473613">New</span><span class="op" id="4473616">(</span><span class="op" id="4473617">)</span><span class="op" id="4473618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473621">if</span>&nbsp;<span class="ident" id="4473624">err</span>&nbsp;<span class="op" id="4473628">!=</span>&nbsp;<span class="builtintype" id="4473631">nil</span>&nbsp;<span class="op" id="4473635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473639">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473647">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473650">m</span>&nbsp;<span class="op" id="4473652">:=</span>&nbsp;<span class="builtinfunc" id="4473655">new</span><span class="op" id="4473658">(</span><span class="ident" id="4473659">big</span><span class="op" id="4473662">.</span><span class="ident" id="4473663">Int</span><span class="op" id="4473666">)</span><span class="op" id="4473667">.</span><span class="ident" id="4473668">SetBytes</span><span class="op" id="4473676">(</span><span class="ident" id="4473677">em</span><span class="op" id="4473679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473682">c</span><span class="op" id="4473683">,</span>&nbsp;<span class="ident" id="4473685">err</span>&nbsp;<span class="op" id="4473689">:=</span>&nbsp;<span class="ident" id="4473692">decrypt</span><span class="op" id="4473699">(</span><span class="ident" id="4473700">rand</span><span class="op" id="4473704">,</span>&nbsp;<span class="ident" id="4473706">priv</span><span class="op" id="4473710">,</span>&nbsp;<span class="ident" id="4473712">m</span><span class="op" id="4473713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473716">if</span>&nbsp;<span class="ident" id="4473719">err</span>&nbsp;<span class="op" id="4473723">!=</span>&nbsp;<span class="builtintype" id="4473726">nil</span>&nbsp;<span class="op" id="4473730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473734">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4473742">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473745">s</span>&nbsp;<span class="op" id="4473747">=</span>&nbsp;<span class="builtinfunc" id="4473749">make</span><span class="op" id="4473753">(</span><span class="op" id="4473754">[</span><span class="op" id="4473755">]</span><span class="builtintype" id="4473756">byte</span><span class="op" id="4473760">,</span>&nbsp;<span class="op" id="4473762">(</span><span class="ident" id="4473763">nBits</span><span class="op" id="4473768">+</span><span class="num" id="4473769">7</span><span class="op" id="4473770">)</span><span class="op" id="4473771">/</span><span class="num" id="4473772">8</span><span class="op" id="4473773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473776">copyWithLeftPad</span><span class="op" id="4473791">(</span><span class="ident" id="4473792">s</span><span class="op" id="4473793">,</span>&nbsp;<span class="ident" id="4473795">c</span><span class="op" id="4473796">.</span><span class="ident" id="4473797">Bytes</span><span class="op" id="4473802">(</span><span class="op" id="4473803">)</span><span class="op" id="4473804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4473807">return</span><br>
<span class="lineno"></span><span class="op" id="4473814">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="4473817">const</span>&nbsp;<span class="op" id="4473823">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473826">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473898">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4473968">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="4473986">=</span>&nbsp;<span class="num" id="4473988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4473991">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474062">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474101">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4474125">=</span>&nbsp;<span class="op" id="4474127">-</span><span class="num" id="4474128">1</span><br>
<span class="lineno"></span><span class="op" id="4474130">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4474133">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="4474207">type</span>&nbsp;<span class="ident" id="4474212">PSSOptions</span>&nbsp;<span class="keyword" id="4474223">struct</span>&nbsp;<span class="op" id="4474230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474233">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474296">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474369">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474398">SaltLength</span>&nbsp;<span class="builtintype" id="4474409">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474415">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474485">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4474554">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4474583">Hash</span>&nbsp;<span class="ident" id="4474588">crypto</span><span class="op" id="4474594">.</span><span class="ident" id="4474595">Hash</span><br>
<span class="lineno">230</span><span class="op" id="4474600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4474603">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="4474666">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="4474688">func</span>&nbsp;<span class="op" id="4474693">(</span><span class="ident" id="4474694">pssOpts</span>&nbsp;<span class="op" id="4474702">*</span><span class="ident" id="4474703">PSSOptions</span><span class="op" id="4474713">)</span>&nbsp;<span class="ident" id="4474715">HashFunc</span><span class="op" id="4474723">(</span><span class="op" id="4474724">)</span>&nbsp;<span class="ident" id="4474726">crypto</span><span class="op" id="4474732">.</span><span class="ident" id="4474733">Hash</span>&nbsp;<span class="op" id="4474738">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474741">return</span>&nbsp;<span class="ident" id="4474748">pssOpts</span><span class="op" id="4474755">.</span><span class="ident" id="4474756">Hash</span><br>
<span class="lineno"></span><span class="op" id="4474761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4474764">func</span>&nbsp;<span class="op" id="4474769">(</span><span class="ident" id="4474770">opts</span>&nbsp;<span class="op" id="4474775">*</span><span class="ident" id="4474776">PSSOptions</span><span class="op" id="4474786">)</span>&nbsp;<span class="ident" id="4474788">saltLength</span><span class="op" id="4474798">(</span><span class="op" id="4474799">)</span>&nbsp;<span class="builtintype" id="4474801">int</span>&nbsp;<span class="op" id="4474805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474808">if</span>&nbsp;<span class="ident" id="4474811">opts</span>&nbsp;<span class="op" id="4474816">==</span>&nbsp;<span class="builtintype" id="4474819">nil</span>&nbsp;<span class="op" id="4474823">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474827">return</span>&nbsp;<span class="ident" id="4474834">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4474853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4474856">return</span>&nbsp;<span class="ident" id="4474863">opts</span><span class="op" id="4474867">.</span><span class="ident" id="4474868">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="4474879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="4474882">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="4474950">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4475028">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4475105">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4475127">func</span>&nbsp;<span class="ident" id="4475132">SignPSS</span><span class="op" id="4475139">(</span><span class="ident" id="4475140">rand</span>&nbsp;<span class="ident" id="4475145">io</span><span class="op" id="4475147">.</span><span class="ident" id="4475148">Reader</span><span class="op" id="4475154">,</span>&nbsp;<span class="ident" id="4475156">priv</span>&nbsp;<span class="op" id="4475161">*</span><span class="ident" id="4475162">PrivateKey</span><span class="op" id="4475172">,</span>&nbsp;<span class="ident" id="4475174">hash</span>&nbsp;<span class="ident" id="4475179">crypto</span><span class="op" id="4475185">.</span><span class="ident" id="4475186">Hash</span><span class="op" id="4475190">,</span>&nbsp;<span class="ident" id="4475192">hashed</span>&nbsp;<span class="op" id="4475199">[</span><span class="op" id="4475200">]</span><span class="builtintype" id="4475201">byte</span><span class="op" id="4475205">,</span>&nbsp;<span class="ident" id="4475207">opts</span>&nbsp;<span class="op" id="4475212">*</span><span class="ident" id="4475213">PSSOptions</span><span class="op" id="4475223">)</span>&nbsp;<span class="op" id="4475225">(</span><span class="ident" id="4475226">s</span>&nbsp;<span class="op" id="4475228">[</span><span class="op" id="4475229">]</span><span class="builtintype" id="4475230">byte</span><span class="op" id="4475234">,</span>&nbsp;<span class="ident" id="4475236">err</span>&nbsp;<span class="builtintype" id="4475240">error</span><span class="op" id="4475245">)</span>&nbsp;<span class="op" id="4475247">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475250">saltLength</span>&nbsp;<span class="op" id="4475261">:=</span>&nbsp;<span class="ident" id="4475264">opts</span><span class="op" id="4475268">.</span><span class="ident" id="4475269">saltLength</span><span class="op" id="4475279">(</span><span class="op" id="4475280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475283">switch</span>&nbsp;<span class="ident" id="4475290">saltLength</span>&nbsp;<span class="op" id="4475301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475304">case</span>&nbsp;<span class="ident" id="4475309">PSSSaltLengthAuto</span><span class="op" id="4475326">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475330">saltLength</span>&nbsp;<span class="op" id="4475341">=</span>&nbsp;<span class="op" id="4475343">(</span><span class="ident" id="4475344">priv</span><span class="op" id="4475348">.</span><span class="ident" id="4475349">N</span><span class="op" id="4475350">.</span><span class="ident" id="4475351">BitLen</span><span class="op" id="4475357">(</span><span class="op" id="4475358">)</span><span class="op" id="4475359">+</span><span class="num" id="4475360">7</span><span class="op" id="4475361">)</span><span class="op" id="4475362">/</span><span class="num" id="4475363">8</span>&nbsp;<span class="op" id="4475365">-</span>&nbsp;<span class="num" id="4475367">2</span>&nbsp;<span class="op" id="4475369">-</span>&nbsp;<span class="ident" id="4475371">hash</span><span class="op" id="4475375">.</span><span class="ident" id="4475376">Size</span><span class="op" id="4475380">(</span><span class="op" id="4475381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475384">case</span>&nbsp;<span class="ident" id="4475389">PSSSaltLengthEqualsHash</span><span class="op" id="4475412">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475416">saltLength</span>&nbsp;<span class="op" id="4475427">=</span>&nbsp;<span class="ident" id="4475429">hash</span><span class="op" id="4475433">.</span><span class="ident" id="4475434">Size</span><span class="op" id="4475438">(</span><span class="op" id="4475439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475442">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475446">if</span>&nbsp;<span class="ident" id="4475449">opts</span><span class="op" id="4475453">.</span><span class="ident" id="4475454">Hash</span>&nbsp;<span class="op" id="4475459">!=</span>&nbsp;<span class="num" id="4475462">0</span>&nbsp;<span class="op" id="4475464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475468">hash</span>&nbsp;<span class="op" id="4475473">=</span>&nbsp;<span class="ident" id="4475475">opts</span><span class="op" id="4475479">.</span><span class="ident" id="4475480">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4475490">salt</span>&nbsp;<span class="op" id="4475495">:=</span>&nbsp;<span class="builtinfunc" id="4475498">make</span><span class="op" id="4475502">(</span><span class="op" id="4475503">[</span><span class="op" id="4475504">]</span><span class="builtintype" id="4475505">byte</span><span class="op" id="4475509">,</span>&nbsp;<span class="ident" id="4475511">saltLength</span><span class="op" id="4475521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475524">if</span>&nbsp;<span class="ident" id="4475527">_</span><span class="op" id="4475528">,</span>&nbsp;<span class="ident" id="4475530">err</span>&nbsp;<span class="op" id="4475534">=</span>&nbsp;<span class="ident" id="4475536">io</span><span class="op" id="4475538">.</span><span class="ident" id="4475539">ReadFull</span><span class="op" id="4475547">(</span><span class="ident" id="4475548">rand</span><span class="op" id="4475552">,</span>&nbsp;<span class="ident" id="4475554">salt</span><span class="op" id="4475558">)</span><span class="op" id="4475559">;</span>&nbsp;<span class="ident" id="4475561">err</span>&nbsp;<span class="op" id="4475565">!=</span>&nbsp;<span class="builtintype" id="4475568">nil</span>&nbsp;<span class="op" id="4475572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475576">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4475584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4475587">return</span>&nbsp;<span class="ident" id="4475594">signPSSWithSalt</span><span class="op" id="4475609">(</span><span class="ident" id="4475610">rand</span><span class="op" id="4475614">,</span>&nbsp;<span class="ident" id="4475616">priv</span><span class="op" id="4475620">,</span>&nbsp;<span class="ident" id="4475622">hash</span><span class="op" id="4475626">,</span>&nbsp;<span class="ident" id="4475628">hashed</span><span class="op" id="4475634">,</span>&nbsp;<span class="ident" id="4475636">salt</span><span class="op" id="4475640">)</span><br>
<span class="lineno"></span><span class="op" id="4475642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4475645">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="4475684">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4475758">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4475830">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="4475909">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4475931">func</span>&nbsp;<span class="ident" id="4475936">VerifyPSS</span><span class="op" id="4475945">(</span><span class="ident" id="4475946">pub</span>&nbsp;<span class="op" id="4475950">*</span><span class="ident" id="4475951">PublicKey</span><span class="op" id="4475960">,</span>&nbsp;<span class="ident" id="4475962">hash</span>&nbsp;<span class="ident" id="4475967">crypto</span><span class="op" id="4475973">.</span><span class="ident" id="4475974">Hash</span><span class="op" id="4475978">,</span>&nbsp;<span class="ident" id="4475980">hashed</span>&nbsp;<span class="op" id="4475987">[</span><span class="op" id="4475988">]</span><span class="builtintype" id="4475989">byte</span><span class="op" id="4475993">,</span>&nbsp;<span class="ident" id="4475995">sig</span>&nbsp;<span class="op" id="4475999">[</span><span class="op" id="4476000">]</span><span class="builtintype" id="4476001">byte</span><span class="op" id="4476005">,</span>&nbsp;<span class="ident" id="4476007">opts</span>&nbsp;<span class="op" id="4476012">*</span><span class="ident" id="4476013">PSSOptions</span><span class="op" id="4476023">)</span>&nbsp;<span class="builtintype" id="4476025">error</span>&nbsp;<span class="op" id="4476031">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476034">return</span>&nbsp;<span class="ident" id="4476041">verifyPSS</span><span class="op" id="4476050">(</span><span class="ident" id="4476051">pub</span><span class="op" id="4476054">,</span>&nbsp;<span class="ident" id="4476056">hash</span><span class="op" id="4476060">,</span>&nbsp;<span class="ident" id="4476062">hashed</span><span class="op" id="4476068">,</span>&nbsp;<span class="ident" id="4476070">sig</span><span class="op" id="4476073">,</span>&nbsp;<span class="ident" id="4476075">opts</span><span class="op" id="4476079">.</span><span class="ident" id="4476080">saltLength</span><span class="op" id="4476090">(</span><span class="op" id="4476091">)</span><span class="op" id="4476092">)</span><br>
<span class="lineno"></span><span class="op" id="4476094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4476097">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="4476163">func</span>&nbsp;<span class="ident" id="4476168">verifyPSS</span><span class="op" id="4476177">(</span><span class="ident" id="4476178">pub</span>&nbsp;<span class="op" id="4476182">*</span><span class="ident" id="4476183">PublicKey</span><span class="op" id="4476192">,</span>&nbsp;<span class="ident" id="4476194">hash</span>&nbsp;<span class="ident" id="4476199">crypto</span><span class="op" id="4476205">.</span><span class="ident" id="4476206">Hash</span><span class="op" id="4476210">,</span>&nbsp;<span class="ident" id="4476212">hashed</span>&nbsp;<span class="op" id="4476219">[</span><span class="op" id="4476220">]</span><span class="builtintype" id="4476221">byte</span><span class="op" id="4476225">,</span>&nbsp;<span class="ident" id="4476227">sig</span>&nbsp;<span class="op" id="4476231">[</span><span class="op" id="4476232">]</span><span class="builtintype" id="4476233">byte</span><span class="op" id="4476237">,</span>&nbsp;<span class="ident" id="4476239">saltLen</span>&nbsp;<span class="builtintype" id="4476247">int</span><span class="op" id="4476250">)</span>&nbsp;<span class="builtintype" id="4476252">error</span>&nbsp;<span class="op" id="4476258">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476261">nBits</span>&nbsp;<span class="op" id="4476267">:=</span>&nbsp;<span class="ident" id="4476270">pub</span><span class="op" id="4476273">.</span><span class="ident" id="4476274">N</span><span class="op" id="4476275">.</span><span class="ident" id="4476276">BitLen</span><span class="op" id="4476282">(</span><span class="op" id="4476283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476286">if</span>&nbsp;<span class="builtinfunc" id="4476289">len</span><span class="op" id="4476292">(</span><span class="ident" id="4476293">sig</span><span class="op" id="4476296">)</span>&nbsp;<span class="op" id="4476298">!=</span>&nbsp;<span class="op" id="4476301">(</span><span class="ident" id="4476302">nBits</span><span class="op" id="4476307">+</span><span class="num" id="4476308">7</span><span class="op" id="4476309">)</span><span class="op" id="4476310">/</span><span class="num" id="4476311">8</span>&nbsp;<span class="op" id="4476313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476317">return</span>&nbsp;<span class="ident" id="4476324">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476341">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476344">s</span>&nbsp;<span class="op" id="4476346">:=</span>&nbsp;<span class="builtinfunc" id="4476349">new</span><span class="op" id="4476352">(</span><span class="ident" id="4476353">big</span><span class="op" id="4476356">.</span><span class="ident" id="4476357">Int</span><span class="op" id="4476360">)</span><span class="op" id="4476361">.</span><span class="ident" id="4476362">SetBytes</span><span class="op" id="4476370">(</span><span class="ident" id="4476371">sig</span><span class="op" id="4476374">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476377">m</span>&nbsp;<span class="op" id="4476379">:=</span>&nbsp;<span class="ident" id="4476382">encrypt</span><span class="op" id="4476389">(</span><span class="builtinfunc" id="4476390">new</span><span class="op" id="4476393">(</span><span class="ident" id="4476394">big</span><span class="op" id="4476397">.</span><span class="ident" id="4476398">Int</span><span class="op" id="4476401">)</span><span class="op" id="4476402">,</span>&nbsp;<span class="ident" id="4476404">pub</span><span class="op" id="4476407">,</span>&nbsp;<span class="ident" id="4476409">s</span><span class="op" id="4476410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476413">emBits</span>&nbsp;<span class="op" id="4476420">:=</span>&nbsp;<span class="ident" id="4476423">nBits</span>&nbsp;<span class="op" id="4476429">-</span>&nbsp;<span class="num" id="4476431">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476434">emLen</span>&nbsp;<span class="op" id="4476440">:=</span>&nbsp;<span class="op" id="4476443">(</span><span class="ident" id="4476444">emBits</span>&nbsp;<span class="op" id="4476451">+</span>&nbsp;<span class="num" id="4476453">7</span><span class="op" id="4476454">)</span>&nbsp;<span class="op" id="4476456">/</span>&nbsp;<span class="num" id="4476458">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476461">if</span>&nbsp;<span class="ident" id="4476464">emLen</span>&nbsp;<span class="op" id="4476470">&lt;</span>&nbsp;<span class="builtinfunc" id="4476472">len</span><span class="op" id="4476475">(</span><span class="ident" id="4476476">m</span><span class="op" id="4476477">.</span><span class="ident" id="4476478">Bytes</span><span class="op" id="4476483">(</span><span class="op" id="4476484">)</span><span class="op" id="4476485">)</span>&nbsp;<span class="op" id="4476487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476491">return</span>&nbsp;<span class="ident" id="4476498">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476518">em</span>&nbsp;<span class="op" id="4476521">:=</span>&nbsp;<span class="builtinfunc" id="4476524">make</span><span class="op" id="4476528">(</span><span class="op" id="4476529">[</span><span class="op" id="4476530">]</span><span class="builtintype" id="4476531">byte</span><span class="op" id="4476535">,</span>&nbsp;<span class="ident" id="4476537">emLen</span><span class="op" id="4476542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476545">copyWithLeftPad</span><span class="op" id="4476560">(</span><span class="ident" id="4476561">em</span><span class="op" id="4476563">,</span>&nbsp;<span class="ident" id="4476565">m</span><span class="op" id="4476566">.</span><span class="ident" id="4476567">Bytes</span><span class="op" id="4476572">(</span><span class="op" id="4476573">)</span><span class="op" id="4476574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476577">if</span>&nbsp;<span class="ident" id="4476580">saltLen</span>&nbsp;<span class="op" id="4476588">==</span>&nbsp;<span class="ident" id="4476591">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="4476615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4476619">saltLen</span>&nbsp;<span class="op" id="4476627">=</span>&nbsp;<span class="ident" id="4476629">hash</span><span class="op" id="4476633">.</span><span class="ident" id="4476634">Size</span><span class="op" id="4476638">(</span><span class="op" id="4476639">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4476642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4476645">return</span>&nbsp;<span class="ident" id="4476652">emsaPSSVerify</span><span class="op" id="4476665">(</span><span class="ident" id="4476666">hashed</span><span class="op" id="4476672">,</span>&nbsp;<span class="ident" id="4476674">em</span><span class="op" id="4476676">,</span>&nbsp;<span class="ident" id="4476678">emBits</span><span class="op" id="4476684">,</span>&nbsp;<span class="ident" id="4476686">saltLen</span><span class="op" id="4476693">,</span>&nbsp;<span class="ident" id="4476695">hash</span><span class="op" id="4476699">.</span><span class="ident" id="4476700">New</span><span class="op" id="4476703">(</span><span class="op" id="4476704">)</span><span class="op" id="4476705">)</span><br>
<span class="lineno"></span><span class="op" id="4476707">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
