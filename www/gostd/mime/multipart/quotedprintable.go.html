<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4957772">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4957827">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4957881">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4957932">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="4958005">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="4958020">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="4958092">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="4958166">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4958215">package</span>&nbsp;<span class="ident" id="4958223">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958234">import</span>&nbsp;<span class="op" id="4958241">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958244">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958253">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958262">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4958269">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4958274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4958277">type</span>&nbsp;<span class="ident" id="4958282">qpReader</span>&nbsp;<span class="keyword" id="4958291">struct</span>&nbsp;<span class="op" id="4958298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958301">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4958306">*</span><span class="ident" id="4958307">bufio</span><span class="op" id="4958312">.</span><span class="ident" id="4958313">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958321">rerr</span>&nbsp;<span class="builtintype" id="4958326">error</span>&nbsp;&nbsp;<span class="comment" id="4958333">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958353">line</span>&nbsp;<span class="op" id="4958358">[</span><span class="op" id="4958359">]</span><span class="builtintype" id="4958360">byte</span>&nbsp;<span class="comment" id="4958365">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="4958401">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4958404">func</span>&nbsp;<span class="ident" id="4958409">newQuotedPrintableReader</span><span class="op" id="4958433">(</span><span class="ident" id="4958434">r</span>&nbsp;<span class="ident" id="4958436">io</span><span class="op" id="4958438">.</span><span class="ident" id="4958439">Reader</span><span class="op" id="4958445">)</span>&nbsp;<span class="ident" id="4958447">io</span><span class="op" id="4958449">.</span><span class="ident" id="4958450">Reader</span>&nbsp;<span class="op" id="4958457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958460">return</span>&nbsp;<span class="op" id="4958467">&amp;</span><span class="ident" id="4958468">qpReader</span><span class="op" id="4958476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4958480">br</span><span class="op" id="4958482">:</span>&nbsp;<span class="ident" id="4958484">bufio</span><span class="op" id="4958489">.</span><span class="ident" id="4958490">NewReader</span><span class="op" id="4958499">(</span><span class="ident" id="4958500">r</span><span class="op" id="4958501">)</span><span class="op" id="4958502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958505">}</span><br>
<span class="lineno">30</span><span class="op" id="4958507">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958510">func</span>&nbsp;<span class="ident" id="4958515">fromHex</span><span class="op" id="4958522">(</span><span class="ident" id="4958523">b</span>&nbsp;<span class="builtintype" id="4958525">byte</span><span class="op" id="4958529">)</span>&nbsp;<span class="op" id="4958531">(</span><span class="builtintype" id="4958532">byte</span><span class="op" id="4958536">,</span>&nbsp;<span class="builtintype" id="4958538">error</span><span class="op" id="4958543">)</span>&nbsp;<span class="op" id="4958545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958548">switch</span>&nbsp;<span class="op" id="4958555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958558">case</span>&nbsp;<span class="ident" id="4958563">b</span>&nbsp;<span class="op" id="4958565">&gt;=</span>&nbsp;<span class="string" id="4958568">&#39;0&#39;</span>&nbsp;<span class="op" id="4958572">&amp;&amp;</span>&nbsp;<span class="ident" id="4958575">b</span>&nbsp;<span class="op" id="4958577">&lt;=</span>&nbsp;<span class="string" id="4958580">&#39;9&#39;</span><span class="op" id="4958583">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958587">return</span>&nbsp;<span class="ident" id="4958594">b</span>&nbsp;<span class="op" id="4958596">-</span>&nbsp;<span class="string" id="4958598">&#39;0&#39;</span><span class="op" id="4958601">,</span>&nbsp;<span class="ident" id="4958603">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958608">case</span>&nbsp;<span class="ident" id="4958613">b</span>&nbsp;<span class="op" id="4958615">&gt;=</span>&nbsp;<span class="string" id="4958618">&#39;A&#39;</span>&nbsp;<span class="op" id="4958622">&amp;&amp;</span>&nbsp;<span class="ident" id="4958625">b</span>&nbsp;<span class="op" id="4958627">&lt;=</span>&nbsp;<span class="string" id="4958630">&#39;F&#39;</span><span class="op" id="4958633">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958637">return</span>&nbsp;<span class="ident" id="4958644">b</span>&nbsp;<span class="op" id="4958646">-</span>&nbsp;<span class="string" id="4958648">&#39;A&#39;</span>&nbsp;<span class="op" id="4958652">+</span>&nbsp;<span class="num" id="4958654">10</span><span class="op" id="4958656">,</span>&nbsp;<span class="ident" id="4958658">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958666">return</span>&nbsp;<span class="num" id="4958673">0</span><span class="op" id="4958674">,</span>&nbsp;<span class="ident" id="4958676">fmt</span><span class="op" id="4958679">.</span><span class="ident" id="4958680">Errorf</span><span class="op" id="4958686">(</span><span class="string" id="4958687">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="4958740">,</span>&nbsp;<span class="ident" id="4958742">b</span><span class="op" id="4958743">)</span><br>
<span class="lineno">40</span><span class="op" id="4958745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4958748">func</span>&nbsp;<span class="op" id="4958753">(</span><span class="ident" id="4958754">q</span>&nbsp;<span class="op" id="4958756">*</span><span class="ident" id="4958757">qpReader</span><span class="op" id="4958765">)</span>&nbsp;<span class="ident" id="4958767">readHexByte</span><span class="op" id="4958778">(</span><span class="ident" id="4958779">v</span>&nbsp;<span class="op" id="4958781">[</span><span class="op" id="4958782">]</span><span class="builtintype" id="4958783">byte</span><span class="op" id="4958787">)</span>&nbsp;<span class="op" id="4958789">(</span><span class="ident" id="4958790">b</span>&nbsp;<span class="builtintype" id="4958792">byte</span><span class="op" id="4958796">,</span>&nbsp;<span class="ident" id="4958798">err</span>&nbsp;<span class="builtintype" id="4958802">error</span><span class="op" id="4958807">)</span>&nbsp;<span class="op" id="4958809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958812">if</span>&nbsp;<span class="builtinfunc" id="4958815">len</span><span class="op" id="4958818">(</span><span class="ident" id="4958819">v</span><span class="op" id="4958820">)</span>&nbsp;<span class="op" id="4958822">&lt;</span>&nbsp;<span class="num" id="4958824">2</span>&nbsp;<span class="op" id="4958826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958830">return</span>&nbsp;<span class="num" id="4958837">0</span><span class="op" id="4958838">,</span>&nbsp;<span class="ident" id="4958840">io</span><span class="op" id="4958842">.</span><span class="ident" id="4958843">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958864">var</span>&nbsp;<span class="ident" id="4958868">hb</span><span class="op" id="4958870">,</span>&nbsp;<span class="ident" id="4958872">lb</span>&nbsp;<span class="builtintype" id="4958875">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958881">if</span>&nbsp;<span class="ident" id="4958884">hb</span><span class="op" id="4958886">,</span>&nbsp;<span class="ident" id="4958888">err</span>&nbsp;<span class="op" id="4958892">=</span>&nbsp;<span class="ident" id="4958894">fromHex</span><span class="op" id="4958901">(</span><span class="ident" id="4958902">v</span><span class="op" id="4958903">[</span><span class="num" id="4958904">0</span><span class="op" id="4958905">]</span><span class="op" id="4958906">)</span><span class="op" id="4958907">;</span>&nbsp;<span class="ident" id="4958909">err</span>&nbsp;<span class="op" id="4958913">!=</span>&nbsp;<span class="ident" id="4958916">nil</span>&nbsp;<span class="op" id="4958920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958924">return</span>&nbsp;<span class="num" id="4958931">0</span><span class="op" id="4958932">,</span>&nbsp;<span class="ident" id="4958934">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4958939">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958942">if</span>&nbsp;<span class="ident" id="4958945">lb</span><span class="op" id="4958947">,</span>&nbsp;<span class="ident" id="4958949">err</span>&nbsp;<span class="op" id="4958953">=</span>&nbsp;<span class="ident" id="4958955">fromHex</span><span class="op" id="4958962">(</span><span class="ident" id="4958963">v</span><span class="op" id="4958964">[</span><span class="num" id="4958965">1</span><span class="op" id="4958966">]</span><span class="op" id="4958967">)</span><span class="op" id="4958968">;</span>&nbsp;<span class="ident" id="4958970">err</span>&nbsp;<span class="op" id="4958974">!=</span>&nbsp;<span class="ident" id="4958977">nil</span>&nbsp;<span class="op" id="4958981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4958985">return</span>&nbsp;<span class="num" id="4958992">0</span><span class="op" id="4958993">,</span>&nbsp;<span class="ident" id="4958995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959003">return</span>&nbsp;<span class="ident" id="4959010">hb</span><span class="op" id="4959012">&lt;&lt;</span><span class="num" id="4959014">4</span>&nbsp;<span class="op" id="4959016">|</span>&nbsp;<span class="ident" id="4959018">lb</span><span class="op" id="4959020">,</span>&nbsp;<span class="ident" id="4959022">nil</span><br>
<span class="lineno"></span><span class="op" id="4959026">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="4959029">func</span>&nbsp;<span class="ident" id="4959034">isQPDiscardWhitespace</span><span class="op" id="4959055">(</span><span class="ident" id="4959056">r</span>&nbsp;<span class="builtintype" id="4959058">rune</span><span class="op" id="4959062">)</span>&nbsp;<span class="builtintype" id="4959064">bool</span>&nbsp;<span class="op" id="4959069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959072">switch</span>&nbsp;<span class="ident" id="4959079">r</span>&nbsp;<span class="op" id="4959081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959084">case</span>&nbsp;<span class="string" id="4959089">&#39;\n&#39;</span><span class="op" id="4959093">,</span>&nbsp;<span class="string" id="4959095">&#39;\r&#39;</span><span class="op" id="4959099">,</span>&nbsp;<span class="string" id="4959101">&#39;&nbsp;&#39;</span><span class="op" id="4959104">,</span>&nbsp;<span class="string" id="4959106">&#39;\t&#39;</span><span class="op" id="4959110">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959114">return</span>&nbsp;<span class="builtintype" id="4959121">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959130">return</span>&nbsp;<span class="builtintype" id="4959137">false</span><br>
<span class="lineno"></span><span class="op" id="4959143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4959146">var</span>&nbsp;<span class="op" id="4959150">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959153">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959164">=</span>&nbsp;<span class="op" id="4959166">[</span><span class="op" id="4959167">]</span><span class="builtintype" id="4959168">byte</span><span class="op" id="4959172">(</span><span class="string" id="4959173">&#34;\r\n&#34;</span><span class="op" id="4959179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959182">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4959193">=</span>&nbsp;<span class="op" id="4959195">[</span><span class="op" id="4959196">]</span><span class="builtintype" id="4959197">byte</span><span class="op" id="4959201">(</span><span class="string" id="4959202">&#34;\n&#34;</span><span class="op" id="4959206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959209">softSuffix</span>&nbsp;<span class="op" id="4959220">=</span>&nbsp;<span class="op" id="4959222">[</span><span class="op" id="4959223">]</span><span class="builtintype" id="4959224">byte</span><span class="op" id="4959228">(</span><span class="string" id="4959229">&#34;=&#34;</span><span class="op" id="4959232">)</span><br>
<span class="lineno"></span><span class="op" id="4959234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4959237">func</span>&nbsp;<span class="op" id="4959242">(</span><span class="ident" id="4959243">q</span>&nbsp;<span class="op" id="4959245">*</span><span class="ident" id="4959246">qpReader</span><span class="op" id="4959254">)</span>&nbsp;<span class="ident" id="4959256">Read</span><span class="op" id="4959260">(</span><span class="ident" id="4959261">p</span>&nbsp;<span class="op" id="4959263">[</span><span class="op" id="4959264">]</span><span class="builtintype" id="4959265">byte</span><span class="op" id="4959269">)</span>&nbsp;<span class="op" id="4959271">(</span><span class="ident" id="4959272">n</span>&nbsp;<span class="builtintype" id="4959274">int</span><span class="op" id="4959277">,</span>&nbsp;<span class="ident" id="4959279">err</span>&nbsp;<span class="builtintype" id="4959283">error</span><span class="op" id="4959288">)</span>&nbsp;<span class="op" id="4959290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959293">for</span>&nbsp;<span class="builtinfunc" id="4959297">len</span><span class="op" id="4959300">(</span><span class="ident" id="4959301">p</span><span class="op" id="4959302">)</span>&nbsp;<span class="op" id="4959304">&gt;</span>&nbsp;<span class="num" id="4959306">0</span>&nbsp;<span class="op" id="4959308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959312">if</span>&nbsp;<span class="builtinfunc" id="4959315">len</span><span class="op" id="4959318">(</span><span class="ident" id="4959319">q</span><span class="op" id="4959320">.</span><span class="ident" id="4959321">line</span><span class="op" id="4959325">)</span>&nbsp;<span class="op" id="4959327">==</span>&nbsp;<span class="num" id="4959330">0</span>&nbsp;<span class="op" id="4959332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959337">if</span>&nbsp;<span class="ident" id="4959340">q</span><span class="op" id="4959341">.</span><span class="ident" id="4959342">rerr</span>&nbsp;<span class="op" id="4959347">!=</span>&nbsp;<span class="ident" id="4959350">nil</span>&nbsp;<span class="op" id="4959354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959360">return</span>&nbsp;<span class="ident" id="4959367">n</span><span class="op" id="4959368">,</span>&nbsp;<span class="ident" id="4959370">q</span><span class="op" id="4959371">.</span><span class="ident" id="4959372">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959385">q</span><span class="op" id="4959386">.</span><span class="ident" id="4959387">line</span><span class="op" id="4959391">,</span>&nbsp;<span class="ident" id="4959393">q</span><span class="op" id="4959394">.</span><span class="ident" id="4959395">rerr</span>&nbsp;<span class="op" id="4959400">=</span>&nbsp;<span class="ident" id="4959402">q</span><span class="op" id="4959403">.</span><span class="ident" id="4959404">br</span><span class="op" id="4959406">.</span><span class="ident" id="4959407">ReadSlice</span><span class="op" id="4959416">(</span><span class="string" id="4959417">&#39;\n&#39;</span><span class="op" id="4959421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4959427">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959479">hasLF</span>&nbsp;<span class="op" id="4959485">:=</span>&nbsp;<span class="ident" id="4959488">bytes</span><span class="op" id="4959493">.</span><span class="ident" id="4959494">HasSuffix</span><span class="op" id="4959503">(</span><span class="ident" id="4959504">q</span><span class="op" id="4959505">.</span><span class="ident" id="4959506">line</span><span class="op" id="4959510">,</span>&nbsp;<span class="ident" id="4959512">lf</span><span class="op" id="4959514">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959519">hasCR</span>&nbsp;<span class="op" id="4959525">:=</span>&nbsp;<span class="ident" id="4959528">bytes</span><span class="op" id="4959533">.</span><span class="ident" id="4959534">HasSuffix</span><span class="op" id="4959543">(</span><span class="ident" id="4959544">q</span><span class="op" id="4959545">.</span><span class="ident" id="4959546">line</span><span class="op" id="4959550">,</span>&nbsp;<span class="ident" id="4959552">crlf</span><span class="op" id="4959556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959561">wholeLine</span>&nbsp;<span class="op" id="4959571">:=</span>&nbsp;<span class="ident" id="4959574">q</span><span class="op" id="4959575">.</span><span class="ident" id="4959576">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959584">q</span><span class="op" id="4959585">.</span><span class="ident" id="4959586">line</span>&nbsp;<span class="op" id="4959591">=</span>&nbsp;<span class="ident" id="4959593">bytes</span><span class="op" id="4959598">.</span><span class="ident" id="4959599">TrimRightFunc</span><span class="op" id="4959612">(</span><span class="ident" id="4959613">wholeLine</span><span class="op" id="4959622">,</span>&nbsp;<span class="ident" id="4959624">isQPDiscardWhitespace</span><span class="op" id="4959645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959650">if</span>&nbsp;<span class="ident" id="4959653">bytes</span><span class="op" id="4959658">.</span><span class="ident" id="4959659">HasSuffix</span><span class="op" id="4959668">(</span><span class="ident" id="4959669">q</span><span class="op" id="4959670">.</span><span class="ident" id="4959671">line</span><span class="op" id="4959675">,</span>&nbsp;<span class="ident" id="4959677">softSuffix</span><span class="op" id="4959687">)</span>&nbsp;<span class="op" id="4959689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959695">rightStripped</span>&nbsp;<span class="op" id="4959709">:=</span>&nbsp;<span class="ident" id="4959712">wholeLine</span><span class="op" id="4959721">[</span><span class="builtinfunc" id="4959722">len</span><span class="op" id="4959725">(</span><span class="ident" id="4959726">q</span><span class="op" id="4959727">.</span><span class="ident" id="4959728">line</span><span class="op" id="4959732">)</span><span class="op" id="4959733">:</span><span class="op" id="4959734">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959740">q</span><span class="op" id="4959741">.</span><span class="ident" id="4959742">line</span>&nbsp;<span class="op" id="4959747">=</span>&nbsp;<span class="ident" id="4959749">q</span><span class="op" id="4959750">.</span><span class="ident" id="4959751">line</span><span class="op" id="4959755">[</span><span class="op" id="4959756">:</span><span class="builtinfunc" id="4959757">len</span><span class="op" id="4959760">(</span><span class="ident" id="4959761">q</span><span class="op" id="4959762">.</span><span class="ident" id="4959763">line</span><span class="op" id="4959767">)</span><span class="op" id="4959768">-</span><span class="num" id="4959769">1</span><span class="op" id="4959770">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959776">if</span>&nbsp;<span class="op" id="4959779">!</span><span class="ident" id="4959780">bytes</span><span class="op" id="4959785">.</span><span class="ident" id="4959786">HasPrefix</span><span class="op" id="4959795">(</span><span class="ident" id="4959796">rightStripped</span><span class="op" id="4959809">,</span>&nbsp;<span class="ident" id="4959811">lf</span><span class="op" id="4959813">)</span>&nbsp;<span class="op" id="4959815">&amp;&amp;</span>&nbsp;<span class="op" id="4959818">!</span><span class="ident" id="4959819">bytes</span><span class="op" id="4959824">.</span><span class="ident" id="4959825">HasPrefix</span><span class="op" id="4959834">(</span><span class="ident" id="4959835">rightStripped</span><span class="op" id="4959848">,</span>&nbsp;<span class="ident" id="4959850">crlf</span><span class="op" id="4959854">)</span>&nbsp;<span class="op" id="4959856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959863">q</span><span class="op" id="4959864">.</span><span class="ident" id="4959865">rerr</span>&nbsp;<span class="op" id="4959870">=</span>&nbsp;<span class="ident" id="4959872">fmt</span><span class="op" id="4959875">.</span><span class="ident" id="4959876">Errorf</span><span class="op" id="4959882">(</span><span class="string" id="4959883">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="4959921">,</span>&nbsp;<span class="ident" id="4959923">rightStripped</span><span class="op" id="4959936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4959947">}</span>&nbsp;<span class="keyword" id="4959949">else</span>&nbsp;<span class="keyword" id="4959954">if</span>&nbsp;<span class="ident" id="4959957">hasLF</span>&nbsp;<span class="op" id="4959963">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4959969">if</span>&nbsp;<span class="ident" id="4959972">hasCR</span>&nbsp;<span class="op" id="4959978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4959985">q</span><span class="op" id="4959986">.</span><span class="ident" id="4959987">line</span>&nbsp;<span class="op" id="4959992">=</span>&nbsp;<span class="builtinfunc" id="4959994">append</span><span class="op" id="4960000">(</span><span class="ident" id="4960001">q</span><span class="op" id="4960002">.</span><span class="ident" id="4960003">line</span><span class="op" id="4960007">,</span>&nbsp;<span class="string" id="4960009">&#39;\r&#39;</span><span class="op" id="4960013">,</span>&nbsp;<span class="string" id="4960015">&#39;\n&#39;</span><span class="op" id="4960019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960025">}</span>&nbsp;<span class="keyword" id="4960027">else</span>&nbsp;<span class="op" id="4960032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960039">q</span><span class="op" id="4960040">.</span><span class="ident" id="4960041">line</span>&nbsp;<span class="op" id="4960046">=</span>&nbsp;<span class="builtinfunc" id="4960048">append</span><span class="op" id="4960054">(</span><span class="ident" id="4960055">q</span><span class="op" id="4960056">.</span><span class="ident" id="4960057">line</span><span class="op" id="4960061">,</span>&nbsp;<span class="string" id="4960063">&#39;\n&#39;</span><span class="op" id="4960067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960073">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960083">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960094">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960098">b</span>&nbsp;<span class="op" id="4960100">:=</span>&nbsp;<span class="ident" id="4960103">q</span><span class="op" id="4960104">.</span><span class="ident" id="4960105">line</span><span class="op" id="4960109">[</span><span class="num" id="4960110">0</span><span class="op" id="4960111">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960116">switch</span>&nbsp;<span class="op" id="4960123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960127">case</span>&nbsp;<span class="ident" id="4960132">b</span>&nbsp;<span class="op" id="4960134">==</span>&nbsp;<span class="string" id="4960137">&#39;=&#39;</span><span class="op" id="4960140">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960145">b</span><span class="op" id="4960146">,</span>&nbsp;<span class="ident" id="4960148">err</span>&nbsp;<span class="op" id="4960152">=</span>&nbsp;<span class="ident" id="4960154">q</span><span class="op" id="4960155">.</span><span class="ident" id="4960156">readHexByte</span><span class="op" id="4960167">(</span><span class="ident" id="4960168">q</span><span class="op" id="4960169">.</span><span class="ident" id="4960170">line</span><span class="op" id="4960174">[</span><span class="num" id="4960175">1</span><span class="op" id="4960176">:</span><span class="op" id="4960177">]</span><span class="op" id="4960178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960183">if</span>&nbsp;<span class="ident" id="4960186">err</span>&nbsp;<span class="op" id="4960190">!=</span>&nbsp;<span class="ident" id="4960193">nil</span>&nbsp;<span class="op" id="4960197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960203">return</span>&nbsp;<span class="ident" id="4960210">n</span><span class="op" id="4960211">,</span>&nbsp;<span class="ident" id="4960213">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960225">q</span><span class="op" id="4960226">.</span><span class="ident" id="4960227">line</span>&nbsp;<span class="op" id="4960232">=</span>&nbsp;<span class="ident" id="4960234">q</span><span class="op" id="4960235">.</span><span class="ident" id="4960236">line</span><span class="op" id="4960240">[</span><span class="num" id="4960241">2</span><span class="op" id="4960242">:</span><span class="op" id="4960243">]</span>&nbsp;<span class="comment" id="4960245">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960284">case</span>&nbsp;<span class="ident" id="4960289">b</span>&nbsp;<span class="op" id="4960291">==</span>&nbsp;<span class="string" id="4960294">&#39;\t&#39;</span>&nbsp;<span class="op" id="4960299">||</span>&nbsp;<span class="ident" id="4960302">b</span>&nbsp;<span class="op" id="4960304">==</span>&nbsp;<span class="string" id="4960307">&#39;\r&#39;</span>&nbsp;<span class="op" id="4960312">||</span>&nbsp;<span class="ident" id="4960315">b</span>&nbsp;<span class="op" id="4960317">==</span>&nbsp;<span class="string" id="4960320">&#39;\n&#39;</span><span class="op" id="4960324">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960329">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960337">case</span>&nbsp;<span class="ident" id="4960342">b</span>&nbsp;<span class="op" id="4960344">&lt;</span>&nbsp;<span class="string" id="4960346">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4960350">||</span>&nbsp;<span class="ident" id="4960353">b</span>&nbsp;<span class="op" id="4960355">&gt;</span>&nbsp;<span class="string" id="4960357">&#39;~&#39;</span><span class="op" id="4960360">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960365">return</span>&nbsp;<span class="ident" id="4960372">n</span><span class="op" id="4960373">,</span>&nbsp;<span class="ident" id="4960375">fmt</span><span class="op" id="4960378">.</span><span class="ident" id="4960379">Errorf</span><span class="op" id="4960385">(</span><span class="string" id="4960386">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="4960453">,</span>&nbsp;<span class="ident" id="4960455">b</span><span class="op" id="4960456">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960464">p</span><span class="op" id="4960465">[</span><span class="num" id="4960466">0</span><span class="op" id="4960467">]</span>&nbsp;<span class="op" id="4960469">=</span>&nbsp;<span class="ident" id="4960471">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960475">p</span>&nbsp;<span class="op" id="4960477">=</span>&nbsp;<span class="ident" id="4960479">p</span><span class="op" id="4960480">[</span><span class="num" id="4960481">1</span><span class="op" id="4960482">:</span><span class="op" id="4960483">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960487">q</span><span class="op" id="4960488">.</span><span class="ident" id="4960489">line</span>&nbsp;<span class="op" id="4960494">=</span>&nbsp;<span class="ident" id="4960496">q</span><span class="op" id="4960497">.</span><span class="ident" id="4960498">line</span><span class="op" id="4960502">[</span><span class="num" id="4960503">1</span><span class="op" id="4960504">:</span><span class="op" id="4960505">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4960509">n</span><span class="op" id="4960510">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4960514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4960517">return</span>&nbsp;<span class="ident" id="4960524">n</span><span class="op" id="4960525">,</span>&nbsp;<span class="ident" id="4960527">nil</span><br>
<span class="lineno"></span><span class="op" id="4960531">}</span>
</div>
</body>
</html>
