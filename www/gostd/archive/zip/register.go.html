<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6057870">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6057925">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6057979">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6058030">package</span>&nbsp;<span class="ident" id="6058038">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6058043">import</span>&nbsp;<span class="op" id="6058050">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6058053">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6058071">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6058081">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6058087">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6058100">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6058107">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="6058110">//&nbsp;A&nbsp;Compressor&nbsp;returns&nbsp;a&nbsp;compressing&nbsp;writer,&nbsp;writing&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6058171">//&nbsp;provided&nbsp;writer.&nbsp;On&nbsp;Close,&nbsp;any&nbsp;pending&nbsp;data&nbsp;should&nbsp;be&nbsp;flushed.</span><br>
<span class="lineno"></span><span class="keyword" id="6058237">type</span>&nbsp;<span class="ident" id="6058242">Compressor</span>&nbsp;<span class="keyword" id="6058253">func</span><span class="op" id="6058257">(</span><span class="ident" id="6058258">io</span><span class="op" id="6058260">.</span><span class="ident" id="6058261">Writer</span><span class="op" id="6058267">)</span>&nbsp;<span class="op" id="6058269">(</span><span class="ident" id="6058270">io</span><span class="op" id="6058272">.</span><span class="ident" id="6058273">WriteCloser</span><span class="op" id="6058284">,</span>&nbsp;<span class="builtintype" id="6058286">error</span><span class="op" id="6058291">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6058294">//&nbsp;Decompressor&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;wraps&nbsp;a&nbsp;Reader&nbsp;with&nbsp;a&nbsp;decompressing&nbsp;Reader.</span><br>
<span class="lineno">20</span><span class="comment" id="6058373">//&nbsp;The&nbsp;decompressed&nbsp;ReadCloser&nbsp;is&nbsp;returned&nbsp;to&nbsp;callers&nbsp;who&nbsp;open&nbsp;files&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6058447">//&nbsp;within&nbsp;the&nbsp;archive.&nbsp;&nbsp;These&nbsp;callers&nbsp;are&nbsp;responsible&nbsp;for&nbsp;closing&nbsp;this&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="6058525">//&nbsp;when&nbsp;they&#39;re&nbsp;finished&nbsp;reading.</span><br>
<span class="lineno"></span><span class="keyword" id="6058559">type</span>&nbsp;<span class="ident" id="6058564">Decompressor</span>&nbsp;<span class="keyword" id="6058577">func</span><span class="op" id="6058581">(</span><span class="ident" id="6058582">io</span><span class="op" id="6058584">.</span><span class="ident" id="6058585">Reader</span><span class="op" id="6058591">)</span>&nbsp;<span class="ident" id="6058593">io</span><span class="op" id="6058595">.</span><span class="ident" id="6058596">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6058608">var</span>&nbsp;<span class="ident" id="6058612">flateWriterPool</span>&nbsp;<span class="ident" id="6058628">sync</span><span class="op" id="6058632">.</span><span class="ident" id="6058633">Pool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6058639">func</span>&nbsp;<span class="ident" id="6058644">newFlateWriter</span><span class="op" id="6058658">(</span><span class="ident" id="6058659">w</span>&nbsp;<span class="ident" id="6058661">io</span><span class="op" id="6058663">.</span><span class="ident" id="6058664">Writer</span><span class="op" id="6058670">)</span>&nbsp;<span class="ident" id="6058672">io</span><span class="op" id="6058674">.</span><span class="ident" id="6058675">WriteCloser</span>&nbsp;<span class="op" id="6058687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058690">fw</span><span class="op" id="6058692">,</span>&nbsp;<span class="ident" id="6058694">ok</span>&nbsp;<span class="op" id="6058697">:=</span>&nbsp;<span class="ident" id="6058700">flateWriterPool</span><span class="op" id="6058715">.</span><span class="ident" id="6058716">Get</span><span class="op" id="6058719">(</span><span class="op" id="6058720">)</span><span class="op" id="6058721">.</span><span class="op" id="6058722">(</span><span class="op" id="6058723">*</span><span class="ident" id="6058724">flate</span><span class="op" id="6058729">.</span><span class="ident" id="6058730">Writer</span><span class="op" id="6058736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058739">if</span>&nbsp;<span class="ident" id="6058742">ok</span>&nbsp;<span class="op" id="6058745">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058749">fw</span><span class="op" id="6058751">.</span><span class="ident" id="6058752">Reset</span><span class="op" id="6058757">(</span><span class="ident" id="6058758">w</span><span class="op" id="6058759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058762">}</span>&nbsp;<span class="keyword" id="6058764">else</span>&nbsp;<span class="op" id="6058769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058773">fw</span><span class="op" id="6058775">,</span>&nbsp;<span class="ident" id="6058777">_</span>&nbsp;<span class="op" id="6058779">=</span>&nbsp;<span class="ident" id="6058781">flate</span><span class="op" id="6058786">.</span><span class="ident" id="6058787">NewWriter</span><span class="op" id="6058796">(</span><span class="ident" id="6058797">w</span><span class="op" id="6058798">,</span>&nbsp;<span class="num" id="6058800">5</span><span class="op" id="6058801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6058804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6058807">return</span>&nbsp;<span class="op" id="6058814">&amp;</span><span class="ident" id="6058815">pooledFlateWriter</span><span class="op" id="6058832">{</span><span class="ident" id="6058833">fw</span><span class="op" id="6058835">:</span>&nbsp;<span class="ident" id="6058837">fw</span><span class="op" id="6058839">}</span><br>
<span class="lineno">35</span><span class="op" id="6058841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6058844">type</span>&nbsp;<span class="ident" id="6058849">pooledFlateWriter</span>&nbsp;<span class="keyword" id="6058867">struct</span>&nbsp;<span class="op" id="6058874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058877">mu</span>&nbsp;<span class="ident" id="6058880">sync</span><span class="op" id="6058884">.</span><span class="ident" id="6058885">Mutex</span>&nbsp;<span class="comment" id="6058891">//&nbsp;guards&nbsp;Close&nbsp;and&nbsp;Write</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6058918">fw</span>&nbsp;<span class="op" id="6058921">*</span><span class="ident" id="6058922">flate</span><span class="op" id="6058927">.</span><span class="ident" id="6058928">Writer</span><br>
<span class="lineno">40</span><span class="op" id="6058935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6058938">func</span>&nbsp;<span class="op" id="6058943">(</span><span class="ident" id="6058944">w</span>&nbsp;<span class="op" id="6058946">*</span><span class="ident" id="6058947">pooledFlateWriter</span><span class="op" id="6058964">)</span>&nbsp;<span class="ident" id="6058966">Write</span><span class="op" id="6058971">(</span><span class="ident" id="6058972">p</span>&nbsp;<span class="op" id="6058974">[</span><span class="op" id="6058975">]</span><span class="builtintype" id="6058976">byte</span><span class="op" id="6058980">)</span>&nbsp;<span class="op" id="6058982">(</span><span class="ident" id="6058983">n</span>&nbsp;<span class="builtintype" id="6058985">int</span><span class="op" id="6058988">,</span>&nbsp;<span class="ident" id="6058990">err</span>&nbsp;<span class="builtintype" id="6058994">error</span><span class="op" id="6058999">)</span>&nbsp;<span class="op" id="6059001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059004">w</span><span class="op" id="6059005">.</span><span class="ident" id="6059006">mu</span><span class="op" id="6059008">.</span><span class="ident" id="6059009">Lock</span><span class="op" id="6059013">(</span><span class="op" id="6059014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059017">defer</span>&nbsp;<span class="ident" id="6059023">w</span><span class="op" id="6059024">.</span><span class="ident" id="6059025">mu</span><span class="op" id="6059027">.</span><span class="ident" id="6059028">Unlock</span><span class="op" id="6059034">(</span><span class="op" id="6059035">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059038">if</span>&nbsp;<span class="ident" id="6059041">w</span><span class="op" id="6059042">.</span><span class="ident" id="6059043">fw</span>&nbsp;<span class="op" id="6059046">==</span>&nbsp;<span class="ident" id="6059049">nil</span>&nbsp;<span class="op" id="6059053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059057">return</span>&nbsp;<span class="num" id="6059064">0</span><span class="op" id="6059065">,</span>&nbsp;<span class="ident" id="6059067">errors</span><span class="op" id="6059073">.</span><span class="ident" id="6059074">New</span><span class="op" id="6059077">(</span><span class="string" id="6059078">&#34;Write&nbsp;after&nbsp;Close&#34;</span><span class="op" id="6059097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059103">return</span>&nbsp;<span class="ident" id="6059110">w</span><span class="op" id="6059111">.</span><span class="ident" id="6059112">fw</span><span class="op" id="6059114">.</span><span class="ident" id="6059115">Write</span><span class="op" id="6059120">(</span><span class="ident" id="6059121">p</span><span class="op" id="6059122">)</span><br>
<span class="lineno"></span><span class="op" id="6059124">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="6059127">func</span>&nbsp;<span class="op" id="6059132">(</span><span class="ident" id="6059133">w</span>&nbsp;<span class="op" id="6059135">*</span><span class="ident" id="6059136">pooledFlateWriter</span><span class="op" id="6059153">)</span>&nbsp;<span class="ident" id="6059155">Close</span><span class="op" id="6059160">(</span><span class="op" id="6059161">)</span>&nbsp;<span class="builtintype" id="6059163">error</span>&nbsp;<span class="op" id="6059169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059172">w</span><span class="op" id="6059173">.</span><span class="ident" id="6059174">mu</span><span class="op" id="6059176">.</span><span class="ident" id="6059177">Lock</span><span class="op" id="6059181">(</span><span class="op" id="6059182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059185">defer</span>&nbsp;<span class="ident" id="6059191">w</span><span class="op" id="6059192">.</span><span class="ident" id="6059193">mu</span><span class="op" id="6059195">.</span><span class="ident" id="6059196">Unlock</span><span class="op" id="6059202">(</span><span class="op" id="6059203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059206">var</span>&nbsp;<span class="ident" id="6059210">err</span>&nbsp;<span class="builtintype" id="6059214">error</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059221">if</span>&nbsp;<span class="ident" id="6059224">w</span><span class="op" id="6059225">.</span><span class="ident" id="6059226">fw</span>&nbsp;<span class="op" id="6059229">!=</span>&nbsp;<span class="ident" id="6059232">nil</span>&nbsp;<span class="op" id="6059236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059240">err</span>&nbsp;<span class="op" id="6059244">=</span>&nbsp;<span class="ident" id="6059246">w</span><span class="op" id="6059247">.</span><span class="ident" id="6059248">fw</span><span class="op" id="6059250">.</span><span class="ident" id="6059251">Close</span><span class="op" id="6059256">(</span><span class="op" id="6059257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059261">flateWriterPool</span><span class="op" id="6059276">.</span><span class="ident" id="6059277">Put</span><span class="op" id="6059280">(</span><span class="ident" id="6059281">w</span><span class="op" id="6059282">.</span><span class="ident" id="6059283">fw</span><span class="op" id="6059285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059289">w</span><span class="op" id="6059290">.</span><span class="ident" id="6059291">fw</span>&nbsp;<span class="op" id="6059294">=</span>&nbsp;<span class="ident" id="6059296">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059301">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059304">return</span>&nbsp;<span class="ident" id="6059311">err</span><br>
<span class="lineno"></span><span class="op" id="6059315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6059318">var</span>&nbsp;<span class="op" id="6059322">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059325">mu</span>&nbsp;<span class="ident" id="6059328">sync</span><span class="op" id="6059332">.</span><span class="ident" id="6059333">RWMutex</span>&nbsp;<span class="comment" id="6059341">//&nbsp;guards&nbsp;compressor&nbsp;and&nbsp;decompressor&nbsp;maps</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059386">compressors</span>&nbsp;<span class="op" id="6059398">=</span>&nbsp;<span class="keyword" id="6059400">map</span><span class="op" id="6059403">[</span><span class="builtintype" id="6059404">uint16</span><span class="op" id="6059410">]</span><span class="ident" id="6059411">Compressor</span><span class="op" id="6059421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059425">Store</span><span class="op" id="6059430">:</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="6059434">func</span><span class="op" id="6059438">(</span><span class="ident" id="6059439">w</span>&nbsp;<span class="ident" id="6059441">io</span><span class="op" id="6059443">.</span><span class="ident" id="6059444">Writer</span><span class="op" id="6059450">)</span>&nbsp;<span class="op" id="6059452">(</span><span class="ident" id="6059453">io</span><span class="op" id="6059455">.</span><span class="ident" id="6059456">WriteCloser</span><span class="op" id="6059467">,</span>&nbsp;<span class="builtintype" id="6059469">error</span><span class="op" id="6059474">)</span>&nbsp;<span class="op" id="6059476">{</span>&nbsp;<span class="keyword" id="6059478">return</span>&nbsp;<span class="op" id="6059485">&amp;</span><span class="ident" id="6059486">nopCloser</span><span class="op" id="6059495">{</span><span class="ident" id="6059496">w</span><span class="op" id="6059497">}</span><span class="op" id="6059498">,</span>&nbsp;<span class="ident" id="6059500">nil</span>&nbsp;<span class="op" id="6059504">}</span><span class="op" id="6059505">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059509">Deflate</span><span class="op" id="6059516">:</span>&nbsp;<span class="keyword" id="6059518">func</span><span class="op" id="6059522">(</span><span class="ident" id="6059523">w</span>&nbsp;<span class="ident" id="6059525">io</span><span class="op" id="6059527">.</span><span class="ident" id="6059528">Writer</span><span class="op" id="6059534">)</span>&nbsp;<span class="op" id="6059536">(</span><span class="ident" id="6059537">io</span><span class="op" id="6059539">.</span><span class="ident" id="6059540">WriteCloser</span><span class="op" id="6059551">,</span>&nbsp;<span class="builtintype" id="6059553">error</span><span class="op" id="6059558">)</span>&nbsp;<span class="op" id="6059560">{</span>&nbsp;<span class="keyword" id="6059562">return</span>&nbsp;<span class="ident" id="6059569">newFlateWriter</span><span class="op" id="6059583">(</span><span class="ident" id="6059584">w</span><span class="op" id="6059585">)</span><span class="op" id="6059586">,</span>&nbsp;<span class="ident" id="6059588">nil</span>&nbsp;<span class="op" id="6059592">}</span><span class="op" id="6059593">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059596">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059600">decompressors</span>&nbsp;<span class="op" id="6059614">=</span>&nbsp;<span class="keyword" id="6059616">map</span><span class="op" id="6059619">[</span><span class="builtintype" id="6059620">uint16</span><span class="op" id="6059626">]</span><span class="ident" id="6059627">Decompressor</span><span class="op" id="6059639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059643">Store</span><span class="op" id="6059648">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6059652">ioutil</span><span class="op" id="6059658">.</span><span class="ident" id="6059659">NopCloser</span><span class="op" id="6059668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059672">Deflate</span><span class="op" id="6059679">:</span>&nbsp;<span class="ident" id="6059681">flate</span><span class="op" id="6059686">.</span><span class="ident" id="6059687">NewReader</span><span class="op" id="6059696">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059699">}</span><br>
<span class="lineno">75</span><span class="op" id="6059701">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6059704">//&nbsp;RegisterDecompressor&nbsp;allows&nbsp;custom&nbsp;decompressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="keyword" id="6059783">func</span>&nbsp;<span class="ident" id="6059788">RegisterDecompressor</span><span class="op" id="6059808">(</span><span class="ident" id="6059809">method</span>&nbsp;<span class="builtintype" id="6059816">uint16</span><span class="op" id="6059822">,</span>&nbsp;<span class="ident" id="6059824">d</span>&nbsp;<span class="ident" id="6059826">Decompressor</span><span class="op" id="6059838">)</span>&nbsp;<span class="op" id="6059840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059843">mu</span><span class="op" id="6059845">.</span><span class="ident" id="6059846">Lock</span><span class="op" id="6059850">(</span><span class="op" id="6059851">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059854">defer</span>&nbsp;<span class="ident" id="6059860">mu</span><span class="op" id="6059862">.</span><span class="ident" id="6059863">Unlock</span><span class="op" id="6059869">(</span><span class="op" id="6059870">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6059874">if</span>&nbsp;<span class="ident" id="6059877">_</span><span class="op" id="6059878">,</span>&nbsp;<span class="ident" id="6059880">ok</span>&nbsp;<span class="op" id="6059883">:=</span>&nbsp;<span class="ident" id="6059886">decompressors</span><span class="op" id="6059899">[</span><span class="ident" id="6059900">method</span><span class="op" id="6059906">]</span><span class="op" id="6059907">;</span>&nbsp;<span class="ident" id="6059909">ok</span>&nbsp;<span class="op" id="6059912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6059916">panic</span><span class="op" id="6059921">(</span><span class="string" id="6059922">&#34;decompressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6059955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6059958">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6059961">decompressors</span><span class="op" id="6059974">[</span><span class="ident" id="6059975">method</span><span class="op" id="6059981">]</span>&nbsp;<span class="op" id="6059983">=</span>&nbsp;<span class="ident" id="6059985">d</span><br>
<span class="lineno"></span><span class="op" id="6059987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6059990">//&nbsp;RegisterCompressor&nbsp;registers&nbsp;custom&nbsp;compressors&nbsp;for&nbsp;a&nbsp;specified&nbsp;method&nbsp;ID.</span><br>
<span class="lineno"></span><span class="comment" id="6060068">//&nbsp;The&nbsp;common&nbsp;methods&nbsp;Store&nbsp;and&nbsp;Deflate&nbsp;are&nbsp;built&nbsp;in.</span><br>
<span class="lineno">90</span><span class="keyword" id="6060122">func</span>&nbsp;<span class="ident" id="6060127">RegisterCompressor</span><span class="op" id="6060145">(</span><span class="ident" id="6060146">method</span>&nbsp;<span class="builtintype" id="6060153">uint16</span><span class="op" id="6060159">,</span>&nbsp;<span class="ident" id="6060161">comp</span>&nbsp;<span class="ident" id="6060166">Compressor</span><span class="op" id="6060176">)</span>&nbsp;<span class="op" id="6060178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060181">mu</span><span class="op" id="6060183">.</span><span class="ident" id="6060184">Lock</span><span class="op" id="6060188">(</span><span class="op" id="6060189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060192">defer</span>&nbsp;<span class="ident" id="6060198">mu</span><span class="op" id="6060200">.</span><span class="ident" id="6060201">Unlock</span><span class="op" id="6060207">(</span><span class="op" id="6060208">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060212">if</span>&nbsp;<span class="ident" id="6060215">_</span><span class="op" id="6060216">,</span>&nbsp;<span class="ident" id="6060218">ok</span>&nbsp;<span class="op" id="6060221">:=</span>&nbsp;<span class="ident" id="6060224">compressors</span><span class="op" id="6060235">[</span><span class="ident" id="6060236">method</span><span class="op" id="6060242">]</span><span class="op" id="6060243">;</span>&nbsp;<span class="ident" id="6060245">ok</span>&nbsp;<span class="op" id="6060248">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6060252">panic</span><span class="op" id="6060257">(</span><span class="string" id="6060258">&#34;compressor&nbsp;already&nbsp;registered&#34;</span><span class="op" id="6060289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6060292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060295">compressors</span><span class="op" id="6060306">[</span><span class="ident" id="6060307">method</span><span class="op" id="6060313">]</span>&nbsp;<span class="op" id="6060315">=</span>&nbsp;<span class="ident" id="6060317">comp</span><br>
<span class="lineno"></span><span class="op" id="6060322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="6060325">func</span>&nbsp;<span class="ident" id="6060330">compressor</span><span class="op" id="6060340">(</span><span class="ident" id="6060341">method</span>&nbsp;<span class="builtintype" id="6060348">uint16</span><span class="op" id="6060354">)</span>&nbsp;<span class="ident" id="6060356">Compressor</span>&nbsp;<span class="op" id="6060367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060370">mu</span><span class="op" id="6060372">.</span><span class="ident" id="6060373">RLock</span><span class="op" id="6060378">(</span><span class="op" id="6060379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060382">defer</span>&nbsp;<span class="ident" id="6060388">mu</span><span class="op" id="6060390">.</span><span class="ident" id="6060391">RUnlock</span><span class="op" id="6060398">(</span><span class="op" id="6060399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060402">return</span>&nbsp;<span class="ident" id="6060409">compressors</span><span class="op" id="6060420">[</span><span class="ident" id="6060421">method</span><span class="op" id="6060427">]</span><br>
<span class="lineno"></span><span class="op" id="6060429">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6060432">func</span>&nbsp;<span class="ident" id="6060437">decompressor</span><span class="op" id="6060449">(</span><span class="ident" id="6060450">method</span>&nbsp;<span class="builtintype" id="6060457">uint16</span><span class="op" id="6060463">)</span>&nbsp;<span class="ident" id="6060465">Decompressor</span>&nbsp;<span class="op" id="6060478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6060481">mu</span><span class="op" id="6060483">.</span><span class="ident" id="6060484">RLock</span><span class="op" id="6060489">(</span><span class="op" id="6060490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060493">defer</span>&nbsp;<span class="ident" id="6060499">mu</span><span class="op" id="6060501">.</span><span class="ident" id="6060502">RUnlock</span><span class="op" id="6060509">(</span><span class="op" id="6060510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6060513">return</span>&nbsp;<span class="ident" id="6060520">decompressors</span><span class="op" id="6060533">[</span><span class="ident" id="6060534">method</span><span class="op" id="6060540">]</span><br>
<span class="lineno">110</span><span class="op" id="6060542">}</span>
</div>
</body>
</html>
