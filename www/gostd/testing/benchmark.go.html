<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6079821">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6079876">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6079930">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6079981">package</span>&nbsp;<span class="ident" id="6079989">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6079998">import</span>&nbsp;<span class="op" id="6080005">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080008">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080016">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080023">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080029">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080040">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080048">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6080063">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6080070">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6080073">var</span>&nbsp;<span class="ident" id="6080077">matchBenchmarks</span>&nbsp;<span class="op" id="6080093">=</span>&nbsp;<span class="ident" id="6080095">flag</span><span class="op" id="6080099">.</span><span class="ident" id="6080100">String</span><span class="op" id="6080106">(</span><span class="string" id="6080107">&#34;test.bench&#34;</span><span class="op" id="6080119">,</span>&nbsp;<span class="string" id="6080121">&#34;&#34;</span><span class="op" id="6080123">,</span>&nbsp;<span class="string" id="6080125">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="6080173">)</span><br>
<span class="lineno"></span><span class="keyword" id="6080175">var</span>&nbsp;<span class="ident" id="6080179">benchTime</span>&nbsp;<span class="op" id="6080189">=</span>&nbsp;<span class="ident" id="6080191">flag</span><span class="op" id="6080195">.</span><span class="ident" id="6080196">Duration</span><span class="op" id="6080204">(</span><span class="string" id="6080205">&#34;test.benchtime&#34;</span><span class="op" id="6080221">,</span>&nbsp;<span class="num" id="6080223">1</span><span class="op" id="6080224">*</span><span class="ident" id="6080225">time</span><span class="op" id="6080229">.</span><span class="ident" id="6080230">Second</span><span class="op" id="6080236">,</span>&nbsp;<span class="string" id="6080238">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="6080279">)</span><br>
<span class="lineno"></span><span class="keyword" id="6080281">var</span>&nbsp;<span class="ident" id="6080285">benchmarkMemory</span>&nbsp;<span class="op" id="6080301">=</span>&nbsp;<span class="ident" id="6080303">flag</span><span class="op" id="6080307">.</span><span class="ident" id="6080308">Bool</span><span class="op" id="6080312">(</span><span class="string" id="6080313">&#34;test.benchmem&#34;</span><span class="op" id="6080328">,</span>&nbsp;<span class="builtintype" id="6080330">false</span><span class="op" id="6080335">,</span>&nbsp;<span class="string" id="6080337">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="6080378">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="6080381">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="6080441">var</span>&nbsp;<span class="ident" id="6080445">benchmarkLock</span>&nbsp;<span class="ident" id="6080459">sync</span><span class="op" id="6080463">.</span><span class="ident" id="6080464">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080471">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="6080521">var</span>&nbsp;<span class="ident" id="6080525">memStats</span>&nbsp;<span class="ident" id="6080534">runtime</span><span class="op" id="6080541">.</span><span class="ident" id="6080542">MemStats</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080552">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6080641">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6080670">type</span>&nbsp;<span class="ident" id="6080675">InternalBenchmark</span>&nbsp;<span class="keyword" id="6080693">struct</span>&nbsp;<span class="op" id="6080700">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080703">Name</span>&nbsp;<span class="builtintype" id="6080708">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080716">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6080721">func</span><span class="op" id="6080725">(</span><span class="ident" id="6080726">b</span>&nbsp;<span class="op" id="6080728">*</span><span class="ident" id="6080729">B</span><span class="op" id="6080730">)</span><br>
<span class="lineno"></span><span class="op" id="6080732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6080735">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="6080800">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6080858">type</span>&nbsp;<span class="ident" id="6080863">B</span>&nbsp;<span class="keyword" id="6080865">struct</span>&nbsp;<span class="op" id="6080872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080875">common</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080883">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080900">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080905">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6080922">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6080936">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6080981">previousDuration</span>&nbsp;<span class="ident" id="6080998">time</span><span class="op" id="6081002">.</span><span class="ident" id="6081003">Duration</span>&nbsp;<span class="comment" id="6081012">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081051">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081068">InternalBenchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081087">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081104">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081111">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6081128">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081134">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="6081151">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081157">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6081174">BenchmarkResult</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081191">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6081208">int</span>&nbsp;<span class="comment" id="6081212">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081270">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081338">startAllocs</span>&nbsp;<span class="ident" id="6081350">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081358">startBytes</span>&nbsp;&nbsp;<span class="ident" id="6081370">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6081378">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081426">netAllocs</span>&nbsp;<span class="ident" id="6081436">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081444">netBytes</span>&nbsp;&nbsp;<span class="ident" id="6081454">uint64</span><br>
<span class="lineno"></span><span class="op" id="6081461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6081464">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="6081539">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="6081613">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="6081637">func</span>&nbsp;<span class="op" id="6081642">(</span><span class="ident" id="6081643">b</span>&nbsp;<span class="op" id="6081645">*</span><span class="ident" id="6081646">B</span><span class="op" id="6081647">)</span>&nbsp;<span class="ident" id="6081649">StartTimer</span><span class="op" id="6081659">(</span><span class="op" id="6081660">)</span>&nbsp;<span class="op" id="6081662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6081665">if</span>&nbsp;<span class="op" id="6081668">!</span><span class="ident" id="6081669">b</span><span class="op" id="6081670">.</span><span class="ident" id="6081671">timerOn</span>&nbsp;<span class="op" id="6081679">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081683">runtime</span><span class="op" id="6081690">.</span><span class="ident" id="6081691">ReadMemStats</span><span class="op" id="6081703">(</span><span class="op" id="6081704">&amp;</span><span class="ident" id="6081705">memStats</span><span class="op" id="6081713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081717">b</span><span class="op" id="6081718">.</span><span class="ident" id="6081719">startAllocs</span>&nbsp;<span class="op" id="6081731">=</span>&nbsp;<span class="ident" id="6081733">memStats</span><span class="op" id="6081741">.</span><span class="ident" id="6081742">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081752">b</span><span class="op" id="6081753">.</span><span class="ident" id="6081754">startBytes</span>&nbsp;<span class="op" id="6081765">=</span>&nbsp;<span class="ident" id="6081767">memStats</span><span class="op" id="6081775">.</span><span class="ident" id="6081776">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081789">b</span><span class="op" id="6081790">.</span><span class="ident" id="6081791">start</span>&nbsp;<span class="op" id="6081797">=</span>&nbsp;<span class="ident" id="6081799">time</span><span class="op" id="6081803">.</span><span class="ident" id="6081804">Now</span><span class="op" id="6081807">(</span><span class="op" id="6081808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6081812">b</span><span class="op" id="6081813">.</span><span class="ident" id="6081814">timerOn</span>&nbsp;<span class="op" id="6081822">=</span>&nbsp;<span class="builtintype" id="6081824">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6081830">}</span><br>
<span class="lineno"></span><span class="op" id="6081832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6081835">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="6081906">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="6081964">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="6081984">func</span>&nbsp;<span class="op" id="6081989">(</span><span class="ident" id="6081990">b</span>&nbsp;<span class="op" id="6081992">*</span><span class="ident" id="6081993">B</span><span class="op" id="6081994">)</span>&nbsp;<span class="ident" id="6081996">StopTimer</span><span class="op" id="6082005">(</span><span class="op" id="6082006">)</span>&nbsp;<span class="op" id="6082008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082011">if</span>&nbsp;<span class="ident" id="6082014">b</span><span class="op" id="6082015">.</span><span class="ident" id="6082016">timerOn</span>&nbsp;<span class="op" id="6082024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082028">b</span><span class="op" id="6082029">.</span><span class="ident" id="6082030">duration</span>&nbsp;<span class="op" id="6082039">+=</span>&nbsp;<span class="ident" id="6082042">time</span><span class="op" id="6082046">.</span><span class="ident" id="6082047">Now</span><span class="op" id="6082050">(</span><span class="op" id="6082051">)</span><span class="op" id="6082052">.</span><span class="ident" id="6082053">Sub</span><span class="op" id="6082056">(</span><span class="ident" id="6082057">b</span><span class="op" id="6082058">.</span><span class="ident" id="6082059">start</span><span class="op" id="6082064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082068">runtime</span><span class="op" id="6082075">.</span><span class="ident" id="6082076">ReadMemStats</span><span class="op" id="6082088">(</span><span class="op" id="6082089">&amp;</span><span class="ident" id="6082090">memStats</span><span class="op" id="6082098">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082102">b</span><span class="op" id="6082103">.</span><span class="ident" id="6082104">netAllocs</span>&nbsp;<span class="op" id="6082114">+=</span>&nbsp;<span class="ident" id="6082117">memStats</span><span class="op" id="6082125">.</span><span class="ident" id="6082126">Mallocs</span>&nbsp;<span class="op" id="6082134">-</span>&nbsp;<span class="ident" id="6082136">b</span><span class="op" id="6082137">.</span><span class="ident" id="6082138">startAllocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082152">b</span><span class="op" id="6082153">.</span><span class="ident" id="6082154">netBytes</span>&nbsp;<span class="op" id="6082163">+=</span>&nbsp;<span class="ident" id="6082166">memStats</span><span class="op" id="6082174">.</span><span class="ident" id="6082175">TotalAlloc</span>&nbsp;<span class="op" id="6082186">-</span>&nbsp;<span class="ident" id="6082188">b</span><span class="op" id="6082189">.</span><span class="ident" id="6082190">startBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082203">b</span><span class="op" id="6082204">.</span><span class="ident" id="6082205">timerOn</span>&nbsp;<span class="op" id="6082213">=</span>&nbsp;<span class="builtintype" id="6082215">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082222">}</span><br>
<span class="lineno"></span><span class="op" id="6082224">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="6082227">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="6082306">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6082358">func</span>&nbsp;<span class="op" id="6082363">(</span><span class="ident" id="6082364">b</span>&nbsp;<span class="op" id="6082366">*</span><span class="ident" id="6082367">B</span><span class="op" id="6082368">)</span>&nbsp;<span class="ident" id="6082370">ResetTimer</span><span class="op" id="6082380">(</span><span class="op" id="6082381">)</span>&nbsp;<span class="op" id="6082383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6082386">if</span>&nbsp;<span class="ident" id="6082389">b</span><span class="op" id="6082390">.</span><span class="ident" id="6082391">timerOn</span>&nbsp;<span class="op" id="6082399">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082403">runtime</span><span class="op" id="6082410">.</span><span class="ident" id="6082411">ReadMemStats</span><span class="op" id="6082423">(</span><span class="op" id="6082424">&amp;</span><span class="ident" id="6082425">memStats</span><span class="op" id="6082433">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082437">b</span><span class="op" id="6082438">.</span><span class="ident" id="6082439">startAllocs</span>&nbsp;<span class="op" id="6082451">=</span>&nbsp;<span class="ident" id="6082453">memStats</span><span class="op" id="6082461">.</span><span class="ident" id="6082462">Mallocs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082472">b</span><span class="op" id="6082473">.</span><span class="ident" id="6082474">startBytes</span>&nbsp;<span class="op" id="6082485">=</span>&nbsp;<span class="ident" id="6082487">memStats</span><span class="op" id="6082495">.</span><span class="ident" id="6082496">TotalAlloc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082509">b</span><span class="op" id="6082510">.</span><span class="ident" id="6082511">start</span>&nbsp;<span class="op" id="6082517">=</span>&nbsp;<span class="ident" id="6082519">time</span><span class="op" id="6082523">.</span><span class="ident" id="6082524">Now</span><span class="op" id="6082527">(</span><span class="op" id="6082528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6082531">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082534">b</span><span class="op" id="6082535">.</span><span class="ident" id="6082536">duration</span>&nbsp;<span class="op" id="6082545">=</span>&nbsp;<span class="num" id="6082547">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082550">b</span><span class="op" id="6082551">.</span><span class="ident" id="6082552">netAllocs</span>&nbsp;<span class="op" id="6082562">=</span>&nbsp;<span class="num" id="6082564">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082567">b</span><span class="op" id="6082568">.</span><span class="ident" id="6082569">netBytes</span>&nbsp;<span class="op" id="6082578">=</span>&nbsp;<span class="num" id="6082580">0</span><br>
<span class="lineno"></span><span class="op" id="6082582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6082585">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="6082658">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="6082722">func</span>&nbsp;<span class="op" id="6082727">(</span><span class="ident" id="6082728">b</span>&nbsp;<span class="op" id="6082730">*</span><span class="ident" id="6082731">B</span><span class="op" id="6082732">)</span>&nbsp;<span class="ident" id="6082734">SetBytes</span><span class="op" id="6082742">(</span><span class="ident" id="6082743">n</span>&nbsp;<span class="ident" id="6082745">int64</span><span class="op" id="6082750">)</span>&nbsp;<span class="op" id="6082752">{</span>&nbsp;<span class="ident" id="6082754">b</span><span class="op" id="6082755">.</span><span class="ident" id="6082756">bytes</span>&nbsp;<span class="op" id="6082762">=</span>&nbsp;<span class="ident" id="6082764">n</span>&nbsp;<span class="op" id="6082766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6082769">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="6082831">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6082902">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="6082949">func</span>&nbsp;<span class="op" id="6082954">(</span><span class="ident" id="6082955">b</span>&nbsp;<span class="op" id="6082957">*</span><span class="ident" id="6082958">B</span><span class="op" id="6082959">)</span>&nbsp;<span class="ident" id="6082961">ReportAllocs</span><span class="op" id="6082973">(</span><span class="op" id="6082974">)</span>&nbsp;<span class="op" id="6082976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6082979">b</span><span class="op" id="6082980">.</span><span class="ident" id="6082981">showAllocResult</span>&nbsp;<span class="op" id="6082997">=</span>&nbsp;<span class="builtintype" id="6082999">true</span><br>
<span class="lineno"></span><span class="op" id="6083004">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="6083007">func</span>&nbsp;<span class="op" id="6083012">(</span><span class="ident" id="6083013">b</span>&nbsp;<span class="op" id="6083015">*</span><span class="ident" id="6083016">B</span><span class="op" id="6083017">)</span>&nbsp;<span class="ident" id="6083019">nsPerOp</span><span class="op" id="6083026">(</span><span class="op" id="6083027">)</span>&nbsp;<span class="ident" id="6083029">int64</span>&nbsp;<span class="op" id="6083035">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083038">if</span>&nbsp;<span class="ident" id="6083041">b</span><span class="op" id="6083042">.</span><span class="ident" id="6083043">N</span>&nbsp;<span class="op" id="6083045">&lt;=</span>&nbsp;<span class="num" id="6083048">0</span>&nbsp;<span class="op" id="6083050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083054">return</span>&nbsp;<span class="num" id="6083061">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083064">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083067">return</span>&nbsp;<span class="ident" id="6083074">b</span><span class="op" id="6083075">.</span><span class="ident" id="6083076">duration</span><span class="op" id="6083084">.</span><span class="ident" id="6083085">Nanoseconds</span><span class="op" id="6083096">(</span><span class="op" id="6083097">)</span>&nbsp;<span class="op" id="6083099">/</span>&nbsp;<span class="ident" id="6083101">int64</span><span class="op" id="6083106">(</span><span class="ident" id="6083107">b</span><span class="op" id="6083108">.</span><span class="ident" id="6083109">N</span><span class="op" id="6083110">)</span><br>
<span class="lineno"></span><span class="op" id="6083112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083115">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="6083187">func</span>&nbsp;<span class="op" id="6083192">(</span><span class="ident" id="6083193">b</span>&nbsp;<span class="op" id="6083195">*</span><span class="ident" id="6083196">B</span><span class="op" id="6083197">)</span>&nbsp;<span class="ident" id="6083199">runN</span><span class="op" id="6083203">(</span><span class="ident" id="6083204">n</span>&nbsp;<span class="builtintype" id="6083206">int</span><span class="op" id="6083209">)</span>&nbsp;<span class="op" id="6083211">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083214">benchmarkLock</span><span class="op" id="6083227">.</span><span class="ident" id="6083228">Lock</span><span class="op" id="6083232">(</span><span class="op" id="6083233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083236">defer</span>&nbsp;<span class="ident" id="6083242">benchmarkLock</span><span class="op" id="6083255">.</span><span class="ident" id="6083256">Unlock</span><span class="op" id="6083262">(</span><span class="op" id="6083263">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083266">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083319">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083363">runtime</span><span class="op" id="6083370">.</span><span class="ident" id="6083371">GC</span><span class="op" id="6083373">(</span><span class="op" id="6083374">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083377">b</span><span class="op" id="6083378">.</span><span class="ident" id="6083379">N</span>&nbsp;<span class="op" id="6083381">=</span>&nbsp;<span class="ident" id="6083383">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083386">b</span><span class="op" id="6083387">.</span><span class="ident" id="6083388">parallelism</span>&nbsp;<span class="op" id="6083400">=</span>&nbsp;<span class="num" id="6083402">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083405">b</span><span class="op" id="6083406">.</span><span class="ident" id="6083407">ResetTimer</span><span class="op" id="6083417">(</span><span class="op" id="6083418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083421">b</span><span class="op" id="6083422">.</span><span class="ident" id="6083423">StartTimer</span><span class="op" id="6083433">(</span><span class="op" id="6083434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083437">b</span><span class="op" id="6083438">.</span><span class="ident" id="6083439">benchmark</span><span class="op" id="6083448">.</span><span class="ident" id="6083449">F</span><span class="op" id="6083450">(</span><span class="ident" id="6083451">b</span><span class="op" id="6083452">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083455">b</span><span class="op" id="6083456">.</span><span class="ident" id="6083457">StopTimer</span><span class="op" id="6083466">(</span><span class="op" id="6083467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083470">b</span><span class="op" id="6083471">.</span><span class="ident" id="6083472">previousN</span>&nbsp;<span class="op" id="6083482">=</span>&nbsp;<span class="ident" id="6083484">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083487">b</span><span class="op" id="6083488">.</span><span class="ident" id="6083489">previousDuration</span>&nbsp;<span class="op" id="6083506">=</span>&nbsp;<span class="ident" id="6083508">b</span><span class="op" id="6083509">.</span><span class="ident" id="6083510">duration</span><br>
<span class="lineno"></span><span class="op" id="6083519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="6083522">func</span>&nbsp;<span class="ident" id="6083527">min</span><span class="op" id="6083530">(</span><span class="ident" id="6083531">x</span><span class="op" id="6083532">,</span>&nbsp;<span class="ident" id="6083534">y</span>&nbsp;<span class="builtintype" id="6083536">int</span><span class="op" id="6083539">)</span>&nbsp;<span class="builtintype" id="6083541">int</span>&nbsp;<span class="op" id="6083545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083548">if</span>&nbsp;<span class="ident" id="6083551">x</span>&nbsp;<span class="op" id="6083553">&gt;</span>&nbsp;<span class="ident" id="6083555">y</span>&nbsp;<span class="op" id="6083557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083561">return</span>&nbsp;<span class="ident" id="6083568">y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083574">return</span>&nbsp;<span class="ident" id="6083581">x</span><br>
<span class="lineno">135</span><span class="op" id="6083583">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6083586">func</span>&nbsp;<span class="ident" id="6083591">max</span><span class="op" id="6083594">(</span><span class="ident" id="6083595">x</span><span class="op" id="6083596">,</span>&nbsp;<span class="ident" id="6083598">y</span>&nbsp;<span class="builtintype" id="6083600">int</span><span class="op" id="6083603">)</span>&nbsp;<span class="builtintype" id="6083605">int</span>&nbsp;<span class="op" id="6083609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083612">if</span>&nbsp;<span class="ident" id="6083615">x</span>&nbsp;<span class="op" id="6083617">&lt;</span>&nbsp;<span class="ident" id="6083619">y</span>&nbsp;<span class="op" id="6083621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083625">return</span>&nbsp;<span class="ident" id="6083632">y</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083638">return</span>&nbsp;<span class="ident" id="6083645">x</span><br>
<span class="lineno"></span><span class="op" id="6083647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6083650">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="6083714">func</span>&nbsp;<span class="ident" id="6083719">roundDown10</span><span class="op" id="6083730">(</span><span class="ident" id="6083731">n</span>&nbsp;<span class="builtintype" id="6083733">int</span><span class="op" id="6083736">)</span>&nbsp;<span class="builtintype" id="6083738">int</span>&nbsp;<span class="op" id="6083742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083745">var</span>&nbsp;<span class="ident" id="6083749">tens</span>&nbsp;<span class="op" id="6083754">=</span>&nbsp;<span class="num" id="6083756">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083759">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083787">for</span>&nbsp;<span class="ident" id="6083791">n</span>&nbsp;<span class="op" id="6083793">&gt;=</span>&nbsp;<span class="num" id="6083796">10</span>&nbsp;<span class="op" id="6083799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083803">n</span>&nbsp;<span class="op" id="6083805">=</span>&nbsp;<span class="ident" id="6083807">n</span>&nbsp;<span class="op" id="6083809">/</span>&nbsp;<span class="num" id="6083811">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083816">tens</span><span class="op" id="6083820">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6083827">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083848">result</span>&nbsp;<span class="op" id="6083855">:=</span>&nbsp;<span class="num" id="6083858">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083861">for</span>&nbsp;<span class="ident" id="6083865">i</span>&nbsp;<span class="op" id="6083867">:=</span>&nbsp;<span class="num" id="6083870">0</span><span class="op" id="6083871">;</span>&nbsp;<span class="ident" id="6083873">i</span>&nbsp;<span class="op" id="6083875">&lt;</span>&nbsp;<span class="ident" id="6083877">tens</span><span class="op" id="6083881">;</span>&nbsp;<span class="ident" id="6083883">i</span><span class="op" id="6083884">++</span>&nbsp;<span class="op" id="6083887">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6083891">result</span>&nbsp;<span class="op" id="6083898">*=</span>&nbsp;<span class="num" id="6083901">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6083905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6083908">return</span>&nbsp;<span class="ident" id="6083915">result</span><br>
<span class="lineno"></span><span class="op" id="6083922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6083925">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="6083994">func</span>&nbsp;<span class="ident" id="6083999">roundUp</span><span class="op" id="6084006">(</span><span class="ident" id="6084007">n</span>&nbsp;<span class="builtintype" id="6084009">int</span><span class="op" id="6084012">)</span>&nbsp;<span class="builtintype" id="6084014">int</span>&nbsp;<span class="op" id="6084018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084021">base</span>&nbsp;<span class="op" id="6084026">:=</span>&nbsp;<span class="ident" id="6084029">roundDown10</span><span class="op" id="6084040">(</span><span class="ident" id="6084041">n</span><span class="op" id="6084042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084045">switch</span>&nbsp;<span class="op" id="6084052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084055">case</span>&nbsp;<span class="ident" id="6084060">n</span>&nbsp;<span class="op" id="6084062">&lt;=</span>&nbsp;<span class="ident" id="6084065">base</span><span class="op" id="6084069">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084073">return</span>&nbsp;<span class="ident" id="6084080">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084086">case</span>&nbsp;<span class="ident" id="6084091">n</span>&nbsp;<span class="op" id="6084093">&lt;=</span>&nbsp;<span class="op" id="6084096">(</span><span class="num" id="6084097">2</span>&nbsp;<span class="op" id="6084099">*</span>&nbsp;<span class="ident" id="6084101">base</span><span class="op" id="6084105">)</span><span class="op" id="6084106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084110">return</span>&nbsp;<span class="num" id="6084117">2</span>&nbsp;<span class="op" id="6084119">*</span>&nbsp;<span class="ident" id="6084121">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084127">case</span>&nbsp;<span class="ident" id="6084132">n</span>&nbsp;<span class="op" id="6084134">&lt;=</span>&nbsp;<span class="op" id="6084137">(</span><span class="num" id="6084138">3</span>&nbsp;<span class="op" id="6084140">*</span>&nbsp;<span class="ident" id="6084142">base</span><span class="op" id="6084146">)</span><span class="op" id="6084147">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084151">return</span>&nbsp;<span class="num" id="6084158">3</span>&nbsp;<span class="op" id="6084160">*</span>&nbsp;<span class="ident" id="6084162">base</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084168">case</span>&nbsp;<span class="ident" id="6084173">n</span>&nbsp;<span class="op" id="6084175">&lt;=</span>&nbsp;<span class="op" id="6084178">(</span><span class="num" id="6084179">5</span>&nbsp;<span class="op" id="6084181">*</span>&nbsp;<span class="ident" id="6084183">base</span><span class="op" id="6084187">)</span><span class="op" id="6084188">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084192">return</span>&nbsp;<span class="num" id="6084199">5</span>&nbsp;<span class="op" id="6084201">*</span>&nbsp;<span class="ident" id="6084203">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084209">default</span><span class="op" id="6084216">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084220">return</span>&nbsp;<span class="num" id="6084227">10</span>&nbsp;<span class="op" id="6084230">*</span>&nbsp;<span class="ident" id="6084232">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084238">}</span><br>
<span class="lineno">175</span><span class="op" id="6084240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084243">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6084304">func</span>&nbsp;<span class="op" id="6084309">(</span><span class="ident" id="6084310">b</span>&nbsp;<span class="op" id="6084312">*</span><span class="ident" id="6084313">B</span><span class="op" id="6084314">)</span>&nbsp;<span class="ident" id="6084316">run</span><span class="op" id="6084319">(</span><span class="op" id="6084320">)</span>&nbsp;<span class="ident" id="6084322">BenchmarkResult</span>&nbsp;<span class="op" id="6084338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084341">go</span>&nbsp;<span class="ident" id="6084344">b</span><span class="op" id="6084345">.</span><span class="ident" id="6084346">launch</span><span class="op" id="6084352">(</span><span class="op" id="6084353">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084356">&lt;-</span><span class="ident" id="6084358">b</span><span class="op" id="6084359">.</span><span class="ident" id="6084360">signal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084368">return</span>&nbsp;<span class="ident" id="6084375">b</span><span class="op" id="6084376">.</span><span class="ident" id="6084377">result</span><br>
<span class="lineno"></span><span class="op" id="6084384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6084387">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="6084465">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="6084546">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="6084591">//&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsptesting.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp100000&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="6084635">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="6084697">func</span>&nbsp;<span class="op" id="6084702">(</span><span class="ident" id="6084703">b</span>&nbsp;<span class="op" id="6084705">*</span><span class="ident" id="6084706">B</span><span class="op" id="6084707">)</span>&nbsp;<span class="ident" id="6084709">launch</span><span class="op" id="6084715">(</span><span class="op" id="6084716">)</span>&nbsp;<span class="op" id="6084718">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084721">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084790">n</span>&nbsp;<span class="op" id="6084792">:=</span>&nbsp;<span class="num" id="6084795">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084799">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084853">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6084889">defer</span>&nbsp;<span class="keyword" id="6084895">func</span><span class="op" id="6084899">(</span><span class="op" id="6084900">)</span>&nbsp;<span class="op" id="6084902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084906">b</span><span class="op" id="6084907">.</span><span class="ident" id="6084908">signal</span>&nbsp;<span class="op" id="6084915">&lt;-</span>&nbsp;<span class="ident" id="6084918">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6084921">}</span><span class="op" id="6084922">(</span><span class="op" id="6084923">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6084927">b</span><span class="op" id="6084928">.</span><span class="ident" id="6084929">runN</span><span class="op" id="6084933">(</span><span class="ident" id="6084934">n</span><span class="op" id="6084935">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6084938">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085003">d</span>&nbsp;<span class="op" id="6085005">:=</span>&nbsp;<span class="op" id="6085008">*</span><span class="ident" id="6085009">benchTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085020">for</span>&nbsp;<span class="op" id="6085024">!</span><span class="ident" id="6085025">b</span><span class="op" id="6085026">.</span><span class="ident" id="6085027">failed</span>&nbsp;<span class="op" id="6085034">&amp;&amp;</span>&nbsp;<span class="ident" id="6085037">b</span><span class="op" id="6085038">.</span><span class="ident" id="6085039">duration</span>&nbsp;<span class="op" id="6085048">&lt;</span>&nbsp;<span class="ident" id="6085050">d</span>&nbsp;<span class="op" id="6085052">&amp;&amp;</span>&nbsp;<span class="ident" id="6085055">n</span>&nbsp;<span class="op" id="6085057">&lt;</span>&nbsp;<span class="num" id="6085059">1e9</span>&nbsp;<span class="op" id="6085063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085067">last</span>&nbsp;<span class="op" id="6085072">:=</span>&nbsp;<span class="ident" id="6085075">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085079">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085113">if</span>&nbsp;<span class="ident" id="6085116">b</span><span class="op" id="6085117">.</span><span class="ident" id="6085118">nsPerOp</span><span class="op" id="6085125">(</span><span class="op" id="6085126">)</span>&nbsp;<span class="op" id="6085128">==</span>&nbsp;<span class="num" id="6085131">0</span>&nbsp;<span class="op" id="6085133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085138">n</span>&nbsp;<span class="op" id="6085140">=</span>&nbsp;<span class="num" id="6085142">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085148">}</span>&nbsp;<span class="keyword" id="6085150">else</span>&nbsp;<span class="op" id="6085155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085160">n</span>&nbsp;<span class="op" id="6085162">=</span>&nbsp;<span class="builtintype" id="6085164">int</span><span class="op" id="6085167">(</span><span class="ident" id="6085168">d</span><span class="op" id="6085169">.</span><span class="ident" id="6085170">Nanoseconds</span><span class="op" id="6085181">(</span><span class="op" id="6085182">)</span>&nbsp;<span class="op" id="6085184">/</span>&nbsp;<span class="ident" id="6085186">b</span><span class="op" id="6085187">.</span><span class="ident" id="6085188">nsPerOp</span><span class="op" id="6085195">(</span><span class="op" id="6085196">)</span><span class="op" id="6085197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085201">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085205">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085263">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085329">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085383">n</span>&nbsp;<span class="op" id="6085385">=</span>&nbsp;<span class="ident" id="6085387">max</span><span class="op" id="6085390">(</span><span class="ident" id="6085391">min</span><span class="op" id="6085394">(</span><span class="ident" id="6085395">n</span><span class="op" id="6085396">+</span><span class="ident" id="6085397">n</span><span class="op" id="6085398">/</span><span class="num" id="6085399">5</span><span class="op" id="6085400">,</span>&nbsp;<span class="num" id="6085402">100</span><span class="op" id="6085405">*</span><span class="ident" id="6085406">last</span><span class="op" id="6085410">)</span><span class="op" id="6085411">,</span>&nbsp;<span class="ident" id="6085413">last</span><span class="op" id="6085417">+</span><span class="num" id="6085418">1</span><span class="op" id="6085419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6085423">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085464">n</span>&nbsp;<span class="op" id="6085466">=</span>&nbsp;<span class="ident" id="6085468">roundUp</span><span class="op" id="6085475">(</span><span class="ident" id="6085476">n</span><span class="op" id="6085477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085481">b</span><span class="op" id="6085482">.</span><span class="ident" id="6085483">runN</span><span class="op" id="6085487">(</span><span class="ident" id="6085488">n</span><span class="op" id="6085489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6085492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085495">b</span><span class="op" id="6085496">.</span><span class="ident" id="6085497">result</span>&nbsp;<span class="op" id="6085504">=</span>&nbsp;<span class="ident" id="6085506">BenchmarkResult</span><span class="op" id="6085521">{</span><span class="ident" id="6085522">b</span><span class="op" id="6085523">.</span><span class="ident" id="6085524">N</span><span class="op" id="6085525">,</span>&nbsp;<span class="ident" id="6085527">b</span><span class="op" id="6085528">.</span><span class="ident" id="6085529">duration</span><span class="op" id="6085537">,</span>&nbsp;<span class="ident" id="6085539">b</span><span class="op" id="6085540">.</span><span class="ident" id="6085541">bytes</span><span class="op" id="6085546">,</span>&nbsp;<span class="ident" id="6085548">b</span><span class="op" id="6085549">.</span><span class="ident" id="6085550">netAllocs</span><span class="op" id="6085559">,</span>&nbsp;<span class="ident" id="6085561">b</span><span class="op" id="6085562">.</span><span class="ident" id="6085563">netBytes</span><span class="op" id="6085571">}</span><br>
<span class="lineno"></span><span class="op" id="6085573">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="6085576">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="6085611">type</span>&nbsp;<span class="ident" id="6085616">BenchmarkResult</span>&nbsp;<span class="keyword" id="6085632">struct</span>&nbsp;<span class="op" id="6085639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085642">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6085652">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085666">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085696">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085706">time</span><span class="op" id="6085710">.</span><span class="ident" id="6085711">Duration</span>&nbsp;<span class="comment" id="6085720">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085746">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6085756">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085770">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085808">MemAllocs</span>&nbsp;<span class="ident" id="6085818">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085832">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6085876">MemBytes</span>&nbsp;&nbsp;<span class="ident" id="6085886">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6085900">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="6085940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="6085943">func</span>&nbsp;<span class="op" id="6085948">(</span><span class="ident" id="6085949">r</span>&nbsp;<span class="ident" id="6085951">BenchmarkResult</span><span class="op" id="6085966">)</span>&nbsp;<span class="ident" id="6085968">NsPerOp</span><span class="op" id="6085975">(</span><span class="op" id="6085976">)</span>&nbsp;<span class="ident" id="6085978">int64</span>&nbsp;<span class="op" id="6085984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6085987">if</span>&nbsp;<span class="ident" id="6085990">r</span><span class="op" id="6085991">.</span><span class="ident" id="6085992">N</span>&nbsp;<span class="op" id="6085994">&lt;=</span>&nbsp;<span class="num" id="6085997">0</span>&nbsp;<span class="op" id="6085999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086003">return</span>&nbsp;<span class="num" id="6086010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086016">return</span>&nbsp;<span class="ident" id="6086023">r</span><span class="op" id="6086024">.</span><span class="ident" id="6086025">T</span><span class="op" id="6086026">.</span><span class="ident" id="6086027">Nanoseconds</span><span class="op" id="6086038">(</span><span class="op" id="6086039">)</span>&nbsp;<span class="op" id="6086041">/</span>&nbsp;<span class="ident" id="6086043">int64</span><span class="op" id="6086048">(</span><span class="ident" id="6086049">r</span><span class="op" id="6086050">.</span><span class="ident" id="6086051">N</span><span class="op" id="6086052">)</span><br>
<span class="lineno">235</span><span class="op" id="6086054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086057">func</span>&nbsp;<span class="op" id="6086062">(</span><span class="ident" id="6086063">r</span>&nbsp;<span class="ident" id="6086065">BenchmarkResult</span><span class="op" id="6086080">)</span>&nbsp;<span class="ident" id="6086082">mbPerSec</span><span class="op" id="6086090">(</span><span class="op" id="6086091">)</span>&nbsp;<span class="builtintype" id="6086093">float64</span>&nbsp;<span class="op" id="6086101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086104">if</span>&nbsp;<span class="ident" id="6086107">r</span><span class="op" id="6086108">.</span><span class="ident" id="6086109">Bytes</span>&nbsp;<span class="op" id="6086115">&lt;=</span>&nbsp;<span class="num" id="6086118">0</span>&nbsp;<span class="op" id="6086120">||</span>&nbsp;<span class="ident" id="6086123">r</span><span class="op" id="6086124">.</span><span class="ident" id="6086125">T</span>&nbsp;<span class="op" id="6086127">&lt;=</span>&nbsp;<span class="num" id="6086130">0</span>&nbsp;<span class="op" id="6086132">||</span>&nbsp;<span class="ident" id="6086135">r</span><span class="op" id="6086136">.</span><span class="ident" id="6086137">N</span>&nbsp;<span class="op" id="6086139">&lt;=</span>&nbsp;<span class="num" id="6086142">0</span>&nbsp;<span class="op" id="6086144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086148">return</span>&nbsp;<span class="num" id="6086155">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086161">return</span>&nbsp;<span class="op" id="6086168">(</span><span class="builtintype" id="6086169">float64</span><span class="op" id="6086176">(</span><span class="ident" id="6086177">r</span><span class="op" id="6086178">.</span><span class="ident" id="6086179">Bytes</span><span class="op" id="6086184">)</span>&nbsp;<span class="op" id="6086186">*</span>&nbsp;<span class="builtintype" id="6086188">float64</span><span class="op" id="6086195">(</span><span class="ident" id="6086196">r</span><span class="op" id="6086197">.</span><span class="ident" id="6086198">N</span><span class="op" id="6086199">)</span>&nbsp;<span class="op" id="6086201">/</span>&nbsp;<span class="num" id="6086203">1e6</span><span class="op" id="6086206">)</span>&nbsp;<span class="op" id="6086208">/</span>&nbsp;<span class="ident" id="6086210">r</span><span class="op" id="6086211">.</span><span class="ident" id="6086212">T</span><span class="op" id="6086213">.</span><span class="ident" id="6086214">Seconds</span><span class="op" id="6086221">(</span><span class="op" id="6086222">)</span><br>
<span class="lineno"></span><span class="op" id="6086224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086227">func</span>&nbsp;<span class="op" id="6086232">(</span><span class="ident" id="6086233">r</span>&nbsp;<span class="ident" id="6086235">BenchmarkResult</span><span class="op" id="6086250">)</span>&nbsp;<span class="ident" id="6086252">AllocsPerOp</span><span class="op" id="6086263">(</span><span class="op" id="6086264">)</span>&nbsp;<span class="ident" id="6086266">int64</span>&nbsp;<span class="op" id="6086272">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086275">if</span>&nbsp;<span class="ident" id="6086278">r</span><span class="op" id="6086279">.</span><span class="ident" id="6086280">N</span>&nbsp;<span class="op" id="6086282">&lt;=</span>&nbsp;<span class="num" id="6086285">0</span>&nbsp;<span class="op" id="6086287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086291">return</span>&nbsp;<span class="num" id="6086298">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086304">return</span>&nbsp;<span class="ident" id="6086311">int64</span><span class="op" id="6086316">(</span><span class="ident" id="6086317">r</span><span class="op" id="6086318">.</span><span class="ident" id="6086319">MemAllocs</span><span class="op" id="6086328">)</span>&nbsp;<span class="op" id="6086330">/</span>&nbsp;<span class="ident" id="6086332">int64</span><span class="op" id="6086337">(</span><span class="ident" id="6086338">r</span><span class="op" id="6086339">.</span><span class="ident" id="6086340">N</span><span class="op" id="6086341">)</span><br>
<span class="lineno"></span><span class="op" id="6086343">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="6086346">func</span>&nbsp;<span class="op" id="6086351">(</span><span class="ident" id="6086352">r</span>&nbsp;<span class="ident" id="6086354">BenchmarkResult</span><span class="op" id="6086369">)</span>&nbsp;<span class="ident" id="6086371">AllocedBytesPerOp</span><span class="op" id="6086388">(</span><span class="op" id="6086389">)</span>&nbsp;<span class="ident" id="6086391">int64</span>&nbsp;<span class="op" id="6086397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086400">if</span>&nbsp;<span class="ident" id="6086403">r</span><span class="op" id="6086404">.</span><span class="ident" id="6086405">N</span>&nbsp;<span class="op" id="6086407">&lt;=</span>&nbsp;<span class="num" id="6086410">0</span>&nbsp;<span class="op" id="6086412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086416">return</span>&nbsp;<span class="num" id="6086423">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086426">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086429">return</span>&nbsp;<span class="ident" id="6086436">int64</span><span class="op" id="6086441">(</span><span class="ident" id="6086442">r</span><span class="op" id="6086443">.</span><span class="ident" id="6086444">MemBytes</span><span class="op" id="6086452">)</span>&nbsp;<span class="op" id="6086454">/</span>&nbsp;<span class="ident" id="6086456">int64</span><span class="op" id="6086461">(</span><span class="ident" id="6086462">r</span><span class="op" id="6086463">.</span><span class="ident" id="6086464">N</span><span class="op" id="6086465">)</span><br>
<span class="lineno"></span><span class="op" id="6086467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6086470">func</span>&nbsp;<span class="op" id="6086475">(</span><span class="ident" id="6086476">r</span>&nbsp;<span class="ident" id="6086478">BenchmarkResult</span><span class="op" id="6086493">)</span>&nbsp;<span class="ident" id="6086495">String</span><span class="op" id="6086501">(</span><span class="op" id="6086502">)</span>&nbsp;<span class="builtintype" id="6086504">string</span>&nbsp;<span class="op" id="6086511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086514">mbs</span>&nbsp;<span class="op" id="6086518">:=</span>&nbsp;<span class="ident" id="6086521">r</span><span class="op" id="6086522">.</span><span class="ident" id="6086523">mbPerSec</span><span class="op" id="6086531">(</span><span class="op" id="6086532">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086535">mb</span>&nbsp;<span class="op" id="6086538">:=</span>&nbsp;<span class="string" id="6086541">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086545">if</span>&nbsp;<span class="ident" id="6086548">mbs</span>&nbsp;<span class="op" id="6086552">!=</span>&nbsp;<span class="num" id="6086555">0</span>&nbsp;<span class="op" id="6086557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086561">mb</span>&nbsp;<span class="op" id="6086564">=</span>&nbsp;<span class="ident" id="6086566">fmt</span><span class="op" id="6086569">.</span><span class="ident" id="6086570">Sprintf</span><span class="op" id="6086577">(</span><span class="string" id="6086578">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="6086592">,</span>&nbsp;<span class="ident" id="6086594">mbs</span><span class="op" id="6086597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086603">nsop</span>&nbsp;<span class="op" id="6086608">:=</span>&nbsp;<span class="ident" id="6086611">r</span><span class="op" id="6086612">.</span><span class="ident" id="6086613">NsPerOp</span><span class="op" id="6086620">(</span><span class="op" id="6086621">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086624">ns</span>&nbsp;<span class="op" id="6086627">:=</span>&nbsp;<span class="ident" id="6086630">fmt</span><span class="op" id="6086633">.</span><span class="ident" id="6086634">Sprintf</span><span class="op" id="6086641">(</span><span class="string" id="6086642">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="6086654">,</span>&nbsp;<span class="ident" id="6086656">nsop</span><span class="op" id="6086660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086663">if</span>&nbsp;<span class="ident" id="6086666">r</span><span class="op" id="6086667">.</span><span class="ident" id="6086668">N</span>&nbsp;<span class="op" id="6086670">&gt;</span>&nbsp;<span class="num" id="6086672">0</span>&nbsp;<span class="op" id="6086674">&amp;&amp;</span>&nbsp;<span class="ident" id="6086677">nsop</span>&nbsp;<span class="op" id="6086682">&lt;</span>&nbsp;<span class="num" id="6086684">100</span>&nbsp;<span class="op" id="6086688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086692">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6086739">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086800">if</span>&nbsp;<span class="ident" id="6086803">nsop</span>&nbsp;<span class="op" id="6086808">&lt;</span>&nbsp;<span class="num" id="6086810">10</span>&nbsp;<span class="op" id="6086813">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086818">ns</span>&nbsp;<span class="op" id="6086821">=</span>&nbsp;<span class="ident" id="6086823">fmt</span><span class="op" id="6086826">.</span><span class="ident" id="6086827">Sprintf</span><span class="op" id="6086834">(</span><span class="string" id="6086835">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="6086849">,</span>&nbsp;<span class="builtintype" id="6086851">float64</span><span class="op" id="6086858">(</span><span class="ident" id="6086859">r</span><span class="op" id="6086860">.</span><span class="ident" id="6086861">T</span><span class="op" id="6086862">.</span><span class="ident" id="6086863">Nanoseconds</span><span class="op" id="6086874">(</span><span class="op" id="6086875">)</span><span class="op" id="6086876">)</span><span class="op" id="6086877">/</span><span class="builtintype" id="6086878">float64</span><span class="op" id="6086885">(</span><span class="ident" id="6086886">r</span><span class="op" id="6086887">.</span><span class="ident" id="6086888">N</span><span class="op" id="6086889">)</span><span class="op" id="6086890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086894">}</span>&nbsp;<span class="keyword" id="6086896">else</span>&nbsp;<span class="op" id="6086901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6086906">ns</span>&nbsp;<span class="op" id="6086909">=</span>&nbsp;<span class="ident" id="6086911">fmt</span><span class="op" id="6086914">.</span><span class="ident" id="6086915">Sprintf</span><span class="op" id="6086922">(</span><span class="string" id="6086923">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="6086937">,</span>&nbsp;<span class="builtintype" id="6086939">float64</span><span class="op" id="6086946">(</span><span class="ident" id="6086947">r</span><span class="op" id="6086948">.</span><span class="ident" id="6086949">T</span><span class="op" id="6086950">.</span><span class="ident" id="6086951">Nanoseconds</span><span class="op" id="6086962">(</span><span class="op" id="6086963">)</span><span class="op" id="6086964">)</span><span class="op" id="6086965">/</span><span class="builtintype" id="6086966">float64</span><span class="op" id="6086973">(</span><span class="ident" id="6086974">r</span><span class="op" id="6086975">.</span><span class="ident" id="6086976">N</span><span class="op" id="6086977">)</span><span class="op" id="6086978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6086985">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6086988">return</span>&nbsp;<span class="ident" id="6086995">fmt</span><span class="op" id="6086998">.</span><span class="ident" id="6086999">Sprintf</span><span class="op" id="6087006">(</span><span class="string" id="6087007">&#34;%8d\t%s%s&#34;</span><span class="op" id="6087018">,</span>&nbsp;<span class="ident" id="6087020">r</span><span class="op" id="6087021">.</span><span class="ident" id="6087022">N</span><span class="op" id="6087023">,</span>&nbsp;<span class="ident" id="6087025">ns</span><span class="op" id="6087027">,</span>&nbsp;<span class="ident" id="6087029">mb</span><span class="op" id="6087031">)</span><br>
<span class="lineno"></span><span class="op" id="6087033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6087036">func</span>&nbsp;<span class="op" id="6087041">(</span><span class="ident" id="6087042">r</span>&nbsp;<span class="ident" id="6087044">BenchmarkResult</span><span class="op" id="6087059">)</span>&nbsp;<span class="ident" id="6087061">MemString</span><span class="op" id="6087070">(</span><span class="op" id="6087071">)</span>&nbsp;<span class="builtintype" id="6087073">string</span>&nbsp;<span class="op" id="6087080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087083">return</span>&nbsp;<span class="ident" id="6087090">fmt</span><span class="op" id="6087093">.</span><span class="ident" id="6087094">Sprintf</span><span class="op" id="6087101">(</span><span class="string" id="6087102">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="6087127">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087131">r</span><span class="op" id="6087132">.</span><span class="ident" id="6087133">AllocedBytesPerOp</span><span class="op" id="6087150">(</span><span class="op" id="6087151">)</span><span class="op" id="6087152">,</span>&nbsp;<span class="ident" id="6087154">r</span><span class="op" id="6087155">.</span><span class="ident" id="6087156">AllocsPerOp</span><span class="op" id="6087167">(</span><span class="op" id="6087168">)</span><span class="op" id="6087169">)</span><br>
<span class="lineno"></span><span class="op" id="6087171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6087174">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="6087267">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="6087296">func</span>&nbsp;<span class="ident" id="6087301">RunBenchmarks</span><span class="op" id="6087314">(</span><span class="ident" id="6087315">matchString</span>&nbsp;<span class="keyword" id="6087327">func</span><span class="op" id="6087331">(</span><span class="ident" id="6087332">pat</span><span class="op" id="6087335">,</span>&nbsp;<span class="ident" id="6087337">str</span>&nbsp;<span class="builtintype" id="6087341">string</span><span class="op" id="6087347">)</span>&nbsp;<span class="op" id="6087349">(</span><span class="builtintype" id="6087350">bool</span><span class="op" id="6087354">,</span>&nbsp;<span class="builtintype" id="6087356">error</span><span class="op" id="6087361">)</span><span class="op" id="6087362">,</span>&nbsp;<span class="ident" id="6087364">benchmarks</span>&nbsp;<span class="op" id="6087375">[</span><span class="op" id="6087376">]</span><span class="ident" id="6087377">InternalBenchmark</span><span class="op" id="6087394">)</span>&nbsp;<span class="op" id="6087396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6087399">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087451">if</span>&nbsp;<span class="builtinfunc" id="6087454">len</span><span class="op" id="6087457">(</span><span class="op" id="6087458">*</span><span class="ident" id="6087459">matchBenchmarks</span><span class="op" id="6087474">)</span>&nbsp;<span class="op" id="6087476">==</span>&nbsp;<span class="num" id="6087479">0</span>&nbsp;<span class="op" id="6087481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087485">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087493">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087496">for</span>&nbsp;<span class="ident" id="6087500">_</span><span class="op" id="6087501">,</span>&nbsp;<span class="ident" id="6087503">Benchmark</span>&nbsp;<span class="op" id="6087513">:=</span>&nbsp;<span class="keyword" id="6087516">range</span>&nbsp;<span class="ident" id="6087522">benchmarks</span>&nbsp;<span class="op" id="6087533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087537">matched</span><span class="op" id="6087544">,</span>&nbsp;<span class="ident" id="6087546">err</span>&nbsp;<span class="op" id="6087550">:=</span>&nbsp;<span class="ident" id="6087553">matchString</span><span class="op" id="6087564">(</span><span class="op" id="6087565">*</span><span class="ident" id="6087566">matchBenchmarks</span><span class="op" id="6087581">,</span>&nbsp;<span class="ident" id="6087583">Benchmark</span><span class="op" id="6087592">.</span><span class="ident" id="6087593">Name</span><span class="op" id="6087597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087601">if</span>&nbsp;<span class="ident" id="6087604">err</span>&nbsp;<span class="op" id="6087608">!=</span>&nbsp;<span class="ident" id="6087611">nil</span>&nbsp;<span class="op" id="6087615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087620">fmt</span><span class="op" id="6087623">.</span><span class="ident" id="6087624">Fprintf</span><span class="op" id="6087631">(</span><span class="ident" id="6087632">os</span><span class="op" id="6087634">.</span><span class="ident" id="6087635">Stderr</span><span class="op" id="6087641">,</span>&nbsp;<span class="string" id="6087643">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="6087690">,</span>&nbsp;<span class="ident" id="6087692">err</span><span class="op" id="6087695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087700">os</span><span class="op" id="6087702">.</span><span class="ident" id="6087703">Exit</span><span class="op" id="6087707">(</span><span class="num" id="6087708">1</span><span class="op" id="6087709">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087717">if</span>&nbsp;<span class="op" id="6087720">!</span><span class="ident" id="6087721">matched</span>&nbsp;<span class="op" id="6087729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087734">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087749">for</span>&nbsp;<span class="ident" id="6087753">_</span><span class="op" id="6087754">,</span>&nbsp;<span class="ident" id="6087756">procs</span>&nbsp;<span class="op" id="6087762">:=</span>&nbsp;<span class="keyword" id="6087765">range</span>&nbsp;<span class="ident" id="6087771">cpuList</span>&nbsp;<span class="op" id="6087779">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087784">runtime</span><span class="op" id="6087791">.</span><span class="ident" id="6087792">GOMAXPROCS</span><span class="op" id="6087802">(</span><span class="ident" id="6087803">procs</span><span class="op" id="6087808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087813">b</span>&nbsp;<span class="op" id="6087815">:=</span>&nbsp;<span class="op" id="6087818">&amp;</span><span class="ident" id="6087819">B</span><span class="op" id="6087820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087826">common</span><span class="op" id="6087832">:</span>&nbsp;<span class="ident" id="6087834">common</span><span class="op" id="6087840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087847">signal</span><span class="op" id="6087853">:</span>&nbsp;<span class="builtinfunc" id="6087855">make</span><span class="op" id="6087859">(</span><span class="keyword" id="6087860">chan</span>&nbsp;<span class="keyword" id="6087865">interface</span><span class="op" id="6087874">{</span><span class="op" id="6087875">}</span><span class="op" id="6087876">)</span><span class="op" id="6087877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087883">}</span><span class="op" id="6087884">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087890">benchmark</span><span class="op" id="6087899">:</span>&nbsp;<span class="ident" id="6087901">Benchmark</span><span class="op" id="6087910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6087915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087920">benchName</span>&nbsp;<span class="op" id="6087930">:=</span>&nbsp;<span class="ident" id="6087933">Benchmark</span><span class="op" id="6087942">.</span><span class="ident" id="6087943">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6087951">if</span>&nbsp;<span class="ident" id="6087954">procs</span>&nbsp;<span class="op" id="6087960">!=</span>&nbsp;<span class="num" id="6087963">1</span>&nbsp;<span class="op" id="6087965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6087971">benchName</span>&nbsp;<span class="op" id="6087981">=</span>&nbsp;<span class="ident" id="6087983">fmt</span><span class="op" id="6087986">.</span><span class="ident" id="6087987">Sprintf</span><span class="op" id="6087994">(</span><span class="string" id="6087995">&#34;%s-%d&#34;</span><span class="op" id="6088002">,</span>&nbsp;<span class="ident" id="6088004">Benchmark</span><span class="op" id="6088013">.</span><span class="ident" id="6088014">Name</span><span class="op" id="6088018">,</span>&nbsp;<span class="ident" id="6088020">procs</span><span class="op" id="6088025">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088030">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088035">fmt</span><span class="op" id="6088038">.</span><span class="ident" id="6088039">Printf</span><span class="op" id="6088045">(</span><span class="string" id="6088046">&#34;%s\t&#34;</span><span class="op" id="6088052">,</span>&nbsp;<span class="ident" id="6088054">benchName</span><span class="op" id="6088063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088068">r</span>&nbsp;<span class="op" id="6088070">:=</span>&nbsp;<span class="ident" id="6088073">b</span><span class="op" id="6088074">.</span><span class="ident" id="6088075">run</span><span class="op" id="6088078">(</span><span class="op" id="6088079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088084">if</span>&nbsp;<span class="ident" id="6088087">b</span><span class="op" id="6088088">.</span><span class="ident" id="6088089">failed</span>&nbsp;<span class="op" id="6088096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088102">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088165">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088242">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088271">fmt</span><span class="op" id="6088274">.</span><span class="ident" id="6088275">Printf</span><span class="op" id="6088281">(</span><span class="string" id="6088282">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="6088300">,</span>&nbsp;<span class="ident" id="6088302">benchName</span><span class="op" id="6088311">,</span>&nbsp;<span class="ident" id="6088313">b</span><span class="op" id="6088314">.</span><span class="ident" id="6088315">output</span><span class="op" id="6088321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088327">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088339">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088344">results</span>&nbsp;<span class="op" id="6088352">:=</span>&nbsp;<span class="ident" id="6088355">r</span><span class="op" id="6088356">.</span><span class="ident" id="6088357">String</span><span class="op" id="6088363">(</span><span class="op" id="6088364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088369">if</span>&nbsp;<span class="op" id="6088372">*</span><span class="ident" id="6088373">benchmarkMemory</span>&nbsp;<span class="op" id="6088389">||</span>&nbsp;<span class="ident" id="6088392">b</span><span class="op" id="6088393">.</span><span class="ident" id="6088394">showAllocResult</span>&nbsp;<span class="op" id="6088410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088416">results</span>&nbsp;<span class="op" id="6088424">+=</span>&nbsp;<span class="string" id="6088427">&#34;\t&#34;</span>&nbsp;<span class="op" id="6088432">+</span>&nbsp;<span class="ident" id="6088434">r</span><span class="op" id="6088435">.</span><span class="ident" id="6088436">MemString</span><span class="op" id="6088445">(</span><span class="op" id="6088446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088456">fmt</span><span class="op" id="6088459">.</span><span class="ident" id="6088460">Println</span><span class="op" id="6088467">(</span><span class="ident" id="6088468">results</span><span class="op" id="6088475">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088480">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088560">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088633">if</span>&nbsp;<span class="builtinfunc" id="6088636">len</span><span class="op" id="6088639">(</span><span class="ident" id="6088640">b</span><span class="op" id="6088641">.</span><span class="ident" id="6088642">output</span><span class="op" id="6088648">)</span>&nbsp;<span class="op" id="6088650">&gt;</span>&nbsp;<span class="num" id="6088652">0</span>&nbsp;<span class="op" id="6088654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088660">b</span><span class="op" id="6088661">.</span><span class="ident" id="6088662">trimOutput</span><span class="op" id="6088672">(</span><span class="op" id="6088673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088679">fmt</span><span class="op" id="6088682">.</span><span class="ident" id="6088683">Printf</span><span class="op" id="6088689">(</span><span class="string" id="6088690">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="6088709">,</span>&nbsp;<span class="ident" id="6088711">benchName</span><span class="op" id="6088720">,</span>&nbsp;<span class="ident" id="6088722">b</span><span class="op" id="6088723">.</span><span class="ident" id="6088724">output</span><span class="op" id="6088730">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6088740">if</span>&nbsp;<span class="ident" id="6088743">p</span>&nbsp;<span class="op" id="6088745">:=</span>&nbsp;<span class="ident" id="6088748">runtime</span><span class="op" id="6088755">.</span><span class="ident" id="6088756">GOMAXPROCS</span><span class="op" id="6088766">(</span><span class="op" id="6088767">-</span><span class="num" id="6088768">1</span><span class="op" id="6088769">)</span><span class="op" id="6088770">;</span>&nbsp;<span class="ident" id="6088772">p</span>&nbsp;<span class="op" id="6088774">!=</span>&nbsp;<span class="ident" id="6088777">procs</span>&nbsp;<span class="op" id="6088783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6088789">fmt</span><span class="op" id="6088792">.</span><span class="ident" id="6088793">Fprintf</span><span class="op" id="6088800">(</span><span class="ident" id="6088801">os</span><span class="op" id="6088803">.</span><span class="ident" id="6088804">Stderr</span><span class="op" id="6088810">,</span>&nbsp;<span class="string" id="6088812">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="6088853">,</span>&nbsp;<span class="ident" id="6088855">benchName</span><span class="op" id="6088864">,</span>&nbsp;<span class="ident" id="6088866">p</span><span class="op" id="6088867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088876">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6088879">}</span><br>
<span class="lineno"></span><span class="op" id="6088881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6088884">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="6088960">func</span>&nbsp;<span class="op" id="6088965">(</span><span class="ident" id="6088966">b</span>&nbsp;<span class="op" id="6088968">*</span><span class="ident" id="6088969">B</span><span class="op" id="6088970">)</span>&nbsp;<span class="ident" id="6088972">trimOutput</span><span class="op" id="6088982">(</span><span class="op" id="6088983">)</span>&nbsp;<span class="op" id="6088985">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6088988">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089060">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6089140">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089224">const</span>&nbsp;<span class="ident" id="6089230">maxNewlines</span>&nbsp;<span class="op" id="6089242">=</span>&nbsp;<span class="num" id="6089244">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089248">for</span>&nbsp;<span class="ident" id="6089252">nlCount</span><span class="op" id="6089259">,</span>&nbsp;<span class="ident" id="6089261">j</span>&nbsp;<span class="op" id="6089263">:=</span>&nbsp;<span class="num" id="6089266">0</span><span class="op" id="6089267">,</span>&nbsp;<span class="num" id="6089269">0</span><span class="op" id="6089270">;</span>&nbsp;<span class="ident" id="6089272">j</span>&nbsp;<span class="op" id="6089274">&lt;</span>&nbsp;<span class="builtinfunc" id="6089276">len</span><span class="op" id="6089279">(</span><span class="ident" id="6089280">b</span><span class="op" id="6089281">.</span><span class="ident" id="6089282">output</span><span class="op" id="6089288">)</span><span class="op" id="6089289">;</span>&nbsp;<span class="ident" id="6089291">j</span><span class="op" id="6089292">++</span>&nbsp;<span class="op" id="6089295">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089299">if</span>&nbsp;<span class="ident" id="6089302">b</span><span class="op" id="6089303">.</span><span class="ident" id="6089304">output</span><span class="op" id="6089310">[</span><span class="ident" id="6089311">j</span><span class="op" id="6089312">]</span>&nbsp;<span class="op" id="6089314">==</span>&nbsp;<span class="string" id="6089317">&#39;\n&#39;</span>&nbsp;<span class="op" id="6089322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089327">nlCount</span><span class="op" id="6089334">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089340">if</span>&nbsp;<span class="ident" id="6089343">nlCount</span>&nbsp;<span class="op" id="6089351">&gt;=</span>&nbsp;<span class="ident" id="6089354">maxNewlines</span>&nbsp;<span class="op" id="6089366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089372">b</span><span class="op" id="6089373">.</span><span class="ident" id="6089374">output</span>&nbsp;<span class="op" id="6089381">=</span>&nbsp;<span class="builtinfunc" id="6089383">append</span><span class="op" id="6089389">(</span><span class="ident" id="6089390">b</span><span class="op" id="6089391">.</span><span class="ident" id="6089392">output</span><span class="op" id="6089398">[</span><span class="op" id="6089399">:</span><span class="ident" id="6089400">j</span><span class="op" id="6089401">]</span><span class="op" id="6089402">,</span>&nbsp;<span class="string" id="6089404">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="6089434">...</span><span class="op" id="6089437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089443">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089452">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6089459">}</span><br>
<span class="lineno"></span><span class="op" id="6089461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="6089464">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="6089528">type</span>&nbsp;<span class="ident" id="6089533">PB</span>&nbsp;<span class="keyword" id="6089536">struct</span>&nbsp;<span class="op" id="6089543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089546">globalN</span>&nbsp;<span class="op" id="6089554">*</span><span class="ident" id="6089555">uint64</span>&nbsp;<span class="comment" id="6089562">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089621">grain</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6089629">uint64</span>&nbsp;&nbsp;<span class="comment" id="6089637">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089691">cache</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6089699">uint64</span>&nbsp;&nbsp;<span class="comment" id="6089707">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089746">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6089754">uint64</span>&nbsp;&nbsp;<span class="comment" id="6089762">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="6089809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6089812">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="6089874">func</span>&nbsp;<span class="op" id="6089879">(</span><span class="ident" id="6089880">pb</span>&nbsp;<span class="op" id="6089883">*</span><span class="ident" id="6089884">PB</span><span class="op" id="6089886">)</span>&nbsp;<span class="ident" id="6089888">Next</span><span class="op" id="6089892">(</span><span class="op" id="6089893">)</span>&nbsp;<span class="builtintype" id="6089895">bool</span>&nbsp;<span class="op" id="6089900">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089903">if</span>&nbsp;<span class="ident" id="6089906">pb</span><span class="op" id="6089908">.</span><span class="ident" id="6089909">cache</span>&nbsp;<span class="op" id="6089915">==</span>&nbsp;<span class="num" id="6089918">0</span>&nbsp;<span class="op" id="6089920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089924">n</span>&nbsp;<span class="op" id="6089926">:=</span>&nbsp;<span class="ident" id="6089929">atomic</span><span class="op" id="6089935">.</span><span class="ident" id="6089936">AddUint64</span><span class="op" id="6089945">(</span><span class="ident" id="6089946">pb</span><span class="op" id="6089948">.</span><span class="ident" id="6089949">globalN</span><span class="op" id="6089956">,</span>&nbsp;<span class="ident" id="6089958">pb</span><span class="op" id="6089960">.</span><span class="ident" id="6089961">grain</span><span class="op" id="6089966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6089970">if</span>&nbsp;<span class="ident" id="6089973">n</span>&nbsp;<span class="op" id="6089975">&lt;=</span>&nbsp;<span class="ident" id="6089978">pb</span><span class="op" id="6089980">.</span><span class="ident" id="6089981">bN</span>&nbsp;<span class="op" id="6089984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6089989">pb</span><span class="op" id="6089991">.</span><span class="ident" id="6089992">cache</span>&nbsp;<span class="op" id="6089998">=</span>&nbsp;<span class="ident" id="6090000">pb</span><span class="op" id="6090002">.</span><span class="ident" id="6090003">grain</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090011">}</span>&nbsp;<span class="keyword" id="6090013">else</span>&nbsp;<span class="keyword" id="6090018">if</span>&nbsp;<span class="ident" id="6090021">n</span>&nbsp;<span class="op" id="6090023">&lt;</span>&nbsp;<span class="ident" id="6090025">pb</span><span class="op" id="6090027">.</span><span class="ident" id="6090028">bN</span><span class="op" id="6090030">+</span><span class="ident" id="6090031">pb</span><span class="op" id="6090033">.</span><span class="ident" id="6090034">grain</span>&nbsp;<span class="op" id="6090040">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090045">pb</span><span class="op" id="6090047">.</span><span class="ident" id="6090048">cache</span>&nbsp;<span class="op" id="6090054">=</span>&nbsp;<span class="ident" id="6090056">pb</span><span class="op" id="6090058">.</span><span class="ident" id="6090059">bN</span>&nbsp;<span class="op" id="6090062">+</span>&nbsp;<span class="ident" id="6090064">pb</span><span class="op" id="6090066">.</span><span class="ident" id="6090067">grain</span>&nbsp;<span class="op" id="6090073">-</span>&nbsp;<span class="ident" id="6090075">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090079">}</span>&nbsp;<span class="keyword" id="6090081">else</span>&nbsp;<span class="op" id="6090086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090091">return</span>&nbsp;<span class="builtintype" id="6090098">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090106">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6090109">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090112">pb</span><span class="op" id="6090114">.</span><span class="ident" id="6090115">cache</span><span class="op" id="6090120">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090124">return</span>&nbsp;<span class="builtintype" id="6090131">true</span><br>
<span class="lineno"></span><span class="op" id="6090136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6090139">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="6090184">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="6090261">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6090341">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="6090410">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="6090469">//</span><br>
<span class="lineno">385</span><span class="comment" id="6090472">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6090545">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6090616">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="6090689">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="6090725">func</span>&nbsp;<span class="op" id="6090730">(</span><span class="ident" id="6090731">b</span>&nbsp;<span class="op" id="6090733">*</span><span class="ident" id="6090734">B</span><span class="op" id="6090735">)</span>&nbsp;<span class="ident" id="6090737">RunParallel</span><span class="op" id="6090748">(</span><span class="ident" id="6090749">body</span>&nbsp;<span class="keyword" id="6090754">func</span><span class="op" id="6090758">(</span><span class="op" id="6090759">*</span><span class="ident" id="6090760">PB</span><span class="op" id="6090762">)</span><span class="op" id="6090763">)</span>&nbsp;<span class="op" id="6090765">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090768">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090836">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6090905">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6090933">grain</span>&nbsp;<span class="op" id="6090939">:=</span>&nbsp;<span class="ident" id="6090942">uint64</span><span class="op" id="6090948">(</span><span class="num" id="6090949">0</span><span class="op" id="6090950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6090953">if</span>&nbsp;<span class="ident" id="6090956">b</span><span class="op" id="6090957">.</span><span class="ident" id="6090958">previousN</span>&nbsp;<span class="op" id="6090968">&gt;</span>&nbsp;<span class="num" id="6090970">0</span>&nbsp;<span class="op" id="6090972">&amp;&amp;</span>&nbsp;<span class="ident" id="6090975">b</span><span class="op" id="6090976">.</span><span class="ident" id="6090977">previousDuration</span>&nbsp;<span class="op" id="6090994">&gt;</span>&nbsp;<span class="num" id="6090996">0</span>&nbsp;<span class="op" id="6090998">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091002">grain</span>&nbsp;<span class="op" id="6091008">=</span>&nbsp;<span class="num" id="6091010">1e5</span>&nbsp;<span class="op" id="6091014">*</span>&nbsp;<span class="ident" id="6091016">uint64</span><span class="op" id="6091022">(</span><span class="ident" id="6091023">b</span><span class="op" id="6091024">.</span><span class="ident" id="6091025">previousN</span><span class="op" id="6091034">)</span>&nbsp;<span class="op" id="6091036">/</span>&nbsp;<span class="ident" id="6091038">uint64</span><span class="op" id="6091044">(</span><span class="ident" id="6091045">b</span><span class="op" id="6091046">.</span><span class="ident" id="6091047">previousDuration</span><span class="op" id="6091063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091069">if</span>&nbsp;<span class="ident" id="6091072">grain</span>&nbsp;<span class="op" id="6091078">&lt;</span>&nbsp;<span class="num" id="6091080">1</span>&nbsp;<span class="op" id="6091082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091086">grain</span>&nbsp;<span class="op" id="6091092">=</span>&nbsp;<span class="num" id="6091094">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091097">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091100">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6091170">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091225">if</span>&nbsp;<span class="ident" id="6091228">grain</span>&nbsp;<span class="op" id="6091234">&gt;</span>&nbsp;<span class="num" id="6091236">1e4</span>&nbsp;<span class="op" id="6091240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091244">grain</span>&nbsp;<span class="op" id="6091250">=</span>&nbsp;<span class="num" id="6091252">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091257">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091261">n</span>&nbsp;<span class="op" id="6091263">:=</span>&nbsp;<span class="ident" id="6091266">uint64</span><span class="op" id="6091272">(</span><span class="num" id="6091273">0</span><span class="op" id="6091274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091277">numProcs</span>&nbsp;<span class="op" id="6091286">:=</span>&nbsp;<span class="ident" id="6091289">b</span><span class="op" id="6091290">.</span><span class="ident" id="6091291">parallelism</span>&nbsp;<span class="op" id="6091303">*</span>&nbsp;<span class="ident" id="6091305">runtime</span><span class="op" id="6091312">.</span><span class="ident" id="6091313">GOMAXPROCS</span><span class="op" id="6091323">(</span><span class="num" id="6091324">0</span><span class="op" id="6091325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091328">var</span>&nbsp;<span class="ident" id="6091332">wg</span>&nbsp;<span class="ident" id="6091335">sync</span><span class="op" id="6091339">.</span><span class="ident" id="6091340">WaitGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091351">wg</span><span class="op" id="6091353">.</span><span class="ident" id="6091354">Add</span><span class="op" id="6091357">(</span><span class="ident" id="6091358">numProcs</span><span class="op" id="6091366">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091369">for</span>&nbsp;<span class="ident" id="6091373">p</span>&nbsp;<span class="op" id="6091375">:=</span>&nbsp;<span class="num" id="6091378">0</span><span class="op" id="6091379">;</span>&nbsp;<span class="ident" id="6091381">p</span>&nbsp;<span class="op" id="6091383">&lt;</span>&nbsp;<span class="ident" id="6091385">numProcs</span><span class="op" id="6091393">;</span>&nbsp;<span class="ident" id="6091395">p</span><span class="op" id="6091396">++</span>&nbsp;<span class="op" id="6091399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091403">go</span>&nbsp;<span class="keyword" id="6091406">func</span><span class="op" id="6091410">(</span><span class="op" id="6091411">)</span>&nbsp;<span class="op" id="6091413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091418">defer</span>&nbsp;<span class="ident" id="6091424">wg</span><span class="op" id="6091426">.</span><span class="ident" id="6091427">Done</span><span class="op" id="6091431">(</span><span class="op" id="6091432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091437">pb</span>&nbsp;<span class="op" id="6091440">:=</span>&nbsp;<span class="op" id="6091443">&amp;</span><span class="ident" id="6091444">PB</span><span class="op" id="6091446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091452">globalN</span><span class="op" id="6091459">:</span>&nbsp;<span class="op" id="6091461">&amp;</span><span class="ident" id="6091462">n</span><span class="op" id="6091463">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091469">grain</span><span class="op" id="6091474">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6091478">grain</span><span class="op" id="6091483">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091489">bN</span><span class="op" id="6091491">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6091498">uint64</span><span class="op" id="6091504">(</span><span class="ident" id="6091505">b</span><span class="op" id="6091506">.</span><span class="ident" id="6091507">N</span><span class="op" id="6091508">)</span><span class="op" id="6091509">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091514">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091519">body</span><span class="op" id="6091523">(</span><span class="ident" id="6091524">pb</span><span class="op" id="6091526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091530">}</span><span class="op" id="6091531">(</span><span class="op" id="6091532">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091535">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091538">wg</span><span class="op" id="6091540">.</span><span class="ident" id="6091541">Wait</span><span class="op" id="6091545">(</span><span class="op" id="6091546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091549">if</span>&nbsp;<span class="ident" id="6091552">n</span>&nbsp;<span class="op" id="6091554">&lt;=</span>&nbsp;<span class="ident" id="6091557">uint64</span><span class="op" id="6091563">(</span><span class="ident" id="6091564">b</span><span class="op" id="6091565">.</span><span class="ident" id="6091566">N</span><span class="op" id="6091567">)</span>&nbsp;<span class="op" id="6091569">&amp;&amp;</span>&nbsp;<span class="op" id="6091572">!</span><span class="ident" id="6091573">b</span><span class="op" id="6091574">.</span><span class="ident" id="6091575">Failed</span><span class="op" id="6091581">(</span><span class="op" id="6091582">)</span>&nbsp;<span class="op" id="6091584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091588">b</span><span class="op" id="6091589">.</span><span class="ident" id="6091590">Fatal</span><span class="op" id="6091595">(</span><span class="string" id="6091596">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="6091649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091652">}</span><br>
<span class="lineno">425</span><span class="op" id="6091654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6091657">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="6091742">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="6091819">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="6091874">func</span>&nbsp;<span class="op" id="6091879">(</span><span class="ident" id="6091880">b</span>&nbsp;<span class="op" id="6091882">*</span><span class="ident" id="6091883">B</span><span class="op" id="6091884">)</span>&nbsp;<span class="ident" id="6091886">SetParallelism</span><span class="op" id="6091900">(</span><span class="ident" id="6091901">p</span>&nbsp;<span class="builtintype" id="6091903">int</span><span class="op" id="6091906">)</span>&nbsp;<span class="op" id="6091908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6091911">if</span>&nbsp;<span class="ident" id="6091914">p</span>&nbsp;<span class="op" id="6091916">&gt;=</span>&nbsp;<span class="num" id="6091919">1</span>&nbsp;<span class="op" id="6091921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6091925">b</span><span class="op" id="6091926">.</span><span class="ident" id="6091927">parallelism</span>&nbsp;<span class="op" id="6091939">=</span>&nbsp;<span class="ident" id="6091941">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6091944">}</span><br>
<span class="lineno"></span><span class="op" id="6091946">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="6091949">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="6092012">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6092072">func</span>&nbsp;<span class="ident" id="6092077">Benchmark</span><span class="op" id="6092086">(</span><span class="ident" id="6092087">f</span>&nbsp;<span class="keyword" id="6092089">func</span><span class="op" id="6092093">(</span><span class="ident" id="6092094">b</span>&nbsp;<span class="op" id="6092096">*</span><span class="ident" id="6092097">B</span><span class="op" id="6092098">)</span><span class="op" id="6092099">)</span>&nbsp;<span class="ident" id="6092101">BenchmarkResult</span>&nbsp;<span class="op" id="6092117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092120">b</span>&nbsp;<span class="op" id="6092122">:=</span>&nbsp;<span class="op" id="6092125">&amp;</span><span class="ident" id="6092126">B</span><span class="op" id="6092127">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092131">common</span><span class="op" id="6092137">:</span>&nbsp;<span class="ident" id="6092139">common</span><span class="op" id="6092145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092150">signal</span><span class="op" id="6092156">:</span>&nbsp;<span class="builtinfunc" id="6092158">make</span><span class="op" id="6092162">(</span><span class="keyword" id="6092163">chan</span>&nbsp;<span class="keyword" id="6092168">interface</span><span class="op" id="6092177">{</span><span class="op" id="6092178">}</span><span class="op" id="6092179">)</span><span class="op" id="6092180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092184">}</span><span class="op" id="6092185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6092189">benchmark</span><span class="op" id="6092198">:</span>&nbsp;<span class="ident" id="6092200">InternalBenchmark</span><span class="op" id="6092217">{</span><span class="string" id="6092218">&#34;&#34;</span><span class="op" id="6092220">,</span>&nbsp;<span class="ident" id="6092222">f</span><span class="op" id="6092223">}</span><span class="op" id="6092224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6092227">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6092230">return</span>&nbsp;<span class="ident" id="6092237">b</span><span class="op" id="6092238">.</span><span class="ident" id="6092239">run</span><span class="op" id="6092242">(</span><span class="op" id="6092243">)</span><br>
<span class="lineno"></span><span class="op" id="6092245">}</span>
</div>
</body>
</html>
