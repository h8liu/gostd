<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>index/suffixarray</h2>
<ul>
<li><a href="/gostd/index/suffixarray/qsufsort.go.html" class="current">qsufsort.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray.go.html">suffixarray.go</a></li>
<li><a href="/gostd/index/suffixarray/suffixarray_test.go.html">suffixarray_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6045165">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6045220">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6045274">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6045325">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6045379">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="6045427">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="6045479">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6045530">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="6045603">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6045675">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="6045752">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6045826">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="6045904">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6045979">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="6046056">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6046117">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="6046188">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="6046265">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6046340">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="6046419">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6046495">package</span>&nbsp;<span class="ident" id="6046503">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6046516">import</span>&nbsp;<span class="string" id="6046523">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6046531">func</span>&nbsp;<span class="ident" id="6046536">qsufsort</span><span class="op" id="6046544">(</span><span class="ident" id="6046545">data</span>&nbsp;<span class="op" id="6046550">[</span><span class="op" id="6046551">]</span><span class="builtintype" id="6046552">byte</span><span class="op" id="6046556">)</span>&nbsp;<span class="op" id="6046558">[</span><span class="op" id="6046559">]</span><span class="builtintype" id="6046560">int</span>&nbsp;<span class="op" id="6046564">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046567">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046611">sa</span>&nbsp;<span class="op" id="6046614">:=</span>&nbsp;<span class="ident" id="6046617">sortedByFirstByte</span><span class="op" id="6046634">(</span><span class="ident" id="6046635">data</span><span class="op" id="6046639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046642">if</span>&nbsp;<span class="builtinfunc" id="6046645">len</span><span class="op" id="6046648">(</span><span class="ident" id="6046649">sa</span><span class="op" id="6046651">)</span>&nbsp;<span class="op" id="6046653">&lt;</span>&nbsp;<span class="num" id="6046655">2</span>&nbsp;<span class="op" id="6046657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046661">return</span>&nbsp;<span class="ident" id="6046668">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6046672">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046675">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046713">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046789">inv</span>&nbsp;<span class="op" id="6046793">:=</span>&nbsp;<span class="ident" id="6046796">initGroups</span><span class="op" id="6046806">(</span><span class="ident" id="6046807">sa</span><span class="op" id="6046809">,</span>&nbsp;<span class="ident" id="6046811">data</span><span class="op" id="6046815">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046819">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6046850">sufSortable</span>&nbsp;<span class="op" id="6046862">:=</span>&nbsp;<span class="op" id="6046865">&amp;</span><span class="ident" id="6046866">suffixSortable</span><span class="op" id="6046880">{</span><span class="ident" id="6046881">sa</span><span class="op" id="6046883">:</span>&nbsp;<span class="ident" id="6046885">sa</span><span class="op" id="6046887">,</span>&nbsp;<span class="ident" id="6046889">inv</span><span class="op" id="6046892">:</span>&nbsp;<span class="ident" id="6046894">inv</span><span class="op" id="6046897">,</span>&nbsp;<span class="ident" id="6046899">h</span><span class="op" id="6046900">:</span>&nbsp;<span class="num" id="6046902">1</span><span class="op" id="6046903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6046907">for</span>&nbsp;<span class="ident" id="6046911">sa</span><span class="op" id="6046913">[</span><span class="num" id="6046914">0</span><span class="op" id="6046915">]</span>&nbsp;<span class="op" id="6046917">&gt;</span>&nbsp;<span class="op" id="6046919">-</span><span class="builtinfunc" id="6046920">len</span><span class="op" id="6046923">(</span><span class="ident" id="6046924">sa</span><span class="op" id="6046926">)</span>&nbsp;<span class="op" id="6046928">{</span>&nbsp;<span class="comment" id="6046930">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6046979">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047034">pi</span>&nbsp;<span class="op" id="6047037">:=</span>&nbsp;<span class="num" id="6047040">0</span>&nbsp;<span class="comment" id="6047042">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047083">sl</span>&nbsp;<span class="op" id="6047086">:=</span>&nbsp;<span class="num" id="6047089">0</span>&nbsp;<span class="comment" id="6047091">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047134">for</span>&nbsp;<span class="ident" id="6047138">pi</span>&nbsp;<span class="op" id="6047141">&lt;</span>&nbsp;<span class="builtinfunc" id="6047143">len</span><span class="op" id="6047146">(</span><span class="ident" id="6047147">sa</span><span class="op" id="6047149">)</span>&nbsp;<span class="op" id="6047151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047156">if</span>&nbsp;<span class="ident" id="6047159">s</span>&nbsp;<span class="op" id="6047161">:=</span>&nbsp;<span class="ident" id="6047164">sa</span><span class="op" id="6047166">[</span><span class="ident" id="6047167">pi</span><span class="op" id="6047169">]</span><span class="op" id="6047170">;</span>&nbsp;<span class="ident" id="6047172">s</span>&nbsp;<span class="op" id="6047174">&lt;</span>&nbsp;<span class="num" id="6047176">0</span>&nbsp;<span class="op" id="6047178">{</span>&nbsp;<span class="comment" id="6047180">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047213">pi</span>&nbsp;<span class="op" id="6047216">-=</span>&nbsp;<span class="ident" id="6047219">s</span>&nbsp;<span class="comment" id="6047221">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047251">sl</span>&nbsp;<span class="op" id="6047254">+=</span>&nbsp;<span class="ident" id="6047257">s</span>&nbsp;<span class="comment" id="6047259">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047290">}</span>&nbsp;<span class="keyword" id="6047292">else</span>&nbsp;<span class="op" id="6047297">{</span>&nbsp;<span class="comment" id="6047299">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047334">if</span>&nbsp;<span class="ident" id="6047337">sl</span>&nbsp;<span class="op" id="6047340">!=</span>&nbsp;<span class="num" id="6047343">0</span>&nbsp;<span class="op" id="6047345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047352">sa</span><span class="op" id="6047354">[</span><span class="ident" id="6047355">pi</span><span class="op" id="6047357">+</span><span class="ident" id="6047358">sl</span><span class="op" id="6047360">]</span>&nbsp;<span class="op" id="6047362">=</span>&nbsp;<span class="ident" id="6047364">sl</span>&nbsp;<span class="comment" id="6047367">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047407">sl</span>&nbsp;<span class="op" id="6047410">=</span>&nbsp;<span class="num" id="6047412">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047418">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047424">pk</span>&nbsp;<span class="op" id="6047427">:=</span>&nbsp;<span class="ident" id="6047430">inv</span><span class="op" id="6047433">[</span><span class="ident" id="6047434">s</span><span class="op" id="6047435">]</span>&nbsp;<span class="op" id="6047437">+</span>&nbsp;<span class="num" id="6047439">1</span>&nbsp;<span class="comment" id="6047441">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047488">sufSortable</span><span class="op" id="6047499">.</span><span class="ident" id="6047500">sa</span>&nbsp;<span class="op" id="6047503">=</span>&nbsp;<span class="ident" id="6047505">sa</span><span class="op" id="6047507">[</span><span class="ident" id="6047508">pi</span><span class="op" id="6047510">:</span><span class="ident" id="6047511">pk</span><span class="op" id="6047513">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047519">sort</span><span class="op" id="6047523">.</span><span class="ident" id="6047524">Sort</span><span class="op" id="6047528">(</span><span class="ident" id="6047529">sufSortable</span><span class="op" id="6047540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047546">sufSortable</span><span class="op" id="6047557">.</span><span class="ident" id="6047558">updateGroups</span><span class="op" id="6047570">(</span><span class="ident" id="6047571">pi</span><span class="op" id="6047573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047579">pi</span>&nbsp;<span class="op" id="6047582">=</span>&nbsp;<span class="ident" id="6047584">pk</span>&nbsp;<span class="comment" id="6047587">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047612">if</span>&nbsp;<span class="ident" id="6047615">sl</span>&nbsp;<span class="op" id="6047618">!=</span>&nbsp;<span class="num" id="6047621">0</span>&nbsp;<span class="op" id="6047623">{</span>&nbsp;<span class="comment" id="6047625">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047669">sa</span><span class="op" id="6047671">[</span><span class="ident" id="6047672">pi</span><span class="op" id="6047674">+</span><span class="ident" id="6047675">sl</span><span class="op" id="6047677">]</span>&nbsp;<span class="op" id="6047679">=</span>&nbsp;<span class="ident" id="6047681">sl</span>&nbsp;<span class="comment" id="6047684">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047724">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047729">sufSortable</span><span class="op" id="6047740">.</span><span class="ident" id="6047741">h</span>&nbsp;<span class="op" id="6047743">*=</span>&nbsp;<span class="num" id="6047746">2</span>&nbsp;<span class="comment" id="6047748">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047776">for</span>&nbsp;<span class="ident" id="6047780">i</span>&nbsp;<span class="op" id="6047782">:=</span>&nbsp;<span class="keyword" id="6047785">range</span>&nbsp;<span class="ident" id="6047791">sa</span>&nbsp;<span class="op" id="6047794">{</span>&nbsp;<span class="comment" id="6047796">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047839">sa</span><span class="op" id="6047841">[</span><span class="ident" id="6047842">inv</span><span class="op" id="6047845">[</span><span class="ident" id="6047846">i</span><span class="op" id="6047847">]</span><span class="op" id="6047848">]</span>&nbsp;<span class="op" id="6047850">=</span>&nbsp;<span class="ident" id="6047852">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047858">return</span>&nbsp;<span class="ident" id="6047865">sa</span><br>
<span class="lineno"></span><span class="op" id="6047868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6047871">func</span>&nbsp;<span class="ident" id="6047876">sortedByFirstByte</span><span class="op" id="6047893">(</span><span class="ident" id="6047894">data</span>&nbsp;<span class="op" id="6047899">[</span><span class="op" id="6047900">]</span><span class="builtintype" id="6047901">byte</span><span class="op" id="6047905">)</span>&nbsp;<span class="op" id="6047907">[</span><span class="op" id="6047908">]</span><span class="builtintype" id="6047909">int</span>&nbsp;<span class="op" id="6047913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6047916">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047938">var</span>&nbsp;<span class="ident" id="6047942">count</span>&nbsp;<span class="op" id="6047948">[</span><span class="num" id="6047949">256</span><span class="op" id="6047952">]</span><span class="builtintype" id="6047953">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6047958">for</span>&nbsp;<span class="ident" id="6047962">_</span><span class="op" id="6047963">,</span>&nbsp;<span class="ident" id="6047965">b</span>&nbsp;<span class="op" id="6047967">:=</span>&nbsp;<span class="keyword" id="6047970">range</span>&nbsp;<span class="ident" id="6047976">data</span>&nbsp;<span class="op" id="6047981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6047985">count</span><span class="op" id="6047990">[</span><span class="ident" id="6047991">b</span><span class="op" id="6047992">]</span><span class="op" id="6047993">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6047997">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048000">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048071">sum</span>&nbsp;<span class="op" id="6048075">:=</span>&nbsp;<span class="num" id="6048078">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048081">for</span>&nbsp;<span class="ident" id="6048085">b</span>&nbsp;<span class="op" id="6048087">:=</span>&nbsp;<span class="keyword" id="6048090">range</span>&nbsp;<span class="ident" id="6048096">count</span>&nbsp;<span class="op" id="6048102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048106">count</span><span class="op" id="6048111">[</span><span class="ident" id="6048112">b</span><span class="op" id="6048113">]</span><span class="op" id="6048114">,</span>&nbsp;<span class="ident" id="6048116">sum</span>&nbsp;<span class="op" id="6048120">=</span>&nbsp;<span class="ident" id="6048122">sum</span><span class="op" id="6048125">,</span>&nbsp;<span class="ident" id="6048127">count</span><span class="op" id="6048132">[</span><span class="ident" id="6048133">b</span><span class="op" id="6048134">]</span><span class="op" id="6048135">+</span><span class="ident" id="6048136">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048144">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048213">sa</span>&nbsp;<span class="op" id="6048216">:=</span>&nbsp;<span class="builtinfunc" id="6048219">make</span><span class="op" id="6048223">(</span><span class="op" id="6048224">[</span><span class="op" id="6048225">]</span><span class="builtintype" id="6048226">int</span><span class="op" id="6048229">,</span>&nbsp;<span class="builtinfunc" id="6048231">len</span><span class="op" id="6048234">(</span><span class="ident" id="6048235">data</span><span class="op" id="6048239">)</span><span class="op" id="6048240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048243">for</span>&nbsp;<span class="ident" id="6048247">i</span><span class="op" id="6048248">,</span>&nbsp;<span class="ident" id="6048250">b</span>&nbsp;<span class="op" id="6048252">:=</span>&nbsp;<span class="keyword" id="6048255">range</span>&nbsp;<span class="ident" id="6048261">data</span>&nbsp;<span class="op" id="6048266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048270">sa</span><span class="op" id="6048272">[</span><span class="ident" id="6048273">count</span><span class="op" id="6048278">[</span><span class="ident" id="6048279">b</span><span class="op" id="6048280">]</span><span class="op" id="6048281">]</span>&nbsp;<span class="op" id="6048283">=</span>&nbsp;<span class="ident" id="6048285">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048289">count</span><span class="op" id="6048294">[</span><span class="ident" id="6048295">b</span><span class="op" id="6048296">]</span><span class="op" id="6048297">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048304">return</span>&nbsp;<span class="ident" id="6048311">sa</span><br>
<span class="lineno"></span><span class="op" id="6048314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6048317">func</span>&nbsp;<span class="ident" id="6048322">initGroups</span><span class="op" id="6048332">(</span><span class="ident" id="6048333">sa</span>&nbsp;<span class="op" id="6048336">[</span><span class="op" id="6048337">]</span><span class="builtintype" id="6048338">int</span><span class="op" id="6048341">,</span>&nbsp;<span class="ident" id="6048343">data</span>&nbsp;<span class="op" id="6048348">[</span><span class="op" id="6048349">]</span><span class="builtintype" id="6048350">byte</span><span class="op" id="6048354">)</span>&nbsp;<span class="op" id="6048356">[</span><span class="op" id="6048357">]</span><span class="builtintype" id="6048358">int</span>&nbsp;<span class="op" id="6048362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048365">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048432">inv</span>&nbsp;<span class="op" id="6048436">:=</span>&nbsp;<span class="builtinfunc" id="6048439">make</span><span class="op" id="6048443">(</span><span class="op" id="6048444">[</span><span class="op" id="6048445">]</span><span class="builtintype" id="6048446">int</span><span class="op" id="6048449">,</span>&nbsp;<span class="builtinfunc" id="6048451">len</span><span class="op" id="6048454">(</span><span class="ident" id="6048455">data</span><span class="op" id="6048459">)</span><span class="op" id="6048460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048463">prevGroup</span>&nbsp;<span class="op" id="6048473">:=</span>&nbsp;<span class="builtinfunc" id="6048476">len</span><span class="op" id="6048479">(</span><span class="ident" id="6048480">sa</span><span class="op" id="6048482">)</span>&nbsp;<span class="op" id="6048484">-</span>&nbsp;<span class="num" id="6048486">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048489">groupByte</span>&nbsp;<span class="op" id="6048499">:=</span>&nbsp;<span class="ident" id="6048502">data</span><span class="op" id="6048506">[</span><span class="ident" id="6048507">sa</span><span class="op" id="6048509">[</span><span class="ident" id="6048510">prevGroup</span><span class="op" id="6048519">]</span><span class="op" id="6048520">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048523">for</span>&nbsp;<span class="ident" id="6048527">i</span>&nbsp;<span class="op" id="6048529">:=</span>&nbsp;<span class="builtinfunc" id="6048532">len</span><span class="op" id="6048535">(</span><span class="ident" id="6048536">sa</span><span class="op" id="6048538">)</span>&nbsp;<span class="op" id="6048540">-</span>&nbsp;<span class="num" id="6048542">1</span><span class="op" id="6048543">;</span>&nbsp;<span class="ident" id="6048545">i</span>&nbsp;<span class="op" id="6048547">&gt;=</span>&nbsp;<span class="num" id="6048550">0</span><span class="op" id="6048551">;</span>&nbsp;<span class="ident" id="6048553">i</span><span class="op" id="6048554">--</span>&nbsp;<span class="op" id="6048557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048561">if</span>&nbsp;<span class="ident" id="6048564">b</span>&nbsp;<span class="op" id="6048566">:=</span>&nbsp;<span class="ident" id="6048569">data</span><span class="op" id="6048573">[</span><span class="ident" id="6048574">sa</span><span class="op" id="6048576">[</span><span class="ident" id="6048577">i</span><span class="op" id="6048578">]</span><span class="op" id="6048579">]</span><span class="op" id="6048580">;</span>&nbsp;<span class="ident" id="6048582">b</span>&nbsp;<span class="op" id="6048584">&lt;</span>&nbsp;<span class="ident" id="6048586">groupByte</span>&nbsp;<span class="op" id="6048596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048601">if</span>&nbsp;<span class="ident" id="6048604">prevGroup</span>&nbsp;<span class="op" id="6048614">==</span>&nbsp;<span class="ident" id="6048617">i</span><span class="op" id="6048618">+</span><span class="num" id="6048619">1</span>&nbsp;<span class="op" id="6048621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048627">sa</span><span class="op" id="6048629">[</span><span class="ident" id="6048630">i</span><span class="op" id="6048631">+</span><span class="num" id="6048632">1</span><span class="op" id="6048633">]</span>&nbsp;<span class="op" id="6048635">=</span>&nbsp;<span class="op" id="6048637">-</span><span class="num" id="6048638">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048643">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048648">groupByte</span>&nbsp;<span class="op" id="6048658">=</span>&nbsp;<span class="ident" id="6048660">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048665">prevGroup</span>&nbsp;<span class="op" id="6048675">=</span>&nbsp;<span class="ident" id="6048677">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048681">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048685">inv</span><span class="op" id="6048688">[</span><span class="ident" id="6048689">sa</span><span class="op" id="6048691">[</span><span class="ident" id="6048692">i</span><span class="op" id="6048693">]</span><span class="op" id="6048694">]</span>&nbsp;<span class="op" id="6048696">=</span>&nbsp;<span class="ident" id="6048698">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048710">if</span>&nbsp;<span class="ident" id="6048713">prevGroup</span>&nbsp;<span class="op" id="6048723">==</span>&nbsp;<span class="num" id="6048726">0</span>&nbsp;<span class="op" id="6048728">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048733">sa</span><span class="op" id="6048735">[</span><span class="num" id="6048736">0</span><span class="op" id="6048737">]</span>&nbsp;<span class="op" id="6048739">=</span>&nbsp;<span class="op" id="6048741">-</span><span class="num" id="6048742">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048746">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6048749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048752">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048813">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6048876">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048920">lastByte</span>&nbsp;<span class="op" id="6048929">:=</span>&nbsp;<span class="ident" id="6048932">data</span><span class="op" id="6048936">[</span><span class="builtinfunc" id="6048937">len</span><span class="op" id="6048940">(</span><span class="ident" id="6048941">data</span><span class="op" id="6048945">)</span><span class="op" id="6048946">-</span><span class="num" id="6048947">1</span><span class="op" id="6048948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6048951">s</span>&nbsp;<span class="op" id="6048953">:=</span>&nbsp;<span class="op" id="6048956">-</span><span class="num" id="6048957">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048960">for</span>&nbsp;<span class="ident" id="6048964">i</span>&nbsp;<span class="op" id="6048966">:=</span>&nbsp;<span class="keyword" id="6048969">range</span>&nbsp;<span class="ident" id="6048975">sa</span>&nbsp;<span class="op" id="6048978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6048982">if</span>&nbsp;<span class="ident" id="6048985">sa</span><span class="op" id="6048987">[</span><span class="ident" id="6048988">i</span><span class="op" id="6048989">]</span>&nbsp;<span class="op" id="6048991">&gt;=</span>&nbsp;<span class="num" id="6048994">0</span>&nbsp;<span class="op" id="6048996">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049001">if</span>&nbsp;<span class="ident" id="6049004">data</span><span class="op" id="6049008">[</span><span class="ident" id="6049009">sa</span><span class="op" id="6049011">[</span><span class="ident" id="6049012">i</span><span class="op" id="6049013">]</span><span class="op" id="6049014">]</span>&nbsp;<span class="op" id="6049016">==</span>&nbsp;<span class="ident" id="6049019">lastByte</span>&nbsp;<span class="op" id="6049028">&amp;&amp;</span>&nbsp;<span class="ident" id="6049031">s</span>&nbsp;<span class="op" id="6049033">==</span>&nbsp;<span class="op" id="6049036">-</span><span class="num" id="6049037">1</span>&nbsp;<span class="op" id="6049039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049045">s</span>&nbsp;<span class="op" id="6049047">=</span>&nbsp;<span class="ident" id="6049049">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049059">if</span>&nbsp;<span class="ident" id="6049062">sa</span><span class="op" id="6049064">[</span><span class="ident" id="6049065">i</span><span class="op" id="6049066">]</span>&nbsp;<span class="op" id="6049068">==</span>&nbsp;<span class="builtinfunc" id="6049071">len</span><span class="op" id="6049074">(</span><span class="ident" id="6049075">sa</span><span class="op" id="6049077">)</span><span class="op" id="6049078">-</span><span class="num" id="6049079">1</span>&nbsp;<span class="op" id="6049081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049087">sa</span><span class="op" id="6049089">[</span><span class="ident" id="6049090">i</span><span class="op" id="6049091">]</span><span class="op" id="6049092">,</span>&nbsp;<span class="ident" id="6049094">sa</span><span class="op" id="6049096">[</span><span class="ident" id="6049097">s</span><span class="op" id="6049098">]</span>&nbsp;<span class="op" id="6049100">=</span>&nbsp;<span class="ident" id="6049102">sa</span><span class="op" id="6049104">[</span><span class="ident" id="6049105">s</span><span class="op" id="6049106">]</span><span class="op" id="6049107">,</span>&nbsp;<span class="ident" id="6049109">sa</span><span class="op" id="6049111">[</span><span class="ident" id="6049112">i</span><span class="op" id="6049113">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049119">inv</span><span class="op" id="6049122">[</span><span class="ident" id="6049123">sa</span><span class="op" id="6049125">[</span><span class="ident" id="6049126">s</span><span class="op" id="6049127">]</span><span class="op" id="6049128">]</span>&nbsp;<span class="op" id="6049130">=</span>&nbsp;<span class="ident" id="6049132">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049138">sa</span><span class="op" id="6049140">[</span><span class="ident" id="6049141">s</span><span class="op" id="6049142">]</span>&nbsp;<span class="op" id="6049144">=</span>&nbsp;<span class="op" id="6049146">-</span><span class="num" id="6049147">1</span>&nbsp;<span class="comment" id="6049149">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049192">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049201">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049205">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049211">return</span>&nbsp;<span class="ident" id="6049218">inv</span><br>
<span class="lineno"></span><span class="op" id="6049222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6049225">type</span>&nbsp;<span class="ident" id="6049230">suffixSortable</span>&nbsp;<span class="keyword" id="6049245">struct</span>&nbsp;<span class="op" id="6049252">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049255">sa</span>&nbsp;&nbsp;<span class="op" id="6049259">[</span><span class="op" id="6049260">]</span><span class="builtintype" id="6049261">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049266">inv</span>&nbsp;<span class="op" id="6049270">[</span><span class="op" id="6049271">]</span><span class="builtintype" id="6049272">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049277">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6049281">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049286">buf</span>&nbsp;<span class="op" id="6049290">[</span><span class="op" id="6049291">]</span><span class="builtintype" id="6049292">int</span>&nbsp;<span class="comment" id="6049296">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="6049320">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6049323">func</span>&nbsp;<span class="op" id="6049328">(</span><span class="ident" id="6049329">x</span>&nbsp;<span class="op" id="6049331">*</span><span class="ident" id="6049332">suffixSortable</span><span class="op" id="6049346">)</span>&nbsp;<span class="ident" id="6049348">Len</span><span class="op" id="6049351">(</span><span class="op" id="6049352">)</span>&nbsp;<span class="builtintype" id="6049354">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049368">{</span>&nbsp;<span class="keyword" id="6049370">return</span>&nbsp;<span class="builtinfunc" id="6049377">len</span><span class="op" id="6049380">(</span><span class="ident" id="6049381">x</span><span class="op" id="6049382">.</span><span class="ident" id="6049383">sa</span><span class="op" id="6049385">)</span>&nbsp;<span class="op" id="6049387">}</span><br>
<span class="lineno"></span><span class="keyword" id="6049389">func</span>&nbsp;<span class="op" id="6049394">(</span><span class="ident" id="6049395">x</span>&nbsp;<span class="op" id="6049397">*</span><span class="ident" id="6049398">suffixSortable</span><span class="op" id="6049412">)</span>&nbsp;<span class="ident" id="6049414">Less</span><span class="op" id="6049418">(</span><span class="ident" id="6049419">i</span><span class="op" id="6049420">,</span>&nbsp;<span class="ident" id="6049422">j</span>&nbsp;<span class="builtintype" id="6049424">int</span><span class="op" id="6049427">)</span>&nbsp;<span class="builtintype" id="6049429">bool</span>&nbsp;<span class="op" id="6049434">{</span>&nbsp;<span class="keyword" id="6049436">return</span>&nbsp;<span class="ident" id="6049443">x</span><span class="op" id="6049444">.</span><span class="ident" id="6049445">inv</span><span class="op" id="6049448">[</span><span class="ident" id="6049449">x</span><span class="op" id="6049450">.</span><span class="ident" id="6049451">sa</span><span class="op" id="6049453">[</span><span class="ident" id="6049454">i</span><span class="op" id="6049455">]</span><span class="op" id="6049456">+</span><span class="ident" id="6049457">x</span><span class="op" id="6049458">.</span><span class="ident" id="6049459">h</span><span class="op" id="6049460">]</span>&nbsp;<span class="op" id="6049462">&lt;</span>&nbsp;<span class="ident" id="6049464">x</span><span class="op" id="6049465">.</span><span class="ident" id="6049466">inv</span><span class="op" id="6049469">[</span><span class="ident" id="6049470">x</span><span class="op" id="6049471">.</span><span class="ident" id="6049472">sa</span><span class="op" id="6049474">[</span><span class="ident" id="6049475">j</span><span class="op" id="6049476">]</span><span class="op" id="6049477">+</span><span class="ident" id="6049478">x</span><span class="op" id="6049479">.</span><span class="ident" id="6049480">h</span><span class="op" id="6049481">]</span>&nbsp;<span class="op" id="6049483">}</span><br>
<span class="lineno"></span><span class="keyword" id="6049485">func</span>&nbsp;<span class="op" id="6049490">(</span><span class="ident" id="6049491">x</span>&nbsp;<span class="op" id="6049493">*</span><span class="ident" id="6049494">suffixSortable</span><span class="op" id="6049508">)</span>&nbsp;<span class="ident" id="6049510">Swap</span><span class="op" id="6049514">(</span><span class="ident" id="6049515">i</span><span class="op" id="6049516">,</span>&nbsp;<span class="ident" id="6049518">j</span>&nbsp;<span class="builtintype" id="6049520">int</span><span class="op" id="6049523">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049530">{</span>&nbsp;<span class="ident" id="6049532">x</span><span class="op" id="6049533">.</span><span class="ident" id="6049534">sa</span><span class="op" id="6049536">[</span><span class="ident" id="6049537">i</span><span class="op" id="6049538">]</span><span class="op" id="6049539">,</span>&nbsp;<span class="ident" id="6049541">x</span><span class="op" id="6049542">.</span><span class="ident" id="6049543">sa</span><span class="op" id="6049545">[</span><span class="ident" id="6049546">j</span><span class="op" id="6049547">]</span>&nbsp;<span class="op" id="6049549">=</span>&nbsp;<span class="ident" id="6049551">x</span><span class="op" id="6049552">.</span><span class="ident" id="6049553">sa</span><span class="op" id="6049555">[</span><span class="ident" id="6049556">j</span><span class="op" id="6049557">]</span><span class="op" id="6049558">,</span>&nbsp;<span class="ident" id="6049560">x</span><span class="op" id="6049561">.</span><span class="ident" id="6049562">sa</span><span class="op" id="6049564">[</span><span class="ident" id="6049565">i</span><span class="op" id="6049566">]</span>&nbsp;<span class="op" id="6049568">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6049571">func</span>&nbsp;<span class="op" id="6049576">(</span><span class="ident" id="6049577">x</span>&nbsp;<span class="op" id="6049579">*</span><span class="ident" id="6049580">suffixSortable</span><span class="op" id="6049594">)</span>&nbsp;<span class="ident" id="6049596">updateGroups</span><span class="op" id="6049608">(</span><span class="ident" id="6049609">offset</span>&nbsp;<span class="builtintype" id="6049616">int</span><span class="op" id="6049619">)</span>&nbsp;<span class="op" id="6049621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049624">bounds</span>&nbsp;<span class="op" id="6049631">:=</span>&nbsp;<span class="ident" id="6049634">x</span><span class="op" id="6049635">.</span><span class="ident" id="6049636">buf</span><span class="op" id="6049639">[</span><span class="num" id="6049640">0</span><span class="op" id="6049641">:</span><span class="num" id="6049642">0</span><span class="op" id="6049643">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049646">group</span>&nbsp;<span class="op" id="6049652">:=</span>&nbsp;<span class="ident" id="6049655">x</span><span class="op" id="6049656">.</span><span class="ident" id="6049657">inv</span><span class="op" id="6049660">[</span><span class="ident" id="6049661">x</span><span class="op" id="6049662">.</span><span class="ident" id="6049663">sa</span><span class="op" id="6049665">[</span><span class="num" id="6049666">0</span><span class="op" id="6049667">]</span><span class="op" id="6049668">+</span><span class="ident" id="6049669">x</span><span class="op" id="6049670">.</span><span class="ident" id="6049671">h</span><span class="op" id="6049672">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049675">for</span>&nbsp;<span class="ident" id="6049679">i</span>&nbsp;<span class="op" id="6049681">:=</span>&nbsp;<span class="num" id="6049684">1</span><span class="op" id="6049685">;</span>&nbsp;<span class="ident" id="6049687">i</span>&nbsp;<span class="op" id="6049689">&lt;</span>&nbsp;<span class="builtinfunc" id="6049691">len</span><span class="op" id="6049694">(</span><span class="ident" id="6049695">x</span><span class="op" id="6049696">.</span><span class="ident" id="6049697">sa</span><span class="op" id="6049699">)</span><span class="op" id="6049700">;</span>&nbsp;<span class="ident" id="6049702">i</span><span class="op" id="6049703">++</span>&nbsp;<span class="op" id="6049706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049710">if</span>&nbsp;<span class="ident" id="6049713">g</span>&nbsp;<span class="op" id="6049715">:=</span>&nbsp;<span class="ident" id="6049718">x</span><span class="op" id="6049719">.</span><span class="ident" id="6049720">inv</span><span class="op" id="6049723">[</span><span class="ident" id="6049724">x</span><span class="op" id="6049725">.</span><span class="ident" id="6049726">sa</span><span class="op" id="6049728">[</span><span class="ident" id="6049729">i</span><span class="op" id="6049730">]</span><span class="op" id="6049731">+</span><span class="ident" id="6049732">x</span><span class="op" id="6049733">.</span><span class="ident" id="6049734">h</span><span class="op" id="6049735">]</span><span class="op" id="6049736">;</span>&nbsp;<span class="ident" id="6049738">g</span>&nbsp;<span class="op" id="6049740">&gt;</span>&nbsp;<span class="ident" id="6049742">group</span>&nbsp;<span class="op" id="6049748">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049753">bounds</span>&nbsp;<span class="op" id="6049760">=</span>&nbsp;<span class="builtinfunc" id="6049762">append</span><span class="op" id="6049768">(</span><span class="ident" id="6049769">bounds</span><span class="op" id="6049775">,</span>&nbsp;<span class="ident" id="6049777">i</span><span class="op" id="6049778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049783">group</span>&nbsp;<span class="op" id="6049789">=</span>&nbsp;<span class="ident" id="6049791">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6049798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049801">bounds</span>&nbsp;<span class="op" id="6049808">=</span>&nbsp;<span class="builtinfunc" id="6049810">append</span><span class="op" id="6049816">(</span><span class="ident" id="6049817">bounds</span><span class="op" id="6049823">,</span>&nbsp;<span class="builtinfunc" id="6049825">len</span><span class="op" id="6049828">(</span><span class="ident" id="6049829">x</span><span class="op" id="6049830">.</span><span class="ident" id="6049831">sa</span><span class="op" id="6049833">)</span><span class="op" id="6049834">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049837">x</span><span class="op" id="6049838">.</span><span class="ident" id="6049839">buf</span>&nbsp;<span class="op" id="6049843">=</span>&nbsp;<span class="ident" id="6049845">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6049854">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049922">prev</span>&nbsp;<span class="op" id="6049927">:=</span>&nbsp;<span class="num" id="6049930">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049933">for</span>&nbsp;<span class="ident" id="6049937">_</span><span class="op" id="6049938">,</span>&nbsp;<span class="ident" id="6049940">b</span>&nbsp;<span class="op" id="6049942">:=</span>&nbsp;<span class="keyword" id="6049945">range</span>&nbsp;<span class="ident" id="6049951">bounds</span>&nbsp;<span class="op" id="6049958">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6049962">for</span>&nbsp;<span class="ident" id="6049966">i</span>&nbsp;<span class="op" id="6049968">:=</span>&nbsp;<span class="ident" id="6049971">prev</span><span class="op" id="6049975">;</span>&nbsp;<span class="ident" id="6049977">i</span>&nbsp;<span class="op" id="6049979">&lt;</span>&nbsp;<span class="ident" id="6049981">b</span><span class="op" id="6049982">;</span>&nbsp;<span class="ident" id="6049984">i</span><span class="op" id="6049985">++</span>&nbsp;<span class="op" id="6049988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6049993">x</span><span class="op" id="6049994">.</span><span class="ident" id="6049995">inv</span><span class="op" id="6049998">[</span><span class="ident" id="6049999">x</span><span class="op" id="6050000">.</span><span class="ident" id="6050001">sa</span><span class="op" id="6050003">[</span><span class="ident" id="6050004">i</span><span class="op" id="6050005">]</span><span class="op" id="6050006">]</span>&nbsp;<span class="op" id="6050008">=</span>&nbsp;<span class="ident" id="6050010">offset</span>&nbsp;<span class="op" id="6050017">+</span>&nbsp;<span class="ident" id="6050019">b</span>&nbsp;<span class="op" id="6050021">-</span>&nbsp;<span class="num" id="6050023">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6050031">if</span>&nbsp;<span class="ident" id="6050034">b</span><span class="op" id="6050035">-</span><span class="ident" id="6050036">prev</span>&nbsp;<span class="op" id="6050041">==</span>&nbsp;<span class="num" id="6050044">1</span>&nbsp;<span class="op" id="6050046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050051">x</span><span class="op" id="6050052">.</span><span class="ident" id="6050053">sa</span><span class="op" id="6050055">[</span><span class="ident" id="6050056">prev</span><span class="op" id="6050060">]</span>&nbsp;<span class="op" id="6050062">=</span>&nbsp;<span class="op" id="6050064">-</span><span class="num" id="6050065">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6050073">prev</span>&nbsp;<span class="op" id="6050078">=</span>&nbsp;<span class="ident" id="6050080">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6050083">}</span><br>
<span class="lineno"></span><span class="op" id="6050085">}</span>
</div>
</body>
</html>
