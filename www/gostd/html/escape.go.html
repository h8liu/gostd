<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html</h2>
<ul>
<li><a href="/gostd/html/entity.go.html">entity.go</a></li>
<li><a href="/gostd/html/entity_test.go.html">entity_test.go</a></li>
<li><a href="/gostd/html/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/escape_test.go.html">escape_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3095911">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3095966">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3096020">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3096071">//&nbsp;Package&nbsp;html&nbsp;provides&nbsp;functions&nbsp;for&nbsp;escaping&nbsp;and&nbsp;unescaping&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="3096145">package</span>&nbsp;<span class="ident" id="3096153">html</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3096159">import</span>&nbsp;<span class="op" id="3096166">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096169">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096178">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096189">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="3096204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3096207">type</span>&nbsp;<span class="ident" id="3096212">writer</span>&nbsp;<span class="keyword" id="3096219">interface</span>&nbsp;<span class="op" id="3096229">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3096232">WriteString</span><span class="op" id="3096243">(</span><span class="builtintype" id="3096244">string</span><span class="op" id="3096250">)</span>&nbsp;<span class="op" id="3096252">(</span><span class="builtintype" id="3096253">int</span><span class="op" id="3096256">,</span>&nbsp;<span class="builtintype" id="3096258">error</span><span class="op" id="3096263">)</span><br>
<span class="lineno"></span><span class="op" id="3096265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3096268">//&nbsp;These&nbsp;replacements&nbsp;permit&nbsp;compatibility&nbsp;with&nbsp;old&nbsp;numeric&nbsp;entities&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3096342">//&nbsp;assumed&nbsp;Windows-1252&nbsp;encoding.</span><br>
<span class="lineno">20</span><span class="comment" id="3096376">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><span class="keyword" id="3096487">var</span>&nbsp;<span class="ident" id="3096491">replacementTable</span>&nbsp;<span class="op" id="3096508">=</span>&nbsp;<span class="op" id="3096510">[</span><span class="op" id="3096511">...</span><span class="op" id="3096514">]</span><span class="builtintype" id="3096515">rune</span><span class="op" id="3096519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096522">&#39;\u20AC&#39;</span><span class="op" id="3096530">,</span>&nbsp;<span class="comment" id="3096532">//&nbsp;First&nbsp;entry&nbsp;is&nbsp;what&nbsp;0x80&nbsp;should&nbsp;be&nbsp;replaced&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096586">&#39;\u0081&#39;</span><span class="op" id="3096594">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096597">&#39;\u201A&#39;</span><span class="op" id="3096605">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096608">&#39;\u0192&#39;</span><span class="op" id="3096616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096619">&#39;\u201E&#39;</span><span class="op" id="3096627">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096630">&#39;\u2026&#39;</span><span class="op" id="3096638">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096641">&#39;\u2020&#39;</span><span class="op" id="3096649">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096652">&#39;\u2021&#39;</span><span class="op" id="3096660">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096663">&#39;\u02C6&#39;</span><span class="op" id="3096671">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096674">&#39;\u2030&#39;</span><span class="op" id="3096682">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096685">&#39;\u0160&#39;</span><span class="op" id="3096693">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096696">&#39;\u2039&#39;</span><span class="op" id="3096704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096707">&#39;\u0152&#39;</span><span class="op" id="3096715">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096718">&#39;\u008D&#39;</span><span class="op" id="3096726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096729">&#39;\u017D&#39;</span><span class="op" id="3096737">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096740">&#39;\u008F&#39;</span><span class="op" id="3096748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096751">&#39;\u0090&#39;</span><span class="op" id="3096759">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096762">&#39;\u2018&#39;</span><span class="op" id="3096770">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096773">&#39;\u2019&#39;</span><span class="op" id="3096781">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096784">&#39;\u201C&#39;</span><span class="op" id="3096792">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096795">&#39;\u201D&#39;</span><span class="op" id="3096803">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096806">&#39;\u2022&#39;</span><span class="op" id="3096814">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096817">&#39;\u2013&#39;</span><span class="op" id="3096825">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096828">&#39;\u2014&#39;</span><span class="op" id="3096836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096839">&#39;\u02DC&#39;</span><span class="op" id="3096847">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096850">&#39;\u2122&#39;</span><span class="op" id="3096858">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096861">&#39;\u0161&#39;</span><span class="op" id="3096869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096872">&#39;\u203A&#39;</span><span class="op" id="3096880">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096883">&#39;\u0153&#39;</span><span class="op" id="3096891">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096894">&#39;\u009D&#39;</span><span class="op" id="3096902">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096905">&#39;\u017E&#39;</span><span class="op" id="3096913">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3096916">&#39;\u0178&#39;</span><span class="op" id="3096924">,</span>&nbsp;<span class="comment" id="3096926">//&nbsp;Last&nbsp;entry&nbsp;is&nbsp;0x9F.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096950">//&nbsp;0x00-&gt;&#39;\uFFFD&#39;&nbsp;is&nbsp;handled&nbsp;programmatically.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3096998">//&nbsp;0x0D-&gt;&#39;\u000D&#39;&nbsp;is&nbsp;a&nbsp;no-op.</span><br>
<span class="lineno"></span><span class="op" id="3097028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3097031">//&nbsp;unescapeEntity&nbsp;reads&nbsp;an&nbsp;entity&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;from&nbsp;b[src:]&nbsp;and&nbsp;writes&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3097105">//&nbsp;corresponding&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;b[dst:],&nbsp;returning&nbsp;the&nbsp;incremented&nbsp;dst&nbsp;and&nbsp;src&nbsp;cursors.</span><br>
<span class="lineno">60</span><span class="comment" id="3097185">//&nbsp;Precondition:&nbsp;b[src]&nbsp;==&nbsp;&#39;&amp;&#39;&nbsp;&amp;&amp;&nbsp;dst&nbsp;&lt;=&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="3097231">//&nbsp;attribute&nbsp;should&nbsp;be&nbsp;true&nbsp;if&nbsp;parsing&nbsp;an&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3097290">func</span>&nbsp;<span class="ident" id="3097295">unescapeEntity</span><span class="op" id="3097309">(</span><span class="ident" id="3097310">b</span>&nbsp;<span class="op" id="3097312">[</span><span class="op" id="3097313">]</span><span class="builtintype" id="3097314">byte</span><span class="op" id="3097318">,</span>&nbsp;<span class="ident" id="3097320">dst</span><span class="op" id="3097323">,</span>&nbsp;<span class="ident" id="3097325">src</span>&nbsp;<span class="builtintype" id="3097329">int</span><span class="op" id="3097332">,</span>&nbsp;<span class="ident" id="3097334">attribute</span>&nbsp;<span class="builtintype" id="3097344">bool</span><span class="op" id="3097348">)</span>&nbsp;<span class="op" id="3097350">(</span><span class="ident" id="3097351">dst1</span><span class="op" id="3097355">,</span>&nbsp;<span class="ident" id="3097357">src1</span>&nbsp;<span class="builtintype" id="3097362">int</span><span class="op" id="3097365">)</span>&nbsp;<span class="op" id="3097367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3097370">//&nbsp;http://www.whatwg.org/specs/web-apps/current-work/multipage/tokenization.html#consume-a-character-reference</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3097483">//&nbsp;i&nbsp;starts&nbsp;at&nbsp;1&nbsp;because&nbsp;we&nbsp;already&nbsp;know&nbsp;that&nbsp;s[0]&nbsp;==&nbsp;&#39;&amp;&#39;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097543">i</span><span class="op" id="3097544">,</span>&nbsp;<span class="ident" id="3097546">s</span>&nbsp;<span class="op" id="3097548">:=</span>&nbsp;<span class="num" id="3097551">1</span><span class="op" id="3097552">,</span>&nbsp;<span class="ident" id="3097554">b</span><span class="op" id="3097555">[</span><span class="ident" id="3097556">src</span><span class="op" id="3097559">:</span><span class="op" id="3097560">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097564">if</span>&nbsp;<span class="builtinfunc" id="3097567">len</span><span class="op" id="3097570">(</span><span class="ident" id="3097571">s</span><span class="op" id="3097572">)</span>&nbsp;<span class="op" id="3097574">&lt;=</span>&nbsp;<span class="num" id="3097577">1</span>&nbsp;<span class="op" id="3097579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097583">b</span><span class="op" id="3097584">[</span><span class="ident" id="3097585">dst</span><span class="op" id="3097588">]</span>&nbsp;<span class="op" id="3097590">=</span>&nbsp;<span class="ident" id="3097592">b</span><span class="op" id="3097593">[</span><span class="ident" id="3097594">src</span><span class="op" id="3097597">]</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097601">return</span>&nbsp;<span class="ident" id="3097608">dst</span>&nbsp;<span class="op" id="3097612">+</span>&nbsp;<span class="num" id="3097614">1</span><span class="op" id="3097615">,</span>&nbsp;<span class="ident" id="3097617">src</span>&nbsp;<span class="op" id="3097621">+</span>&nbsp;<span class="num" id="3097623">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097630">if</span>&nbsp;<span class="ident" id="3097633">s</span><span class="op" id="3097634">[</span><span class="ident" id="3097635">i</span><span class="op" id="3097636">]</span>&nbsp;<span class="op" id="3097638">==</span>&nbsp;<span class="string" id="3097641">&#39;#&#39;</span>&nbsp;<span class="op" id="3097645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097649">if</span>&nbsp;<span class="builtinfunc" id="3097652">len</span><span class="op" id="3097655">(</span><span class="ident" id="3097656">s</span><span class="op" id="3097657">)</span>&nbsp;<span class="op" id="3097659">&lt;=</span>&nbsp;<span class="num" id="3097662">3</span>&nbsp;<span class="op" id="3097664">{</span>&nbsp;<span class="comment" id="3097666">//&nbsp;We&nbsp;need&nbsp;to&nbsp;have&nbsp;at&nbsp;least&nbsp;&#34;&amp;#.&#34;.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097704">b</span><span class="op" id="3097705">[</span><span class="ident" id="3097706">dst</span><span class="op" id="3097709">]</span>&nbsp;<span class="op" id="3097711">=</span>&nbsp;<span class="ident" id="3097713">b</span><span class="op" id="3097714">[</span><span class="ident" id="3097715">src</span><span class="op" id="3097718">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097723">return</span>&nbsp;<span class="ident" id="3097730">dst</span>&nbsp;<span class="op" id="3097734">+</span>&nbsp;<span class="num" id="3097736">1</span><span class="op" id="3097737">,</span>&nbsp;<span class="ident" id="3097739">src</span>&nbsp;<span class="op" id="3097743">+</span>&nbsp;<span class="num" id="3097745">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097753">i</span><span class="op" id="3097754">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097759">c</span>&nbsp;<span class="op" id="3097761">:=</span>&nbsp;<span class="ident" id="3097764">s</span><span class="op" id="3097765">[</span><span class="ident" id="3097766">i</span><span class="op" id="3097767">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097771">hex</span>&nbsp;<span class="op" id="3097775">:=</span>&nbsp;<span class="builtintype" id="3097778">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097786">if</span>&nbsp;<span class="ident" id="3097789">c</span>&nbsp;<span class="op" id="3097791">==</span>&nbsp;<span class="string" id="3097794">&#39;x&#39;</span>&nbsp;<span class="op" id="3097798">||</span>&nbsp;<span class="ident" id="3097801">c</span>&nbsp;<span class="op" id="3097803">==</span>&nbsp;<span class="string" id="3097806">&#39;X&#39;</span>&nbsp;<span class="op" id="3097810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097815">hex</span>&nbsp;<span class="op" id="3097819">=</span>&nbsp;<span class="builtintype" id="3097821">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097829">i</span><span class="op" id="3097830">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097835">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097840">x</span>&nbsp;<span class="op" id="3097842">:=</span>&nbsp;<span class="string" id="3097845">&#39;\x00&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097854">for</span>&nbsp;<span class="ident" id="3097858">i</span>&nbsp;<span class="op" id="3097860">&lt;</span>&nbsp;<span class="builtinfunc" id="3097862">len</span><span class="op" id="3097865">(</span><span class="ident" id="3097866">s</span><span class="op" id="3097867">)</span>&nbsp;<span class="op" id="3097869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097874">c</span>&nbsp;<span class="op" id="3097876">=</span>&nbsp;<span class="ident" id="3097878">s</span><span class="op" id="3097879">[</span><span class="ident" id="3097880">i</span><span class="op" id="3097881">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097886">i</span><span class="op" id="3097887">++</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097893">if</span>&nbsp;<span class="ident" id="3097896">hex</span>&nbsp;<span class="op" id="3097900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097906">if</span>&nbsp;<span class="string" id="3097909">&#39;0&#39;</span>&nbsp;<span class="op" id="3097913">&lt;=</span>&nbsp;<span class="ident" id="3097916">c</span>&nbsp;<span class="op" id="3097918">&amp;&amp;</span>&nbsp;<span class="ident" id="3097921">c</span>&nbsp;<span class="op" id="3097923">&lt;=</span>&nbsp;<span class="string" id="3097926">&#39;9&#39;</span>&nbsp;<span class="op" id="3097930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3097937">x</span>&nbsp;<span class="op" id="3097939">=</span>&nbsp;<span class="num" id="3097941">16</span><span class="op" id="3097943">*</span><span class="ident" id="3097944">x</span>&nbsp;<span class="op" id="3097946">+</span>&nbsp;<span class="builtintype" id="3097948">rune</span><span class="op" id="3097952">(</span><span class="ident" id="3097953">c</span><span class="op" id="3097954">)</span>&nbsp;<span class="op" id="3097956">-</span>&nbsp;<span class="string" id="3097958">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3097967">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3097980">}</span>&nbsp;<span class="keyword" id="3097982">else</span>&nbsp;<span class="keyword" id="3097987">if</span>&nbsp;<span class="string" id="3097990">&#39;a&#39;</span>&nbsp;<span class="op" id="3097994">&lt;=</span>&nbsp;<span class="ident" id="3097997">c</span>&nbsp;<span class="op" id="3097999">&amp;&amp;</span>&nbsp;<span class="ident" id="3098002">c</span>&nbsp;<span class="op" id="3098004">&lt;=</span>&nbsp;<span class="string" id="3098007">&#39;f&#39;</span>&nbsp;<span class="op" id="3098011">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098018">x</span>&nbsp;<span class="op" id="3098020">=</span>&nbsp;<span class="num" id="3098022">16</span><span class="op" id="3098024">*</span><span class="ident" id="3098025">x</span>&nbsp;<span class="op" id="3098027">+</span>&nbsp;<span class="builtintype" id="3098029">rune</span><span class="op" id="3098033">(</span><span class="ident" id="3098034">c</span><span class="op" id="3098035">)</span>&nbsp;<span class="op" id="3098037">-</span>&nbsp;<span class="string" id="3098039">&#39;a&#39;</span>&nbsp;<span class="op" id="3098043">+</span>&nbsp;<span class="num" id="3098045">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098053">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098066">}</span>&nbsp;<span class="keyword" id="3098068">else</span>&nbsp;<span class="keyword" id="3098073">if</span>&nbsp;<span class="string" id="3098076">&#39;A&#39;</span>&nbsp;<span class="op" id="3098080">&lt;=</span>&nbsp;<span class="ident" id="3098083">c</span>&nbsp;<span class="op" id="3098085">&amp;&amp;</span>&nbsp;<span class="ident" id="3098088">c</span>&nbsp;<span class="op" id="3098090">&lt;=</span>&nbsp;<span class="string" id="3098093">&#39;F&#39;</span>&nbsp;<span class="op" id="3098097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098104">x</span>&nbsp;<span class="op" id="3098106">=</span>&nbsp;<span class="num" id="3098108">16</span><span class="op" id="3098110">*</span><span class="ident" id="3098111">x</span>&nbsp;<span class="op" id="3098113">+</span>&nbsp;<span class="builtintype" id="3098115">rune</span><span class="op" id="3098119">(</span><span class="ident" id="3098120">c</span><span class="op" id="3098121">)</span>&nbsp;<span class="op" id="3098123">-</span>&nbsp;<span class="string" id="3098125">&#39;A&#39;</span>&nbsp;<span class="op" id="3098129">+</span>&nbsp;<span class="num" id="3098131">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098139">continue</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098152">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098157">}</span>&nbsp;<span class="keyword" id="3098159">else</span>&nbsp;<span class="keyword" id="3098164">if</span>&nbsp;<span class="string" id="3098167">&#39;0&#39;</span>&nbsp;<span class="op" id="3098171">&lt;=</span>&nbsp;<span class="ident" id="3098174">c</span>&nbsp;<span class="op" id="3098176">&amp;&amp;</span>&nbsp;<span class="ident" id="3098179">c</span>&nbsp;<span class="op" id="3098181">&lt;=</span>&nbsp;<span class="string" id="3098184">&#39;9&#39;</span>&nbsp;<span class="op" id="3098188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098194">x</span>&nbsp;<span class="op" id="3098196">=</span>&nbsp;<span class="num" id="3098198">10</span><span class="op" id="3098200">*</span><span class="ident" id="3098201">x</span>&nbsp;<span class="op" id="3098203">+</span>&nbsp;<span class="builtintype" id="3098205">rune</span><span class="op" id="3098209">(</span><span class="ident" id="3098210">c</span><span class="op" id="3098211">)</span>&nbsp;<span class="op" id="3098213">-</span>&nbsp;<span class="string" id="3098215">&#39;0&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098223">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098235">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098240">if</span>&nbsp;<span class="ident" id="3098243">c</span>&nbsp;<span class="op" id="3098245">!=</span>&nbsp;<span class="string" id="3098248">&#39;;&#39;</span>&nbsp;<span class="op" id="3098252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098258">i</span><span class="op" id="3098259">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098270">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098278">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098283">if</span>&nbsp;<span class="ident" id="3098286">i</span>&nbsp;<span class="op" id="3098288">&lt;=</span>&nbsp;<span class="num" id="3098291">3</span>&nbsp;<span class="op" id="3098293">{</span>&nbsp;<span class="comment" id="3098295">//&nbsp;No&nbsp;characters&nbsp;matched.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098324">b</span><span class="op" id="3098325">[</span><span class="ident" id="3098326">dst</span><span class="op" id="3098329">]</span>&nbsp;<span class="op" id="3098331">=</span>&nbsp;<span class="ident" id="3098333">b</span><span class="op" id="3098334">[</span><span class="ident" id="3098335">src</span><span class="op" id="3098338">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098343">return</span>&nbsp;<span class="ident" id="3098350">dst</span>&nbsp;<span class="op" id="3098354">+</span>&nbsp;<span class="num" id="3098356">1</span><span class="op" id="3098357">,</span>&nbsp;<span class="ident" id="3098359">src</span>&nbsp;<span class="op" id="3098363">+</span>&nbsp;<span class="num" id="3098365">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098369">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098374">if</span>&nbsp;<span class="num" id="3098377">0x80</span>&nbsp;<span class="op" id="3098382">&lt;=</span>&nbsp;<span class="ident" id="3098385">x</span>&nbsp;<span class="op" id="3098387">&amp;&amp;</span>&nbsp;<span class="ident" id="3098390">x</span>&nbsp;<span class="op" id="3098392">&lt;=</span>&nbsp;<span class="num" id="3098395">0x9F</span>&nbsp;<span class="op" id="3098400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098405">//&nbsp;Replace&nbsp;characters&nbsp;from&nbsp;Windows-1252&nbsp;with&nbsp;UTF-8&nbsp;equivalents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098472">x</span>&nbsp;<span class="op" id="3098474">=</span>&nbsp;<span class="ident" id="3098476">replacementTable</span><span class="op" id="3098492">[</span><span class="ident" id="3098493">x</span><span class="op" id="3098494">-</span><span class="num" id="3098495">0x80</span><span class="op" id="3098499">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098503">}</span>&nbsp;<span class="keyword" id="3098505">else</span>&nbsp;<span class="keyword" id="3098510">if</span>&nbsp;<span class="ident" id="3098513">x</span>&nbsp;<span class="op" id="3098515">==</span>&nbsp;<span class="num" id="3098518">0</span>&nbsp;<span class="op" id="3098520">||</span>&nbsp;<span class="op" id="3098523">(</span><span class="num" id="3098524">0xD800</span>&nbsp;<span class="op" id="3098531">&lt;=</span>&nbsp;<span class="ident" id="3098534">x</span>&nbsp;<span class="op" id="3098536">&amp;&amp;</span>&nbsp;<span class="ident" id="3098539">x</span>&nbsp;<span class="op" id="3098541">&lt;=</span>&nbsp;<span class="num" id="3098544">0xDFFF</span><span class="op" id="3098550">)</span>&nbsp;<span class="op" id="3098552">||</span>&nbsp;<span class="ident" id="3098555">x</span>&nbsp;<span class="op" id="3098557">&gt;</span>&nbsp;<span class="num" id="3098559">0x10FFFF</span>&nbsp;<span class="op" id="3098568">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098573">//&nbsp;Replace&nbsp;invalid&nbsp;characters&nbsp;with&nbsp;the&nbsp;replacement&nbsp;character.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098638">x</span>&nbsp;<span class="op" id="3098640">=</span>&nbsp;<span class="string" id="3098642">&#39;\uFFFD&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098658">return</span>&nbsp;<span class="ident" id="3098665">dst</span>&nbsp;<span class="op" id="3098669">+</span>&nbsp;<span class="ident" id="3098671">utf8</span><span class="op" id="3098675">.</span><span class="ident" id="3098676">EncodeRune</span><span class="op" id="3098686">(</span><span class="ident" id="3098687">b</span><span class="op" id="3098688">[</span><span class="ident" id="3098689">dst</span><span class="op" id="3098692">:</span><span class="op" id="3098693">]</span><span class="op" id="3098694">,</span>&nbsp;<span class="ident" id="3098696">x</span><span class="op" id="3098697">)</span><span class="op" id="3098698">,</span>&nbsp;<span class="ident" id="3098700">src</span>&nbsp;<span class="op" id="3098704">+</span>&nbsp;<span class="ident" id="3098706">i</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3098709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098713">//&nbsp;Consume&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;characters&nbsp;possible,&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098777">//&nbsp;consumed&nbsp;characters&nbsp;matching&nbsp;one&nbsp;of&nbsp;the&nbsp;named&nbsp;references.</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098840">for</span>&nbsp;<span class="ident" id="3098844">i</span>&nbsp;<span class="op" id="3098846">&lt;</span>&nbsp;<span class="builtinfunc" id="3098848">len</span><span class="op" id="3098851">(</span><span class="ident" id="3098852">s</span><span class="op" id="3098853">)</span>&nbsp;<span class="op" id="3098855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098859">c</span>&nbsp;<span class="op" id="3098861">:=</span>&nbsp;<span class="ident" id="3098864">s</span><span class="op" id="3098865">[</span><span class="ident" id="3098866">i</span><span class="op" id="3098867">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3098871">i</span><span class="op" id="3098872">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3098877">//&nbsp;Lower-cased&nbsp;characters&nbsp;are&nbsp;more&nbsp;common&nbsp;in&nbsp;entities,&nbsp;so&nbsp;we&nbsp;check&nbsp;for&nbsp;them&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3098962">if</span>&nbsp;<span class="string" id="3098965">&#39;a&#39;</span>&nbsp;<span class="op" id="3098969">&lt;=</span>&nbsp;<span class="ident" id="3098972">c</span>&nbsp;<span class="op" id="3098974">&amp;&amp;</span>&nbsp;<span class="ident" id="3098977">c</span>&nbsp;<span class="op" id="3098979">&lt;=</span>&nbsp;<span class="string" id="3098982">&#39;z&#39;</span>&nbsp;<span class="op" id="3098986">||</span>&nbsp;<span class="string" id="3098989">&#39;A&#39;</span>&nbsp;<span class="op" id="3098993">&lt;=</span>&nbsp;<span class="ident" id="3098996">c</span>&nbsp;<span class="op" id="3098998">&amp;&amp;</span>&nbsp;<span class="ident" id="3099001">c</span>&nbsp;<span class="op" id="3099003">&lt;=</span>&nbsp;<span class="string" id="3099006">&#39;Z&#39;</span>&nbsp;<span class="op" id="3099010">||</span>&nbsp;<span class="string" id="3099013">&#39;0&#39;</span>&nbsp;<span class="op" id="3099017">&lt;=</span>&nbsp;<span class="ident" id="3099020">c</span>&nbsp;<span class="op" id="3099022">&amp;&amp;</span>&nbsp;<span class="ident" id="3099025">c</span>&nbsp;<span class="op" id="3099027">&lt;=</span>&nbsp;<span class="string" id="3099030">&#39;9&#39;</span>&nbsp;<span class="op" id="3099034">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099039">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099054">if</span>&nbsp;<span class="ident" id="3099057">c</span>&nbsp;<span class="op" id="3099059">!=</span>&nbsp;<span class="string" id="3099062">&#39;;&#39;</span>&nbsp;<span class="op" id="3099066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099071">i</span><span class="op" id="3099072">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099077">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099081">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099092">entityName</span>&nbsp;<span class="op" id="3099103">:=</span>&nbsp;<span class="builtintype" id="3099106">string</span><span class="op" id="3099112">(</span><span class="ident" id="3099113">s</span><span class="op" id="3099114">[</span><span class="num" id="3099115">1</span><span class="op" id="3099116">:</span><span class="ident" id="3099117">i</span><span class="op" id="3099118">]</span><span class="op" id="3099119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099122">if</span>&nbsp;<span class="ident" id="3099125">entityName</span>&nbsp;<span class="op" id="3099136">==</span>&nbsp;<span class="string" id="3099139">&#34;&#34;</span>&nbsp;<span class="op" id="3099142">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3099146">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099157">}</span>&nbsp;<span class="keyword" id="3099159">else</span>&nbsp;<span class="keyword" id="3099164">if</span>&nbsp;<span class="ident" id="3099167">attribute</span>&nbsp;<span class="op" id="3099177">&amp;&amp;</span>&nbsp;<span class="ident" id="3099180">entityName</span><span class="op" id="3099190">[</span><span class="builtinfunc" id="3099191">len</span><span class="op" id="3099194">(</span><span class="ident" id="3099195">entityName</span><span class="op" id="3099205">)</span><span class="op" id="3099206">-</span><span class="num" id="3099207">1</span><span class="op" id="3099208">]</span>&nbsp;<span class="op" id="3099210">!=</span>&nbsp;<span class="string" id="3099213">&#39;;&#39;</span>&nbsp;<span class="op" id="3099217">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3099220">len</span><span class="op" id="3099223">(</span><span class="ident" id="3099224">s</span><span class="op" id="3099225">)</span>&nbsp;<span class="op" id="3099227">&gt;</span>&nbsp;<span class="ident" id="3099229">i</span>&nbsp;<span class="op" id="3099231">&amp;&amp;</span>&nbsp;<span class="ident" id="3099234">s</span><span class="op" id="3099235">[</span><span class="ident" id="3099236">i</span><span class="op" id="3099237">]</span>&nbsp;<span class="op" id="3099239">==</span>&nbsp;<span class="string" id="3099242">&#39;=&#39;</span>&nbsp;<span class="op" id="3099246">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3099250">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099261">}</span>&nbsp;<span class="keyword" id="3099263">else</span>&nbsp;<span class="keyword" id="3099268">if</span>&nbsp;<span class="ident" id="3099271">x</span>&nbsp;<span class="op" id="3099273">:=</span>&nbsp;<span class="ident" id="3099276">entity</span><span class="op" id="3099282">[</span><span class="ident" id="3099283">entityName</span><span class="op" id="3099293">]</span><span class="op" id="3099294">;</span>&nbsp;<span class="ident" id="3099296">x</span>&nbsp;<span class="op" id="3099298">!=</span>&nbsp;<span class="num" id="3099301">0</span>&nbsp;<span class="op" id="3099303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099307">return</span>&nbsp;<span class="ident" id="3099314">dst</span>&nbsp;<span class="op" id="3099318">+</span>&nbsp;<span class="ident" id="3099320">utf8</span><span class="op" id="3099324">.</span><span class="ident" id="3099325">EncodeRune</span><span class="op" id="3099335">(</span><span class="ident" id="3099336">b</span><span class="op" id="3099337">[</span><span class="ident" id="3099338">dst</span><span class="op" id="3099341">:</span><span class="op" id="3099342">]</span><span class="op" id="3099343">,</span>&nbsp;<span class="ident" id="3099345">x</span><span class="op" id="3099346">)</span><span class="op" id="3099347">,</span>&nbsp;<span class="ident" id="3099349">src</span>&nbsp;<span class="op" id="3099353">+</span>&nbsp;<span class="ident" id="3099355">i</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099358">}</span>&nbsp;<span class="keyword" id="3099360">else</span>&nbsp;<span class="keyword" id="3099365">if</span>&nbsp;<span class="ident" id="3099368">x</span>&nbsp;<span class="op" id="3099370">:=</span>&nbsp;<span class="ident" id="3099373">entity2</span><span class="op" id="3099380">[</span><span class="ident" id="3099381">entityName</span><span class="op" id="3099391">]</span><span class="op" id="3099392">;</span>&nbsp;<span class="ident" id="3099394">x</span><span class="op" id="3099395">[</span><span class="num" id="3099396">0</span><span class="op" id="3099397">]</span>&nbsp;<span class="op" id="3099399">!=</span>&nbsp;<span class="num" id="3099402">0</span>&nbsp;<span class="op" id="3099404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099408">dst1</span>&nbsp;<span class="op" id="3099413">:=</span>&nbsp;<span class="ident" id="3099416">dst</span>&nbsp;<span class="op" id="3099420">+</span>&nbsp;<span class="ident" id="3099422">utf8</span><span class="op" id="3099426">.</span><span class="ident" id="3099427">EncodeRune</span><span class="op" id="3099437">(</span><span class="ident" id="3099438">b</span><span class="op" id="3099439">[</span><span class="ident" id="3099440">dst</span><span class="op" id="3099443">:</span><span class="op" id="3099444">]</span><span class="op" id="3099445">,</span>&nbsp;<span class="ident" id="3099447">x</span><span class="op" id="3099448">[</span><span class="num" id="3099449">0</span><span class="op" id="3099450">]</span><span class="op" id="3099451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099455">return</span>&nbsp;<span class="ident" id="3099462">dst1</span>&nbsp;<span class="op" id="3099467">+</span>&nbsp;<span class="ident" id="3099469">utf8</span><span class="op" id="3099473">.</span><span class="ident" id="3099474">EncodeRune</span><span class="op" id="3099484">(</span><span class="ident" id="3099485">b</span><span class="op" id="3099486">[</span><span class="ident" id="3099487">dst1</span><span class="op" id="3099491">:</span><span class="op" id="3099492">]</span><span class="op" id="3099493">,</span>&nbsp;<span class="ident" id="3099495">x</span><span class="op" id="3099496">[</span><span class="num" id="3099497">1</span><span class="op" id="3099498">]</span><span class="op" id="3099499">)</span><span class="op" id="3099500">,</span>&nbsp;<span class="ident" id="3099502">src</span>&nbsp;<span class="op" id="3099506">+</span>&nbsp;<span class="ident" id="3099508">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099511">}</span>&nbsp;<span class="keyword" id="3099513">else</span>&nbsp;<span class="keyword" id="3099518">if</span>&nbsp;<span class="op" id="3099521">!</span><span class="ident" id="3099522">attribute</span>&nbsp;<span class="op" id="3099532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099536">maxLen</span>&nbsp;<span class="op" id="3099543">:=</span>&nbsp;<span class="builtinfunc" id="3099546">len</span><span class="op" id="3099549">(</span><span class="ident" id="3099550">entityName</span><span class="op" id="3099560">)</span>&nbsp;<span class="op" id="3099562">-</span>&nbsp;<span class="num" id="3099564">1</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099568">if</span>&nbsp;<span class="ident" id="3099571">maxLen</span>&nbsp;<span class="op" id="3099578">&gt;</span>&nbsp;<span class="ident" id="3099580">longestEntityWithoutSemicolon</span>&nbsp;<span class="op" id="3099610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099615">maxLen</span>&nbsp;<span class="op" id="3099622">=</span>&nbsp;<span class="ident" id="3099624">longestEntityWithoutSemicolon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099660">for</span>&nbsp;<span class="ident" id="3099664">j</span>&nbsp;<span class="op" id="3099666">:=</span>&nbsp;<span class="ident" id="3099669">maxLen</span><span class="op" id="3099675">;</span>&nbsp;<span class="ident" id="3099677">j</span>&nbsp;<span class="op" id="3099679">&gt;</span>&nbsp;<span class="num" id="3099681">1</span><span class="op" id="3099682">;</span>&nbsp;<span class="ident" id="3099684">j</span><span class="op" id="3099685">--</span>&nbsp;<span class="op" id="3099688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099693">if</span>&nbsp;<span class="ident" id="3099696">x</span>&nbsp;<span class="op" id="3099698">:=</span>&nbsp;<span class="ident" id="3099701">entity</span><span class="op" id="3099707">[</span><span class="ident" id="3099708">entityName</span><span class="op" id="3099718">[</span><span class="op" id="3099719">:</span><span class="ident" id="3099720">j</span><span class="op" id="3099721">]</span><span class="op" id="3099722">]</span><span class="op" id="3099723">;</span>&nbsp;<span class="ident" id="3099725">x</span>&nbsp;<span class="op" id="3099727">!=</span>&nbsp;<span class="num" id="3099730">0</span>&nbsp;<span class="op" id="3099732">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099738">return</span>&nbsp;<span class="ident" id="3099745">dst</span>&nbsp;<span class="op" id="3099749">+</span>&nbsp;<span class="ident" id="3099751">utf8</span><span class="op" id="3099755">.</span><span class="ident" id="3099756">EncodeRune</span><span class="op" id="3099766">(</span><span class="ident" id="3099767">b</span><span class="op" id="3099768">[</span><span class="ident" id="3099769">dst</span><span class="op" id="3099772">:</span><span class="op" id="3099773">]</span><span class="op" id="3099774">,</span>&nbsp;<span class="ident" id="3099776">x</span><span class="op" id="3099777">)</span><span class="op" id="3099778">,</span>&nbsp;<span class="ident" id="3099780">src</span>&nbsp;<span class="op" id="3099784">+</span>&nbsp;<span class="ident" id="3099786">j</span>&nbsp;<span class="op" id="3099788">+</span>&nbsp;<span class="num" id="3099790">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3099802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3099806">dst1</span><span class="op" id="3099810">,</span>&nbsp;<span class="ident" id="3099812">src1</span>&nbsp;<span class="op" id="3099817">=</span>&nbsp;<span class="ident" id="3099819">dst</span><span class="op" id="3099822">+</span><span class="ident" id="3099823">i</span><span class="op" id="3099824">,</span>&nbsp;<span class="ident" id="3099826">src</span><span class="op" id="3099829">+</span><span class="ident" id="3099830">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3099833">copy</span><span class="op" id="3099837">(</span><span class="ident" id="3099838">b</span><span class="op" id="3099839">[</span><span class="ident" id="3099840">dst</span><span class="op" id="3099843">:</span><span class="ident" id="3099844">dst1</span><span class="op" id="3099848">]</span><span class="op" id="3099849">,</span>&nbsp;<span class="ident" id="3099851">b</span><span class="op" id="3099852">[</span><span class="ident" id="3099853">src</span><span class="op" id="3099856">:</span><span class="ident" id="3099857">src1</span><span class="op" id="3099861">]</span><span class="op" id="3099862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099865">return</span>&nbsp;<span class="ident" id="3099872">dst1</span><span class="op" id="3099876">,</span>&nbsp;<span class="ident" id="3099878">src1</span><br>
<span class="lineno"></span><span class="op" id="3099883">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3099886">//&nbsp;unescape&nbsp;unescapes&nbsp;b&#39;s&nbsp;entities&nbsp;in-place,&nbsp;so&nbsp;that&nbsp;&#34;a&amp;lt;b&#34;&nbsp;becomes&nbsp;&#34;a&lt;b&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3099963">func</span>&nbsp;<span class="ident" id="3099968">unescape</span><span class="op" id="3099976">(</span><span class="ident" id="3099977">b</span>&nbsp;<span class="op" id="3099979">[</span><span class="op" id="3099980">]</span><span class="builtintype" id="3099981">byte</span><span class="op" id="3099985">)</span>&nbsp;<span class="op" id="3099987">[</span><span class="op" id="3099988">]</span><span class="builtintype" id="3099989">byte</span>&nbsp;<span class="op" id="3099994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3099997">for</span>&nbsp;<span class="ident" id="3100001">i</span><span class="op" id="3100002">,</span>&nbsp;<span class="ident" id="3100004">c</span>&nbsp;<span class="op" id="3100006">:=</span>&nbsp;<span class="keyword" id="3100009">range</span>&nbsp;<span class="ident" id="3100015">b</span>&nbsp;<span class="op" id="3100017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100021">if</span>&nbsp;<span class="ident" id="3100024">c</span>&nbsp;<span class="op" id="3100026">==</span>&nbsp;<span class="string" id="3100029">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3100033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100038">dst</span><span class="op" id="3100041">,</span>&nbsp;<span class="ident" id="3100043">src</span>&nbsp;<span class="op" id="3100047">:=</span>&nbsp;<span class="ident" id="3100050">unescapeEntity</span><span class="op" id="3100064">(</span><span class="ident" id="3100065">b</span><span class="op" id="3100066">,</span>&nbsp;<span class="ident" id="3100068">i</span><span class="op" id="3100069">,</span>&nbsp;<span class="ident" id="3100071">i</span><span class="op" id="3100072">,</span>&nbsp;<span class="builtintype" id="3100074">false</span><span class="op" id="3100079">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100084">for</span>&nbsp;<span class="ident" id="3100088">src</span>&nbsp;<span class="op" id="3100092">&lt;</span>&nbsp;<span class="builtinfunc" id="3100094">len</span><span class="op" id="3100097">(</span><span class="ident" id="3100098">b</span><span class="op" id="3100099">)</span>&nbsp;<span class="op" id="3100101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100107">c</span>&nbsp;<span class="op" id="3100109">:=</span>&nbsp;<span class="ident" id="3100112">b</span><span class="op" id="3100113">[</span><span class="ident" id="3100114">src</span><span class="op" id="3100117">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100123">if</span>&nbsp;<span class="ident" id="3100126">c</span>&nbsp;<span class="op" id="3100128">==</span>&nbsp;<span class="string" id="3100131">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3100135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100142">dst</span><span class="op" id="3100145">,</span>&nbsp;<span class="ident" id="3100147">src</span>&nbsp;<span class="op" id="3100151">=</span>&nbsp;<span class="ident" id="3100153">unescapeEntity</span><span class="op" id="3100167">(</span><span class="ident" id="3100168">b</span><span class="op" id="3100169">,</span>&nbsp;<span class="ident" id="3100171">dst</span><span class="op" id="3100174">,</span>&nbsp;<span class="ident" id="3100176">src</span><span class="op" id="3100179">,</span>&nbsp;<span class="builtintype" id="3100181">false</span><span class="op" id="3100186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100192">}</span>&nbsp;<span class="keyword" id="3100194">else</span>&nbsp;<span class="op" id="3100199">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100206">b</span><span class="op" id="3100207">[</span><span class="ident" id="3100208">dst</span><span class="op" id="3100211">]</span>&nbsp;<span class="op" id="3100213">=</span>&nbsp;<span class="ident" id="3100215">c</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100222">dst</span><span class="op" id="3100225">,</span>&nbsp;<span class="ident" id="3100227">src</span>&nbsp;<span class="op" id="3100231">=</span>&nbsp;<span class="ident" id="3100233">dst</span><span class="op" id="3100236">+</span><span class="num" id="3100237">1</span><span class="op" id="3100238">,</span>&nbsp;<span class="ident" id="3100240">src</span><span class="op" id="3100243">+</span><span class="num" id="3100244">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100260">return</span>&nbsp;<span class="ident" id="3100267">b</span><span class="op" id="3100268">[</span><span class="num" id="3100269">0</span><span class="op" id="3100270">:</span><span class="ident" id="3100271">dst</span><span class="op" id="3100274">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100284">return</span>&nbsp;<span class="ident" id="3100291">b</span><br>
<span class="lineno"></span><span class="op" id="3100293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="3100296">const</span>&nbsp;<span class="ident" id="3100302">escapedChars</span>&nbsp;<span class="op" id="3100315">=</span>&nbsp;<span class="string" id="3100317">`&amp;&#39;&lt;&gt;&#34;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3100326">func</span>&nbsp;<span class="ident" id="3100331">escape</span><span class="op" id="3100337">(</span><span class="ident" id="3100338">w</span>&nbsp;<span class="ident" id="3100340">writer</span><span class="op" id="3100346">,</span>&nbsp;<span class="ident" id="3100348">s</span>&nbsp;<span class="builtintype" id="3100350">string</span><span class="op" id="3100356">)</span>&nbsp;<span class="builtintype" id="3100358">error</span>&nbsp;<span class="op" id="3100364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100367">i</span>&nbsp;<span class="op" id="3100369">:=</span>&nbsp;<span class="ident" id="3100372">strings</span><span class="op" id="3100379">.</span><span class="ident" id="3100380">IndexAny</span><span class="op" id="3100388">(</span><span class="ident" id="3100389">s</span><span class="op" id="3100390">,</span>&nbsp;<span class="ident" id="3100392">escapedChars</span><span class="op" id="3100404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100407">for</span>&nbsp;<span class="ident" id="3100411">i</span>&nbsp;<span class="op" id="3100413">!=</span>&nbsp;<span class="op" id="3100416">-</span><span class="num" id="3100417">1</span>&nbsp;<span class="op" id="3100419">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100423">if</span>&nbsp;<span class="ident" id="3100426">_</span><span class="op" id="3100427">,</span>&nbsp;<span class="ident" id="3100429">err</span>&nbsp;<span class="op" id="3100433">:=</span>&nbsp;<span class="ident" id="3100436">w</span><span class="op" id="3100437">.</span><span class="ident" id="3100438">WriteString</span><span class="op" id="3100449">(</span><span class="ident" id="3100450">s</span><span class="op" id="3100451">[</span><span class="op" id="3100452">:</span><span class="ident" id="3100453">i</span><span class="op" id="3100454">]</span><span class="op" id="3100455">)</span><span class="op" id="3100456">;</span>&nbsp;<span class="ident" id="3100458">err</span>&nbsp;<span class="op" id="3100462">!=</span>&nbsp;<span class="ident" id="3100465">nil</span>&nbsp;<span class="op" id="3100469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100474">return</span>&nbsp;<span class="ident" id="3100481">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100491">var</span>&nbsp;<span class="ident" id="3100495">esc</span>&nbsp;<span class="builtintype" id="3100499">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100508">switch</span>&nbsp;<span class="ident" id="3100515">s</span><span class="op" id="3100516">[</span><span class="ident" id="3100517">i</span><span class="op" id="3100518">]</span>&nbsp;<span class="op" id="3100520">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100524">case</span>&nbsp;<span class="string" id="3100529">&#39;&amp;&#39;</span><span class="op" id="3100532">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100537">esc</span>&nbsp;<span class="op" id="3100541">=</span>&nbsp;<span class="string" id="3100543">&#34;&amp;amp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100553">case</span>&nbsp;<span class="string" id="3100558">&#39;\&#39;&#39;</span><span class="op" id="3100562">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100567">//&nbsp;&#34;&amp;#39;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;apos;&#34;&nbsp;and&nbsp;apos&nbsp;was&nbsp;not&nbsp;in&nbsp;HTML&nbsp;until&nbsp;HTML5.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100644">esc</span>&nbsp;<span class="op" id="3100648">=</span>&nbsp;<span class="string" id="3100650">&#34;&amp;#39;&#34;</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100660">case</span>&nbsp;<span class="string" id="3100665">&#39;&lt;&#39;</span><span class="op" id="3100668">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100673">esc</span>&nbsp;<span class="op" id="3100677">=</span>&nbsp;<span class="string" id="3100679">&#34;&amp;lt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100688">case</span>&nbsp;<span class="string" id="3100693">&#39;&gt;&#39;</span><span class="op" id="3100696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100701">esc</span>&nbsp;<span class="op" id="3100705">=</span>&nbsp;<span class="string" id="3100707">&#34;&amp;gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100716">case</span>&nbsp;<span class="string" id="3100721">&#39;&#34;&#39;</span><span class="op" id="3100724">:</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3100729">//&nbsp;&#34;&amp;#34;&#34;&nbsp;is&nbsp;shorter&nbsp;than&nbsp;&#34;&amp;quot;&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100769">esc</span>&nbsp;<span class="op" id="3100773">=</span>&nbsp;<span class="string" id="3100775">&#34;&amp;#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100785">default</span><span class="op" id="3100792">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3100797">panic</span><span class="op" id="3100802">(</span><span class="string" id="3100803">&#34;unrecognized&nbsp;escape&nbsp;character&#34;</span><span class="op" id="3100834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100838">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100842">s</span>&nbsp;<span class="op" id="3100844">=</span>&nbsp;<span class="ident" id="3100846">s</span><span class="op" id="3100847">[</span><span class="ident" id="3100848">i</span><span class="op" id="3100849">+</span><span class="num" id="3100850">1</span><span class="op" id="3100851">:</span><span class="op" id="3100852">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100856">if</span>&nbsp;<span class="ident" id="3100859">_</span><span class="op" id="3100860">,</span>&nbsp;<span class="ident" id="3100862">err</span>&nbsp;<span class="op" id="3100866">:=</span>&nbsp;<span class="ident" id="3100869">w</span><span class="op" id="3100870">.</span><span class="ident" id="3100871">WriteString</span><span class="op" id="3100882">(</span><span class="ident" id="3100883">esc</span><span class="op" id="3100886">)</span><span class="op" id="3100887">;</span>&nbsp;<span class="ident" id="3100889">err</span>&nbsp;<span class="op" id="3100893">!=</span>&nbsp;<span class="ident" id="3100896">nil</span>&nbsp;<span class="op" id="3100900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100905">return</span>&nbsp;<span class="ident" id="3100912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100922">i</span>&nbsp;<span class="op" id="3100924">=</span>&nbsp;<span class="ident" id="3100926">strings</span><span class="op" id="3100933">.</span><span class="ident" id="3100934">IndexAny</span><span class="op" id="3100942">(</span><span class="ident" id="3100943">s</span><span class="op" id="3100944">,</span>&nbsp;<span class="ident" id="3100946">escapedChars</span><span class="op" id="3100958">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3100961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3100964">_</span><span class="op" id="3100965">,</span>&nbsp;<span class="ident" id="3100967">err</span>&nbsp;<span class="op" id="3100971">:=</span>&nbsp;<span class="ident" id="3100974">w</span><span class="op" id="3100975">.</span><span class="ident" id="3100976">WriteString</span><span class="op" id="3100987">(</span><span class="ident" id="3100988">s</span><span class="op" id="3100989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3100992">return</span>&nbsp;<span class="ident" id="3100999">err</span><br>
<span class="lineno"></span><span class="op" id="3101003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="comment" id="3101006">//&nbsp;EscapeString&nbsp;escapes&nbsp;special&nbsp;characters&nbsp;like&nbsp;&#34;&lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&amp;lt;&#34;.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3101079">//&nbsp;escapes&nbsp;only&nbsp;five&nbsp;such&nbsp;characters:&nbsp;&lt;,&nbsp;&gt;,&nbsp;&amp;,&nbsp;&#39;&nbsp;and&nbsp;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3101135">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3101212">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3101228">func</span>&nbsp;<span class="ident" id="3101233">EscapeString</span><span class="op" id="3101245">(</span><span class="ident" id="3101246">s</span>&nbsp;<span class="builtintype" id="3101248">string</span><span class="op" id="3101254">)</span>&nbsp;<span class="builtintype" id="3101256">string</span>&nbsp;<span class="op" id="3101263">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101266">if</span>&nbsp;<span class="ident" id="3101269">strings</span><span class="op" id="3101276">.</span><span class="ident" id="3101277">IndexAny</span><span class="op" id="3101285">(</span><span class="ident" id="3101286">s</span><span class="op" id="3101287">,</span>&nbsp;<span class="ident" id="3101289">escapedChars</span><span class="op" id="3101301">)</span>&nbsp;<span class="op" id="3101303">==</span>&nbsp;<span class="op" id="3101306">-</span><span class="num" id="3101307">1</span>&nbsp;<span class="op" id="3101309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101313">return</span>&nbsp;<span class="ident" id="3101320">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3101323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101326">var</span>&nbsp;<span class="ident" id="3101330">buf</span>&nbsp;<span class="ident" id="3101334">bytes</span><span class="op" id="3101339">.</span><span class="ident" id="3101340">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3101348">escape</span><span class="op" id="3101354">(</span><span class="op" id="3101355">&amp;</span><span class="ident" id="3101356">buf</span><span class="op" id="3101359">,</span>&nbsp;<span class="ident" id="3101361">s</span><span class="op" id="3101362">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101365">return</span>&nbsp;<span class="ident" id="3101372">buf</span><span class="op" id="3101375">.</span><span class="ident" id="3101376">String</span><span class="op" id="3101382">(</span><span class="op" id="3101383">)</span><br>
<span class="lineno"></span><span class="op" id="3101385">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3101388">//&nbsp;UnescapeString&nbsp;unescapes&nbsp;entities&nbsp;like&nbsp;&#34;&amp;lt;&#34;&nbsp;to&nbsp;become&nbsp;&#34;&lt;&#34;.&nbsp;It&nbsp;unescapes&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3101467">//&nbsp;larger&nbsp;range&nbsp;of&nbsp;entities&nbsp;than&nbsp;EscapeString&nbsp;escapes.&nbsp;For&nbsp;example,&nbsp;&#34;&amp;aacute;&#34;</span><br>
<span class="lineno">240</span><span class="comment" id="3101546">//&nbsp;unescapes&nbsp;to&nbsp;&#34;á&#34;,&nbsp;as&nbsp;does&nbsp;&#34;&amp;#225;&#34;&nbsp;and&nbsp;&#34;&amp;xE1;&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="3101598">//&nbsp;UnescapeString(EscapeString(s))&nbsp;==&nbsp;s&nbsp;always&nbsp;holds,&nbsp;but&nbsp;the&nbsp;converse&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="3101675">//&nbsp;always&nbsp;true.</span><br>
<span class="lineno"></span><span class="keyword" id="3101691">func</span>&nbsp;<span class="ident" id="3101696">UnescapeString</span><span class="op" id="3101710">(</span><span class="ident" id="3101711">s</span>&nbsp;<span class="builtintype" id="3101713">string</span><span class="op" id="3101719">)</span>&nbsp;<span class="builtintype" id="3101721">string</span>&nbsp;<span class="op" id="3101728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101731">for</span>&nbsp;<span class="ident" id="3101735">_</span><span class="op" id="3101736">,</span>&nbsp;<span class="ident" id="3101738">c</span>&nbsp;<span class="op" id="3101740">:=</span>&nbsp;<span class="keyword" id="3101743">range</span>&nbsp;<span class="ident" id="3101749">s</span>&nbsp;<span class="op" id="3101751">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101755">if</span>&nbsp;<span class="ident" id="3101758">c</span>&nbsp;<span class="op" id="3101760">==</span>&nbsp;<span class="string" id="3101763">&#39;&amp;&#39;</span>&nbsp;<span class="op" id="3101767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101772">return</span>&nbsp;<span class="builtintype" id="3101779">string</span><span class="op" id="3101785">(</span><span class="ident" id="3101786">unescape</span><span class="op" id="3101794">(</span><span class="op" id="3101795">[</span><span class="op" id="3101796">]</span><span class="builtintype" id="3101797">byte</span><span class="op" id="3101801">(</span><span class="ident" id="3101802">s</span><span class="op" id="3101803">)</span><span class="op" id="3101804">)</span><span class="op" id="3101805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3101809">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3101812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3101815">return</span>&nbsp;<span class="ident" id="3101822">s</span><br>
<span class="lineno">250</span><span class="op" id="3101824">}</span>
</div>
</body>
</html>
