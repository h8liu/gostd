<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7723991">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7724046">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7724100">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7724151">package</span>&nbsp;<span class="ident" id="7724159">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7724164">import</span>&nbsp;<span class="op" id="7724171">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724174">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724183">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724190">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724196">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724209">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724215">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724226">&#34;strings&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724237">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724248">&#34;testing/iotest&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7724266">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7724273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7724276">type</span>&nbsp;<span class="ident" id="7724281">writerTestEntry</span>&nbsp;<span class="keyword" id="7724297">struct</span>&nbsp;<span class="op" id="7724304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724307">header</span>&nbsp;&nbsp;&nbsp;<span class="op" id="7724316">*</span><span class="ident" id="7724317">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724325">contents</span>&nbsp;<span class="builtintype" id="7724334">string</span><br>
<span class="lineno"></span><span class="op" id="7724341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="7724344">type</span>&nbsp;<span class="ident" id="7724349">writerTest</span>&nbsp;<span class="keyword" id="7724360">struct</span>&nbsp;<span class="op" id="7724367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724370">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7724378">string</span>&nbsp;<span class="comment" id="7724385">//&nbsp;filename&nbsp;of&nbsp;expected&nbsp;output</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724417">entries</span>&nbsp;<span class="op" id="7724425">[</span><span class="op" id="7724426">]</span><span class="op" id="7724427">*</span><span class="ident" id="7724428">writerTestEntry</span><br>
<span class="lineno"></span><span class="op" id="7724444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7724447">var</span>&nbsp;<span class="ident" id="7724451">writerTests</span>&nbsp;<span class="op" id="7724463">=</span>&nbsp;<span class="op" id="7724465">[</span><span class="op" id="7724466">]</span><span class="op" id="7724467">*</span><span class="ident" id="7724468">writerTest</span><span class="op" id="7724478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724481">//&nbsp;The&nbsp;writer&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;with&nbsp;this&nbsp;command:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724538">//&nbsp;tar&nbsp;(GNU&nbsp;tar)&nbsp;1.26</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724561">//&nbsp;&nbsp;&nbsp;ln&nbsp;-s&nbsp;small.txt&nbsp;link.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7724592">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;--format=ustar&nbsp;-c&nbsp;-f&nbsp;writer.tar&nbsp;small.txt&nbsp;small2.txt&nbsp;link.txt</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724673">file</span><span class="op" id="7724677">:</span>&nbsp;<span class="string" id="7724679">&#34;testdata/writer.tar&#34;</span><span class="op" id="7724700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724704">entries</span><span class="op" id="7724711">:</span>&nbsp;<span class="op" id="7724713">[</span><span class="op" id="7724714">]</span><span class="op" id="7724715">*</span><span class="ident" id="7724716">writerTestEntry</span><span class="op" id="7724731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724742">header</span><span class="op" id="7724748">:</span>&nbsp;<span class="op" id="7724750">&amp;</span><span class="ident" id="7724751">Header</span><span class="op" id="7724757">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724764">Name</span><span class="op" id="7724768">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7724774">&#34;small.txt&#34;</span><span class="op" id="7724785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724792">Mode</span><span class="op" id="7724796">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7724802">0640</span><span class="op" id="7724806">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724813">Uid</span><span class="op" id="7724816">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7724823">73025</span><span class="op" id="7724828">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724835">Gid</span><span class="op" id="7724838">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7724845">5000</span><span class="op" id="7724849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724856">Size</span><span class="op" id="7724860">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7724866">5</span><span class="op" id="7724867">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724874">ModTime</span><span class="op" id="7724881">:</span>&nbsp;&nbsp;<span class="ident" id="7724884">time</span><span class="op" id="7724888">.</span><span class="ident" id="7724889">Unix</span><span class="op" id="7724893">(</span><span class="num" id="7724894">1246508266</span><span class="op" id="7724904">,</span>&nbsp;<span class="num" id="7724906">0</span><span class="op" id="7724907">)</span><span class="op" id="7724908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724915">Typeflag</span><span class="op" id="7724923">:</span>&nbsp;<span class="string" id="7724925">&#39;0&#39;</span><span class="op" id="7724928">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724935">Uname</span><span class="op" id="7724940">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7724945">&#34;dsymonds&#34;</span><span class="op" id="7724955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724962">Gname</span><span class="op" id="7724967">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7724972">&#34;eng&#34;</span><span class="op" id="7724977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7724983">}</span><span class="op" id="7724984">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7724990">contents</span><span class="op" id="7724998">:</span>&nbsp;<span class="string" id="7725000">&#34;Kilts&#34;</span><span class="op" id="7725007">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725012">}</span><span class="op" id="7725013">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725024">header</span><span class="op" id="7725030">:</span>&nbsp;<span class="op" id="7725032">&amp;</span><span class="ident" id="7725033">Header</span><span class="op" id="7725039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725046">Name</span><span class="op" id="7725050">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725056">&#34;small2.txt&#34;</span><span class="op" id="7725068">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725075">Mode</span><span class="op" id="7725079">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725085">0640</span><span class="op" id="7725089">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725096">Uid</span><span class="op" id="7725099">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725106">73025</span><span class="op" id="7725111">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725118">Gid</span><span class="op" id="7725121">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725128">5000</span><span class="op" id="7725132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725139">Size</span><span class="op" id="7725143">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725149">11</span><span class="op" id="7725151">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725158">ModTime</span><span class="op" id="7725165">:</span>&nbsp;&nbsp;<span class="ident" id="7725168">time</span><span class="op" id="7725172">.</span><span class="ident" id="7725173">Unix</span><span class="op" id="7725177">(</span><span class="num" id="7725178">1245217492</span><span class="op" id="7725188">,</span>&nbsp;<span class="num" id="7725190">0</span><span class="op" id="7725191">)</span><span class="op" id="7725192">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725199">Typeflag</span><span class="op" id="7725207">:</span>&nbsp;<span class="string" id="7725209">&#39;0&#39;</span><span class="op" id="7725212">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725219">Uname</span><span class="op" id="7725224">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725229">&#34;dsymonds&#34;</span><span class="op" id="7725239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725246">Gname</span><span class="op" id="7725251">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725256">&#34;eng&#34;</span><span class="op" id="7725261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725267">}</span><span class="op" id="7725268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725274">contents</span><span class="op" id="7725282">:</span>&nbsp;<span class="string" id="7725284">&#34;Google.com\n&#34;</span><span class="op" id="7725298">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725303">}</span><span class="op" id="7725304">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725315">header</span><span class="op" id="7725321">:</span>&nbsp;<span class="op" id="7725323">&amp;</span><span class="ident" id="7725324">Header</span><span class="op" id="7725330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725337">Name</span><span class="op" id="7725341">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725347">&#34;link.txt&#34;</span><span class="op" id="7725357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725364">Mode</span><span class="op" id="7725368">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725374">0777</span><span class="op" id="7725378">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725385">Uid</span><span class="op" id="7725388">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725395">1000</span><span class="op" id="7725399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725406">Gid</span><span class="op" id="7725409">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725416">1000</span><span class="op" id="7725420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725427">Size</span><span class="op" id="7725431">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725437">0</span><span class="op" id="7725438">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725445">ModTime</span><span class="op" id="7725452">:</span>&nbsp;&nbsp;<span class="ident" id="7725455">time</span><span class="op" id="7725459">.</span><span class="ident" id="7725460">Unix</span><span class="op" id="7725464">(</span><span class="num" id="7725465">1314603082</span><span class="op" id="7725475">,</span>&nbsp;<span class="num" id="7725477">0</span><span class="op" id="7725478">)</span><span class="op" id="7725479">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725486">Typeflag</span><span class="op" id="7725494">:</span>&nbsp;<span class="string" id="7725496">&#39;2&#39;</span><span class="op" id="7725499">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725506">Linkname</span><span class="op" id="7725514">:</span>&nbsp;<span class="string" id="7725516">&#34;small.txt&#34;</span><span class="op" id="7725527">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725534">Uname</span><span class="op" id="7725539">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725544">&#34;strings&#34;</span><span class="op" id="7725553">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725560">Gname</span><span class="op" id="7725565">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725570">&#34;strings&#34;</span><span class="op" id="7725579">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725585">}</span><span class="op" id="7725586">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725592">//&nbsp;no&nbsp;contents</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725610">}</span><span class="op" id="7725611">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725615">}</span><span class="op" id="7725616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725619">}</span><span class="op" id="7725620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725623">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725686">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;/tmp/16gig.txt</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7725748">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;/tmp/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725826">file</span><span class="op" id="7725830">:</span>&nbsp;<span class="string" id="7725832">&#34;testdata/writer-big.tar&#34;</span><span class="op" id="7725857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725861">entries</span><span class="op" id="7725868">:</span>&nbsp;<span class="op" id="7725870">[</span><span class="op" id="7725871">]</span><span class="op" id="7725872">*</span><span class="ident" id="7725873">writerTestEntry</span><span class="op" id="7725888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7725893">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725899">header</span><span class="op" id="7725905">:</span>&nbsp;<span class="op" id="7725907">&amp;</span><span class="ident" id="7725908">Header</span><span class="op" id="7725914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725921">Name</span><span class="op" id="7725925">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7725931">&#34;tmp/16gig.txt&#34;</span><span class="op" id="7725946">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725953">Mode</span><span class="op" id="7725957">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725963">0640</span><span class="op" id="7725967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725974">Uid</span><span class="op" id="7725977">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7725984">73025</span><span class="op" id="7725989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7725996">Gid</span><span class="op" id="7725999">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726006">5000</span><span class="op" id="7726010">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726017">Size</span><span class="op" id="7726021">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726027">16</span>&nbsp;<span class="op" id="7726030">&lt;&lt;</span>&nbsp;<span class="num" id="7726033">30</span><span class="op" id="7726035">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726042">ModTime</span><span class="op" id="7726049">:</span>&nbsp;&nbsp;<span class="ident" id="7726052">time</span><span class="op" id="7726056">.</span><span class="ident" id="7726057">Unix</span><span class="op" id="7726061">(</span><span class="num" id="7726062">1254699560</span><span class="op" id="7726072">,</span>&nbsp;<span class="num" id="7726074">0</span><span class="op" id="7726075">)</span><span class="op" id="7726076">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726083">Typeflag</span><span class="op" id="7726091">:</span>&nbsp;<span class="string" id="7726093">&#39;0&#39;</span><span class="op" id="7726096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726103">Uname</span><span class="op" id="7726108">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7726113">&#34;dsymonds&#34;</span><span class="op" id="7726123">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726130">Gname</span><span class="op" id="7726135">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7726140">&#34;eng&#34;</span><span class="op" id="7726145">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726151">}</span><span class="op" id="7726152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726158">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726179">contents</span><span class="op" id="7726187">:</span>&nbsp;<span class="ident" id="7726189">strings</span><span class="op" id="7726196">.</span><span class="ident" id="7726197">Repeat</span><span class="op" id="7726203">(</span><span class="string" id="7726204">&#34;\x00&#34;</span><span class="op" id="7726210">,</span>&nbsp;<span class="num" id="7726212">4</span><span class="op" id="7726213">&lt;&lt;</span><span class="num" id="7726215">10</span><span class="op" id="7726217">)</span><span class="op" id="7726218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726223">}</span><span class="op" id="7726224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726228">}</span><span class="op" id="7726229">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726232">}</span><span class="op" id="7726233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726236">//&nbsp;The&nbsp;truncated&nbsp;test&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;these&nbsp;commands:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726299">//&nbsp;&nbsp;&nbsp;dd&nbsp;if=/dev/zero&nbsp;bs=1048576&nbsp;count=16384&nbsp;&gt;&nbsp;(longname/)*15&nbsp;/16gig.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726372">//&nbsp;&nbsp;&nbsp;tar&nbsp;-b&nbsp;1&nbsp;-c&nbsp;-f-&nbsp;(longname/)*15&nbsp;/16gig.txt&nbsp;|&nbsp;dd&nbsp;bs=512&nbsp;count=8&nbsp;&gt;&nbsp;writer-big-long.tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726462">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726466">file</span><span class="op" id="7726470">:</span>&nbsp;<span class="string" id="7726472">&#34;testdata/writer-big-long.tar&#34;</span><span class="op" id="7726502">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726506">entries</span><span class="op" id="7726513">:</span>&nbsp;<span class="op" id="7726515">[</span><span class="op" id="7726516">]</span><span class="op" id="7726517">*</span><span class="ident" id="7726518">writerTestEntry</span><span class="op" id="7726533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726544">header</span><span class="op" id="7726550">:</span>&nbsp;<span class="op" id="7726552">&amp;</span><span class="ident" id="7726553">Header</span><span class="op" id="7726559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726566">Name</span><span class="op" id="7726570">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7726576">strings</span><span class="op" id="7726583">.</span><span class="ident" id="7726584">Repeat</span><span class="op" id="7726590">(</span><span class="string" id="7726591">&#34;longname/&#34;</span><span class="op" id="7726602">,</span>&nbsp;<span class="num" id="7726604">15</span><span class="op" id="7726606">)</span>&nbsp;<span class="op" id="7726608">+</span>&nbsp;<span class="string" id="7726610">&#34;16gig.txt&#34;</span><span class="op" id="7726621">,</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726628">Mode</span><span class="op" id="7726632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726638">0644</span><span class="op" id="7726642">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726649">Uid</span><span class="op" id="7726652">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726659">1000</span><span class="op" id="7726663">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726670">Gid</span><span class="op" id="7726673">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726680">1000</span><span class="op" id="7726684">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726691">Size</span><span class="op" id="7726695">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7726701">16</span>&nbsp;<span class="op" id="7726704">&lt;&lt;</span>&nbsp;<span class="num" id="7726707">30</span><span class="op" id="7726709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726716">ModTime</span><span class="op" id="7726723">:</span>&nbsp;&nbsp;<span class="ident" id="7726726">time</span><span class="op" id="7726730">.</span><span class="ident" id="7726731">Unix</span><span class="op" id="7726735">(</span><span class="num" id="7726736">1399583047</span><span class="op" id="7726746">,</span>&nbsp;<span class="num" id="7726748">0</span><span class="op" id="7726749">)</span><span class="op" id="7726750">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726757">Typeflag</span><span class="op" id="7726765">:</span>&nbsp;<span class="string" id="7726767">&#39;0&#39;</span><span class="op" id="7726770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726777">Uname</span><span class="op" id="7726782">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7726787">&#34;guillaume&#34;</span><span class="op" id="7726798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726805">Gname</span><span class="op" id="7726810">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7726815">&#34;guillaume&#34;</span><span class="op" id="7726826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726832">}</span><span class="op" id="7726833">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726839">//&nbsp;fake&nbsp;contents</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7726860">contents</span><span class="op" id="7726868">:</span>&nbsp;<span class="ident" id="7726870">strings</span><span class="op" id="7726877">.</span><span class="ident" id="7726878">Repeat</span><span class="op" id="7726884">(</span><span class="string" id="7726885">&#34;\x00&#34;</span><span class="op" id="7726891">,</span>&nbsp;<span class="num" id="7726893">4</span><span class="op" id="7726894">&lt;&lt;</span><span class="num" id="7726896">10</span><span class="op" id="7726898">)</span><span class="op" id="7726899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726904">}</span><span class="op" id="7726905">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726909">}</span><span class="op" id="7726910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7726913">}</span><span class="op" id="7726914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726917">//&nbsp;This&nbsp;file&nbsp;was&nbsp;produced&nbsp;using&nbsp;gnu&nbsp;tar&nbsp;1.17</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7726963">//&nbsp;gnutar&nbsp;&nbsp;-b&nbsp;4&nbsp;--format=ustar&nbsp;(longname/)*15&nbsp;+&nbsp;file.txt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727025">file</span><span class="op" id="7727029">:</span>&nbsp;<span class="string" id="7727031">&#34;testdata/ustar.tar&#34;</span><span class="op" id="7727051">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727055">entries</span><span class="op" id="7727062">:</span>&nbsp;<span class="op" id="7727064">[</span><span class="op" id="7727065">]</span><span class="op" id="7727066">*</span><span class="ident" id="7727067">writerTestEntry</span><span class="op" id="7727082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727087">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727093">header</span><span class="op" id="7727099">:</span>&nbsp;<span class="op" id="7727101">&amp;</span><span class="ident" id="7727102">Header</span><span class="op" id="7727108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727115">Name</span><span class="op" id="7727119">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7727125">strings</span><span class="op" id="7727132">.</span><span class="ident" id="7727133">Repeat</span><span class="op" id="7727139">(</span><span class="string" id="7727140">&#34;longname/&#34;</span><span class="op" id="7727151">,</span>&nbsp;<span class="num" id="7727153">15</span><span class="op" id="7727155">)</span>&nbsp;<span class="op" id="7727157">+</span>&nbsp;<span class="string" id="7727159">&#34;file.txt&#34;</span><span class="op" id="7727169">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727176">Mode</span><span class="op" id="7727180">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7727186">0644</span><span class="op" id="7727190">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727197">Uid</span><span class="op" id="7727200">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7727207">0765</span><span class="op" id="7727211">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727218">Gid</span><span class="op" id="7727221">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7727228">024</span><span class="op" id="7727231">,</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727238">Size</span><span class="op" id="7727242">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7727248">06</span><span class="op" id="7727250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727257">ModTime</span><span class="op" id="7727264">:</span>&nbsp;&nbsp;<span class="ident" id="7727267">time</span><span class="op" id="7727271">.</span><span class="ident" id="7727272">Unix</span><span class="op" id="7727276">(</span><span class="num" id="7727277">1360135598</span><span class="op" id="7727287">,</span>&nbsp;<span class="num" id="7727289">0</span><span class="op" id="7727290">)</span><span class="op" id="7727291">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727298">Typeflag</span><span class="op" id="7727306">:</span>&nbsp;<span class="string" id="7727308">&#39;0&#39;</span><span class="op" id="7727311">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727318">Uname</span><span class="op" id="7727323">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7727328">&#34;shane&#34;</span><span class="op" id="7727335">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727342">Gname</span><span class="op" id="7727347">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7727352">&#34;staff&#34;</span><span class="op" id="7727359">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727365">}</span><span class="op" id="7727366">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727372">contents</span><span class="op" id="7727380">:</span>&nbsp;<span class="string" id="7727382">&#34;hello\n&#34;</span><span class="op" id="7727391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727396">}</span><span class="op" id="7727397">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727401">}</span><span class="op" id="7727402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727405">}</span><span class="op" id="7727406">,</span><br>
<span class="lineno">150</span><span class="op" id="7727408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7727411">//&nbsp;Render&nbsp;byte&nbsp;array&nbsp;in&nbsp;a&nbsp;two-character&nbsp;hexadecimal&nbsp;string,&nbsp;spaced&nbsp;for&nbsp;easy&nbsp;visual&nbsp;inspection.</span><br>
<span class="lineno"></span><span class="keyword" id="7727506">func</span>&nbsp;<span class="ident" id="7727511">bytestr</span><span class="op" id="7727518">(</span><span class="ident" id="7727519">offset</span>&nbsp;<span class="builtintype" id="7727526">int</span><span class="op" id="7727529">,</span>&nbsp;<span class="ident" id="7727531">b</span>&nbsp;<span class="op" id="7727533">[</span><span class="op" id="7727534">]</span><span class="builtintype" id="7727535">byte</span><span class="op" id="7727539">)</span>&nbsp;<span class="builtintype" id="7727541">string</span>&nbsp;<span class="op" id="7727548">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727551">const</span>&nbsp;<span class="ident" id="7727557">rowLen</span>&nbsp;<span class="op" id="7727564">=</span>&nbsp;<span class="num" id="7727566">32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727570">s</span>&nbsp;<span class="op" id="7727572">:=</span>&nbsp;<span class="ident" id="7727575">fmt</span><span class="op" id="7727578">.</span><span class="ident" id="7727579">Sprintf</span><span class="op" id="7727586">(</span><span class="string" id="7727587">&#34;%04x&nbsp;&#34;</span><span class="op" id="7727594">,</span>&nbsp;<span class="ident" id="7727596">offset</span><span class="op" id="7727602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727605">for</span>&nbsp;<span class="ident" id="7727609">_</span><span class="op" id="7727610">,</span>&nbsp;<span class="ident" id="7727612">ch</span>&nbsp;<span class="op" id="7727615">:=</span>&nbsp;<span class="keyword" id="7727618">range</span>&nbsp;<span class="ident" id="7727624">b</span>&nbsp;<span class="op" id="7727626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727630">switch</span>&nbsp;<span class="op" id="7727637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727641">case</span>&nbsp;<span class="string" id="7727646">&#39;0&#39;</span>&nbsp;<span class="op" id="7727650">&lt;=</span>&nbsp;<span class="ident" id="7727653">ch</span>&nbsp;<span class="op" id="7727656">&amp;&amp;</span>&nbsp;<span class="ident" id="7727659">ch</span>&nbsp;<span class="op" id="7727662">&lt;=</span>&nbsp;<span class="string" id="7727665">&#39;9&#39;</span><span class="op" id="7727668">,</span>&nbsp;<span class="string" id="7727670">&#39;A&#39;</span>&nbsp;<span class="op" id="7727674">&lt;=</span>&nbsp;<span class="ident" id="7727677">ch</span>&nbsp;<span class="op" id="7727680">&amp;&amp;</span>&nbsp;<span class="ident" id="7727683">ch</span>&nbsp;<span class="op" id="7727686">&lt;=</span>&nbsp;<span class="string" id="7727689">&#39;Z&#39;</span><span class="op" id="7727692">,</span>&nbsp;<span class="string" id="7727694">&#39;a&#39;</span>&nbsp;<span class="op" id="7727698">&lt;=</span>&nbsp;<span class="ident" id="7727701">ch</span>&nbsp;<span class="op" id="7727704">&amp;&amp;</span>&nbsp;<span class="ident" id="7727707">ch</span>&nbsp;<span class="op" id="7727710">&lt;=</span>&nbsp;<span class="string" id="7727713">&#39;z&#39;</span><span class="op" id="7727716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727721">s</span>&nbsp;<span class="op" id="7727723">+=</span>&nbsp;<span class="ident" id="7727726">fmt</span><span class="op" id="7727729">.</span><span class="ident" id="7727730">Sprintf</span><span class="op" id="7727737">(</span><span class="string" id="7727738">&#34;&nbsp;&nbsp;%c&#34;</span><span class="op" id="7727744">,</span>&nbsp;<span class="ident" id="7727746">ch</span><span class="op" id="7727748">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727752">default</span><span class="op" id="7727759">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727764">s</span>&nbsp;<span class="op" id="7727766">+=</span>&nbsp;<span class="ident" id="7727769">fmt</span><span class="op" id="7727772">.</span><span class="ident" id="7727773">Sprintf</span><span class="op" id="7727780">(</span><span class="string" id="7727781">&#34;&nbsp;%02x&#34;</span><span class="op" id="7727788">,</span>&nbsp;<span class="ident" id="7727790">ch</span><span class="op" id="7727792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7727799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727802">return</span>&nbsp;<span class="ident" id="7727809">s</span><br>
<span class="lineno">165</span><span class="op" id="7727811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7727814">//&nbsp;Render&nbsp;a&nbsp;pseudo-diff&nbsp;between&nbsp;two&nbsp;blocks&nbsp;of&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="7727867">func</span>&nbsp;<span class="ident" id="7727872">bytediff</span><span class="op" id="7727880">(</span><span class="ident" id="7727881">a</span>&nbsp;<span class="op" id="7727883">[</span><span class="op" id="7727884">]</span><span class="builtintype" id="7727885">byte</span><span class="op" id="7727889">,</span>&nbsp;<span class="ident" id="7727891">b</span>&nbsp;<span class="op" id="7727893">[</span><span class="op" id="7727894">]</span><span class="builtintype" id="7727895">byte</span><span class="op" id="7727899">)</span>&nbsp;<span class="builtintype" id="7727901">string</span>&nbsp;<span class="op" id="7727908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727911">const</span>&nbsp;<span class="ident" id="7727917">rowLen</span>&nbsp;<span class="op" id="7727924">=</span>&nbsp;<span class="num" id="7727926">32</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7727930">s</span>&nbsp;<span class="op" id="7727932">:=</span>&nbsp;<span class="ident" id="7727935">fmt</span><span class="op" id="7727938">.</span><span class="ident" id="7727939">Sprintf</span><span class="op" id="7727946">(</span><span class="string" id="7727947">&#34;(%d&nbsp;bytes&nbsp;vs.&nbsp;%d&nbsp;bytes)\n&#34;</span><span class="op" id="7727974">,</span>&nbsp;<span class="builtinfunc" id="7727976">len</span><span class="op" id="7727979">(</span><span class="ident" id="7727980">a</span><span class="op" id="7727981">)</span><span class="op" id="7727982">,</span>&nbsp;<span class="builtinfunc" id="7727984">len</span><span class="op" id="7727987">(</span><span class="ident" id="7727988">b</span><span class="op" id="7727989">)</span><span class="op" id="7727990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7727993">for</span>&nbsp;<span class="ident" id="7727997">offset</span>&nbsp;<span class="op" id="7728004">:=</span>&nbsp;<span class="num" id="7728007">0</span><span class="op" id="7728008">;</span>&nbsp;<span class="builtinfunc" id="7728010">len</span><span class="op" id="7728013">(</span><span class="ident" id="7728014">a</span><span class="op" id="7728015">)</span><span class="op" id="7728016">+</span><span class="builtinfunc" id="7728017">len</span><span class="op" id="7728020">(</span><span class="ident" id="7728021">b</span><span class="op" id="7728022">)</span>&nbsp;<span class="op" id="7728024">&gt;</span>&nbsp;<span class="num" id="7728026">0</span><span class="op" id="7728027">;</span>&nbsp;<span class="ident" id="7728029">offset</span>&nbsp;<span class="op" id="7728036">+=</span>&nbsp;<span class="ident" id="7728039">rowLen</span>&nbsp;<span class="op" id="7728046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728050">na</span><span class="op" id="7728052">,</span>&nbsp;<span class="ident" id="7728054">nb</span>&nbsp;<span class="op" id="7728057">:=</span>&nbsp;<span class="ident" id="7728060">rowLen</span><span class="op" id="7728066">,</span>&nbsp;<span class="ident" id="7728068">rowLen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728077">if</span>&nbsp;<span class="ident" id="7728080">na</span>&nbsp;<span class="op" id="7728083">&gt;</span>&nbsp;<span class="builtinfunc" id="7728085">len</span><span class="op" id="7728088">(</span><span class="ident" id="7728089">a</span><span class="op" id="7728090">)</span>&nbsp;<span class="op" id="7728092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728097">na</span>&nbsp;<span class="op" id="7728100">=</span>&nbsp;<span class="builtinfunc" id="7728102">len</span><span class="op" id="7728105">(</span><span class="ident" id="7728106">a</span><span class="op" id="7728107">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728115">if</span>&nbsp;<span class="ident" id="7728118">nb</span>&nbsp;<span class="op" id="7728121">&gt;</span>&nbsp;<span class="builtinfunc" id="7728123">len</span><span class="op" id="7728126">(</span><span class="ident" id="7728127">b</span><span class="op" id="7728128">)</span>&nbsp;<span class="op" id="7728130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728135">nb</span>&nbsp;<span class="op" id="7728138">=</span>&nbsp;<span class="builtinfunc" id="7728140">len</span><span class="op" id="7728143">(</span><span class="ident" id="7728144">b</span><span class="op" id="7728145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728153">sa</span>&nbsp;<span class="op" id="7728156">:=</span>&nbsp;<span class="ident" id="7728159">bytestr</span><span class="op" id="7728166">(</span><span class="ident" id="7728167">offset</span><span class="op" id="7728173">,</span>&nbsp;<span class="ident" id="7728175">a</span><span class="op" id="7728176">[</span><span class="num" id="7728177">0</span><span class="op" id="7728178">:</span><span class="ident" id="7728179">na</span><span class="op" id="7728181">]</span><span class="op" id="7728182">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728186">sb</span>&nbsp;<span class="op" id="7728189">:=</span>&nbsp;<span class="ident" id="7728192">bytestr</span><span class="op" id="7728199">(</span><span class="ident" id="7728200">offset</span><span class="op" id="7728206">,</span>&nbsp;<span class="ident" id="7728208">b</span><span class="op" id="7728209">[</span><span class="num" id="7728210">0</span><span class="op" id="7728211">:</span><span class="ident" id="7728212">nb</span><span class="op" id="7728214">]</span><span class="op" id="7728215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728219">if</span>&nbsp;<span class="ident" id="7728222">sa</span>&nbsp;<span class="op" id="7728225">!=</span>&nbsp;<span class="ident" id="7728228">sb</span>&nbsp;<span class="op" id="7728231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728236">s</span>&nbsp;<span class="op" id="7728238">+=</span>&nbsp;<span class="ident" id="7728241">fmt</span><span class="op" id="7728244">.</span><span class="ident" id="7728245">Sprintf</span><span class="op" id="7728252">(</span><span class="string" id="7728253">&#34;-%v\n+%v\n&#34;</span><span class="op" id="7728265">,</span>&nbsp;<span class="ident" id="7728267">sa</span><span class="op" id="7728269">,</span>&nbsp;<span class="ident" id="7728271">sb</span><span class="op" id="7728273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728277">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728281">a</span>&nbsp;<span class="op" id="7728283">=</span>&nbsp;<span class="ident" id="7728285">a</span><span class="op" id="7728286">[</span><span class="ident" id="7728287">na</span><span class="op" id="7728289">:</span><span class="op" id="7728290">]</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728294">b</span>&nbsp;<span class="op" id="7728296">=</span>&nbsp;<span class="ident" id="7728298">b</span><span class="op" id="7728299">[</span><span class="ident" id="7728300">nb</span><span class="op" id="7728302">:</span><span class="op" id="7728303">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728309">return</span>&nbsp;<span class="ident" id="7728316">s</span><br>
<span class="lineno"></span><span class="op" id="7728318">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7728321">func</span>&nbsp;<span class="ident" id="7728326">TestWriter</span><span class="op" id="7728336">(</span><span class="ident" id="7728337">t</span>&nbsp;<span class="op" id="7728339">*</span><span class="ident" id="7728340">testing</span><span class="op" id="7728347">.</span><span class="ident" id="7728348">T</span><span class="op" id="7728349">)</span>&nbsp;<span class="op" id="7728351">{</span><br>
<span class="lineno"></span><span class="ident" id="7728353">testLoop</span><span class="op" id="7728361">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728364">for</span>&nbsp;<span class="ident" id="7728368">i</span><span class="op" id="7728369">,</span>&nbsp;<span class="ident" id="7728371">test</span>&nbsp;<span class="op" id="7728376">:=</span>&nbsp;<span class="keyword" id="7728379">range</span>&nbsp;<span class="ident" id="7728385">writerTests</span>&nbsp;<span class="op" id="7728397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728401">expected</span><span class="op" id="7728409">,</span>&nbsp;<span class="ident" id="7728411">err</span>&nbsp;<span class="op" id="7728415">:=</span>&nbsp;<span class="ident" id="7728418">ioutil</span><span class="op" id="7728424">.</span><span class="ident" id="7728425">ReadFile</span><span class="op" id="7728433">(</span><span class="ident" id="7728434">test</span><span class="op" id="7728438">.</span><span class="ident" id="7728439">file</span><span class="op" id="7728443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728447">if</span>&nbsp;<span class="ident" id="7728450">err</span>&nbsp;<span class="op" id="7728454">!=</span>&nbsp;<span class="ident" id="7728457">nil</span>&nbsp;<span class="op" id="7728461">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728466">t</span><span class="op" id="7728467">.</span><span class="ident" id="7728468">Errorf</span><span class="op" id="7728474">(</span><span class="string" id="7728475">&#34;test&nbsp;%d:&nbsp;Unexpected&nbsp;error:&nbsp;%v&#34;</span><span class="op" id="7728506">,</span>&nbsp;<span class="ident" id="7728508">i</span><span class="op" id="7728509">,</span>&nbsp;<span class="ident" id="7728511">err</span><span class="op" id="7728514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728519">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728535">buf</span>&nbsp;<span class="op" id="7728539">:=</span>&nbsp;<span class="builtinfunc" id="7728542">new</span><span class="op" id="7728545">(</span><span class="ident" id="7728546">bytes</span><span class="op" id="7728551">.</span><span class="ident" id="7728552">Buffer</span><span class="op" id="7728558">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728562">tw</span>&nbsp;<span class="op" id="7728565">:=</span>&nbsp;<span class="ident" id="7728568">NewWriter</span><span class="op" id="7728577">(</span><span class="ident" id="7728578">iotest</span><span class="op" id="7728584">.</span><span class="ident" id="7728585">TruncateWriter</span><span class="op" id="7728599">(</span><span class="ident" id="7728600">buf</span><span class="op" id="7728603">,</span>&nbsp;<span class="num" id="7728605">4</span><span class="op" id="7728606">&lt;&lt;</span><span class="num" id="7728608">10</span><span class="op" id="7728610">)</span><span class="op" id="7728611">)</span>&nbsp;<span class="comment" id="7728613">//&nbsp;only&nbsp;catch&nbsp;the&nbsp;first&nbsp;4&nbsp;KB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728644">big</span>&nbsp;<span class="op" id="7728648">:=</span>&nbsp;<span class="ident" id="7728651">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728659">for</span>&nbsp;<span class="ident" id="7728663">j</span><span class="op" id="7728664">,</span>&nbsp;<span class="ident" id="7728666">entry</span>&nbsp;<span class="op" id="7728672">:=</span>&nbsp;<span class="keyword" id="7728675">range</span>&nbsp;<span class="ident" id="7728681">test</span><span class="op" id="7728685">.</span><span class="ident" id="7728686">entries</span>&nbsp;<span class="op" id="7728694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728699">big</span>&nbsp;<span class="op" id="7728703">=</span>&nbsp;<span class="ident" id="7728705">big</span>&nbsp;<span class="op" id="7728709">||</span>&nbsp;<span class="ident" id="7728712">entry</span><span class="op" id="7728717">.</span><span class="ident" id="7728718">header</span><span class="op" id="7728724">.</span><span class="ident" id="7728725">Size</span>&nbsp;<span class="op" id="7728730">&gt;</span>&nbsp;<span class="num" id="7728732">1</span><span class="op" id="7728733">&lt;&lt;</span><span class="num" id="7728735">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728741">if</span>&nbsp;<span class="ident" id="7728744">err</span>&nbsp;<span class="op" id="7728748">:=</span>&nbsp;<span class="ident" id="7728751">tw</span><span class="op" id="7728753">.</span><span class="ident" id="7728754">WriteHeader</span><span class="op" id="7728765">(</span><span class="ident" id="7728766">entry</span><span class="op" id="7728771">.</span><span class="ident" id="7728772">header</span><span class="op" id="7728778">)</span><span class="op" id="7728779">;</span>&nbsp;<span class="ident" id="7728781">err</span>&nbsp;<span class="op" id="7728785">!=</span>&nbsp;<span class="ident" id="7728788">nil</span>&nbsp;<span class="op" id="7728792">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728798">t</span><span class="op" id="7728799">.</span><span class="ident" id="7728800">Errorf</span><span class="op" id="7728806">(</span><span class="string" id="7728807">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7728853">,</span>&nbsp;<span class="ident" id="7728855">i</span><span class="op" id="7728856">,</span>&nbsp;<span class="ident" id="7728858">j</span><span class="op" id="7728859">,</span>&nbsp;<span class="ident" id="7728861">err</span><span class="op" id="7728864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728870">continue</span>&nbsp;<span class="ident" id="7728879">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7728891">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7728896">if</span>&nbsp;<span class="ident" id="7728899">_</span><span class="op" id="7728900">,</span>&nbsp;<span class="ident" id="7728902">err</span>&nbsp;<span class="op" id="7728906">:=</span>&nbsp;<span class="ident" id="7728909">io</span><span class="op" id="7728911">.</span><span class="ident" id="7728912">WriteString</span><span class="op" id="7728923">(</span><span class="ident" id="7728924">tw</span><span class="op" id="7728926">,</span>&nbsp;<span class="ident" id="7728928">entry</span><span class="op" id="7728933">.</span><span class="ident" id="7728934">contents</span><span class="op" id="7728942">)</span><span class="op" id="7728943">;</span>&nbsp;<span class="ident" id="7728945">err</span>&nbsp;<span class="op" id="7728949">!=</span>&nbsp;<span class="ident" id="7728952">nil</span>&nbsp;<span class="op" id="7728956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7728962">t</span><span class="op" id="7728963">.</span><span class="ident" id="7728964">Errorf</span><span class="op" id="7728970">(</span><span class="string" id="7728971">&#34;test&nbsp;%d,&nbsp;entry&nbsp;%d:&nbsp;Failed&nbsp;writing&nbsp;contents:&nbsp;%v&#34;</span><span class="op" id="7729019">,</span>&nbsp;<span class="ident" id="7729021">i</span><span class="op" id="7729022">,</span>&nbsp;<span class="ident" id="7729024">j</span><span class="op" id="7729025">,</span>&nbsp;<span class="ident" id="7729027">err</span><span class="op" id="7729030">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729036">continue</span>&nbsp;<span class="ident" id="7729045">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729065">//&nbsp;Only&nbsp;interested&nbsp;in&nbsp;Close&nbsp;failures&nbsp;for&nbsp;the&nbsp;small&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729125">if</span>&nbsp;<span class="ident" id="7729128">err</span>&nbsp;<span class="op" id="7729132">:=</span>&nbsp;<span class="ident" id="7729135">tw</span><span class="op" id="7729137">.</span><span class="ident" id="7729138">Close</span><span class="op" id="7729143">(</span><span class="op" id="7729144">)</span><span class="op" id="7729145">;</span>&nbsp;<span class="ident" id="7729147">err</span>&nbsp;<span class="op" id="7729151">!=</span>&nbsp;<span class="ident" id="7729154">nil</span>&nbsp;<span class="op" id="7729158">&amp;&amp;</span>&nbsp;<span class="op" id="7729161">!</span><span class="ident" id="7729162">big</span>&nbsp;<span class="op" id="7729166">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729171">t</span><span class="op" id="7729172">.</span><span class="ident" id="7729173">Errorf</span><span class="op" id="7729179">(</span><span class="string" id="7729180">&#34;test&nbsp;%d:&nbsp;Failed&nbsp;closing&nbsp;archive:&nbsp;%v&#34;</span><span class="op" id="7729217">,</span>&nbsp;<span class="ident" id="7729219">i</span><span class="op" id="7729220">,</span>&nbsp;<span class="ident" id="7729222">err</span><span class="op" id="7729225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729230">continue</span>&nbsp;<span class="ident" id="7729239">testLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729255">actual</span>&nbsp;<span class="op" id="7729262">:=</span>&nbsp;<span class="ident" id="7729265">buf</span><span class="op" id="7729268">.</span><span class="ident" id="7729269">Bytes</span><span class="op" id="7729274">(</span><span class="op" id="7729275">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729279">if</span>&nbsp;<span class="op" id="7729282">!</span><span class="ident" id="7729283">bytes</span><span class="op" id="7729288">.</span><span class="ident" id="7729289">Equal</span><span class="op" id="7729294">(</span><span class="ident" id="7729295">expected</span><span class="op" id="7729303">,</span>&nbsp;<span class="ident" id="7729305">actual</span><span class="op" id="7729311">)</span>&nbsp;<span class="op" id="7729313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729318">t</span><span class="op" id="7729319">.</span><span class="ident" id="7729320">Errorf</span><span class="op" id="7729326">(</span><span class="string" id="7729327">&#34;test&nbsp;%d:&nbsp;Incorrect&nbsp;result:&nbsp;(-=expected,&nbsp;+=actual)\n%v&#34;</span><span class="op" id="7729382">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729388">i</span><span class="op" id="7729389">,</span>&nbsp;<span class="ident" id="7729391">bytediff</span><span class="op" id="7729399">(</span><span class="ident" id="7729400">expected</span><span class="op" id="7729408">,</span>&nbsp;<span class="ident" id="7729410">actual</span><span class="op" id="7729416">)</span><span class="op" id="7729417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729425">if</span>&nbsp;<span class="ident" id="7729428">testing</span><span class="op" id="7729435">.</span><span class="ident" id="7729436">Short</span><span class="op" id="7729441">(</span><span class="op" id="7729442">)</span>&nbsp;<span class="op" id="7729444">{</span>&nbsp;<span class="comment" id="7729446">//&nbsp;The&nbsp;second&nbsp;test&nbsp;is&nbsp;expensive.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729482">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729493">}</span><br>
<span class="lineno"></span><span class="op" id="7729495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="7729498">func</span>&nbsp;<span class="ident" id="7729503">TestPax</span><span class="op" id="7729510">(</span><span class="ident" id="7729511">t</span>&nbsp;<span class="op" id="7729513">*</span><span class="ident" id="7729514">testing</span><span class="op" id="7729521">.</span><span class="ident" id="7729522">T</span><span class="op" id="7729523">)</span>&nbsp;<span class="op" id="7729525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729528">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729568">fileinfo</span><span class="op" id="7729576">,</span>&nbsp;<span class="ident" id="7729578">err</span>&nbsp;<span class="op" id="7729582">:=</span>&nbsp;<span class="ident" id="7729585">os</span><span class="op" id="7729587">.</span><span class="ident" id="7729588">Stat</span><span class="op" id="7729592">(</span><span class="string" id="7729593">&#34;testdata/small.txt&#34;</span><span class="op" id="7729613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729616">if</span>&nbsp;<span class="ident" id="7729619">err</span>&nbsp;<span class="op" id="7729623">!=</span>&nbsp;<span class="ident" id="7729626">nil</span>&nbsp;<span class="op" id="7729630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729634">t</span><span class="op" id="7729635">.</span><span class="ident" id="7729636">Fatal</span><span class="op" id="7729641">(</span><span class="ident" id="7729642">err</span><span class="op" id="7729645">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729651">hdr</span><span class="op" id="7729654">,</span>&nbsp;<span class="ident" id="7729656">err</span>&nbsp;<span class="op" id="7729660">:=</span>&nbsp;<span class="ident" id="7729663">FileInfoHeader</span><span class="op" id="7729677">(</span><span class="ident" id="7729678">fileinfo</span><span class="op" id="7729686">,</span>&nbsp;<span class="string" id="7729688">&#34;&#34;</span><span class="op" id="7729690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729693">if</span>&nbsp;<span class="ident" id="7729696">err</span>&nbsp;<span class="op" id="7729700">!=</span>&nbsp;<span class="ident" id="7729703">nil</span>&nbsp;<span class="op" id="7729707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729711">t</span><span class="op" id="7729712">.</span><span class="ident" id="7729713">Fatalf</span><span class="op" id="7729719">(</span><span class="string" id="7729720">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7729733">,</span>&nbsp;<span class="ident" id="7729735">err</span><span class="op" id="7729738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7729741">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7729744">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729784">longName</span>&nbsp;<span class="op" id="7729793">:=</span>&nbsp;<span class="ident" id="7729796">strings</span><span class="op" id="7729803">.</span><span class="ident" id="7729804">Repeat</span><span class="op" id="7729810">(</span><span class="string" id="7729811">&#34;ab&#34;</span><span class="op" id="7729815">,</span>&nbsp;<span class="num" id="7729817">100</span><span class="op" id="7729820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729823">contents</span>&nbsp;<span class="op" id="7729832">:=</span>&nbsp;<span class="ident" id="7729835">strings</span><span class="op" id="7729842">.</span><span class="ident" id="7729843">Repeat</span><span class="op" id="7729849">(</span><span class="string" id="7729850">&#34;&nbsp;&#34;</span><span class="op" id="7729853">,</span>&nbsp;<span class="builtintype" id="7729855">int</span><span class="op" id="7729858">(</span><span class="ident" id="7729859">hdr</span><span class="op" id="7729862">.</span><span class="ident" id="7729863">Size</span><span class="op" id="7729867">)</span><span class="op" id="7729868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729871">hdr</span><span class="op" id="7729874">.</span><span class="ident" id="7729875">Name</span>&nbsp;<span class="op" id="7729880">=</span>&nbsp;<span class="ident" id="7729882">longName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729892">var</span>&nbsp;<span class="ident" id="7729896">buf</span>&nbsp;<span class="ident" id="7729900">bytes</span><span class="op" id="7729905">.</span><span class="ident" id="7729906">Buffer</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729914">writer</span>&nbsp;<span class="op" id="7729921">:=</span>&nbsp;<span class="ident" id="7729924">NewWriter</span><span class="op" id="7729933">(</span><span class="op" id="7729934">&amp;</span><span class="ident" id="7729935">buf</span><span class="op" id="7729938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7729941">if</span>&nbsp;<span class="ident" id="7729944">err</span>&nbsp;<span class="op" id="7729948">:=</span>&nbsp;<span class="ident" id="7729951">writer</span><span class="op" id="7729957">.</span><span class="ident" id="7729958">WriteHeader</span><span class="op" id="7729969">(</span><span class="ident" id="7729970">hdr</span><span class="op" id="7729973">)</span><span class="op" id="7729974">;</span>&nbsp;<span class="ident" id="7729976">err</span>&nbsp;<span class="op" id="7729980">!=</span>&nbsp;<span class="ident" id="7729983">nil</span>&nbsp;<span class="op" id="7729987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7729991">t</span><span class="op" id="7729992">.</span><span class="ident" id="7729993">Fatal</span><span class="op" id="7729998">(</span><span class="ident" id="7729999">err</span><span class="op" id="7730002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730008">if</span>&nbsp;<span class="ident" id="7730011">_</span><span class="op" id="7730012">,</span>&nbsp;<span class="ident" id="7730014">err</span>&nbsp;<span class="op" id="7730018">=</span>&nbsp;<span class="ident" id="7730020">writer</span><span class="op" id="7730026">.</span><span class="ident" id="7730027">Write</span><span class="op" id="7730032">(</span><span class="op" id="7730033">[</span><span class="op" id="7730034">]</span><span class="builtintype" id="7730035">byte</span><span class="op" id="7730039">(</span><span class="ident" id="7730040">contents</span><span class="op" id="7730048">)</span><span class="op" id="7730049">)</span><span class="op" id="7730050">;</span>&nbsp;<span class="ident" id="7730052">err</span>&nbsp;<span class="op" id="7730056">!=</span>&nbsp;<span class="ident" id="7730059">nil</span>&nbsp;<span class="op" id="7730063">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730067">t</span><span class="op" id="7730068">.</span><span class="ident" id="7730069">Fatal</span><span class="op" id="7730074">(</span><span class="ident" id="7730075">err</span><span class="op" id="7730078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730084">if</span>&nbsp;<span class="ident" id="7730087">err</span>&nbsp;<span class="op" id="7730091">:=</span>&nbsp;<span class="ident" id="7730094">writer</span><span class="op" id="7730100">.</span><span class="ident" id="7730101">Close</span><span class="op" id="7730106">(</span><span class="op" id="7730107">)</span><span class="op" id="7730108">;</span>&nbsp;<span class="ident" id="7730110">err</span>&nbsp;<span class="op" id="7730114">!=</span>&nbsp;<span class="ident" id="7730117">nil</span>&nbsp;<span class="op" id="7730121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730125">t</span><span class="op" id="7730126">.</span><span class="ident" id="7730127">Fatal</span><span class="op" id="7730132">(</span><span class="ident" id="7730133">err</span><span class="op" id="7730136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730139">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7730142">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730200">if</span>&nbsp;<span class="op" id="7730203">!</span><span class="ident" id="7730204">bytes</span><span class="op" id="7730209">.</span><span class="ident" id="7730210">Contains</span><span class="op" id="7730218">(</span><span class="ident" id="7730219">buf</span><span class="op" id="7730222">.</span><span class="ident" id="7730223">Bytes</span><span class="op" id="7730228">(</span><span class="op" id="7730229">)</span><span class="op" id="7730230">,</span>&nbsp;<span class="op" id="7730232">[</span><span class="op" id="7730233">]</span><span class="builtintype" id="7730234">byte</span><span class="op" id="7730238">(</span><span class="string" id="7730239">&#34;PaxHeaders.&#34;</span><span class="op" id="7730252">)</span><span class="op" id="7730253">)</span>&nbsp;<span class="op" id="7730255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730259">t</span><span class="op" id="7730260">.</span><span class="ident" id="7730261">Fatal</span><span class="op" id="7730266">(</span><span class="string" id="7730267">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7730316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7730322">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730384">reader</span>&nbsp;<span class="op" id="7730391">:=</span>&nbsp;<span class="ident" id="7730394">NewReader</span><span class="op" id="7730403">(</span><span class="op" id="7730404">&amp;</span><span class="ident" id="7730405">buf</span><span class="op" id="7730408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730411">hdr</span><span class="op" id="7730414">,</span>&nbsp;<span class="ident" id="7730416">err</span>&nbsp;<span class="op" id="7730420">=</span>&nbsp;<span class="ident" id="7730422">reader</span><span class="op" id="7730428">.</span><span class="ident" id="7730429">Next</span><span class="op" id="7730433">(</span><span class="op" id="7730434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730437">if</span>&nbsp;<span class="ident" id="7730440">err</span>&nbsp;<span class="op" id="7730444">!=</span>&nbsp;<span class="ident" id="7730447">nil</span>&nbsp;<span class="op" id="7730451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730455">t</span><span class="op" id="7730456">.</span><span class="ident" id="7730457">Fatal</span><span class="op" id="7730462">(</span><span class="ident" id="7730463">err</span><span class="op" id="7730466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730469">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730472">if</span>&nbsp;<span class="ident" id="7730475">hdr</span><span class="op" id="7730478">.</span><span class="ident" id="7730479">Name</span>&nbsp;<span class="op" id="7730484">!=</span>&nbsp;<span class="ident" id="7730487">longName</span>&nbsp;<span class="op" id="7730496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730500">t</span><span class="op" id="7730501">.</span><span class="ident" id="7730502">Fatal</span><span class="op" id="7730507">(</span><span class="string" id="7730508">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;file&nbsp;name&#34;</span><span class="op" id="7730541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730544">}</span><br>
<span class="lineno"></span><span class="op" id="7730546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="7730549">func</span>&nbsp;<span class="ident" id="7730554">TestPaxSymlink</span><span class="op" id="7730568">(</span><span class="ident" id="7730569">t</span>&nbsp;<span class="op" id="7730571">*</span><span class="ident" id="7730572">testing</span><span class="op" id="7730579">.</span><span class="ident" id="7730580">T</span><span class="op" id="7730581">)</span>&nbsp;<span class="op" id="7730583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7730586">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;large&nbsp;linkname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730630">fileinfo</span><span class="op" id="7730638">,</span>&nbsp;<span class="ident" id="7730640">err</span>&nbsp;<span class="op" id="7730644">:=</span>&nbsp;<span class="ident" id="7730647">os</span><span class="op" id="7730649">.</span><span class="ident" id="7730650">Stat</span><span class="op" id="7730654">(</span><span class="string" id="7730655">&#34;testdata/small.txt&#34;</span><span class="op" id="7730675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730678">if</span>&nbsp;<span class="ident" id="7730681">err</span>&nbsp;<span class="op" id="7730685">!=</span>&nbsp;<span class="ident" id="7730688">nil</span>&nbsp;<span class="op" id="7730692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730696">t</span><span class="op" id="7730697">.</span><span class="ident" id="7730698">Fatal</span><span class="op" id="7730703">(</span><span class="ident" id="7730704">err</span><span class="op" id="7730707">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730713">hdr</span><span class="op" id="7730716">,</span>&nbsp;<span class="ident" id="7730718">err</span>&nbsp;<span class="op" id="7730722">:=</span>&nbsp;<span class="ident" id="7730725">FileInfoHeader</span><span class="op" id="7730739">(</span><span class="ident" id="7730740">fileinfo</span><span class="op" id="7730748">,</span>&nbsp;<span class="string" id="7730750">&#34;&#34;</span><span class="op" id="7730752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730755">hdr</span><span class="op" id="7730758">.</span><span class="ident" id="7730759">Typeflag</span>&nbsp;<span class="op" id="7730768">=</span>&nbsp;<span class="ident" id="7730770">TypeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730783">if</span>&nbsp;<span class="ident" id="7730786">err</span>&nbsp;<span class="op" id="7730790">!=</span>&nbsp;<span class="ident" id="7730793">nil</span>&nbsp;<span class="op" id="7730797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730801">t</span><span class="op" id="7730802">.</span><span class="ident" id="7730803">Fatalf</span><span class="op" id="7730809">(</span><span class="string" id="7730810">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7730824">,</span>&nbsp;<span class="ident" id="7730826">err</span><span class="op" id="7730829">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7730832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7730835">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;linkname&nbsp;to&nbsp;be&nbsp;written</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730879">longLinkname</span>&nbsp;<span class="op" id="7730892">:=</span>&nbsp;<span class="ident" id="7730895">strings</span><span class="op" id="7730902">.</span><span class="ident" id="7730903">Repeat</span><span class="op" id="7730909">(</span><span class="string" id="7730910">&#34;1234567890/1234567890&#34;</span><span class="op" id="7730933">,</span>&nbsp;<span class="num" id="7730935">10</span><span class="op" id="7730937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730940">hdr</span><span class="op" id="7730943">.</span><span class="ident" id="7730944">Linkname</span>&nbsp;<span class="op" id="7730953">=</span>&nbsp;<span class="ident" id="7730955">longLinkname</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7730970">hdr</span><span class="op" id="7730973">.</span><span class="ident" id="7730974">Size</span>&nbsp;<span class="op" id="7730979">=</span>&nbsp;<span class="num" id="7730981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7730984">var</span>&nbsp;<span class="ident" id="7730988">buf</span>&nbsp;<span class="ident" id="7730992">bytes</span><span class="op" id="7730997">.</span><span class="ident" id="7730998">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731006">writer</span>&nbsp;<span class="op" id="7731013">:=</span>&nbsp;<span class="ident" id="7731016">NewWriter</span><span class="op" id="7731025">(</span><span class="op" id="7731026">&amp;</span><span class="ident" id="7731027">buf</span><span class="op" id="7731030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731033">if</span>&nbsp;<span class="ident" id="7731036">err</span>&nbsp;<span class="op" id="7731040">:=</span>&nbsp;<span class="ident" id="7731043">writer</span><span class="op" id="7731049">.</span><span class="ident" id="7731050">WriteHeader</span><span class="op" id="7731061">(</span><span class="ident" id="7731062">hdr</span><span class="op" id="7731065">)</span><span class="op" id="7731066">;</span>&nbsp;<span class="ident" id="7731068">err</span>&nbsp;<span class="op" id="7731072">!=</span>&nbsp;<span class="ident" id="7731075">nil</span>&nbsp;<span class="op" id="7731079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731083">t</span><span class="op" id="7731084">.</span><span class="ident" id="7731085">Fatal</span><span class="op" id="7731090">(</span><span class="ident" id="7731091">err</span><span class="op" id="7731094">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731100">if</span>&nbsp;<span class="ident" id="7731103">err</span>&nbsp;<span class="op" id="7731107">:=</span>&nbsp;<span class="ident" id="7731110">writer</span><span class="op" id="7731116">.</span><span class="ident" id="7731117">Close</span><span class="op" id="7731122">(</span><span class="op" id="7731123">)</span><span class="op" id="7731124">;</span>&nbsp;<span class="ident" id="7731126">err</span>&nbsp;<span class="op" id="7731130">!=</span>&nbsp;<span class="ident" id="7731133">nil</span>&nbsp;<span class="op" id="7731137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731141">t</span><span class="op" id="7731142">.</span><span class="ident" id="7731143">Fatal</span><span class="op" id="7731148">(</span><span class="ident" id="7731149">err</span><span class="op" id="7731152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7731158">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731216">if</span>&nbsp;<span class="op" id="7731219">!</span><span class="ident" id="7731220">bytes</span><span class="op" id="7731225">.</span><span class="ident" id="7731226">Contains</span><span class="op" id="7731234">(</span><span class="ident" id="7731235">buf</span><span class="op" id="7731238">.</span><span class="ident" id="7731239">Bytes</span><span class="op" id="7731244">(</span><span class="op" id="7731245">)</span><span class="op" id="7731246">,</span>&nbsp;<span class="op" id="7731248">[</span><span class="op" id="7731249">]</span><span class="builtintype" id="7731250">byte</span><span class="op" id="7731254">(</span><span class="string" id="7731255">&#34;PaxHeaders.&#34;</span><span class="op" id="7731268">)</span><span class="op" id="7731269">)</span>&nbsp;<span class="op" id="7731271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731275">t</span><span class="op" id="7731276">.</span><span class="ident" id="7731277">Fatal</span><span class="op" id="7731282">(</span><span class="string" id="7731283">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7731332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7731338">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731400">reader</span>&nbsp;<span class="op" id="7731407">:=</span>&nbsp;<span class="ident" id="7731410">NewReader</span><span class="op" id="7731419">(</span><span class="op" id="7731420">&amp;</span><span class="ident" id="7731421">buf</span><span class="op" id="7731424">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731427">hdr</span><span class="op" id="7731430">,</span>&nbsp;<span class="ident" id="7731432">err</span>&nbsp;<span class="op" id="7731436">=</span>&nbsp;<span class="ident" id="7731438">reader</span><span class="op" id="7731444">.</span><span class="ident" id="7731445">Next</span><span class="op" id="7731449">(</span><span class="op" id="7731450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731453">if</span>&nbsp;<span class="ident" id="7731456">err</span>&nbsp;<span class="op" id="7731460">!=</span>&nbsp;<span class="ident" id="7731463">nil</span>&nbsp;<span class="op" id="7731467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731471">t</span><span class="op" id="7731472">.</span><span class="ident" id="7731473">Fatal</span><span class="op" id="7731478">(</span><span class="ident" id="7731479">err</span><span class="op" id="7731482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731485">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731488">if</span>&nbsp;<span class="ident" id="7731491">hdr</span><span class="op" id="7731494">.</span><span class="ident" id="7731495">Linkname</span>&nbsp;<span class="op" id="7731504">!=</span>&nbsp;<span class="ident" id="7731507">longLinkname</span>&nbsp;<span class="op" id="7731520">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731524">t</span><span class="op" id="7731525">.</span><span class="ident" id="7731526">Fatal</span><span class="op" id="7731531">(</span><span class="string" id="7731532">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;link&nbsp;name&#34;</span><span class="op" id="7731565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731568">}</span><br>
<span class="lineno"></span><span class="op" id="7731570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7731573">func</span>&nbsp;<span class="ident" id="7731578">TestPaxNonAscii</span><span class="op" id="7731593">(</span><span class="ident" id="7731594">t</span>&nbsp;<span class="op" id="7731596">*</span><span class="ident" id="7731597">testing</span><span class="op" id="7731604">.</span><span class="ident" id="7731605">T</span><span class="op" id="7731606">)</span>&nbsp;<span class="op" id="7731608">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7731611">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;non&nbsp;ascii.&nbsp;These&nbsp;should&nbsp;trigger&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7731683">//&nbsp;because&nbsp;pax&nbsp;headers&nbsp;have&nbsp;a&nbsp;defined&nbsp;utf-8&nbsp;encoding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731738">fileinfo</span><span class="op" id="7731746">,</span>&nbsp;<span class="ident" id="7731748">err</span>&nbsp;<span class="op" id="7731752">:=</span>&nbsp;<span class="ident" id="7731755">os</span><span class="op" id="7731757">.</span><span class="ident" id="7731758">Stat</span><span class="op" id="7731762">(</span><span class="string" id="7731763">&#34;testdata/small.txt&#34;</span><span class="op" id="7731783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731786">if</span>&nbsp;<span class="ident" id="7731789">err</span>&nbsp;<span class="op" id="7731793">!=</span>&nbsp;<span class="ident" id="7731796">nil</span>&nbsp;<span class="op" id="7731800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731804">t</span><span class="op" id="7731805">.</span><span class="ident" id="7731806">Fatal</span><span class="op" id="7731811">(</span><span class="ident" id="7731812">err</span><span class="op" id="7731815">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731822">hdr</span><span class="op" id="7731825">,</span>&nbsp;<span class="ident" id="7731827">err</span>&nbsp;<span class="op" id="7731831">:=</span>&nbsp;<span class="ident" id="7731834">FileInfoHeader</span><span class="op" id="7731848">(</span><span class="ident" id="7731849">fileinfo</span><span class="op" id="7731857">,</span>&nbsp;<span class="string" id="7731859">&#34;&#34;</span><span class="op" id="7731861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7731864">if</span>&nbsp;<span class="ident" id="7731867">err</span>&nbsp;<span class="op" id="7731871">!=</span>&nbsp;<span class="ident" id="7731874">nil</span>&nbsp;<span class="op" id="7731878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731882">t</span><span class="op" id="7731883">.</span><span class="ident" id="7731884">Fatalf</span><span class="op" id="7731890">(</span><span class="string" id="7731891">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7731905">,</span>&nbsp;<span class="ident" id="7731907">err</span><span class="op" id="7731910">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7731913">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7731917">//&nbsp;some&nbsp;sample&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731938">chineseFilename</span>&nbsp;<span class="op" id="7731954">:=</span>&nbsp;<span class="string" id="7731957">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731970">chineseGroupname</span>&nbsp;<span class="op" id="7731987">:=</span>&nbsp;<span class="string" id="7731990">&#34;&#34;</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7731997">chineseUsername</span>&nbsp;<span class="op" id="7732013">:=</span>&nbsp;<span class="string" id="7732016">&#34;&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732030">hdr</span><span class="op" id="7732033">.</span><span class="ident" id="7732034">Name</span>&nbsp;<span class="op" id="7732039">=</span>&nbsp;<span class="ident" id="7732041">chineseFilename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732058">hdr</span><span class="op" id="7732061">.</span><span class="ident" id="7732062">Gname</span>&nbsp;<span class="op" id="7732068">=</span>&nbsp;<span class="ident" id="7732070">chineseGroupname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732088">hdr</span><span class="op" id="7732091">.</span><span class="ident" id="7732092">Uname</span>&nbsp;<span class="op" id="7732098">=</span>&nbsp;<span class="ident" id="7732100">chineseUsername</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732118">contents</span>&nbsp;<span class="op" id="7732127">:=</span>&nbsp;<span class="ident" id="7732130">strings</span><span class="op" id="7732137">.</span><span class="ident" id="7732138">Repeat</span><span class="op" id="7732144">(</span><span class="string" id="7732145">&#34;&nbsp;&#34;</span><span class="op" id="7732148">,</span>&nbsp;<span class="builtintype" id="7732150">int</span><span class="op" id="7732153">(</span><span class="ident" id="7732154">hdr</span><span class="op" id="7732157">.</span><span class="ident" id="7732158">Size</span><span class="op" id="7732162">)</span><span class="op" id="7732163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732167">var</span>&nbsp;<span class="ident" id="7732171">buf</span>&nbsp;<span class="ident" id="7732175">bytes</span><span class="op" id="7732180">.</span><span class="ident" id="7732181">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732189">writer</span>&nbsp;<span class="op" id="7732196">:=</span>&nbsp;<span class="ident" id="7732199">NewWriter</span><span class="op" id="7732208">(</span><span class="op" id="7732209">&amp;</span><span class="ident" id="7732210">buf</span><span class="op" id="7732213">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732216">if</span>&nbsp;<span class="ident" id="7732219">err</span>&nbsp;<span class="op" id="7732223">:=</span>&nbsp;<span class="ident" id="7732226">writer</span><span class="op" id="7732232">.</span><span class="ident" id="7732233">WriteHeader</span><span class="op" id="7732244">(</span><span class="ident" id="7732245">hdr</span><span class="op" id="7732248">)</span><span class="op" id="7732249">;</span>&nbsp;<span class="ident" id="7732251">err</span>&nbsp;<span class="op" id="7732255">!=</span>&nbsp;<span class="ident" id="7732258">nil</span>&nbsp;<span class="op" id="7732262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732266">t</span><span class="op" id="7732267">.</span><span class="ident" id="7732268">Fatal</span><span class="op" id="7732273">(</span><span class="ident" id="7732274">err</span><span class="op" id="7732277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732283">if</span>&nbsp;<span class="ident" id="7732286">_</span><span class="op" id="7732287">,</span>&nbsp;<span class="ident" id="7732289">err</span>&nbsp;<span class="op" id="7732293">=</span>&nbsp;<span class="ident" id="7732295">writer</span><span class="op" id="7732301">.</span><span class="ident" id="7732302">Write</span><span class="op" id="7732307">(</span><span class="op" id="7732308">[</span><span class="op" id="7732309">]</span><span class="builtintype" id="7732310">byte</span><span class="op" id="7732314">(</span><span class="ident" id="7732315">contents</span><span class="op" id="7732323">)</span><span class="op" id="7732324">)</span><span class="op" id="7732325">;</span>&nbsp;<span class="ident" id="7732327">err</span>&nbsp;<span class="op" id="7732331">!=</span>&nbsp;<span class="ident" id="7732334">nil</span>&nbsp;<span class="op" id="7732338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732342">t</span><span class="op" id="7732343">.</span><span class="ident" id="7732344">Fatal</span><span class="op" id="7732349">(</span><span class="ident" id="7732350">err</span><span class="op" id="7732353">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732359">if</span>&nbsp;<span class="ident" id="7732362">err</span>&nbsp;<span class="op" id="7732366">:=</span>&nbsp;<span class="ident" id="7732369">writer</span><span class="op" id="7732375">.</span><span class="ident" id="7732376">Close</span><span class="op" id="7732381">(</span><span class="op" id="7732382">)</span><span class="op" id="7732383">;</span>&nbsp;<span class="ident" id="7732385">err</span>&nbsp;<span class="op" id="7732389">!=</span>&nbsp;<span class="ident" id="7732392">nil</span>&nbsp;<span class="op" id="7732396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732400">t</span><span class="op" id="7732401">.</span><span class="ident" id="7732402">Fatal</span><span class="op" id="7732407">(</span><span class="ident" id="7732408">err</span><span class="op" id="7732411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7732417">//&nbsp;Simple&nbsp;test&nbsp;to&nbsp;make&nbsp;sure&nbsp;PAX&nbsp;extensions&nbsp;are&nbsp;in&nbsp;effect</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732475">if</span>&nbsp;<span class="op" id="7732478">!</span><span class="ident" id="7732479">bytes</span><span class="op" id="7732484">.</span><span class="ident" id="7732485">Contains</span><span class="op" id="7732493">(</span><span class="ident" id="7732494">buf</span><span class="op" id="7732497">.</span><span class="ident" id="7732498">Bytes</span><span class="op" id="7732503">(</span><span class="op" id="7732504">)</span><span class="op" id="7732505">,</span>&nbsp;<span class="op" id="7732507">[</span><span class="op" id="7732508">]</span><span class="builtintype" id="7732509">byte</span><span class="op" id="7732513">(</span><span class="string" id="7732514">&#34;PaxHeaders.&#34;</span><span class="op" id="7732527">)</span><span class="op" id="7732528">)</span>&nbsp;<span class="op" id="7732530">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732534">t</span><span class="op" id="7732535">.</span><span class="ident" id="7732536">Fatal</span><span class="op" id="7732541">(</span><span class="string" id="7732542">&#34;Expected&nbsp;at&nbsp;least&nbsp;one&nbsp;PAX&nbsp;header&nbsp;to&nbsp;be&nbsp;written.&#34;</span><span class="op" id="7732591">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7732597">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732659">reader</span>&nbsp;<span class="op" id="7732666">:=</span>&nbsp;<span class="ident" id="7732669">NewReader</span><span class="op" id="7732678">(</span><span class="op" id="7732679">&amp;</span><span class="ident" id="7732680">buf</span><span class="op" id="7732683">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732686">hdr</span><span class="op" id="7732689">,</span>&nbsp;<span class="ident" id="7732691">err</span>&nbsp;<span class="op" id="7732695">=</span>&nbsp;<span class="ident" id="7732697">reader</span><span class="op" id="7732703">.</span><span class="ident" id="7732704">Next</span><span class="op" id="7732708">(</span><span class="op" id="7732709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732712">if</span>&nbsp;<span class="ident" id="7732715">err</span>&nbsp;<span class="op" id="7732719">!=</span>&nbsp;<span class="ident" id="7732722">nil</span>&nbsp;<span class="op" id="7732726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732730">t</span><span class="op" id="7732731">.</span><span class="ident" id="7732732">Fatal</span><span class="op" id="7732737">(</span><span class="ident" id="7732738">err</span><span class="op" id="7732741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732747">if</span>&nbsp;<span class="ident" id="7732750">hdr</span><span class="op" id="7732753">.</span><span class="ident" id="7732754">Name</span>&nbsp;<span class="op" id="7732759">!=</span>&nbsp;<span class="ident" id="7732762">chineseFilename</span>&nbsp;<span class="op" id="7732778">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732782">t</span><span class="op" id="7732783">.</span><span class="ident" id="7732784">Fatal</span><span class="op" id="7732789">(</span><span class="string" id="7732790">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;name&#34;</span><span class="op" id="7732821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732827">if</span>&nbsp;<span class="ident" id="7732830">hdr</span><span class="op" id="7732833">.</span><span class="ident" id="7732834">Gname</span>&nbsp;<span class="op" id="7732840">!=</span>&nbsp;<span class="ident" id="7732843">chineseGroupname</span>&nbsp;<span class="op" id="7732860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732864">t</span><span class="op" id="7732865">.</span><span class="ident" id="7732866">Fatal</span><span class="op" id="7732871">(</span><span class="string" id="7732872">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;group&#34;</span><span class="op" id="7732904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732907">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7732910">if</span>&nbsp;<span class="ident" id="7732913">hdr</span><span class="op" id="7732916">.</span><span class="ident" id="7732917">Uname</span>&nbsp;<span class="op" id="7732923">!=</span>&nbsp;<span class="ident" id="7732926">chineseUsername</span>&nbsp;<span class="op" id="7732942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7732946">t</span><span class="op" id="7732947">.</span><span class="ident" id="7732948">Fatal</span><span class="op" id="7732953">(</span><span class="string" id="7732954">&#34;Couldn&#39;t&nbsp;recover&nbsp;unicode&nbsp;user&#34;</span><span class="op" id="7732985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7732988">}</span><br>
<span class="lineno"></span><span class="op" id="7732990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">365</span><span class="keyword" id="7732993">func</span>&nbsp;<span class="ident" id="7732998">TestPaxXattrs</span><span class="op" id="7733011">(</span><span class="ident" id="7733012">t</span>&nbsp;<span class="op" id="7733014">*</span><span class="ident" id="7733015">testing</span><span class="op" id="7733022">.</span><span class="ident" id="7733023">T</span><span class="op" id="7733024">)</span>&nbsp;<span class="op" id="7733026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733029">xattrs</span>&nbsp;<span class="op" id="7733036">:=</span>&nbsp;<span class="keyword" id="7733039">map</span><span class="op" id="7733042">[</span><span class="builtintype" id="7733043">string</span><span class="op" id="7733049">]</span><span class="builtintype" id="7733050">string</span><span class="op" id="7733056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7733060">&#34;user.key&#34;</span><span class="op" id="7733070">:</span>&nbsp;<span class="string" id="7733072">&#34;value&#34;</span><span class="op" id="7733079">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7733086">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;an&nbsp;xattr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733122">fileinfo</span><span class="op" id="7733130">,</span>&nbsp;<span class="ident" id="7733132">err</span>&nbsp;<span class="op" id="7733136">:=</span>&nbsp;<span class="ident" id="7733139">os</span><span class="op" id="7733141">.</span><span class="ident" id="7733142">Stat</span><span class="op" id="7733146">(</span><span class="string" id="7733147">&#34;testdata/small.txt&#34;</span><span class="op" id="7733167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733170">if</span>&nbsp;<span class="ident" id="7733173">err</span>&nbsp;<span class="op" id="7733177">!=</span>&nbsp;<span class="ident" id="7733180">nil</span>&nbsp;<span class="op" id="7733184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733188">t</span><span class="op" id="7733189">.</span><span class="ident" id="7733190">Fatal</span><span class="op" id="7733195">(</span><span class="ident" id="7733196">err</span><span class="op" id="7733199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733202">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733205">hdr</span><span class="op" id="7733208">,</span>&nbsp;<span class="ident" id="7733210">err</span>&nbsp;<span class="op" id="7733214">:=</span>&nbsp;<span class="ident" id="7733217">FileInfoHeader</span><span class="op" id="7733231">(</span><span class="ident" id="7733232">fileinfo</span><span class="op" id="7733240">,</span>&nbsp;<span class="string" id="7733242">&#34;&#34;</span><span class="op" id="7733244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733247">if</span>&nbsp;<span class="ident" id="7733250">err</span>&nbsp;<span class="op" id="7733254">!=</span>&nbsp;<span class="ident" id="7733257">nil</span>&nbsp;<span class="op" id="7733261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733265">t</span><span class="op" id="7733266">.</span><span class="ident" id="7733267">Fatalf</span><span class="op" id="7733273">(</span><span class="string" id="7733274">&#34;os.Stat:&nbsp;%v&#34;</span><span class="op" id="7733287">,</span>&nbsp;<span class="ident" id="7733289">err</span><span class="op" id="7733292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733295">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733298">contents</span>&nbsp;<span class="op" id="7733307">:=</span>&nbsp;<span class="string" id="7733310">&#34;Kilts&#34;</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733319">hdr</span><span class="op" id="7733322">.</span><span class="ident" id="7733323">Xattrs</span>&nbsp;<span class="op" id="7733330">=</span>&nbsp;<span class="ident" id="7733332">xattrs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733340">var</span>&nbsp;<span class="ident" id="7733344">buf</span>&nbsp;<span class="ident" id="7733348">bytes</span><span class="op" id="7733353">.</span><span class="ident" id="7733354">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733362">writer</span>&nbsp;<span class="op" id="7733369">:=</span>&nbsp;<span class="ident" id="7733372">NewWriter</span><span class="op" id="7733381">(</span><span class="op" id="7733382">&amp;</span><span class="ident" id="7733383">buf</span><span class="op" id="7733386">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733389">if</span>&nbsp;<span class="ident" id="7733392">err</span>&nbsp;<span class="op" id="7733396">:=</span>&nbsp;<span class="ident" id="7733399">writer</span><span class="op" id="7733405">.</span><span class="ident" id="7733406">WriteHeader</span><span class="op" id="7733417">(</span><span class="ident" id="7733418">hdr</span><span class="op" id="7733421">)</span><span class="op" id="7733422">;</span>&nbsp;<span class="ident" id="7733424">err</span>&nbsp;<span class="op" id="7733428">!=</span>&nbsp;<span class="ident" id="7733431">nil</span>&nbsp;<span class="op" id="7733435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733439">t</span><span class="op" id="7733440">.</span><span class="ident" id="7733441">Fatal</span><span class="op" id="7733446">(</span><span class="ident" id="7733447">err</span><span class="op" id="7733450">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733456">if</span>&nbsp;<span class="ident" id="7733459">_</span><span class="op" id="7733460">,</span>&nbsp;<span class="ident" id="7733462">err</span>&nbsp;<span class="op" id="7733466">=</span>&nbsp;<span class="ident" id="7733468">writer</span><span class="op" id="7733474">.</span><span class="ident" id="7733475">Write</span><span class="op" id="7733480">(</span><span class="op" id="7733481">[</span><span class="op" id="7733482">]</span><span class="builtintype" id="7733483">byte</span><span class="op" id="7733487">(</span><span class="ident" id="7733488">contents</span><span class="op" id="7733496">)</span><span class="op" id="7733497">)</span><span class="op" id="7733498">;</span>&nbsp;<span class="ident" id="7733500">err</span>&nbsp;<span class="op" id="7733504">!=</span>&nbsp;<span class="ident" id="7733507">nil</span>&nbsp;<span class="op" id="7733511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733515">t</span><span class="op" id="7733516">.</span><span class="ident" id="7733517">Fatal</span><span class="op" id="7733522">(</span><span class="ident" id="7733523">err</span><span class="op" id="7733526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733532">if</span>&nbsp;<span class="ident" id="7733535">err</span>&nbsp;<span class="op" id="7733539">:=</span>&nbsp;<span class="ident" id="7733542">writer</span><span class="op" id="7733548">.</span><span class="ident" id="7733549">Close</span><span class="op" id="7733554">(</span><span class="op" id="7733555">)</span><span class="op" id="7733556">;</span>&nbsp;<span class="ident" id="7733558">err</span>&nbsp;<span class="op" id="7733562">!=</span>&nbsp;<span class="ident" id="7733565">nil</span>&nbsp;<span class="op" id="7733569">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733573">t</span><span class="op" id="7733574">.</span><span class="ident" id="7733575">Fatal</span><span class="op" id="7733580">(</span><span class="ident" id="7733581">err</span><span class="op" id="7733584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7733590">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;the&nbsp;xattrs&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733651">reader</span>&nbsp;<span class="op" id="7733658">:=</span>&nbsp;<span class="ident" id="7733661">NewReader</span><span class="op" id="7733670">(</span><span class="op" id="7733671">&amp;</span><span class="ident" id="7733672">buf</span><span class="op" id="7733675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733678">hdr</span><span class="op" id="7733681">,</span>&nbsp;<span class="ident" id="7733683">err</span>&nbsp;<span class="op" id="7733687">=</span>&nbsp;<span class="ident" id="7733689">reader</span><span class="op" id="7733695">.</span><span class="ident" id="7733696">Next</span><span class="op" id="7733700">(</span><span class="op" id="7733701">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733704">if</span>&nbsp;<span class="ident" id="7733707">err</span>&nbsp;<span class="op" id="7733711">!=</span>&nbsp;<span class="ident" id="7733714">nil</span>&nbsp;<span class="op" id="7733718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733722">t</span><span class="op" id="7733723">.</span><span class="ident" id="7733724">Fatal</span><span class="op" id="7733729">(</span><span class="ident" id="7733730">err</span><span class="op" id="7733733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7733739">if</span>&nbsp;<span class="op" id="7733742">!</span><span class="ident" id="7733743">reflect</span><span class="op" id="7733750">.</span><span class="ident" id="7733751">DeepEqual</span><span class="op" id="7733760">(</span><span class="ident" id="7733761">hdr</span><span class="op" id="7733764">.</span><span class="ident" id="7733765">Xattrs</span><span class="op" id="7733771">,</span>&nbsp;<span class="ident" id="7733773">xattrs</span><span class="op" id="7733779">)</span>&nbsp;<span class="op" id="7733781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733785">t</span><span class="op" id="7733786">.</span><span class="ident" id="7733787">Fatalf</span><span class="op" id="7733793">(</span><span class="string" id="7733794">&#34;xattrs&nbsp;did&nbsp;not&nbsp;survive&nbsp;round&nbsp;trip:&nbsp;got&nbsp;%+v,&nbsp;want&nbsp;%+v&#34;</span><span class="op" id="7733848">,</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733853">hdr</span><span class="op" id="7733856">.</span><span class="ident" id="7733857">Xattrs</span><span class="op" id="7733863">,</span>&nbsp;<span class="ident" id="7733865">xattrs</span><span class="op" id="7733871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7733874">}</span><br>
<span class="lineno"></span><span class="op" id="7733876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7733879">func</span>&nbsp;<span class="ident" id="7733884">TestPAXHeader</span><span class="op" id="7733897">(</span><span class="ident" id="7733898">t</span>&nbsp;<span class="op" id="7733900">*</span><span class="ident" id="7733901">testing</span><span class="op" id="7733908">.</span><span class="ident" id="7733909">T</span><span class="op" id="7733910">)</span>&nbsp;<span class="op" id="7733912">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733915">medName</span>&nbsp;<span class="op" id="7733923">:=</span>&nbsp;<span class="ident" id="7733926">strings</span><span class="op" id="7733933">.</span><span class="ident" id="7733934">Repeat</span><span class="op" id="7733940">(</span><span class="string" id="7733941">&#34;CD&#34;</span><span class="op" id="7733945">,</span>&nbsp;<span class="num" id="7733947">50</span><span class="op" id="7733949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733952">longName</span>&nbsp;<span class="op" id="7733961">:=</span>&nbsp;<span class="ident" id="7733964">strings</span><span class="op" id="7733971">.</span><span class="ident" id="7733972">Repeat</span><span class="op" id="7733978">(</span><span class="string" id="7733979">&#34;AB&#34;</span><span class="op" id="7733983">,</span>&nbsp;<span class="num" id="7733985">100</span><span class="op" id="7733988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7733991">paxTests</span>&nbsp;<span class="op" id="7734000">:=</span>&nbsp;<span class="op" id="7734003">[</span><span class="op" id="7734004">]</span><span class="op" id="7734005">[</span><span class="num" id="7734006">2</span><span class="op" id="7734007">]</span><span class="builtintype" id="7734008">string</span><span class="op" id="7734014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734018">{</span><span class="ident" id="7734019">paxPath</span>&nbsp;<span class="op" id="7734027">+</span>&nbsp;<span class="string" id="7734029">&#34;=/etc/hosts&#34;</span><span class="op" id="7734042">,</span>&nbsp;<span class="string" id="7734044">&#34;19&nbsp;path=/etc/hosts\n&#34;</span><span class="op" id="7734066">}</span><span class="op" id="7734067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734071">{</span><span class="string" id="7734072">&#34;a=b&#34;</span><span class="op" id="7734077">,</span>&nbsp;<span class="string" id="7734079">&#34;6&nbsp;a=b\n&#34;</span><span class="op" id="7734088">}</span><span class="op" id="7734089">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7734100">//&nbsp;Single&nbsp;digit&nbsp;length</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734125">{</span><span class="string" id="7734126">&#34;a=names&#34;</span><span class="op" id="7734135">,</span>&nbsp;<span class="string" id="7734137">&#34;11&nbsp;a=names\n&#34;</span><span class="op" id="7734151">}</span><span class="op" id="7734152">,</span>&nbsp;<span class="comment" id="7734154">//&nbsp;Test&nbsp;case&nbsp;involving&nbsp;carries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734187">{</span><span class="ident" id="7734188">paxPath</span>&nbsp;<span class="op" id="7734196">+</span>&nbsp;<span class="string" id="7734198">&#34;=&#34;</span>&nbsp;<span class="op" id="7734202">+</span>&nbsp;<span class="ident" id="7734204">longName</span><span class="op" id="7734212">,</span>&nbsp;<span class="ident" id="7734214">fmt</span><span class="op" id="7734217">.</span><span class="ident" id="7734218">Sprintf</span><span class="op" id="7734225">(</span><span class="string" id="7734226">&#34;210&nbsp;path=%s\n&#34;</span><span class="op" id="7734241">,</span>&nbsp;<span class="ident" id="7734243">longName</span><span class="op" id="7734251">)</span><span class="op" id="7734252">}</span><span class="op" id="7734253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734257">{</span><span class="ident" id="7734258">paxPath</span>&nbsp;<span class="op" id="7734266">+</span>&nbsp;<span class="string" id="7734268">&#34;=&#34;</span>&nbsp;<span class="op" id="7734272">+</span>&nbsp;<span class="ident" id="7734274">medName</span><span class="op" id="7734281">,</span>&nbsp;<span class="ident" id="7734283">fmt</span><span class="op" id="7734286">.</span><span class="ident" id="7734287">Sprintf</span><span class="op" id="7734294">(</span><span class="string" id="7734295">&#34;110&nbsp;path=%s\n&#34;</span><span class="op" id="7734310">,</span>&nbsp;<span class="ident" id="7734312">medName</span><span class="op" id="7734319">)</span><span class="op" id="7734320">}</span><span class="op" id="7734321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734325">for</span>&nbsp;<span class="ident" id="7734329">_</span><span class="op" id="7734330">,</span>&nbsp;<span class="ident" id="7734332">test</span>&nbsp;<span class="op" id="7734337">:=</span>&nbsp;<span class="keyword" id="7734340">range</span>&nbsp;<span class="ident" id="7734346">paxTests</span>&nbsp;<span class="op" id="7734355">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734359">key</span><span class="op" id="7734362">,</span>&nbsp;<span class="ident" id="7734364">expected</span>&nbsp;<span class="op" id="7734373">:=</span>&nbsp;<span class="ident" id="7734376">test</span><span class="op" id="7734380">[</span><span class="num" id="7734381">0</span><span class="op" id="7734382">]</span><span class="op" id="7734383">,</span>&nbsp;<span class="ident" id="7734385">test</span><span class="op" id="7734389">[</span><span class="num" id="7734390">1</span><span class="op" id="7734391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734395">if</span>&nbsp;<span class="ident" id="7734398">result</span>&nbsp;<span class="op" id="7734405">:=</span>&nbsp;<span class="ident" id="7734408">paxHeader</span><span class="op" id="7734417">(</span><span class="ident" id="7734418">key</span><span class="op" id="7734421">)</span><span class="op" id="7734422">;</span>&nbsp;<span class="ident" id="7734424">result</span>&nbsp;<span class="op" id="7734431">!=</span>&nbsp;<span class="ident" id="7734434">expected</span>&nbsp;<span class="op" id="7734443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734448">t</span><span class="op" id="7734449">.</span><span class="ident" id="7734450">Fatalf</span><span class="op" id="7734456">(</span><span class="string" id="7734457">&#34;paxHeader:&nbsp;got&nbsp;%s,&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="7734489">,</span>&nbsp;<span class="ident" id="7734491">result</span><span class="op" id="7734497">,</span>&nbsp;<span class="ident" id="7734499">expected</span><span class="op" id="7734507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734514">}</span><br>
<span class="lineno">420</span><span class="op" id="7734516">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7734519">func</span>&nbsp;<span class="ident" id="7734524">TestUSTARLongName</span><span class="op" id="7734541">(</span><span class="ident" id="7734542">t</span>&nbsp;<span class="op" id="7734544">*</span><span class="ident" id="7734545">testing</span><span class="op" id="7734552">.</span><span class="ident" id="7734553">T</span><span class="op" id="7734554">)</span>&nbsp;<span class="op" id="7734556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7734559">//&nbsp;Create&nbsp;an&nbsp;archive&nbsp;with&nbsp;a&nbsp;path&nbsp;that&nbsp;failed&nbsp;to&nbsp;split&nbsp;with&nbsp;USTAR&nbsp;extension&nbsp;in&nbsp;previous&nbsp;versions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734657">fileinfo</span><span class="op" id="7734665">,</span>&nbsp;<span class="ident" id="7734667">err</span>&nbsp;<span class="op" id="7734671">:=</span>&nbsp;<span class="ident" id="7734674">os</span><span class="op" id="7734676">.</span><span class="ident" id="7734677">Stat</span><span class="op" id="7734681">(</span><span class="string" id="7734682">&#34;testdata/small.txt&#34;</span><span class="op" id="7734702">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734705">if</span>&nbsp;<span class="ident" id="7734708">err</span>&nbsp;<span class="op" id="7734712">!=</span>&nbsp;<span class="ident" id="7734715">nil</span>&nbsp;<span class="op" id="7734719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734723">t</span><span class="op" id="7734724">.</span><span class="ident" id="7734725">Fatal</span><span class="op" id="7734730">(</span><span class="ident" id="7734731">err</span><span class="op" id="7734734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734740">hdr</span><span class="op" id="7734743">,</span>&nbsp;<span class="ident" id="7734745">err</span>&nbsp;<span class="op" id="7734749">:=</span>&nbsp;<span class="ident" id="7734752">FileInfoHeader</span><span class="op" id="7734766">(</span><span class="ident" id="7734767">fileinfo</span><span class="op" id="7734775">,</span>&nbsp;<span class="string" id="7734777">&#34;&#34;</span><span class="op" id="7734779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734782">hdr</span><span class="op" id="7734785">.</span><span class="ident" id="7734786">Typeflag</span>&nbsp;<span class="op" id="7734795">=</span>&nbsp;<span class="ident" id="7734797">TypeDir</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7734806">if</span>&nbsp;<span class="ident" id="7734809">err</span>&nbsp;<span class="op" id="7734813">!=</span>&nbsp;<span class="ident" id="7734816">nil</span>&nbsp;<span class="op" id="7734820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7734824">t</span><span class="op" id="7734825">.</span><span class="ident" id="7734826">Fatalf</span><span class="op" id="7734832">(</span><span class="string" id="7734833">&#34;os.Stat:1&nbsp;%v&#34;</span><span class="op" id="7734847">,</span>&nbsp;<span class="ident" id="7734849">err</span><span class="op" id="7734852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7734855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7734858">//&nbsp;Force&nbsp;a&nbsp;PAX&nbsp;long&nbsp;name&nbsp;to&nbsp;be&nbsp;written.&nbsp;The&nbsp;name&nbsp;was&nbsp;taken&nbsp;from&nbsp;a&nbsp;practical&nbsp;example</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7734943">//&nbsp;that&nbsp;fails&nbsp;and&nbsp;replaced&nbsp;ever&nbsp;char&nbsp;through&nbsp;numbers&nbsp;to&nbsp;anonymize&nbsp;the&nbsp;sample.</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735022">longName</span>&nbsp;<span class="op" id="7735031">:=</span>&nbsp;<span class="string" id="7735034">&#34;/0000_0000000/00000-000000000/0000_0000000/00000-0000000000000/0000_0000000/00000-0000000-00000000/0000_0000000/00000000/0000_0000000/000/0000_0000000/00000000v00/0000_0000000/000000/0000_0000000/0000000/0000_0000000/00000y-00/0000/0000/00000000/0x000000/&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735293">hdr</span><span class="op" id="7735296">.</span><span class="ident" id="7735297">Name</span>&nbsp;<span class="op" id="7735302">=</span>&nbsp;<span class="ident" id="7735304">longName</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735315">hdr</span><span class="op" id="7735318">.</span><span class="ident" id="7735319">Size</span>&nbsp;<span class="op" id="7735324">=</span>&nbsp;<span class="num" id="7735326">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735329">var</span>&nbsp;<span class="ident" id="7735333">buf</span>&nbsp;<span class="ident" id="7735337">bytes</span><span class="op" id="7735342">.</span><span class="ident" id="7735343">Buffer</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735351">writer</span>&nbsp;<span class="op" id="7735358">:=</span>&nbsp;<span class="ident" id="7735361">NewWriter</span><span class="op" id="7735370">(</span><span class="op" id="7735371">&amp;</span><span class="ident" id="7735372">buf</span><span class="op" id="7735375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735378">if</span>&nbsp;<span class="ident" id="7735381">err</span>&nbsp;<span class="op" id="7735385">:=</span>&nbsp;<span class="ident" id="7735388">writer</span><span class="op" id="7735394">.</span><span class="ident" id="7735395">WriteHeader</span><span class="op" id="7735406">(</span><span class="ident" id="7735407">hdr</span><span class="op" id="7735410">)</span><span class="op" id="7735411">;</span>&nbsp;<span class="ident" id="7735413">err</span>&nbsp;<span class="op" id="7735417">!=</span>&nbsp;<span class="ident" id="7735420">nil</span>&nbsp;<span class="op" id="7735424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735428">t</span><span class="op" id="7735429">.</span><span class="ident" id="7735430">Fatal</span><span class="op" id="7735435">(</span><span class="ident" id="7735436">err</span><span class="op" id="7735439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735445">if</span>&nbsp;<span class="ident" id="7735448">err</span>&nbsp;<span class="op" id="7735452">:=</span>&nbsp;<span class="ident" id="7735455">writer</span><span class="op" id="7735461">.</span><span class="ident" id="7735462">Close</span><span class="op" id="7735467">(</span><span class="op" id="7735468">)</span><span class="op" id="7735469">;</span>&nbsp;<span class="ident" id="7735471">err</span>&nbsp;<span class="op" id="7735475">!=</span>&nbsp;<span class="ident" id="7735478">nil</span>&nbsp;<span class="op" id="7735482">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735486">t</span><span class="op" id="7735487">.</span><span class="ident" id="7735488">Fatal</span><span class="op" id="7735493">(</span><span class="ident" id="7735494">err</span><span class="op" id="7735497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735500">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7735503">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;long&nbsp;name&nbsp;back&nbsp;out&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735565">reader</span>&nbsp;<span class="op" id="7735572">:=</span>&nbsp;<span class="ident" id="7735575">NewReader</span><span class="op" id="7735584">(</span><span class="op" id="7735585">&amp;</span><span class="ident" id="7735586">buf</span><span class="op" id="7735589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735592">hdr</span><span class="op" id="7735595">,</span>&nbsp;<span class="ident" id="7735597">err</span>&nbsp;<span class="op" id="7735601">=</span>&nbsp;<span class="ident" id="7735603">reader</span><span class="op" id="7735609">.</span><span class="ident" id="7735610">Next</span><span class="op" id="7735614">(</span><span class="op" id="7735615">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735618">if</span>&nbsp;<span class="ident" id="7735621">err</span>&nbsp;<span class="op" id="7735625">!=</span>&nbsp;<span class="ident" id="7735628">nil</span>&nbsp;<span class="op" id="7735632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735636">t</span><span class="op" id="7735637">.</span><span class="ident" id="7735638">Fatal</span><span class="op" id="7735643">(</span><span class="ident" id="7735644">err</span><span class="op" id="7735647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735653">if</span>&nbsp;<span class="ident" id="7735656">hdr</span><span class="op" id="7735659">.</span><span class="ident" id="7735660">Name</span>&nbsp;<span class="op" id="7735665">!=</span>&nbsp;<span class="ident" id="7735668">longName</span>&nbsp;<span class="op" id="7735677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735681">t</span><span class="op" id="7735682">.</span><span class="ident" id="7735683">Fatal</span><span class="op" id="7735688">(</span><span class="string" id="7735689">&#34;Couldn&#39;t&nbsp;recover&nbsp;long&nbsp;name&#34;</span><span class="op" id="7735717">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735720">}</span><br>
<span class="lineno"></span><span class="op" id="7735722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7735725">func</span>&nbsp;<span class="ident" id="7735730">TestValidTypeflagWithPAXHeader</span><span class="op" id="7735760">(</span><span class="ident" id="7735761">t</span>&nbsp;<span class="op" id="7735763">*</span><span class="ident" id="7735764">testing</span><span class="op" id="7735771">.</span><span class="ident" id="7735772">T</span><span class="op" id="7735773">)</span>&nbsp;<span class="op" id="7735775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735778">var</span>&nbsp;<span class="ident" id="7735782">buffer</span>&nbsp;<span class="ident" id="7735789">bytes</span><span class="op" id="7735794">.</span><span class="ident" id="7735795">Buffer</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735803">tw</span>&nbsp;<span class="op" id="7735806">:=</span>&nbsp;<span class="ident" id="7735809">NewWriter</span><span class="op" id="7735818">(</span><span class="op" id="7735819">&amp;</span><span class="ident" id="7735820">buffer</span><span class="op" id="7735826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735830">fileName</span>&nbsp;<span class="op" id="7735839">:=</span>&nbsp;<span class="ident" id="7735842">strings</span><span class="op" id="7735849">.</span><span class="ident" id="7735850">Repeat</span><span class="op" id="7735856">(</span><span class="string" id="7735857">&#34;ab&#34;</span><span class="op" id="7735861">,</span>&nbsp;<span class="num" id="7735863">100</span><span class="op" id="7735866">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735870">hdr</span>&nbsp;<span class="op" id="7735874">:=</span>&nbsp;<span class="op" id="7735877">&amp;</span><span class="ident" id="7735878">Header</span><span class="op" id="7735884">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735888">Name</span><span class="op" id="7735892">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7735898">fileName</span><span class="op" id="7735906">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735910">Size</span><span class="op" id="7735914">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7735920">4</span><span class="op" id="7735921">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735925">Typeflag</span><span class="op" id="7735933">:</span>&nbsp;<span class="num" id="7735935">0</span><span class="op" id="7735936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7735939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7735942">if</span>&nbsp;<span class="ident" id="7735945">err</span>&nbsp;<span class="op" id="7735949">:=</span>&nbsp;<span class="ident" id="7735952">tw</span><span class="op" id="7735954">.</span><span class="ident" id="7735955">WriteHeader</span><span class="op" id="7735966">(</span><span class="ident" id="7735967">hdr</span><span class="op" id="7735970">)</span><span class="op" id="7735971">;</span>&nbsp;<span class="ident" id="7735973">err</span>&nbsp;<span class="op" id="7735977">!=</span>&nbsp;<span class="ident" id="7735980">nil</span>&nbsp;<span class="op" id="7735984">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7735988">t</span><span class="op" id="7735989">.</span><span class="ident" id="7735990">Fatalf</span><span class="op" id="7735996">(</span><span class="string" id="7735997">&#34;Failed&nbsp;to&nbsp;write&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7736025">,</span>&nbsp;<span class="ident" id="7736027">err</span><span class="op" id="7736030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736036">if</span>&nbsp;<span class="ident" id="7736039">_</span><span class="op" id="7736040">,</span>&nbsp;<span class="ident" id="7736042">err</span>&nbsp;<span class="op" id="7736046">:=</span>&nbsp;<span class="ident" id="7736049">tw</span><span class="op" id="7736051">.</span><span class="ident" id="7736052">Write</span><span class="op" id="7736057">(</span><span class="op" id="7736058">[</span><span class="op" id="7736059">]</span><span class="builtintype" id="7736060">byte</span><span class="op" id="7736064">(</span><span class="string" id="7736065">&#34;fooo&#34;</span><span class="op" id="7736071">)</span><span class="op" id="7736072">)</span><span class="op" id="7736073">;</span>&nbsp;<span class="ident" id="7736075">err</span>&nbsp;<span class="op" id="7736079">!=</span>&nbsp;<span class="ident" id="7736082">nil</span>&nbsp;<span class="op" id="7736086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736090">t</span><span class="op" id="7736091">.</span><span class="ident" id="7736092">Fatalf</span><span class="op" id="7736098">(</span><span class="string" id="7736099">&#34;Failed&nbsp;to&nbsp;write&nbsp;the&nbsp;file&#39;s&nbsp;data:&nbsp;%s&#34;</span><span class="op" id="7736136">,</span>&nbsp;<span class="ident" id="7736138">err</span><span class="op" id="7736141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736144">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736147">tw</span><span class="op" id="7736149">.</span><span class="ident" id="7736150">Close</span><span class="op" id="7736155">(</span><span class="op" id="7736156">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736160">tr</span>&nbsp;<span class="op" id="7736163">:=</span>&nbsp;<span class="ident" id="7736166">NewReader</span><span class="op" id="7736175">(</span><span class="op" id="7736176">&amp;</span><span class="ident" id="7736177">buffer</span><span class="op" id="7736183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736187">for</span>&nbsp;<span class="op" id="7736191">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736195">header</span><span class="op" id="7736201">,</span>&nbsp;<span class="ident" id="7736203">err</span>&nbsp;<span class="op" id="7736207">:=</span>&nbsp;<span class="ident" id="7736210">tr</span><span class="op" id="7736212">.</span><span class="ident" id="7736213">Next</span><span class="op" id="7736217">(</span><span class="op" id="7736218">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736222">if</span>&nbsp;<span class="ident" id="7736225">err</span>&nbsp;<span class="op" id="7736229">==</span>&nbsp;<span class="ident" id="7736232">io</span><span class="op" id="7736234">.</span><span class="ident" id="7736235">EOF</span>&nbsp;<span class="op" id="7736239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736244">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736256">if</span>&nbsp;<span class="ident" id="7736259">err</span>&nbsp;<span class="op" id="7736263">!=</span>&nbsp;<span class="ident" id="7736266">nil</span>&nbsp;<span class="op" id="7736270">{</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736275">t</span><span class="op" id="7736276">.</span><span class="ident" id="7736277">Fatalf</span><span class="op" id="7736283">(</span><span class="string" id="7736284">&#34;Failed&nbsp;to&nbsp;read&nbsp;header:&nbsp;%s&#34;</span><span class="op" id="7736311">,</span>&nbsp;<span class="ident" id="7736313">err</span><span class="op" id="7736316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7736324">if</span>&nbsp;<span class="ident" id="7736327">header</span><span class="op" id="7736333">.</span><span class="ident" id="7736334">Typeflag</span>&nbsp;<span class="op" id="7736343">!=</span>&nbsp;<span class="num" id="7736346">0</span>&nbsp;<span class="op" id="7736348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7736353">t</span><span class="op" id="7736354">.</span><span class="ident" id="7736355">Fatalf</span><span class="op" id="7736361">(</span><span class="string" id="7736362">&#34;Typeflag&nbsp;should&#39;ve&nbsp;been&nbsp;0,&nbsp;found&nbsp;%d&#34;</span><span class="op" id="7736399">,</span>&nbsp;<span class="ident" id="7736401">header</span><span class="op" id="7736407">.</span><span class="ident" id="7736408">Typeflag</span><span class="op" id="7736416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736420">}</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7736423">}</span><br>
<span class="lineno"></span><span class="op" id="7736425">}</span>
</div>
</body>
</html>
