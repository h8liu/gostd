<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5155794">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5155849">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5155903">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5155954">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;NewPackage.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5155991">package</span>&nbsp;<span class="ident" id="5155999">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5156004">import</span>&nbsp;<span class="op" id="5156011">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5156014">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5156021">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5156035">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5156047">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="5156057">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="5156060">type</span>&nbsp;<span class="ident" id="5156065">pkgBuilder</span>&nbsp;<span class="keyword" id="5156076">struct</span>&nbsp;<span class="op" id="5156083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156086">fset</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5156093">*</span><span class="ident" id="5156094"><a href="/go/ast/resolve.go.html#5156035">token</a></span><span class="op" id="5156099">.</span><span class="ident" id="5156100">FileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156109">errors</span>&nbsp;<span class="ident" id="5156116"><a href="/go/ast/resolve.go.html#5156021">scanner</a></span><span class="op" id="5156123">.</span><span class="ident" id="5156124">ErrorList</span><br>
<span class="lineno"></span><span class="op" id="5156134">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5156137">func</span>&nbsp;<span class="op" id="5156142">(</span><span class="ident" id="5156143">p</span>&nbsp;<span class="op" id="5156145">*</span><span class="ident" id="5156146"><a href="/go/ast/resolve.go.html#5156065">pkgBuilder</a></span><span class="op" id="5156156">)</span>&nbsp;<span class="builtintype" id="5156158">error</span><span class="op" id="5156163">(</span><span class="ident" id="5156164">pos</span>&nbsp;<span class="ident" id="5156168"><a href="/go/ast/resolve.go.html#5156035">token</a></span><span class="op" id="5156173">.</span><span class="ident" id="5156174">Pos</span><span class="op" id="5156177">,</span>&nbsp;<span class="ident" id="5156179">msg</span>&nbsp;<span class="builtintype" id="5156183">string</span><span class="op" id="5156189">)</span>&nbsp;<span class="op" id="5156191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156194"><a href="/go/ast/resolve.go.html#5156143">p</a></span><span class="op" id="5156195">.</span><span class="ident" id="5156196">errors</span><span class="op" id="5156202">.</span><span class="ident" id="5156203">Add</span><span class="op" id="5156206">(</span><span class="ident" id="5156207"><a href="/go/ast/resolve.go.html#5156143">p</a></span><span class="op" id="5156208">.</span><span class="ident" id="5156209">fset</span><span class="op" id="5156213">.</span><span class="ident" id="5156214">Position</span><span class="op" id="5156222">(</span><span class="ident" id="5156223"><a href="/go/ast/resolve.go.html#5156164">pos</a></span><span class="op" id="5156226">)</span><span class="op" id="5156227">,</span>&nbsp;<span class="ident" id="5156229"><a href="/go/ast/resolve.go.html#5156179">msg</a></span><span class="op" id="5156232">)</span><br>
<span class="lineno"></span><span class="op" id="5156234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5156237">func</span>&nbsp;<span class="op" id="5156242">(</span><span class="ident" id="5156243">p</span>&nbsp;<span class="op" id="5156245">*</span><span class="ident" id="5156246"><a href="/go/ast/resolve.go.html#5156065">pkgBuilder</a></span><span class="op" id="5156256">)</span>&nbsp;<span class="ident" id="5156258">errorf</span><span class="op" id="5156264">(</span><span class="ident" id="5156265">pos</span>&nbsp;<span class="ident" id="5156269"><a href="/go/ast/resolve.go.html#5156035">token</a></span><span class="op" id="5156274">.</span><span class="ident" id="5156275">Pos</span><span class="op" id="5156278">,</span>&nbsp;<span class="ident" id="5156280">format</span>&nbsp;<span class="builtintype" id="5156287">string</span><span class="op" id="5156293">,</span>&nbsp;<span class="ident" id="5156295">args</span>&nbsp;<span class="op" id="5156300">...</span><span class="keyword" id="5156303">interface</span><span class="op" id="5156312">{</span><span class="op" id="5156313">}</span><span class="op" id="5156314">)</span>&nbsp;<span class="op" id="5156316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156319"><a href="/go/ast/resolve.go.html#5156243">p</a></span><span class="op" id="5156320">.</span><span class="builtintype" id="5156321">error</span><span class="op" id="5156326">(</span><span class="ident" id="5156327"><a href="/go/ast/resolve.go.html#5156265">pos</a></span><span class="op" id="5156330">,</span>&nbsp;<span class="ident" id="5156332"><a href="/go/ast/resolve.go.html#5156014">fmt</a></span><span class="op" id="5156335">.</span><span class="ident" id="5156336">Sprintf</span><span class="op" id="5156343">(</span><span class="ident" id="5156344"><a href="/go/ast/resolve.go.html#5156280">format</a></span><span class="op" id="5156350">,</span>&nbsp;<span class="ident" id="5156352"><a href="/go/ast/resolve.go.html#5156295">args</a></span><span class="op" id="5156356">...</span><span class="op" id="5156359">)</span><span class="op" id="5156360">)</span><br>
<span class="lineno"></span><span class="op" id="5156362">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5156365">func</span>&nbsp;<span class="op" id="5156370">(</span><span class="ident" id="5156371">p</span>&nbsp;<span class="op" id="5156373">*</span><span class="ident" id="5156374"><a href="/go/ast/resolve.go.html#5156065">pkgBuilder</a></span><span class="op" id="5156384">)</span>&nbsp;<span class="ident" id="5156386">declare</span><span class="op" id="5156393">(</span><span class="ident" id="5156394">scope</span><span class="op" id="5156399">,</span>&nbsp;<span class="ident" id="5156401">altScope</span>&nbsp;<span class="op" id="5156410">*</span><span class="ident" id="5156411"><a href="/go/ast/scope.go.html#5161576">Scope</a></span><span class="op" id="5156416">,</span>&nbsp;<span class="ident" id="5156418">obj</span>&nbsp;<span class="op" id="5156422">*</span><span class="ident" id="5156423"><a href="/go/ast/scope.go.html#5163287">Object</a></span><span class="op" id="5156429">)</span>&nbsp;<span class="op" id="5156431">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156434">alt</span>&nbsp;<span class="op" id="5156438">:=</span>&nbsp;<span class="ident" id="5156441"><a href="/go/ast/resolve.go.html#5156394">scope</a></span><span class="op" id="5156446">.</span><span class="ident" id="5156447">Insert</span><span class="op" id="5156453">(</span><span class="ident" id="5156454"><a href="/go/ast/resolve.go.html#5156418">obj</a></span><span class="op" id="5156457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156460">if</span>&nbsp;<span class="ident" id="5156463"><a href="/go/ast/resolve.go.html#5156434">alt</a></span>&nbsp;<span class="op" id="5156467">==</span>&nbsp;<span class="ident" id="5156470">nil</span>&nbsp;<span class="op" id="5156474">&amp;&amp;</span>&nbsp;<span class="ident" id="5156477"><a href="/go/ast/resolve.go.html#5156401">altScope</a></span>&nbsp;<span class="op" id="5156486">!=</span>&nbsp;<span class="ident" id="5156489">nil</span>&nbsp;<span class="op" id="5156493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156497">//&nbsp;see&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;conflicting&nbsp;declaration&nbsp;in&nbsp;altScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156556"><a href="/go/ast/resolve.go.html#5156434">alt</a></span>&nbsp;<span class="op" id="5156560">=</span>&nbsp;<span class="ident" id="5156562"><a href="/go/ast/resolve.go.html#5156401">altScope</a></span><span class="op" id="5156570">.</span><span class="ident" id="5156571">Lookup</span><span class="op" id="5156577">(</span><span class="ident" id="5156578"><a href="/go/ast/resolve.go.html#5156418">obj</a></span><span class="op" id="5156581">.</span><span class="ident" id="5156582">Name</span><span class="op" id="5156586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156589">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156592">if</span>&nbsp;<span class="ident" id="5156595"><a href="/go/ast/resolve.go.html#5156434">alt</a></span>&nbsp;<span class="op" id="5156599">!=</span>&nbsp;<span class="ident" id="5156602">nil</span>&nbsp;<span class="op" id="5156606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156610">prevDecl</span>&nbsp;<span class="op" id="5156619">:=</span>&nbsp;<span class="string" id="5156622">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156627">if</span>&nbsp;<span class="ident" id="5156630">pos</span>&nbsp;<span class="op" id="5156634">:=</span>&nbsp;<span class="ident" id="5156637"><a href="/go/ast/resolve.go.html#5156434">alt</a></span><span class="op" id="5156640">.</span><span class="ident" id="5156641">Pos</span><span class="op" id="5156644">(</span><span class="op" id="5156645">)</span><span class="op" id="5156646">;</span>&nbsp;<span class="ident" id="5156648"><a href="/go/ast/resolve.go.html#5156630">pos</a></span><span class="op" id="5156651">.</span><span class="ident" id="5156652">IsValid</span><span class="op" id="5156659">(</span><span class="op" id="5156660">)</span>&nbsp;<span class="op" id="5156662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156667"><a href="/go/ast/resolve.go.html#5156610">prevDecl</a></span>&nbsp;<span class="op" id="5156676">=</span>&nbsp;<span class="ident" id="5156678"><a href="/go/ast/resolve.go.html#5156014">fmt</a></span><span class="op" id="5156681">.</span><span class="ident" id="5156682">Sprintf</span><span class="op" id="5156689">(</span><span class="string" id="5156690">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5156722">,</span>&nbsp;<span class="ident" id="5156724"><a href="/go/ast/resolve.go.html#5156371">p</a></span><span class="op" id="5156725">.</span><span class="ident" id="5156726">fset</span><span class="op" id="5156730">.</span><span class="ident" id="5156731">Position</span><span class="op" id="5156739">(</span><span class="ident" id="5156740"><a href="/go/ast/resolve.go.html#5156630">pos</a></span><span class="op" id="5156743">)</span><span class="op" id="5156744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156748">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156752"><a href="/go/ast/resolve.go.html#5156371">p</a></span><span class="op" id="5156753">.</span><span class="builtintype" id="5156754">error</span><span class="op" id="5156759">(</span><span class="ident" id="5156760"><a href="/go/ast/resolve.go.html#5156418">obj</a></span><span class="op" id="5156763">.</span><span class="ident" id="5156764">Pos</span><span class="op" id="5156767">(</span><span class="op" id="5156768">)</span><span class="op" id="5156769">,</span>&nbsp;<span class="ident" id="5156771"><a href="/go/ast/resolve.go.html#5156014">fmt</a></span><span class="op" id="5156774">.</span><span class="ident" id="5156775">Sprintf</span><span class="op" id="5156782">(</span><span class="string" id="5156783">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5156814">,</span>&nbsp;<span class="ident" id="5156816"><a href="/go/ast/resolve.go.html#5156418">obj</a></span><span class="op" id="5156819">.</span><span class="ident" id="5156820">Name</span><span class="op" id="5156824">,</span>&nbsp;<span class="ident" id="5156826"><a href="/go/ast/resolve.go.html#5156610">prevDecl</a></span><span class="op" id="5156834">)</span><span class="op" id="5156835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156838">}</span><br>
<span class="lineno"></span><span class="op" id="5156840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5156843">func</span>&nbsp;<span class="ident" id="5156848">resolve</span><span class="op" id="5156855">(</span><span class="ident" id="5156856">scope</span>&nbsp;<span class="op" id="5156862">*</span><span class="ident" id="5156863"><a href="/go/ast/scope.go.html#5161576">Scope</a></span><span class="op" id="5156868">,</span>&nbsp;<span class="ident" id="5156870">ident</span>&nbsp;<span class="op" id="5156876">*</span><span class="ident" id="5156877"><a href="/go/ast/ast.go.html#5098384">Ident</a></span><span class="op" id="5156882">)</span>&nbsp;<span class="builtintype" id="5156884">bool</span>&nbsp;<span class="op" id="5156889">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156892">for</span>&nbsp;<span class="op" id="5156896">;</span>&nbsp;<span class="ident" id="5156898"><a href="/go/ast/resolve.go.html#5156856">scope</a></span>&nbsp;<span class="op" id="5156904">!=</span>&nbsp;<span class="ident" id="5156907">nil</span><span class="op" id="5156910">;</span>&nbsp;<span class="ident" id="5156912"><a href="/go/ast/resolve.go.html#5156856">scope</a></span>&nbsp;<span class="op" id="5156918">=</span>&nbsp;<span class="ident" id="5156920"><a href="/go/ast/resolve.go.html#5156856">scope</a></span><span class="op" id="5156925">.</span><span class="ident" id="5156926">Outer</span>&nbsp;<span class="op" id="5156932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156936">if</span>&nbsp;<span class="ident" id="5156939">obj</span>&nbsp;<span class="op" id="5156943">:=</span>&nbsp;<span class="ident" id="5156946"><a href="/go/ast/resolve.go.html#5156856">scope</a></span><span class="op" id="5156951">.</span><span class="ident" id="5156952">Lookup</span><span class="op" id="5156958">(</span><span class="ident" id="5156959"><a href="/go/ast/resolve.go.html#5156870">ident</a></span><span class="op" id="5156964">.</span><span class="ident" id="5156965">Name</span><span class="op" id="5156969">)</span><span class="op" id="5156970">;</span>&nbsp;<span class="ident" id="5156972"><a href="/go/ast/resolve.go.html#5156939">obj</a></span>&nbsp;<span class="op" id="5156976">!=</span>&nbsp;<span class="ident" id="5156979">nil</span>&nbsp;<span class="op" id="5156983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156988"><a href="/go/ast/resolve.go.html#5156870">ident</a></span><span class="op" id="5156993">.</span><span class="ident" id="5156994">Obj</span>&nbsp;<span class="op" id="5156998">=</span>&nbsp;<span class="ident" id="5157000"><a href="/go/ast/resolve.go.html#5156939">obj</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157007">return</span>&nbsp;<span class="builtintype" id="5157014">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157021">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157027">return</span>&nbsp;<span class="builtintype" id="5157034">false</span><br>
<span class="lineno"></span><span class="op" id="5157040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5157043">//&nbsp;An&nbsp;Importer&nbsp;resolves&nbsp;import&nbsp;paths&nbsp;to&nbsp;package&nbsp;Objects.</span><br>
<span class="lineno">55</span><span class="comment" id="5157100">//&nbsp;The&nbsp;imports&nbsp;map&nbsp;records&nbsp;the&nbsp;packages&nbsp;already&nbsp;imported,</span><br>
<span class="lineno"></span><span class="comment" id="5157158">//&nbsp;indexed&nbsp;by&nbsp;package&nbsp;id&nbsp;(canonical&nbsp;import&nbsp;path).</span><br>
<span class="lineno"></span><span class="comment" id="5157208">//&nbsp;An&nbsp;Importer&nbsp;must&nbsp;determine&nbsp;the&nbsp;canonical&nbsp;import&nbsp;path&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5157268">//&nbsp;check&nbsp;the&nbsp;map&nbsp;to&nbsp;see&nbsp;if&nbsp;it&nbsp;is&nbsp;already&nbsp;present&nbsp;in&nbsp;the&nbsp;imports&nbsp;map.</span><br>
<span class="lineno"></span><span class="comment" id="5157337">//&nbsp;If&nbsp;so,&nbsp;the&nbsp;Importer&nbsp;can&nbsp;return&nbsp;the&nbsp;map&nbsp;entry.&nbsp;&nbsp;Otherwise,&nbsp;the</span><br>
<span class="lineno">60</span><span class="comment" id="5157402">//&nbsp;Importer&nbsp;should&nbsp;load&nbsp;the&nbsp;package&nbsp;data&nbsp;for&nbsp;the&nbsp;given&nbsp;path&nbsp;into</span><br>
<span class="lineno"></span><span class="comment" id="5157467">//&nbsp;a&nbsp;new&nbsp;*Object&nbsp;(pkg),&nbsp;record&nbsp;pkg&nbsp;in&nbsp;the&nbsp;imports&nbsp;map,&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5157531">//&nbsp;return&nbsp;pkg.</span><br>
<span class="lineno"></span><span class="keyword" id="5157546">type</span>&nbsp;<span class="ident" id="5157551">Importer</span>&nbsp;<span class="keyword" id="5157560">func</span><span class="op" id="5157564">(</span><span class="ident" id="5157565">imports</span>&nbsp;<span class="keyword" id="5157573">map</span><span class="op" id="5157576">[</span><span class="builtintype" id="5157577">string</span><span class="op" id="5157583">]</span><span class="op" id="5157584">*</span><span class="ident" id="5157585"><a href="/go/ast/scope.go.html#5163287">Object</a></span><span class="op" id="5157591">,</span>&nbsp;<span class="ident" id="5157593">path</span>&nbsp;<span class="builtintype" id="5157598">string</span><span class="op" id="5157604">)</span>&nbsp;<span class="op" id="5157606">(</span><span class="ident" id="5157607">pkg</span>&nbsp;<span class="op" id="5157611">*</span><span class="ident" id="5157612"><a href="/go/ast/scope.go.html#5163287">Object</a></span><span class="op" id="5157618">,</span>&nbsp;<span class="ident" id="5157620">err</span>&nbsp;<span class="builtintype" id="5157624">error</span><span class="op" id="5157629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="5157632">//&nbsp;NewPackage&nbsp;creates&nbsp;a&nbsp;new&nbsp;Package&nbsp;node&nbsp;from&nbsp;a&nbsp;set&nbsp;of&nbsp;File&nbsp;nodes.&nbsp;It&nbsp;resolves</span><br>
<span class="lineno"></span><span class="comment" id="5157711">//&nbsp;unresolved&nbsp;identifiers&nbsp;across&nbsp;files&nbsp;and&nbsp;updates&nbsp;each&nbsp;file&#39;s&nbsp;Unresolved&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="5157790">//&nbsp;accordingly.&nbsp;If&nbsp;a&nbsp;non-nil&nbsp;importer&nbsp;and&nbsp;universe&nbsp;scope&nbsp;are&nbsp;provided,&nbsp;they&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5157870">//&nbsp;used&nbsp;to&nbsp;resolve&nbsp;identifiers&nbsp;not&nbsp;declared&nbsp;in&nbsp;any&nbsp;of&nbsp;the&nbsp;package&nbsp;files.&nbsp;Any</span><br>
<span class="lineno"></span><span class="comment" id="5157947">//&nbsp;remaining&nbsp;unresolved&nbsp;identifiers&nbsp;are&nbsp;reported&nbsp;as&nbsp;undeclared.&nbsp;If&nbsp;the&nbsp;files</span><br>
<span class="lineno">70</span><span class="comment" id="5158024">//&nbsp;belong&nbsp;to&nbsp;different&nbsp;packages,&nbsp;one&nbsp;package&nbsp;name&nbsp;is&nbsp;selected&nbsp;and&nbsp;files&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="5158101">//&nbsp;different&nbsp;package&nbsp;names&nbsp;are&nbsp;reported&nbsp;and&nbsp;then&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="5158159">//&nbsp;The&nbsp;result&nbsp;is&nbsp;a&nbsp;package&nbsp;node&nbsp;and&nbsp;a&nbsp;scanner.ErrorList&nbsp;if&nbsp;there&nbsp;were&nbsp;errors.</span><br>
<span class="lineno"></span><span class="comment" id="5158237">//</span><br>
<span class="lineno"></span><span class="keyword" id="5158240">func</span>&nbsp;<span class="ident" id="5158245">NewPackage</span><span class="op" id="5158255">(</span><span class="ident" id="5158256">fset</span>&nbsp;<span class="op" id="5158261">*</span><span class="ident" id="5158262"><a href="/go/ast/resolve.go.html#5156035">token</a></span><span class="op" id="5158267">.</span><span class="ident" id="5158268">FileSet</span><span class="op" id="5158275">,</span>&nbsp;<span class="ident" id="5158277">files</span>&nbsp;<span class="keyword" id="5158283">map</span><span class="op" id="5158286">[</span><span class="builtintype" id="5158287">string</span><span class="op" id="5158293">]</span><span class="op" id="5158294">*</span><span class="ident" id="5158295"><a href="/go/ast/ast.go.html#5122014">File</a></span><span class="op" id="5158299">,</span>&nbsp;<span class="ident" id="5158301">importer</span>&nbsp;<span class="ident" id="5158310"><a href="/go/ast/resolve.go.html#5157551">Importer</a></span><span class="op" id="5158318">,</span>&nbsp;<span class="ident" id="5158320">universe</span>&nbsp;<span class="op" id="5158329">*</span><span class="ident" id="5158330"><a href="/go/ast/scope.go.html#5161576">Scope</a></span><span class="op" id="5158335">)</span>&nbsp;<span class="op" id="5158337">(</span><span class="op" id="5158338">*</span><span class="ident" id="5158339"><a href="/go/ast/ast.go.html#5122783">Package</a></span><span class="op" id="5158346">,</span>&nbsp;<span class="builtintype" id="5158348">error</span><span class="op" id="5158353">)</span>&nbsp;<span class="op" id="5158355">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158358">var</span>&nbsp;<span class="ident" id="5158362">p</span>&nbsp;<span class="ident" id="5158364"><a href="/go/ast/resolve.go.html#5156065">pkgBuilder</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158376"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5158377">.</span><span class="ident" id="5158378">fset</span>&nbsp;<span class="op" id="5158383">=</span>&nbsp;<span class="ident" id="5158385"><a href="/go/ast/resolve.go.html#5158256">fset</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5158392">//&nbsp;complete&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158419">pkgName</span>&nbsp;<span class="op" id="5158427">:=</span>&nbsp;<span class="string" id="5158430">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158434">pkgScope</span>&nbsp;<span class="op" id="5158443">:=</span>&nbsp;<span class="ident" id="5158446"><a href="/go/ast/scope.go.html#5161702">NewScope</a></span><span class="op" id="5158454">(</span><span class="ident" id="5158455"><a href="/go/ast/resolve.go.html#5158320">universe</a></span><span class="op" id="5158463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158466">for</span>&nbsp;<span class="ident" id="5158470">_</span><span class="op" id="5158471">,</span>&nbsp;<span class="ident" id="5158473">file</span>&nbsp;<span class="op" id="5158478">:=</span>&nbsp;<span class="keyword" id="5158481">range</span>&nbsp;<span class="ident" id="5158487"><a href="/go/ast/resolve.go.html#5158277">files</a></span>&nbsp;<span class="op" id="5158493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5158497">//&nbsp;package&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158527">switch</span>&nbsp;<span class="ident" id="5158534">name</span>&nbsp;<span class="op" id="5158539">:=</span>&nbsp;<span class="ident" id="5158542"><a href="/go/ast/resolve.go.html#5158473">file</a></span><span class="op" id="5158546">.</span><span class="ident" id="5158547">Name</span><span class="op" id="5158551">.</span><span class="ident" id="5158552">Name</span><span class="op" id="5158556">;</span>&nbsp;<span class="op" id="5158558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158562">case</span>&nbsp;<span class="ident" id="5158567"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span>&nbsp;<span class="op" id="5158575">==</span>&nbsp;<span class="string" id="5158578">&#34;&#34;</span><span class="op" id="5158580">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158585"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span>&nbsp;<span class="op" id="5158593">=</span>&nbsp;<span class="ident" id="5158595"><a href="/go/ast/resolve.go.html#5158534">name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158602">case</span>&nbsp;<span class="ident" id="5158607"><a href="/go/ast/resolve.go.html#5158534">name</a></span>&nbsp;<span class="op" id="5158612">!=</span>&nbsp;<span class="ident" id="5158615"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span><span class="op" id="5158622">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158627"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5158628">.</span><span class="ident" id="5158629">errorf</span><span class="op" id="5158635">(</span><span class="ident" id="5158636"><a href="/go/ast/resolve.go.html#5158473">file</a></span><span class="op" id="5158640">.</span><span class="ident" id="5158641">Package</span><span class="op" id="5158648">,</span>&nbsp;<span class="string" id="5158650">&#34;package&nbsp;%s;&nbsp;expected&nbsp;%s&#34;</span><span class="op" id="5158675">,</span>&nbsp;<span class="ident" id="5158677"><a href="/go/ast/resolve.go.html#5158534">name</a></span><span class="op" id="5158681">,</span>&nbsp;<span class="ident" id="5158683"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span><span class="op" id="5158690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158695">continue</span>&nbsp;<span class="comment" id="5158704">//&nbsp;ignore&nbsp;this&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158726">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5158731">//&nbsp;collect&nbsp;top-level&nbsp;file&nbsp;objects&nbsp;in&nbsp;package&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158784">for</span>&nbsp;<span class="ident" id="5158788">_</span><span class="op" id="5158789">,</span>&nbsp;<span class="ident" id="5158791">obj</span>&nbsp;<span class="op" id="5158795">:=</span>&nbsp;<span class="keyword" id="5158798">range</span>&nbsp;<span class="ident" id="5158804"><a href="/go/ast/resolve.go.html#5158473">file</a></span><span class="op" id="5158808">.</span><span class="ident" id="5158809">Scope</span><span class="op" id="5158814">.</span><span class="ident" id="5158815">Objects</span>&nbsp;<span class="op" id="5158823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158828"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5158829">.</span><span class="ident" id="5158830">declare</span><span class="op" id="5158837">(</span><span class="ident" id="5158838"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5158846">,</span>&nbsp;<span class="ident" id="5158848">nil</span><span class="op" id="5158851">,</span>&nbsp;<span class="ident" id="5158853"><a href="/go/ast/resolve.go.html#5158791">obj</a></span><span class="op" id="5158856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158860">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5158867">//&nbsp;package&nbsp;global&nbsp;mapping&nbsp;of&nbsp;imported&nbsp;package&nbsp;ids&nbsp;to&nbsp;package&nbsp;objects</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158937">imports</span>&nbsp;<span class="op" id="5158945">:=</span>&nbsp;<span class="builtinfunc" id="5158948">make</span><span class="op" id="5158952">(</span><span class="keyword" id="5158953">map</span><span class="op" id="5158956">[</span><span class="builtintype" id="5158957">string</span><span class="op" id="5158963">]</span><span class="op" id="5158964">*</span><span class="ident" id="5158965"><a href="/go/ast/scope.go.html#5163287">Object</a></span><span class="op" id="5158971">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5158975">//&nbsp;complete&nbsp;file&nbsp;scopes&nbsp;with&nbsp;imports&nbsp;and&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159037">for</span>&nbsp;<span class="ident" id="5159041">_</span><span class="op" id="5159042">,</span>&nbsp;<span class="ident" id="5159044">file</span>&nbsp;<span class="op" id="5159049">:=</span>&nbsp;<span class="keyword" id="5159052">range</span>&nbsp;<span class="ident" id="5159058"><a href="/go/ast/resolve.go.html#5158277">files</a></span>&nbsp;<span class="op" id="5159064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159068">//&nbsp;ignore&nbsp;file&nbsp;if&nbsp;it&nbsp;belongs&nbsp;to&nbsp;a&nbsp;different&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159122">//&nbsp;(error&nbsp;has&nbsp;already&nbsp;been&nbsp;reported)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159161">if</span>&nbsp;<span class="ident" id="5159164"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5159168">.</span><span class="ident" id="5159169">Name</span><span class="op" id="5159173">.</span><span class="ident" id="5159174">Name</span>&nbsp;<span class="op" id="5159179">!=</span>&nbsp;<span class="ident" id="5159182"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span>&nbsp;<span class="op" id="5159190">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159195">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5159206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159211">//&nbsp;build&nbsp;file&nbsp;scope&nbsp;by&nbsp;processing&nbsp;all&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159259">importErrors</span>&nbsp;<span class="op" id="5159272">:=</span>&nbsp;<span class="builtintype" id="5159275">false</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159283">fileScope</span>&nbsp;<span class="op" id="5159293">:=</span>&nbsp;<span class="ident" id="5159296"><a href="/go/ast/scope.go.html#5161702">NewScope</a></span><span class="op" id="5159304">(</span><span class="ident" id="5159305"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5159313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159317">for</span>&nbsp;<span class="ident" id="5159321">_</span><span class="op" id="5159322">,</span>&nbsp;<span class="ident" id="5159324">spec</span>&nbsp;<span class="op" id="5159329">:=</span>&nbsp;<span class="keyword" id="5159332">range</span>&nbsp;<span class="ident" id="5159338"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5159342">.</span><span class="ident" id="5159343">Imports</span>&nbsp;<span class="op" id="5159351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159356">if</span>&nbsp;<span class="ident" id="5159359"><a href="/go/ast/resolve.go.html#5158301">importer</a></span>&nbsp;<span class="op" id="5159368">==</span>&nbsp;<span class="ident" id="5159371">nil</span>&nbsp;<span class="op" id="5159375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159381"><a href="/go/ast/resolve.go.html#5159259">importErrors</a></span>&nbsp;<span class="op" id="5159394">=</span>&nbsp;<span class="builtintype" id="5159396">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159405">continue</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5159417">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159422">path</span><span class="op" id="5159426">,</span>&nbsp;<span class="ident" id="5159428">_</span>&nbsp;<span class="op" id="5159430">:=</span>&nbsp;<span class="ident" id="5159433"><a href="/go/ast/resolve.go.html#5156047">strconv</a></span><span class="op" id="5159440">.</span><span class="ident" id="5159441">Unquote</span><span class="op" id="5159448">(</span><span class="ident" id="5159449"><a href="/go/ast/resolve.go.html#5159324">spec</a></span><span class="op" id="5159453">.</span><span class="ident" id="5159454">Path</span><span class="op" id="5159458">.</span><span class="ident" id="5159459">Value</span><span class="op" id="5159464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159469">pkg</span><span class="op" id="5159472">,</span>&nbsp;<span class="ident" id="5159474">err</span>&nbsp;<span class="op" id="5159478">:=</span>&nbsp;<span class="ident" id="5159481"><a href="/go/ast/resolve.go.html#5158301">importer</a></span><span class="op" id="5159489">(</span><span class="ident" id="5159490"><a href="/go/ast/resolve.go.html#5158937">imports</a></span><span class="op" id="5159497">,</span>&nbsp;<span class="ident" id="5159499"><a href="/go/ast/resolve.go.html#5159422">path</a></span><span class="op" id="5159503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159508">if</span>&nbsp;<span class="ident" id="5159511"><a href="/go/ast/resolve.go.html#5159474">err</a></span>&nbsp;<span class="op" id="5159515">!=</span>&nbsp;<span class="ident" id="5159518">nil</span>&nbsp;<span class="op" id="5159522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159528"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5159529">.</span><span class="ident" id="5159530">errorf</span><span class="op" id="5159536">(</span><span class="ident" id="5159537"><a href="/go/ast/resolve.go.html#5159324">spec</a></span><span class="op" id="5159541">.</span><span class="ident" id="5159542">Path</span><span class="op" id="5159546">.</span><span class="ident" id="5159547">Pos</span><span class="op" id="5159550">(</span><span class="op" id="5159551">)</span><span class="op" id="5159552">,</span>&nbsp;<span class="string" id="5159554">&#34;could&nbsp;not&nbsp;import&nbsp;%s&nbsp;(%s)&#34;</span><span class="op" id="5159580">,</span>&nbsp;<span class="ident" id="5159582"><a href="/go/ast/resolve.go.html#5159422">path</a></span><span class="op" id="5159586">,</span>&nbsp;<span class="ident" id="5159588"><a href="/go/ast/resolve.go.html#5159474">err</a></span><span class="op" id="5159591">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159597"><a href="/go/ast/resolve.go.html#5159259">importErrors</a></span>&nbsp;<span class="op" id="5159610">=</span>&nbsp;<span class="builtintype" id="5159612">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159621">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5159633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159638">//&nbsp;TODO(gri)&nbsp;If&nbsp;a&nbsp;local&nbsp;package&nbsp;name&nbsp;!=&nbsp;&#34;.&#34;&nbsp;is&nbsp;provided,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159698">//&nbsp;global&nbsp;identifier&nbsp;resolution&nbsp;could&nbsp;proceed&nbsp;even&nbsp;if&nbsp;the</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159759">//&nbsp;import&nbsp;failed.&nbsp;Consider&nbsp;adjusting&nbsp;the&nbsp;logic&nbsp;here&nbsp;a&nbsp;bit.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159822">//&nbsp;local&nbsp;name&nbsp;overrides&nbsp;imported&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159871">name</span>&nbsp;<span class="op" id="5159876">:=</span>&nbsp;<span class="ident" id="5159879"><a href="/go/ast/resolve.go.html#5159469">pkg</a></span><span class="op" id="5159882">.</span><span class="ident" id="5159883">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159891">if</span>&nbsp;<span class="ident" id="5159894"><a href="/go/ast/resolve.go.html#5159324">spec</a></span><span class="op" id="5159898">.</span><span class="ident" id="5159899">Name</span>&nbsp;<span class="op" id="5159904">!=</span>&nbsp;<span class="ident" id="5159907">nil</span>&nbsp;<span class="op" id="5159911">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5159917"><a href="/go/ast/resolve.go.html#5159871">name</a></span>&nbsp;<span class="op" id="5159922">=</span>&nbsp;<span class="ident" id="5159924"><a href="/go/ast/resolve.go.html#5159324">spec</a></span><span class="op" id="5159928">.</span><span class="ident" id="5159929">Name</span><span class="op" id="5159933">.</span><span class="ident" id="5159934">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5159942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5159948">//&nbsp;add&nbsp;import&nbsp;to&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5159979">if</span>&nbsp;<span class="ident" id="5159982"><a href="/go/ast/resolve.go.html#5159871">name</a></span>&nbsp;<span class="op" id="5159987">==</span>&nbsp;<span class="string" id="5159990">&#34;.&#34;</span>&nbsp;<span class="op" id="5159994">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160000">//&nbsp;merge&nbsp;imported&nbsp;scope&nbsp;with&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5160044">for</span>&nbsp;<span class="ident" id="5160048">_</span><span class="op" id="5160049">,</span>&nbsp;<span class="ident" id="5160051">obj</span>&nbsp;<span class="op" id="5160055">:=</span>&nbsp;<span class="keyword" id="5160058">range</span>&nbsp;<span class="ident" id="5160064"><a href="/go/ast/resolve.go.html#5159469">pkg</a></span><span class="op" id="5160067">.</span><span class="ident" id="5160068">Data</span><span class="op" id="5160072">.</span><span class="op" id="5160073">(</span><span class="op" id="5160074">*</span><span class="ident" id="5160075"><a href="/go/ast/scope.go.html#5161576">Scope</a></span><span class="op" id="5160080">)</span><span class="op" id="5160081">.</span><span class="ident" id="5160082">Objects</span>&nbsp;<span class="op" id="5160090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160097"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5160098">.</span><span class="ident" id="5160099">declare</span><span class="op" id="5160106">(</span><span class="ident" id="5160107"><a href="/go/ast/resolve.go.html#5159283">fileScope</a></span><span class="op" id="5160116">,</span>&nbsp;<span class="ident" id="5160118"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5160126">,</span>&nbsp;<span class="ident" id="5160128"><a href="/go/ast/resolve.go.html#5160051">obj</a></span><span class="op" id="5160131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160142">}</span>&nbsp;<span class="keyword" id="5160144">else</span>&nbsp;<span class="keyword" id="5160149">if</span>&nbsp;<span class="ident" id="5160152"><a href="/go/ast/resolve.go.html#5159871">name</a></span>&nbsp;<span class="op" id="5160157">!=</span>&nbsp;<span class="string" id="5160160">&#34;_&#34;</span>&nbsp;<span class="op" id="5160164">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160170">//&nbsp;declare&nbsp;imported&nbsp;package&nbsp;object&nbsp;in&nbsp;file&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160223">//&nbsp;(do&nbsp;not&nbsp;re-use&nbsp;pkg&nbsp;in&nbsp;the&nbsp;file&nbsp;scope&nbsp;but&nbsp;create</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160278">//&nbsp;a&nbsp;new&nbsp;object&nbsp;instead;&nbsp;the&nbsp;Decl&nbsp;field&nbsp;is&nbsp;different</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160335">//&nbsp;for&nbsp;different&nbsp;files)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160363">obj</span>&nbsp;<span class="op" id="5160367">:=</span>&nbsp;<span class="ident" id="5160370"><a href="/go/ast/scope.go.html#5163633">NewObj</a></span><span class="op" id="5160376">(</span><span class="ident" id="5160377"><a href="/go/ast/scope.go.html#5164901">Pkg</a></span><span class="op" id="5160380">,</span>&nbsp;<span class="ident" id="5160382"><a href="/go/ast/resolve.go.html#5159871">name</a></span><span class="op" id="5160386">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160392"><a href="/go/ast/resolve.go.html#5160363">obj</a></span><span class="op" id="5160395">.</span><span class="ident" id="5160396">Decl</span>&nbsp;<span class="op" id="5160401">=</span>&nbsp;<span class="ident" id="5160403"><a href="/go/ast/resolve.go.html#5159324">spec</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160412"><a href="/go/ast/resolve.go.html#5160363">obj</a></span><span class="op" id="5160415">.</span><span class="ident" id="5160416">Data</span>&nbsp;<span class="op" id="5160421">=</span>&nbsp;<span class="ident" id="5160423"><a href="/go/ast/resolve.go.html#5159469">pkg</a></span><span class="op" id="5160426">.</span><span class="ident" id="5160427">Data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160436"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5160437">.</span><span class="ident" id="5160438">declare</span><span class="op" id="5160445">(</span><span class="ident" id="5160446"><a href="/go/ast/resolve.go.html#5159283">fileScope</a></span><span class="op" id="5160455">,</span>&nbsp;<span class="ident" id="5160457"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5160465">,</span>&nbsp;<span class="ident" id="5160467"><a href="/go/ast/resolve.go.html#5160363">obj</a></span><span class="op" id="5160470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160479">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160484">//&nbsp;resolve&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5160509">if</span>&nbsp;<span class="ident" id="5160512"><a href="/go/ast/resolve.go.html#5159259">importErrors</a></span>&nbsp;<span class="op" id="5160525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160530">//&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;universe&nbsp;scope&nbsp;without&nbsp;correct&nbsp;imports</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160589">//&nbsp;(objects&nbsp;in&nbsp;the&nbsp;universe&nbsp;may&nbsp;be&nbsp;shadowed&nbsp;by&nbsp;imports;</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160648">//&nbsp;with&nbsp;missing&nbsp;imports,&nbsp;identifiers&nbsp;might&nbsp;get&nbsp;resolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5160707">//&nbsp;incorrectly&nbsp;to&nbsp;universe&nbsp;objects)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160746"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5160754">.</span><span class="ident" id="5160755">Outer</span>&nbsp;<span class="op" id="5160761">=</span>&nbsp;<span class="ident" id="5160763">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160773">i</span>&nbsp;<span class="op" id="5160775">:=</span>&nbsp;<span class="num" id="5160778">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5160782">for</span>&nbsp;<span class="ident" id="5160786">_</span><span class="op" id="5160787">,</span>&nbsp;<span class="ident" id="5160789">ident</span>&nbsp;<span class="op" id="5160795">:=</span>&nbsp;<span class="keyword" id="5160798">range</span>&nbsp;<span class="ident" id="5160804"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5160808">.</span><span class="ident" id="5160809">Unresolved</span>&nbsp;<span class="op" id="5160820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5160825">if</span>&nbsp;<span class="op" id="5160828">!</span><span class="ident" id="5160829"><a href="/go/ast/resolve.go.html#5156848">resolve</a></span><span class="op" id="5160836">(</span><span class="ident" id="5160837"><a href="/go/ast/resolve.go.html#5159283">fileScope</a></span><span class="op" id="5160846">,</span>&nbsp;<span class="ident" id="5160848"><a href="/go/ast/resolve.go.html#5160789">ident</a></span><span class="op" id="5160853">)</span>&nbsp;<span class="op" id="5160855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160861"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5160862">.</span><span class="ident" id="5160863">errorf</span><span class="op" id="5160869">(</span><span class="ident" id="5160870"><a href="/go/ast/resolve.go.html#5160789">ident</a></span><span class="op" id="5160875">.</span><span class="ident" id="5160876">Pos</span><span class="op" id="5160879">(</span><span class="op" id="5160880">)</span><span class="op" id="5160881">,</span>&nbsp;<span class="string" id="5160883">&#34;undeclared&nbsp;name:&nbsp;%s&#34;</span><span class="op" id="5160904">,</span>&nbsp;<span class="ident" id="5160906"><a href="/go/ast/resolve.go.html#5160789">ident</a></span><span class="op" id="5160911">.</span><span class="ident" id="5160912">Name</span><span class="op" id="5160916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160922"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5160926">.</span><span class="ident" id="5160927">Unresolved</span><span class="op" id="5160937">[</span><span class="ident" id="5160938"><a href="/go/ast/resolve.go.html#5160773">i</a></span><span class="op" id="5160939">]</span>&nbsp;<span class="op" id="5160941">=</span>&nbsp;<span class="ident" id="5160943"><a href="/go/ast/resolve.go.html#5160789">ident</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160953"><a href="/go/ast/resolve.go.html#5160773">i</a></span><span class="op" id="5160954">++</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5160965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5160969"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5160973">.</span><span class="ident" id="5160974">Unresolved</span>&nbsp;<span class="op" id="5160985">=</span>&nbsp;<span class="ident" id="5160987"><a href="/go/ast/resolve.go.html#5159044">file</a></span><span class="op" id="5160991">.</span><span class="ident" id="5160992">Unresolved</span><span class="op" id="5161002">[</span><span class="num" id="5161003">0</span><span class="op" id="5161004">:</span><span class="ident" id="5161005"><a href="/go/ast/resolve.go.html#5160773">i</a></span><span class="op" id="5161006">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161010"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5161018">.</span><span class="ident" id="5161019">Outer</span>&nbsp;<span class="op" id="5161025">=</span>&nbsp;<span class="ident" id="5161027"><a href="/go/ast/resolve.go.html#5158320">universe</a></span>&nbsp;<span class="comment" id="5161036">//&nbsp;reset&nbsp;universe&nbsp;scope</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5161061">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5161065"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5161066">.</span><span class="ident" id="5161067">errors</span><span class="op" id="5161073">.</span><span class="ident" id="5161074">Sort</span><span class="op" id="5161078">(</span><span class="op" id="5161079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5161082">return</span>&nbsp;<span class="op" id="5161089">&amp;</span><span class="ident" id="5161090"><a href="/go/ast/ast.go.html#5122783">Package</a></span><span class="op" id="5161097">{</span><span class="ident" id="5161098"><a href="/go/ast/resolve.go.html#5158419">pkgName</a></span><span class="op" id="5161105">,</span>&nbsp;<span class="ident" id="5161107"><a href="/go/ast/resolve.go.html#5158434">pkgScope</a></span><span class="op" id="5161115">,</span>&nbsp;<span class="ident" id="5161117"><a href="/go/ast/resolve.go.html#5158937">imports</a></span><span class="op" id="5161124">,</span>&nbsp;<span class="ident" id="5161126"><a href="/go/ast/resolve.go.html#5158277">files</a></span><span class="op" id="5161131">}</span><span class="op" id="5161132">,</span>&nbsp;<span class="ident" id="5161134"><a href="/go/ast/resolve.go.html#5158362">p</a></span><span class="op" id="5161135">.</span><span class="ident" id="5161136">errors</span><span class="op" id="5161142">.</span><span class="ident" id="5161143">Err</span><span class="op" id="5161146">(</span><span class="op" id="5161147">)</span><br>
<span class="lineno"></span><span class="op" id="5161149">}</span>
</div>
</body>
</html>
