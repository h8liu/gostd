<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/parser</h2>
<ul>
<li><a href="/gostd/go/parser/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/go/parser/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/parser/interface.go.html">interface.go</a></li>
<li><a href="/gostd/go/parser/parser.go.html" class="current">parser.go</a></li>
<li><a href="/gostd/go/parser/parser_test.go.html">parser_test.go</a></li>
<li><a href="/gostd/go/parser/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/parser/short_test.go.html">short_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5289085">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5289140">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5289194">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5289245">//&nbsp;Package&nbsp;parser&nbsp;implements&nbsp;a&nbsp;parser&nbsp;for&nbsp;Go&nbsp;source&nbsp;files.&nbsp;Input&nbsp;may&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="5289317">//&nbsp;provided&nbsp;in&nbsp;a&nbsp;variety&nbsp;of&nbsp;forms&nbsp;(see&nbsp;the&nbsp;various&nbsp;Parse*&nbsp;functions);&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5289391">//&nbsp;output&nbsp;is&nbsp;an&nbsp;abstract&nbsp;syntax&nbsp;tree&nbsp;(AST)&nbsp;representing&nbsp;the&nbsp;Go&nbsp;source.&nbsp;The</span><br>
<span class="lineno"></span><span class="comment" id="5289466">//&nbsp;parser&nbsp;is&nbsp;invoked&nbsp;through&nbsp;one&nbsp;of&nbsp;the&nbsp;Parse*&nbsp;functions.</span><br>
<span class="lineno"></span><span class="comment" id="5289524">//</span><br>
<span class="lineno">10</span><span class="keyword" id="5289527">package</span>&nbsp;<span class="ident" id="5289535">parser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5289543">import</span>&nbsp;<span class="op" id="5289550">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289553">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289560">&#34;go/ast&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289570">&#34;go/scanner&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289584">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289596">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289607">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5289618">&#34;unicode&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5289628">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5289631">//&nbsp;The&nbsp;parser&nbsp;structure&nbsp;holds&nbsp;the&nbsp;parser&#39;s&nbsp;internal&nbsp;state.</span><br>
<span class="lineno"></span><span class="keyword" id="5289690">type</span>&nbsp;<span class="ident" id="5289695">parser</span>&nbsp;<span class="keyword" id="5289702">struct</span>&nbsp;<span class="op" id="5289709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289712">file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289720">*</span><span class="ident" id="5289721">token</span><span class="op" id="5289726">.</span><span class="ident" id="5289727">File</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289733">errors</span>&nbsp;&nbsp;<span class="ident" id="5289741">scanner</span><span class="op" id="5289748">.</span><span class="ident" id="5289749">ErrorList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289760">scanner</span>&nbsp;<span class="ident" id="5289768">scanner</span><span class="op" id="5289775">.</span><span class="ident" id="5289776">Scanner</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289786">//&nbsp;Tracing/debugging</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289808">mode</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5289815">Mode</span>&nbsp;<span class="comment" id="5289820">//&nbsp;parsing&nbsp;mode</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289837">trace</span>&nbsp;&nbsp;<span class="builtintype" id="5289844">bool</span>&nbsp;<span class="comment" id="5289849">//&nbsp;==&nbsp;(mode&nbsp;&amp;&nbsp;Trace&nbsp;!=&nbsp;0)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289876">indent</span>&nbsp;<span class="builtintype" id="5289883">int</span>&nbsp;&nbsp;<span class="comment" id="5289888">//&nbsp;indentation&nbsp;used&nbsp;for&nbsp;tracing&nbsp;output</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5289929">//&nbsp;Comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289942">comments</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5289954">[</span><span class="op" id="5289955">]</span><span class="op" id="5289956">*</span><span class="ident" id="5289957">ast</span><span class="op" id="5289960">.</span><span class="ident" id="5289961">CommentGroup</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5289975">leadComment</span>&nbsp;<span class="op" id="5289987">*</span><span class="ident" id="5289988">ast</span><span class="op" id="5289991">.</span><span class="ident" id="5289992">CommentGroup</span>&nbsp;<span class="comment" id="5290005">//&nbsp;last&nbsp;lead&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290027">lineComment</span>&nbsp;<span class="op" id="5290039">*</span><span class="ident" id="5290040">ast</span><span class="op" id="5290043">.</span><span class="ident" id="5290044">CommentGroup</span>&nbsp;<span class="comment" id="5290057">//&nbsp;last&nbsp;line&nbsp;comment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290080">//&nbsp;Next&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290095">pos</span>&nbsp;<span class="ident" id="5290099">token</span><span class="op" id="5290104">.</span><span class="ident" id="5290105">Pos</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="5290111">//&nbsp;token&nbsp;position</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290130">tok</span>&nbsp;<span class="ident" id="5290134">token</span><span class="op" id="5290139">.</span><span class="ident" id="5290140">Token</span>&nbsp;<span class="comment" id="5290146">//&nbsp;one&nbsp;token&nbsp;look-ahead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290171">lit</span>&nbsp;<span class="builtintype" id="5290175">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290187">//&nbsp;token&nbsp;literal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290206">//&nbsp;Error&nbsp;recovery</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290225">//&nbsp;(used&nbsp;to&nbsp;limit&nbsp;the&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;functions</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290285">//&nbsp;w/o&nbsp;making&nbsp;scanning&nbsp;progress&nbsp;-&nbsp;avoids&nbsp;potential&nbsp;endless</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290345">//&nbsp;loops&nbsp;across&nbsp;multiple&nbsp;parser&nbsp;functions&nbsp;during&nbsp;error&nbsp;recovery)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290411">syncPos</span>&nbsp;<span class="ident" id="5290419">token</span><span class="op" id="5290424">.</span><span class="ident" id="5290425">Pos</span>&nbsp;<span class="comment" id="5290429">//&nbsp;last&nbsp;synchronization&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290463">syncCnt</span>&nbsp;<span class="builtintype" id="5290471">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290481">//&nbsp;number&nbsp;of&nbsp;calls&nbsp;to&nbsp;syncXXX&nbsp;without&nbsp;progress</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290530">//&nbsp;Non-syntactic&nbsp;parser&nbsp;control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290563">exprLev</span>&nbsp;<span class="builtintype" id="5290571">int</span>&nbsp;&nbsp;<span class="comment" id="5290576">//&nbsp;&lt;&nbsp;0:&nbsp;in&nbsp;control&nbsp;clause,&nbsp;&gt;=&nbsp;0:&nbsp;in&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290624">inRhs</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5290632">bool</span>&nbsp;<span class="comment" id="5290637">//&nbsp;if&nbsp;set,&nbsp;the&nbsp;parser&nbsp;is&nbsp;parsing&nbsp;a&nbsp;rhs&nbsp;expression</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290689">//&nbsp;Ordinary&nbsp;identifier&nbsp;scopes</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290720">pkgScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5290731">*</span><span class="ident" id="5290732">ast</span><span class="op" id="5290735">.</span><span class="ident" id="5290736">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290749">//&nbsp;pkgScope.Outer&nbsp;==&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290775">topScope</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5290786">*</span><span class="ident" id="5290787">ast</span><span class="op" id="5290790">.</span><span class="ident" id="5290791">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290804">//&nbsp;top-most&nbsp;scope;&nbsp;may&nbsp;be&nbsp;pkgScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290840">unresolved</span>&nbsp;<span class="op" id="5290851">[</span><span class="op" id="5290852">]</span><span class="op" id="5290853">*</span><span class="ident" id="5290854">ast</span><span class="op" id="5290857">.</span><span class="ident" id="5290858">Ident</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290869">//&nbsp;unresolved&nbsp;identifiers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5290896">imports</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5290907">[</span><span class="op" id="5290908">]</span><span class="op" id="5290909">*</span><span class="ident" id="5290910">ast</span><span class="op" id="5290913">.</span><span class="ident" id="5290914">ImportSpec</span>&nbsp;<span class="comment" id="5290925">//&nbsp;list&nbsp;of&nbsp;imports</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290946">//&nbsp;Label&nbsp;scopes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5290963">//&nbsp;(maintained&nbsp;by&nbsp;open/close&nbsp;LabelScope)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291005">labelScope</span>&nbsp;&nbsp;<span class="op" id="5291017">*</span><span class="ident" id="5291018">ast</span><span class="op" id="5291021">.</span><span class="ident" id="5291022">Scope</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5291032">//&nbsp;label&nbsp;scope&nbsp;for&nbsp;current&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291069">targetStack</span>&nbsp;<span class="op" id="5291081">[</span><span class="op" id="5291082">]</span><span class="op" id="5291083">[</span><span class="op" id="5291084">]</span><span class="op" id="5291085">*</span><span class="ident" id="5291086">ast</span><span class="op" id="5291089">.</span><span class="ident" id="5291090">Ident</span>&nbsp;<span class="comment" id="5291096">//&nbsp;stack&nbsp;of&nbsp;unresolved&nbsp;labels</span><br>
<span class="lineno"></span><span class="op" id="5291126">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5291129">func</span>&nbsp;<span class="op" id="5291134">(</span><span class="ident" id="5291135">p</span>&nbsp;<span class="op" id="5291137">*</span><span class="ident" id="5291138">parser</span><span class="op" id="5291144">)</span>&nbsp;<span class="ident" id="5291146">init</span><span class="op" id="5291150">(</span><span class="ident" id="5291151">fset</span>&nbsp;<span class="op" id="5291156">*</span><span class="ident" id="5291157">token</span><span class="op" id="5291162">.</span><span class="ident" id="5291163">FileSet</span><span class="op" id="5291170">,</span>&nbsp;<span class="ident" id="5291172">filename</span>&nbsp;<span class="builtintype" id="5291181">string</span><span class="op" id="5291187">,</span>&nbsp;<span class="ident" id="5291189">src</span>&nbsp;<span class="op" id="5291193">[</span><span class="op" id="5291194">]</span><span class="builtintype" id="5291195">byte</span><span class="op" id="5291199">,</span>&nbsp;<span class="ident" id="5291201">mode</span>&nbsp;<span class="ident" id="5291206">Mode</span><span class="op" id="5291210">)</span>&nbsp;<span class="op" id="5291212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291215">p</span><span class="op" id="5291216">.</span><span class="ident" id="5291217">file</span>&nbsp;<span class="op" id="5291222">=</span>&nbsp;<span class="ident" id="5291224">fset</span><span class="op" id="5291228">.</span><span class="ident" id="5291229">AddFile</span><span class="op" id="5291236">(</span><span class="ident" id="5291237">filename</span><span class="op" id="5291245">,</span>&nbsp;<span class="op" id="5291247">-</span><span class="num" id="5291248">1</span><span class="op" id="5291249">,</span>&nbsp;<span class="builtinfunc" id="5291251">len</span><span class="op" id="5291254">(</span><span class="ident" id="5291255">src</span><span class="op" id="5291258">)</span><span class="op" id="5291259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5291262">var</span>&nbsp;<span class="ident" id="5291266">m</span>&nbsp;<span class="ident" id="5291268">scanner</span><span class="op" id="5291275">.</span><span class="ident" id="5291276">Mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5291282">if</span>&nbsp;<span class="ident" id="5291285">mode</span><span class="op" id="5291289">&amp;</span><span class="ident" id="5291290">ParseComments</span>&nbsp;<span class="op" id="5291304">!=</span>&nbsp;<span class="num" id="5291307">0</span>&nbsp;<span class="op" id="5291309">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291313">m</span>&nbsp;<span class="op" id="5291315">=</span>&nbsp;<span class="ident" id="5291317">scanner</span><span class="op" id="5291324">.</span><span class="ident" id="5291325">ScanComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5291339">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291342">eh</span>&nbsp;<span class="op" id="5291345">:=</span>&nbsp;<span class="keyword" id="5291348">func</span><span class="op" id="5291352">(</span><span class="ident" id="5291353">pos</span>&nbsp;<span class="ident" id="5291357">token</span><span class="op" id="5291362">.</span><span class="ident" id="5291363">Position</span><span class="op" id="5291371">,</span>&nbsp;<span class="ident" id="5291373">msg</span>&nbsp;<span class="builtintype" id="5291377">string</span><span class="op" id="5291383">)</span>&nbsp;<span class="op" id="5291385">{</span>&nbsp;<span class="ident" id="5291387">p</span><span class="op" id="5291388">.</span><span class="ident" id="5291389">errors</span><span class="op" id="5291395">.</span><span class="ident" id="5291396">Add</span><span class="op" id="5291399">(</span><span class="ident" id="5291400">pos</span><span class="op" id="5291403">,</span>&nbsp;<span class="ident" id="5291405">msg</span><span class="op" id="5291408">)</span>&nbsp;<span class="op" id="5291410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291413">p</span><span class="op" id="5291414">.</span><span class="ident" id="5291415">scanner</span><span class="op" id="5291422">.</span><span class="ident" id="5291423">Init</span><span class="op" id="5291427">(</span><span class="ident" id="5291428">p</span><span class="op" id="5291429">.</span><span class="ident" id="5291430">file</span><span class="op" id="5291434">,</span>&nbsp;<span class="ident" id="5291436">src</span><span class="op" id="5291439">,</span>&nbsp;<span class="ident" id="5291441">eh</span><span class="op" id="5291443">,</span>&nbsp;<span class="ident" id="5291445">m</span><span class="op" id="5291446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291450">p</span><span class="op" id="5291451">.</span><span class="ident" id="5291452">mode</span>&nbsp;<span class="op" id="5291457">=</span>&nbsp;<span class="ident" id="5291459">mode</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291465">p</span><span class="op" id="5291466">.</span><span class="ident" id="5291467">trace</span>&nbsp;<span class="op" id="5291473">=</span>&nbsp;<span class="ident" id="5291475">mode</span><span class="op" id="5291479">&amp;</span><span class="ident" id="5291480">Trace</span>&nbsp;<span class="op" id="5291486">!=</span>&nbsp;<span class="num" id="5291489">0</span>&nbsp;<span class="comment" id="5291491">//&nbsp;for&nbsp;convenience&nbsp;(p.trace&nbsp;is&nbsp;used&nbsp;frequently)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291541">p</span><span class="op" id="5291542">.</span><span class="ident" id="5291543">next</span><span class="op" id="5291547">(</span><span class="op" id="5291548">)</span><br>
<span class="lineno"></span><span class="op" id="5291550">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5291553">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5291633">//&nbsp;Scoping&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5291653">func</span>&nbsp;<span class="op" id="5291658">(</span><span class="ident" id="5291659">p</span>&nbsp;<span class="op" id="5291661">*</span><span class="ident" id="5291662">parser</span><span class="op" id="5291668">)</span>&nbsp;<span class="ident" id="5291670">openScope</span><span class="op" id="5291679">(</span><span class="op" id="5291680">)</span>&nbsp;<span class="op" id="5291682">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291685">p</span><span class="op" id="5291686">.</span><span class="ident" id="5291687">topScope</span>&nbsp;<span class="op" id="5291696">=</span>&nbsp;<span class="ident" id="5291698">ast</span><span class="op" id="5291701">.</span><span class="ident" id="5291702">NewScope</span><span class="op" id="5291710">(</span><span class="ident" id="5291711">p</span><span class="op" id="5291712">.</span><span class="ident" id="5291713">topScope</span><span class="op" id="5291721">)</span><br>
<span class="lineno"></span><span class="op" id="5291723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5291726">func</span>&nbsp;<span class="op" id="5291731">(</span><span class="ident" id="5291732">p</span>&nbsp;<span class="op" id="5291734">*</span><span class="ident" id="5291735">parser</span><span class="op" id="5291741">)</span>&nbsp;<span class="ident" id="5291743">closeScope</span><span class="op" id="5291753">(</span><span class="op" id="5291754">)</span>&nbsp;<span class="op" id="5291756">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291759">p</span><span class="op" id="5291760">.</span><span class="ident" id="5291761">topScope</span>&nbsp;<span class="op" id="5291770">=</span>&nbsp;<span class="ident" id="5291772">p</span><span class="op" id="5291773">.</span><span class="ident" id="5291774">topScope</span><span class="op" id="5291782">.</span><span class="ident" id="5291783">Outer</span><br>
<span class="lineno">90</span><span class="op" id="5291789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5291792">func</span>&nbsp;<span class="op" id="5291797">(</span><span class="ident" id="5291798">p</span>&nbsp;<span class="op" id="5291800">*</span><span class="ident" id="5291801">parser</span><span class="op" id="5291807">)</span>&nbsp;<span class="ident" id="5291809">openLabelScope</span><span class="op" id="5291823">(</span><span class="op" id="5291824">)</span>&nbsp;<span class="op" id="5291826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291829">p</span><span class="op" id="5291830">.</span><span class="ident" id="5291831">labelScope</span>&nbsp;<span class="op" id="5291842">=</span>&nbsp;<span class="ident" id="5291844">ast</span><span class="op" id="5291847">.</span><span class="ident" id="5291848">NewScope</span><span class="op" id="5291856">(</span><span class="ident" id="5291857">p</span><span class="op" id="5291858">.</span><span class="ident" id="5291859">labelScope</span><span class="op" id="5291869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291872">p</span><span class="op" id="5291873">.</span><span class="ident" id="5291874">targetStack</span>&nbsp;<span class="op" id="5291886">=</span>&nbsp;<span class="builtinfunc" id="5291888">append</span><span class="op" id="5291894">(</span><span class="ident" id="5291895">p</span><span class="op" id="5291896">.</span><span class="ident" id="5291897">targetStack</span><span class="op" id="5291908">,</span>&nbsp;<span class="builtintype" id="5291910">nil</span><span class="op" id="5291913">)</span><br>
<span class="lineno">95</span><span class="op" id="5291915">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5291918">func</span>&nbsp;<span class="op" id="5291923">(</span><span class="ident" id="5291924">p</span>&nbsp;<span class="op" id="5291926">*</span><span class="ident" id="5291927">parser</span><span class="op" id="5291933">)</span>&nbsp;<span class="ident" id="5291935">closeLabelScope</span><span class="op" id="5291950">(</span><span class="op" id="5291951">)</span>&nbsp;<span class="op" id="5291953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5291956">//&nbsp;resolve&nbsp;labels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5291975">n</span>&nbsp;<span class="op" id="5291977">:=</span>&nbsp;<span class="builtinfunc" id="5291980">len</span><span class="op" id="5291983">(</span><span class="ident" id="5291984">p</span><span class="op" id="5291985">.</span><span class="ident" id="5291986">targetStack</span><span class="op" id="5291997">)</span>&nbsp;<span class="op" id="5291999">-</span>&nbsp;<span class="num" id="5292001">1</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292004">scope</span>&nbsp;<span class="op" id="5292010">:=</span>&nbsp;<span class="ident" id="5292013">p</span><span class="op" id="5292014">.</span><span class="ident" id="5292015">labelScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292027">for</span>&nbsp;<span class="ident" id="5292031">_</span><span class="op" id="5292032">,</span>&nbsp;<span class="ident" id="5292034">ident</span>&nbsp;<span class="op" id="5292040">:=</span>&nbsp;<span class="keyword" id="5292043">range</span>&nbsp;<span class="ident" id="5292049">p</span><span class="op" id="5292050">.</span><span class="ident" id="5292051">targetStack</span><span class="op" id="5292062">[</span><span class="ident" id="5292063">n</span><span class="op" id="5292064">]</span>&nbsp;<span class="op" id="5292066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292070">ident</span><span class="op" id="5292075">.</span><span class="ident" id="5292076">Obj</span>&nbsp;<span class="op" id="5292080">=</span>&nbsp;<span class="ident" id="5292082">scope</span><span class="op" id="5292087">.</span><span class="ident" id="5292088">Lookup</span><span class="op" id="5292094">(</span><span class="ident" id="5292095">ident</span><span class="op" id="5292100">.</span><span class="ident" id="5292101">Name</span><span class="op" id="5292105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292109">if</span>&nbsp;<span class="ident" id="5292112">ident</span><span class="op" id="5292117">.</span><span class="ident" id="5292118">Obj</span>&nbsp;<span class="op" id="5292122">==</span>&nbsp;<span class="builtintype" id="5292125">nil</span>&nbsp;<span class="op" id="5292129">&amp;&amp;</span>&nbsp;<span class="ident" id="5292132">p</span><span class="op" id="5292133">.</span><span class="ident" id="5292134">mode</span><span class="op" id="5292138">&amp;</span><span class="ident" id="5292139">DeclarationErrors</span>&nbsp;<span class="op" id="5292157">!=</span>&nbsp;<span class="num" id="5292160">0</span>&nbsp;<span class="op" id="5292162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292167">p</span><span class="op" id="5292168">.</span><span class="builtintype" id="5292169">error</span><span class="op" id="5292174">(</span><span class="ident" id="5292175">ident</span><span class="op" id="5292180">.</span><span class="ident" id="5292181">Pos</span><span class="op" id="5292184">(</span><span class="op" id="5292185">)</span><span class="op" id="5292186">,</span>&nbsp;<span class="ident" id="5292188">fmt</span><span class="op" id="5292191">.</span><span class="ident" id="5292192">Sprintf</span><span class="op" id="5292199">(</span><span class="string" id="5292200">&#34;label&nbsp;%s&nbsp;undefined&#34;</span><span class="op" id="5292220">,</span>&nbsp;<span class="ident" id="5292222">ident</span><span class="op" id="5292227">.</span><span class="ident" id="5292228">Name</span><span class="op" id="5292232">)</span><span class="op" id="5292233">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5292237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5292240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5292243">//&nbsp;pop&nbsp;label&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292263">p</span><span class="op" id="5292264">.</span><span class="ident" id="5292265">targetStack</span>&nbsp;<span class="op" id="5292277">=</span>&nbsp;<span class="ident" id="5292279">p</span><span class="op" id="5292280">.</span><span class="ident" id="5292281">targetStack</span><span class="op" id="5292292">[</span><span class="num" id="5292293">0</span><span class="op" id="5292294">:</span><span class="ident" id="5292295">n</span><span class="op" id="5292296">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292299">p</span><span class="op" id="5292300">.</span><span class="ident" id="5292301">labelScope</span>&nbsp;<span class="op" id="5292312">=</span>&nbsp;<span class="ident" id="5292314">p</span><span class="op" id="5292315">.</span><span class="ident" id="5292316">labelScope</span><span class="op" id="5292326">.</span><span class="ident" id="5292327">Outer</span><br>
<span class="lineno">110</span><span class="op" id="5292333">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5292336">func</span>&nbsp;<span class="op" id="5292341">(</span><span class="ident" id="5292342">p</span>&nbsp;<span class="op" id="5292344">*</span><span class="ident" id="5292345">parser</span><span class="op" id="5292351">)</span>&nbsp;<span class="ident" id="5292353">declare</span><span class="op" id="5292360">(</span><span class="ident" id="5292361">decl</span><span class="op" id="5292365">,</span>&nbsp;<span class="ident" id="5292367">data</span>&nbsp;<span class="keyword" id="5292372">interface</span><span class="op" id="5292381">{</span><span class="op" id="5292382">}</span><span class="op" id="5292383">,</span>&nbsp;<span class="ident" id="5292385">scope</span>&nbsp;<span class="op" id="5292391">*</span><span class="ident" id="5292392">ast</span><span class="op" id="5292395">.</span><span class="ident" id="5292396">Scope</span><span class="op" id="5292401">,</span>&nbsp;<span class="ident" id="5292403">kind</span>&nbsp;<span class="ident" id="5292408">ast</span><span class="op" id="5292411">.</span><span class="ident" id="5292412">ObjKind</span><span class="op" id="5292419">,</span>&nbsp;<span class="ident" id="5292421">idents</span>&nbsp;<span class="op" id="5292428">...</span><span class="op" id="5292431">*</span><span class="ident" id="5292432">ast</span><span class="op" id="5292435">.</span><span class="ident" id="5292436">Ident</span><span class="op" id="5292441">)</span>&nbsp;<span class="op" id="5292443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292446">for</span>&nbsp;<span class="ident" id="5292450">_</span><span class="op" id="5292451">,</span>&nbsp;<span class="ident" id="5292453">ident</span>&nbsp;<span class="op" id="5292459">:=</span>&nbsp;<span class="keyword" id="5292462">range</span>&nbsp;<span class="ident" id="5292468">idents</span>&nbsp;<span class="op" id="5292475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292479">assert</span><span class="op" id="5292485">(</span><span class="ident" id="5292486">ident</span><span class="op" id="5292491">.</span><span class="ident" id="5292492">Obj</span>&nbsp;<span class="op" id="5292496">==</span>&nbsp;<span class="builtintype" id="5292499">nil</span><span class="op" id="5292502">,</span>&nbsp;<span class="string" id="5292504">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5292545">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292549">obj</span>&nbsp;<span class="op" id="5292553">:=</span>&nbsp;<span class="ident" id="5292556">ast</span><span class="op" id="5292559">.</span><span class="ident" id="5292560">NewObj</span><span class="op" id="5292566">(</span><span class="ident" id="5292567">kind</span><span class="op" id="5292571">,</span>&nbsp;<span class="ident" id="5292573">ident</span><span class="op" id="5292578">.</span><span class="ident" id="5292579">Name</span><span class="op" id="5292583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5292587">//&nbsp;remember&nbsp;the&nbsp;corresponding&nbsp;declaration&nbsp;for&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5292649">//&nbsp;errors&nbsp;and&nbsp;global&nbsp;variable&nbsp;resolution/typechecking&nbsp;phase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292711">obj</span><span class="op" id="5292714">.</span><span class="ident" id="5292715">Decl</span>&nbsp;<span class="op" id="5292720">=</span>&nbsp;<span class="ident" id="5292722">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292729">obj</span><span class="op" id="5292732">.</span><span class="ident" id="5292733">Data</span>&nbsp;<span class="op" id="5292738">=</span>&nbsp;<span class="ident" id="5292740">data</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292747">ident</span><span class="op" id="5292752">.</span><span class="ident" id="5292753">Obj</span>&nbsp;<span class="op" id="5292757">=</span>&nbsp;<span class="ident" id="5292759">obj</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292765">if</span>&nbsp;<span class="ident" id="5292768">ident</span><span class="op" id="5292773">.</span><span class="ident" id="5292774">Name</span>&nbsp;<span class="op" id="5292779">!=</span>&nbsp;<span class="string" id="5292782">&#34;_&#34;</span>&nbsp;<span class="op" id="5292786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292791">if</span>&nbsp;<span class="ident" id="5292794">alt</span>&nbsp;<span class="op" id="5292798">:=</span>&nbsp;<span class="ident" id="5292801">scope</span><span class="op" id="5292806">.</span><span class="ident" id="5292807">Insert</span><span class="op" id="5292813">(</span><span class="ident" id="5292814">obj</span><span class="op" id="5292817">)</span><span class="op" id="5292818">;</span>&nbsp;<span class="ident" id="5292820">alt</span>&nbsp;<span class="op" id="5292824">!=</span>&nbsp;<span class="builtintype" id="5292827">nil</span>&nbsp;<span class="op" id="5292831">&amp;&amp;</span>&nbsp;<span class="ident" id="5292834">p</span><span class="op" id="5292835">.</span><span class="ident" id="5292836">mode</span><span class="op" id="5292840">&amp;</span><span class="ident" id="5292841">DeclarationErrors</span>&nbsp;<span class="op" id="5292859">!=</span>&nbsp;<span class="num" id="5292862">0</span>&nbsp;<span class="op" id="5292864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292870">prevDecl</span>&nbsp;<span class="op" id="5292879">:=</span>&nbsp;<span class="string" id="5292882">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5292889">if</span>&nbsp;<span class="ident" id="5292892">pos</span>&nbsp;<span class="op" id="5292896">:=</span>&nbsp;<span class="ident" id="5292899">alt</span><span class="op" id="5292902">.</span><span class="ident" id="5292903">Pos</span><span class="op" id="5292906">(</span><span class="op" id="5292907">)</span><span class="op" id="5292908">;</span>&nbsp;<span class="ident" id="5292910">pos</span><span class="op" id="5292913">.</span><span class="ident" id="5292914">IsValid</span><span class="op" id="5292921">(</span><span class="op" id="5292922">)</span>&nbsp;<span class="op" id="5292924">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5292931">prevDecl</span>&nbsp;<span class="op" id="5292940">=</span>&nbsp;<span class="ident" id="5292942">fmt</span><span class="op" id="5292945">.</span><span class="ident" id="5292946">Sprintf</span><span class="op" id="5292953">(</span><span class="string" id="5292954">&#34;\n\tprevious&nbsp;declaration&nbsp;at&nbsp;%s&#34;</span><span class="op" id="5292986">,</span>&nbsp;<span class="ident" id="5292988">p</span><span class="op" id="5292989">.</span><span class="ident" id="5292990">file</span><span class="op" id="5292994">.</span><span class="ident" id="5292995">Position</span><span class="op" id="5293003">(</span><span class="ident" id="5293004">pos</span><span class="op" id="5293007">)</span><span class="op" id="5293008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293020">p</span><span class="op" id="5293021">.</span><span class="builtintype" id="5293022">error</span><span class="op" id="5293027">(</span><span class="ident" id="5293028">ident</span><span class="op" id="5293033">.</span><span class="ident" id="5293034">Pos</span><span class="op" id="5293037">(</span><span class="op" id="5293038">)</span><span class="op" id="5293039">,</span>&nbsp;<span class="ident" id="5293041">fmt</span><span class="op" id="5293044">.</span><span class="ident" id="5293045">Sprintf</span><span class="op" id="5293052">(</span><span class="string" id="5293053">&#34;%s&nbsp;redeclared&nbsp;in&nbsp;this&nbsp;block%s&#34;</span><span class="op" id="5293084">,</span>&nbsp;<span class="ident" id="5293086">ident</span><span class="op" id="5293091">.</span><span class="ident" id="5293092">Name</span><span class="op" id="5293096">,</span>&nbsp;<span class="ident" id="5293098">prevDecl</span><span class="op" id="5293106">)</span><span class="op" id="5293107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293116">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293119">}</span><br>
<span class="lineno"></span><span class="op" id="5293121">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5293124">func</span>&nbsp;<span class="op" id="5293129">(</span><span class="ident" id="5293130">p</span>&nbsp;<span class="op" id="5293132">*</span><span class="ident" id="5293133">parser</span><span class="op" id="5293139">)</span>&nbsp;<span class="ident" id="5293141">shortVarDecl</span><span class="op" id="5293153">(</span><span class="ident" id="5293154">decl</span>&nbsp;<span class="op" id="5293159">*</span><span class="ident" id="5293160">ast</span><span class="op" id="5293163">.</span><span class="ident" id="5293164">AssignStmt</span><span class="op" id="5293174">,</span>&nbsp;<span class="ident" id="5293176">list</span>&nbsp;<span class="op" id="5293181">[</span><span class="op" id="5293182">]</span><span class="ident" id="5293183">ast</span><span class="op" id="5293186">.</span><span class="ident" id="5293187">Expr</span><span class="op" id="5293191">)</span>&nbsp;<span class="op" id="5293193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5293196">//&nbsp;Go&nbsp;spec:&nbsp;A&nbsp;short&nbsp;variable&nbsp;declaration&nbsp;may&nbsp;redeclare&nbsp;variables</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5293262">//&nbsp;provided&nbsp;they&nbsp;were&nbsp;originally&nbsp;declared&nbsp;in&nbsp;the&nbsp;same&nbsp;block&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5293328">//&nbsp;the&nbsp;same&nbsp;type,&nbsp;and&nbsp;at&nbsp;least&nbsp;one&nbsp;of&nbsp;the&nbsp;non-blank&nbsp;variables&nbsp;is&nbsp;new.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293399">n</span>&nbsp;<span class="op" id="5293401">:=</span>&nbsp;<span class="num" id="5293404">0</span>&nbsp;<span class="comment" id="5293406">//&nbsp;number&nbsp;of&nbsp;new&nbsp;variables</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293434">for</span>&nbsp;<span class="ident" id="5293438">_</span><span class="op" id="5293439">,</span>&nbsp;<span class="ident" id="5293441">x</span>&nbsp;<span class="op" id="5293443">:=</span>&nbsp;<span class="keyword" id="5293446">range</span>&nbsp;<span class="ident" id="5293452">list</span>&nbsp;<span class="op" id="5293457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293461">if</span>&nbsp;<span class="ident" id="5293464">ident</span><span class="op" id="5293469">,</span>&nbsp;<span class="ident" id="5293471">isIdent</span>&nbsp;<span class="op" id="5293479">:=</span>&nbsp;<span class="ident" id="5293482">x</span><span class="op" id="5293483">.</span><span class="op" id="5293484">(</span><span class="op" id="5293485">*</span><span class="ident" id="5293486">ast</span><span class="op" id="5293489">.</span><span class="ident" id="5293490">Ident</span><span class="op" id="5293495">)</span><span class="op" id="5293496">;</span>&nbsp;<span class="ident" id="5293498">isIdent</span>&nbsp;<span class="op" id="5293506">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293511">assert</span><span class="op" id="5293517">(</span><span class="ident" id="5293518">ident</span><span class="op" id="5293523">.</span><span class="ident" id="5293524">Obj</span>&nbsp;<span class="op" id="5293528">==</span>&nbsp;<span class="builtintype" id="5293531">nil</span><span class="op" id="5293534">,</span>&nbsp;<span class="string" id="5293536">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5293577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293582">obj</span>&nbsp;<span class="op" id="5293586">:=</span>&nbsp;<span class="ident" id="5293589">ast</span><span class="op" id="5293592">.</span><span class="ident" id="5293593">NewObj</span><span class="op" id="5293599">(</span><span class="ident" id="5293600">ast</span><span class="op" id="5293603">.</span><span class="ident" id="5293604">Var</span><span class="op" id="5293607">,</span>&nbsp;<span class="ident" id="5293609">ident</span><span class="op" id="5293614">.</span><span class="ident" id="5293615">Name</span><span class="op" id="5293619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5293624">//&nbsp;remember&nbsp;corresponding&nbsp;assignment&nbsp;for&nbsp;other&nbsp;tools</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293680">obj</span><span class="op" id="5293683">.</span><span class="ident" id="5293684">Decl</span>&nbsp;<span class="op" id="5293689">=</span>&nbsp;<span class="ident" id="5293691">decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293699">ident</span><span class="op" id="5293704">.</span><span class="ident" id="5293705">Obj</span>&nbsp;<span class="op" id="5293709">=</span>&nbsp;<span class="ident" id="5293711">obj</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293718">if</span>&nbsp;<span class="ident" id="5293721">ident</span><span class="op" id="5293726">.</span><span class="ident" id="5293727">Name</span>&nbsp;<span class="op" id="5293732">!=</span>&nbsp;<span class="string" id="5293735">&#34;_&#34;</span>&nbsp;<span class="op" id="5293739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293745">if</span>&nbsp;<span class="ident" id="5293748">alt</span>&nbsp;<span class="op" id="5293752">:=</span>&nbsp;<span class="ident" id="5293755">p</span><span class="op" id="5293756">.</span><span class="ident" id="5293757">topScope</span><span class="op" id="5293765">.</span><span class="ident" id="5293766">Insert</span><span class="op" id="5293772">(</span><span class="ident" id="5293773">obj</span><span class="op" id="5293776">)</span><span class="op" id="5293777">;</span>&nbsp;<span class="ident" id="5293779">alt</span>&nbsp;<span class="op" id="5293783">!=</span>&nbsp;<span class="builtintype" id="5293786">nil</span>&nbsp;<span class="op" id="5293790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293797">ident</span><span class="op" id="5293802">.</span><span class="ident" id="5293803">Obj</span>&nbsp;<span class="op" id="5293807">=</span>&nbsp;<span class="ident" id="5293809">alt</span>&nbsp;<span class="comment" id="5293813">//&nbsp;redeclaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293834">}</span>&nbsp;<span class="keyword" id="5293836">else</span>&nbsp;<span class="op" id="5293841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293848">n</span><span class="op" id="5293849">++</span>&nbsp;<span class="comment" id="5293852">//&nbsp;new&nbsp;declaration</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293884">}</span>&nbsp;<span class="keyword" id="5293886">else</span>&nbsp;<span class="op" id="5293891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5293896">p</span><span class="op" id="5293897">.</span><span class="ident" id="5293898">errorExpected</span><span class="op" id="5293911">(</span><span class="ident" id="5293912">x</span><span class="op" id="5293913">.</span><span class="ident" id="5293914">Pos</span><span class="op" id="5293917">(</span><span class="op" id="5293918">)</span><span class="op" id="5293919">,</span>&nbsp;<span class="string" id="5293921">&#34;identifier&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5293952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293956">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5293959">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5293962">if</span>&nbsp;<span class="ident" id="5293965">n</span>&nbsp;<span class="op" id="5293967">==</span>&nbsp;<span class="num" id="5293970">0</span>&nbsp;<span class="op" id="5293972">&amp;&amp;</span>&nbsp;<span class="ident" id="5293975">p</span><span class="op" id="5293976">.</span><span class="ident" id="5293977">mode</span><span class="op" id="5293981">&amp;</span><span class="ident" id="5293982">DeclarationErrors</span>&nbsp;<span class="op" id="5294000">!=</span>&nbsp;<span class="num" id="5294003">0</span>&nbsp;<span class="op" id="5294005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5294009">p</span><span class="op" id="5294010">.</span><span class="builtintype" id="5294011">error</span><span class="op" id="5294016">(</span><span class="ident" id="5294017">list</span><span class="op" id="5294021">[</span><span class="num" id="5294022">0</span><span class="op" id="5294023">]</span><span class="op" id="5294024">.</span><span class="ident" id="5294025">Pos</span><span class="op" id="5294028">(</span><span class="op" id="5294029">)</span><span class="op" id="5294030">,</span>&nbsp;<span class="string" id="5294032">&#34;no&nbsp;new&nbsp;variables&nbsp;on&nbsp;left&nbsp;side&nbsp;of&nbsp;:=&#34;</span><span class="op" id="5294069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5294072">}</span><br>
<span class="lineno"></span><span class="op" id="5294074">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="5294077">//&nbsp;The&nbsp;unresolved&nbsp;object&nbsp;is&nbsp;a&nbsp;sentinel&nbsp;to&nbsp;mark&nbsp;identifiers&nbsp;that&nbsp;have&nbsp;been&nbsp;added</span><br>
<span class="lineno"></span><span class="comment" id="5294157">//&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;identifiers.&nbsp;The&nbsp;sentinel&nbsp;is&nbsp;only&nbsp;used&nbsp;for&nbsp;verifying</span><br>
<span class="lineno"></span><span class="comment" id="5294239">//&nbsp;internal&nbsp;consistency.</span><br>
<span class="lineno"></span><span class="keyword" id="5294264">var</span>&nbsp;<span class="ident" id="5294268">unresolved</span>&nbsp;<span class="op" id="5294279">=</span>&nbsp;<span class="builtinfunc" id="5294281">new</span><span class="op" id="5294284">(</span><span class="ident" id="5294285">ast</span><span class="op" id="5294288">.</span><span class="ident" id="5294289">Object</span><span class="op" id="5294295">)</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="5294298">//&nbsp;If&nbsp;x&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;tryResolve&nbsp;attempts&nbsp;to&nbsp;resolve&nbsp;x&nbsp;by&nbsp;looking&nbsp;up</span><br>
<span class="lineno"></span><span class="comment" id="5294371">//&nbsp;the&nbsp;object&nbsp;it&nbsp;denotes.&nbsp;If&nbsp;no&nbsp;object&nbsp;is&nbsp;found&nbsp;and&nbsp;collectUnresolved&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5294444">//&nbsp;set,&nbsp;x&nbsp;is&nbsp;marked&nbsp;as&nbsp;unresolved&nbsp;and&nbsp;collected&nbsp;in&nbsp;the&nbsp;list&nbsp;of&nbsp;unresolved</span><br>
<span class="lineno"></span><span class="comment" id="5294518">//&nbsp;identifiers.</span><br>
<span class="lineno">170</span><span class="comment" id="5294534">//</span><br>
<span class="lineno"></span><span class="keyword" id="5294537">func</span>&nbsp;<span class="op" id="5294542">(</span><span class="ident" id="5294543">p</span>&nbsp;<span class="op" id="5294545">*</span><span class="ident" id="5294546">parser</span><span class="op" id="5294552">)</span>&nbsp;<span class="ident" id="5294554">tryResolve</span><span class="op" id="5294564">(</span><span class="ident" id="5294565">x</span>&nbsp;<span class="ident" id="5294567">ast</span><span class="op" id="5294570">.</span><span class="ident" id="5294571">Expr</span><span class="op" id="5294575">,</span>&nbsp;<span class="ident" id="5294577">collectUnresolved</span>&nbsp;<span class="builtintype" id="5294595">bool</span><span class="op" id="5294599">)</span>&nbsp;<span class="op" id="5294601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5294604">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;if&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;identifier&nbsp;or&nbsp;the&nbsp;blank&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5294672">ident</span><span class="op" id="5294677">,</span>&nbsp;<span class="ident" id="5294679">_</span>&nbsp;<span class="op" id="5294681">:=</span>&nbsp;<span class="ident" id="5294684">x</span><span class="op" id="5294685">.</span><span class="op" id="5294686">(</span><span class="op" id="5294687">*</span><span class="ident" id="5294688">ast</span><span class="op" id="5294691">.</span><span class="ident" id="5294692">Ident</span><span class="op" id="5294697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294700">if</span>&nbsp;<span class="ident" id="5294703">ident</span>&nbsp;<span class="op" id="5294709">==</span>&nbsp;<span class="builtintype" id="5294712">nil</span>&nbsp;<span class="op" id="5294716">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294720">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5294728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5294731">assert</span><span class="op" id="5294737">(</span><span class="ident" id="5294738">ident</span><span class="op" id="5294743">.</span><span class="ident" id="5294744">Obj</span>&nbsp;<span class="op" id="5294748">==</span>&nbsp;<span class="builtintype" id="5294751">nil</span><span class="op" id="5294754">,</span>&nbsp;<span class="string" id="5294756">&#34;identifier&nbsp;already&nbsp;declared&nbsp;or&nbsp;resolved&#34;</span><span class="op" id="5294797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294800">if</span>&nbsp;<span class="ident" id="5294803">ident</span><span class="op" id="5294808">.</span><span class="ident" id="5294809">Name</span>&nbsp;<span class="op" id="5294814">==</span>&nbsp;<span class="string" id="5294817">&#34;_&#34;</span>&nbsp;<span class="op" id="5294821">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294825">return</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5294833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5294836">//&nbsp;try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294870">for</span>&nbsp;<span class="ident" id="5294874">s</span>&nbsp;<span class="op" id="5294876">:=</span>&nbsp;<span class="ident" id="5294879">p</span><span class="op" id="5294880">.</span><span class="ident" id="5294881">topScope</span><span class="op" id="5294889">;</span>&nbsp;<span class="ident" id="5294891">s</span>&nbsp;<span class="op" id="5294893">!=</span>&nbsp;<span class="builtintype" id="5294896">nil</span><span class="op" id="5294899">;</span>&nbsp;<span class="ident" id="5294901">s</span>&nbsp;<span class="op" id="5294903">=</span>&nbsp;<span class="ident" id="5294905">s</span><span class="op" id="5294906">.</span><span class="ident" id="5294907">Outer</span>&nbsp;<span class="op" id="5294913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294917">if</span>&nbsp;<span class="ident" id="5294920">obj</span>&nbsp;<span class="op" id="5294924">:=</span>&nbsp;<span class="ident" id="5294927">s</span><span class="op" id="5294928">.</span><span class="ident" id="5294929">Lookup</span><span class="op" id="5294935">(</span><span class="ident" id="5294936">ident</span><span class="op" id="5294941">.</span><span class="ident" id="5294942">Name</span><span class="op" id="5294946">)</span><span class="op" id="5294947">;</span>&nbsp;<span class="ident" id="5294949">obj</span>&nbsp;<span class="op" id="5294953">!=</span>&nbsp;<span class="builtintype" id="5294956">nil</span>&nbsp;<span class="op" id="5294960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5294965">ident</span><span class="op" id="5294970">.</span><span class="ident" id="5294971">Obj</span>&nbsp;<span class="op" id="5294975">=</span>&nbsp;<span class="ident" id="5294977">obj</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5294984">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5294993">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5294996">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5294999">//&nbsp;all&nbsp;local&nbsp;scopes&nbsp;are&nbsp;known,&nbsp;so&nbsp;any&nbsp;unresolved&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5295060">//&nbsp;must&nbsp;be&nbsp;found&nbsp;either&nbsp;in&nbsp;the&nbsp;file&nbsp;scope,&nbsp;package&nbsp;scope</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5295118">//&nbsp;(perhaps&nbsp;in&nbsp;another&nbsp;file),&nbsp;or&nbsp;universe&nbsp;scope&nbsp;---&nbsp;collect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5295179">//&nbsp;them&nbsp;so&nbsp;that&nbsp;they&nbsp;can&nbsp;be&nbsp;resolved&nbsp;later</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5295223">if</span>&nbsp;<span class="ident" id="5295226">collectUnresolved</span>&nbsp;<span class="op" id="5295244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295248">ident</span><span class="op" id="5295253">.</span><span class="ident" id="5295254">Obj</span>&nbsp;<span class="op" id="5295258">=</span>&nbsp;<span class="ident" id="5295260">unresolved</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295273">p</span><span class="op" id="5295274">.</span><span class="ident" id="5295275">unresolved</span>&nbsp;<span class="op" id="5295286">=</span>&nbsp;<span class="builtinfunc" id="5295288">append</span><span class="op" id="5295294">(</span><span class="ident" id="5295295">p</span><span class="op" id="5295296">.</span><span class="ident" id="5295297">unresolved</span><span class="op" id="5295307">,</span>&nbsp;<span class="ident" id="5295309">ident</span><span class="op" id="5295314">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5295317">}</span><br>
<span class="lineno"></span><span class="op" id="5295319">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5295322">func</span>&nbsp;<span class="op" id="5295327">(</span><span class="ident" id="5295328">p</span>&nbsp;<span class="op" id="5295330">*</span><span class="ident" id="5295331">parser</span><span class="op" id="5295337">)</span>&nbsp;<span class="ident" id="5295339">resolve</span><span class="op" id="5295346">(</span><span class="ident" id="5295347">x</span>&nbsp;<span class="ident" id="5295349">ast</span><span class="op" id="5295352">.</span><span class="ident" id="5295353">Expr</span><span class="op" id="5295357">)</span>&nbsp;<span class="op" id="5295359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295362">p</span><span class="op" id="5295363">.</span><span class="ident" id="5295364">tryResolve</span><span class="op" id="5295374">(</span><span class="ident" id="5295375">x</span><span class="op" id="5295376">,</span>&nbsp;<span class="builtintype" id="5295378">true</span><span class="op" id="5295382">)</span><br>
<span class="lineno">200</span><span class="op" id="5295384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5295387">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5295467">//&nbsp;Parsing&nbsp;support</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5295487">func</span>&nbsp;<span class="op" id="5295492">(</span><span class="ident" id="5295493">p</span>&nbsp;<span class="op" id="5295495">*</span><span class="ident" id="5295496">parser</span><span class="op" id="5295502">)</span>&nbsp;<span class="ident" id="5295504">printTrace</span><span class="op" id="5295514">(</span><span class="ident" id="5295515">a</span>&nbsp;<span class="op" id="5295517">...</span><span class="keyword" id="5295520">interface</span><span class="op" id="5295529">{</span><span class="op" id="5295530">}</span><span class="op" id="5295531">)</span>&nbsp;<span class="op" id="5295533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5295536">const</span>&nbsp;<span class="ident" id="5295542">dots</span>&nbsp;<span class="op" id="5295547">=</span>&nbsp;<span class="string" id="5295549">&#34;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;.&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5295617">const</span>&nbsp;<span class="ident" id="5295623">n</span>&nbsp;<span class="op" id="5295625">=</span>&nbsp;<span class="builtinfunc" id="5295627">len</span><span class="op" id="5295630">(</span><span class="ident" id="5295631">dots</span><span class="op" id="5295635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295638">pos</span>&nbsp;<span class="op" id="5295642">:=</span>&nbsp;<span class="ident" id="5295645">p</span><span class="op" id="5295646">.</span><span class="ident" id="5295647">file</span><span class="op" id="5295651">.</span><span class="ident" id="5295652">Position</span><span class="op" id="5295660">(</span><span class="ident" id="5295661">p</span><span class="op" id="5295662">.</span><span class="ident" id="5295663">pos</span><span class="op" id="5295666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295669">fmt</span><span class="op" id="5295672">.</span><span class="ident" id="5295673">Printf</span><span class="op" id="5295679">(</span><span class="string" id="5295680">&#34;%5d:%3d:&nbsp;&#34;</span><span class="op" id="5295691">,</span>&nbsp;<span class="ident" id="5295693">pos</span><span class="op" id="5295696">.</span><span class="ident" id="5295697">Line</span><span class="op" id="5295701">,</span>&nbsp;<span class="ident" id="5295703">pos</span><span class="op" id="5295706">.</span><span class="ident" id="5295707">Column</span><span class="op" id="5295713">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295716">i</span>&nbsp;<span class="op" id="5295718">:=</span>&nbsp;<span class="num" id="5295721">2</span>&nbsp;<span class="op" id="5295723">*</span>&nbsp;<span class="ident" id="5295725">p</span><span class="op" id="5295726">.</span><span class="ident" id="5295727">indent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5295735">for</span>&nbsp;<span class="ident" id="5295739">i</span>&nbsp;<span class="op" id="5295741">&gt;</span>&nbsp;<span class="ident" id="5295743">n</span>&nbsp;<span class="op" id="5295745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295749">fmt</span><span class="op" id="5295752">.</span><span class="ident" id="5295753">Print</span><span class="op" id="5295758">(</span><span class="ident" id="5295759">dots</span><span class="op" id="5295763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295767">i</span>&nbsp;<span class="op" id="5295769">-=</span>&nbsp;<span class="ident" id="5295772">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5295775">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5295778">//&nbsp;i&nbsp;&lt;=&nbsp;n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295789">fmt</span><span class="op" id="5295792">.</span><span class="ident" id="5295793">Print</span><span class="op" id="5295798">(</span><span class="ident" id="5295799">dots</span><span class="op" id="5295803">[</span><span class="num" id="5295804">0</span><span class="op" id="5295805">:</span><span class="ident" id="5295806">i</span><span class="op" id="5295807">]</span><span class="op" id="5295808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295811">fmt</span><span class="op" id="5295814">.</span><span class="ident" id="5295815">Println</span><span class="op" id="5295822">(</span><span class="ident" id="5295823">a</span><span class="op" id="5295824">...</span><span class="op" id="5295827">)</span><br>
<span class="lineno"></span><span class="op" id="5295829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="keyword" id="5295832">func</span>&nbsp;<span class="ident" id="5295837">trace</span><span class="op" id="5295842">(</span><span class="ident" id="5295843">p</span>&nbsp;<span class="op" id="5295845">*</span><span class="ident" id="5295846">parser</span><span class="op" id="5295852">,</span>&nbsp;<span class="ident" id="5295854">msg</span>&nbsp;<span class="builtintype" id="5295858">string</span><span class="op" id="5295864">)</span>&nbsp;<span class="op" id="5295866">*</span><span class="ident" id="5295867">parser</span>&nbsp;<span class="op" id="5295874">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295877">p</span><span class="op" id="5295878">.</span><span class="ident" id="5295879">printTrace</span><span class="op" id="5295889">(</span><span class="ident" id="5295890">msg</span><span class="op" id="5295893">,</span>&nbsp;<span class="string" id="5295895">&#34;(&#34;</span><span class="op" id="5295898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295901">p</span><span class="op" id="5295902">.</span><span class="ident" id="5295903">indent</span><span class="op" id="5295909">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5295913">return</span>&nbsp;<span class="ident" id="5295920">p</span><br>
<span class="lineno"></span><span class="op" id="5295922">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="5295925">//&nbsp;Usage&nbsp;pattern:&nbsp;defer&nbsp;un(trace(p,&nbsp;&#34;...&#34;))</span><br>
<span class="lineno"></span><span class="keyword" id="5295969">func</span>&nbsp;<span class="ident" id="5295974">un</span><span class="op" id="5295976">(</span><span class="ident" id="5295977">p</span>&nbsp;<span class="op" id="5295979">*</span><span class="ident" id="5295980">parser</span><span class="op" id="5295986">)</span>&nbsp;<span class="op" id="5295988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5295991">p</span><span class="op" id="5295992">.</span><span class="ident" id="5295993">indent</span><span class="op" id="5295999">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296003">p</span><span class="op" id="5296004">.</span><span class="ident" id="5296005">printTrace</span><span class="op" id="5296015">(</span><span class="string" id="5296016">&#34;)&#34;</span><span class="op" id="5296019">)</span><br>
<span class="lineno">230</span><span class="op" id="5296021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5296024">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;token.</span><br>
<span class="lineno"></span><span class="keyword" id="5296054">func</span>&nbsp;<span class="op" id="5296059">(</span><span class="ident" id="5296060">p</span>&nbsp;<span class="op" id="5296062">*</span><span class="ident" id="5296063">parser</span><span class="op" id="5296069">)</span>&nbsp;<span class="ident" id="5296071">next0</span><span class="op" id="5296076">(</span><span class="op" id="5296077">)</span>&nbsp;<span class="op" id="5296079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296082">//&nbsp;Because&nbsp;of&nbsp;one-token&nbsp;look-ahead,&nbsp;print&nbsp;the&nbsp;previous&nbsp;token</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296144">//&nbsp;when&nbsp;tracing&nbsp;as&nbsp;it&nbsp;provides&nbsp;a&nbsp;more&nbsp;readable&nbsp;output.&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296204">//&nbsp;very&nbsp;first&nbsp;token&nbsp;(!p.pos.IsValid())&nbsp;is&nbsp;not&nbsp;initialized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296263">//&nbsp;(it&nbsp;is&nbsp;token.ILLEGAL),&nbsp;so&nbsp;don&#39;t&nbsp;print&nbsp;it&nbsp;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296310">if</span>&nbsp;<span class="ident" id="5296313">p</span><span class="op" id="5296314">.</span><span class="ident" id="5296315">trace</span>&nbsp;<span class="op" id="5296321">&amp;&amp;</span>&nbsp;<span class="ident" id="5296324">p</span><span class="op" id="5296325">.</span><span class="ident" id="5296326">pos</span><span class="op" id="5296329">.</span><span class="ident" id="5296330">IsValid</span><span class="op" id="5296337">(</span><span class="op" id="5296338">)</span>&nbsp;<span class="op" id="5296340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296344">s</span>&nbsp;<span class="op" id="5296346">:=</span>&nbsp;<span class="ident" id="5296349">p</span><span class="op" id="5296350">.</span><span class="ident" id="5296351">tok</span><span class="op" id="5296354">.</span><span class="ident" id="5296355">String</span><span class="op" id="5296361">(</span><span class="op" id="5296362">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296366">switch</span>&nbsp;<span class="op" id="5296373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296377">case</span>&nbsp;<span class="ident" id="5296382">p</span><span class="op" id="5296383">.</span><span class="ident" id="5296384">tok</span><span class="op" id="5296387">.</span><span class="ident" id="5296388">IsLiteral</span><span class="op" id="5296397">(</span><span class="op" id="5296398">)</span><span class="op" id="5296399">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296404">p</span><span class="op" id="5296405">.</span><span class="ident" id="5296406">printTrace</span><span class="op" id="5296416">(</span><span class="ident" id="5296417">s</span><span class="op" id="5296418">,</span>&nbsp;<span class="ident" id="5296420">p</span><span class="op" id="5296421">.</span><span class="ident" id="5296422">lit</span><span class="op" id="5296425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296429">case</span>&nbsp;<span class="ident" id="5296434">p</span><span class="op" id="5296435">.</span><span class="ident" id="5296436">tok</span><span class="op" id="5296439">.</span><span class="ident" id="5296440">IsOperator</span><span class="op" id="5296450">(</span><span class="op" id="5296451">)</span><span class="op" id="5296452">,</span>&nbsp;<span class="ident" id="5296454">p</span><span class="op" id="5296455">.</span><span class="ident" id="5296456">tok</span><span class="op" id="5296459">.</span><span class="ident" id="5296460">IsKeyword</span><span class="op" id="5296469">(</span><span class="op" id="5296470">)</span><span class="op" id="5296471">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296476">p</span><span class="op" id="5296477">.</span><span class="ident" id="5296478">printTrace</span><span class="op" id="5296488">(</span><span class="string" id="5296489">&#34;\&#34;&#34;</span>&nbsp;<span class="op" id="5296494">+</span>&nbsp;<span class="ident" id="5296496">s</span>&nbsp;<span class="op" id="5296498">+</span>&nbsp;<span class="string" id="5296500">&#34;\&#34;&#34;</span><span class="op" id="5296504">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296508">default</span><span class="op" id="5296515">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296520">p</span><span class="op" id="5296521">.</span><span class="ident" id="5296522">printTrace</span><span class="op" id="5296532">(</span><span class="ident" id="5296533">s</span><span class="op" id="5296534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5296538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5296541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296545">p</span><span class="op" id="5296546">.</span><span class="ident" id="5296547">pos</span><span class="op" id="5296550">,</span>&nbsp;<span class="ident" id="5296552">p</span><span class="op" id="5296553">.</span><span class="ident" id="5296554">tok</span><span class="op" id="5296557">,</span>&nbsp;<span class="ident" id="5296559">p</span><span class="op" id="5296560">.</span><span class="ident" id="5296561">lit</span>&nbsp;<span class="op" id="5296565">=</span>&nbsp;<span class="ident" id="5296567">p</span><span class="op" id="5296568">.</span><span class="ident" id="5296569">scanner</span><span class="op" id="5296576">.</span><span class="ident" id="5296577">Scan</span><span class="op" id="5296581">(</span><span class="op" id="5296582">)</span><br>
<span class="lineno"></span><span class="op" id="5296584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5296587">//&nbsp;Consume&nbsp;a&nbsp;comment&nbsp;and&nbsp;return&nbsp;it&nbsp;and&nbsp;the&nbsp;line&nbsp;on&nbsp;which&nbsp;it&nbsp;ends.</span><br>
<span class="lineno"></span><span class="keyword" id="5296653">func</span>&nbsp;<span class="op" id="5296658">(</span><span class="ident" id="5296659">p</span>&nbsp;<span class="op" id="5296661">*</span><span class="ident" id="5296662">parser</span><span class="op" id="5296668">)</span>&nbsp;<span class="ident" id="5296670">consumeComment</span><span class="op" id="5296684">(</span><span class="op" id="5296685">)</span>&nbsp;<span class="op" id="5296687">(</span><span class="ident" id="5296688">comment</span>&nbsp;<span class="op" id="5296696">*</span><span class="ident" id="5296697">ast</span><span class="op" id="5296700">.</span><span class="ident" id="5296701">Comment</span><span class="op" id="5296708">,</span>&nbsp;<span class="ident" id="5296710">endline</span>&nbsp;<span class="builtintype" id="5296718">int</span><span class="op" id="5296721">)</span>&nbsp;<span class="op" id="5296723">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296726">//&nbsp;/*-style&nbsp;comments&nbsp;may&nbsp;end&nbsp;on&nbsp;a&nbsp;different&nbsp;line&nbsp;than&nbsp;where&nbsp;they&nbsp;start.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296799">//&nbsp;Scan&nbsp;the&nbsp;comment&nbsp;for&nbsp;&#39;\n&#39;&nbsp;chars&nbsp;and&nbsp;adjust&nbsp;endline&nbsp;accordingly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5296867">endline</span>&nbsp;<span class="op" id="5296875">=</span>&nbsp;<span class="ident" id="5296877">p</span><span class="op" id="5296878">.</span><span class="ident" id="5296879">file</span><span class="op" id="5296883">.</span><span class="ident" id="5296884">Line</span><span class="op" id="5296888">(</span><span class="ident" id="5296889">p</span><span class="op" id="5296890">.</span><span class="ident" id="5296891">pos</span><span class="op" id="5296894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296897">if</span>&nbsp;<span class="ident" id="5296900">p</span><span class="op" id="5296901">.</span><span class="ident" id="5296902">lit</span><span class="op" id="5296905">[</span><span class="num" id="5296906">1</span><span class="op" id="5296907">]</span>&nbsp;<span class="op" id="5296909">==</span>&nbsp;<span class="string" id="5296912">&#39;*&#39;</span>&nbsp;<span class="op" id="5296916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5296920">//&nbsp;don&#39;t&nbsp;use&nbsp;range&nbsp;here&nbsp;-&nbsp;no&nbsp;need&nbsp;to&nbsp;decode&nbsp;Unicode&nbsp;code&nbsp;points</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5296986">for</span>&nbsp;<span class="ident" id="5296990">i</span>&nbsp;<span class="op" id="5296992">:=</span>&nbsp;<span class="num" id="5296995">0</span><span class="op" id="5296996">;</span>&nbsp;<span class="ident" id="5296998">i</span>&nbsp;<span class="op" id="5297000">&lt;</span>&nbsp;<span class="builtinfunc" id="5297002">len</span><span class="op" id="5297005">(</span><span class="ident" id="5297006">p</span><span class="op" id="5297007">.</span><span class="ident" id="5297008">lit</span><span class="op" id="5297011">)</span><span class="op" id="5297012">;</span>&nbsp;<span class="ident" id="5297014">i</span><span class="op" id="5297015">++</span>&nbsp;<span class="op" id="5297018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297023">if</span>&nbsp;<span class="ident" id="5297026">p</span><span class="op" id="5297027">.</span><span class="ident" id="5297028">lit</span><span class="op" id="5297031">[</span><span class="ident" id="5297032">i</span><span class="op" id="5297033">]</span>&nbsp;<span class="op" id="5297035">==</span>&nbsp;<span class="string" id="5297038">&#39;\n&#39;</span>&nbsp;<span class="op" id="5297043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297049">endline</span><span class="op" id="5297056">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5297062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5297066">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5297069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297073">comment</span>&nbsp;<span class="op" id="5297081">=</span>&nbsp;<span class="op" id="5297083">&amp;</span><span class="ident" id="5297084">ast</span><span class="op" id="5297087">.</span><span class="ident" id="5297088">Comment</span><span class="op" id="5297095">{</span><span class="ident" id="5297096">Slash</span><span class="op" id="5297101">:</span>&nbsp;<span class="ident" id="5297103">p</span><span class="op" id="5297104">.</span><span class="ident" id="5297105">pos</span><span class="op" id="5297108">,</span>&nbsp;<span class="ident" id="5297110">Text</span><span class="op" id="5297114">:</span>&nbsp;<span class="ident" id="5297116">p</span><span class="op" id="5297117">.</span><span class="ident" id="5297118">lit</span><span class="op" id="5297121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297124">p</span><span class="op" id="5297125">.</span><span class="ident" id="5297126">next0</span><span class="op" id="5297131">(</span><span class="op" id="5297132">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297136">return</span><br>
<span class="lineno"></span><span class="op" id="5297143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5297146">//&nbsp;Consume&nbsp;a&nbsp;group&nbsp;of&nbsp;adjacent&nbsp;comments,&nbsp;add&nbsp;it&nbsp;to&nbsp;the&nbsp;parser&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5297210">//&nbsp;comments&nbsp;list,&nbsp;and&nbsp;return&nbsp;it&nbsp;together&nbsp;with&nbsp;the&nbsp;line&nbsp;at&nbsp;which</span><br>
<span class="lineno">275</span><span class="comment" id="5297274">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;in&nbsp;the&nbsp;group&nbsp;ends.&nbsp;A&nbsp;non-comment&nbsp;token&nbsp;or&nbsp;n</span><br>
<span class="lineno"></span><span class="comment" id="5297338">//&nbsp;empty&nbsp;lines&nbsp;terminate&nbsp;a&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5297380">//</span><br>
<span class="lineno"></span><span class="keyword" id="5297383">func</span>&nbsp;<span class="op" id="5297388">(</span><span class="ident" id="5297389">p</span>&nbsp;<span class="op" id="5297391">*</span><span class="ident" id="5297392">parser</span><span class="op" id="5297398">)</span>&nbsp;<span class="ident" id="5297400">consumeCommentGroup</span><span class="op" id="5297419">(</span><span class="ident" id="5297420">n</span>&nbsp;<span class="builtintype" id="5297422">int</span><span class="op" id="5297425">)</span>&nbsp;<span class="op" id="5297427">(</span><span class="ident" id="5297428">comments</span>&nbsp;<span class="op" id="5297437">*</span><span class="ident" id="5297438">ast</span><span class="op" id="5297441">.</span><span class="ident" id="5297442">CommentGroup</span><span class="op" id="5297454">,</span>&nbsp;<span class="ident" id="5297456">endline</span>&nbsp;<span class="builtintype" id="5297464">int</span><span class="op" id="5297467">)</span>&nbsp;<span class="op" id="5297469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297472">var</span>&nbsp;<span class="ident" id="5297476">list</span>&nbsp;<span class="op" id="5297481">[</span><span class="op" id="5297482">]</span><span class="op" id="5297483">*</span><span class="ident" id="5297484">ast</span><span class="op" id="5297487">.</span><span class="ident" id="5297488">Comment</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297497">endline</span>&nbsp;<span class="op" id="5297505">=</span>&nbsp;<span class="ident" id="5297507">p</span><span class="op" id="5297508">.</span><span class="ident" id="5297509">file</span><span class="op" id="5297513">.</span><span class="ident" id="5297514">Line</span><span class="op" id="5297518">(</span><span class="ident" id="5297519">p</span><span class="op" id="5297520">.</span><span class="ident" id="5297521">pos</span><span class="op" id="5297524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297527">for</span>&nbsp;<span class="ident" id="5297531">p</span><span class="op" id="5297532">.</span><span class="ident" id="5297533">tok</span>&nbsp;<span class="op" id="5297537">==</span>&nbsp;<span class="ident" id="5297540">token</span><span class="op" id="5297545">.</span><span class="ident" id="5297546">COMMENT</span>&nbsp;<span class="op" id="5297554">&amp;&amp;</span>&nbsp;<span class="ident" id="5297557">p</span><span class="op" id="5297558">.</span><span class="ident" id="5297559">file</span><span class="op" id="5297563">.</span><span class="ident" id="5297564">Line</span><span class="op" id="5297568">(</span><span class="ident" id="5297569">p</span><span class="op" id="5297570">.</span><span class="ident" id="5297571">pos</span><span class="op" id="5297574">)</span>&nbsp;<span class="op" id="5297576">&lt;=</span>&nbsp;<span class="ident" id="5297579">endline</span><span class="op" id="5297586">+</span><span class="ident" id="5297587">n</span>&nbsp;<span class="op" id="5297589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297593">var</span>&nbsp;<span class="ident" id="5297597">comment</span>&nbsp;<span class="op" id="5297605">*</span><span class="ident" id="5297606">ast</span><span class="op" id="5297609">.</span><span class="ident" id="5297610">Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297620">comment</span><span class="op" id="5297627">,</span>&nbsp;<span class="ident" id="5297629">endline</span>&nbsp;<span class="op" id="5297637">=</span>&nbsp;<span class="ident" id="5297639">p</span><span class="op" id="5297640">.</span><span class="ident" id="5297641">consumeComment</span><span class="op" id="5297655">(</span><span class="op" id="5297656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297660">list</span>&nbsp;<span class="op" id="5297665">=</span>&nbsp;<span class="builtinfunc" id="5297667">append</span><span class="op" id="5297673">(</span><span class="ident" id="5297674">list</span><span class="op" id="5297678">,</span>&nbsp;<span class="ident" id="5297680">comment</span><span class="op" id="5297687">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5297690">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5297694">//&nbsp;add&nbsp;comment&nbsp;group&nbsp;to&nbsp;the&nbsp;comments&nbsp;list</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297737">comments</span>&nbsp;<span class="op" id="5297746">=</span>&nbsp;<span class="op" id="5297748">&amp;</span><span class="ident" id="5297749">ast</span><span class="op" id="5297752">.</span><span class="ident" id="5297753">CommentGroup</span><span class="op" id="5297765">{</span><span class="ident" id="5297766">List</span><span class="op" id="5297770">:</span>&nbsp;<span class="ident" id="5297772">list</span><span class="op" id="5297776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5297779">p</span><span class="op" id="5297780">.</span><span class="ident" id="5297781">comments</span>&nbsp;<span class="op" id="5297790">=</span>&nbsp;<span class="builtinfunc" id="5297792">append</span><span class="op" id="5297798">(</span><span class="ident" id="5297799">p</span><span class="op" id="5297800">.</span><span class="ident" id="5297801">comments</span><span class="op" id="5297809">,</span>&nbsp;<span class="ident" id="5297811">comments</span><span class="op" id="5297819">)</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5297823">return</span><br>
<span class="lineno"></span><span class="op" id="5297830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5297833">//&nbsp;Advance&nbsp;to&nbsp;the&nbsp;next&nbsp;non-comment&nbsp;token.&nbsp;In&nbsp;the&nbsp;process,&nbsp;collect</span><br>
<span class="lineno">295</span><span class="comment" id="5297899">//&nbsp;any&nbsp;comment&nbsp;groups&nbsp;encountered,&nbsp;and&nbsp;remember&nbsp;the&nbsp;last&nbsp;lead&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5297965">//&nbsp;and&nbsp;line&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="5297987">//</span><br>
<span class="lineno"></span><span class="comment" id="5297990">//&nbsp;A&nbsp;lead&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;starts&nbsp;and&nbsp;ends&nbsp;in&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5298053">//&nbsp;line&nbsp;without&nbsp;any&nbsp;other&nbsp;tokens&nbsp;and&nbsp;that&nbsp;is&nbsp;followed&nbsp;by&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno">300</span><span class="comment" id="5298124">//&nbsp;token&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the&nbsp;comment&nbsp;group.</span><br>
<span class="lineno"></span><span class="comment" id="5298182">//</span><br>
<span class="lineno"></span><span class="comment" id="5298185">//&nbsp;A&nbsp;line&nbsp;comment&nbsp;is&nbsp;a&nbsp;comment&nbsp;group&nbsp;that&nbsp;follows&nbsp;a&nbsp;non-comment</span><br>
<span class="lineno"></span><span class="comment" id="5298249">//&nbsp;token&nbsp;on&nbsp;the&nbsp;same&nbsp;line,&nbsp;and&nbsp;that&nbsp;has&nbsp;no&nbsp;tokens&nbsp;after&nbsp;it&nbsp;on&nbsp;the&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="5298320">//&nbsp;where&nbsp;it&nbsp;ends.</span><br>
<span class="lineno">305</span><span class="comment" id="5298338">//</span><br>
<span class="lineno"></span><span class="comment" id="5298341">//&nbsp;Lead&nbsp;and&nbsp;line&nbsp;comments&nbsp;may&nbsp;be&nbsp;considered&nbsp;documentation&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="5298407">//&nbsp;stored&nbsp;in&nbsp;the&nbsp;AST.</span><br>
<span class="lineno"></span><span class="comment" id="5298429">//</span><br>
<span class="lineno"></span><span class="keyword" id="5298432">func</span>&nbsp;<span class="op" id="5298437">(</span><span class="ident" id="5298438">p</span>&nbsp;<span class="op" id="5298440">*</span><span class="ident" id="5298441">parser</span><span class="op" id="5298447">)</span>&nbsp;<span class="ident" id="5298449">next</span><span class="op" id="5298453">(</span><span class="op" id="5298454">)</span>&nbsp;<span class="op" id="5298456">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298459">p</span><span class="op" id="5298460">.</span><span class="ident" id="5298461">leadComment</span>&nbsp;<span class="op" id="5298473">=</span>&nbsp;<span class="builtintype" id="5298475">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298480">p</span><span class="op" id="5298481">.</span><span class="ident" id="5298482">lineComment</span>&nbsp;<span class="op" id="5298494">=</span>&nbsp;<span class="builtintype" id="5298496">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298501">prev</span>&nbsp;<span class="op" id="5298506">:=</span>&nbsp;<span class="ident" id="5298509">p</span><span class="op" id="5298510">.</span><span class="ident" id="5298511">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298516">p</span><span class="op" id="5298517">.</span><span class="ident" id="5298518">next0</span><span class="op" id="5298523">(</span><span class="op" id="5298524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5298528">if</span>&nbsp;<span class="ident" id="5298531">p</span><span class="op" id="5298532">.</span><span class="ident" id="5298533">tok</span>&nbsp;<span class="op" id="5298537">==</span>&nbsp;<span class="ident" id="5298540">token</span><span class="op" id="5298545">.</span><span class="ident" id="5298546">COMMENT</span>&nbsp;<span class="op" id="5298554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5298558">var</span>&nbsp;<span class="ident" id="5298562">comment</span>&nbsp;<span class="op" id="5298570">*</span><span class="ident" id="5298571">ast</span><span class="op" id="5298574">.</span><span class="ident" id="5298575">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5298590">var</span>&nbsp;<span class="ident" id="5298594">endline</span>&nbsp;<span class="builtintype" id="5298602">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5298609">if</span>&nbsp;<span class="ident" id="5298612">p</span><span class="op" id="5298613">.</span><span class="ident" id="5298614">file</span><span class="op" id="5298618">.</span><span class="ident" id="5298619">Line</span><span class="op" id="5298623">(</span><span class="ident" id="5298624">p</span><span class="op" id="5298625">.</span><span class="ident" id="5298626">pos</span><span class="op" id="5298629">)</span>&nbsp;<span class="op" id="5298631">==</span>&nbsp;<span class="ident" id="5298634">p</span><span class="op" id="5298635">.</span><span class="ident" id="5298636">file</span><span class="op" id="5298640">.</span><span class="ident" id="5298641">Line</span><span class="op" id="5298645">(</span><span class="ident" id="5298646">prev</span><span class="op" id="5298650">)</span>&nbsp;<span class="op" id="5298652">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5298657">//&nbsp;The&nbsp;comment&nbsp;is&nbsp;on&nbsp;same&nbsp;line&nbsp;as&nbsp;the&nbsp;previous&nbsp;token;&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5298717">//&nbsp;cannot&nbsp;be&nbsp;a&nbsp;lead&nbsp;comment&nbsp;but&nbsp;may&nbsp;be&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298775">comment</span><span class="op" id="5298782">,</span>&nbsp;<span class="ident" id="5298784">endline</span>&nbsp;<span class="op" id="5298792">=</span>&nbsp;<span class="ident" id="5298794">p</span><span class="op" id="5298795">.</span><span class="ident" id="5298796">consumeCommentGroup</span><span class="op" id="5298815">(</span><span class="num" id="5298816">0</span><span class="op" id="5298817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5298822">if</span>&nbsp;<span class="ident" id="5298825">p</span><span class="op" id="5298826">.</span><span class="ident" id="5298827">file</span><span class="op" id="5298831">.</span><span class="ident" id="5298832">Line</span><span class="op" id="5298836">(</span><span class="ident" id="5298837">p</span><span class="op" id="5298838">.</span><span class="ident" id="5298839">pos</span><span class="op" id="5298842">)</span>&nbsp;<span class="op" id="5298844">!=</span>&nbsp;<span class="ident" id="5298847">endline</span>&nbsp;<span class="op" id="5298855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5298861">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;on&nbsp;a&nbsp;different&nbsp;line,&nbsp;thus</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5298912">//&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;line&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5298961">p</span><span class="op" id="5298962">.</span><span class="ident" id="5298963">lineComment</span>&nbsp;<span class="op" id="5298975">=</span>&nbsp;<span class="ident" id="5298977">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5298988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5298992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5298997">//&nbsp;consume&nbsp;successor&nbsp;comments,&nbsp;if&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299037">endline</span>&nbsp;<span class="op" id="5299045">=</span>&nbsp;<span class="op" id="5299047">-</span><span class="num" id="5299048">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299052">for</span>&nbsp;<span class="ident" id="5299056">p</span><span class="op" id="5299057">.</span><span class="ident" id="5299058">tok</span>&nbsp;<span class="op" id="5299062">==</span>&nbsp;<span class="ident" id="5299065">token</span><span class="op" id="5299070">.</span><span class="ident" id="5299071">COMMENT</span>&nbsp;<span class="op" id="5299079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299084">comment</span><span class="op" id="5299091">,</span>&nbsp;<span class="ident" id="5299093">endline</span>&nbsp;<span class="op" id="5299101">=</span>&nbsp;<span class="ident" id="5299103">p</span><span class="op" id="5299104">.</span><span class="ident" id="5299105">consumeCommentGroup</span><span class="op" id="5299124">(</span><span class="num" id="5299125">1</span><span class="op" id="5299126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299130">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299135">if</span>&nbsp;<span class="ident" id="5299138">endline</span><span class="op" id="5299145">+</span><span class="num" id="5299146">1</span>&nbsp;<span class="op" id="5299148">==</span>&nbsp;<span class="ident" id="5299151">p</span><span class="op" id="5299152">.</span><span class="ident" id="5299153">file</span><span class="op" id="5299157">.</span><span class="ident" id="5299158">Line</span><span class="op" id="5299162">(</span><span class="ident" id="5299163">p</span><span class="op" id="5299164">.</span><span class="ident" id="5299165">pos</span><span class="op" id="5299168">)</span>&nbsp;<span class="op" id="5299170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299175">//&nbsp;The&nbsp;next&nbsp;token&nbsp;is&nbsp;following&nbsp;on&nbsp;the&nbsp;line&nbsp;immediately&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299243">//&nbsp;comment&nbsp;group,&nbsp;thus&nbsp;the&nbsp;last&nbsp;comment&nbsp;group&nbsp;is&nbsp;a&nbsp;lead&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299311">p</span><span class="op" id="5299312">.</span><span class="ident" id="5299313">leadComment</span>&nbsp;<span class="op" id="5299325">=</span>&nbsp;<span class="ident" id="5299327">comment</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299337">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299340">}</span><br>
<span class="lineno"></span><span class="op" id="5299342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5299345">//&nbsp;A&nbsp;bailout&nbsp;panic&nbsp;is&nbsp;raised&nbsp;to&nbsp;indicate&nbsp;early&nbsp;termination.</span><br>
<span class="lineno">345</span><span class="keyword" id="5299405">type</span>&nbsp;<span class="ident" id="5299410">bailout</span>&nbsp;<span class="keyword" id="5299418">struct</span><span class="op" id="5299424">{</span><span class="op" id="5299425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5299428">func</span>&nbsp;<span class="op" id="5299433">(</span><span class="ident" id="5299434">p</span>&nbsp;<span class="op" id="5299436">*</span><span class="ident" id="5299437">parser</span><span class="op" id="5299443">)</span>&nbsp;<span class="builtintype" id="5299445">error</span><span class="op" id="5299450">(</span><span class="ident" id="5299451">pos</span>&nbsp;<span class="ident" id="5299455">token</span><span class="op" id="5299460">.</span><span class="ident" id="5299461">Pos</span><span class="op" id="5299464">,</span>&nbsp;<span class="ident" id="5299466">msg</span>&nbsp;<span class="builtintype" id="5299470">string</span><span class="op" id="5299476">)</span>&nbsp;<span class="op" id="5299478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299481">epos</span>&nbsp;<span class="op" id="5299486">:=</span>&nbsp;<span class="ident" id="5299489">p</span><span class="op" id="5299490">.</span><span class="ident" id="5299491">file</span><span class="op" id="5299495">.</span><span class="ident" id="5299496">Position</span><span class="op" id="5299504">(</span><span class="ident" id="5299505">pos</span><span class="op" id="5299508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299512">//&nbsp;If&nbsp;AllErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;discard&nbsp;errors&nbsp;reported&nbsp;on&nbsp;the&nbsp;same&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299582">//&nbsp;as&nbsp;the&nbsp;last&nbsp;recorded&nbsp;error&nbsp;and&nbsp;stop&nbsp;parsing&nbsp;if&nbsp;there&nbsp;are&nbsp;more&nbsp;than</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299653">//&nbsp;10&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299668">if</span>&nbsp;<span class="ident" id="5299671">p</span><span class="op" id="5299672">.</span><span class="ident" id="5299673">mode</span><span class="op" id="5299677">&amp;</span><span class="ident" id="5299678">AllErrors</span>&nbsp;<span class="op" id="5299688">==</span>&nbsp;<span class="num" id="5299691">0</span>&nbsp;<span class="op" id="5299693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299697">n</span>&nbsp;<span class="op" id="5299699">:=</span>&nbsp;<span class="builtinfunc" id="5299702">len</span><span class="op" id="5299705">(</span><span class="ident" id="5299706">p</span><span class="op" id="5299707">.</span><span class="ident" id="5299708">errors</span><span class="op" id="5299714">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299718">if</span>&nbsp;<span class="ident" id="5299721">n</span>&nbsp;<span class="op" id="5299723">&gt;</span>&nbsp;<span class="num" id="5299725">0</span>&nbsp;<span class="op" id="5299727">&amp;&amp;</span>&nbsp;<span class="ident" id="5299730">p</span><span class="op" id="5299731">.</span><span class="ident" id="5299732">errors</span><span class="op" id="5299738">[</span><span class="ident" id="5299739">n</span><span class="op" id="5299740">-</span><span class="num" id="5299741">1</span><span class="op" id="5299742">]</span><span class="op" id="5299743">.</span><span class="ident" id="5299744">Pos</span><span class="op" id="5299747">.</span><span class="ident" id="5299748">Line</span>&nbsp;<span class="op" id="5299753">==</span>&nbsp;<span class="ident" id="5299756">epos</span><span class="op" id="5299760">.</span><span class="ident" id="5299761">Line</span>&nbsp;<span class="op" id="5299766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299771">return</span>&nbsp;<span class="comment" id="5299778">//&nbsp;discard&nbsp;-&nbsp;likely&nbsp;a&nbsp;spurious&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299817">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299821">if</span>&nbsp;<span class="ident" id="5299824">n</span>&nbsp;<span class="op" id="5299826">&gt;</span>&nbsp;<span class="num" id="5299828">10</span>&nbsp;<span class="op" id="5299831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5299836">panic</span><span class="op" id="5299841">(</span><span class="ident" id="5299842">bailout</span><span class="op" id="5299849">{</span><span class="op" id="5299850">}</span><span class="op" id="5299851">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5299858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299862">p</span><span class="op" id="5299863">.</span><span class="ident" id="5299864">errors</span><span class="op" id="5299870">.</span><span class="ident" id="5299871">Add</span><span class="op" id="5299874">(</span><span class="ident" id="5299875">epos</span><span class="op" id="5299879">,</span>&nbsp;<span class="ident" id="5299881">msg</span><span class="op" id="5299884">)</span><br>
<span class="lineno"></span><span class="op" id="5299886">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="5299889">func</span>&nbsp;<span class="op" id="5299894">(</span><span class="ident" id="5299895">p</span>&nbsp;<span class="op" id="5299897">*</span><span class="ident" id="5299898">parser</span><span class="op" id="5299904">)</span>&nbsp;<span class="ident" id="5299906">errorExpected</span><span class="op" id="5299919">(</span><span class="ident" id="5299920">pos</span>&nbsp;<span class="ident" id="5299924">token</span><span class="op" id="5299929">.</span><span class="ident" id="5299930">Pos</span><span class="op" id="5299933">,</span>&nbsp;<span class="ident" id="5299935">msg</span>&nbsp;<span class="builtintype" id="5299939">string</span><span class="op" id="5299945">)</span>&nbsp;<span class="op" id="5299947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5299950">msg</span>&nbsp;<span class="op" id="5299954">=</span>&nbsp;<span class="string" id="5299956">&#34;expected&nbsp;&#34;</span>&nbsp;<span class="op" id="5299968">+</span>&nbsp;<span class="ident" id="5299970">msg</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5299975">if</span>&nbsp;<span class="ident" id="5299978">pos</span>&nbsp;<span class="op" id="5299982">==</span>&nbsp;<span class="ident" id="5299985">p</span><span class="op" id="5299986">.</span><span class="ident" id="5299987">pos</span>&nbsp;<span class="op" id="5299991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5299995">//&nbsp;the&nbsp;error&nbsp;happened&nbsp;at&nbsp;the&nbsp;current&nbsp;position;</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5300044">//&nbsp;make&nbsp;the&nbsp;error&nbsp;message&nbsp;more&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300086">if</span>&nbsp;<span class="ident" id="5300089">p</span><span class="op" id="5300090">.</span><span class="ident" id="5300091">tok</span>&nbsp;<span class="op" id="5300095">==</span>&nbsp;<span class="ident" id="5300098">token</span><span class="op" id="5300103">.</span><span class="ident" id="5300104">SEMICOLON</span>&nbsp;<span class="op" id="5300114">&amp;&amp;</span>&nbsp;<span class="ident" id="5300117">p</span><span class="op" id="5300118">.</span><span class="ident" id="5300119">lit</span>&nbsp;<span class="op" id="5300123">==</span>&nbsp;<span class="string" id="5300126">&#34;\n&#34;</span>&nbsp;<span class="op" id="5300131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300136">msg</span>&nbsp;<span class="op" id="5300140">+=</span>&nbsp;<span class="string" id="5300143">&#34;,&nbsp;found&nbsp;newline&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300163">}</span>&nbsp;<span class="keyword" id="5300165">else</span>&nbsp;<span class="op" id="5300170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300175">msg</span>&nbsp;<span class="op" id="5300179">+=</span>&nbsp;<span class="string" id="5300182">&#34;,&nbsp;found&nbsp;&#39;&#34;</span>&nbsp;<span class="op" id="5300194">+</span>&nbsp;<span class="ident" id="5300196">p</span><span class="op" id="5300197">.</span><span class="ident" id="5300198">tok</span><span class="op" id="5300201">.</span><span class="ident" id="5300202">String</span><span class="op" id="5300208">(</span><span class="op" id="5300209">)</span>&nbsp;<span class="op" id="5300211">+</span>&nbsp;<span class="string" id="5300213">&#34;&#39;&#34;</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300220">if</span>&nbsp;<span class="ident" id="5300223">p</span><span class="op" id="5300224">.</span><span class="ident" id="5300225">tok</span><span class="op" id="5300228">.</span><span class="ident" id="5300229">IsLiteral</span><span class="op" id="5300238">(</span><span class="op" id="5300239">)</span>&nbsp;<span class="op" id="5300241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300247">msg</span>&nbsp;<span class="op" id="5300251">+=</span>&nbsp;<span class="string" id="5300254">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5300258">+</span>&nbsp;<span class="ident" id="5300260">p</span><span class="op" id="5300261">.</span><span class="ident" id="5300262">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300276">}</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300279">p</span><span class="op" id="5300280">.</span><span class="builtintype" id="5300281">error</span><span class="op" id="5300286">(</span><span class="ident" id="5300287">pos</span><span class="op" id="5300290">,</span>&nbsp;<span class="ident" id="5300292">msg</span><span class="op" id="5300295">)</span><br>
<span class="lineno"></span><span class="op" id="5300297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5300300">func</span>&nbsp;<span class="op" id="5300305">(</span><span class="ident" id="5300306">p</span>&nbsp;<span class="op" id="5300308">*</span><span class="ident" id="5300309">parser</span><span class="op" id="5300315">)</span>&nbsp;<span class="ident" id="5300317">expect</span><span class="op" id="5300323">(</span><span class="ident" id="5300324">tok</span>&nbsp;<span class="ident" id="5300328">token</span><span class="op" id="5300333">.</span><span class="ident" id="5300334">Token</span><span class="op" id="5300339">)</span>&nbsp;<span class="ident" id="5300341">token</span><span class="op" id="5300346">.</span><span class="ident" id="5300347">Pos</span>&nbsp;<span class="op" id="5300351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300354">pos</span>&nbsp;<span class="op" id="5300358">:=</span>&nbsp;<span class="ident" id="5300361">p</span><span class="op" id="5300362">.</span><span class="ident" id="5300363">pos</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300368">if</span>&nbsp;<span class="ident" id="5300371">p</span><span class="op" id="5300372">.</span><span class="ident" id="5300373">tok</span>&nbsp;<span class="op" id="5300377">!=</span>&nbsp;<span class="ident" id="5300380">tok</span>&nbsp;<span class="op" id="5300384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300388">p</span><span class="op" id="5300389">.</span><span class="ident" id="5300390">errorExpected</span><span class="op" id="5300403">(</span><span class="ident" id="5300404">pos</span><span class="op" id="5300407">,</span>&nbsp;<span class="string" id="5300409">&#34;&#39;&#34;</span><span class="op" id="5300412">+</span><span class="ident" id="5300413">tok</span><span class="op" id="5300416">.</span><span class="ident" id="5300417">String</span><span class="op" id="5300423">(</span><span class="op" id="5300424">)</span><span class="op" id="5300425">+</span><span class="string" id="5300426">&#34;&#39;&#34;</span><span class="op" id="5300429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300435">p</span><span class="op" id="5300436">.</span><span class="ident" id="5300437">next</span><span class="op" id="5300441">(</span><span class="op" id="5300442">)</span>&nbsp;<span class="comment" id="5300444">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300462">return</span>&nbsp;<span class="ident" id="5300469">pos</span><br>
<span class="lineno">390</span><span class="op" id="5300473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5300476">//&nbsp;expectClosing&nbsp;is&nbsp;like&nbsp;expect&nbsp;but&nbsp;provides&nbsp;a&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="5300544">//&nbsp;for&nbsp;the&nbsp;common&nbsp;case&nbsp;of&nbsp;a&nbsp;missing&nbsp;comma&nbsp;before&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span><span class="comment" id="5300604">//</span><br>
<span class="lineno">395</span><span class="keyword" id="5300607">func</span>&nbsp;<span class="op" id="5300612">(</span><span class="ident" id="5300613">p</span>&nbsp;<span class="op" id="5300615">*</span><span class="ident" id="5300616">parser</span><span class="op" id="5300622">)</span>&nbsp;<span class="ident" id="5300624">expectClosing</span><span class="op" id="5300637">(</span><span class="ident" id="5300638">tok</span>&nbsp;<span class="ident" id="5300642">token</span><span class="op" id="5300647">.</span><span class="ident" id="5300648">Token</span><span class="op" id="5300653">,</span>&nbsp;<span class="ident" id="5300655">context</span>&nbsp;<span class="builtintype" id="5300663">string</span><span class="op" id="5300669">)</span>&nbsp;<span class="ident" id="5300671">token</span><span class="op" id="5300676">.</span><span class="ident" id="5300677">Pos</span>&nbsp;<span class="op" id="5300681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300684">if</span>&nbsp;<span class="ident" id="5300687">p</span><span class="op" id="5300688">.</span><span class="ident" id="5300689">tok</span>&nbsp;<span class="op" id="5300693">!=</span>&nbsp;<span class="ident" id="5300696">tok</span>&nbsp;<span class="op" id="5300700">&amp;&amp;</span>&nbsp;<span class="ident" id="5300703">p</span><span class="op" id="5300704">.</span><span class="ident" id="5300705">tok</span>&nbsp;<span class="op" id="5300709">==</span>&nbsp;<span class="ident" id="5300712">token</span><span class="op" id="5300717">.</span><span class="ident" id="5300718">SEMICOLON</span>&nbsp;<span class="op" id="5300728">&amp;&amp;</span>&nbsp;<span class="ident" id="5300731">p</span><span class="op" id="5300732">.</span><span class="ident" id="5300733">lit</span>&nbsp;<span class="op" id="5300737">==</span>&nbsp;<span class="string" id="5300740">&#34;\n&#34;</span>&nbsp;<span class="op" id="5300745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300749">p</span><span class="op" id="5300750">.</span><span class="builtintype" id="5300751">error</span><span class="op" id="5300756">(</span><span class="ident" id="5300757">p</span><span class="op" id="5300758">.</span><span class="ident" id="5300759">pos</span><span class="op" id="5300762">,</span>&nbsp;<span class="string" id="5300764">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5300796">+</span><span class="ident" id="5300797">context</span><span class="op" id="5300804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5300808">p</span><span class="op" id="5300809">.</span><span class="ident" id="5300810">next</span><span class="op" id="5300814">(</span><span class="op" id="5300815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5300818">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300821">return</span>&nbsp;<span class="ident" id="5300828">p</span><span class="op" id="5300829">.</span><span class="ident" id="5300830">expect</span><span class="op" id="5300836">(</span><span class="ident" id="5300837">tok</span><span class="op" id="5300840">)</span><br>
<span class="lineno"></span><span class="op" id="5300842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5300845">func</span>&nbsp;<span class="op" id="5300850">(</span><span class="ident" id="5300851">p</span>&nbsp;<span class="op" id="5300853">*</span><span class="ident" id="5300854">parser</span><span class="op" id="5300860">)</span>&nbsp;<span class="ident" id="5300862">expectSemi</span><span class="op" id="5300872">(</span><span class="op" id="5300873">)</span>&nbsp;<span class="op" id="5300875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5300878">//&nbsp;semicolon&nbsp;is&nbsp;optional&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#39;)&#39;&nbsp;or&nbsp;&#39;}&#39;</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300932">if</span>&nbsp;<span class="ident" id="5300935">p</span><span class="op" id="5300936">.</span><span class="ident" id="5300937">tok</span>&nbsp;<span class="op" id="5300941">!=</span>&nbsp;<span class="ident" id="5300944">token</span><span class="op" id="5300949">.</span><span class="ident" id="5300950">RPAREN</span>&nbsp;<span class="op" id="5300957">&amp;&amp;</span>&nbsp;<span class="ident" id="5300960">p</span><span class="op" id="5300961">.</span><span class="ident" id="5300962">tok</span>&nbsp;<span class="op" id="5300966">!=</span>&nbsp;<span class="ident" id="5300969">token</span><span class="op" id="5300974">.</span><span class="ident" id="5300975">RBRACE</span>&nbsp;<span class="op" id="5300982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5300986">if</span>&nbsp;<span class="ident" id="5300989">p</span><span class="op" id="5300990">.</span><span class="ident" id="5300991">tok</span>&nbsp;<span class="op" id="5300995">==</span>&nbsp;<span class="ident" id="5300998">token</span><span class="op" id="5301003">.</span><span class="ident" id="5301004">SEMICOLON</span>&nbsp;<span class="op" id="5301014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301019">p</span><span class="op" id="5301020">.</span><span class="ident" id="5301021">next</span><span class="op" id="5301025">(</span><span class="op" id="5301026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301030">}</span>&nbsp;<span class="keyword" id="5301032">else</span>&nbsp;<span class="op" id="5301037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301042">p</span><span class="op" id="5301043">.</span><span class="ident" id="5301044">errorExpected</span><span class="op" id="5301057">(</span><span class="ident" id="5301058">p</span><span class="op" id="5301059">.</span><span class="ident" id="5301060">pos</span><span class="op" id="5301063">,</span>&nbsp;<span class="string" id="5301065">&#34;&#39;;&#39;&#34;</span><span class="op" id="5301070">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301075">syncStmt</span><span class="op" id="5301083">(</span><span class="ident" id="5301084">p</span><span class="op" id="5301085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301092">}</span><br>
<span class="lineno"></span><span class="op" id="5301094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="keyword" id="5301097">func</span>&nbsp;<span class="op" id="5301102">(</span><span class="ident" id="5301103">p</span>&nbsp;<span class="op" id="5301105">*</span><span class="ident" id="5301106">parser</span><span class="op" id="5301112">)</span>&nbsp;<span class="ident" id="5301114">atComma</span><span class="op" id="5301121">(</span><span class="ident" id="5301122">context</span>&nbsp;<span class="builtintype" id="5301130">string</span><span class="op" id="5301136">)</span>&nbsp;<span class="builtintype" id="5301138">bool</span>&nbsp;<span class="op" id="5301143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301146">if</span>&nbsp;<span class="ident" id="5301149">p</span><span class="op" id="5301150">.</span><span class="ident" id="5301151">tok</span>&nbsp;<span class="op" id="5301155">==</span>&nbsp;<span class="ident" id="5301158">token</span><span class="op" id="5301163">.</span><span class="ident" id="5301164">COMMA</span>&nbsp;<span class="op" id="5301170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301174">return</span>&nbsp;<span class="builtintype" id="5301181">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301190">if</span>&nbsp;<span class="ident" id="5301193">p</span><span class="op" id="5301194">.</span><span class="ident" id="5301195">tok</span>&nbsp;<span class="op" id="5301199">==</span>&nbsp;<span class="ident" id="5301202">token</span><span class="op" id="5301207">.</span><span class="ident" id="5301208">SEMICOLON</span>&nbsp;<span class="op" id="5301218">&amp;&amp;</span>&nbsp;<span class="ident" id="5301221">p</span><span class="op" id="5301222">.</span><span class="ident" id="5301223">lit</span>&nbsp;<span class="op" id="5301227">==</span>&nbsp;<span class="string" id="5301230">&#34;\n&#34;</span>&nbsp;<span class="op" id="5301235">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301239">p</span><span class="op" id="5301240">.</span><span class="builtintype" id="5301241">error</span><span class="op" id="5301246">(</span><span class="ident" id="5301247">p</span><span class="op" id="5301248">.</span><span class="ident" id="5301249">pos</span><span class="op" id="5301252">,</span>&nbsp;<span class="string" id="5301254">&#34;missing&nbsp;&#39;,&#39;&nbsp;before&nbsp;newline&nbsp;in&nbsp;&#34;</span><span class="op" id="5301286">+</span><span class="ident" id="5301287">context</span><span class="op" id="5301294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301298">return</span>&nbsp;<span class="builtintype" id="5301305">true</span>&nbsp;<span class="comment" id="5301310">//&nbsp;&#34;insert&#34;&nbsp;the&nbsp;comma&nbsp;and&nbsp;continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301350">return</span>&nbsp;<span class="builtintype" id="5301357">false</span><br>
<span class="lineno">425</span><span class="op" id="5301363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5301366">func</span>&nbsp;<span class="ident" id="5301371">assert</span><span class="op" id="5301377">(</span><span class="ident" id="5301378">cond</span>&nbsp;<span class="builtintype" id="5301383">bool</span><span class="op" id="5301387">,</span>&nbsp;<span class="ident" id="5301389">msg</span>&nbsp;<span class="builtintype" id="5301393">string</span><span class="op" id="5301399">)</span>&nbsp;<span class="op" id="5301401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301404">if</span>&nbsp;<span class="op" id="5301407">!</span><span class="ident" id="5301408">cond</span>&nbsp;<span class="op" id="5301413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5301417">panic</span><span class="op" id="5301422">(</span><span class="string" id="5301423">&#34;go/parser&nbsp;internal&nbsp;error:&nbsp;&#34;</span>&nbsp;<span class="op" id="5301452">+</span>&nbsp;<span class="ident" id="5301454">msg</span><span class="op" id="5301457">)</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5301460">}</span><br>
<span class="lineno"></span><span class="op" id="5301462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5301465">//&nbsp;syncStmt&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="5301509">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno">435</span><span class="comment" id="5301553">//</span><br>
<span class="lineno"></span><span class="keyword" id="5301556">func</span>&nbsp;<span class="ident" id="5301561">syncStmt</span><span class="op" id="5301569">(</span><span class="ident" id="5301570">p</span>&nbsp;<span class="op" id="5301572">*</span><span class="ident" id="5301573">parser</span><span class="op" id="5301579">)</span>&nbsp;<span class="op" id="5301581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301584">for</span>&nbsp;<span class="op" id="5301588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301592">switch</span>&nbsp;<span class="ident" id="5301599">p</span><span class="op" id="5301600">.</span><span class="ident" id="5301601">tok</span>&nbsp;<span class="op" id="5301605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5301609">case</span>&nbsp;<span class="ident" id="5301614">token</span><span class="op" id="5301619">.</span><span class="ident" id="5301620">BREAK</span><span class="op" id="5301625">,</span>&nbsp;<span class="ident" id="5301627">token</span><span class="op" id="5301632">.</span><span class="ident" id="5301633">CONST</span><span class="op" id="5301638">,</span>&nbsp;<span class="ident" id="5301640">token</span><span class="op" id="5301645">.</span><span class="ident" id="5301646">CONTINUE</span><span class="op" id="5301654">,</span>&nbsp;<span class="ident" id="5301656">token</span><span class="op" id="5301661">.</span><span class="ident" id="5301662">DEFER</span><span class="op" id="5301667">,</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301672">token</span><span class="op" id="5301677">.</span><span class="ident" id="5301678">FALLTHROUGH</span><span class="op" id="5301689">,</span>&nbsp;<span class="ident" id="5301691">token</span><span class="op" id="5301696">.</span><span class="ident" id="5301697">FOR</span><span class="op" id="5301700">,</span>&nbsp;<span class="ident" id="5301702">token</span><span class="op" id="5301707">.</span><span class="ident" id="5301708">GO</span><span class="op" id="5301710">,</span>&nbsp;<span class="ident" id="5301712">token</span><span class="op" id="5301717">.</span><span class="ident" id="5301718">GOTO</span><span class="op" id="5301722">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301727">token</span><span class="op" id="5301732">.</span><span class="ident" id="5301733">IF</span><span class="op" id="5301735">,</span>&nbsp;<span class="ident" id="5301737">token</span><span class="op" id="5301742">.</span><span class="ident" id="5301743">RETURN</span><span class="op" id="5301749">,</span>&nbsp;<span class="ident" id="5301751">token</span><span class="op" id="5301756">.</span><span class="ident" id="5301757">SELECT</span><span class="op" id="5301763">,</span>&nbsp;<span class="ident" id="5301765">token</span><span class="op" id="5301770">.</span><span class="ident" id="5301771">SWITCH</span><span class="op" id="5301777">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5301782">token</span><span class="op" id="5301787">.</span><span class="ident" id="5301788">TYPE</span><span class="op" id="5301792">,</span>&nbsp;<span class="ident" id="5301794">token</span><span class="op" id="5301799">.</span><span class="ident" id="5301800">VAR</span><span class="op" id="5301803">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5301808">//&nbsp;Return&nbsp;only&nbsp;if&nbsp;parser&nbsp;made&nbsp;some&nbsp;progress&nbsp;since&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5301866">//&nbsp;sync&nbsp;or&nbsp;if&nbsp;it&nbsp;has&nbsp;not&nbsp;reached&nbsp;10&nbsp;sync&nbsp;calls&nbsp;without</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5301924">//&nbsp;progress.&nbsp;Otherwise&nbsp;consume&nbsp;at&nbsp;least&nbsp;one&nbsp;token&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5301980">//&nbsp;avoid&nbsp;an&nbsp;endless&nbsp;parser&nbsp;loop&nbsp;(it&nbsp;is&nbsp;possible&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302036">//&nbsp;both&nbsp;parseOperand&nbsp;and&nbsp;parseStmt&nbsp;call&nbsp;syncStmt&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302092">//&nbsp;correctly&nbsp;do&nbsp;not&nbsp;advance,&nbsp;thus&nbsp;the&nbsp;need&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302146">//&nbsp;invocation&nbsp;limit&nbsp;p.syncCnt).</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302181">if</span>&nbsp;<span class="ident" id="5302184">p</span><span class="op" id="5302185">.</span><span class="ident" id="5302186">pos</span>&nbsp;<span class="op" id="5302190">==</span>&nbsp;<span class="ident" id="5302193">p</span><span class="op" id="5302194">.</span><span class="ident" id="5302195">syncPos</span>&nbsp;<span class="op" id="5302203">&amp;&amp;</span>&nbsp;<span class="ident" id="5302206">p</span><span class="op" id="5302207">.</span><span class="ident" id="5302208">syncCnt</span>&nbsp;<span class="op" id="5302216">&lt;</span>&nbsp;<span class="num" id="5302218">10</span>&nbsp;<span class="op" id="5302221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302227">p</span><span class="op" id="5302228">.</span><span class="ident" id="5302229">syncCnt</span><span class="op" id="5302236">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302243">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5302253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302258">if</span>&nbsp;<span class="ident" id="5302261">p</span><span class="op" id="5302262">.</span><span class="ident" id="5302263">pos</span>&nbsp;<span class="op" id="5302267">&gt;</span>&nbsp;<span class="ident" id="5302269">p</span><span class="op" id="5302270">.</span><span class="ident" id="5302271">syncPos</span>&nbsp;<span class="op" id="5302279">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302285">p</span><span class="op" id="5302286">.</span><span class="ident" id="5302287">syncPos</span>&nbsp;<span class="op" id="5302295">=</span>&nbsp;<span class="ident" id="5302297">p</span><span class="op" id="5302298">.</span><span class="ident" id="5302299">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302307">p</span><span class="op" id="5302308">.</span><span class="ident" id="5302309">syncCnt</span>&nbsp;<span class="op" id="5302317">=</span>&nbsp;<span class="num" id="5302319">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302325">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5302335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302340">//&nbsp;Reaching&nbsp;here&nbsp;indicates&nbsp;a&nbsp;parser&nbsp;bug,&nbsp;likely&nbsp;an</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302394">//&nbsp;incorrect&nbsp;token&nbsp;list&nbsp;in&nbsp;this&nbsp;function,&nbsp;but&nbsp;it&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302451">//&nbsp;leads&nbsp;to&nbsp;skipping&nbsp;of&nbsp;possibly&nbsp;correct&nbsp;code&nbsp;if&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302505">//&nbsp;previous&nbsp;error&nbsp;is&nbsp;present,&nbsp;and&nbsp;thus&nbsp;is&nbsp;preferred</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302560">//&nbsp;over&nbsp;a&nbsp;non-terminating&nbsp;parse.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302595">case</span>&nbsp;<span class="ident" id="5302600">token</span><span class="op" id="5302605">.</span><span class="ident" id="5302606">EOF</span><span class="op" id="5302609">:</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302614">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5302623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302627">p</span><span class="op" id="5302628">.</span><span class="ident" id="5302629">next</span><span class="op" id="5302633">(</span><span class="op" id="5302634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5302637">}</span><br>
<span class="lineno"></span><span class="op" id="5302639">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="comment" id="5302642">//&nbsp;syncDecl&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;declaration.</span><br>
<span class="lineno"></span><span class="comment" id="5302688">//&nbsp;Used&nbsp;for&nbsp;synchronization&nbsp;after&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5302732">//</span><br>
<span class="lineno"></span><span class="keyword" id="5302735">func</span>&nbsp;<span class="ident" id="5302740">syncDecl</span><span class="op" id="5302748">(</span><span class="ident" id="5302749">p</span>&nbsp;<span class="op" id="5302751">*</span><span class="ident" id="5302752">parser</span><span class="op" id="5302758">)</span>&nbsp;<span class="op" id="5302760">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302763">for</span>&nbsp;<span class="op" id="5302767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302771">switch</span>&nbsp;<span class="ident" id="5302778">p</span><span class="op" id="5302779">.</span><span class="ident" id="5302780">tok</span>&nbsp;<span class="op" id="5302784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302788">case</span>&nbsp;<span class="ident" id="5302793">token</span><span class="op" id="5302798">.</span><span class="ident" id="5302799">CONST</span><span class="op" id="5302804">,</span>&nbsp;<span class="ident" id="5302806">token</span><span class="op" id="5302811">.</span><span class="ident" id="5302812">TYPE</span><span class="op" id="5302816">,</span>&nbsp;<span class="ident" id="5302818">token</span><span class="op" id="5302823">.</span><span class="ident" id="5302824">VAR</span><span class="op" id="5302827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5302832">//&nbsp;see&nbsp;comments&nbsp;in&nbsp;syncStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302863">if</span>&nbsp;<span class="ident" id="5302866">p</span><span class="op" id="5302867">.</span><span class="ident" id="5302868">pos</span>&nbsp;<span class="op" id="5302872">==</span>&nbsp;<span class="ident" id="5302875">p</span><span class="op" id="5302876">.</span><span class="ident" id="5302877">syncPos</span>&nbsp;<span class="op" id="5302885">&amp;&amp;</span>&nbsp;<span class="ident" id="5302888">p</span><span class="op" id="5302889">.</span><span class="ident" id="5302890">syncCnt</span>&nbsp;<span class="op" id="5302898">&lt;</span>&nbsp;<span class="num" id="5302900">10</span>&nbsp;<span class="op" id="5302903">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302909">p</span><span class="op" id="5302910">.</span><span class="ident" id="5302911">syncCnt</span><span class="op" id="5302918">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302925">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5302935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5302940">if</span>&nbsp;<span class="ident" id="5302943">p</span><span class="op" id="5302944">.</span><span class="ident" id="5302945">pos</span>&nbsp;<span class="op" id="5302949">&gt;</span>&nbsp;<span class="ident" id="5302951">p</span><span class="op" id="5302952">.</span><span class="ident" id="5302953">syncPos</span>&nbsp;<span class="op" id="5302961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302967">p</span><span class="op" id="5302968">.</span><span class="ident" id="5302969">syncPos</span>&nbsp;<span class="op" id="5302977">=</span>&nbsp;<span class="ident" id="5302979">p</span><span class="op" id="5302980">.</span><span class="ident" id="5302981">pos</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5302989">p</span><span class="op" id="5302990">.</span><span class="ident" id="5302991">syncCnt</span>&nbsp;<span class="op" id="5302999">=</span>&nbsp;<span class="num" id="5303001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303007">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5303017">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303021">case</span>&nbsp;<span class="ident" id="5303026">token</span><span class="op" id="5303031">.</span><span class="ident" id="5303032">EOF</span><span class="op" id="5303035">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303040">return</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5303049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5303053">p</span><span class="op" id="5303054">.</span><span class="ident" id="5303055">next</span><span class="op" id="5303059">(</span><span class="op" id="5303060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5303063">}</span><br>
<span class="lineno"></span><span class="op" id="5303065">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span><span class="comment" id="5303068">//&nbsp;safePos&nbsp;returns&nbsp;a&nbsp;valid&nbsp;file&nbsp;position&nbsp;for&nbsp;a&nbsp;given&nbsp;position:&nbsp;If&nbsp;pos</span><br>
<span class="lineno"></span><span class="comment" id="5303138">//&nbsp;is&nbsp;valid&nbsp;to&nbsp;begin&nbsp;with,&nbsp;safePos&nbsp;returns&nbsp;pos.&nbsp;If&nbsp;pos&nbsp;is&nbsp;out-of-range,</span><br>
<span class="lineno"></span><span class="comment" id="5303210">//&nbsp;safePos&nbsp;returns&nbsp;the&nbsp;EOF&nbsp;position.</span><br>
<span class="lineno"></span><span class="comment" id="5303247">//</span><br>
<span class="lineno"></span><span class="comment" id="5303250">//&nbsp;This&nbsp;is&nbsp;hack&nbsp;to&nbsp;work&nbsp;around&nbsp;&#34;artificial&#34;&nbsp;end&nbsp;positions&nbsp;in&nbsp;the&nbsp;AST&nbsp;which</span><br>
<span class="lineno">500</span><span class="comment" id="5303325">//&nbsp;are&nbsp;computed&nbsp;by&nbsp;adding&nbsp;1&nbsp;to&nbsp;(presumably&nbsp;valid)&nbsp;token&nbsp;positions.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5303399">//&nbsp;token&nbsp;positions&nbsp;are&nbsp;invalid&nbsp;due&nbsp;to&nbsp;parse&nbsp;errors,&nbsp;the&nbsp;resulting&nbsp;end&nbsp;position</span><br>
<span class="lineno"></span><span class="comment" id="5303478">//&nbsp;may&nbsp;be&nbsp;past&nbsp;the&nbsp;file&#39;s&nbsp;EOF&nbsp;position,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to&nbsp;panics&nbsp;if&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="5303553">//&nbsp;later&nbsp;on.</span><br>
<span class="lineno"></span><span class="comment" id="5303566">//</span><br>
<span class="lineno">505</span><span class="keyword" id="5303569">func</span>&nbsp;<span class="op" id="5303574">(</span><span class="ident" id="5303575">p</span>&nbsp;<span class="op" id="5303577">*</span><span class="ident" id="5303578">parser</span><span class="op" id="5303584">)</span>&nbsp;<span class="ident" id="5303586">safePos</span><span class="op" id="5303593">(</span><span class="ident" id="5303594">pos</span>&nbsp;<span class="ident" id="5303598">token</span><span class="op" id="5303603">.</span><span class="ident" id="5303604">Pos</span><span class="op" id="5303607">)</span>&nbsp;<span class="op" id="5303609">(</span><span class="ident" id="5303610">res</span>&nbsp;<span class="ident" id="5303614">token</span><span class="op" id="5303619">.</span><span class="ident" id="5303620">Pos</span><span class="op" id="5303623">)</span>&nbsp;<span class="op" id="5303625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303628">defer</span>&nbsp;<span class="keyword" id="5303634">func</span><span class="op" id="5303638">(</span><span class="op" id="5303639">)</span>&nbsp;<span class="op" id="5303641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303645">if</span>&nbsp;<span class="builtinfunc" id="5303648">recover</span><span class="op" id="5303655">(</span><span class="op" id="5303656">)</span>&nbsp;<span class="op" id="5303658">!=</span>&nbsp;<span class="builtintype" id="5303661">nil</span>&nbsp;<span class="op" id="5303665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5303670">res</span>&nbsp;<span class="op" id="5303674">=</span>&nbsp;<span class="ident" id="5303676">token</span><span class="op" id="5303681">.</span><span class="ident" id="5303682">Pos</span><span class="op" id="5303685">(</span><span class="ident" id="5303686">p</span><span class="op" id="5303687">.</span><span class="ident" id="5303688">file</span><span class="op" id="5303692">.</span><span class="ident" id="5303693">Base</span><span class="op" id="5303697">(</span><span class="op" id="5303698">)</span>&nbsp;<span class="op" id="5303700">+</span>&nbsp;<span class="ident" id="5303702">p</span><span class="op" id="5303703">.</span><span class="ident" id="5303704">file</span><span class="op" id="5303708">.</span><span class="ident" id="5303709">Size</span><span class="op" id="5303713">(</span><span class="op" id="5303714">)</span><span class="op" id="5303715">)</span>&nbsp;<span class="comment" id="5303717">//&nbsp;EOF&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5303735">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5303738">}</span><span class="op" id="5303739">(</span><span class="op" id="5303740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5303743">_</span>&nbsp;<span class="op" id="5303745">=</span>&nbsp;<span class="ident" id="5303747">p</span><span class="op" id="5303748">.</span><span class="ident" id="5303749">file</span><span class="op" id="5303753">.</span><span class="ident" id="5303754">Offset</span><span class="op" id="5303760">(</span><span class="ident" id="5303761">pos</span><span class="op" id="5303764">)</span>&nbsp;<span class="comment" id="5303766">//&nbsp;trigger&nbsp;a&nbsp;panic&nbsp;if&nbsp;position&nbsp;is&nbsp;out-of-range</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303814">return</span>&nbsp;<span class="ident" id="5303821">pos</span><br>
<span class="lineno"></span><span class="op" id="5303825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="comment" id="5303828">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5303908">//&nbsp;Identifiers</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5303924">func</span>&nbsp;<span class="op" id="5303929">(</span><span class="ident" id="5303930">p</span>&nbsp;<span class="op" id="5303932">*</span><span class="ident" id="5303933">parser</span><span class="op" id="5303939">)</span>&nbsp;<span class="ident" id="5303941">parseIdent</span><span class="op" id="5303951">(</span><span class="op" id="5303952">)</span>&nbsp;<span class="op" id="5303954">*</span><span class="ident" id="5303955">ast</span><span class="op" id="5303958">.</span><span class="ident" id="5303959">Ident</span>&nbsp;<span class="op" id="5303965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5303968">pos</span>&nbsp;<span class="op" id="5303972">:=</span>&nbsp;<span class="ident" id="5303975">p</span><span class="op" id="5303976">.</span><span class="ident" id="5303977">pos</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5303982">name</span>&nbsp;<span class="op" id="5303987">:=</span>&nbsp;<span class="string" id="5303990">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5303995">if</span>&nbsp;<span class="ident" id="5303998">p</span><span class="op" id="5303999">.</span><span class="ident" id="5304000">tok</span>&nbsp;<span class="op" id="5304004">==</span>&nbsp;<span class="ident" id="5304007">token</span><span class="op" id="5304012">.</span><span class="ident" id="5304013">IDENT</span>&nbsp;<span class="op" id="5304019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304023">name</span>&nbsp;<span class="op" id="5304028">=</span>&nbsp;<span class="ident" id="5304030">p</span><span class="op" id="5304031">.</span><span class="ident" id="5304032">lit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304038">p</span><span class="op" id="5304039">.</span><span class="ident" id="5304040">next</span><span class="op" id="5304044">(</span><span class="op" id="5304045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304048">}</span>&nbsp;<span class="keyword" id="5304050">else</span>&nbsp;<span class="op" id="5304055">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304059">p</span><span class="op" id="5304060">.</span><span class="ident" id="5304061">expect</span><span class="op" id="5304067">(</span><span class="ident" id="5304068">token</span><span class="op" id="5304073">.</span><span class="ident" id="5304074">IDENT</span><span class="op" id="5304079">)</span>&nbsp;<span class="comment" id="5304081">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304116">return</span>&nbsp;<span class="op" id="5304123">&amp;</span><span class="ident" id="5304124">ast</span><span class="op" id="5304127">.</span><span class="ident" id="5304128">Ident</span><span class="op" id="5304133">{</span><span class="ident" id="5304134">NamePos</span><span class="op" id="5304141">:</span>&nbsp;<span class="ident" id="5304143">pos</span><span class="op" id="5304146">,</span>&nbsp;<span class="ident" id="5304148">Name</span><span class="op" id="5304152">:</span>&nbsp;<span class="ident" id="5304154">name</span><span class="op" id="5304158">}</span><br>
<span class="lineno"></span><span class="op" id="5304160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span><span class="keyword" id="5304163">func</span>&nbsp;<span class="op" id="5304168">(</span><span class="ident" id="5304169">p</span>&nbsp;<span class="op" id="5304171">*</span><span class="ident" id="5304172">parser</span><span class="op" id="5304178">)</span>&nbsp;<span class="ident" id="5304180">parseIdentList</span><span class="op" id="5304194">(</span><span class="op" id="5304195">)</span>&nbsp;<span class="op" id="5304197">(</span><span class="ident" id="5304198">list</span>&nbsp;<span class="op" id="5304203">[</span><span class="op" id="5304204">]</span><span class="op" id="5304205">*</span><span class="ident" id="5304206">ast</span><span class="op" id="5304209">.</span><span class="ident" id="5304210">Ident</span><span class="op" id="5304215">)</span>&nbsp;<span class="op" id="5304217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304220">if</span>&nbsp;<span class="ident" id="5304223">p</span><span class="op" id="5304224">.</span><span class="ident" id="5304225">trace</span>&nbsp;<span class="op" id="5304231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304235">defer</span>&nbsp;<span class="ident" id="5304241">un</span><span class="op" id="5304243">(</span><span class="ident" id="5304244">trace</span><span class="op" id="5304249">(</span><span class="ident" id="5304250">p</span><span class="op" id="5304251">,</span>&nbsp;<span class="string" id="5304253">&#34;IdentList&#34;</span><span class="op" id="5304264">)</span><span class="op" id="5304265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304272">list</span>&nbsp;<span class="op" id="5304277">=</span>&nbsp;<span class="builtinfunc" id="5304279">append</span><span class="op" id="5304285">(</span><span class="ident" id="5304286">list</span><span class="op" id="5304290">,</span>&nbsp;<span class="ident" id="5304292">p</span><span class="op" id="5304293">.</span><span class="ident" id="5304294">parseIdent</span><span class="op" id="5304304">(</span><span class="op" id="5304305">)</span><span class="op" id="5304306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304309">for</span>&nbsp;<span class="ident" id="5304313">p</span><span class="op" id="5304314">.</span><span class="ident" id="5304315">tok</span>&nbsp;<span class="op" id="5304319">==</span>&nbsp;<span class="ident" id="5304322">token</span><span class="op" id="5304327">.</span><span class="ident" id="5304328">COMMA</span>&nbsp;<span class="op" id="5304334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304338">p</span><span class="op" id="5304339">.</span><span class="ident" id="5304340">next</span><span class="op" id="5304344">(</span><span class="op" id="5304345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304349">list</span>&nbsp;<span class="op" id="5304354">=</span>&nbsp;<span class="builtinfunc" id="5304356">append</span><span class="op" id="5304362">(</span><span class="ident" id="5304363">list</span><span class="op" id="5304367">,</span>&nbsp;<span class="ident" id="5304369">p</span><span class="op" id="5304370">.</span><span class="ident" id="5304371">parseIdent</span><span class="op" id="5304381">(</span><span class="op" id="5304382">)</span><span class="op" id="5304383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304386">}</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304390">return</span><br>
<span class="lineno"></span><span class="op" id="5304397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5304400">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">545</span><span class="comment" id="5304480">//&nbsp;Common&nbsp;productions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5304503">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set,&nbsp;result&nbsp;list&nbsp;elements&nbsp;which&nbsp;are&nbsp;identifiers&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5304582">func</span>&nbsp;<span class="op" id="5304587">(</span><span class="ident" id="5304588">p</span>&nbsp;<span class="op" id="5304590">*</span><span class="ident" id="5304591">parser</span><span class="op" id="5304597">)</span>&nbsp;<span class="ident" id="5304599">parseExprList</span><span class="op" id="5304612">(</span><span class="ident" id="5304613">lhs</span>&nbsp;<span class="builtintype" id="5304617">bool</span><span class="op" id="5304621">)</span>&nbsp;<span class="op" id="5304623">(</span><span class="ident" id="5304624">list</span>&nbsp;<span class="op" id="5304629">[</span><span class="op" id="5304630">]</span><span class="ident" id="5304631">ast</span><span class="op" id="5304634">.</span><span class="ident" id="5304635">Expr</span><span class="op" id="5304639">)</span>&nbsp;<span class="op" id="5304641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304644">if</span>&nbsp;<span class="ident" id="5304647">p</span><span class="op" id="5304648">.</span><span class="ident" id="5304649">trace</span>&nbsp;<span class="op" id="5304655">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304659">defer</span>&nbsp;<span class="ident" id="5304665">un</span><span class="op" id="5304667">(</span><span class="ident" id="5304668">trace</span><span class="op" id="5304673">(</span><span class="ident" id="5304674">p</span><span class="op" id="5304675">,</span>&nbsp;<span class="string" id="5304677">&#34;ExpressionList&#34;</span><span class="op" id="5304693">)</span><span class="op" id="5304694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304697">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304701">list</span>&nbsp;<span class="op" id="5304706">=</span>&nbsp;<span class="builtinfunc" id="5304708">append</span><span class="op" id="5304714">(</span><span class="ident" id="5304715">list</span><span class="op" id="5304719">,</span>&nbsp;<span class="ident" id="5304721">p</span><span class="op" id="5304722">.</span><span class="ident" id="5304723">checkExpr</span><span class="op" id="5304732">(</span><span class="ident" id="5304733">p</span><span class="op" id="5304734">.</span><span class="ident" id="5304735">parseExpr</span><span class="op" id="5304744">(</span><span class="ident" id="5304745">lhs</span><span class="op" id="5304748">)</span><span class="op" id="5304749">)</span><span class="op" id="5304750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304753">for</span>&nbsp;<span class="ident" id="5304757">p</span><span class="op" id="5304758">.</span><span class="ident" id="5304759">tok</span>&nbsp;<span class="op" id="5304763">==</span>&nbsp;<span class="ident" id="5304766">token</span><span class="op" id="5304771">.</span><span class="ident" id="5304772">COMMA</span>&nbsp;<span class="op" id="5304778">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304782">p</span><span class="op" id="5304783">.</span><span class="ident" id="5304784">next</span><span class="op" id="5304788">(</span><span class="op" id="5304789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304793">list</span>&nbsp;<span class="op" id="5304798">=</span>&nbsp;<span class="builtinfunc" id="5304800">append</span><span class="op" id="5304806">(</span><span class="ident" id="5304807">list</span><span class="op" id="5304811">,</span>&nbsp;<span class="ident" id="5304813">p</span><span class="op" id="5304814">.</span><span class="ident" id="5304815">checkExpr</span><span class="op" id="5304824">(</span><span class="ident" id="5304825">p</span><span class="op" id="5304826">.</span><span class="ident" id="5304827">parseExpr</span><span class="op" id="5304836">(</span><span class="ident" id="5304837">lhs</span><span class="op" id="5304840">)</span><span class="op" id="5304841">)</span><span class="op" id="5304842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5304845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304849">return</span><br>
<span class="lineno">560</span><span class="op" id="5304856">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5304859">func</span>&nbsp;<span class="op" id="5304864">(</span><span class="ident" id="5304865">p</span>&nbsp;<span class="op" id="5304867">*</span><span class="ident" id="5304868">parser</span><span class="op" id="5304874">)</span>&nbsp;<span class="ident" id="5304876">parseLhsList</span><span class="op" id="5304888">(</span><span class="op" id="5304889">)</span>&nbsp;<span class="op" id="5304891">[</span><span class="op" id="5304892">]</span><span class="ident" id="5304893">ast</span><span class="op" id="5304896">.</span><span class="ident" id="5304897">Expr</span>&nbsp;<span class="op" id="5304902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304905">old</span>&nbsp;<span class="op" id="5304909">:=</span>&nbsp;<span class="ident" id="5304912">p</span><span class="op" id="5304913">.</span><span class="ident" id="5304914">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304921">p</span><span class="op" id="5304922">.</span><span class="ident" id="5304923">inRhs</span>&nbsp;<span class="op" id="5304929">=</span>&nbsp;<span class="builtintype" id="5304931">false</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5304938">list</span>&nbsp;<span class="op" id="5304943">:=</span>&nbsp;<span class="ident" id="5304946">p</span><span class="op" id="5304947">.</span><span class="ident" id="5304948">parseExprList</span><span class="op" id="5304961">(</span><span class="builtintype" id="5304962">true</span><span class="op" id="5304966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304969">switch</span>&nbsp;<span class="ident" id="5304976">p</span><span class="op" id="5304977">.</span><span class="ident" id="5304978">tok</span>&nbsp;<span class="op" id="5304982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5304985">case</span>&nbsp;<span class="ident" id="5304990">token</span><span class="op" id="5304995">.</span><span class="ident" id="5304996">DEFINE</span><span class="op" id="5305002">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305006">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;short&nbsp;variable&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305047">//&nbsp;but&nbsp;doesn&#39;t&nbsp;enter&nbsp;scope&nbsp;until&nbsp;later:</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305089">//&nbsp;caller&nbsp;must&nbsp;call&nbsp;p.shortVarDecl(p.makeIdentList(list))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305149">//&nbsp;at&nbsp;appropriate&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5305174">case</span>&nbsp;<span class="ident" id="5305179">token</span><span class="op" id="5305184">.</span><span class="ident" id="5305185">COLON</span><span class="op" id="5305190">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305194">//&nbsp;lhs&nbsp;of&nbsp;a&nbsp;label&nbsp;declaration&nbsp;or&nbsp;a&nbsp;communication&nbsp;clause&nbsp;of&nbsp;a&nbsp;select</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305264">//&nbsp;statement&nbsp;(parseLhsList&nbsp;is&nbsp;not&nbsp;called&nbsp;when&nbsp;parsing&nbsp;the&nbsp;case&nbsp;clause</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305336">//&nbsp;of&nbsp;a&nbsp;switch&nbsp;statement):</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305365">//&nbsp;-&nbsp;labels&nbsp;are&nbsp;declared&nbsp;by&nbsp;the&nbsp;caller&nbsp;of&nbsp;parseLhsList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305422">//&nbsp;-&nbsp;for&nbsp;communication&nbsp;clauses,&nbsp;if&nbsp;there&nbsp;is&nbsp;a&nbsp;stand-alone&nbsp;identifier</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305493">//&nbsp;&nbsp;&nbsp;followed&nbsp;by&nbsp;a&nbsp;colon,&nbsp;we&nbsp;have&nbsp;a&nbsp;syntax&nbsp;error;&nbsp;there&nbsp;is&nbsp;no&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305562">//&nbsp;&nbsp;&nbsp;to&nbsp;resolve&nbsp;the&nbsp;identifier&nbsp;in&nbsp;that&nbsp;case</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5305607">default</span><span class="op" id="5305614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5305618">//&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;declared&nbsp;elsewhere</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5305662">for</span>&nbsp;<span class="ident" id="5305666">_</span><span class="op" id="5305667">,</span>&nbsp;<span class="ident" id="5305669">x</span>&nbsp;<span class="op" id="5305671">:=</span>&nbsp;<span class="keyword" id="5305674">range</span>&nbsp;<span class="ident" id="5305680">list</span>&nbsp;<span class="op" id="5305685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305690">p</span><span class="op" id="5305691">.</span><span class="ident" id="5305692">resolve</span><span class="op" id="5305699">(</span><span class="ident" id="5305700">x</span><span class="op" id="5305701">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5305705">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5305708">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305711">p</span><span class="op" id="5305712">.</span><span class="ident" id="5305713">inRhs</span>&nbsp;<span class="op" id="5305719">=</span>&nbsp;<span class="ident" id="5305721">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5305726">return</span>&nbsp;<span class="ident" id="5305733">list</span><br>
<span class="lineno"></span><span class="op" id="5305738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">590</span><span class="keyword" id="5305741">func</span>&nbsp;<span class="op" id="5305746">(</span><span class="ident" id="5305747">p</span>&nbsp;<span class="op" id="5305749">*</span><span class="ident" id="5305750">parser</span><span class="op" id="5305756">)</span>&nbsp;<span class="ident" id="5305758">parseRhsList</span><span class="op" id="5305770">(</span><span class="op" id="5305771">)</span>&nbsp;<span class="op" id="5305773">[</span><span class="op" id="5305774">]</span><span class="ident" id="5305775">ast</span><span class="op" id="5305778">.</span><span class="ident" id="5305779">Expr</span>&nbsp;<span class="op" id="5305784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305787">old</span>&nbsp;<span class="op" id="5305791">:=</span>&nbsp;<span class="ident" id="5305794">p</span><span class="op" id="5305795">.</span><span class="ident" id="5305796">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305803">p</span><span class="op" id="5305804">.</span><span class="ident" id="5305805">inRhs</span>&nbsp;<span class="op" id="5305811">=</span>&nbsp;<span class="builtintype" id="5305813">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305819">list</span>&nbsp;<span class="op" id="5305824">:=</span>&nbsp;<span class="ident" id="5305827">p</span><span class="op" id="5305828">.</span><span class="ident" id="5305829">parseExprList</span><span class="op" id="5305842">(</span><span class="builtintype" id="5305843">false</span><span class="op" id="5305848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5305851">p</span><span class="op" id="5305852">.</span><span class="ident" id="5305853">inRhs</span>&nbsp;<span class="op" id="5305859">=</span>&nbsp;<span class="ident" id="5305861">old</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5305866">return</span>&nbsp;<span class="ident" id="5305873">list</span><br>
<span class="lineno"></span><span class="op" id="5305878">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5305881">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5305961">//&nbsp;Types</span><br>
<span class="lineno">600</span><br>
<span class="lineno"></span><span class="keyword" id="5305971">func</span>&nbsp;<span class="op" id="5305976">(</span><span class="ident" id="5305977">p</span>&nbsp;<span class="op" id="5305979">*</span><span class="ident" id="5305980">parser</span><span class="op" id="5305986">)</span>&nbsp;<span class="ident" id="5305988">parseType</span><span class="op" id="5305997">(</span><span class="op" id="5305998">)</span>&nbsp;<span class="ident" id="5306000">ast</span><span class="op" id="5306003">.</span><span class="ident" id="5306004">Expr</span>&nbsp;<span class="op" id="5306009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306012">if</span>&nbsp;<span class="ident" id="5306015">p</span><span class="op" id="5306016">.</span><span class="ident" id="5306017">trace</span>&nbsp;<span class="op" id="5306023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306027">defer</span>&nbsp;<span class="ident" id="5306033">un</span><span class="op" id="5306035">(</span><span class="ident" id="5306036">trace</span><span class="op" id="5306041">(</span><span class="ident" id="5306042">p</span><span class="op" id="5306043">,</span>&nbsp;<span class="string" id="5306045">&#34;Type&#34;</span><span class="op" id="5306051">)</span><span class="op" id="5306052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306055">}</span><br>
<span class="lineno">605</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306059">typ</span>&nbsp;<span class="op" id="5306063">:=</span>&nbsp;<span class="ident" id="5306066">p</span><span class="op" id="5306067">.</span><span class="ident" id="5306068">tryType</span><span class="op" id="5306075">(</span><span class="op" id="5306076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306080">if</span>&nbsp;<span class="ident" id="5306083">typ</span>&nbsp;<span class="op" id="5306087">==</span>&nbsp;<span class="builtintype" id="5306090">nil</span>&nbsp;<span class="op" id="5306094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306098">pos</span>&nbsp;<span class="op" id="5306102">:=</span>&nbsp;<span class="ident" id="5306105">p</span><span class="op" id="5306106">.</span><span class="ident" id="5306107">pos</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306113">p</span><span class="op" id="5306114">.</span><span class="ident" id="5306115">errorExpected</span><span class="op" id="5306128">(</span><span class="ident" id="5306129">pos</span><span class="op" id="5306132">,</span>&nbsp;<span class="string" id="5306134">&#34;type&#34;</span><span class="op" id="5306140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306144">p</span><span class="op" id="5306145">.</span><span class="ident" id="5306146">next</span><span class="op" id="5306150">(</span><span class="op" id="5306151">)</span>&nbsp;<span class="comment" id="5306153">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306172">return</span>&nbsp;<span class="op" id="5306179">&amp;</span><span class="ident" id="5306180">ast</span><span class="op" id="5306183">.</span><span class="ident" id="5306184">BadExpr</span><span class="op" id="5306191">{</span><span class="ident" id="5306192">From</span><span class="op" id="5306196">:</span>&nbsp;<span class="ident" id="5306198">pos</span><span class="op" id="5306201">,</span>&nbsp;<span class="ident" id="5306203">To</span><span class="op" id="5306205">:</span>&nbsp;<span class="ident" id="5306207">p</span><span class="op" id="5306208">.</span><span class="ident" id="5306209">pos</span><span class="op" id="5306212">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306219">return</span>&nbsp;<span class="ident" id="5306226">typ</span><br>
<span class="lineno"></span><span class="op" id="5306230">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5306233">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5306288">func</span>&nbsp;<span class="op" id="5306293">(</span><span class="ident" id="5306294">p</span>&nbsp;<span class="op" id="5306296">*</span><span class="ident" id="5306297">parser</span><span class="op" id="5306303">)</span>&nbsp;<span class="ident" id="5306305">parseTypeName</span><span class="op" id="5306318">(</span><span class="op" id="5306319">)</span>&nbsp;<span class="ident" id="5306321">ast</span><span class="op" id="5306324">.</span><span class="ident" id="5306325">Expr</span>&nbsp;<span class="op" id="5306330">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306333">if</span>&nbsp;<span class="ident" id="5306336">p</span><span class="op" id="5306337">.</span><span class="ident" id="5306338">trace</span>&nbsp;<span class="op" id="5306344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306348">defer</span>&nbsp;<span class="ident" id="5306354">un</span><span class="op" id="5306356">(</span><span class="ident" id="5306357">trace</span><span class="op" id="5306362">(</span><span class="ident" id="5306363">p</span><span class="op" id="5306364">,</span>&nbsp;<span class="string" id="5306366">&#34;TypeName&#34;</span><span class="op" id="5306376">)</span><span class="op" id="5306377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306384">ident</span>&nbsp;<span class="op" id="5306390">:=</span>&nbsp;<span class="ident" id="5306393">p</span><span class="op" id="5306394">.</span><span class="ident" id="5306395">parseIdent</span><span class="op" id="5306405">(</span><span class="op" id="5306406">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5306409">//&nbsp;don&#39;t&nbsp;resolve&nbsp;ident&nbsp;yet&nbsp;-&nbsp;it&nbsp;may&nbsp;be&nbsp;a&nbsp;parameter&nbsp;or&nbsp;field&nbsp;name</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306476">if</span>&nbsp;<span class="ident" id="5306479">p</span><span class="op" id="5306480">.</span><span class="ident" id="5306481">tok</span>&nbsp;<span class="op" id="5306485">==</span>&nbsp;<span class="ident" id="5306488">token</span><span class="op" id="5306493">.</span><span class="ident" id="5306494">PERIOD</span>&nbsp;<span class="op" id="5306501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5306505">//&nbsp;ident&nbsp;is&nbsp;a&nbsp;package&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306534">p</span><span class="op" id="5306535">.</span><span class="ident" id="5306536">next</span><span class="op" id="5306540">(</span><span class="op" id="5306541">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306545">p</span><span class="op" id="5306546">.</span><span class="ident" id="5306547">resolve</span><span class="op" id="5306554">(</span><span class="ident" id="5306555">ident</span><span class="op" id="5306560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306564">sel</span>&nbsp;<span class="op" id="5306568">:=</span>&nbsp;<span class="ident" id="5306571">p</span><span class="op" id="5306572">.</span><span class="ident" id="5306573">parseIdent</span><span class="op" id="5306583">(</span><span class="op" id="5306584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306588">return</span>&nbsp;<span class="op" id="5306595">&amp;</span><span class="ident" id="5306596">ast</span><span class="op" id="5306599">.</span><span class="ident" id="5306600">SelectorExpr</span><span class="op" id="5306612">{</span><span class="ident" id="5306613">X</span><span class="op" id="5306614">:</span>&nbsp;<span class="ident" id="5306616">ident</span><span class="op" id="5306621">,</span>&nbsp;<span class="ident" id="5306623">Sel</span><span class="op" id="5306626">:</span>&nbsp;<span class="ident" id="5306628">sel</span><span class="op" id="5306631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306638">return</span>&nbsp;<span class="ident" id="5306645">ident</span><br>
<span class="lineno"></span><span class="op" id="5306651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5306654">func</span>&nbsp;<span class="op" id="5306659">(</span><span class="ident" id="5306660">p</span>&nbsp;<span class="op" id="5306662">*</span><span class="ident" id="5306663">parser</span><span class="op" id="5306669">)</span>&nbsp;<span class="ident" id="5306671">parseArrayType</span><span class="op" id="5306685">(</span><span class="op" id="5306686">)</span>&nbsp;<span class="ident" id="5306688">ast</span><span class="op" id="5306691">.</span><span class="ident" id="5306692">Expr</span>&nbsp;<span class="op" id="5306697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306700">if</span>&nbsp;<span class="ident" id="5306703">p</span><span class="op" id="5306704">.</span><span class="ident" id="5306705">trace</span>&nbsp;<span class="op" id="5306711">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306715">defer</span>&nbsp;<span class="ident" id="5306721">un</span><span class="op" id="5306723">(</span><span class="ident" id="5306724">trace</span><span class="op" id="5306729">(</span><span class="ident" id="5306730">p</span><span class="op" id="5306731">,</span>&nbsp;<span class="string" id="5306733">&#34;ArrayType&#34;</span><span class="op" id="5306744">)</span><span class="op" id="5306745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306752">lbrack</span>&nbsp;<span class="op" id="5306759">:=</span>&nbsp;<span class="ident" id="5306762">p</span><span class="op" id="5306763">.</span><span class="ident" id="5306764">expect</span><span class="op" id="5306770">(</span><span class="ident" id="5306771">token</span><span class="op" id="5306776">.</span><span class="ident" id="5306777">LBRACK</span><span class="op" id="5306783">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306786">p</span><span class="op" id="5306787">.</span><span class="ident" id="5306788">exprLev</span><span class="op" id="5306795">++</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306799">var</span>&nbsp;<span class="builtinfunc" id="5306803">len</span>&nbsp;<span class="ident" id="5306807">ast</span><span class="op" id="5306810">.</span><span class="ident" id="5306811">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5306817">//&nbsp;always&nbsp;permit&nbsp;ellipsis&nbsp;for&nbsp;more&nbsp;fault-tolerant&nbsp;parsing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5306876">if</span>&nbsp;<span class="ident" id="5306879">p</span><span class="op" id="5306880">.</span><span class="ident" id="5306881">tok</span>&nbsp;<span class="op" id="5306885">==</span>&nbsp;<span class="ident" id="5306888">token</span><span class="op" id="5306893">.</span><span class="ident" id="5306894">ELLIPSIS</span>&nbsp;<span class="op" id="5306903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5306907">len</span>&nbsp;<span class="op" id="5306911">=</span>&nbsp;<span class="op" id="5306913">&amp;</span><span class="ident" id="5306914">ast</span><span class="op" id="5306917">.</span><span class="ident" id="5306918">Ellipsis</span><span class="op" id="5306926">{</span><span class="ident" id="5306927">Ellipsis</span><span class="op" id="5306935">:</span>&nbsp;<span class="ident" id="5306937">p</span><span class="op" id="5306938">.</span><span class="ident" id="5306939">pos</span><span class="op" id="5306942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5306946">p</span><span class="op" id="5306947">.</span><span class="ident" id="5306948">next</span><span class="op" id="5306952">(</span><span class="op" id="5306953">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5306956">}</span>&nbsp;<span class="keyword" id="5306958">else</span>&nbsp;<span class="keyword" id="5306963">if</span>&nbsp;<span class="ident" id="5306966">p</span><span class="op" id="5306967">.</span><span class="ident" id="5306968">tok</span>&nbsp;<span class="op" id="5306972">!=</span>&nbsp;<span class="ident" id="5306975">token</span><span class="op" id="5306980">.</span><span class="ident" id="5306981">RBRACK</span>&nbsp;<span class="op" id="5306988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5306992">len</span>&nbsp;<span class="op" id="5306996">=</span>&nbsp;<span class="ident" id="5306998">p</span><span class="op" id="5306999">.</span><span class="ident" id="5307000">parseRhs</span><span class="op" id="5307008">(</span><span class="op" id="5307009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307012">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307015">p</span><span class="op" id="5307016">.</span><span class="ident" id="5307017">exprLev</span><span class="op" id="5307024">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307028">p</span><span class="op" id="5307029">.</span><span class="ident" id="5307030">expect</span><span class="op" id="5307036">(</span><span class="ident" id="5307037">token</span><span class="op" id="5307042">.</span><span class="ident" id="5307043">RBRACK</span><span class="op" id="5307049">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307052">elt</span>&nbsp;<span class="op" id="5307056">:=</span>&nbsp;<span class="ident" id="5307059">p</span><span class="op" id="5307060">.</span><span class="ident" id="5307061">parseType</span><span class="op" id="5307070">(</span><span class="op" id="5307071">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307075">return</span>&nbsp;<span class="op" id="5307082">&amp;</span><span class="ident" id="5307083">ast</span><span class="op" id="5307086">.</span><span class="ident" id="5307087">ArrayType</span><span class="op" id="5307096">{</span><span class="ident" id="5307097">Lbrack</span><span class="op" id="5307103">:</span>&nbsp;<span class="ident" id="5307105">lbrack</span><span class="op" id="5307111">,</span>&nbsp;<span class="ident" id="5307113">Len</span><span class="op" id="5307116">:</span>&nbsp;<span class="builtinfunc" id="5307118">len</span><span class="op" id="5307121">,</span>&nbsp;<span class="ident" id="5307123">Elt</span><span class="op" id="5307126">:</span>&nbsp;<span class="ident" id="5307128">elt</span><span class="op" id="5307131">}</span><br>
<span class="lineno"></span><span class="op" id="5307133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">660</span><span class="keyword" id="5307136">func</span>&nbsp;<span class="op" id="5307141">(</span><span class="ident" id="5307142">p</span>&nbsp;<span class="op" id="5307144">*</span><span class="ident" id="5307145">parser</span><span class="op" id="5307151">)</span>&nbsp;<span class="ident" id="5307153">makeIdentList</span><span class="op" id="5307166">(</span><span class="ident" id="5307167">list</span>&nbsp;<span class="op" id="5307172">[</span><span class="op" id="5307173">]</span><span class="ident" id="5307174">ast</span><span class="op" id="5307177">.</span><span class="ident" id="5307178">Expr</span><span class="op" id="5307182">)</span>&nbsp;<span class="op" id="5307184">[</span><span class="op" id="5307185">]</span><span class="op" id="5307186">*</span><span class="ident" id="5307187">ast</span><span class="op" id="5307190">.</span><span class="ident" id="5307191">Ident</span>&nbsp;<span class="op" id="5307197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307200">idents</span>&nbsp;<span class="op" id="5307207">:=</span>&nbsp;<span class="builtinfunc" id="5307210">make</span><span class="op" id="5307214">(</span><span class="op" id="5307215">[</span><span class="op" id="5307216">]</span><span class="op" id="5307217">*</span><span class="ident" id="5307218">ast</span><span class="op" id="5307221">.</span><span class="ident" id="5307222">Ident</span><span class="op" id="5307227">,</span>&nbsp;<span class="builtinfunc" id="5307229">len</span><span class="op" id="5307232">(</span><span class="ident" id="5307233">list</span><span class="op" id="5307237">)</span><span class="op" id="5307238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307241">for</span>&nbsp;<span class="ident" id="5307245">i</span><span class="op" id="5307246">,</span>&nbsp;<span class="ident" id="5307248">x</span>&nbsp;<span class="op" id="5307250">:=</span>&nbsp;<span class="keyword" id="5307253">range</span>&nbsp;<span class="ident" id="5307259">list</span>&nbsp;<span class="op" id="5307264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307268">ident</span><span class="op" id="5307273">,</span>&nbsp;<span class="ident" id="5307275">isIdent</span>&nbsp;<span class="op" id="5307283">:=</span>&nbsp;<span class="ident" id="5307286">x</span><span class="op" id="5307287">.</span><span class="op" id="5307288">(</span><span class="op" id="5307289">*</span><span class="ident" id="5307290">ast</span><span class="op" id="5307293">.</span><span class="ident" id="5307294">Ident</span><span class="op" id="5307299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307303">if</span>&nbsp;<span class="op" id="5307306">!</span><span class="ident" id="5307307">isIdent</span>&nbsp;<span class="op" id="5307315">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307320">if</span>&nbsp;<span class="ident" id="5307323">_</span><span class="op" id="5307324">,</span>&nbsp;<span class="ident" id="5307326">isBad</span>&nbsp;<span class="op" id="5307332">:=</span>&nbsp;<span class="ident" id="5307335">x</span><span class="op" id="5307336">.</span><span class="op" id="5307337">(</span><span class="op" id="5307338">*</span><span class="ident" id="5307339">ast</span><span class="op" id="5307342">.</span><span class="ident" id="5307343">BadExpr</span><span class="op" id="5307350">)</span><span class="op" id="5307351">;</span>&nbsp;<span class="op" id="5307353">!</span><span class="ident" id="5307354">isBad</span>&nbsp;<span class="op" id="5307360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5307366">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307409">p</span><span class="op" id="5307410">.</span><span class="ident" id="5307411">errorExpected</span><span class="op" id="5307424">(</span><span class="ident" id="5307425">x</span><span class="op" id="5307426">.</span><span class="ident" id="5307427">Pos</span><span class="op" id="5307430">(</span><span class="op" id="5307431">)</span><span class="op" id="5307432">,</span>&nbsp;<span class="string" id="5307434">&#34;identifier&#34;</span><span class="op" id="5307446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307456">ident</span>&nbsp;<span class="op" id="5307462">=</span>&nbsp;<span class="op" id="5307464">&amp;</span><span class="ident" id="5307465">ast</span><span class="op" id="5307468">.</span><span class="ident" id="5307469">Ident</span><span class="op" id="5307474">{</span><span class="ident" id="5307475">NamePos</span><span class="op" id="5307482">:</span>&nbsp;<span class="ident" id="5307484">x</span><span class="op" id="5307485">.</span><span class="ident" id="5307486">Pos</span><span class="op" id="5307489">(</span><span class="op" id="5307490">)</span><span class="op" id="5307491">,</span>&nbsp;<span class="ident" id="5307493">Name</span><span class="op" id="5307497">:</span>&nbsp;<span class="string" id="5307499">&#34;_&#34;</span><span class="op" id="5307502">}</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307510">idents</span><span class="op" id="5307516">[</span><span class="ident" id="5307517">i</span><span class="op" id="5307518">]</span>&nbsp;<span class="op" id="5307520">=</span>&nbsp;<span class="ident" id="5307522">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307532">return</span>&nbsp;<span class="ident" id="5307539">idents</span><br>
<span class="lineno"></span><span class="op" id="5307546">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span><span class="keyword" id="5307549">func</span>&nbsp;<span class="op" id="5307554">(</span><span class="ident" id="5307555">p</span>&nbsp;<span class="op" id="5307557">*</span><span class="ident" id="5307558">parser</span><span class="op" id="5307564">)</span>&nbsp;<span class="ident" id="5307566">parseFieldDecl</span><span class="op" id="5307580">(</span><span class="ident" id="5307581">scope</span>&nbsp;<span class="op" id="5307587">*</span><span class="ident" id="5307588">ast</span><span class="op" id="5307591">.</span><span class="ident" id="5307592">Scope</span><span class="op" id="5307597">)</span>&nbsp;<span class="op" id="5307599">*</span><span class="ident" id="5307600">ast</span><span class="op" id="5307603">.</span><span class="ident" id="5307604">Field</span>&nbsp;<span class="op" id="5307610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307613">if</span>&nbsp;<span class="ident" id="5307616">p</span><span class="op" id="5307617">.</span><span class="ident" id="5307618">trace</span>&nbsp;<span class="op" id="5307624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307628">defer</span>&nbsp;<span class="ident" id="5307634">un</span><span class="op" id="5307636">(</span><span class="ident" id="5307637">trace</span><span class="op" id="5307642">(</span><span class="ident" id="5307643">p</span><span class="op" id="5307644">,</span>&nbsp;<span class="string" id="5307646">&#34;FieldDecl&#34;</span><span class="op" id="5307657">)</span><span class="op" id="5307658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307661">}</span><br>
<span class="lineno">680</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307665">doc</span>&nbsp;<span class="op" id="5307669">:=</span>&nbsp;<span class="ident" id="5307672">p</span><span class="op" id="5307673">.</span><span class="ident" id="5307674">leadComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5307688">//&nbsp;FieldDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307702">list</span><span class="op" id="5307706">,</span>&nbsp;<span class="ident" id="5307708">typ</span>&nbsp;<span class="op" id="5307712">:=</span>&nbsp;<span class="ident" id="5307715">p</span><span class="op" id="5307716">.</span><span class="ident" id="5307717">parseVarList</span><span class="op" id="5307729">(</span><span class="builtintype" id="5307730">false</span><span class="op" id="5307735">)</span><br>
<span class="lineno">685</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5307739">//&nbsp;Tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307747">var</span>&nbsp;<span class="ident" id="5307751">tag</span>&nbsp;<span class="op" id="5307755">*</span><span class="ident" id="5307756">ast</span><span class="op" id="5307759">.</span><span class="ident" id="5307760">BasicLit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307770">if</span>&nbsp;<span class="ident" id="5307773">p</span><span class="op" id="5307774">.</span><span class="ident" id="5307775">tok</span>&nbsp;<span class="op" id="5307779">==</span>&nbsp;<span class="ident" id="5307782">token</span><span class="op" id="5307787">.</span><span class="ident" id="5307788">STRING</span>&nbsp;<span class="op" id="5307795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307799">tag</span>&nbsp;<span class="op" id="5307803">=</span>&nbsp;<span class="op" id="5307805">&amp;</span><span class="ident" id="5307806">ast</span><span class="op" id="5307809">.</span><span class="ident" id="5307810">BasicLit</span><span class="op" id="5307818">{</span><span class="ident" id="5307819">ValuePos</span><span class="op" id="5307827">:</span>&nbsp;<span class="ident" id="5307829">p</span><span class="op" id="5307830">.</span><span class="ident" id="5307831">pos</span><span class="op" id="5307834">,</span>&nbsp;<span class="ident" id="5307836">Kind</span><span class="op" id="5307840">:</span>&nbsp;<span class="ident" id="5307842">p</span><span class="op" id="5307843">.</span><span class="ident" id="5307844">tok</span><span class="op" id="5307847">,</span>&nbsp;<span class="ident" id="5307849">Value</span><span class="op" id="5307854">:</span>&nbsp;<span class="ident" id="5307856">p</span><span class="op" id="5307857">.</span><span class="ident" id="5307858">lit</span><span class="op" id="5307861">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307865">p</span><span class="op" id="5307866">.</span><span class="ident" id="5307867">next</span><span class="op" id="5307871">(</span><span class="op" id="5307872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307875">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5307879">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307896">var</span>&nbsp;<span class="ident" id="5307900">idents</span>&nbsp;<span class="op" id="5307907">[</span><span class="op" id="5307908">]</span><span class="op" id="5307909">*</span><span class="ident" id="5307910">ast</span><span class="op" id="5307913">.</span><span class="ident" id="5307914">Ident</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5307921">if</span>&nbsp;<span class="ident" id="5307924">typ</span>&nbsp;<span class="op" id="5307928">!=</span>&nbsp;<span class="builtintype" id="5307931">nil</span>&nbsp;<span class="op" id="5307935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5307939">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5307964">idents</span>&nbsp;<span class="op" id="5307971">=</span>&nbsp;<span class="ident" id="5307973">p</span><span class="op" id="5307974">.</span><span class="ident" id="5307975">makeIdentList</span><span class="op" id="5307988">(</span><span class="ident" id="5307989">list</span><span class="op" id="5307993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5307996">}</span>&nbsp;<span class="keyword" id="5307998">else</span>&nbsp;<span class="op" id="5308003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5308007">//&nbsp;[&#34;*&#34;]&nbsp;TypeName&nbsp;(AnonymousField)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308044">typ</span>&nbsp;<span class="op" id="5308048">=</span>&nbsp;<span class="ident" id="5308050">list</span><span class="op" id="5308054">[</span><span class="num" id="5308055">0</span><span class="op" id="5308056">]</span>&nbsp;<span class="comment" id="5308058">//&nbsp;we&nbsp;always&nbsp;have&nbsp;at&nbsp;least&nbsp;one&nbsp;element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308099">if</span>&nbsp;<span class="ident" id="5308102">n</span>&nbsp;<span class="op" id="5308104">:=</span>&nbsp;<span class="builtinfunc" id="5308107">len</span><span class="op" id="5308110">(</span><span class="ident" id="5308111">list</span><span class="op" id="5308115">)</span><span class="op" id="5308116">;</span>&nbsp;<span class="ident" id="5308118">n</span>&nbsp;<span class="op" id="5308120">&gt;</span>&nbsp;<span class="num" id="5308122">1</span>&nbsp;<span class="op" id="5308124">||</span>&nbsp;<span class="op" id="5308127">!</span><span class="ident" id="5308128">isTypeName</span><span class="op" id="5308138">(</span><span class="ident" id="5308139">deref</span><span class="op" id="5308144">(</span><span class="ident" id="5308145">typ</span><span class="op" id="5308148">)</span><span class="op" id="5308149">)</span>&nbsp;<span class="op" id="5308151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308156">pos</span>&nbsp;<span class="op" id="5308160">:=</span>&nbsp;<span class="ident" id="5308163">typ</span><span class="op" id="5308166">.</span><span class="ident" id="5308167">Pos</span><span class="op" id="5308170">(</span><span class="op" id="5308171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308176">p</span><span class="op" id="5308177">.</span><span class="ident" id="5308178">errorExpected</span><span class="op" id="5308191">(</span><span class="ident" id="5308192">pos</span><span class="op" id="5308195">,</span>&nbsp;<span class="string" id="5308197">&#34;anonymous&nbsp;field&#34;</span><span class="op" id="5308214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308219">typ</span>&nbsp;<span class="op" id="5308223">=</span>&nbsp;<span class="op" id="5308225">&amp;</span><span class="ident" id="5308226">ast</span><span class="op" id="5308229">.</span><span class="ident" id="5308230">BadExpr</span><span class="op" id="5308237">{</span><span class="ident" id="5308238">From</span><span class="op" id="5308242">:</span>&nbsp;<span class="ident" id="5308244">pos</span><span class="op" id="5308247">,</span>&nbsp;<span class="ident" id="5308249">To</span><span class="op" id="5308251">:</span>&nbsp;<span class="ident" id="5308253">p</span><span class="op" id="5308254">.</span><span class="ident" id="5308255">safePos</span><span class="op" id="5308262">(</span><span class="ident" id="5308263">list</span><span class="op" id="5308267">[</span><span class="ident" id="5308268">n</span><span class="op" id="5308269">-</span><span class="num" id="5308270">1</span><span class="op" id="5308271">]</span><span class="op" id="5308272">.</span><span class="ident" id="5308273">End</span><span class="op" id="5308276">(</span><span class="op" id="5308277">)</span><span class="op" id="5308278">)</span><span class="op" id="5308279">}</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5308283">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5308286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308290">p</span><span class="op" id="5308291">.</span><span class="ident" id="5308292">expectSemi</span><span class="op" id="5308302">(</span><span class="op" id="5308303">)</span>&nbsp;<span class="comment" id="5308305">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308346">field</span>&nbsp;<span class="op" id="5308352">:=</span>&nbsp;<span class="op" id="5308355">&amp;</span><span class="ident" id="5308356">ast</span><span class="op" id="5308359">.</span><span class="ident" id="5308360">Field</span><span class="op" id="5308365">{</span><span class="ident" id="5308366">Doc</span><span class="op" id="5308369">:</span>&nbsp;<span class="ident" id="5308371">doc</span><span class="op" id="5308374">,</span>&nbsp;<span class="ident" id="5308376">Names</span><span class="op" id="5308381">:</span>&nbsp;<span class="ident" id="5308383">idents</span><span class="op" id="5308389">,</span>&nbsp;<span class="ident" id="5308391">Type</span><span class="op" id="5308395">:</span>&nbsp;<span class="ident" id="5308397">typ</span><span class="op" id="5308400">,</span>&nbsp;<span class="ident" id="5308402">Tag</span><span class="op" id="5308405">:</span>&nbsp;<span class="ident" id="5308407">tag</span><span class="op" id="5308410">,</span>&nbsp;<span class="ident" id="5308412">Comment</span><span class="op" id="5308419">:</span>&nbsp;<span class="ident" id="5308421">p</span><span class="op" id="5308422">.</span><span class="ident" id="5308423">lineComment</span><span class="op" id="5308434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308437">p</span><span class="op" id="5308438">.</span><span class="ident" id="5308439">declare</span><span class="op" id="5308446">(</span><span class="ident" id="5308447">field</span><span class="op" id="5308452">,</span>&nbsp;<span class="builtintype" id="5308454">nil</span><span class="op" id="5308457">,</span>&nbsp;<span class="ident" id="5308459">scope</span><span class="op" id="5308464">,</span>&nbsp;<span class="ident" id="5308466">ast</span><span class="op" id="5308469">.</span><span class="ident" id="5308470">Var</span><span class="op" id="5308473">,</span>&nbsp;<span class="ident" id="5308475">idents</span><span class="op" id="5308481">...</span><span class="op" id="5308484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308487">p</span><span class="op" id="5308488">.</span><span class="ident" id="5308489">resolve</span><span class="op" id="5308496">(</span><span class="ident" id="5308497">typ</span><span class="op" id="5308500">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308504">return</span>&nbsp;<span class="ident" id="5308511">field</span><br>
<span class="lineno">715</span><span class="op" id="5308517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5308520">func</span>&nbsp;<span class="op" id="5308525">(</span><span class="ident" id="5308526">p</span>&nbsp;<span class="op" id="5308528">*</span><span class="ident" id="5308529">parser</span><span class="op" id="5308535">)</span>&nbsp;<span class="ident" id="5308537">parseStructType</span><span class="op" id="5308552">(</span><span class="op" id="5308553">)</span>&nbsp;<span class="op" id="5308555">*</span><span class="ident" id="5308556">ast</span><span class="op" id="5308559">.</span><span class="ident" id="5308560">StructType</span>&nbsp;<span class="op" id="5308571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308574">if</span>&nbsp;<span class="ident" id="5308577">p</span><span class="op" id="5308578">.</span><span class="ident" id="5308579">trace</span>&nbsp;<span class="op" id="5308585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308589">defer</span>&nbsp;<span class="ident" id="5308595">un</span><span class="op" id="5308597">(</span><span class="ident" id="5308598">trace</span><span class="op" id="5308603">(</span><span class="ident" id="5308604">p</span><span class="op" id="5308605">,</span>&nbsp;<span class="string" id="5308607">&#34;StructType&#34;</span><span class="op" id="5308619">)</span><span class="op" id="5308620">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5308623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308627">pos</span>&nbsp;<span class="op" id="5308631">:=</span>&nbsp;<span class="ident" id="5308634">p</span><span class="op" id="5308635">.</span><span class="ident" id="5308636">expect</span><span class="op" id="5308642">(</span><span class="ident" id="5308643">token</span><span class="op" id="5308648">.</span><span class="ident" id="5308649">STRUCT</span><span class="op" id="5308655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308658">lbrace</span>&nbsp;<span class="op" id="5308665">:=</span>&nbsp;<span class="ident" id="5308668">p</span><span class="op" id="5308669">.</span><span class="ident" id="5308670">expect</span><span class="op" id="5308676">(</span><span class="ident" id="5308677">token</span><span class="op" id="5308682">.</span><span class="ident" id="5308683">LBRACE</span><span class="op" id="5308689">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5308692">scope</span>&nbsp;<span class="op" id="5308698">:=</span>&nbsp;<span class="ident" id="5308701">ast</span><span class="op" id="5308704">.</span><span class="ident" id="5308705">NewScope</span><span class="op" id="5308713">(</span><span class="builtintype" id="5308714">nil</span><span class="op" id="5308717">)</span>&nbsp;<span class="comment" id="5308719">//&nbsp;struct&nbsp;scope</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308736">var</span>&nbsp;<span class="ident" id="5308740">list</span>&nbsp;<span class="op" id="5308745">[</span><span class="op" id="5308746">]</span><span class="op" id="5308747">*</span><span class="ident" id="5308748">ast</span><span class="op" id="5308751">.</span><span class="ident" id="5308752">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5308759">for</span>&nbsp;<span class="ident" id="5308763">p</span><span class="op" id="5308764">.</span><span class="ident" id="5308765">tok</span>&nbsp;<span class="op" id="5308769">==</span>&nbsp;<span class="ident" id="5308772">token</span><span class="op" id="5308777">.</span><span class="ident" id="5308778">IDENT</span>&nbsp;<span class="op" id="5308784">||</span>&nbsp;<span class="ident" id="5308787">p</span><span class="op" id="5308788">.</span><span class="ident" id="5308789">tok</span>&nbsp;<span class="op" id="5308793">==</span>&nbsp;<span class="ident" id="5308796">token</span><span class="op" id="5308801">.</span><span class="ident" id="5308802">MUL</span>&nbsp;<span class="op" id="5308806">||</span>&nbsp;<span class="ident" id="5308809">p</span><span class="op" id="5308810">.</span><span class="ident" id="5308811">tok</span>&nbsp;<span class="op" id="5308815">==</span>&nbsp;<span class="ident" id="5308818">token</span><span class="op" id="5308823">.</span><span class="ident" id="5308824">LPAREN</span>&nbsp;<span class="op" id="5308831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5308835">//&nbsp;a&nbsp;field&nbsp;declaration&nbsp;cannot&nbsp;start&nbsp;with&nbsp;a&nbsp;&#39;(&#39;&nbsp;but&nbsp;we&nbsp;accept</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5308898">//&nbsp;it&nbsp;here&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;better&nbsp;error&nbsp;messages</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5308961">//&nbsp;(parseFieldDecl&nbsp;will&nbsp;check&nbsp;and&nbsp;complain&nbsp;if&nbsp;necessary)</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309020">list</span>&nbsp;<span class="op" id="5309025">=</span>&nbsp;<span class="builtinfunc" id="5309027">append</span><span class="op" id="5309033">(</span><span class="ident" id="5309034">list</span><span class="op" id="5309038">,</span>&nbsp;<span class="ident" id="5309040">p</span><span class="op" id="5309041">.</span><span class="ident" id="5309042">parseFieldDecl</span><span class="op" id="5309056">(</span><span class="ident" id="5309057">scope</span><span class="op" id="5309062">)</span><span class="op" id="5309063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309069">rbrace</span>&nbsp;<span class="op" id="5309076">:=</span>&nbsp;<span class="ident" id="5309079">p</span><span class="op" id="5309080">.</span><span class="ident" id="5309081">expect</span><span class="op" id="5309087">(</span><span class="ident" id="5309088">token</span><span class="op" id="5309093">.</span><span class="ident" id="5309094">RBRACE</span><span class="op" id="5309100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309104">return</span>&nbsp;<span class="op" id="5309111">&amp;</span><span class="ident" id="5309112">ast</span><span class="op" id="5309115">.</span><span class="ident" id="5309116">StructType</span><span class="op" id="5309126">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309130">Struct</span><span class="op" id="5309136">:</span>&nbsp;<span class="ident" id="5309138">pos</span><span class="op" id="5309141">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309145">Fields</span><span class="op" id="5309151">:</span>&nbsp;<span class="op" id="5309153">&amp;</span><span class="ident" id="5309154">ast</span><span class="op" id="5309157">.</span><span class="ident" id="5309158">FieldList</span><span class="op" id="5309167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309172">Opening</span><span class="op" id="5309179">:</span>&nbsp;<span class="ident" id="5309181">lbrace</span><span class="op" id="5309187">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309192">List</span><span class="op" id="5309196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309201">list</span><span class="op" id="5309205">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309210">Closing</span><span class="op" id="5309217">:</span>&nbsp;<span class="ident" id="5309219">rbrace</span><span class="op" id="5309225">,</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309229">}</span><span class="op" id="5309230">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309233">}</span><br>
<span class="lineno"></span><span class="op" id="5309235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5309238">func</span>&nbsp;<span class="op" id="5309243">(</span><span class="ident" id="5309244">p</span>&nbsp;<span class="op" id="5309246">*</span><span class="ident" id="5309247">parser</span><span class="op" id="5309253">)</span>&nbsp;<span class="ident" id="5309255">parsePointerType</span><span class="op" id="5309271">(</span><span class="op" id="5309272">)</span>&nbsp;<span class="op" id="5309274">*</span><span class="ident" id="5309275">ast</span><span class="op" id="5309278">.</span><span class="ident" id="5309279">StarExpr</span>&nbsp;<span class="op" id="5309288">{</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309291">if</span>&nbsp;<span class="ident" id="5309294">p</span><span class="op" id="5309295">.</span><span class="ident" id="5309296">trace</span>&nbsp;<span class="op" id="5309302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309306">defer</span>&nbsp;<span class="ident" id="5309312">un</span><span class="op" id="5309314">(</span><span class="ident" id="5309315">trace</span><span class="op" id="5309320">(</span><span class="ident" id="5309321">p</span><span class="op" id="5309322">,</span>&nbsp;<span class="string" id="5309324">&#34;PointerType&#34;</span><span class="op" id="5309337">)</span><span class="op" id="5309338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309345">star</span>&nbsp;<span class="op" id="5309350">:=</span>&nbsp;<span class="ident" id="5309353">p</span><span class="op" id="5309354">.</span><span class="ident" id="5309355">expect</span><span class="op" id="5309361">(</span><span class="ident" id="5309362">token</span><span class="op" id="5309367">.</span><span class="ident" id="5309368">MUL</span><span class="op" id="5309371">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309374">base</span>&nbsp;<span class="op" id="5309379">:=</span>&nbsp;<span class="ident" id="5309382">p</span><span class="op" id="5309383">.</span><span class="ident" id="5309384">parseType</span><span class="op" id="5309393">(</span><span class="op" id="5309394">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309398">return</span>&nbsp;<span class="op" id="5309405">&amp;</span><span class="ident" id="5309406">ast</span><span class="op" id="5309409">.</span><span class="ident" id="5309410">StarExpr</span><span class="op" id="5309418">{</span><span class="ident" id="5309419">Star</span><span class="op" id="5309423">:</span>&nbsp;<span class="ident" id="5309425">star</span><span class="op" id="5309429">,</span>&nbsp;<span class="ident" id="5309431">X</span><span class="op" id="5309432">:</span>&nbsp;<span class="ident" id="5309434">base</span><span class="op" id="5309438">}</span><br>
<span class="lineno"></span><span class="op" id="5309440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">755</span><span class="comment" id="5309443">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5309498">func</span>&nbsp;<span class="op" id="5309503">(</span><span class="ident" id="5309504">p</span>&nbsp;<span class="op" id="5309506">*</span><span class="ident" id="5309507">parser</span><span class="op" id="5309513">)</span>&nbsp;<span class="ident" id="5309515">tryVarType</span><span class="op" id="5309525">(</span><span class="ident" id="5309526">isParam</span>&nbsp;<span class="builtintype" id="5309534">bool</span><span class="op" id="5309538">)</span>&nbsp;<span class="ident" id="5309540">ast</span><span class="op" id="5309543">.</span><span class="ident" id="5309544">Expr</span>&nbsp;<span class="op" id="5309549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309552">if</span>&nbsp;<span class="ident" id="5309555">isParam</span>&nbsp;<span class="op" id="5309563">&amp;&amp;</span>&nbsp;<span class="ident" id="5309566">p</span><span class="op" id="5309567">.</span><span class="ident" id="5309568">tok</span>&nbsp;<span class="op" id="5309572">==</span>&nbsp;<span class="ident" id="5309575">token</span><span class="op" id="5309580">.</span><span class="ident" id="5309581">ELLIPSIS</span>&nbsp;<span class="op" id="5309590">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309594">pos</span>&nbsp;<span class="op" id="5309598">:=</span>&nbsp;<span class="ident" id="5309601">p</span><span class="op" id="5309602">.</span><span class="ident" id="5309603">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309609">p</span><span class="op" id="5309610">.</span><span class="ident" id="5309611">next</span><span class="op" id="5309615">(</span><span class="op" id="5309616">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309620">typ</span>&nbsp;<span class="op" id="5309624">:=</span>&nbsp;<span class="ident" id="5309627">p</span><span class="op" id="5309628">.</span><span class="ident" id="5309629">tryIdentOrType</span><span class="op" id="5309643">(</span><span class="op" id="5309644">)</span>&nbsp;<span class="comment" id="5309646">//&nbsp;don&#39;t&nbsp;use&nbsp;parseType&nbsp;so&nbsp;we&nbsp;can&nbsp;provide&nbsp;better&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309710">if</span>&nbsp;<span class="ident" id="5309713">typ</span>&nbsp;<span class="op" id="5309717">!=</span>&nbsp;<span class="builtintype" id="5309720">nil</span>&nbsp;<span class="op" id="5309724">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309729">p</span><span class="op" id="5309730">.</span><span class="ident" id="5309731">resolve</span><span class="op" id="5309738">(</span><span class="ident" id="5309739">typ</span><span class="op" id="5309742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309746">}</span>&nbsp;<span class="keyword" id="5309748">else</span>&nbsp;<span class="op" id="5309753">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309758">p</span><span class="op" id="5309759">.</span><span class="builtintype" id="5309760">error</span><span class="op" id="5309765">(</span><span class="ident" id="5309766">pos</span><span class="op" id="5309769">,</span>&nbsp;<span class="string" id="5309771">&#34;&#39;...&#39;&nbsp;parameter&nbsp;is&nbsp;missing&nbsp;type&#34;</span><span class="op" id="5309804">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309809">typ</span>&nbsp;<span class="op" id="5309813">=</span>&nbsp;<span class="op" id="5309815">&amp;</span><span class="ident" id="5309816">ast</span><span class="op" id="5309819">.</span><span class="ident" id="5309820">BadExpr</span><span class="op" id="5309827">{</span><span class="ident" id="5309828">From</span><span class="op" id="5309832">:</span>&nbsp;<span class="ident" id="5309834">pos</span><span class="op" id="5309837">,</span>&nbsp;<span class="ident" id="5309839">To</span><span class="op" id="5309841">:</span>&nbsp;<span class="ident" id="5309843">p</span><span class="op" id="5309844">.</span><span class="ident" id="5309845">pos</span><span class="op" id="5309848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309856">return</span>&nbsp;<span class="op" id="5309863">&amp;</span><span class="ident" id="5309864">ast</span><span class="op" id="5309867">.</span><span class="ident" id="5309868">Ellipsis</span><span class="op" id="5309876">{</span><span class="ident" id="5309877">Ellipsis</span><span class="op" id="5309885">:</span>&nbsp;<span class="ident" id="5309887">pos</span><span class="op" id="5309890">,</span>&nbsp;<span class="ident" id="5309892">Elt</span><span class="op" id="5309895">:</span>&nbsp;<span class="ident" id="5309897">typ</span><span class="op" id="5309900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5309903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5309906">return</span>&nbsp;<span class="ident" id="5309913">p</span><span class="op" id="5309914">.</span><span class="ident" id="5309915">tryIdentOrType</span><span class="op" id="5309929">(</span><span class="op" id="5309930">)</span><br>
<span class="lineno">770</span><span class="op" id="5309932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5309935">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5309990">func</span>&nbsp;<span class="op" id="5309995">(</span><span class="ident" id="5309996">p</span>&nbsp;<span class="op" id="5309998">*</span><span class="ident" id="5309999">parser</span><span class="op" id="5310005">)</span>&nbsp;<span class="ident" id="5310007">parseVarType</span><span class="op" id="5310019">(</span><span class="ident" id="5310020">isParam</span>&nbsp;<span class="builtintype" id="5310028">bool</span><span class="op" id="5310032">)</span>&nbsp;<span class="ident" id="5310034">ast</span><span class="op" id="5310037">.</span><span class="ident" id="5310038">Expr</span>&nbsp;<span class="op" id="5310043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310046">typ</span>&nbsp;<span class="op" id="5310050">:=</span>&nbsp;<span class="ident" id="5310053">p</span><span class="op" id="5310054">.</span><span class="ident" id="5310055">tryVarType</span><span class="op" id="5310065">(</span><span class="ident" id="5310066">isParam</span><span class="op" id="5310073">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310076">if</span>&nbsp;<span class="ident" id="5310079">typ</span>&nbsp;<span class="op" id="5310083">==</span>&nbsp;<span class="builtintype" id="5310086">nil</span>&nbsp;<span class="op" id="5310090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310094">pos</span>&nbsp;<span class="op" id="5310098">:=</span>&nbsp;<span class="ident" id="5310101">p</span><span class="op" id="5310102">.</span><span class="ident" id="5310103">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310109">p</span><span class="op" id="5310110">.</span><span class="ident" id="5310111">errorExpected</span><span class="op" id="5310124">(</span><span class="ident" id="5310125">pos</span><span class="op" id="5310128">,</span>&nbsp;<span class="string" id="5310130">&#34;type&#34;</span><span class="op" id="5310136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310140">p</span><span class="op" id="5310141">.</span><span class="ident" id="5310142">next</span><span class="op" id="5310146">(</span><span class="op" id="5310147">)</span>&nbsp;<span class="comment" id="5310149">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310168">typ</span>&nbsp;<span class="op" id="5310172">=</span>&nbsp;<span class="op" id="5310174">&amp;</span><span class="ident" id="5310175">ast</span><span class="op" id="5310178">.</span><span class="ident" id="5310179">BadExpr</span><span class="op" id="5310186">{</span><span class="ident" id="5310187">From</span><span class="op" id="5310191">:</span>&nbsp;<span class="ident" id="5310193">pos</span><span class="op" id="5310196">,</span>&nbsp;<span class="ident" id="5310198">To</span><span class="op" id="5310200">:</span>&nbsp;<span class="ident" id="5310202">p</span><span class="op" id="5310203">.</span><span class="ident" id="5310204">pos</span><span class="op" id="5310207">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5310210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310213">return</span>&nbsp;<span class="ident" id="5310220">typ</span><br>
<span class="lineno"></span><span class="op" id="5310224">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5310227">//&nbsp;If&nbsp;any&nbsp;of&nbsp;the&nbsp;results&nbsp;are&nbsp;identifiers,&nbsp;they&nbsp;are&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">785</span><span class="keyword" id="5310292">func</span>&nbsp;<span class="op" id="5310297">(</span><span class="ident" id="5310298">p</span>&nbsp;<span class="op" id="5310300">*</span><span class="ident" id="5310301">parser</span><span class="op" id="5310307">)</span>&nbsp;<span class="ident" id="5310309">parseVarList</span><span class="op" id="5310321">(</span><span class="ident" id="5310322">isParam</span>&nbsp;<span class="builtintype" id="5310330">bool</span><span class="op" id="5310334">)</span>&nbsp;<span class="op" id="5310336">(</span><span class="ident" id="5310337">list</span>&nbsp;<span class="op" id="5310342">[</span><span class="op" id="5310343">]</span><span class="ident" id="5310344">ast</span><span class="op" id="5310347">.</span><span class="ident" id="5310348">Expr</span><span class="op" id="5310352">,</span>&nbsp;<span class="ident" id="5310354">typ</span>&nbsp;<span class="ident" id="5310358">ast</span><span class="op" id="5310361">.</span><span class="ident" id="5310362">Expr</span><span class="op" id="5310366">)</span>&nbsp;<span class="op" id="5310368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310371">if</span>&nbsp;<span class="ident" id="5310374">p</span><span class="op" id="5310375">.</span><span class="ident" id="5310376">trace</span>&nbsp;<span class="op" id="5310382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310386">defer</span>&nbsp;<span class="ident" id="5310392">un</span><span class="op" id="5310394">(</span><span class="ident" id="5310395">trace</span><span class="op" id="5310400">(</span><span class="ident" id="5310401">p</span><span class="op" id="5310402">,</span>&nbsp;<span class="string" id="5310404">&#34;VarList&#34;</span><span class="op" id="5310413">)</span><span class="op" id="5310414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5310417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310421">//&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers&nbsp;looks&nbsp;like&nbsp;a&nbsp;list&nbsp;of&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310479">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310483">//&nbsp;parse/tryVarType&nbsp;accepts&nbsp;any&nbsp;type&nbsp;(including&nbsp;parenthesized</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310546">//&nbsp;ones)&nbsp;even&nbsp;though&nbsp;the&nbsp;syntax&nbsp;does&nbsp;not&nbsp;permit&nbsp;them&nbsp;here:&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310609">//&nbsp;accept&nbsp;them&nbsp;all&nbsp;for&nbsp;more&nbsp;robust&nbsp;parsing&nbsp;and&nbsp;complain&nbsp;later</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310672">for</span>&nbsp;<span class="ident" id="5310676">typ</span>&nbsp;<span class="op" id="5310680">:=</span>&nbsp;<span class="ident" id="5310683">p</span><span class="op" id="5310684">.</span><span class="ident" id="5310685">parseVarType</span><span class="op" id="5310697">(</span><span class="ident" id="5310698">isParam</span><span class="op" id="5310705">)</span><span class="op" id="5310706">;</span>&nbsp;<span class="ident" id="5310708">typ</span>&nbsp;<span class="op" id="5310712">!=</span>&nbsp;<span class="builtintype" id="5310715">nil</span><span class="op" id="5310718">;</span>&nbsp;<span class="op" id="5310720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310724">list</span>&nbsp;<span class="op" id="5310729">=</span>&nbsp;<span class="builtinfunc" id="5310731">append</span><span class="op" id="5310737">(</span><span class="ident" id="5310738">list</span><span class="op" id="5310742">,</span>&nbsp;<span class="ident" id="5310744">typ</span><span class="op" id="5310747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310751">if</span>&nbsp;<span class="ident" id="5310754">p</span><span class="op" id="5310755">.</span><span class="ident" id="5310756">tok</span>&nbsp;<span class="op" id="5310760">!=</span>&nbsp;<span class="ident" id="5310763">token</span><span class="op" id="5310768">.</span><span class="ident" id="5310769">COMMA</span>&nbsp;<span class="op" id="5310775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310780">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5310788">}</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310792">p</span><span class="op" id="5310793">.</span><span class="ident" id="5310794">next</span><span class="op" id="5310798">(</span><span class="op" id="5310799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310803">typ</span>&nbsp;<span class="op" id="5310807">=</span>&nbsp;<span class="ident" id="5310809">p</span><span class="op" id="5310810">.</span><span class="ident" id="5310811">tryVarType</span><span class="op" id="5310821">(</span><span class="ident" id="5310822">isParam</span><span class="op" id="5310829">)</span>&nbsp;<span class="comment" id="5310831">//&nbsp;maybe&nbsp;nil&nbsp;as&nbsp;in:&nbsp;func&nbsp;f(int,)&nbsp;{}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5310868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5310872">//&nbsp;if&nbsp;we&nbsp;had&nbsp;a&nbsp;list&nbsp;of&nbsp;identifiers,&nbsp;it&nbsp;must&nbsp;be&nbsp;followed&nbsp;by&nbsp;a&nbsp;type</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5310939">typ</span>&nbsp;<span class="op" id="5310943">=</span>&nbsp;<span class="ident" id="5310945">p</span><span class="op" id="5310946">.</span><span class="ident" id="5310947">tryVarType</span><span class="op" id="5310957">(</span><span class="ident" id="5310958">isParam</span><span class="op" id="5310965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5310969">return</span><br>
<span class="lineno"></span><span class="op" id="5310976">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">810</span><span class="keyword" id="5310979">func</span>&nbsp;<span class="op" id="5310984">(</span><span class="ident" id="5310985">p</span>&nbsp;<span class="op" id="5310987">*</span><span class="ident" id="5310988">parser</span><span class="op" id="5310994">)</span>&nbsp;<span class="ident" id="5310996">parseParameterList</span><span class="op" id="5311014">(</span><span class="ident" id="5311015">scope</span>&nbsp;<span class="op" id="5311021">*</span><span class="ident" id="5311022">ast</span><span class="op" id="5311025">.</span><span class="ident" id="5311026">Scope</span><span class="op" id="5311031">,</span>&nbsp;<span class="ident" id="5311033">ellipsisOk</span>&nbsp;<span class="builtintype" id="5311044">bool</span><span class="op" id="5311048">)</span>&nbsp;<span class="op" id="5311050">(</span><span class="ident" id="5311051">params</span>&nbsp;<span class="op" id="5311058">[</span><span class="op" id="5311059">]</span><span class="op" id="5311060">*</span><span class="ident" id="5311061">ast</span><span class="op" id="5311064">.</span><span class="ident" id="5311065">Field</span><span class="op" id="5311070">)</span>&nbsp;<span class="op" id="5311072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311075">if</span>&nbsp;<span class="ident" id="5311078">p</span><span class="op" id="5311079">.</span><span class="ident" id="5311080">trace</span>&nbsp;<span class="op" id="5311086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311090">defer</span>&nbsp;<span class="ident" id="5311096">un</span><span class="op" id="5311098">(</span><span class="ident" id="5311099">trace</span><span class="op" id="5311104">(</span><span class="ident" id="5311105">p</span><span class="op" id="5311106">,</span>&nbsp;<span class="string" id="5311108">&#34;ParameterList&#34;</span><span class="op" id="5311123">)</span><span class="op" id="5311124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5311127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311131">//&nbsp;ParameterDecl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311149">list</span><span class="op" id="5311153">,</span>&nbsp;<span class="ident" id="5311155">typ</span>&nbsp;<span class="op" id="5311159">:=</span>&nbsp;<span class="ident" id="5311162">p</span><span class="op" id="5311163">.</span><span class="ident" id="5311164">parseVarList</span><span class="op" id="5311176">(</span><span class="ident" id="5311177">ellipsisOk</span><span class="op" id="5311187">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311191">//&nbsp;analyze&nbsp;case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311208">if</span>&nbsp;<span class="ident" id="5311211">typ</span>&nbsp;<span class="op" id="5311215">!=</span>&nbsp;<span class="builtintype" id="5311218">nil</span>&nbsp;<span class="op" id="5311222">{</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311226">//&nbsp;IdentifierList&nbsp;Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311251">idents</span>&nbsp;<span class="op" id="5311258">:=</span>&nbsp;<span class="ident" id="5311261">p</span><span class="op" id="5311262">.</span><span class="ident" id="5311263">makeIdentList</span><span class="op" id="5311276">(</span><span class="ident" id="5311277">list</span><span class="op" id="5311281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311285">field</span>&nbsp;<span class="op" id="5311291">:=</span>&nbsp;<span class="op" id="5311294">&amp;</span><span class="ident" id="5311295">ast</span><span class="op" id="5311298">.</span><span class="ident" id="5311299">Field</span><span class="op" id="5311304">{</span><span class="ident" id="5311305">Names</span><span class="op" id="5311310">:</span>&nbsp;<span class="ident" id="5311312">idents</span><span class="op" id="5311318">,</span>&nbsp;<span class="ident" id="5311320">Type</span><span class="op" id="5311324">:</span>&nbsp;<span class="ident" id="5311326">typ</span><span class="op" id="5311329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311333">params</span>&nbsp;<span class="op" id="5311340">=</span>&nbsp;<span class="builtinfunc" id="5311342">append</span><span class="op" id="5311348">(</span><span class="ident" id="5311349">params</span><span class="op" id="5311355">,</span>&nbsp;<span class="ident" id="5311357">field</span><span class="op" id="5311362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311366">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311427">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311483">p</span><span class="op" id="5311484">.</span><span class="ident" id="5311485">declare</span><span class="op" id="5311492">(</span><span class="ident" id="5311493">field</span><span class="op" id="5311498">,</span>&nbsp;<span class="builtintype" id="5311500">nil</span><span class="op" id="5311503">,</span>&nbsp;<span class="ident" id="5311505">scope</span><span class="op" id="5311510">,</span>&nbsp;<span class="ident" id="5311512">ast</span><span class="op" id="5311515">.</span><span class="ident" id="5311516">Var</span><span class="op" id="5311519">,</span>&nbsp;<span class="ident" id="5311521">idents</span><span class="op" id="5311527">...</span><span class="op" id="5311530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311534">p</span><span class="op" id="5311535">.</span><span class="ident" id="5311536">resolve</span><span class="op" id="5311543">(</span><span class="ident" id="5311544">typ</span><span class="op" id="5311547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311551">if</span>&nbsp;<span class="op" id="5311554">!</span><span class="ident" id="5311555">p</span><span class="op" id="5311556">.</span><span class="ident" id="5311557">atComma</span><span class="op" id="5311564">(</span><span class="string" id="5311565">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5311581">)</span>&nbsp;<span class="op" id="5311583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311588">return</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5311597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311601">p</span><span class="op" id="5311602">.</span><span class="ident" id="5311603">next</span><span class="op" id="5311607">(</span><span class="op" id="5311608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5311612">for</span>&nbsp;<span class="ident" id="5311616">p</span><span class="op" id="5311617">.</span><span class="ident" id="5311618">tok</span>&nbsp;<span class="op" id="5311622">!=</span>&nbsp;<span class="ident" id="5311625">token</span><span class="op" id="5311630">.</span><span class="ident" id="5311631">RPAREN</span>&nbsp;<span class="op" id="5311638">&amp;&amp;</span>&nbsp;<span class="ident" id="5311641">p</span><span class="op" id="5311642">.</span><span class="ident" id="5311643">tok</span>&nbsp;<span class="op" id="5311647">!=</span>&nbsp;<span class="ident" id="5311650">token</span><span class="op" id="5311655">.</span><span class="ident" id="5311656">EOF</span>&nbsp;<span class="op" id="5311660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311665">idents</span>&nbsp;<span class="op" id="5311672">:=</span>&nbsp;<span class="ident" id="5311675">p</span><span class="op" id="5311676">.</span><span class="ident" id="5311677">parseIdentList</span><span class="op" id="5311691">(</span><span class="op" id="5311692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311697">typ</span>&nbsp;<span class="op" id="5311701">:=</span>&nbsp;<span class="ident" id="5311704">p</span><span class="op" id="5311705">.</span><span class="ident" id="5311706">parseVarType</span><span class="op" id="5311718">(</span><span class="ident" id="5311719">ellipsisOk</span><span class="op" id="5311729">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311734">field</span>&nbsp;<span class="op" id="5311740">:=</span>&nbsp;<span class="op" id="5311743">&amp;</span><span class="ident" id="5311744">ast</span><span class="op" id="5311747">.</span><span class="ident" id="5311748">Field</span><span class="op" id="5311753">{</span><span class="ident" id="5311754">Names</span><span class="op" id="5311759">:</span>&nbsp;<span class="ident" id="5311761">idents</span><span class="op" id="5311767">,</span>&nbsp;<span class="ident" id="5311769">Type</span><span class="op" id="5311773">:</span>&nbsp;<span class="ident" id="5311775">typ</span><span class="op" id="5311778">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311783">params</span>&nbsp;<span class="op" id="5311790">=</span>&nbsp;<span class="builtinfunc" id="5311792">append</span><span class="op" id="5311798">(</span><span class="ident" id="5311799">params</span><span class="op" id="5311805">,</span>&nbsp;<span class="ident" id="5311807">field</span><span class="op" id="5311812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311817">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5311879">//&nbsp;parameter&nbsp;or&nbsp;result&nbsp;variable&nbsp;is&nbsp;the&nbsp;function&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311936">p</span><span class="op" id="5311937">.</span><span class="ident" id="5311938">declare</span><span class="op" id="5311945">(</span><span class="ident" id="5311946">field</span><span class="op" id="5311951">,</span>&nbsp;<span class="builtintype" id="5311953">nil</span><span class="op" id="5311956">,</span>&nbsp;<span class="ident" id="5311958">scope</span><span class="op" id="5311963">,</span>&nbsp;<span class="ident" id="5311965">ast</span><span class="op" id="5311968">.</span><span class="ident" id="5311969">Var</span><span class="op" id="5311972">,</span>&nbsp;<span class="ident" id="5311974">idents</span><span class="op" id="5311980">...</span><span class="op" id="5311983">)</span><br>
<span class="lineno">840</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5311988">p</span><span class="op" id="5311989">.</span><span class="ident" id="5311990">resolve</span><span class="op" id="5311997">(</span><span class="ident" id="5311998">typ</span><span class="op" id="5312001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312006">if</span>&nbsp;<span class="op" id="5312009">!</span><span class="ident" id="5312010">p</span><span class="op" id="5312011">.</span><span class="ident" id="5312012">atComma</span><span class="op" id="5312019">(</span><span class="string" id="5312020">&#34;parameter&nbsp;list&#34;</span><span class="op" id="5312036">)</span>&nbsp;<span class="op" id="5312038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312044">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312058">p</span><span class="op" id="5312059">.</span><span class="ident" id="5312060">next</span><span class="op" id="5312064">(</span><span class="op" id="5312065">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312073">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5312085">//&nbsp;Type&nbsp;{&nbsp;&#34;,&#34;&nbsp;Type&nbsp;}&nbsp;(anonymous&nbsp;parameters)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312130">params</span>&nbsp;<span class="op" id="5312137">=</span>&nbsp;<span class="builtinfunc" id="5312139">make</span><span class="op" id="5312143">(</span><span class="op" id="5312144">[</span><span class="op" id="5312145">]</span><span class="op" id="5312146">*</span><span class="ident" id="5312147">ast</span><span class="op" id="5312150">.</span><span class="ident" id="5312151">Field</span><span class="op" id="5312156">,</span>&nbsp;<span class="builtinfunc" id="5312158">len</span><span class="op" id="5312161">(</span><span class="ident" id="5312162">list</span><span class="op" id="5312166">)</span><span class="op" id="5312167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312170">for</span>&nbsp;<span class="ident" id="5312174">i</span><span class="op" id="5312175">,</span>&nbsp;<span class="ident" id="5312177">typ</span>&nbsp;<span class="op" id="5312181">:=</span>&nbsp;<span class="keyword" id="5312184">range</span>&nbsp;<span class="ident" id="5312190">list</span>&nbsp;<span class="op" id="5312195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312199">p</span><span class="op" id="5312200">.</span><span class="ident" id="5312201">resolve</span><span class="op" id="5312208">(</span><span class="ident" id="5312209">typ</span><span class="op" id="5312212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312216">params</span><span class="op" id="5312222">[</span><span class="ident" id="5312223">i</span><span class="op" id="5312224">]</span>&nbsp;<span class="op" id="5312226">=</span>&nbsp;<span class="op" id="5312228">&amp;</span><span class="ident" id="5312229">ast</span><span class="op" id="5312232">.</span><span class="ident" id="5312233">Field</span><span class="op" id="5312238">{</span><span class="ident" id="5312239">Type</span><span class="op" id="5312243">:</span>&nbsp;<span class="ident" id="5312245">typ</span><span class="op" id="5312248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312251">}</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312254">return</span><br>
<span class="lineno"></span><span class="op" id="5312261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312264">func</span>&nbsp;<span class="op" id="5312269">(</span><span class="ident" id="5312270">p</span>&nbsp;<span class="op" id="5312272">*</span><span class="ident" id="5312273">parser</span><span class="op" id="5312279">)</span>&nbsp;<span class="ident" id="5312281">parseParameters</span><span class="op" id="5312296">(</span><span class="ident" id="5312297">scope</span>&nbsp;<span class="op" id="5312303">*</span><span class="ident" id="5312304">ast</span><span class="op" id="5312307">.</span><span class="ident" id="5312308">Scope</span><span class="op" id="5312313">,</span>&nbsp;<span class="ident" id="5312315">ellipsisOk</span>&nbsp;<span class="builtintype" id="5312326">bool</span><span class="op" id="5312330">)</span>&nbsp;<span class="op" id="5312332">*</span><span class="ident" id="5312333">ast</span><span class="op" id="5312336">.</span><span class="ident" id="5312337">FieldList</span>&nbsp;<span class="op" id="5312347">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312350">if</span>&nbsp;<span class="ident" id="5312353">p</span><span class="op" id="5312354">.</span><span class="ident" id="5312355">trace</span>&nbsp;<span class="op" id="5312361">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312365">defer</span>&nbsp;<span class="ident" id="5312371">un</span><span class="op" id="5312373">(</span><span class="ident" id="5312374">trace</span><span class="op" id="5312379">(</span><span class="ident" id="5312380">p</span><span class="op" id="5312381">,</span>&nbsp;<span class="string" id="5312383">&#34;Parameters&#34;</span><span class="op" id="5312395">)</span><span class="op" id="5312396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312403">var</span>&nbsp;<span class="ident" id="5312407">params</span>&nbsp;<span class="op" id="5312414">[</span><span class="op" id="5312415">]</span><span class="op" id="5312416">*</span><span class="ident" id="5312417">ast</span><span class="op" id="5312420">.</span><span class="ident" id="5312421">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312428">lparen</span>&nbsp;<span class="op" id="5312435">:=</span>&nbsp;<span class="ident" id="5312438">p</span><span class="op" id="5312439">.</span><span class="ident" id="5312440">expect</span><span class="op" id="5312446">(</span><span class="ident" id="5312447">token</span><span class="op" id="5312452">.</span><span class="ident" id="5312453">LPAREN</span><span class="op" id="5312459">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312462">if</span>&nbsp;<span class="ident" id="5312465">p</span><span class="op" id="5312466">.</span><span class="ident" id="5312467">tok</span>&nbsp;<span class="op" id="5312471">!=</span>&nbsp;<span class="ident" id="5312474">token</span><span class="op" id="5312479">.</span><span class="ident" id="5312480">RPAREN</span>&nbsp;<span class="op" id="5312487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312491">params</span>&nbsp;<span class="op" id="5312498">=</span>&nbsp;<span class="ident" id="5312500">p</span><span class="op" id="5312501">.</span><span class="ident" id="5312502">parseParameterList</span><span class="op" id="5312520">(</span><span class="ident" id="5312521">scope</span><span class="op" id="5312526">,</span>&nbsp;<span class="ident" id="5312528">ellipsisOk</span><span class="op" id="5312538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312544">rparen</span>&nbsp;<span class="op" id="5312551">:=</span>&nbsp;<span class="ident" id="5312554">p</span><span class="op" id="5312555">.</span><span class="ident" id="5312556">expect</span><span class="op" id="5312562">(</span><span class="ident" id="5312563">token</span><span class="op" id="5312568">.</span><span class="ident" id="5312569">RPAREN</span><span class="op" id="5312575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312579">return</span>&nbsp;<span class="op" id="5312586">&amp;</span><span class="ident" id="5312587">ast</span><span class="op" id="5312590">.</span><span class="ident" id="5312591">FieldList</span><span class="op" id="5312600">{</span><span class="ident" id="5312601">Opening</span><span class="op" id="5312608">:</span>&nbsp;<span class="ident" id="5312610">lparen</span><span class="op" id="5312616">,</span>&nbsp;<span class="ident" id="5312618">List</span><span class="op" id="5312622">:</span>&nbsp;<span class="ident" id="5312624">params</span><span class="op" id="5312630">,</span>&nbsp;<span class="ident" id="5312632">Closing</span><span class="op" id="5312639">:</span>&nbsp;<span class="ident" id="5312641">rparen</span><span class="op" id="5312647">}</span><br>
<span class="lineno"></span><span class="op" id="5312649">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312652">func</span>&nbsp;<span class="op" id="5312657">(</span><span class="ident" id="5312658">p</span>&nbsp;<span class="op" id="5312660">*</span><span class="ident" id="5312661">parser</span><span class="op" id="5312667">)</span>&nbsp;<span class="ident" id="5312669">parseResult</span><span class="op" id="5312680">(</span><span class="ident" id="5312681">scope</span>&nbsp;<span class="op" id="5312687">*</span><span class="ident" id="5312688">ast</span><span class="op" id="5312691">.</span><span class="ident" id="5312692">Scope</span><span class="op" id="5312697">)</span>&nbsp;<span class="op" id="5312699">*</span><span class="ident" id="5312700">ast</span><span class="op" id="5312703">.</span><span class="ident" id="5312704">FieldList</span>&nbsp;<span class="op" id="5312714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312717">if</span>&nbsp;<span class="ident" id="5312720">p</span><span class="op" id="5312721">.</span><span class="ident" id="5312722">trace</span>&nbsp;<span class="op" id="5312728">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312732">defer</span>&nbsp;<span class="ident" id="5312738">un</span><span class="op" id="5312740">(</span><span class="ident" id="5312741">trace</span><span class="op" id="5312746">(</span><span class="ident" id="5312747">p</span><span class="op" id="5312748">,</span>&nbsp;<span class="string" id="5312750">&#34;Result&#34;</span><span class="op" id="5312758">)</span><span class="op" id="5312759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312762">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312766">if</span>&nbsp;<span class="ident" id="5312769">p</span><span class="op" id="5312770">.</span><span class="ident" id="5312771">tok</span>&nbsp;<span class="op" id="5312775">==</span>&nbsp;<span class="ident" id="5312778">token</span><span class="op" id="5312783">.</span><span class="ident" id="5312784">LPAREN</span>&nbsp;<span class="op" id="5312791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312795">return</span>&nbsp;<span class="ident" id="5312802">p</span><span class="op" id="5312803">.</span><span class="ident" id="5312804">parseParameters</span><span class="op" id="5312819">(</span><span class="ident" id="5312820">scope</span><span class="op" id="5312825">,</span>&nbsp;<span class="builtintype" id="5312827">false</span><span class="op" id="5312832">)</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312835">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312839">typ</span>&nbsp;<span class="op" id="5312843">:=</span>&nbsp;<span class="ident" id="5312846">p</span><span class="op" id="5312847">.</span><span class="ident" id="5312848">tryType</span><span class="op" id="5312855">(</span><span class="op" id="5312856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312859">if</span>&nbsp;<span class="ident" id="5312862">typ</span>&nbsp;<span class="op" id="5312866">!=</span>&nbsp;<span class="builtintype" id="5312869">nil</span>&nbsp;<span class="op" id="5312873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312877">list</span>&nbsp;<span class="op" id="5312882">:=</span>&nbsp;<span class="builtinfunc" id="5312885">make</span><span class="op" id="5312889">(</span><span class="op" id="5312890">[</span><span class="op" id="5312891">]</span><span class="op" id="5312892">*</span><span class="ident" id="5312893">ast</span><span class="op" id="5312896">.</span><span class="ident" id="5312897">Field</span><span class="op" id="5312902">,</span>&nbsp;<span class="num" id="5312904">1</span><span class="op" id="5312905">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5312909">list</span><span class="op" id="5312913">[</span><span class="num" id="5312914">0</span><span class="op" id="5312915">]</span>&nbsp;<span class="op" id="5312917">=</span>&nbsp;<span class="op" id="5312919">&amp;</span><span class="ident" id="5312920">ast</span><span class="op" id="5312923">.</span><span class="ident" id="5312924">Field</span><span class="op" id="5312929">{</span><span class="ident" id="5312930">Type</span><span class="op" id="5312934">:</span>&nbsp;<span class="ident" id="5312936">typ</span><span class="op" id="5312939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312943">return</span>&nbsp;<span class="op" id="5312950">&amp;</span><span class="ident" id="5312951">ast</span><span class="op" id="5312954">.</span><span class="ident" id="5312955">FieldList</span><span class="op" id="5312964">{</span><span class="ident" id="5312965">List</span><span class="op" id="5312969">:</span>&nbsp;<span class="ident" id="5312971">list</span><span class="op" id="5312975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5312978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5312982">return</span>&nbsp;<span class="builtintype" id="5312989">nil</span><br>
<span class="lineno">890</span><span class="op" id="5312993">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5312996">func</span>&nbsp;<span class="op" id="5313001">(</span><span class="ident" id="5313002">p</span>&nbsp;<span class="op" id="5313004">*</span><span class="ident" id="5313005">parser</span><span class="op" id="5313011">)</span>&nbsp;<span class="ident" id="5313013">parseSignature</span><span class="op" id="5313027">(</span><span class="ident" id="5313028">scope</span>&nbsp;<span class="op" id="5313034">*</span><span class="ident" id="5313035">ast</span><span class="op" id="5313038">.</span><span class="ident" id="5313039">Scope</span><span class="op" id="5313044">)</span>&nbsp;<span class="op" id="5313046">(</span><span class="ident" id="5313047">params</span><span class="op" id="5313053">,</span>&nbsp;<span class="ident" id="5313055">results</span>&nbsp;<span class="op" id="5313063">*</span><span class="ident" id="5313064">ast</span><span class="op" id="5313067">.</span><span class="ident" id="5313068">FieldList</span><span class="op" id="5313077">)</span>&nbsp;<span class="op" id="5313079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313082">if</span>&nbsp;<span class="ident" id="5313085">p</span><span class="op" id="5313086">.</span><span class="ident" id="5313087">trace</span>&nbsp;<span class="op" id="5313093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313097">defer</span>&nbsp;<span class="ident" id="5313103">un</span><span class="op" id="5313105">(</span><span class="ident" id="5313106">trace</span><span class="op" id="5313111">(</span><span class="ident" id="5313112">p</span><span class="op" id="5313113">,</span>&nbsp;<span class="string" id="5313115">&#34;Signature&#34;</span><span class="op" id="5313126">)</span><span class="op" id="5313127">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5313130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313134">params</span>&nbsp;<span class="op" id="5313141">=</span>&nbsp;<span class="ident" id="5313143">p</span><span class="op" id="5313144">.</span><span class="ident" id="5313145">parseParameters</span><span class="op" id="5313160">(</span><span class="ident" id="5313161">scope</span><span class="op" id="5313166">,</span>&nbsp;<span class="builtintype" id="5313168">true</span><span class="op" id="5313172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313175">results</span>&nbsp;<span class="op" id="5313183">=</span>&nbsp;<span class="ident" id="5313185">p</span><span class="op" id="5313186">.</span><span class="ident" id="5313187">parseResult</span><span class="op" id="5313198">(</span><span class="ident" id="5313199">scope</span><span class="op" id="5313204">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313208">return</span><br>
<span class="lineno"></span><span class="op" id="5313215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5313218">func</span>&nbsp;<span class="op" id="5313223">(</span><span class="ident" id="5313224">p</span>&nbsp;<span class="op" id="5313226">*</span><span class="ident" id="5313227">parser</span><span class="op" id="5313233">)</span>&nbsp;<span class="ident" id="5313235">parseFuncType</span><span class="op" id="5313248">(</span><span class="op" id="5313249">)</span>&nbsp;<span class="op" id="5313251">(</span><span class="op" id="5313252">*</span><span class="ident" id="5313253">ast</span><span class="op" id="5313256">.</span><span class="ident" id="5313257">FuncType</span><span class="op" id="5313265">,</span>&nbsp;<span class="op" id="5313267">*</span><span class="ident" id="5313268">ast</span><span class="op" id="5313271">.</span><span class="ident" id="5313272">Scope</span><span class="op" id="5313277">)</span>&nbsp;<span class="op" id="5313279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313282">if</span>&nbsp;<span class="ident" id="5313285">p</span><span class="op" id="5313286">.</span><span class="ident" id="5313287">trace</span>&nbsp;<span class="op" id="5313293">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313297">defer</span>&nbsp;<span class="ident" id="5313303">un</span><span class="op" id="5313305">(</span><span class="ident" id="5313306">trace</span><span class="op" id="5313311">(</span><span class="ident" id="5313312">p</span><span class="op" id="5313313">,</span>&nbsp;<span class="string" id="5313315">&#34;FuncType&#34;</span><span class="op" id="5313325">)</span><span class="op" id="5313326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5313329">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313333">pos</span>&nbsp;<span class="op" id="5313337">:=</span>&nbsp;<span class="ident" id="5313340">p</span><span class="op" id="5313341">.</span><span class="ident" id="5313342">expect</span><span class="op" id="5313348">(</span><span class="ident" id="5313349">token</span><span class="op" id="5313354">.</span><span class="ident" id="5313355">FUNC</span><span class="op" id="5313359">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313362">scope</span>&nbsp;<span class="op" id="5313368">:=</span>&nbsp;<span class="ident" id="5313371">ast</span><span class="op" id="5313374">.</span><span class="ident" id="5313375">NewScope</span><span class="op" id="5313383">(</span><span class="ident" id="5313384">p</span><span class="op" id="5313385">.</span><span class="ident" id="5313386">topScope</span><span class="op" id="5313394">)</span>&nbsp;<span class="comment" id="5313396">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313415">params</span><span class="op" id="5313421">,</span>&nbsp;<span class="ident" id="5313423">results</span>&nbsp;<span class="op" id="5313431">:=</span>&nbsp;<span class="ident" id="5313434">p</span><span class="op" id="5313435">.</span><span class="ident" id="5313436">parseSignature</span><span class="op" id="5313450">(</span><span class="ident" id="5313451">scope</span><span class="op" id="5313456">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313460">return</span>&nbsp;<span class="op" id="5313467">&amp;</span><span class="ident" id="5313468">ast</span><span class="op" id="5313471">.</span><span class="ident" id="5313472">FuncType</span><span class="op" id="5313480">{</span><span class="ident" id="5313481">Func</span><span class="op" id="5313485">:</span>&nbsp;<span class="ident" id="5313487">pos</span><span class="op" id="5313490">,</span>&nbsp;<span class="ident" id="5313492">Params</span><span class="op" id="5313498">:</span>&nbsp;<span class="ident" id="5313500">params</span><span class="op" id="5313506">,</span>&nbsp;<span class="ident" id="5313508">Results</span><span class="op" id="5313515">:</span>&nbsp;<span class="ident" id="5313517">results</span><span class="op" id="5313524">}</span><span class="op" id="5313525">,</span>&nbsp;<span class="ident" id="5313527">scope</span><br>
<span class="lineno"></span><span class="op" id="5313533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="5313536">func</span>&nbsp;<span class="op" id="5313541">(</span><span class="ident" id="5313542">p</span>&nbsp;<span class="op" id="5313544">*</span><span class="ident" id="5313545">parser</span><span class="op" id="5313551">)</span>&nbsp;<span class="ident" id="5313553">parseMethodSpec</span><span class="op" id="5313568">(</span><span class="ident" id="5313569">scope</span>&nbsp;<span class="op" id="5313575">*</span><span class="ident" id="5313576">ast</span><span class="op" id="5313579">.</span><span class="ident" id="5313580">Scope</span><span class="op" id="5313585">)</span>&nbsp;<span class="op" id="5313587">*</span><span class="ident" id="5313588">ast</span><span class="op" id="5313591">.</span><span class="ident" id="5313592">Field</span>&nbsp;<span class="op" id="5313598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313601">if</span>&nbsp;<span class="ident" id="5313604">p</span><span class="op" id="5313605">.</span><span class="ident" id="5313606">trace</span>&nbsp;<span class="op" id="5313612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313616">defer</span>&nbsp;<span class="ident" id="5313622">un</span><span class="op" id="5313624">(</span><span class="ident" id="5313625">trace</span><span class="op" id="5313630">(</span><span class="ident" id="5313631">p</span><span class="op" id="5313632">,</span>&nbsp;<span class="string" id="5313634">&#34;MethodSpec&#34;</span><span class="op" id="5313646">)</span><span class="op" id="5313647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5313650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313654">doc</span>&nbsp;<span class="op" id="5313658">:=</span>&nbsp;<span class="ident" id="5313661">p</span><span class="op" id="5313662">.</span><span class="ident" id="5313663">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313676">var</span>&nbsp;<span class="ident" id="5313680">idents</span>&nbsp;<span class="op" id="5313687">[</span><span class="op" id="5313688">]</span><span class="op" id="5313689">*</span><span class="ident" id="5313690">ast</span><span class="op" id="5313693">.</span><span class="ident" id="5313694">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313701">var</span>&nbsp;<span class="ident" id="5313705">typ</span>&nbsp;<span class="ident" id="5313709">ast</span><span class="op" id="5313712">.</span><span class="ident" id="5313713">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313719">x</span>&nbsp;<span class="op" id="5313721">:=</span>&nbsp;<span class="ident" id="5313724">p</span><span class="op" id="5313725">.</span><span class="ident" id="5313726">parseTypeName</span><span class="op" id="5313739">(</span><span class="op" id="5313740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5313743">if</span>&nbsp;<span class="ident" id="5313746">ident</span><span class="op" id="5313751">,</span>&nbsp;<span class="ident" id="5313753">isIdent</span>&nbsp;<span class="op" id="5313761">:=</span>&nbsp;<span class="ident" id="5313764">x</span><span class="op" id="5313765">.</span><span class="op" id="5313766">(</span><span class="op" id="5313767">*</span><span class="ident" id="5313768">ast</span><span class="op" id="5313771">.</span><span class="ident" id="5313772">Ident</span><span class="op" id="5313777">)</span><span class="op" id="5313778">;</span>&nbsp;<span class="ident" id="5313780">isIdent</span>&nbsp;<span class="op" id="5313788">&amp;&amp;</span>&nbsp;<span class="ident" id="5313791">p</span><span class="op" id="5313792">.</span><span class="ident" id="5313793">tok</span>&nbsp;<span class="op" id="5313797">==</span>&nbsp;<span class="ident" id="5313800">token</span><span class="op" id="5313805">.</span><span class="ident" id="5313806">LPAREN</span>&nbsp;<span class="op" id="5313813">{</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5313817">//&nbsp;method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313829">idents</span>&nbsp;<span class="op" id="5313836">=</span>&nbsp;<span class="op" id="5313838">[</span><span class="op" id="5313839">]</span><span class="op" id="5313840">*</span><span class="ident" id="5313841">ast</span><span class="op" id="5313844">.</span><span class="ident" id="5313845">Ident</span><span class="op" id="5313850">{</span><span class="ident" id="5313851">ident</span><span class="op" id="5313856">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313860">scope</span>&nbsp;<span class="op" id="5313866">:=</span>&nbsp;<span class="ident" id="5313869">ast</span><span class="op" id="5313872">.</span><span class="ident" id="5313873">NewScope</span><span class="op" id="5313881">(</span><span class="builtintype" id="5313882">nil</span><span class="op" id="5313885">)</span>&nbsp;<span class="comment" id="5313887">//&nbsp;method&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313905">params</span><span class="op" id="5313911">,</span>&nbsp;<span class="ident" id="5313913">results</span>&nbsp;<span class="op" id="5313921">:=</span>&nbsp;<span class="ident" id="5313924">p</span><span class="op" id="5313925">.</span><span class="ident" id="5313926">parseSignature</span><span class="op" id="5313940">(</span><span class="ident" id="5313941">scope</span><span class="op" id="5313946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5313950">typ</span>&nbsp;<span class="op" id="5313954">=</span>&nbsp;<span class="op" id="5313956">&amp;</span><span class="ident" id="5313957">ast</span><span class="op" id="5313960">.</span><span class="ident" id="5313961">FuncType</span><span class="op" id="5313969">{</span><span class="ident" id="5313970">Func</span><span class="op" id="5313974">:</span>&nbsp;<span class="ident" id="5313976">token</span><span class="op" id="5313981">.</span><span class="ident" id="5313982">NoPos</span><span class="op" id="5313987">,</span>&nbsp;<span class="ident" id="5313989">Params</span><span class="op" id="5313995">:</span>&nbsp;<span class="ident" id="5313997">params</span><span class="op" id="5314003">,</span>&nbsp;<span class="ident" id="5314005">Results</span><span class="op" id="5314012">:</span>&nbsp;<span class="ident" id="5314014">results</span><span class="op" id="5314021">}</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314024">}</span>&nbsp;<span class="keyword" id="5314026">else</span>&nbsp;<span class="op" id="5314031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5314035">//&nbsp;embedded&nbsp;interface</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314059">typ</span>&nbsp;<span class="op" id="5314063">=</span>&nbsp;<span class="ident" id="5314065">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314069">p</span><span class="op" id="5314070">.</span><span class="ident" id="5314071">resolve</span><span class="op" id="5314078">(</span><span class="ident" id="5314079">typ</span><span class="op" id="5314082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314085">}</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314088">p</span><span class="op" id="5314089">.</span><span class="ident" id="5314090">expectSemi</span><span class="op" id="5314100">(</span><span class="op" id="5314101">)</span>&nbsp;<span class="comment" id="5314103">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314144">spec</span>&nbsp;<span class="op" id="5314149">:=</span>&nbsp;<span class="op" id="5314152">&amp;</span><span class="ident" id="5314153">ast</span><span class="op" id="5314156">.</span><span class="ident" id="5314157">Field</span><span class="op" id="5314162">{</span><span class="ident" id="5314163">Doc</span><span class="op" id="5314166">:</span>&nbsp;<span class="ident" id="5314168">doc</span><span class="op" id="5314171">,</span>&nbsp;<span class="ident" id="5314173">Names</span><span class="op" id="5314178">:</span>&nbsp;<span class="ident" id="5314180">idents</span><span class="op" id="5314186">,</span>&nbsp;<span class="ident" id="5314188">Type</span><span class="op" id="5314192">:</span>&nbsp;<span class="ident" id="5314194">typ</span><span class="op" id="5314197">,</span>&nbsp;<span class="ident" id="5314199">Comment</span><span class="op" id="5314206">:</span>&nbsp;<span class="ident" id="5314208">p</span><span class="op" id="5314209">.</span><span class="ident" id="5314210">lineComment</span><span class="op" id="5314221">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314224">p</span><span class="op" id="5314225">.</span><span class="ident" id="5314226">declare</span><span class="op" id="5314233">(</span><span class="ident" id="5314234">spec</span><span class="op" id="5314238">,</span>&nbsp;<span class="builtintype" id="5314240">nil</span><span class="op" id="5314243">,</span>&nbsp;<span class="ident" id="5314245">scope</span><span class="op" id="5314250">,</span>&nbsp;<span class="ident" id="5314252">ast</span><span class="op" id="5314255">.</span><span class="ident" id="5314256">Fun</span><span class="op" id="5314259">,</span>&nbsp;<span class="ident" id="5314261">idents</span><span class="op" id="5314267">...</span><span class="op" id="5314270">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314274">return</span>&nbsp;<span class="ident" id="5314281">spec</span><br>
<span class="lineno"></span><span class="op" id="5314286">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5314289">func</span>&nbsp;<span class="op" id="5314294">(</span><span class="ident" id="5314295">p</span>&nbsp;<span class="op" id="5314297">*</span><span class="ident" id="5314298">parser</span><span class="op" id="5314304">)</span>&nbsp;<span class="ident" id="5314306">parseInterfaceType</span><span class="op" id="5314324">(</span><span class="op" id="5314325">)</span>&nbsp;<span class="op" id="5314327">*</span><span class="ident" id="5314328">ast</span><span class="op" id="5314331">.</span><span class="ident" id="5314332">InterfaceType</span>&nbsp;<span class="op" id="5314346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314349">if</span>&nbsp;<span class="ident" id="5314352">p</span><span class="op" id="5314353">.</span><span class="ident" id="5314354">trace</span>&nbsp;<span class="op" id="5314360">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314364">defer</span>&nbsp;<span class="ident" id="5314370">un</span><span class="op" id="5314372">(</span><span class="ident" id="5314373">trace</span><span class="op" id="5314378">(</span><span class="ident" id="5314379">p</span><span class="op" id="5314380">,</span>&nbsp;<span class="string" id="5314382">&#34;InterfaceType&#34;</span><span class="op" id="5314397">)</span><span class="op" id="5314398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314405">pos</span>&nbsp;<span class="op" id="5314409">:=</span>&nbsp;<span class="ident" id="5314412">p</span><span class="op" id="5314413">.</span><span class="ident" id="5314414">expect</span><span class="op" id="5314420">(</span><span class="ident" id="5314421">token</span><span class="op" id="5314426">.</span><span class="ident" id="5314427">INTERFACE</span><span class="op" id="5314436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314439">lbrace</span>&nbsp;<span class="op" id="5314446">:=</span>&nbsp;<span class="ident" id="5314449">p</span><span class="op" id="5314450">.</span><span class="ident" id="5314451">expect</span><span class="op" id="5314457">(</span><span class="ident" id="5314458">token</span><span class="op" id="5314463">.</span><span class="ident" id="5314464">LBRACE</span><span class="op" id="5314470">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314473">scope</span>&nbsp;<span class="op" id="5314479">:=</span>&nbsp;<span class="ident" id="5314482">ast</span><span class="op" id="5314485">.</span><span class="ident" id="5314486">NewScope</span><span class="op" id="5314494">(</span><span class="builtintype" id="5314495">nil</span><span class="op" id="5314498">)</span>&nbsp;<span class="comment" id="5314500">//&nbsp;interface&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314520">var</span>&nbsp;<span class="ident" id="5314524">list</span>&nbsp;<span class="op" id="5314529">[</span><span class="op" id="5314530">]</span><span class="op" id="5314531">*</span><span class="ident" id="5314532">ast</span><span class="op" id="5314535">.</span><span class="ident" id="5314536">Field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314543">for</span>&nbsp;<span class="ident" id="5314547">p</span><span class="op" id="5314548">.</span><span class="ident" id="5314549">tok</span>&nbsp;<span class="op" id="5314553">==</span>&nbsp;<span class="ident" id="5314556">token</span><span class="op" id="5314561">.</span><span class="ident" id="5314562">IDENT</span>&nbsp;<span class="op" id="5314568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314572">list</span>&nbsp;<span class="op" id="5314577">=</span>&nbsp;<span class="builtinfunc" id="5314579">append</span><span class="op" id="5314585">(</span><span class="ident" id="5314586">list</span><span class="op" id="5314590">,</span>&nbsp;<span class="ident" id="5314592">p</span><span class="op" id="5314593">.</span><span class="ident" id="5314594">parseMethodSpec</span><span class="op" id="5314609">(</span><span class="ident" id="5314610">scope</span><span class="op" id="5314615">)</span><span class="op" id="5314616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314619">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314622">rbrace</span>&nbsp;<span class="op" id="5314629">:=</span>&nbsp;<span class="ident" id="5314632">p</span><span class="op" id="5314633">.</span><span class="ident" id="5314634">expect</span><span class="op" id="5314640">(</span><span class="ident" id="5314641">token</span><span class="op" id="5314646">.</span><span class="ident" id="5314647">RBRACE</span><span class="op" id="5314653">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314657">return</span>&nbsp;<span class="op" id="5314664">&amp;</span><span class="ident" id="5314665">ast</span><span class="op" id="5314668">.</span><span class="ident" id="5314669">InterfaceType</span><span class="op" id="5314682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314686">Interface</span><span class="op" id="5314695">:</span>&nbsp;<span class="ident" id="5314697">pos</span><span class="op" id="5314700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314704">Methods</span><span class="op" id="5314711">:</span>&nbsp;<span class="op" id="5314713">&amp;</span><span class="ident" id="5314714">ast</span><span class="op" id="5314717">.</span><span class="ident" id="5314718">FieldList</span><span class="op" id="5314727">{</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314732">Opening</span><span class="op" id="5314739">:</span>&nbsp;<span class="ident" id="5314741">lbrace</span><span class="op" id="5314747">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314752">List</span><span class="op" id="5314756">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314761">list</span><span class="op" id="5314765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314770">Closing</span><span class="op" id="5314777">:</span>&nbsp;<span class="ident" id="5314779">rbrace</span><span class="op" id="5314785">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314789">}</span><span class="op" id="5314790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314793">}</span><br>
<span class="lineno">965</span><span class="op" id="5314795">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5314798">func</span>&nbsp;<span class="op" id="5314803">(</span><span class="ident" id="5314804">p</span>&nbsp;<span class="op" id="5314806">*</span><span class="ident" id="5314807">parser</span><span class="op" id="5314813">)</span>&nbsp;<span class="ident" id="5314815">parseMapType</span><span class="op" id="5314827">(</span><span class="op" id="5314828">)</span>&nbsp;<span class="op" id="5314830">*</span><span class="ident" id="5314831">ast</span><span class="op" id="5314834">.</span><span class="ident" id="5314835">MapType</span>&nbsp;<span class="op" id="5314843">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314846">if</span>&nbsp;<span class="ident" id="5314849">p</span><span class="op" id="5314850">.</span><span class="ident" id="5314851">trace</span>&nbsp;<span class="op" id="5314857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5314861">defer</span>&nbsp;<span class="ident" id="5314867">un</span><span class="op" id="5314869">(</span><span class="ident" id="5314870">trace</span><span class="op" id="5314875">(</span><span class="ident" id="5314876">p</span><span class="op" id="5314877">,</span>&nbsp;<span class="string" id="5314879">&#34;MapType&#34;</span><span class="op" id="5314888">)</span><span class="op" id="5314889">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5314892">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314896">pos</span>&nbsp;<span class="op" id="5314900">:=</span>&nbsp;<span class="ident" id="5314903">p</span><span class="op" id="5314904">.</span><span class="ident" id="5314905">expect</span><span class="op" id="5314911">(</span><span class="ident" id="5314912">token</span><span class="op" id="5314917">.</span><span class="ident" id="5314918">MAP</span><span class="op" id="5314921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314924">p</span><span class="op" id="5314925">.</span><span class="ident" id="5314926">expect</span><span class="op" id="5314932">(</span><span class="ident" id="5314933">token</span><span class="op" id="5314938">.</span><span class="ident" id="5314939">LBRACK</span><span class="op" id="5314945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314948">key</span>&nbsp;<span class="op" id="5314952">:=</span>&nbsp;<span class="ident" id="5314955">p</span><span class="op" id="5314956">.</span><span class="ident" id="5314957">parseType</span><span class="op" id="5314966">(</span><span class="op" id="5314967">)</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314970">p</span><span class="op" id="5314971">.</span><span class="ident" id="5314972">expect</span><span class="op" id="5314978">(</span><span class="ident" id="5314979">token</span><span class="op" id="5314984">.</span><span class="ident" id="5314985">RBRACK</span><span class="op" id="5314991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5314994">value</span>&nbsp;<span class="op" id="5315000">:=</span>&nbsp;<span class="ident" id="5315003">p</span><span class="op" id="5315004">.</span><span class="ident" id="5315005">parseType</span><span class="op" id="5315014">(</span><span class="op" id="5315015">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315019">return</span>&nbsp;<span class="op" id="5315026">&amp;</span><span class="ident" id="5315027">ast</span><span class="op" id="5315030">.</span><span class="ident" id="5315031">MapType</span><span class="op" id="5315038">{</span><span class="ident" id="5315039">Map</span><span class="op" id="5315042">:</span>&nbsp;<span class="ident" id="5315044">pos</span><span class="op" id="5315047">,</span>&nbsp;<span class="ident" id="5315049">Key</span><span class="op" id="5315052">:</span>&nbsp;<span class="ident" id="5315054">key</span><span class="op" id="5315057">,</span>&nbsp;<span class="ident" id="5315059">Value</span><span class="op" id="5315064">:</span>&nbsp;<span class="ident" id="5315066">value</span><span class="op" id="5315071">}</span><br>
<span class="lineno"></span><span class="op" id="5315073">}</span><br>
<span class="lineno">980</span><br>
<span class="lineno"></span><span class="keyword" id="5315076">func</span>&nbsp;<span class="op" id="5315081">(</span><span class="ident" id="5315082">p</span>&nbsp;<span class="op" id="5315084">*</span><span class="ident" id="5315085">parser</span><span class="op" id="5315091">)</span>&nbsp;<span class="ident" id="5315093">parseChanType</span><span class="op" id="5315106">(</span><span class="op" id="5315107">)</span>&nbsp;<span class="op" id="5315109">*</span><span class="ident" id="5315110">ast</span><span class="op" id="5315113">.</span><span class="ident" id="5315114">ChanType</span>&nbsp;<span class="op" id="5315123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315126">if</span>&nbsp;<span class="ident" id="5315129">p</span><span class="op" id="5315130">.</span><span class="ident" id="5315131">trace</span>&nbsp;<span class="op" id="5315137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315141">defer</span>&nbsp;<span class="ident" id="5315147">un</span><span class="op" id="5315149">(</span><span class="ident" id="5315150">trace</span><span class="op" id="5315155">(</span><span class="ident" id="5315156">p</span><span class="op" id="5315157">,</span>&nbsp;<span class="string" id="5315159">&#34;ChanType&#34;</span><span class="op" id="5315169">)</span><span class="op" id="5315170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5315173">}</span><br>
<span class="lineno">985</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315177">pos</span>&nbsp;<span class="op" id="5315181">:=</span>&nbsp;<span class="ident" id="5315184">p</span><span class="op" id="5315185">.</span><span class="ident" id="5315186">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315191">dir</span>&nbsp;<span class="op" id="5315195">:=</span>&nbsp;<span class="ident" id="5315198">ast</span><span class="op" id="5315201">.</span><span class="ident" id="5315202">SEND</span>&nbsp;<span class="op" id="5315207">|</span>&nbsp;<span class="ident" id="5315209">ast</span><span class="op" id="5315212">.</span><span class="ident" id="5315213">RECV</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315219">var</span>&nbsp;<span class="ident" id="5315223">arrow</span>&nbsp;<span class="ident" id="5315229">token</span><span class="op" id="5315234">.</span><span class="ident" id="5315235">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315240">if</span>&nbsp;<span class="ident" id="5315243">p</span><span class="op" id="5315244">.</span><span class="ident" id="5315245">tok</span>&nbsp;<span class="op" id="5315249">==</span>&nbsp;<span class="ident" id="5315252">token</span><span class="op" id="5315257">.</span><span class="ident" id="5315258">CHAN</span>&nbsp;<span class="op" id="5315263">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315267">p</span><span class="op" id="5315268">.</span><span class="ident" id="5315269">next</span><span class="op" id="5315273">(</span><span class="op" id="5315274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315278">if</span>&nbsp;<span class="ident" id="5315281">p</span><span class="op" id="5315282">.</span><span class="ident" id="5315283">tok</span>&nbsp;<span class="op" id="5315287">==</span>&nbsp;<span class="ident" id="5315290">token</span><span class="op" id="5315295">.</span><span class="ident" id="5315296">ARROW</span>&nbsp;<span class="op" id="5315302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315307">arrow</span>&nbsp;<span class="op" id="5315313">=</span>&nbsp;<span class="ident" id="5315315">p</span><span class="op" id="5315316">.</span><span class="ident" id="5315317">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315324">p</span><span class="op" id="5315325">.</span><span class="ident" id="5315326">next</span><span class="op" id="5315330">(</span><span class="op" id="5315331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315336">dir</span>&nbsp;<span class="op" id="5315340">=</span>&nbsp;<span class="ident" id="5315342">ast</span><span class="op" id="5315345">.</span><span class="ident" id="5315346">SEND</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5315353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5315356">}</span>&nbsp;<span class="keyword" id="5315358">else</span>&nbsp;<span class="op" id="5315363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315367">arrow</span>&nbsp;<span class="op" id="5315373">=</span>&nbsp;<span class="ident" id="5315375">p</span><span class="op" id="5315376">.</span><span class="ident" id="5315377">expect</span><span class="op" id="5315383">(</span><span class="ident" id="5315384">token</span><span class="op" id="5315389">.</span><span class="ident" id="5315390">ARROW</span><span class="op" id="5315395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315399">p</span><span class="op" id="5315400">.</span><span class="ident" id="5315401">expect</span><span class="op" id="5315407">(</span><span class="ident" id="5315408">token</span><span class="op" id="5315413">.</span><span class="ident" id="5315414">CHAN</span><span class="op" id="5315418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315422">dir</span>&nbsp;<span class="op" id="5315426">=</span>&nbsp;<span class="ident" id="5315428">ast</span><span class="op" id="5315431">.</span><span class="ident" id="5315432">RECV</span><br>
<span class="lineno">1000</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5315438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315441">value</span>&nbsp;<span class="op" id="5315447">:=</span>&nbsp;<span class="ident" id="5315450">p</span><span class="op" id="5315451">.</span><span class="ident" id="5315452">parseType</span><span class="op" id="5315461">(</span><span class="op" id="5315462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315466">return</span>&nbsp;<span class="op" id="5315473">&amp;</span><span class="ident" id="5315474">ast</span><span class="op" id="5315477">.</span><span class="ident" id="5315478">ChanType</span><span class="op" id="5315486">{</span><span class="ident" id="5315487">Begin</span><span class="op" id="5315492">:</span>&nbsp;<span class="ident" id="5315494">pos</span><span class="op" id="5315497">,</span>&nbsp;<span class="ident" id="5315499">Arrow</span><span class="op" id="5315504">:</span>&nbsp;<span class="ident" id="5315506">arrow</span><span class="op" id="5315511">,</span>&nbsp;<span class="ident" id="5315513">Dir</span><span class="op" id="5315516">:</span>&nbsp;<span class="ident" id="5315518">dir</span><span class="op" id="5315521">,</span>&nbsp;<span class="ident" id="5315523">Value</span><span class="op" id="5315528">:</span>&nbsp;<span class="ident" id="5315530">value</span><span class="op" id="5315535">}</span><br>
<span class="lineno"></span><span class="op" id="5315537">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="5315540">//&nbsp;If&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5315595">func</span>&nbsp;<span class="op" id="5315600">(</span><span class="ident" id="5315601">p</span>&nbsp;<span class="op" id="5315603">*</span><span class="ident" id="5315604">parser</span><span class="op" id="5315610">)</span>&nbsp;<span class="ident" id="5315612">tryIdentOrType</span><span class="op" id="5315626">(</span><span class="op" id="5315627">)</span>&nbsp;<span class="ident" id="5315629">ast</span><span class="op" id="5315632">.</span><span class="ident" id="5315633">Expr</span>&nbsp;<span class="op" id="5315638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315641">switch</span>&nbsp;<span class="ident" id="5315648">p</span><span class="op" id="5315649">.</span><span class="ident" id="5315650">tok</span>&nbsp;<span class="op" id="5315654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315657">case</span>&nbsp;<span class="ident" id="5315662">token</span><span class="op" id="5315667">.</span><span class="ident" id="5315668">IDENT</span><span class="op" id="5315673">:</span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315677">return</span>&nbsp;<span class="ident" id="5315684">p</span><span class="op" id="5315685">.</span><span class="ident" id="5315686">parseTypeName</span><span class="op" id="5315699">(</span><span class="op" id="5315700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315703">case</span>&nbsp;<span class="ident" id="5315708">token</span><span class="op" id="5315713">.</span><span class="ident" id="5315714">LBRACK</span><span class="op" id="5315720">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315724">return</span>&nbsp;<span class="ident" id="5315731">p</span><span class="op" id="5315732">.</span><span class="ident" id="5315733">parseArrayType</span><span class="op" id="5315747">(</span><span class="op" id="5315748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315751">case</span>&nbsp;<span class="ident" id="5315756">token</span><span class="op" id="5315761">.</span><span class="ident" id="5315762">STRUCT</span><span class="op" id="5315768">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315772">return</span>&nbsp;<span class="ident" id="5315779">p</span><span class="op" id="5315780">.</span><span class="ident" id="5315781">parseStructType</span><span class="op" id="5315796">(</span><span class="op" id="5315797">)</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315800">case</span>&nbsp;<span class="ident" id="5315805">token</span><span class="op" id="5315810">.</span><span class="ident" id="5315811">MUL</span><span class="op" id="5315814">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315818">return</span>&nbsp;<span class="ident" id="5315825">p</span><span class="op" id="5315826">.</span><span class="ident" id="5315827">parsePointerType</span><span class="op" id="5315843">(</span><span class="op" id="5315844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315847">case</span>&nbsp;<span class="ident" id="5315852">token</span><span class="op" id="5315857">.</span><span class="ident" id="5315858">FUNC</span><span class="op" id="5315862">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5315866">typ</span><span class="op" id="5315869">,</span>&nbsp;<span class="ident" id="5315871">_</span>&nbsp;<span class="op" id="5315873">:=</span>&nbsp;<span class="ident" id="5315876">p</span><span class="op" id="5315877">.</span><span class="ident" id="5315878">parseFuncType</span><span class="op" id="5315891">(</span><span class="op" id="5315892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315896">return</span>&nbsp;<span class="ident" id="5315903">typ</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315908">case</span>&nbsp;<span class="ident" id="5315913">token</span><span class="op" id="5315918">.</span><span class="ident" id="5315919">INTERFACE</span><span class="op" id="5315928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315932">return</span>&nbsp;<span class="ident" id="5315939">p</span><span class="op" id="5315940">.</span><span class="ident" id="5315941">parseInterfaceType</span><span class="op" id="5315959">(</span><span class="op" id="5315960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315963">case</span>&nbsp;<span class="ident" id="5315968">token</span><span class="op" id="5315973">.</span><span class="ident" id="5315974">MAP</span><span class="op" id="5315977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5315981">return</span>&nbsp;<span class="ident" id="5315988">p</span><span class="op" id="5315989">.</span><span class="ident" id="5315990">parseMapType</span><span class="op" id="5316002">(</span><span class="op" id="5316003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316006">case</span>&nbsp;<span class="ident" id="5316011">token</span><span class="op" id="5316016">.</span><span class="ident" id="5316017">CHAN</span><span class="op" id="5316021">,</span>&nbsp;<span class="ident" id="5316023">token</span><span class="op" id="5316028">.</span><span class="ident" id="5316029">ARROW</span><span class="op" id="5316034">:</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316038">return</span>&nbsp;<span class="ident" id="5316045">p</span><span class="op" id="5316046">.</span><span class="ident" id="5316047">parseChanType</span><span class="op" id="5316060">(</span><span class="op" id="5316061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316064">case</span>&nbsp;<span class="ident" id="5316069">token</span><span class="op" id="5316074">.</span><span class="ident" id="5316075">LPAREN</span><span class="op" id="5316081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316085">lparen</span>&nbsp;<span class="op" id="5316092">:=</span>&nbsp;<span class="ident" id="5316095">p</span><span class="op" id="5316096">.</span><span class="ident" id="5316097">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316103">p</span><span class="op" id="5316104">.</span><span class="ident" id="5316105">next</span><span class="op" id="5316109">(</span><span class="op" id="5316110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316114">typ</span>&nbsp;<span class="op" id="5316118">:=</span>&nbsp;<span class="ident" id="5316121">p</span><span class="op" id="5316122">.</span><span class="ident" id="5316123">parseType</span><span class="op" id="5316132">(</span><span class="op" id="5316133">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316137">rparen</span>&nbsp;<span class="op" id="5316144">:=</span>&nbsp;<span class="ident" id="5316147">p</span><span class="op" id="5316148">.</span><span class="ident" id="5316149">expect</span><span class="op" id="5316155">(</span><span class="ident" id="5316156">token</span><span class="op" id="5316161">.</span><span class="ident" id="5316162">RPAREN</span><span class="op" id="5316168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316172">return</span>&nbsp;<span class="op" id="5316179">&amp;</span><span class="ident" id="5316180">ast</span><span class="op" id="5316183">.</span><span class="ident" id="5316184">ParenExpr</span><span class="op" id="5316193">{</span><span class="ident" id="5316194">Lparen</span><span class="op" id="5316200">:</span>&nbsp;<span class="ident" id="5316202">lparen</span><span class="op" id="5316208">,</span>&nbsp;<span class="ident" id="5316210">X</span><span class="op" id="5316211">:</span>&nbsp;<span class="ident" id="5316213">typ</span><span class="op" id="5316216">,</span>&nbsp;<span class="ident" id="5316218">Rparen</span><span class="op" id="5316224">:</span>&nbsp;<span class="ident" id="5316226">rparen</span><span class="op" id="5316232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316235">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5316239">//&nbsp;no&nbsp;type&nbsp;found</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316257">return</span>&nbsp;<span class="builtintype" id="5316264">nil</span><br>
<span class="lineno"></span><span class="op" id="5316268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316271">func</span>&nbsp;<span class="op" id="5316276">(</span><span class="ident" id="5316277">p</span>&nbsp;<span class="op" id="5316279">*</span><span class="ident" id="5316280">parser</span><span class="op" id="5316286">)</span>&nbsp;<span class="ident" id="5316288">tryType</span><span class="op" id="5316295">(</span><span class="op" id="5316296">)</span>&nbsp;<span class="ident" id="5316298">ast</span><span class="op" id="5316301">.</span><span class="ident" id="5316302">Expr</span>&nbsp;<span class="op" id="5316307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316310">typ</span>&nbsp;<span class="op" id="5316314">:=</span>&nbsp;<span class="ident" id="5316317">p</span><span class="op" id="5316318">.</span><span class="ident" id="5316319">tryIdentOrType</span><span class="op" id="5316333">(</span><span class="op" id="5316334">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316337">if</span>&nbsp;<span class="ident" id="5316340">typ</span>&nbsp;<span class="op" id="5316344">!=</span>&nbsp;<span class="builtintype" id="5316347">nil</span>&nbsp;<span class="op" id="5316351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316355">p</span><span class="op" id="5316356">.</span><span class="ident" id="5316357">resolve</span><span class="op" id="5316364">(</span><span class="ident" id="5316365">typ</span><span class="op" id="5316368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316374">return</span>&nbsp;<span class="ident" id="5316381">typ</span><br>
<span class="lineno"></span><span class="op" id="5316385">}</span><br>
<span class="lineno">1045</span><br>
<span class="lineno"></span><span class="comment" id="5316388">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5316468">//&nbsp;Blocks</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5316479">func</span>&nbsp;<span class="op" id="5316484">(</span><span class="ident" id="5316485">p</span>&nbsp;<span class="op" id="5316487">*</span><span class="ident" id="5316488">parser</span><span class="op" id="5316494">)</span>&nbsp;<span class="ident" id="5316496">parseStmtList</span><span class="op" id="5316509">(</span><span class="op" id="5316510">)</span>&nbsp;<span class="op" id="5316512">(</span><span class="ident" id="5316513">list</span>&nbsp;<span class="op" id="5316518">[</span><span class="op" id="5316519">]</span><span class="ident" id="5316520">ast</span><span class="op" id="5316523">.</span><span class="ident" id="5316524">Stmt</span><span class="op" id="5316528">)</span>&nbsp;<span class="op" id="5316530">{</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316533">if</span>&nbsp;<span class="ident" id="5316536">p</span><span class="op" id="5316537">.</span><span class="ident" id="5316538">trace</span>&nbsp;<span class="op" id="5316544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316548">defer</span>&nbsp;<span class="ident" id="5316554">un</span><span class="op" id="5316556">(</span><span class="ident" id="5316557">trace</span><span class="op" id="5316562">(</span><span class="ident" id="5316563">p</span><span class="op" id="5316564">,</span>&nbsp;<span class="string" id="5316566">&#34;StatementList&#34;</span><span class="op" id="5316581">)</span><span class="op" id="5316582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316585">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316589">for</span>&nbsp;<span class="ident" id="5316593">p</span><span class="op" id="5316594">.</span><span class="ident" id="5316595">tok</span>&nbsp;<span class="op" id="5316599">!=</span>&nbsp;<span class="ident" id="5316602">token</span><span class="op" id="5316607">.</span><span class="ident" id="5316608">CASE</span>&nbsp;<span class="op" id="5316613">&amp;&amp;</span>&nbsp;<span class="ident" id="5316616">p</span><span class="op" id="5316617">.</span><span class="ident" id="5316618">tok</span>&nbsp;<span class="op" id="5316622">!=</span>&nbsp;<span class="ident" id="5316625">token</span><span class="op" id="5316630">.</span><span class="ident" id="5316631">DEFAULT</span>&nbsp;<span class="op" id="5316639">&amp;&amp;</span>&nbsp;<span class="ident" id="5316642">p</span><span class="op" id="5316643">.</span><span class="ident" id="5316644">tok</span>&nbsp;<span class="op" id="5316648">!=</span>&nbsp;<span class="ident" id="5316651">token</span><span class="op" id="5316656">.</span><span class="ident" id="5316657">RBRACE</span>&nbsp;<span class="op" id="5316664">&amp;&amp;</span>&nbsp;<span class="ident" id="5316667">p</span><span class="op" id="5316668">.</span><span class="ident" id="5316669">tok</span>&nbsp;<span class="op" id="5316673">!=</span>&nbsp;<span class="ident" id="5316676">token</span><span class="op" id="5316681">.</span><span class="ident" id="5316682">EOF</span>&nbsp;<span class="op" id="5316686">{</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316690">list</span>&nbsp;<span class="op" id="5316695">=</span>&nbsp;<span class="builtinfunc" id="5316697">append</span><span class="op" id="5316703">(</span><span class="ident" id="5316704">list</span><span class="op" id="5316708">,</span>&nbsp;<span class="ident" id="5316710">p</span><span class="op" id="5316711">.</span><span class="ident" id="5316712">parseStmt</span><span class="op" id="5316721">(</span><span class="op" id="5316722">)</span><span class="op" id="5316723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316730">return</span><br>
<span class="lineno"></span><span class="op" id="5316737">}</span><br>
<span class="lineno">1060</span><br>
<span class="lineno"></span><span class="keyword" id="5316740">func</span>&nbsp;<span class="op" id="5316745">(</span><span class="ident" id="5316746">p</span>&nbsp;<span class="op" id="5316748">*</span><span class="ident" id="5316749">parser</span><span class="op" id="5316755">)</span>&nbsp;<span class="ident" id="5316757">parseBody</span><span class="op" id="5316766">(</span><span class="ident" id="5316767">scope</span>&nbsp;<span class="op" id="5316773">*</span><span class="ident" id="5316774">ast</span><span class="op" id="5316777">.</span><span class="ident" id="5316778">Scope</span><span class="op" id="5316783">)</span>&nbsp;<span class="op" id="5316785">*</span><span class="ident" id="5316786">ast</span><span class="op" id="5316789">.</span><span class="ident" id="5316790">BlockStmt</span>&nbsp;<span class="op" id="5316800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316803">if</span>&nbsp;<span class="ident" id="5316806">p</span><span class="op" id="5316807">.</span><span class="ident" id="5316808">trace</span>&nbsp;<span class="op" id="5316814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5316818">defer</span>&nbsp;<span class="ident" id="5316824">un</span><span class="op" id="5316826">(</span><span class="ident" id="5316827">trace</span><span class="op" id="5316832">(</span><span class="ident" id="5316833">p</span><span class="op" id="5316834">,</span>&nbsp;<span class="string" id="5316836">&#34;Body&#34;</span><span class="op" id="5316842">)</span><span class="op" id="5316843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5316846">}</span><br>
<span class="lineno">1065</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316850">lbrace</span>&nbsp;<span class="op" id="5316857">:=</span>&nbsp;<span class="ident" id="5316860">p</span><span class="op" id="5316861">.</span><span class="ident" id="5316862">expect</span><span class="op" id="5316868">(</span><span class="ident" id="5316869">token</span><span class="op" id="5316874">.</span><span class="ident" id="5316875">LBRACE</span><span class="op" id="5316881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316884">p</span><span class="op" id="5316885">.</span><span class="ident" id="5316886">topScope</span>&nbsp;<span class="op" id="5316895">=</span>&nbsp;<span class="ident" id="5316897">scope</span>&nbsp;<span class="comment" id="5316903">//&nbsp;open&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316927">p</span><span class="op" id="5316928">.</span><span class="ident" id="5316929">openLabelScope</span><span class="op" id="5316943">(</span><span class="op" id="5316944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316947">list</span>&nbsp;<span class="op" id="5316952">:=</span>&nbsp;<span class="ident" id="5316955">p</span><span class="op" id="5316956">.</span><span class="ident" id="5316957">parseStmtList</span><span class="op" id="5316970">(</span><span class="op" id="5316971">)</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316974">p</span><span class="op" id="5316975">.</span><span class="ident" id="5316976">closeLabelScope</span><span class="op" id="5316991">(</span><span class="op" id="5316992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5316995">p</span><span class="op" id="5316996">.</span><span class="ident" id="5316997">closeScope</span><span class="op" id="5317007">(</span><span class="op" id="5317008">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317011">rbrace</span>&nbsp;<span class="op" id="5317018">:=</span>&nbsp;<span class="ident" id="5317021">p</span><span class="op" id="5317022">.</span><span class="ident" id="5317023">expect</span><span class="op" id="5317029">(</span><span class="ident" id="5317030">token</span><span class="op" id="5317035">.</span><span class="ident" id="5317036">RBRACE</span><span class="op" id="5317042">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317046">return</span>&nbsp;<span class="op" id="5317053">&amp;</span><span class="ident" id="5317054">ast</span><span class="op" id="5317057">.</span><span class="ident" id="5317058">BlockStmt</span><span class="op" id="5317067">{</span><span class="ident" id="5317068">Lbrace</span><span class="op" id="5317074">:</span>&nbsp;<span class="ident" id="5317076">lbrace</span><span class="op" id="5317082">,</span>&nbsp;<span class="ident" id="5317084">List</span><span class="op" id="5317088">:</span>&nbsp;<span class="ident" id="5317090">list</span><span class="op" id="5317094">,</span>&nbsp;<span class="ident" id="5317096">Rbrace</span><span class="op" id="5317102">:</span>&nbsp;<span class="ident" id="5317104">rbrace</span><span class="op" id="5317110">}</span><br>
<span class="lineno">1075</span><span class="op" id="5317112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5317115">func</span>&nbsp;<span class="op" id="5317120">(</span><span class="ident" id="5317121">p</span>&nbsp;<span class="op" id="5317123">*</span><span class="ident" id="5317124">parser</span><span class="op" id="5317130">)</span>&nbsp;<span class="ident" id="5317132">parseBlockStmt</span><span class="op" id="5317146">(</span><span class="op" id="5317147">)</span>&nbsp;<span class="op" id="5317149">*</span><span class="ident" id="5317150">ast</span><span class="op" id="5317153">.</span><span class="ident" id="5317154">BlockStmt</span>&nbsp;<span class="op" id="5317164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317167">if</span>&nbsp;<span class="ident" id="5317170">p</span><span class="op" id="5317171">.</span><span class="ident" id="5317172">trace</span>&nbsp;<span class="op" id="5317178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317182">defer</span>&nbsp;<span class="ident" id="5317188">un</span><span class="op" id="5317190">(</span><span class="ident" id="5317191">trace</span><span class="op" id="5317196">(</span><span class="ident" id="5317197">p</span><span class="op" id="5317198">,</span>&nbsp;<span class="string" id="5317200">&#34;BlockStmt&#34;</span><span class="op" id="5317211">)</span><span class="op" id="5317212">)</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5317215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317219">lbrace</span>&nbsp;<span class="op" id="5317226">:=</span>&nbsp;<span class="ident" id="5317229">p</span><span class="op" id="5317230">.</span><span class="ident" id="5317231">expect</span><span class="op" id="5317237">(</span><span class="ident" id="5317238">token</span><span class="op" id="5317243">.</span><span class="ident" id="5317244">LBRACE</span><span class="op" id="5317250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317253">p</span><span class="op" id="5317254">.</span><span class="ident" id="5317255">openScope</span><span class="op" id="5317264">(</span><span class="op" id="5317265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317268">list</span>&nbsp;<span class="op" id="5317273">:=</span>&nbsp;<span class="ident" id="5317276">p</span><span class="op" id="5317277">.</span><span class="ident" id="5317278">parseStmtList</span><span class="op" id="5317291">(</span><span class="op" id="5317292">)</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317295">p</span><span class="op" id="5317296">.</span><span class="ident" id="5317297">closeScope</span><span class="op" id="5317307">(</span><span class="op" id="5317308">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317311">rbrace</span>&nbsp;<span class="op" id="5317318">:=</span>&nbsp;<span class="ident" id="5317321">p</span><span class="op" id="5317322">.</span><span class="ident" id="5317323">expect</span><span class="op" id="5317329">(</span><span class="ident" id="5317330">token</span><span class="op" id="5317335">.</span><span class="ident" id="5317336">RBRACE</span><span class="op" id="5317342">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317346">return</span>&nbsp;<span class="op" id="5317353">&amp;</span><span class="ident" id="5317354">ast</span><span class="op" id="5317357">.</span><span class="ident" id="5317358">BlockStmt</span><span class="op" id="5317367">{</span><span class="ident" id="5317368">Lbrace</span><span class="op" id="5317374">:</span>&nbsp;<span class="ident" id="5317376">lbrace</span><span class="op" id="5317382">,</span>&nbsp;<span class="ident" id="5317384">List</span><span class="op" id="5317388">:</span>&nbsp;<span class="ident" id="5317390">list</span><span class="op" id="5317394">,</span>&nbsp;<span class="ident" id="5317396">Rbrace</span><span class="op" id="5317402">:</span>&nbsp;<span class="ident" id="5317404">rbrace</span><span class="op" id="5317410">}</span><br>
<span class="lineno"></span><span class="op" id="5317412">}</span><br>
<span class="lineno">1090</span><br>
<span class="lineno"></span><span class="comment" id="5317415">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5317495">//&nbsp;Expressions</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5317511">func</span>&nbsp;<span class="op" id="5317516">(</span><span class="ident" id="5317517">p</span>&nbsp;<span class="op" id="5317519">*</span><span class="ident" id="5317520">parser</span><span class="op" id="5317526">)</span>&nbsp;<span class="ident" id="5317528">parseFuncTypeOrLit</span><span class="op" id="5317546">(</span><span class="op" id="5317547">)</span>&nbsp;<span class="ident" id="5317549">ast</span><span class="op" id="5317552">.</span><span class="ident" id="5317553">Expr</span>&nbsp;<span class="op" id="5317558">{</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317561">if</span>&nbsp;<span class="ident" id="5317564">p</span><span class="op" id="5317565">.</span><span class="ident" id="5317566">trace</span>&nbsp;<span class="op" id="5317572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317576">defer</span>&nbsp;<span class="ident" id="5317582">un</span><span class="op" id="5317584">(</span><span class="ident" id="5317585">trace</span><span class="op" id="5317590">(</span><span class="ident" id="5317591">p</span><span class="op" id="5317592">,</span>&nbsp;<span class="string" id="5317594">&#34;FuncTypeOrLit&#34;</span><span class="op" id="5317609">)</span><span class="op" id="5317610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5317613">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317617">typ</span><span class="op" id="5317620">,</span>&nbsp;<span class="ident" id="5317622">scope</span>&nbsp;<span class="op" id="5317628">:=</span>&nbsp;<span class="ident" id="5317631">p</span><span class="op" id="5317632">.</span><span class="ident" id="5317633">parseFuncType</span><span class="op" id="5317646">(</span><span class="op" id="5317647">)</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317650">if</span>&nbsp;<span class="ident" id="5317653">p</span><span class="op" id="5317654">.</span><span class="ident" id="5317655">tok</span>&nbsp;<span class="op" id="5317659">!=</span>&nbsp;<span class="ident" id="5317662">token</span><span class="op" id="5317667">.</span><span class="ident" id="5317668">LBRACE</span>&nbsp;<span class="op" id="5317675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5317679">//&nbsp;function&nbsp;type&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317703">return</span>&nbsp;<span class="ident" id="5317710">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5317715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317719">p</span><span class="op" id="5317720">.</span><span class="ident" id="5317721">exprLev</span><span class="op" id="5317728">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317732">body</span>&nbsp;<span class="op" id="5317737">:=</span>&nbsp;<span class="ident" id="5317740">p</span><span class="op" id="5317741">.</span><span class="ident" id="5317742">parseBody</span><span class="op" id="5317751">(</span><span class="ident" id="5317752">scope</span><span class="op" id="5317757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5317760">p</span><span class="op" id="5317761">.</span><span class="ident" id="5317762">exprLev</span><span class="op" id="5317769">--</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5317774">return</span>&nbsp;<span class="op" id="5317781">&amp;</span><span class="ident" id="5317782">ast</span><span class="op" id="5317785">.</span><span class="ident" id="5317786">FuncLit</span><span class="op" id="5317793">{</span><span class="ident" id="5317794">Type</span><span class="op" id="5317798">:</span>&nbsp;<span class="ident" id="5317800">typ</span><span class="op" id="5317803">,</span>&nbsp;<span class="ident" id="5317805">Body</span><span class="op" id="5317809">:</span>&nbsp;<span class="ident" id="5317811">body</span><span class="op" id="5317815">}</span><br>
<span class="lineno">1110</span><span class="op" id="5317817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5317820">//&nbsp;parseOperand&nbsp;may&nbsp;return&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;raw&nbsp;type&nbsp;(incl.&nbsp;array</span><br>
<span class="lineno"></span><span class="comment" id="5317888">//&nbsp;types&nbsp;of&nbsp;the&nbsp;form&nbsp;[...]T.&nbsp;Callers&nbsp;must&nbsp;verify&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="comment" id="5317949">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1115</span><span class="comment" id="5318019">//</span><br>
<span class="lineno"></span><span class="keyword" id="5318022">func</span>&nbsp;<span class="op" id="5318027">(</span><span class="ident" id="5318028">p</span>&nbsp;<span class="op" id="5318030">*</span><span class="ident" id="5318031">parser</span><span class="op" id="5318037">)</span>&nbsp;<span class="ident" id="5318039">parseOperand</span><span class="op" id="5318051">(</span><span class="ident" id="5318052">lhs</span>&nbsp;<span class="builtintype" id="5318056">bool</span><span class="op" id="5318060">)</span>&nbsp;<span class="ident" id="5318062">ast</span><span class="op" id="5318065">.</span><span class="ident" id="5318066">Expr</span>&nbsp;<span class="op" id="5318071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318074">if</span>&nbsp;<span class="ident" id="5318077">p</span><span class="op" id="5318078">.</span><span class="ident" id="5318079">trace</span>&nbsp;<span class="op" id="5318085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318089">defer</span>&nbsp;<span class="ident" id="5318095">un</span><span class="op" id="5318097">(</span><span class="ident" id="5318098">trace</span><span class="op" id="5318103">(</span><span class="ident" id="5318104">p</span><span class="op" id="5318105">,</span>&nbsp;<span class="string" id="5318107">&#34;Operand&#34;</span><span class="op" id="5318116">)</span><span class="op" id="5318117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5318120">}</span><br>
<span class="lineno">1120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318124">switch</span>&nbsp;<span class="ident" id="5318131">p</span><span class="op" id="5318132">.</span><span class="ident" id="5318133">tok</span>&nbsp;<span class="op" id="5318137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318140">case</span>&nbsp;<span class="ident" id="5318145">token</span><span class="op" id="5318150">.</span><span class="ident" id="5318151">IDENT</span><span class="op" id="5318156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318160">x</span>&nbsp;<span class="op" id="5318162">:=</span>&nbsp;<span class="ident" id="5318165">p</span><span class="op" id="5318166">.</span><span class="ident" id="5318167">parseIdent</span><span class="op" id="5318177">(</span><span class="op" id="5318178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318182">if</span>&nbsp;<span class="op" id="5318185">!</span><span class="ident" id="5318186">lhs</span>&nbsp;<span class="op" id="5318190">{</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318195">p</span><span class="op" id="5318196">.</span><span class="ident" id="5318197">resolve</span><span class="op" id="5318204">(</span><span class="ident" id="5318205">x</span><span class="op" id="5318206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5318210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318214">return</span>&nbsp;<span class="ident" id="5318221">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318225">case</span>&nbsp;<span class="ident" id="5318230">token</span><span class="op" id="5318235">.</span><span class="ident" id="5318236">INT</span><span class="op" id="5318239">,</span>&nbsp;<span class="ident" id="5318241">token</span><span class="op" id="5318246">.</span><span class="ident" id="5318247">FLOAT</span><span class="op" id="5318252">,</span>&nbsp;<span class="ident" id="5318254">token</span><span class="op" id="5318259">.</span><span class="ident" id="5318260">IMAG</span><span class="op" id="5318264">,</span>&nbsp;<span class="ident" id="5318266">token</span><span class="op" id="5318271">.</span><span class="ident" id="5318272">CHAR</span><span class="op" id="5318276">,</span>&nbsp;<span class="ident" id="5318278">token</span><span class="op" id="5318283">.</span><span class="ident" id="5318284">STRING</span><span class="op" id="5318290">:</span><br>
<span class="lineno">1130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318294">x</span>&nbsp;<span class="op" id="5318296">:=</span>&nbsp;<span class="op" id="5318299">&amp;</span><span class="ident" id="5318300">ast</span><span class="op" id="5318303">.</span><span class="ident" id="5318304">BasicLit</span><span class="op" id="5318312">{</span><span class="ident" id="5318313">ValuePos</span><span class="op" id="5318321">:</span>&nbsp;<span class="ident" id="5318323">p</span><span class="op" id="5318324">.</span><span class="ident" id="5318325">pos</span><span class="op" id="5318328">,</span>&nbsp;<span class="ident" id="5318330">Kind</span><span class="op" id="5318334">:</span>&nbsp;<span class="ident" id="5318336">p</span><span class="op" id="5318337">.</span><span class="ident" id="5318338">tok</span><span class="op" id="5318341">,</span>&nbsp;<span class="ident" id="5318343">Value</span><span class="op" id="5318348">:</span>&nbsp;<span class="ident" id="5318350">p</span><span class="op" id="5318351">.</span><span class="ident" id="5318352">lit</span><span class="op" id="5318355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318359">p</span><span class="op" id="5318360">.</span><span class="ident" id="5318361">next</span><span class="op" id="5318365">(</span><span class="op" id="5318366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318370">return</span>&nbsp;<span class="ident" id="5318377">x</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318381">case</span>&nbsp;<span class="ident" id="5318386">token</span><span class="op" id="5318391">.</span><span class="ident" id="5318392">LPAREN</span><span class="op" id="5318398">:</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318402">lparen</span>&nbsp;<span class="op" id="5318409">:=</span>&nbsp;<span class="ident" id="5318412">p</span><span class="op" id="5318413">.</span><span class="ident" id="5318414">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318420">p</span><span class="op" id="5318421">.</span><span class="ident" id="5318422">next</span><span class="op" id="5318426">(</span><span class="op" id="5318427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318431">p</span><span class="op" id="5318432">.</span><span class="ident" id="5318433">exprLev</span><span class="op" id="5318440">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318445">x</span>&nbsp;<span class="op" id="5318447">:=</span>&nbsp;<span class="ident" id="5318450">p</span><span class="op" id="5318451">.</span><span class="ident" id="5318452">parseRhsOrType</span><span class="op" id="5318466">(</span><span class="op" id="5318467">)</span>&nbsp;<span class="comment" id="5318469">//&nbsp;types&nbsp;may&nbsp;be&nbsp;parenthesized:&nbsp;(some&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318514">p</span><span class="op" id="5318515">.</span><span class="ident" id="5318516">exprLev</span><span class="op" id="5318523">--</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318528">rparen</span>&nbsp;<span class="op" id="5318535">:=</span>&nbsp;<span class="ident" id="5318538">p</span><span class="op" id="5318539">.</span><span class="ident" id="5318540">expect</span><span class="op" id="5318546">(</span><span class="ident" id="5318547">token</span><span class="op" id="5318552">.</span><span class="ident" id="5318553">RPAREN</span><span class="op" id="5318559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318563">return</span>&nbsp;<span class="op" id="5318570">&amp;</span><span class="ident" id="5318571">ast</span><span class="op" id="5318574">.</span><span class="ident" id="5318575">ParenExpr</span><span class="op" id="5318584">{</span><span class="ident" id="5318585">Lparen</span><span class="op" id="5318591">:</span>&nbsp;<span class="ident" id="5318593">lparen</span><span class="op" id="5318599">,</span>&nbsp;<span class="ident" id="5318601">X</span><span class="op" id="5318602">:</span>&nbsp;<span class="ident" id="5318604">x</span><span class="op" id="5318605">,</span>&nbsp;<span class="ident" id="5318607">Rparen</span><span class="op" id="5318613">:</span>&nbsp;<span class="ident" id="5318615">rparen</span><span class="op" id="5318621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318625">case</span>&nbsp;<span class="ident" id="5318630">token</span><span class="op" id="5318635">.</span><span class="ident" id="5318636">FUNC</span><span class="op" id="5318640">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318644">return</span>&nbsp;<span class="ident" id="5318651">p</span><span class="op" id="5318652">.</span><span class="ident" id="5318653">parseFuncTypeOrLit</span><span class="op" id="5318671">(</span><span class="op" id="5318672">)</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5318675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318679">if</span>&nbsp;<span class="ident" id="5318682">typ</span>&nbsp;<span class="op" id="5318686">:=</span>&nbsp;<span class="ident" id="5318689">p</span><span class="op" id="5318690">.</span><span class="ident" id="5318691">tryIdentOrType</span><span class="op" id="5318705">(</span><span class="op" id="5318706">)</span><span class="op" id="5318707">;</span>&nbsp;<span class="ident" id="5318709">typ</span>&nbsp;<span class="op" id="5318713">!=</span>&nbsp;<span class="builtintype" id="5318716">nil</span>&nbsp;<span class="op" id="5318720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5318724">//&nbsp;could&nbsp;be&nbsp;type&nbsp;for&nbsp;composite&nbsp;literal&nbsp;or&nbsp;conversion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318779">_</span><span class="op" id="5318780">,</span>&nbsp;<span class="ident" id="5318782">isIdent</span>&nbsp;<span class="op" id="5318790">:=</span>&nbsp;<span class="ident" id="5318793">typ</span><span class="op" id="5318796">.</span><span class="op" id="5318797">(</span><span class="op" id="5318798">*</span><span class="ident" id="5318799">ast</span><span class="op" id="5318802">.</span><span class="ident" id="5318803">Ident</span><span class="op" id="5318808">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318812">assert</span><span class="op" id="5318818">(</span><span class="op" id="5318819">!</span><span class="ident" id="5318820">isIdent</span><span class="op" id="5318827">,</span>&nbsp;<span class="string" id="5318829">&#34;type&nbsp;cannot&nbsp;be&nbsp;identifier&#34;</span><span class="op" id="5318856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318860">return</span>&nbsp;<span class="ident" id="5318867">typ</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5318872">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5318876">//&nbsp;we&nbsp;have&nbsp;an&nbsp;error</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318897">pos</span>&nbsp;<span class="op" id="5318901">:=</span>&nbsp;<span class="ident" id="5318904">p</span><span class="op" id="5318905">.</span><span class="ident" id="5318906">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318911">p</span><span class="op" id="5318912">.</span><span class="ident" id="5318913">errorExpected</span><span class="op" id="5318926">(</span><span class="ident" id="5318927">pos</span><span class="op" id="5318930">,</span>&nbsp;<span class="string" id="5318932">&#34;operand&#34;</span><span class="op" id="5318941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5318944">syncStmt</span><span class="op" id="5318952">(</span><span class="ident" id="5318953">p</span><span class="op" id="5318954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5318957">return</span>&nbsp;<span class="op" id="5318964">&amp;</span><span class="ident" id="5318965">ast</span><span class="op" id="5318968">.</span><span class="ident" id="5318969">BadExpr</span><span class="op" id="5318976">{</span><span class="ident" id="5318977">From</span><span class="op" id="5318981">:</span>&nbsp;<span class="ident" id="5318983">pos</span><span class="op" id="5318986">,</span>&nbsp;<span class="ident" id="5318988">To</span><span class="op" id="5318990">:</span>&nbsp;<span class="ident" id="5318992">p</span><span class="op" id="5318993">.</span><span class="ident" id="5318994">pos</span><span class="op" id="5318997">}</span><br>
<span class="lineno"></span><span class="op" id="5318999">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span><span class="keyword" id="5319002">func</span>&nbsp;<span class="op" id="5319007">(</span><span class="ident" id="5319008">p</span>&nbsp;<span class="op" id="5319010">*</span><span class="ident" id="5319011">parser</span><span class="op" id="5319017">)</span>&nbsp;<span class="ident" id="5319019">parseSelector</span><span class="op" id="5319032">(</span><span class="ident" id="5319033">x</span>&nbsp;<span class="ident" id="5319035">ast</span><span class="op" id="5319038">.</span><span class="ident" id="5319039">Expr</span><span class="op" id="5319043">)</span>&nbsp;<span class="ident" id="5319045">ast</span><span class="op" id="5319048">.</span><span class="ident" id="5319049">Expr</span>&nbsp;<span class="op" id="5319054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319057">if</span>&nbsp;<span class="ident" id="5319060">p</span><span class="op" id="5319061">.</span><span class="ident" id="5319062">trace</span>&nbsp;<span class="op" id="5319068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319072">defer</span>&nbsp;<span class="ident" id="5319078">un</span><span class="op" id="5319080">(</span><span class="ident" id="5319081">trace</span><span class="op" id="5319086">(</span><span class="ident" id="5319087">p</span><span class="op" id="5319088">,</span>&nbsp;<span class="string" id="5319090">&#34;Selector&#34;</span><span class="op" id="5319100">)</span><span class="op" id="5319101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319104">}</span><br>
<span class="lineno">1165</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319108">sel</span>&nbsp;<span class="op" id="5319112">:=</span>&nbsp;<span class="ident" id="5319115">p</span><span class="op" id="5319116">.</span><span class="ident" id="5319117">parseIdent</span><span class="op" id="5319127">(</span><span class="op" id="5319128">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319132">return</span>&nbsp;<span class="op" id="5319139">&amp;</span><span class="ident" id="5319140">ast</span><span class="op" id="5319143">.</span><span class="ident" id="5319144">SelectorExpr</span><span class="op" id="5319156">{</span><span class="ident" id="5319157">X</span><span class="op" id="5319158">:</span>&nbsp;<span class="ident" id="5319160">x</span><span class="op" id="5319161">,</span>&nbsp;<span class="ident" id="5319163">Sel</span><span class="op" id="5319166">:</span>&nbsp;<span class="ident" id="5319168">sel</span><span class="op" id="5319171">}</span><br>
<span class="lineno"></span><span class="op" id="5319173">}</span><br>
<span class="lineno">1170</span><br>
<span class="lineno"></span><span class="keyword" id="5319176">func</span>&nbsp;<span class="op" id="5319181">(</span><span class="ident" id="5319182">p</span>&nbsp;<span class="op" id="5319184">*</span><span class="ident" id="5319185">parser</span><span class="op" id="5319191">)</span>&nbsp;<span class="ident" id="5319193">parseTypeAssertion</span><span class="op" id="5319211">(</span><span class="ident" id="5319212">x</span>&nbsp;<span class="ident" id="5319214">ast</span><span class="op" id="5319217">.</span><span class="ident" id="5319218">Expr</span><span class="op" id="5319222">)</span>&nbsp;<span class="ident" id="5319224">ast</span><span class="op" id="5319227">.</span><span class="ident" id="5319228">Expr</span>&nbsp;<span class="op" id="5319233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319236">if</span>&nbsp;<span class="ident" id="5319239">p</span><span class="op" id="5319240">.</span><span class="ident" id="5319241">trace</span>&nbsp;<span class="op" id="5319247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319251">defer</span>&nbsp;<span class="ident" id="5319257">un</span><span class="op" id="5319259">(</span><span class="ident" id="5319260">trace</span><span class="op" id="5319265">(</span><span class="ident" id="5319266">p</span><span class="op" id="5319267">,</span>&nbsp;<span class="string" id="5319269">&#34;TypeAssertion&#34;</span><span class="op" id="5319284">)</span><span class="op" id="5319285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319288">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319292">lparen</span>&nbsp;<span class="op" id="5319299">:=</span>&nbsp;<span class="ident" id="5319302">p</span><span class="op" id="5319303">.</span><span class="ident" id="5319304">expect</span><span class="op" id="5319310">(</span><span class="ident" id="5319311">token</span><span class="op" id="5319316">.</span><span class="ident" id="5319317">LPAREN</span><span class="op" id="5319323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319326">var</span>&nbsp;<span class="ident" id="5319330">typ</span>&nbsp;<span class="ident" id="5319334">ast</span><span class="op" id="5319337">.</span><span class="ident" id="5319338">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319344">if</span>&nbsp;<span class="ident" id="5319347">p</span><span class="op" id="5319348">.</span><span class="ident" id="5319349">tok</span>&nbsp;<span class="op" id="5319353">==</span>&nbsp;<span class="ident" id="5319356">token</span><span class="op" id="5319361">.</span><span class="ident" id="5319362">TYPE</span>&nbsp;<span class="op" id="5319367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5319371">//&nbsp;type&nbsp;switch:&nbsp;typ&nbsp;==&nbsp;nil</span><br>
<span class="lineno">1180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319400">p</span><span class="op" id="5319401">.</span><span class="ident" id="5319402">next</span><span class="op" id="5319406">(</span><span class="op" id="5319407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319410">}</span>&nbsp;<span class="keyword" id="5319412">else</span>&nbsp;<span class="op" id="5319417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319421">typ</span>&nbsp;<span class="op" id="5319425">=</span>&nbsp;<span class="ident" id="5319427">p</span><span class="op" id="5319428">.</span><span class="ident" id="5319429">parseType</span><span class="op" id="5319438">(</span><span class="op" id="5319439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319445">rparen</span>&nbsp;<span class="op" id="5319452">:=</span>&nbsp;<span class="ident" id="5319455">p</span><span class="op" id="5319456">.</span><span class="ident" id="5319457">expect</span><span class="op" id="5319463">(</span><span class="ident" id="5319464">token</span><span class="op" id="5319469">.</span><span class="ident" id="5319470">RPAREN</span><span class="op" id="5319476">)</span><br>
<span class="lineno">1185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319480">return</span>&nbsp;<span class="op" id="5319487">&amp;</span><span class="ident" id="5319488">ast</span><span class="op" id="5319491">.</span><span class="ident" id="5319492">TypeAssertExpr</span><span class="op" id="5319506">{</span><span class="ident" id="5319507">X</span><span class="op" id="5319508">:</span>&nbsp;<span class="ident" id="5319510">x</span><span class="op" id="5319511">,</span>&nbsp;<span class="ident" id="5319513">Type</span><span class="op" id="5319517">:</span>&nbsp;<span class="ident" id="5319519">typ</span><span class="op" id="5319522">,</span>&nbsp;<span class="ident" id="5319524">Lparen</span><span class="op" id="5319530">:</span>&nbsp;<span class="ident" id="5319532">lparen</span><span class="op" id="5319538">,</span>&nbsp;<span class="ident" id="5319540">Rparen</span><span class="op" id="5319546">:</span>&nbsp;<span class="ident" id="5319548">rparen</span><span class="op" id="5319554">}</span><br>
<span class="lineno"></span><span class="op" id="5319556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5319559">func</span>&nbsp;<span class="op" id="5319564">(</span><span class="ident" id="5319565">p</span>&nbsp;<span class="op" id="5319567">*</span><span class="ident" id="5319568">parser</span><span class="op" id="5319574">)</span>&nbsp;<span class="ident" id="5319576">parseIndexOrSlice</span><span class="op" id="5319593">(</span><span class="ident" id="5319594">x</span>&nbsp;<span class="ident" id="5319596">ast</span><span class="op" id="5319599">.</span><span class="ident" id="5319600">Expr</span><span class="op" id="5319604">)</span>&nbsp;<span class="ident" id="5319606">ast</span><span class="op" id="5319609">.</span><span class="ident" id="5319610">Expr</span>&nbsp;<span class="op" id="5319615">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319618">if</span>&nbsp;<span class="ident" id="5319621">p</span><span class="op" id="5319622">.</span><span class="ident" id="5319623">trace</span>&nbsp;<span class="op" id="5319629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319633">defer</span>&nbsp;<span class="ident" id="5319639">un</span><span class="op" id="5319641">(</span><span class="ident" id="5319642">trace</span><span class="op" id="5319647">(</span><span class="ident" id="5319648">p</span><span class="op" id="5319649">,</span>&nbsp;<span class="string" id="5319651">&#34;IndexOrSlice&#34;</span><span class="op" id="5319665">)</span><span class="op" id="5319666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319673">const</span>&nbsp;<span class="ident" id="5319679">N</span>&nbsp;<span class="op" id="5319681">=</span>&nbsp;<span class="num" id="5319683">3</span>&nbsp;<span class="comment" id="5319685">//&nbsp;change&nbsp;the&nbsp;3&nbsp;to&nbsp;2&nbsp;to&nbsp;disable&nbsp;3-index&nbsp;slices</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319733">lbrack</span>&nbsp;<span class="op" id="5319740">:=</span>&nbsp;<span class="ident" id="5319743">p</span><span class="op" id="5319744">.</span><span class="ident" id="5319745">expect</span><span class="op" id="5319751">(</span><span class="ident" id="5319752">token</span><span class="op" id="5319757">.</span><span class="ident" id="5319758">LBRACK</span><span class="op" id="5319764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319767">p</span><span class="op" id="5319768">.</span><span class="ident" id="5319769">exprLev</span><span class="op" id="5319776">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319780">var</span>&nbsp;<span class="ident" id="5319784">index</span>&nbsp;<span class="op" id="5319790">[</span><span class="ident" id="5319791">N</span><span class="op" id="5319792">]</span><span class="ident" id="5319793">ast</span><span class="op" id="5319796">.</span><span class="ident" id="5319797">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319803">var</span>&nbsp;<span class="ident" id="5319807">colons</span>&nbsp;<span class="op" id="5319814">[</span><span class="ident" id="5319815">N</span>&nbsp;<span class="op" id="5319817">-</span>&nbsp;<span class="num" id="5319819">1</span><span class="op" id="5319820">]</span><span class="ident" id="5319821">token</span><span class="op" id="5319826">.</span><span class="ident" id="5319827">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319832">if</span>&nbsp;<span class="ident" id="5319835">p</span><span class="op" id="5319836">.</span><span class="ident" id="5319837">tok</span>&nbsp;<span class="op" id="5319841">!=</span>&nbsp;<span class="ident" id="5319844">token</span><span class="op" id="5319849">.</span><span class="ident" id="5319850">COLON</span>&nbsp;<span class="op" id="5319856">{</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319860">index</span><span class="op" id="5319865">[</span><span class="num" id="5319866">0</span><span class="op" id="5319867">]</span>&nbsp;<span class="op" id="5319869">=</span>&nbsp;<span class="ident" id="5319871">p</span><span class="op" id="5319872">.</span><span class="ident" id="5319873">parseRhs</span><span class="op" id="5319881">(</span><span class="op" id="5319882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5319885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319888">ncolons</span>&nbsp;<span class="op" id="5319896">:=</span>&nbsp;<span class="num" id="5319899">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5319902">for</span>&nbsp;<span class="ident" id="5319906">p</span><span class="op" id="5319907">.</span><span class="ident" id="5319908">tok</span>&nbsp;<span class="op" id="5319912">==</span>&nbsp;<span class="ident" id="5319915">token</span><span class="op" id="5319920">.</span><span class="ident" id="5319921">COLON</span>&nbsp;<span class="op" id="5319927">&amp;&amp;</span>&nbsp;<span class="ident" id="5319930">ncolons</span>&nbsp;<span class="op" id="5319938">&lt;</span>&nbsp;<span class="builtinfunc" id="5319940">len</span><span class="op" id="5319943">(</span><span class="ident" id="5319944">colons</span><span class="op" id="5319950">)</span>&nbsp;<span class="op" id="5319952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319956">colons</span><span class="op" id="5319962">[</span><span class="ident" id="5319963">ncolons</span><span class="op" id="5319970">]</span>&nbsp;<span class="op" id="5319972">=</span>&nbsp;<span class="ident" id="5319974">p</span><span class="op" id="5319975">.</span><span class="ident" id="5319976">pos</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319982">ncolons</span><span class="op" id="5319989">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5319994">p</span><span class="op" id="5319995">.</span><span class="ident" id="5319996">next</span><span class="op" id="5320000">(</span><span class="op" id="5320001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320005">if</span>&nbsp;<span class="ident" id="5320008">p</span><span class="op" id="5320009">.</span><span class="ident" id="5320010">tok</span>&nbsp;<span class="op" id="5320014">!=</span>&nbsp;<span class="ident" id="5320017">token</span><span class="op" id="5320022">.</span><span class="ident" id="5320023">COLON</span>&nbsp;<span class="op" id="5320029">&amp;&amp;</span>&nbsp;<span class="ident" id="5320032">p</span><span class="op" id="5320033">.</span><span class="ident" id="5320034">tok</span>&nbsp;<span class="op" id="5320038">!=</span>&nbsp;<span class="ident" id="5320041">token</span><span class="op" id="5320046">.</span><span class="ident" id="5320047">RBRACK</span>&nbsp;<span class="op" id="5320054">&amp;&amp;</span>&nbsp;<span class="ident" id="5320057">p</span><span class="op" id="5320058">.</span><span class="ident" id="5320059">tok</span>&nbsp;<span class="op" id="5320063">!=</span>&nbsp;<span class="ident" id="5320066">token</span><span class="op" id="5320071">.</span><span class="ident" id="5320072">EOF</span>&nbsp;<span class="op" id="5320076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320081">index</span><span class="op" id="5320086">[</span><span class="ident" id="5320087">ncolons</span><span class="op" id="5320094">]</span>&nbsp;<span class="op" id="5320096">=</span>&nbsp;<span class="ident" id="5320098">p</span><span class="op" id="5320099">.</span><span class="ident" id="5320100">parseRhs</span><span class="op" id="5320108">(</span><span class="op" id="5320109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320113">}</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320119">p</span><span class="op" id="5320120">.</span><span class="ident" id="5320121">exprLev</span><span class="op" id="5320128">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320132">rbrack</span>&nbsp;<span class="op" id="5320139">:=</span>&nbsp;<span class="ident" id="5320142">p</span><span class="op" id="5320143">.</span><span class="ident" id="5320144">expect</span><span class="op" id="5320150">(</span><span class="ident" id="5320151">token</span><span class="op" id="5320156">.</span><span class="ident" id="5320157">RBRACK</span><span class="op" id="5320163">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320167">if</span>&nbsp;<span class="ident" id="5320170">ncolons</span>&nbsp;<span class="op" id="5320178">&gt;</span>&nbsp;<span class="num" id="5320180">0</span>&nbsp;<span class="op" id="5320182">{</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320186">//&nbsp;slice&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320208">slice3</span>&nbsp;<span class="op" id="5320215">:=</span>&nbsp;<span class="builtintype" id="5320218">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320226">if</span>&nbsp;<span class="ident" id="5320229">ncolons</span>&nbsp;<span class="op" id="5320237">==</span>&nbsp;<span class="num" id="5320240">2</span>&nbsp;<span class="op" id="5320242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320247">slice3</span>&nbsp;<span class="op" id="5320254">=</span>&nbsp;<span class="builtintype" id="5320256">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320264">//&nbsp;Check&nbsp;presence&nbsp;of&nbsp;2nd&nbsp;and&nbsp;3rd&nbsp;index&nbsp;here&nbsp;rather&nbsp;than&nbsp;during&nbsp;type-checking</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5320344">//&nbsp;to&nbsp;prevent&nbsp;erroneous&nbsp;programs&nbsp;from&nbsp;passing&nbsp;through&nbsp;gofmt&nbsp;(was&nbsp;issue&nbsp;7305).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320425">if</span>&nbsp;<span class="ident" id="5320428">index</span><span class="op" id="5320433">[</span><span class="num" id="5320434">1</span><span class="op" id="5320435">]</span>&nbsp;<span class="op" id="5320437">==</span>&nbsp;<span class="builtintype" id="5320440">nil</span>&nbsp;<span class="op" id="5320444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320450">p</span><span class="op" id="5320451">.</span><span class="builtintype" id="5320452">error</span><span class="op" id="5320457">(</span><span class="ident" id="5320458">colons</span><span class="op" id="5320464">[</span><span class="num" id="5320465">0</span><span class="op" id="5320466">]</span><span class="op" id="5320467">,</span>&nbsp;<span class="string" id="5320469">&#34;2nd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5320506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320512">index</span><span class="op" id="5320517">[</span><span class="num" id="5320518">1</span><span class="op" id="5320519">]</span>&nbsp;<span class="op" id="5320521">=</span>&nbsp;<span class="op" id="5320523">&amp;</span><span class="ident" id="5320524">ast</span><span class="op" id="5320527">.</span><span class="ident" id="5320528">BadExpr</span><span class="op" id="5320535">{</span><span class="ident" id="5320536">From</span><span class="op" id="5320540">:</span>&nbsp;<span class="ident" id="5320542">colons</span><span class="op" id="5320548">[</span><span class="num" id="5320549">0</span><span class="op" id="5320550">]</span>&nbsp;<span class="op" id="5320552">+</span>&nbsp;<span class="num" id="5320554">1</span><span class="op" id="5320555">,</span>&nbsp;<span class="ident" id="5320557">To</span><span class="op" id="5320559">:</span>&nbsp;<span class="ident" id="5320561">colons</span><span class="op" id="5320567">[</span><span class="num" id="5320568">1</span><span class="op" id="5320569">]</span><span class="op" id="5320570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320575">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320580">if</span>&nbsp;<span class="ident" id="5320583">index</span><span class="op" id="5320588">[</span><span class="num" id="5320589">2</span><span class="op" id="5320590">]</span>&nbsp;<span class="op" id="5320592">==</span>&nbsp;<span class="builtintype" id="5320595">nil</span>&nbsp;<span class="op" id="5320599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320605">p</span><span class="op" id="5320606">.</span><span class="builtintype" id="5320607">error</span><span class="op" id="5320612">(</span><span class="ident" id="5320613">colons</span><span class="op" id="5320619">[</span><span class="num" id="5320620">1</span><span class="op" id="5320621">]</span><span class="op" id="5320622">,</span>&nbsp;<span class="string" id="5320624">&#34;3rd&nbsp;index&nbsp;required&nbsp;in&nbsp;3-index&nbsp;slice&#34;</span><span class="op" id="5320661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5320667">index</span><span class="op" id="5320672">[</span><span class="num" id="5320673">2</span><span class="op" id="5320674">]</span>&nbsp;<span class="op" id="5320676">=</span>&nbsp;<span class="op" id="5320678">&amp;</span><span class="ident" id="5320679">ast</span><span class="op" id="5320682">.</span><span class="ident" id="5320683">BadExpr</span><span class="op" id="5320690">{</span><span class="ident" id="5320691">From</span><span class="op" id="5320695">:</span>&nbsp;<span class="ident" id="5320697">colons</span><span class="op" id="5320703">[</span><span class="num" id="5320704">1</span><span class="op" id="5320705">]</span>&nbsp;<span class="op" id="5320707">+</span>&nbsp;<span class="num" id="5320709">1</span><span class="op" id="5320710">,</span>&nbsp;<span class="ident" id="5320712">To</span><span class="op" id="5320714">:</span>&nbsp;<span class="ident" id="5320716">rbrack</span><span class="op" id="5320722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320731">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320735">return</span>&nbsp;<span class="op" id="5320742">&amp;</span><span class="ident" id="5320743">ast</span><span class="op" id="5320746">.</span><span class="ident" id="5320747">SliceExpr</span><span class="op" id="5320756">{</span><span class="ident" id="5320757">X</span><span class="op" id="5320758">:</span>&nbsp;<span class="ident" id="5320760">x</span><span class="op" id="5320761">,</span>&nbsp;<span class="ident" id="5320763">Lbrack</span><span class="op" id="5320769">:</span>&nbsp;<span class="ident" id="5320771">lbrack</span><span class="op" id="5320777">,</span>&nbsp;<span class="ident" id="5320779">Low</span><span class="op" id="5320782">:</span>&nbsp;<span class="ident" id="5320784">index</span><span class="op" id="5320789">[</span><span class="num" id="5320790">0</span><span class="op" id="5320791">]</span><span class="op" id="5320792">,</span>&nbsp;<span class="ident" id="5320794">High</span><span class="op" id="5320798">:</span>&nbsp;<span class="ident" id="5320800">index</span><span class="op" id="5320805">[</span><span class="num" id="5320806">1</span><span class="op" id="5320807">]</span><span class="op" id="5320808">,</span>&nbsp;<span class="ident" id="5320810">Max</span><span class="op" id="5320813">:</span>&nbsp;<span class="ident" id="5320815">index</span><span class="op" id="5320820">[</span><span class="num" id="5320821">2</span><span class="op" id="5320822">]</span><span class="op" id="5320823">,</span>&nbsp;<span class="ident" id="5320825">Slice3</span><span class="op" id="5320831">:</span>&nbsp;<span class="ident" id="5320833">slice3</span><span class="op" id="5320839">,</span>&nbsp;<span class="ident" id="5320841">Rbrack</span><span class="op" id="5320847">:</span>&nbsp;<span class="ident" id="5320849">rbrack</span><span class="op" id="5320855">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5320858">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5320862">return</span>&nbsp;<span class="op" id="5320869">&amp;</span><span class="ident" id="5320870">ast</span><span class="op" id="5320873">.</span><span class="ident" id="5320874">IndexExpr</span><span class="op" id="5320883">{</span><span class="ident" id="5320884">X</span><span class="op" id="5320885">:</span>&nbsp;<span class="ident" id="5320887">x</span><span class="op" id="5320888">,</span>&nbsp;<span class="ident" id="5320890">Lbrack</span><span class="op" id="5320896">:</span>&nbsp;<span class="ident" id="5320898">lbrack</span><span class="op" id="5320904">,</span>&nbsp;<span class="ident" id="5320906">Index</span><span class="op" id="5320911">:</span>&nbsp;<span class="ident" id="5320913">index</span><span class="op" id="5320918">[</span><span class="num" id="5320919">0</span><span class="op" id="5320920">]</span><span class="op" id="5320921">,</span>&nbsp;<span class="ident" id="5320923">Rbrack</span><span class="op" id="5320929">:</span>&nbsp;<span class="ident" id="5320931">rbrack</span><span class="op" id="5320937">}</span><br>
<span class="lineno"></span><span class="op" id="5320939">}</span><br>
<span class="lineno">1235</span><br>
<span class="lineno"></span><span class="keyword" id="5320942">func</span>&nbsp;<span class="op" id="5320947">(</span><span class="ident" id="5320948">p</span>&nbsp;<span class="op" id="5320950">*</span><span class="ident" id="5320951">parser</span><span class="op" id="5320957">)</span>&nbsp;<span class="ident" id="5320959">parseCallOrConversion</span><span class="op" id="5320980">(</span><span class="ident" id="5320981">fun</span>&nbsp;<span class="ident" id="5320985">ast</span><span class="op" id="5320988">.</span><span class="ident" id="5320989">Expr</span><span class="op" id="5320993">)</span>&nbsp;<span class="op" id="5320995">*</span><span class="ident" id="5320996">ast</span><span class="op" id="5320999">.</span><span class="ident" id="5321000">CallExpr</span>&nbsp;<span class="op" id="5321009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321012">if</span>&nbsp;<span class="ident" id="5321015">p</span><span class="op" id="5321016">.</span><span class="ident" id="5321017">trace</span>&nbsp;<span class="op" id="5321023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321027">defer</span>&nbsp;<span class="ident" id="5321033">un</span><span class="op" id="5321035">(</span><span class="ident" id="5321036">trace</span><span class="op" id="5321041">(</span><span class="ident" id="5321042">p</span><span class="op" id="5321043">,</span>&nbsp;<span class="string" id="5321045">&#34;CallOrConversion&#34;</span><span class="op" id="5321063">)</span><span class="op" id="5321064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321067">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321071">lparen</span>&nbsp;<span class="op" id="5321078">:=</span>&nbsp;<span class="ident" id="5321081">p</span><span class="op" id="5321082">.</span><span class="ident" id="5321083">expect</span><span class="op" id="5321089">(</span><span class="ident" id="5321090">token</span><span class="op" id="5321095">.</span><span class="ident" id="5321096">LPAREN</span><span class="op" id="5321102">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321105">p</span><span class="op" id="5321106">.</span><span class="ident" id="5321107">exprLev</span><span class="op" id="5321114">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321118">var</span>&nbsp;<span class="ident" id="5321122">list</span>&nbsp;<span class="op" id="5321127">[</span><span class="op" id="5321128">]</span><span class="ident" id="5321129">ast</span><span class="op" id="5321132">.</span><span class="ident" id="5321133">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321139">var</span>&nbsp;<span class="ident" id="5321143">ellipsis</span>&nbsp;<span class="ident" id="5321152">token</span><span class="op" id="5321157">.</span><span class="ident" id="5321158">Pos</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321163">for</span>&nbsp;<span class="ident" id="5321167">p</span><span class="op" id="5321168">.</span><span class="ident" id="5321169">tok</span>&nbsp;<span class="op" id="5321173">!=</span>&nbsp;<span class="ident" id="5321176">token</span><span class="op" id="5321181">.</span><span class="ident" id="5321182">RPAREN</span>&nbsp;<span class="op" id="5321189">&amp;&amp;</span>&nbsp;<span class="ident" id="5321192">p</span><span class="op" id="5321193">.</span><span class="ident" id="5321194">tok</span>&nbsp;<span class="op" id="5321198">!=</span>&nbsp;<span class="ident" id="5321201">token</span><span class="op" id="5321206">.</span><span class="ident" id="5321207">EOF</span>&nbsp;<span class="op" id="5321211">&amp;&amp;</span>&nbsp;<span class="op" id="5321214">!</span><span class="ident" id="5321215">ellipsis</span><span class="op" id="5321223">.</span><span class="ident" id="5321224">IsValid</span><span class="op" id="5321231">(</span><span class="op" id="5321232">)</span>&nbsp;<span class="op" id="5321234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321238">list</span>&nbsp;<span class="op" id="5321243">=</span>&nbsp;<span class="builtinfunc" id="5321245">append</span><span class="op" id="5321251">(</span><span class="ident" id="5321252">list</span><span class="op" id="5321256">,</span>&nbsp;<span class="ident" id="5321258">p</span><span class="op" id="5321259">.</span><span class="ident" id="5321260">parseRhsOrType</span><span class="op" id="5321274">(</span><span class="op" id="5321275">)</span><span class="op" id="5321276">)</span>&nbsp;<span class="comment" id="5321278">//&nbsp;builtins&nbsp;may&nbsp;expect&nbsp;a&nbsp;type:&nbsp;make(some&nbsp;type,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321332">if</span>&nbsp;<span class="ident" id="5321335">p</span><span class="op" id="5321336">.</span><span class="ident" id="5321337">tok</span>&nbsp;<span class="op" id="5321341">==</span>&nbsp;<span class="ident" id="5321344">token</span><span class="op" id="5321349">.</span><span class="ident" id="5321350">ELLIPSIS</span>&nbsp;<span class="op" id="5321359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321364">ellipsis</span>&nbsp;<span class="op" id="5321373">=</span>&nbsp;<span class="ident" id="5321375">p</span><span class="op" id="5321376">.</span><span class="ident" id="5321377">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321384">p</span><span class="op" id="5321385">.</span><span class="ident" id="5321386">next</span><span class="op" id="5321390">(</span><span class="op" id="5321391">)</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321395">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321399">if</span>&nbsp;<span class="op" id="5321402">!</span><span class="ident" id="5321403">p</span><span class="op" id="5321404">.</span><span class="ident" id="5321405">atComma</span><span class="op" id="5321412">(</span><span class="string" id="5321413">&#34;argument&nbsp;list&#34;</span><span class="op" id="5321428">)</span>&nbsp;<span class="op" id="5321430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321435">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321447">p</span><span class="op" id="5321448">.</span><span class="ident" id="5321449">next</span><span class="op" id="5321453">(</span><span class="op" id="5321454">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321460">p</span><span class="op" id="5321461">.</span><span class="ident" id="5321462">exprLev</span><span class="op" id="5321469">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5321473">rparen</span>&nbsp;<span class="op" id="5321480">:=</span>&nbsp;<span class="ident" id="5321483">p</span><span class="op" id="5321484">.</span><span class="ident" id="5321485">expectClosing</span><span class="op" id="5321498">(</span><span class="ident" id="5321499">token</span><span class="op" id="5321504">.</span><span class="ident" id="5321505">RPAREN</span><span class="op" id="5321511">,</span>&nbsp;<span class="string" id="5321513">&#34;argument&nbsp;list&#34;</span><span class="op" id="5321528">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321532">return</span>&nbsp;<span class="op" id="5321539">&amp;</span><span class="ident" id="5321540">ast</span><span class="op" id="5321543">.</span><span class="ident" id="5321544">CallExpr</span><span class="op" id="5321552">{</span><span class="ident" id="5321553">Fun</span><span class="op" id="5321556">:</span>&nbsp;<span class="ident" id="5321558">fun</span><span class="op" id="5321561">,</span>&nbsp;<span class="ident" id="5321563">Lparen</span><span class="op" id="5321569">:</span>&nbsp;<span class="ident" id="5321571">lparen</span><span class="op" id="5321577">,</span>&nbsp;<span class="ident" id="5321579">Args</span><span class="op" id="5321583">:</span>&nbsp;<span class="ident" id="5321585">list</span><span class="op" id="5321589">,</span>&nbsp;<span class="ident" id="5321591">Ellipsis</span><span class="op" id="5321599">:</span>&nbsp;<span class="ident" id="5321601">ellipsis</span><span class="op" id="5321609">,</span>&nbsp;<span class="ident" id="5321611">Rparen</span><span class="op" id="5321617">:</span>&nbsp;<span class="ident" id="5321619">rparen</span><span class="op" id="5321625">}</span><br>
<span class="lineno">1260</span><span class="op" id="5321627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5321630">func</span>&nbsp;<span class="op" id="5321635">(</span><span class="ident" id="5321636">p</span>&nbsp;<span class="op" id="5321638">*</span><span class="ident" id="5321639">parser</span><span class="op" id="5321645">)</span>&nbsp;<span class="ident" id="5321647">parseElement</span><span class="op" id="5321659">(</span><span class="ident" id="5321660">keyOk</span>&nbsp;<span class="builtintype" id="5321666">bool</span><span class="op" id="5321670">)</span>&nbsp;<span class="ident" id="5321672">ast</span><span class="op" id="5321675">.</span><span class="ident" id="5321676">Expr</span>&nbsp;<span class="op" id="5321681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321684">if</span>&nbsp;<span class="ident" id="5321687">p</span><span class="op" id="5321688">.</span><span class="ident" id="5321689">trace</span>&nbsp;<span class="op" id="5321695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321699">defer</span>&nbsp;<span class="ident" id="5321705">un</span><span class="op" id="5321707">(</span><span class="ident" id="5321708">trace</span><span class="op" id="5321713">(</span><span class="ident" id="5321714">p</span><span class="op" id="5321715">,</span>&nbsp;<span class="string" id="5321717">&#34;Element&#34;</span><span class="op" id="5321726">)</span><span class="op" id="5321727">)</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321734">if</span>&nbsp;<span class="ident" id="5321737">p</span><span class="op" id="5321738">.</span><span class="ident" id="5321739">tok</span>&nbsp;<span class="op" id="5321743">==</span>&nbsp;<span class="ident" id="5321746">token</span><span class="op" id="5321751">.</span><span class="ident" id="5321752">LBRACE</span>&nbsp;<span class="op" id="5321759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5321763">return</span>&nbsp;<span class="ident" id="5321770">p</span><span class="op" id="5321771">.</span><span class="ident" id="5321772">parseLiteralValue</span><span class="op" id="5321789">(</span><span class="builtintype" id="5321790">nil</span><span class="op" id="5321793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5321796">}</span><br>
<span class="lineno">1270</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5321800">//&nbsp;Because&nbsp;the&nbsp;parser&nbsp;doesn&#39;t&nbsp;know&nbsp;the&nbsp;composite&nbsp;literal&nbsp;type,&nbsp;it&nbsp;cannot</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5321874">//&nbsp;know&nbsp;if&nbsp;a&nbsp;key&nbsp;that&#39;s&nbsp;an&nbsp;identifier&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;name&nbsp;or&nbsp;a&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5321946">//&nbsp;denoting&nbsp;a&nbsp;value.&nbsp;The&nbsp;former&nbsp;is&nbsp;not&nbsp;resolved&nbsp;by&nbsp;the&nbsp;parser&nbsp;or&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322016">//&nbsp;resolver.</span><br>
<span class="lineno">1275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322030">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322034">//&nbsp;Instead,&nbsp;_try_&nbsp;to&nbsp;resolve&nbsp;such&nbsp;a&nbsp;key&nbsp;if&nbsp;possible.&nbsp;If&nbsp;it&nbsp;resolves,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322104">//&nbsp;it&nbsp;a)&nbsp;has&nbsp;correctly&nbsp;resolved,&nbsp;or&nbsp;b)&nbsp;incorrectly&nbsp;resolved&nbsp;because</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322173">//&nbsp;the&nbsp;key&nbsp;is&nbsp;a&nbsp;struct&nbsp;field&nbsp;with&nbsp;a&nbsp;name&nbsp;matching&nbsp;another&nbsp;identifier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322244">//&nbsp;In&nbsp;the&nbsp;former&nbsp;case&nbsp;we&nbsp;are&nbsp;done,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322312">//&nbsp;care&nbsp;because&nbsp;the&nbsp;type&nbsp;checker&nbsp;will&nbsp;do&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322379">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322383">//&nbsp;If&nbsp;the&nbsp;key&nbsp;does&nbsp;not&nbsp;resolve,&nbsp;it&nbsp;a)&nbsp;must&nbsp;be&nbsp;defined&nbsp;at&nbsp;the&nbsp;top</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322449">//&nbsp;level&nbsp;in&nbsp;another&nbsp;file&nbsp;of&nbsp;the&nbsp;same&nbsp;package,&nbsp;the&nbsp;universe&nbsp;scope,&nbsp;or&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322522">//&nbsp;undeclared;&nbsp;or&nbsp;b)&nbsp;it&nbsp;is&nbsp;a&nbsp;struct&nbsp;field.&nbsp;In&nbsp;the&nbsp;former&nbsp;case,&nbsp;the&nbsp;type</span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322595">//&nbsp;checker&nbsp;can&nbsp;do&nbsp;a&nbsp;top-level&nbsp;lookup,&nbsp;and&nbsp;in&nbsp;the&nbsp;latter&nbsp;case&nbsp;it&nbsp;will&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322668">//&nbsp;a&nbsp;separate&nbsp;field&nbsp;lookup.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322697">x</span>&nbsp;<span class="op" id="5322699">:=</span>&nbsp;<span class="ident" id="5322702">p</span><span class="op" id="5322703">.</span><span class="ident" id="5322704">checkExpr</span><span class="op" id="5322713">(</span><span class="ident" id="5322714">p</span><span class="op" id="5322715">.</span><span class="ident" id="5322716">parseExpr</span><span class="op" id="5322725">(</span><span class="ident" id="5322726">keyOk</span><span class="op" id="5322731">)</span><span class="op" id="5322732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322735">if</span>&nbsp;<span class="ident" id="5322738">keyOk</span>&nbsp;<span class="op" id="5322744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5322748">if</span>&nbsp;<span class="ident" id="5322751">p</span><span class="op" id="5322752">.</span><span class="ident" id="5322753">tok</span>&nbsp;<span class="op" id="5322757">==</span>&nbsp;<span class="ident" id="5322760">token</span><span class="op" id="5322765">.</span><span class="ident" id="5322766">COLON</span>&nbsp;<span class="op" id="5322772">{</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322777">colon</span>&nbsp;<span class="op" id="5322783">:=</span>&nbsp;<span class="ident" id="5322786">p</span><span class="op" id="5322787">.</span><span class="ident" id="5322788">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322795">p</span><span class="op" id="5322796">.</span><span class="ident" id="5322797">next</span><span class="op" id="5322801">(</span><span class="op" id="5322802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322807">//&nbsp;Try&nbsp;to&nbsp;resolve&nbsp;the&nbsp;key&nbsp;but&nbsp;don&#39;t&nbsp;collect&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322857">//&nbsp;as&nbsp;unresolved&nbsp;identifier&nbsp;if&nbsp;it&nbsp;fails&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322908">//&nbsp;we&nbsp;don&#39;t&nbsp;get&nbsp;(possibly&nbsp;false)&nbsp;errors&nbsp;about</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5322957">//&nbsp;undeclared&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5322981">p</span><span class="op" id="5322982">.</span><span class="ident" id="5322983">tryResolve</span><span class="op" id="5322993">(</span><span class="ident" id="5322994">x</span><span class="op" id="5322995">,</span>&nbsp;<span class="builtintype" id="5322997">false</span><span class="op" id="5323002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323007">return</span>&nbsp;<span class="op" id="5323014">&amp;</span><span class="ident" id="5323015">ast</span><span class="op" id="5323018">.</span><span class="ident" id="5323019">KeyValueExpr</span><span class="op" id="5323031">{</span><span class="ident" id="5323032">Key</span><span class="op" id="5323035">:</span>&nbsp;<span class="ident" id="5323037">x</span><span class="op" id="5323038">,</span>&nbsp;<span class="ident" id="5323040">Colon</span><span class="op" id="5323045">:</span>&nbsp;<span class="ident" id="5323047">colon</span><span class="op" id="5323052">,</span>&nbsp;<span class="ident" id="5323054">Value</span><span class="op" id="5323059">:</span>&nbsp;<span class="ident" id="5323061">p</span><span class="op" id="5323062">.</span><span class="ident" id="5323063">parseElement</span><span class="op" id="5323075">(</span><span class="builtintype" id="5323076">false</span><span class="op" id="5323081">)</span><span class="op" id="5323082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323090">p</span><span class="op" id="5323091">.</span><span class="ident" id="5323092">resolve</span><span class="op" id="5323099">(</span><span class="ident" id="5323100">x</span><span class="op" id="5323101">)</span>&nbsp;<span class="comment" id="5323103">//&nbsp;not&nbsp;a&nbsp;key</span><br>
<span class="lineno">1300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323121">return</span>&nbsp;<span class="ident" id="5323128">x</span><br>
<span class="lineno"></span><span class="op" id="5323130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span><span class="keyword" id="5323133">func</span>&nbsp;<span class="op" id="5323138">(</span><span class="ident" id="5323139">p</span>&nbsp;<span class="op" id="5323141">*</span><span class="ident" id="5323142">parser</span><span class="op" id="5323148">)</span>&nbsp;<span class="ident" id="5323150">parseElementList</span><span class="op" id="5323166">(</span><span class="op" id="5323167">)</span>&nbsp;<span class="op" id="5323169">(</span><span class="ident" id="5323170">list</span>&nbsp;<span class="op" id="5323175">[</span><span class="op" id="5323176">]</span><span class="ident" id="5323177">ast</span><span class="op" id="5323180">.</span><span class="ident" id="5323181">Expr</span><span class="op" id="5323185">)</span>&nbsp;<span class="op" id="5323187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323190">if</span>&nbsp;<span class="ident" id="5323193">p</span><span class="op" id="5323194">.</span><span class="ident" id="5323195">trace</span>&nbsp;<span class="op" id="5323201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323205">defer</span>&nbsp;<span class="ident" id="5323211">un</span><span class="op" id="5323213">(</span><span class="ident" id="5323214">trace</span><span class="op" id="5323219">(</span><span class="ident" id="5323220">p</span><span class="op" id="5323221">,</span>&nbsp;<span class="string" id="5323223">&#34;ElementList&#34;</span><span class="op" id="5323236">)</span><span class="op" id="5323237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323244">for</span>&nbsp;<span class="ident" id="5323248">p</span><span class="op" id="5323249">.</span><span class="ident" id="5323250">tok</span>&nbsp;<span class="op" id="5323254">!=</span>&nbsp;<span class="ident" id="5323257">token</span><span class="op" id="5323262">.</span><span class="ident" id="5323263">RBRACE</span>&nbsp;<span class="op" id="5323270">&amp;&amp;</span>&nbsp;<span class="ident" id="5323273">p</span><span class="op" id="5323274">.</span><span class="ident" id="5323275">tok</span>&nbsp;<span class="op" id="5323279">!=</span>&nbsp;<span class="ident" id="5323282">token</span><span class="op" id="5323287">.</span><span class="ident" id="5323288">EOF</span>&nbsp;<span class="op" id="5323292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323296">list</span>&nbsp;<span class="op" id="5323301">=</span>&nbsp;<span class="builtinfunc" id="5323303">append</span><span class="op" id="5323309">(</span><span class="ident" id="5323310">list</span><span class="op" id="5323314">,</span>&nbsp;<span class="ident" id="5323316">p</span><span class="op" id="5323317">.</span><span class="ident" id="5323318">parseElement</span><span class="op" id="5323330">(</span><span class="builtintype" id="5323331">true</span><span class="op" id="5323335">)</span><span class="op" id="5323336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323340">if</span>&nbsp;<span class="op" id="5323343">!</span><span class="ident" id="5323344">p</span><span class="op" id="5323345">.</span><span class="ident" id="5323346">atComma</span><span class="op" id="5323353">(</span><span class="string" id="5323354">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5323373">)</span>&nbsp;<span class="op" id="5323375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323380">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323388">}</span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323392">p</span><span class="op" id="5323393">.</span><span class="ident" id="5323394">next</span><span class="op" id="5323398">(</span><span class="op" id="5323399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323406">return</span><br>
<span class="lineno"></span><span class="op" id="5323413">}</span><br>
<span class="lineno">1320</span><br>
<span class="lineno"></span><span class="keyword" id="5323416">func</span>&nbsp;<span class="op" id="5323421">(</span><span class="ident" id="5323422">p</span>&nbsp;<span class="op" id="5323424">*</span><span class="ident" id="5323425">parser</span><span class="op" id="5323431">)</span>&nbsp;<span class="ident" id="5323433">parseLiteralValue</span><span class="op" id="5323450">(</span><span class="ident" id="5323451">typ</span>&nbsp;<span class="ident" id="5323455">ast</span><span class="op" id="5323458">.</span><span class="ident" id="5323459">Expr</span><span class="op" id="5323463">)</span>&nbsp;<span class="ident" id="5323465">ast</span><span class="op" id="5323468">.</span><span class="ident" id="5323469">Expr</span>&nbsp;<span class="op" id="5323474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323477">if</span>&nbsp;<span class="ident" id="5323480">p</span><span class="op" id="5323481">.</span><span class="ident" id="5323482">trace</span>&nbsp;<span class="op" id="5323488">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323492">defer</span>&nbsp;<span class="ident" id="5323498">un</span><span class="op" id="5323500">(</span><span class="ident" id="5323501">trace</span><span class="op" id="5323506">(</span><span class="ident" id="5323507">p</span><span class="op" id="5323508">,</span>&nbsp;<span class="string" id="5323510">&#34;LiteralValue&#34;</span><span class="op" id="5323524">)</span><span class="op" id="5323525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323528">}</span><br>
<span class="lineno">1325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323532">lbrace</span>&nbsp;<span class="op" id="5323539">:=</span>&nbsp;<span class="ident" id="5323542">p</span><span class="op" id="5323543">.</span><span class="ident" id="5323544">expect</span><span class="op" id="5323550">(</span><span class="ident" id="5323551">token</span><span class="op" id="5323556">.</span><span class="ident" id="5323557">LBRACE</span><span class="op" id="5323563">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323566">var</span>&nbsp;<span class="ident" id="5323570">elts</span>&nbsp;<span class="op" id="5323575">[</span><span class="op" id="5323576">]</span><span class="ident" id="5323577">ast</span><span class="op" id="5323580">.</span><span class="ident" id="5323581">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323587">p</span><span class="op" id="5323588">.</span><span class="ident" id="5323589">exprLev</span><span class="op" id="5323596">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323600">if</span>&nbsp;<span class="ident" id="5323603">p</span><span class="op" id="5323604">.</span><span class="ident" id="5323605">tok</span>&nbsp;<span class="op" id="5323609">!=</span>&nbsp;<span class="ident" id="5323612">token</span><span class="op" id="5323617">.</span><span class="ident" id="5323618">RBRACE</span>&nbsp;<span class="op" id="5323625">{</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323629">elts</span>&nbsp;<span class="op" id="5323634">=</span>&nbsp;<span class="ident" id="5323636">p</span><span class="op" id="5323637">.</span><span class="ident" id="5323638">parseElementList</span><span class="op" id="5323654">(</span><span class="op" id="5323655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5323658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323661">p</span><span class="op" id="5323662">.</span><span class="ident" id="5323663">exprLev</span><span class="op" id="5323670">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5323674">rbrace</span>&nbsp;<span class="op" id="5323681">:=</span>&nbsp;<span class="ident" id="5323684">p</span><span class="op" id="5323685">.</span><span class="ident" id="5323686">expectClosing</span><span class="op" id="5323699">(</span><span class="ident" id="5323700">token</span><span class="op" id="5323705">.</span><span class="ident" id="5323706">RBRACE</span><span class="op" id="5323712">,</span>&nbsp;<span class="string" id="5323714">&#34;composite&nbsp;literal&#34;</span><span class="op" id="5323733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323736">return</span>&nbsp;<span class="op" id="5323743">&amp;</span><span class="ident" id="5323744">ast</span><span class="op" id="5323747">.</span><span class="ident" id="5323748">CompositeLit</span><span class="op" id="5323760">{</span><span class="ident" id="5323761">Type</span><span class="op" id="5323765">:</span>&nbsp;<span class="ident" id="5323767">typ</span><span class="op" id="5323770">,</span>&nbsp;<span class="ident" id="5323772">Lbrace</span><span class="op" id="5323778">:</span>&nbsp;<span class="ident" id="5323780">lbrace</span><span class="op" id="5323786">,</span>&nbsp;<span class="ident" id="5323788">Elts</span><span class="op" id="5323792">:</span>&nbsp;<span class="ident" id="5323794">elts</span><span class="op" id="5323798">,</span>&nbsp;<span class="ident" id="5323800">Rbrace</span><span class="op" id="5323806">:</span>&nbsp;<span class="ident" id="5323808">rbrace</span><span class="op" id="5323814">}</span><br>
<span class="lineno">1335</span><span class="op" id="5323816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5323819">//&nbsp;checkExpr&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;(and&nbsp;not&nbsp;a&nbsp;type).</span><br>
<span class="lineno"></span><span class="keyword" id="5323881">func</span>&nbsp;<span class="op" id="5323886">(</span><span class="ident" id="5323887">p</span>&nbsp;<span class="op" id="5323889">*</span><span class="ident" id="5323890">parser</span><span class="op" id="5323896">)</span>&nbsp;<span class="ident" id="5323898">checkExpr</span><span class="op" id="5323907">(</span><span class="ident" id="5323908">x</span>&nbsp;<span class="ident" id="5323910">ast</span><span class="op" id="5323913">.</span><span class="ident" id="5323914">Expr</span><span class="op" id="5323918">)</span>&nbsp;<span class="ident" id="5323920">ast</span><span class="op" id="5323923">.</span><span class="ident" id="5323924">Expr</span>&nbsp;<span class="op" id="5323929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323932">switch</span>&nbsp;<span class="ident" id="5323939">unparen</span><span class="op" id="5323946">(</span><span class="ident" id="5323947">x</span><span class="op" id="5323948">)</span><span class="op" id="5323949">.</span><span class="op" id="5323950">(</span><span class="keyword" id="5323951">type</span><span class="op" id="5323955">)</span>&nbsp;<span class="op" id="5323957">{</span><br>
<span class="lineno">1340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323960">case</span>&nbsp;<span class="op" id="5323965">*</span><span class="ident" id="5323966">ast</span><span class="op" id="5323969">.</span><span class="ident" id="5323970">BadExpr</span><span class="op" id="5323977">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323980">case</span>&nbsp;<span class="op" id="5323985">*</span><span class="ident" id="5323986">ast</span><span class="op" id="5323989">.</span><span class="ident" id="5323990">Ident</span><span class="op" id="5323995">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5323998">case</span>&nbsp;<span class="op" id="5324003">*</span><span class="ident" id="5324004">ast</span><span class="op" id="5324007">.</span><span class="ident" id="5324008">BasicLit</span><span class="op" id="5324016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324019">case</span>&nbsp;<span class="op" id="5324024">*</span><span class="ident" id="5324025">ast</span><span class="op" id="5324028">.</span><span class="ident" id="5324029">FuncLit</span><span class="op" id="5324036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324039">case</span>&nbsp;<span class="op" id="5324044">*</span><span class="ident" id="5324045">ast</span><span class="op" id="5324048">.</span><span class="ident" id="5324049">CompositeLit</span><span class="op" id="5324061">:</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324064">case</span>&nbsp;<span class="op" id="5324069">*</span><span class="ident" id="5324070">ast</span><span class="op" id="5324073">.</span><span class="ident" id="5324074">ParenExpr</span><span class="op" id="5324083">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5324087">panic</span><span class="op" id="5324092">(</span><span class="string" id="5324093">&#34;unreachable&#34;</span><span class="op" id="5324106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324109">case</span>&nbsp;<span class="op" id="5324114">*</span><span class="ident" id="5324115">ast</span><span class="op" id="5324118">.</span><span class="ident" id="5324119">SelectorExpr</span><span class="op" id="5324131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324134">case</span>&nbsp;<span class="op" id="5324139">*</span><span class="ident" id="5324140">ast</span><span class="op" id="5324143">.</span><span class="ident" id="5324144">IndexExpr</span><span class="op" id="5324153">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324156">case</span>&nbsp;<span class="op" id="5324161">*</span><span class="ident" id="5324162">ast</span><span class="op" id="5324165">.</span><span class="ident" id="5324166">SliceExpr</span><span class="op" id="5324175">:</span><br>
<span class="lineno">1350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324178">case</span>&nbsp;<span class="op" id="5324183">*</span><span class="ident" id="5324184">ast</span><span class="op" id="5324187">.</span><span class="ident" id="5324188">TypeAssertExpr</span><span class="op" id="5324202">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324206">//&nbsp;If&nbsp;t.Type&nbsp;==&nbsp;nil&nbsp;we&nbsp;have&nbsp;a&nbsp;type&nbsp;assertion&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324265">//&nbsp;y.(type),&nbsp;which&nbsp;is&nbsp;only&nbsp;allowed&nbsp;in&nbsp;type&nbsp;switch&nbsp;expressions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324330">//&nbsp;It&#39;s&nbsp;hard&nbsp;to&nbsp;exclude&nbsp;those&nbsp;but&nbsp;for&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;are&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324395">//&nbsp;a&nbsp;type&nbsp;switch.&nbsp;Instead&nbsp;be&nbsp;lenient&nbsp;and&nbsp;test&nbsp;this&nbsp;in&nbsp;the&nbsp;type</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324460">//&nbsp;checker.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324473">case</span>&nbsp;<span class="op" id="5324478">*</span><span class="ident" id="5324479">ast</span><span class="op" id="5324482">.</span><span class="ident" id="5324483">CallExpr</span><span class="op" id="5324491">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324494">case</span>&nbsp;<span class="op" id="5324499">*</span><span class="ident" id="5324500">ast</span><span class="op" id="5324503">.</span><span class="ident" id="5324504">StarExpr</span><span class="op" id="5324512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324515">case</span>&nbsp;<span class="op" id="5324520">*</span><span class="ident" id="5324521">ast</span><span class="op" id="5324524">.</span><span class="ident" id="5324525">UnaryExpr</span><span class="op" id="5324534">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324537">case</span>&nbsp;<span class="op" id="5324542">*</span><span class="ident" id="5324543">ast</span><span class="op" id="5324546">.</span><span class="ident" id="5324547">BinaryExpr</span><span class="op" id="5324557">:</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324560">default</span><span class="op" id="5324567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5324571">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;proper&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324619">p</span><span class="op" id="5324620">.</span><span class="ident" id="5324621">errorExpected</span><span class="op" id="5324634">(</span><span class="ident" id="5324635">x</span><span class="op" id="5324636">.</span><span class="ident" id="5324637">Pos</span><span class="op" id="5324640">(</span><span class="op" id="5324641">)</span><span class="op" id="5324642">,</span>&nbsp;<span class="string" id="5324644">&#34;expression&#34;</span><span class="op" id="5324656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324660">x</span>&nbsp;<span class="op" id="5324662">=</span>&nbsp;<span class="op" id="5324664">&amp;</span><span class="ident" id="5324665">ast</span><span class="op" id="5324668">.</span><span class="ident" id="5324669">BadExpr</span><span class="op" id="5324676">{</span><span class="ident" id="5324677">From</span><span class="op" id="5324681">:</span>&nbsp;<span class="ident" id="5324683">x</span><span class="op" id="5324684">.</span><span class="ident" id="5324685">Pos</span><span class="op" id="5324688">(</span><span class="op" id="5324689">)</span><span class="op" id="5324690">,</span>&nbsp;<span class="ident" id="5324692">To</span><span class="op" id="5324694">:</span>&nbsp;<span class="ident" id="5324696">p</span><span class="op" id="5324697">.</span><span class="ident" id="5324698">safePos</span><span class="op" id="5324705">(</span><span class="ident" id="5324706">x</span><span class="op" id="5324707">.</span><span class="ident" id="5324708">End</span><span class="op" id="5324711">(</span><span class="op" id="5324712">)</span><span class="op" id="5324713">)</span><span class="op" id="5324714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5324717">}</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324720">return</span>&nbsp;<span class="ident" id="5324727">x</span><br>
<span class="lineno"></span><span class="op" id="5324729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5324732">//&nbsp;isTypeName&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;(qualified)&nbsp;TypeName.</span><br>
<span class="lineno"></span><span class="keyword" id="5324792">func</span>&nbsp;<span class="ident" id="5324797">isTypeName</span><span class="op" id="5324807">(</span><span class="ident" id="5324808">x</span>&nbsp;<span class="ident" id="5324810">ast</span><span class="op" id="5324813">.</span><span class="ident" id="5324814">Expr</span><span class="op" id="5324818">)</span>&nbsp;<span class="builtintype" id="5324820">bool</span>&nbsp;<span class="op" id="5324825">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324828">switch</span>&nbsp;<span class="ident" id="5324835">t</span>&nbsp;<span class="op" id="5324837">:=</span>&nbsp;<span class="ident" id="5324840">x</span><span class="op" id="5324841">.</span><span class="op" id="5324842">(</span><span class="keyword" id="5324843">type</span><span class="op" id="5324847">)</span>&nbsp;<span class="op" id="5324849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324852">case</span>&nbsp;<span class="op" id="5324857">*</span><span class="ident" id="5324858">ast</span><span class="op" id="5324861">.</span><span class="ident" id="5324862">BadExpr</span><span class="op" id="5324869">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324872">case</span>&nbsp;<span class="op" id="5324877">*</span><span class="ident" id="5324878">ast</span><span class="op" id="5324881">.</span><span class="ident" id="5324882">Ident</span><span class="op" id="5324887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324890">case</span>&nbsp;<span class="op" id="5324895">*</span><span class="ident" id="5324896">ast</span><span class="op" id="5324899">.</span><span class="ident" id="5324900">SelectorExpr</span><span class="op" id="5324912">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5324916">_</span><span class="op" id="5324917">,</span>&nbsp;<span class="ident" id="5324919">isIdent</span>&nbsp;<span class="op" id="5324927">:=</span>&nbsp;<span class="ident" id="5324930">t</span><span class="op" id="5324931">.</span><span class="ident" id="5324932">X</span><span class="op" id="5324933">.</span><span class="op" id="5324934">(</span><span class="op" id="5324935">*</span><span class="ident" id="5324936">ast</span><span class="op" id="5324939">.</span><span class="ident" id="5324940">Ident</span><span class="op" id="5324945">)</span><br>
<span class="lineno">1375</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324949">return</span>&nbsp;<span class="ident" id="5324956">isIdent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324965">default</span><span class="op" id="5324972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5324976">return</span>&nbsp;<span class="builtintype" id="5324983">false</span>&nbsp;<span class="comment" id="5324989">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;type&nbsp;names</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325028">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325031">return</span>&nbsp;<span class="builtintype" id="5325038">true</span><br>
<span class="lineno">1380</span><span class="op" id="5325043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325046">//&nbsp;isLiteralType&nbsp;returns&nbsp;true&nbsp;iff&nbsp;x&nbsp;is&nbsp;a&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5325117">func</span>&nbsp;<span class="ident" id="5325122">isLiteralType</span><span class="op" id="5325135">(</span><span class="ident" id="5325136">x</span>&nbsp;<span class="ident" id="5325138">ast</span><span class="op" id="5325141">.</span><span class="ident" id="5325142">Expr</span><span class="op" id="5325146">)</span>&nbsp;<span class="builtintype" id="5325148">bool</span>&nbsp;<span class="op" id="5325153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325156">switch</span>&nbsp;<span class="ident" id="5325163">t</span>&nbsp;<span class="op" id="5325165">:=</span>&nbsp;<span class="ident" id="5325168">x</span><span class="op" id="5325169">.</span><span class="op" id="5325170">(</span><span class="keyword" id="5325171">type</span><span class="op" id="5325175">)</span>&nbsp;<span class="op" id="5325177">{</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325180">case</span>&nbsp;<span class="op" id="5325185">*</span><span class="ident" id="5325186">ast</span><span class="op" id="5325189">.</span><span class="ident" id="5325190">BadExpr</span><span class="op" id="5325197">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325200">case</span>&nbsp;<span class="op" id="5325205">*</span><span class="ident" id="5325206">ast</span><span class="op" id="5325209">.</span><span class="ident" id="5325210">Ident</span><span class="op" id="5325215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325218">case</span>&nbsp;<span class="op" id="5325223">*</span><span class="ident" id="5325224">ast</span><span class="op" id="5325227">.</span><span class="ident" id="5325228">SelectorExpr</span><span class="op" id="5325240">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5325244">_</span><span class="op" id="5325245">,</span>&nbsp;<span class="ident" id="5325247">isIdent</span>&nbsp;<span class="op" id="5325255">:=</span>&nbsp;<span class="ident" id="5325258">t</span><span class="op" id="5325259">.</span><span class="ident" id="5325260">X</span><span class="op" id="5325261">.</span><span class="op" id="5325262">(</span><span class="op" id="5325263">*</span><span class="ident" id="5325264">ast</span><span class="op" id="5325267">.</span><span class="ident" id="5325268">Ident</span><span class="op" id="5325273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325277">return</span>&nbsp;<span class="ident" id="5325284">isIdent</span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325293">case</span>&nbsp;<span class="op" id="5325298">*</span><span class="ident" id="5325299">ast</span><span class="op" id="5325302">.</span><span class="ident" id="5325303">ArrayType</span><span class="op" id="5325312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325315">case</span>&nbsp;<span class="op" id="5325320">*</span><span class="ident" id="5325321">ast</span><span class="op" id="5325324">.</span><span class="ident" id="5325325">StructType</span><span class="op" id="5325335">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325338">case</span>&nbsp;<span class="op" id="5325343">*</span><span class="ident" id="5325344">ast</span><span class="op" id="5325347">.</span><span class="ident" id="5325348">MapType</span><span class="op" id="5325355">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325358">default</span><span class="op" id="5325365">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325369">return</span>&nbsp;<span class="builtintype" id="5325376">false</span>&nbsp;<span class="comment" id="5325382">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;not&nbsp;legal&nbsp;composite&nbsp;literal&nbsp;types</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325443">return</span>&nbsp;<span class="builtintype" id="5325450">true</span><br>
<span class="lineno"></span><span class="op" id="5325455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325458">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;*T,&nbsp;deref&nbsp;returns&nbsp;T,&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno">1400</span><span class="keyword" id="5325526">func</span>&nbsp;<span class="ident" id="5325531">deref</span><span class="op" id="5325536">(</span><span class="ident" id="5325537">x</span>&nbsp;<span class="ident" id="5325539">ast</span><span class="op" id="5325542">.</span><span class="ident" id="5325543">Expr</span><span class="op" id="5325547">)</span>&nbsp;<span class="ident" id="5325549">ast</span><span class="op" id="5325552">.</span><span class="ident" id="5325553">Expr</span>&nbsp;<span class="op" id="5325558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325561">if</span>&nbsp;<span class="ident" id="5325564">p</span><span class="op" id="5325565">,</span>&nbsp;<span class="ident" id="5325567">isPtr</span>&nbsp;<span class="op" id="5325573">:=</span>&nbsp;<span class="ident" id="5325576">x</span><span class="op" id="5325577">.</span><span class="op" id="5325578">(</span><span class="op" id="5325579">*</span><span class="ident" id="5325580">ast</span><span class="op" id="5325583">.</span><span class="ident" id="5325584">StarExpr</span><span class="op" id="5325592">)</span><span class="op" id="5325593">;</span>&nbsp;<span class="ident" id="5325595">isPtr</span>&nbsp;<span class="op" id="5325601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5325605">x</span>&nbsp;<span class="op" id="5325607">=</span>&nbsp;<span class="ident" id="5325609">p</span><span class="op" id="5325610">.</span><span class="ident" id="5325611">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325617">return</span>&nbsp;<span class="ident" id="5325624">x</span><br>
<span class="lineno">1405</span><span class="op" id="5325626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5325629">//&nbsp;If&nbsp;x&nbsp;is&nbsp;of&nbsp;the&nbsp;form&nbsp;(T),&nbsp;unparen&nbsp;returns&nbsp;unparen(T),&nbsp;otherwise&nbsp;it&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5325709">func</span>&nbsp;<span class="ident" id="5325714">unparen</span><span class="op" id="5325721">(</span><span class="ident" id="5325722">x</span>&nbsp;<span class="ident" id="5325724">ast</span><span class="op" id="5325727">.</span><span class="ident" id="5325728">Expr</span><span class="op" id="5325732">)</span>&nbsp;<span class="ident" id="5325734">ast</span><span class="op" id="5325737">.</span><span class="ident" id="5325738">Expr</span>&nbsp;<span class="op" id="5325743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325746">if</span>&nbsp;<span class="ident" id="5325749">p</span><span class="op" id="5325750">,</span>&nbsp;<span class="ident" id="5325752">isParen</span>&nbsp;<span class="op" id="5325760">:=</span>&nbsp;<span class="ident" id="5325763">x</span><span class="op" id="5325764">.</span><span class="op" id="5325765">(</span><span class="op" id="5325766">*</span><span class="ident" id="5325767">ast</span><span class="op" id="5325770">.</span><span class="ident" id="5325771">ParenExpr</span><span class="op" id="5325780">)</span><span class="op" id="5325781">;</span>&nbsp;<span class="ident" id="5325783">isParen</span>&nbsp;<span class="op" id="5325791">{</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5325795">x</span>&nbsp;<span class="op" id="5325797">=</span>&nbsp;<span class="ident" id="5325799">unparen</span><span class="op" id="5325806">(</span><span class="ident" id="5325807">p</span><span class="op" id="5325808">.</span><span class="ident" id="5325809">X</span><span class="op" id="5325810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5325813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325816">return</span>&nbsp;<span class="ident" id="5325823">x</span><br>
<span class="lineno"></span><span class="op" id="5325825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1415</span><span class="comment" id="5325828">//&nbsp;checkExprOrType&nbsp;checks&nbsp;that&nbsp;x&nbsp;is&nbsp;an&nbsp;expression&nbsp;or&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="5325888">//&nbsp;(and&nbsp;not&nbsp;a&nbsp;raw&nbsp;type&nbsp;such&nbsp;as&nbsp;[...]T).</span><br>
<span class="lineno"></span><span class="comment" id="5325928">//</span><br>
<span class="lineno"></span><span class="keyword" id="5325931">func</span>&nbsp;<span class="op" id="5325936">(</span><span class="ident" id="5325937">p</span>&nbsp;<span class="op" id="5325939">*</span><span class="ident" id="5325940">parser</span><span class="op" id="5325946">)</span>&nbsp;<span class="ident" id="5325948">checkExprOrType</span><span class="op" id="5325963">(</span><span class="ident" id="5325964">x</span>&nbsp;<span class="ident" id="5325966">ast</span><span class="op" id="5325969">.</span><span class="ident" id="5325970">Expr</span><span class="op" id="5325974">)</span>&nbsp;<span class="ident" id="5325976">ast</span><span class="op" id="5325979">.</span><span class="ident" id="5325980">Expr</span>&nbsp;<span class="op" id="5325985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5325988">switch</span>&nbsp;<span class="ident" id="5325995">t</span>&nbsp;<span class="op" id="5325997">:=</span>&nbsp;<span class="ident" id="5326000">unparen</span><span class="op" id="5326007">(</span><span class="ident" id="5326008">x</span><span class="op" id="5326009">)</span><span class="op" id="5326010">.</span><span class="op" id="5326011">(</span><span class="keyword" id="5326012">type</span><span class="op" id="5326016">)</span>&nbsp;<span class="op" id="5326018">{</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326021">case</span>&nbsp;<span class="op" id="5326026">*</span><span class="ident" id="5326027">ast</span><span class="op" id="5326030">.</span><span class="ident" id="5326031">ParenExpr</span><span class="op" id="5326040">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5326044">panic</span><span class="op" id="5326049">(</span><span class="string" id="5326050">&#34;unreachable&#34;</span><span class="op" id="5326063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326066">case</span>&nbsp;<span class="op" id="5326071">*</span><span class="ident" id="5326072">ast</span><span class="op" id="5326075">.</span><span class="ident" id="5326076">UnaryExpr</span><span class="op" id="5326085">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326088">case</span>&nbsp;<span class="op" id="5326093">*</span><span class="ident" id="5326094">ast</span><span class="op" id="5326097">.</span><span class="ident" id="5326098">ArrayType</span><span class="op" id="5326107">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326111">if</span>&nbsp;<span class="builtinfunc" id="5326114">len</span><span class="op" id="5326117">,</span>&nbsp;<span class="ident" id="5326119">isEllipsis</span>&nbsp;<span class="op" id="5326130">:=</span>&nbsp;<span class="ident" id="5326133">t</span><span class="op" id="5326134">.</span><span class="ident" id="5326135">Len</span><span class="op" id="5326138">.</span><span class="op" id="5326139">(</span><span class="op" id="5326140">*</span><span class="ident" id="5326141">ast</span><span class="op" id="5326144">.</span><span class="ident" id="5326145">Ellipsis</span><span class="op" id="5326153">)</span><span class="op" id="5326154">;</span>&nbsp;<span class="ident" id="5326156">isEllipsis</span>&nbsp;<span class="op" id="5326167">{</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326172">p</span><span class="op" id="5326173">.</span><span class="builtintype" id="5326174">error</span><span class="op" id="5326179">(</span><span class="builtinfunc" id="5326180">len</span><span class="op" id="5326183">.</span><span class="ident" id="5326184">Pos</span><span class="op" id="5326187">(</span><span class="op" id="5326188">)</span><span class="op" id="5326189">,</span>&nbsp;<span class="string" id="5326191">&#34;expected&nbsp;array&nbsp;length,&nbsp;found&nbsp;&#39;...&#39;&#34;</span><span class="op" id="5326227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326232">x</span>&nbsp;<span class="op" id="5326234">=</span>&nbsp;<span class="op" id="5326236">&amp;</span><span class="ident" id="5326237">ast</span><span class="op" id="5326240">.</span><span class="ident" id="5326241">BadExpr</span><span class="op" id="5326248">{</span><span class="ident" id="5326249">From</span><span class="op" id="5326253">:</span>&nbsp;<span class="ident" id="5326255">x</span><span class="op" id="5326256">.</span><span class="ident" id="5326257">Pos</span><span class="op" id="5326260">(</span><span class="op" id="5326261">)</span><span class="op" id="5326262">,</span>&nbsp;<span class="ident" id="5326264">To</span><span class="op" id="5326266">:</span>&nbsp;<span class="ident" id="5326268">p</span><span class="op" id="5326269">.</span><span class="ident" id="5326270">safePos</span><span class="op" id="5326277">(</span><span class="ident" id="5326278">x</span><span class="op" id="5326279">.</span><span class="ident" id="5326280">End</span><span class="op" id="5326283">(</span><span class="op" id="5326284">)</span><span class="op" id="5326285">)</span><span class="op" id="5326286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5326290">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5326293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5326297">//&nbsp;all&nbsp;other&nbsp;nodes&nbsp;are&nbsp;expressions&nbsp;or&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326342">return</span>&nbsp;<span class="ident" id="5326349">x</span><br>
<span class="lineno"></span><span class="op" id="5326351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5326354">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno">1435</span><span class="keyword" id="5326424">func</span>&nbsp;<span class="op" id="5326429">(</span><span class="ident" id="5326430">p</span>&nbsp;<span class="op" id="5326432">*</span><span class="ident" id="5326433">parser</span><span class="op" id="5326439">)</span>&nbsp;<span class="ident" id="5326441">parsePrimaryExpr</span><span class="op" id="5326457">(</span><span class="ident" id="5326458">lhs</span>&nbsp;<span class="builtintype" id="5326462">bool</span><span class="op" id="5326466">)</span>&nbsp;<span class="ident" id="5326468">ast</span><span class="op" id="5326471">.</span><span class="ident" id="5326472">Expr</span>&nbsp;<span class="op" id="5326477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326480">if</span>&nbsp;<span class="ident" id="5326483">p</span><span class="op" id="5326484">.</span><span class="ident" id="5326485">trace</span>&nbsp;<span class="op" id="5326491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326495">defer</span>&nbsp;<span class="ident" id="5326501">un</span><span class="op" id="5326503">(</span><span class="ident" id="5326504">trace</span><span class="op" id="5326509">(</span><span class="ident" id="5326510">p</span><span class="op" id="5326511">,</span>&nbsp;<span class="string" id="5326513">&#34;PrimaryExpr&#34;</span><span class="op" id="5326526">)</span><span class="op" id="5326527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5326530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326534">x</span>&nbsp;<span class="op" id="5326536">:=</span>&nbsp;<span class="ident" id="5326539">p</span><span class="op" id="5326540">.</span><span class="ident" id="5326541">parseOperand</span><span class="op" id="5326553">(</span><span class="ident" id="5326554">lhs</span><span class="op" id="5326557">)</span><br>
<span class="lineno"></span><span class="ident" id="5326559">L</span><span class="op" id="5326560">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326563">for</span>&nbsp;<span class="op" id="5326567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326571">switch</span>&nbsp;<span class="ident" id="5326578">p</span><span class="op" id="5326579">.</span><span class="ident" id="5326580">tok</span>&nbsp;<span class="op" id="5326584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326588">case</span>&nbsp;<span class="ident" id="5326593">token</span><span class="op" id="5326598">.</span><span class="ident" id="5326599">PERIOD</span><span class="op" id="5326605">:</span><br>
<span class="lineno">1445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326610">p</span><span class="op" id="5326611">.</span><span class="ident" id="5326612">next</span><span class="op" id="5326616">(</span><span class="op" id="5326617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326622">if</span>&nbsp;<span class="ident" id="5326625">lhs</span>&nbsp;<span class="op" id="5326629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326635">p</span><span class="op" id="5326636">.</span><span class="ident" id="5326637">resolve</span><span class="op" id="5326644">(</span><span class="ident" id="5326645">x</span><span class="op" id="5326646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5326651">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326656">switch</span>&nbsp;<span class="ident" id="5326663">p</span><span class="op" id="5326664">.</span><span class="ident" id="5326665">tok</span>&nbsp;<span class="op" id="5326669">{</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326674">case</span>&nbsp;<span class="ident" id="5326679">token</span><span class="op" id="5326684">.</span><span class="ident" id="5326685">IDENT</span><span class="op" id="5326690">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326696">x</span>&nbsp;<span class="op" id="5326698">=</span>&nbsp;<span class="ident" id="5326700">p</span><span class="op" id="5326701">.</span><span class="ident" id="5326702">parseSelector</span><span class="op" id="5326715">(</span><span class="ident" id="5326716">p</span><span class="op" id="5326717">.</span><span class="ident" id="5326718">checkExprOrType</span><span class="op" id="5326733">(</span><span class="ident" id="5326734">x</span><span class="op" id="5326735">)</span><span class="op" id="5326736">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326741">case</span>&nbsp;<span class="ident" id="5326746">token</span><span class="op" id="5326751">.</span><span class="ident" id="5326752">LPAREN</span><span class="op" id="5326758">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326764">x</span>&nbsp;<span class="op" id="5326766">=</span>&nbsp;<span class="ident" id="5326768">p</span><span class="op" id="5326769">.</span><span class="ident" id="5326770">parseTypeAssertion</span><span class="op" id="5326788">(</span><span class="ident" id="5326789">p</span><span class="op" id="5326790">.</span><span class="ident" id="5326791">checkExpr</span><span class="op" id="5326800">(</span><span class="ident" id="5326801">x</span><span class="op" id="5326802">)</span><span class="op" id="5326803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326808">default</span><span class="op" id="5326815">:</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326821">pos</span>&nbsp;<span class="op" id="5326825">:=</span>&nbsp;<span class="ident" id="5326828">p</span><span class="op" id="5326829">.</span><span class="ident" id="5326830">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326838">p</span><span class="op" id="5326839">.</span><span class="ident" id="5326840">errorExpected</span><span class="op" id="5326853">(</span><span class="ident" id="5326854">pos</span><span class="op" id="5326857">,</span>&nbsp;<span class="string" id="5326859">&#34;selector&nbsp;or&nbsp;type&nbsp;assertion&#34;</span><span class="op" id="5326887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326893">p</span><span class="op" id="5326894">.</span><span class="ident" id="5326895">next</span><span class="op" id="5326899">(</span><span class="op" id="5326900">)</span>&nbsp;<span class="comment" id="5326902">//&nbsp;make&nbsp;progress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5326923">x</span>&nbsp;<span class="op" id="5326925">=</span>&nbsp;<span class="op" id="5326927">&amp;</span><span class="ident" id="5326928">ast</span><span class="op" id="5326931">.</span><span class="ident" id="5326932">BadExpr</span><span class="op" id="5326939">{</span><span class="ident" id="5326940">From</span><span class="op" id="5326944">:</span>&nbsp;<span class="ident" id="5326946">pos</span><span class="op" id="5326949">,</span>&nbsp;<span class="ident" id="5326951">To</span><span class="op" id="5326953">:</span>&nbsp;<span class="ident" id="5326955">p</span><span class="op" id="5326956">.</span><span class="ident" id="5326957">pos</span><span class="op" id="5326960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5326965">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326969">case</span>&nbsp;<span class="ident" id="5326974">token</span><span class="op" id="5326979">.</span><span class="ident" id="5326980">LBRACK</span><span class="op" id="5326986">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5326991">if</span>&nbsp;<span class="ident" id="5326994">lhs</span>&nbsp;<span class="op" id="5326998">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327004">p</span><span class="op" id="5327005">.</span><span class="ident" id="5327006">resolve</span><span class="op" id="5327013">(</span><span class="ident" id="5327014">x</span><span class="op" id="5327015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327025">x</span>&nbsp;<span class="op" id="5327027">=</span>&nbsp;<span class="ident" id="5327029">p</span><span class="op" id="5327030">.</span><span class="ident" id="5327031">parseIndexOrSlice</span><span class="op" id="5327048">(</span><span class="ident" id="5327049">p</span><span class="op" id="5327050">.</span><span class="ident" id="5327051">checkExpr</span><span class="op" id="5327060">(</span><span class="ident" id="5327061">x</span><span class="op" id="5327062">)</span><span class="op" id="5327063">)</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327067">case</span>&nbsp;<span class="ident" id="5327072">token</span><span class="op" id="5327077">.</span><span class="ident" id="5327078">LPAREN</span><span class="op" id="5327084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327089">if</span>&nbsp;<span class="ident" id="5327092">lhs</span>&nbsp;<span class="op" id="5327096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327102">p</span><span class="op" id="5327103">.</span><span class="ident" id="5327104">resolve</span><span class="op" id="5327111">(</span><span class="ident" id="5327112">x</span><span class="op" id="5327113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327123">x</span>&nbsp;<span class="op" id="5327125">=</span>&nbsp;<span class="ident" id="5327127">p</span><span class="op" id="5327128">.</span><span class="ident" id="5327129">parseCallOrConversion</span><span class="op" id="5327150">(</span><span class="ident" id="5327151">p</span><span class="op" id="5327152">.</span><span class="ident" id="5327153">checkExprOrType</span><span class="op" id="5327168">(</span><span class="ident" id="5327169">x</span><span class="op" id="5327170">)</span><span class="op" id="5327171">)</span><br>
<span class="lineno">1470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327175">case</span>&nbsp;<span class="ident" id="5327180">token</span><span class="op" id="5327185">.</span><span class="ident" id="5327186">LBRACE</span><span class="op" id="5327192">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327197">if</span>&nbsp;<span class="ident" id="5327200">isLiteralType</span><span class="op" id="5327213">(</span><span class="ident" id="5327214">x</span><span class="op" id="5327215">)</span>&nbsp;<span class="op" id="5327217">&amp;&amp;</span>&nbsp;<span class="op" id="5327220">(</span><span class="ident" id="5327221">p</span><span class="op" id="5327222">.</span><span class="ident" id="5327223">exprLev</span>&nbsp;<span class="op" id="5327231">&gt;=</span>&nbsp;<span class="num" id="5327234">0</span>&nbsp;<span class="op" id="5327236">||</span>&nbsp;<span class="op" id="5327239">!</span><span class="ident" id="5327240">isTypeName</span><span class="op" id="5327250">(</span><span class="ident" id="5327251">x</span><span class="op" id="5327252">)</span><span class="op" id="5327253">)</span>&nbsp;<span class="op" id="5327255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327261">if</span>&nbsp;<span class="ident" id="5327264">lhs</span>&nbsp;<span class="op" id="5327268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327275">p</span><span class="op" id="5327276">.</span><span class="ident" id="5327277">resolve</span><span class="op" id="5327284">(</span><span class="ident" id="5327285">x</span><span class="op" id="5327286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327292">}</span><br>
<span class="lineno">1475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327298">x</span>&nbsp;<span class="op" id="5327300">=</span>&nbsp;<span class="ident" id="5327302">p</span><span class="op" id="5327303">.</span><span class="ident" id="5327304">parseLiteralValue</span><span class="op" id="5327321">(</span><span class="ident" id="5327322">x</span><span class="op" id="5327323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327328">}</span>&nbsp;<span class="keyword" id="5327330">else</span>&nbsp;<span class="op" id="5327335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327341">break</span>&nbsp;<span class="ident" id="5327347">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327356">default</span><span class="op" id="5327363">:</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327368">break</span>&nbsp;<span class="ident" id="5327374">L</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327382">lhs</span>&nbsp;<span class="op" id="5327386">=</span>&nbsp;<span class="builtintype" id="5327388">false</span>&nbsp;<span class="comment" id="5327394">//&nbsp;no&nbsp;need&nbsp;to&nbsp;try&nbsp;to&nbsp;resolve&nbsp;again</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327434">return</span>&nbsp;<span class="ident" id="5327441">x</span><br>
<span class="lineno"></span><span class="op" id="5327443">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5327446">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5327516">func</span>&nbsp;<span class="op" id="5327521">(</span><span class="ident" id="5327522">p</span>&nbsp;<span class="op" id="5327524">*</span><span class="ident" id="5327525">parser</span><span class="op" id="5327531">)</span>&nbsp;<span class="ident" id="5327533">parseUnaryExpr</span><span class="op" id="5327547">(</span><span class="ident" id="5327548">lhs</span>&nbsp;<span class="builtintype" id="5327552">bool</span><span class="op" id="5327556">)</span>&nbsp;<span class="ident" id="5327558">ast</span><span class="op" id="5327561">.</span><span class="ident" id="5327562">Expr</span>&nbsp;<span class="op" id="5327567">{</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327570">if</span>&nbsp;<span class="ident" id="5327573">p</span><span class="op" id="5327574">.</span><span class="ident" id="5327575">trace</span>&nbsp;<span class="op" id="5327581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327585">defer</span>&nbsp;<span class="ident" id="5327591">un</span><span class="op" id="5327593">(</span><span class="ident" id="5327594">trace</span><span class="op" id="5327599">(</span><span class="ident" id="5327600">p</span><span class="op" id="5327601">,</span>&nbsp;<span class="string" id="5327603">&#34;UnaryExpr&#34;</span><span class="op" id="5327614">)</span><span class="op" id="5327615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5327618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327622">switch</span>&nbsp;<span class="ident" id="5327629">p</span><span class="op" id="5327630">.</span><span class="ident" id="5327631">tok</span>&nbsp;<span class="op" id="5327635">{</span><br>
<span class="lineno">1495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327638">case</span>&nbsp;<span class="ident" id="5327643">token</span><span class="op" id="5327648">.</span><span class="ident" id="5327649">ADD</span><span class="op" id="5327652">,</span>&nbsp;<span class="ident" id="5327654">token</span><span class="op" id="5327659">.</span><span class="ident" id="5327660">SUB</span><span class="op" id="5327663">,</span>&nbsp;<span class="ident" id="5327665">token</span><span class="op" id="5327670">.</span><span class="ident" id="5327671">NOT</span><span class="op" id="5327674">,</span>&nbsp;<span class="ident" id="5327676">token</span><span class="op" id="5327681">.</span><span class="ident" id="5327682">XOR</span><span class="op" id="5327685">,</span>&nbsp;<span class="ident" id="5327687">token</span><span class="op" id="5327692">.</span><span class="ident" id="5327693">AND</span><span class="op" id="5327696">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327700">pos</span><span class="op" id="5327703">,</span>&nbsp;<span class="ident" id="5327705">op</span>&nbsp;<span class="op" id="5327708">:=</span>&nbsp;<span class="ident" id="5327711">p</span><span class="op" id="5327712">.</span><span class="ident" id="5327713">pos</span><span class="op" id="5327716">,</span>&nbsp;<span class="ident" id="5327718">p</span><span class="op" id="5327719">.</span><span class="ident" id="5327720">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327726">p</span><span class="op" id="5327727">.</span><span class="ident" id="5327728">next</span><span class="op" id="5327732">(</span><span class="op" id="5327733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327737">x</span>&nbsp;<span class="op" id="5327739">:=</span>&nbsp;<span class="ident" id="5327742">p</span><span class="op" id="5327743">.</span><span class="ident" id="5327744">parseUnaryExpr</span><span class="op" id="5327758">(</span><span class="builtintype" id="5327759">false</span><span class="op" id="5327764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327768">return</span>&nbsp;<span class="op" id="5327775">&amp;</span><span class="ident" id="5327776">ast</span><span class="op" id="5327779">.</span><span class="ident" id="5327780">UnaryExpr</span><span class="op" id="5327789">{</span><span class="ident" id="5327790">OpPos</span><span class="op" id="5327795">:</span>&nbsp;<span class="ident" id="5327797">pos</span><span class="op" id="5327800">,</span>&nbsp;<span class="ident" id="5327802">Op</span><span class="op" id="5327804">:</span>&nbsp;<span class="ident" id="5327806">op</span><span class="op" id="5327808">,</span>&nbsp;<span class="ident" id="5327810">X</span><span class="op" id="5327811">:</span>&nbsp;<span class="ident" id="5327813">p</span><span class="op" id="5327814">.</span><span class="ident" id="5327815">checkExpr</span><span class="op" id="5327824">(</span><span class="ident" id="5327825">x</span><span class="op" id="5327826">)</span><span class="op" id="5327827">}</span><br>
<span class="lineno">1500</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5327831">case</span>&nbsp;<span class="ident" id="5327836">token</span><span class="op" id="5327841">.</span><span class="ident" id="5327842">ARROW</span><span class="op" id="5327847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5327851">//&nbsp;channel&nbsp;type&nbsp;or&nbsp;receive&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327891">arrow</span>&nbsp;<span class="op" id="5327897">:=</span>&nbsp;<span class="ident" id="5327900">p</span><span class="op" id="5327901">.</span><span class="ident" id="5327902">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5327908">p</span><span class="op" id="5327909">.</span><span class="ident" id="5327910">next</span><span class="op" id="5327914">(</span><span class="op" id="5327915">)</span><br>
<span class="lineno">1505</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5327920">//&nbsp;If&nbsp;the&nbsp;next&nbsp;token&nbsp;is&nbsp;token.CHAN&nbsp;we&nbsp;still&nbsp;don&#39;t&nbsp;know&nbsp;if&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5327983">//&nbsp;is&nbsp;a&nbsp;channel&nbsp;type&nbsp;or&nbsp;a&nbsp;receive&nbsp;operation&nbsp;-&nbsp;we&nbsp;only&nbsp;know</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328044">//&nbsp;once&nbsp;we&nbsp;have&nbsp;found&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;unary&nbsp;expression.&nbsp;There</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328107">//&nbsp;are&nbsp;two&nbsp;cases:</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328127">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328132">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;type&nbsp;&nbsp;=&gt;&nbsp;(&lt;-type)&nbsp;must&nbsp;be&nbsp;channel&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328181">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;expr&nbsp;&nbsp;=&gt;&nbsp;&lt;-(expr)&nbsp;is&nbsp;a&nbsp;receive&nbsp;from&nbsp;an&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328241">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328246">//&nbsp;In&nbsp;the&nbsp;first&nbsp;case,&nbsp;the&nbsp;arrow&nbsp;must&nbsp;be&nbsp;re-associated&nbsp;with</span><br>
<span class="lineno">1515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328307">//&nbsp;the&nbsp;channel&nbsp;type&nbsp;parsed&nbsp;already:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328345">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328350">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&nbsp;type)&nbsp;&nbsp;&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;type)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328393">//&nbsp;&nbsp;&nbsp;&lt;-&nbsp;(chan&lt;-&nbsp;type)&nbsp;&nbsp;=&gt;&nbsp;&nbsp;(&lt;-chan&nbsp;(&lt;-type))</span><br>
<span class="lineno"></span><br>
<span class="lineno">1520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328441">x</span>&nbsp;<span class="op" id="5328443">:=</span>&nbsp;<span class="ident" id="5328446">p</span><span class="op" id="5328447">.</span><span class="ident" id="5328448">parseUnaryExpr</span><span class="op" id="5328462">(</span><span class="builtintype" id="5328463">false</span><span class="op" id="5328468">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328473">//&nbsp;determine&nbsp;which&nbsp;case&nbsp;we&nbsp;have</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328507">if</span>&nbsp;<span class="ident" id="5328510">typ</span><span class="op" id="5328513">,</span>&nbsp;<span class="ident" id="5328515">ok</span>&nbsp;<span class="op" id="5328518">:=</span>&nbsp;<span class="ident" id="5328521">x</span><span class="op" id="5328522">.</span><span class="op" id="5328523">(</span><span class="op" id="5328524">*</span><span class="ident" id="5328525">ast</span><span class="op" id="5328528">.</span><span class="ident" id="5328529">ChanType</span><span class="op" id="5328537">)</span><span class="op" id="5328538">;</span>&nbsp;<span class="ident" id="5328540">ok</span>&nbsp;<span class="op" id="5328543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328548">//&nbsp;(&lt;-type)</span><br>
<span class="lineno">1525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328564">//&nbsp;re-associate&nbsp;position&nbsp;info&nbsp;and&nbsp;&lt;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328604">dir</span>&nbsp;<span class="op" id="5328608">:=</span>&nbsp;<span class="ident" id="5328611">ast</span><span class="op" id="5328614">.</span><span class="ident" id="5328615">SEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328623">for</span>&nbsp;<span class="ident" id="5328627">ok</span>&nbsp;<span class="op" id="5328630">&amp;&amp;</span>&nbsp;<span class="ident" id="5328633">dir</span>&nbsp;<span class="op" id="5328637">==</span>&nbsp;<span class="ident" id="5328640">ast</span><span class="op" id="5328643">.</span><span class="ident" id="5328644">SEND</span>&nbsp;<span class="op" id="5328649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328655">if</span>&nbsp;<span class="ident" id="5328658">typ</span><span class="op" id="5328661">.</span><span class="ident" id="5328662">Dir</span>&nbsp;<span class="op" id="5328666">==</span>&nbsp;<span class="ident" id="5328669">ast</span><span class="op" id="5328672">.</span><span class="ident" id="5328673">RECV</span>&nbsp;<span class="op" id="5328678">{</span><br>
<span class="lineno">1530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5328685">//&nbsp;error:&nbsp;(&lt;-type)&nbsp;is&nbsp;(&lt;-(&lt;-chan&nbsp;T))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328727">p</span><span class="op" id="5328728">.</span><span class="ident" id="5328729">errorExpected</span><span class="op" id="5328742">(</span><span class="ident" id="5328743">typ</span><span class="op" id="5328746">.</span><span class="ident" id="5328747">Arrow</span><span class="op" id="5328752">,</span>&nbsp;<span class="string" id="5328754">&#34;&#39;chan&#39;&#34;</span><span class="op" id="5328762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328774">arrow</span><span class="op" id="5328779">,</span>&nbsp;<span class="ident" id="5328781">typ</span><span class="op" id="5328784">.</span><span class="ident" id="5328785">Begin</span><span class="op" id="5328790">,</span>&nbsp;<span class="ident" id="5328792">typ</span><span class="op" id="5328795">.</span><span class="ident" id="5328796">Arrow</span>&nbsp;<span class="op" id="5328802">=</span>&nbsp;<span class="ident" id="5328804">typ</span><span class="op" id="5328807">.</span><span class="ident" id="5328808">Arrow</span><span class="op" id="5328813">,</span>&nbsp;<span class="ident" id="5328815">arrow</span><span class="op" id="5328820">,</span>&nbsp;<span class="ident" id="5328822">arrow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328832">dir</span><span class="op" id="5328835">,</span>&nbsp;<span class="ident" id="5328837">typ</span><span class="op" id="5328840">.</span><span class="ident" id="5328841">Dir</span>&nbsp;<span class="op" id="5328845">=</span>&nbsp;<span class="ident" id="5328847">typ</span><span class="op" id="5328850">.</span><span class="ident" id="5328851">Dir</span><span class="op" id="5328854">,</span>&nbsp;<span class="ident" id="5328856">ast</span><span class="op" id="5328859">.</span><span class="ident" id="5328860">RECV</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328869">typ</span><span class="op" id="5328872">,</span>&nbsp;<span class="ident" id="5328874">ok</span>&nbsp;<span class="op" id="5328877">=</span>&nbsp;<span class="ident" id="5328879">typ</span><span class="op" id="5328882">.</span><span class="ident" id="5328883">Value</span><span class="op" id="5328888">.</span><span class="op" id="5328889">(</span><span class="op" id="5328890">*</span><span class="ident" id="5328891">ast</span><span class="op" id="5328894">.</span><span class="ident" id="5328895">ChanType</span><span class="op" id="5328903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328913">if</span>&nbsp;<span class="ident" id="5328916">dir</span>&nbsp;<span class="op" id="5328920">==</span>&nbsp;<span class="ident" id="5328923">ast</span><span class="op" id="5328926">.</span><span class="ident" id="5328927">SEND</span>&nbsp;<span class="op" id="5328932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5328938">p</span><span class="op" id="5328939">.</span><span class="ident" id="5328940">errorExpected</span><span class="op" id="5328953">(</span><span class="ident" id="5328954">arrow</span><span class="op" id="5328959">,</span>&nbsp;<span class="string" id="5328961">&#34;channel&nbsp;type&#34;</span><span class="op" id="5328975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328980">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5328986">return</span>&nbsp;<span class="ident" id="5328993">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5328997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5329002">//&nbsp;&lt;-(expr)</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329016">return</span>&nbsp;<span class="op" id="5329023">&amp;</span><span class="ident" id="5329024">ast</span><span class="op" id="5329027">.</span><span class="ident" id="5329028">UnaryExpr</span><span class="op" id="5329037">{</span><span class="ident" id="5329038">OpPos</span><span class="op" id="5329043">:</span>&nbsp;<span class="ident" id="5329045">arrow</span><span class="op" id="5329050">,</span>&nbsp;<span class="ident" id="5329052">Op</span><span class="op" id="5329054">:</span>&nbsp;<span class="ident" id="5329056">token</span><span class="op" id="5329061">.</span><span class="ident" id="5329062">ARROW</span><span class="op" id="5329067">,</span>&nbsp;<span class="ident" id="5329069">X</span><span class="op" id="5329070">:</span>&nbsp;<span class="ident" id="5329072">p</span><span class="op" id="5329073">.</span><span class="ident" id="5329074">checkExpr</span><span class="op" id="5329083">(</span><span class="ident" id="5329084">x</span><span class="op" id="5329085">)</span><span class="op" id="5329086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329090">case</span>&nbsp;<span class="ident" id="5329095">token</span><span class="op" id="5329100">.</span><span class="ident" id="5329101">MUL</span><span class="op" id="5329104">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5329108">//&nbsp;pointer&nbsp;type&nbsp;or&nbsp;unary&nbsp;&#34;*&#34;&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329150">pos</span>&nbsp;<span class="op" id="5329154">:=</span>&nbsp;<span class="ident" id="5329157">p</span><span class="op" id="5329158">.</span><span class="ident" id="5329159">pos</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329165">p</span><span class="op" id="5329166">.</span><span class="ident" id="5329167">next</span><span class="op" id="5329171">(</span><span class="op" id="5329172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329176">x</span>&nbsp;<span class="op" id="5329178">:=</span>&nbsp;<span class="ident" id="5329181">p</span><span class="op" id="5329182">.</span><span class="ident" id="5329183">parseUnaryExpr</span><span class="op" id="5329197">(</span><span class="builtintype" id="5329198">false</span><span class="op" id="5329203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329207">return</span>&nbsp;<span class="op" id="5329214">&amp;</span><span class="ident" id="5329215">ast</span><span class="op" id="5329218">.</span><span class="ident" id="5329219">StarExpr</span><span class="op" id="5329227">{</span><span class="ident" id="5329228">Star</span><span class="op" id="5329232">:</span>&nbsp;<span class="ident" id="5329234">pos</span><span class="op" id="5329237">,</span>&nbsp;<span class="ident" id="5329239">X</span><span class="op" id="5329240">:</span>&nbsp;<span class="ident" id="5329242">p</span><span class="op" id="5329243">.</span><span class="ident" id="5329244">checkExprOrType</span><span class="op" id="5329259">(</span><span class="ident" id="5329260">x</span><span class="op" id="5329261">)</span><span class="op" id="5329262">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1555</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329269">return</span>&nbsp;<span class="ident" id="5329276">p</span><span class="op" id="5329277">.</span><span class="ident" id="5329278">parsePrimaryExpr</span><span class="op" id="5329294">(</span><span class="ident" id="5329295">lhs</span><span class="op" id="5329298">)</span><br>
<span class="lineno"></span><span class="op" id="5329300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5329303">func</span>&nbsp;<span class="op" id="5329308">(</span><span class="ident" id="5329309">p</span>&nbsp;<span class="op" id="5329311">*</span><span class="ident" id="5329312">parser</span><span class="op" id="5329318">)</span>&nbsp;<span class="ident" id="5329320">tokPrec</span><span class="op" id="5329327">(</span><span class="op" id="5329328">)</span>&nbsp;<span class="op" id="5329330">(</span><span class="ident" id="5329331">token</span><span class="op" id="5329336">.</span><span class="ident" id="5329337">Token</span><span class="op" id="5329342">,</span>&nbsp;<span class="builtintype" id="5329344">int</span><span class="op" id="5329347">)</span>&nbsp;<span class="op" id="5329349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329352">tok</span>&nbsp;<span class="op" id="5329356">:=</span>&nbsp;<span class="ident" id="5329359">p</span><span class="op" id="5329360">.</span><span class="ident" id="5329361">tok</span><br>
<span class="lineno">1560</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329366">if</span>&nbsp;<span class="ident" id="5329369">p</span><span class="op" id="5329370">.</span><span class="ident" id="5329371">inRhs</span>&nbsp;<span class="op" id="5329377">&amp;&amp;</span>&nbsp;<span class="ident" id="5329380">tok</span>&nbsp;<span class="op" id="5329384">==</span>&nbsp;<span class="ident" id="5329387">token</span><span class="op" id="5329392">.</span><span class="ident" id="5329393">ASSIGN</span>&nbsp;<span class="op" id="5329400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329404">tok</span>&nbsp;<span class="op" id="5329408">=</span>&nbsp;<span class="ident" id="5329410">token</span><span class="op" id="5329415">.</span><span class="ident" id="5329416">EQL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329424">return</span>&nbsp;<span class="ident" id="5329431">tok</span><span class="op" id="5329434">,</span>&nbsp;<span class="ident" id="5329436">tok</span><span class="op" id="5329439">.</span><span class="ident" id="5329440">Precedence</span><span class="op" id="5329450">(</span><span class="op" id="5329451">)</span><br>
<span class="lineno"></span><span class="op" id="5329453">}</span><br>
<span class="lineno">1565</span><br>
<span class="lineno"></span><span class="comment" id="5329456">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="keyword" id="5329526">func</span>&nbsp;<span class="op" id="5329531">(</span><span class="ident" id="5329532">p</span>&nbsp;<span class="op" id="5329534">*</span><span class="ident" id="5329535">parser</span><span class="op" id="5329541">)</span>&nbsp;<span class="ident" id="5329543">parseBinaryExpr</span><span class="op" id="5329558">(</span><span class="ident" id="5329559">lhs</span>&nbsp;<span class="builtintype" id="5329563">bool</span><span class="op" id="5329567">,</span>&nbsp;<span class="ident" id="5329569">prec1</span>&nbsp;<span class="builtintype" id="5329575">int</span><span class="op" id="5329578">)</span>&nbsp;<span class="ident" id="5329580">ast</span><span class="op" id="5329583">.</span><span class="ident" id="5329584">Expr</span>&nbsp;<span class="op" id="5329589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329592">if</span>&nbsp;<span class="ident" id="5329595">p</span><span class="op" id="5329596">.</span><span class="ident" id="5329597">trace</span>&nbsp;<span class="op" id="5329603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329607">defer</span>&nbsp;<span class="ident" id="5329613">un</span><span class="op" id="5329615">(</span><span class="ident" id="5329616">trace</span><span class="op" id="5329621">(</span><span class="ident" id="5329622">p</span><span class="op" id="5329623">,</span>&nbsp;<span class="string" id="5329625">&#34;BinaryExpr&#34;</span><span class="op" id="5329637">)</span><span class="op" id="5329638">)</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329645">x</span>&nbsp;<span class="op" id="5329647">:=</span>&nbsp;<span class="ident" id="5329650">p</span><span class="op" id="5329651">.</span><span class="ident" id="5329652">parseUnaryExpr</span><span class="op" id="5329666">(</span><span class="ident" id="5329667">lhs</span><span class="op" id="5329670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329673">for</span>&nbsp;<span class="ident" id="5329677">_</span><span class="op" id="5329678">,</span>&nbsp;<span class="ident" id="5329680">prec</span>&nbsp;<span class="op" id="5329685">:=</span>&nbsp;<span class="ident" id="5329688">p</span><span class="op" id="5329689">.</span><span class="ident" id="5329690">tokPrec</span><span class="op" id="5329697">(</span><span class="op" id="5329698">)</span><span class="op" id="5329699">;</span>&nbsp;<span class="ident" id="5329701">prec</span>&nbsp;<span class="op" id="5329706">&gt;=</span>&nbsp;<span class="ident" id="5329709">prec1</span><span class="op" id="5329714">;</span>&nbsp;<span class="ident" id="5329716">prec</span><span class="op" id="5329720">--</span>&nbsp;<span class="op" id="5329723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329727">for</span>&nbsp;<span class="op" id="5329731">{</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329736">op</span><span class="op" id="5329738">,</span>&nbsp;<span class="ident" id="5329740">oprec</span>&nbsp;<span class="op" id="5329746">:=</span>&nbsp;<span class="ident" id="5329749">p</span><span class="op" id="5329750">.</span><span class="ident" id="5329751">tokPrec</span><span class="op" id="5329758">(</span><span class="op" id="5329759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329764">if</span>&nbsp;<span class="ident" id="5329767">oprec</span>&nbsp;<span class="op" id="5329773">!=</span>&nbsp;<span class="ident" id="5329776">prec</span>&nbsp;<span class="op" id="5329781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329787">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329796">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329801">pos</span>&nbsp;<span class="op" id="5329805">:=</span>&nbsp;<span class="ident" id="5329808">p</span><span class="op" id="5329809">.</span><span class="ident" id="5329810">expect</span><span class="op" id="5329816">(</span><span class="ident" id="5329817">op</span><span class="op" id="5329819">)</span><br>
<span class="lineno">1580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5329824">if</span>&nbsp;<span class="ident" id="5329827">lhs</span>&nbsp;<span class="op" id="5329831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329837">p</span><span class="op" id="5329838">.</span><span class="ident" id="5329839">resolve</span><span class="op" id="5329846">(</span><span class="ident" id="5329847">x</span><span class="op" id="5329848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329854">lhs</span>&nbsp;<span class="op" id="5329858">=</span>&nbsp;<span class="builtintype" id="5329860">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329874">y</span>&nbsp;<span class="op" id="5329876">:=</span>&nbsp;<span class="ident" id="5329879">p</span><span class="op" id="5329880">.</span><span class="ident" id="5329881">parseBinaryExpr</span><span class="op" id="5329896">(</span><span class="builtintype" id="5329897">false</span><span class="op" id="5329902">,</span>&nbsp;<span class="ident" id="5329904">prec</span><span class="op" id="5329908">+</span><span class="num" id="5329909">1</span><span class="op" id="5329910">)</span><br>
<span class="lineno">1585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5329915">x</span>&nbsp;<span class="op" id="5329917">=</span>&nbsp;<span class="op" id="5329919">&amp;</span><span class="ident" id="5329920">ast</span><span class="op" id="5329923">.</span><span class="ident" id="5329924">BinaryExpr</span><span class="op" id="5329934">{</span><span class="ident" id="5329935">X</span><span class="op" id="5329936">:</span>&nbsp;<span class="ident" id="5329938">p</span><span class="op" id="5329939">.</span><span class="ident" id="5329940">checkExpr</span><span class="op" id="5329949">(</span><span class="ident" id="5329950">x</span><span class="op" id="5329951">)</span><span class="op" id="5329952">,</span>&nbsp;<span class="ident" id="5329954">OpPos</span><span class="op" id="5329959">:</span>&nbsp;<span class="ident" id="5329961">pos</span><span class="op" id="5329964">,</span>&nbsp;<span class="ident" id="5329966">Op</span><span class="op" id="5329968">:</span>&nbsp;<span class="ident" id="5329970">op</span><span class="op" id="5329972">,</span>&nbsp;<span class="ident" id="5329974">Y</span><span class="op" id="5329975">:</span>&nbsp;<span class="ident" id="5329977">p</span><span class="op" id="5329978">.</span><span class="ident" id="5329979">checkExpr</span><span class="op" id="5329988">(</span><span class="ident" id="5329989">y</span><span class="op" id="5329990">)</span><span class="op" id="5329991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5329998">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330002">return</span>&nbsp;<span class="ident" id="5330009">x</span><br>
<span class="lineno">1590</span><span class="op" id="5330011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5330014">//&nbsp;If&nbsp;lhs&nbsp;is&nbsp;set&nbsp;and&nbsp;the&nbsp;result&nbsp;is&nbsp;an&nbsp;identifier,&nbsp;it&nbsp;is&nbsp;not&nbsp;resolved.</span><br>
<span class="lineno"></span><span class="comment" id="5330084">//&nbsp;The&nbsp;result&nbsp;may&nbsp;be&nbsp;a&nbsp;type&nbsp;or&nbsp;even&nbsp;a&nbsp;raw&nbsp;type&nbsp;([...]int).&nbsp;Callers&nbsp;must</span><br>
<span class="lineno"></span><span class="comment" id="5330156">//&nbsp;check&nbsp;the&nbsp;result&nbsp;(using&nbsp;checkExpr&nbsp;or&nbsp;checkExprOrType),&nbsp;depending&nbsp;on</span><br>
<span class="lineno">1595</span><span class="comment" id="5330227">//&nbsp;context.</span><br>
<span class="lineno"></span><span class="keyword" id="5330239">func</span>&nbsp;<span class="op" id="5330244">(</span><span class="ident" id="5330245">p</span>&nbsp;<span class="op" id="5330247">*</span><span class="ident" id="5330248">parser</span><span class="op" id="5330254">)</span>&nbsp;<span class="ident" id="5330256">parseExpr</span><span class="op" id="5330265">(</span><span class="ident" id="5330266">lhs</span>&nbsp;<span class="builtintype" id="5330270">bool</span><span class="op" id="5330274">)</span>&nbsp;<span class="ident" id="5330276">ast</span><span class="op" id="5330279">.</span><span class="ident" id="5330280">Expr</span>&nbsp;<span class="op" id="5330285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330288">if</span>&nbsp;<span class="ident" id="5330291">p</span><span class="op" id="5330292">.</span><span class="ident" id="5330293">trace</span>&nbsp;<span class="op" id="5330299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330303">defer</span>&nbsp;<span class="ident" id="5330309">un</span><span class="op" id="5330311">(</span><span class="ident" id="5330312">trace</span><span class="op" id="5330317">(</span><span class="ident" id="5330318">p</span><span class="op" id="5330319">,</span>&nbsp;<span class="string" id="5330321">&#34;Expression&#34;</span><span class="op" id="5330333">)</span><span class="op" id="5330334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5330337">}</span><br>
<span class="lineno">1600</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330341">return</span>&nbsp;<span class="ident" id="5330348">p</span><span class="op" id="5330349">.</span><span class="ident" id="5330350">parseBinaryExpr</span><span class="op" id="5330365">(</span><span class="ident" id="5330366">lhs</span><span class="op" id="5330369">,</span>&nbsp;<span class="ident" id="5330371">token</span><span class="op" id="5330376">.</span><span class="ident" id="5330377">LowestPrec</span><span class="op" id="5330387">+</span><span class="num" id="5330388">1</span><span class="op" id="5330389">)</span><br>
<span class="lineno"></span><span class="op" id="5330391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5330394">func</span>&nbsp;<span class="op" id="5330399">(</span><span class="ident" id="5330400">p</span>&nbsp;<span class="op" id="5330402">*</span><span class="ident" id="5330403">parser</span><span class="op" id="5330409">)</span>&nbsp;<span class="ident" id="5330411">parseRhs</span><span class="op" id="5330419">(</span><span class="op" id="5330420">)</span>&nbsp;<span class="ident" id="5330422">ast</span><span class="op" id="5330425">.</span><span class="ident" id="5330426">Expr</span>&nbsp;<span class="op" id="5330431">{</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330434">old</span>&nbsp;<span class="op" id="5330438">:=</span>&nbsp;<span class="ident" id="5330441">p</span><span class="op" id="5330442">.</span><span class="ident" id="5330443">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330450">p</span><span class="op" id="5330451">.</span><span class="ident" id="5330452">inRhs</span>&nbsp;<span class="op" id="5330458">=</span>&nbsp;<span class="builtintype" id="5330460">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330466">x</span>&nbsp;<span class="op" id="5330468">:=</span>&nbsp;<span class="ident" id="5330471">p</span><span class="op" id="5330472">.</span><span class="ident" id="5330473">checkExpr</span><span class="op" id="5330482">(</span><span class="ident" id="5330483">p</span><span class="op" id="5330484">.</span><span class="ident" id="5330485">parseExpr</span><span class="op" id="5330494">(</span><span class="builtintype" id="5330495">false</span><span class="op" id="5330500">)</span><span class="op" id="5330501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330504">p</span><span class="op" id="5330505">.</span><span class="ident" id="5330506">inRhs</span>&nbsp;<span class="op" id="5330512">=</span>&nbsp;<span class="ident" id="5330514">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330519">return</span>&nbsp;<span class="ident" id="5330526">x</span><br>
<span class="lineno">1610</span><span class="op" id="5330528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5330531">func</span>&nbsp;<span class="op" id="5330536">(</span><span class="ident" id="5330537">p</span>&nbsp;<span class="op" id="5330539">*</span><span class="ident" id="5330540">parser</span><span class="op" id="5330546">)</span>&nbsp;<span class="ident" id="5330548">parseRhsOrType</span><span class="op" id="5330562">(</span><span class="op" id="5330563">)</span>&nbsp;<span class="ident" id="5330565">ast</span><span class="op" id="5330568">.</span><span class="ident" id="5330569">Expr</span>&nbsp;<span class="op" id="5330574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330577">old</span>&nbsp;<span class="op" id="5330581">:=</span>&nbsp;<span class="ident" id="5330584">p</span><span class="op" id="5330585">.</span><span class="ident" id="5330586">inRhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330593">p</span><span class="op" id="5330594">.</span><span class="ident" id="5330595">inRhs</span>&nbsp;<span class="op" id="5330601">=</span>&nbsp;<span class="builtintype" id="5330603">true</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330609">x</span>&nbsp;<span class="op" id="5330611">:=</span>&nbsp;<span class="ident" id="5330614">p</span><span class="op" id="5330615">.</span><span class="ident" id="5330616">checkExprOrType</span><span class="op" id="5330631">(</span><span class="ident" id="5330632">p</span><span class="op" id="5330633">.</span><span class="ident" id="5330634">parseExpr</span><span class="op" id="5330643">(</span><span class="builtintype" id="5330644">false</span><span class="op" id="5330649">)</span><span class="op" id="5330650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330653">p</span><span class="op" id="5330654">.</span><span class="ident" id="5330655">inRhs</span>&nbsp;<span class="op" id="5330661">=</span>&nbsp;<span class="ident" id="5330663">old</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5330668">return</span>&nbsp;<span class="ident" id="5330675">x</span><br>
<span class="lineno"></span><span class="op" id="5330677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1620</span><span class="comment" id="5330680">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5330760">//&nbsp;Statements</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5330775">//&nbsp;Parsing&nbsp;modes&nbsp;for&nbsp;parseSimpleStmt.</span><br>
<span class="lineno"></span><span class="keyword" id="5330813">const</span>&nbsp;<span class="op" id="5330819">(</span><br>
<span class="lineno">1625</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330822">basic</span>&nbsp;<span class="op" id="5330828">=</span>&nbsp;<span class="ident" id="5330830">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330836">labelOk</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5330845">rangeOk</span><br>
<span class="lineno"></span><span class="op" id="5330853">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1630</span><span class="comment" id="5330856">//&nbsp;parseSimpleStmt&nbsp;returns&nbsp;true&nbsp;as&nbsp;2nd&nbsp;result&nbsp;if&nbsp;it&nbsp;parsed&nbsp;the&nbsp;assignment</span><br>
<span class="lineno"></span><span class="comment" id="5330930">//&nbsp;of&nbsp;a&nbsp;range&nbsp;clause&nbsp;(with&nbsp;mode&nbsp;==&nbsp;rangeOk).&nbsp;The&nbsp;returned&nbsp;statement&nbsp;is&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="5331004">//&nbsp;assignment&nbsp;with&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5331078">//&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;.&nbsp;No&nbsp;guarantees&nbsp;are&nbsp;given&nbsp;for&nbsp;the&nbsp;left-hand&nbsp;side.</span><br>
<span class="lineno"></span><span class="keyword" id="5331149">func</span>&nbsp;<span class="op" id="5331154">(</span><span class="ident" id="5331155">p</span>&nbsp;<span class="op" id="5331157">*</span><span class="ident" id="5331158">parser</span><span class="op" id="5331164">)</span>&nbsp;<span class="ident" id="5331166">parseSimpleStmt</span><span class="op" id="5331181">(</span><span class="ident" id="5331182">mode</span>&nbsp;<span class="builtintype" id="5331187">int</span><span class="op" id="5331190">)</span>&nbsp;<span class="op" id="5331192">(</span><span class="ident" id="5331193">ast</span><span class="op" id="5331196">.</span><span class="ident" id="5331197">Stmt</span><span class="op" id="5331201">,</span>&nbsp;<span class="builtintype" id="5331203">bool</span><span class="op" id="5331207">)</span>&nbsp;<span class="op" id="5331209">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331212">if</span>&nbsp;<span class="ident" id="5331215">p</span><span class="op" id="5331216">.</span><span class="ident" id="5331217">trace</span>&nbsp;<span class="op" id="5331223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331227">defer</span>&nbsp;<span class="ident" id="5331233">un</span><span class="op" id="5331235">(</span><span class="ident" id="5331236">trace</span><span class="op" id="5331241">(</span><span class="ident" id="5331242">p</span><span class="op" id="5331243">,</span>&nbsp;<span class="string" id="5331245">&#34;SimpleStmt&#34;</span><span class="op" id="5331257">)</span><span class="op" id="5331258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331261">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331265">x</span>&nbsp;<span class="op" id="5331267">:=</span>&nbsp;<span class="ident" id="5331270">p</span><span class="op" id="5331271">.</span><span class="ident" id="5331272">parseLhsList</span><span class="op" id="5331284">(</span><span class="op" id="5331285">)</span><br>
<span class="lineno">1640</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331289">switch</span>&nbsp;<span class="ident" id="5331296">p</span><span class="op" id="5331297">.</span><span class="ident" id="5331298">tok</span>&nbsp;<span class="op" id="5331302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331305">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331312">token</span><span class="op" id="5331317">.</span><span class="ident" id="5331318">DEFINE</span><span class="op" id="5331324">,</span>&nbsp;<span class="ident" id="5331326">token</span><span class="op" id="5331331">.</span><span class="ident" id="5331332">ASSIGN</span><span class="op" id="5331338">,</span>&nbsp;<span class="ident" id="5331340">token</span><span class="op" id="5331345">.</span><span class="ident" id="5331346">ADD_ASSIGN</span><span class="op" id="5331356">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331360">token</span><span class="op" id="5331365">.</span><span class="ident" id="5331366">SUB_ASSIGN</span><span class="op" id="5331376">,</span>&nbsp;<span class="ident" id="5331378">token</span><span class="op" id="5331383">.</span><span class="ident" id="5331384">MUL_ASSIGN</span><span class="op" id="5331394">,</span>&nbsp;<span class="ident" id="5331396">token</span><span class="op" id="5331401">.</span><span class="ident" id="5331402">QUO_ASSIGN</span><span class="op" id="5331412">,</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331416">token</span><span class="op" id="5331421">.</span><span class="ident" id="5331422">REM_ASSIGN</span><span class="op" id="5331432">,</span>&nbsp;<span class="ident" id="5331434">token</span><span class="op" id="5331439">.</span><span class="ident" id="5331440">AND_ASSIGN</span><span class="op" id="5331450">,</span>&nbsp;<span class="ident" id="5331452">token</span><span class="op" id="5331457">.</span><span class="ident" id="5331458">OR_ASSIGN</span><span class="op" id="5331467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331471">token</span><span class="op" id="5331476">.</span><span class="ident" id="5331477">XOR_ASSIGN</span><span class="op" id="5331487">,</span>&nbsp;<span class="ident" id="5331489">token</span><span class="op" id="5331494">.</span><span class="ident" id="5331495">SHL_ASSIGN</span><span class="op" id="5331505">,</span>&nbsp;<span class="ident" id="5331507">token</span><span class="op" id="5331512">.</span><span class="ident" id="5331513">SHR_ASSIGN</span><span class="op" id="5331523">,</span>&nbsp;<span class="ident" id="5331525">token</span><span class="op" id="5331530">.</span><span class="ident" id="5331531">AND_NOT_ASSIGN</span><span class="op" id="5331545">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5331549">//&nbsp;assignment&nbsp;statement,&nbsp;possibly&nbsp;part&nbsp;of&nbsp;a&nbsp;range&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331608">pos</span><span class="op" id="5331611">,</span>&nbsp;<span class="ident" id="5331613">tok</span>&nbsp;<span class="op" id="5331617">:=</span>&nbsp;<span class="ident" id="5331620">p</span><span class="op" id="5331621">.</span><span class="ident" id="5331622">pos</span><span class="op" id="5331625">,</span>&nbsp;<span class="ident" id="5331627">p</span><span class="op" id="5331628">.</span><span class="ident" id="5331629">tok</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331635">p</span><span class="op" id="5331636">.</span><span class="ident" id="5331637">next</span><span class="op" id="5331641">(</span><span class="op" id="5331642">)</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331646">var</span>&nbsp;<span class="ident" id="5331650">y</span>&nbsp;<span class="op" id="5331652">[</span><span class="op" id="5331653">]</span><span class="ident" id="5331654">ast</span><span class="op" id="5331657">.</span><span class="ident" id="5331658">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331665">isRange</span>&nbsp;<span class="op" id="5331673">:=</span>&nbsp;<span class="builtintype" id="5331676">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5331684">if</span>&nbsp;<span class="ident" id="5331687">mode</span>&nbsp;<span class="op" id="5331692">==</span>&nbsp;<span class="ident" id="5331695">rangeOk</span>&nbsp;<span class="op" id="5331703">&amp;&amp;</span>&nbsp;<span class="ident" id="5331706">p</span><span class="op" id="5331707">.</span><span class="ident" id="5331708">tok</span>&nbsp;<span class="op" id="5331712">==</span>&nbsp;<span class="ident" id="5331715">token</span><span class="op" id="5331720">.</span><span class="ident" id="5331721">RANGE</span>&nbsp;<span class="op" id="5331727">&amp;&amp;</span>&nbsp;<span class="op" id="5331730">(</span><span class="ident" id="5331731">tok</span>&nbsp;<span class="op" id="5331735">==</span>&nbsp;<span class="ident" id="5331738">token</span><span class="op" id="5331743">.</span><span class="ident" id="5331744">DEFINE</span>&nbsp;<span class="op" id="5331751">||</span>&nbsp;<span class="ident" id="5331754">tok</span>&nbsp;<span class="op" id="5331758">==</span>&nbsp;<span class="ident" id="5331761">token</span><span class="op" id="5331766">.</span><span class="ident" id="5331767">ASSIGN</span><span class="op" id="5331773">)</span>&nbsp;<span class="op" id="5331775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331780">pos</span>&nbsp;<span class="op" id="5331784">:=</span>&nbsp;<span class="ident" id="5331787">p</span><span class="op" id="5331788">.</span><span class="ident" id="5331789">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331796">p</span><span class="op" id="5331797">.</span><span class="ident" id="5331798">next</span><span class="op" id="5331802">(</span><span class="op" id="5331803">)</span><br>
<span class="lineno">1655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331808">y</span>&nbsp;<span class="op" id="5331810">=</span>&nbsp;<span class="op" id="5331812">[</span><span class="op" id="5331813">]</span><span class="ident" id="5331814">ast</span><span class="op" id="5331817">.</span><span class="ident" id="5331818">Expr</span><span class="op" id="5331822">{</span><span class="op" id="5331823">&amp;</span><span class="ident" id="5331824">ast</span><span class="op" id="5331827">.</span><span class="ident" id="5331828">UnaryExpr</span><span class="op" id="5331837">{</span><span class="ident" id="5331838">OpPos</span><span class="op" id="5331843">:</span>&nbsp;<span class="ident" id="5331845">pos</span><span class="op" id="5331848">,</span>&nbsp;<span class="ident" id="5331850">Op</span><span class="op" id="5331852">:</span>&nbsp;<span class="ident" id="5331854">token</span><span class="op" id="5331859">.</span><span class="ident" id="5331860">RANGE</span><span class="op" id="5331865">,</span>&nbsp;<span class="ident" id="5331867">X</span><span class="op" id="5331868">:</span>&nbsp;<span class="ident" id="5331870">p</span><span class="op" id="5331871">.</span><span class="ident" id="5331872">parseRhs</span><span class="op" id="5331880">(</span><span class="op" id="5331881">)</span><span class="op" id="5331882">}</span><span class="op" id="5331883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331888">isRange</span>&nbsp;<span class="op" id="5331896">=</span>&nbsp;<span class="builtintype" id="5331898">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331905">}</span>&nbsp;<span class="keyword" id="5331907">else</span>&nbsp;<span class="op" id="5331912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331917">y</span>&nbsp;<span class="op" id="5331919">=</span>&nbsp;<span class="ident" id="5331921">p</span><span class="op" id="5331922">.</span><span class="ident" id="5331923">parseRhsList</span><span class="op" id="5331935">(</span><span class="op" id="5331936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5331940">}</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5331944">as</span>&nbsp;<span class="op" id="5331947">:=</span>&nbsp;<span class="op" id="5331950">&amp;</span><span class="ident" id="5331951">ast</span><span class="op" id="5331954">.</span><span class="ident" id="5331955">AssignStmt</span><span class="op" id="5331965">{</span><span class="ident" id="5331966">Lhs</span><span class="op" id="5331969">:</span>&nbsp;<span class="ident" id="5331971">x</span><span class="op" id="5331972">,</span>&nbsp;<span class="ident" id="5331974">TokPos</span><span class="op" id="5331980">:</span>&nbsp;<span class="ident" id="5331982">pos</span><span class="op" id="5331985">,</span>&nbsp;<span class="ident" id="5331987">Tok</span><span class="op" id="5331990">:</span>&nbsp;<span class="ident" id="5331992">tok</span><span class="op" id="5331995">,</span>&nbsp;<span class="ident" id="5331997">Rhs</span><span class="op" id="5332000">:</span>&nbsp;<span class="ident" id="5332002">y</span><span class="op" id="5332003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332007">if</span>&nbsp;<span class="ident" id="5332010">tok</span>&nbsp;<span class="op" id="5332014">==</span>&nbsp;<span class="ident" id="5332017">token</span><span class="op" id="5332022">.</span><span class="ident" id="5332023">DEFINE</span>&nbsp;<span class="op" id="5332030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332035">p</span><span class="op" id="5332036">.</span><span class="ident" id="5332037">shortVarDecl</span><span class="op" id="5332049">(</span><span class="ident" id="5332050">as</span><span class="op" id="5332052">,</span>&nbsp;<span class="ident" id="5332054">x</span><span class="op" id="5332055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332063">return</span>&nbsp;<span class="ident" id="5332070">as</span><span class="op" id="5332072">,</span>&nbsp;<span class="ident" id="5332074">isRange</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332087">if</span>&nbsp;<span class="builtinfunc" id="5332090">len</span><span class="op" id="5332093">(</span><span class="ident" id="5332094">x</span><span class="op" id="5332095">)</span>&nbsp;<span class="op" id="5332097">&gt;</span>&nbsp;<span class="num" id="5332099">1</span>&nbsp;<span class="op" id="5332101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332105">p</span><span class="op" id="5332106">.</span><span class="ident" id="5332107">errorExpected</span><span class="op" id="5332120">(</span><span class="ident" id="5332121">x</span><span class="op" id="5332122">[</span><span class="num" id="5332123">0</span><span class="op" id="5332124">]</span><span class="op" id="5332125">.</span><span class="ident" id="5332126">Pos</span><span class="op" id="5332129">(</span><span class="op" id="5332130">)</span><span class="op" id="5332131">,</span>&nbsp;<span class="string" id="5332133">&#34;1&nbsp;expression&#34;</span><span class="op" id="5332147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332151">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332190">switch</span>&nbsp;<span class="ident" id="5332197">p</span><span class="op" id="5332198">.</span><span class="ident" id="5332199">tok</span>&nbsp;<span class="op" id="5332203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332206">case</span>&nbsp;<span class="ident" id="5332211">token</span><span class="op" id="5332216">.</span><span class="ident" id="5332217">COLON</span><span class="op" id="5332222">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332226">//&nbsp;labeled&nbsp;statement</span><br>
<span class="lineno">1675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332249">colon</span>&nbsp;<span class="op" id="5332255">:=</span>&nbsp;<span class="ident" id="5332258">p</span><span class="op" id="5332259">.</span><span class="ident" id="5332260">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332266">p</span><span class="op" id="5332267">.</span><span class="ident" id="5332268">next</span><span class="op" id="5332272">(</span><span class="op" id="5332273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332277">if</span>&nbsp;<span class="ident" id="5332280">label</span><span class="op" id="5332285">,</span>&nbsp;<span class="ident" id="5332287">isIdent</span>&nbsp;<span class="op" id="5332295">:=</span>&nbsp;<span class="ident" id="5332298">x</span><span class="op" id="5332299">[</span><span class="num" id="5332300">0</span><span class="op" id="5332301">]</span><span class="op" id="5332302">.</span><span class="op" id="5332303">(</span><span class="op" id="5332304">*</span><span class="ident" id="5332305">ast</span><span class="op" id="5332308">.</span><span class="ident" id="5332309">Ident</span><span class="op" id="5332314">)</span><span class="op" id="5332315">;</span>&nbsp;<span class="ident" id="5332317">mode</span>&nbsp;<span class="op" id="5332322">==</span>&nbsp;<span class="ident" id="5332325">labelOk</span>&nbsp;<span class="op" id="5332333">&amp;&amp;</span>&nbsp;<span class="ident" id="5332336">isIdent</span>&nbsp;<span class="op" id="5332344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332349">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;label&nbsp;is&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332413">//&nbsp;in&nbsp;which&nbsp;it&nbsp;is&nbsp;declared&nbsp;and&nbsp;excludes&nbsp;the&nbsp;body&nbsp;of&nbsp;any&nbsp;nested</span><br>
<span class="lineno">1680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332479">//&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332495">stmt</span>&nbsp;<span class="op" id="5332500">:=</span>&nbsp;<span class="op" id="5332503">&amp;</span><span class="ident" id="5332504">ast</span><span class="op" id="5332507">.</span><span class="ident" id="5332508">LabeledStmt</span><span class="op" id="5332519">{</span><span class="ident" id="5332520">Label</span><span class="op" id="5332525">:</span>&nbsp;<span class="ident" id="5332527">label</span><span class="op" id="5332532">,</span>&nbsp;<span class="ident" id="5332534">Colon</span><span class="op" id="5332539">:</span>&nbsp;<span class="ident" id="5332541">colon</span><span class="op" id="5332546">,</span>&nbsp;<span class="ident" id="5332548">Stmt</span><span class="op" id="5332552">:</span>&nbsp;<span class="ident" id="5332554">p</span><span class="op" id="5332555">.</span><span class="ident" id="5332556">parseStmt</span><span class="op" id="5332565">(</span><span class="op" id="5332566">)</span><span class="op" id="5332567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5332572">p</span><span class="op" id="5332573">.</span><span class="ident" id="5332574">declare</span><span class="op" id="5332581">(</span><span class="ident" id="5332582">stmt</span><span class="op" id="5332586">,</span>&nbsp;<span class="builtintype" id="5332588">nil</span><span class="op" id="5332591">,</span>&nbsp;<span class="ident" id="5332593">p</span><span class="op" id="5332594">.</span><span class="ident" id="5332595">labelScope</span><span class="op" id="5332605">,</span>&nbsp;<span class="ident" id="5332607">ast</span><span class="op" id="5332610">.</span><span class="ident" id="5332611">Lbl</span><span class="op" id="5332614">,</span>&nbsp;<span class="ident" id="5332616">label</span><span class="op" id="5332621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5332626">return</span>&nbsp;<span class="ident" id="5332633">stmt</span><span class="op" id="5332637">,</span>&nbsp;<span class="builtintype" id="5332639">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5332647">}</span><br>
<span class="lineno">1685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332651">//&nbsp;The&nbsp;label&nbsp;declaration&nbsp;typically&nbsp;starts&nbsp;at&nbsp;x[0].Pos(),&nbsp;but&nbsp;the&nbsp;label</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332724">//&nbsp;declaration&nbsp;may&nbsp;be&nbsp;erroneous&nbsp;due&nbsp;to&nbsp;a&nbsp;token&nbsp;after&nbsp;that&nbsp;position&nbsp;(and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332798">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;).&nbsp;If&nbsp;SpuriousErrors&nbsp;is&nbsp;not&nbsp;set,&nbsp;the&nbsp;(only)&nbsp;error&nbsp;re-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332871">//&nbsp;ported&nbsp;for&nbsp;the&nbsp;line&nbsp;is&nbsp;the&nbsp;illegal&nbsp;label&nbsp;error&nbsp;instead&nbsp;of&nbsp;the&nbsp;token</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5332944">//&nbsp;before&nbsp;the&nbsp;&#39;:&#39;&nbsp;that&nbsp;caused&nbsp;the&nbsp;problem.&nbsp;Thus,&nbsp;use&nbsp;the&nbsp;(latest)&nbsp;colon</span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333018">//&nbsp;position&nbsp;for&nbsp;error&nbsp;reporting.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333053">p</span><span class="op" id="5333054">.</span><span class="builtintype" id="5333055">error</span><span class="op" id="5333060">(</span><span class="ident" id="5333061">colon</span><span class="op" id="5333066">,</span>&nbsp;<span class="string" id="5333068">&#34;illegal&nbsp;label&nbsp;declaration&#34;</span><span class="op" id="5333095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333099">return</span>&nbsp;<span class="op" id="5333106">&amp;</span><span class="ident" id="5333107">ast</span><span class="op" id="5333110">.</span><span class="ident" id="5333111">BadStmt</span><span class="op" id="5333118">{</span><span class="ident" id="5333119">From</span><span class="op" id="5333123">:</span>&nbsp;<span class="ident" id="5333125">x</span><span class="op" id="5333126">[</span><span class="num" id="5333127">0</span><span class="op" id="5333128">]</span><span class="op" id="5333129">.</span><span class="ident" id="5333130">Pos</span><span class="op" id="5333133">(</span><span class="op" id="5333134">)</span><span class="op" id="5333135">,</span>&nbsp;<span class="ident" id="5333137">To</span><span class="op" id="5333139">:</span>&nbsp;<span class="ident" id="5333141">colon</span>&nbsp;<span class="op" id="5333147">+</span>&nbsp;<span class="num" id="5333149">1</span><span class="op" id="5333150">}</span><span class="op" id="5333151">,</span>&nbsp;<span class="builtintype" id="5333153">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333161">case</span>&nbsp;<span class="ident" id="5333166">token</span><span class="op" id="5333171">.</span><span class="ident" id="5333172">ARROW</span><span class="op" id="5333177">:</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333181">//&nbsp;send&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333201">arrow</span>&nbsp;<span class="op" id="5333207">:=</span>&nbsp;<span class="ident" id="5333210">p</span><span class="op" id="5333211">.</span><span class="ident" id="5333212">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333218">p</span><span class="op" id="5333219">.</span><span class="ident" id="5333220">next</span><span class="op" id="5333224">(</span><span class="op" id="5333225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333229">y</span>&nbsp;<span class="op" id="5333231">:=</span>&nbsp;<span class="ident" id="5333234">p</span><span class="op" id="5333235">.</span><span class="ident" id="5333236">parseRhs</span><span class="op" id="5333244">(</span><span class="op" id="5333245">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333249">return</span>&nbsp;<span class="op" id="5333256">&amp;</span><span class="ident" id="5333257">ast</span><span class="op" id="5333260">.</span><span class="ident" id="5333261">SendStmt</span><span class="op" id="5333269">{</span><span class="ident" id="5333270">Chan</span><span class="op" id="5333274">:</span>&nbsp;<span class="ident" id="5333276">x</span><span class="op" id="5333277">[</span><span class="num" id="5333278">0</span><span class="op" id="5333279">]</span><span class="op" id="5333280">,</span>&nbsp;<span class="ident" id="5333282">Arrow</span><span class="op" id="5333287">:</span>&nbsp;<span class="ident" id="5333289">arrow</span><span class="op" id="5333294">,</span>&nbsp;<span class="ident" id="5333296">Value</span><span class="op" id="5333301">:</span>&nbsp;<span class="ident" id="5333303">y</span><span class="op" id="5333304">}</span><span class="op" id="5333305">,</span>&nbsp;<span class="builtintype" id="5333307">false</span><br>
<span class="lineno">1700</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333315">case</span>&nbsp;<span class="ident" id="5333320">token</span><span class="op" id="5333325">.</span><span class="ident" id="5333326">INC</span><span class="op" id="5333329">,</span>&nbsp;<span class="ident" id="5333331">token</span><span class="op" id="5333336">.</span><span class="ident" id="5333337">DEC</span><span class="op" id="5333340">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333344">//&nbsp;increment&nbsp;or&nbsp;decrement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333372">s</span>&nbsp;<span class="op" id="5333374">:=</span>&nbsp;<span class="op" id="5333377">&amp;</span><span class="ident" id="5333378">ast</span><span class="op" id="5333381">.</span><span class="ident" id="5333382">IncDecStmt</span><span class="op" id="5333392">{</span><span class="ident" id="5333393">X</span><span class="op" id="5333394">:</span>&nbsp;<span class="ident" id="5333396">x</span><span class="op" id="5333397">[</span><span class="num" id="5333398">0</span><span class="op" id="5333399">]</span><span class="op" id="5333400">,</span>&nbsp;<span class="ident" id="5333402">TokPos</span><span class="op" id="5333408">:</span>&nbsp;<span class="ident" id="5333410">p</span><span class="op" id="5333411">.</span><span class="ident" id="5333412">pos</span><span class="op" id="5333415">,</span>&nbsp;<span class="ident" id="5333417">Tok</span><span class="op" id="5333420">:</span>&nbsp;<span class="ident" id="5333422">p</span><span class="op" id="5333423">.</span><span class="ident" id="5333424">tok</span><span class="op" id="5333427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333431">p</span><span class="op" id="5333432">.</span><span class="ident" id="5333433">next</span><span class="op" id="5333437">(</span><span class="op" id="5333438">)</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333442">return</span>&nbsp;<span class="ident" id="5333449">s</span><span class="op" id="5333450">,</span>&nbsp;<span class="builtintype" id="5333452">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5333459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333463">//&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333478">return</span>&nbsp;<span class="op" id="5333485">&amp;</span><span class="ident" id="5333486">ast</span><span class="op" id="5333489">.</span><span class="ident" id="5333490">ExprStmt</span><span class="op" id="5333498">{</span><span class="ident" id="5333499">X</span><span class="op" id="5333500">:</span>&nbsp;<span class="ident" id="5333502">x</span><span class="op" id="5333503">[</span><span class="num" id="5333504">0</span><span class="op" id="5333505">]</span><span class="op" id="5333506">}</span><span class="op" id="5333507">,</span>&nbsp;<span class="builtintype" id="5333509">false</span><br>
<span class="lineno">1710</span><span class="op" id="5333515">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5333518">func</span>&nbsp;<span class="op" id="5333523">(</span><span class="ident" id="5333524">p</span>&nbsp;<span class="op" id="5333526">*</span><span class="ident" id="5333527">parser</span><span class="op" id="5333533">)</span>&nbsp;<span class="ident" id="5333535">parseCallExpr</span><span class="op" id="5333548">(</span><span class="ident" id="5333549">callType</span>&nbsp;<span class="builtintype" id="5333558">string</span><span class="op" id="5333564">)</span>&nbsp;<span class="op" id="5333566">*</span><span class="ident" id="5333567">ast</span><span class="op" id="5333570">.</span><span class="ident" id="5333571">CallExpr</span>&nbsp;<span class="op" id="5333580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333583">x</span>&nbsp;<span class="op" id="5333585">:=</span>&nbsp;<span class="ident" id="5333588">p</span><span class="op" id="5333589">.</span><span class="ident" id="5333590">parseRhsOrType</span><span class="op" id="5333604">(</span><span class="op" id="5333605">)</span>&nbsp;<span class="comment" id="5333607">//&nbsp;could&nbsp;be&nbsp;a&nbsp;conversion:&nbsp;(some&nbsp;type)(x)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333649">if</span>&nbsp;<span class="ident" id="5333652">call</span><span class="op" id="5333656">,</span>&nbsp;<span class="ident" id="5333658">isCall</span>&nbsp;<span class="op" id="5333665">:=</span>&nbsp;<span class="ident" id="5333668">x</span><span class="op" id="5333669">.</span><span class="op" id="5333670">(</span><span class="op" id="5333671">*</span><span class="ident" id="5333672">ast</span><span class="op" id="5333675">.</span><span class="ident" id="5333676">CallExpr</span><span class="op" id="5333684">)</span><span class="op" id="5333685">;</span>&nbsp;<span class="ident" id="5333687">isCall</span>&nbsp;<span class="op" id="5333694">{</span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333698">return</span>&nbsp;<span class="ident" id="5333705">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5333711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333714">if</span>&nbsp;<span class="ident" id="5333717">_</span><span class="op" id="5333718">,</span>&nbsp;<span class="ident" id="5333720">isBad</span>&nbsp;<span class="op" id="5333726">:=</span>&nbsp;<span class="ident" id="5333729">x</span><span class="op" id="5333730">.</span><span class="op" id="5333731">(</span><span class="op" id="5333732">*</span><span class="ident" id="5333733">ast</span><span class="op" id="5333736">.</span><span class="ident" id="5333737">BadExpr</span><span class="op" id="5333744">)</span><span class="op" id="5333745">;</span>&nbsp;<span class="op" id="5333747">!</span><span class="ident" id="5333748">isBad</span>&nbsp;<span class="op" id="5333754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5333758">//&nbsp;only&nbsp;report&nbsp;error&nbsp;if&nbsp;it&#39;s&nbsp;a&nbsp;new&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5333799">p</span><span class="op" id="5333800">.</span><span class="builtintype" id="5333801">error</span><span class="op" id="5333806">(</span><span class="ident" id="5333807">p</span><span class="op" id="5333808">.</span><span class="ident" id="5333809">safePos</span><span class="op" id="5333816">(</span><span class="ident" id="5333817">x</span><span class="op" id="5333818">.</span><span class="ident" id="5333819">End</span><span class="op" id="5333822">(</span><span class="op" id="5333823">)</span><span class="op" id="5333824">)</span><span class="op" id="5333825">,</span>&nbsp;<span class="ident" id="5333827">fmt</span><span class="op" id="5333830">.</span><span class="ident" id="5333831">Sprintf</span><span class="op" id="5333838">(</span><span class="string" id="5333839">&#34;function&nbsp;must&nbsp;be&nbsp;invoked&nbsp;in&nbsp;%s&nbsp;statement&#34;</span><span class="op" id="5333881">,</span>&nbsp;<span class="ident" id="5333883">callType</span><span class="op" id="5333891">)</span><span class="op" id="5333892">)</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5333895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333898">return</span>&nbsp;<span class="builtintype" id="5333905">nil</span><br>
<span class="lineno"></span><span class="op" id="5333909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5333912">func</span>&nbsp;<span class="op" id="5333917">(</span><span class="ident" id="5333918">p</span>&nbsp;<span class="op" id="5333920">*</span><span class="ident" id="5333921">parser</span><span class="op" id="5333927">)</span>&nbsp;<span class="ident" id="5333929">parseGoStmt</span><span class="op" id="5333940">(</span><span class="op" id="5333941">)</span>&nbsp;<span class="ident" id="5333943">ast</span><span class="op" id="5333946">.</span><span class="ident" id="5333947">Stmt</span>&nbsp;<span class="op" id="5333952">{</span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333955">if</span>&nbsp;<span class="ident" id="5333958">p</span><span class="op" id="5333959">.</span><span class="ident" id="5333960">trace</span>&nbsp;<span class="op" id="5333966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5333970">defer</span>&nbsp;<span class="ident" id="5333976">un</span><span class="op" id="5333978">(</span><span class="ident" id="5333979">trace</span><span class="op" id="5333984">(</span><span class="ident" id="5333985">p</span><span class="op" id="5333986">,</span>&nbsp;<span class="string" id="5333988">&#34;GoStmt&#34;</span><span class="op" id="5333996">)</span><span class="op" id="5333997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334000">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334004">pos</span>&nbsp;<span class="op" id="5334008">:=</span>&nbsp;<span class="ident" id="5334011">p</span><span class="op" id="5334012">.</span><span class="ident" id="5334013">expect</span><span class="op" id="5334019">(</span><span class="ident" id="5334020">token</span><span class="op" id="5334025">.</span><span class="ident" id="5334026">GO</span><span class="op" id="5334028">)</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334031">call</span>&nbsp;<span class="op" id="5334036">:=</span>&nbsp;<span class="ident" id="5334039">p</span><span class="op" id="5334040">.</span><span class="ident" id="5334041">parseCallExpr</span><span class="op" id="5334054">(</span><span class="string" id="5334055">&#34;go&#34;</span><span class="op" id="5334059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334062">p</span><span class="op" id="5334063">.</span><span class="ident" id="5334064">expectSemi</span><span class="op" id="5334074">(</span><span class="op" id="5334075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334078">if</span>&nbsp;<span class="ident" id="5334081">call</span>&nbsp;<span class="op" id="5334086">==</span>&nbsp;<span class="builtintype" id="5334089">nil</span>&nbsp;<span class="op" id="5334093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334097">return</span>&nbsp;<span class="op" id="5334104">&amp;</span><span class="ident" id="5334105">ast</span><span class="op" id="5334108">.</span><span class="ident" id="5334109">BadStmt</span><span class="op" id="5334116">{</span><span class="ident" id="5334117">From</span><span class="op" id="5334121">:</span>&nbsp;<span class="ident" id="5334123">pos</span><span class="op" id="5334126">,</span>&nbsp;<span class="ident" id="5334128">To</span><span class="op" id="5334130">:</span>&nbsp;<span class="ident" id="5334132">pos</span>&nbsp;<span class="op" id="5334136">+</span>&nbsp;<span class="num" id="5334138">2</span><span class="op" id="5334139">}</span>&nbsp;<span class="comment" id="5334141">//&nbsp;len(&#34;go&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334155">}</span><br>
<span class="lineno">1735</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334159">return</span>&nbsp;<span class="op" id="5334166">&amp;</span><span class="ident" id="5334167">ast</span><span class="op" id="5334170">.</span><span class="ident" id="5334171">GoStmt</span><span class="op" id="5334177">{</span><span class="ident" id="5334178">Go</span><span class="op" id="5334180">:</span>&nbsp;<span class="ident" id="5334182">pos</span><span class="op" id="5334185">,</span>&nbsp;<span class="ident" id="5334187">Call</span><span class="op" id="5334191">:</span>&nbsp;<span class="ident" id="5334193">call</span><span class="op" id="5334197">}</span><br>
<span class="lineno"></span><span class="op" id="5334199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5334202">func</span>&nbsp;<span class="op" id="5334207">(</span><span class="ident" id="5334208">p</span>&nbsp;<span class="op" id="5334210">*</span><span class="ident" id="5334211">parser</span><span class="op" id="5334217">)</span>&nbsp;<span class="ident" id="5334219">parseDeferStmt</span><span class="op" id="5334233">(</span><span class="op" id="5334234">)</span>&nbsp;<span class="ident" id="5334236">ast</span><span class="op" id="5334239">.</span><span class="ident" id="5334240">Stmt</span>&nbsp;<span class="op" id="5334245">{</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334248">if</span>&nbsp;<span class="ident" id="5334251">p</span><span class="op" id="5334252">.</span><span class="ident" id="5334253">trace</span>&nbsp;<span class="op" id="5334259">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334263">defer</span>&nbsp;<span class="ident" id="5334269">un</span><span class="op" id="5334271">(</span><span class="ident" id="5334272">trace</span><span class="op" id="5334277">(</span><span class="ident" id="5334278">p</span><span class="op" id="5334279">,</span>&nbsp;<span class="string" id="5334281">&#34;DeferStmt&#34;</span><span class="op" id="5334292">)</span><span class="op" id="5334293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334300">pos</span>&nbsp;<span class="op" id="5334304">:=</span>&nbsp;<span class="ident" id="5334307">p</span><span class="op" id="5334308">.</span><span class="ident" id="5334309">expect</span><span class="op" id="5334315">(</span><span class="ident" id="5334316">token</span><span class="op" id="5334321">.</span><span class="ident" id="5334322">DEFER</span><span class="op" id="5334327">)</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334330">call</span>&nbsp;<span class="op" id="5334335">:=</span>&nbsp;<span class="ident" id="5334338">p</span><span class="op" id="5334339">.</span><span class="ident" id="5334340">parseCallExpr</span><span class="op" id="5334353">(</span><span class="string" id="5334354">&#34;defer&#34;</span><span class="op" id="5334361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334364">p</span><span class="op" id="5334365">.</span><span class="ident" id="5334366">expectSemi</span><span class="op" id="5334376">(</span><span class="op" id="5334377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334380">if</span>&nbsp;<span class="ident" id="5334383">call</span>&nbsp;<span class="op" id="5334388">==</span>&nbsp;<span class="builtintype" id="5334391">nil</span>&nbsp;<span class="op" id="5334395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334399">return</span>&nbsp;<span class="op" id="5334406">&amp;</span><span class="ident" id="5334407">ast</span><span class="op" id="5334410">.</span><span class="ident" id="5334411">BadStmt</span><span class="op" id="5334418">{</span><span class="ident" id="5334419">From</span><span class="op" id="5334423">:</span>&nbsp;<span class="ident" id="5334425">pos</span><span class="op" id="5334428">,</span>&nbsp;<span class="ident" id="5334430">To</span><span class="op" id="5334432">:</span>&nbsp;<span class="ident" id="5334434">pos</span>&nbsp;<span class="op" id="5334438">+</span>&nbsp;<span class="num" id="5334440">5</span><span class="op" id="5334441">}</span>&nbsp;<span class="comment" id="5334443">//&nbsp;len(&#34;defer&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334460">}</span><br>
<span class="lineno">1750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334464">return</span>&nbsp;<span class="op" id="5334471">&amp;</span><span class="ident" id="5334472">ast</span><span class="op" id="5334475">.</span><span class="ident" id="5334476">DeferStmt</span><span class="op" id="5334485">{</span><span class="ident" id="5334486">Defer</span><span class="op" id="5334491">:</span>&nbsp;<span class="ident" id="5334493">pos</span><span class="op" id="5334496">,</span>&nbsp;<span class="ident" id="5334498">Call</span><span class="op" id="5334502">:</span>&nbsp;<span class="ident" id="5334504">call</span><span class="op" id="5334508">}</span><br>
<span class="lineno"></span><span class="op" id="5334510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5334513">func</span>&nbsp;<span class="op" id="5334518">(</span><span class="ident" id="5334519">p</span>&nbsp;<span class="op" id="5334521">*</span><span class="ident" id="5334522">parser</span><span class="op" id="5334528">)</span>&nbsp;<span class="ident" id="5334530">parseReturnStmt</span><span class="op" id="5334545">(</span><span class="op" id="5334546">)</span>&nbsp;<span class="op" id="5334548">*</span><span class="ident" id="5334549">ast</span><span class="op" id="5334552">.</span><span class="ident" id="5334553">ReturnStmt</span>&nbsp;<span class="op" id="5334564">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334567">if</span>&nbsp;<span class="ident" id="5334570">p</span><span class="op" id="5334571">.</span><span class="ident" id="5334572">trace</span>&nbsp;<span class="op" id="5334578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334582">defer</span>&nbsp;<span class="ident" id="5334588">un</span><span class="op" id="5334590">(</span><span class="ident" id="5334591">trace</span><span class="op" id="5334596">(</span><span class="ident" id="5334597">p</span><span class="op" id="5334598">,</span>&nbsp;<span class="string" id="5334600">&#34;ReturnStmt&#34;</span><span class="op" id="5334612">)</span><span class="op" id="5334613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334620">pos</span>&nbsp;<span class="op" id="5334624">:=</span>&nbsp;<span class="ident" id="5334627">p</span><span class="op" id="5334628">.</span><span class="ident" id="5334629">pos</span><br>
<span class="lineno">1760</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334634">p</span><span class="op" id="5334635">.</span><span class="ident" id="5334636">expect</span><span class="op" id="5334642">(</span><span class="ident" id="5334643">token</span><span class="op" id="5334648">.</span><span class="ident" id="5334649">RETURN</span><span class="op" id="5334655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334658">var</span>&nbsp;<span class="ident" id="5334662">x</span>&nbsp;<span class="op" id="5334664">[</span><span class="op" id="5334665">]</span><span class="ident" id="5334666">ast</span><span class="op" id="5334669">.</span><span class="ident" id="5334670">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334676">if</span>&nbsp;<span class="ident" id="5334679">p</span><span class="op" id="5334680">.</span><span class="ident" id="5334681">tok</span>&nbsp;<span class="op" id="5334685">!=</span>&nbsp;<span class="ident" id="5334688">token</span><span class="op" id="5334693">.</span><span class="ident" id="5334694">SEMICOLON</span>&nbsp;<span class="op" id="5334704">&amp;&amp;</span>&nbsp;<span class="ident" id="5334707">p</span><span class="op" id="5334708">.</span><span class="ident" id="5334709">tok</span>&nbsp;<span class="op" id="5334713">!=</span>&nbsp;<span class="ident" id="5334716">token</span><span class="op" id="5334721">.</span><span class="ident" id="5334722">RBRACE</span>&nbsp;<span class="op" id="5334729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334733">x</span>&nbsp;<span class="op" id="5334735">=</span>&nbsp;<span class="ident" id="5334737">p</span><span class="op" id="5334738">.</span><span class="ident" id="5334739">parseRhsList</span><span class="op" id="5334751">(</span><span class="op" id="5334752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334755">}</span><br>
<span class="lineno">1765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334758">p</span><span class="op" id="5334759">.</span><span class="ident" id="5334760">expectSemi</span><span class="op" id="5334770">(</span><span class="op" id="5334771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334775">return</span>&nbsp;<span class="op" id="5334782">&amp;</span><span class="ident" id="5334783">ast</span><span class="op" id="5334786">.</span><span class="ident" id="5334787">ReturnStmt</span><span class="op" id="5334797">{</span><span class="ident" id="5334798">Return</span><span class="op" id="5334804">:</span>&nbsp;<span class="ident" id="5334806">pos</span><span class="op" id="5334809">,</span>&nbsp;<span class="ident" id="5334811">Results</span><span class="op" id="5334818">:</span>&nbsp;<span class="ident" id="5334820">x</span><span class="op" id="5334821">}</span><br>
<span class="lineno"></span><span class="op" id="5334823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1770</span><span class="keyword" id="5334826">func</span>&nbsp;<span class="op" id="5334831">(</span><span class="ident" id="5334832">p</span>&nbsp;<span class="op" id="5334834">*</span><span class="ident" id="5334835">parser</span><span class="op" id="5334841">)</span>&nbsp;<span class="ident" id="5334843">parseBranchStmt</span><span class="op" id="5334858">(</span><span class="ident" id="5334859">tok</span>&nbsp;<span class="ident" id="5334863">token</span><span class="op" id="5334868">.</span><span class="ident" id="5334869">Token</span><span class="op" id="5334874">)</span>&nbsp;<span class="op" id="5334876">*</span><span class="ident" id="5334877">ast</span><span class="op" id="5334880">.</span><span class="ident" id="5334881">BranchStmt</span>&nbsp;<span class="op" id="5334892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334895">if</span>&nbsp;<span class="ident" id="5334898">p</span><span class="op" id="5334899">.</span><span class="ident" id="5334900">trace</span>&nbsp;<span class="op" id="5334906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334910">defer</span>&nbsp;<span class="ident" id="5334916">un</span><span class="op" id="5334918">(</span><span class="ident" id="5334919">trace</span><span class="op" id="5334924">(</span><span class="ident" id="5334925">p</span><span class="op" id="5334926">,</span>&nbsp;<span class="string" id="5334928">&#34;BranchStmt&#34;</span><span class="op" id="5334940">)</span><span class="op" id="5334941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5334944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5334948">pos</span>&nbsp;<span class="op" id="5334952">:=</span>&nbsp;<span class="ident" id="5334955">p</span><span class="op" id="5334956">.</span><span class="ident" id="5334957">expect</span><span class="op" id="5334963">(</span><span class="ident" id="5334964">tok</span><span class="op" id="5334967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334970">var</span>&nbsp;<span class="ident" id="5334974">label</span>&nbsp;<span class="op" id="5334980">*</span><span class="ident" id="5334981">ast</span><span class="op" id="5334984">.</span><span class="ident" id="5334985">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5334992">if</span>&nbsp;<span class="ident" id="5334995">tok</span>&nbsp;<span class="op" id="5334999">!=</span>&nbsp;<span class="ident" id="5335002">token</span><span class="op" id="5335007">.</span><span class="ident" id="5335008">FALLTHROUGH</span>&nbsp;<span class="op" id="5335020">&amp;&amp;</span>&nbsp;<span class="ident" id="5335023">p</span><span class="op" id="5335024">.</span><span class="ident" id="5335025">tok</span>&nbsp;<span class="op" id="5335029">==</span>&nbsp;<span class="ident" id="5335032">token</span><span class="op" id="5335037">.</span><span class="ident" id="5335038">IDENT</span>&nbsp;<span class="op" id="5335044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335048">label</span>&nbsp;<span class="op" id="5335054">=</span>&nbsp;<span class="ident" id="5335056">p</span><span class="op" id="5335057">.</span><span class="ident" id="5335058">parseIdent</span><span class="op" id="5335068">(</span><span class="op" id="5335069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5335073">//&nbsp;add&nbsp;to&nbsp;list&nbsp;of&nbsp;unresolved&nbsp;targets</span><br>
<span class="lineno">1780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335112">n</span>&nbsp;<span class="op" id="5335114">:=</span>&nbsp;<span class="builtinfunc" id="5335117">len</span><span class="op" id="5335120">(</span><span class="ident" id="5335121">p</span><span class="op" id="5335122">.</span><span class="ident" id="5335123">targetStack</span><span class="op" id="5335134">)</span>&nbsp;<span class="op" id="5335136">-</span>&nbsp;<span class="num" id="5335138">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335142">p</span><span class="op" id="5335143">.</span><span class="ident" id="5335144">targetStack</span><span class="op" id="5335155">[</span><span class="ident" id="5335156">n</span><span class="op" id="5335157">]</span>&nbsp;<span class="op" id="5335159">=</span>&nbsp;<span class="builtinfunc" id="5335161">append</span><span class="op" id="5335167">(</span><span class="ident" id="5335168">p</span><span class="op" id="5335169">.</span><span class="ident" id="5335170">targetStack</span><span class="op" id="5335181">[</span><span class="ident" id="5335182">n</span><span class="op" id="5335183">]</span><span class="op" id="5335184">,</span>&nbsp;<span class="ident" id="5335186">label</span><span class="op" id="5335191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335197">p</span><span class="op" id="5335198">.</span><span class="ident" id="5335199">expectSemi</span><span class="op" id="5335209">(</span><span class="op" id="5335210">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1785</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335214">return</span>&nbsp;<span class="op" id="5335221">&amp;</span><span class="ident" id="5335222">ast</span><span class="op" id="5335225">.</span><span class="ident" id="5335226">BranchStmt</span><span class="op" id="5335236">{</span><span class="ident" id="5335237">TokPos</span><span class="op" id="5335243">:</span>&nbsp;<span class="ident" id="5335245">pos</span><span class="op" id="5335248">,</span>&nbsp;<span class="ident" id="5335250">Tok</span><span class="op" id="5335253">:</span>&nbsp;<span class="ident" id="5335255">tok</span><span class="op" id="5335258">,</span>&nbsp;<span class="ident" id="5335260">Label</span><span class="op" id="5335265">:</span>&nbsp;<span class="ident" id="5335267">label</span><span class="op" id="5335272">}</span><br>
<span class="lineno"></span><span class="op" id="5335274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5335277">func</span>&nbsp;<span class="op" id="5335282">(</span><span class="ident" id="5335283">p</span>&nbsp;<span class="op" id="5335285">*</span><span class="ident" id="5335286">parser</span><span class="op" id="5335292">)</span>&nbsp;<span class="ident" id="5335294">makeExpr</span><span class="op" id="5335302">(</span><span class="ident" id="5335303">s</span>&nbsp;<span class="ident" id="5335305">ast</span><span class="op" id="5335308">.</span><span class="ident" id="5335309">Stmt</span><span class="op" id="5335313">,</span>&nbsp;<span class="ident" id="5335315">kind</span>&nbsp;<span class="builtintype" id="5335320">string</span><span class="op" id="5335326">)</span>&nbsp;<span class="ident" id="5335328">ast</span><span class="op" id="5335331">.</span><span class="ident" id="5335332">Expr</span>&nbsp;<span class="op" id="5335337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335340">if</span>&nbsp;<span class="ident" id="5335343">s</span>&nbsp;<span class="op" id="5335345">==</span>&nbsp;<span class="builtintype" id="5335348">nil</span>&nbsp;<span class="op" id="5335352">{</span><br>
<span class="lineno">1790</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335356">return</span>&nbsp;<span class="builtintype" id="5335363">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335371">if</span>&nbsp;<span class="ident" id="5335374">es</span><span class="op" id="5335376">,</span>&nbsp;<span class="ident" id="5335378">isExpr</span>&nbsp;<span class="op" id="5335385">:=</span>&nbsp;<span class="ident" id="5335388">s</span><span class="op" id="5335389">.</span><span class="op" id="5335390">(</span><span class="op" id="5335391">*</span><span class="ident" id="5335392">ast</span><span class="op" id="5335395">.</span><span class="ident" id="5335396">ExprStmt</span><span class="op" id="5335404">)</span><span class="op" id="5335405">;</span>&nbsp;<span class="ident" id="5335407">isExpr</span>&nbsp;<span class="op" id="5335414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335418">return</span>&nbsp;<span class="ident" id="5335425">p</span><span class="op" id="5335426">.</span><span class="ident" id="5335427">checkExpr</span><span class="op" id="5335436">(</span><span class="ident" id="5335437">es</span><span class="op" id="5335439">.</span><span class="ident" id="5335440">X</span><span class="op" id="5335441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335444">}</span><br>
<span class="lineno">1795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335447">p</span><span class="op" id="5335448">.</span><span class="builtintype" id="5335449">error</span><span class="op" id="5335454">(</span><span class="ident" id="5335455">s</span><span class="op" id="5335456">.</span><span class="ident" id="5335457">Pos</span><span class="op" id="5335460">(</span><span class="op" id="5335461">)</span><span class="op" id="5335462">,</span>&nbsp;<span class="ident" id="5335464">fmt</span><span class="op" id="5335467">.</span><span class="ident" id="5335468">Sprintf</span><span class="op" id="5335475">(</span><span class="string" id="5335476">&#34;expected&nbsp;%s,&nbsp;found&nbsp;simple&nbsp;statement&nbsp;(missing&nbsp;parentheses&nbsp;around&nbsp;composite&nbsp;literal?)&#34;</span><span class="op" id="5335561">,</span>&nbsp;<span class="ident" id="5335563">kind</span><span class="op" id="5335567">)</span><span class="op" id="5335568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335571">return</span>&nbsp;<span class="op" id="5335578">&amp;</span><span class="ident" id="5335579">ast</span><span class="op" id="5335582">.</span><span class="ident" id="5335583">BadExpr</span><span class="op" id="5335590">{</span><span class="ident" id="5335591">From</span><span class="op" id="5335595">:</span>&nbsp;<span class="ident" id="5335597">s</span><span class="op" id="5335598">.</span><span class="ident" id="5335599">Pos</span><span class="op" id="5335602">(</span><span class="op" id="5335603">)</span><span class="op" id="5335604">,</span>&nbsp;<span class="ident" id="5335606">To</span><span class="op" id="5335608">:</span>&nbsp;<span class="ident" id="5335610">p</span><span class="op" id="5335611">.</span><span class="ident" id="5335612">safePos</span><span class="op" id="5335619">(</span><span class="ident" id="5335620">s</span><span class="op" id="5335621">.</span><span class="ident" id="5335622">End</span><span class="op" id="5335625">(</span><span class="op" id="5335626">)</span><span class="op" id="5335627">)</span><span class="op" id="5335628">}</span><br>
<span class="lineno"></span><span class="op" id="5335630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5335633">func</span>&nbsp;<span class="op" id="5335638">(</span><span class="ident" id="5335639">p</span>&nbsp;<span class="op" id="5335641">*</span><span class="ident" id="5335642">parser</span><span class="op" id="5335648">)</span>&nbsp;<span class="ident" id="5335650">parseIfStmt</span><span class="op" id="5335661">(</span><span class="op" id="5335662">)</span>&nbsp;<span class="op" id="5335664">*</span><span class="ident" id="5335665">ast</span><span class="op" id="5335668">.</span><span class="ident" id="5335669">IfStmt</span>&nbsp;<span class="op" id="5335676">{</span><br>
<span class="lineno">1800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335679">if</span>&nbsp;<span class="ident" id="5335682">p</span><span class="op" id="5335683">.</span><span class="ident" id="5335684">trace</span>&nbsp;<span class="op" id="5335690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335694">defer</span>&nbsp;<span class="ident" id="5335700">un</span><span class="op" id="5335702">(</span><span class="ident" id="5335703">trace</span><span class="op" id="5335708">(</span><span class="ident" id="5335709">p</span><span class="op" id="5335710">,</span>&nbsp;<span class="string" id="5335712">&#34;IfStmt&#34;</span><span class="op" id="5335720">)</span><span class="op" id="5335721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335724">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335728">pos</span>&nbsp;<span class="op" id="5335732">:=</span>&nbsp;<span class="ident" id="5335735">p</span><span class="op" id="5335736">.</span><span class="ident" id="5335737">expect</span><span class="op" id="5335743">(</span><span class="ident" id="5335744">token</span><span class="op" id="5335749">.</span><span class="ident" id="5335750">IF</span><span class="op" id="5335752">)</span><br>
<span class="lineno">1805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335755">p</span><span class="op" id="5335756">.</span><span class="ident" id="5335757">openScope</span><span class="op" id="5335766">(</span><span class="op" id="5335767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335770">defer</span>&nbsp;<span class="ident" id="5335776">p</span><span class="op" id="5335777">.</span><span class="ident" id="5335778">closeScope</span><span class="op" id="5335788">(</span><span class="op" id="5335789">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335793">var</span>&nbsp;<span class="ident" id="5335797">s</span>&nbsp;<span class="ident" id="5335799">ast</span><span class="op" id="5335802">.</span><span class="ident" id="5335803">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335809">var</span>&nbsp;<span class="ident" id="5335813">x</span>&nbsp;<span class="ident" id="5335815">ast</span><span class="op" id="5335818">.</span><span class="ident" id="5335819">Expr</span><br>
<span class="lineno">1810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335829">prevLev</span>&nbsp;<span class="op" id="5335837">:=</span>&nbsp;<span class="ident" id="5335840">p</span><span class="op" id="5335841">.</span><span class="ident" id="5335842">exprLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335852">p</span><span class="op" id="5335853">.</span><span class="ident" id="5335854">exprLev</span>&nbsp;<span class="op" id="5335862">=</span>&nbsp;<span class="op" id="5335864">-</span><span class="num" id="5335865">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335869">if</span>&nbsp;<span class="ident" id="5335872">p</span><span class="op" id="5335873">.</span><span class="ident" id="5335874">tok</span>&nbsp;<span class="op" id="5335878">==</span>&nbsp;<span class="ident" id="5335881">token</span><span class="op" id="5335886">.</span><span class="ident" id="5335887">SEMICOLON</span>&nbsp;<span class="op" id="5335897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335902">p</span><span class="op" id="5335903">.</span><span class="ident" id="5335904">next</span><span class="op" id="5335908">(</span><span class="op" id="5335909">)</span><br>
<span class="lineno">1815</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335914">x</span>&nbsp;<span class="op" id="5335916">=</span>&nbsp;<span class="ident" id="5335918">p</span><span class="op" id="5335919">.</span><span class="ident" id="5335920">parseRhs</span><span class="op" id="5335928">(</span><span class="op" id="5335929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5335933">}</span>&nbsp;<span class="keyword" id="5335935">else</span>&nbsp;<span class="op" id="5335940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5335945">s</span><span class="op" id="5335946">,</span>&nbsp;<span class="ident" id="5335948">_</span>&nbsp;<span class="op" id="5335950">=</span>&nbsp;<span class="ident" id="5335952">p</span><span class="op" id="5335953">.</span><span class="ident" id="5335954">parseSimpleStmt</span><span class="op" id="5335969">(</span><span class="ident" id="5335970">basic</span><span class="op" id="5335975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5335980">if</span>&nbsp;<span class="ident" id="5335983">p</span><span class="op" id="5335984">.</span><span class="ident" id="5335985">tok</span>&nbsp;<span class="op" id="5335989">==</span>&nbsp;<span class="ident" id="5335992">token</span><span class="op" id="5335997">.</span><span class="ident" id="5335998">SEMICOLON</span>&nbsp;<span class="op" id="5336008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336014">p</span><span class="op" id="5336015">.</span><span class="ident" id="5336016">next</span><span class="op" id="5336020">(</span><span class="op" id="5336021">)</span><br>
<span class="lineno">1820</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336027">x</span>&nbsp;<span class="op" id="5336029">=</span>&nbsp;<span class="ident" id="5336031">p</span><span class="op" id="5336032">.</span><span class="ident" id="5336033">parseRhs</span><span class="op" id="5336041">(</span><span class="op" id="5336042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336047">}</span>&nbsp;<span class="keyword" id="5336049">else</span>&nbsp;<span class="op" id="5336054">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336060">x</span>&nbsp;<span class="op" id="5336062">=</span>&nbsp;<span class="ident" id="5336064">p</span><span class="op" id="5336065">.</span><span class="ident" id="5336066">makeExpr</span><span class="op" id="5336074">(</span><span class="ident" id="5336075">s</span><span class="op" id="5336076">,</span>&nbsp;<span class="string" id="5336078">&#34;boolean&nbsp;expression&#34;</span><span class="op" id="5336098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336104">s</span>&nbsp;<span class="op" id="5336106">=</span>&nbsp;<span class="builtintype" id="5336108">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336115">}</span><br>
<span class="lineno">1825</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336123">p</span><span class="op" id="5336124">.</span><span class="ident" id="5336125">exprLev</span>&nbsp;<span class="op" id="5336133">=</span>&nbsp;<span class="ident" id="5336135">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336148">body</span>&nbsp;<span class="op" id="5336153">:=</span>&nbsp;<span class="ident" id="5336156">p</span><span class="op" id="5336157">.</span><span class="ident" id="5336158">parseBlockStmt</span><span class="op" id="5336172">(</span><span class="op" id="5336173">)</span><br>
<span class="lineno">1830</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336176">var</span>&nbsp;<span class="ident" id="5336180">else_</span>&nbsp;<span class="ident" id="5336186">ast</span><span class="op" id="5336189">.</span><span class="ident" id="5336190">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336196">if</span>&nbsp;<span class="ident" id="5336199">p</span><span class="op" id="5336200">.</span><span class="ident" id="5336201">tok</span>&nbsp;<span class="op" id="5336205">==</span>&nbsp;<span class="ident" id="5336208">token</span><span class="op" id="5336213">.</span><span class="ident" id="5336214">ELSE</span>&nbsp;<span class="op" id="5336219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336223">p</span><span class="op" id="5336224">.</span><span class="ident" id="5336225">next</span><span class="op" id="5336229">(</span><span class="op" id="5336230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336234">else_</span>&nbsp;<span class="op" id="5336240">=</span>&nbsp;<span class="ident" id="5336242">p</span><span class="op" id="5336243">.</span><span class="ident" id="5336244">parseStmt</span><span class="op" id="5336253">(</span><span class="op" id="5336254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336257">}</span>&nbsp;<span class="keyword" id="5336259">else</span>&nbsp;<span class="op" id="5336264">{</span><br>
<span class="lineno">1835</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336268">p</span><span class="op" id="5336269">.</span><span class="ident" id="5336270">expectSemi</span><span class="op" id="5336280">(</span><span class="op" id="5336281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336284">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336288">return</span>&nbsp;<span class="op" id="5336295">&amp;</span><span class="ident" id="5336296">ast</span><span class="op" id="5336299">.</span><span class="ident" id="5336300">IfStmt</span><span class="op" id="5336306">{</span><span class="ident" id="5336307">If</span><span class="op" id="5336309">:</span>&nbsp;<span class="ident" id="5336311">pos</span><span class="op" id="5336314">,</span>&nbsp;<span class="ident" id="5336316">Init</span><span class="op" id="5336320">:</span>&nbsp;<span class="ident" id="5336322">s</span><span class="op" id="5336323">,</span>&nbsp;<span class="ident" id="5336325">Cond</span><span class="op" id="5336329">:</span>&nbsp;<span class="ident" id="5336331">x</span><span class="op" id="5336332">,</span>&nbsp;<span class="ident" id="5336334">Body</span><span class="op" id="5336338">:</span>&nbsp;<span class="ident" id="5336340">body</span><span class="op" id="5336344">,</span>&nbsp;<span class="ident" id="5336346">Else</span><span class="op" id="5336350">:</span>&nbsp;<span class="ident" id="5336352">else_</span><span class="op" id="5336357">}</span><br>
<span class="lineno"></span><span class="op" id="5336359">}</span><br>
<span class="lineno">1840</span><br>
<span class="lineno"></span><span class="keyword" id="5336362">func</span>&nbsp;<span class="op" id="5336367">(</span><span class="ident" id="5336368">p</span>&nbsp;<span class="op" id="5336370">*</span><span class="ident" id="5336371">parser</span><span class="op" id="5336377">)</span>&nbsp;<span class="ident" id="5336379">parseTypeList</span><span class="op" id="5336392">(</span><span class="op" id="5336393">)</span>&nbsp;<span class="op" id="5336395">(</span><span class="ident" id="5336396">list</span>&nbsp;<span class="op" id="5336401">[</span><span class="op" id="5336402">]</span><span class="ident" id="5336403">ast</span><span class="op" id="5336406">.</span><span class="ident" id="5336407">Expr</span><span class="op" id="5336411">)</span>&nbsp;<span class="op" id="5336413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336416">if</span>&nbsp;<span class="ident" id="5336419">p</span><span class="op" id="5336420">.</span><span class="ident" id="5336421">trace</span>&nbsp;<span class="op" id="5336427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336431">defer</span>&nbsp;<span class="ident" id="5336437">un</span><span class="op" id="5336439">(</span><span class="ident" id="5336440">trace</span><span class="op" id="5336445">(</span><span class="ident" id="5336446">p</span><span class="op" id="5336447">,</span>&nbsp;<span class="string" id="5336449">&#34;TypeList&#34;</span><span class="op" id="5336459">)</span><span class="op" id="5336460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336463">}</span><br>
<span class="lineno">1845</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336467">list</span>&nbsp;<span class="op" id="5336472">=</span>&nbsp;<span class="builtinfunc" id="5336474">append</span><span class="op" id="5336480">(</span><span class="ident" id="5336481">list</span><span class="op" id="5336485">,</span>&nbsp;<span class="ident" id="5336487">p</span><span class="op" id="5336488">.</span><span class="ident" id="5336489">parseType</span><span class="op" id="5336498">(</span><span class="op" id="5336499">)</span><span class="op" id="5336500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336503">for</span>&nbsp;<span class="ident" id="5336507">p</span><span class="op" id="5336508">.</span><span class="ident" id="5336509">tok</span>&nbsp;<span class="op" id="5336513">==</span>&nbsp;<span class="ident" id="5336516">token</span><span class="op" id="5336521">.</span><span class="ident" id="5336522">COMMA</span>&nbsp;<span class="op" id="5336528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336532">p</span><span class="op" id="5336533">.</span><span class="ident" id="5336534">next</span><span class="op" id="5336538">(</span><span class="op" id="5336539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336543">list</span>&nbsp;<span class="op" id="5336548">=</span>&nbsp;<span class="builtinfunc" id="5336550">append</span><span class="op" id="5336556">(</span><span class="ident" id="5336557">list</span><span class="op" id="5336561">,</span>&nbsp;<span class="ident" id="5336563">p</span><span class="op" id="5336564">.</span><span class="ident" id="5336565">parseType</span><span class="op" id="5336574">(</span><span class="op" id="5336575">)</span><span class="op" id="5336576">)</span><br>
<span class="lineno">1850</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336583">return</span><br>
<span class="lineno"></span><span class="op" id="5336590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1855</span><span class="keyword" id="5336593">func</span>&nbsp;<span class="op" id="5336598">(</span><span class="ident" id="5336599">p</span>&nbsp;<span class="op" id="5336601">*</span><span class="ident" id="5336602">parser</span><span class="op" id="5336608">)</span>&nbsp;<span class="ident" id="5336610">parseCaseClause</span><span class="op" id="5336625">(</span><span class="ident" id="5336626">typeSwitch</span>&nbsp;<span class="builtintype" id="5336637">bool</span><span class="op" id="5336641">)</span>&nbsp;<span class="op" id="5336643">*</span><span class="ident" id="5336644">ast</span><span class="op" id="5336647">.</span><span class="ident" id="5336648">CaseClause</span>&nbsp;<span class="op" id="5336659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336662">if</span>&nbsp;<span class="ident" id="5336665">p</span><span class="op" id="5336666">.</span><span class="ident" id="5336667">trace</span>&nbsp;<span class="op" id="5336673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336677">defer</span>&nbsp;<span class="ident" id="5336683">un</span><span class="op" id="5336685">(</span><span class="ident" id="5336686">trace</span><span class="op" id="5336691">(</span><span class="ident" id="5336692">p</span><span class="op" id="5336693">,</span>&nbsp;<span class="string" id="5336695">&#34;CaseClause&#34;</span><span class="op" id="5336707">)</span><span class="op" id="5336708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1860</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336715">pos</span>&nbsp;<span class="op" id="5336719">:=</span>&nbsp;<span class="ident" id="5336722">p</span><span class="op" id="5336723">.</span><span class="ident" id="5336724">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336729">var</span>&nbsp;<span class="ident" id="5336733">list</span>&nbsp;<span class="op" id="5336738">[</span><span class="op" id="5336739">]</span><span class="ident" id="5336740">ast</span><span class="op" id="5336743">.</span><span class="ident" id="5336744">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336750">if</span>&nbsp;<span class="ident" id="5336753">p</span><span class="op" id="5336754">.</span><span class="ident" id="5336755">tok</span>&nbsp;<span class="op" id="5336759">==</span>&nbsp;<span class="ident" id="5336762">token</span><span class="op" id="5336767">.</span><span class="ident" id="5336768">CASE</span>&nbsp;<span class="op" id="5336773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336777">p</span><span class="op" id="5336778">.</span><span class="ident" id="5336779">next</span><span class="op" id="5336783">(</span><span class="op" id="5336784">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5336788">if</span>&nbsp;<span class="ident" id="5336791">typeSwitch</span>&nbsp;<span class="op" id="5336802">{</span><br>
<span class="lineno">1865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336807">list</span>&nbsp;<span class="op" id="5336812">=</span>&nbsp;<span class="ident" id="5336814">p</span><span class="op" id="5336815">.</span><span class="ident" id="5336816">parseTypeList</span><span class="op" id="5336829">(</span><span class="op" id="5336830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336834">}</span>&nbsp;<span class="keyword" id="5336836">else</span>&nbsp;<span class="op" id="5336841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336846">list</span>&nbsp;<span class="op" id="5336851">=</span>&nbsp;<span class="ident" id="5336853">p</span><span class="op" id="5336854">.</span><span class="ident" id="5336855">parseRhsList</span><span class="op" id="5336867">(</span><span class="op" id="5336868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336875">}</span>&nbsp;<span class="keyword" id="5336877">else</span>&nbsp;<span class="op" id="5336882">{</span><br>
<span class="lineno">1870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336886">p</span><span class="op" id="5336887">.</span><span class="ident" id="5336888">expect</span><span class="op" id="5336894">(</span><span class="ident" id="5336895">token</span><span class="op" id="5336900">.</span><span class="ident" id="5336901">DEFAULT</span><span class="op" id="5336908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5336911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336915">colon</span>&nbsp;<span class="op" id="5336921">:=</span>&nbsp;<span class="ident" id="5336924">p</span><span class="op" id="5336925">.</span><span class="ident" id="5336926">expect</span><span class="op" id="5336932">(</span><span class="ident" id="5336933">token</span><span class="op" id="5336938">.</span><span class="ident" id="5336939">COLON</span><span class="op" id="5336944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336947">p</span><span class="op" id="5336948">.</span><span class="ident" id="5336949">openScope</span><span class="op" id="5336958">(</span><span class="op" id="5336959">)</span><br>
<span class="lineno">1875</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336962">body</span>&nbsp;<span class="op" id="5336967">:=</span>&nbsp;<span class="ident" id="5336970">p</span><span class="op" id="5336971">.</span><span class="ident" id="5336972">parseStmtList</span><span class="op" id="5336985">(</span><span class="op" id="5336986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5336989">p</span><span class="op" id="5336990">.</span><span class="ident" id="5336991">closeScope</span><span class="op" id="5337001">(</span><span class="op" id="5337002">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337006">return</span>&nbsp;<span class="op" id="5337013">&amp;</span><span class="ident" id="5337014">ast</span><span class="op" id="5337017">.</span><span class="ident" id="5337018">CaseClause</span><span class="op" id="5337028">{</span><span class="ident" id="5337029">Case</span><span class="op" id="5337033">:</span>&nbsp;<span class="ident" id="5337035">pos</span><span class="op" id="5337038">,</span>&nbsp;<span class="ident" id="5337040">List</span><span class="op" id="5337044">:</span>&nbsp;<span class="ident" id="5337046">list</span><span class="op" id="5337050">,</span>&nbsp;<span class="ident" id="5337052">Colon</span><span class="op" id="5337057">:</span>&nbsp;<span class="ident" id="5337059">colon</span><span class="op" id="5337064">,</span>&nbsp;<span class="ident" id="5337066">Body</span><span class="op" id="5337070">:</span>&nbsp;<span class="ident" id="5337072">body</span><span class="op" id="5337076">}</span><br>
<span class="lineno"></span><span class="op" id="5337078">}</span><br>
<span class="lineno">1880</span><br>
<span class="lineno"></span><span class="keyword" id="5337081">func</span>&nbsp;<span class="ident" id="5337086">isTypeSwitchAssert</span><span class="op" id="5337104">(</span><span class="ident" id="5337105">x</span>&nbsp;<span class="ident" id="5337107">ast</span><span class="op" id="5337110">.</span><span class="ident" id="5337111">Expr</span><span class="op" id="5337115">)</span>&nbsp;<span class="builtintype" id="5337117">bool</span>&nbsp;<span class="op" id="5337122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337125">a</span><span class="op" id="5337126">,</span>&nbsp;<span class="ident" id="5337128">ok</span>&nbsp;<span class="op" id="5337131">:=</span>&nbsp;<span class="ident" id="5337134">x</span><span class="op" id="5337135">.</span><span class="op" id="5337136">(</span><span class="op" id="5337137">*</span><span class="ident" id="5337138">ast</span><span class="op" id="5337141">.</span><span class="ident" id="5337142">TypeAssertExpr</span><span class="op" id="5337156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337159">return</span>&nbsp;<span class="ident" id="5337166">ok</span>&nbsp;<span class="op" id="5337169">&amp;&amp;</span>&nbsp;<span class="ident" id="5337172">a</span><span class="op" id="5337173">.</span><span class="ident" id="5337174">Type</span>&nbsp;<span class="op" id="5337179">==</span>&nbsp;<span class="builtintype" id="5337182">nil</span><br>
<span class="lineno"></span><span class="op" id="5337186">}</span><br>
<span class="lineno">1885</span><br>
<span class="lineno"></span><span class="keyword" id="5337189">func</span>&nbsp;<span class="ident" id="5337194">isTypeSwitchGuard</span><span class="op" id="5337211">(</span><span class="ident" id="5337212">s</span>&nbsp;<span class="ident" id="5337214">ast</span><span class="op" id="5337217">.</span><span class="ident" id="5337218">Stmt</span><span class="op" id="5337222">)</span>&nbsp;<span class="builtintype" id="5337224">bool</span>&nbsp;<span class="op" id="5337229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337232">switch</span>&nbsp;<span class="ident" id="5337239">t</span>&nbsp;<span class="op" id="5337241">:=</span>&nbsp;<span class="ident" id="5337244">s</span><span class="op" id="5337245">.</span><span class="op" id="5337246">(</span><span class="keyword" id="5337247">type</span><span class="op" id="5337251">)</span>&nbsp;<span class="op" id="5337253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337256">case</span>&nbsp;<span class="op" id="5337261">*</span><span class="ident" id="5337262">ast</span><span class="op" id="5337265">.</span><span class="ident" id="5337266">ExprStmt</span><span class="op" id="5337274">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5337278">//&nbsp;x.(nil)</span><br>
<span class="lineno">1890</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337291">return</span>&nbsp;<span class="ident" id="5337298">isTypeSwitchAssert</span><span class="op" id="5337316">(</span><span class="ident" id="5337317">t</span><span class="op" id="5337318">.</span><span class="ident" id="5337319">X</span><span class="op" id="5337320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337323">case</span>&nbsp;<span class="op" id="5337328">*</span><span class="ident" id="5337329">ast</span><span class="op" id="5337332">.</span><span class="ident" id="5337333">AssignStmt</span><span class="op" id="5337343">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5337347">//&nbsp;v&nbsp;:=&nbsp;x.(nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337365">return</span>&nbsp;<span class="builtinfunc" id="5337372">len</span><span class="op" id="5337375">(</span><span class="ident" id="5337376">t</span><span class="op" id="5337377">.</span><span class="ident" id="5337378">Lhs</span><span class="op" id="5337381">)</span>&nbsp;<span class="op" id="5337383">==</span>&nbsp;<span class="num" id="5337386">1</span>&nbsp;<span class="op" id="5337388">&amp;&amp;</span>&nbsp;<span class="ident" id="5337391">t</span><span class="op" id="5337392">.</span><span class="ident" id="5337393">Tok</span>&nbsp;<span class="op" id="5337397">==</span>&nbsp;<span class="ident" id="5337400">token</span><span class="op" id="5337405">.</span><span class="ident" id="5337406">DEFINE</span>&nbsp;<span class="op" id="5337413">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5337416">len</span><span class="op" id="5337419">(</span><span class="ident" id="5337420">t</span><span class="op" id="5337421">.</span><span class="ident" id="5337422">Rhs</span><span class="op" id="5337425">)</span>&nbsp;<span class="op" id="5337427">==</span>&nbsp;<span class="num" id="5337430">1</span>&nbsp;<span class="op" id="5337432">&amp;&amp;</span>&nbsp;<span class="ident" id="5337435">isTypeSwitchAssert</span><span class="op" id="5337453">(</span><span class="ident" id="5337454">t</span><span class="op" id="5337455">.</span><span class="ident" id="5337456">Rhs</span><span class="op" id="5337459">[</span><span class="num" id="5337460">0</span><span class="op" id="5337461">]</span><span class="op" id="5337462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5337465">}</span><br>
<span class="lineno">1895</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337468">return</span>&nbsp;<span class="builtintype" id="5337475">false</span><br>
<span class="lineno"></span><span class="op" id="5337481">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5337484">func</span>&nbsp;<span class="op" id="5337489">(</span><span class="ident" id="5337490">p</span>&nbsp;<span class="op" id="5337492">*</span><span class="ident" id="5337493">parser</span><span class="op" id="5337499">)</span>&nbsp;<span class="ident" id="5337501">parseSwitchStmt</span><span class="op" id="5337516">(</span><span class="op" id="5337517">)</span>&nbsp;<span class="ident" id="5337519">ast</span><span class="op" id="5337522">.</span><span class="ident" id="5337523">Stmt</span>&nbsp;<span class="op" id="5337528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337531">if</span>&nbsp;<span class="ident" id="5337534">p</span><span class="op" id="5337535">.</span><span class="ident" id="5337536">trace</span>&nbsp;<span class="op" id="5337542">{</span><br>
<span class="lineno">1900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337546">defer</span>&nbsp;<span class="ident" id="5337552">un</span><span class="op" id="5337554">(</span><span class="ident" id="5337555">trace</span><span class="op" id="5337560">(</span><span class="ident" id="5337561">p</span><span class="op" id="5337562">,</span>&nbsp;<span class="string" id="5337564">&#34;SwitchStmt&#34;</span><span class="op" id="5337576">)</span><span class="op" id="5337577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5337580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337584">pos</span>&nbsp;<span class="op" id="5337588">:=</span>&nbsp;<span class="ident" id="5337591">p</span><span class="op" id="5337592">.</span><span class="ident" id="5337593">expect</span><span class="op" id="5337599">(</span><span class="ident" id="5337600">token</span><span class="op" id="5337605">.</span><span class="ident" id="5337606">SWITCH</span><span class="op" id="5337612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337615">p</span><span class="op" id="5337616">.</span><span class="ident" id="5337617">openScope</span><span class="op" id="5337626">(</span><span class="op" id="5337627">)</span><br>
<span class="lineno">1905</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337630">defer</span>&nbsp;<span class="ident" id="5337636">p</span><span class="op" id="5337637">.</span><span class="ident" id="5337638">closeScope</span><span class="op" id="5337648">(</span><span class="op" id="5337649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337653">var</span>&nbsp;<span class="ident" id="5337657">s1</span><span class="op" id="5337659">,</span>&nbsp;<span class="ident" id="5337661">s2</span>&nbsp;<span class="ident" id="5337664">ast</span><span class="op" id="5337667">.</span><span class="ident" id="5337668">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337674">if</span>&nbsp;<span class="ident" id="5337677">p</span><span class="op" id="5337678">.</span><span class="ident" id="5337679">tok</span>&nbsp;<span class="op" id="5337683">!=</span>&nbsp;<span class="ident" id="5337686">token</span><span class="op" id="5337691">.</span><span class="ident" id="5337692">LBRACE</span>&nbsp;<span class="op" id="5337699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337703">prevLev</span>&nbsp;<span class="op" id="5337711">:=</span>&nbsp;<span class="ident" id="5337714">p</span><span class="op" id="5337715">.</span><span class="ident" id="5337716">exprLev</span><br>
<span class="lineno">1910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337726">p</span><span class="op" id="5337727">.</span><span class="ident" id="5337728">exprLev</span>&nbsp;<span class="op" id="5337736">=</span>&nbsp;<span class="op" id="5337738">-</span><span class="num" id="5337739">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337743">if</span>&nbsp;<span class="ident" id="5337746">p</span><span class="op" id="5337747">.</span><span class="ident" id="5337748">tok</span>&nbsp;<span class="op" id="5337752">!=</span>&nbsp;<span class="ident" id="5337755">token</span><span class="op" id="5337760">.</span><span class="ident" id="5337761">SEMICOLON</span>&nbsp;<span class="op" id="5337771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337776">s2</span><span class="op" id="5337778">,</span>&nbsp;<span class="ident" id="5337780">_</span>&nbsp;<span class="op" id="5337782">=</span>&nbsp;<span class="ident" id="5337784">p</span><span class="op" id="5337785">.</span><span class="ident" id="5337786">parseSimpleStmt</span><span class="op" id="5337801">(</span><span class="ident" id="5337802">basic</span><span class="op" id="5337807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5337811">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337815">if</span>&nbsp;<span class="ident" id="5337818">p</span><span class="op" id="5337819">.</span><span class="ident" id="5337820">tok</span>&nbsp;<span class="op" id="5337824">==</span>&nbsp;<span class="ident" id="5337827">token</span><span class="op" id="5337832">.</span><span class="ident" id="5337833">SEMICOLON</span>&nbsp;<span class="op" id="5337843">{</span><br>
<span class="lineno">1915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337848">p</span><span class="op" id="5337849">.</span><span class="ident" id="5337850">next</span><span class="op" id="5337854">(</span><span class="op" id="5337855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337860">s1</span>&nbsp;<span class="op" id="5337863">=</span>&nbsp;<span class="ident" id="5337865">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5337871">s2</span>&nbsp;<span class="op" id="5337874">=</span>&nbsp;<span class="builtintype" id="5337876">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5337883">if</span>&nbsp;<span class="ident" id="5337886">p</span><span class="op" id="5337887">.</span><span class="ident" id="5337888">tok</span>&nbsp;<span class="op" id="5337892">!=</span>&nbsp;<span class="ident" id="5337895">token</span><span class="op" id="5337900">.</span><span class="ident" id="5337901">LBRACE</span>&nbsp;<span class="op" id="5337908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5337914">//&nbsp;A&nbsp;TypeSwitchGuard&nbsp;may&nbsp;declare&nbsp;a&nbsp;variable&nbsp;in&nbsp;addition</span><br>
<span class="lineno">1920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5337974">//&nbsp;to&nbsp;the&nbsp;variable&nbsp;declared&nbsp;in&nbsp;the&nbsp;initial&nbsp;SimpleStmt.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338033">//&nbsp;Introduce&nbsp;extra&nbsp;scope&nbsp;to&nbsp;avoid&nbsp;redeclaration&nbsp;errors:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338093">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338100">//&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;t&nbsp;:=&nbsp;0;&nbsp;t&nbsp;:=&nbsp;x.(T)&nbsp;{&nbsp;...&nbsp;}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338141">//</span><br>
<span class="lineno">1925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338148">//&nbsp;(this&nbsp;code&nbsp;is&nbsp;not&nbsp;valid&nbsp;Go&nbsp;because&nbsp;the&nbsp;first&nbsp;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338202">//&nbsp;cannot&nbsp;be&nbsp;accessed&nbsp;and&nbsp;thus&nbsp;is&nbsp;never&nbsp;used,&nbsp;the&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338262">//&nbsp;scope&nbsp;is&nbsp;needed&nbsp;for&nbsp;the&nbsp;correct&nbsp;error&nbsp;message).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338317">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338324">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;a&nbsp;type&nbsp;switch,&nbsp;s2&nbsp;must&nbsp;be&nbsp;an&nbsp;expression.</span><br>
<span class="lineno">1930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5338389">//&nbsp;Having&nbsp;the&nbsp;extra&nbsp;nested&nbsp;but&nbsp;empty&nbsp;scope&nbsp;won&#39;t&nbsp;affect&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338453">p</span><span class="op" id="5338454">.</span><span class="ident" id="5338455">openScope</span><span class="op" id="5338464">(</span><span class="op" id="5338465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338471">defer</span>&nbsp;<span class="ident" id="5338477">p</span><span class="op" id="5338478">.</span><span class="ident" id="5338479">closeScope</span><span class="op" id="5338489">(</span><span class="op" id="5338490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338496">s2</span><span class="op" id="5338498">,</span>&nbsp;<span class="ident" id="5338500">_</span>&nbsp;<span class="op" id="5338502">=</span>&nbsp;<span class="ident" id="5338504">p</span><span class="op" id="5338505">.</span><span class="ident" id="5338506">parseSimpleStmt</span><span class="op" id="5338521">(</span><span class="ident" id="5338522">basic</span><span class="op" id="5338527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5338532">}</span><br>
<span class="lineno">1935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5338536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338540">p</span><span class="op" id="5338541">.</span><span class="ident" id="5338542">exprLev</span>&nbsp;<span class="op" id="5338550">=</span>&nbsp;<span class="ident" id="5338552">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5338561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338565">typeSwitch</span>&nbsp;<span class="op" id="5338576">:=</span>&nbsp;<span class="ident" id="5338579">isTypeSwitchGuard</span><span class="op" id="5338596">(</span><span class="ident" id="5338597">s2</span><span class="op" id="5338599">)</span><br>
<span class="lineno">1940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338602">lbrace</span>&nbsp;<span class="op" id="5338609">:=</span>&nbsp;<span class="ident" id="5338612">p</span><span class="op" id="5338613">.</span><span class="ident" id="5338614">expect</span><span class="op" id="5338620">(</span><span class="ident" id="5338621">token</span><span class="op" id="5338626">.</span><span class="ident" id="5338627">LBRACE</span><span class="op" id="5338633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338636">var</span>&nbsp;<span class="ident" id="5338640">list</span>&nbsp;<span class="op" id="5338645">[</span><span class="op" id="5338646">]</span><span class="ident" id="5338647">ast</span><span class="op" id="5338650">.</span><span class="ident" id="5338651">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338657">for</span>&nbsp;<span class="ident" id="5338661">p</span><span class="op" id="5338662">.</span><span class="ident" id="5338663">tok</span>&nbsp;<span class="op" id="5338667">==</span>&nbsp;<span class="ident" id="5338670">token</span><span class="op" id="5338675">.</span><span class="ident" id="5338676">CASE</span>&nbsp;<span class="op" id="5338681">||</span>&nbsp;<span class="ident" id="5338684">p</span><span class="op" id="5338685">.</span><span class="ident" id="5338686">tok</span>&nbsp;<span class="op" id="5338690">==</span>&nbsp;<span class="ident" id="5338693">token</span><span class="op" id="5338698">.</span><span class="ident" id="5338699">DEFAULT</span>&nbsp;<span class="op" id="5338707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338711">list</span>&nbsp;<span class="op" id="5338716">=</span>&nbsp;<span class="builtinfunc" id="5338718">append</span><span class="op" id="5338724">(</span><span class="ident" id="5338725">list</span><span class="op" id="5338729">,</span>&nbsp;<span class="ident" id="5338731">p</span><span class="op" id="5338732">.</span><span class="ident" id="5338733">parseCaseClause</span><span class="op" id="5338748">(</span><span class="ident" id="5338749">typeSwitch</span><span class="op" id="5338759">)</span><span class="op" id="5338760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5338763">}</span><br>
<span class="lineno">1945</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338766">rbrace</span>&nbsp;<span class="op" id="5338773">:=</span>&nbsp;<span class="ident" id="5338776">p</span><span class="op" id="5338777">.</span><span class="ident" id="5338778">expect</span><span class="op" id="5338784">(</span><span class="ident" id="5338785">token</span><span class="op" id="5338790">.</span><span class="ident" id="5338791">RBRACE</span><span class="op" id="5338797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338800">p</span><span class="op" id="5338801">.</span><span class="ident" id="5338802">expectSemi</span><span class="op" id="5338812">(</span><span class="op" id="5338813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5338816">body</span>&nbsp;<span class="op" id="5338821">:=</span>&nbsp;<span class="op" id="5338824">&amp;</span><span class="ident" id="5338825">ast</span><span class="op" id="5338828">.</span><span class="ident" id="5338829">BlockStmt</span><span class="op" id="5338838">{</span><span class="ident" id="5338839">Lbrace</span><span class="op" id="5338845">:</span>&nbsp;<span class="ident" id="5338847">lbrace</span><span class="op" id="5338853">,</span>&nbsp;<span class="ident" id="5338855">List</span><span class="op" id="5338859">:</span>&nbsp;<span class="ident" id="5338861">list</span><span class="op" id="5338865">,</span>&nbsp;<span class="ident" id="5338867">Rbrace</span><span class="op" id="5338873">:</span>&nbsp;<span class="ident" id="5338875">rbrace</span><span class="op" id="5338881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338885">if</span>&nbsp;<span class="ident" id="5338888">typeSwitch</span>&nbsp;<span class="op" id="5338899">{</span><br>
<span class="lineno">1950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338903">return</span>&nbsp;<span class="op" id="5338910">&amp;</span><span class="ident" id="5338911">ast</span><span class="op" id="5338914">.</span><span class="ident" id="5338915">TypeSwitchStmt</span><span class="op" id="5338929">{</span><span class="ident" id="5338930">Switch</span><span class="op" id="5338936">:</span>&nbsp;<span class="ident" id="5338938">pos</span><span class="op" id="5338941">,</span>&nbsp;<span class="ident" id="5338943">Init</span><span class="op" id="5338947">:</span>&nbsp;<span class="ident" id="5338949">s1</span><span class="op" id="5338951">,</span>&nbsp;<span class="ident" id="5338953">Assign</span><span class="op" id="5338959">:</span>&nbsp;<span class="ident" id="5338961">s2</span><span class="op" id="5338963">,</span>&nbsp;<span class="ident" id="5338965">Body</span><span class="op" id="5338969">:</span>&nbsp;<span class="ident" id="5338971">body</span><span class="op" id="5338975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5338978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5338982">return</span>&nbsp;<span class="op" id="5338989">&amp;</span><span class="ident" id="5338990">ast</span><span class="op" id="5338993">.</span><span class="ident" id="5338994">SwitchStmt</span><span class="op" id="5339004">{</span><span class="ident" id="5339005">Switch</span><span class="op" id="5339011">:</span>&nbsp;<span class="ident" id="5339013">pos</span><span class="op" id="5339016">,</span>&nbsp;<span class="ident" id="5339018">Init</span><span class="op" id="5339022">:</span>&nbsp;<span class="ident" id="5339024">s1</span><span class="op" id="5339026">,</span>&nbsp;<span class="ident" id="5339028">Tag</span><span class="op" id="5339031">:</span>&nbsp;<span class="ident" id="5339033">p</span><span class="op" id="5339034">.</span><span class="ident" id="5339035">makeExpr</span><span class="op" id="5339043">(</span><span class="ident" id="5339044">s2</span><span class="op" id="5339046">,</span>&nbsp;<span class="string" id="5339048">&#34;switch&nbsp;expression&#34;</span><span class="op" id="5339067">)</span><span class="op" id="5339068">,</span>&nbsp;<span class="ident" id="5339070">Body</span><span class="op" id="5339074">:</span>&nbsp;<span class="ident" id="5339076">body</span><span class="op" id="5339080">}</span><br>
<span class="lineno"></span><span class="op" id="5339082">}</span><br>
<span class="lineno">1955</span><br>
<span class="lineno"></span><span class="keyword" id="5339085">func</span>&nbsp;<span class="op" id="5339090">(</span><span class="ident" id="5339091">p</span>&nbsp;<span class="op" id="5339093">*</span><span class="ident" id="5339094">parser</span><span class="op" id="5339100">)</span>&nbsp;<span class="ident" id="5339102">parseCommClause</span><span class="op" id="5339117">(</span><span class="op" id="5339118">)</span>&nbsp;<span class="op" id="5339120">*</span><span class="ident" id="5339121">ast</span><span class="op" id="5339124">.</span><span class="ident" id="5339125">CommClause</span>&nbsp;<span class="op" id="5339136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339139">if</span>&nbsp;<span class="ident" id="5339142">p</span><span class="op" id="5339143">.</span><span class="ident" id="5339144">trace</span>&nbsp;<span class="op" id="5339150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339154">defer</span>&nbsp;<span class="ident" id="5339160">un</span><span class="op" id="5339162">(</span><span class="ident" id="5339163">trace</span><span class="op" id="5339168">(</span><span class="ident" id="5339169">p</span><span class="op" id="5339170">,</span>&nbsp;<span class="string" id="5339172">&#34;CommClause&#34;</span><span class="op" id="5339184">)</span><span class="op" id="5339185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5339188">}</span><br>
<span class="lineno">1960</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339192">p</span><span class="op" id="5339193">.</span><span class="ident" id="5339194">openScope</span><span class="op" id="5339203">(</span><span class="op" id="5339204">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339207">pos</span>&nbsp;<span class="op" id="5339211">:=</span>&nbsp;<span class="ident" id="5339214">p</span><span class="op" id="5339215">.</span><span class="ident" id="5339216">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339221">var</span>&nbsp;<span class="ident" id="5339225">comm</span>&nbsp;<span class="ident" id="5339230">ast</span><span class="op" id="5339233">.</span><span class="ident" id="5339234">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339240">if</span>&nbsp;<span class="ident" id="5339243">p</span><span class="op" id="5339244">.</span><span class="ident" id="5339245">tok</span>&nbsp;<span class="op" id="5339249">==</span>&nbsp;<span class="ident" id="5339252">token</span><span class="op" id="5339257">.</span><span class="ident" id="5339258">CASE</span>&nbsp;<span class="op" id="5339263">{</span><br>
<span class="lineno">1965</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339267">p</span><span class="op" id="5339268">.</span><span class="ident" id="5339269">next</span><span class="op" id="5339273">(</span><span class="op" id="5339274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339278">lhs</span>&nbsp;<span class="op" id="5339282">:=</span>&nbsp;<span class="ident" id="5339285">p</span><span class="op" id="5339286">.</span><span class="ident" id="5339287">parseLhsList</span><span class="op" id="5339299">(</span><span class="op" id="5339300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339304">if</span>&nbsp;<span class="ident" id="5339307">p</span><span class="op" id="5339308">.</span><span class="ident" id="5339309">tok</span>&nbsp;<span class="op" id="5339313">==</span>&nbsp;<span class="ident" id="5339316">token</span><span class="op" id="5339321">.</span><span class="ident" id="5339322">ARROW</span>&nbsp;<span class="op" id="5339328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339333">//&nbsp;SendStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339348">if</span>&nbsp;<span class="builtinfunc" id="5339351">len</span><span class="op" id="5339354">(</span><span class="ident" id="5339355">lhs</span><span class="op" id="5339358">)</span>&nbsp;<span class="op" id="5339360">&gt;</span>&nbsp;<span class="num" id="5339362">1</span>&nbsp;<span class="op" id="5339364">{</span><br>
<span class="lineno">1970</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339370">p</span><span class="op" id="5339371">.</span><span class="ident" id="5339372">errorExpected</span><span class="op" id="5339385">(</span><span class="ident" id="5339386">lhs</span><span class="op" id="5339389">[</span><span class="num" id="5339390">0</span><span class="op" id="5339391">]</span><span class="op" id="5339392">.</span><span class="ident" id="5339393">Pos</span><span class="op" id="5339396">(</span><span class="op" id="5339397">)</span><span class="op" id="5339398">,</span>&nbsp;<span class="string" id="5339400">&#34;1&nbsp;expression&#34;</span><span class="op" id="5339414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339420">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5339457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339462">arrow</span>&nbsp;<span class="op" id="5339468">:=</span>&nbsp;<span class="ident" id="5339471">p</span><span class="op" id="5339472">.</span><span class="ident" id="5339473">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339480">p</span><span class="op" id="5339481">.</span><span class="ident" id="5339482">next</span><span class="op" id="5339486">(</span><span class="op" id="5339487">)</span><br>
<span class="lineno">1975</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339492">rhs</span>&nbsp;<span class="op" id="5339496">:=</span>&nbsp;<span class="ident" id="5339499">p</span><span class="op" id="5339500">.</span><span class="ident" id="5339501">parseRhs</span><span class="op" id="5339509">(</span><span class="op" id="5339510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339515">comm</span>&nbsp;<span class="op" id="5339520">=</span>&nbsp;<span class="op" id="5339522">&amp;</span><span class="ident" id="5339523">ast</span><span class="op" id="5339526">.</span><span class="ident" id="5339527">SendStmt</span><span class="op" id="5339535">{</span><span class="ident" id="5339536">Chan</span><span class="op" id="5339540">:</span>&nbsp;<span class="ident" id="5339542">lhs</span><span class="op" id="5339545">[</span><span class="num" id="5339546">0</span><span class="op" id="5339547">]</span><span class="op" id="5339548">,</span>&nbsp;<span class="ident" id="5339550">Arrow</span><span class="op" id="5339555">:</span>&nbsp;<span class="ident" id="5339557">arrow</span><span class="op" id="5339562">,</span>&nbsp;<span class="ident" id="5339564">Value</span><span class="op" id="5339569">:</span>&nbsp;<span class="ident" id="5339571">rhs</span><span class="op" id="5339574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5339578">}</span>&nbsp;<span class="keyword" id="5339580">else</span>&nbsp;<span class="op" id="5339585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339590">//&nbsp;RecvStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339605">if</span>&nbsp;<span class="ident" id="5339608">tok</span>&nbsp;<span class="op" id="5339612">:=</span>&nbsp;<span class="ident" id="5339615">p</span><span class="op" id="5339616">.</span><span class="ident" id="5339617">tok</span><span class="op" id="5339620">;</span>&nbsp;<span class="ident" id="5339622">tok</span>&nbsp;<span class="op" id="5339626">==</span>&nbsp;<span class="ident" id="5339629">token</span><span class="op" id="5339634">.</span><span class="ident" id="5339635">ASSIGN</span>&nbsp;<span class="op" id="5339642">||</span>&nbsp;<span class="ident" id="5339645">tok</span>&nbsp;<span class="op" id="5339649">==</span>&nbsp;<span class="ident" id="5339652">token</span><span class="op" id="5339657">.</span><span class="ident" id="5339658">DEFINE</span>&nbsp;<span class="op" id="5339665">{</span><br>
<span class="lineno">1980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339671">//&nbsp;RecvStmt&nbsp;with&nbsp;assignment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339703">if</span>&nbsp;<span class="builtinfunc" id="5339706">len</span><span class="op" id="5339709">(</span><span class="ident" id="5339710">lhs</span><span class="op" id="5339713">)</span>&nbsp;<span class="op" id="5339715">&gt;</span>&nbsp;<span class="num" id="5339717">2</span>&nbsp;<span class="op" id="5339719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339726">p</span><span class="op" id="5339727">.</span><span class="ident" id="5339728">errorExpected</span><span class="op" id="5339741">(</span><span class="ident" id="5339742">lhs</span><span class="op" id="5339745">[</span><span class="num" id="5339746">0</span><span class="op" id="5339747">]</span><span class="op" id="5339748">.</span><span class="ident" id="5339749">Pos</span><span class="op" id="5339752">(</span><span class="op" id="5339753">)</span><span class="op" id="5339754">,</span>&nbsp;<span class="string" id="5339756">&#34;1&nbsp;or&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5339776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5339783">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;two&nbsp;expressions</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339827">lhs</span>&nbsp;<span class="op" id="5339831">=</span>&nbsp;<span class="ident" id="5339833">lhs</span><span class="op" id="5339836">[</span><span class="num" id="5339837">0</span><span class="op" id="5339838">:</span><span class="num" id="5339839">2</span><span class="op" id="5339840">]</span><br>
<span class="lineno">1985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5339846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339852">pos</span>&nbsp;<span class="op" id="5339856">:=</span>&nbsp;<span class="ident" id="5339859">p</span><span class="op" id="5339860">.</span><span class="ident" id="5339861">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339869">p</span><span class="op" id="5339870">.</span><span class="ident" id="5339871">next</span><span class="op" id="5339875">(</span><span class="op" id="5339876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339882">rhs</span>&nbsp;<span class="op" id="5339886">:=</span>&nbsp;<span class="ident" id="5339889">p</span><span class="op" id="5339890">.</span><span class="ident" id="5339891">parseRhs</span><span class="op" id="5339899">(</span><span class="op" id="5339900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5339906">as</span>&nbsp;<span class="op" id="5339909">:=</span>&nbsp;<span class="op" id="5339912">&amp;</span><span class="ident" id="5339913">ast</span><span class="op" id="5339916">.</span><span class="ident" id="5339917">AssignStmt</span><span class="op" id="5339927">{</span><span class="ident" id="5339928">Lhs</span><span class="op" id="5339931">:</span>&nbsp;<span class="ident" id="5339933">lhs</span><span class="op" id="5339936">,</span>&nbsp;<span class="ident" id="5339938">TokPos</span><span class="op" id="5339944">:</span>&nbsp;<span class="ident" id="5339946">pos</span><span class="op" id="5339949">,</span>&nbsp;<span class="ident" id="5339951">Tok</span><span class="op" id="5339954">:</span>&nbsp;<span class="ident" id="5339956">tok</span><span class="op" id="5339959">,</span>&nbsp;<span class="ident" id="5339961">Rhs</span><span class="op" id="5339964">:</span>&nbsp;<span class="op" id="5339966">[</span><span class="op" id="5339967">]</span><span class="ident" id="5339968">ast</span><span class="op" id="5339971">.</span><span class="ident" id="5339972">Expr</span><span class="op" id="5339976">{</span><span class="ident" id="5339977">rhs</span><span class="op" id="5339980">}</span><span class="op" id="5339981">}</span><br>
<span class="lineno">1990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5339987">if</span>&nbsp;<span class="ident" id="5339990">tok</span>&nbsp;<span class="op" id="5339994">==</span>&nbsp;<span class="ident" id="5339997">token</span><span class="op" id="5340002">.</span><span class="ident" id="5340003">DEFINE</span>&nbsp;<span class="op" id="5340010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340017">p</span><span class="op" id="5340018">.</span><span class="ident" id="5340019">shortVarDecl</span><span class="op" id="5340031">(</span><span class="ident" id="5340032">as</span><span class="op" id="5340034">,</span>&nbsp;<span class="ident" id="5340036">lhs</span><span class="op" id="5340039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340051">comm</span>&nbsp;<span class="op" id="5340056">=</span>&nbsp;<span class="ident" id="5340058">as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340064">}</span>&nbsp;<span class="keyword" id="5340066">else</span>&nbsp;<span class="op" id="5340071">{</span><br>
<span class="lineno">1995</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340077">//&nbsp;lhs&nbsp;must&nbsp;be&nbsp;single&nbsp;receive&nbsp;operation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340121">if</span>&nbsp;<span class="builtinfunc" id="5340124">len</span><span class="op" id="5340127">(</span><span class="ident" id="5340128">lhs</span><span class="op" id="5340131">)</span>&nbsp;<span class="op" id="5340133">&gt;</span>&nbsp;<span class="num" id="5340135">1</span>&nbsp;<span class="op" id="5340137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340144">p</span><span class="op" id="5340145">.</span><span class="ident" id="5340146">errorExpected</span><span class="op" id="5340159">(</span><span class="ident" id="5340160">lhs</span><span class="op" id="5340163">[</span><span class="num" id="5340164">0</span><span class="op" id="5340165">]</span><span class="op" id="5340166">.</span><span class="ident" id="5340167">Pos</span><span class="op" id="5340170">(</span><span class="op" id="5340171">)</span><span class="op" id="5340172">,</span>&nbsp;<span class="string" id="5340174">&#34;1&nbsp;expression&#34;</span><span class="op" id="5340188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5340195">//&nbsp;continue&nbsp;with&nbsp;first&nbsp;expression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340233">}</span><br>
<span class="lineno">2000</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340239">comm</span>&nbsp;<span class="op" id="5340244">=</span>&nbsp;<span class="op" id="5340246">&amp;</span><span class="ident" id="5340247">ast</span><span class="op" id="5340250">.</span><span class="ident" id="5340251">ExprStmt</span><span class="op" id="5340259">{</span><span class="ident" id="5340260">X</span><span class="op" id="5340261">:</span>&nbsp;<span class="ident" id="5340263">lhs</span><span class="op" id="5340266">[</span><span class="num" id="5340267">0</span><span class="op" id="5340268">]</span><span class="op" id="5340269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340281">}</span>&nbsp;<span class="keyword" id="5340283">else</span>&nbsp;<span class="op" id="5340288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340292">p</span><span class="op" id="5340293">.</span><span class="ident" id="5340294">expect</span><span class="op" id="5340300">(</span><span class="ident" id="5340301">token</span><span class="op" id="5340306">.</span><span class="ident" id="5340307">DEFAULT</span><span class="op" id="5340314">)</span><br>
<span class="lineno">2005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340321">colon</span>&nbsp;<span class="op" id="5340327">:=</span>&nbsp;<span class="ident" id="5340330">p</span><span class="op" id="5340331">.</span><span class="ident" id="5340332">expect</span><span class="op" id="5340338">(</span><span class="ident" id="5340339">token</span><span class="op" id="5340344">.</span><span class="ident" id="5340345">COLON</span><span class="op" id="5340350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340353">body</span>&nbsp;<span class="op" id="5340358">:=</span>&nbsp;<span class="ident" id="5340361">p</span><span class="op" id="5340362">.</span><span class="ident" id="5340363">parseStmtList</span><span class="op" id="5340376">(</span><span class="op" id="5340377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340380">p</span><span class="op" id="5340381">.</span><span class="ident" id="5340382">closeScope</span><span class="op" id="5340392">(</span><span class="op" id="5340393">)</span><br>
<span class="lineno">2010</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340397">return</span>&nbsp;<span class="op" id="5340404">&amp;</span><span class="ident" id="5340405">ast</span><span class="op" id="5340408">.</span><span class="ident" id="5340409">CommClause</span><span class="op" id="5340419">{</span><span class="ident" id="5340420">Case</span><span class="op" id="5340424">:</span>&nbsp;<span class="ident" id="5340426">pos</span><span class="op" id="5340429">,</span>&nbsp;<span class="ident" id="5340431">Comm</span><span class="op" id="5340435">:</span>&nbsp;<span class="ident" id="5340437">comm</span><span class="op" id="5340441">,</span>&nbsp;<span class="ident" id="5340443">Colon</span><span class="op" id="5340448">:</span>&nbsp;<span class="ident" id="5340450">colon</span><span class="op" id="5340455">,</span>&nbsp;<span class="ident" id="5340457">Body</span><span class="op" id="5340461">:</span>&nbsp;<span class="ident" id="5340463">body</span><span class="op" id="5340467">}</span><br>
<span class="lineno"></span><span class="op" id="5340469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5340472">func</span>&nbsp;<span class="op" id="5340477">(</span><span class="ident" id="5340478">p</span>&nbsp;<span class="op" id="5340480">*</span><span class="ident" id="5340481">parser</span><span class="op" id="5340487">)</span>&nbsp;<span class="ident" id="5340489">parseSelectStmt</span><span class="op" id="5340504">(</span><span class="op" id="5340505">)</span>&nbsp;<span class="op" id="5340507">*</span><span class="ident" id="5340508">ast</span><span class="op" id="5340511">.</span><span class="ident" id="5340512">SelectStmt</span>&nbsp;<span class="op" id="5340523">{</span><br>
<span class="lineno">2015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340526">if</span>&nbsp;<span class="ident" id="5340529">p</span><span class="op" id="5340530">.</span><span class="ident" id="5340531">trace</span>&nbsp;<span class="op" id="5340537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340541">defer</span>&nbsp;<span class="ident" id="5340547">un</span><span class="op" id="5340549">(</span><span class="ident" id="5340550">trace</span><span class="op" id="5340555">(</span><span class="ident" id="5340556">p</span><span class="op" id="5340557">,</span>&nbsp;<span class="string" id="5340559">&#34;SelectStmt&#34;</span><span class="op" id="5340571">)</span><span class="op" id="5340572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340579">pos</span>&nbsp;<span class="op" id="5340583">:=</span>&nbsp;<span class="ident" id="5340586">p</span><span class="op" id="5340587">.</span><span class="ident" id="5340588">expect</span><span class="op" id="5340594">(</span><span class="ident" id="5340595">token</span><span class="op" id="5340600">.</span><span class="ident" id="5340601">SELECT</span><span class="op" id="5340607">)</span><br>
<span class="lineno">2020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340610">lbrace</span>&nbsp;<span class="op" id="5340617">:=</span>&nbsp;<span class="ident" id="5340620">p</span><span class="op" id="5340621">.</span><span class="ident" id="5340622">expect</span><span class="op" id="5340628">(</span><span class="ident" id="5340629">token</span><span class="op" id="5340634">.</span><span class="ident" id="5340635">LBRACE</span><span class="op" id="5340641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340644">var</span>&nbsp;<span class="ident" id="5340648">list</span>&nbsp;<span class="op" id="5340653">[</span><span class="op" id="5340654">]</span><span class="ident" id="5340655">ast</span><span class="op" id="5340658">.</span><span class="ident" id="5340659">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340665">for</span>&nbsp;<span class="ident" id="5340669">p</span><span class="op" id="5340670">.</span><span class="ident" id="5340671">tok</span>&nbsp;<span class="op" id="5340675">==</span>&nbsp;<span class="ident" id="5340678">token</span><span class="op" id="5340683">.</span><span class="ident" id="5340684">CASE</span>&nbsp;<span class="op" id="5340689">||</span>&nbsp;<span class="ident" id="5340692">p</span><span class="op" id="5340693">.</span><span class="ident" id="5340694">tok</span>&nbsp;<span class="op" id="5340698">==</span>&nbsp;<span class="ident" id="5340701">token</span><span class="op" id="5340706">.</span><span class="ident" id="5340707">DEFAULT</span>&nbsp;<span class="op" id="5340715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340719">list</span>&nbsp;<span class="op" id="5340724">=</span>&nbsp;<span class="builtinfunc" id="5340726">append</span><span class="op" id="5340732">(</span><span class="ident" id="5340733">list</span><span class="op" id="5340737">,</span>&nbsp;<span class="ident" id="5340739">p</span><span class="op" id="5340740">.</span><span class="ident" id="5340741">parseCommClause</span><span class="op" id="5340756">(</span><span class="op" id="5340757">)</span><span class="op" id="5340758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5340761">}</span><br>
<span class="lineno">2025</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340764">rbrace</span>&nbsp;<span class="op" id="5340771">:=</span>&nbsp;<span class="ident" id="5340774">p</span><span class="op" id="5340775">.</span><span class="ident" id="5340776">expect</span><span class="op" id="5340782">(</span><span class="ident" id="5340783">token</span><span class="op" id="5340788">.</span><span class="ident" id="5340789">RBRACE</span><span class="op" id="5340795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340798">p</span><span class="op" id="5340799">.</span><span class="ident" id="5340800">expectSemi</span><span class="op" id="5340810">(</span><span class="op" id="5340811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5340814">body</span>&nbsp;<span class="op" id="5340819">:=</span>&nbsp;<span class="op" id="5340822">&amp;</span><span class="ident" id="5340823">ast</span><span class="op" id="5340826">.</span><span class="ident" id="5340827">BlockStmt</span><span class="op" id="5340836">{</span><span class="ident" id="5340837">Lbrace</span><span class="op" id="5340843">:</span>&nbsp;<span class="ident" id="5340845">lbrace</span><span class="op" id="5340851">,</span>&nbsp;<span class="ident" id="5340853">List</span><span class="op" id="5340857">:</span>&nbsp;<span class="ident" id="5340859">list</span><span class="op" id="5340863">,</span>&nbsp;<span class="ident" id="5340865">Rbrace</span><span class="op" id="5340871">:</span>&nbsp;<span class="ident" id="5340873">rbrace</span><span class="op" id="5340879">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340883">return</span>&nbsp;<span class="op" id="5340890">&amp;</span><span class="ident" id="5340891">ast</span><span class="op" id="5340894">.</span><span class="ident" id="5340895">SelectStmt</span><span class="op" id="5340905">{</span><span class="ident" id="5340906">Select</span><span class="op" id="5340912">:</span>&nbsp;<span class="ident" id="5340914">pos</span><span class="op" id="5340917">,</span>&nbsp;<span class="ident" id="5340919">Body</span><span class="op" id="5340923">:</span>&nbsp;<span class="ident" id="5340925">body</span><span class="op" id="5340929">}</span><br>
<span class="lineno">2030</span><span class="op" id="5340931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5340934">func</span>&nbsp;<span class="op" id="5340939">(</span><span class="ident" id="5340940">p</span>&nbsp;<span class="op" id="5340942">*</span><span class="ident" id="5340943">parser</span><span class="op" id="5340949">)</span>&nbsp;<span class="ident" id="5340951">parseForStmt</span><span class="op" id="5340963">(</span><span class="op" id="5340964">)</span>&nbsp;<span class="ident" id="5340966">ast</span><span class="op" id="5340969">.</span><span class="ident" id="5340970">Stmt</span>&nbsp;<span class="op" id="5340975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340978">if</span>&nbsp;<span class="ident" id="5340981">p</span><span class="op" id="5340982">.</span><span class="ident" id="5340983">trace</span>&nbsp;<span class="op" id="5340989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5340993">defer</span>&nbsp;<span class="ident" id="5340999">un</span><span class="op" id="5341001">(</span><span class="ident" id="5341002">trace</span><span class="op" id="5341007">(</span><span class="ident" id="5341008">p</span><span class="op" id="5341009">,</span>&nbsp;<span class="string" id="5341011">&#34;ForStmt&#34;</span><span class="op" id="5341020">)</span><span class="op" id="5341021">)</span><br>
<span class="lineno">2035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341024">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341028">pos</span>&nbsp;<span class="op" id="5341032">:=</span>&nbsp;<span class="ident" id="5341035">p</span><span class="op" id="5341036">.</span><span class="ident" id="5341037">expect</span><span class="op" id="5341043">(</span><span class="ident" id="5341044">token</span><span class="op" id="5341049">.</span><span class="ident" id="5341050">FOR</span><span class="op" id="5341053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341056">p</span><span class="op" id="5341057">.</span><span class="ident" id="5341058">openScope</span><span class="op" id="5341067">(</span><span class="op" id="5341068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341071">defer</span>&nbsp;<span class="ident" id="5341077">p</span><span class="op" id="5341078">.</span><span class="ident" id="5341079">closeScope</span><span class="op" id="5341089">(</span><span class="op" id="5341090">)</span><br>
<span class="lineno">2040</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341094">var</span>&nbsp;<span class="ident" id="5341098">s1</span><span class="op" id="5341100">,</span>&nbsp;<span class="ident" id="5341102">s2</span><span class="op" id="5341104">,</span>&nbsp;<span class="ident" id="5341106">s3</span>&nbsp;<span class="ident" id="5341109">ast</span><span class="op" id="5341112">.</span><span class="ident" id="5341113">Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341119">var</span>&nbsp;<span class="ident" id="5341123">isRange</span>&nbsp;<span class="builtintype" id="5341131">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341137">if</span>&nbsp;<span class="ident" id="5341140">p</span><span class="op" id="5341141">.</span><span class="ident" id="5341142">tok</span>&nbsp;<span class="op" id="5341146">!=</span>&nbsp;<span class="ident" id="5341149">token</span><span class="op" id="5341154">.</span><span class="ident" id="5341155">LBRACE</span>&nbsp;<span class="op" id="5341162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341166">prevLev</span>&nbsp;<span class="op" id="5341174">:=</span>&nbsp;<span class="ident" id="5341177">p</span><span class="op" id="5341178">.</span><span class="ident" id="5341179">exprLev</span><br>
<span class="lineno">2045</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341189">p</span><span class="op" id="5341190">.</span><span class="ident" id="5341191">exprLev</span>&nbsp;<span class="op" id="5341199">=</span>&nbsp;<span class="op" id="5341201">-</span><span class="num" id="5341202">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341206">if</span>&nbsp;<span class="ident" id="5341209">p</span><span class="op" id="5341210">.</span><span class="ident" id="5341211">tok</span>&nbsp;<span class="op" id="5341215">!=</span>&nbsp;<span class="ident" id="5341218">token</span><span class="op" id="5341223">.</span><span class="ident" id="5341224">SEMICOLON</span>&nbsp;<span class="op" id="5341234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341239">if</span>&nbsp;<span class="ident" id="5341242">p</span><span class="op" id="5341243">.</span><span class="ident" id="5341244">tok</span>&nbsp;<span class="op" id="5341248">==</span>&nbsp;<span class="ident" id="5341251">token</span><span class="op" id="5341256">.</span><span class="ident" id="5341257">RANGE</span>&nbsp;<span class="op" id="5341263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341269">//&nbsp;&#34;for&nbsp;range&nbsp;x&#34;&nbsp;(nil&nbsp;lhs&nbsp;in&nbsp;assignment)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341314">pos</span>&nbsp;<span class="op" id="5341318">:=</span>&nbsp;<span class="ident" id="5341321">p</span><span class="op" id="5341322">.</span><span class="ident" id="5341323">pos</span><br>
<span class="lineno">2050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341331">p</span><span class="op" id="5341332">.</span><span class="ident" id="5341333">next</span><span class="op" id="5341337">(</span><span class="op" id="5341338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341344">y</span>&nbsp;<span class="op" id="5341346">:=</span>&nbsp;<span class="op" id="5341349">[</span><span class="op" id="5341350">]</span><span class="ident" id="5341351">ast</span><span class="op" id="5341354">.</span><span class="ident" id="5341355">Expr</span><span class="op" id="5341359">{</span><span class="op" id="5341360">&amp;</span><span class="ident" id="5341361">ast</span><span class="op" id="5341364">.</span><span class="ident" id="5341365">UnaryExpr</span><span class="op" id="5341374">{</span><span class="ident" id="5341375">OpPos</span><span class="op" id="5341380">:</span>&nbsp;<span class="ident" id="5341382">pos</span><span class="op" id="5341385">,</span>&nbsp;<span class="ident" id="5341387">Op</span><span class="op" id="5341389">:</span>&nbsp;<span class="ident" id="5341391">token</span><span class="op" id="5341396">.</span><span class="ident" id="5341397">RANGE</span><span class="op" id="5341402">,</span>&nbsp;<span class="ident" id="5341404">X</span><span class="op" id="5341405">:</span>&nbsp;<span class="ident" id="5341407">p</span><span class="op" id="5341408">.</span><span class="ident" id="5341409">parseRhs</span><span class="op" id="5341417">(</span><span class="op" id="5341418">)</span><span class="op" id="5341419">}</span><span class="op" id="5341420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341426">s2</span>&nbsp;<span class="op" id="5341429">=</span>&nbsp;<span class="op" id="5341431">&amp;</span><span class="ident" id="5341432">ast</span><span class="op" id="5341435">.</span><span class="ident" id="5341436">AssignStmt</span><span class="op" id="5341446">{</span><span class="ident" id="5341447">Rhs</span><span class="op" id="5341450">:</span>&nbsp;<span class="ident" id="5341452">y</span><span class="op" id="5341453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341459">isRange</span>&nbsp;<span class="op" id="5341467">=</span>&nbsp;<span class="builtintype" id="5341469">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341477">}</span>&nbsp;<span class="keyword" id="5341479">else</span>&nbsp;<span class="op" id="5341484">{</span><br>
<span class="lineno">2055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341490">s2</span><span class="op" id="5341492">,</span>&nbsp;<span class="ident" id="5341494">isRange</span>&nbsp;<span class="op" id="5341502">=</span>&nbsp;<span class="ident" id="5341504">p</span><span class="op" id="5341505">.</span><span class="ident" id="5341506">parseSimpleStmt</span><span class="op" id="5341521">(</span><span class="ident" id="5341522">rangeOk</span><span class="op" id="5341529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341542">if</span>&nbsp;<span class="op" id="5341545">!</span><span class="ident" id="5341546">isRange</span>&nbsp;<span class="op" id="5341554">&amp;&amp;</span>&nbsp;<span class="ident" id="5341557">p</span><span class="op" id="5341558">.</span><span class="ident" id="5341559">tok</span>&nbsp;<span class="op" id="5341563">==</span>&nbsp;<span class="ident" id="5341566">token</span><span class="op" id="5341571">.</span><span class="ident" id="5341572">SEMICOLON</span>&nbsp;<span class="op" id="5341582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341587">p</span><span class="op" id="5341588">.</span><span class="ident" id="5341589">next</span><span class="op" id="5341593">(</span><span class="op" id="5341594">)</span><br>
<span class="lineno">2060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341599">s1</span>&nbsp;<span class="op" id="5341602">=</span>&nbsp;<span class="ident" id="5341604">s2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341610">s2</span>&nbsp;<span class="op" id="5341613">=</span>&nbsp;<span class="builtintype" id="5341615">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341622">if</span>&nbsp;<span class="ident" id="5341625">p</span><span class="op" id="5341626">.</span><span class="ident" id="5341627">tok</span>&nbsp;<span class="op" id="5341631">!=</span>&nbsp;<span class="ident" id="5341634">token</span><span class="op" id="5341639">.</span><span class="ident" id="5341640">SEMICOLON</span>&nbsp;<span class="op" id="5341650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341656">s2</span><span class="op" id="5341658">,</span>&nbsp;<span class="ident" id="5341660">_</span>&nbsp;<span class="op" id="5341662">=</span>&nbsp;<span class="ident" id="5341664">p</span><span class="op" id="5341665">.</span><span class="ident" id="5341666">parseSimpleStmt</span><span class="op" id="5341681">(</span><span class="ident" id="5341682">basic</span><span class="op" id="5341687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341692">}</span><br>
<span class="lineno">2065</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341697">p</span><span class="op" id="5341698">.</span><span class="ident" id="5341699">expectSemi</span><span class="op" id="5341709">(</span><span class="op" id="5341710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341715">if</span>&nbsp;<span class="ident" id="5341718">p</span><span class="op" id="5341719">.</span><span class="ident" id="5341720">tok</span>&nbsp;<span class="op" id="5341724">!=</span>&nbsp;<span class="ident" id="5341727">token</span><span class="op" id="5341732">.</span><span class="ident" id="5341733">LBRACE</span>&nbsp;<span class="op" id="5341740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341746">s3</span><span class="op" id="5341748">,</span>&nbsp;<span class="ident" id="5341750">_</span>&nbsp;<span class="op" id="5341752">=</span>&nbsp;<span class="ident" id="5341754">p</span><span class="op" id="5341755">.</span><span class="ident" id="5341756">parseSimpleStmt</span><span class="op" id="5341771">(</span><span class="ident" id="5341772">basic</span><span class="op" id="5341777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341786">}</span><br>
<span class="lineno">2070</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341790">p</span><span class="op" id="5341791">.</span><span class="ident" id="5341792">exprLev</span>&nbsp;<span class="op" id="5341800">=</span>&nbsp;<span class="ident" id="5341802">prevLev</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5341811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341815">body</span>&nbsp;<span class="op" id="5341820">:=</span>&nbsp;<span class="ident" id="5341823">p</span><span class="op" id="5341824">.</span><span class="ident" id="5341825">parseBlockStmt</span><span class="op" id="5341839">(</span><span class="op" id="5341840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341843">p</span><span class="op" id="5341844">.</span><span class="ident" id="5341845">expectSemi</span><span class="op" id="5341855">(</span><span class="op" id="5341856">)</span><br>
<span class="lineno">2075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341860">if</span>&nbsp;<span class="ident" id="5341863">isRange</span>&nbsp;<span class="op" id="5341871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5341875">as</span>&nbsp;<span class="op" id="5341878">:=</span>&nbsp;<span class="ident" id="5341881">s2</span><span class="op" id="5341883">.</span><span class="op" id="5341884">(</span><span class="op" id="5341885">*</span><span class="ident" id="5341886">ast</span><span class="op" id="5341889">.</span><span class="ident" id="5341890">AssignStmt</span><span class="op" id="5341900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341904">//&nbsp;check&nbsp;lhs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341919">var</span>&nbsp;<span class="ident" id="5341923">key</span><span class="op" id="5341926">,</span>&nbsp;<span class="ident" id="5341928">value</span>&nbsp;<span class="ident" id="5341934">ast</span><span class="op" id="5341937">.</span><span class="ident" id="5341938">Expr</span><br>
<span class="lineno">2080</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341945">switch</span>&nbsp;<span class="builtinfunc" id="5341952">len</span><span class="op" id="5341955">(</span><span class="ident" id="5341956">as</span><span class="op" id="5341958">.</span><span class="ident" id="5341959">Lhs</span><span class="op" id="5341962">)</span>&nbsp;<span class="op" id="5341964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341968">case</span>&nbsp;<span class="num" id="5341973">0</span><span class="op" id="5341974">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5341979">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5341998">case</span>&nbsp;<span class="num" id="5342003">1</span><span class="op" id="5342004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342009">key</span>&nbsp;<span class="op" id="5342013">=</span>&nbsp;<span class="ident" id="5342015">as</span><span class="op" id="5342017">.</span><span class="ident" id="5342018">Lhs</span><span class="op" id="5342021">[</span><span class="num" id="5342022">0</span><span class="op" id="5342023">]</span><br>
<span class="lineno">2085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342027">case</span>&nbsp;<span class="num" id="5342032">2</span><span class="op" id="5342033">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342038">key</span><span class="op" id="5342041">,</span>&nbsp;<span class="ident" id="5342043">value</span>&nbsp;<span class="op" id="5342049">=</span>&nbsp;<span class="ident" id="5342051">as</span><span class="op" id="5342053">.</span><span class="ident" id="5342054">Lhs</span><span class="op" id="5342057">[</span><span class="num" id="5342058">0</span><span class="op" id="5342059">]</span><span class="op" id="5342060">,</span>&nbsp;<span class="ident" id="5342062">as</span><span class="op" id="5342064">.</span><span class="ident" id="5342065">Lhs</span><span class="op" id="5342068">[</span><span class="num" id="5342069">1</span><span class="op" id="5342070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342074">default</span><span class="op" id="5342081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342086">p</span><span class="op" id="5342087">.</span><span class="ident" id="5342088">errorExpected</span><span class="op" id="5342101">(</span><span class="ident" id="5342102">as</span><span class="op" id="5342104">.</span><span class="ident" id="5342105">Lhs</span><span class="op" id="5342108">[</span><span class="builtinfunc" id="5342109">len</span><span class="op" id="5342112">(</span><span class="ident" id="5342113">as</span><span class="op" id="5342115">.</span><span class="ident" id="5342116">Lhs</span><span class="op" id="5342119">)</span><span class="op" id="5342120">-</span><span class="num" id="5342121">1</span><span class="op" id="5342122">]</span><span class="op" id="5342123">.</span><span class="ident" id="5342124">Pos</span><span class="op" id="5342127">(</span><span class="op" id="5342128">)</span><span class="op" id="5342129">,</span>&nbsp;<span class="string" id="5342131">&#34;at&nbsp;most&nbsp;2&nbsp;expressions&#34;</span><span class="op" id="5342154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342159">return</span>&nbsp;<span class="op" id="5342166">&amp;</span><span class="ident" id="5342167">ast</span><span class="op" id="5342170">.</span><span class="ident" id="5342171">BadStmt</span><span class="op" id="5342178">{</span><span class="ident" id="5342179">From</span><span class="op" id="5342183">:</span>&nbsp;<span class="ident" id="5342185">pos</span><span class="op" id="5342188">,</span>&nbsp;<span class="ident" id="5342190">To</span><span class="op" id="5342192">:</span>&nbsp;<span class="ident" id="5342194">p</span><span class="op" id="5342195">.</span><span class="ident" id="5342196">safePos</span><span class="op" id="5342203">(</span><span class="ident" id="5342204">body</span><span class="op" id="5342208">.</span><span class="ident" id="5342209">End</span><span class="op" id="5342212">(</span><span class="op" id="5342213">)</span><span class="op" id="5342214">)</span><span class="op" id="5342215">}</span><br>
<span class="lineno">2090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342223">//&nbsp;parseSimpleStmt&nbsp;returned&nbsp;a&nbsp;right-hand&nbsp;side&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342276">//&nbsp;is&nbsp;a&nbsp;single&nbsp;unary&nbsp;expression&nbsp;of&nbsp;the&nbsp;form&nbsp;&#34;range&nbsp;x&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342332">x</span>&nbsp;<span class="op" id="5342334">:=</span>&nbsp;<span class="ident" id="5342337">as</span><span class="op" id="5342339">.</span><span class="ident" id="5342340">Rhs</span><span class="op" id="5342343">[</span><span class="num" id="5342344">0</span><span class="op" id="5342345">]</span><span class="op" id="5342346">.</span><span class="op" id="5342347">(</span><span class="op" id="5342348">*</span><span class="ident" id="5342349">ast</span><span class="op" id="5342352">.</span><span class="ident" id="5342353">UnaryExpr</span><span class="op" id="5342362">)</span><span class="op" id="5342363">.</span><span class="ident" id="5342364">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342368">return</span>&nbsp;<span class="op" id="5342375">&amp;</span><span class="ident" id="5342376">ast</span><span class="op" id="5342379">.</span><span class="ident" id="5342380">RangeStmt</span><span class="op" id="5342389">{</span><br>
<span class="lineno">2095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342394">For</span><span class="op" id="5342397">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342402">pos</span><span class="op" id="5342405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342410">Key</span><span class="op" id="5342413">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342418">key</span><span class="op" id="5342421">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342426">Value</span><span class="op" id="5342431">:</span>&nbsp;&nbsp;<span class="ident" id="5342434">value</span><span class="op" id="5342439">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342444">TokPos</span><span class="op" id="5342450">:</span>&nbsp;<span class="ident" id="5342452">as</span><span class="op" id="5342454">.</span><span class="ident" id="5342455">TokPos</span><span class="op" id="5342461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342466">Tok</span><span class="op" id="5342469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342474">as</span><span class="op" id="5342476">.</span><span class="ident" id="5342477">Tok</span><span class="op" id="5342480">,</span><br>
<span class="lineno">2100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342485">X</span><span class="op" id="5342486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342493">x</span><span class="op" id="5342494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342499">Body</span><span class="op" id="5342503">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5342507">body</span><span class="op" id="5342511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342522">//&nbsp;regular&nbsp;for&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342548">return</span>&nbsp;<span class="op" id="5342555">&amp;</span><span class="ident" id="5342556">ast</span><span class="op" id="5342559">.</span><span class="ident" id="5342560">ForStmt</span><span class="op" id="5342567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342571">For</span><span class="op" id="5342574">:</span>&nbsp;&nbsp;<span class="ident" id="5342577">pos</span><span class="op" id="5342580">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342584">Init</span><span class="op" id="5342588">:</span>&nbsp;<span class="ident" id="5342590">s1</span><span class="op" id="5342592">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342596">Cond</span><span class="op" id="5342600">:</span>&nbsp;<span class="ident" id="5342602">p</span><span class="op" id="5342603">.</span><span class="ident" id="5342604">makeExpr</span><span class="op" id="5342612">(</span><span class="ident" id="5342613">s2</span><span class="op" id="5342615">,</span>&nbsp;<span class="string" id="5342617">&#34;boolean&nbsp;or&nbsp;range&nbsp;expression&#34;</span><span class="op" id="5342646">)</span><span class="op" id="5342647">,</span><br>
<span class="lineno">2110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342651">Post</span><span class="op" id="5342655">:</span>&nbsp;<span class="ident" id="5342657">s3</span><span class="op" id="5342659">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342663">Body</span><span class="op" id="5342667">:</span>&nbsp;<span class="ident" id="5342669">body</span><span class="op" id="5342673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342676">}</span><br>
<span class="lineno"></span><span class="op" id="5342678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2115</span><span class="keyword" id="5342681">func</span>&nbsp;<span class="op" id="5342686">(</span><span class="ident" id="5342687">p</span>&nbsp;<span class="op" id="5342689">*</span><span class="ident" id="5342690">parser</span><span class="op" id="5342696">)</span>&nbsp;<span class="ident" id="5342698">parseStmt</span><span class="op" id="5342707">(</span><span class="op" id="5342708">)</span>&nbsp;<span class="op" id="5342710">(</span><span class="ident" id="5342711">s</span>&nbsp;<span class="ident" id="5342713">ast</span><span class="op" id="5342716">.</span><span class="ident" id="5342717">Stmt</span><span class="op" id="5342721">)</span>&nbsp;<span class="op" id="5342723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342726">if</span>&nbsp;<span class="ident" id="5342729">p</span><span class="op" id="5342730">.</span><span class="ident" id="5342731">trace</span>&nbsp;<span class="op" id="5342737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342741">defer</span>&nbsp;<span class="ident" id="5342747">un</span><span class="op" id="5342749">(</span><span class="ident" id="5342750">trace</span><span class="op" id="5342755">(</span><span class="ident" id="5342756">p</span><span class="op" id="5342757">,</span>&nbsp;<span class="string" id="5342759">&#34;Statement&#34;</span><span class="op" id="5342770">)</span><span class="op" id="5342771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5342774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342778">switch</span>&nbsp;<span class="ident" id="5342785">p</span><span class="op" id="5342786">.</span><span class="ident" id="5342787">tok</span>&nbsp;<span class="op" id="5342791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342794">case</span>&nbsp;<span class="ident" id="5342799">token</span><span class="op" id="5342804">.</span><span class="ident" id="5342805">CONST</span><span class="op" id="5342810">,</span>&nbsp;<span class="ident" id="5342812">token</span><span class="op" id="5342817">.</span><span class="ident" id="5342818">TYPE</span><span class="op" id="5342822">,</span>&nbsp;<span class="ident" id="5342824">token</span><span class="op" id="5342829">.</span><span class="ident" id="5342830">VAR</span><span class="op" id="5342833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342837">s</span>&nbsp;<span class="op" id="5342839">=</span>&nbsp;<span class="op" id="5342841">&amp;</span><span class="ident" id="5342842">ast</span><span class="op" id="5342845">.</span><span class="ident" id="5342846">DeclStmt</span><span class="op" id="5342854">{</span><span class="ident" id="5342855">Decl</span><span class="op" id="5342859">:</span>&nbsp;<span class="ident" id="5342861">p</span><span class="op" id="5342862">.</span><span class="ident" id="5342863">parseDecl</span><span class="op" id="5342872">(</span><span class="ident" id="5342873">syncStmt</span><span class="op" id="5342881">)</span><span class="op" id="5342882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5342885">case</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5342892">//&nbsp;tokens&nbsp;that&nbsp;may&nbsp;start&nbsp;an&nbsp;expression</span><br>
<span class="lineno">2125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5342933">token</span><span class="op" id="5342938">.</span><span class="ident" id="5342939">IDENT</span><span class="op" id="5342944">,</span>&nbsp;<span class="ident" id="5342946">token</span><span class="op" id="5342951">.</span><span class="ident" id="5342952">INT</span><span class="op" id="5342955">,</span>&nbsp;<span class="ident" id="5342957">token</span><span class="op" id="5342962">.</span><span class="ident" id="5342963">FLOAT</span><span class="op" id="5342968">,</span>&nbsp;<span class="ident" id="5342970">token</span><span class="op" id="5342975">.</span><span class="ident" id="5342976">IMAG</span><span class="op" id="5342980">,</span>&nbsp;<span class="ident" id="5342982">token</span><span class="op" id="5342987">.</span><span class="ident" id="5342988">CHAR</span><span class="op" id="5342992">,</span>&nbsp;<span class="ident" id="5342994">token</span><span class="op" id="5342999">.</span><span class="ident" id="5343000">STRING</span><span class="op" id="5343006">,</span>&nbsp;<span class="ident" id="5343008">token</span><span class="op" id="5343013">.</span><span class="ident" id="5343014">FUNC</span><span class="op" id="5343018">,</span>&nbsp;<span class="ident" id="5343020">token</span><span class="op" id="5343025">.</span><span class="ident" id="5343026">LPAREN</span><span class="op" id="5343032">,</span>&nbsp;<span class="comment" id="5343034">//&nbsp;operands</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343048">token</span><span class="op" id="5343053">.</span><span class="ident" id="5343054">LBRACK</span><span class="op" id="5343060">,</span>&nbsp;<span class="ident" id="5343062">token</span><span class="op" id="5343067">.</span><span class="ident" id="5343068">STRUCT</span><span class="op" id="5343074">,</span>&nbsp;<span class="comment" id="5343076">//&nbsp;composite&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343097">token</span><span class="op" id="5343102">.</span><span class="ident" id="5343103">ADD</span><span class="op" id="5343106">,</span>&nbsp;<span class="ident" id="5343108">token</span><span class="op" id="5343113">.</span><span class="ident" id="5343114">SUB</span><span class="op" id="5343117">,</span>&nbsp;<span class="ident" id="5343119">token</span><span class="op" id="5343124">.</span><span class="ident" id="5343125">MUL</span><span class="op" id="5343128">,</span>&nbsp;<span class="ident" id="5343130">token</span><span class="op" id="5343135">.</span><span class="ident" id="5343136">AND</span><span class="op" id="5343139">,</span>&nbsp;<span class="ident" id="5343141">token</span><span class="op" id="5343146">.</span><span class="ident" id="5343147">XOR</span><span class="op" id="5343150">,</span>&nbsp;<span class="ident" id="5343152">token</span><span class="op" id="5343157">.</span><span class="ident" id="5343158">ARROW</span><span class="op" id="5343163">,</span>&nbsp;<span class="ident" id="5343165">token</span><span class="op" id="5343170">.</span><span class="ident" id="5343171">NOT</span><span class="op" id="5343174">:</span>&nbsp;<span class="comment" id="5343176">//&nbsp;unary&nbsp;operators</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343197">s</span><span class="op" id="5343198">,</span>&nbsp;<span class="ident" id="5343200">_</span>&nbsp;<span class="op" id="5343202">=</span>&nbsp;<span class="ident" id="5343204">p</span><span class="op" id="5343205">.</span><span class="ident" id="5343206">parseSimpleStmt</span><span class="op" id="5343221">(</span><span class="ident" id="5343222">labelOk</span><span class="op" id="5343229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5343233">//&nbsp;because&nbsp;of&nbsp;the&nbsp;required&nbsp;look-ahead,&nbsp;labeled&nbsp;statements&nbsp;are</span><br>
<span class="lineno">2130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5343297">//&nbsp;parsed&nbsp;by&nbsp;parseSimpleStmt&nbsp;-&nbsp;don&#39;t&nbsp;expect&nbsp;a&nbsp;semicolon&nbsp;after</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5343361">//&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343371">if</span>&nbsp;<span class="ident" id="5343374">_</span><span class="op" id="5343375">,</span>&nbsp;<span class="ident" id="5343377">isLabeledStmt</span>&nbsp;<span class="op" id="5343391">:=</span>&nbsp;<span class="ident" id="5343394">s</span><span class="op" id="5343395">.</span><span class="op" id="5343396">(</span><span class="op" id="5343397">*</span><span class="ident" id="5343398">ast</span><span class="op" id="5343401">.</span><span class="ident" id="5343402">LabeledStmt</span><span class="op" id="5343413">)</span><span class="op" id="5343414">;</span>&nbsp;<span class="op" id="5343416">!</span><span class="ident" id="5343417">isLabeledStmt</span>&nbsp;<span class="op" id="5343431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343436">p</span><span class="op" id="5343437">.</span><span class="ident" id="5343438">expectSemi</span><span class="op" id="5343448">(</span><span class="op" id="5343449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5343453">}</span><br>
<span class="lineno">2135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343456">case</span>&nbsp;<span class="ident" id="5343461">token</span><span class="op" id="5343466">.</span><span class="ident" id="5343467">GO</span><span class="op" id="5343469">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343473">s</span>&nbsp;<span class="op" id="5343475">=</span>&nbsp;<span class="ident" id="5343477">p</span><span class="op" id="5343478">.</span><span class="ident" id="5343479">parseGoStmt</span><span class="op" id="5343490">(</span><span class="op" id="5343491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343494">case</span>&nbsp;<span class="ident" id="5343499">token</span><span class="op" id="5343504">.</span><span class="ident" id="5343505">DEFER</span><span class="op" id="5343510">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343514">s</span>&nbsp;<span class="op" id="5343516">=</span>&nbsp;<span class="ident" id="5343518">p</span><span class="op" id="5343519">.</span><span class="ident" id="5343520">parseDeferStmt</span><span class="op" id="5343534">(</span><span class="op" id="5343535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343538">case</span>&nbsp;<span class="ident" id="5343543">token</span><span class="op" id="5343548">.</span><span class="ident" id="5343549">RETURN</span><span class="op" id="5343555">:</span><br>
<span class="lineno">2140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343559">s</span>&nbsp;<span class="op" id="5343561">=</span>&nbsp;<span class="ident" id="5343563">p</span><span class="op" id="5343564">.</span><span class="ident" id="5343565">parseReturnStmt</span><span class="op" id="5343580">(</span><span class="op" id="5343581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343584">case</span>&nbsp;<span class="ident" id="5343589">token</span><span class="op" id="5343594">.</span><span class="ident" id="5343595">BREAK</span><span class="op" id="5343600">,</span>&nbsp;<span class="ident" id="5343602">token</span><span class="op" id="5343607">.</span><span class="ident" id="5343608">CONTINUE</span><span class="op" id="5343616">,</span>&nbsp;<span class="ident" id="5343618">token</span><span class="op" id="5343623">.</span><span class="ident" id="5343624">GOTO</span><span class="op" id="5343628">,</span>&nbsp;<span class="ident" id="5343630">token</span><span class="op" id="5343635">.</span><span class="ident" id="5343636">FALLTHROUGH</span><span class="op" id="5343647">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343651">s</span>&nbsp;<span class="op" id="5343653">=</span>&nbsp;<span class="ident" id="5343655">p</span><span class="op" id="5343656">.</span><span class="ident" id="5343657">parseBranchStmt</span><span class="op" id="5343672">(</span><span class="ident" id="5343673">p</span><span class="op" id="5343674">.</span><span class="ident" id="5343675">tok</span><span class="op" id="5343678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343681">case</span>&nbsp;<span class="ident" id="5343686">token</span><span class="op" id="5343691">.</span><span class="ident" id="5343692">LBRACE</span><span class="op" id="5343698">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343702">s</span>&nbsp;<span class="op" id="5343704">=</span>&nbsp;<span class="ident" id="5343706">p</span><span class="op" id="5343707">.</span><span class="ident" id="5343708">parseBlockStmt</span><span class="op" id="5343722">(</span><span class="op" id="5343723">)</span><br>
<span class="lineno">2145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343727">p</span><span class="op" id="5343728">.</span><span class="ident" id="5343729">expectSemi</span><span class="op" id="5343739">(</span><span class="op" id="5343740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343743">case</span>&nbsp;<span class="ident" id="5343748">token</span><span class="op" id="5343753">.</span><span class="ident" id="5343754">IF</span><span class="op" id="5343756">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343760">s</span>&nbsp;<span class="op" id="5343762">=</span>&nbsp;<span class="ident" id="5343764">p</span><span class="op" id="5343765">.</span><span class="ident" id="5343766">parseIfStmt</span><span class="op" id="5343777">(</span><span class="op" id="5343778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343781">case</span>&nbsp;<span class="ident" id="5343786">token</span><span class="op" id="5343791">.</span><span class="ident" id="5343792">SWITCH</span><span class="op" id="5343798">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343802">s</span>&nbsp;<span class="op" id="5343804">=</span>&nbsp;<span class="ident" id="5343806">p</span><span class="op" id="5343807">.</span><span class="ident" id="5343808">parseSwitchStmt</span><span class="op" id="5343823">(</span><span class="op" id="5343824">)</span><br>
<span class="lineno">2150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343827">case</span>&nbsp;<span class="ident" id="5343832">token</span><span class="op" id="5343837">.</span><span class="ident" id="5343838">SELECT</span><span class="op" id="5343844">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343848">s</span>&nbsp;<span class="op" id="5343850">=</span>&nbsp;<span class="ident" id="5343852">p</span><span class="op" id="5343853">.</span><span class="ident" id="5343854">parseSelectStmt</span><span class="op" id="5343869">(</span><span class="op" id="5343870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343873">case</span>&nbsp;<span class="ident" id="5343878">token</span><span class="op" id="5343883">.</span><span class="ident" id="5343884">FOR</span><span class="op" id="5343887">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343891">s</span>&nbsp;<span class="op" id="5343893">=</span>&nbsp;<span class="ident" id="5343895">p</span><span class="op" id="5343896">.</span><span class="ident" id="5343897">parseForStmt</span><span class="op" id="5343909">(</span><span class="op" id="5343910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343913">case</span>&nbsp;<span class="ident" id="5343918">token</span><span class="op" id="5343923">.</span><span class="ident" id="5343924">SEMICOLON</span><span class="op" id="5343933">:</span><br>
<span class="lineno">2155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343937">s</span>&nbsp;<span class="op" id="5343939">=</span>&nbsp;<span class="op" id="5343941">&amp;</span><span class="ident" id="5343942">ast</span><span class="op" id="5343945">.</span><span class="ident" id="5343946">EmptyStmt</span><span class="op" id="5343955">{</span><span class="ident" id="5343956">Semicolon</span><span class="op" id="5343965">:</span>&nbsp;<span class="ident" id="5343967">p</span><span class="op" id="5343968">.</span><span class="ident" id="5343969">pos</span><span class="op" id="5343972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5343976">p</span><span class="op" id="5343977">.</span><span class="ident" id="5343978">next</span><span class="op" id="5343982">(</span><span class="op" id="5343983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5343986">case</span>&nbsp;<span class="ident" id="5343991">token</span><span class="op" id="5343996">.</span><span class="ident" id="5343997">RBRACE</span><span class="op" id="5344003">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5344007">//&nbsp;a&nbsp;semicolon&nbsp;may&nbsp;be&nbsp;omitted&nbsp;before&nbsp;a&nbsp;closing&nbsp;&#34;}&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344060">s</span>&nbsp;<span class="op" id="5344062">=</span>&nbsp;<span class="op" id="5344064">&amp;</span><span class="ident" id="5344065">ast</span><span class="op" id="5344068">.</span><span class="ident" id="5344069">EmptyStmt</span><span class="op" id="5344078">{</span><span class="ident" id="5344079">Semicolon</span><span class="op" id="5344088">:</span>&nbsp;<span class="ident" id="5344090">p</span><span class="op" id="5344091">.</span><span class="ident" id="5344092">pos</span><span class="op" id="5344095">}</span><br>
<span class="lineno">2160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344098">default</span><span class="op" id="5344105">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5344109">//&nbsp;no&nbsp;statement&nbsp;found</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344133">pos</span>&nbsp;<span class="op" id="5344137">:=</span>&nbsp;<span class="ident" id="5344140">p</span><span class="op" id="5344141">.</span><span class="ident" id="5344142">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344148">p</span><span class="op" id="5344149">.</span><span class="ident" id="5344150">errorExpected</span><span class="op" id="5344163">(</span><span class="ident" id="5344164">pos</span><span class="op" id="5344167">,</span>&nbsp;<span class="string" id="5344169">&#34;statement&#34;</span><span class="op" id="5344180">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344184">syncStmt</span><span class="op" id="5344192">(</span><span class="ident" id="5344193">p</span><span class="op" id="5344194">)</span><br>
<span class="lineno">2165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344198">s</span>&nbsp;<span class="op" id="5344200">=</span>&nbsp;<span class="op" id="5344202">&amp;</span><span class="ident" id="5344203">ast</span><span class="op" id="5344206">.</span><span class="ident" id="5344207">BadStmt</span><span class="op" id="5344214">{</span><span class="ident" id="5344215">From</span><span class="op" id="5344219">:</span>&nbsp;<span class="ident" id="5344221">pos</span><span class="op" id="5344224">,</span>&nbsp;<span class="ident" id="5344226">To</span><span class="op" id="5344228">:</span>&nbsp;<span class="ident" id="5344230">p</span><span class="op" id="5344231">.</span><span class="ident" id="5344232">pos</span><span class="op" id="5344235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344238">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344242">return</span><br>
<span class="lineno"></span><span class="op" id="5344249">}</span><br>
<span class="lineno">2170</span><br>
<span class="lineno"></span><span class="comment" id="5344252">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="5344332">//&nbsp;Declarations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5344349">type</span>&nbsp;<span class="ident" id="5344354">parseSpecFunction</span>&nbsp;<span class="keyword" id="5344372">func</span><span class="op" id="5344376">(</span><span class="ident" id="5344377">doc</span>&nbsp;<span class="op" id="5344381">*</span><span class="ident" id="5344382">ast</span><span class="op" id="5344385">.</span><span class="ident" id="5344386">CommentGroup</span><span class="op" id="5344398">,</span>&nbsp;<span class="ident" id="5344400">keyword</span>&nbsp;<span class="ident" id="5344408">token</span><span class="op" id="5344413">.</span><span class="ident" id="5344414">Token</span><span class="op" id="5344419">,</span>&nbsp;<span class="ident" id="5344421">iota</span>&nbsp;<span class="builtintype" id="5344426">int</span><span class="op" id="5344429">)</span>&nbsp;<span class="ident" id="5344431">ast</span><span class="op" id="5344434">.</span><span class="ident" id="5344435">Spec</span><br>
<span class="lineno">2175</span><br>
<span class="lineno"></span><span class="keyword" id="5344441">func</span>&nbsp;<span class="ident" id="5344446">isValidImport</span><span class="op" id="5344459">(</span><span class="ident" id="5344460">lit</span>&nbsp;<span class="builtintype" id="5344464">string</span><span class="op" id="5344470">)</span>&nbsp;<span class="builtintype" id="5344472">bool</span>&nbsp;<span class="op" id="5344477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344480">const</span>&nbsp;<span class="ident" id="5344486">illegalChars</span>&nbsp;<span class="op" id="5344499">=</span>&nbsp;<span class="string" id="5344501">`!&#34;#$%&amp;&#39;()*,:;&lt;=&gt;?[\]^{|}`</span>&nbsp;<span class="op" id="5344528">+</span>&nbsp;<span class="string" id="5344530">&#34;`\uFFFD&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344541">s</span><span class="op" id="5344542">,</span>&nbsp;<span class="ident" id="5344544">_</span>&nbsp;<span class="op" id="5344546">:=</span>&nbsp;<span class="ident" id="5344549">strconv</span><span class="op" id="5344556">.</span><span class="ident" id="5344557">Unquote</span><span class="op" id="5344564">(</span><span class="ident" id="5344565">lit</span><span class="op" id="5344568">)</span>&nbsp;<span class="comment" id="5344570">//&nbsp;go/scanner&nbsp;returns&nbsp;a&nbsp;legal&nbsp;string&nbsp;literal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344616">for</span>&nbsp;<span class="ident" id="5344620">_</span><span class="op" id="5344621">,</span>&nbsp;<span class="ident" id="5344623">r</span>&nbsp;<span class="op" id="5344625">:=</span>&nbsp;<span class="keyword" id="5344628">range</span>&nbsp;<span class="ident" id="5344634">s</span>&nbsp;<span class="op" id="5344636">{</span><br>
<span class="lineno">2180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344640">if</span>&nbsp;<span class="op" id="5344643">!</span><span class="ident" id="5344644">unicode</span><span class="op" id="5344651">.</span><span class="ident" id="5344652">IsGraphic</span><span class="op" id="5344661">(</span><span class="ident" id="5344662">r</span><span class="op" id="5344663">)</span>&nbsp;<span class="op" id="5344665">||</span>&nbsp;<span class="ident" id="5344668">unicode</span><span class="op" id="5344675">.</span><span class="ident" id="5344676">IsSpace</span><span class="op" id="5344683">(</span><span class="ident" id="5344684">r</span><span class="op" id="5344685">)</span>&nbsp;<span class="op" id="5344687">||</span>&nbsp;<span class="ident" id="5344690">strings</span><span class="op" id="5344697">.</span><span class="ident" id="5344698">ContainsRune</span><span class="op" id="5344710">(</span><span class="ident" id="5344711">illegalChars</span><span class="op" id="5344723">,</span>&nbsp;<span class="ident" id="5344725">r</span><span class="op" id="5344726">)</span>&nbsp;<span class="op" id="5344728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344733">return</span>&nbsp;<span class="builtintype" id="5344740">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344748">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344754">return</span>&nbsp;<span class="ident" id="5344761">s</span>&nbsp;<span class="op" id="5344763">!=</span>&nbsp;<span class="string" id="5344766">&#34;&#34;</span><br>
<span class="lineno">2185</span><span class="op" id="5344769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5344772">func</span>&nbsp;<span class="op" id="5344777">(</span><span class="ident" id="5344778">p</span>&nbsp;<span class="op" id="5344780">*</span><span class="ident" id="5344781">parser</span><span class="op" id="5344787">)</span>&nbsp;<span class="ident" id="5344789">parseImportSpec</span><span class="op" id="5344804">(</span><span class="ident" id="5344805">doc</span>&nbsp;<span class="op" id="5344809">*</span><span class="ident" id="5344810">ast</span><span class="op" id="5344813">.</span><span class="ident" id="5344814">CommentGroup</span><span class="op" id="5344826">,</span>&nbsp;<span class="ident" id="5344828">_</span>&nbsp;<span class="ident" id="5344830">token</span><span class="op" id="5344835">.</span><span class="ident" id="5344836">Token</span><span class="op" id="5344841">,</span>&nbsp;<span class="ident" id="5344843">_</span>&nbsp;<span class="builtintype" id="5344845">int</span><span class="op" id="5344848">)</span>&nbsp;<span class="ident" id="5344850">ast</span><span class="op" id="5344853">.</span><span class="ident" id="5344854">Spec</span>&nbsp;<span class="op" id="5344859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344862">if</span>&nbsp;<span class="ident" id="5344865">p</span><span class="op" id="5344866">.</span><span class="ident" id="5344867">trace</span>&nbsp;<span class="op" id="5344873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344877">defer</span>&nbsp;<span class="ident" id="5344883">un</span><span class="op" id="5344885">(</span><span class="ident" id="5344886">trace</span><span class="op" id="5344891">(</span><span class="ident" id="5344892">p</span><span class="op" id="5344893">,</span>&nbsp;<span class="string" id="5344895">&#34;ImportSpec&#34;</span><span class="op" id="5344907">)</span><span class="op" id="5344908">)</span><br>
<span class="lineno">2190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5344911">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344915">var</span>&nbsp;<span class="ident" id="5344919">ident</span>&nbsp;<span class="op" id="5344925">*</span><span class="ident" id="5344926">ast</span><span class="op" id="5344929">.</span><span class="ident" id="5344930">Ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344937">switch</span>&nbsp;<span class="ident" id="5344944">p</span><span class="op" id="5344945">.</span><span class="ident" id="5344946">tok</span>&nbsp;<span class="op" id="5344950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5344953">case</span>&nbsp;<span class="ident" id="5344958">token</span><span class="op" id="5344963">.</span><span class="ident" id="5344964">PERIOD</span><span class="op" id="5344970">:</span><br>
<span class="lineno">2195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5344974">ident</span>&nbsp;<span class="op" id="5344980">=</span>&nbsp;<span class="op" id="5344982">&amp;</span><span class="ident" id="5344983">ast</span><span class="op" id="5344986">.</span><span class="ident" id="5344987">Ident</span><span class="op" id="5344992">{</span><span class="ident" id="5344993">NamePos</span><span class="op" id="5345000">:</span>&nbsp;<span class="ident" id="5345002">p</span><span class="op" id="5345003">.</span><span class="ident" id="5345004">pos</span><span class="op" id="5345007">,</span>&nbsp;<span class="ident" id="5345009">Name</span><span class="op" id="5345013">:</span>&nbsp;<span class="string" id="5345015">&#34;.&#34;</span><span class="op" id="5345018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345022">p</span><span class="op" id="5345023">.</span><span class="ident" id="5345024">next</span><span class="op" id="5345028">(</span><span class="op" id="5345029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345032">case</span>&nbsp;<span class="ident" id="5345037">token</span><span class="op" id="5345042">.</span><span class="ident" id="5345043">IDENT</span><span class="op" id="5345048">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345052">ident</span>&nbsp;<span class="op" id="5345058">=</span>&nbsp;<span class="ident" id="5345060">p</span><span class="op" id="5345061">.</span><span class="ident" id="5345062">parseIdent</span><span class="op" id="5345072">(</span><span class="op" id="5345073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345076">}</span><br>
<span class="lineno">2200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345080">pos</span>&nbsp;<span class="op" id="5345084">:=</span>&nbsp;<span class="ident" id="5345087">p</span><span class="op" id="5345088">.</span><span class="ident" id="5345089">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345094">var</span>&nbsp;<span class="ident" id="5345098">path</span>&nbsp;<span class="builtintype" id="5345103">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345111">if</span>&nbsp;<span class="ident" id="5345114">p</span><span class="op" id="5345115">.</span><span class="ident" id="5345116">tok</span>&nbsp;<span class="op" id="5345120">==</span>&nbsp;<span class="ident" id="5345123">token</span><span class="op" id="5345128">.</span><span class="ident" id="5345129">STRING</span>&nbsp;<span class="op" id="5345136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345140">path</span>&nbsp;<span class="op" id="5345145">=</span>&nbsp;<span class="ident" id="5345147">p</span><span class="op" id="5345148">.</span><span class="ident" id="5345149">lit</span><br>
<span class="lineno">2205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345155">if</span>&nbsp;<span class="op" id="5345158">!</span><span class="ident" id="5345159">isValidImport</span><span class="op" id="5345172">(</span><span class="ident" id="5345173">path</span><span class="op" id="5345177">)</span>&nbsp;<span class="op" id="5345179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345184">p</span><span class="op" id="5345185">.</span><span class="builtintype" id="5345186">error</span><span class="op" id="5345191">(</span><span class="ident" id="5345192">pos</span><span class="op" id="5345195">,</span>&nbsp;<span class="string" id="5345197">&#34;invalid&nbsp;import&nbsp;path:&nbsp;&#34;</span><span class="op" id="5345220">+</span><span class="ident" id="5345221">path</span><span class="op" id="5345225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345233">p</span><span class="op" id="5345234">.</span><span class="ident" id="5345235">next</span><span class="op" id="5345239">(</span><span class="op" id="5345240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345243">}</span>&nbsp;<span class="keyword" id="5345245">else</span>&nbsp;<span class="op" id="5345250">{</span><br>
<span class="lineno">2210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345254">p</span><span class="op" id="5345255">.</span><span class="ident" id="5345256">expect</span><span class="op" id="5345262">(</span><span class="ident" id="5345263">token</span><span class="op" id="5345268">.</span><span class="ident" id="5345269">STRING</span><span class="op" id="5345275">)</span>&nbsp;<span class="comment" id="5345277">//&nbsp;use&nbsp;expect()&nbsp;error&nbsp;handling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345312">p</span><span class="op" id="5345313">.</span><span class="ident" id="5345314">expectSemi</span><span class="op" id="5345324">(</span><span class="op" id="5345325">)</span>&nbsp;<span class="comment" id="5345327">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5345368">//&nbsp;collect&nbsp;imports</span><br>
<span class="lineno">2215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345388">spec</span>&nbsp;<span class="op" id="5345393">:=</span>&nbsp;<span class="op" id="5345396">&amp;</span><span class="ident" id="5345397">ast</span><span class="op" id="5345400">.</span><span class="ident" id="5345401">ImportSpec</span><span class="op" id="5345411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345415">Doc</span><span class="op" id="5345418">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345424">doc</span><span class="op" id="5345427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345431">Name</span><span class="op" id="5345435">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345440">ident</span><span class="op" id="5345445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345449">Path</span><span class="op" id="5345453">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345458">&amp;</span><span class="ident" id="5345459">ast</span><span class="op" id="5345462">.</span><span class="ident" id="5345463">BasicLit</span><span class="op" id="5345471">{</span><span class="ident" id="5345472">ValuePos</span><span class="op" id="5345480">:</span>&nbsp;<span class="ident" id="5345482">pos</span><span class="op" id="5345485">,</span>&nbsp;<span class="ident" id="5345487">Kind</span><span class="op" id="5345491">:</span>&nbsp;<span class="ident" id="5345493">token</span><span class="op" id="5345498">.</span><span class="ident" id="5345499">STRING</span><span class="op" id="5345505">,</span>&nbsp;<span class="ident" id="5345507">Value</span><span class="op" id="5345512">:</span>&nbsp;<span class="ident" id="5345514">path</span><span class="op" id="5345518">}</span><span class="op" id="5345519">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345523">Comment</span><span class="op" id="5345530">:</span>&nbsp;<span class="ident" id="5345532">p</span><span class="op" id="5345533">.</span><span class="ident" id="5345534">lineComment</span><span class="op" id="5345545">,</span><br>
<span class="lineno">2220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345551">p</span><span class="op" id="5345552">.</span><span class="ident" id="5345553">imports</span>&nbsp;<span class="op" id="5345561">=</span>&nbsp;<span class="builtinfunc" id="5345563">append</span><span class="op" id="5345569">(</span><span class="ident" id="5345570">p</span><span class="op" id="5345571">.</span><span class="ident" id="5345572">imports</span><span class="op" id="5345579">,</span>&nbsp;<span class="ident" id="5345581">spec</span><span class="op" id="5345585">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345589">return</span>&nbsp;<span class="ident" id="5345596">spec</span><br>
<span class="lineno"></span><span class="op" id="5345601">}</span><br>
<span class="lineno">2225</span><br>
<span class="lineno"></span><span class="keyword" id="5345604">func</span>&nbsp;<span class="op" id="5345609">(</span><span class="ident" id="5345610">p</span>&nbsp;<span class="op" id="5345612">*</span><span class="ident" id="5345613">parser</span><span class="op" id="5345619">)</span>&nbsp;<span class="ident" id="5345621">parseValueSpec</span><span class="op" id="5345635">(</span><span class="ident" id="5345636">doc</span>&nbsp;<span class="op" id="5345640">*</span><span class="ident" id="5345641">ast</span><span class="op" id="5345644">.</span><span class="ident" id="5345645">CommentGroup</span><span class="op" id="5345657">,</span>&nbsp;<span class="ident" id="5345659">keyword</span>&nbsp;<span class="ident" id="5345667">token</span><span class="op" id="5345672">.</span><span class="ident" id="5345673">Token</span><span class="op" id="5345678">,</span>&nbsp;<span class="ident" id="5345680">iota</span>&nbsp;<span class="builtintype" id="5345685">int</span><span class="op" id="5345688">)</span>&nbsp;<span class="ident" id="5345690">ast</span><span class="op" id="5345693">.</span><span class="ident" id="5345694">Spec</span>&nbsp;<span class="op" id="5345699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345702">if</span>&nbsp;<span class="ident" id="5345705">p</span><span class="op" id="5345706">.</span><span class="ident" id="5345707">trace</span>&nbsp;<span class="op" id="5345713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345717">defer</span>&nbsp;<span class="ident" id="5345723">un</span><span class="op" id="5345725">(</span><span class="ident" id="5345726">trace</span><span class="op" id="5345731">(</span><span class="ident" id="5345732">p</span><span class="op" id="5345733">,</span>&nbsp;<span class="ident" id="5345735">keyword</span><span class="op" id="5345742">.</span><span class="ident" id="5345743">String</span><span class="op" id="5345749">(</span><span class="op" id="5345750">)</span><span class="op" id="5345751">+</span><span class="string" id="5345752">&#34;Spec&#34;</span><span class="op" id="5345758">)</span><span class="op" id="5345759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345762">}</span><br>
<span class="lineno">2230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345766">idents</span>&nbsp;<span class="op" id="5345773">:=</span>&nbsp;<span class="ident" id="5345776">p</span><span class="op" id="5345777">.</span><span class="ident" id="5345778">parseIdentList</span><span class="op" id="5345792">(</span><span class="op" id="5345793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345796">typ</span>&nbsp;<span class="op" id="5345800">:=</span>&nbsp;<span class="ident" id="5345803">p</span><span class="op" id="5345804">.</span><span class="ident" id="5345805">tryType</span><span class="op" id="5345812">(</span><span class="op" id="5345813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345816">var</span>&nbsp;<span class="ident" id="5345820">values</span>&nbsp;<span class="op" id="5345827">[</span><span class="op" id="5345828">]</span><span class="ident" id="5345829">ast</span><span class="op" id="5345832">.</span><span class="ident" id="5345833">Expr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5345839">//&nbsp;always&nbsp;permit&nbsp;optional&nbsp;initialization&nbsp;for&nbsp;more&nbsp;tolerant&nbsp;parsing</span><br>
<span class="lineno">2235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5345907">if</span>&nbsp;<span class="ident" id="5345910">p</span><span class="op" id="5345911">.</span><span class="ident" id="5345912">tok</span>&nbsp;<span class="op" id="5345916">==</span>&nbsp;<span class="ident" id="5345919">token</span><span class="op" id="5345924">.</span><span class="ident" id="5345925">ASSIGN</span>&nbsp;<span class="op" id="5345932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345936">p</span><span class="op" id="5345937">.</span><span class="ident" id="5345938">next</span><span class="op" id="5345942">(</span><span class="op" id="5345943">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345947">values</span>&nbsp;<span class="op" id="5345954">=</span>&nbsp;<span class="ident" id="5345956">p</span><span class="op" id="5345957">.</span><span class="ident" id="5345958">parseRhsList</span><span class="op" id="5345970">(</span><span class="op" id="5345971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5345974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5345977">p</span><span class="op" id="5345978">.</span><span class="ident" id="5345979">expectSemi</span><span class="op" id="5345989">(</span><span class="op" id="5345990">)</span>&nbsp;<span class="comment" id="5345992">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno">2240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346033">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;constant&nbsp;or&nbsp;variable&nbsp;identifier&nbsp;declared&nbsp;inside</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346109">//&nbsp;a&nbsp;function&nbsp;begins&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;ConstSpec&nbsp;or&nbsp;VarSpec&nbsp;and&nbsp;ends&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346182">//&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346229">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno">2245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346302">spec</span>&nbsp;<span class="op" id="5346307">:=</span>&nbsp;<span class="op" id="5346310">&amp;</span><span class="ident" id="5346311">ast</span><span class="op" id="5346314">.</span><span class="ident" id="5346315">ValueSpec</span><span class="op" id="5346324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346328">Doc</span><span class="op" id="5346331">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346337">doc</span><span class="op" id="5346340">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346344">Names</span><span class="op" id="5346349">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5346353">idents</span><span class="op" id="5346359">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346363">Type</span><span class="op" id="5346367">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346372">typ</span><span class="op" id="5346375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346379">Values</span><span class="op" id="5346385">:</span>&nbsp;&nbsp;<span class="ident" id="5346388">values</span><span class="op" id="5346394">,</span><br>
<span class="lineno">2250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346398">Comment</span><span class="op" id="5346405">:</span>&nbsp;<span class="ident" id="5346407">p</span><span class="op" id="5346408">.</span><span class="ident" id="5346409">lineComment</span><span class="op" id="5346420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346426">kind</span>&nbsp;<span class="op" id="5346431">:=</span>&nbsp;<span class="ident" id="5346434">ast</span><span class="op" id="5346437">.</span><span class="ident" id="5346438">Con</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346443">if</span>&nbsp;<span class="ident" id="5346446">keyword</span>&nbsp;<span class="op" id="5346454">==</span>&nbsp;<span class="ident" id="5346457">token</span><span class="op" id="5346462">.</span><span class="ident" id="5346463">VAR</span>&nbsp;<span class="op" id="5346467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346471">kind</span>&nbsp;<span class="op" id="5346476">=</span>&nbsp;<span class="ident" id="5346478">ast</span><span class="op" id="5346481">.</span><span class="ident" id="5346482">Var</span><br>
<span class="lineno">2255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346490">p</span><span class="op" id="5346491">.</span><span class="ident" id="5346492">declare</span><span class="op" id="5346499">(</span><span class="ident" id="5346500">spec</span><span class="op" id="5346504">,</span>&nbsp;<span class="ident" id="5346506">iota</span><span class="op" id="5346510">,</span>&nbsp;<span class="ident" id="5346512">p</span><span class="op" id="5346513">.</span><span class="ident" id="5346514">topScope</span><span class="op" id="5346522">,</span>&nbsp;<span class="ident" id="5346524">kind</span><span class="op" id="5346528">,</span>&nbsp;<span class="ident" id="5346530">idents</span><span class="op" id="5346536">...</span><span class="op" id="5346539">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346543">return</span>&nbsp;<span class="ident" id="5346550">spec</span><br>
<span class="lineno"></span><span class="op" id="5346555">}</span><br>
<span class="lineno">2260</span><br>
<span class="lineno"></span><span class="keyword" id="5346558">func</span>&nbsp;<span class="op" id="5346563">(</span><span class="ident" id="5346564">p</span>&nbsp;<span class="op" id="5346566">*</span><span class="ident" id="5346567">parser</span><span class="op" id="5346573">)</span>&nbsp;<span class="ident" id="5346575">parseTypeSpec</span><span class="op" id="5346588">(</span><span class="ident" id="5346589">doc</span>&nbsp;<span class="op" id="5346593">*</span><span class="ident" id="5346594">ast</span><span class="op" id="5346597">.</span><span class="ident" id="5346598">CommentGroup</span><span class="op" id="5346610">,</span>&nbsp;<span class="ident" id="5346612">_</span>&nbsp;<span class="ident" id="5346614">token</span><span class="op" id="5346619">.</span><span class="ident" id="5346620">Token</span><span class="op" id="5346625">,</span>&nbsp;<span class="ident" id="5346627">_</span>&nbsp;<span class="builtintype" id="5346629">int</span><span class="op" id="5346632">)</span>&nbsp;<span class="ident" id="5346634">ast</span><span class="op" id="5346637">.</span><span class="ident" id="5346638">Spec</span>&nbsp;<span class="op" id="5346643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346646">if</span>&nbsp;<span class="ident" id="5346649">p</span><span class="op" id="5346650">.</span><span class="ident" id="5346651">trace</span>&nbsp;<span class="op" id="5346657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5346661">defer</span>&nbsp;<span class="ident" id="5346667">un</span><span class="op" id="5346669">(</span><span class="ident" id="5346670">trace</span><span class="op" id="5346675">(</span><span class="ident" id="5346676">p</span><span class="op" id="5346677">,</span>&nbsp;<span class="string" id="5346679">&#34;TypeSpec&#34;</span><span class="op" id="5346689">)</span><span class="op" id="5346690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5346693">}</span><br>
<span class="lineno">2265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346697">ident</span>&nbsp;<span class="op" id="5346703">:=</span>&nbsp;<span class="ident" id="5346706">p</span><span class="op" id="5346707">.</span><span class="ident" id="5346708">parseIdent</span><span class="op" id="5346718">(</span><span class="op" id="5346719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346723">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;a&nbsp;type&nbsp;identifier&nbsp;declared&nbsp;inside&nbsp;a&nbsp;function&nbsp;begins</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346801">//&nbsp;at&nbsp;the&nbsp;identifier&nbsp;in&nbsp;the&nbsp;TypeSpec&nbsp;and&nbsp;ends&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;innermost</span><br>
<span class="lineno">2270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346876">//&nbsp;containing&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5346898">//&nbsp;(Global&nbsp;identifiers&nbsp;are&nbsp;resolved&nbsp;in&nbsp;a&nbsp;separate&nbsp;phase&nbsp;after&nbsp;parsing.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5346971">spec</span>&nbsp;<span class="op" id="5346976">:=</span>&nbsp;<span class="op" id="5346979">&amp;</span><span class="ident" id="5346980">ast</span><span class="op" id="5346983">.</span><span class="ident" id="5346984">TypeSpec</span><span class="op" id="5346992">{</span><span class="ident" id="5346993">Doc</span><span class="op" id="5346996">:</span>&nbsp;<span class="ident" id="5346998">doc</span><span class="op" id="5347001">,</span>&nbsp;<span class="ident" id="5347003">Name</span><span class="op" id="5347007">:</span>&nbsp;<span class="ident" id="5347009">ident</span><span class="op" id="5347014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347017">p</span><span class="op" id="5347018">.</span><span class="ident" id="5347019">declare</span><span class="op" id="5347026">(</span><span class="ident" id="5347027">spec</span><span class="op" id="5347031">,</span>&nbsp;<span class="builtintype" id="5347033">nil</span><span class="op" id="5347036">,</span>&nbsp;<span class="ident" id="5347038">p</span><span class="op" id="5347039">.</span><span class="ident" id="5347040">topScope</span><span class="op" id="5347048">,</span>&nbsp;<span class="ident" id="5347050">ast</span><span class="op" id="5347053">.</span><span class="ident" id="5347054">Typ</span><span class="op" id="5347057">,</span>&nbsp;<span class="ident" id="5347059">ident</span><span class="op" id="5347064">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347068">spec</span><span class="op" id="5347072">.</span><span class="ident" id="5347073">Type</span>&nbsp;<span class="op" id="5347078">=</span>&nbsp;<span class="ident" id="5347080">p</span><span class="op" id="5347081">.</span><span class="ident" id="5347082">parseType</span><span class="op" id="5347091">(</span><span class="op" id="5347092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347095">p</span><span class="op" id="5347096">.</span><span class="ident" id="5347097">expectSemi</span><span class="op" id="5347107">(</span><span class="op" id="5347108">)</span>&nbsp;<span class="comment" id="5347110">//&nbsp;call&nbsp;before&nbsp;accessing&nbsp;p.linecomment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347150">spec</span><span class="op" id="5347154">.</span><span class="ident" id="5347155">Comment</span>&nbsp;<span class="op" id="5347163">=</span>&nbsp;<span class="ident" id="5347165">p</span><span class="op" id="5347166">.</span><span class="ident" id="5347167">lineComment</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347181">return</span>&nbsp;<span class="ident" id="5347188">spec</span><br>
<span class="lineno">2280</span><span class="op" id="5347193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5347196">func</span>&nbsp;<span class="op" id="5347201">(</span><span class="ident" id="5347202">p</span>&nbsp;<span class="op" id="5347204">*</span><span class="ident" id="5347205">parser</span><span class="op" id="5347211">)</span>&nbsp;<span class="ident" id="5347213">parseGenDecl</span><span class="op" id="5347225">(</span><span class="ident" id="5347226">keyword</span>&nbsp;<span class="ident" id="5347234">token</span><span class="op" id="5347239">.</span><span class="ident" id="5347240">Token</span><span class="op" id="5347245">,</span>&nbsp;<span class="ident" id="5347247">f</span>&nbsp;<span class="ident" id="5347249">parseSpecFunction</span><span class="op" id="5347266">)</span>&nbsp;<span class="op" id="5347268">*</span><span class="ident" id="5347269">ast</span><span class="op" id="5347272">.</span><span class="ident" id="5347273">GenDecl</span>&nbsp;<span class="op" id="5347281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347284">if</span>&nbsp;<span class="ident" id="5347287">p</span><span class="op" id="5347288">.</span><span class="ident" id="5347289">trace</span>&nbsp;<span class="op" id="5347295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347299">defer</span>&nbsp;<span class="ident" id="5347305">un</span><span class="op" id="5347307">(</span><span class="ident" id="5347308">trace</span><span class="op" id="5347313">(</span><span class="ident" id="5347314">p</span><span class="op" id="5347315">,</span>&nbsp;<span class="string" id="5347317">&#34;GenDecl(&#34;</span><span class="op" id="5347327">+</span><span class="ident" id="5347328">keyword</span><span class="op" id="5347335">.</span><span class="ident" id="5347336">String</span><span class="op" id="5347342">(</span><span class="op" id="5347343">)</span><span class="op" id="5347344">+</span><span class="string" id="5347345">&#34;)&#34;</span><span class="op" id="5347348">)</span><span class="op" id="5347349">)</span><br>
<span class="lineno">2285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347352">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347356">doc</span>&nbsp;<span class="op" id="5347360">:=</span>&nbsp;<span class="ident" id="5347363">p</span><span class="op" id="5347364">.</span><span class="ident" id="5347365">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347378">pos</span>&nbsp;<span class="op" id="5347382">:=</span>&nbsp;<span class="ident" id="5347385">p</span><span class="op" id="5347386">.</span><span class="ident" id="5347387">expect</span><span class="op" id="5347393">(</span><span class="ident" id="5347394">keyword</span><span class="op" id="5347401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347404">var</span>&nbsp;<span class="ident" id="5347408">lparen</span><span class="op" id="5347414">,</span>&nbsp;<span class="ident" id="5347416">rparen</span>&nbsp;<span class="ident" id="5347423">token</span><span class="op" id="5347428">.</span><span class="ident" id="5347429">Pos</span><br>
<span class="lineno">2290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347434">var</span>&nbsp;<span class="ident" id="5347438">list</span>&nbsp;<span class="op" id="5347443">[</span><span class="op" id="5347444">]</span><span class="ident" id="5347445">ast</span><span class="op" id="5347448">.</span><span class="ident" id="5347449">Spec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347455">if</span>&nbsp;<span class="ident" id="5347458">p</span><span class="op" id="5347459">.</span><span class="ident" id="5347460">tok</span>&nbsp;<span class="op" id="5347464">==</span>&nbsp;<span class="ident" id="5347467">token</span><span class="op" id="5347472">.</span><span class="ident" id="5347473">LPAREN</span>&nbsp;<span class="op" id="5347480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347484">lparen</span>&nbsp;<span class="op" id="5347491">=</span>&nbsp;<span class="ident" id="5347493">p</span><span class="op" id="5347494">.</span><span class="ident" id="5347495">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347501">p</span><span class="op" id="5347502">.</span><span class="ident" id="5347503">next</span><span class="op" id="5347507">(</span><span class="op" id="5347508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347512">for</span>&nbsp;<span class="ident" id="5347516">iota</span>&nbsp;<span class="op" id="5347521">:=</span>&nbsp;<span class="num" id="5347524">0</span><span class="op" id="5347525">;</span>&nbsp;<span class="ident" id="5347527">p</span><span class="op" id="5347528">.</span><span class="ident" id="5347529">tok</span>&nbsp;<span class="op" id="5347533">!=</span>&nbsp;<span class="ident" id="5347536">token</span><span class="op" id="5347541">.</span><span class="ident" id="5347542">RPAREN</span>&nbsp;<span class="op" id="5347549">&amp;&amp;</span>&nbsp;<span class="ident" id="5347552">p</span><span class="op" id="5347553">.</span><span class="ident" id="5347554">tok</span>&nbsp;<span class="op" id="5347558">!=</span>&nbsp;<span class="ident" id="5347561">token</span><span class="op" id="5347566">.</span><span class="ident" id="5347567">EOF</span><span class="op" id="5347570">;</span>&nbsp;<span class="ident" id="5347572">iota</span><span class="op" id="5347576">++</span>&nbsp;<span class="op" id="5347579">{</span><br>
<span class="lineno">2295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347584">list</span>&nbsp;<span class="op" id="5347589">=</span>&nbsp;<span class="builtinfunc" id="5347591">append</span><span class="op" id="5347597">(</span><span class="ident" id="5347598">list</span><span class="op" id="5347602">,</span>&nbsp;<span class="ident" id="5347604">f</span><span class="op" id="5347605">(</span><span class="ident" id="5347606">p</span><span class="op" id="5347607">.</span><span class="ident" id="5347608">leadComment</span><span class="op" id="5347619">,</span>&nbsp;<span class="ident" id="5347621">keyword</span><span class="op" id="5347628">,</span>&nbsp;<span class="ident" id="5347630">iota</span><span class="op" id="5347634">)</span><span class="op" id="5347635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347643">rparen</span>&nbsp;<span class="op" id="5347650">=</span>&nbsp;<span class="ident" id="5347652">p</span><span class="op" id="5347653">.</span><span class="ident" id="5347654">expect</span><span class="op" id="5347660">(</span><span class="ident" id="5347661">token</span><span class="op" id="5347666">.</span><span class="ident" id="5347667">RPAREN</span><span class="op" id="5347673">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347677">p</span><span class="op" id="5347678">.</span><span class="ident" id="5347679">expectSemi</span><span class="op" id="5347689">(</span><span class="op" id="5347690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347693">}</span>&nbsp;<span class="keyword" id="5347695">else</span>&nbsp;<span class="op" id="5347700">{</span><br>
<span class="lineno">2300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347704">list</span>&nbsp;<span class="op" id="5347709">=</span>&nbsp;<span class="builtinfunc" id="5347711">append</span><span class="op" id="5347717">(</span><span class="ident" id="5347718">list</span><span class="op" id="5347722">,</span>&nbsp;<span class="ident" id="5347724">f</span><span class="op" id="5347725">(</span><span class="builtintype" id="5347726">nil</span><span class="op" id="5347729">,</span>&nbsp;<span class="ident" id="5347731">keyword</span><span class="op" id="5347738">,</span>&nbsp;<span class="num" id="5347740">0</span><span class="op" id="5347741">)</span><span class="op" id="5347742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347745">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347749">return</span>&nbsp;<span class="op" id="5347756">&amp;</span><span class="ident" id="5347757">ast</span><span class="op" id="5347760">.</span><span class="ident" id="5347761">GenDecl</span><span class="op" id="5347768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347772">Doc</span><span class="op" id="5347775">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347780">doc</span><span class="op" id="5347783">,</span><br>
<span class="lineno">2305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347787">TokPos</span><span class="op" id="5347793">:</span>&nbsp;<span class="ident" id="5347795">pos</span><span class="op" id="5347798">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347802">Tok</span><span class="op" id="5347805">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347810">keyword</span><span class="op" id="5347817">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347821">Lparen</span><span class="op" id="5347827">:</span>&nbsp;<span class="ident" id="5347829">lparen</span><span class="op" id="5347835">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347839">Specs</span><span class="op" id="5347844">:</span>&nbsp;&nbsp;<span class="ident" id="5347847">list</span><span class="op" id="5347851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347855">Rparen</span><span class="op" id="5347861">:</span>&nbsp;<span class="ident" id="5347863">rparen</span><span class="op" id="5347869">,</span><br>
<span class="lineno">2310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347872">}</span><br>
<span class="lineno"></span><span class="op" id="5347874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5347877">func</span>&nbsp;<span class="op" id="5347882">(</span><span class="ident" id="5347883">p</span>&nbsp;<span class="op" id="5347885">*</span><span class="ident" id="5347886">parser</span><span class="op" id="5347892">)</span>&nbsp;<span class="ident" id="5347894">parseFuncDecl</span><span class="op" id="5347907">(</span><span class="op" id="5347908">)</span>&nbsp;<span class="op" id="5347910">*</span><span class="ident" id="5347911">ast</span><span class="op" id="5347914">.</span><span class="ident" id="5347915">FuncDecl</span>&nbsp;<span class="op" id="5347924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347927">if</span>&nbsp;<span class="ident" id="5347930">p</span><span class="op" id="5347931">.</span><span class="ident" id="5347932">trace</span>&nbsp;<span class="op" id="5347938">{</span><br>
<span class="lineno">2315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5347942">defer</span>&nbsp;<span class="ident" id="5347948">un</span><span class="op" id="5347950">(</span><span class="ident" id="5347951">trace</span><span class="op" id="5347956">(</span><span class="ident" id="5347957">p</span><span class="op" id="5347958">,</span>&nbsp;<span class="string" id="5347960">&#34;FunctionDecl&#34;</span><span class="op" id="5347974">)</span><span class="op" id="5347975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5347978">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5347982">doc</span>&nbsp;<span class="op" id="5347986">:=</span>&nbsp;<span class="ident" id="5347989">p</span><span class="op" id="5347990">.</span><span class="ident" id="5347991">leadComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348004">pos</span>&nbsp;<span class="op" id="5348008">:=</span>&nbsp;<span class="ident" id="5348011">p</span><span class="op" id="5348012">.</span><span class="ident" id="5348013">expect</span><span class="op" id="5348019">(</span><span class="ident" id="5348020">token</span><span class="op" id="5348025">.</span><span class="ident" id="5348026">FUNC</span><span class="op" id="5348030">)</span><br>
<span class="lineno">2320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348033">scope</span>&nbsp;<span class="op" id="5348039">:=</span>&nbsp;<span class="ident" id="5348042">ast</span><span class="op" id="5348045">.</span><span class="ident" id="5348046">NewScope</span><span class="op" id="5348054">(</span><span class="ident" id="5348055">p</span><span class="op" id="5348056">.</span><span class="ident" id="5348057">topScope</span><span class="op" id="5348065">)</span>&nbsp;<span class="comment" id="5348067">//&nbsp;function&nbsp;scope</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348087">var</span>&nbsp;<span class="ident" id="5348091">recv</span>&nbsp;<span class="op" id="5348096">*</span><span class="ident" id="5348097">ast</span><span class="op" id="5348100">.</span><span class="ident" id="5348101">FieldList</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348112">if</span>&nbsp;<span class="ident" id="5348115">p</span><span class="op" id="5348116">.</span><span class="ident" id="5348117">tok</span>&nbsp;<span class="op" id="5348121">==</span>&nbsp;<span class="ident" id="5348124">token</span><span class="op" id="5348129">.</span><span class="ident" id="5348130">LPAREN</span>&nbsp;<span class="op" id="5348137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348141">recv</span>&nbsp;<span class="op" id="5348146">=</span>&nbsp;<span class="ident" id="5348148">p</span><span class="op" id="5348149">.</span><span class="ident" id="5348150">parseParameters</span><span class="op" id="5348165">(</span><span class="ident" id="5348166">scope</span><span class="op" id="5348171">,</span>&nbsp;<span class="builtintype" id="5348173">false</span><span class="op" id="5348178">)</span><br>
<span class="lineno">2325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348185">ident</span>&nbsp;<span class="op" id="5348191">:=</span>&nbsp;<span class="ident" id="5348194">p</span><span class="op" id="5348195">.</span><span class="ident" id="5348196">parseIdent</span><span class="op" id="5348206">(</span><span class="op" id="5348207">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348211">params</span><span class="op" id="5348217">,</span>&nbsp;<span class="ident" id="5348219">results</span>&nbsp;<span class="op" id="5348227">:=</span>&nbsp;<span class="ident" id="5348230">p</span><span class="op" id="5348231">.</span><span class="ident" id="5348232">parseSignature</span><span class="op" id="5348246">(</span><span class="ident" id="5348247">scope</span><span class="op" id="5348252">)</span><br>
<span class="lineno">2330</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348256">var</span>&nbsp;<span class="ident" id="5348260">body</span>&nbsp;<span class="op" id="5348265">*</span><span class="ident" id="5348266">ast</span><span class="op" id="5348269">.</span><span class="ident" id="5348270">BlockStmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348281">if</span>&nbsp;<span class="ident" id="5348284">p</span><span class="op" id="5348285">.</span><span class="ident" id="5348286">tok</span>&nbsp;<span class="op" id="5348290">==</span>&nbsp;<span class="ident" id="5348293">token</span><span class="op" id="5348298">.</span><span class="ident" id="5348299">LBRACE</span>&nbsp;<span class="op" id="5348306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348310">body</span>&nbsp;<span class="op" id="5348315">=</span>&nbsp;<span class="ident" id="5348317">p</span><span class="op" id="5348318">.</span><span class="ident" id="5348319">parseBody</span><span class="op" id="5348328">(</span><span class="ident" id="5348329">scope</span><span class="op" id="5348334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348337">}</span><br>
<span class="lineno">2335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348340">p</span><span class="op" id="5348341">.</span><span class="ident" id="5348342">expectSemi</span><span class="op" id="5348352">(</span><span class="op" id="5348353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348357">decl</span>&nbsp;<span class="op" id="5348362">:=</span>&nbsp;<span class="op" id="5348365">&amp;</span><span class="ident" id="5348366">ast</span><span class="op" id="5348369">.</span><span class="ident" id="5348370">FuncDecl</span><span class="op" id="5348378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348382">Doc</span><span class="op" id="5348385">:</span>&nbsp;&nbsp;<span class="ident" id="5348388">doc</span><span class="op" id="5348391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348395">Recv</span><span class="op" id="5348399">:</span>&nbsp;<span class="ident" id="5348401">recv</span><span class="op" id="5348405">,</span><br>
<span class="lineno">2340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348409">Name</span><span class="op" id="5348413">:</span>&nbsp;<span class="ident" id="5348415">ident</span><span class="op" id="5348420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348424">Type</span><span class="op" id="5348428">:</span>&nbsp;<span class="op" id="5348430">&amp;</span><span class="ident" id="5348431">ast</span><span class="op" id="5348434">.</span><span class="ident" id="5348435">FuncType</span><span class="op" id="5348443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348448">Func</span><span class="op" id="5348452">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348457">pos</span><span class="op" id="5348460">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348465">Params</span><span class="op" id="5348471">:</span>&nbsp;&nbsp;<span class="ident" id="5348474">params</span><span class="op" id="5348480">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348485">Results</span><span class="op" id="5348492">:</span>&nbsp;<span class="ident" id="5348494">results</span><span class="op" id="5348501">,</span><br>
<span class="lineno">2345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348505">}</span><span class="op" id="5348506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348510">Body</span><span class="op" id="5348514">:</span>&nbsp;<span class="ident" id="5348516">body</span><span class="op" id="5348520">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348526">if</span>&nbsp;<span class="ident" id="5348529">recv</span>&nbsp;<span class="op" id="5348534">==</span>&nbsp;<span class="builtintype" id="5348537">nil</span>&nbsp;<span class="op" id="5348541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348545">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;scope&nbsp;of&nbsp;an&nbsp;identifier&nbsp;denoting&nbsp;a&nbsp;constant,&nbsp;type,</span><br>
<span class="lineno">2350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348613">//&nbsp;variable,&nbsp;or&nbsp;function&nbsp;(but&nbsp;not&nbsp;method)&nbsp;declared&nbsp;at&nbsp;top&nbsp;level</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348679">//&nbsp;(outside&nbsp;any&nbsp;function)&nbsp;is&nbsp;the&nbsp;package&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348729">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348734">//&nbsp;init()&nbsp;functions&nbsp;cannot&nbsp;be&nbsp;referred&nbsp;to&nbsp;and&nbsp;there&nbsp;may</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5348792">//&nbsp;be&nbsp;more&nbsp;than&nbsp;one&nbsp;-&nbsp;don&#39;t&nbsp;put&nbsp;them&nbsp;in&nbsp;the&nbsp;pkgScope</span><br>
<span class="lineno">2355</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348847">if</span>&nbsp;<span class="ident" id="5348850">ident</span><span class="op" id="5348855">.</span><span class="ident" id="5348856">Name</span>&nbsp;<span class="op" id="5348861">!=</span>&nbsp;<span class="string" id="5348864">&#34;init&#34;</span>&nbsp;<span class="op" id="5348871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5348876">p</span><span class="op" id="5348877">.</span><span class="ident" id="5348878">declare</span><span class="op" id="5348885">(</span><span class="ident" id="5348886">decl</span><span class="op" id="5348890">,</span>&nbsp;<span class="builtintype" id="5348892">nil</span><span class="op" id="5348895">,</span>&nbsp;<span class="ident" id="5348897">p</span><span class="op" id="5348898">.</span><span class="ident" id="5348899">pkgScope</span><span class="op" id="5348907">,</span>&nbsp;<span class="ident" id="5348909">ast</span><span class="op" id="5348912">.</span><span class="ident" id="5348913">Fun</span><span class="op" id="5348916">,</span>&nbsp;<span class="ident" id="5348918">ident</span><span class="op" id="5348923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5348930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5348934">return</span>&nbsp;<span class="ident" id="5348941">decl</span><br>
<span class="lineno"></span><span class="op" id="5348946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5348949">func</span>&nbsp;<span class="op" id="5348954">(</span><span class="ident" id="5348955">p</span>&nbsp;<span class="op" id="5348957">*</span><span class="ident" id="5348958">parser</span><span class="op" id="5348964">)</span>&nbsp;<span class="ident" id="5348966">parseDecl</span><span class="op" id="5348975">(</span><span class="ident" id="5348976">sync</span>&nbsp;<span class="keyword" id="5348981">func</span><span class="op" id="5348985">(</span><span class="op" id="5348986">*</span><span class="ident" id="5348987">parser</span><span class="op" id="5348993">)</span><span class="op" id="5348994">)</span>&nbsp;<span class="ident" id="5348996">ast</span><span class="op" id="5348999">.</span><span class="ident" id="5349000">Decl</span>&nbsp;<span class="op" id="5349005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349008">if</span>&nbsp;<span class="ident" id="5349011">p</span><span class="op" id="5349012">.</span><span class="ident" id="5349013">trace</span>&nbsp;<span class="op" id="5349019">{</span><br>
<span class="lineno">2365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349023">defer</span>&nbsp;<span class="ident" id="5349029">un</span><span class="op" id="5349031">(</span><span class="ident" id="5349032">trace</span><span class="op" id="5349037">(</span><span class="ident" id="5349038">p</span><span class="op" id="5349039">,</span>&nbsp;<span class="string" id="5349041">&#34;Declaration&#34;</span><span class="op" id="5349054">)</span><span class="op" id="5349055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349058">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349062">var</span>&nbsp;<span class="ident" id="5349066">f</span>&nbsp;<span class="ident" id="5349068">parseSpecFunction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349087">switch</span>&nbsp;<span class="ident" id="5349094">p</span><span class="op" id="5349095">.</span><span class="ident" id="5349096">tok</span>&nbsp;<span class="op" id="5349100">{</span><br>
<span class="lineno">2370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349103">case</span>&nbsp;<span class="ident" id="5349108">token</span><span class="op" id="5349113">.</span><span class="ident" id="5349114">CONST</span><span class="op" id="5349119">,</span>&nbsp;<span class="ident" id="5349121">token</span><span class="op" id="5349126">.</span><span class="ident" id="5349127">VAR</span><span class="op" id="5349130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349134">f</span>&nbsp;<span class="op" id="5349136">=</span>&nbsp;<span class="ident" id="5349138">p</span><span class="op" id="5349139">.</span><span class="ident" id="5349140">parseValueSpec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349157">case</span>&nbsp;<span class="ident" id="5349162">token</span><span class="op" id="5349167">.</span><span class="ident" id="5349168">TYPE</span><span class="op" id="5349172">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349176">f</span>&nbsp;<span class="op" id="5349178">=</span>&nbsp;<span class="ident" id="5349180">p</span><span class="op" id="5349181">.</span><span class="ident" id="5349182">parseTypeSpec</span><br>
<span class="lineno">2375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349198">case</span>&nbsp;<span class="ident" id="5349203">token</span><span class="op" id="5349208">.</span><span class="ident" id="5349209">FUNC</span><span class="op" id="5349213">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349217">return</span>&nbsp;<span class="ident" id="5349224">p</span><span class="op" id="5349225">.</span><span class="ident" id="5349226">parseFuncDecl</span><span class="op" id="5349239">(</span><span class="op" id="5349240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349244">default</span><span class="op" id="5349251">:</span><br>
<span class="lineno">2380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349255">pos</span>&nbsp;<span class="op" id="5349259">:=</span>&nbsp;<span class="ident" id="5349262">p</span><span class="op" id="5349263">.</span><span class="ident" id="5349264">pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349270">p</span><span class="op" id="5349271">.</span><span class="ident" id="5349272">errorExpected</span><span class="op" id="5349285">(</span><span class="ident" id="5349286">pos</span><span class="op" id="5349289">,</span>&nbsp;<span class="string" id="5349291">&#34;declaration&#34;</span><span class="op" id="5349304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349308">sync</span><span class="op" id="5349312">(</span><span class="ident" id="5349313">p</span><span class="op" id="5349314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349318">return</span>&nbsp;<span class="op" id="5349325">&amp;</span><span class="ident" id="5349326">ast</span><span class="op" id="5349329">.</span><span class="ident" id="5349330">BadDecl</span><span class="op" id="5349337">{</span><span class="ident" id="5349338">From</span><span class="op" id="5349342">:</span>&nbsp;<span class="ident" id="5349344">pos</span><span class="op" id="5349347">,</span>&nbsp;<span class="ident" id="5349349">To</span><span class="op" id="5349351">:</span>&nbsp;<span class="ident" id="5349353">p</span><span class="op" id="5349354">.</span><span class="ident" id="5349355">pos</span><span class="op" id="5349358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349361">}</span><br>
<span class="lineno">2385</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349365">return</span>&nbsp;<span class="ident" id="5349372">p</span><span class="op" id="5349373">.</span><span class="ident" id="5349374">parseGenDecl</span><span class="op" id="5349386">(</span><span class="ident" id="5349387">p</span><span class="op" id="5349388">.</span><span class="ident" id="5349389">tok</span><span class="op" id="5349392">,</span>&nbsp;<span class="ident" id="5349394">f</span><span class="op" id="5349395">)</span><br>
<span class="lineno"></span><span class="op" id="5349397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5349400">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">2390</span><span class="comment" id="5349480">//&nbsp;Source&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5349497">func</span>&nbsp;<span class="op" id="5349502">(</span><span class="ident" id="5349503">p</span>&nbsp;<span class="op" id="5349505">*</span><span class="ident" id="5349506">parser</span><span class="op" id="5349512">)</span>&nbsp;<span class="ident" id="5349514">parseFile</span><span class="op" id="5349523">(</span><span class="op" id="5349524">)</span>&nbsp;<span class="op" id="5349526">*</span><span class="ident" id="5349527">ast</span><span class="op" id="5349530">.</span><span class="ident" id="5349531">File</span>&nbsp;<span class="op" id="5349536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349539">if</span>&nbsp;<span class="ident" id="5349542">p</span><span class="op" id="5349543">.</span><span class="ident" id="5349544">trace</span>&nbsp;<span class="op" id="5349550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349554">defer</span>&nbsp;<span class="ident" id="5349560">un</span><span class="op" id="5349562">(</span><span class="ident" id="5349563">trace</span><span class="op" id="5349568">(</span><span class="ident" id="5349569">p</span><span class="op" id="5349570">,</span>&nbsp;<span class="string" id="5349572">&#34;File&#34;</span><span class="op" id="5349578">)</span><span class="op" id="5349579">)</span><br>
<span class="lineno">2395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349586">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;scanning&nbsp;the&nbsp;first&nbsp;token.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349663">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349703">if</span>&nbsp;<span class="ident" id="5349706">p</span><span class="op" id="5349707">.</span><span class="ident" id="5349708">errors</span><span class="op" id="5349714">.</span><span class="ident" id="5349715">Len</span><span class="op" id="5349718">(</span><span class="op" id="5349719">)</span>&nbsp;<span class="op" id="5349721">!=</span>&nbsp;<span class="num" id="5349724">0</span>&nbsp;<span class="op" id="5349726">{</span><br>
<span class="lineno">2400</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349730">return</span>&nbsp;<span class="builtintype" id="5349737">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5349742">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349746">//&nbsp;package&nbsp;clause</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349765">doc</span>&nbsp;<span class="op" id="5349769">:=</span>&nbsp;<span class="ident" id="5349772">p</span><span class="op" id="5349773">.</span><span class="ident" id="5349774">leadComment</span><br>
<span class="lineno">2405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349787">pos</span>&nbsp;<span class="op" id="5349791">:=</span>&nbsp;<span class="ident" id="5349794">p</span><span class="op" id="5349795">.</span><span class="ident" id="5349796">expect</span><span class="op" id="5349802">(</span><span class="ident" id="5349803">token</span><span class="op" id="5349808">.</span><span class="ident" id="5349809">PACKAGE</span><span class="op" id="5349816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349819">//&nbsp;Go&nbsp;spec:&nbsp;The&nbsp;package&nbsp;clause&nbsp;is&nbsp;not&nbsp;a&nbsp;declaration;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5349873">//&nbsp;the&nbsp;package&nbsp;name&nbsp;does&nbsp;not&nbsp;appear&nbsp;in&nbsp;any&nbsp;scope.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5349924">ident</span>&nbsp;<span class="op" id="5349930">:=</span>&nbsp;<span class="ident" id="5349933">p</span><span class="op" id="5349934">.</span><span class="ident" id="5349935">parseIdent</span><span class="op" id="5349945">(</span><span class="op" id="5349946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5349949">if</span>&nbsp;<span class="ident" id="5349952">ident</span><span class="op" id="5349957">.</span><span class="ident" id="5349958">Name</span>&nbsp;<span class="op" id="5349963">==</span>&nbsp;<span class="string" id="5349966">&#34;_&#34;</span>&nbsp;<span class="op" id="5349970">&amp;&amp;</span>&nbsp;<span class="ident" id="5349973">p</span><span class="op" id="5349974">.</span><span class="ident" id="5349975">mode</span><span class="op" id="5349979">&amp;</span><span class="ident" id="5349980">DeclarationErrors</span>&nbsp;<span class="op" id="5349998">!=</span>&nbsp;<span class="num" id="5350001">0</span>&nbsp;<span class="op" id="5350003">{</span><br>
<span class="lineno">2410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350007">p</span><span class="op" id="5350008">.</span><span class="builtintype" id="5350009">error</span><span class="op" id="5350014">(</span><span class="ident" id="5350015">p</span><span class="op" id="5350016">.</span><span class="ident" id="5350017">pos</span><span class="op" id="5350020">,</span>&nbsp;<span class="string" id="5350022">&#34;invalid&nbsp;package&nbsp;name&nbsp;_&#34;</span><span class="op" id="5350046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350052">p</span><span class="op" id="5350053">.</span><span class="ident" id="5350054">expectSemi</span><span class="op" id="5350064">(</span><span class="op" id="5350065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350069">//&nbsp;Don&#39;t&nbsp;bother&nbsp;parsing&nbsp;the&nbsp;rest&nbsp;if&nbsp;we&nbsp;had&nbsp;errors&nbsp;parsing&nbsp;the&nbsp;package&nbsp;clause.</span><br>
<span class="lineno">2415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350148">//&nbsp;Likely&nbsp;not&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350188">if</span>&nbsp;<span class="ident" id="5350191">p</span><span class="op" id="5350192">.</span><span class="ident" id="5350193">errors</span><span class="op" id="5350199">.</span><span class="ident" id="5350200">Len</span><span class="op" id="5350203">(</span><span class="op" id="5350204">)</span>&nbsp;<span class="op" id="5350206">!=</span>&nbsp;<span class="num" id="5350209">0</span>&nbsp;<span class="op" id="5350211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350215">return</span>&nbsp;<span class="builtintype" id="5350222">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">2420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350231">p</span><span class="op" id="5350232">.</span><span class="ident" id="5350233">openScope</span><span class="op" id="5350242">(</span><span class="op" id="5350243">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350246">p</span><span class="op" id="5350247">.</span><span class="ident" id="5350248">pkgScope</span>&nbsp;<span class="op" id="5350257">=</span>&nbsp;<span class="ident" id="5350259">p</span><span class="op" id="5350260">.</span><span class="ident" id="5350261">topScope</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350271">var</span>&nbsp;<span class="ident" id="5350275">decls</span>&nbsp;<span class="op" id="5350281">[</span><span class="op" id="5350282">]</span><span class="ident" id="5350283">ast</span><span class="op" id="5350286">.</span><span class="ident" id="5350287">Decl</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350293">if</span>&nbsp;<span class="ident" id="5350296">p</span><span class="op" id="5350297">.</span><span class="ident" id="5350298">mode</span><span class="op" id="5350302">&amp;</span><span class="ident" id="5350303">PackageClauseOnly</span>&nbsp;<span class="op" id="5350321">==</span>&nbsp;<span class="num" id="5350324">0</span>&nbsp;<span class="op" id="5350326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350330">//&nbsp;import&nbsp;decls</span><br>
<span class="lineno">2425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350348">for</span>&nbsp;<span class="ident" id="5350352">p</span><span class="op" id="5350353">.</span><span class="ident" id="5350354">tok</span>&nbsp;<span class="op" id="5350358">==</span>&nbsp;<span class="ident" id="5350361">token</span><span class="op" id="5350366">.</span><span class="ident" id="5350367">IMPORT</span>&nbsp;<span class="op" id="5350374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350379">decls</span>&nbsp;<span class="op" id="5350385">=</span>&nbsp;<span class="builtinfunc" id="5350387">append</span><span class="op" id="5350393">(</span><span class="ident" id="5350394">decls</span><span class="op" id="5350399">,</span>&nbsp;<span class="ident" id="5350401">p</span><span class="op" id="5350402">.</span><span class="ident" id="5350403">parseGenDecl</span><span class="op" id="5350415">(</span><span class="ident" id="5350416">token</span><span class="op" id="5350421">.</span><span class="ident" id="5350422">IMPORT</span><span class="op" id="5350428">,</span>&nbsp;<span class="ident" id="5350430">p</span><span class="op" id="5350431">.</span><span class="ident" id="5350432">parseImportSpec</span><span class="op" id="5350447">)</span><span class="op" id="5350448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350457">if</span>&nbsp;<span class="ident" id="5350460">p</span><span class="op" id="5350461">.</span><span class="ident" id="5350462">mode</span><span class="op" id="5350466">&amp;</span><span class="ident" id="5350467">ImportsOnly</span>&nbsp;<span class="op" id="5350479">==</span>&nbsp;<span class="num" id="5350482">0</span>&nbsp;<span class="op" id="5350484">{</span><br>
<span class="lineno">2430</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350489">//&nbsp;rest&nbsp;of&nbsp;package&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350516">for</span>&nbsp;<span class="ident" id="5350520">p</span><span class="op" id="5350521">.</span><span class="ident" id="5350522">tok</span>&nbsp;<span class="op" id="5350526">!=</span>&nbsp;<span class="ident" id="5350529">token</span><span class="op" id="5350534">.</span><span class="ident" id="5350535">EOF</span>&nbsp;<span class="op" id="5350539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350545">decls</span>&nbsp;<span class="op" id="5350551">=</span>&nbsp;<span class="builtinfunc" id="5350553">append</span><span class="op" id="5350559">(</span><span class="ident" id="5350560">decls</span><span class="op" id="5350565">,</span>&nbsp;<span class="ident" id="5350567">p</span><span class="op" id="5350568">.</span><span class="ident" id="5350569">parseDecl</span><span class="op" id="5350578">(</span><span class="ident" id="5350579">syncDecl</span><span class="op" id="5350587">)</span><span class="op" id="5350588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350597">}</span><br>
<span class="lineno">2435</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5350600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350603">p</span><span class="op" id="5350604">.</span><span class="ident" id="5350605">closeScope</span><span class="op" id="5350615">(</span><span class="op" id="5350616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350619">assert</span><span class="op" id="5350625">(</span><span class="ident" id="5350626">p</span><span class="op" id="5350627">.</span><span class="ident" id="5350628">topScope</span>&nbsp;<span class="op" id="5350637">==</span>&nbsp;<span class="builtintype" id="5350640">nil</span><span class="op" id="5350643">,</span>&nbsp;<span class="string" id="5350645">&#34;unbalanced&nbsp;scopes&#34;</span><span class="op" id="5350664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350667">assert</span><span class="op" id="5350673">(</span><span class="ident" id="5350674">p</span><span class="op" id="5350675">.</span><span class="ident" id="5350676">labelScope</span>&nbsp;<span class="op" id="5350687">==</span>&nbsp;<span class="builtintype" id="5350690">nil</span><span class="op" id="5350693">,</span>&nbsp;<span class="string" id="5350695">&#34;unbalanced&nbsp;label&nbsp;scopes&#34;</span><span class="op" id="5350720">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">2440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350724">//&nbsp;resolve&nbsp;global&nbsp;identifiers&nbsp;within&nbsp;the&nbsp;same&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350776">i</span>&nbsp;<span class="op" id="5350778">:=</span>&nbsp;<span class="num" id="5350781">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350784">for</span>&nbsp;<span class="ident" id="5350788">_</span><span class="op" id="5350789">,</span>&nbsp;<span class="ident" id="5350791">ident</span>&nbsp;<span class="op" id="5350797">:=</span>&nbsp;<span class="keyword" id="5350800">range</span>&nbsp;<span class="ident" id="5350806">p</span><span class="op" id="5350807">.</span><span class="ident" id="5350808">unresolved</span>&nbsp;<span class="op" id="5350819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5350823">//&nbsp;i&nbsp;&lt;=&nbsp;index&nbsp;for&nbsp;current&nbsp;ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350857">assert</span><span class="op" id="5350863">(</span><span class="ident" id="5350864">ident</span><span class="op" id="5350869">.</span><span class="ident" id="5350870">Obj</span>&nbsp;<span class="op" id="5350874">==</span>&nbsp;<span class="ident" id="5350877">unresolved</span><span class="op" id="5350887">,</span>&nbsp;<span class="string" id="5350889">&#34;object&nbsp;already&nbsp;resolved&#34;</span><span class="op" id="5350914">)</span><br>
<span class="lineno">2445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5350918">ident</span><span class="op" id="5350923">.</span><span class="ident" id="5350924">Obj</span>&nbsp;<span class="op" id="5350928">=</span>&nbsp;<span class="ident" id="5350930">p</span><span class="op" id="5350931">.</span><span class="ident" id="5350932">pkgScope</span><span class="op" id="5350940">.</span><span class="ident" id="5350941">Lookup</span><span class="op" id="5350947">(</span><span class="ident" id="5350948">ident</span><span class="op" id="5350953">.</span><span class="ident" id="5350954">Name</span><span class="op" id="5350958">)</span>&nbsp;<span class="comment" id="5350960">//&nbsp;also&nbsp;removes&nbsp;unresolved&nbsp;sentinel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5350998">if</span>&nbsp;<span class="ident" id="5351001">ident</span><span class="op" id="5351006">.</span><span class="ident" id="5351007">Obj</span>&nbsp;<span class="op" id="5351011">==</span>&nbsp;<span class="builtintype" id="5351014">nil</span>&nbsp;<span class="op" id="5351018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351023">p</span><span class="op" id="5351024">.</span><span class="ident" id="5351025">unresolved</span><span class="op" id="5351035">[</span><span class="ident" id="5351036">i</span><span class="op" id="5351037">]</span>&nbsp;<span class="op" id="5351039">=</span>&nbsp;<span class="ident" id="5351041">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351050">i</span><span class="op" id="5351051">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351056">}</span><br>
<span class="lineno">2450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351059">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5351063">return</span>&nbsp;<span class="op" id="5351070">&amp;</span><span class="ident" id="5351071">ast</span><span class="op" id="5351074">.</span><span class="ident" id="5351075">File</span><span class="op" id="5351079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351083">Doc</span><span class="op" id="5351086">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351095">doc</span><span class="op" id="5351098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351102">Package</span><span class="op" id="5351109">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351114">pos</span><span class="op" id="5351117">,</span><br>
<span class="lineno">2455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351121">Name</span><span class="op" id="5351125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351133">ident</span><span class="op" id="5351138">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351142">Decls</span><span class="op" id="5351147">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351154">decls</span><span class="op" id="5351159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351163">Scope</span><span class="op" id="5351168">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351175">p</span><span class="op" id="5351176">.</span><span class="ident" id="5351177">pkgScope</span><span class="op" id="5351185">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351189">Imports</span><span class="op" id="5351196">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351201">p</span><span class="op" id="5351202">.</span><span class="ident" id="5351203">imports</span><span class="op" id="5351210">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351214">Unresolved</span><span class="op" id="5351224">:</span>&nbsp;<span class="ident" id="5351226">p</span><span class="op" id="5351227">.</span><span class="ident" id="5351228">unresolved</span><span class="op" id="5351238">[</span><span class="num" id="5351239">0</span><span class="op" id="5351240">:</span><span class="ident" id="5351241">i</span><span class="op" id="5351242">]</span><span class="op" id="5351243">,</span><br>
<span class="lineno">2460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5351247">Comments</span><span class="op" id="5351255">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5351259">p</span><span class="op" id="5351260">.</span><span class="ident" id="5351261">comments</span><span class="op" id="5351269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5351272">}</span><br>
<span class="lineno"></span><span class="op" id="5351274">}</span>
</div>
</body>
</html>
