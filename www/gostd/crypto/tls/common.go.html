<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3621417">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3621472">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3621526">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3621577">package</span>&nbsp;<span class="ident" id="3621585">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3621590">import</span>&nbsp;<span class="op" id="3621597">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621600">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621618">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621628">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621643">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621658">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621665">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621671">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621683">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621694">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621702">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3621709">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="3621712">const</span>&nbsp;<span class="op" id="3621718">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621721">VersionSSL30</span>&nbsp;<span class="op" id="3621734">=</span>&nbsp;<span class="num" id="3621736">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621744">VersionTLS10</span>&nbsp;<span class="op" id="3621757">=</span>&nbsp;<span class="num" id="3621759">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621767">VersionTLS11</span>&nbsp;<span class="op" id="3621780">=</span>&nbsp;<span class="num" id="3621782">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621790">VersionTLS12</span>&nbsp;<span class="op" id="3621803">=</span>&nbsp;<span class="num" id="3621805">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="3621812">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3621815">const</span>&nbsp;<span class="op" id="3621821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621824">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3621840">=</span>&nbsp;<span class="num" id="3621842">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3621855">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621892">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3621908">=</span>&nbsp;<span class="num" id="3621910">16384</span>&nbsp;<span class="op" id="3621916">+</span>&nbsp;<span class="num" id="3621918">2048</span>&nbsp;<span class="comment" id="3621923">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621961">recordHeaderLen</span>&nbsp;<span class="op" id="3621977">=</span>&nbsp;<span class="num" id="3621979">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3621992">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622017">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3622033">=</span>&nbsp;<span class="num" id="3622035">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3622048">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622106">minVersion</span>&nbsp;<span class="op" id="3622117">=</span>&nbsp;<span class="ident" id="3622119">VersionSSL30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622133">maxVersion</span>&nbsp;<span class="op" id="3622144">=</span>&nbsp;<span class="ident" id="3622146">VersionTLS12</span><br>
<span class="lineno">35</span><span class="op" id="3622159">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622162">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3622183">type</span>&nbsp;<span class="ident" id="3622188">recordType</span>&nbsp;<span class="builtintype" id="3622199">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="3622206">const</span>&nbsp;<span class="op" id="3622212">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622215">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="3622242">recordType</span>&nbsp;<span class="op" id="3622253">=</span>&nbsp;<span class="num" id="3622255">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622259">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3622286">recordType</span>&nbsp;<span class="op" id="3622297">=</span>&nbsp;<span class="num" id="3622299">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622303">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3622330">recordType</span>&nbsp;<span class="op" id="3622341">=</span>&nbsp;<span class="num" id="3622343">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622347">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="3622374">recordType</span>&nbsp;<span class="op" id="3622385">=</span>&nbsp;<span class="num" id="3622387">23</span><br>
<span class="lineno">45</span><span class="op" id="3622390">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622393">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3622425">const</span>&nbsp;<span class="op" id="3622431">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622434">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622457">uint8</span>&nbsp;<span class="op" id="3622463">=</span>&nbsp;<span class="num" id="3622465">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622468">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622491">uint8</span>&nbsp;<span class="op" id="3622497">=</span>&nbsp;<span class="num" id="3622499">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622502">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622525">uint8</span>&nbsp;<span class="op" id="3622531">=</span>&nbsp;<span class="num" id="3622533">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622536">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622559">uint8</span>&nbsp;<span class="op" id="3622565">=</span>&nbsp;<span class="num" id="3622567">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622571">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3622594">uint8</span>&nbsp;<span class="op" id="3622600">=</span>&nbsp;<span class="num" id="3622602">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622606">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="3622629">uint8</span>&nbsp;<span class="op" id="3622635">=</span>&nbsp;<span class="num" id="3622637">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622641">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622664">uint8</span>&nbsp;<span class="op" id="3622670">=</span>&nbsp;<span class="num" id="3622672">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622676">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="3622699">uint8</span>&nbsp;<span class="op" id="3622705">=</span>&nbsp;<span class="num" id="3622707">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622711">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="3622734">uint8</span>&nbsp;<span class="op" id="3622740">=</span>&nbsp;<span class="num" id="3622742">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622746">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622769">uint8</span>&nbsp;<span class="op" id="3622775">=</span>&nbsp;<span class="num" id="3622777">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622781">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="3622804">uint8</span>&nbsp;<span class="op" id="3622810">=</span>&nbsp;<span class="num" id="3622812">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622816">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3622839">uint8</span>&nbsp;<span class="op" id="3622845">=</span>&nbsp;<span class="num" id="3622847">67</span>&nbsp;<span class="comment" id="3622850">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="3622871">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622874">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="3622900">const</span>&nbsp;<span class="op" id="3622906">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622909">compressionNone</span>&nbsp;<span class="builtintype" id="3622925">uint8</span>&nbsp;<span class="op" id="3622931">=</span>&nbsp;<span class="num" id="3622933">0</span><br>
<span class="lineno"></span><span class="op" id="3622935">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3622938">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="3622963">const</span>&nbsp;<span class="op" id="3622969">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622972">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623001">uint16</span>&nbsp;<span class="op" id="3623008">=</span>&nbsp;<span class="num" id="3623010">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623013">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623042">uint16</span>&nbsp;<span class="op" id="3623049">=</span>&nbsp;<span class="num" id="3623051">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623054">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623083">uint16</span>&nbsp;<span class="op" id="3623090">=</span>&nbsp;<span class="num" id="3623092">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623096">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623125">uint16</span>&nbsp;<span class="op" id="3623132">=</span>&nbsp;<span class="num" id="3623134">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623138">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="3623167">uint16</span>&nbsp;<span class="op" id="3623174">=</span>&nbsp;<span class="num" id="3623176">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623180">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623209">uint16</span>&nbsp;<span class="op" id="3623216">=</span>&nbsp;<span class="num" id="3623218">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623222">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623251">uint16</span>&nbsp;<span class="op" id="3623258">=</span>&nbsp;<span class="num" id="3623260">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623264">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623293">uint16</span>&nbsp;<span class="op" id="3623300">=</span>&nbsp;<span class="num" id="3623302">13172</span>&nbsp;<span class="comment" id="3623308">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623330">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3623359">uint16</span>&nbsp;<span class="op" id="3623366">=</span>&nbsp;<span class="num" id="3623368">0xff01</span><br>
<span class="lineno"></span><span class="op" id="3623375">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="3623378">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="3623415">const</span>&nbsp;<span class="op" id="3623421">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623424">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="3623442">uint16</span>&nbsp;<span class="op" id="3623449">=</span>&nbsp;<span class="num" id="3623451">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="3623458">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="3623461">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="3623531">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="3623617">type</span>&nbsp;<span class="ident" id="3623622">CurveID</span>&nbsp;<span class="builtintype" id="3623630">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="3623638">const</span>&nbsp;<span class="op" id="3623644">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623647">CurveP256</span>&nbsp;<span class="ident" id="3623657">CurveID</span>&nbsp;<span class="op" id="3623665">=</span>&nbsp;<span class="num" id="3623667">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623671">CurveP384</span>&nbsp;<span class="ident" id="3623681">CurveID</span>&nbsp;<span class="op" id="3623689">=</span>&nbsp;<span class="num" id="3623691">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623695">CurveP521</span>&nbsp;<span class="ident" id="3623705">CurveID</span>&nbsp;<span class="op" id="3623713">=</span>&nbsp;<span class="num" id="3623715">25</span><br>
<span class="lineno"></span><span class="op" id="3623718">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="3623721">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="3623757">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="3623843">const</span>&nbsp;<span class="op" id="3623849">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623852">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="3623876">uint8</span>&nbsp;<span class="op" id="3623882">=</span>&nbsp;<span class="num" id="3623884">0</span><br>
<span class="lineno">100</span><span class="op" id="3623886">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3623889">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="3623929">const</span>&nbsp;<span class="op" id="3623935">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623938">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="3623953">uint8</span>&nbsp;<span class="op" id="3623959">=</span>&nbsp;<span class="num" id="3623961">1</span><br>
<span class="lineno">105</span><span class="op" id="3623963">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3623966">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="3624015">const</span>&nbsp;<span class="op" id="3624021">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624024">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3624043">=</span>&nbsp;<span class="num" id="3624045">1</span>&nbsp;<span class="comment" id="3624047">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624087">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3624106">=</span>&nbsp;<span class="num" id="3624108">2</span>&nbsp;<span class="comment" id="3624110">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624149">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="3624168">=</span>&nbsp;<span class="num" id="3624170">3</span>&nbsp;<span class="comment" id="3624172">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624217">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="3624236">=</span>&nbsp;<span class="num" id="3624238">4</span>&nbsp;<span class="comment" id="3624240">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624286">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624322">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3624345">=</span>&nbsp;<span class="num" id="3624347">64</span>&nbsp;<span class="comment" id="3624350">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624427">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3624450">=</span>&nbsp;<span class="num" id="3624452">65</span>&nbsp;<span class="comment" id="3624455">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624529">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="3624552">=</span>&nbsp;<span class="num" id="3624554">66</span>&nbsp;<span class="comment" id="3624557">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3624634">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="3624680">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3624683">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3624743">const</span>&nbsp;<span class="op" id="3624749">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624752">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3624763">uint8</span>&nbsp;<span class="op" id="3624769">=</span>&nbsp;<span class="num" id="3624771">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624774">hashSHA256</span>&nbsp;<span class="builtintype" id="3624785">uint8</span>&nbsp;<span class="op" id="3624791">=</span>&nbsp;<span class="num" id="3624793">4</span><br>
<span class="lineno"></span><span class="op" id="3624795">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3624798">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="3624864">const</span>&nbsp;<span class="op" id="3624870">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624873">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3624888">uint8</span>&nbsp;<span class="op" id="3624894">=</span>&nbsp;<span class="num" id="3624896">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624899">signatureECDSA</span>&nbsp;<span class="builtintype" id="3624914">uint8</span>&nbsp;<span class="op" id="3624920">=</span>&nbsp;<span class="num" id="3624922">3</span><br>
<span class="lineno"></span><span class="op" id="3624924">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3624927">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="3625006">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="3625034">type</span>&nbsp;<span class="ident" id="3625039">signatureAndHash</span>&nbsp;<span class="keyword" id="3625056">struct</span>&nbsp;<span class="op" id="3625063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625066">hash</span><span class="op" id="3625070">,</span>&nbsp;<span class="ident" id="3625072">signature</span>&nbsp;<span class="builtintype" id="3625082">uint8</span><br>
<span class="lineno"></span><span class="op" id="3625088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="3625091">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="3625169">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="3625236">var</span>&nbsp;<span class="ident" id="3625240">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="3625272">=</span>&nbsp;<span class="op" id="3625274">[</span><span class="op" id="3625275">]</span><span class="ident" id="3625276">signatureAndHash</span><span class="op" id="3625292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625295">{</span><span class="ident" id="3625296">hashSHA256</span><span class="op" id="3625306">,</span>&nbsp;<span class="ident" id="3625308">signatureRSA</span><span class="op" id="3625320">}</span><span class="op" id="3625321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625324">{</span><span class="ident" id="3625325">hashSHA256</span><span class="op" id="3625335">,</span>&nbsp;<span class="ident" id="3625337">signatureECDSA</span><span class="op" id="3625351">}</span><span class="op" id="3625352">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625355">{</span><span class="ident" id="3625356">hashSHA1</span><span class="op" id="3625364">,</span>&nbsp;<span class="ident" id="3625366">signatureRSA</span><span class="op" id="3625378">}</span><span class="op" id="3625379">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625382">{</span><span class="ident" id="3625383">hashSHA1</span><span class="op" id="3625391">,</span>&nbsp;<span class="ident" id="3625393">signatureECDSA</span><span class="op" id="3625407">}</span><span class="op" id="3625408">,</span><br>
<span class="lineno"></span><span class="op" id="3625410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3625413">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="3625487">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="3625552">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="3625575">var</span>&nbsp;<span class="ident" id="3625579">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="3625618">=</span>&nbsp;<span class="op" id="3625620">[</span><span class="op" id="3625621">]</span><span class="ident" id="3625622">signatureAndHash</span><span class="op" id="3625638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625641">{</span><span class="ident" id="3625642">hashSHA256</span><span class="op" id="3625652">,</span>&nbsp;<span class="ident" id="3625654">signatureRSA</span><span class="op" id="3625666">}</span><span class="op" id="3625667">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625670">{</span><span class="ident" id="3625671">hashSHA256</span><span class="op" id="3625681">,</span>&nbsp;<span class="ident" id="3625683">signatureECDSA</span><span class="op" id="3625697">}</span><span class="op" id="3625698">,</span><br>
<span class="lineno">155</span><span class="op" id="3625700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3625703">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3625770">type</span>&nbsp;<span class="ident" id="3625775">ConnectionState</span>&nbsp;<span class="keyword" id="3625791">struct</span>&nbsp;<span class="op" id="3625798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625801">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3625828">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3625850">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625909">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3625936">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3625958">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625988">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3626015">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3626037">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626086">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3626113">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3626135">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626191">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3626218">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3626240">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626294">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="3626321">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3626343">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626392">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3626419">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3626441">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626504">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3626531">[</span><span class="op" id="3626532">]</span><span class="op" id="3626533">*</span><span class="ident" id="3626534">x509</span><span class="op" id="3626538">.</span><span class="ident" id="3626539">Certificate</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3626553">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3626600">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3626627">[</span><span class="op" id="3626628">]</span><span class="op" id="3626629">[</span><span class="op" id="3626630">]</span><span class="op" id="3626631">*</span><span class="ident" id="3626632">x509</span><span class="op" id="3626636">.</span><span class="ident" id="3626637">Certificate</span>&nbsp;<span class="comment" id="3626649">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626698">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626769">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626835">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626895">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3626968">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3627034">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627068">TLSUnique</span>&nbsp;<span class="op" id="3627078">[</span><span class="op" id="3627079">]</span><span class="builtintype" id="3627080">byte</span><br>
<span class="lineno"></span><span class="op" id="3627085">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3627088">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="3627153">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="3627183">type</span>&nbsp;<span class="ident" id="3627188">ClientAuthType</span>&nbsp;<span class="builtintype" id="3627203">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3627208">const</span>&nbsp;<span class="op" id="3627214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627217">NoClientCert</span>&nbsp;<span class="ident" id="3627230">ClientAuthType</span>&nbsp;<span class="op" id="3627245">=</span>&nbsp;<span class="ident" id="3627247">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627253">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627272">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627294">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627319">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="3627346">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="3627349">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="3627422">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="3627435">type</span>&nbsp;<span class="ident" id="3627440">ClientSessionState</span>&nbsp;<span class="keyword" id="3627459">struct</span>&nbsp;<span class="op" id="3627466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627469">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3627488">[</span><span class="op" id="3627489">]</span><span class="builtintype" id="3627490">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3627508">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627569">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3627588">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3627608">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627655">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3627674">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3627694">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627737">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3627756">[</span><span class="op" id="3627757">]</span><span class="builtintype" id="3627758">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3627776">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3627833">serverCertificates</span>&nbsp;<span class="op" id="3627852">[</span><span class="op" id="3627853">]</span><span class="op" id="3627854">*</span><span class="ident" id="3627855">x509</span><span class="op" id="3627859">.</span><span class="ident" id="3627860">Certificate</span>&nbsp;<span class="comment" id="3627872">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="3627917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="3627920">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3628000">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="3628079">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="3628153">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="3628168">type</span>&nbsp;<span class="ident" id="3628173">ClientSessionCache</span>&nbsp;<span class="keyword" id="3628192">interface</span>&nbsp;<span class="op" id="3628202">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628205">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628278">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628322">Get</span><span class="op" id="3628325">(</span><span class="ident" id="3628326">sessionKey</span>&nbsp;<span class="builtintype" id="3628337">string</span><span class="op" id="3628343">)</span>&nbsp;<span class="op" id="3628345">(</span><span class="ident" id="3628346">session</span>&nbsp;<span class="op" id="3628354">*</span><span class="ident" id="3628355">ClientSessionState</span><span class="op" id="3628373">,</span>&nbsp;<span class="ident" id="3628375">ok</span>&nbsp;<span class="builtintype" id="3628378">bool</span><span class="op" id="3628382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628386">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628455">Put</span><span class="op" id="3628458">(</span><span class="ident" id="3628459">sessionKey</span>&nbsp;<span class="builtintype" id="3628470">string</span><span class="op" id="3628476">,</span>&nbsp;<span class="ident" id="3628478">cs</span>&nbsp;<span class="op" id="3628481">*</span><span class="ident" id="3628482">ClientSessionState</span><span class="op" id="3628500">)</span><br>
<span class="lineno"></span><span class="op" id="3628502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3628505">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3628584">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="3628647">type</span>&nbsp;<span class="ident" id="3628652">ClientHelloInfo</span>&nbsp;<span class="keyword" id="3628668">struct</span>&nbsp;<span class="op" id="3628675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628678">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628748">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3628779">CipherSuites</span>&nbsp;<span class="op" id="3628792">[</span><span class="op" id="3628793">]</span><span class="builtintype" id="3628794">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628803">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628875">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628946">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3628975">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629028">ServerName</span>&nbsp;<span class="builtintype" id="3629039">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629048">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629119">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629184">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629217">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629272">SupportedCurves</span>&nbsp;<span class="op" id="3629288">[</span><span class="op" id="3629289">]</span><span class="ident" id="3629290">CurveID</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629300">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629369">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629442">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629465">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629520">SupportedPoints</span>&nbsp;<span class="op" id="3629536">[</span><span class="op" id="3629537">]</span><span class="builtintype" id="3629538">uint8</span><br>
<span class="lineno"></span><span class="op" id="3629544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3629547">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="3629614">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="3629676">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="3629743">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="3629757">type</span>&nbsp;<span class="ident" id="3629762">Config</span>&nbsp;<span class="keyword" id="3629769">struct</span>&nbsp;<span class="op" id="3629776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629779">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629848">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629920">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3629937">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3629997">Rand</span>&nbsp;<span class="ident" id="3630002">io</span><span class="op" id="3630004">.</span><span class="ident" id="3630005">Reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630014">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630090">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630129">Time</span>&nbsp;<span class="keyword" id="3630134">func</span><span class="op" id="3630138">(</span><span class="op" id="3630139">)</span>&nbsp;<span class="ident" id="3630141">time</span><span class="op" id="3630145">.</span><span class="ident" id="3630146">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630153">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630210">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630262">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630327">Certificates</span>&nbsp;<span class="op" id="3630340">[</span><span class="op" id="3630341">]</span><span class="ident" id="3630342">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630356">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630424">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630490">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630559">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630597">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630667">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3630692">NameToCertificate</span>&nbsp;<span class="keyword" id="3630710">map</span><span class="op" id="3630713">[</span><span class="builtintype" id="3630714">string</span><span class="op" id="3630720">]</span><span class="op" id="3630721">*</span><span class="ident" id="3630722">Certificate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630736">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630796">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630867">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630923">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3630995">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631005">GetCertificate</span>&nbsp;<span class="keyword" id="3631020">func</span><span class="op" id="3631024">(</span><span class="ident" id="3631025">clientHello</span>&nbsp;<span class="op" id="3631037">*</span><span class="ident" id="3631038">ClientHelloInfo</span><span class="op" id="3631053">)</span>&nbsp;<span class="op" id="3631055">(</span><span class="op" id="3631056">*</span><span class="ident" id="3631057">Certificate</span><span class="op" id="3631068">,</span>&nbsp;<span class="builtintype" id="3631070">error</span><span class="op" id="3631075">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631079">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631139">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631196">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631252">RootCAs</span>&nbsp;<span class="op" id="3631260">*</span><span class="ident" id="3631261">x509</span><span class="op" id="3631265">.</span><span class="ident" id="3631266">CertPool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631277">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631345">NextProtos</span>&nbsp;<span class="op" id="3631356">[</span><span class="op" id="3631357">]</span><span class="builtintype" id="3631358">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631367">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631429">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631502">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631560">ServerName</span>&nbsp;<span class="builtintype" id="3631571">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631580">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631630">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631690">ClientAuth</span>&nbsp;<span class="ident" id="3631701">ClientAuthType</span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631718">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631780">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631844">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3631877">ClientCAs</span>&nbsp;<span class="op" id="3631887">*</span><span class="ident" id="3631888">x509</span><span class="op" id="3631892">.</span><span class="ident" id="3631893">CertPool</span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631904">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3631966">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632012">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632075">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632142">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632209">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632251">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="3632270">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632277">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632348">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632419">CipherSuites</span>&nbsp;<span class="op" id="3632432">[</span><span class="op" id="3632433">]</span><span class="builtintype" id="3632434">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632443">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632512">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632584">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632655">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632707">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="3632732">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632739">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632811">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3632837">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="3632860">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632867">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632930">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3632992">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633043">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633047">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633117">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633176">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633239">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633287">SessionTicketKey</span>&nbsp;<span class="op" id="3633304">[</span><span class="num" id="3633305">32</span><span class="op" id="3633307">]</span><span class="builtintype" id="3633308">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633315">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633389">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633405">ClientSessionCache</span>&nbsp;<span class="ident" id="3633424">ClientSessionCache</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633445">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633517">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633566">MinVersion</span>&nbsp;<span class="builtintype" id="3633577">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633586">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633658">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633731">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633763">MaxVersion</span>&nbsp;<span class="builtintype" id="3633774">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633783">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633854">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3633926">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633939">CurvePreferences</span>&nbsp;<span class="op" id="3633956">[</span><span class="op" id="3633957">]</span><span class="ident" id="3633958">CurveID</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3633968">serverInitOnce</span>&nbsp;<span class="ident" id="3633983">sync</span><span class="op" id="3633987">.</span><span class="ident" id="3633988">Once</span>&nbsp;<span class="comment" id="3633993">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="3634032">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634035">func</span>&nbsp;<span class="op" id="3634040">(</span><span class="ident" id="3634041">c</span>&nbsp;<span class="op" id="3634043">*</span><span class="ident" id="3634044">Config</span><span class="op" id="3634050">)</span>&nbsp;<span class="ident" id="3634052">serverInit</span><span class="op" id="3634062">(</span><span class="op" id="3634063">)</span>&nbsp;<span class="op" id="3634065">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634068">if</span>&nbsp;<span class="ident" id="3634071">c</span><span class="op" id="3634072">.</span><span class="ident" id="3634073">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3634096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634100">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3634112">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634176">for</span>&nbsp;<span class="ident" id="3634180">_</span><span class="op" id="3634181">,</span>&nbsp;<span class="ident" id="3634183">b</span>&nbsp;<span class="op" id="3634185">:=</span>&nbsp;<span class="keyword" id="3634188">range</span>&nbsp;<span class="ident" id="3634194">c</span><span class="op" id="3634195">.</span><span class="ident" id="3634196">SessionTicketKey</span>&nbsp;<span class="op" id="3634213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634217">if</span>&nbsp;<span class="ident" id="3634220">b</span>&nbsp;<span class="op" id="3634222">!=</span>&nbsp;<span class="num" id="3634225">0</span>&nbsp;<span class="op" id="3634227">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634244">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634248">if</span>&nbsp;<span class="ident" id="3634251">_</span><span class="op" id="3634252">,</span>&nbsp;<span class="ident" id="3634254">err</span>&nbsp;<span class="op" id="3634258">:=</span>&nbsp;<span class="ident" id="3634261">io</span><span class="op" id="3634263">.</span><span class="ident" id="3634264">ReadFull</span><span class="op" id="3634272">(</span><span class="ident" id="3634273">c</span><span class="op" id="3634274">.</span><span class="ident" id="3634275">rand</span><span class="op" id="3634279">(</span><span class="op" id="3634280">)</span><span class="op" id="3634281">,</span>&nbsp;<span class="ident" id="3634283">c</span><span class="op" id="3634284">.</span><span class="ident" id="3634285">SessionTicketKey</span><span class="op" id="3634301">[</span><span class="op" id="3634302">:</span><span class="op" id="3634303">]</span><span class="op" id="3634304">)</span><span class="op" id="3634305">;</span>&nbsp;<span class="ident" id="3634307">err</span>&nbsp;<span class="op" id="3634311">!=</span>&nbsp;<span class="ident" id="3634314">nil</span>&nbsp;<span class="op" id="3634318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634322">c</span><span class="op" id="3634323">.</span><span class="ident" id="3634324">SessionTicketsDisabled</span>&nbsp;<span class="op" id="3634347">=</span>&nbsp;<span class="builtintype" id="3634349">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634355">}</span><br>
<span class="lineno"></span><span class="op" id="3634357">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="3634360">func</span>&nbsp;<span class="op" id="3634365">(</span><span class="ident" id="3634366">c</span>&nbsp;<span class="op" id="3634368">*</span><span class="ident" id="3634369">Config</span><span class="op" id="3634375">)</span>&nbsp;<span class="ident" id="3634377">rand</span><span class="op" id="3634381">(</span><span class="op" id="3634382">)</span>&nbsp;<span class="ident" id="3634384">io</span><span class="op" id="3634386">.</span><span class="ident" id="3634387">Reader</span>&nbsp;<span class="op" id="3634394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634397">r</span>&nbsp;<span class="op" id="3634399">:=</span>&nbsp;<span class="ident" id="3634402">c</span><span class="op" id="3634403">.</span><span class="ident" id="3634404">Rand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634410">if</span>&nbsp;<span class="ident" id="3634413">r</span>&nbsp;<span class="op" id="3634415">==</span>&nbsp;<span class="ident" id="3634418">nil</span>&nbsp;<span class="op" id="3634422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634426">return</span>&nbsp;<span class="ident" id="3634433">rand</span><span class="op" id="3634437">.</span><span class="ident" id="3634438">Reader</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634446">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634449">return</span>&nbsp;<span class="ident" id="3634456">r</span><br>
<span class="lineno"></span><span class="op" id="3634458">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634461">func</span>&nbsp;<span class="op" id="3634466">(</span><span class="ident" id="3634467">c</span>&nbsp;<span class="op" id="3634469">*</span><span class="ident" id="3634470">Config</span><span class="op" id="3634476">)</span>&nbsp;<span class="ident" id="3634478">time</span><span class="op" id="3634482">(</span><span class="op" id="3634483">)</span>&nbsp;<span class="ident" id="3634485">time</span><span class="op" id="3634489">.</span><span class="ident" id="3634490">Time</span>&nbsp;<span class="op" id="3634495">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634498">t</span>&nbsp;<span class="op" id="3634500">:=</span>&nbsp;<span class="ident" id="3634503">c</span><span class="op" id="3634504">.</span><span class="ident" id="3634505">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634511">if</span>&nbsp;<span class="ident" id="3634514">t</span>&nbsp;<span class="op" id="3634516">==</span>&nbsp;<span class="ident" id="3634519">nil</span>&nbsp;<span class="op" id="3634523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634527">t</span>&nbsp;<span class="op" id="3634529">=</span>&nbsp;<span class="ident" id="3634531">time</span><span class="op" id="3634535">.</span><span class="ident" id="3634536">Now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634544">return</span>&nbsp;<span class="ident" id="3634551">t</span><span class="op" id="3634552">(</span><span class="op" id="3634553">)</span><br>
<span class="lineno">380</span><span class="op" id="3634555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634558">func</span>&nbsp;<span class="op" id="3634563">(</span><span class="ident" id="3634564">c</span>&nbsp;<span class="op" id="3634566">*</span><span class="ident" id="3634567">Config</span><span class="op" id="3634573">)</span>&nbsp;<span class="ident" id="3634575">cipherSuites</span><span class="op" id="3634587">(</span><span class="op" id="3634588">)</span>&nbsp;<span class="op" id="3634590">[</span><span class="op" id="3634591">]</span><span class="builtintype" id="3634592">uint16</span>&nbsp;<span class="op" id="3634599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634602">s</span>&nbsp;<span class="op" id="3634604">:=</span>&nbsp;<span class="ident" id="3634607">c</span><span class="op" id="3634608">.</span><span class="ident" id="3634609">CipherSuites</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634623">if</span>&nbsp;<span class="ident" id="3634626">s</span>&nbsp;<span class="op" id="3634628">==</span>&nbsp;<span class="ident" id="3634631">nil</span>&nbsp;<span class="op" id="3634635">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3634639">s</span>&nbsp;<span class="op" id="3634641">=</span>&nbsp;<span class="ident" id="3634643">defaultCipherSuites</span><span class="op" id="3634662">(</span><span class="op" id="3634663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634669">return</span>&nbsp;<span class="ident" id="3634676">s</span><br>
<span class="lineno"></span><span class="op" id="3634678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="3634681">func</span>&nbsp;<span class="op" id="3634686">(</span><span class="ident" id="3634687">c</span>&nbsp;<span class="op" id="3634689">*</span><span class="ident" id="3634690">Config</span><span class="op" id="3634696">)</span>&nbsp;<span class="ident" id="3634698">minVersion</span><span class="op" id="3634708">(</span><span class="op" id="3634709">)</span>&nbsp;<span class="builtintype" id="3634711">uint16</span>&nbsp;<span class="op" id="3634718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634721">if</span>&nbsp;<span class="ident" id="3634724">c</span>&nbsp;<span class="op" id="3634726">==</span>&nbsp;<span class="ident" id="3634729">nil</span>&nbsp;<span class="op" id="3634733">||</span>&nbsp;<span class="ident" id="3634736">c</span><span class="op" id="3634737">.</span><span class="ident" id="3634738">MinVersion</span>&nbsp;<span class="op" id="3634749">==</span>&nbsp;<span class="num" id="3634752">0</span>&nbsp;<span class="op" id="3634754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634758">return</span>&nbsp;<span class="ident" id="3634765">minVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634780">return</span>&nbsp;<span class="ident" id="3634787">c</span><span class="op" id="3634788">.</span><span class="ident" id="3634789">MinVersion</span><br>
<span class="lineno">395</span><span class="op" id="3634800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634803">func</span>&nbsp;<span class="op" id="3634808">(</span><span class="ident" id="3634809">c</span>&nbsp;<span class="op" id="3634811">*</span><span class="ident" id="3634812">Config</span><span class="op" id="3634818">)</span>&nbsp;<span class="ident" id="3634820">maxVersion</span><span class="op" id="3634830">(</span><span class="op" id="3634831">)</span>&nbsp;<span class="builtintype" id="3634833">uint16</span>&nbsp;<span class="op" id="3634840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634843">if</span>&nbsp;<span class="ident" id="3634846">c</span>&nbsp;<span class="op" id="3634848">==</span>&nbsp;<span class="ident" id="3634851">nil</span>&nbsp;<span class="op" id="3634855">||</span>&nbsp;<span class="ident" id="3634858">c</span><span class="op" id="3634859">.</span><span class="ident" id="3634860">MaxVersion</span>&nbsp;<span class="op" id="3634871">==</span>&nbsp;<span class="num" id="3634874">0</span>&nbsp;<span class="op" id="3634876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634880">return</span>&nbsp;<span class="ident" id="3634887">maxVersion</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3634899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3634902">return</span>&nbsp;<span class="ident" id="3634909">c</span><span class="op" id="3634910">.</span><span class="ident" id="3634911">MaxVersion</span><br>
<span class="lineno"></span><span class="op" id="3634922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3634925">var</span>&nbsp;<span class="ident" id="3634929">defaultCurvePreferences</span>&nbsp;<span class="op" id="3634953">=</span>&nbsp;<span class="op" id="3634955">[</span><span class="op" id="3634956">]</span><span class="ident" id="3634957">CurveID</span><span class="op" id="3634964">{</span><span class="ident" id="3634965">CurveP256</span><span class="op" id="3634974">,</span>&nbsp;<span class="ident" id="3634976">CurveP384</span><span class="op" id="3634985">,</span>&nbsp;<span class="ident" id="3634987">CurveP521</span><span class="op" id="3634996">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="3634999">func</span>&nbsp;<span class="op" id="3635004">(</span><span class="ident" id="3635005">c</span>&nbsp;<span class="op" id="3635007">*</span><span class="ident" id="3635008">Config</span><span class="op" id="3635014">)</span>&nbsp;<span class="ident" id="3635016">curvePreferences</span><span class="op" id="3635032">(</span><span class="op" id="3635033">)</span>&nbsp;<span class="op" id="3635035">[</span><span class="op" id="3635036">]</span><span class="ident" id="3635037">CurveID</span>&nbsp;<span class="op" id="3635045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635048">if</span>&nbsp;<span class="ident" id="3635051">c</span>&nbsp;<span class="op" id="3635053">==</span>&nbsp;<span class="ident" id="3635056">nil</span>&nbsp;<span class="op" id="3635060">||</span>&nbsp;<span class="builtinfunc" id="3635063">len</span><span class="op" id="3635066">(</span><span class="ident" id="3635067">c</span><span class="op" id="3635068">.</span><span class="ident" id="3635069">CurvePreferences</span><span class="op" id="3635085">)</span>&nbsp;<span class="op" id="3635087">==</span>&nbsp;<span class="num" id="3635090">0</span>&nbsp;<span class="op" id="3635092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635096">return</span>&nbsp;<span class="ident" id="3635103">defaultCurvePreferences</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635128">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635131">return</span>&nbsp;<span class="ident" id="3635138">c</span><span class="op" id="3635139">.</span><span class="ident" id="3635140">CurvePreferences</span><br>
<span class="lineno"></span><span class="op" id="3635157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635160">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="3635234">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="3635258">func</span>&nbsp;<span class="op" id="3635263">(</span><span class="ident" id="3635264">c</span>&nbsp;<span class="op" id="3635266">*</span><span class="ident" id="3635267">Config</span><span class="op" id="3635273">)</span>&nbsp;<span class="ident" id="3635275">mutualVersion</span><span class="op" id="3635288">(</span><span class="ident" id="3635289">vers</span>&nbsp;<span class="builtintype" id="3635294">uint16</span><span class="op" id="3635300">)</span>&nbsp;<span class="op" id="3635302">(</span><span class="builtintype" id="3635303">uint16</span><span class="op" id="3635309">,</span>&nbsp;<span class="builtintype" id="3635311">bool</span><span class="op" id="3635315">)</span>&nbsp;<span class="op" id="3635317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635320">minVersion</span>&nbsp;<span class="op" id="3635331">:=</span>&nbsp;<span class="ident" id="3635334">c</span><span class="op" id="3635335">.</span><span class="ident" id="3635336">minVersion</span><span class="op" id="3635346">(</span><span class="op" id="3635347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635350">maxVersion</span>&nbsp;<span class="op" id="3635361">:=</span>&nbsp;<span class="ident" id="3635364">c</span><span class="op" id="3635365">.</span><span class="ident" id="3635366">maxVersion</span><span class="op" id="3635376">(</span><span class="op" id="3635377">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635381">if</span>&nbsp;<span class="ident" id="3635384">vers</span>&nbsp;<span class="op" id="3635389">&lt;</span>&nbsp;<span class="ident" id="3635391">minVersion</span>&nbsp;<span class="op" id="3635402">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635406">return</span>&nbsp;<span class="num" id="3635413">0</span><span class="op" id="3635414">,</span>&nbsp;<span class="builtintype" id="3635416">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635423">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635426">if</span>&nbsp;<span class="ident" id="3635429">vers</span>&nbsp;<span class="op" id="3635434">&gt;</span>&nbsp;<span class="ident" id="3635436">maxVersion</span>&nbsp;<span class="op" id="3635447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635451">vers</span>&nbsp;<span class="op" id="3635456">=</span>&nbsp;<span class="ident" id="3635458">maxVersion</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635470">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635473">return</span>&nbsp;<span class="ident" id="3635480">vers</span><span class="op" id="3635484">,</span>&nbsp;<span class="builtintype" id="3635486">true</span><br>
<span class="lineno"></span><span class="op" id="3635491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3635494">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="3635572">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="3635626">func</span>&nbsp;<span class="op" id="3635631">(</span><span class="ident" id="3635632">c</span>&nbsp;<span class="op" id="3635634">*</span><span class="ident" id="3635635">Config</span><span class="op" id="3635641">)</span>&nbsp;<span class="ident" id="3635643">getCertificate</span><span class="op" id="3635657">(</span><span class="ident" id="3635658">clientHello</span>&nbsp;<span class="op" id="3635670">*</span><span class="ident" id="3635671">ClientHelloInfo</span><span class="op" id="3635686">)</span>&nbsp;<span class="op" id="3635688">(</span><span class="op" id="3635689">*</span><span class="ident" id="3635690">Certificate</span><span class="op" id="3635701">,</span>&nbsp;<span class="builtintype" id="3635703">error</span><span class="op" id="3635708">)</span>&nbsp;<span class="op" id="3635710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635713">if</span>&nbsp;<span class="ident" id="3635716">c</span><span class="op" id="3635717">.</span><span class="ident" id="3635718">GetCertificate</span>&nbsp;<span class="op" id="3635733">!=</span>&nbsp;<span class="ident" id="3635736">nil</span>&nbsp;<span class="op" id="3635740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3635744">cert</span><span class="op" id="3635748">,</span>&nbsp;<span class="ident" id="3635750">err</span>&nbsp;<span class="op" id="3635754">:=</span>&nbsp;<span class="ident" id="3635757">c</span><span class="op" id="3635758">.</span><span class="ident" id="3635759">GetCertificate</span><span class="op" id="3635773">(</span><span class="ident" id="3635774">clientHello</span><span class="op" id="3635785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635789">if</span>&nbsp;<span class="ident" id="3635792">cert</span>&nbsp;<span class="op" id="3635797">!=</span>&nbsp;<span class="ident" id="3635800">nil</span>&nbsp;<span class="op" id="3635804">||</span>&nbsp;<span class="ident" id="3635807">err</span>&nbsp;<span class="op" id="3635811">!=</span>&nbsp;<span class="ident" id="3635814">nil</span>&nbsp;<span class="op" id="3635818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635823">return</span>&nbsp;<span class="ident" id="3635830">cert</span><span class="op" id="3635834">,</span>&nbsp;<span class="ident" id="3635836">err</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3635845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635849">if</span>&nbsp;<span class="builtinfunc" id="3635852">len</span><span class="op" id="3635855">(</span><span class="ident" id="3635856">c</span><span class="op" id="3635857">.</span><span class="ident" id="3635858">Certificates</span><span class="op" id="3635870">)</span>&nbsp;<span class="op" id="3635872">==</span>&nbsp;<span class="num" id="3635875">1</span>&nbsp;<span class="op" id="3635877">||</span>&nbsp;<span class="ident" id="3635880">c</span><span class="op" id="3635881">.</span><span class="ident" id="3635882">NameToCertificate</span>&nbsp;<span class="op" id="3635900">==</span>&nbsp;<span class="ident" id="3635903">nil</span>&nbsp;<span class="op" id="3635907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3635911">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3635969">return</span>&nbsp;<span class="op" id="3635976">&amp;</span><span class="ident" id="3635977">c</span><span class="op" id="3635978">.</span><span class="ident" id="3635979">Certificates</span><span class="op" id="3635991">[</span><span class="num" id="3635992">0</span><span class="op" id="3635993">]</span><span class="op" id="3635994">,</span>&nbsp;<span class="ident" id="3635996">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636005">name</span>&nbsp;<span class="op" id="3636010">:=</span>&nbsp;<span class="ident" id="3636013">strings</span><span class="op" id="3636020">.</span><span class="ident" id="3636021">ToLower</span><span class="op" id="3636028">(</span><span class="ident" id="3636029">clientHello</span><span class="op" id="3636040">.</span><span class="ident" id="3636041">ServerName</span><span class="op" id="3636051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636054">for</span>&nbsp;<span class="builtinfunc" id="3636058">len</span><span class="op" id="3636061">(</span><span class="ident" id="3636062">name</span><span class="op" id="3636066">)</span>&nbsp;<span class="op" id="3636068">&gt;</span>&nbsp;<span class="num" id="3636070">0</span>&nbsp;<span class="op" id="3636072">&amp;&amp;</span>&nbsp;<span class="ident" id="3636075">name</span><span class="op" id="3636079">[</span><span class="builtinfunc" id="3636080">len</span><span class="op" id="3636083">(</span><span class="ident" id="3636084">name</span><span class="op" id="3636088">)</span><span class="op" id="3636089">-</span><span class="num" id="3636090">1</span><span class="op" id="3636091">]</span>&nbsp;<span class="op" id="3636093">==</span>&nbsp;<span class="string" id="3636096">&#39;.&#39;</span>&nbsp;<span class="op" id="3636100">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636104">name</span>&nbsp;<span class="op" id="3636109">=</span>&nbsp;<span class="ident" id="3636111">name</span><span class="op" id="3636115">[</span><span class="op" id="3636116">:</span><span class="builtinfunc" id="3636117">len</span><span class="op" id="3636120">(</span><span class="ident" id="3636121">name</span><span class="op" id="3636125">)</span><span class="op" id="3636126">-</span><span class="num" id="3636127">1</span><span class="op" id="3636128">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636135">if</span>&nbsp;<span class="ident" id="3636138">cert</span><span class="op" id="3636142">,</span>&nbsp;<span class="ident" id="3636144">ok</span>&nbsp;<span class="op" id="3636147">:=</span>&nbsp;<span class="ident" id="3636150">c</span><span class="op" id="3636151">.</span><span class="ident" id="3636152">NameToCertificate</span><span class="op" id="3636169">[</span><span class="ident" id="3636170">name</span><span class="op" id="3636174">]</span><span class="op" id="3636175">;</span>&nbsp;<span class="ident" id="3636177">ok</span>&nbsp;<span class="op" id="3636180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636184">return</span>&nbsp;<span class="ident" id="3636191">cert</span><span class="op" id="3636195">,</span>&nbsp;<span class="ident" id="3636197">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3636206">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3636273">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636284">labels</span>&nbsp;<span class="op" id="3636291">:=</span>&nbsp;<span class="ident" id="3636294">strings</span><span class="op" id="3636301">.</span><span class="ident" id="3636302">Split</span><span class="op" id="3636307">(</span><span class="ident" id="3636308">name</span><span class="op" id="3636312">,</span>&nbsp;<span class="string" id="3636314">&#34;.&#34;</span><span class="op" id="3636317">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636320">for</span>&nbsp;<span class="ident" id="3636324">i</span>&nbsp;<span class="op" id="3636326">:=</span>&nbsp;<span class="keyword" id="3636329">range</span>&nbsp;<span class="ident" id="3636335">labels</span>&nbsp;<span class="op" id="3636342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636346">labels</span><span class="op" id="3636352">[</span><span class="ident" id="3636353">i</span><span class="op" id="3636354">]</span>&nbsp;<span class="op" id="3636356">=</span>&nbsp;<span class="string" id="3636358">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636364">candidate</span>&nbsp;<span class="op" id="3636374">:=</span>&nbsp;<span class="ident" id="3636377">strings</span><span class="op" id="3636384">.</span><span class="ident" id="3636385">Join</span><span class="op" id="3636389">(</span><span class="ident" id="3636390">labels</span><span class="op" id="3636396">,</span>&nbsp;<span class="string" id="3636398">&#34;.&#34;</span><span class="op" id="3636401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636405">if</span>&nbsp;<span class="ident" id="3636408">cert</span><span class="op" id="3636412">,</span>&nbsp;<span class="ident" id="3636414">ok</span>&nbsp;<span class="op" id="3636417">:=</span>&nbsp;<span class="ident" id="3636420">c</span><span class="op" id="3636421">.</span><span class="ident" id="3636422">NameToCertificate</span><span class="op" id="3636439">[</span><span class="ident" id="3636440">candidate</span><span class="op" id="3636449">]</span><span class="op" id="3636450">;</span>&nbsp;<span class="ident" id="3636452">ok</span>&nbsp;<span class="op" id="3636455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636460">return</span>&nbsp;<span class="ident" id="3636467">cert</span><span class="op" id="3636471">,</span>&nbsp;<span class="ident" id="3636473">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636479">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3636486">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636540">return</span>&nbsp;<span class="op" id="3636547">&amp;</span><span class="ident" id="3636548">c</span><span class="op" id="3636549">.</span><span class="ident" id="3636550">Certificates</span><span class="op" id="3636562">[</span><span class="num" id="3636563">0</span><span class="op" id="3636564">]</span><span class="op" id="3636565">,</span>&nbsp;<span class="ident" id="3636567">nil</span><br>
<span class="lineno">465</span><span class="op" id="3636571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3636574">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="3636653">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="3636728">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="3636745">func</span>&nbsp;<span class="op" id="3636750">(</span><span class="ident" id="3636751">c</span>&nbsp;<span class="op" id="3636753">*</span><span class="ident" id="3636754">Config</span><span class="op" id="3636760">)</span>&nbsp;<span class="ident" id="3636762">BuildNameToCertificate</span><span class="op" id="3636784">(</span><span class="op" id="3636785">)</span>&nbsp;<span class="op" id="3636787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636790">c</span><span class="op" id="3636791">.</span><span class="ident" id="3636792">NameToCertificate</span>&nbsp;<span class="op" id="3636810">=</span>&nbsp;<span class="builtinfunc" id="3636812">make</span><span class="op" id="3636816">(</span><span class="keyword" id="3636817">map</span><span class="op" id="3636820">[</span><span class="builtintype" id="3636821">string</span><span class="op" id="3636827">]</span><span class="op" id="3636828">*</span><span class="ident" id="3636829">Certificate</span><span class="op" id="3636840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636843">for</span>&nbsp;<span class="ident" id="3636847">i</span>&nbsp;<span class="op" id="3636849">:=</span>&nbsp;<span class="keyword" id="3636852">range</span>&nbsp;<span class="ident" id="3636858">c</span><span class="op" id="3636859">.</span><span class="ident" id="3636860">Certificates</span>&nbsp;<span class="op" id="3636873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636877">cert</span>&nbsp;<span class="op" id="3636882">:=</span>&nbsp;<span class="op" id="3636885">&amp;</span><span class="ident" id="3636886">c</span><span class="op" id="3636887">.</span><span class="ident" id="3636888">Certificates</span><span class="op" id="3636900">[</span><span class="ident" id="3636901">i</span><span class="op" id="3636902">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3636906">x509Cert</span><span class="op" id="3636914">,</span>&nbsp;<span class="ident" id="3636916">err</span>&nbsp;<span class="op" id="3636920">:=</span>&nbsp;<span class="ident" id="3636923">x509</span><span class="op" id="3636927">.</span><span class="ident" id="3636928">ParseCertificate</span><span class="op" id="3636944">(</span><span class="ident" id="3636945">cert</span><span class="op" id="3636949">.</span><span class="ident" id="3636950">Certificate</span><span class="op" id="3636961">[</span><span class="num" id="3636962">0</span><span class="op" id="3636963">]</span><span class="op" id="3636964">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636968">if</span>&nbsp;<span class="ident" id="3636971">err</span>&nbsp;<span class="op" id="3636975">!=</span>&nbsp;<span class="ident" id="3636978">nil</span>&nbsp;<span class="op" id="3636982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3636987">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3636998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637002">if</span>&nbsp;<span class="builtinfunc" id="3637005">len</span><span class="op" id="3637008">(</span><span class="ident" id="3637009">x509Cert</span><span class="op" id="3637017">.</span><span class="ident" id="3637018">Subject</span><span class="op" id="3637025">.</span><span class="ident" id="3637026">CommonName</span><span class="op" id="3637036">)</span>&nbsp;<span class="op" id="3637038">&gt;</span>&nbsp;<span class="num" id="3637040">0</span>&nbsp;<span class="op" id="3637042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637047">c</span><span class="op" id="3637048">.</span><span class="ident" id="3637049">NameToCertificate</span><span class="op" id="3637066">[</span><span class="ident" id="3637067">x509Cert</span><span class="op" id="3637075">.</span><span class="ident" id="3637076">Subject</span><span class="op" id="3637083">.</span><span class="ident" id="3637084">CommonName</span><span class="op" id="3637094">]</span>&nbsp;<span class="op" id="3637096">=</span>&nbsp;<span class="ident" id="3637098">cert</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3637109">for</span>&nbsp;<span class="ident" id="3637113">_</span><span class="op" id="3637114">,</span>&nbsp;<span class="ident" id="3637116">san</span>&nbsp;<span class="op" id="3637120">:=</span>&nbsp;<span class="keyword" id="3637123">range</span>&nbsp;<span class="ident" id="3637129">x509Cert</span><span class="op" id="3637137">.</span><span class="ident" id="3637138">DNSNames</span>&nbsp;<span class="op" id="3637147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637152">c</span><span class="op" id="3637153">.</span><span class="ident" id="3637154">NameToCertificate</span><span class="op" id="3637171">[</span><span class="ident" id="3637172">san</span><span class="op" id="3637175">]</span>&nbsp;<span class="op" id="3637177">=</span>&nbsp;<span class="ident" id="3637179">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3637189">}</span><br>
<span class="lineno">485</span><span class="op" id="3637191">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3637194">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="3637263">type</span>&nbsp;<span class="ident" id="3637268">Certificate</span>&nbsp;<span class="keyword" id="3637280">struct</span>&nbsp;<span class="op" id="3637287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637290">Certificate</span>&nbsp;<span class="op" id="3637302">[</span><span class="op" id="3637303">]</span><span class="op" id="3637304">[</span><span class="op" id="3637305">]</span><span class="builtintype" id="3637306">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637312">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637384">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637445">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637515">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637585">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637614">PrivateKey</span>&nbsp;<span class="ident" id="3637625">crypto</span><span class="op" id="3637631">.</span><span class="ident" id="3637632">PrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637644">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637715">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3637747">OCSPStaple</span>&nbsp;<span class="op" id="3637758">[</span><span class="op" id="3637759">]</span><span class="builtintype" id="3637760">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637766">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637832">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637900">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3637972">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638019">Leaf</span>&nbsp;<span class="op" id="3638024">*</span><span class="ident" id="3638025">x509</span><span class="op" id="3638029">.</span><span class="ident" id="3638030">Certificate</span><br>
<span class="lineno"></span><span class="op" id="3638042">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="3638045">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="3638062">type</span>&nbsp;<span class="ident" id="3638067">record</span>&nbsp;<span class="keyword" id="3638074">struct</span>&nbsp;<span class="op" id="3638081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638084">contentType</span>&nbsp;&nbsp;<span class="ident" id="3638097">recordType</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638109">major</span><span class="op" id="3638114">,</span>&nbsp;<span class="ident" id="3638116">minor</span>&nbsp;<span class="builtintype" id="3638122">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638129">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638142">[</span><span class="op" id="3638143">]</span><span class="builtintype" id="3638144">byte</span><br>
<span class="lineno"></span><span class="op" id="3638149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3638152">type</span>&nbsp;<span class="ident" id="3638157">handshakeMessage</span>&nbsp;<span class="keyword" id="3638174">interface</span>&nbsp;<span class="op" id="3638184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638187">marshal</span><span class="op" id="3638194">(</span><span class="op" id="3638195">)</span>&nbsp;<span class="op" id="3638197">[</span><span class="op" id="3638198">]</span><span class="builtintype" id="3638199">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638205">unmarshal</span><span class="op" id="3638214">(</span><span class="op" id="3638215">[</span><span class="op" id="3638216">]</span><span class="builtintype" id="3638217">byte</span><span class="op" id="3638221">)</span>&nbsp;<span class="builtintype" id="3638223">bool</span><br>
<span class="lineno"></span><span class="op" id="3638228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638231">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="3638306">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="3638327">type</span>&nbsp;<span class="ident" id="3638332">lruSessionCache</span>&nbsp;<span class="keyword" id="3638348">struct</span>&nbsp;<span class="op" id="3638355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638358">sync</span><span class="op" id="3638362">.</span><span class="ident" id="3638363">Mutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638371">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3638380">map</span><span class="op" id="3638383">[</span><span class="builtintype" id="3638384">string</span><span class="op" id="3638390">]</span><span class="op" id="3638391">*</span><span class="ident" id="3638392">list</span><span class="op" id="3638396">.</span><span class="ident" id="3638397">Element</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638406">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638415">*</span><span class="ident" id="3638416">list</span><span class="op" id="3638420">.</span><span class="ident" id="3638421">List</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638427">capacity</span>&nbsp;<span class="builtintype" id="3638436">int</span><br>
<span class="lineno"></span><span class="op" id="3638440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3638443">type</span>&nbsp;<span class="ident" id="3638448">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="3638469">struct</span>&nbsp;<span class="op" id="3638476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638479">sessionKey</span>&nbsp;<span class="builtintype" id="3638490">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638498">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3638509">*</span><span class="ident" id="3638510">ClientSessionState</span><br>
<span class="lineno"></span><span class="op" id="3638529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638532">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="3638604">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="3638682">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="3638702">func</span>&nbsp;<span class="ident" id="3638707">NewLRUClientSessionCache</span><span class="op" id="3638731">(</span><span class="ident" id="3638732">capacity</span>&nbsp;<span class="builtintype" id="3638741">int</span><span class="op" id="3638744">)</span>&nbsp;<span class="ident" id="3638746">ClientSessionCache</span>&nbsp;<span class="op" id="3638765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638768">const</span>&nbsp;<span class="ident" id="3638774">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="3638802">=</span>&nbsp;<span class="num" id="3638804">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638809">if</span>&nbsp;<span class="ident" id="3638812">capacity</span>&nbsp;<span class="op" id="3638821">&lt;</span>&nbsp;<span class="num" id="3638823">1</span>&nbsp;<span class="op" id="3638825">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638829">capacity</span>&nbsp;<span class="op" id="3638838">=</span>&nbsp;<span class="ident" id="3638840">defaultSessionCacheCapacity</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3638872">return</span>&nbsp;<span class="op" id="3638879">&amp;</span><span class="ident" id="3638880">lruSessionCache</span><span class="op" id="3638895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638899">m</span><span class="op" id="3638900">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3638909">make</span><span class="op" id="3638913">(</span><span class="keyword" id="3638914">map</span><span class="op" id="3638917">[</span><span class="builtintype" id="3638918">string</span><span class="op" id="3638924">]</span><span class="op" id="3638925">*</span><span class="ident" id="3638926">list</span><span class="op" id="3638930">.</span><span class="ident" id="3638931">Element</span><span class="op" id="3638938">)</span><span class="op" id="3638939">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638943">q</span><span class="op" id="3638944">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3638953">list</span><span class="op" id="3638957">.</span><span class="ident" id="3638958">New</span><span class="op" id="3638961">(</span><span class="op" id="3638962">)</span><span class="op" id="3638963">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3638967">capacity</span><span class="op" id="3638975">:</span>&nbsp;<span class="ident" id="3638977">capacity</span><span class="op" id="3638985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3638988">}</span><br>
<span class="lineno"></span><span class="op" id="3638990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3638993">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="3639054">func</span>&nbsp;<span class="op" id="3639059">(</span><span class="ident" id="3639060">c</span>&nbsp;<span class="op" id="3639062">*</span><span class="ident" id="3639063">lruSessionCache</span><span class="op" id="3639078">)</span>&nbsp;<span class="ident" id="3639080">Put</span><span class="op" id="3639083">(</span><span class="ident" id="3639084">sessionKey</span>&nbsp;<span class="builtintype" id="3639095">string</span><span class="op" id="3639101">,</span>&nbsp;<span class="ident" id="3639103">cs</span>&nbsp;<span class="op" id="3639106">*</span><span class="ident" id="3639107">ClientSessionState</span><span class="op" id="3639125">)</span>&nbsp;<span class="op" id="3639127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639130">c</span><span class="op" id="3639131">.</span><span class="ident" id="3639132">Lock</span><span class="op" id="3639136">(</span><span class="op" id="3639137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639140">defer</span>&nbsp;<span class="ident" id="3639146">c</span><span class="op" id="3639147">.</span><span class="ident" id="3639148">Unlock</span><span class="op" id="3639154">(</span><span class="op" id="3639155">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639159">if</span>&nbsp;<span class="ident" id="3639162">elem</span><span class="op" id="3639166">,</span>&nbsp;<span class="ident" id="3639168">ok</span>&nbsp;<span class="op" id="3639171">:=</span>&nbsp;<span class="ident" id="3639174">c</span><span class="op" id="3639175">.</span><span class="ident" id="3639176">m</span><span class="op" id="3639177">[</span><span class="ident" id="3639178">sessionKey</span><span class="op" id="3639188">]</span><span class="op" id="3639189">;</span>&nbsp;<span class="ident" id="3639191">ok</span>&nbsp;<span class="op" id="3639194">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639198">entry</span>&nbsp;<span class="op" id="3639204">:=</span>&nbsp;<span class="ident" id="3639207">elem</span><span class="op" id="3639211">.</span><span class="ident" id="3639212">Value</span><span class="op" id="3639217">.</span><span class="op" id="3639218">(</span><span class="op" id="3639219">*</span><span class="ident" id="3639220">lruSessionCacheEntry</span><span class="op" id="3639240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639244">entry</span><span class="op" id="3639249">.</span><span class="ident" id="3639250">state</span>&nbsp;<span class="op" id="3639256">=</span>&nbsp;<span class="ident" id="3639258">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639263">c</span><span class="op" id="3639264">.</span><span class="ident" id="3639265">q</span><span class="op" id="3639266">.</span><span class="ident" id="3639267">MoveToFront</span><span class="op" id="3639278">(</span><span class="ident" id="3639279">elem</span><span class="op" id="3639283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639287">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639295">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639299">if</span>&nbsp;<span class="ident" id="3639302">c</span><span class="op" id="3639303">.</span><span class="ident" id="3639304">q</span><span class="op" id="3639305">.</span><span class="ident" id="3639306">Len</span><span class="op" id="3639309">(</span><span class="op" id="3639310">)</span>&nbsp;<span class="op" id="3639312">&lt;</span>&nbsp;<span class="ident" id="3639314">c</span><span class="op" id="3639315">.</span><span class="ident" id="3639316">capacity</span>&nbsp;<span class="op" id="3639325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639329">entry</span>&nbsp;<span class="op" id="3639335">:=</span>&nbsp;<span class="op" id="3639338">&amp;</span><span class="ident" id="3639339">lruSessionCacheEntry</span><span class="op" id="3639359">{</span><span class="ident" id="3639360">sessionKey</span><span class="op" id="3639370">,</span>&nbsp;<span class="ident" id="3639372">cs</span><span class="op" id="3639374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639378">c</span><span class="op" id="3639379">.</span><span class="ident" id="3639380">m</span><span class="op" id="3639381">[</span><span class="ident" id="3639382">sessionKey</span><span class="op" id="3639392">]</span>&nbsp;<span class="op" id="3639394">=</span>&nbsp;<span class="ident" id="3639396">c</span><span class="op" id="3639397">.</span><span class="ident" id="3639398">q</span><span class="op" id="3639399">.</span><span class="ident" id="3639400">PushFront</span><span class="op" id="3639409">(</span><span class="ident" id="3639410">entry</span><span class="op" id="3639415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639419">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639427">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639431">elem</span>&nbsp;<span class="op" id="3639436">:=</span>&nbsp;<span class="ident" id="3639439">c</span><span class="op" id="3639440">.</span><span class="ident" id="3639441">q</span><span class="op" id="3639442">.</span><span class="ident" id="3639443">Back</span><span class="op" id="3639447">(</span><span class="op" id="3639448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639451">entry</span>&nbsp;<span class="op" id="3639457">:=</span>&nbsp;<span class="ident" id="3639460">elem</span><span class="op" id="3639464">.</span><span class="ident" id="3639465">Value</span><span class="op" id="3639470">.</span><span class="op" id="3639471">(</span><span class="op" id="3639472">*</span><span class="ident" id="3639473">lruSessionCacheEntry</span><span class="op" id="3639493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3639496">delete</span><span class="op" id="3639502">(</span><span class="ident" id="3639503">c</span><span class="op" id="3639504">.</span><span class="ident" id="3639505">m</span><span class="op" id="3639506">,</span>&nbsp;<span class="ident" id="3639508">entry</span><span class="op" id="3639513">.</span><span class="ident" id="3639514">sessionKey</span><span class="op" id="3639524">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639527">entry</span><span class="op" id="3639532">.</span><span class="ident" id="3639533">sessionKey</span>&nbsp;<span class="op" id="3639544">=</span>&nbsp;<span class="ident" id="3639546">sessionKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639558">entry</span><span class="op" id="3639563">.</span><span class="ident" id="3639564">state</span>&nbsp;<span class="op" id="3639570">=</span>&nbsp;<span class="ident" id="3639572">cs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639576">c</span><span class="op" id="3639577">.</span><span class="ident" id="3639578">q</span><span class="op" id="3639579">.</span><span class="ident" id="3639580">MoveToFront</span><span class="op" id="3639591">(</span><span class="ident" id="3639592">elem</span><span class="op" id="3639596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639599">c</span><span class="op" id="3639600">.</span><span class="ident" id="3639601">m</span><span class="op" id="3639602">[</span><span class="ident" id="3639603">sessionKey</span><span class="op" id="3639613">]</span>&nbsp;<span class="op" id="3639615">=</span>&nbsp;<span class="ident" id="3639617">elem</span><br>
<span class="lineno"></span><span class="op" id="3639622">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="3639625">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="3639701">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="3639747">func</span>&nbsp;<span class="op" id="3639752">(</span><span class="ident" id="3639753">c</span>&nbsp;<span class="op" id="3639755">*</span><span class="ident" id="3639756">lruSessionCache</span><span class="op" id="3639771">)</span>&nbsp;<span class="ident" id="3639773">Get</span><span class="op" id="3639776">(</span><span class="ident" id="3639777">sessionKey</span>&nbsp;<span class="builtintype" id="3639788">string</span><span class="op" id="3639794">)</span>&nbsp;<span class="op" id="3639796">(</span><span class="op" id="3639797">*</span><span class="ident" id="3639798">ClientSessionState</span><span class="op" id="3639816">,</span>&nbsp;<span class="builtintype" id="3639818">bool</span><span class="op" id="3639822">)</span>&nbsp;<span class="op" id="3639824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639827">c</span><span class="op" id="3639828">.</span><span class="ident" id="3639829">Lock</span><span class="op" id="3639833">(</span><span class="op" id="3639834">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639837">defer</span>&nbsp;<span class="ident" id="3639843">c</span><span class="op" id="3639844">.</span><span class="ident" id="3639845">Unlock</span><span class="op" id="3639851">(</span><span class="op" id="3639852">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639856">if</span>&nbsp;<span class="ident" id="3639859">elem</span><span class="op" id="3639863">,</span>&nbsp;<span class="ident" id="3639865">ok</span>&nbsp;<span class="op" id="3639868">:=</span>&nbsp;<span class="ident" id="3639871">c</span><span class="op" id="3639872">.</span><span class="ident" id="3639873">m</span><span class="op" id="3639874">[</span><span class="ident" id="3639875">sessionKey</span><span class="op" id="3639885">]</span><span class="op" id="3639886">;</span>&nbsp;<span class="ident" id="3639888">ok</span>&nbsp;<span class="op" id="3639891">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3639895">c</span><span class="op" id="3639896">.</span><span class="ident" id="3639897">q</span><span class="op" id="3639898">.</span><span class="ident" id="3639899">MoveToFront</span><span class="op" id="3639910">(</span><span class="ident" id="3639911">elem</span><span class="op" id="3639915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639919">return</span>&nbsp;<span class="ident" id="3639926">elem</span><span class="op" id="3639930">.</span><span class="ident" id="3639931">Value</span><span class="op" id="3639936">.</span><span class="op" id="3639937">(</span><span class="op" id="3639938">*</span><span class="ident" id="3639939">lruSessionCacheEntry</span><span class="op" id="3639959">)</span><span class="op" id="3639960">.</span><span class="ident" id="3639961">state</span><span class="op" id="3639966">,</span>&nbsp;<span class="builtintype" id="3639968">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3639974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3639977">return</span>&nbsp;<span class="ident" id="3639984">nil</span><span class="op" id="3639987">,</span>&nbsp;<span class="builtintype" id="3639989">false</span><br>
<span class="lineno"></span><span class="op" id="3639995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3639998">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="3640071">type</span>&nbsp;<span class="ident" id="3640076">dsaSignature</span>&nbsp;<span class="keyword" id="3640089">struct</span>&nbsp;<span class="op" id="3640096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640099">R</span><span class="op" id="3640100">,</span>&nbsp;<span class="ident" id="3640102">S</span>&nbsp;<span class="op" id="3640104">*</span><span class="ident" id="3640105">big</span><span class="op" id="3640108">.</span><span class="ident" id="3640109">Int</span><br>
<span class="lineno"></span><span class="op" id="3640113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640116">type</span>&nbsp;<span class="ident" id="3640121">ecdsaSignature</span>&nbsp;<span class="ident" id="3640136">dsaSignature</span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="3640150">var</span>&nbsp;<span class="ident" id="3640154">emptyConfig</span>&nbsp;<span class="ident" id="3640166">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640174">func</span>&nbsp;<span class="ident" id="3640179">defaultConfig</span><span class="op" id="3640192">(</span><span class="op" id="3640193">)</span>&nbsp;<span class="op" id="3640195">*</span><span class="ident" id="3640196">Config</span>&nbsp;<span class="op" id="3640203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640206">return</span>&nbsp;<span class="op" id="3640213">&amp;</span><span class="ident" id="3640214">emptyConfig</span><br>
<span class="lineno">600</span><span class="op" id="3640226">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640229">var</span>&nbsp;<span class="op" id="3640233">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640236">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3640259">sync</span><span class="op" id="3640263">.</span><span class="ident" id="3640264">Once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640270">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3640293">[</span><span class="op" id="3640294">]</span><span class="builtintype" id="3640295">uint16</span><br>
<span class="lineno">605</span><span class="op" id="3640302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640305">func</span>&nbsp;<span class="ident" id="3640310">defaultCipherSuites</span><span class="op" id="3640329">(</span><span class="op" id="3640330">)</span>&nbsp;<span class="op" id="3640332">[</span><span class="op" id="3640333">]</span><span class="builtintype" id="3640334">uint16</span>&nbsp;<span class="op" id="3640341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640344">once</span><span class="op" id="3640348">.</span><span class="ident" id="3640349">Do</span><span class="op" id="3640351">(</span><span class="ident" id="3640352">initDefaultCipherSuites</span><span class="op" id="3640375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640378">return</span>&nbsp;<span class="ident" id="3640385">varDefaultCipherSuites</span><br>
<span class="lineno">610</span><span class="op" id="3640408">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640411">func</span>&nbsp;<span class="ident" id="3640416">initDefaultCipherSuites</span><span class="op" id="3640439">(</span><span class="op" id="3640440">)</span>&nbsp;<span class="op" id="3640442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640445">varDefaultCipherSuites</span>&nbsp;<span class="op" id="3640468">=</span>&nbsp;<span class="builtinfunc" id="3640470">make</span><span class="op" id="3640474">(</span><span class="op" id="3640475">[</span><span class="op" id="3640476">]</span><span class="builtintype" id="3640477">uint16</span><span class="op" id="3640483">,</span>&nbsp;<span class="builtinfunc" id="3640485">len</span><span class="op" id="3640488">(</span><span class="ident" id="3640489">cipherSuites</span><span class="op" id="3640501">)</span><span class="op" id="3640502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640505">for</span>&nbsp;<span class="ident" id="3640509">i</span><span class="op" id="3640510">,</span>&nbsp;<span class="ident" id="3640512">suite</span>&nbsp;<span class="op" id="3640518">:=</span>&nbsp;<span class="keyword" id="3640521">range</span>&nbsp;<span class="ident" id="3640527">cipherSuites</span>&nbsp;<span class="op" id="3640540">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3640544">varDefaultCipherSuites</span><span class="op" id="3640566">[</span><span class="ident" id="3640567">i</span><span class="op" id="3640568">]</span>&nbsp;<span class="op" id="3640570">=</span>&nbsp;<span class="ident" id="3640572">suite</span><span class="op" id="3640577">.</span><span class="ident" id="3640578">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3640582">}</span><br>
<span class="lineno"></span><span class="op" id="3640584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3640587">func</span>&nbsp;<span class="ident" id="3640592">unexpectedMessageError</span><span class="op" id="3640614">(</span><span class="ident" id="3640615">wanted</span><span class="op" id="3640621">,</span>&nbsp;<span class="ident" id="3640623">got</span>&nbsp;<span class="keyword" id="3640627">interface</span><span class="op" id="3640636">{</span><span class="op" id="3640637">}</span><span class="op" id="3640638">)</span>&nbsp;<span class="builtintype" id="3640640">error</span>&nbsp;<span class="op" id="3640646">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3640649">return</span>&nbsp;<span class="ident" id="3640656">fmt</span><span class="op" id="3640659">.</span><span class="ident" id="3640660">Errorf</span><span class="op" id="3640666">(</span><span class="string" id="3640667">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="3640742">,</span>&nbsp;<span class="ident" id="3640744">got</span><span class="op" id="3640747">,</span>&nbsp;<span class="ident" id="3640749">wanted</span><span class="op" id="3640755">)</span><br>
<span class="lineno"></span><span class="op" id="3640757">}</span>
</div>
</body>
</html>
