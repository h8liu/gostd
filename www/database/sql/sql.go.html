<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6348603">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6348658">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6348712">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6348763">//&nbsp;Package&nbsp;sql&nbsp;provides&nbsp;a&nbsp;generic&nbsp;interface&nbsp;around&nbsp;SQL&nbsp;(or&nbsp;SQL-like)</span><br>
<span class="lineno"></span><span class="comment" id="6348832">//&nbsp;databases.</span><br>
<span class="lineno"></span><span class="comment" id="6348846">//</span><br>
<span class="lineno"></span><span class="comment" id="6348849">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;must&nbsp;be&nbsp;used&nbsp;in&nbsp;conjunction&nbsp;with&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span><span class="comment" id="6348920">//&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for&nbsp;a&nbsp;list&nbsp;of&nbsp;drivers.</span><br>
<span class="lineno">10</span><span class="comment" id="6348981">//</span><br>
<span class="lineno"></span><span class="comment" id="6348984">//&nbsp;For&nbsp;more&nbsp;usage&nbsp;examples,&nbsp;see&nbsp;the&nbsp;wiki&nbsp;page&nbsp;at</span><br>
<span class="lineno"></span><span class="comment" id="6349033">//&nbsp;http://golang.org/s/sqlwiki.</span><br>
<span class="lineno"></span><span class="keyword" id="6349065">package</span>&nbsp;<span class="ident" id="6349073">sql</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6349078">import</span>&nbsp;<span class="op" id="6349085">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349088">&#34;database/sql/driver&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349111">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349121">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349128">&#34;io&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349134">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349145">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349153">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6349160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6349163">var</span>&nbsp;<span class="ident" id="6349167">drivers</span>&nbsp;<span class="op" id="6349175">=</span>&nbsp;<span class="builtinfunc" id="6349177">make</span><span class="op" id="6349181">(</span><span class="keyword" id="6349182">map</span><span class="op" id="6349185">[</span><span class="builtintype" id="6349186">string</span><span class="op" id="6349192">]</span><span class="ident" id="6349193"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6349199">.</span><span class="ident" id="6349200">Driver</span><span class="op" id="6349206">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6349209">//&nbsp;Register&nbsp;makes&nbsp;a&nbsp;database&nbsp;driver&nbsp;available&nbsp;by&nbsp;the&nbsp;provided&nbsp;name.</span><br>
<span class="lineno"></span><span class="comment" id="6349277">//&nbsp;If&nbsp;Register&nbsp;is&nbsp;called&nbsp;twice&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;or&nbsp;if&nbsp;driver&nbsp;is&nbsp;nil,</span><br>
<span class="lineno"></span><span class="comment" id="6349348">//&nbsp;it&nbsp;panics.</span><br>
<span class="lineno">30</span><span class="keyword" id="6349362">func</span>&nbsp;<span class="ident" id="6349367">Register</span><span class="op" id="6349375">(</span><span class="ident" id="6349376">name</span>&nbsp;<span class="builtintype" id="6349381">string</span><span class="op" id="6349387">,</span>&nbsp;<span class="ident" id="6349389">driver</span>&nbsp;<span class="ident" id="6349396"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6349402">.</span><span class="ident" id="6349403">Driver</span><span class="op" id="6349409">)</span>&nbsp;<span class="op" id="6349411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349414">if</span>&nbsp;<span class="ident" id="6349417"><a href="/database/sql/sql.go.html#6349389">driver</a></span>&nbsp;<span class="op" id="6349424">==</span>&nbsp;<span class="ident" id="6349427">nil</span>&nbsp;<span class="op" id="6349431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6349435">panic</span><span class="op" id="6349440">(</span><span class="string" id="6349441">&#34;sql:&nbsp;Register&nbsp;driver&nbsp;is&nbsp;nil&#34;</span><span class="op" id="6349470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349476">if</span>&nbsp;<span class="ident" id="6349479">_</span><span class="op" id="6349480">,</span>&nbsp;<span class="ident" id="6349482">dup</span>&nbsp;<span class="op" id="6349486">:=</span>&nbsp;<span class="ident" id="6349489"><a href="/database/sql/sql.go.html#6349167">drivers</a></span><span class="op" id="6349496">[</span><span class="ident" id="6349497"><a href="/database/sql/sql.go.html#6349376">name</a></span><span class="op" id="6349501">]</span><span class="op" id="6349502">;</span>&nbsp;<span class="ident" id="6349504"><a href="/database/sql/sql.go.html#6349482">dup</a></span>&nbsp;<span class="op" id="6349508">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6349512">panic</span><span class="op" id="6349517">(</span><span class="string" id="6349518">&#34;sql:&nbsp;Register&nbsp;called&nbsp;twice&nbsp;for&nbsp;driver&nbsp;&#34;</span>&nbsp;<span class="op" id="6349559">+</span>&nbsp;<span class="ident" id="6349561"><a href="/database/sql/sql.go.html#6349376">name</a></span><span class="op" id="6349565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349571"><a href="/database/sql/sql.go.html#6349167">drivers</a></span><span class="op" id="6349578">[</span><span class="ident" id="6349579"><a href="/database/sql/sql.go.html#6349376">name</a></span><span class="op" id="6349583">]</span>&nbsp;<span class="op" id="6349585">=</span>&nbsp;<span class="ident" id="6349587"><a href="/database/sql/sql.go.html#6349389">driver</a></span><br>
<span class="lineno"></span><span class="op" id="6349594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="6349597">func</span>&nbsp;<span class="ident" id="6349602">unregisterAllDrivers</span><span class="op" id="6349622">(</span><span class="op" id="6349623">)</span>&nbsp;<span class="op" id="6349625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6349628">//&nbsp;For&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349643"><a href="/database/sql/sql.go.html#6349167">drivers</a></span>&nbsp;<span class="op" id="6349651">=</span>&nbsp;<span class="builtinfunc" id="6349653">make</span><span class="op" id="6349657">(</span><span class="keyword" id="6349658">map</span><span class="op" id="6349661">[</span><span class="builtintype" id="6349662">string</span><span class="op" id="6349668">]</span><span class="ident" id="6349669"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6349675">.</span><span class="ident" id="6349676">Driver</span><span class="op" id="6349682">)</span><br>
<span class="lineno"></span><span class="op" id="6349684">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span><span class="comment" id="6349687">//&nbsp;Drivers&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;registered&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="keyword" id="6349760">func</span>&nbsp;<span class="ident" id="6349765">Drivers</span><span class="op" id="6349772">(</span><span class="op" id="6349773">)</span>&nbsp;<span class="op" id="6349775">[</span><span class="op" id="6349776">]</span><span class="builtintype" id="6349777">string</span>&nbsp;<span class="op" id="6349784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349787">var</span>&nbsp;<span class="ident" id="6349791">list</span>&nbsp;<span class="op" id="6349796">[</span><span class="op" id="6349797">]</span><span class="builtintype" id="6349798">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349806">for</span>&nbsp;<span class="ident" id="6349810">name</span>&nbsp;<span class="op" id="6349815">:=</span>&nbsp;<span class="keyword" id="6349818">range</span>&nbsp;<span class="ident" id="6349824"><a href="/database/sql/sql.go.html#6349167">drivers</a></span>&nbsp;<span class="op" id="6349832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349836"><a href="/database/sql/sql.go.html#6349791">list</a></span>&nbsp;<span class="op" id="6349841">=</span>&nbsp;<span class="builtinfunc" id="6349843">append</span><span class="op" id="6349849">(</span><span class="ident" id="6349850"><a href="/database/sql/sql.go.html#6349791">list</a></span><span class="op" id="6349854">,</span>&nbsp;<span class="ident" id="6349856"><a href="/database/sql/sql.go.html#6349810">name</a></span><span class="op" id="6349860">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6349863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349866"><a href="/database/sql/sql.go.html#6349145">sort</a></span><span class="op" id="6349870">.</span><span class="ident" id="6349871">Strings</span><span class="op" id="6349878">(</span><span class="ident" id="6349879"><a href="/database/sql/sql.go.html#6349791">list</a></span><span class="op" id="6349883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6349886">return</span>&nbsp;<span class="ident" id="6349893"><a href="/database/sql/sql.go.html#6349791">list</a></span><br>
<span class="lineno"></span><span class="op" id="6349898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="6349901">//&nbsp;RawBytes&nbsp;is&nbsp;a&nbsp;byte&nbsp;slice&nbsp;that&nbsp;holds&nbsp;a&nbsp;reference&nbsp;to&nbsp;memory&nbsp;owned&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6349971">//&nbsp;the&nbsp;database&nbsp;itself.&nbsp;After&nbsp;a&nbsp;Scan&nbsp;into&nbsp;a&nbsp;RawBytes,&nbsp;the&nbsp;slice&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="6350043">//&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Next,&nbsp;Scan,&nbsp;or&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6350097">type</span>&nbsp;<span class="ident" id="6350102">RawBytes</span>&nbsp;<span class="op" id="6350111">[</span><span class="op" id="6350112">]</span><span class="builtintype" id="6350113">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="6350119">//&nbsp;NullString&nbsp;represents&nbsp;a&nbsp;string&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="6350171">//&nbsp;NullString&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6350221">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination:</span><br>
<span class="lineno"></span><span class="comment" id="6350262">//</span><br>
<span class="lineno"></span><span class="comment" id="6350265">//&nbsp;&nbsp;var&nbsp;s&nbsp;NullString</span><br>
<span class="lineno">65</span><span class="comment" id="6350286">//&nbsp;&nbsp;err&nbsp;:=&nbsp;db.QueryRow(&#34;SELECT&nbsp;name&nbsp;FROM&nbsp;foo&nbsp;WHERE&nbsp;id=?&#34;,&nbsp;id).Scan(&amp;s)</span><br>
<span class="lineno"></span><span class="comment" id="6350357">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6350365">//&nbsp;&nbsp;if&nbsp;s.Valid&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6350382">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;use&nbsp;s.String</span><br>
<span class="lineno"></span><span class="comment" id="6350405">//&nbsp;&nbsp;}&nbsp;else&nbsp;{</span><br>
<span class="lineno">70</span><span class="comment" id="6350418">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;NULL&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="6350439">//&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6350445">//</span><br>
<span class="lineno"></span><span class="keyword" id="6350448">type</span>&nbsp;<span class="ident" id="6350453">NullString</span>&nbsp;<span class="keyword" id="6350464">struct</span>&nbsp;<span class="op" id="6350471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350474">String</span>&nbsp;<span class="builtintype" id="6350481">string</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350489">Valid</span>&nbsp;&nbsp;<span class="builtintype" id="6350496">bool</span>&nbsp;<span class="comment" id="6350501">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;String&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="6350540">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6350543">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6350585">func</span>&nbsp;<span class="op" id="6350590">(</span><span class="ident" id="6350591">ns</span>&nbsp;<span class="op" id="6350594">*</span><span class="ident" id="6350595"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="6350605">)</span>&nbsp;<span class="ident" id="6350607">Scan</span><span class="op" id="6350611">(</span><span class="ident" id="6350612">value</span>&nbsp;<span class="keyword" id="6350618">interface</span><span class="op" id="6350627">{</span><span class="op" id="6350628">}</span><span class="op" id="6350629">)</span>&nbsp;<span class="builtintype" id="6350631">error</span>&nbsp;<span class="op" id="6350637">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350640">if</span>&nbsp;<span class="ident" id="6350643"><a href="/database/sql/sql.go.html#6350612">value</a></span>&nbsp;<span class="op" id="6350649">==</span>&nbsp;<span class="ident" id="6350652">nil</span>&nbsp;<span class="op" id="6350656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350660"><a href="/database/sql/sql.go.html#6350591">ns</a></span><span class="op" id="6350662">.</span><span class="ident" id="6350663">String</span><span class="op" id="6350669">,</span>&nbsp;<span class="ident" id="6350671"><a href="/database/sql/sql.go.html#6350591">ns</a></span><span class="op" id="6350673">.</span><span class="ident" id="6350674">Valid</span>&nbsp;<span class="op" id="6350680">=</span>&nbsp;<span class="string" id="6350682">&#34;&#34;</span><span class="op" id="6350684">,</span>&nbsp;<span class="builtintype" id="6350686">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350694">return</span>&nbsp;<span class="ident" id="6350701">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6350706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350709"><a href="/database/sql/sql.go.html#6350591">ns</a></span><span class="op" id="6350711">.</span><span class="ident" id="6350712">Valid</span>&nbsp;<span class="op" id="6350718">=</span>&nbsp;<span class="builtintype" id="6350720">true</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350726">return</span>&nbsp;<span class="ident" id="6350733"><a href="/database/sql/convert.go.html#6343828">convertAssign</a></span><span class="op" id="6350746">(</span><span class="op" id="6350747">&amp;</span><span class="ident" id="6350748"><a href="/database/sql/sql.go.html#6350591">ns</a></span><span class="op" id="6350750">.</span><span class="ident" id="6350751">String</span><span class="op" id="6350757">,</span>&nbsp;<span class="ident" id="6350759"><a href="/database/sql/sql.go.html#6350612">value</a></span><span class="op" id="6350764">)</span><br>
<span class="lineno"></span><span class="op" id="6350766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6350769">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6350818">func</span>&nbsp;<span class="op" id="6350823">(</span><span class="ident" id="6350824">ns</span>&nbsp;<span class="ident" id="6350827"><a href="/database/sql/sql.go.html#6350453">NullString</a></span><span class="op" id="6350837">)</span>&nbsp;<span class="ident" id="6350839">Value</span><span class="op" id="6350844">(</span><span class="op" id="6350845">)</span>&nbsp;<span class="op" id="6350847">(</span><span class="ident" id="6350848"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6350854">.</span><span class="ident" id="6350855">Value</span><span class="op" id="6350860">,</span>&nbsp;<span class="builtintype" id="6350862">error</span><span class="op" id="6350867">)</span>&nbsp;<span class="op" id="6350869">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350872">if</span>&nbsp;<span class="op" id="6350875">!</span><span class="ident" id="6350876"><a href="/database/sql/sql.go.html#6350824">ns</a></span><span class="op" id="6350878">.</span><span class="ident" id="6350879">Valid</span>&nbsp;<span class="op" id="6350885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350889">return</span>&nbsp;<span class="ident" id="6350896">nil</span><span class="op" id="6350899">,</span>&nbsp;<span class="ident" id="6350901">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6350906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350909">return</span>&nbsp;<span class="ident" id="6350916"><a href="/database/sql/sql.go.html#6350824">ns</a></span><span class="op" id="6350918">.</span><span class="ident" id="6350919">String</span><span class="op" id="6350925">,</span>&nbsp;<span class="ident" id="6350927">nil</span><br>
<span class="lineno"></span><span class="op" id="6350931">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="6350934">//&nbsp;NullInt64&nbsp;represents&nbsp;an&nbsp;int64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="6350985">//&nbsp;NullInt64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6351034">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="6351098">type</span>&nbsp;<span class="ident" id="6351103">NullInt64</span>&nbsp;<span class="keyword" id="6351113">struct</span>&nbsp;<span class="op" id="6351120">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351123">Int64</span>&nbsp;<span class="ident" id="6351129">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351136">Valid</span>&nbsp;<span class="builtintype" id="6351142">bool</span>&nbsp;<span class="comment" id="6351147">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Int64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="6351185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6351188">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno">105</span><span class="keyword" id="6351230">func</span>&nbsp;<span class="op" id="6351235">(</span><span class="ident" id="6351236">n</span>&nbsp;<span class="op" id="6351238">*</span><span class="ident" id="6351239"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="6351248">)</span>&nbsp;<span class="ident" id="6351250">Scan</span><span class="op" id="6351254">(</span><span class="ident" id="6351255">value</span>&nbsp;<span class="keyword" id="6351261">interface</span><span class="op" id="6351270">{</span><span class="op" id="6351271">}</span><span class="op" id="6351272">)</span>&nbsp;<span class="builtintype" id="6351274">error</span>&nbsp;<span class="op" id="6351280">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351283">if</span>&nbsp;<span class="ident" id="6351286"><a href="/database/sql/sql.go.html#6351255">value</a></span>&nbsp;<span class="op" id="6351292">==</span>&nbsp;<span class="ident" id="6351295">nil</span>&nbsp;<span class="op" id="6351299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351303"><a href="/database/sql/sql.go.html#6351236">n</a></span><span class="op" id="6351304">.</span><span class="ident" id="6351305">Int64</span><span class="op" id="6351310">,</span>&nbsp;<span class="ident" id="6351312"><a href="/database/sql/sql.go.html#6351236">n</a></span><span class="op" id="6351313">.</span><span class="ident" id="6351314">Valid</span>&nbsp;<span class="op" id="6351320">=</span>&nbsp;<span class="num" id="6351322">0</span><span class="op" id="6351323">,</span>&nbsp;<span class="builtintype" id="6351325">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351333">return</span>&nbsp;<span class="ident" id="6351340">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351345">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351348"><a href="/database/sql/sql.go.html#6351236">n</a></span><span class="op" id="6351349">.</span><span class="ident" id="6351350">Valid</span>&nbsp;<span class="op" id="6351356">=</span>&nbsp;<span class="builtintype" id="6351358">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351364">return</span>&nbsp;<span class="ident" id="6351371"><a href="/database/sql/convert.go.html#6343828">convertAssign</a></span><span class="op" id="6351384">(</span><span class="op" id="6351385">&amp;</span><span class="ident" id="6351386"><a href="/database/sql/sql.go.html#6351236">n</a></span><span class="op" id="6351387">.</span><span class="ident" id="6351388">Int64</span><span class="op" id="6351393">,</span>&nbsp;<span class="ident" id="6351395"><a href="/database/sql/sql.go.html#6351255">value</a></span><span class="op" id="6351400">)</span><br>
<span class="lineno"></span><span class="op" id="6351402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6351405">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno">115</span><span class="keyword" id="6351454">func</span>&nbsp;<span class="op" id="6351459">(</span><span class="ident" id="6351460">n</span>&nbsp;<span class="ident" id="6351462"><a href="/database/sql/sql.go.html#6351103">NullInt64</a></span><span class="op" id="6351471">)</span>&nbsp;<span class="ident" id="6351473">Value</span><span class="op" id="6351478">(</span><span class="op" id="6351479">)</span>&nbsp;<span class="op" id="6351481">(</span><span class="ident" id="6351482"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6351488">.</span><span class="ident" id="6351489">Value</span><span class="op" id="6351494">,</span>&nbsp;<span class="builtintype" id="6351496">error</span><span class="op" id="6351501">)</span>&nbsp;<span class="op" id="6351503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351506">if</span>&nbsp;<span class="op" id="6351509">!</span><span class="ident" id="6351510"><a href="/database/sql/sql.go.html#6351460">n</a></span><span class="op" id="6351511">.</span><span class="ident" id="6351512">Valid</span>&nbsp;<span class="op" id="6351518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351522">return</span>&nbsp;<span class="ident" id="6351529">nil</span><span class="op" id="6351532">,</span>&nbsp;<span class="ident" id="6351534">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351542">return</span>&nbsp;<span class="ident" id="6351549"><a href="/database/sql/sql.go.html#6351460">n</a></span><span class="op" id="6351550">.</span><span class="ident" id="6351551">Int64</span><span class="op" id="6351556">,</span>&nbsp;<span class="ident" id="6351558">nil</span><br>
<span class="lineno">120</span><span class="op" id="6351562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6351565">//&nbsp;NullFloat64&nbsp;represents&nbsp;a&nbsp;float64&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="6351619">//&nbsp;NullFloat64&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6351670">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno">125</span><span class="keyword" id="6351734">type</span>&nbsp;<span class="ident" id="6351739">NullFloat64</span>&nbsp;<span class="keyword" id="6351751">struct</span>&nbsp;<span class="op" id="6351758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351761">Float64</span>&nbsp;<span class="builtintype" id="6351769">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351778">Valid</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6351786">bool</span>&nbsp;<span class="comment" id="6351791">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Float64&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="6351831">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="6351834">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6351876">func</span>&nbsp;<span class="op" id="6351881">(</span><span class="ident" id="6351882">n</span>&nbsp;<span class="op" id="6351884">*</span><span class="ident" id="6351885"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="6351896">)</span>&nbsp;<span class="ident" id="6351898">Scan</span><span class="op" id="6351902">(</span><span class="ident" id="6351903">value</span>&nbsp;<span class="keyword" id="6351909">interface</span><span class="op" id="6351918">{</span><span class="op" id="6351919">}</span><span class="op" id="6351920">)</span>&nbsp;<span class="builtintype" id="6351922">error</span>&nbsp;<span class="op" id="6351928">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351931">if</span>&nbsp;<span class="ident" id="6351934"><a href="/database/sql/sql.go.html#6351903">value</a></span>&nbsp;<span class="op" id="6351940">==</span>&nbsp;<span class="ident" id="6351943">nil</span>&nbsp;<span class="op" id="6351947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351951"><a href="/database/sql/sql.go.html#6351882">n</a></span><span class="op" id="6351952">.</span><span class="ident" id="6351953">Float64</span><span class="op" id="6351960">,</span>&nbsp;<span class="ident" id="6351962"><a href="/database/sql/sql.go.html#6351882">n</a></span><span class="op" id="6351963">.</span><span class="ident" id="6351964">Valid</span>&nbsp;<span class="op" id="6351970">=</span>&nbsp;<span class="num" id="6351972">0</span><span class="op" id="6351973">,</span>&nbsp;<span class="builtintype" id="6351975">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351983">return</span>&nbsp;<span class="ident" id="6351990">nil</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351998"><a href="/database/sql/sql.go.html#6351882">n</a></span><span class="op" id="6351999">.</span><span class="ident" id="6352000">Valid</span>&nbsp;<span class="op" id="6352006">=</span>&nbsp;<span class="builtintype" id="6352008">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352014">return</span>&nbsp;<span class="ident" id="6352021"><a href="/database/sql/convert.go.html#6343828">convertAssign</a></span><span class="op" id="6352034">(</span><span class="op" id="6352035">&amp;</span><span class="ident" id="6352036"><a href="/database/sql/sql.go.html#6351882">n</a></span><span class="op" id="6352037">.</span><span class="ident" id="6352038">Float64</span><span class="op" id="6352045">,</span>&nbsp;<span class="ident" id="6352047"><a href="/database/sql/sql.go.html#6351903">value</a></span><span class="op" id="6352052">)</span><br>
<span class="lineno"></span><span class="op" id="6352054">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="6352057">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6352106">func</span>&nbsp;<span class="op" id="6352111">(</span><span class="ident" id="6352112">n</span>&nbsp;<span class="ident" id="6352114"><a href="/database/sql/sql.go.html#6351739">NullFloat64</a></span><span class="op" id="6352125">)</span>&nbsp;<span class="ident" id="6352127">Value</span><span class="op" id="6352132">(</span><span class="op" id="6352133">)</span>&nbsp;<span class="op" id="6352135">(</span><span class="ident" id="6352136"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6352142">.</span><span class="ident" id="6352143">Value</span><span class="op" id="6352148">,</span>&nbsp;<span class="builtintype" id="6352150">error</span><span class="op" id="6352155">)</span>&nbsp;<span class="op" id="6352157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352160">if</span>&nbsp;<span class="op" id="6352163">!</span><span class="ident" id="6352164"><a href="/database/sql/sql.go.html#6352112">n</a></span><span class="op" id="6352165">.</span><span class="ident" id="6352166">Valid</span>&nbsp;<span class="op" id="6352172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352176">return</span>&nbsp;<span class="ident" id="6352183">nil</span><span class="op" id="6352186">,</span>&nbsp;<span class="ident" id="6352188">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352193">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352196">return</span>&nbsp;<span class="ident" id="6352203"><a href="/database/sql/sql.go.html#6352112">n</a></span><span class="op" id="6352204">.</span><span class="ident" id="6352205">Float64</span><span class="op" id="6352212">,</span>&nbsp;<span class="ident" id="6352214">nil</span><br>
<span class="lineno"></span><span class="op" id="6352218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6352221">//&nbsp;NullBool&nbsp;represents&nbsp;a&nbsp;bool&nbsp;that&nbsp;may&nbsp;be&nbsp;null.</span><br>
<span class="lineno"></span><span class="comment" id="6352269">//&nbsp;NullBool&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface&nbsp;so</span><br>
<span class="lineno">150</span><span class="comment" id="6352317">//&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;as&nbsp;a&nbsp;scan&nbsp;destination,&nbsp;similar&nbsp;to&nbsp;NullString.</span><br>
<span class="lineno"></span><span class="keyword" id="6352381">type</span>&nbsp;<span class="ident" id="6352386">NullBool</span>&nbsp;<span class="keyword" id="6352395">struct</span>&nbsp;<span class="op" id="6352402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352405">Bool</span>&nbsp;&nbsp;<span class="builtintype" id="6352411">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352417">Valid</span>&nbsp;<span class="builtintype" id="6352423">bool</span>&nbsp;<span class="comment" id="6352428">//&nbsp;Valid&nbsp;is&nbsp;true&nbsp;if&nbsp;Bool&nbsp;is&nbsp;not&nbsp;NULL</span><br>
<span class="lineno"></span><span class="op" id="6352465">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="comment" id="6352468">//&nbsp;Scan&nbsp;implements&nbsp;the&nbsp;Scanner&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6352510">func</span>&nbsp;<span class="op" id="6352515">(</span><span class="ident" id="6352516">n</span>&nbsp;<span class="op" id="6352518">*</span><span class="ident" id="6352519"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="6352527">)</span>&nbsp;<span class="ident" id="6352529">Scan</span><span class="op" id="6352533">(</span><span class="ident" id="6352534">value</span>&nbsp;<span class="keyword" id="6352540">interface</span><span class="op" id="6352549">{</span><span class="op" id="6352550">}</span><span class="op" id="6352551">)</span>&nbsp;<span class="builtintype" id="6352553">error</span>&nbsp;<span class="op" id="6352559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352562">if</span>&nbsp;<span class="ident" id="6352565"><a href="/database/sql/sql.go.html#6352534">value</a></span>&nbsp;<span class="op" id="6352571">==</span>&nbsp;<span class="ident" id="6352574">nil</span>&nbsp;<span class="op" id="6352578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352582"><a href="/database/sql/sql.go.html#6352516">n</a></span><span class="op" id="6352583">.</span><span class="ident" id="6352584">Bool</span><span class="op" id="6352588">,</span>&nbsp;<span class="ident" id="6352590"><a href="/database/sql/sql.go.html#6352516">n</a></span><span class="op" id="6352591">.</span><span class="ident" id="6352592">Valid</span>&nbsp;<span class="op" id="6352598">=</span>&nbsp;<span class="builtintype" id="6352600">false</span><span class="op" id="6352605">,</span>&nbsp;<span class="builtintype" id="6352607">false</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352615">return</span>&nbsp;<span class="ident" id="6352622">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352630"><a href="/database/sql/sql.go.html#6352516">n</a></span><span class="op" id="6352631">.</span><span class="ident" id="6352632">Valid</span>&nbsp;<span class="op" id="6352638">=</span>&nbsp;<span class="builtintype" id="6352640">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352646">return</span>&nbsp;<span class="ident" id="6352653"><a href="/database/sql/convert.go.html#6343828">convertAssign</a></span><span class="op" id="6352666">(</span><span class="op" id="6352667">&amp;</span><span class="ident" id="6352668"><a href="/database/sql/sql.go.html#6352516">n</a></span><span class="op" id="6352669">.</span><span class="ident" id="6352670">Bool</span><span class="op" id="6352674">,</span>&nbsp;<span class="ident" id="6352676"><a href="/database/sql/sql.go.html#6352534">value</a></span><span class="op" id="6352681">)</span><br>
<span class="lineno"></span><span class="op" id="6352683">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="comment" id="6352686">//&nbsp;Value&nbsp;implements&nbsp;the&nbsp;driver&nbsp;Valuer&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="6352735">func</span>&nbsp;<span class="op" id="6352740">(</span><span class="ident" id="6352741">n</span>&nbsp;<span class="ident" id="6352743"><a href="/database/sql/sql.go.html#6352386">NullBool</a></span><span class="op" id="6352751">)</span>&nbsp;<span class="ident" id="6352753">Value</span><span class="op" id="6352758">(</span><span class="op" id="6352759">)</span>&nbsp;<span class="op" id="6352761">(</span><span class="ident" id="6352762"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6352768">.</span><span class="ident" id="6352769">Value</span><span class="op" id="6352774">,</span>&nbsp;<span class="builtintype" id="6352776">error</span><span class="op" id="6352781">)</span>&nbsp;<span class="op" id="6352783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352786">if</span>&nbsp;<span class="op" id="6352789">!</span><span class="ident" id="6352790"><a href="/database/sql/sql.go.html#6352741">n</a></span><span class="op" id="6352791">.</span><span class="ident" id="6352792">Valid</span>&nbsp;<span class="op" id="6352798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352802">return</span>&nbsp;<span class="ident" id="6352809">nil</span><span class="op" id="6352812">,</span>&nbsp;<span class="ident" id="6352814">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352822">return</span>&nbsp;<span class="ident" id="6352829"><a href="/database/sql/sql.go.html#6352741">n</a></span><span class="op" id="6352830">.</span><span class="ident" id="6352831">Bool</span><span class="op" id="6352835">,</span>&nbsp;<span class="ident" id="6352837">nil</span><br>
<span class="lineno"></span><span class="op" id="6352841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6352844">//&nbsp;Scanner&nbsp;is&nbsp;an&nbsp;interface&nbsp;used&nbsp;by&nbsp;Scan.</span><br>
<span class="lineno">175</span><span class="keyword" id="6352885">type</span>&nbsp;<span class="ident" id="6352890">Scanner</span>&nbsp;<span class="keyword" id="6352898">interface</span>&nbsp;<span class="op" id="6352908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352911">//&nbsp;Scan&nbsp;assigns&nbsp;a&nbsp;value&nbsp;from&nbsp;a&nbsp;database&nbsp;driver.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352960">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352964">//&nbsp;The&nbsp;src&nbsp;value&nbsp;will&nbsp;be&nbsp;of&nbsp;one&nbsp;of&nbsp;the&nbsp;following&nbsp;restricted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353025">//&nbsp;set&nbsp;of&nbsp;types:</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353043">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353047">//&nbsp;&nbsp;&nbsp;&nbsp;int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353060">//&nbsp;&nbsp;&nbsp;&nbsp;float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353075">//&nbsp;&nbsp;&nbsp;&nbsp;bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353087">//&nbsp;&nbsp;&nbsp;&nbsp;[]byte</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353101">//&nbsp;&nbsp;&nbsp;&nbsp;string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353115">//&nbsp;&nbsp;&nbsp;&nbsp;time.Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353132">//&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;-&nbsp;for&nbsp;NULL&nbsp;values</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353161">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353165">//&nbsp;An&nbsp;error&nbsp;should&nbsp;be&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;can&nbsp;not&nbsp;be&nbsp;stored</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6353228">//&nbsp;without&nbsp;loss&nbsp;of&nbsp;information.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6353261">Scan</span><span class="op" id="6353265">(</span><span class="ident" id="6353266">src</span>&nbsp;<span class="keyword" id="6353270">interface</span><span class="op" id="6353279">{</span><span class="op" id="6353280">}</span><span class="op" id="6353281">)</span>&nbsp;<span class="builtintype" id="6353283">error</span><br>
<span class="lineno"></span><span class="op" id="6353289">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6353292">//&nbsp;ErrNoRows&nbsp;is&nbsp;returned&nbsp;by&nbsp;Scan&nbsp;when&nbsp;QueryRow&nbsp;doesn&#39;t&nbsp;return&nbsp;a</span><br>
<span class="lineno">195</span><span class="comment" id="6353356">//&nbsp;row.&nbsp;In&nbsp;such&nbsp;a&nbsp;case,&nbsp;QueryRow&nbsp;returns&nbsp;a&nbsp;placeholder&nbsp;*Row&nbsp;value&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6353427">//&nbsp;defers&nbsp;this&nbsp;error&nbsp;until&nbsp;a&nbsp;Scan.</span><br>
<span class="lineno"></span><span class="keyword" id="6353462">var</span>&nbsp;<span class="ident" id="6353466">ErrNoRows</span>&nbsp;<span class="op" id="6353476">=</span>&nbsp;<span class="ident" id="6353478"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6353484">.</span><span class="ident" id="6353485">New</span><span class="op" id="6353488">(</span><span class="string" id="6353489">&#34;sql:&nbsp;no&nbsp;rows&nbsp;in&nbsp;result&nbsp;set&#34;</span><span class="op" id="6353517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6353520">//&nbsp;DB&nbsp;is&nbsp;a&nbsp;database&nbsp;handle&nbsp;representing&nbsp;a&nbsp;pool&nbsp;of&nbsp;zero&nbsp;or&nbsp;more</span><br>
<span class="lineno">200</span><span class="comment" id="6353583">//&nbsp;underlying&nbsp;connections.&nbsp;It&#39;s&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple</span><br>
<span class="lineno"></span><span class="comment" id="6353651">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="comment" id="6353666">//</span><br>
<span class="lineno"></span><span class="comment" id="6353669">//&nbsp;The&nbsp;sql&nbsp;package&nbsp;creates&nbsp;and&nbsp;frees&nbsp;connections&nbsp;automatically;&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="6353736">//&nbsp;also&nbsp;maintains&nbsp;a&nbsp;free&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;If&nbsp;the&nbsp;database&nbsp;has</span><br>
<span class="lineno">205</span><span class="comment" id="6353807">//&nbsp;a&nbsp;concept&nbsp;of&nbsp;per-connection&nbsp;state,&nbsp;such&nbsp;state&nbsp;can&nbsp;only&nbsp;be&nbsp;reliably</span><br>
<span class="lineno"></span><span class="comment" id="6353877">//&nbsp;observed&nbsp;within&nbsp;a&nbsp;transaction.&nbsp;Once&nbsp;DB.Begin&nbsp;is&nbsp;called,&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6353940">//&nbsp;returned&nbsp;Tx&nbsp;is&nbsp;bound&nbsp;to&nbsp;a&nbsp;single&nbsp;connection.&nbsp;Once&nbsp;Commit&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6354003">//&nbsp;Rollback&nbsp;is&nbsp;called&nbsp;on&nbsp;the&nbsp;transaction,&nbsp;that&nbsp;transaction&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="6354064">//&nbsp;connection&nbsp;is&nbsp;returned&nbsp;to&nbsp;DB&#39;s&nbsp;idle&nbsp;connection&nbsp;pool.&nbsp;The&nbsp;pool&nbsp;size</span><br>
<span class="lineno">210</span><span class="comment" id="6354134">//&nbsp;can&nbsp;be&nbsp;controlled&nbsp;with&nbsp;SetMaxIdleConns.</span><br>
<span class="lineno"></span><span class="keyword" id="6354177">type</span>&nbsp;<span class="ident" id="6354182">DB</span>&nbsp;<span class="keyword" id="6354185">struct</span>&nbsp;<span class="op" id="6354192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354195">driver</span>&nbsp;<span class="ident" id="6354202"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6354208">.</span><span class="ident" id="6354209">Driver</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354217">dsn</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6354224">string</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354233">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6354246"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6354250">.</span><span class="ident" id="6354251">Mutex</span>&nbsp;<span class="comment" id="6354257">//&nbsp;protects&nbsp;following&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354287">freeConn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6354300">[</span><span class="op" id="6354301">]</span><span class="op" id="6354302">*</span><span class="ident" id="6354303"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354315">connRequests</span>&nbsp;<span class="op" id="6354328">[</span><span class="op" id="6354329">]</span><span class="keyword" id="6354330">chan</span>&nbsp;<span class="ident" id="6354335"><a href="/database/sql/sql.go.html#6365285">connRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354348">numOpen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6354361">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354366">pendingOpens</span>&nbsp;<span class="builtintype" id="6354379">int</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6354384">//&nbsp;Used&nbsp;to&nbsp;signal&nbsp;the&nbsp;need&nbsp;for&nbsp;new&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6354432">//&nbsp;a&nbsp;goroutine&nbsp;running&nbsp;connectionOpener()&nbsp;reads&nbsp;on&nbsp;this&nbsp;chan&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6354498">//&nbsp;maybeOpenNewConnections&nbsp;sends&nbsp;on&nbsp;the&nbsp;chan&nbsp;(one&nbsp;send&nbsp;per&nbsp;needed&nbsp;connection)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6354577">//&nbsp;It&nbsp;is&nbsp;closed&nbsp;during&nbsp;db.Close().&nbsp;The&nbsp;close&nbsp;tells&nbsp;the&nbsp;connectionOpener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6354650">//&nbsp;goroutine&nbsp;to&nbsp;exit.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354673">openerCh</span>&nbsp;<span class="keyword" id="6354682">chan</span>&nbsp;<span class="keyword" id="6354687">struct</span><span class="op" id="6354693">{</span><span class="op" id="6354694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354697">closed</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6354706">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354712">dep</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6354721">map</span><span class="op" id="6354724">[</span><span class="ident" id="6354725"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6354736">]</span><span class="ident" id="6354737"><a href="/database/sql/sql.go.html#6357891">depSet</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354745">lastPut</span>&nbsp;&nbsp;<span class="keyword" id="6354754">map</span><span class="op" id="6354757">[</span><span class="op" id="6354758">*</span><span class="ident" id="6354759"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6354769">]</span><span class="builtintype" id="6354770">string</span>&nbsp;<span class="comment" id="6354777">//&nbsp;stacktrace&nbsp;of&nbsp;last&nbsp;conn&#39;s&nbsp;put;&nbsp;debug&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354823">maxIdle</span>&nbsp;&nbsp;<span class="builtintype" id="6354832">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6354855">//&nbsp;zero&nbsp;means&nbsp;defaultMaxIdleConns;&nbsp;negative&nbsp;means&nbsp;0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6354908">maxOpen</span>&nbsp;&nbsp;<span class="builtintype" id="6354917">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6354940">//&nbsp;&lt;=&nbsp;0&nbsp;means&nbsp;unlimited</span><br>
<span class="lineno"></span><span class="op" id="6354964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6354967">//&nbsp;driverConn&nbsp;wraps&nbsp;a&nbsp;driver.Conn&nbsp;with&nbsp;a&nbsp;mutex,&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6355018">//&nbsp;be&nbsp;held&nbsp;during&nbsp;all&nbsp;calls&nbsp;into&nbsp;the&nbsp;Conn.&nbsp;(including&nbsp;any&nbsp;calls&nbsp;onto</span><br>
<span class="lineno">235</span><span class="comment" id="6355087">//&nbsp;interfaces&nbsp;returned&nbsp;via&nbsp;that&nbsp;Conn,&nbsp;such&nbsp;as&nbsp;calls&nbsp;on&nbsp;Tx,&nbsp;Stmt,</span><br>
<span class="lineno"></span><span class="comment" id="6355152">//&nbsp;Result,&nbsp;Rows)</span><br>
<span class="lineno"></span><span class="keyword" id="6355169">type</span>&nbsp;<span class="ident" id="6355174">driverConn</span>&nbsp;<span class="keyword" id="6355185">struct</span>&nbsp;<span class="op" id="6355192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355195">db</span>&nbsp;<span class="op" id="6355198">*</span><span class="ident" id="6355199"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355204"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6355208">.</span><span class="ident" id="6355209">Mutex</span>&nbsp;&nbsp;<span class="comment" id="6355216">//&nbsp;guards&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355237">ci</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6355249"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6355255">.</span><span class="ident" id="6355256">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355262">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355274">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355280">finalClosed</span>&nbsp;<span class="builtintype" id="6355292">bool</span>&nbsp;<span class="comment" id="6355297">//&nbsp;ci.Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355326">openStmt</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6355338">map</span><span class="op" id="6355341">[</span><span class="ident" id="6355342"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6355348">.</span><span class="ident" id="6355349">Stmt</span><span class="op" id="6355353">]</span><span class="builtintype" id="6355354">bool</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355361">//&nbsp;guarded&nbsp;by&nbsp;db.mu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355382">inUse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6355393">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355399">onPut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6355410">[</span><span class="op" id="6355411">]</span><span class="keyword" id="6355412">func</span><span class="op" id="6355416">(</span><span class="op" id="6355417">)</span>&nbsp;<span class="comment" id="6355419">//&nbsp;code&nbsp;(with&nbsp;db.mu&nbsp;held)&nbsp;run&nbsp;when&nbsp;conn&nbsp;is&nbsp;next&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355477">dbmuClosed</span>&nbsp;<span class="builtintype" id="6355488">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6355497">//&nbsp;same&nbsp;as&nbsp;closed,&nbsp;but&nbsp;guarded&nbsp;by&nbsp;db.mu,&nbsp;for&nbsp;connIfFree</span><br>
<span class="lineno">250</span><span class="op" id="6355553">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6355556">func</span>&nbsp;<span class="op" id="6355561">(</span><span class="ident" id="6355562">dc</span>&nbsp;<span class="op" id="6355565">*</span><span class="ident" id="6355566"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6355576">)</span>&nbsp;<span class="ident" id="6355578">releaseConn</span><span class="op" id="6355589">(</span><span class="ident" id="6355590">err</span>&nbsp;<span class="builtintype" id="6355594">error</span><span class="op" id="6355599">)</span>&nbsp;<span class="op" id="6355601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355604"><a href="/database/sql/sql.go.html#6355562">dc</a></span><span class="op" id="6355606">.</span><span class="ident" id="6355607">db</span><span class="op" id="6355609">.</span><span class="ident" id="6355610">putConn</span><span class="op" id="6355617">(</span><span class="ident" id="6355618"><a href="/database/sql/sql.go.html#6355562">dc</a></span><span class="op" id="6355620">,</span>&nbsp;<span class="ident" id="6355622"><a href="/database/sql/sql.go.html#6355590">err</a></span><span class="op" id="6355625">)</span><br>
<span class="lineno"></span><span class="op" id="6355627">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6355630">func</span>&nbsp;<span class="op" id="6355635">(</span><span class="ident" id="6355636">dc</span>&nbsp;<span class="op" id="6355639">*</span><span class="ident" id="6355640"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6355650">)</span>&nbsp;<span class="ident" id="6355652">removeOpenStmt</span><span class="op" id="6355666">(</span><span class="ident" id="6355667">si</span>&nbsp;<span class="ident" id="6355670"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6355676">.</span><span class="ident" id="6355677">Stmt</span><span class="op" id="6355681">)</span>&nbsp;<span class="op" id="6355683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355686"><a href="/database/sql/sql.go.html#6355636">dc</a></span><span class="op" id="6355688">.</span><span class="ident" id="6355689">Lock</span><span class="op" id="6355693">(</span><span class="op" id="6355694">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355697">defer</span>&nbsp;<span class="ident" id="6355703"><a href="/database/sql/sql.go.html#6355636">dc</a></span><span class="op" id="6355705">.</span><span class="ident" id="6355706">Unlock</span><span class="op" id="6355712">(</span><span class="op" id="6355713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6355716">delete</span><span class="op" id="6355722">(</span><span class="ident" id="6355723"><a href="/database/sql/sql.go.html#6355636">dc</a></span><span class="op" id="6355725">.</span><span class="ident" id="6355726">openStmt</span><span class="op" id="6355734">,</span>&nbsp;<span class="ident" id="6355736"><a href="/database/sql/sql.go.html#6355667">si</a></span><span class="op" id="6355738">)</span><br>
<span class="lineno">260</span><span class="op" id="6355740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6355743">func</span>&nbsp;<span class="op" id="6355748">(</span><span class="ident" id="6355749">dc</span>&nbsp;<span class="op" id="6355752">*</span><span class="ident" id="6355753"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6355763">)</span>&nbsp;<span class="ident" id="6355765">prepareLocked</span><span class="op" id="6355778">(</span><span class="ident" id="6355779">query</span>&nbsp;<span class="builtintype" id="6355785">string</span><span class="op" id="6355791">)</span>&nbsp;<span class="op" id="6355793">(</span><span class="ident" id="6355794"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6355800">.</span><span class="ident" id="6355801">Stmt</span><span class="op" id="6355805">,</span>&nbsp;<span class="builtintype" id="6355807">error</span><span class="op" id="6355812">)</span>&nbsp;<span class="op" id="6355814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6355817">si</span><span class="op" id="6355819">,</span>&nbsp;<span class="ident" id="6355821">err</span>&nbsp;<span class="op" id="6355825">:=</span>&nbsp;<span class="ident" id="6355828"><a href="/database/sql/sql.go.html#6355749">dc</a></span><span class="op" id="6355830">.</span><span class="ident" id="6355831">ci</span><span class="op" id="6355833">.</span><span class="ident" id="6355834">Prepare</span><span class="op" id="6355841">(</span><span class="ident" id="6355842"><a href="/database/sql/sql.go.html#6355779">query</a></span><span class="op" id="6355847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6355850">if</span>&nbsp;<span class="ident" id="6355853"><a href="/database/sql/sql.go.html#6355821">err</a></span>&nbsp;<span class="op" id="6355857">==</span>&nbsp;<span class="ident" id="6355860">nil</span>&nbsp;<span class="op" id="6355864">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355868">//&nbsp;Track&nbsp;each&nbsp;driverConn&#39;s&nbsp;open&nbsp;statements,&nbsp;so&nbsp;we&nbsp;can&nbsp;close&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355935">//&nbsp;before&nbsp;closing&nbsp;the&nbsp;conn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355965">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6355970">//&nbsp;TODO(bradfitz):&nbsp;let&nbsp;drivers&nbsp;opt&nbsp;out&nbsp;of&nbsp;caring&nbsp;about</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356027">//&nbsp;stmt&nbsp;closes&nbsp;if&nbsp;the&nbsp;conn&nbsp;is&nbsp;about&nbsp;to&nbsp;close&nbsp;anyway?&nbsp;For&nbsp;now</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356090">//&nbsp;do&nbsp;the&nbsp;safe&nbsp;thing,&nbsp;in&nbsp;case&nbsp;stmts&nbsp;need&nbsp;to&nbsp;be&nbsp;closed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356147">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356152">//&nbsp;TODO(bradfitz):&nbsp;after&nbsp;Go&nbsp;1.2,&nbsp;closing&nbsp;driver.Stmts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356208">//&nbsp;should&nbsp;be&nbsp;moved&nbsp;to&nbsp;driverStmt,&nbsp;using&nbsp;unique</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356257">//&nbsp;*driverStmts&nbsp;everywhere&nbsp;(including&nbsp;from</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356302">//&nbsp;*Stmt.connStmt,&nbsp;instead&nbsp;of&nbsp;returning&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356346">//&nbsp;driver.Stmt),&nbsp;using&nbsp;driverStmt&nbsp;as&nbsp;a&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6356395">//&nbsp;everywhere,&nbsp;and&nbsp;making&nbsp;it&nbsp;a&nbsp;finalCloser.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356441">if</span>&nbsp;<span class="ident" id="6356444"><a href="/database/sql/sql.go.html#6355749">dc</a></span><span class="op" id="6356446">.</span><span class="ident" id="6356447">openStmt</span>&nbsp;<span class="op" id="6356456">==</span>&nbsp;<span class="ident" id="6356459">nil</span>&nbsp;<span class="op" id="6356463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356468"><a href="/database/sql/sql.go.html#6355749">dc</a></span><span class="op" id="6356470">.</span><span class="ident" id="6356471">openStmt</span>&nbsp;<span class="op" id="6356480">=</span>&nbsp;<span class="builtinfunc" id="6356482">make</span><span class="op" id="6356486">(</span><span class="keyword" id="6356487">map</span><span class="op" id="6356490">[</span><span class="ident" id="6356491"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6356497">.</span><span class="ident" id="6356498">Stmt</span><span class="op" id="6356502">]</span><span class="builtintype" id="6356503">bool</span><span class="op" id="6356507">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356511">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356515"><a href="/database/sql/sql.go.html#6355749">dc</a></span><span class="op" id="6356517">.</span><span class="ident" id="6356518">openStmt</span><span class="op" id="6356526">[</span><span class="ident" id="6356527"><a href="/database/sql/sql.go.html#6355817">si</a></span><span class="op" id="6356529">]</span>&nbsp;<span class="op" id="6356531">=</span>&nbsp;<span class="builtintype" id="6356533">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356539">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356542">return</span>&nbsp;<span class="ident" id="6356549"><a href="/database/sql/sql.go.html#6355817">si</a></span><span class="op" id="6356551">,</span>&nbsp;<span class="ident" id="6356553"><a href="/database/sql/sql.go.html#6355821">err</a></span><br>
<span class="lineno"></span><span class="op" id="6356557">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="comment" id="6356560">//&nbsp;the&nbsp;dc.db&#39;s&nbsp;Mutex&nbsp;is&nbsp;held.</span><br>
<span class="lineno"></span><span class="keyword" id="6356590">func</span>&nbsp;<span class="op" id="6356595">(</span><span class="ident" id="6356596">dc</span>&nbsp;<span class="op" id="6356599">*</span><span class="ident" id="6356600"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6356610">)</span>&nbsp;<span class="ident" id="6356612">closeDBLocked</span><span class="op" id="6356625">(</span><span class="op" id="6356626">)</span>&nbsp;<span class="keyword" id="6356628">func</span><span class="op" id="6356632">(</span><span class="op" id="6356633">)</span>&nbsp;<span class="builtintype" id="6356635">error</span>&nbsp;<span class="op" id="6356641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356644"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356646">.</span><span class="ident" id="6356647">Lock</span><span class="op" id="6356651">(</span><span class="op" id="6356652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356655">defer</span>&nbsp;<span class="ident" id="6356661"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356663">.</span><span class="ident" id="6356664">Unlock</span><span class="op" id="6356670">(</span><span class="op" id="6356671">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356674">if</span>&nbsp;<span class="ident" id="6356677"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356679">.</span><span class="ident" id="6356680">closed</span>&nbsp;<span class="op" id="6356687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356691">return</span>&nbsp;<span class="keyword" id="6356698">func</span><span class="op" id="6356702">(</span><span class="op" id="6356703">)</span>&nbsp;<span class="builtintype" id="6356705">error</span>&nbsp;<span class="op" id="6356711">{</span>&nbsp;<span class="keyword" id="6356713">return</span>&nbsp;<span class="ident" id="6356720"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6356726">.</span><span class="ident" id="6356727">New</span><span class="op" id="6356730">(</span><span class="string" id="6356731">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="6356764">)</span>&nbsp;<span class="op" id="6356766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356772"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356774">.</span><span class="ident" id="6356775">closed</span>&nbsp;<span class="op" id="6356782">=</span>&nbsp;<span class="builtintype" id="6356784">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356790">return</span>&nbsp;<span class="ident" id="6356797"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356799">.</span><span class="ident" id="6356800">db</span><span class="op" id="6356802">.</span><span class="ident" id="6356803">removeDepLocked</span><span class="op" id="6356818">(</span><span class="ident" id="6356819"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356821">,</span>&nbsp;<span class="ident" id="6356823"><a href="/database/sql/sql.go.html#6356596">dc</a></span><span class="op" id="6356825">)</span><br>
<span class="lineno">295</span><span class="op" id="6356827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6356830">func</span>&nbsp;<span class="op" id="6356835">(</span><span class="ident" id="6356836">dc</span>&nbsp;<span class="op" id="6356839">*</span><span class="ident" id="6356840"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6356850">)</span>&nbsp;<span class="ident" id="6356852">Close</span><span class="op" id="6356857">(</span><span class="op" id="6356858">)</span>&nbsp;<span class="builtintype" id="6356860">error</span>&nbsp;<span class="op" id="6356866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356869"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6356871">.</span><span class="ident" id="6356872">Lock</span><span class="op" id="6356876">(</span><span class="op" id="6356877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356880">if</span>&nbsp;<span class="ident" id="6356883"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6356885">.</span><span class="ident" id="6356886">closed</span>&nbsp;<span class="op" id="6356893">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356897"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6356899">.</span><span class="ident" id="6356900">Unlock</span><span class="op" id="6356906">(</span><span class="op" id="6356907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6356911">return</span>&nbsp;<span class="ident" id="6356918"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6356924">.</span><span class="ident" id="6356925">New</span><span class="op" id="6356928">(</span><span class="string" id="6356929">&#34;sql:&nbsp;duplicate&nbsp;driverConn&nbsp;close&#34;</span><span class="op" id="6356962">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6356965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356968"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6356970">.</span><span class="ident" id="6356971">closed</span>&nbsp;<span class="op" id="6356978">=</span>&nbsp;<span class="builtintype" id="6356980">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6356986"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6356988">.</span><span class="ident" id="6356989">Unlock</span><span class="op" id="6356995">(</span><span class="op" id="6356996">)</span>&nbsp;<span class="comment" id="6356998">//&nbsp;not&nbsp;defer;&nbsp;removeDep&nbsp;finalClose&nbsp;calls&nbsp;may&nbsp;need&nbsp;to&nbsp;lock</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6357058">//&nbsp;And&nbsp;now&nbsp;updates&nbsp;that&nbsp;require&nbsp;holding&nbsp;dc.mu.Lock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357111"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357113">.</span><span class="ident" id="6357114">db</span><span class="op" id="6357116">.</span><span class="ident" id="6357117">mu</span><span class="op" id="6357119">.</span><span class="ident" id="6357120">Lock</span><span class="op" id="6357124">(</span><span class="op" id="6357125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357128"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357130">.</span><span class="ident" id="6357131">dbmuClosed</span>&nbsp;<span class="op" id="6357142">=</span>&nbsp;<span class="builtintype" id="6357144">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357150">fn</span>&nbsp;<span class="op" id="6357153">:=</span>&nbsp;<span class="ident" id="6357156"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357158">.</span><span class="ident" id="6357159">db</span><span class="op" id="6357161">.</span><span class="ident" id="6357162">removeDepLocked</span><span class="op" id="6357177">(</span><span class="ident" id="6357178"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357180">,</span>&nbsp;<span class="ident" id="6357182"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357184">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357187"><a href="/database/sql/sql.go.html#6356836">dc</a></span><span class="op" id="6357189">.</span><span class="ident" id="6357190">db</span><span class="op" id="6357192">.</span><span class="ident" id="6357193">mu</span><span class="op" id="6357195">.</span><span class="ident" id="6357196">Unlock</span><span class="op" id="6357202">(</span><span class="op" id="6357203">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357206">return</span>&nbsp;<span class="ident" id="6357213"><a href="/database/sql/sql.go.html#6357150">fn</a></span><span class="op" id="6357215">(</span><span class="op" id="6357216">)</span><br>
<span class="lineno"></span><span class="op" id="6357218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6357221">func</span>&nbsp;<span class="op" id="6357226">(</span><span class="ident" id="6357227">dc</span>&nbsp;<span class="op" id="6357230">*</span><span class="ident" id="6357231"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6357241">)</span>&nbsp;<span class="ident" id="6357243">finalClose</span><span class="op" id="6357253">(</span><span class="op" id="6357254">)</span>&nbsp;<span class="builtintype" id="6357256">error</span>&nbsp;<span class="op" id="6357262">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357265"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357267">.</span><span class="ident" id="6357268">Lock</span><span class="op" id="6357272">(</span><span class="op" id="6357273">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357277">for</span>&nbsp;<span class="ident" id="6357281">si</span>&nbsp;<span class="op" id="6357284">:=</span>&nbsp;<span class="keyword" id="6357287">range</span>&nbsp;<span class="ident" id="6357293"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357295">.</span><span class="ident" id="6357296">openStmt</span>&nbsp;<span class="op" id="6357305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357309"><a href="/database/sql/sql.go.html#6357281">si</a></span><span class="op" id="6357311">.</span><span class="ident" id="6357312">Close</span><span class="op" id="6357317">(</span><span class="op" id="6357318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6357321">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357324"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357326">.</span><span class="ident" id="6357327">openStmt</span>&nbsp;<span class="op" id="6357336">=</span>&nbsp;<span class="ident" id="6357338">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357344">err</span>&nbsp;<span class="op" id="6357348">:=</span>&nbsp;<span class="ident" id="6357351"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357353">.</span><span class="ident" id="6357354">ci</span><span class="op" id="6357356">.</span><span class="ident" id="6357357">Close</span><span class="op" id="6357362">(</span><span class="op" id="6357363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357366"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357368">.</span><span class="ident" id="6357369">ci</span>&nbsp;<span class="op" id="6357372">=</span>&nbsp;<span class="ident" id="6357374">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357379"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357381">.</span><span class="ident" id="6357382">finalClosed</span>&nbsp;<span class="op" id="6357394">=</span>&nbsp;<span class="builtintype" id="6357396">true</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357402"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357404">.</span><span class="ident" id="6357405">Unlock</span><span class="op" id="6357411">(</span><span class="op" id="6357412">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357416"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357418">.</span><span class="ident" id="6357419">db</span><span class="op" id="6357421">.</span><span class="ident" id="6357422">mu</span><span class="op" id="6357424">.</span><span class="ident" id="6357425">Lock</span><span class="op" id="6357429">(</span><span class="op" id="6357430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357433"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357435">.</span><span class="ident" id="6357436">db</span><span class="op" id="6357438">.</span><span class="ident" id="6357439">numOpen</span><span class="op" id="6357446">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357450"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357452">.</span><span class="ident" id="6357453">db</span><span class="op" id="6357455">.</span><span class="ident" id="6357456">maybeOpenNewConnections</span><span class="op" id="6357479">(</span><span class="op" id="6357480">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357483"><a href="/database/sql/sql.go.html#6357227">dc</a></span><span class="op" id="6357485">.</span><span class="ident" id="6357486">db</span><span class="op" id="6357488">.</span><span class="ident" id="6357489">mu</span><span class="op" id="6357491">.</span><span class="ident" id="6357492">Unlock</span><span class="op" id="6357498">(</span><span class="op" id="6357499">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357503">return</span>&nbsp;<span class="ident" id="6357510"><a href="/database/sql/sql.go.html#6357344">err</a></span><br>
<span class="lineno"></span><span class="op" id="6357514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="comment" id="6357517">//&nbsp;driverStmt&nbsp;associates&nbsp;a&nbsp;driver.Stmt&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6357565">//&nbsp;*driverConn&nbsp;from&nbsp;which&nbsp;it&nbsp;came,&nbsp;so&nbsp;the&nbsp;driverConn&#39;s&nbsp;lock&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6357632">//&nbsp;held&nbsp;during&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6357654">type</span>&nbsp;<span class="ident" id="6357659">driverStmt</span>&nbsp;<span class="keyword" id="6357670">struct</span>&nbsp;<span class="op" id="6357677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357680"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6357684">.</span><span class="ident" id="6357685">Locker</span>&nbsp;<span class="comment" id="6357692">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357712">si</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6357724"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6357730">.</span><span class="ident" id="6357731">Stmt</span><br>
<span class="lineno"></span><span class="op" id="6357736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6357739">func</span>&nbsp;<span class="op" id="6357744">(</span><span class="ident" id="6357745">ds</span>&nbsp;<span class="op" id="6357748">*</span><span class="ident" id="6357749"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6357759">)</span>&nbsp;<span class="ident" id="6357761">Close</span><span class="op" id="6357766">(</span><span class="op" id="6357767">)</span>&nbsp;<span class="builtintype" id="6357769">error</span>&nbsp;<span class="op" id="6357775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6357778"><a href="/database/sql/sql.go.html#6357745">ds</a></span><span class="op" id="6357780">.</span><span class="ident" id="6357781">Lock</span><span class="op" id="6357785">(</span><span class="op" id="6357786">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357789">defer</span>&nbsp;<span class="ident" id="6357795"><a href="/database/sql/sql.go.html#6357745">ds</a></span><span class="op" id="6357797">.</span><span class="ident" id="6357798">Unlock</span><span class="op" id="6357804">(</span><span class="op" id="6357805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6357808">return</span>&nbsp;<span class="ident" id="6357815"><a href="/database/sql/sql.go.html#6357745">ds</a></span><span class="op" id="6357817">.</span><span class="ident" id="6357818">si</span><span class="op" id="6357820">.</span><span class="ident" id="6357821">Close</span><span class="op" id="6357826">(</span><span class="op" id="6357827">)</span><br>
<span class="lineno"></span><span class="op" id="6357829">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6357832">//&nbsp;depSet&nbsp;is&nbsp;a&nbsp;finalCloser&#39;s&nbsp;outstanding&nbsp;dependencies</span><br>
<span class="lineno">350</span><span class="keyword" id="6357886">type</span>&nbsp;<span class="ident" id="6357891">depSet</span>&nbsp;<span class="keyword" id="6357898">map</span><span class="op" id="6357901">[</span><span class="keyword" id="6357902">interface</span><span class="op" id="6357911">{</span><span class="op" id="6357912">}</span><span class="op" id="6357913">]</span><span class="builtintype" id="6357914">bool</span>&nbsp;<span class="comment" id="6357919">//&nbsp;set&nbsp;of&nbsp;true&nbsp;bools</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6357941">//&nbsp;The&nbsp;finalCloser&nbsp;interface&nbsp;is&nbsp;used&nbsp;by&nbsp;(*DB).addDep&nbsp;and&nbsp;related</span><br>
<span class="lineno"></span><span class="comment" id="6358006">//&nbsp;dependency&nbsp;reference&nbsp;counting.</span><br>
<span class="lineno"></span><span class="keyword" id="6358040">type</span>&nbsp;<span class="ident" id="6358045">finalCloser</span>&nbsp;<span class="keyword" id="6358057">interface</span>&nbsp;<span class="op" id="6358067">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358070">//&nbsp;finalClose&nbsp;is&nbsp;called&nbsp;when&nbsp;the&nbsp;reference&nbsp;count&nbsp;of&nbsp;an&nbsp;object</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358133">//&nbsp;goes&nbsp;to&nbsp;zero.&nbsp;(*DB).mu&nbsp;is&nbsp;not&nbsp;held&nbsp;while&nbsp;calling&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358190">finalClose</span><span class="op" id="6358200">(</span><span class="op" id="6358201">)</span>&nbsp;<span class="builtintype" id="6358203">error</span><br>
<span class="lineno"></span><span class="op" id="6358209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">360</span><span class="comment" id="6358212">//&nbsp;addDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;now&nbsp;depends&nbsp;on&nbsp;dep,&nbsp;and&nbsp;x&#39;s&nbsp;finalClose&nbsp;won&#39;t&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6358283">//&nbsp;called&nbsp;until&nbsp;all&nbsp;of&nbsp;x&#39;s&nbsp;dependencies&nbsp;are&nbsp;removed&nbsp;with&nbsp;removeDep.</span><br>
<span class="lineno"></span><span class="keyword" id="6358351">func</span>&nbsp;<span class="op" id="6358356">(</span><span class="ident" id="6358357">db</span>&nbsp;<span class="op" id="6358360">*</span><span class="ident" id="6358361"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6358363">)</span>&nbsp;<span class="ident" id="6358365">addDep</span><span class="op" id="6358371">(</span><span class="ident" id="6358372">x</span>&nbsp;<span class="ident" id="6358374"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6358385">,</span>&nbsp;<span class="ident" id="6358387">dep</span>&nbsp;<span class="keyword" id="6358391">interface</span><span class="op" id="6358400">{</span><span class="op" id="6358401">}</span><span class="op" id="6358402">)</span>&nbsp;<span class="op" id="6358404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6358407">//println(fmt.Sprintf(&#34;addDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358471"><a href="/database/sql/sql.go.html#6358357">db</a></span><span class="op" id="6358473">.</span><span class="ident" id="6358474">mu</span><span class="op" id="6358476">.</span><span class="ident" id="6358477">Lock</span><span class="op" id="6358481">(</span><span class="op" id="6358482">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358485">defer</span>&nbsp;<span class="ident" id="6358491"><a href="/database/sql/sql.go.html#6358357">db</a></span><span class="op" id="6358493">.</span><span class="ident" id="6358494">mu</span><span class="op" id="6358496">.</span><span class="ident" id="6358497">Unlock</span><span class="op" id="6358503">(</span><span class="op" id="6358504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358507"><a href="/database/sql/sql.go.html#6358357">db</a></span><span class="op" id="6358509">.</span><span class="ident" id="6358510">addDepLocked</span><span class="op" id="6358522">(</span><span class="ident" id="6358523"><a href="/database/sql/sql.go.html#6358372">x</a></span><span class="op" id="6358524">,</span>&nbsp;<span class="ident" id="6358526"><a href="/database/sql/sql.go.html#6358387">dep</a></span><span class="op" id="6358529">)</span><br>
<span class="lineno"></span><span class="op" id="6358531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6358534">func</span>&nbsp;<span class="op" id="6358539">(</span><span class="ident" id="6358540">db</span>&nbsp;<span class="op" id="6358543">*</span><span class="ident" id="6358544"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6358546">)</span>&nbsp;<span class="ident" id="6358548">addDepLocked</span><span class="op" id="6358560">(</span><span class="ident" id="6358561">x</span>&nbsp;<span class="ident" id="6358563"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6358574">,</span>&nbsp;<span class="ident" id="6358576">dep</span>&nbsp;<span class="keyword" id="6358580">interface</span><span class="op" id="6358589">{</span><span class="op" id="6358590">}</span><span class="op" id="6358591">)</span>&nbsp;<span class="op" id="6358593">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358596">if</span>&nbsp;<span class="ident" id="6358599"><a href="/database/sql/sql.go.html#6358540">db</a></span><span class="op" id="6358601">.</span><span class="ident" id="6358602">dep</span>&nbsp;<span class="op" id="6358606">==</span>&nbsp;<span class="ident" id="6358609">nil</span>&nbsp;<span class="op" id="6358613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358617"><a href="/database/sql/sql.go.html#6358540">db</a></span><span class="op" id="6358619">.</span><span class="ident" id="6358620">dep</span>&nbsp;<span class="op" id="6358624">=</span>&nbsp;<span class="builtinfunc" id="6358626">make</span><span class="op" id="6358630">(</span><span class="keyword" id="6358631">map</span><span class="op" id="6358634">[</span><span class="ident" id="6358635"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6358646">]</span><span class="ident" id="6358647"><a href="/database/sql/sql.go.html#6357891">depSet</a></span><span class="op" id="6358653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358659">xdep</span>&nbsp;<span class="op" id="6358664">:=</span>&nbsp;<span class="ident" id="6358667"><a href="/database/sql/sql.go.html#6358540">db</a></span><span class="op" id="6358669">.</span><span class="ident" id="6358670">dep</span><span class="op" id="6358673">[</span><span class="ident" id="6358674"><a href="/database/sql/sql.go.html#6358561">x</a></span><span class="op" id="6358675">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6358678">if</span>&nbsp;<span class="ident" id="6358681"><a href="/database/sql/sql.go.html#6358659">xdep</a></span>&nbsp;<span class="op" id="6358686">==</span>&nbsp;<span class="ident" id="6358689">nil</span>&nbsp;<span class="op" id="6358693">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358697"><a href="/database/sql/sql.go.html#6358659">xdep</a></span>&nbsp;<span class="op" id="6358702">=</span>&nbsp;<span class="builtinfunc" id="6358704">make</span><span class="op" id="6358708">(</span><span class="ident" id="6358709"><a href="/database/sql/sql.go.html#6357891">depSet</a></span><span class="op" id="6358715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358719"><a href="/database/sql/sql.go.html#6358540">db</a></span><span class="op" id="6358721">.</span><span class="ident" id="6358722">dep</span><span class="op" id="6358725">[</span><span class="ident" id="6358726"><a href="/database/sql/sql.go.html#6358561">x</a></span><span class="op" id="6358727">]</span>&nbsp;<span class="op" id="6358729">=</span>&nbsp;<span class="ident" id="6358731"><a href="/database/sql/sql.go.html#6358659">xdep</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6358737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6358740"><a href="/database/sql/sql.go.html#6358659">xdep</a></span><span class="op" id="6358744">[</span><span class="ident" id="6358745"><a href="/database/sql/sql.go.html#6358576">dep</a></span><span class="op" id="6358748">]</span>&nbsp;<span class="op" id="6358750">=</span>&nbsp;<span class="builtintype" id="6358752">true</span><br>
<span class="lineno"></span><span class="op" id="6358757">}</span><br>
<span class="lineno">380</span><br>
<span class="lineno"></span><span class="comment" id="6358760">//&nbsp;removeDep&nbsp;notes&nbsp;that&nbsp;x&nbsp;no&nbsp;longer&nbsp;depends&nbsp;on&nbsp;dep.</span><br>
<span class="lineno"></span><span class="comment" id="6358812">//&nbsp;If&nbsp;x&nbsp;still&nbsp;has&nbsp;dependencies,&nbsp;nil&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="6358861">//&nbsp;If&nbsp;x&nbsp;no&nbsp;longer&nbsp;has&nbsp;any&nbsp;dependencies,&nbsp;its&nbsp;finalClose&nbsp;method&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6358931">//&nbsp;called&nbsp;and&nbsp;its&nbsp;error&nbsp;value&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno">385</span><span class="keyword" id="6358979">func</span>&nbsp;<span class="op" id="6358984">(</span><span class="ident" id="6358985">db</span>&nbsp;<span class="op" id="6358988">*</span><span class="ident" id="6358989"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6358991">)</span>&nbsp;<span class="ident" id="6358993">removeDep</span><span class="op" id="6359002">(</span><span class="ident" id="6359003">x</span>&nbsp;<span class="ident" id="6359005"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6359016">,</span>&nbsp;<span class="ident" id="6359018">dep</span>&nbsp;<span class="keyword" id="6359022">interface</span><span class="op" id="6359031">{</span><span class="op" id="6359032">}</span><span class="op" id="6359033">)</span>&nbsp;<span class="builtintype" id="6359035">error</span>&nbsp;<span class="op" id="6359041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359044"><a href="/database/sql/sql.go.html#6358985">db</a></span><span class="op" id="6359046">.</span><span class="ident" id="6359047">mu</span><span class="op" id="6359049">.</span><span class="ident" id="6359050">Lock</span><span class="op" id="6359054">(</span><span class="op" id="6359055">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359058">fn</span>&nbsp;<span class="op" id="6359061">:=</span>&nbsp;<span class="ident" id="6359064"><a href="/database/sql/sql.go.html#6358985">db</a></span><span class="op" id="6359066">.</span><span class="ident" id="6359067">removeDepLocked</span><span class="op" id="6359082">(</span><span class="ident" id="6359083"><a href="/database/sql/sql.go.html#6359003">x</a></span><span class="op" id="6359084">,</span>&nbsp;<span class="ident" id="6359086"><a href="/database/sql/sql.go.html#6359018">dep</a></span><span class="op" id="6359089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359092"><a href="/database/sql/sql.go.html#6358985">db</a></span><span class="op" id="6359094">.</span><span class="ident" id="6359095">mu</span><span class="op" id="6359097">.</span><span class="ident" id="6359098">Unlock</span><span class="op" id="6359104">(</span><span class="op" id="6359105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359108">return</span>&nbsp;<span class="ident" id="6359115"><a href="/database/sql/sql.go.html#6359058">fn</a></span><span class="op" id="6359117">(</span><span class="op" id="6359118">)</span><br>
<span class="lineno">390</span><span class="op" id="6359120">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6359123">func</span>&nbsp;<span class="op" id="6359128">(</span><span class="ident" id="6359129">db</span>&nbsp;<span class="op" id="6359132">*</span><span class="ident" id="6359133"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6359135">)</span>&nbsp;<span class="ident" id="6359137">removeDepLocked</span><span class="op" id="6359152">(</span><span class="ident" id="6359153">x</span>&nbsp;<span class="ident" id="6359155"><a href="/database/sql/sql.go.html#6358045">finalCloser</a></span><span class="op" id="6359166">,</span>&nbsp;<span class="ident" id="6359168">dep</span>&nbsp;<span class="keyword" id="6359172">interface</span><span class="op" id="6359181">{</span><span class="op" id="6359182">}</span><span class="op" id="6359183">)</span>&nbsp;<span class="keyword" id="6359185">func</span><span class="op" id="6359189">(</span><span class="op" id="6359190">)</span>&nbsp;<span class="builtintype" id="6359192">error</span>&nbsp;<span class="op" id="6359198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359201">//println(fmt.Sprintf(&#34;removeDep(%T&nbsp;%p,&nbsp;%T&nbsp;%p)&#34;,&nbsp;x,&nbsp;x,&nbsp;dep,&nbsp;dep))</span><br>
<span class="lineno"></span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359269">xdep</span><span class="op" id="6359273">,</span>&nbsp;<span class="ident" id="6359275">ok</span>&nbsp;<span class="op" id="6359278">:=</span>&nbsp;<span class="ident" id="6359281"><a href="/database/sql/sql.go.html#6359129">db</a></span><span class="op" id="6359283">.</span><span class="ident" id="6359284">dep</span><span class="op" id="6359287">[</span><span class="ident" id="6359288"><a href="/database/sql/sql.go.html#6359153">x</a></span><span class="op" id="6359289">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359292">if</span>&nbsp;<span class="op" id="6359295">!</span><span class="ident" id="6359296"><a href="/database/sql/sql.go.html#6359275">ok</a></span>&nbsp;<span class="op" id="6359299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6359303">panic</span><span class="op" id="6359308">(</span><span class="ident" id="6359309"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6359312">.</span><span class="ident" id="6359313">Sprintf</span><span class="op" id="6359320">(</span><span class="string" id="6359321">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;deps&nbsp;for&nbsp;%T&#34;</span><span class="op" id="6359357">,</span>&nbsp;<span class="ident" id="6359359"><a href="/database/sql/sql.go.html#6359153">x</a></span><span class="op" id="6359360">)</span><span class="op" id="6359361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6359368">l0</span>&nbsp;<span class="op" id="6359371">:=</span>&nbsp;<span class="builtinfunc" id="6359374">len</span><span class="op" id="6359377">(</span><span class="ident" id="6359378"><a href="/database/sql/sql.go.html#6359269">xdep</a></span><span class="op" id="6359382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6359385">delete</span><span class="op" id="6359391">(</span><span class="ident" id="6359392"><a href="/database/sql/sql.go.html#6359269">xdep</a></span><span class="op" id="6359396">,</span>&nbsp;<span class="ident" id="6359398"><a href="/database/sql/sql.go.html#6359168">dep</a></span><span class="op" id="6359401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359405">switch</span>&nbsp;<span class="builtinfunc" id="6359412">len</span><span class="op" id="6359415">(</span><span class="ident" id="6359416"><a href="/database/sql/sql.go.html#6359269">xdep</a></span><span class="op" id="6359420">)</span>&nbsp;<span class="op" id="6359422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359425">case</span>&nbsp;<span class="ident" id="6359430"><a href="/database/sql/sql.go.html#6359368">l0</a></span><span class="op" id="6359432">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359436">//&nbsp;Nothing&nbsp;removed.&nbsp;Shouldn&#39;t&nbsp;happen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6359476">panic</span><span class="op" id="6359481">(</span><span class="ident" id="6359482"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6359485">.</span><span class="ident" id="6359486">Sprintf</span><span class="op" id="6359493">(</span><span class="string" id="6359494">&#34;unpaired&nbsp;removeDep:&nbsp;no&nbsp;%T&nbsp;dep&nbsp;on&nbsp;%T&#34;</span><span class="op" id="6359531">,</span>&nbsp;<span class="ident" id="6359533"><a href="/database/sql/sql.go.html#6359168">dep</a></span><span class="op" id="6359536">,</span>&nbsp;<span class="ident" id="6359538"><a href="/database/sql/sql.go.html#6359153">x</a></span><span class="op" id="6359539">)</span><span class="op" id="6359540">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359543">case</span>&nbsp;<span class="num" id="6359548">0</span><span class="op" id="6359549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359553">//&nbsp;No&nbsp;more&nbsp;dependencies.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6359580">delete</span><span class="op" id="6359586">(</span><span class="ident" id="6359587"><a href="/database/sql/sql.go.html#6359129">db</a></span><span class="op" id="6359589">.</span><span class="ident" id="6359590">dep</span><span class="op" id="6359593">,</span>&nbsp;<span class="ident" id="6359595"><a href="/database/sql/sql.go.html#6359153">x</a></span><span class="op" id="6359596">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359600">return</span>&nbsp;<span class="ident" id="6359607"><a href="/database/sql/sql.go.html#6359153">x</a></span><span class="op" id="6359608">.</span><span class="ident" id="6359609">finalClose</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359621">default</span><span class="op" id="6359628">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6359632">//&nbsp;Dependencies&nbsp;remain.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6359658">return</span>&nbsp;<span class="keyword" id="6359665">func</span><span class="op" id="6359669">(</span><span class="op" id="6359670">)</span>&nbsp;<span class="builtintype" id="6359672">error</span>&nbsp;<span class="op" id="6359678">{</span>&nbsp;<span class="keyword" id="6359680">return</span>&nbsp;<span class="ident" id="6359687">nil</span>&nbsp;<span class="op" id="6359691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6359694">}</span><br>
<span class="lineno">415</span><span class="op" id="6359696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6359699">//&nbsp;This&nbsp;is&nbsp;the&nbsp;size&nbsp;of&nbsp;the&nbsp;connectionOpener&nbsp;request&nbsp;chan&nbsp;(dn.openerCh).</span><br>
<span class="lineno"></span><span class="comment" id="6359771">//&nbsp;This&nbsp;value&nbsp;should&nbsp;be&nbsp;larger&nbsp;than&nbsp;the&nbsp;maximum&nbsp;typical&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="6359833">//&nbsp;used&nbsp;for&nbsp;db.maxOpen.&nbsp;If&nbsp;maxOpen&nbsp;is&nbsp;significantly&nbsp;larger&nbsp;than</span><br>
<span class="lineno">420</span><span class="comment" id="6359897">//&nbsp;connectionRequestQueueSize&nbsp;then&nbsp;it&nbsp;is&nbsp;possible&nbsp;for&nbsp;ALL&nbsp;calls&nbsp;into&nbsp;the&nbsp;*DB</span><br>
<span class="lineno"></span><span class="comment" id="6359974">//&nbsp;to&nbsp;block&nbsp;until&nbsp;the&nbsp;connectionOpener&nbsp;can&nbsp;satisfy&nbsp;the&nbsp;backlog&nbsp;of&nbsp;requests.</span><br>
<span class="lineno"></span><span class="keyword" id="6360050">var</span>&nbsp;<span class="ident" id="6360054">connectionRequestQueueSize</span>&nbsp;<span class="op" id="6360081">=</span>&nbsp;<span class="num" id="6360083">1000000</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6360092">//&nbsp;Open&nbsp;opens&nbsp;a&nbsp;database&nbsp;specified&nbsp;by&nbsp;its&nbsp;database&nbsp;driver&nbsp;name&nbsp;and&nbsp;a</span><br>
<span class="lineno">425</span><span class="comment" id="6360161">//&nbsp;driver-specific&nbsp;data&nbsp;source&nbsp;name,&nbsp;usually&nbsp;consisting&nbsp;of&nbsp;at&nbsp;least&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6360231">//&nbsp;database&nbsp;name&nbsp;and&nbsp;connection&nbsp;information.</span><br>
<span class="lineno"></span><span class="comment" id="6360276">//</span><br>
<span class="lineno"></span><span class="comment" id="6360279">//&nbsp;Most&nbsp;users&nbsp;will&nbsp;open&nbsp;a&nbsp;database&nbsp;via&nbsp;a&nbsp;driver-specific&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6360347">//&nbsp;helper&nbsp;function&nbsp;that&nbsp;returns&nbsp;a&nbsp;*DB.&nbsp;No&nbsp;database&nbsp;drivers&nbsp;are&nbsp;included</span><br>
<span class="lineno">430</span><span class="comment" id="6360419">//&nbsp;in&nbsp;the&nbsp;Go&nbsp;standard&nbsp;library.&nbsp;See&nbsp;http://golang.org/s/sqldrivers&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6360489">//&nbsp;a&nbsp;list&nbsp;of&nbsp;third-party&nbsp;drivers.</span><br>
<span class="lineno"></span><span class="comment" id="6360523">//</span><br>
<span class="lineno"></span><span class="comment" id="6360526">//&nbsp;Open&nbsp;may&nbsp;just&nbsp;validate&nbsp;its&nbsp;arguments&nbsp;without&nbsp;creating&nbsp;a&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6360596">//&nbsp;to&nbsp;the&nbsp;database.&nbsp;To&nbsp;verify&nbsp;that&nbsp;the&nbsp;data&nbsp;source&nbsp;name&nbsp;is&nbsp;valid,&nbsp;call</span><br>
<span class="lineno">435</span><span class="comment" id="6360667">//&nbsp;Ping.</span><br>
<span class="lineno"></span><span class="comment" id="6360676">//</span><br>
<span class="lineno"></span><span class="comment" id="6360679">//&nbsp;The&nbsp;returned&nbsp;DB&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines</span><br>
<span class="lineno"></span><span class="comment" id="6360748">//&nbsp;and&nbsp;maintains&nbsp;its&nbsp;own&nbsp;pool&nbsp;of&nbsp;idle&nbsp;connections.&nbsp;Thus,&nbsp;the&nbsp;Open</span><br>
<span class="lineno"></span><span class="comment" id="6360814">//&nbsp;function&nbsp;should&nbsp;be&nbsp;called&nbsp;just&nbsp;once.&nbsp;It&nbsp;is&nbsp;rarely&nbsp;necessary&nbsp;to</span><br>
<span class="lineno">440</span><span class="comment" id="6360880">//&nbsp;close&nbsp;a&nbsp;DB.</span><br>
<span class="lineno"></span><span class="keyword" id="6360895">func</span>&nbsp;<span class="ident" id="6360900">Open</span><span class="op" id="6360904">(</span><span class="ident" id="6360905">driverName</span><span class="op" id="6360915">,</span>&nbsp;<span class="ident" id="6360917">dataSourceName</span>&nbsp;<span class="builtintype" id="6360932">string</span><span class="op" id="6360938">)</span>&nbsp;<span class="op" id="6360940">(</span><span class="op" id="6360941">*</span><span class="ident" id="6360942"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6360944">,</span>&nbsp;<span class="builtintype" id="6360946">error</span><span class="op" id="6360951">)</span>&nbsp;<span class="op" id="6360953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6360956">driveri</span><span class="op" id="6360963">,</span>&nbsp;<span class="ident" id="6360965">ok</span>&nbsp;<span class="op" id="6360968">:=</span>&nbsp;<span class="ident" id="6360971"><a href="/database/sql/sql.go.html#6349167">drivers</a></span><span class="op" id="6360978">[</span><span class="ident" id="6360979"><a href="/database/sql/sql.go.html#6360905">driverName</a></span><span class="op" id="6360989">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6360992">if</span>&nbsp;<span class="op" id="6360995">!</span><span class="ident" id="6360996"><a href="/database/sql/sql.go.html#6360965">ok</a></span>&nbsp;<span class="op" id="6360999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361003">return</span>&nbsp;<span class="ident" id="6361010">nil</span><span class="op" id="6361013">,</span>&nbsp;<span class="ident" id="6361015"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6361018">.</span><span class="ident" id="6361019">Errorf</span><span class="op" id="6361025">(</span><span class="string" id="6361026">&#34;sql:&nbsp;unknown&nbsp;driver&nbsp;%q&nbsp;(forgotten&nbsp;import?)&#34;</span><span class="op" id="6361070">,</span>&nbsp;<span class="ident" id="6361072"><a href="/database/sql/sql.go.html#6360905">driverName</a></span><span class="op" id="6361082">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361088">db</span>&nbsp;<span class="op" id="6361091">:=</span>&nbsp;<span class="op" id="6361094">&amp;</span><span class="ident" id="6361095"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6361097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361101">driver</span><span class="op" id="6361107">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6361111"><a href="/database/sql/sql.go.html#6360956">driveri</a></span><span class="op" id="6361118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361122">dsn</span><span class="op" id="6361125">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6361132"><a href="/database/sql/sql.go.html#6360917">dataSourceName</a></span><span class="op" id="6361146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361150">openerCh</span><span class="op" id="6361158">:</span>&nbsp;<span class="builtinfunc" id="6361160">make</span><span class="op" id="6361164">(</span><span class="keyword" id="6361165">chan</span>&nbsp;<span class="keyword" id="6361170">struct</span><span class="op" id="6361176">{</span><span class="op" id="6361177">}</span><span class="op" id="6361178">,</span>&nbsp;<span class="ident" id="6361180"><a href="/database/sql/sql.go.html#6360054">connectionRequestQueueSize</a></span><span class="op" id="6361206">)</span><span class="op" id="6361207">,</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361211">lastPut</span><span class="op" id="6361218">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="6361221">make</span><span class="op" id="6361225">(</span><span class="keyword" id="6361226">map</span><span class="op" id="6361229">[</span><span class="op" id="6361230">*</span><span class="ident" id="6361231"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6361241">]</span><span class="builtintype" id="6361242">string</span><span class="op" id="6361248">)</span><span class="op" id="6361249">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361255">go</span>&nbsp;<span class="ident" id="6361258"><a href="/database/sql/sql.go.html#6361088">db</a></span><span class="op" id="6361260">.</span><span class="ident" id="6361261">connectionOpener</span><span class="op" id="6361277">(</span><span class="op" id="6361278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361281">return</span>&nbsp;<span class="ident" id="6361288"><a href="/database/sql/sql.go.html#6361088">db</a></span><span class="op" id="6361290">,</span>&nbsp;<span class="ident" id="6361292">nil</span><br>
<span class="lineno"></span><span class="op" id="6361296">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="comment" id="6361299">//&nbsp;Ping&nbsp;verifies&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;database&nbsp;is&nbsp;still&nbsp;alive,</span><br>
<span class="lineno"></span><span class="comment" id="6361361">//&nbsp;establishing&nbsp;a&nbsp;connection&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6361404">func</span>&nbsp;<span class="op" id="6361409">(</span><span class="ident" id="6361410">db</span>&nbsp;<span class="op" id="6361413">*</span><span class="ident" id="6361414"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6361416">)</span>&nbsp;<span class="ident" id="6361418">Ping</span><span class="op" id="6361422">(</span><span class="op" id="6361423">)</span>&nbsp;<span class="builtintype" id="6361425">error</span>&nbsp;<span class="op" id="6361431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361434">//&nbsp;TODO(bradfitz):&nbsp;give&nbsp;drivers&nbsp;an&nbsp;optional&nbsp;hook&nbsp;to&nbsp;implement</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361497">//&nbsp;this&nbsp;in&nbsp;a&nbsp;more&nbsp;efficient&nbsp;or&nbsp;more&nbsp;reliable&nbsp;way,&nbsp;if&nbsp;they</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6361556">//&nbsp;have&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361570">dc</span><span class="op" id="6361572">,</span>&nbsp;<span class="ident" id="6361574">err</span>&nbsp;<span class="op" id="6361578">:=</span>&nbsp;<span class="ident" id="6361581"><a href="/database/sql/sql.go.html#6361410">db</a></span><span class="op" id="6361583">.</span><span class="ident" id="6361584">conn</span><span class="op" id="6361588">(</span><span class="op" id="6361589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361592">if</span>&nbsp;<span class="ident" id="6361595"><a href="/database/sql/sql.go.html#6361574">err</a></span>&nbsp;<span class="op" id="6361599">!=</span>&nbsp;<span class="ident" id="6361602">nil</span>&nbsp;<span class="op" id="6361606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361610">return</span>&nbsp;<span class="ident" id="6361617"><a href="/database/sql/sql.go.html#6361574">err</a></span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361622">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361625"><a href="/database/sql/sql.go.html#6361410">db</a></span><span class="op" id="6361627">.</span><span class="ident" id="6361628">putConn</span><span class="op" id="6361635">(</span><span class="ident" id="6361636"><a href="/database/sql/sql.go.html#6361570">dc</a></span><span class="op" id="6361638">,</span>&nbsp;<span class="ident" id="6361640">nil</span><span class="op" id="6361643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361646">return</span>&nbsp;<span class="ident" id="6361653">nil</span><br>
<span class="lineno"></span><span class="op" id="6361657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">470</span><span class="comment" id="6361660">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;database,&nbsp;releasing&nbsp;any&nbsp;open&nbsp;resources.</span><br>
<span class="lineno"></span><span class="comment" id="6361720">//</span><br>
<span class="lineno"></span><span class="comment" id="6361723">//&nbsp;It&nbsp;is&nbsp;rare&nbsp;to&nbsp;Close&nbsp;a&nbsp;DB,&nbsp;as&nbsp;the&nbsp;DB&nbsp;handle&nbsp;is&nbsp;meant&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="6361784">//&nbsp;long-lived&nbsp;and&nbsp;shared&nbsp;between&nbsp;many&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6361834">func</span>&nbsp;<span class="op" id="6361839">(</span><span class="ident" id="6361840">db</span>&nbsp;<span class="op" id="6361843">*</span><span class="ident" id="6361844"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6361846">)</span>&nbsp;<span class="ident" id="6361848">Close</span><span class="op" id="6361853">(</span><span class="op" id="6361854">)</span>&nbsp;<span class="builtintype" id="6361856">error</span>&nbsp;<span class="op" id="6361862">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361865"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6361867">.</span><span class="ident" id="6361868">mu</span><span class="op" id="6361870">.</span><span class="ident" id="6361871">Lock</span><span class="op" id="6361875">(</span><span class="op" id="6361876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361879">if</span>&nbsp;<span class="ident" id="6361882"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6361884">.</span><span class="ident" id="6361885">closed</span>&nbsp;<span class="op" id="6361892">{</span>&nbsp;<span class="comment" id="6361894">//&nbsp;Make&nbsp;DB.Close&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361924"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6361926">.</span><span class="ident" id="6361927">mu</span><span class="op" id="6361929">.</span><span class="ident" id="6361930">Unlock</span><span class="op" id="6361936">(</span><span class="op" id="6361937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361941">return</span>&nbsp;<span class="ident" id="6361948">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6361953">}</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6361956">close</span><span class="op" id="6361961">(</span><span class="ident" id="6361962"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6361964">.</span><span class="ident" id="6361965">openerCh</span><span class="op" id="6361973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6361976">var</span>&nbsp;<span class="ident" id="6361980">err</span>&nbsp;<span class="builtintype" id="6361984">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6361991">fns</span>&nbsp;<span class="op" id="6361995">:=</span>&nbsp;<span class="builtinfunc" id="6361998">make</span><span class="op" id="6362002">(</span><span class="op" id="6362003">[</span><span class="op" id="6362004">]</span><span class="keyword" id="6362005">func</span><span class="op" id="6362009">(</span><span class="op" id="6362010">)</span>&nbsp;<span class="builtintype" id="6362012">error</span><span class="op" id="6362017">,</span>&nbsp;<span class="num" id="6362019">0</span><span class="op" id="6362020">,</span>&nbsp;<span class="builtinfunc" id="6362022">len</span><span class="op" id="6362025">(</span><span class="ident" id="6362026"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362028">.</span><span class="ident" id="6362029">freeConn</span><span class="op" id="6362037">)</span><span class="op" id="6362038">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362041">for</span>&nbsp;<span class="ident" id="6362045">_</span><span class="op" id="6362046">,</span>&nbsp;<span class="ident" id="6362048">dc</span>&nbsp;<span class="op" id="6362051">:=</span>&nbsp;<span class="keyword" id="6362054">range</span>&nbsp;<span class="ident" id="6362060"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362062">.</span><span class="ident" id="6362063">freeConn</span>&nbsp;<span class="op" id="6362072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362076"><a href="/database/sql/sql.go.html#6361991">fns</a></span>&nbsp;<span class="op" id="6362080">=</span>&nbsp;<span class="builtinfunc" id="6362082">append</span><span class="op" id="6362088">(</span><span class="ident" id="6362089"><a href="/database/sql/sql.go.html#6361991">fns</a></span><span class="op" id="6362092">,</span>&nbsp;<span class="ident" id="6362094"><a href="/database/sql/sql.go.html#6362048">dc</a></span><span class="op" id="6362096">.</span><span class="ident" id="6362097">closeDBLocked</span><span class="op" id="6362110">(</span><span class="op" id="6362111">)</span><span class="op" id="6362112">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362118"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362120">.</span><span class="ident" id="6362121">freeConn</span>&nbsp;<span class="op" id="6362130">=</span>&nbsp;<span class="ident" id="6362132">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362137"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362139">.</span><span class="ident" id="6362140">closed</span>&nbsp;<span class="op" id="6362147">=</span>&nbsp;<span class="builtintype" id="6362149">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362155">for</span>&nbsp;<span class="ident" id="6362159">_</span><span class="op" id="6362160">,</span>&nbsp;<span class="ident" id="6362162">req</span>&nbsp;<span class="op" id="6362166">:=</span>&nbsp;<span class="keyword" id="6362169">range</span>&nbsp;<span class="ident" id="6362175"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362177">.</span><span class="ident" id="6362178">connRequests</span>&nbsp;<span class="op" id="6362191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6362195">close</span><span class="op" id="6362200">(</span><span class="ident" id="6362201"><a href="/database/sql/sql.go.html#6362162">req</a></span><span class="op" id="6362204">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362210"><a href="/database/sql/sql.go.html#6361840">db</a></span><span class="op" id="6362212">.</span><span class="ident" id="6362213">mu</span><span class="op" id="6362215">.</span><span class="ident" id="6362216">Unlock</span><span class="op" id="6362222">(</span><span class="op" id="6362223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362226">for</span>&nbsp;<span class="ident" id="6362230">_</span><span class="op" id="6362231">,</span>&nbsp;<span class="ident" id="6362233">fn</span>&nbsp;<span class="op" id="6362236">:=</span>&nbsp;<span class="keyword" id="6362239">range</span>&nbsp;<span class="ident" id="6362245"><a href="/database/sql/sql.go.html#6361991">fns</a></span>&nbsp;<span class="op" id="6362249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362253">err1</span>&nbsp;<span class="op" id="6362258">:=</span>&nbsp;<span class="ident" id="6362261"><a href="/database/sql/sql.go.html#6362233">fn</a></span><span class="op" id="6362263">(</span><span class="op" id="6362264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362268">if</span>&nbsp;<span class="ident" id="6362271"><a href="/database/sql/sql.go.html#6362253">err1</a></span>&nbsp;<span class="op" id="6362276">!=</span>&nbsp;<span class="ident" id="6362279">nil</span>&nbsp;<span class="op" id="6362283">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362288"><a href="/database/sql/sql.go.html#6361980">err</a></span>&nbsp;<span class="op" id="6362292">=</span>&nbsp;<span class="ident" id="6362294"><a href="/database/sql/sql.go.html#6362253">err1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362307">return</span>&nbsp;<span class="ident" id="6362314"><a href="/database/sql/sql.go.html#6361980">err</a></span><br>
<span class="lineno"></span><span class="op" id="6362318">}</span><br>
<span class="lineno">500</span><br>
<span class="lineno"></span><span class="keyword" id="6362321">const</span>&nbsp;<span class="ident" id="6362327">defaultMaxIdleConns</span>&nbsp;<span class="op" id="6362347">=</span>&nbsp;<span class="num" id="6362349">2</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6362352">func</span>&nbsp;<span class="op" id="6362357">(</span><span class="ident" id="6362358">db</span>&nbsp;<span class="op" id="6362361">*</span><span class="ident" id="6362362"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6362364">)</span>&nbsp;<span class="ident" id="6362366">maxIdleConnsLocked</span><span class="op" id="6362384">(</span><span class="op" id="6362385">)</span>&nbsp;<span class="builtintype" id="6362387">int</span>&nbsp;<span class="op" id="6362391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362394">n</span>&nbsp;<span class="op" id="6362396">:=</span>&nbsp;<span class="ident" id="6362399"><a href="/database/sql/sql.go.html#6362358">db</a></span><span class="op" id="6362401">.</span><span class="ident" id="6362402">maxIdle</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362411">switch</span>&nbsp;<span class="op" id="6362418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362421">case</span>&nbsp;<span class="ident" id="6362426"><a href="/database/sql/sql.go.html#6362394">n</a></span>&nbsp;<span class="op" id="6362428">==</span>&nbsp;<span class="num" id="6362431">0</span><span class="op" id="6362432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362436">//&nbsp;TODO(bradfitz):&nbsp;ask&nbsp;driver,&nbsp;if&nbsp;supported,&nbsp;for&nbsp;its&nbsp;default&nbsp;preference</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362510">return</span>&nbsp;<span class="ident" id="6362517"><a href="/database/sql/sql.go.html#6362327">defaultMaxIdleConns</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362538">case</span>&nbsp;<span class="ident" id="6362543"><a href="/database/sql/sql.go.html#6362394">n</a></span>&nbsp;<span class="op" id="6362545">&lt;</span>&nbsp;<span class="num" id="6362547">0</span><span class="op" id="6362548">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362552">return</span>&nbsp;<span class="num" id="6362559">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362562">default</span><span class="op" id="6362569">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362573">return</span>&nbsp;<span class="ident" id="6362580"><a href="/database/sql/sql.go.html#6362394">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362583">}</span><br>
<span class="lineno"></span><span class="op" id="6362585">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span><span class="comment" id="6362588">//&nbsp;SetMaxIdleConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;connections&nbsp;in&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="6362658">//&nbsp;connection&nbsp;pool.</span><br>
<span class="lineno"></span><span class="comment" id="6362678">//</span><br>
<span class="lineno"></span><span class="comment" id="6362681">//&nbsp;If&nbsp;MaxOpenConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;but&nbsp;less&nbsp;than&nbsp;the&nbsp;new&nbsp;MaxIdleConns</span><br>
<span class="lineno">520</span><span class="comment" id="6362753">//&nbsp;then&nbsp;the&nbsp;new&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="6362830">//</span><br>
<span class="lineno"></span><span class="comment" id="6362833">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;no&nbsp;idle&nbsp;connections&nbsp;are&nbsp;retained.</span><br>
<span class="lineno"></span><span class="keyword" id="6362881">func</span>&nbsp;<span class="op" id="6362886">(</span><span class="ident" id="6362887">db</span>&nbsp;<span class="op" id="6362890">*</span><span class="ident" id="6362891"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6362893">)</span>&nbsp;<span class="ident" id="6362895">SetMaxIdleConns</span><span class="op" id="6362910">(</span><span class="ident" id="6362911">n</span>&nbsp;<span class="builtintype" id="6362913">int</span><span class="op" id="6362916">)</span>&nbsp;<span class="op" id="6362918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362921"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6362923">.</span><span class="ident" id="6362924">mu</span><span class="op" id="6362926">.</span><span class="ident" id="6362927">Lock</span><span class="op" id="6362931">(</span><span class="op" id="6362932">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6362935">if</span>&nbsp;<span class="ident" id="6362938"><a href="/database/sql/sql.go.html#6362911">n</a></span>&nbsp;<span class="op" id="6362940">&gt;</span>&nbsp;<span class="num" id="6362942">0</span>&nbsp;<span class="op" id="6362944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6362948"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6362950">.</span><span class="ident" id="6362951">maxIdle</span>&nbsp;<span class="op" id="6362959">=</span>&nbsp;<span class="ident" id="6362961"><a href="/database/sql/sql.go.html#6362911">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6362964">}</span>&nbsp;<span class="keyword" id="6362966">else</span>&nbsp;<span class="op" id="6362971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6362975">//&nbsp;No&nbsp;idle&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363001"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363003">.</span><span class="ident" id="6363004">maxIdle</span>&nbsp;<span class="op" id="6363012">=</span>&nbsp;<span class="op" id="6363014">-</span><span class="num" id="6363015">1</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6363021">//&nbsp;Make&nbsp;sure&nbsp;maxIdle&nbsp;doesn&#39;t&nbsp;exceed&nbsp;maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363066">if</span>&nbsp;<span class="ident" id="6363069"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363071">.</span><span class="ident" id="6363072">maxOpen</span>&nbsp;<span class="op" id="6363080">&gt;</span>&nbsp;<span class="num" id="6363082">0</span>&nbsp;<span class="op" id="6363084">&amp;&amp;</span>&nbsp;<span class="ident" id="6363087"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363089">.</span><span class="ident" id="6363090">maxIdleConnsLocked</span><span class="op" id="6363108">(</span><span class="op" id="6363109">)</span>&nbsp;<span class="op" id="6363111">&gt;</span>&nbsp;<span class="ident" id="6363113"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363115">.</span><span class="ident" id="6363116">maxOpen</span>&nbsp;<span class="op" id="6363124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363128"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363130">.</span><span class="ident" id="6363131">maxIdle</span>&nbsp;<span class="op" id="6363139">=</span>&nbsp;<span class="ident" id="6363141"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363143">.</span><span class="ident" id="6363144">maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363153">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363156">var</span>&nbsp;<span class="ident" id="6363160">closing</span>&nbsp;<span class="op" id="6363168">[</span><span class="op" id="6363169">]</span><span class="op" id="6363170">*</span><span class="ident" id="6363171"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363183">idleCount</span>&nbsp;<span class="op" id="6363193">:=</span>&nbsp;<span class="builtinfunc" id="6363196">len</span><span class="op" id="6363199">(</span><span class="ident" id="6363200"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363202">.</span><span class="ident" id="6363203">freeConn</span><span class="op" id="6363211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363214">maxIdle</span>&nbsp;<span class="op" id="6363222">:=</span>&nbsp;<span class="ident" id="6363225"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363227">.</span><span class="ident" id="6363228">maxIdleConnsLocked</span><span class="op" id="6363246">(</span><span class="op" id="6363247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363250">if</span>&nbsp;<span class="ident" id="6363253"><a href="/database/sql/sql.go.html#6363183">idleCount</a></span>&nbsp;<span class="op" id="6363263">&gt;</span>&nbsp;<span class="ident" id="6363265"><a href="/database/sql/sql.go.html#6363214">maxIdle</a></span>&nbsp;<span class="op" id="6363273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363277"><a href="/database/sql/sql.go.html#6363160">closing</a></span>&nbsp;<span class="op" id="6363285">=</span>&nbsp;<span class="ident" id="6363287"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363289">.</span><span class="ident" id="6363290">freeConn</span><span class="op" id="6363298">[</span><span class="ident" id="6363299"><a href="/database/sql/sql.go.html#6363214">maxIdle</a></span><span class="op" id="6363306">:</span><span class="op" id="6363307">]</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363311"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363313">.</span><span class="ident" id="6363314">freeConn</span>&nbsp;<span class="op" id="6363323">=</span>&nbsp;<span class="ident" id="6363325"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363327">.</span><span class="ident" id="6363328">freeConn</span><span class="op" id="6363336">[</span><span class="op" id="6363337">:</span><span class="ident" id="6363338"><a href="/database/sql/sql.go.html#6363214">maxIdle</a></span><span class="op" id="6363345">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363351"><a href="/database/sql/sql.go.html#6362887">db</a></span><span class="op" id="6363353">.</span><span class="ident" id="6363354">mu</span><span class="op" id="6363356">.</span><span class="ident" id="6363357">Unlock</span><span class="op" id="6363363">(</span><span class="op" id="6363364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363367">for</span>&nbsp;<span class="ident" id="6363371">_</span><span class="op" id="6363372">,</span>&nbsp;<span class="ident" id="6363374">c</span>&nbsp;<span class="op" id="6363376">:=</span>&nbsp;<span class="keyword" id="6363379">range</span>&nbsp;<span class="ident" id="6363385"><a href="/database/sql/sql.go.html#6363160">closing</a></span>&nbsp;<span class="op" id="6363393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363397"><a href="/database/sql/sql.go.html#6363374">c</a></span><span class="op" id="6363398">.</span><span class="ident" id="6363399">Close</span><span class="op" id="6363404">(</span><span class="op" id="6363405">)</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363408">}</span><br>
<span class="lineno"></span><span class="op" id="6363410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6363413">//&nbsp;SetMaxOpenConns&nbsp;sets&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;to&nbsp;the&nbsp;database.</span><br>
<span class="lineno"></span><span class="comment" id="6363493">//</span><br>
<span class="lineno">550</span><span class="comment" id="6363496">//&nbsp;If&nbsp;MaxIdleConns&nbsp;is&nbsp;greater&nbsp;than&nbsp;0&nbsp;and&nbsp;the&nbsp;new&nbsp;MaxOpenConns&nbsp;is&nbsp;less&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="6363571">//&nbsp;MaxIdleConns,&nbsp;then&nbsp;MaxIdleConns&nbsp;will&nbsp;be&nbsp;reduced&nbsp;to&nbsp;match&nbsp;the&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="6363639">//&nbsp;MaxOpenConns&nbsp;limit</span><br>
<span class="lineno"></span><span class="comment" id="6363661">//</span><br>
<span class="lineno"></span><span class="comment" id="6363664">//&nbsp;If&nbsp;n&nbsp;&lt;=&nbsp;0,&nbsp;then&nbsp;there&nbsp;is&nbsp;no&nbsp;limit&nbsp;on&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections.</span><br>
<span class="lineno">555</span><span class="comment" id="6363736">//&nbsp;The&nbsp;default&nbsp;is&nbsp;0&nbsp;(unlimited).</span><br>
<span class="lineno"></span><span class="keyword" id="6363769">func</span>&nbsp;<span class="op" id="6363774">(</span><span class="ident" id="6363775">db</span>&nbsp;<span class="op" id="6363778">*</span><span class="ident" id="6363779"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6363781">)</span>&nbsp;<span class="ident" id="6363783">SetMaxOpenConns</span><span class="op" id="6363798">(</span><span class="ident" id="6363799">n</span>&nbsp;<span class="builtintype" id="6363801">int</span><span class="op" id="6363804">)</span>&nbsp;<span class="op" id="6363806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363809"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363811">.</span><span class="ident" id="6363812">mu</span><span class="op" id="6363814">.</span><span class="ident" id="6363815">Lock</span><span class="op" id="6363819">(</span><span class="op" id="6363820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363823"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363825">.</span><span class="ident" id="6363826">maxOpen</span>&nbsp;<span class="op" id="6363834">=</span>&nbsp;<span class="ident" id="6363836"><a href="/database/sql/sql.go.html#6363799">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363839">if</span>&nbsp;<span class="ident" id="6363842"><a href="/database/sql/sql.go.html#6363799">n</a></span>&nbsp;<span class="op" id="6363844">&lt;</span>&nbsp;<span class="num" id="6363846">0</span>&nbsp;<span class="op" id="6363848">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363852"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363854">.</span><span class="ident" id="6363855">maxOpen</span>&nbsp;<span class="op" id="6363863">=</span>&nbsp;<span class="num" id="6363865">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6363868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363871">syncMaxIdle</span>&nbsp;<span class="op" id="6363883">:=</span>&nbsp;<span class="ident" id="6363886"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363888">.</span><span class="ident" id="6363889">maxOpen</span>&nbsp;<span class="op" id="6363897">&gt;</span>&nbsp;<span class="num" id="6363899">0</span>&nbsp;<span class="op" id="6363901">&amp;&amp;</span>&nbsp;<span class="ident" id="6363904"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363906">.</span><span class="ident" id="6363907">maxIdleConnsLocked</span><span class="op" id="6363925">(</span><span class="op" id="6363926">)</span>&nbsp;<span class="op" id="6363928">&gt;</span>&nbsp;<span class="ident" id="6363930"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363932">.</span><span class="ident" id="6363933">maxOpen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363942"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363944">.</span><span class="ident" id="6363945">mu</span><span class="op" id="6363947">.</span><span class="ident" id="6363948">Unlock</span><span class="op" id="6363954">(</span><span class="op" id="6363955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6363958">if</span>&nbsp;<span class="ident" id="6363961"><a href="/database/sql/sql.go.html#6363871">syncMaxIdle</a></span>&nbsp;<span class="op" id="6363973">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6363977"><a href="/database/sql/sql.go.html#6363775">db</a></span><span class="op" id="6363979">.</span><span class="ident" id="6363980">SetMaxIdleConns</span><span class="op" id="6363995">(</span><span class="ident" id="6363996"><a href="/database/sql/sql.go.html#6363799">n</a></span><span class="op" id="6363997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364000">}</span><br>
<span class="lineno"></span><span class="op" id="6364002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364005">//&nbsp;Assumes&nbsp;db.mu&nbsp;is&nbsp;locked.</span><br>
<span class="lineno">570</span><span class="comment" id="6364033">//&nbsp;If&nbsp;there&nbsp;are&nbsp;connRequests&nbsp;and&nbsp;the&nbsp;connection&nbsp;limit&nbsp;hasn&#39;t&nbsp;been&nbsp;reached,</span><br>
<span class="lineno"></span><span class="comment" id="6364108">//&nbsp;then&nbsp;tell&nbsp;the&nbsp;connectionOpener&nbsp;to&nbsp;open&nbsp;new&nbsp;connections.</span><br>
<span class="lineno"></span><span class="keyword" id="6364167">func</span>&nbsp;<span class="op" id="6364172">(</span><span class="ident" id="6364173">db</span>&nbsp;<span class="op" id="6364176">*</span><span class="ident" id="6364177"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6364179">)</span>&nbsp;<span class="ident" id="6364181">maybeOpenNewConnections</span><span class="op" id="6364204">(</span><span class="op" id="6364205">)</span>&nbsp;<span class="op" id="6364207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364210">numRequests</span>&nbsp;<span class="op" id="6364222">:=</span>&nbsp;<span class="builtinfunc" id="6364225">len</span><span class="op" id="6364228">(</span><span class="ident" id="6364229"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364231">.</span><span class="ident" id="6364232">connRequests</span><span class="op" id="6364244">)</span>&nbsp;<span class="op" id="6364246">-</span>&nbsp;<span class="ident" id="6364248"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364250">.</span><span class="ident" id="6364251">pendingOpens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364265">if</span>&nbsp;<span class="ident" id="6364268"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364270">.</span><span class="ident" id="6364271">maxOpen</span>&nbsp;<span class="op" id="6364279">&gt;</span>&nbsp;<span class="num" id="6364281">0</span>&nbsp;<span class="op" id="6364283">{</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364287">numCanOpen</span>&nbsp;<span class="op" id="6364298">:=</span>&nbsp;<span class="ident" id="6364301"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364303">.</span><span class="ident" id="6364304">maxOpen</span>&nbsp;<span class="op" id="6364312">-</span>&nbsp;<span class="op" id="6364314">(</span><span class="ident" id="6364315"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364317">.</span><span class="ident" id="6364318">numOpen</span>&nbsp;<span class="op" id="6364326">+</span>&nbsp;<span class="ident" id="6364328"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364330">.</span><span class="ident" id="6364331">pendingOpens</span><span class="op" id="6364343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364347">if</span>&nbsp;<span class="ident" id="6364350"><a href="/database/sql/sql.go.html#6364210">numRequests</a></span>&nbsp;<span class="op" id="6364362">&gt;</span>&nbsp;<span class="ident" id="6364364"><a href="/database/sql/sql.go.html#6364287">numCanOpen</a></span>&nbsp;<span class="op" id="6364375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364380"><a href="/database/sql/sql.go.html#6364210">numRequests</a></span>&nbsp;<span class="op" id="6364392">=</span>&nbsp;<span class="ident" id="6364394"><a href="/database/sql/sql.go.html#6364287">numCanOpen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364410">}</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364413">for</span>&nbsp;<span class="ident" id="6364417"><a href="/database/sql/sql.go.html#6364210">numRequests</a></span>&nbsp;<span class="op" id="6364429">&gt;</span>&nbsp;<span class="num" id="6364431">0</span>&nbsp;<span class="op" id="6364433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364437"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364439">.</span><span class="ident" id="6364440">pendingOpens</span><span class="op" id="6364452">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364457"><a href="/database/sql/sql.go.html#6364210">numRequests</a></span><span class="op" id="6364468">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364473"><a href="/database/sql/sql.go.html#6364173">db</a></span><span class="op" id="6364475">.</span><span class="ident" id="6364476">openerCh</span>&nbsp;<span class="op" id="6364485">&lt;-</span>&nbsp;<span class="keyword" id="6364488">struct</span><span class="op" id="6364494">{</span><span class="op" id="6364495">}</span><span class="op" id="6364496">{</span><span class="op" id="6364497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364500">}</span><br>
<span class="lineno">585</span><span class="op" id="6364502">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364505">//&nbsp;Runs&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine,&nbsp;opens&nbsp;new&nbsp;connections&nbsp;when&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="6364576">func</span>&nbsp;<span class="op" id="6364581">(</span><span class="ident" id="6364582">db</span>&nbsp;<span class="op" id="6364585">*</span><span class="ident" id="6364586"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6364588">)</span>&nbsp;<span class="ident" id="6364590">connectionOpener</span><span class="op" id="6364606">(</span><span class="op" id="6364607">)</span>&nbsp;<span class="op" id="6364609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364612">for</span>&nbsp;<span class="keyword" id="6364616">range</span>&nbsp;<span class="ident" id="6364622"><a href="/database/sql/sql.go.html#6364582">db</a></span><span class="op" id="6364624">.</span><span class="ident" id="6364625">openerCh</span>&nbsp;<span class="op" id="6364634">{</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364638"><a href="/database/sql/sql.go.html#6364582">db</a></span><span class="op" id="6364640">.</span><span class="ident" id="6364641">openNewConnection</span><span class="op" id="6364658">(</span><span class="op" id="6364659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364662">}</span><br>
<span class="lineno"></span><span class="op" id="6364664">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6364667">//&nbsp;Open&nbsp;one&nbsp;new&nbsp;connection</span><br>
<span class="lineno">595</span><span class="keyword" id="6364694">func</span>&nbsp;<span class="op" id="6364699">(</span><span class="ident" id="6364700">db</span>&nbsp;<span class="op" id="6364703">*</span><span class="ident" id="6364704"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6364706">)</span>&nbsp;<span class="ident" id="6364708">openNewConnection</span><span class="op" id="6364725">(</span><span class="op" id="6364726">)</span>&nbsp;<span class="op" id="6364728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364731">ci</span><span class="op" id="6364733">,</span>&nbsp;<span class="ident" id="6364735">err</span>&nbsp;<span class="op" id="6364739">:=</span>&nbsp;<span class="ident" id="6364742"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364744">.</span><span class="ident" id="6364745">driver</span><span class="op" id="6364751">.</span><span class="ident" id="6364752">Open</span><span class="op" id="6364756">(</span><span class="ident" id="6364757"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364759">.</span><span class="ident" id="6364760">dsn</span><span class="op" id="6364763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364766"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364768">.</span><span class="ident" id="6364769">mu</span><span class="op" id="6364771">.</span><span class="ident" id="6364772">Lock</span><span class="op" id="6364776">(</span><span class="op" id="6364777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364780">defer</span>&nbsp;<span class="ident" id="6364786"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364788">.</span><span class="ident" id="6364789">mu</span><span class="op" id="6364791">.</span><span class="ident" id="6364792">Unlock</span><span class="op" id="6364798">(</span><span class="op" id="6364799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364802">if</span>&nbsp;<span class="ident" id="6364805"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364807">.</span><span class="ident" id="6364808">closed</span>&nbsp;<span class="op" id="6364815">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364819">if</span>&nbsp;<span class="ident" id="6364822"><a href="/database/sql/sql.go.html#6364735">err</a></span>&nbsp;<span class="op" id="6364826">==</span>&nbsp;<span class="ident" id="6364829">nil</span>&nbsp;<span class="op" id="6364833">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364838"><a href="/database/sql/sql.go.html#6364731">ci</a></span><span class="op" id="6364840">.</span><span class="ident" id="6364841">Close</span><span class="op" id="6364846">(</span><span class="op" id="6364847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364855">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364863">}</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364866"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364868">.</span><span class="ident" id="6364869">pendingOpens</span><span class="op" id="6364881">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364885">if</span>&nbsp;<span class="ident" id="6364888"><a href="/database/sql/sql.go.html#6364735">err</a></span>&nbsp;<span class="op" id="6364892">!=</span>&nbsp;<span class="ident" id="6364895">nil</span>&nbsp;<span class="op" id="6364899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364903"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364905">.</span><span class="ident" id="6364906">putConnDBLocked</span><span class="op" id="6364921">(</span><span class="ident" id="6364922">nil</span><span class="op" id="6364925">,</span>&nbsp;<span class="ident" id="6364927"><a href="/database/sql/sql.go.html#6364735">err</a></span><span class="op" id="6364930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364934">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364942">}</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364945">dc</span>&nbsp;<span class="op" id="6364948">:=</span>&nbsp;<span class="op" id="6364951">&amp;</span><span class="ident" id="6364952"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6364962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364966">db</span><span class="op" id="6364968">:</span>&nbsp;<span class="ident" id="6364970"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364972">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6364976">ci</span><span class="op" id="6364978">:</span>&nbsp;<span class="ident" id="6364980"><a href="/database/sql/sql.go.html#6364731">ci</a></span><span class="op" id="6364982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6364985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6364988">if</span>&nbsp;<span class="ident" id="6364991"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6364993">.</span><span class="ident" id="6364994">putConnDBLocked</span><span class="op" id="6365009">(</span><span class="ident" id="6365010"><a href="/database/sql/sql.go.html#6364945">dc</a></span><span class="op" id="6365012">,</span>&nbsp;<span class="ident" id="6365014"><a href="/database/sql/sql.go.html#6364735">err</a></span><span class="op" id="6365017">)</span>&nbsp;<span class="op" id="6365019">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365023"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6365025">.</span><span class="ident" id="6365026">addDepLocked</span><span class="op" id="6365038">(</span><span class="ident" id="6365039"><a href="/database/sql/sql.go.html#6364945">dc</a></span><span class="op" id="6365041">,</span>&nbsp;<span class="ident" id="6365043"><a href="/database/sql/sql.go.html#6364945">dc</a></span><span class="op" id="6365045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365049"><a href="/database/sql/sql.go.html#6364700">db</a></span><span class="op" id="6365051">.</span><span class="ident" id="6365052">numOpen</span><span class="op" id="6365059">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365063">}</span>&nbsp;<span class="keyword" id="6365065">else</span>&nbsp;<span class="op" id="6365070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365074"><a href="/database/sql/sql.go.html#6364731">ci</a></span><span class="op" id="6365076">.</span><span class="ident" id="6365077">Close</span><span class="op" id="6365082">(</span><span class="op" id="6365083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365086">}</span><br>
<span class="lineno">620</span><span class="op" id="6365088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365091">//&nbsp;connRequest&nbsp;represents&nbsp;one&nbsp;request&nbsp;for&nbsp;a&nbsp;new&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6365150">//&nbsp;When&nbsp;there&nbsp;are&nbsp;no&nbsp;idle&nbsp;connections&nbsp;available,&nbsp;DB.conn&nbsp;will&nbsp;create</span><br>
<span class="lineno"></span><span class="comment" id="6365219">//&nbsp;a&nbsp;new&nbsp;connRequest&nbsp;and&nbsp;put&nbsp;it&nbsp;on&nbsp;the&nbsp;db.connRequests&nbsp;list.</span><br>
<span class="lineno">625</span><span class="keyword" id="6365280">type</span>&nbsp;<span class="ident" id="6365285">connRequest</span>&nbsp;<span class="keyword" id="6365297">struct</span>&nbsp;<span class="op" id="6365304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365307">conn</span>&nbsp;<span class="op" id="6365312">*</span><span class="ident" id="6365313"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365325">err</span>&nbsp;&nbsp;<span class="builtintype" id="6365330">error</span><br>
<span class="lineno"></span><span class="op" id="6365336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">630</span><span class="keyword" id="6365339">var</span>&nbsp;<span class="ident" id="6365343">errDBClosed</span>&nbsp;<span class="op" id="6365355">=</span>&nbsp;<span class="ident" id="6365357"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6365363">.</span><span class="ident" id="6365364">New</span><span class="op" id="6365367">(</span><span class="string" id="6365368">&#34;sql:&nbsp;database&nbsp;is&nbsp;closed&#34;</span><span class="op" id="6365393">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6365396">//&nbsp;conn&nbsp;returns&nbsp;a&nbsp;newly-opened&nbsp;or&nbsp;cached&nbsp;*driverConn</span><br>
<span class="lineno"></span><span class="keyword" id="6365449">func</span>&nbsp;<span class="op" id="6365454">(</span><span class="ident" id="6365455">db</span>&nbsp;<span class="op" id="6365458">*</span><span class="ident" id="6365459"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6365461">)</span>&nbsp;<span class="ident" id="6365463">conn</span><span class="op" id="6365467">(</span><span class="op" id="6365468">)</span>&nbsp;<span class="op" id="6365470">(</span><span class="op" id="6365471">*</span><span class="ident" id="6365472"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6365482">,</span>&nbsp;<span class="builtintype" id="6365484">error</span><span class="op" id="6365489">)</span>&nbsp;<span class="op" id="6365491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365494"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365496">.</span><span class="ident" id="6365497">mu</span><span class="op" id="6365499">.</span><span class="ident" id="6365500">Lock</span><span class="op" id="6365504">(</span><span class="op" id="6365505">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365508">if</span>&nbsp;<span class="ident" id="6365511"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365513">.</span><span class="ident" id="6365514">closed</span>&nbsp;<span class="op" id="6365521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365525"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365527">.</span><span class="ident" id="6365528">mu</span><span class="op" id="6365530">.</span><span class="ident" id="6365531">Unlock</span><span class="op" id="6365537">(</span><span class="op" id="6365538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365542">return</span>&nbsp;<span class="ident" id="6365549">nil</span><span class="op" id="6365552">,</span>&nbsp;<span class="ident" id="6365554"><a href="/database/sql/sql.go.html#6365343">errDBClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6365567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365571">//&nbsp;If&nbsp;db.maxOpen&nbsp;&gt;&nbsp;0&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;open&nbsp;connections&nbsp;is&nbsp;over&nbsp;the&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365646">//&nbsp;and&nbsp;there&nbsp;are&nbsp;no&nbsp;free&nbsp;connection,&nbsp;make&nbsp;a&nbsp;request&nbsp;and&nbsp;wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6365709">if</span>&nbsp;<span class="ident" id="6365712"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365714">.</span><span class="ident" id="6365715">maxOpen</span>&nbsp;<span class="op" id="6365723">&gt;</span>&nbsp;<span class="num" id="6365725">0</span>&nbsp;<span class="op" id="6365727">&amp;&amp;</span>&nbsp;<span class="ident" id="6365730"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365732">.</span><span class="ident" id="6365733">numOpen</span>&nbsp;<span class="op" id="6365741">&gt;=</span>&nbsp;<span class="ident" id="6365744"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365746">.</span><span class="ident" id="6365747">maxOpen</span>&nbsp;<span class="op" id="6365755">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6365758">len</span><span class="op" id="6365761">(</span><span class="ident" id="6365762"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365764">.</span><span class="ident" id="6365765">freeConn</span><span class="op" id="6365773">)</span>&nbsp;<span class="op" id="6365775">==</span>&nbsp;<span class="num" id="6365778">0</span>&nbsp;<span class="op" id="6365780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365784">//&nbsp;Make&nbsp;the&nbsp;connRequest&nbsp;channel.&nbsp;It&#39;s&nbsp;buffered&nbsp;so&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6365845">//&nbsp;connectionOpener&nbsp;doesn&#39;t&nbsp;block&nbsp;while&nbsp;waiting&nbsp;for&nbsp;the&nbsp;req&nbsp;to&nbsp;be&nbsp;read.</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365919">req</span>&nbsp;<span class="op" id="6365923">:=</span>&nbsp;<span class="builtinfunc" id="6365926">make</span><span class="op" id="6365930">(</span><span class="keyword" id="6365931">chan</span>&nbsp;<span class="ident" id="6365936"><a href="/database/sql/sql.go.html#6365285">connRequest</a></span><span class="op" id="6365947">,</span>&nbsp;<span class="num" id="6365949">1</span><span class="op" id="6365950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6365954"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365956">.</span><span class="ident" id="6365957">connRequests</span>&nbsp;<span class="op" id="6365970">=</span>&nbsp;<span class="builtinfunc" id="6365972">append</span><span class="op" id="6365978">(</span><span class="ident" id="6365979"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6365981">.</span><span class="ident" id="6365982">connRequests</span><span class="op" id="6365994">,</span>&nbsp;<span class="ident" id="6365996"><a href="/database/sql/sql.go.html#6365919">req</a></span><span class="op" id="6365999">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366003"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366005">.</span><span class="ident" id="6366006">maybeOpenNewConnections</span><span class="op" id="6366029">(</span><span class="op" id="6366030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366034"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366036">.</span><span class="ident" id="6366037">mu</span><span class="op" id="6366039">.</span><span class="ident" id="6366040">Unlock</span><span class="op" id="6366046">(</span><span class="op" id="6366047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366051">ret</span>&nbsp;<span class="op" id="6366055">:=</span>&nbsp;<span class="op" id="6366058">&lt;-</span><span class="ident" id="6366060"><a href="/database/sql/sql.go.html#6365919">req</a></span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366066">return</span>&nbsp;<span class="ident" id="6366073"><a href="/database/sql/sql.go.html#6366051">ret</a></span><span class="op" id="6366076">.</span><span class="ident" id="6366077">conn</span><span class="op" id="6366081">,</span>&nbsp;<span class="ident" id="6366083"><a href="/database/sql/sql.go.html#6366051">ret</a></span><span class="op" id="6366086">.</span><span class="ident" id="6366087">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366092">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366096">if</span>&nbsp;<span class="ident" id="6366099">c</span>&nbsp;<span class="op" id="6366101">:=</span>&nbsp;<span class="builtinfunc" id="6366104">len</span><span class="op" id="6366107">(</span><span class="ident" id="6366108"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366110">.</span><span class="ident" id="6366111">freeConn</span><span class="op" id="6366119">)</span><span class="op" id="6366120">;</span>&nbsp;<span class="ident" id="6366122"><a href="/database/sql/sql.go.html#6366099">c</a></span>&nbsp;<span class="op" id="6366124">&gt;</span>&nbsp;<span class="num" id="6366126">0</span>&nbsp;<span class="op" id="6366128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366132">conn</span>&nbsp;<span class="op" id="6366137">:=</span>&nbsp;<span class="ident" id="6366140"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366142">.</span><span class="ident" id="6366143">freeConn</span><span class="op" id="6366151">[</span><span class="num" id="6366152">0</span><span class="op" id="6366153">]</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6366157">copy</span><span class="op" id="6366161">(</span><span class="ident" id="6366162"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366164">.</span><span class="ident" id="6366165">freeConn</span><span class="op" id="6366173">,</span>&nbsp;<span class="ident" id="6366175"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366177">.</span><span class="ident" id="6366178">freeConn</span><span class="op" id="6366186">[</span><span class="num" id="6366187">1</span><span class="op" id="6366188">:</span><span class="op" id="6366189">]</span><span class="op" id="6366190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366194"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366196">.</span><span class="ident" id="6366197">freeConn</span>&nbsp;<span class="op" id="6366206">=</span>&nbsp;<span class="ident" id="6366208"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366210">.</span><span class="ident" id="6366211">freeConn</span><span class="op" id="6366219">[</span><span class="op" id="6366220">:</span><span class="ident" id="6366221"><a href="/database/sql/sql.go.html#6366099">c</a></span><span class="op" id="6366222">-</span><span class="num" id="6366223">1</span><span class="op" id="6366224">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366228"><a href="/database/sql/sql.go.html#6366132">conn</a></span><span class="op" id="6366232">.</span><span class="ident" id="6366233">inUse</span>&nbsp;<span class="op" id="6366239">=</span>&nbsp;<span class="builtintype" id="6366241">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366248"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366250">.</span><span class="ident" id="6366251">mu</span><span class="op" id="6366253">.</span><span class="ident" id="6366254">Unlock</span><span class="op" id="6366260">(</span><span class="op" id="6366261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366265">return</span>&nbsp;<span class="ident" id="6366272"><a href="/database/sql/sql.go.html#6366132">conn</a></span><span class="op" id="6366276">,</span>&nbsp;<span class="ident" id="6366278">nil</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366287"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366289">.</span><span class="ident" id="6366290">numOpen</span><span class="op" id="6366297">++</span>&nbsp;<span class="comment" id="6366300">//&nbsp;optimistically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366319"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366321">.</span><span class="ident" id="6366322">mu</span><span class="op" id="6366324">.</span><span class="ident" id="6366325">Unlock</span><span class="op" id="6366331">(</span><span class="op" id="6366332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366335">ci</span><span class="op" id="6366337">,</span>&nbsp;<span class="ident" id="6366339">err</span>&nbsp;<span class="op" id="6366343">:=</span>&nbsp;<span class="ident" id="6366346"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366348">.</span><span class="ident" id="6366349">driver</span><span class="op" id="6366355">.</span><span class="ident" id="6366356">Open</span><span class="op" id="6366360">(</span><span class="ident" id="6366361"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366363">.</span><span class="ident" id="6366364">dsn</span><span class="op" id="6366367">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366370">if</span>&nbsp;<span class="ident" id="6366373"><a href="/database/sql/sql.go.html#6366339">err</a></span>&nbsp;<span class="op" id="6366377">!=</span>&nbsp;<span class="ident" id="6366380">nil</span>&nbsp;<span class="op" id="6366384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366388"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366390">.</span><span class="ident" id="6366391">mu</span><span class="op" id="6366393">.</span><span class="ident" id="6366394">Lock</span><span class="op" id="6366398">(</span><span class="op" id="6366399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366403"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366405">.</span><span class="ident" id="6366406">numOpen</span><span class="op" id="6366413">--</span>&nbsp;<span class="comment" id="6366416">//&nbsp;correct&nbsp;for&nbsp;earlier&nbsp;optimism</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366450"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366452">.</span><span class="ident" id="6366453">mu</span><span class="op" id="6366455">.</span><span class="ident" id="6366456">Unlock</span><span class="op" id="6366462">(</span><span class="op" id="6366463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366467">return</span>&nbsp;<span class="ident" id="6366474">nil</span><span class="op" id="6366477">,</span>&nbsp;<span class="ident" id="6366479"><a href="/database/sql/sql.go.html#6366339">err</a></span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366484">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366487"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366489">.</span><span class="ident" id="6366490">mu</span><span class="op" id="6366492">.</span><span class="ident" id="6366493">Lock</span><span class="op" id="6366497">(</span><span class="op" id="6366498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366501">dc</span>&nbsp;<span class="op" id="6366504">:=</span>&nbsp;<span class="op" id="6366507">&amp;</span><span class="ident" id="6366508"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6366518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366522">db</span><span class="op" id="6366524">:</span>&nbsp;<span class="ident" id="6366526"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366528">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366532">ci</span><span class="op" id="6366534">:</span>&nbsp;<span class="ident" id="6366536"><a href="/database/sql/sql.go.html#6366335">ci</a></span><span class="op" id="6366538">,</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6366541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366544"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366546">.</span><span class="ident" id="6366547">addDepLocked</span><span class="op" id="6366559">(</span><span class="ident" id="6366560"><a href="/database/sql/sql.go.html#6366501">dc</a></span><span class="op" id="6366562">,</span>&nbsp;<span class="ident" id="6366564"><a href="/database/sql/sql.go.html#6366501">dc</a></span><span class="op" id="6366566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366569"><a href="/database/sql/sql.go.html#6366501">dc</a></span><span class="op" id="6366571">.</span><span class="ident" id="6366572">inUse</span>&nbsp;<span class="op" id="6366578">=</span>&nbsp;<span class="builtintype" id="6366580">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366586"><a href="/database/sql/sql.go.html#6365455">db</a></span><span class="op" id="6366588">.</span><span class="ident" id="6366589">mu</span><span class="op" id="6366591">.</span><span class="ident" id="6366592">Unlock</span><span class="op" id="6366598">(</span><span class="op" id="6366599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6366602">return</span>&nbsp;<span class="ident" id="6366609"><a href="/database/sql/sql.go.html#6366501">dc</a></span><span class="op" id="6366611">,</span>&nbsp;<span class="ident" id="6366613">nil</span><br>
<span class="lineno">680</span><span class="op" id="6366617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6366620">var</span>&nbsp;<span class="op" id="6366624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366627">errConnClosed</span>&nbsp;<span class="op" id="6366641">=</span>&nbsp;<span class="ident" id="6366643"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6366649">.</span><span class="ident" id="6366650">New</span><span class="op" id="6366653">(</span><span class="string" id="6366654">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;closed&#34;</span><span class="op" id="6366709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6366712">errConnBusy</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6366726">=</span>&nbsp;<span class="ident" id="6366728"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6366734">.</span><span class="ident" id="6366735">New</span><span class="op" id="6366738">(</span><span class="string" id="6366739">&#34;database/sql:&nbsp;internal&nbsp;sentinel&nbsp;error:&nbsp;conn&nbsp;is&nbsp;busy&#34;</span><span class="op" id="6366792">)</span><br>
<span class="lineno">685</span><span class="op" id="6366794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6366797">//&nbsp;connIfFree&nbsp;returns&nbsp;(wanted,&nbsp;nil)&nbsp;if&nbsp;wanted&nbsp;is&nbsp;still&nbsp;a&nbsp;valid&nbsp;conn&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="6366869">//&nbsp;isn&#39;t&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="comment" id="6366886">//</span><br>
<span class="lineno">690</span><span class="comment" id="6366889">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnClosed&nbsp;if&nbsp;the&nbsp;connection&nbsp;if&nbsp;the&nbsp;requested&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="6366965">//&nbsp;is&nbsp;invalid&nbsp;because&nbsp;it&#39;s&nbsp;been&nbsp;closed.</span><br>
<span class="lineno"></span><span class="comment" id="6367005">//</span><br>
<span class="lineno"></span><span class="comment" id="6367008">//&nbsp;The&nbsp;error&nbsp;is&nbsp;errConnBusy&nbsp;if&nbsp;the&nbsp;connection&nbsp;is&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="6367065">func</span>&nbsp;<span class="op" id="6367070">(</span><span class="ident" id="6367071">db</span>&nbsp;<span class="op" id="6367074">*</span><span class="ident" id="6367075"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6367077">)</span>&nbsp;<span class="ident" id="6367079">connIfFree</span><span class="op" id="6367089">(</span><span class="ident" id="6367090">wanted</span>&nbsp;<span class="op" id="6367097">*</span><span class="ident" id="6367098"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6367108">)</span>&nbsp;<span class="op" id="6367110">(</span><span class="op" id="6367111">*</span><span class="ident" id="6367112"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6367122">,</span>&nbsp;<span class="builtintype" id="6367124">error</span><span class="op" id="6367129">)</span>&nbsp;<span class="op" id="6367131">{</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367134"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367136">.</span><span class="ident" id="6367137">mu</span><span class="op" id="6367139">.</span><span class="ident" id="6367140">Lock</span><span class="op" id="6367144">(</span><span class="op" id="6367145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367148">defer</span>&nbsp;<span class="ident" id="6367154"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367156">.</span><span class="ident" id="6367157">mu</span><span class="op" id="6367159">.</span><span class="ident" id="6367160">Unlock</span><span class="op" id="6367166">(</span><span class="op" id="6367167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367170">if</span>&nbsp;<span class="ident" id="6367173"><a href="/database/sql/sql.go.html#6367090">wanted</a></span><span class="op" id="6367179">.</span><span class="ident" id="6367180">dbmuClosed</span>&nbsp;<span class="op" id="6367191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367195">return</span>&nbsp;<span class="ident" id="6367202">nil</span><span class="op" id="6367205">,</span>&nbsp;<span class="ident" id="6367207"><a href="/database/sql/sql.go.html#6366627">errConnClosed</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367222">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367225">if</span>&nbsp;<span class="ident" id="6367228"><a href="/database/sql/sql.go.html#6367090">wanted</a></span><span class="op" id="6367234">.</span><span class="ident" id="6367235">inUse</span>&nbsp;<span class="op" id="6367241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367245">return</span>&nbsp;<span class="ident" id="6367252">nil</span><span class="op" id="6367255">,</span>&nbsp;<span class="ident" id="6367257"><a href="/database/sql/sql.go.html#6366712">errConnBusy</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367273">idx</span>&nbsp;<span class="op" id="6367277">:=</span>&nbsp;<span class="op" id="6367280">-</span><span class="num" id="6367281">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367284">for</span>&nbsp;<span class="ident" id="6367288">ii</span><span class="op" id="6367290">,</span>&nbsp;<span class="ident" id="6367292">v</span>&nbsp;<span class="op" id="6367294">:=</span>&nbsp;<span class="keyword" id="6367297">range</span>&nbsp;<span class="ident" id="6367303"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367305">.</span><span class="ident" id="6367306">freeConn</span>&nbsp;<span class="op" id="6367315">{</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367319">if</span>&nbsp;<span class="ident" id="6367322"><a href="/database/sql/sql.go.html#6367292">v</a></span>&nbsp;<span class="op" id="6367324">==</span>&nbsp;<span class="ident" id="6367327"><a href="/database/sql/sql.go.html#6367090">wanted</a></span>&nbsp;<span class="op" id="6367334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367339"><a href="/database/sql/sql.go.html#6367273">idx</a></span>&nbsp;<span class="op" id="6367343">=</span>&nbsp;<span class="ident" id="6367345"><a href="/database/sql/sql.go.html#6367288">ii</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367351">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367362">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367365">if</span>&nbsp;<span class="ident" id="6367368"><a href="/database/sql/sql.go.html#6367273">idx</a></span>&nbsp;<span class="op" id="6367372">&gt;=</span>&nbsp;<span class="num" id="6367375">0</span>&nbsp;<span class="op" id="6367377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367381"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367383">.</span><span class="ident" id="6367384">freeConn</span>&nbsp;<span class="op" id="6367393">=</span>&nbsp;<span class="builtinfunc" id="6367395">append</span><span class="op" id="6367401">(</span><span class="ident" id="6367402"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367404">.</span><span class="ident" id="6367405">freeConn</span><span class="op" id="6367413">[</span><span class="op" id="6367414">:</span><span class="ident" id="6367415"><a href="/database/sql/sql.go.html#6367273">idx</a></span><span class="op" id="6367418">]</span><span class="op" id="6367419">,</span>&nbsp;<span class="ident" id="6367421"><a href="/database/sql/sql.go.html#6367071">db</a></span><span class="op" id="6367423">.</span><span class="ident" id="6367424">freeConn</span><span class="op" id="6367432">[</span><span class="ident" id="6367433"><a href="/database/sql/sql.go.html#6367273">idx</a></span><span class="op" id="6367436">+</span><span class="num" id="6367437">1</span><span class="op" id="6367438">:</span><span class="op" id="6367439">]</span><span class="op" id="6367440">...</span><span class="op" id="6367443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6367447"><a href="/database/sql/sql.go.html#6367090">wanted</a></span><span class="op" id="6367453">.</span><span class="ident" id="6367454">inUse</span>&nbsp;<span class="op" id="6367460">=</span>&nbsp;<span class="builtintype" id="6367462">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367469">return</span>&nbsp;<span class="ident" id="6367476"><a href="/database/sql/sql.go.html#6367090">wanted</a></span><span class="op" id="6367482">,</span>&nbsp;<span class="ident" id="6367484">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6367489">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367492">//&nbsp;TODO(bradfitz):&nbsp;shouldn&#39;t&nbsp;get&nbsp;here.&nbsp;After&nbsp;Go&nbsp;1.1,&nbsp;change&nbsp;this&nbsp;to:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367562">//&nbsp;panic(&#34;connIfFree&nbsp;call&nbsp;requested&nbsp;a&nbsp;non-closed,&nbsp;non-busy,&nbsp;non-free&nbsp;conn&#34;)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367639">//&nbsp;Which&nbsp;passes&nbsp;all&nbsp;the&nbsp;tests,&nbsp;but&nbsp;I&#39;m&nbsp;too&nbsp;paranoid&nbsp;to&nbsp;include&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367708">//&nbsp;late&nbsp;in&nbsp;Go&nbsp;1.1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6367728">//&nbsp;Instead,&nbsp;treat&nbsp;it&nbsp;like&nbsp;a&nbsp;busy&nbsp;connection:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6367774">return</span>&nbsp;<span class="ident" id="6367781">nil</span><span class="op" id="6367784">,</span>&nbsp;<span class="ident" id="6367786"><a href="/database/sql/sql.go.html#6366712">errConnBusy</a></span><br>
<span class="lineno"></span><span class="op" id="6367798">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6367801">//&nbsp;putConnHook&nbsp;is&nbsp;a&nbsp;hook&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span><span class="keyword" id="6367839">var</span>&nbsp;<span class="ident" id="6367843">putConnHook</span>&nbsp;<span class="keyword" id="6367855">func</span><span class="op" id="6367859">(</span><span class="op" id="6367860">*</span><span class="ident" id="6367861"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6367863">,</span>&nbsp;<span class="op" id="6367865">*</span><span class="ident" id="6367866"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6367876">)</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="6367879">//&nbsp;noteUnusedDriverStatement&nbsp;notes&nbsp;that&nbsp;si&nbsp;is&nbsp;no&nbsp;longer&nbsp;used&nbsp;and&nbsp;should</span><br>
<span class="lineno"></span><span class="comment" id="6367951">//&nbsp;be&nbsp;closed&nbsp;whenever&nbsp;possible&nbsp;(when&nbsp;c&nbsp;is&nbsp;next&nbsp;not&nbsp;in&nbsp;use),&nbsp;unless&nbsp;c&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="6368023">//&nbsp;already&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="6368042">func</span>&nbsp;<span class="op" id="6368047">(</span><span class="ident" id="6368048">db</span>&nbsp;<span class="op" id="6368051">*</span><span class="ident" id="6368052"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6368054">)</span>&nbsp;<span class="ident" id="6368056">noteUnusedDriverStatement</span><span class="op" id="6368081">(</span><span class="ident" id="6368082">c</span>&nbsp;<span class="op" id="6368084">*</span><span class="ident" id="6368085"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6368095">,</span>&nbsp;<span class="ident" id="6368097">si</span>&nbsp;<span class="ident" id="6368100"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6368106">.</span><span class="ident" id="6368107">Stmt</span><span class="op" id="6368111">)</span>&nbsp;<span class="op" id="6368113">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368116"><a href="/database/sql/sql.go.html#6368048">db</a></span><span class="op" id="6368118">.</span><span class="ident" id="6368119">mu</span><span class="op" id="6368121">.</span><span class="ident" id="6368122">Lock</span><span class="op" id="6368126">(</span><span class="op" id="6368127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368130">defer</span>&nbsp;<span class="ident" id="6368136"><a href="/database/sql/sql.go.html#6368048">db</a></span><span class="op" id="6368138">.</span><span class="ident" id="6368139">mu</span><span class="op" id="6368141">.</span><span class="ident" id="6368142">Unlock</span><span class="op" id="6368148">(</span><span class="op" id="6368149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368152">if</span>&nbsp;<span class="ident" id="6368155"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368156">.</span><span class="ident" id="6368157">inUse</span>&nbsp;<span class="op" id="6368163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368167"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368168">.</span><span class="ident" id="6368169">onPut</span>&nbsp;<span class="op" id="6368175">=</span>&nbsp;<span class="builtinfunc" id="6368177">append</span><span class="op" id="6368183">(</span><span class="ident" id="6368184"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368185">.</span><span class="ident" id="6368186">onPut</span><span class="op" id="6368191">,</span>&nbsp;<span class="keyword" id="6368193">func</span><span class="op" id="6368197">(</span><span class="op" id="6368198">)</span>&nbsp;<span class="op" id="6368200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368205"><a href="/database/sql/sql.go.html#6368097">si</a></span><span class="op" id="6368207">.</span><span class="ident" id="6368208">Close</span><span class="op" id="6368213">(</span><span class="op" id="6368214">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368218">}</span><span class="op" id="6368219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368222">}</span>&nbsp;<span class="keyword" id="6368224">else</span>&nbsp;<span class="op" id="6368229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368233"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368234">.</span><span class="ident" id="6368235">Lock</span><span class="op" id="6368239">(</span><span class="op" id="6368240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368244">defer</span>&nbsp;<span class="ident" id="6368250"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368251">.</span><span class="ident" id="6368252">Unlock</span><span class="op" id="6368258">(</span><span class="op" id="6368259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368263">if</span>&nbsp;<span class="op" id="6368266">!</span><span class="ident" id="6368267"><a href="/database/sql/sql.go.html#6368082">c</a></span><span class="op" id="6368268">.</span><span class="ident" id="6368269">finalClosed</span>&nbsp;<span class="op" id="6368281">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368286"><a href="/database/sql/sql.go.html#6368097">si</a></span><span class="op" id="6368288">.</span><span class="ident" id="6368289">Close</span><span class="op" id="6368294">(</span><span class="op" id="6368295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368302">}</span><br>
<span class="lineno"></span><span class="op" id="6368304">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">745</span><span class="comment" id="6368307">//&nbsp;debugGetPut&nbsp;determines&nbsp;whether&nbsp;getConn&nbsp;&amp;&nbsp;putConn&nbsp;calls&#39;&nbsp;stack&nbsp;traces</span><br>
<span class="lineno"></span><span class="comment" id="6368379">//&nbsp;are&nbsp;returned&nbsp;for&nbsp;more&nbsp;verbose&nbsp;crashes.</span><br>
<span class="lineno"></span><span class="keyword" id="6368421">const</span>&nbsp;<span class="ident" id="6368427">debugGetPut</span>&nbsp;<span class="op" id="6368439">=</span>&nbsp;<span class="builtintype" id="6368441">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6368448">//&nbsp;putConn&nbsp;adds&nbsp;a&nbsp;connection&nbsp;to&nbsp;the&nbsp;db&#39;s&nbsp;free&nbsp;pool.</span><br>
<span class="lineno">750</span><span class="comment" id="6368500">//&nbsp;err&nbsp;is&nbsp;optionally&nbsp;the&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;on&nbsp;this&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6368570">func</span>&nbsp;<span class="op" id="6368575">(</span><span class="ident" id="6368576">db</span>&nbsp;<span class="op" id="6368579">*</span><span class="ident" id="6368580"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6368582">)</span>&nbsp;<span class="ident" id="6368584">putConn</span><span class="op" id="6368591">(</span><span class="ident" id="6368592">dc</span>&nbsp;<span class="op" id="6368595">*</span><span class="ident" id="6368596"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6368606">,</span>&nbsp;<span class="ident" id="6368608">err</span>&nbsp;<span class="builtintype" id="6368612">error</span><span class="op" id="6368617">)</span>&nbsp;<span class="op" id="6368619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368622"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6368624">.</span><span class="ident" id="6368625">mu</span><span class="op" id="6368627">.</span><span class="ident" id="6368628">Lock</span><span class="op" id="6368632">(</span><span class="op" id="6368633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368636">if</span>&nbsp;<span class="op" id="6368639">!</span><span class="ident" id="6368640"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368642">.</span><span class="ident" id="6368643">inUse</span>&nbsp;<span class="op" id="6368649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368653">if</span>&nbsp;<span class="ident" id="6368656"><a href="/database/sql/sql.go.html#6368427">debugGetPut</a></span>&nbsp;<span class="op" id="6368668">{</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368673"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6368676">.</span><span class="ident" id="6368677">Printf</span><span class="op" id="6368683">(</span><span class="string" id="6368684">&#34;putConn(%v)&nbsp;DUPLICATE&nbsp;was:&nbsp;%s\n\nPREVIOUS&nbsp;was:&nbsp;%s&#34;</span><span class="op" id="6368735">,</span>&nbsp;<span class="ident" id="6368737"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368739">,</span>&nbsp;<span class="ident" id="6368741"><a href="/database/sql/sql.go.html#6394298">stack</a></span><span class="op" id="6368746">(</span><span class="op" id="6368747">)</span><span class="op" id="6368748">,</span>&nbsp;<span class="ident" id="6368750"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6368752">.</span><span class="ident" id="6368753">lastPut</span><span class="op" id="6368760">[</span><span class="ident" id="6368761"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368763">]</span><span class="op" id="6368764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6368772">panic</span><span class="op" id="6368777">(</span><span class="string" id="6368778">&#34;sql:&nbsp;connection&nbsp;returned&nbsp;that&nbsp;was&nbsp;never&nbsp;out&#34;</span><span class="op" id="6368823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368826">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368829">if</span>&nbsp;<span class="ident" id="6368832"><a href="/database/sql/sql.go.html#6368427">debugGetPut</a></span>&nbsp;<span class="op" id="6368844">{</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368848"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6368850">.</span><span class="ident" id="6368851">lastPut</span><span class="op" id="6368858">[</span><span class="ident" id="6368859"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368861">]</span>&nbsp;<span class="op" id="6368863">=</span>&nbsp;<span class="ident" id="6368865"><a href="/database/sql/sql.go.html#6394298">stack</a></span><span class="op" id="6368870">(</span><span class="op" id="6368871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368877"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368879">.</span><span class="ident" id="6368880">inUse</span>&nbsp;<span class="op" id="6368886">=</span>&nbsp;<span class="builtintype" id="6368888">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368896">for</span>&nbsp;<span class="ident" id="6368900">_</span><span class="op" id="6368901">,</span>&nbsp;<span class="ident" id="6368903">fn</span>&nbsp;<span class="op" id="6368906">:=</span>&nbsp;<span class="keyword" id="6368909">range</span>&nbsp;<span class="ident" id="6368915"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368917">.</span><span class="ident" id="6368918">onPut</span>&nbsp;<span class="op" id="6368924">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368928"><a href="/database/sql/sql.go.html#6368903">fn</a></span><span class="op" id="6368930">(</span><span class="op" id="6368931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6368934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6368937"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6368939">.</span><span class="ident" id="6368940">onPut</span>&nbsp;<span class="op" id="6368946">=</span>&nbsp;<span class="ident" id="6368948">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6368954">if</span>&nbsp;<span class="ident" id="6368957"><a href="/database/sql/sql.go.html#6368608">err</a></span>&nbsp;<span class="op" id="6368961">==</span>&nbsp;<span class="ident" id="6368964"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6368970">.</span><span class="ident" id="6368971">ErrBadConn</span>&nbsp;<span class="op" id="6368982">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6368986">//&nbsp;Don&#39;t&nbsp;reuse&nbsp;bad&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6369020">//&nbsp;Since&nbsp;the&nbsp;conn&nbsp;is&nbsp;considered&nbsp;bad&nbsp;and&nbsp;is&nbsp;being&nbsp;discarded,&nbsp;treat&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6369091">//&nbsp;as&nbsp;closed.&nbsp;Don&#39;t&nbsp;decrement&nbsp;the&nbsp;open&nbsp;count&nbsp;here,&nbsp;finalClose&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6369160">//&nbsp;take&nbsp;care&nbsp;of&nbsp;that.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369184"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6369186">.</span><span class="ident" id="6369187">maybeOpenNewConnections</span><span class="op" id="6369210">(</span><span class="op" id="6369211">)</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369215"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6369217">.</span><span class="ident" id="6369218">mu</span><span class="op" id="6369220">.</span><span class="ident" id="6369221">Unlock</span><span class="op" id="6369227">(</span><span class="op" id="6369228">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369232"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6369234">.</span><span class="ident" id="6369235">Close</span><span class="op" id="6369240">(</span><span class="op" id="6369241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369245">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369256">if</span>&nbsp;<span class="ident" id="6369259"><a href="/database/sql/sql.go.html#6367843">putConnHook</a></span>&nbsp;<span class="op" id="6369271">!=</span>&nbsp;<span class="ident" id="6369274">nil</span>&nbsp;<span class="op" id="6369278">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369282"><a href="/database/sql/sql.go.html#6367843">putConnHook</a></span><span class="op" id="6369293">(</span><span class="ident" id="6369294"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6369296">,</span>&nbsp;<span class="ident" id="6369298"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6369300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369306">added</span>&nbsp;<span class="op" id="6369312">:=</span>&nbsp;<span class="ident" id="6369315"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6369317">.</span><span class="ident" id="6369318">putConnDBLocked</span><span class="op" id="6369333">(</span><span class="ident" id="6369334"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6369336">,</span>&nbsp;<span class="ident" id="6369338">nil</span><span class="op" id="6369341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369344"><a href="/database/sql/sql.go.html#6368576">db</a></span><span class="op" id="6369346">.</span><span class="ident" id="6369347">mu</span><span class="op" id="6369349">.</span><span class="ident" id="6369350">Unlock</span><span class="op" id="6369356">(</span><span class="op" id="6369357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369361">if</span>&nbsp;<span class="op" id="6369364">!</span><span class="ident" id="6369365"><a href="/database/sql/sql.go.html#6369306">added</a></span>&nbsp;<span class="op" id="6369371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6369375"><a href="/database/sql/sql.go.html#6368592">dc</a></span><span class="op" id="6369377">.</span><span class="ident" id="6369378">Close</span><span class="op" id="6369383">(</span><span class="op" id="6369384">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6369387">}</span><br>
<span class="lineno"></span><span class="op" id="6369389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">790</span><span class="comment" id="6369392">//&nbsp;Satisfy&nbsp;a&nbsp;connRequest&nbsp;or&nbsp;put&nbsp;the&nbsp;driverConn&nbsp;in&nbsp;the&nbsp;idle&nbsp;pool&nbsp;and&nbsp;return&nbsp;true</span><br>
<span class="lineno"></span><span class="comment" id="6369472">//&nbsp;or&nbsp;return&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="6369492">//&nbsp;putConnDBLocked&nbsp;will&nbsp;satisfy&nbsp;a&nbsp;connRequest&nbsp;if&nbsp;there&nbsp;is&nbsp;one,&nbsp;or&nbsp;it&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="6369566">//&nbsp;return&nbsp;the&nbsp;*driverConn&nbsp;to&nbsp;the&nbsp;freeConn&nbsp;list&nbsp;if&nbsp;err&nbsp;==&nbsp;nil&nbsp;and&nbsp;the&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="6369640">//&nbsp;connection&nbsp;limit&nbsp;will&nbsp;not&nbsp;be&nbsp;exceeded.</span><br>
<span class="lineno">795</span><span class="comment" id="6369682">//&nbsp;If&nbsp;err&nbsp;!=&nbsp;nil,&nbsp;the&nbsp;value&nbsp;of&nbsp;dc&nbsp;is&nbsp;ignored.</span><br>
<span class="lineno"></span><span class="comment" id="6369728">//&nbsp;If&nbsp;err&nbsp;==&nbsp;nil,&nbsp;then&nbsp;dc&nbsp;must&nbsp;not&nbsp;equal&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="6369774">//&nbsp;If&nbsp;a&nbsp;connRequest&nbsp;was&nbsp;fulfilled&nbsp;or&nbsp;the&nbsp;*driverConn&nbsp;was&nbsp;placed&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6369845">//&nbsp;freeConn&nbsp;list,&nbsp;then&nbsp;true&nbsp;is&nbsp;returned,&nbsp;otherwise&nbsp;false&nbsp;is&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="6369915">func</span>&nbsp;<span class="op" id="6369920">(</span><span class="ident" id="6369921">db</span>&nbsp;<span class="op" id="6369924">*</span><span class="ident" id="6369925"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6369927">)</span>&nbsp;<span class="ident" id="6369929">putConnDBLocked</span><span class="op" id="6369944">(</span><span class="ident" id="6369945">dc</span>&nbsp;<span class="op" id="6369948">*</span><span class="ident" id="6369949"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6369959">,</span>&nbsp;<span class="ident" id="6369961">err</span>&nbsp;<span class="builtintype" id="6369965">error</span><span class="op" id="6369970">)</span>&nbsp;<span class="builtintype" id="6369972">bool</span>&nbsp;<span class="op" id="6369977">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6369980">if</span>&nbsp;<span class="ident" id="6369983">c</span>&nbsp;<span class="op" id="6369985">:=</span>&nbsp;<span class="builtinfunc" id="6369988">len</span><span class="op" id="6369991">(</span><span class="ident" id="6369992"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6369994">.</span><span class="ident" id="6369995">connRequests</span><span class="op" id="6370007">)</span><span class="op" id="6370008">;</span>&nbsp;<span class="ident" id="6370010"><a href="/database/sql/sql.go.html#6369983">c</a></span>&nbsp;<span class="op" id="6370012">&gt;</span>&nbsp;<span class="num" id="6370014">0</span>&nbsp;<span class="op" id="6370016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370020">req</span>&nbsp;<span class="op" id="6370024">:=</span>&nbsp;<span class="ident" id="6370027"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370029">.</span><span class="ident" id="6370030">connRequests</span><span class="op" id="6370042">[</span><span class="num" id="6370043">0</span><span class="op" id="6370044">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370048">//&nbsp;This&nbsp;copy&nbsp;is&nbsp;O(n)&nbsp;but&nbsp;in&nbsp;practice&nbsp;faster&nbsp;than&nbsp;a&nbsp;linked&nbsp;list.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370114">//&nbsp;TODO:&nbsp;consider&nbsp;compacting&nbsp;it&nbsp;down&nbsp;less&nbsp;often&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6370168">//&nbsp;moving&nbsp;the&nbsp;base&nbsp;instead?</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6370198">copy</span><span class="op" id="6370202">(</span><span class="ident" id="6370203"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370205">.</span><span class="ident" id="6370206">connRequests</span><span class="op" id="6370218">,</span>&nbsp;<span class="ident" id="6370220"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370222">.</span><span class="ident" id="6370223">connRequests</span><span class="op" id="6370235">[</span><span class="num" id="6370236">1</span><span class="op" id="6370237">:</span><span class="op" id="6370238">]</span><span class="op" id="6370239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370243"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370245">.</span><span class="ident" id="6370246">connRequests</span>&nbsp;<span class="op" id="6370259">=</span>&nbsp;<span class="ident" id="6370261"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370263">.</span><span class="ident" id="6370264">connRequests</span><span class="op" id="6370276">[</span><span class="op" id="6370277">:</span><span class="ident" id="6370278"><a href="/database/sql/sql.go.html#6369983">c</a></span><span class="op" id="6370279">-</span><span class="num" id="6370280">1</span><span class="op" id="6370281">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370285">if</span>&nbsp;<span class="ident" id="6370288"><a href="/database/sql/sql.go.html#6369961">err</a></span>&nbsp;<span class="op" id="6370292">==</span>&nbsp;<span class="ident" id="6370295">nil</span>&nbsp;<span class="op" id="6370299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370304"><a href="/database/sql/sql.go.html#6369945">dc</a></span><span class="op" id="6370306">.</span><span class="ident" id="6370307">inUse</span>&nbsp;<span class="op" id="6370313">=</span>&nbsp;<span class="builtintype" id="6370315">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370322">}</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370326"><a href="/database/sql/sql.go.html#6370020">req</a></span>&nbsp;<span class="op" id="6370330">&lt;-</span>&nbsp;<span class="ident" id="6370333"><a href="/database/sql/sql.go.html#6365285">connRequest</a></span><span class="op" id="6370344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370349">conn</span><span class="op" id="6370353">:</span>&nbsp;<span class="ident" id="6370355"><a href="/database/sql/sql.go.html#6369945">dc</a></span><span class="op" id="6370357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370362">err</span><span class="op" id="6370365">:</span>&nbsp;&nbsp;<span class="ident" id="6370368"><a href="/database/sql/sql.go.html#6369961">err</a></span><span class="op" id="6370371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370379">return</span>&nbsp;<span class="builtintype" id="6370386">true</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370392">}</span>&nbsp;<span class="keyword" id="6370394">else</span>&nbsp;<span class="keyword" id="6370399">if</span>&nbsp;<span class="ident" id="6370402"><a href="/database/sql/sql.go.html#6369961">err</a></span>&nbsp;<span class="op" id="6370406">==</span>&nbsp;<span class="ident" id="6370409">nil</span>&nbsp;<span class="op" id="6370413">&amp;&amp;</span>&nbsp;<span class="op" id="6370416">!</span><span class="ident" id="6370417"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370419">.</span><span class="ident" id="6370420">closed</span>&nbsp;<span class="op" id="6370427">&amp;&amp;</span>&nbsp;<span class="ident" id="6370430"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370432">.</span><span class="ident" id="6370433">maxIdleConnsLocked</span><span class="op" id="6370451">(</span><span class="op" id="6370452">)</span>&nbsp;<span class="op" id="6370454">&gt;</span>&nbsp;<span class="builtinfunc" id="6370456">len</span><span class="op" id="6370459">(</span><span class="ident" id="6370460"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370462">.</span><span class="ident" id="6370463">freeConn</span><span class="op" id="6370471">)</span>&nbsp;<span class="op" id="6370473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370477"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370479">.</span><span class="ident" id="6370480">freeConn</span>&nbsp;<span class="op" id="6370489">=</span>&nbsp;<span class="builtinfunc" id="6370491">append</span><span class="op" id="6370497">(</span><span class="ident" id="6370498"><a href="/database/sql/sql.go.html#6369921">db</a></span><span class="op" id="6370500">.</span><span class="ident" id="6370501">freeConn</span><span class="op" id="6370509">,</span>&nbsp;<span class="ident" id="6370511"><a href="/database/sql/sql.go.html#6369945">dc</a></span><span class="op" id="6370513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370517">return</span>&nbsp;<span class="builtintype" id="6370524">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6370530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370533">return</span>&nbsp;<span class="builtintype" id="6370540">false</span><br>
<span class="lineno">820</span><span class="op" id="6370546">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6370549">//&nbsp;maxBadConnRetries&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;maximum&nbsp;retries&nbsp;if&nbsp;the&nbsp;driver&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="6370625">//&nbsp;driver.ErrBadConn&nbsp;to&nbsp;signal&nbsp;a&nbsp;broken&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6370677">const</span>&nbsp;<span class="ident" id="6370683">maxBadConnRetries</span>&nbsp;<span class="op" id="6370701">=</span>&nbsp;<span class="num" id="6370703">10</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="comment" id="6370707">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;later&nbsp;queries&nbsp;or&nbsp;executions.</span><br>
<span class="lineno"></span><span class="comment" id="6370780">//&nbsp;Multiple&nbsp;queries&nbsp;or&nbsp;executions&nbsp;may&nbsp;be&nbsp;run&nbsp;concurrently&nbsp;from&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6370847">//&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="6370870">func</span>&nbsp;<span class="op" id="6370875">(</span><span class="ident" id="6370876">db</span>&nbsp;<span class="op" id="6370879">*</span><span class="ident" id="6370880"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6370882">)</span>&nbsp;<span class="ident" id="6370884">Prepare</span><span class="op" id="6370891">(</span><span class="ident" id="6370892">query</span>&nbsp;<span class="builtintype" id="6370898">string</span><span class="op" id="6370904">)</span>&nbsp;<span class="op" id="6370906">(</span><span class="op" id="6370907">*</span><span class="ident" id="6370908"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6370912">,</span>&nbsp;<span class="builtintype" id="6370914">error</span><span class="op" id="6370919">)</span>&nbsp;<span class="op" id="6370921">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370924">var</span>&nbsp;<span class="ident" id="6370928">stmt</span>&nbsp;<span class="op" id="6370933">*</span><span class="ident" id="6370934"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370940">var</span>&nbsp;<span class="ident" id="6370944">err</span>&nbsp;<span class="builtintype" id="6370948">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6370955">for</span>&nbsp;<span class="ident" id="6370959">i</span>&nbsp;<span class="op" id="6370961">:=</span>&nbsp;<span class="num" id="6370964">0</span><span class="op" id="6370965">;</span>&nbsp;<span class="ident" id="6370967"><a href="/database/sql/sql.go.html#6370959">i</a></span>&nbsp;<span class="op" id="6370969">&lt;</span>&nbsp;<span class="ident" id="6370971"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6370988">;</span>&nbsp;<span class="ident" id="6370990"><a href="/database/sql/sql.go.html#6370959">i</a></span><span class="op" id="6370991">++</span>&nbsp;<span class="op" id="6370994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6370998"><a href="/database/sql/sql.go.html#6370928">stmt</a></span><span class="op" id="6371002">,</span>&nbsp;<span class="ident" id="6371004"><a href="/database/sql/sql.go.html#6370944">err</a></span>&nbsp;<span class="op" id="6371008">=</span>&nbsp;<span class="ident" id="6371010"><a href="/database/sql/sql.go.html#6370876">db</a></span><span class="op" id="6371012">.</span><span class="ident" id="6371013">prepare</span><span class="op" id="6371020">(</span><span class="ident" id="6371021"><a href="/database/sql/sql.go.html#6370892">query</a></span><span class="op" id="6371026">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371030">if</span>&nbsp;<span class="ident" id="6371033"><a href="/database/sql/sql.go.html#6370944">err</a></span>&nbsp;<span class="op" id="6371037">!=</span>&nbsp;<span class="ident" id="6371040"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6371046">.</span><span class="ident" id="6371047">ErrBadConn</span>&nbsp;<span class="op" id="6371058">{</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371063">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371071">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371077">return</span>&nbsp;<span class="ident" id="6371084"><a href="/database/sql/sql.go.html#6370928">stmt</a></span><span class="op" id="6371088">,</span>&nbsp;<span class="ident" id="6371090"><a href="/database/sql/sql.go.html#6370944">err</a></span><br>
<span class="lineno"></span><span class="op" id="6371094">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="6371097">func</span>&nbsp;<span class="op" id="6371102">(</span><span class="ident" id="6371103">db</span>&nbsp;<span class="op" id="6371106">*</span><span class="ident" id="6371107"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6371109">)</span>&nbsp;<span class="ident" id="6371111">prepare</span><span class="op" id="6371118">(</span><span class="ident" id="6371119">query</span>&nbsp;<span class="builtintype" id="6371125">string</span><span class="op" id="6371131">)</span>&nbsp;<span class="op" id="6371133">(</span><span class="op" id="6371134">*</span><span class="ident" id="6371135"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6371139">,</span>&nbsp;<span class="builtintype" id="6371141">error</span><span class="op" id="6371146">)</span>&nbsp;<span class="op" id="6371148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371151">//&nbsp;TODO:&nbsp;check&nbsp;if&nbsp;db.driver&nbsp;supports&nbsp;an&nbsp;optional</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371201">//&nbsp;driver.Preparer&nbsp;interface&nbsp;and&nbsp;call&nbsp;that&nbsp;instead,&nbsp;if&nbsp;so,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371261">//&nbsp;otherwise&nbsp;we&nbsp;make&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;that&#39;s&nbsp;bound</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371317">//&nbsp;to&nbsp;a&nbsp;connection,&nbsp;and&nbsp;to&nbsp;execute&nbsp;this&nbsp;prepared&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371377">//&nbsp;we&nbsp;either&nbsp;need&nbsp;to&nbsp;use&nbsp;this&nbsp;connection&nbsp;(if&nbsp;it&#39;s&nbsp;free),&nbsp;else</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6371440">//&nbsp;get&nbsp;a&nbsp;new&nbsp;connection&nbsp;+&nbsp;re-prepare&nbsp;+&nbsp;execute&nbsp;on&nbsp;that&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371501">dc</span><span class="op" id="6371503">,</span>&nbsp;<span class="ident" id="6371505">err</span>&nbsp;<span class="op" id="6371509">:=</span>&nbsp;<span class="ident" id="6371512"><a href="/database/sql/sql.go.html#6371103">db</a></span><span class="op" id="6371514">.</span><span class="ident" id="6371515">conn</span><span class="op" id="6371519">(</span><span class="op" id="6371520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371523">if</span>&nbsp;<span class="ident" id="6371526"><a href="/database/sql/sql.go.html#6371505">err</a></span>&nbsp;<span class="op" id="6371530">!=</span>&nbsp;<span class="ident" id="6371533">nil</span>&nbsp;<span class="op" id="6371537">{</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371541">return</span>&nbsp;<span class="ident" id="6371548">nil</span><span class="op" id="6371551">,</span>&nbsp;<span class="ident" id="6371553"><a href="/database/sql/sql.go.html#6371505">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371561"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371563">.</span><span class="ident" id="6371564">Lock</span><span class="op" id="6371568">(</span><span class="op" id="6371569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371572">si</span><span class="op" id="6371574">,</span>&nbsp;<span class="ident" id="6371576"><a href="/database/sql/sql.go.html#6371505">err</a></span>&nbsp;<span class="op" id="6371580">:=</span>&nbsp;<span class="ident" id="6371583"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371585">.</span><span class="ident" id="6371586">prepareLocked</span><span class="op" id="6371599">(</span><span class="ident" id="6371600"><a href="/database/sql/sql.go.html#6371119">query</a></span><span class="op" id="6371605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371608"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371610">.</span><span class="ident" id="6371611">Unlock</span><span class="op" id="6371617">(</span><span class="op" id="6371618">)</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371621">if</span>&nbsp;<span class="ident" id="6371624"><a href="/database/sql/sql.go.html#6371505">err</a></span>&nbsp;<span class="op" id="6371628">!=</span>&nbsp;<span class="ident" id="6371631">nil</span>&nbsp;<span class="op" id="6371635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371639"><a href="/database/sql/sql.go.html#6371103">db</a></span><span class="op" id="6371641">.</span><span class="ident" id="6371642">putConn</span><span class="op" id="6371649">(</span><span class="ident" id="6371650"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371652">,</span>&nbsp;<span class="ident" id="6371654"><a href="/database/sql/sql.go.html#6371505">err</a></span><span class="op" id="6371657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371661">return</span>&nbsp;<span class="ident" id="6371668">nil</span><span class="op" id="6371671">,</span>&nbsp;<span class="ident" id="6371673"><a href="/database/sql/sql.go.html#6371505">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371681">stmt</span>&nbsp;<span class="op" id="6371686">:=</span>&nbsp;<span class="op" id="6371689">&amp;</span><span class="ident" id="6371690"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6371694">{</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371698">db</span><span class="op" id="6371700">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6371705"><a href="/database/sql/sql.go.html#6371103">db</a></span><span class="op" id="6371707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371711">query</span><span class="op" id="6371716">:</span>&nbsp;<span class="ident" id="6371718"><a href="/database/sql/sql.go.html#6371119">query</a></span><span class="op" id="6371723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371727">css</span><span class="op" id="6371730">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6371734">[</span><span class="op" id="6371735">]</span><span class="ident" id="6371736"><a href="/database/sql/sql.go.html#6381328">connStmt</a></span><span class="op" id="6371744">{</span><span class="op" id="6371745">{</span><span class="ident" id="6371746"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371748">,</span>&nbsp;<span class="ident" id="6371750"><a href="/database/sql/sql.go.html#6371572">si</a></span><span class="op" id="6371752">}</span><span class="op" id="6371753">}</span><span class="op" id="6371754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6371757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371760"><a href="/database/sql/sql.go.html#6371103">db</a></span><span class="op" id="6371762">.</span><span class="ident" id="6371763">addDep</span><span class="op" id="6371769">(</span><span class="ident" id="6371770"><a href="/database/sql/sql.go.html#6371681">stmt</a></span><span class="op" id="6371774">,</span>&nbsp;<span class="ident" id="6371776"><a href="/database/sql/sql.go.html#6371681">stmt</a></span><span class="op" id="6371780">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6371783"><a href="/database/sql/sql.go.html#6371103">db</a></span><span class="op" id="6371785">.</span><span class="ident" id="6371786">putConn</span><span class="op" id="6371793">(</span><span class="ident" id="6371794"><a href="/database/sql/sql.go.html#6371501">dc</a></span><span class="op" id="6371796">,</span>&nbsp;<span class="ident" id="6371798">nil</span><span class="op" id="6371801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6371804">return</span>&nbsp;<span class="ident" id="6371811"><a href="/database/sql/sql.go.html#6371681">stmt</a></span><span class="op" id="6371815">,</span>&nbsp;<span class="ident" id="6371817">nil</span><br>
<span class="lineno"></span><span class="op" id="6371821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6371824">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;without&nbsp;returning&nbsp;any&nbsp;rows.</span><br>
<span class="lineno">870</span><span class="comment" id="6371877">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno"></span><span class="keyword" id="6371938">func</span>&nbsp;<span class="op" id="6371943">(</span><span class="ident" id="6371944">db</span>&nbsp;<span class="op" id="6371947">*</span><span class="ident" id="6371948"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6371950">)</span>&nbsp;<span class="ident" id="6371952">Exec</span><span class="op" id="6371956">(</span><span class="ident" id="6371957">query</span>&nbsp;<span class="builtintype" id="6371963">string</span><span class="op" id="6371969">,</span>&nbsp;<span class="ident" id="6371971">args</span>&nbsp;<span class="op" id="6371976">...</span><span class="keyword" id="6371979">interface</span><span class="op" id="6371988">{</span><span class="op" id="6371989">}</span><span class="op" id="6371990">)</span>&nbsp;<span class="op" id="6371992">(</span><span class="ident" id="6371993"><a href="/database/sql/sql.go.html#6393463">Result</a></span><span class="op" id="6371999">,</span>&nbsp;<span class="builtintype" id="6372001">error</span><span class="op" id="6372006">)</span>&nbsp;<span class="op" id="6372008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372011">var</span>&nbsp;<span class="ident" id="6372015">res</span>&nbsp;<span class="ident" id="6372019"><a href="/database/sql/sql.go.html#6393463">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372027">var</span>&nbsp;<span class="ident" id="6372031">err</span>&nbsp;<span class="builtintype" id="6372035">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372042">for</span>&nbsp;<span class="ident" id="6372046">i</span>&nbsp;<span class="op" id="6372048">:=</span>&nbsp;<span class="num" id="6372051">0</span><span class="op" id="6372052">;</span>&nbsp;<span class="ident" id="6372054"><a href="/database/sql/sql.go.html#6372046">i</a></span>&nbsp;<span class="op" id="6372056">&lt;</span>&nbsp;<span class="ident" id="6372058"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6372075">;</span>&nbsp;<span class="ident" id="6372077"><a href="/database/sql/sql.go.html#6372046">i</a></span><span class="op" id="6372078">++</span>&nbsp;<span class="op" id="6372081">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372085"><a href="/database/sql/sql.go.html#6372015">res</a></span><span class="op" id="6372088">,</span>&nbsp;<span class="ident" id="6372090"><a href="/database/sql/sql.go.html#6372031">err</a></span>&nbsp;<span class="op" id="6372094">=</span>&nbsp;<span class="ident" id="6372096"><a href="/database/sql/sql.go.html#6371944">db</a></span><span class="op" id="6372098">.</span><span class="ident" id="6372099">exec</span><span class="op" id="6372103">(</span><span class="ident" id="6372104"><a href="/database/sql/sql.go.html#6371957">query</a></span><span class="op" id="6372109">,</span>&nbsp;<span class="ident" id="6372111"><a href="/database/sql/sql.go.html#6371971">args</a></span><span class="op" id="6372115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372119">if</span>&nbsp;<span class="ident" id="6372122"><a href="/database/sql/sql.go.html#6372031">err</a></span>&nbsp;<span class="op" id="6372126">!=</span>&nbsp;<span class="ident" id="6372129"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6372135">.</span><span class="ident" id="6372136">ErrBadConn</span>&nbsp;<span class="op" id="6372147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372152">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372160">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372163">}</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372166">return</span>&nbsp;<span class="ident" id="6372173"><a href="/database/sql/sql.go.html#6372015">res</a></span><span class="op" id="6372176">,</span>&nbsp;<span class="ident" id="6372178"><a href="/database/sql/sql.go.html#6372031">err</a></span><br>
<span class="lineno"></span><span class="op" id="6372182">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6372185">func</span>&nbsp;<span class="op" id="6372190">(</span><span class="ident" id="6372191">db</span>&nbsp;<span class="op" id="6372194">*</span><span class="ident" id="6372195"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6372197">)</span>&nbsp;<span class="ident" id="6372199">exec</span><span class="op" id="6372203">(</span><span class="ident" id="6372204">query</span>&nbsp;<span class="builtintype" id="6372210">string</span><span class="op" id="6372216">,</span>&nbsp;<span class="ident" id="6372218">args</span>&nbsp;<span class="op" id="6372223">[</span><span class="op" id="6372224">]</span><span class="keyword" id="6372225">interface</span><span class="op" id="6372234">{</span><span class="op" id="6372235">}</span><span class="op" id="6372236">)</span>&nbsp;<span class="op" id="6372238">(</span><span class="ident" id="6372239">res</span>&nbsp;<span class="ident" id="6372243"><a href="/database/sql/sql.go.html#6393463">Result</a></span><span class="op" id="6372249">,</span>&nbsp;<span class="ident" id="6372251">err</span>&nbsp;<span class="builtintype" id="6372255">error</span><span class="op" id="6372260">)</span>&nbsp;<span class="op" id="6372262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372265">dc</span><span class="op" id="6372267">,</span>&nbsp;<span class="ident" id="6372269"><a href="/database/sql/sql.go.html#6372251">err</a></span>&nbsp;<span class="op" id="6372273">:=</span>&nbsp;<span class="ident" id="6372276"><a href="/database/sql/sql.go.html#6372191">db</a></span><span class="op" id="6372278">.</span><span class="ident" id="6372279">conn</span><span class="op" id="6372283">(</span><span class="op" id="6372284">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372287">if</span>&nbsp;<span class="ident" id="6372290"><a href="/database/sql/sql.go.html#6372251">err</a></span>&nbsp;<span class="op" id="6372294">!=</span>&nbsp;<span class="ident" id="6372297">nil</span>&nbsp;<span class="op" id="6372301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372305">return</span>&nbsp;<span class="ident" id="6372312">nil</span><span class="op" id="6372315">,</span>&nbsp;<span class="ident" id="6372317"><a href="/database/sql/sql.go.html#6372251">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372325">defer</span>&nbsp;<span class="keyword" id="6372331">func</span><span class="op" id="6372335">(</span><span class="op" id="6372336">)</span>&nbsp;<span class="op" id="6372338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372342"><a href="/database/sql/sql.go.html#6372191">db</a></span><span class="op" id="6372344">.</span><span class="ident" id="6372345">putConn</span><span class="op" id="6372352">(</span><span class="ident" id="6372353"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372355">,</span>&nbsp;<span class="ident" id="6372357"><a href="/database/sql/sql.go.html#6372251">err</a></span><span class="op" id="6372360">)</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372363">}</span><span class="op" id="6372364">(</span><span class="op" id="6372365">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372369">if</span>&nbsp;<span class="ident" id="6372372">execer</span><span class="op" id="6372378">,</span>&nbsp;<span class="ident" id="6372380">ok</span>&nbsp;<span class="op" id="6372383">:=</span>&nbsp;<span class="ident" id="6372386"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372388">.</span><span class="ident" id="6372389">ci</span><span class="op" id="6372391">.</span><span class="op" id="6372392">(</span><span class="ident" id="6372393"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6372399">.</span><span class="ident" id="6372400">Execer</span><span class="op" id="6372406">)</span><span class="op" id="6372407">;</span>&nbsp;<span class="ident" id="6372409"><a href="/database/sql/sql.go.html#6372380">ok</a></span>&nbsp;<span class="op" id="6372412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372416">dargs</span><span class="op" id="6372421">,</span>&nbsp;<span class="ident" id="6372423">err</span>&nbsp;<span class="op" id="6372427">:=</span>&nbsp;<span class="ident" id="6372430"><a href="/database/sql/convert.go.html#6341842">driverArgs</a></span><span class="op" id="6372440">(</span><span class="ident" id="6372441">nil</span><span class="op" id="6372444">,</span>&nbsp;<span class="ident" id="6372446"><a href="/database/sql/sql.go.html#6372218">args</a></span><span class="op" id="6372450">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372454">if</span>&nbsp;<span class="ident" id="6372457"><a href="/database/sql/sql.go.html#6372423">err</a></span>&nbsp;<span class="op" id="6372461">!=</span>&nbsp;<span class="ident" id="6372464">nil</span>&nbsp;<span class="op" id="6372468">{</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372473">return</span>&nbsp;<span class="ident" id="6372480">nil</span><span class="op" id="6372483">,</span>&nbsp;<span class="ident" id="6372485"><a href="/database/sql/sql.go.html#6372423">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372495"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372497">.</span><span class="ident" id="6372498">Lock</span><span class="op" id="6372502">(</span><span class="op" id="6372503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372507">resi</span><span class="op" id="6372511">,</span>&nbsp;<span class="ident" id="6372513"><a href="/database/sql/sql.go.html#6372423">err</a></span>&nbsp;<span class="op" id="6372517">:=</span>&nbsp;<span class="ident" id="6372520"><a href="/database/sql/sql.go.html#6372372">execer</a></span><span class="op" id="6372526">.</span><span class="ident" id="6372527">Exec</span><span class="op" id="6372531">(</span><span class="ident" id="6372532"><a href="/database/sql/sql.go.html#6372204">query</a></span><span class="op" id="6372537">,</span>&nbsp;<span class="ident" id="6372539"><a href="/database/sql/sql.go.html#6372416">dargs</a></span><span class="op" id="6372544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372548"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372550">.</span><span class="ident" id="6372551">Unlock</span><span class="op" id="6372557">(</span><span class="op" id="6372558">)</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372562">if</span>&nbsp;<span class="ident" id="6372565"><a href="/database/sql/sql.go.html#6372423">err</a></span>&nbsp;<span class="op" id="6372569">!=</span>&nbsp;<span class="ident" id="6372572"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6372578">.</span><span class="ident" id="6372579">ErrSkip</span>&nbsp;<span class="op" id="6372587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372592">if</span>&nbsp;<span class="ident" id="6372595"><a href="/database/sql/sql.go.html#6372423">err</a></span>&nbsp;<span class="op" id="6372599">!=</span>&nbsp;<span class="ident" id="6372602">nil</span>&nbsp;<span class="op" id="6372606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372612">return</span>&nbsp;<span class="ident" id="6372619">nil</span><span class="op" id="6372622">,</span>&nbsp;<span class="ident" id="6372624"><a href="/database/sql/sql.go.html#6372423">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372636">return</span>&nbsp;<span class="ident" id="6372643"><a href="/database/sql/sql.go.html#6393971">driverResult</a></span><span class="op" id="6372655">{</span><span class="ident" id="6372656"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372658">,</span>&nbsp;<span class="ident" id="6372660"><a href="/database/sql/sql.go.html#6372507">resi</a></span><span class="op" id="6372664">}</span><span class="op" id="6372665">,</span>&nbsp;<span class="ident" id="6372667">nil</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372680"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372682">.</span><span class="ident" id="6372683">Lock</span><span class="op" id="6372687">(</span><span class="op" id="6372688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372691">si</span><span class="op" id="6372693">,</span>&nbsp;<span class="ident" id="6372695"><a href="/database/sql/sql.go.html#6372251">err</a></span>&nbsp;<span class="op" id="6372699">:=</span>&nbsp;<span class="ident" id="6372702"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372704">.</span><span class="ident" id="6372705">ci</span><span class="op" id="6372707">.</span><span class="ident" id="6372708">Prepare</span><span class="op" id="6372715">(</span><span class="ident" id="6372716"><a href="/database/sql/sql.go.html#6372204">query</a></span><span class="op" id="6372721">)</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6372724"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372726">.</span><span class="ident" id="6372727">Unlock</span><span class="op" id="6372733">(</span><span class="op" id="6372734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372737">if</span>&nbsp;<span class="ident" id="6372740"><a href="/database/sql/sql.go.html#6372251">err</a></span>&nbsp;<span class="op" id="6372744">!=</span>&nbsp;<span class="ident" id="6372747">nil</span>&nbsp;<span class="op" id="6372751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372755">return</span>&nbsp;<span class="ident" id="6372762">nil</span><span class="op" id="6372765">,</span>&nbsp;<span class="ident" id="6372767"><a href="/database/sql/sql.go.html#6372251">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6372772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372775">defer</span>&nbsp;<span class="ident" id="6372781"><a href="/database/sql/sql.go.html#6394432">withLock</a></span><span class="op" id="6372789">(</span><span class="ident" id="6372790"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372792">,</span>&nbsp;<span class="keyword" id="6372794">func</span><span class="op" id="6372798">(</span><span class="op" id="6372799">)</span>&nbsp;<span class="op" id="6372801">{</span>&nbsp;<span class="ident" id="6372803"><a href="/database/sql/sql.go.html#6372691">si</a></span><span class="op" id="6372805">.</span><span class="ident" id="6372806">Close</span><span class="op" id="6372811">(</span><span class="op" id="6372812">)</span>&nbsp;<span class="op" id="6372814">}</span><span class="op" id="6372815">)</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6372818">return</span>&nbsp;<span class="ident" id="6372825"><a href="/database/sql/sql.go.html#6382728">resultFromStatement</a></span><span class="op" id="6372844">(</span><span class="ident" id="6372845"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6372855">{</span><span class="ident" id="6372856"><a href="/database/sql/sql.go.html#6372265">dc</a></span><span class="op" id="6372858">,</span>&nbsp;<span class="ident" id="6372860"><a href="/database/sql/sql.go.html#6372691">si</a></span><span class="op" id="6372862">}</span><span class="op" id="6372863">,</span>&nbsp;<span class="ident" id="6372865"><a href="/database/sql/sql.go.html#6372218">args</a></span><span class="op" id="6372869">...</span><span class="op" id="6372872">)</span><br>
<span class="lineno"></span><span class="op" id="6372874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6372877">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="comment" id="6372942">//&nbsp;The&nbsp;args&nbsp;are&nbsp;for&nbsp;any&nbsp;placeholder&nbsp;parameters&nbsp;in&nbsp;the&nbsp;query.</span><br>
<span class="lineno">920</span><span class="keyword" id="6373003">func</span>&nbsp;<span class="op" id="6373008">(</span><span class="ident" id="6373009">db</span>&nbsp;<span class="op" id="6373012">*</span><span class="ident" id="6373013"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6373015">)</span>&nbsp;<span class="ident" id="6373017">Query</span><span class="op" id="6373022">(</span><span class="ident" id="6373023">query</span>&nbsp;<span class="builtintype" id="6373029">string</span><span class="op" id="6373035">,</span>&nbsp;<span class="ident" id="6373037">args</span>&nbsp;<span class="op" id="6373042">...</span><span class="keyword" id="6373045">interface</span><span class="op" id="6373054">{</span><span class="op" id="6373055">}</span><span class="op" id="6373056">)</span>&nbsp;<span class="op" id="6373058">(</span><span class="op" id="6373059">*</span><span class="ident" id="6373060"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6373064">,</span>&nbsp;<span class="builtintype" id="6373066">error</span><span class="op" id="6373071">)</span>&nbsp;<span class="op" id="6373073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373076">var</span>&nbsp;<span class="ident" id="6373080">rows</span>&nbsp;<span class="op" id="6373085">*</span><span class="ident" id="6373086"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373092">var</span>&nbsp;<span class="ident" id="6373096">err</span>&nbsp;<span class="builtintype" id="6373100">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373107">for</span>&nbsp;<span class="ident" id="6373111">i</span>&nbsp;<span class="op" id="6373113">:=</span>&nbsp;<span class="num" id="6373116">0</span><span class="op" id="6373117">;</span>&nbsp;<span class="ident" id="6373119"><a href="/database/sql/sql.go.html#6373111">i</a></span>&nbsp;<span class="op" id="6373121">&lt;</span>&nbsp;<span class="ident" id="6373123"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6373140">;</span>&nbsp;<span class="ident" id="6373142"><a href="/database/sql/sql.go.html#6373111">i</a></span><span class="op" id="6373143">++</span>&nbsp;<span class="op" id="6373146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373150"><a href="/database/sql/sql.go.html#6373080">rows</a></span><span class="op" id="6373154">,</span>&nbsp;<span class="ident" id="6373156"><a href="/database/sql/sql.go.html#6373096">err</a></span>&nbsp;<span class="op" id="6373160">=</span>&nbsp;<span class="ident" id="6373162"><a href="/database/sql/sql.go.html#6373009">db</a></span><span class="op" id="6373164">.</span><span class="ident" id="6373165">query</span><span class="op" id="6373170">(</span><span class="ident" id="6373171"><a href="/database/sql/sql.go.html#6373023">query</a></span><span class="op" id="6373176">,</span>&nbsp;<span class="ident" id="6373178"><a href="/database/sql/sql.go.html#6373037">args</a></span><span class="op" id="6373182">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373186">if</span>&nbsp;<span class="ident" id="6373189"><a href="/database/sql/sql.go.html#6373096">err</a></span>&nbsp;<span class="op" id="6373193">!=</span>&nbsp;<span class="ident" id="6373196"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6373202">.</span><span class="ident" id="6373203">ErrBadConn</span>&nbsp;<span class="op" id="6373214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373219">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373227">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373233">return</span>&nbsp;<span class="ident" id="6373240"><a href="/database/sql/sql.go.html#6373080">rows</a></span><span class="op" id="6373244">,</span>&nbsp;<span class="ident" id="6373246"><a href="/database/sql/sql.go.html#6373096">err</a></span><br>
<span class="lineno">930</span><span class="op" id="6373250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6373253">func</span>&nbsp;<span class="op" id="6373258">(</span><span class="ident" id="6373259">db</span>&nbsp;<span class="op" id="6373262">*</span><span class="ident" id="6373263"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6373265">)</span>&nbsp;<span class="ident" id="6373267">query</span><span class="op" id="6373272">(</span><span class="ident" id="6373273">query</span>&nbsp;<span class="builtintype" id="6373279">string</span><span class="op" id="6373285">,</span>&nbsp;<span class="ident" id="6373287">args</span>&nbsp;<span class="op" id="6373292">[</span><span class="op" id="6373293">]</span><span class="keyword" id="6373294">interface</span><span class="op" id="6373303">{</span><span class="op" id="6373304">}</span><span class="op" id="6373305">)</span>&nbsp;<span class="op" id="6373307">(</span><span class="op" id="6373308">*</span><span class="ident" id="6373309"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6373313">,</span>&nbsp;<span class="builtintype" id="6373315">error</span><span class="op" id="6373320">)</span>&nbsp;<span class="op" id="6373322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373325">ci</span><span class="op" id="6373327">,</span>&nbsp;<span class="ident" id="6373329">err</span>&nbsp;<span class="op" id="6373333">:=</span>&nbsp;<span class="ident" id="6373336"><a href="/database/sql/sql.go.html#6373259">db</a></span><span class="op" id="6373338">.</span><span class="ident" id="6373339">conn</span><span class="op" id="6373343">(</span><span class="op" id="6373344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373347">if</span>&nbsp;<span class="ident" id="6373350"><a href="/database/sql/sql.go.html#6373329">err</a></span>&nbsp;<span class="op" id="6373354">!=</span>&nbsp;<span class="ident" id="6373357">nil</span>&nbsp;<span class="op" id="6373361">{</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373365">return</span>&nbsp;<span class="ident" id="6373372">nil</span><span class="op" id="6373375">,</span>&nbsp;<span class="ident" id="6373377"><a href="/database/sql/sql.go.html#6373329">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373386">return</span>&nbsp;<span class="ident" id="6373393"><a href="/database/sql/sql.go.html#6373259">db</a></span><span class="op" id="6373395">.</span><span class="ident" id="6373396">queryConn</span><span class="op" id="6373405">(</span><span class="ident" id="6373406"><a href="/database/sql/sql.go.html#6373325">ci</a></span><span class="op" id="6373408">,</span>&nbsp;<span class="ident" id="6373410"><a href="/database/sql/sql.go.html#6373325">ci</a></span><span class="op" id="6373412">.</span><span class="ident" id="6373413">releaseConn</span><span class="op" id="6373424">,</span>&nbsp;<span class="ident" id="6373426"><a href="/database/sql/sql.go.html#6373273">query</a></span><span class="op" id="6373431">,</span>&nbsp;<span class="ident" id="6373433"><a href="/database/sql/sql.go.html#6373287">args</a></span><span class="op" id="6373437">)</span><br>
<span class="lineno"></span><span class="op" id="6373439">}</span><br>
<span class="lineno">940</span><br>
<span class="lineno"></span><span class="comment" id="6373442">//&nbsp;queryConn&nbsp;executes&nbsp;a&nbsp;query&nbsp;on&nbsp;the&nbsp;given&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6373497">//&nbsp;The&nbsp;connection&nbsp;gets&nbsp;released&nbsp;by&nbsp;the&nbsp;releaseConn&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6373558">func</span>&nbsp;<span class="op" id="6373563">(</span><span class="ident" id="6373564">db</span>&nbsp;<span class="op" id="6373567">*</span><span class="ident" id="6373568"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6373570">)</span>&nbsp;<span class="ident" id="6373572">queryConn</span><span class="op" id="6373581">(</span><span class="ident" id="6373582">dc</span>&nbsp;<span class="op" id="6373585">*</span><span class="ident" id="6373586"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6373596">,</span>&nbsp;<span class="ident" id="6373598">releaseConn</span>&nbsp;<span class="keyword" id="6373610">func</span><span class="op" id="6373614">(</span><span class="builtintype" id="6373615">error</span><span class="op" id="6373620">)</span><span class="op" id="6373621">,</span>&nbsp;<span class="ident" id="6373623">query</span>&nbsp;<span class="builtintype" id="6373629">string</span><span class="op" id="6373635">,</span>&nbsp;<span class="ident" id="6373637">args</span>&nbsp;<span class="op" id="6373642">[</span><span class="op" id="6373643">]</span><span class="keyword" id="6373644">interface</span><span class="op" id="6373653">{</span><span class="op" id="6373654">}</span><span class="op" id="6373655">)</span>&nbsp;<span class="op" id="6373657">(</span><span class="op" id="6373658">*</span><span class="ident" id="6373659"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6373663">,</span>&nbsp;<span class="builtintype" id="6373665">error</span><span class="op" id="6373670">)</span>&nbsp;<span class="op" id="6373672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373675">if</span>&nbsp;<span class="ident" id="6373678">queryer</span><span class="op" id="6373685">,</span>&nbsp;<span class="ident" id="6373687">ok</span>&nbsp;<span class="op" id="6373690">:=</span>&nbsp;<span class="ident" id="6373693"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6373695">.</span><span class="ident" id="6373696">ci</span><span class="op" id="6373698">.</span><span class="op" id="6373699">(</span><span class="ident" id="6373700"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6373706">.</span><span class="ident" id="6373707">Queryer</span><span class="op" id="6373714">)</span><span class="op" id="6373715">;</span>&nbsp;<span class="ident" id="6373717"><a href="/database/sql/sql.go.html#6373687">ok</a></span>&nbsp;<span class="op" id="6373720">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373724">dargs</span><span class="op" id="6373729">,</span>&nbsp;<span class="ident" id="6373731">err</span>&nbsp;<span class="op" id="6373735">:=</span>&nbsp;<span class="ident" id="6373738"><a href="/database/sql/convert.go.html#6341842">driverArgs</a></span><span class="op" id="6373748">(</span><span class="ident" id="6373749">nil</span><span class="op" id="6373752">,</span>&nbsp;<span class="ident" id="6373754"><a href="/database/sql/sql.go.html#6373637">args</a></span><span class="op" id="6373758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373762">if</span>&nbsp;<span class="ident" id="6373765"><a href="/database/sql/sql.go.html#6373731">err</a></span>&nbsp;<span class="op" id="6373769">!=</span>&nbsp;<span class="ident" id="6373772">nil</span>&nbsp;<span class="op" id="6373776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373781"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6373792">(</span><span class="ident" id="6373793"><a href="/database/sql/sql.go.html#6373731">err</a></span><span class="op" id="6373796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373801">return</span>&nbsp;<span class="ident" id="6373808">nil</span><span class="op" id="6373811">,</span>&nbsp;<span class="ident" id="6373813"><a href="/database/sql/sql.go.html#6373731">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373819">}</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373823"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6373825">.</span><span class="ident" id="6373826">Lock</span><span class="op" id="6373830">(</span><span class="op" id="6373831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373835">rowsi</span><span class="op" id="6373840">,</span>&nbsp;<span class="ident" id="6373842"><a href="/database/sql/sql.go.html#6373731">err</a></span>&nbsp;<span class="op" id="6373846">:=</span>&nbsp;<span class="ident" id="6373849"><a href="/database/sql/sql.go.html#6373678">queryer</a></span><span class="op" id="6373856">.</span><span class="ident" id="6373857">Query</span><span class="op" id="6373862">(</span><span class="ident" id="6373863"><a href="/database/sql/sql.go.html#6373623">query</a></span><span class="op" id="6373868">,</span>&nbsp;<span class="ident" id="6373870"><a href="/database/sql/sql.go.html#6373724">dargs</a></span><span class="op" id="6373875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373879"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6373881">.</span><span class="ident" id="6373882">Unlock</span><span class="op" id="6373888">(</span><span class="op" id="6373889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373893">if</span>&nbsp;<span class="ident" id="6373896"><a href="/database/sql/sql.go.html#6373731">err</a></span>&nbsp;<span class="op" id="6373900">!=</span>&nbsp;<span class="ident" id="6373903"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6373909">.</span><span class="ident" id="6373910">ErrSkip</span>&nbsp;<span class="op" id="6373918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373923">if</span>&nbsp;<span class="ident" id="6373926"><a href="/database/sql/sql.go.html#6373731">err</a></span>&nbsp;<span class="op" id="6373930">!=</span>&nbsp;<span class="ident" id="6373933">nil</span>&nbsp;<span class="op" id="6373937">{</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6373943"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6373954">(</span><span class="ident" id="6373955"><a href="/database/sql/sql.go.html#6373731">err</a></span><span class="op" id="6373958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6373964">return</span>&nbsp;<span class="ident" id="6373971">nil</span><span class="op" id="6373974">,</span>&nbsp;<span class="ident" id="6373976"><a href="/database/sql/sql.go.html#6373731">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6373983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6373988">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;dc&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6374049">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374073">rows</span>&nbsp;<span class="op" id="6374078">:=</span>&nbsp;<span class="op" id="6374081">&amp;</span><span class="ident" id="6374082"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6374086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374092">dc</span><span class="op" id="6374094">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374105"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374107">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374113">releaseConn</span><span class="op" id="6374124">:</span>&nbsp;<span class="ident" id="6374126"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6374137">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374143">rowsi</span><span class="op" id="6374148">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374156"><a href="/database/sql/sql.go.html#6373835">rowsi</a></span><span class="op" id="6374161">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374166">}</span><br>
<span class="lineno">965</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374171">return</span>&nbsp;<span class="ident" id="6374178"><a href="/database/sql/sql.go.html#6374073">rows</a></span><span class="op" id="6374182">,</span>&nbsp;<span class="ident" id="6374184">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374190">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374197"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374199">.</span><span class="ident" id="6374200">Lock</span><span class="op" id="6374204">(</span><span class="op" id="6374205">)</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374208">si</span><span class="op" id="6374210">,</span>&nbsp;<span class="ident" id="6374212">err</span>&nbsp;<span class="op" id="6374216">:=</span>&nbsp;<span class="ident" id="6374219"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374221">.</span><span class="ident" id="6374222">ci</span><span class="op" id="6374224">.</span><span class="ident" id="6374225">Prepare</span><span class="op" id="6374232">(</span><span class="ident" id="6374233"><a href="/database/sql/sql.go.html#6373623">query</a></span><span class="op" id="6374238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374241"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374243">.</span><span class="ident" id="6374244">Unlock</span><span class="op" id="6374250">(</span><span class="op" id="6374251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374254">if</span>&nbsp;<span class="ident" id="6374257"><a href="/database/sql/sql.go.html#6374212">err</a></span>&nbsp;<span class="op" id="6374261">!=</span>&nbsp;<span class="ident" id="6374264">nil</span>&nbsp;<span class="op" id="6374268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374272"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6374283">(</span><span class="ident" id="6374284"><a href="/database/sql/sql.go.html#6374212">err</a></span><span class="op" id="6374287">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374291">return</span>&nbsp;<span class="ident" id="6374298">nil</span><span class="op" id="6374301">,</span>&nbsp;<span class="ident" id="6374303"><a href="/database/sql/sql.go.html#6374212">err</a></span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374312">ds</span>&nbsp;<span class="op" id="6374315">:=</span>&nbsp;<span class="ident" id="6374318"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6374328">{</span><span class="ident" id="6374329"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374331">,</span>&nbsp;<span class="ident" id="6374333"><a href="/database/sql/sql.go.html#6374208">si</a></span><span class="op" id="6374335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374338">rowsi</span><span class="op" id="6374343">,</span>&nbsp;<span class="ident" id="6374345"><a href="/database/sql/sql.go.html#6374212">err</a></span>&nbsp;<span class="op" id="6374349">:=</span>&nbsp;<span class="ident" id="6374352"><a href="/database/sql/sql.go.html#6386249">rowsiFromStatement</a></span><span class="op" id="6374370">(</span><span class="ident" id="6374371"><a href="/database/sql/sql.go.html#6374312">ds</a></span><span class="op" id="6374373">,</span>&nbsp;<span class="ident" id="6374375"><a href="/database/sql/sql.go.html#6373637">args</a></span><span class="op" id="6374379">...</span><span class="op" id="6374382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374385">if</span>&nbsp;<span class="ident" id="6374388"><a href="/database/sql/sql.go.html#6374212">err</a></span>&nbsp;<span class="op" id="6374392">!=</span>&nbsp;<span class="ident" id="6374395">nil</span>&nbsp;<span class="op" id="6374399">{</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374403"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374405">.</span><span class="ident" id="6374406">Lock</span><span class="op" id="6374410">(</span><span class="op" id="6374411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374415"><a href="/database/sql/sql.go.html#6374208">si</a></span><span class="op" id="6374417">.</span><span class="ident" id="6374418">Close</span><span class="op" id="6374423">(</span><span class="op" id="6374424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374428"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374430">.</span><span class="ident" id="6374431">Unlock</span><span class="op" id="6374437">(</span><span class="op" id="6374438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374442"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6374453">(</span><span class="ident" id="6374454"><a href="/database/sql/sql.go.html#6374212">err</a></span><span class="op" id="6374457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374461">return</span>&nbsp;<span class="ident" id="6374468">nil</span><span class="op" id="6374471">,</span>&nbsp;<span class="ident" id="6374473"><a href="/database/sql/sql.go.html#6374212">err</a></span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374478">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6374482">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6374541">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374563">rows</span>&nbsp;<span class="op" id="6374568">:=</span>&nbsp;<span class="op" id="6374571">&amp;</span><span class="ident" id="6374572"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6374576">{</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374580">dc</span><span class="op" id="6374582">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374593"><a href="/database/sql/sql.go.html#6373582">dc</a></span><span class="op" id="6374595">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374599">releaseConn</span><span class="op" id="6374610">:</span>&nbsp;<span class="ident" id="6374612"><a href="/database/sql/sql.go.html#6373598">releaseConn</a></span><span class="op" id="6374623">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374627">rowsi</span><span class="op" id="6374632">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6374640"><a href="/database/sql/sql.go.html#6374338">rowsi</a></span><span class="op" id="6374645">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374649">closeStmt</span><span class="op" id="6374658">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6374662"><a href="/database/sql/sql.go.html#6374208">si</a></span><span class="op" id="6374664">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6374667">}</span><br>
<span class="lineno">995</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374670">return</span>&nbsp;<span class="ident" id="6374677"><a href="/database/sql/sql.go.html#6374563">rows</a></span><span class="op" id="6374681">,</span>&nbsp;<span class="ident" id="6374683">nil</span><br>
<span class="lineno"></span><span class="op" id="6374687">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6374690">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="6374763">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno">1000</span><span class="comment" id="6374832">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno"></span><span class="keyword" id="6374864">func</span>&nbsp;<span class="op" id="6374869">(</span><span class="ident" id="6374870">db</span>&nbsp;<span class="op" id="6374873">*</span><span class="ident" id="6374874"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6374876">)</span>&nbsp;<span class="ident" id="6374878">QueryRow</span><span class="op" id="6374886">(</span><span class="ident" id="6374887">query</span>&nbsp;<span class="builtintype" id="6374893">string</span><span class="op" id="6374899">,</span>&nbsp;<span class="ident" id="6374901">args</span>&nbsp;<span class="op" id="6374906">...</span><span class="keyword" id="6374909">interface</span><span class="op" id="6374918">{</span><span class="op" id="6374919">}</span><span class="op" id="6374920">)</span>&nbsp;<span class="op" id="6374922">*</span><span class="ident" id="6374923"><a href="/database/sql/sql.go.html#6391775">Row</a></span>&nbsp;<span class="op" id="6374927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6374930">rows</span><span class="op" id="6374934">,</span>&nbsp;<span class="ident" id="6374936">err</span>&nbsp;<span class="op" id="6374940">:=</span>&nbsp;<span class="ident" id="6374943"><a href="/database/sql/sql.go.html#6374870">db</a></span><span class="op" id="6374945">.</span><span class="ident" id="6374946">Query</span><span class="op" id="6374951">(</span><span class="ident" id="6374952"><a href="/database/sql/sql.go.html#6374887">query</a></span><span class="op" id="6374957">,</span>&nbsp;<span class="ident" id="6374959"><a href="/database/sql/sql.go.html#6374901">args</a></span><span class="op" id="6374963">...</span><span class="op" id="6374966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6374969">return</span>&nbsp;<span class="op" id="6374976">&amp;</span><span class="ident" id="6374977"><a href="/database/sql/sql.go.html#6391775">Row</a></span><span class="op" id="6374980">{</span><span class="ident" id="6374981">rows</span><span class="op" id="6374985">:</span>&nbsp;<span class="ident" id="6374987"><a href="/database/sql/sql.go.html#6374930">rows</a></span><span class="op" id="6374991">,</span>&nbsp;<span class="ident" id="6374993">err</span><span class="op" id="6374996">:</span>&nbsp;<span class="ident" id="6374998"><a href="/database/sql/sql.go.html#6374936">err</a></span><span class="op" id="6375001">}</span><br>
<span class="lineno"></span><span class="op" id="6375003">}</span><br>
<span class="lineno">1005</span><br>
<span class="lineno"></span><span class="comment" id="6375006">//&nbsp;Begin&nbsp;starts&nbsp;a&nbsp;transaction.&nbsp;The&nbsp;isolation&nbsp;level&nbsp;is&nbsp;dependent&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6375073">//&nbsp;the&nbsp;driver.</span><br>
<span class="lineno"></span><span class="keyword" id="6375088">func</span>&nbsp;<span class="op" id="6375093">(</span><span class="ident" id="6375094">db</span>&nbsp;<span class="op" id="6375097">*</span><span class="ident" id="6375098"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6375100">)</span>&nbsp;<span class="ident" id="6375102">Begin</span><span class="op" id="6375107">(</span><span class="op" id="6375108">)</span>&nbsp;<span class="op" id="6375110">(</span><span class="op" id="6375111">*</span><span class="ident" id="6375112"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6375114">,</span>&nbsp;<span class="builtintype" id="6375116">error</span><span class="op" id="6375121">)</span>&nbsp;<span class="op" id="6375123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375126">var</span>&nbsp;<span class="ident" id="6375130">tx</span>&nbsp;<span class="op" id="6375133">*</span><span class="ident" id="6375134"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno">1010</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375138">var</span>&nbsp;<span class="ident" id="6375142">err</span>&nbsp;<span class="builtintype" id="6375146">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375153">for</span>&nbsp;<span class="ident" id="6375157">i</span>&nbsp;<span class="op" id="6375159">:=</span>&nbsp;<span class="num" id="6375162">0</span><span class="op" id="6375163">;</span>&nbsp;<span class="ident" id="6375165"><a href="/database/sql/sql.go.html#6375157">i</a></span>&nbsp;<span class="op" id="6375167">&lt;</span>&nbsp;<span class="ident" id="6375169"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6375186">;</span>&nbsp;<span class="ident" id="6375188"><a href="/database/sql/sql.go.html#6375157">i</a></span><span class="op" id="6375189">++</span>&nbsp;<span class="op" id="6375192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375196"><a href="/database/sql/sql.go.html#6375130">tx</a></span><span class="op" id="6375198">,</span>&nbsp;<span class="ident" id="6375200"><a href="/database/sql/sql.go.html#6375142">err</a></span>&nbsp;<span class="op" id="6375204">=</span>&nbsp;<span class="ident" id="6375206"><a href="/database/sql/sql.go.html#6375094">db</a></span><span class="op" id="6375208">.</span><span class="ident" id="6375209">begin</span><span class="op" id="6375214">(</span><span class="op" id="6375215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375219">if</span>&nbsp;<span class="ident" id="6375222"><a href="/database/sql/sql.go.html#6375142">err</a></span>&nbsp;<span class="op" id="6375226">!=</span>&nbsp;<span class="ident" id="6375229"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6375235">.</span><span class="ident" id="6375236">ErrBadConn</span>&nbsp;<span class="op" id="6375247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375252">break</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375266">return</span>&nbsp;<span class="ident" id="6375273"><a href="/database/sql/sql.go.html#6375130">tx</a></span><span class="op" id="6375275">,</span>&nbsp;<span class="ident" id="6375277"><a href="/database/sql/sql.go.html#6375142">err</a></span><br>
<span class="lineno"></span><span class="op" id="6375281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1020</span><span class="keyword" id="6375284">func</span>&nbsp;<span class="op" id="6375289">(</span><span class="ident" id="6375290">db</span>&nbsp;<span class="op" id="6375293">*</span><span class="ident" id="6375294"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6375296">)</span>&nbsp;<span class="ident" id="6375298">begin</span><span class="op" id="6375303">(</span><span class="op" id="6375304">)</span>&nbsp;<span class="op" id="6375306">(</span><span class="ident" id="6375307">tx</span>&nbsp;<span class="op" id="6375310">*</span><span class="ident" id="6375311"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6375313">,</span>&nbsp;<span class="ident" id="6375315">err</span>&nbsp;<span class="builtintype" id="6375319">error</span><span class="op" id="6375324">)</span>&nbsp;<span class="op" id="6375326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375329">dc</span><span class="op" id="6375331">,</span>&nbsp;<span class="ident" id="6375333"><a href="/database/sql/sql.go.html#6375315">err</a></span>&nbsp;<span class="op" id="6375337">:=</span>&nbsp;<span class="ident" id="6375340"><a href="/database/sql/sql.go.html#6375290">db</a></span><span class="op" id="6375342">.</span><span class="ident" id="6375343">conn</span><span class="op" id="6375347">(</span><span class="op" id="6375348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375351">if</span>&nbsp;<span class="ident" id="6375354"><a href="/database/sql/sql.go.html#6375315">err</a></span>&nbsp;<span class="op" id="6375358">!=</span>&nbsp;<span class="ident" id="6375361">nil</span>&nbsp;<span class="op" id="6375365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375369">return</span>&nbsp;<span class="ident" id="6375376">nil</span><span class="op" id="6375379">,</span>&nbsp;<span class="ident" id="6375381"><a href="/database/sql/sql.go.html#6375315">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375386">}</span><br>
<span class="lineno">1025</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375389"><a href="/database/sql/sql.go.html#6375329">dc</a></span><span class="op" id="6375391">.</span><span class="ident" id="6375392">Lock</span><span class="op" id="6375396">(</span><span class="op" id="6375397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375400">txi</span><span class="op" id="6375403">,</span>&nbsp;<span class="ident" id="6375405"><a href="/database/sql/sql.go.html#6375315">err</a></span>&nbsp;<span class="op" id="6375409">:=</span>&nbsp;<span class="ident" id="6375412"><a href="/database/sql/sql.go.html#6375329">dc</a></span><span class="op" id="6375414">.</span><span class="ident" id="6375415">ci</span><span class="op" id="6375417">.</span><span class="ident" id="6375418">Begin</span><span class="op" id="6375423">(</span><span class="op" id="6375424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375427"><a href="/database/sql/sql.go.html#6375329">dc</a></span><span class="op" id="6375429">.</span><span class="ident" id="6375430">Unlock</span><span class="op" id="6375436">(</span><span class="op" id="6375437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375440">if</span>&nbsp;<span class="ident" id="6375443"><a href="/database/sql/sql.go.html#6375315">err</a></span>&nbsp;<span class="op" id="6375447">!=</span>&nbsp;<span class="ident" id="6375450">nil</span>&nbsp;<span class="op" id="6375454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375458"><a href="/database/sql/sql.go.html#6375290">db</a></span><span class="op" id="6375460">.</span><span class="ident" id="6375461">putConn</span><span class="op" id="6375468">(</span><span class="ident" id="6375469"><a href="/database/sql/sql.go.html#6375329">dc</a></span><span class="op" id="6375471">,</span>&nbsp;<span class="ident" id="6375473"><a href="/database/sql/sql.go.html#6375315">err</a></span><span class="op" id="6375476">)</span><br>
<span class="lineno">1030</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375480">return</span>&nbsp;<span class="ident" id="6375487">nil</span><span class="op" id="6375490">,</span>&nbsp;<span class="ident" id="6375492"><a href="/database/sql/sql.go.html#6375315">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375500">return</span>&nbsp;<span class="op" id="6375507">&amp;</span><span class="ident" id="6375508"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6375510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375514">db</span><span class="op" id="6375516">:</span>&nbsp;&nbsp;<span class="ident" id="6375519"><a href="/database/sql/sql.go.html#6375290">db</a></span><span class="op" id="6375521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375525">dc</span><span class="op" id="6375527">:</span>&nbsp;&nbsp;<span class="ident" id="6375530"><a href="/database/sql/sql.go.html#6375329">dc</a></span><span class="op" id="6375532">,</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375536">txi</span><span class="op" id="6375539">:</span>&nbsp;<span class="ident" id="6375541"><a href="/database/sql/sql.go.html#6375400">txi</a></span><span class="op" id="6375544">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6375547">}</span><span class="op" id="6375548">,</span>&nbsp;<span class="ident" id="6375550">nil</span><br>
<span class="lineno"></span><span class="op" id="6375554">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6375557">//&nbsp;Driver&nbsp;returns&nbsp;the&nbsp;database&#39;s&nbsp;underlying&nbsp;driver.</span><br>
<span class="lineno">1040</span><span class="keyword" id="6375609">func</span>&nbsp;<span class="op" id="6375614">(</span><span class="ident" id="6375615">db</span>&nbsp;<span class="op" id="6375618">*</span><span class="ident" id="6375619"><a href="/database/sql/sql.go.html#6354182">DB</a></span><span class="op" id="6375621">)</span>&nbsp;<span class="ident" id="6375623">Driver</span><span class="op" id="6375629">(</span><span class="op" id="6375630">)</span>&nbsp;<span class="ident" id="6375632"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6375638">.</span><span class="ident" id="6375639">Driver</span>&nbsp;<span class="op" id="6375646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6375649">return</span>&nbsp;<span class="ident" id="6375656"><a href="/database/sql/sql.go.html#6375615">db</a></span><span class="op" id="6375658">.</span><span class="ident" id="6375659">driver</span><br>
<span class="lineno"></span><span class="op" id="6375666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6375669">//&nbsp;Tx&nbsp;is&nbsp;an&nbsp;in-progress&nbsp;database&nbsp;transaction.</span><br>
<span class="lineno">1045</span><span class="comment" id="6375715">//</span><br>
<span class="lineno"></span><span class="comment" id="6375718">//&nbsp;A&nbsp;transaction&nbsp;must&nbsp;end&nbsp;with&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback.</span><br>
<span class="lineno"></span><span class="comment" id="6375779">//</span><br>
<span class="lineno"></span><span class="comment" id="6375782">//&nbsp;After&nbsp;a&nbsp;call&nbsp;to&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;all&nbsp;operations&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6375843">//&nbsp;transaction&nbsp;fail&nbsp;with&nbsp;ErrTxDone.</span><br>
<span class="lineno">1050</span><span class="keyword" id="6375879">type</span>&nbsp;<span class="ident" id="6375884">Tx</span>&nbsp;<span class="keyword" id="6375887">struct</span>&nbsp;<span class="op" id="6375894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6375897">db</span>&nbsp;<span class="op" id="6375900">*</span><span class="ident" id="6375901"><a href="/database/sql/sql.go.html#6354182">DB</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375906">//&nbsp;dc&nbsp;is&nbsp;owned&nbsp;exclusively&nbsp;until&nbsp;Commit&nbsp;or&nbsp;Rollback,&nbsp;at&nbsp;which&nbsp;point</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6375975">//&nbsp;it&#39;s&nbsp;returned&nbsp;with&nbsp;putConn.</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376007">dc</span>&nbsp;&nbsp;<span class="op" id="6376011">*</span><span class="ident" id="6376012"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376024">txi</span>&nbsp;<span class="ident" id="6376028"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6376034">.</span><span class="ident" id="6376035">Tx</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376040">//&nbsp;done&nbsp;transitions&nbsp;from&nbsp;false&nbsp;to&nbsp;true&nbsp;exactly&nbsp;once,&nbsp;on&nbsp;Commit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376104">//&nbsp;or&nbsp;Rollback.&nbsp;once&nbsp;done,&nbsp;all&nbsp;operations&nbsp;fail&nbsp;with</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376157">//&nbsp;ErrTxDone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376172">done</span>&nbsp;<span class="builtintype" id="6376177">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376184">//&nbsp;All&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.&nbsp;&nbsp;These&nbsp;will&nbsp;be&nbsp;closed&nbsp;after&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6376261">//&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376312">stmts</span>&nbsp;<span class="keyword" id="6376318">struct</span>&nbsp;<span class="op" id="6376325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376329"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6376333">.</span><span class="ident" id="6376334">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376342">v</span>&nbsp;<span class="op" id="6376344">[</span><span class="op" id="6376345">]</span><span class="op" id="6376346">*</span><span class="ident" id="6376347"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376353">}</span><br>
<span class="lineno"></span><span class="op" id="6376355">}</span><br>
<span class="lineno">1070</span><br>
<span class="lineno"></span><span class="keyword" id="6376358">var</span>&nbsp;<span class="ident" id="6376362">ErrTxDone</span>&nbsp;<span class="op" id="6376372">=</span>&nbsp;<span class="ident" id="6376374"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6376380">.</span><span class="ident" id="6376381">New</span><span class="op" id="6376384">(</span><span class="string" id="6376385">&#34;sql:&nbsp;Transaction&nbsp;has&nbsp;already&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back&#34;</span><span class="op" id="6376445">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6376448">func</span>&nbsp;<span class="op" id="6376453">(</span><span class="ident" id="6376454">tx</span>&nbsp;<span class="op" id="6376457">*</span><span class="ident" id="6376458"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6376460">)</span>&nbsp;<span class="builtinfunc" id="6376462">close</span><span class="op" id="6376467">(</span><span class="op" id="6376468">)</span>&nbsp;<span class="op" id="6376470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376473">if</span>&nbsp;<span class="ident" id="6376476"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376478">.</span><span class="ident" id="6376479">done</span>&nbsp;<span class="op" id="6376484">{</span><br>
<span class="lineno">1075</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6376488">panic</span><span class="op" id="6376493">(</span><span class="string" id="6376494">&#34;double&nbsp;close&#34;</span><span class="op" id="6376508">)</span>&nbsp;<span class="comment" id="6376510">//&nbsp;internal&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376532"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376534">.</span><span class="ident" id="6376535">done</span>&nbsp;<span class="op" id="6376540">=</span>&nbsp;<span class="builtintype" id="6376542">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376548"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376550">.</span><span class="ident" id="6376551">db</span><span class="op" id="6376553">.</span><span class="ident" id="6376554">putConn</span><span class="op" id="6376561">(</span><span class="ident" id="6376562"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376564">.</span><span class="ident" id="6376565">dc</span><span class="op" id="6376567">,</span>&nbsp;<span class="ident" id="6376569">nil</span><span class="op" id="6376572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376575"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376577">.</span><span class="ident" id="6376578">dc</span>&nbsp;<span class="op" id="6376581">=</span>&nbsp;<span class="ident" id="6376583">nil</span><br>
<span class="lineno">1080</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376588"><a href="/database/sql/sql.go.html#6376454">tx</a></span><span class="op" id="6376590">.</span><span class="ident" id="6376591">txi</span>&nbsp;<span class="op" id="6376595">=</span>&nbsp;<span class="ident" id="6376597">nil</span><br>
<span class="lineno"></span><span class="op" id="6376601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6376604">func</span>&nbsp;<span class="op" id="6376609">(</span><span class="ident" id="6376610">tx</span>&nbsp;<span class="op" id="6376613">*</span><span class="ident" id="6376614"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6376616">)</span>&nbsp;<span class="ident" id="6376618">grabConn</span><span class="op" id="6376626">(</span><span class="op" id="6376627">)</span>&nbsp;<span class="op" id="6376629">(</span><span class="op" id="6376630">*</span><span class="ident" id="6376631"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6376641">,</span>&nbsp;<span class="builtintype" id="6376643">error</span><span class="op" id="6376648">)</span>&nbsp;<span class="op" id="6376650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376653">if</span>&nbsp;<span class="ident" id="6376656"><a href="/database/sql/sql.go.html#6376610">tx</a></span><span class="op" id="6376658">.</span><span class="ident" id="6376659">done</span>&nbsp;<span class="op" id="6376664">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376668">return</span>&nbsp;<span class="ident" id="6376675">nil</span><span class="op" id="6376678">,</span>&nbsp;<span class="ident" id="6376680"><a href="/database/sql/sql.go.html#6376362">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376694">return</span>&nbsp;<span class="ident" id="6376701"><a href="/database/sql/sql.go.html#6376610">tx</a></span><span class="op" id="6376703">.</span><span class="ident" id="6376704">dc</span><span class="op" id="6376706">,</span>&nbsp;<span class="ident" id="6376708">nil</span><br>
<span class="lineno"></span><span class="op" id="6376712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1090</span><span class="comment" id="6376715">//&nbsp;Closes&nbsp;all&nbsp;Stmts&nbsp;prepared&nbsp;for&nbsp;this&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6376766">func</span>&nbsp;<span class="op" id="6376771">(</span><span class="ident" id="6376772">tx</span>&nbsp;<span class="op" id="6376775">*</span><span class="ident" id="6376776"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6376778">)</span>&nbsp;<span class="ident" id="6376780">closePrepared</span><span class="op" id="6376793">(</span><span class="op" id="6376794">)</span>&nbsp;<span class="op" id="6376796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376799"><a href="/database/sql/sql.go.html#6376772">tx</a></span><span class="op" id="6376801">.</span><span class="ident" id="6376802">stmts</span><span class="op" id="6376807">.</span><span class="ident" id="6376808">Lock</span><span class="op" id="6376812">(</span><span class="op" id="6376813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376816">for</span>&nbsp;<span class="ident" id="6376820">_</span><span class="op" id="6376821">,</span>&nbsp;<span class="ident" id="6376823">stmt</span>&nbsp;<span class="op" id="6376828">:=</span>&nbsp;<span class="keyword" id="6376831">range</span>&nbsp;<span class="ident" id="6376837"><a href="/database/sql/sql.go.html#6376772">tx</a></span><span class="op" id="6376839">.</span><span class="ident" id="6376840">stmts</span><span class="op" id="6376845">.</span><span class="ident" id="6376846">v</span>&nbsp;<span class="op" id="6376848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376852"><a href="/database/sql/sql.go.html#6376823">stmt</a></span><span class="op" id="6376856">.</span><span class="ident" id="6376857">Close</span><span class="op" id="6376862">(</span><span class="op" id="6376863">)</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6376869"><a href="/database/sql/sql.go.html#6376772">tx</a></span><span class="op" id="6376871">.</span><span class="ident" id="6376872">stmts</span><span class="op" id="6376877">.</span><span class="ident" id="6376878">Unlock</span><span class="op" id="6376884">(</span><span class="op" id="6376885">)</span><br>
<span class="lineno"></span><span class="op" id="6376887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6376890">//&nbsp;Commit&nbsp;commits&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1100</span><span class="keyword" id="6376925">func</span>&nbsp;<span class="op" id="6376930">(</span><span class="ident" id="6376931">tx</span>&nbsp;<span class="op" id="6376934">*</span><span class="ident" id="6376935"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6376937">)</span>&nbsp;<span class="ident" id="6376939">Commit</span><span class="op" id="6376945">(</span><span class="op" id="6376946">)</span>&nbsp;<span class="builtintype" id="6376948">error</span>&nbsp;<span class="op" id="6376954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376957">if</span>&nbsp;<span class="ident" id="6376960"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6376962">.</span><span class="ident" id="6376963">done</span>&nbsp;<span class="op" id="6376968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376972">return</span>&nbsp;<span class="ident" id="6376979"><a href="/database/sql/sql.go.html#6376362">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6376990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6376993">defer</span>&nbsp;<span class="ident" id="6376999"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6377001">.</span><span class="builtinfunc" id="6377002">close</span><span class="op" id="6377007">(</span><span class="op" id="6377008">)</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377011"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6377013">.</span><span class="ident" id="6377014">dc</span><span class="op" id="6377016">.</span><span class="ident" id="6377017">Lock</span><span class="op" id="6377021">(</span><span class="op" id="6377022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377025">err</span>&nbsp;<span class="op" id="6377029">:=</span>&nbsp;<span class="ident" id="6377032"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6377034">.</span><span class="ident" id="6377035">txi</span><span class="op" id="6377038">.</span><span class="ident" id="6377039">Commit</span><span class="op" id="6377045">(</span><span class="op" id="6377046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377049"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6377051">.</span><span class="ident" id="6377052">dc</span><span class="op" id="6377054">.</span><span class="ident" id="6377055">Unlock</span><span class="op" id="6377061">(</span><span class="op" id="6377062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377065">if</span>&nbsp;<span class="ident" id="6377068"><a href="/database/sql/sql.go.html#6377025">err</a></span>&nbsp;<span class="op" id="6377072">!=</span>&nbsp;<span class="ident" id="6377075"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6377081">.</span><span class="ident" id="6377082">ErrBadConn</span>&nbsp;<span class="op" id="6377093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377097"><a href="/database/sql/sql.go.html#6376931">tx</a></span><span class="op" id="6377099">.</span><span class="ident" id="6377100">closePrepared</span><span class="op" id="6377113">(</span><span class="op" id="6377114">)</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377120">return</span>&nbsp;<span class="ident" id="6377127"><a href="/database/sql/sql.go.html#6377025">err</a></span><br>
<span class="lineno"></span><span class="op" id="6377131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6377134">//&nbsp;Rollback&nbsp;aborts&nbsp;the&nbsp;transaction.</span><br>
<span class="lineno">1115</span><span class="keyword" id="6377170">func</span>&nbsp;<span class="op" id="6377175">(</span><span class="ident" id="6377176">tx</span>&nbsp;<span class="op" id="6377179">*</span><span class="ident" id="6377180"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6377182">)</span>&nbsp;<span class="ident" id="6377184">Rollback</span><span class="op" id="6377192">(</span><span class="op" id="6377193">)</span>&nbsp;<span class="builtintype" id="6377195">error</span>&nbsp;<span class="op" id="6377201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377204">if</span>&nbsp;<span class="ident" id="6377207"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377209">.</span><span class="ident" id="6377210">done</span>&nbsp;<span class="op" id="6377215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377219">return</span>&nbsp;<span class="ident" id="6377226"><a href="/database/sql/sql.go.html#6376362">ErrTxDone</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377240">defer</span>&nbsp;<span class="ident" id="6377246"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377248">.</span><span class="builtinfunc" id="6377249">close</span><span class="op" id="6377254">(</span><span class="op" id="6377255">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377258"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377260">.</span><span class="ident" id="6377261">dc</span><span class="op" id="6377263">.</span><span class="ident" id="6377264">Lock</span><span class="op" id="6377268">(</span><span class="op" id="6377269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377272">err</span>&nbsp;<span class="op" id="6377276">:=</span>&nbsp;<span class="ident" id="6377279"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377281">.</span><span class="ident" id="6377282">txi</span><span class="op" id="6377285">.</span><span class="ident" id="6377286">Rollback</span><span class="op" id="6377294">(</span><span class="op" id="6377295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377298"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377300">.</span><span class="ident" id="6377301">dc</span><span class="op" id="6377303">.</span><span class="ident" id="6377304">Unlock</span><span class="op" id="6377310">(</span><span class="op" id="6377311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377314">if</span>&nbsp;<span class="ident" id="6377317"><a href="/database/sql/sql.go.html#6377272">err</a></span>&nbsp;<span class="op" id="6377321">!=</span>&nbsp;<span class="ident" id="6377324"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6377330">.</span><span class="ident" id="6377331">ErrBadConn</span>&nbsp;<span class="op" id="6377342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6377346"><a href="/database/sql/sql.go.html#6377176">tx</a></span><span class="op" id="6377348">.</span><span class="ident" id="6377349">closePrepared</span><span class="op" id="6377362">(</span><span class="op" id="6377363">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6377366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6377369">return</span>&nbsp;<span class="ident" id="6377376"><a href="/database/sql/sql.go.html#6377272">err</a></span><br>
<span class="lineno"></span><span class="op" id="6377380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6377383">//&nbsp;Prepare&nbsp;creates&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;for&nbsp;use&nbsp;within&nbsp;a&nbsp;transaction.</span><br>
<span class="lineno">1130</span><span class="comment" id="6377453">//</span><br>
<span class="lineno"></span><span class="comment" id="6377456">//&nbsp;The&nbsp;returned&nbsp;statement&nbsp;operates&nbsp;within&nbsp;the&nbsp;transaction&nbsp;and&nbsp;can&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="6377532">//&nbsp;be&nbsp;used&nbsp;once&nbsp;the&nbsp;transaction&nbsp;has&nbsp;been&nbsp;committed&nbsp;or&nbsp;rolled&nbsp;back.</span><br>
<span class="lineno"></span><span class="comment" id="6377599">//</span><br>
<span class="lineno"></span><span class="comment" id="6377602">//&nbsp;To&nbsp;use&nbsp;an&nbsp;existing&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;this&nbsp;transaction,&nbsp;see&nbsp;Tx.Stmt.</span><br>
<span class="lineno">1135</span><span class="keyword" id="6377677">func</span>&nbsp;<span class="op" id="6377682">(</span><span class="ident" id="6377683">tx</span>&nbsp;<span class="op" id="6377686">*</span><span class="ident" id="6377687"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6377689">)</span>&nbsp;<span class="ident" id="6377691">Prepare</span><span class="op" id="6377698">(</span><span class="ident" id="6377699">query</span>&nbsp;<span class="builtintype" id="6377705">string</span><span class="op" id="6377711">)</span>&nbsp;<span class="op" id="6377713">(</span><span class="op" id="6377714">*</span><span class="ident" id="6377715"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6377719">,</span>&nbsp;<span class="builtintype" id="6377721">error</span><span class="op" id="6377726">)</span>&nbsp;<span class="op" id="6377728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377731">//&nbsp;TODO(bradfitz):&nbsp;We&nbsp;could&nbsp;be&nbsp;more&nbsp;efficient&nbsp;here&nbsp;and&nbsp;either</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377794">//&nbsp;provide&nbsp;a&nbsp;method&nbsp;to&nbsp;take&nbsp;an&nbsp;existing&nbsp;Stmt&nbsp;(created&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377852">//&nbsp;perhaps&nbsp;a&nbsp;different&nbsp;Conn),&nbsp;and&nbsp;re-create&nbsp;it&nbsp;on&nbsp;this&nbsp;Conn&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377916">//&nbsp;necessary.&nbsp;Or,&nbsp;better:&nbsp;keep&nbsp;a&nbsp;map&nbsp;in&nbsp;DB&nbsp;of&nbsp;query&nbsp;string&nbsp;to</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6377979">//&nbsp;Stmts,&nbsp;and&nbsp;have&nbsp;Stmt.Execute&nbsp;do&nbsp;the&nbsp;right&nbsp;thing&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378035">//&nbsp;re-prepare&nbsp;if&nbsp;the&nbsp;Conn&nbsp;in&nbsp;use&nbsp;doesn&#39;t&nbsp;have&nbsp;that&nbsp;prepared</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378096">//&nbsp;statement.&nbsp;&nbsp;But&nbsp;we&#39;ll&nbsp;want&nbsp;to&nbsp;avoid&nbsp;caching&nbsp;the&nbsp;statement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378158">//&nbsp;in&nbsp;the&nbsp;case&nbsp;where&nbsp;we&nbsp;only&nbsp;call&nbsp;conn.Prepare&nbsp;implicitly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378217">//&nbsp;(such&nbsp;as&nbsp;in&nbsp;db.Exec&nbsp;or&nbsp;tx.Exec),&nbsp;but&nbsp;the&nbsp;caller&nbsp;package</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378277">//&nbsp;can&#39;t&nbsp;be&nbsp;holding&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;returned&nbsp;statement.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378337">//&nbsp;Perhaps&nbsp;just&nbsp;looking&nbsp;at&nbsp;the&nbsp;reference&nbsp;count&nbsp;(by&nbsp;noting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378396">//&nbsp;Stmt.Close)&nbsp;would&nbsp;be&nbsp;enough.&nbsp;We&nbsp;might&nbsp;also&nbsp;want&nbsp;a&nbsp;finalizer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6378460">//&nbsp;on&nbsp;Stmt&nbsp;to&nbsp;drop&nbsp;the&nbsp;reference&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378501">dc</span><span class="op" id="6378503">,</span>&nbsp;<span class="ident" id="6378505">err</span>&nbsp;<span class="op" id="6378509">:=</span>&nbsp;<span class="ident" id="6378512"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378514">.</span><span class="ident" id="6378515">grabConn</span><span class="op" id="6378523">(</span><span class="op" id="6378524">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378527">if</span>&nbsp;<span class="ident" id="6378530"><a href="/database/sql/sql.go.html#6378505">err</a></span>&nbsp;<span class="op" id="6378534">!=</span>&nbsp;<span class="ident" id="6378537">nil</span>&nbsp;<span class="op" id="6378541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378545">return</span>&nbsp;<span class="ident" id="6378552">nil</span><span class="op" id="6378555">,</span>&nbsp;<span class="ident" id="6378557"><a href="/database/sql/sql.go.html#6378505">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378562">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378566"><a href="/database/sql/sql.go.html#6378501">dc</a></span><span class="op" id="6378568">.</span><span class="ident" id="6378569">Lock</span><span class="op" id="6378573">(</span><span class="op" id="6378574">)</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378577">si</span><span class="op" id="6378579">,</span>&nbsp;<span class="ident" id="6378581"><a href="/database/sql/sql.go.html#6378505">err</a></span>&nbsp;<span class="op" id="6378585">:=</span>&nbsp;<span class="ident" id="6378588"><a href="/database/sql/sql.go.html#6378501">dc</a></span><span class="op" id="6378590">.</span><span class="ident" id="6378591">ci</span><span class="op" id="6378593">.</span><span class="ident" id="6378594">Prepare</span><span class="op" id="6378601">(</span><span class="ident" id="6378602"><a href="/database/sql/sql.go.html#6377699">query</a></span><span class="op" id="6378607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378610"><a href="/database/sql/sql.go.html#6378501">dc</a></span><span class="op" id="6378612">.</span><span class="ident" id="6378613">Unlock</span><span class="op" id="6378619">(</span><span class="op" id="6378620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378623">if</span>&nbsp;<span class="ident" id="6378626"><a href="/database/sql/sql.go.html#6378505">err</a></span>&nbsp;<span class="op" id="6378630">!=</span>&nbsp;<span class="ident" id="6378633">nil</span>&nbsp;<span class="op" id="6378637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378641">return</span>&nbsp;<span class="ident" id="6378648">nil</span><span class="op" id="6378651">,</span>&nbsp;<span class="ident" id="6378653"><a href="/database/sql/sql.go.html#6378505">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378658">}</span><br>
<span class="lineno">1160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378662">stmt</span>&nbsp;<span class="op" id="6378667">:=</span>&nbsp;<span class="op" id="6378670">&amp;</span><span class="ident" id="6378671"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6378675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378679">db</span><span class="op" id="6378681">:</span>&nbsp;<span class="ident" id="6378683"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378685">.</span><span class="ident" id="6378686">db</span><span class="op" id="6378688">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378692">tx</span><span class="op" id="6378694">:</span>&nbsp;<span class="ident" id="6378696"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378698">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378702">txsi</span><span class="op" id="6378706">:</span>&nbsp;<span class="op" id="6378708">&amp;</span><span class="ident" id="6378709"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6378719">{</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378724">Locker</span><span class="op" id="6378730">:</span>&nbsp;<span class="ident" id="6378732"><a href="/database/sql/sql.go.html#6378501">dc</a></span><span class="op" id="6378734">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378739">si</span><span class="op" id="6378741">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6378747"><a href="/database/sql/sql.go.html#6378577">si</a></span><span class="op" id="6378749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378753">}</span><span class="op" id="6378754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378758">query</span><span class="op" id="6378763">:</span>&nbsp;<span class="ident" id="6378765"><a href="/database/sql/sql.go.html#6377699">query</a></span><span class="op" id="6378770">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6378773">}</span><br>
<span class="lineno">1170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378776"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378778">.</span><span class="ident" id="6378779">stmts</span><span class="op" id="6378784">.</span><span class="ident" id="6378785">Lock</span><span class="op" id="6378789">(</span><span class="op" id="6378790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378793"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378795">.</span><span class="ident" id="6378796">stmts</span><span class="op" id="6378801">.</span><span class="ident" id="6378802">v</span>&nbsp;<span class="op" id="6378804">=</span>&nbsp;<span class="builtinfunc" id="6378806">append</span><span class="op" id="6378812">(</span><span class="ident" id="6378813"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378815">.</span><span class="ident" id="6378816">stmts</span><span class="op" id="6378821">.</span><span class="ident" id="6378822">v</span><span class="op" id="6378823">,</span>&nbsp;<span class="ident" id="6378825"><a href="/database/sql/sql.go.html#6378662">stmt</a></span><span class="op" id="6378829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6378832"><a href="/database/sql/sql.go.html#6377683">tx</a></span><span class="op" id="6378834">.</span><span class="ident" id="6378835">stmts</span><span class="op" id="6378840">.</span><span class="ident" id="6378841">Unlock</span><span class="op" id="6378847">(</span><span class="op" id="6378848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6378851">return</span>&nbsp;<span class="ident" id="6378858"><a href="/database/sql/sql.go.html#6378662">stmt</a></span><span class="op" id="6378862">,</span>&nbsp;<span class="ident" id="6378864">nil</span><br>
<span class="lineno"></span><span class="op" id="6378868">}</span><br>
<span class="lineno">1175</span><br>
<span class="lineno"></span><span class="comment" id="6378871">//&nbsp;Stmt&nbsp;returns&nbsp;a&nbsp;transaction-specific&nbsp;prepared&nbsp;statement&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="6378934">//&nbsp;an&nbsp;existing&nbsp;statement.</span><br>
<span class="lineno"></span><span class="comment" id="6378960">//</span><br>
<span class="lineno"></span><span class="comment" id="6378963">//&nbsp;Example:</span><br>
<span class="lineno">1180</span><span class="comment" id="6378975">//&nbsp;&nbsp;updateMoney,&nbsp;err&nbsp;:=&nbsp;db.Prepare(&#34;UPDATE&nbsp;balance&nbsp;SET&nbsp;money=money+?&nbsp;WHERE&nbsp;id=?&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6379057">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6379065">//&nbsp;&nbsp;tx,&nbsp;err&nbsp;:=&nbsp;db.Begin()</span><br>
<span class="lineno"></span><span class="comment" id="6379091">//&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6379099">//&nbsp;&nbsp;res,&nbsp;err&nbsp;:=&nbsp;tx.Stmt(updateMoney).Exec(123.45,&nbsp;98293203)</span><br>
<span class="lineno">1185</span><span class="keyword" id="6379159">func</span>&nbsp;<span class="op" id="6379164">(</span><span class="ident" id="6379165">tx</span>&nbsp;<span class="op" id="6379168">*</span><span class="ident" id="6379169"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6379171">)</span>&nbsp;<span class="ident" id="6379173">Stmt</span><span class="op" id="6379177">(</span><span class="ident" id="6379178">stmt</span>&nbsp;<span class="op" id="6379183">*</span><span class="ident" id="6379184"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6379188">)</span>&nbsp;<span class="op" id="6379190">*</span><span class="ident" id="6379191"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span>&nbsp;<span class="op" id="6379196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379199">//&nbsp;TODO(bradfitz):&nbsp;optimize&nbsp;this.&nbsp;Currently&nbsp;this&nbsp;re-prepares</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379261">//&nbsp;each&nbsp;time.&nbsp;&nbsp;This&nbsp;is&nbsp;fine&nbsp;for&nbsp;now&nbsp;to&nbsp;illustrate&nbsp;the&nbsp;API&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379324">//&nbsp;we&nbsp;should&nbsp;really&nbsp;cache&nbsp;already-prepared&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6379379">//&nbsp;per-Conn.&nbsp;See&nbsp;also&nbsp;the&nbsp;big&nbsp;comment&nbsp;in&nbsp;Tx.Prepare.</span><br>
<span class="lineno">1190</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379434">if</span>&nbsp;<span class="ident" id="6379437"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379439">.</span><span class="ident" id="6379440">db</span>&nbsp;<span class="op" id="6379443">!=</span>&nbsp;<span class="ident" id="6379446"><a href="/database/sql/sql.go.html#6379178">stmt</a></span><span class="op" id="6379450">.</span><span class="ident" id="6379451">db</span>&nbsp;<span class="op" id="6379454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379458">return</span>&nbsp;<span class="op" id="6379465">&amp;</span><span class="ident" id="6379466"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6379470">{</span><span class="ident" id="6379471">stickyErr</span><span class="op" id="6379480">:</span>&nbsp;<span class="ident" id="6379482"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6379488">.</span><span class="ident" id="6379489">New</span><span class="op" id="6379492">(</span><span class="string" id="6379493">&#34;sql:&nbsp;Tx.Stmt:&nbsp;statement&nbsp;from&nbsp;different&nbsp;database&nbsp;used&#34;</span><span class="op" id="6379547">)</span><span class="op" id="6379548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379554">dc</span><span class="op" id="6379556">,</span>&nbsp;<span class="ident" id="6379558">err</span>&nbsp;<span class="op" id="6379562">:=</span>&nbsp;<span class="ident" id="6379565"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379567">.</span><span class="ident" id="6379568">grabConn</span><span class="op" id="6379576">(</span><span class="op" id="6379577">)</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379580">if</span>&nbsp;<span class="ident" id="6379583"><a href="/database/sql/sql.go.html#6379558">err</a></span>&nbsp;<span class="op" id="6379587">!=</span>&nbsp;<span class="ident" id="6379590">nil</span>&nbsp;<span class="op" id="6379594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379598">return</span>&nbsp;<span class="op" id="6379605">&amp;</span><span class="ident" id="6379606"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6379610">{</span><span class="ident" id="6379611">stickyErr</span><span class="op" id="6379620">:</span>&nbsp;<span class="ident" id="6379622"><a href="/database/sql/sql.go.html#6379558">err</a></span><span class="op" id="6379625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379631"><a href="/database/sql/sql.go.html#6379554">dc</a></span><span class="op" id="6379633">.</span><span class="ident" id="6379634">Lock</span><span class="op" id="6379638">(</span><span class="op" id="6379639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379642">si</span><span class="op" id="6379644">,</span>&nbsp;<span class="ident" id="6379646"><a href="/database/sql/sql.go.html#6379558">err</a></span>&nbsp;<span class="op" id="6379650">:=</span>&nbsp;<span class="ident" id="6379653"><a href="/database/sql/sql.go.html#6379554">dc</a></span><span class="op" id="6379655">.</span><span class="ident" id="6379656">ci</span><span class="op" id="6379658">.</span><span class="ident" id="6379659">Prepare</span><span class="op" id="6379666">(</span><span class="ident" id="6379667"><a href="/database/sql/sql.go.html#6379178">stmt</a></span><span class="op" id="6379671">.</span><span class="ident" id="6379672">query</span><span class="op" id="6379677">)</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379680"><a href="/database/sql/sql.go.html#6379554">dc</a></span><span class="op" id="6379682">.</span><span class="ident" id="6379683">Unlock</span><span class="op" id="6379689">(</span><span class="op" id="6379690">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379693">txs</span>&nbsp;<span class="op" id="6379697">:=</span>&nbsp;<span class="op" id="6379700">&amp;</span><span class="ident" id="6379701"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6379705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379709">db</span><span class="op" id="6379711">:</span>&nbsp;<span class="ident" id="6379713"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379715">.</span><span class="ident" id="6379716">db</span><span class="op" id="6379718">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379722">tx</span><span class="op" id="6379724">:</span>&nbsp;<span class="ident" id="6379726"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379728">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379732">txsi</span><span class="op" id="6379736">:</span>&nbsp;<span class="op" id="6379738">&amp;</span><span class="ident" id="6379739"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6379749">{</span><br>
<span class="lineno">1205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379754">Locker</span><span class="op" id="6379760">:</span>&nbsp;<span class="ident" id="6379762"><a href="/database/sql/sql.go.html#6379554">dc</a></span><span class="op" id="6379764">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379769">si</span><span class="op" id="6379771">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379777"><a href="/database/sql/sql.go.html#6379642">si</a></span><span class="op" id="6379779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379783">}</span><span class="op" id="6379784">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379788">query</span><span class="op" id="6379793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6379799"><a href="/database/sql/sql.go.html#6379178">stmt</a></span><span class="op" id="6379803">.</span><span class="ident" id="6379804">query</span><span class="op" id="6379809">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379813">stickyErr</span><span class="op" id="6379822">:</span>&nbsp;<span class="ident" id="6379824"><a href="/database/sql/sql.go.html#6379558">err</a></span><span class="op" id="6379827">,</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6379830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379833"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379835">.</span><span class="ident" id="6379836">stmts</span><span class="op" id="6379841">.</span><span class="ident" id="6379842">Lock</span><span class="op" id="6379846">(</span><span class="op" id="6379847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379850"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379852">.</span><span class="ident" id="6379853">stmts</span><span class="op" id="6379858">.</span><span class="ident" id="6379859">v</span>&nbsp;<span class="op" id="6379861">=</span>&nbsp;<span class="builtinfunc" id="6379863">append</span><span class="op" id="6379869">(</span><span class="ident" id="6379870"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379872">.</span><span class="ident" id="6379873">stmts</span><span class="op" id="6379878">.</span><span class="ident" id="6379879">v</span><span class="op" id="6379880">,</span>&nbsp;<span class="ident" id="6379882"><a href="/database/sql/sql.go.html#6379693">txs</a></span><span class="op" id="6379885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6379888"><a href="/database/sql/sql.go.html#6379165">tx</a></span><span class="op" id="6379890">.</span><span class="ident" id="6379891">stmts</span><span class="op" id="6379896">.</span><span class="ident" id="6379897">Unlock</span><span class="op" id="6379903">(</span><span class="op" id="6379904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6379907">return</span>&nbsp;<span class="ident" id="6379914"><a href="/database/sql/sql.go.html#6379693">txs</a></span><br>
<span class="lineno">1215</span><span class="op" id="6379918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6379921">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;doesn&#39;t&nbsp;return&nbsp;rows.</span><br>
<span class="lineno"></span><span class="comment" id="6379972">//&nbsp;For&nbsp;example:&nbsp;an&nbsp;INSERT&nbsp;and&nbsp;UPDATE.</span><br>
<span class="lineno"></span><span class="keyword" id="6380010">func</span>&nbsp;<span class="op" id="6380015">(</span><span class="ident" id="6380016">tx</span>&nbsp;<span class="op" id="6380019">*</span><span class="ident" id="6380020"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6380022">)</span>&nbsp;<span class="ident" id="6380024">Exec</span><span class="op" id="6380028">(</span><span class="ident" id="6380029">query</span>&nbsp;<span class="builtintype" id="6380035">string</span><span class="op" id="6380041">,</span>&nbsp;<span class="ident" id="6380043">args</span>&nbsp;<span class="op" id="6380048">...</span><span class="keyword" id="6380051">interface</span><span class="op" id="6380060">{</span><span class="op" id="6380061">}</span><span class="op" id="6380062">)</span>&nbsp;<span class="op" id="6380064">(</span><span class="ident" id="6380065"><a href="/database/sql/sql.go.html#6393463">Result</a></span><span class="op" id="6380071">,</span>&nbsp;<span class="builtintype" id="6380073">error</span><span class="op" id="6380078">)</span>&nbsp;<span class="op" id="6380080">{</span><br>
<span class="lineno">1220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380083">dc</span><span class="op" id="6380085">,</span>&nbsp;<span class="ident" id="6380087">err</span>&nbsp;<span class="op" id="6380091">:=</span>&nbsp;<span class="ident" id="6380094"><a href="/database/sql/sql.go.html#6380016">tx</a></span><span class="op" id="6380096">.</span><span class="ident" id="6380097">grabConn</span><span class="op" id="6380105">(</span><span class="op" id="6380106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380109">if</span>&nbsp;<span class="ident" id="6380112"><a href="/database/sql/sql.go.html#6380087">err</a></span>&nbsp;<span class="op" id="6380116">!=</span>&nbsp;<span class="ident" id="6380119">nil</span>&nbsp;<span class="op" id="6380123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380127">return</span>&nbsp;<span class="ident" id="6380134">nil</span><span class="op" id="6380137">,</span>&nbsp;<span class="ident" id="6380139"><a href="/database/sql/sql.go.html#6380087">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380148">if</span>&nbsp;<span class="ident" id="6380151">execer</span><span class="op" id="6380157">,</span>&nbsp;<span class="ident" id="6380159">ok</span>&nbsp;<span class="op" id="6380162">:=</span>&nbsp;<span class="ident" id="6380165"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380167">.</span><span class="ident" id="6380168">ci</span><span class="op" id="6380170">.</span><span class="op" id="6380171">(</span><span class="ident" id="6380172"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6380178">.</span><span class="ident" id="6380179">Execer</span><span class="op" id="6380185">)</span><span class="op" id="6380186">;</span>&nbsp;<span class="ident" id="6380188"><a href="/database/sql/sql.go.html#6380159">ok</a></span>&nbsp;<span class="op" id="6380191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380195">dargs</span><span class="op" id="6380200">,</span>&nbsp;<span class="ident" id="6380202">err</span>&nbsp;<span class="op" id="6380206">:=</span>&nbsp;<span class="ident" id="6380209"><a href="/database/sql/convert.go.html#6341842">driverArgs</a></span><span class="op" id="6380219">(</span><span class="ident" id="6380220">nil</span><span class="op" id="6380223">,</span>&nbsp;<span class="ident" id="6380225"><a href="/database/sql/sql.go.html#6380043">args</a></span><span class="op" id="6380229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380233">if</span>&nbsp;<span class="ident" id="6380236"><a href="/database/sql/sql.go.html#6380202">err</a></span>&nbsp;<span class="op" id="6380240">!=</span>&nbsp;<span class="ident" id="6380243">nil</span>&nbsp;<span class="op" id="6380247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380252">return</span>&nbsp;<span class="ident" id="6380259">nil</span><span class="op" id="6380262">,</span>&nbsp;<span class="ident" id="6380264"><a href="/database/sql/sql.go.html#6380202">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380270">}</span><br>
<span class="lineno">1230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380274"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380276">.</span><span class="ident" id="6380277">Lock</span><span class="op" id="6380281">(</span><span class="op" id="6380282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380286">resi</span><span class="op" id="6380290">,</span>&nbsp;<span class="ident" id="6380292"><a href="/database/sql/sql.go.html#6380202">err</a></span>&nbsp;<span class="op" id="6380296">:=</span>&nbsp;<span class="ident" id="6380299"><a href="/database/sql/sql.go.html#6380151">execer</a></span><span class="op" id="6380305">.</span><span class="ident" id="6380306">Exec</span><span class="op" id="6380310">(</span><span class="ident" id="6380311"><a href="/database/sql/sql.go.html#6380029">query</a></span><span class="op" id="6380316">,</span>&nbsp;<span class="ident" id="6380318"><a href="/database/sql/sql.go.html#6380195">dargs</a></span><span class="op" id="6380323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380327"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380329">.</span><span class="ident" id="6380330">Unlock</span><span class="op" id="6380336">(</span><span class="op" id="6380337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380341">if</span>&nbsp;<span class="ident" id="6380344"><a href="/database/sql/sql.go.html#6380202">err</a></span>&nbsp;<span class="op" id="6380348">==</span>&nbsp;<span class="ident" id="6380351">nil</span>&nbsp;<span class="op" id="6380355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380360">return</span>&nbsp;<span class="ident" id="6380367"><a href="/database/sql/sql.go.html#6393971">driverResult</a></span><span class="op" id="6380379">{</span><span class="ident" id="6380380"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380382">,</span>&nbsp;<span class="ident" id="6380384"><a href="/database/sql/sql.go.html#6380286">resi</a></span><span class="op" id="6380388">}</span><span class="op" id="6380389">,</span>&nbsp;<span class="ident" id="6380391">nil</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380401">if</span>&nbsp;<span class="ident" id="6380404"><a href="/database/sql/sql.go.html#6380202">err</a></span>&nbsp;<span class="op" id="6380408">!=</span>&nbsp;<span class="ident" id="6380411"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6380417">.</span><span class="ident" id="6380418">ErrSkip</span>&nbsp;<span class="op" id="6380426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380431">return</span>&nbsp;<span class="ident" id="6380438">nil</span><span class="op" id="6380441">,</span>&nbsp;<span class="ident" id="6380443"><a href="/database/sql/sql.go.html#6380202">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380449">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380452">}</span><br>
<span class="lineno">1240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380456"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380458">.</span><span class="ident" id="6380459">Lock</span><span class="op" id="6380463">(</span><span class="op" id="6380464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380467">si</span><span class="op" id="6380469">,</span>&nbsp;<span class="ident" id="6380471"><a href="/database/sql/sql.go.html#6380087">err</a></span>&nbsp;<span class="op" id="6380475">:=</span>&nbsp;<span class="ident" id="6380478"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380480">.</span><span class="ident" id="6380481">ci</span><span class="op" id="6380483">.</span><span class="ident" id="6380484">Prepare</span><span class="op" id="6380491">(</span><span class="ident" id="6380492"><a href="/database/sql/sql.go.html#6380029">query</a></span><span class="op" id="6380497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380500"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380502">.</span><span class="ident" id="6380503">Unlock</span><span class="op" id="6380509">(</span><span class="op" id="6380510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380513">if</span>&nbsp;<span class="ident" id="6380516"><a href="/database/sql/sql.go.html#6380087">err</a></span>&nbsp;<span class="op" id="6380520">!=</span>&nbsp;<span class="ident" id="6380523">nil</span>&nbsp;<span class="op" id="6380527">{</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380531">return</span>&nbsp;<span class="ident" id="6380538">nil</span><span class="op" id="6380541">,</span>&nbsp;<span class="ident" id="6380543"><a href="/database/sql/sql.go.html#6380087">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380548">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380551">defer</span>&nbsp;<span class="ident" id="6380557"><a href="/database/sql/sql.go.html#6394432">withLock</a></span><span class="op" id="6380565">(</span><span class="ident" id="6380566"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380568">,</span>&nbsp;<span class="keyword" id="6380570">func</span><span class="op" id="6380574">(</span><span class="op" id="6380575">)</span>&nbsp;<span class="op" id="6380577">{</span>&nbsp;<span class="ident" id="6380579"><a href="/database/sql/sql.go.html#6380467">si</a></span><span class="op" id="6380581">.</span><span class="ident" id="6380582">Close</span><span class="op" id="6380587">(</span><span class="op" id="6380588">)</span>&nbsp;<span class="op" id="6380590">}</span><span class="op" id="6380591">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380595">return</span>&nbsp;<span class="ident" id="6380602"><a href="/database/sql/sql.go.html#6382728">resultFromStatement</a></span><span class="op" id="6380621">(</span><span class="ident" id="6380622"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6380632">{</span><span class="ident" id="6380633"><a href="/database/sql/sql.go.html#6380083">dc</a></span><span class="op" id="6380635">,</span>&nbsp;<span class="ident" id="6380637"><a href="/database/sql/sql.go.html#6380467">si</a></span><span class="op" id="6380639">}</span><span class="op" id="6380640">,</span>&nbsp;<span class="ident" id="6380642"><a href="/database/sql/sql.go.html#6380043">args</a></span><span class="op" id="6380646">...</span><span class="op" id="6380649">)</span><br>
<span class="lineno">1250</span><span class="op" id="6380651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6380654">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;returns&nbsp;rows,&nbsp;typically&nbsp;a&nbsp;SELECT.</span><br>
<span class="lineno"></span><span class="keyword" id="6380719">func</span>&nbsp;<span class="op" id="6380724">(</span><span class="ident" id="6380725">tx</span>&nbsp;<span class="op" id="6380728">*</span><span class="ident" id="6380729"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6380731">)</span>&nbsp;<span class="ident" id="6380733">Query</span><span class="op" id="6380738">(</span><span class="ident" id="6380739">query</span>&nbsp;<span class="builtintype" id="6380745">string</span><span class="op" id="6380751">,</span>&nbsp;<span class="ident" id="6380753">args</span>&nbsp;<span class="op" id="6380758">...</span><span class="keyword" id="6380761">interface</span><span class="op" id="6380770">{</span><span class="op" id="6380771">}</span><span class="op" id="6380772">)</span>&nbsp;<span class="op" id="6380774">(</span><span class="op" id="6380775">*</span><span class="ident" id="6380776"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6380780">,</span>&nbsp;<span class="builtintype" id="6380782">error</span><span class="op" id="6380787">)</span>&nbsp;<span class="op" id="6380789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380792">dc</span><span class="op" id="6380794">,</span>&nbsp;<span class="ident" id="6380796">err</span>&nbsp;<span class="op" id="6380800">:=</span>&nbsp;<span class="ident" id="6380803"><a href="/database/sql/sql.go.html#6380725">tx</a></span><span class="op" id="6380805">.</span><span class="ident" id="6380806">grabConn</span><span class="op" id="6380814">(</span><span class="op" id="6380815">)</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380818">if</span>&nbsp;<span class="ident" id="6380821"><a href="/database/sql/sql.go.html#6380796">err</a></span>&nbsp;<span class="op" id="6380825">!=</span>&nbsp;<span class="ident" id="6380828">nil</span>&nbsp;<span class="op" id="6380832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380836">return</span>&nbsp;<span class="ident" id="6380843">nil</span><span class="op" id="6380846">,</span>&nbsp;<span class="ident" id="6380848"><a href="/database/sql/sql.go.html#6380796">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6380853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6380856">releaseConn</span>&nbsp;<span class="op" id="6380868">:=</span>&nbsp;<span class="keyword" id="6380871">func</span><span class="op" id="6380875">(</span><span class="builtintype" id="6380876">error</span><span class="op" id="6380881">)</span>&nbsp;<span class="op" id="6380883">{</span><span class="op" id="6380884">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6380887">return</span>&nbsp;<span class="ident" id="6380894"><a href="/database/sql/sql.go.html#6380725">tx</a></span><span class="op" id="6380896">.</span><span class="ident" id="6380897">db</span><span class="op" id="6380899">.</span><span class="ident" id="6380900">queryConn</span><span class="op" id="6380909">(</span><span class="ident" id="6380910"><a href="/database/sql/sql.go.html#6380792">dc</a></span><span class="op" id="6380912">,</span>&nbsp;<span class="ident" id="6380914"><a href="/database/sql/sql.go.html#6380856">releaseConn</a></span><span class="op" id="6380925">,</span>&nbsp;<span class="ident" id="6380927"><a href="/database/sql/sql.go.html#6380739">query</a></span><span class="op" id="6380932">,</span>&nbsp;<span class="ident" id="6380934"><a href="/database/sql/sql.go.html#6380753">args</a></span><span class="op" id="6380938">)</span><br>
<span class="lineno">1260</span><span class="op" id="6380940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6380943">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;query&nbsp;that&nbsp;is&nbsp;expected&nbsp;to&nbsp;return&nbsp;at&nbsp;most&nbsp;one&nbsp;row.</span><br>
<span class="lineno"></span><span class="comment" id="6381016">//&nbsp;QueryRow&nbsp;always&nbsp;return&nbsp;a&nbsp;non-nil&nbsp;value.&nbsp;Errors&nbsp;are&nbsp;deferred&nbsp;until</span><br>
<span class="lineno"></span><span class="comment" id="6381085">//&nbsp;Row&#39;s&nbsp;Scan&nbsp;method&nbsp;is&nbsp;called.</span><br>
<span class="lineno">1265</span><span class="keyword" id="6381117">func</span>&nbsp;<span class="op" id="6381122">(</span><span class="ident" id="6381123">tx</span>&nbsp;<span class="op" id="6381126">*</span><span class="ident" id="6381127"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><span class="op" id="6381129">)</span>&nbsp;<span class="ident" id="6381131">QueryRow</span><span class="op" id="6381139">(</span><span class="ident" id="6381140">query</span>&nbsp;<span class="builtintype" id="6381146">string</span><span class="op" id="6381152">,</span>&nbsp;<span class="ident" id="6381154">args</span>&nbsp;<span class="op" id="6381159">...</span><span class="keyword" id="6381162">interface</span><span class="op" id="6381171">{</span><span class="op" id="6381172">}</span><span class="op" id="6381173">)</span>&nbsp;<span class="op" id="6381175">*</span><span class="ident" id="6381176"><a href="/database/sql/sql.go.html#6391775">Row</a></span>&nbsp;<span class="op" id="6381180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381183">rows</span><span class="op" id="6381187">,</span>&nbsp;<span class="ident" id="6381189">err</span>&nbsp;<span class="op" id="6381193">:=</span>&nbsp;<span class="ident" id="6381196"><a href="/database/sql/sql.go.html#6381123">tx</a></span><span class="op" id="6381198">.</span><span class="ident" id="6381199">Query</span><span class="op" id="6381204">(</span><span class="ident" id="6381205"><a href="/database/sql/sql.go.html#6381140">query</a></span><span class="op" id="6381210">,</span>&nbsp;<span class="ident" id="6381212"><a href="/database/sql/sql.go.html#6381154">args</a></span><span class="op" id="6381216">...</span><span class="op" id="6381219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6381222">return</span>&nbsp;<span class="op" id="6381229">&amp;</span><span class="ident" id="6381230"><a href="/database/sql/sql.go.html#6391775">Row</a></span><span class="op" id="6381233">{</span><span class="ident" id="6381234">rows</span><span class="op" id="6381238">:</span>&nbsp;<span class="ident" id="6381240"><a href="/database/sql/sql.go.html#6381183">rows</a></span><span class="op" id="6381244">,</span>&nbsp;<span class="ident" id="6381246">err</span><span class="op" id="6381249">:</span>&nbsp;<span class="ident" id="6381251"><a href="/database/sql/sql.go.html#6381189">err</a></span><span class="op" id="6381254">}</span><br>
<span class="lineno"></span><span class="op" id="6381256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1270</span><span class="comment" id="6381259">//&nbsp;connStmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;on&nbsp;a&nbsp;particular&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6381323">type</span>&nbsp;<span class="ident" id="6381328">connStmt</span>&nbsp;<span class="keyword" id="6381337">struct</span>&nbsp;<span class="op" id="6381344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381347">dc</span>&nbsp;<span class="op" id="6381350">*</span><span class="ident" id="6381351"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381363">si</span>&nbsp;<span class="ident" id="6381366"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6381372">.</span><span class="ident" id="6381373">Stmt</span><br>
<span class="lineno"></span><span class="op" id="6381378">}</span><br>
<span class="lineno">1275</span><br>
<span class="lineno"></span><span class="comment" id="6381381">//&nbsp;Stmt&nbsp;is&nbsp;a&nbsp;prepared&nbsp;statement.&nbsp;Stmt&nbsp;is&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="6381470">type</span>&nbsp;<span class="ident" id="6381475">Stmt</span>&nbsp;<span class="keyword" id="6381480">struct</span>&nbsp;<span class="op" id="6381487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381490">//&nbsp;Immutable:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381505">db</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6381515">*</span><span class="ident" id="6381516"><a href="/database/sql/sql.go.html#6354182">DB</a></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6381522">//&nbsp;where&nbsp;we&nbsp;came&nbsp;from</span><br>
<span class="lineno">1280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381545">query</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6381555">string</span>&nbsp;<span class="comment" id="6381562">//&nbsp;that&nbsp;created&nbsp;the&nbsp;Stmt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381588">stickyErr</span>&nbsp;<span class="builtintype" id="6381598">error</span>&nbsp;&nbsp;<span class="comment" id="6381605">//&nbsp;if&nbsp;non-nil,&nbsp;this&nbsp;error&nbsp;is&nbsp;returned&nbsp;for&nbsp;all&nbsp;operations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381664">closemu</span>&nbsp;<span class="ident" id="6381672"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6381676">.</span><span class="ident" id="6381677">RWMutex</span>&nbsp;<span class="comment" id="6381685">//&nbsp;held&nbsp;exclusively&nbsp;during&nbsp;close,&nbsp;for&nbsp;read&nbsp;otherwise.</span><br>
<span class="lineno"></span><br>
<span class="lineno">1285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381741">//&nbsp;If&nbsp;in&nbsp;a&nbsp;transaction,&nbsp;else&nbsp;both&nbsp;nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381781">tx</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6381786">*</span><span class="ident" id="6381787"><a href="/database/sql/sql.go.html#6375884">Tx</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381791">txsi</span>&nbsp;<span class="op" id="6381796">*</span><span class="ident" id="6381797"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381810">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6381817"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6381821">.</span><span class="ident" id="6381822">Mutex</span>&nbsp;<span class="comment" id="6381828">//&nbsp;protects&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;fields</span><br>
<span class="lineno">1290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6381864">closed</span>&nbsp;<span class="builtintype" id="6381871">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381878">//&nbsp;css&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;underlying&nbsp;driver&nbsp;statement&nbsp;interfaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381938">//&nbsp;that&nbsp;are&nbsp;valid&nbsp;on&nbsp;particular&nbsp;connections.&nbsp;&nbsp;This&nbsp;is&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6381998">//&nbsp;used&nbsp;if&nbsp;tx&nbsp;==&nbsp;nil&nbsp;and&nbsp;one&nbsp;is&nbsp;found&nbsp;that&nbsp;has&nbsp;idle</span><br>
<span class="lineno">1295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382051">//&nbsp;connections.&nbsp;&nbsp;If&nbsp;tx&nbsp;!=&nbsp;nil,&nbsp;txsi&nbsp;is&nbsp;always&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382104">css</span>&nbsp;<span class="op" id="6382108">[</span><span class="op" id="6382109">]</span><span class="ident" id="6382110"><a href="/database/sql/sql.go.html#6381328">connStmt</a></span><br>
<span class="lineno"></span><span class="op" id="6382119">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6382122">//&nbsp;Exec&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments&nbsp;and</span><br>
<span class="lineno">1300</span><span class="comment" id="6382189">//&nbsp;returns&nbsp;a&nbsp;Result&nbsp;summarizing&nbsp;the&nbsp;effect&nbsp;of&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="6382250">func</span>&nbsp;<span class="op" id="6382255">(</span><span class="ident" id="6382256">s</span>&nbsp;<span class="op" id="6382258">*</span><span class="ident" id="6382259"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6382263">)</span>&nbsp;<span class="ident" id="6382265">Exec</span><span class="op" id="6382269">(</span><span class="ident" id="6382270">args</span>&nbsp;<span class="op" id="6382275">...</span><span class="keyword" id="6382278">interface</span><span class="op" id="6382287">{</span><span class="op" id="6382288">}</span><span class="op" id="6382289">)</span>&nbsp;<span class="op" id="6382291">(</span><span class="ident" id="6382292"><a href="/database/sql/sql.go.html#6393463">Result</a></span><span class="op" id="6382298">,</span>&nbsp;<span class="builtintype" id="6382300">error</span><span class="op" id="6382305">)</span>&nbsp;<span class="op" id="6382307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382310"><a href="/database/sql/sql.go.html#6382256">s</a></span><span class="op" id="6382311">.</span><span class="ident" id="6382312">closemu</span><span class="op" id="6382319">.</span><span class="ident" id="6382320">RLock</span><span class="op" id="6382325">(</span><span class="op" id="6382326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382329">defer</span>&nbsp;<span class="ident" id="6382335"><a href="/database/sql/sql.go.html#6382256">s</a></span><span class="op" id="6382336">.</span><span class="ident" id="6382337">closemu</span><span class="op" id="6382344">.</span><span class="ident" id="6382345">RUnlock</span><span class="op" id="6382352">(</span><span class="op" id="6382353">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382357">var</span>&nbsp;<span class="ident" id="6382361">res</span>&nbsp;<span class="ident" id="6382365"><a href="/database/sql/sql.go.html#6393463">Result</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382373">for</span>&nbsp;<span class="ident" id="6382377">i</span>&nbsp;<span class="op" id="6382379">:=</span>&nbsp;<span class="num" id="6382382">0</span><span class="op" id="6382383">;</span>&nbsp;<span class="ident" id="6382385"><a href="/database/sql/sql.go.html#6382377">i</a></span>&nbsp;<span class="op" id="6382387">&lt;</span>&nbsp;<span class="ident" id="6382389"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6382406">;</span>&nbsp;<span class="ident" id="6382408"><a href="/database/sql/sql.go.html#6382377">i</a></span><span class="op" id="6382409">++</span>&nbsp;<span class="op" id="6382412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382416">dc</span><span class="op" id="6382418">,</span>&nbsp;<span class="ident" id="6382420">releaseConn</span><span class="op" id="6382431">,</span>&nbsp;<span class="ident" id="6382433">si</span><span class="op" id="6382435">,</span>&nbsp;<span class="ident" id="6382437">err</span>&nbsp;<span class="op" id="6382441">:=</span>&nbsp;<span class="ident" id="6382444"><a href="/database/sql/sql.go.html#6382256">s</a></span><span class="op" id="6382445">.</span><span class="ident" id="6382446">connStmt</span><span class="op" id="6382454">(</span><span class="op" id="6382455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382459">if</span>&nbsp;<span class="ident" id="6382462"><a href="/database/sql/sql.go.html#6382437">err</a></span>&nbsp;<span class="op" id="6382466">!=</span>&nbsp;<span class="ident" id="6382469">nil</span>&nbsp;<span class="op" id="6382473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382478">if</span>&nbsp;<span class="ident" id="6382481"><a href="/database/sql/sql.go.html#6382437">err</a></span>&nbsp;<span class="op" id="6382485">==</span>&nbsp;<span class="ident" id="6382488"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6382494">.</span><span class="ident" id="6382495">ErrBadConn</span>&nbsp;<span class="op" id="6382506">{</span><br>
<span class="lineno">1310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382512">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382524">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382529">return</span>&nbsp;<span class="ident" id="6382536">nil</span><span class="op" id="6382539">,</span>&nbsp;<span class="ident" id="6382541"><a href="/database/sql/sql.go.html#6382437">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382552"><a href="/database/sql/sql.go.html#6382361">res</a></span><span class="op" id="6382555">,</span>&nbsp;<span class="ident" id="6382557"><a href="/database/sql/sql.go.html#6382437">err</a></span>&nbsp;<span class="op" id="6382561">=</span>&nbsp;<span class="ident" id="6382563"><a href="/database/sql/sql.go.html#6382728">resultFromStatement</a></span><span class="op" id="6382582">(</span><span class="ident" id="6382583"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6382593">{</span><span class="ident" id="6382594"><a href="/database/sql/sql.go.html#6382416">dc</a></span><span class="op" id="6382596">,</span>&nbsp;<span class="ident" id="6382598"><a href="/database/sql/sql.go.html#6382433">si</a></span><span class="op" id="6382600">}</span><span class="op" id="6382601">,</span>&nbsp;<span class="ident" id="6382603"><a href="/database/sql/sql.go.html#6382270">args</a></span><span class="op" id="6382607">...</span><span class="op" id="6382610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382614"><a href="/database/sql/sql.go.html#6382420">releaseConn</a></span><span class="op" id="6382625">(</span><span class="ident" id="6382626"><a href="/database/sql/sql.go.html#6382437">err</a></span><span class="op" id="6382629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382633">if</span>&nbsp;<span class="ident" id="6382636"><a href="/database/sql/sql.go.html#6382437">err</a></span>&nbsp;<span class="op" id="6382640">!=</span>&nbsp;<span class="ident" id="6382643"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6382649">.</span><span class="ident" id="6382650">ErrBadConn</span>&nbsp;<span class="op" id="6382661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382666">return</span>&nbsp;<span class="ident" id="6382673"><a href="/database/sql/sql.go.html#6382361">res</a></span><span class="op" id="6382676">,</span>&nbsp;<span class="ident" id="6382678"><a href="/database/sql/sql.go.html#6382437">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382684">}</span><br>
<span class="lineno">1320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6382687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6382690">return</span>&nbsp;<span class="ident" id="6382697">nil</span><span class="op" id="6382700">,</span>&nbsp;<span class="ident" id="6382702"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6382708">.</span><span class="ident" id="6382709">ErrBadConn</span><br>
<span class="lineno"></span><span class="op" id="6382720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6382723">func</span>&nbsp;<span class="ident" id="6382728">resultFromStatement</span><span class="op" id="6382747">(</span><span class="ident" id="6382748">ds</span>&nbsp;<span class="ident" id="6382751"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6382761">,</span>&nbsp;<span class="ident" id="6382763">args</span>&nbsp;<span class="op" id="6382768">...</span><span class="keyword" id="6382771">interface</span><span class="op" id="6382780">{</span><span class="op" id="6382781">}</span><span class="op" id="6382782">)</span>&nbsp;<span class="op" id="6382784">(</span><span class="ident" id="6382785"><a href="/database/sql/sql.go.html#6393463">Result</a></span><span class="op" id="6382791">,</span>&nbsp;<span class="builtintype" id="6382793">error</span><span class="op" id="6382798">)</span>&nbsp;<span class="op" id="6382800">{</span><br>
<span class="lineno">1325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382803"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6382805">.</span><span class="ident" id="6382806">Lock</span><span class="op" id="6382810">(</span><span class="op" id="6382811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382814">want</span>&nbsp;<span class="op" id="6382819">:=</span>&nbsp;<span class="ident" id="6382822"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6382824">.</span><span class="ident" id="6382825">si</span><span class="op" id="6382827">.</span><span class="ident" id="6382828">NumInput</span><span class="op" id="6382836">(</span><span class="op" id="6382837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6382840"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6382842">.</span><span class="ident" id="6382843">Unlock</span><span class="op" id="6382849">(</span><span class="op" id="6382850">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382854">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno">1330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382918">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6382992">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383021">if</span>&nbsp;<span class="ident" id="6383024"><a href="/database/sql/sql.go.html#6382814">want</a></span>&nbsp;<span class="op" id="6383029">!=</span>&nbsp;<span class="op" id="6383032">-</span><span class="num" id="6383033">1</span>&nbsp;<span class="op" id="6383035">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6383038">len</span><span class="op" id="6383041">(</span><span class="ident" id="6383042"><a href="/database/sql/sql.go.html#6382763">args</a></span><span class="op" id="6383046">)</span>&nbsp;<span class="op" id="6383048">!=</span>&nbsp;<span class="ident" id="6383051"><a href="/database/sql/sql.go.html#6382814">want</a></span>&nbsp;<span class="op" id="6383056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383060">return</span>&nbsp;<span class="ident" id="6383067">nil</span><span class="op" id="6383070">,</span>&nbsp;<span class="ident" id="6383072"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6383075">.</span><span class="ident" id="6383076">Errorf</span><span class="op" id="6383082">(</span><span class="string" id="6383083">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;arguments,&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6383119">,</span>&nbsp;<span class="ident" id="6383121"><a href="/database/sql/sql.go.html#6382814">want</a></span><span class="op" id="6383125">,</span>&nbsp;<span class="builtinfunc" id="6383127">len</span><span class="op" id="6383130">(</span><span class="ident" id="6383131"><a href="/database/sql/sql.go.html#6382763">args</a></span><span class="op" id="6383135">)</span><span class="op" id="6383136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383139">}</span><br>
<span class="lineno">1335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383143">dargs</span><span class="op" id="6383148">,</span>&nbsp;<span class="ident" id="6383150">err</span>&nbsp;<span class="op" id="6383154">:=</span>&nbsp;<span class="ident" id="6383157"><a href="/database/sql/convert.go.html#6341842">driverArgs</a></span><span class="op" id="6383167">(</span><span class="op" id="6383168">&amp;</span><span class="ident" id="6383169"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6383171">,</span>&nbsp;<span class="ident" id="6383173"><a href="/database/sql/sql.go.html#6382763">args</a></span><span class="op" id="6383177">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383180">if</span>&nbsp;<span class="ident" id="6383183"><a href="/database/sql/sql.go.html#6383150">err</a></span>&nbsp;<span class="op" id="6383187">!=</span>&nbsp;<span class="ident" id="6383190">nil</span>&nbsp;<span class="op" id="6383194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383198">return</span>&nbsp;<span class="ident" id="6383205">nil</span><span class="op" id="6383208">,</span>&nbsp;<span class="ident" id="6383210"><a href="/database/sql/sql.go.html#6383150">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383215">}</span><br>
<span class="lineno">1340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383219"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6383221">.</span><span class="ident" id="6383222">Lock</span><span class="op" id="6383226">(</span><span class="op" id="6383227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383230">resi</span><span class="op" id="6383234">,</span>&nbsp;<span class="ident" id="6383236"><a href="/database/sql/sql.go.html#6383150">err</a></span>&nbsp;<span class="op" id="6383240">:=</span>&nbsp;<span class="ident" id="6383243"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6383245">.</span><span class="ident" id="6383246">si</span><span class="op" id="6383248">.</span><span class="ident" id="6383249">Exec</span><span class="op" id="6383253">(</span><span class="ident" id="6383254"><a href="/database/sql/sql.go.html#6383143">dargs</a></span><span class="op" id="6383259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383262"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6383264">.</span><span class="ident" id="6383265">Unlock</span><span class="op" id="6383271">(</span><span class="op" id="6383272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383275">if</span>&nbsp;<span class="ident" id="6383278"><a href="/database/sql/sql.go.html#6383150">err</a></span>&nbsp;<span class="op" id="6383282">!=</span>&nbsp;<span class="ident" id="6383285">nil</span>&nbsp;<span class="op" id="6383289">{</span><br>
<span class="lineno">1345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383293">return</span>&nbsp;<span class="ident" id="6383300">nil</span><span class="op" id="6383303">,</span>&nbsp;<span class="ident" id="6383305"><a href="/database/sql/sql.go.html#6383150">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383313">return</span>&nbsp;<span class="ident" id="6383320"><a href="/database/sql/sql.go.html#6393971">driverResult</a></span><span class="op" id="6383332">{</span><span class="ident" id="6383333"><a href="/database/sql/sql.go.html#6382748">ds</a></span><span class="op" id="6383335">.</span><span class="ident" id="6383336">Locker</span><span class="op" id="6383342">,</span>&nbsp;<span class="ident" id="6383344"><a href="/database/sql/sql.go.html#6383230">resi</a></span><span class="op" id="6383348">}</span><span class="op" id="6383349">,</span>&nbsp;<span class="ident" id="6383351">nil</span><br>
<span class="lineno"></span><span class="op" id="6383355">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1350</span><span class="comment" id="6383358">//&nbsp;connStmt&nbsp;returns&nbsp;a&nbsp;free&nbsp;driver&nbsp;connection&nbsp;on&nbsp;which&nbsp;to&nbsp;execute&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6383427">//&nbsp;statement,&nbsp;a&nbsp;function&nbsp;to&nbsp;call&nbsp;to&nbsp;release&nbsp;the&nbsp;connection,&nbsp;and&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="6383493">//&nbsp;statement&nbsp;bound&nbsp;to&nbsp;that&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6383532">func</span>&nbsp;<span class="op" id="6383537">(</span><span class="ident" id="6383538">s</span>&nbsp;<span class="op" id="6383540">*</span><span class="ident" id="6383541"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6383545">)</span>&nbsp;<span class="ident" id="6383547">connStmt</span><span class="op" id="6383555">(</span><span class="op" id="6383556">)</span>&nbsp;<span class="op" id="6383558">(</span><span class="ident" id="6383559">ci</span>&nbsp;<span class="op" id="6383562">*</span><span class="ident" id="6383563"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span><span class="op" id="6383573">,</span>&nbsp;<span class="ident" id="6383575">releaseConn</span>&nbsp;<span class="keyword" id="6383587">func</span><span class="op" id="6383591">(</span><span class="builtintype" id="6383592">error</span><span class="op" id="6383597">)</span><span class="op" id="6383598">,</span>&nbsp;<span class="ident" id="6383600">si</span>&nbsp;<span class="ident" id="6383603"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6383609">.</span><span class="ident" id="6383610">Stmt</span><span class="op" id="6383614">,</span>&nbsp;<span class="ident" id="6383616">err</span>&nbsp;<span class="builtintype" id="6383620">error</span><span class="op" id="6383625">)</span>&nbsp;<span class="op" id="6383627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383630">if</span>&nbsp;<span class="ident" id="6383633"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6383637">=</span>&nbsp;<span class="ident" id="6383639"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383640">.</span><span class="ident" id="6383641">stickyErr</span><span class="op" id="6383650">;</span>&nbsp;<span class="ident" id="6383652"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6383656">!=</span>&nbsp;<span class="ident" id="6383659">nil</span>&nbsp;<span class="op" id="6383663">{</span><br>
<span class="lineno">1355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383667">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383678"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383679">.</span><span class="ident" id="6383680">mu</span><span class="op" id="6383682">.</span><span class="ident" id="6383683">Lock</span><span class="op" id="6383687">(</span><span class="op" id="6383688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383691">if</span>&nbsp;<span class="ident" id="6383694"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383695">.</span><span class="ident" id="6383696">closed</span>&nbsp;<span class="op" id="6383703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383707"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383708">.</span><span class="ident" id="6383709">mu</span><span class="op" id="6383711">.</span><span class="ident" id="6383712">Unlock</span><span class="op" id="6383718">(</span><span class="op" id="6383719">)</span><br>
<span class="lineno">1360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383723"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6383727">=</span>&nbsp;<span class="ident" id="6383729"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6383735">.</span><span class="ident" id="6383736">New</span><span class="op" id="6383739">(</span><span class="string" id="6383740">&#34;sql:&nbsp;statement&nbsp;is&nbsp;closed&#34;</span><span class="op" id="6383766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383770">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6383778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383782">//&nbsp;In&nbsp;a&nbsp;transaction,&nbsp;we&nbsp;always&nbsp;use&nbsp;the&nbsp;connection&nbsp;that&nbsp;the</span><br>
<span class="lineno">1365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6383842">//&nbsp;transaction&nbsp;was&nbsp;created&nbsp;on.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383874">if</span>&nbsp;<span class="ident" id="6383877"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383878">.</span><span class="ident" id="6383879">tx</span>&nbsp;<span class="op" id="6383882">!=</span>&nbsp;<span class="ident" id="6383885">nil</span>&nbsp;<span class="op" id="6383889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383893"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383894">.</span><span class="ident" id="6383895">mu</span><span class="op" id="6383897">.</span><span class="ident" id="6383898">Unlock</span><span class="op" id="6383904">(</span><span class="op" id="6383905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6383909"><a href="/database/sql/sql.go.html#6383559">ci</a></span><span class="op" id="6383911">,</span>&nbsp;<span class="ident" id="6383913"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6383917">=</span>&nbsp;<span class="ident" id="6383919"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6383920">.</span><span class="ident" id="6383921">tx</span><span class="op" id="6383923">.</span><span class="ident" id="6383924">grabConn</span><span class="op" id="6383932">(</span><span class="op" id="6383933">)</span>&nbsp;<span class="comment" id="6383935">//&nbsp;blocks,&nbsp;waiting&nbsp;for&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383976">if</span>&nbsp;<span class="ident" id="6383979"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6383983">!=</span>&nbsp;<span class="ident" id="6383986">nil</span>&nbsp;<span class="op" id="6383990">{</span><br>
<span class="lineno">1370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6383995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384008"><a href="/database/sql/sql.go.html#6383575">releaseConn</a></span>&nbsp;<span class="op" id="6384020">=</span>&nbsp;<span class="keyword" id="6384022">func</span><span class="op" id="6384026">(</span><span class="builtintype" id="6384027">error</span><span class="op" id="6384032">)</span>&nbsp;<span class="op" id="6384034">{</span><span class="op" id="6384035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384039">return</span>&nbsp;<span class="ident" id="6384046"><a href="/database/sql/sql.go.html#6383559">ci</a></span><span class="op" id="6384048">,</span>&nbsp;<span class="ident" id="6384050"><a href="/database/sql/sql.go.html#6383575">releaseConn</a></span><span class="op" id="6384061">,</span>&nbsp;<span class="ident" id="6384063"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384064">.</span><span class="ident" id="6384065">txsi</span><span class="op" id="6384069">.</span><span class="ident" id="6384070">si</span><span class="op" id="6384072">,</span>&nbsp;<span class="ident" id="6384074">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384079">}</span><br>
<span class="lineno">1375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384083">for</span>&nbsp;<span class="ident" id="6384087">i</span>&nbsp;<span class="op" id="6384089">:=</span>&nbsp;<span class="num" id="6384092">0</span><span class="op" id="6384093">;</span>&nbsp;<span class="ident" id="6384095"><a href="/database/sql/sql.go.html#6384087">i</a></span>&nbsp;<span class="op" id="6384097">&lt;</span>&nbsp;<span class="builtinfunc" id="6384099">len</span><span class="op" id="6384102">(</span><span class="ident" id="6384103"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384104">.</span><span class="ident" id="6384105">css</span><span class="op" id="6384108">)</span><span class="op" id="6384109">;</span>&nbsp;<span class="ident" id="6384111"><a href="/database/sql/sql.go.html#6384087">i</a></span><span class="op" id="6384112">++</span>&nbsp;<span class="op" id="6384115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384119">v</span>&nbsp;<span class="op" id="6384121">:=</span>&nbsp;<span class="ident" id="6384124"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384125">.</span><span class="ident" id="6384126">css</span><span class="op" id="6384129">[</span><span class="ident" id="6384130"><a href="/database/sql/sql.go.html#6384087">i</a></span><span class="op" id="6384131">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384135">_</span><span class="op" id="6384136">,</span>&nbsp;<span class="ident" id="6384138">err</span>&nbsp;<span class="op" id="6384142">:=</span>&nbsp;<span class="ident" id="6384145"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384146">.</span><span class="ident" id="6384147">db</span><span class="op" id="6384149">.</span><span class="ident" id="6384150">connIfFree</span><span class="op" id="6384160">(</span><span class="ident" id="6384161"><a href="/database/sql/sql.go.html#6384119">v</a></span><span class="op" id="6384162">.</span><span class="ident" id="6384163">dc</span><span class="op" id="6384165">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384169">if</span>&nbsp;<span class="ident" id="6384172"><a href="/database/sql/sql.go.html#6384138">err</a></span>&nbsp;<span class="op" id="6384176">==</span>&nbsp;<span class="ident" id="6384179">nil</span>&nbsp;<span class="op" id="6384183">{</span><br>
<span class="lineno">1380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384188"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384189">.</span><span class="ident" id="6384190">mu</span><span class="op" id="6384192">.</span><span class="ident" id="6384193">Unlock</span><span class="op" id="6384199">(</span><span class="op" id="6384200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384205">return</span>&nbsp;<span class="ident" id="6384212"><a href="/database/sql/sql.go.html#6384119">v</a></span><span class="op" id="6384213">.</span><span class="ident" id="6384214">dc</span><span class="op" id="6384216">,</span>&nbsp;<span class="ident" id="6384218"><a href="/database/sql/sql.go.html#6384119">v</a></span><span class="op" id="6384219">.</span><span class="ident" id="6384220">dc</span><span class="op" id="6384222">.</span><span class="ident" id="6384223">releaseConn</span><span class="op" id="6384234">,</span>&nbsp;<span class="ident" id="6384236"><a href="/database/sql/sql.go.html#6384119">v</a></span><span class="op" id="6384237">.</span><span class="ident" id="6384238">si</span><span class="op" id="6384240">,</span>&nbsp;<span class="ident" id="6384242">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384252">if</span>&nbsp;<span class="ident" id="6384255"><a href="/database/sql/sql.go.html#6384138">err</a></span>&nbsp;<span class="op" id="6384259">==</span>&nbsp;<span class="ident" id="6384262"><a href="/database/sql/sql.go.html#6366627">errConnClosed</a></span>&nbsp;<span class="op" id="6384276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384281">//&nbsp;Lazily&nbsp;remove&nbsp;dead&nbsp;conn&nbsp;from&nbsp;our&nbsp;freelist.</span><br>
<span class="lineno">1385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384330"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384331">.</span><span class="ident" id="6384332">css</span><span class="op" id="6384335">[</span><span class="ident" id="6384336"><a href="/database/sql/sql.go.html#6384087">i</a></span><span class="op" id="6384337">]</span>&nbsp;<span class="op" id="6384339">=</span>&nbsp;<span class="ident" id="6384341"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384342">.</span><span class="ident" id="6384343">css</span><span class="op" id="6384346">[</span><span class="builtinfunc" id="6384347">len</span><span class="op" id="6384350">(</span><span class="ident" id="6384351"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384352">.</span><span class="ident" id="6384353">css</span><span class="op" id="6384356">)</span><span class="op" id="6384357">-</span><span class="num" id="6384358">1</span><span class="op" id="6384359">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384364"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384365">.</span><span class="ident" id="6384366">css</span>&nbsp;<span class="op" id="6384370">=</span>&nbsp;<span class="ident" id="6384372"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384373">.</span><span class="ident" id="6384374">css</span><span class="op" id="6384377">[</span><span class="op" id="6384378">:</span><span class="builtinfunc" id="6384379">len</span><span class="op" id="6384382">(</span><span class="ident" id="6384383"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384384">.</span><span class="ident" id="6384385">css</span><span class="op" id="6384388">)</span><span class="op" id="6384389">-</span><span class="num" id="6384390">1</span><span class="op" id="6384391">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384396"><a href="/database/sql/sql.go.html#6384087">i</a></span><span class="op" id="6384397">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384406">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384409"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384410">.</span><span class="ident" id="6384411">mu</span><span class="op" id="6384413">.</span><span class="ident" id="6384414">Unlock</span><span class="op" id="6384420">(</span><span class="op" id="6384421">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384425">//&nbsp;If&nbsp;all&nbsp;connections&nbsp;are&nbsp;busy,&nbsp;either&nbsp;wait&nbsp;for&nbsp;one&nbsp;to&nbsp;become&nbsp;available&nbsp;(if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384502">//&nbsp;we&#39;ve&nbsp;already&nbsp;hit&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;open&nbsp;connections)&nbsp;or&nbsp;create&nbsp;a</span><br>
<span class="lineno">1395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384576">//&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384589">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384593">//&nbsp;TODO(bradfitz):&nbsp;or&nbsp;always&nbsp;wait&nbsp;for&nbsp;one?&nbsp;make&nbsp;configurable&nbsp;later?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384662">dc</span><span class="op" id="6384664">,</span>&nbsp;<span class="ident" id="6384666"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6384670">:=</span>&nbsp;<span class="ident" id="6384673"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384674">.</span><span class="ident" id="6384675">db</span><span class="op" id="6384677">.</span><span class="ident" id="6384678">conn</span><span class="op" id="6384682">(</span><span class="op" id="6384683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384686">if</span>&nbsp;<span class="ident" id="6384689"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6384693">!=</span>&nbsp;<span class="ident" id="6384696">nil</span>&nbsp;<span class="op" id="6384700">{</span><br>
<span class="lineno">1400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384704">return</span>&nbsp;<span class="ident" id="6384711">nil</span><span class="op" id="6384714">,</span>&nbsp;<span class="ident" id="6384716">nil</span><span class="op" id="6384719">,</span>&nbsp;<span class="ident" id="6384721">nil</span><span class="op" id="6384724">,</span>&nbsp;<span class="ident" id="6384726"><a href="/database/sql/sql.go.html#6383616">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384735">//&nbsp;Do&nbsp;another&nbsp;pass&nbsp;over&nbsp;the&nbsp;list&nbsp;to&nbsp;see&nbsp;whether&nbsp;this&nbsp;statement&nbsp;has</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6384803">//&nbsp;already&nbsp;been&nbsp;prepared&nbsp;on&nbsp;the&nbsp;connection&nbsp;assigned&nbsp;to&nbsp;us.</span><br>
<span class="lineno">1405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384863"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384864">.</span><span class="ident" id="6384865">mu</span><span class="op" id="6384867">.</span><span class="ident" id="6384868">Lock</span><span class="op" id="6384872">(</span><span class="op" id="6384873">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384876">for</span>&nbsp;<span class="ident" id="6384880">_</span><span class="op" id="6384881">,</span>&nbsp;<span class="ident" id="6384883">v</span>&nbsp;<span class="op" id="6384885">:=</span>&nbsp;<span class="keyword" id="6384888">range</span>&nbsp;<span class="ident" id="6384894"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384895">.</span><span class="ident" id="6384896">css</span>&nbsp;<span class="op" id="6384900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384904">if</span>&nbsp;<span class="ident" id="6384907"><a href="/database/sql/sql.go.html#6384883">v</a></span><span class="op" id="6384908">.</span><span class="ident" id="6384909">dc</span>&nbsp;<span class="op" id="6384912">==</span>&nbsp;<span class="ident" id="6384915"><a href="/database/sql/sql.go.html#6384662">dc</a></span>&nbsp;<span class="op" id="6384918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384923"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384924">.</span><span class="ident" id="6384925">mu</span><span class="op" id="6384927">.</span><span class="ident" id="6384928">Unlock</span><span class="op" id="6384934">(</span><span class="op" id="6384935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6384940">return</span>&nbsp;<span class="ident" id="6384947"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6384949">,</span>&nbsp;<span class="ident" id="6384951"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6384953">.</span><span class="ident" id="6384954">releaseConn</span><span class="op" id="6384965">,</span>&nbsp;<span class="ident" id="6384967"><a href="/database/sql/sql.go.html#6384883">v</a></span><span class="op" id="6384968">.</span><span class="ident" id="6384969">si</span><span class="op" id="6384971">,</span>&nbsp;<span class="ident" id="6384973">nil</span><br>
<span class="lineno">1410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6384982">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6384985"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6384986">.</span><span class="ident" id="6384987">mu</span><span class="op" id="6384989">.</span><span class="ident" id="6384990">Unlock</span><span class="op" id="6384996">(</span><span class="op" id="6384997">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385001">//&nbsp;No&nbsp;luck;&nbsp;we&nbsp;need&nbsp;to&nbsp;prepare&nbsp;the&nbsp;statement&nbsp;on&nbsp;this&nbsp;connection</span><br>
<span class="lineno">1415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385066"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385068">.</span><span class="ident" id="6385069">Lock</span><span class="op" id="6385073">(</span><span class="op" id="6385074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385077"><a href="/database/sql/sql.go.html#6383600">si</a></span><span class="op" id="6385079">,</span>&nbsp;<span class="ident" id="6385081"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6385085">=</span>&nbsp;<span class="ident" id="6385087"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385089">.</span><span class="ident" id="6385090">prepareLocked</span><span class="op" id="6385103">(</span><span class="ident" id="6385104"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385105">.</span><span class="ident" id="6385106">query</span><span class="op" id="6385111">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385114"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385116">.</span><span class="ident" id="6385117">Unlock</span><span class="op" id="6385123">(</span><span class="op" id="6385124">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385127">if</span>&nbsp;<span class="ident" id="6385130"><a href="/database/sql/sql.go.html#6383616">err</a></span>&nbsp;<span class="op" id="6385134">!=</span>&nbsp;<span class="ident" id="6385137">nil</span>&nbsp;<span class="op" id="6385141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385145"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385146">.</span><span class="ident" id="6385147">db</span><span class="op" id="6385149">.</span><span class="ident" id="6385150">putConn</span><span class="op" id="6385157">(</span><span class="ident" id="6385158"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385160">,</span>&nbsp;<span class="ident" id="6385162"><a href="/database/sql/sql.go.html#6383616">err</a></span><span class="op" id="6385165">)</span><br>
<span class="lineno">1420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385169">return</span>&nbsp;<span class="ident" id="6385176">nil</span><span class="op" id="6385179">,</span>&nbsp;<span class="ident" id="6385181">nil</span><span class="op" id="6385184">,</span>&nbsp;<span class="ident" id="6385186">nil</span><span class="op" id="6385189">,</span>&nbsp;<span class="ident" id="6385191"><a href="/database/sql/sql.go.html#6383616">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385199"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385200">.</span><span class="ident" id="6385201">mu</span><span class="op" id="6385203">.</span><span class="ident" id="6385204">Lock</span><span class="op" id="6385208">(</span><span class="op" id="6385209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385212">cs</span>&nbsp;<span class="op" id="6385215">:=</span>&nbsp;<span class="ident" id="6385218"><a href="/database/sql/sql.go.html#6381328">connStmt</a></span><span class="op" id="6385226">{</span><span class="ident" id="6385227"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385229">,</span>&nbsp;<span class="ident" id="6385231"><a href="/database/sql/sql.go.html#6383600">si</a></span><span class="op" id="6385233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385236"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385237">.</span><span class="ident" id="6385238">css</span>&nbsp;<span class="op" id="6385242">=</span>&nbsp;<span class="builtinfunc" id="6385244">append</span><span class="op" id="6385250">(</span><span class="ident" id="6385251"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385252">.</span><span class="ident" id="6385253">css</span><span class="op" id="6385256">,</span>&nbsp;<span class="ident" id="6385258"><a href="/database/sql/sql.go.html#6385212">cs</a></span><span class="op" id="6385260">)</span><br>
<span class="lineno">1425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385263"><a href="/database/sql/sql.go.html#6383538">s</a></span><span class="op" id="6385264">.</span><span class="ident" id="6385265">mu</span><span class="op" id="6385267">.</span><span class="ident" id="6385268">Unlock</span><span class="op" id="6385274">(</span><span class="op" id="6385275">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385279">return</span>&nbsp;<span class="ident" id="6385286"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385288">,</span>&nbsp;<span class="ident" id="6385290"><a href="/database/sql/sql.go.html#6384662">dc</a></span><span class="op" id="6385292">.</span><span class="ident" id="6385293">releaseConn</span><span class="op" id="6385304">,</span>&nbsp;<span class="ident" id="6385306"><a href="/database/sql/sql.go.html#6383600">si</a></span><span class="op" id="6385308">,</span>&nbsp;<span class="ident" id="6385310">nil</span><br>
<span class="lineno"></span><span class="op" id="6385314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1430</span><span class="comment" id="6385317">//&nbsp;Query&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments</span><br>
<span class="lineno"></span><span class="comment" id="6385387">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;query&nbsp;results&nbsp;as&nbsp;a&nbsp;*Rows.</span><br>
<span class="lineno"></span><span class="keyword" id="6385432">func</span>&nbsp;<span class="op" id="6385437">(</span><span class="ident" id="6385438">s</span>&nbsp;<span class="op" id="6385440">*</span><span class="ident" id="6385441"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6385445">)</span>&nbsp;<span class="ident" id="6385447">Query</span><span class="op" id="6385452">(</span><span class="ident" id="6385453">args</span>&nbsp;<span class="op" id="6385458">...</span><span class="keyword" id="6385461">interface</span><span class="op" id="6385470">{</span><span class="op" id="6385471">}</span><span class="op" id="6385472">)</span>&nbsp;<span class="op" id="6385474">(</span><span class="op" id="6385475">*</span><span class="ident" id="6385476"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6385480">,</span>&nbsp;<span class="builtintype" id="6385482">error</span><span class="op" id="6385487">)</span>&nbsp;<span class="op" id="6385489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385492"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6385493">.</span><span class="ident" id="6385494">closemu</span><span class="op" id="6385501">.</span><span class="ident" id="6385502">RLock</span><span class="op" id="6385507">(</span><span class="op" id="6385508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385511">defer</span>&nbsp;<span class="ident" id="6385517"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6385518">.</span><span class="ident" id="6385519">closemu</span><span class="op" id="6385526">.</span><span class="ident" id="6385527">RUnlock</span><span class="op" id="6385534">(</span><span class="op" id="6385535">)</span><br>
<span class="lineno">1435</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385539">var</span>&nbsp;<span class="ident" id="6385543">rowsi</span>&nbsp;<span class="ident" id="6385549"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6385555">.</span><span class="ident" id="6385556">Rows</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385562">for</span>&nbsp;<span class="ident" id="6385566">i</span>&nbsp;<span class="op" id="6385568">:=</span>&nbsp;<span class="num" id="6385571">0</span><span class="op" id="6385572">;</span>&nbsp;<span class="ident" id="6385574"><a href="/database/sql/sql.go.html#6385566">i</a></span>&nbsp;<span class="op" id="6385576">&lt;</span>&nbsp;<span class="ident" id="6385578"><a href="/database/sql/sql.go.html#6370683">maxBadConnRetries</a></span><span class="op" id="6385595">;</span>&nbsp;<span class="ident" id="6385597"><a href="/database/sql/sql.go.html#6385566">i</a></span><span class="op" id="6385598">++</span>&nbsp;<span class="op" id="6385601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385605">dc</span><span class="op" id="6385607">,</span>&nbsp;<span class="ident" id="6385609">releaseConn</span><span class="op" id="6385620">,</span>&nbsp;<span class="ident" id="6385622">si</span><span class="op" id="6385624">,</span>&nbsp;<span class="ident" id="6385626">err</span>&nbsp;<span class="op" id="6385630">:=</span>&nbsp;<span class="ident" id="6385633"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6385634">.</span><span class="ident" id="6385635">connStmt</span><span class="op" id="6385643">(</span><span class="op" id="6385644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385648">if</span>&nbsp;<span class="ident" id="6385651"><a href="/database/sql/sql.go.html#6385626">err</a></span>&nbsp;<span class="op" id="6385655">!=</span>&nbsp;<span class="ident" id="6385658">nil</span>&nbsp;<span class="op" id="6385662">{</span><br>
<span class="lineno">1440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385667">if</span>&nbsp;<span class="ident" id="6385670"><a href="/database/sql/sql.go.html#6385626">err</a></span>&nbsp;<span class="op" id="6385674">==</span>&nbsp;<span class="ident" id="6385677"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6385683">.</span><span class="ident" id="6385684">ErrBadConn</span>&nbsp;<span class="op" id="6385695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385701">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385718">return</span>&nbsp;<span class="ident" id="6385725">nil</span><span class="op" id="6385728">,</span>&nbsp;<span class="ident" id="6385730"><a href="/database/sql/sql.go.html#6385626">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385736">}</span><br>
<span class="lineno">1445</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385741"><a href="/database/sql/sql.go.html#6385543">rowsi</a></span><span class="op" id="6385746">,</span>&nbsp;<span class="ident" id="6385748"><a href="/database/sql/sql.go.html#6385626">err</a></span>&nbsp;<span class="op" id="6385752">=</span>&nbsp;<span class="ident" id="6385754"><a href="/database/sql/sql.go.html#6386249">rowsiFromStatement</a></span><span class="op" id="6385772">(</span><span class="ident" id="6385773"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6385783">{</span><span class="ident" id="6385784"><a href="/database/sql/sql.go.html#6385605">dc</a></span><span class="op" id="6385786">,</span>&nbsp;<span class="ident" id="6385788"><a href="/database/sql/sql.go.html#6385622">si</a></span><span class="op" id="6385790">}</span><span class="op" id="6385791">,</span>&nbsp;<span class="ident" id="6385793"><a href="/database/sql/sql.go.html#6385453">args</a></span><span class="op" id="6385797">...</span><span class="op" id="6385800">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385804">if</span>&nbsp;<span class="ident" id="6385807"><a href="/database/sql/sql.go.html#6385626">err</a></span>&nbsp;<span class="op" id="6385811">==</span>&nbsp;<span class="ident" id="6385814">nil</span>&nbsp;<span class="op" id="6385818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385823">//&nbsp;Note:&nbsp;ownership&nbsp;of&nbsp;ci&nbsp;passes&nbsp;to&nbsp;the&nbsp;*Rows,&nbsp;to&nbsp;be&nbsp;freed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385884">//&nbsp;with&nbsp;releaseConn.</span><br>
<span class="lineno">1450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385908">rows</span>&nbsp;<span class="op" id="6385913">:=</span>&nbsp;<span class="op" id="6385916">&amp;</span><span class="ident" id="6385917"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6385921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385927">dc</span><span class="op" id="6385929">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6385934"><a href="/database/sql/sql.go.html#6385605">dc</a></span><span class="op" id="6385936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385942">rowsi</span><span class="op" id="6385947">:</span>&nbsp;<span class="ident" id="6385949"><a href="/database/sql/sql.go.html#6385543">rowsi</a></span><span class="op" id="6385954">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385960">//&nbsp;releaseConn&nbsp;set&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385988">}</span><br>
<span class="lineno">1455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385993"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6385994">.</span><span class="ident" id="6385995">db</span><span class="op" id="6385997">.</span><span class="ident" id="6385998">addDep</span><span class="op" id="6386004">(</span><span class="ident" id="6386005"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6386006">,</span>&nbsp;<span class="ident" id="6386008"><a href="/database/sql/sql.go.html#6385908">rows</a></span><span class="op" id="6386012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386017"><a href="/database/sql/sql.go.html#6385908">rows</a></span><span class="op" id="6386021">.</span><span class="ident" id="6386022">releaseConn</span>&nbsp;<span class="op" id="6386034">=</span>&nbsp;<span class="keyword" id="6386036">func</span><span class="op" id="6386040">(</span><span class="ident" id="6386041">err</span>&nbsp;<span class="builtintype" id="6386045">error</span><span class="op" id="6386050">)</span>&nbsp;<span class="op" id="6386052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386058"><a href="/database/sql/sql.go.html#6385609">releaseConn</a></span><span class="op" id="6386069">(</span><span class="ident" id="6386070"><a href="/database/sql/sql.go.html#6386041">err</a></span><span class="op" id="6386073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386079"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6386080">.</span><span class="ident" id="6386081">db</span><span class="op" id="6386083">.</span><span class="ident" id="6386084">removeDep</span><span class="op" id="6386093">(</span><span class="ident" id="6386094"><a href="/database/sql/sql.go.html#6385438">s</a></span><span class="op" id="6386095">,</span>&nbsp;<span class="ident" id="6386097"><a href="/database/sql/sql.go.html#6385908">rows</a></span><span class="op" id="6386101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386106">}</span><br>
<span class="lineno">1460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386111">return</span>&nbsp;<span class="ident" id="6386118"><a href="/database/sql/sql.go.html#6385908">rows</a></span><span class="op" id="6386122">,</span>&nbsp;<span class="ident" id="6386124">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386135"><a href="/database/sql/sql.go.html#6385609">releaseConn</a></span><span class="op" id="6386146">(</span><span class="ident" id="6386147"><a href="/database/sql/sql.go.html#6385626">err</a></span><span class="op" id="6386150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386154">if</span>&nbsp;<span class="ident" id="6386157"><a href="/database/sql/sql.go.html#6385626">err</a></span>&nbsp;<span class="op" id="6386161">!=</span>&nbsp;<span class="ident" id="6386164"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6386170">.</span><span class="ident" id="6386171">ErrBadConn</span>&nbsp;<span class="op" id="6386182">{</span><br>
<span class="lineno">1465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386187">return</span>&nbsp;<span class="ident" id="6386194">nil</span><span class="op" id="6386197">,</span>&nbsp;<span class="ident" id="6386199"><a href="/database/sql/sql.go.html#6385626">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386211">return</span>&nbsp;<span class="ident" id="6386218">nil</span><span class="op" id="6386221">,</span>&nbsp;<span class="ident" id="6386223"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6386229">.</span><span class="ident" id="6386230">ErrBadConn</span><br>
<span class="lineno"></span><span class="op" id="6386241">}</span><br>
<span class="lineno">1470</span><br>
<span class="lineno"></span><span class="keyword" id="6386244">func</span>&nbsp;<span class="ident" id="6386249">rowsiFromStatement</span><span class="op" id="6386267">(</span><span class="ident" id="6386268">ds</span>&nbsp;<span class="ident" id="6386271"><a href="/database/sql/sql.go.html#6357659">driverStmt</a></span><span class="op" id="6386281">,</span>&nbsp;<span class="ident" id="6386283">args</span>&nbsp;<span class="op" id="6386288">...</span><span class="keyword" id="6386291">interface</span><span class="op" id="6386300">{</span><span class="op" id="6386301">}</span><span class="op" id="6386302">)</span>&nbsp;<span class="op" id="6386304">(</span><span class="ident" id="6386305"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6386311">.</span><span class="ident" id="6386312">Rows</span><span class="op" id="6386316">,</span>&nbsp;<span class="builtintype" id="6386318">error</span><span class="op" id="6386323">)</span>&nbsp;<span class="op" id="6386325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386328"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386330">.</span><span class="ident" id="6386331">Lock</span><span class="op" id="6386335">(</span><span class="op" id="6386336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386339">want</span>&nbsp;<span class="op" id="6386344">:=</span>&nbsp;<span class="ident" id="6386347"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386349">.</span><span class="ident" id="6386350">si</span><span class="op" id="6386352">.</span><span class="ident" id="6386353">NumInput</span><span class="op" id="6386361">(</span><span class="op" id="6386362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386365"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386367">.</span><span class="ident" id="6386368">Unlock</span><span class="op" id="6386374">(</span><span class="op" id="6386375">)</span><br>
<span class="lineno">1475</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386379">//&nbsp;-1&nbsp;means&nbsp;the&nbsp;driver&nbsp;doesn&#39;t&nbsp;know&nbsp;how&nbsp;to&nbsp;count&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386443">//&nbsp;placeholders,&nbsp;so&nbsp;we&nbsp;won&#39;t&nbsp;sanity&nbsp;check&nbsp;input&nbsp;here&nbsp;and&nbsp;instead&nbsp;let&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386517">//&nbsp;driver&nbsp;deal&nbsp;with&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386546">if</span>&nbsp;<span class="ident" id="6386549"><a href="/database/sql/sql.go.html#6386339">want</a></span>&nbsp;<span class="op" id="6386554">!=</span>&nbsp;<span class="op" id="6386557">-</span><span class="num" id="6386558">1</span>&nbsp;<span class="op" id="6386560">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6386563">len</span><span class="op" id="6386566">(</span><span class="ident" id="6386567"><a href="/database/sql/sql.go.html#6386283">args</a></span><span class="op" id="6386571">)</span>&nbsp;<span class="op" id="6386573">!=</span>&nbsp;<span class="ident" id="6386576"><a href="/database/sql/sql.go.html#6386339">want</a></span>&nbsp;<span class="op" id="6386581">{</span><br>
<span class="lineno">1480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386585">return</span>&nbsp;<span class="ident" id="6386592">nil</span><span class="op" id="6386595">,</span>&nbsp;<span class="ident" id="6386597"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6386600">.</span><span class="ident" id="6386601">Errorf</span><span class="op" id="6386607">(</span><span class="string" id="6386608">&#34;sql:&nbsp;statement&nbsp;expects&nbsp;%d&nbsp;inputs;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="6386650">,</span>&nbsp;<span class="ident" id="6386652"><a href="/database/sql/sql.go.html#6386339">want</a></span><span class="op" id="6386656">,</span>&nbsp;<span class="builtinfunc" id="6386658">len</span><span class="op" id="6386661">(</span><span class="ident" id="6386662"><a href="/database/sql/sql.go.html#6386283">args</a></span><span class="op" id="6386666">)</span><span class="op" id="6386667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386670">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386674">dargs</span><span class="op" id="6386679">,</span>&nbsp;<span class="ident" id="6386681">err</span>&nbsp;<span class="op" id="6386685">:=</span>&nbsp;<span class="ident" id="6386688"><a href="/database/sql/convert.go.html#6341842">driverArgs</a></span><span class="op" id="6386698">(</span><span class="op" id="6386699">&amp;</span><span class="ident" id="6386700"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386702">,</span>&nbsp;<span class="ident" id="6386704"><a href="/database/sql/sql.go.html#6386283">args</a></span><span class="op" id="6386708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386711">if</span>&nbsp;<span class="ident" id="6386714"><a href="/database/sql/sql.go.html#6386681">err</a></span>&nbsp;<span class="op" id="6386718">!=</span>&nbsp;<span class="ident" id="6386721">nil</span>&nbsp;<span class="op" id="6386725">{</span><br>
<span class="lineno">1485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386729">return</span>&nbsp;<span class="ident" id="6386736">nil</span><span class="op" id="6386739">,</span>&nbsp;<span class="ident" id="6386741"><a href="/database/sql/sql.go.html#6386681">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386750"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386752">.</span><span class="ident" id="6386753">Lock</span><span class="op" id="6386757">(</span><span class="op" id="6386758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386761">rowsi</span><span class="op" id="6386766">,</span>&nbsp;<span class="ident" id="6386768"><a href="/database/sql/sql.go.html#6386681">err</a></span>&nbsp;<span class="op" id="6386772">:=</span>&nbsp;<span class="ident" id="6386775"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386777">.</span><span class="ident" id="6386778">si</span><span class="op" id="6386780">.</span><span class="ident" id="6386781">Query</span><span class="op" id="6386786">(</span><span class="ident" id="6386787"><a href="/database/sql/sql.go.html#6386674">dargs</a></span><span class="op" id="6386792">)</span><br>
<span class="lineno">1490</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386795"><a href="/database/sql/sql.go.html#6386268">ds</a></span><span class="op" id="6386797">.</span><span class="ident" id="6386798">Unlock</span><span class="op" id="6386804">(</span><span class="op" id="6386805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386808">if</span>&nbsp;<span class="ident" id="6386811"><a href="/database/sql/sql.go.html#6386681">err</a></span>&nbsp;<span class="op" id="6386815">!=</span>&nbsp;<span class="ident" id="6386818">nil</span>&nbsp;<span class="op" id="6386822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386826">return</span>&nbsp;<span class="ident" id="6386833">nil</span><span class="op" id="6386836">,</span>&nbsp;<span class="ident" id="6386838"><a href="/database/sql/sql.go.html#6386681">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386846">return</span>&nbsp;<span class="ident" id="6386853"><a href="/database/sql/sql.go.html#6386761">rowsi</a></span><span class="op" id="6386858">,</span>&nbsp;<span class="ident" id="6386860">nil</span><br>
<span class="lineno">1495</span><span class="op" id="6386864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6386867">//&nbsp;QueryRow&nbsp;executes&nbsp;a&nbsp;prepared&nbsp;query&nbsp;statement&nbsp;with&nbsp;the&nbsp;given&nbsp;arguments.</span><br>
<span class="lineno"></span><span class="comment" id="6386941">//&nbsp;If&nbsp;an&nbsp;error&nbsp;occurs&nbsp;during&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;statement,&nbsp;that&nbsp;error&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="6387018">//&nbsp;be&nbsp;returned&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Scan&nbsp;on&nbsp;the&nbsp;returned&nbsp;*Row,&nbsp;which&nbsp;is&nbsp;always&nbsp;non-nil.</span><br>
<span class="lineno">1500</span><span class="comment" id="6387098">//&nbsp;If&nbsp;the&nbsp;query&nbsp;selects&nbsp;no&nbsp;rows,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;will&nbsp;return&nbsp;ErrNoRows.</span><br>
<span class="lineno"></span><span class="comment" id="6387170">//&nbsp;Otherwise,&nbsp;the&nbsp;*Row&#39;s&nbsp;Scan&nbsp;scans&nbsp;the&nbsp;first&nbsp;selected&nbsp;row&nbsp;and&nbsp;discards</span><br>
<span class="lineno"></span><span class="comment" id="6387242">//&nbsp;the&nbsp;rest.</span><br>
<span class="lineno"></span><span class="comment" id="6387255">//</span><br>
<span class="lineno"></span><span class="comment" id="6387258">//&nbsp;Example&nbsp;usage:</span><br>
<span class="lineno">1505</span><span class="comment" id="6387276">//</span><br>
<span class="lineno"></span><span class="comment" id="6387279">//&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="6387299">//&nbsp;&nbsp;err&nbsp;:=&nbsp;nameByUseridStmt.QueryRow(id).Scan(&amp;name)</span><br>
<span class="lineno"></span><span class="keyword" id="6387352">func</span>&nbsp;<span class="op" id="6387357">(</span><span class="ident" id="6387358">s</span>&nbsp;<span class="op" id="6387360">*</span><span class="ident" id="6387361"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6387365">)</span>&nbsp;<span class="ident" id="6387367">QueryRow</span><span class="op" id="6387375">(</span><span class="ident" id="6387376">args</span>&nbsp;<span class="op" id="6387381">...</span><span class="keyword" id="6387384">interface</span><span class="op" id="6387393">{</span><span class="op" id="6387394">}</span><span class="op" id="6387395">)</span>&nbsp;<span class="op" id="6387397">*</span><span class="ident" id="6387398"><a href="/database/sql/sql.go.html#6391775">Row</a></span>&nbsp;<span class="op" id="6387402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387405">rows</span><span class="op" id="6387409">,</span>&nbsp;<span class="ident" id="6387411">err</span>&nbsp;<span class="op" id="6387415">:=</span>&nbsp;<span class="ident" id="6387418"><a href="/database/sql/sql.go.html#6387358">s</a></span><span class="op" id="6387419">.</span><span class="ident" id="6387420">Query</span><span class="op" id="6387425">(</span><span class="ident" id="6387426"><a href="/database/sql/sql.go.html#6387376">args</a></span><span class="op" id="6387430">...</span><span class="op" id="6387433">)</span><br>
<span class="lineno">1510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387436">if</span>&nbsp;<span class="ident" id="6387439"><a href="/database/sql/sql.go.html#6387411">err</a></span>&nbsp;<span class="op" id="6387443">!=</span>&nbsp;<span class="ident" id="6387446">nil</span>&nbsp;<span class="op" id="6387450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387454">return</span>&nbsp;<span class="op" id="6387461">&amp;</span><span class="ident" id="6387462"><a href="/database/sql/sql.go.html#6391775">Row</a></span><span class="op" id="6387465">{</span><span class="ident" id="6387466">err</span><span class="op" id="6387469">:</span>&nbsp;<span class="ident" id="6387471"><a href="/database/sql/sql.go.html#6387411">err</a></span><span class="op" id="6387474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387477">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387480">return</span>&nbsp;<span class="op" id="6387487">&amp;</span><span class="ident" id="6387488"><a href="/database/sql/sql.go.html#6391775">Row</a></span><span class="op" id="6387491">{</span><span class="ident" id="6387492">rows</span><span class="op" id="6387496">:</span>&nbsp;<span class="ident" id="6387498"><a href="/database/sql/sql.go.html#6387405">rows</a></span><span class="op" id="6387502">}</span><br>
<span class="lineno"></span><span class="op" id="6387504">}</span><br>
<span class="lineno">1515</span><br>
<span class="lineno"></span><span class="comment" id="6387507">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;statement.</span><br>
<span class="lineno"></span><span class="keyword" id="6387538">func</span>&nbsp;<span class="op" id="6387543">(</span><span class="ident" id="6387544">s</span>&nbsp;<span class="op" id="6387546">*</span><span class="ident" id="6387547"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6387551">)</span>&nbsp;<span class="ident" id="6387553">Close</span><span class="op" id="6387558">(</span><span class="op" id="6387559">)</span>&nbsp;<span class="builtintype" id="6387561">error</span>&nbsp;<span class="op" id="6387567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387570"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387571">.</span><span class="ident" id="6387572">closemu</span><span class="op" id="6387579">.</span><span class="ident" id="6387580">Lock</span><span class="op" id="6387584">(</span><span class="op" id="6387585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387588">defer</span>&nbsp;<span class="ident" id="6387594"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387595">.</span><span class="ident" id="6387596">closemu</span><span class="op" id="6387603">.</span><span class="ident" id="6387604">Unlock</span><span class="op" id="6387610">(</span><span class="op" id="6387611">)</span><br>
<span class="lineno">1520</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387615">if</span>&nbsp;<span class="ident" id="6387618"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387619">.</span><span class="ident" id="6387620">stickyErr</span>&nbsp;<span class="op" id="6387630">!=</span>&nbsp;<span class="ident" id="6387633">nil</span>&nbsp;<span class="op" id="6387637">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387641">return</span>&nbsp;<span class="ident" id="6387648"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387649">.</span><span class="ident" id="6387650">stickyErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387661">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387664"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387665">.</span><span class="ident" id="6387666">mu</span><span class="op" id="6387668">.</span><span class="ident" id="6387669">Lock</span><span class="op" id="6387673">(</span><span class="op" id="6387674">)</span><br>
<span class="lineno">1525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387677">if</span>&nbsp;<span class="ident" id="6387680"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387681">.</span><span class="ident" id="6387682">closed</span>&nbsp;<span class="op" id="6387689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387693"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387694">.</span><span class="ident" id="6387695">mu</span><span class="op" id="6387697">.</span><span class="ident" id="6387698">Unlock</span><span class="op" id="6387704">(</span><span class="op" id="6387705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387709">return</span>&nbsp;<span class="ident" id="6387716">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387724"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387725">.</span><span class="ident" id="6387726">closed</span>&nbsp;<span class="op" id="6387733">=</span>&nbsp;<span class="builtintype" id="6387735">true</span><br>
<span class="lineno">1530</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387742">if</span>&nbsp;<span class="ident" id="6387745"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387746">.</span><span class="ident" id="6387747">tx</span>&nbsp;<span class="op" id="6387750">!=</span>&nbsp;<span class="ident" id="6387753">nil</span>&nbsp;<span class="op" id="6387757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387761"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387762">.</span><span class="ident" id="6387763">txsi</span><span class="op" id="6387767">.</span><span class="ident" id="6387768">Close</span><span class="op" id="6387773">(</span><span class="op" id="6387774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387778"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387779">.</span><span class="ident" id="6387780">mu</span><span class="op" id="6387782">.</span><span class="ident" id="6387783">Unlock</span><span class="op" id="6387789">(</span><span class="op" id="6387790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387794">return</span>&nbsp;<span class="ident" id="6387801">nil</span><br>
<span class="lineno">1535</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387806">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387809"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387810">.</span><span class="ident" id="6387811">mu</span><span class="op" id="6387813">.</span><span class="ident" id="6387814">Unlock</span><span class="op" id="6387820">(</span><span class="op" id="6387821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387825">return</span>&nbsp;<span class="ident" id="6387832"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387833">.</span><span class="ident" id="6387834">db</span><span class="op" id="6387836">.</span><span class="ident" id="6387837">removeDep</span><span class="op" id="6387846">(</span><span class="ident" id="6387847"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387848">,</span>&nbsp;<span class="ident" id="6387850"><a href="/database/sql/sql.go.html#6387544">s</a></span><span class="op" id="6387851">)</span><br>
<span class="lineno"></span><span class="op" id="6387853">}</span><br>
<span class="lineno">1540</span><br>
<span class="lineno"></span><span class="keyword" id="6387856">func</span>&nbsp;<span class="op" id="6387861">(</span><span class="ident" id="6387862">s</span>&nbsp;<span class="op" id="6387864">*</span><span class="ident" id="6387865"><a href="/database/sql/sql.go.html#6381475">Stmt</a></span><span class="op" id="6387869">)</span>&nbsp;<span class="ident" id="6387871">finalClose</span><span class="op" id="6387881">(</span><span class="op" id="6387882">)</span>&nbsp;<span class="builtintype" id="6387884">error</span>&nbsp;<span class="op" id="6387890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387893"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6387894">.</span><span class="ident" id="6387895">mu</span><span class="op" id="6387897">.</span><span class="ident" id="6387898">Lock</span><span class="op" id="6387902">(</span><span class="op" id="6387903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387906">defer</span>&nbsp;<span class="ident" id="6387912"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6387913">.</span><span class="ident" id="6387914">mu</span><span class="op" id="6387916">.</span><span class="ident" id="6387917">Unlock</span><span class="op" id="6387923">(</span><span class="op" id="6387924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387927">if</span>&nbsp;<span class="ident" id="6387930"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6387931">.</span><span class="ident" id="6387932">css</span>&nbsp;<span class="op" id="6387936">!=</span>&nbsp;<span class="ident" id="6387939">nil</span>&nbsp;<span class="op" id="6387943">{</span><br>
<span class="lineno">1545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387947">for</span>&nbsp;<span class="ident" id="6387951">_</span><span class="op" id="6387952">,</span>&nbsp;<span class="ident" id="6387954">v</span>&nbsp;<span class="op" id="6387956">:=</span>&nbsp;<span class="keyword" id="6387959">range</span>&nbsp;<span class="ident" id="6387965"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6387966">.</span><span class="ident" id="6387967">css</span>&nbsp;<span class="op" id="6387971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387976"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6387977">.</span><span class="ident" id="6387978">db</span><span class="op" id="6387980">.</span><span class="ident" id="6387981">noteUnusedDriverStatement</span><span class="op" id="6388006">(</span><span class="ident" id="6388007"><a href="/database/sql/sql.go.html#6387954">v</a></span><span class="op" id="6388008">.</span><span class="ident" id="6388009">dc</span><span class="op" id="6388011">,</span>&nbsp;<span class="ident" id="6388013"><a href="/database/sql/sql.go.html#6387954">v</a></span><span class="op" id="6388014">.</span><span class="ident" id="6388015">si</span><span class="op" id="6388017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388022"><a href="/database/sql/sql.go.html#6387954">v</a></span><span class="op" id="6388023">.</span><span class="ident" id="6388024">dc</span><span class="op" id="6388026">.</span><span class="ident" id="6388027">removeOpenStmt</span><span class="op" id="6388041">(</span><span class="ident" id="6388042"><a href="/database/sql/sql.go.html#6387954">v</a></span><span class="op" id="6388043">.</span><span class="ident" id="6388044">si</span><span class="op" id="6388046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388054"><a href="/database/sql/sql.go.html#6387862">s</a></span><span class="op" id="6388055">.</span><span class="ident" id="6388056">css</span>&nbsp;<span class="op" id="6388060">=</span>&nbsp;<span class="ident" id="6388062">nil</span><br>
<span class="lineno">1550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388067">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388070">return</span>&nbsp;<span class="ident" id="6388077">nil</span><br>
<span class="lineno"></span><span class="op" id="6388081">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388084">//&nbsp;Rows&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;a&nbsp;query.&nbsp;Its&nbsp;cursor&nbsp;starts&nbsp;before&nbsp;the&nbsp;first&nbsp;row</span><br>
<span class="lineno">1555</span><span class="comment" id="6388157">//&nbsp;of&nbsp;the&nbsp;result&nbsp;set.&nbsp;Use&nbsp;Next&nbsp;to&nbsp;advance&nbsp;through&nbsp;the&nbsp;rows:</span><br>
<span class="lineno"></span><span class="comment" id="6388217">//</span><br>
<span class="lineno"></span><span class="comment" id="6388220">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;rows,&nbsp;err&nbsp;:=&nbsp;db.Query(&#34;SELECT&nbsp;...&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="6388263">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="comment" id="6388274">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;defer&nbsp;rows.Close()</span><br>
<span class="lineno">1560</span><span class="comment" id="6388300">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;rows.Next()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="6388325">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;id&nbsp;int</span><br>
<span class="lineno"></span><span class="comment" id="6388347">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="6388374">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Scan(&amp;id,&nbsp;&amp;name)</span><br>
<span class="lineno"></span><span class="comment" id="6388413">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno">1565</span><span class="comment" id="6388428">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="6388437">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;rows.Err()&nbsp;//&nbsp;get&nbsp;any&nbsp;error&nbsp;encountered&nbsp;during&nbsp;iteration</span><br>
<span class="lineno"></span><span class="comment" id="6388507">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span><br>
<span class="lineno"></span><span class="keyword" id="6388518">type</span>&nbsp;<span class="ident" id="6388523">Rows</span>&nbsp;<span class="keyword" id="6388528">struct</span>&nbsp;<span class="op" id="6388535">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388538">dc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388550">*</span><span class="ident" id="6388551"><a href="/database/sql/sql.go.html#6355174">driverConn</a></span>&nbsp;<span class="comment" id="6388562">//&nbsp;owned;&nbsp;must&nbsp;call&nbsp;releaseConn&nbsp;when&nbsp;closed&nbsp;to&nbsp;release</span><br>
<span class="lineno">1570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388618">releaseConn</span>&nbsp;<span class="keyword" id="6388630">func</span><span class="op" id="6388634">(</span><span class="builtintype" id="6388635">error</span><span class="op" id="6388640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388643">rowsi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6388655"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6388661">.</span><span class="ident" id="6388662">Rows</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388669">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6388679">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388685">lastcols</span>&nbsp;&nbsp;<span class="op" id="6388695">[</span><span class="op" id="6388696">]</span><span class="ident" id="6388697"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6388703">.</span><span class="ident" id="6388704">Value</span><br>
<span class="lineno">1575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388711">lasterr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6388721">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6388733">//&nbsp;non-nil&nbsp;only&nbsp;if&nbsp;closed&nbsp;is&nbsp;true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388768">closeStmt</span>&nbsp;<span class="ident" id="6388778"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6388784">.</span><span class="ident" id="6388785">Stmt</span>&nbsp;<span class="comment" id="6388790">//&nbsp;if&nbsp;non-nil,&nbsp;statement&nbsp;to&nbsp;Close&nbsp;on&nbsp;close</span><br>
<span class="lineno"></span><span class="op" id="6388833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6388836">//&nbsp;Next&nbsp;prepares&nbsp;the&nbsp;next&nbsp;result&nbsp;row&nbsp;for&nbsp;reading&nbsp;with&nbsp;the&nbsp;Scan&nbsp;method.&nbsp;&nbsp;It</span><br>
<span class="lineno">1580</span><span class="comment" id="6388911">//&nbsp;returns&nbsp;true&nbsp;on&nbsp;success,&nbsp;or&nbsp;false&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;next&nbsp;result&nbsp;row&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="6388991">//&nbsp;happened&nbsp;while&nbsp;preparing&nbsp;it.&nbsp;&nbsp;Err&nbsp;should&nbsp;be&nbsp;consulted&nbsp;to&nbsp;distinguish&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="6389071">//&nbsp;the&nbsp;two&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="6389089">//</span><br>
<span class="lineno"></span><span class="comment" id="6389092">//&nbsp;Every&nbsp;call&nbsp;to&nbsp;Scan,&nbsp;even&nbsp;the&nbsp;first&nbsp;one,&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Next.</span><br>
<span class="lineno">1585</span><span class="keyword" id="6389171">func</span>&nbsp;<span class="op" id="6389176">(</span><span class="ident" id="6389177">rs</span>&nbsp;<span class="op" id="6389180">*</span><span class="ident" id="6389181"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6389185">)</span>&nbsp;<span class="ident" id="6389187">Next</span><span class="op" id="6389191">(</span><span class="op" id="6389192">)</span>&nbsp;<span class="builtintype" id="6389194">bool</span>&nbsp;<span class="op" id="6389199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389202">if</span>&nbsp;<span class="ident" id="6389205"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389207">.</span><span class="ident" id="6389208">closed</span>&nbsp;<span class="op" id="6389215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389219">return</span>&nbsp;<span class="builtintype" id="6389226">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389236">if</span>&nbsp;<span class="ident" id="6389239"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389241">.</span><span class="ident" id="6389242">lastcols</span>&nbsp;<span class="op" id="6389251">==</span>&nbsp;<span class="ident" id="6389254">nil</span>&nbsp;<span class="op" id="6389258">{</span><br>
<span class="lineno">1590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389262"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389264">.</span><span class="ident" id="6389265">lastcols</span>&nbsp;<span class="op" id="6389274">=</span>&nbsp;<span class="builtinfunc" id="6389276">make</span><span class="op" id="6389280">(</span><span class="op" id="6389281">[</span><span class="op" id="6389282">]</span><span class="ident" id="6389283"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6389289">.</span><span class="ident" id="6389290">Value</span><span class="op" id="6389295">,</span>&nbsp;<span class="builtinfunc" id="6389297">len</span><span class="op" id="6389300">(</span><span class="ident" id="6389301"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389303">.</span><span class="ident" id="6389304">rowsi</span><span class="op" id="6389309">.</span><span class="ident" id="6389310">Columns</span><span class="op" id="6389317">(</span><span class="op" id="6389318">)</span><span class="op" id="6389319">)</span><span class="op" id="6389320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389326"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389328">.</span><span class="ident" id="6389329">lasterr</span>&nbsp;<span class="op" id="6389337">=</span>&nbsp;<span class="ident" id="6389339"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389341">.</span><span class="ident" id="6389342">rowsi</span><span class="op" id="6389347">.</span><span class="ident" id="6389348">Next</span><span class="op" id="6389352">(</span><span class="ident" id="6389353"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389355">.</span><span class="ident" id="6389356">lastcols</span><span class="op" id="6389364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389367">if</span>&nbsp;<span class="ident" id="6389370"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389372">.</span><span class="ident" id="6389373">lasterr</span>&nbsp;<span class="op" id="6389381">!=</span>&nbsp;<span class="ident" id="6389384">nil</span>&nbsp;<span class="op" id="6389388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389392"><a href="/database/sql/sql.go.html#6389177">rs</a></span><span class="op" id="6389394">.</span><span class="ident" id="6389395">Close</span><span class="op" id="6389400">(</span><span class="op" id="6389401">)</span><br>
<span class="lineno">1595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389405">return</span>&nbsp;<span class="builtintype" id="6389412">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389422">return</span>&nbsp;<span class="builtintype" id="6389429">true</span><br>
<span class="lineno"></span><span class="op" id="6389434">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1600</span><span class="comment" id="6389437">//&nbsp;Err&nbsp;returns&nbsp;the&nbsp;error,&nbsp;if&nbsp;any,&nbsp;that&nbsp;was&nbsp;encountered&nbsp;during&nbsp;iteration.</span><br>
<span class="lineno"></span><span class="comment" id="6389510">//&nbsp;Err&nbsp;may&nbsp;be&nbsp;called&nbsp;after&nbsp;an&nbsp;explicit&nbsp;or&nbsp;implicit&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="6389568">func</span>&nbsp;<span class="op" id="6389573">(</span><span class="ident" id="6389574">rs</span>&nbsp;<span class="op" id="6389577">*</span><span class="ident" id="6389578"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6389582">)</span>&nbsp;<span class="ident" id="6389584">Err</span><span class="op" id="6389587">(</span><span class="op" id="6389588">)</span>&nbsp;<span class="builtintype" id="6389590">error</span>&nbsp;<span class="op" id="6389596">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389599">if</span>&nbsp;<span class="ident" id="6389602"><a href="/database/sql/sql.go.html#6389574">rs</a></span><span class="op" id="6389604">.</span><span class="ident" id="6389605">lasterr</span>&nbsp;<span class="op" id="6389613">==</span>&nbsp;<span class="ident" id="6389616"><a href="/database/sql/sql.go.html#6349128">io</a></span><span class="op" id="6389618">.</span><span class="ident" id="6389619">EOF</span>&nbsp;<span class="op" id="6389623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389627">return</span>&nbsp;<span class="ident" id="6389634">nil</span><br>
<span class="lineno">1605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389639">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389642">return</span>&nbsp;<span class="ident" id="6389649"><a href="/database/sql/sql.go.html#6389574">rs</a></span><span class="op" id="6389651">.</span><span class="ident" id="6389652">lasterr</span><br>
<span class="lineno"></span><span class="op" id="6389660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6389663">//&nbsp;Columns&nbsp;returns&nbsp;the&nbsp;column&nbsp;names.</span><br>
<span class="lineno">1610</span><span class="comment" id="6389700">//&nbsp;Columns&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;rows&nbsp;are&nbsp;closed,&nbsp;or&nbsp;if&nbsp;the&nbsp;rows</span><br>
<span class="lineno"></span><span class="comment" id="6389767">//&nbsp;are&nbsp;from&nbsp;QueryRow&nbsp;and&nbsp;there&nbsp;was&nbsp;a&nbsp;deferred&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="6389820">func</span>&nbsp;<span class="op" id="6389825">(</span><span class="ident" id="6389826">rs</span>&nbsp;<span class="op" id="6389829">*</span><span class="ident" id="6389830"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6389834">)</span>&nbsp;<span class="ident" id="6389836">Columns</span><span class="op" id="6389843">(</span><span class="op" id="6389844">)</span>&nbsp;<span class="op" id="6389846">(</span><span class="op" id="6389847">[</span><span class="op" id="6389848">]</span><span class="builtintype" id="6389849">string</span><span class="op" id="6389855">,</span>&nbsp;<span class="builtintype" id="6389857">error</span><span class="op" id="6389862">)</span>&nbsp;<span class="op" id="6389864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389867">if</span>&nbsp;<span class="ident" id="6389870"><a href="/database/sql/sql.go.html#6389826">rs</a></span><span class="op" id="6389872">.</span><span class="ident" id="6389873">closed</span>&nbsp;<span class="op" id="6389880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389884">return</span>&nbsp;<span class="ident" id="6389891">nil</span><span class="op" id="6389894">,</span>&nbsp;<span class="ident" id="6389896"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6389902">.</span><span class="ident" id="6389903">New</span><span class="op" id="6389906">(</span><span class="string" id="6389907">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="6389929">)</span><br>
<span class="lineno">1615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389935">if</span>&nbsp;<span class="ident" id="6389938"><a href="/database/sql/sql.go.html#6389826">rs</a></span><span class="op" id="6389940">.</span><span class="ident" id="6389941">rowsi</span>&nbsp;<span class="op" id="6389947">==</span>&nbsp;<span class="ident" id="6389950">nil</span>&nbsp;<span class="op" id="6389954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389958">return</span>&nbsp;<span class="ident" id="6389965">nil</span><span class="op" id="6389968">,</span>&nbsp;<span class="ident" id="6389970"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6389976">.</span><span class="ident" id="6389977">New</span><span class="op" id="6389980">(</span><span class="string" id="6389981">&#34;sql:&nbsp;no&nbsp;Rows&nbsp;available&#34;</span><span class="op" id="6390005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390011">return</span>&nbsp;<span class="ident" id="6390018"><a href="/database/sql/sql.go.html#6389826">rs</a></span><span class="op" id="6390020">.</span><span class="ident" id="6390021">rowsi</span><span class="op" id="6390026">.</span><span class="ident" id="6390027">Columns</span><span class="op" id="6390034">(</span><span class="op" id="6390035">)</span><span class="op" id="6390036">,</span>&nbsp;<span class="ident" id="6390038">nil</span><br>
<span class="lineno">1620</span><span class="op" id="6390042">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6390045">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;in&nbsp;the&nbsp;current&nbsp;row&nbsp;into&nbsp;the&nbsp;values&nbsp;pointed</span><br>
<span class="lineno"></span><span class="comment" id="6390115">//&nbsp;at&nbsp;by&nbsp;dest.</span><br>
<span class="lineno"></span><span class="comment" id="6390130">//</span><br>
<span class="lineno">1625</span><span class="comment" id="6390133">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*[]byte,&nbsp;Scan&nbsp;saves&nbsp;in&nbsp;that&nbsp;argument&nbsp;a&nbsp;copy</span><br>
<span class="lineno"></span><span class="comment" id="6390204">//&nbsp;of&nbsp;the&nbsp;corresponding&nbsp;data.&nbsp;The&nbsp;copy&nbsp;is&nbsp;owned&nbsp;by&nbsp;the&nbsp;caller&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="6390274">//&nbsp;be&nbsp;modified&nbsp;and&nbsp;held&nbsp;indefinitely.&nbsp;The&nbsp;copy&nbsp;can&nbsp;be&nbsp;avoided&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="6390345">//&nbsp;an&nbsp;argument&nbsp;of&nbsp;type&nbsp;*RawBytes&nbsp;instead;&nbsp;see&nbsp;the&nbsp;documentation&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="6390413">//&nbsp;RawBytes&nbsp;for&nbsp;restrictions&nbsp;on&nbsp;its&nbsp;use.</span><br>
<span class="lineno">1630</span><span class="comment" id="6390454">//</span><br>
<span class="lineno"></span><span class="comment" id="6390457">//&nbsp;If&nbsp;an&nbsp;argument&nbsp;has&nbsp;type&nbsp;*interface{},&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="6390520">//&nbsp;provided&nbsp;by&nbsp;the&nbsp;underlying&nbsp;driver&nbsp;without&nbsp;conversion.&nbsp;If&nbsp;the&nbsp;value</span><br>
<span class="lineno"></span><span class="comment" id="6390590">//&nbsp;is&nbsp;of&nbsp;type&nbsp;[]byte,&nbsp;a&nbsp;copy&nbsp;is&nbsp;made&nbsp;and&nbsp;the&nbsp;caller&nbsp;owns&nbsp;the&nbsp;result.</span><br>
<span class="lineno"></span><span class="keyword" id="6390659">func</span>&nbsp;<span class="op" id="6390664">(</span><span class="ident" id="6390665">rs</span>&nbsp;<span class="op" id="6390668">*</span><span class="ident" id="6390669"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6390673">)</span>&nbsp;<span class="ident" id="6390675">Scan</span><span class="op" id="6390679">(</span><span class="ident" id="6390680">dest</span>&nbsp;<span class="op" id="6390685">...</span><span class="keyword" id="6390688">interface</span><span class="op" id="6390697">{</span><span class="op" id="6390698">}</span><span class="op" id="6390699">)</span>&nbsp;<span class="builtintype" id="6390701">error</span>&nbsp;<span class="op" id="6390707">{</span><br>
<span class="lineno">1635</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390710">if</span>&nbsp;<span class="ident" id="6390713"><a href="/database/sql/sql.go.html#6390665">rs</a></span><span class="op" id="6390715">.</span><span class="ident" id="6390716">closed</span>&nbsp;<span class="op" id="6390723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390727">return</span>&nbsp;<span class="ident" id="6390734"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6390740">.</span><span class="ident" id="6390741">New</span><span class="op" id="6390744">(</span><span class="string" id="6390745">&#34;sql:&nbsp;Rows&nbsp;are&nbsp;closed&#34;</span><span class="op" id="6390767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390770">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390773">if</span>&nbsp;<span class="ident" id="6390776"><a href="/database/sql/sql.go.html#6390665">rs</a></span><span class="op" id="6390778">.</span><span class="ident" id="6390779">lastcols</span>&nbsp;<span class="op" id="6390788">==</span>&nbsp;<span class="ident" id="6390791">nil</span>&nbsp;<span class="op" id="6390795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390799">return</span>&nbsp;<span class="ident" id="6390806"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6390812">.</span><span class="ident" id="6390813">New</span><span class="op" id="6390816">(</span><span class="string" id="6390817">&#34;sql:&nbsp;Scan&nbsp;called&nbsp;without&nbsp;calling&nbsp;Next&#34;</span><span class="op" id="6390856">)</span><br>
<span class="lineno">1640</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6390859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390862">if</span>&nbsp;<span class="builtinfunc" id="6390865">len</span><span class="op" id="6390868">(</span><span class="ident" id="6390869"><a href="/database/sql/sql.go.html#6390680">dest</a></span><span class="op" id="6390873">)</span>&nbsp;<span class="op" id="6390875">!=</span>&nbsp;<span class="builtinfunc" id="6390878">len</span><span class="op" id="6390881">(</span><span class="ident" id="6390882"><a href="/database/sql/sql.go.html#6390665">rs</a></span><span class="op" id="6390884">.</span><span class="ident" id="6390885">lastcols</span><span class="op" id="6390893">)</span>&nbsp;<span class="op" id="6390895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6390899">return</span>&nbsp;<span class="ident" id="6390906"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6390909">.</span><span class="ident" id="6390910">Errorf</span><span class="op" id="6390916">(</span><span class="string" id="6390917">&#34;sql:&nbsp;expected&nbsp;%d&nbsp;destination&nbsp;arguments&nbsp;in&nbsp;Scan,&nbsp;not&nbsp;%d&#34;</span><span class="op" id="6390973">,</span>&nbsp;<span class="builtinfunc" id="6390975">len</span><span class="op" id="6390978">(</span><span class="ident" id="6390979"><a href="/database/sql/sql.go.html#6390665">rs</a></span><span class="op" id="6390981">.</span><span class="ident" id="6390982">lastcols</span><span class="op" id="6390990">)</span><span class="op" id="6390991">,</span>&nbsp;<span class="builtinfunc" id="6390993">len</span><span class="op" id="6390996">(</span><span class="ident" id="6390997"><a href="/database/sql/sql.go.html#6390680">dest</a></span><span class="op" id="6391001">)</span><span class="op" id="6391002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391008">for</span>&nbsp;<span class="ident" id="6391012">i</span><span class="op" id="6391013">,</span>&nbsp;<span class="ident" id="6391015">sv</span>&nbsp;<span class="op" id="6391018">:=</span>&nbsp;<span class="keyword" id="6391021">range</span>&nbsp;<span class="ident" id="6391027"><a href="/database/sql/sql.go.html#6390665">rs</a></span><span class="op" id="6391029">.</span><span class="ident" id="6391030">lastcols</span>&nbsp;<span class="op" id="6391039">{</span><br>
<span class="lineno">1645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391043">err</span>&nbsp;<span class="op" id="6391047">:=</span>&nbsp;<span class="ident" id="6391050"><a href="/database/sql/convert.go.html#6343828">convertAssign</a></span><span class="op" id="6391063">(</span><span class="ident" id="6391064"><a href="/database/sql/sql.go.html#6390680">dest</a></span><span class="op" id="6391068">[</span><span class="ident" id="6391069"><a href="/database/sql/sql.go.html#6391012">i</a></span><span class="op" id="6391070">]</span><span class="op" id="6391071">,</span>&nbsp;<span class="ident" id="6391073"><a href="/database/sql/sql.go.html#6391015">sv</a></span><span class="op" id="6391075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391079">if</span>&nbsp;<span class="ident" id="6391082"><a href="/database/sql/sql.go.html#6391043">err</a></span>&nbsp;<span class="op" id="6391086">!=</span>&nbsp;<span class="ident" id="6391089">nil</span>&nbsp;<span class="op" id="6391093">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391098">return</span>&nbsp;<span class="ident" id="6391105"><a href="/database/sql/sql.go.html#6349121">fmt</a></span><span class="op" id="6391108">.</span><span class="ident" id="6391109">Errorf</span><span class="op" id="6391115">(</span><span class="string" id="6391116">&#34;sql:&nbsp;Scan&nbsp;error&nbsp;on&nbsp;column&nbsp;index&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6391156">,</span>&nbsp;<span class="ident" id="6391158"><a href="/database/sql/sql.go.html#6391012">i</a></span><span class="op" id="6391159">,</span>&nbsp;<span class="ident" id="6391161"><a href="/database/sql/sql.go.html#6391043">err</a></span><span class="op" id="6391164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391171">}</span><br>
<span class="lineno">1650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391174">return</span>&nbsp;<span class="ident" id="6391181">nil</span><br>
<span class="lineno"></span><span class="op" id="6391185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6391188">var</span>&nbsp;<span class="ident" id="6391192">rowsCloseHook</span>&nbsp;<span class="keyword" id="6391206">func</span><span class="op" id="6391210">(</span><span class="op" id="6391211">*</span><span class="ident" id="6391212"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6391216">,</span>&nbsp;<span class="op" id="6391218">*</span><span class="builtintype" id="6391219">error</span><span class="op" id="6391224">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">1655</span><span class="comment" id="6391227">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Rows,&nbsp;preventing&nbsp;further&nbsp;enumeration.&nbsp;If&nbsp;Next&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="6391301">//&nbsp;false,&nbsp;the&nbsp;Rows&nbsp;are&nbsp;closed&nbsp;automatically&nbsp;and&nbsp;it&nbsp;will&nbsp;suffice&nbsp;to&nbsp;check&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6391378">//&nbsp;result&nbsp;of&nbsp;Err.&nbsp;Close&nbsp;is&nbsp;idempotent&nbsp;and&nbsp;does&nbsp;not&nbsp;affect&nbsp;the&nbsp;result&nbsp;of&nbsp;Err.</span><br>
<span class="lineno"></span><span class="keyword" id="6391455">func</span>&nbsp;<span class="op" id="6391460">(</span><span class="ident" id="6391461">rs</span>&nbsp;<span class="op" id="6391464">*</span><span class="ident" id="6391465"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><span class="op" id="6391469">)</span>&nbsp;<span class="ident" id="6391471">Close</span><span class="op" id="6391476">(</span><span class="op" id="6391477">)</span>&nbsp;<span class="builtintype" id="6391479">error</span>&nbsp;<span class="op" id="6391485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391488">if</span>&nbsp;<span class="ident" id="6391491"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391493">.</span><span class="ident" id="6391494">closed</span>&nbsp;<span class="op" id="6391501">{</span><br>
<span class="lineno">1660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391505">return</span>&nbsp;<span class="ident" id="6391512">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391520"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391522">.</span><span class="ident" id="6391523">closed</span>&nbsp;<span class="op" id="6391530">=</span>&nbsp;<span class="builtintype" id="6391532">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391538">err</span>&nbsp;<span class="op" id="6391542">:=</span>&nbsp;<span class="ident" id="6391545"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391547">.</span><span class="ident" id="6391548">rowsi</span><span class="op" id="6391553">.</span><span class="ident" id="6391554">Close</span><span class="op" id="6391559">(</span><span class="op" id="6391560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391563">if</span>&nbsp;<span class="ident" id="6391566">fn</span>&nbsp;<span class="op" id="6391569">:=</span>&nbsp;<span class="ident" id="6391572"><a href="/database/sql/sql.go.html#6391192">rowsCloseHook</a></span><span class="op" id="6391585">;</span>&nbsp;<span class="ident" id="6391587"><a href="/database/sql/sql.go.html#6391566">fn</a></span>&nbsp;<span class="op" id="6391590">!=</span>&nbsp;<span class="ident" id="6391593">nil</span>&nbsp;<span class="op" id="6391597">{</span><br>
<span class="lineno">1665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391601"><a href="/database/sql/sql.go.html#6391566">fn</a></span><span class="op" id="6391603">(</span><span class="ident" id="6391604"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391606">,</span>&nbsp;<span class="op" id="6391608">&amp;</span><span class="ident" id="6391609"><a href="/database/sql/sql.go.html#6391538">err</a></span><span class="op" id="6391612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391618">if</span>&nbsp;<span class="ident" id="6391621"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391623">.</span><span class="ident" id="6391624">closeStmt</span>&nbsp;<span class="op" id="6391634">!=</span>&nbsp;<span class="ident" id="6391637">nil</span>&nbsp;<span class="op" id="6391641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391645"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391647">.</span><span class="ident" id="6391648">closeStmt</span><span class="op" id="6391657">.</span><span class="ident" id="6391658">Close</span><span class="op" id="6391663">(</span><span class="op" id="6391664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6391667">}</span><br>
<span class="lineno">1670</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391670"><a href="/database/sql/sql.go.html#6391461">rs</a></span><span class="op" id="6391672">.</span><span class="ident" id="6391673">releaseConn</span><span class="op" id="6391684">(</span><span class="ident" id="6391685"><a href="/database/sql/sql.go.html#6391538">err</a></span><span class="op" id="6391688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6391691">return</span>&nbsp;<span class="ident" id="6391698"><a href="/database/sql/sql.go.html#6391538">err</a></span><br>
<span class="lineno"></span><span class="op" id="6391702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6391705">//&nbsp;Row&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;calling&nbsp;QueryRow&nbsp;to&nbsp;select&nbsp;a&nbsp;single&nbsp;row.</span><br>
<span class="lineno">1675</span><span class="keyword" id="6391770">type</span>&nbsp;<span class="ident" id="6391775">Row</span>&nbsp;<span class="keyword" id="6391779">struct</span>&nbsp;<span class="op" id="6391786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6391789">//&nbsp;One&nbsp;of&nbsp;these&nbsp;two&nbsp;will&nbsp;be&nbsp;non-nil:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391827">err</span>&nbsp;&nbsp;<span class="builtintype" id="6391832">error</span>&nbsp;<span class="comment" id="6391838">//&nbsp;deferred&nbsp;error&nbsp;for&nbsp;easy&nbsp;chaining</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6391875">rows</span>&nbsp;<span class="op" id="6391880">*</span><span class="ident" id="6391881"><a href="/database/sql/sql.go.html#6388523">Rows</a></span><br>
<span class="lineno"></span><span class="op" id="6391886">}</span><br>
<span class="lineno">1680</span><br>
<span class="lineno"></span><span class="comment" id="6391889">//&nbsp;Scan&nbsp;copies&nbsp;the&nbsp;columns&nbsp;from&nbsp;the&nbsp;matched&nbsp;row&nbsp;into&nbsp;the&nbsp;values</span><br>
<span class="lineno"></span><span class="comment" id="6391953">//&nbsp;pointed&nbsp;at&nbsp;by&nbsp;dest.&nbsp;&nbsp;If&nbsp;more&nbsp;than&nbsp;one&nbsp;row&nbsp;matches&nbsp;the&nbsp;query,</span><br>
<span class="lineno"></span><span class="comment" id="6392017">//&nbsp;Scan&nbsp;uses&nbsp;the&nbsp;first&nbsp;row&nbsp;and&nbsp;discards&nbsp;the&nbsp;rest.&nbsp;&nbsp;If&nbsp;no&nbsp;row&nbsp;matches</span><br>
<span class="lineno"></span><span class="comment" id="6392086">//&nbsp;the&nbsp;query,&nbsp;Scan&nbsp;returns&nbsp;ErrNoRows.</span><br>
<span class="lineno">1685</span><span class="keyword" id="6392124">func</span>&nbsp;<span class="op" id="6392129">(</span><span class="ident" id="6392130">r</span>&nbsp;<span class="op" id="6392132">*</span><span class="ident" id="6392133"><a href="/database/sql/sql.go.html#6391775">Row</a></span><span class="op" id="6392136">)</span>&nbsp;<span class="ident" id="6392138">Scan</span><span class="op" id="6392142">(</span><span class="ident" id="6392143">dest</span>&nbsp;<span class="op" id="6392148">...</span><span class="keyword" id="6392151">interface</span><span class="op" id="6392160">{</span><span class="op" id="6392161">}</span><span class="op" id="6392162">)</span>&nbsp;<span class="builtintype" id="6392164">error</span>&nbsp;<span class="op" id="6392170">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392173">if</span>&nbsp;<span class="ident" id="6392176"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6392177">.</span><span class="ident" id="6392178">err</span>&nbsp;<span class="op" id="6392182">!=</span>&nbsp;<span class="ident" id="6392185">nil</span>&nbsp;<span class="op" id="6392189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392193">return</span>&nbsp;<span class="ident" id="6392200"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6392201">.</span><span class="ident" id="6392202">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6392207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392211">//&nbsp;TODO(bradfitz):&nbsp;for&nbsp;now&nbsp;we&nbsp;need&nbsp;to&nbsp;defensively&nbsp;clone&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392272">//&nbsp;[]byte&nbsp;that&nbsp;the&nbsp;driver&nbsp;returned&nbsp;(not&nbsp;permitting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392324">//&nbsp;*RawBytes&nbsp;in&nbsp;Rows.Scan),&nbsp;since&nbsp;we&#39;re&nbsp;about&nbsp;to&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392380">//&nbsp;the&nbsp;Rows&nbsp;in&nbsp;our&nbsp;defer,&nbsp;when&nbsp;we&nbsp;return&nbsp;from&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392442">//&nbsp;the&nbsp;contract&nbsp;with&nbsp;the&nbsp;driver.Next(...)&nbsp;interface&nbsp;is&nbsp;that&nbsp;it</span><br>
<span class="lineno">1695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392506">//&nbsp;can&nbsp;return&nbsp;slices&nbsp;into&nbsp;read-only&nbsp;temporary&nbsp;memory&nbsp;that&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392567">//&nbsp;only&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;Scan/Close.&nbsp;&nbsp;But&nbsp;the&nbsp;TODO&nbsp;is&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392631">//&nbsp;for&nbsp;a&nbsp;lot&nbsp;of&nbsp;drivers,&nbsp;this&nbsp;copy&nbsp;will&nbsp;be&nbsp;unnecessary.&nbsp;&nbsp;We</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392692">//&nbsp;should&nbsp;provide&nbsp;an&nbsp;optional&nbsp;interface&nbsp;for&nbsp;drivers&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392748">//&nbsp;implement&nbsp;to&nbsp;say,&nbsp;&#34;don&#39;t&nbsp;worry,&nbsp;the&nbsp;[]bytes&nbsp;that&nbsp;I&nbsp;return</span><br>
<span class="lineno">1700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392810">//&nbsp;from&nbsp;Next&nbsp;will&nbsp;not&nbsp;be&nbsp;modified&nbsp;again.&#34;&nbsp;(for&nbsp;instance,&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392871">//&nbsp;they&nbsp;were&nbsp;obtained&nbsp;from&nbsp;the&nbsp;network&nbsp;anyway)&nbsp;But&nbsp;for&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6392934">//&nbsp;don&#39;t&nbsp;care.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392950">defer</span>&nbsp;<span class="ident" id="6392956"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6392957">.</span><span class="ident" id="6392958">rows</span><span class="op" id="6392962">.</span><span class="ident" id="6392963">Close</span><span class="op" id="6392968">(</span><span class="op" id="6392969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6392972">for</span>&nbsp;<span class="ident" id="6392976">_</span><span class="op" id="6392977">,</span>&nbsp;<span class="ident" id="6392979">dp</span>&nbsp;<span class="op" id="6392982">:=</span>&nbsp;<span class="keyword" id="6392985">range</span>&nbsp;<span class="ident" id="6392991"><a href="/database/sql/sql.go.html#6392143">dest</a></span>&nbsp;<span class="op" id="6392996">{</span><br>
<span class="lineno">1705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393000">if</span>&nbsp;<span class="ident" id="6393003">_</span><span class="op" id="6393004">,</span>&nbsp;<span class="ident" id="6393006">ok</span>&nbsp;<span class="op" id="6393009">:=</span>&nbsp;<span class="ident" id="6393012"><a href="/database/sql/sql.go.html#6392979">dp</a></span><span class="op" id="6393014">.</span><span class="op" id="6393015">(</span><span class="op" id="6393016">*</span><span class="ident" id="6393017"><a href="/database/sql/sql.go.html#6350102">RawBytes</a></span><span class="op" id="6393025">)</span><span class="op" id="6393026">;</span>&nbsp;<span class="ident" id="6393028"><a href="/database/sql/sql.go.html#6393006">ok</a></span>&nbsp;<span class="op" id="6393031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393036">return</span>&nbsp;<span class="ident" id="6393043"><a href="/database/sql/sql.go.html#6349111">errors</a></span><span class="op" id="6393049">.</span><span class="ident" id="6393050">New</span><span class="op" id="6393053">(</span><span class="string" id="6393054">&#34;sql:&nbsp;RawBytes&nbsp;isn&#39;t&nbsp;allowed&nbsp;on&nbsp;Row.Scan&#34;</span><span class="op" id="6393095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393102">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393106">if</span>&nbsp;<span class="op" id="6393109">!</span><span class="ident" id="6393110"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6393111">.</span><span class="ident" id="6393112">rows</span><span class="op" id="6393116">.</span><span class="ident" id="6393117">Next</span><span class="op" id="6393121">(</span><span class="op" id="6393122">)</span>&nbsp;<span class="op" id="6393124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393128">if</span>&nbsp;<span class="ident" id="6393131">err</span>&nbsp;<span class="op" id="6393135">:=</span>&nbsp;<span class="ident" id="6393138"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6393139">.</span><span class="ident" id="6393140">rows</span><span class="op" id="6393144">.</span><span class="ident" id="6393145">Err</span><span class="op" id="6393148">(</span><span class="op" id="6393149">)</span><span class="op" id="6393150">;</span>&nbsp;<span class="ident" id="6393152"><a href="/database/sql/sql.go.html#6393131">err</a></span>&nbsp;<span class="op" id="6393156">!=</span>&nbsp;<span class="ident" id="6393159">nil</span>&nbsp;<span class="op" id="6393163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393168">return</span>&nbsp;<span class="ident" id="6393175"><a href="/database/sql/sql.go.html#6393131">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393185">return</span>&nbsp;<span class="ident" id="6393192"><a href="/database/sql/sql.go.html#6353466">ErrNoRows</a></span><br>
<span class="lineno">1715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393206">err</span>&nbsp;<span class="op" id="6393210">:=</span>&nbsp;<span class="ident" id="6393213"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6393214">.</span><span class="ident" id="6393215">rows</span><span class="op" id="6393219">.</span><span class="ident" id="6393220">Scan</span><span class="op" id="6393224">(</span><span class="ident" id="6393225"><a href="/database/sql/sql.go.html#6392143">dest</a></span><span class="op" id="6393229">...</span><span class="op" id="6393232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393235">if</span>&nbsp;<span class="ident" id="6393238"><a href="/database/sql/sql.go.html#6393206">err</a></span>&nbsp;<span class="op" id="6393242">!=</span>&nbsp;<span class="ident" id="6393245">nil</span>&nbsp;<span class="op" id="6393249">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393253">return</span>&nbsp;<span class="ident" id="6393260"><a href="/database/sql/sql.go.html#6393206">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393265">}</span><br>
<span class="lineno">1720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393268">//&nbsp;Make&nbsp;sure&nbsp;the&nbsp;query&nbsp;can&nbsp;be&nbsp;processed&nbsp;to&nbsp;completion&nbsp;with&nbsp;no&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393339">if</span>&nbsp;<span class="ident" id="6393342">err</span>&nbsp;<span class="op" id="6393346">:=</span>&nbsp;<span class="ident" id="6393349"><a href="/database/sql/sql.go.html#6392130">r</a></span><span class="op" id="6393350">.</span><span class="ident" id="6393351">rows</span><span class="op" id="6393355">.</span><span class="ident" id="6393356">Close</span><span class="op" id="6393361">(</span><span class="op" id="6393362">)</span><span class="op" id="6393363">;</span>&nbsp;<span class="ident" id="6393365"><a href="/database/sql/sql.go.html#6393342">err</a></span>&nbsp;<span class="op" id="6393369">!=</span>&nbsp;<span class="ident" id="6393372">nil</span>&nbsp;<span class="op" id="6393376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393380">return</span>&nbsp;<span class="ident" id="6393387"><a href="/database/sql/sql.go.html#6393342">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6393392">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1725</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6393396">return</span>&nbsp;<span class="ident" id="6393403">nil</span><br>
<span class="lineno"></span><span class="op" id="6393407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6393410">//&nbsp;A&nbsp;Result&nbsp;summarizes&nbsp;an&nbsp;executed&nbsp;SQL&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="6393458">type</span>&nbsp;<span class="ident" id="6393463">Result</span>&nbsp;<span class="keyword" id="6393470">interface</span>&nbsp;<span class="op" id="6393480">{</span><br>
<span class="lineno">1730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393483">//&nbsp;LastInsertId&nbsp;returns&nbsp;the&nbsp;integer&nbsp;generated&nbsp;by&nbsp;the&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393546">//&nbsp;in&nbsp;response&nbsp;to&nbsp;a&nbsp;command.&nbsp;Typically&nbsp;this&nbsp;will&nbsp;be&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393607">//&nbsp;&#34;auto&nbsp;increment&#34;&nbsp;column&nbsp;when&nbsp;inserting&nbsp;a&nbsp;new&nbsp;row.&nbsp;Not&nbsp;all</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393669">//&nbsp;databases&nbsp;support&nbsp;this&nbsp;feature,&nbsp;and&nbsp;the&nbsp;syntax&nbsp;of&nbsp;such</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393728">//&nbsp;statements&nbsp;varies.</span><br>
<span class="lineno">1735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393751">LastInsertId</span><span class="op" id="6393763">(</span><span class="op" id="6393764">)</span>&nbsp;<span class="op" id="6393766">(</span><span class="ident" id="6393767">int64</span><span class="op" id="6393772">,</span>&nbsp;<span class="builtintype" id="6393774">error</span><span class="op" id="6393779">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393783">//&nbsp;RowsAffected&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;rows&nbsp;affected&nbsp;by&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393842">//&nbsp;update,&nbsp;insert,&nbsp;or&nbsp;delete.&nbsp;Not&nbsp;every&nbsp;database&nbsp;or&nbsp;database</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6393904">//&nbsp;driver&nbsp;may&nbsp;support&nbsp;this.</span><br>
<span class="lineno">1740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393933">RowsAffected</span><span class="op" id="6393945">(</span><span class="op" id="6393946">)</span>&nbsp;<span class="op" id="6393948">(</span><span class="ident" id="6393949">int64</span><span class="op" id="6393954">,</span>&nbsp;<span class="builtintype" id="6393956">error</span><span class="op" id="6393961">)</span><br>
<span class="lineno"></span><span class="op" id="6393963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6393966">type</span>&nbsp;<span class="ident" id="6393971">driverResult</span>&nbsp;<span class="keyword" id="6393984">struct</span>&nbsp;<span class="op" id="6393991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6393994"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6393998">.</span><span class="ident" id="6393999">Locker</span>&nbsp;<span class="comment" id="6394006">//&nbsp;the&nbsp;*driverConn</span><br>
<span class="lineno">1745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394026">resi</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6394038"><a href="/database/sql/sql.go.html#6349088">driver</a></span><span class="op" id="6394044">.</span><span class="ident" id="6394045">Result</span><br>
<span class="lineno"></span><span class="op" id="6394052">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6394055">func</span>&nbsp;<span class="op" id="6394060">(</span><span class="ident" id="6394061">dr</span>&nbsp;<span class="ident" id="6394064"><a href="/database/sql/sql.go.html#6393971">driverResult</a></span><span class="op" id="6394076">)</span>&nbsp;<span class="ident" id="6394078">LastInsertId</span><span class="op" id="6394090">(</span><span class="op" id="6394091">)</span>&nbsp;<span class="op" id="6394093">(</span><span class="ident" id="6394094">int64</span><span class="op" id="6394099">,</span>&nbsp;<span class="builtintype" id="6394101">error</span><span class="op" id="6394106">)</span>&nbsp;<span class="op" id="6394108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394111"><a href="/database/sql/sql.go.html#6394061">dr</a></span><span class="op" id="6394113">.</span><span class="ident" id="6394114">Lock</span><span class="op" id="6394118">(</span><span class="op" id="6394119">)</span><br>
<span class="lineno">1750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394122">defer</span>&nbsp;<span class="ident" id="6394128"><a href="/database/sql/sql.go.html#6394061">dr</a></span><span class="op" id="6394130">.</span><span class="ident" id="6394131">Unlock</span><span class="op" id="6394137">(</span><span class="op" id="6394138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394141">return</span>&nbsp;<span class="ident" id="6394148"><a href="/database/sql/sql.go.html#6394061">dr</a></span><span class="op" id="6394150">.</span><span class="ident" id="6394151">resi</span><span class="op" id="6394155">.</span><span class="ident" id="6394156">LastInsertId</span><span class="op" id="6394168">(</span><span class="op" id="6394169">)</span><br>
<span class="lineno"></span><span class="op" id="6394171">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6394174">func</span>&nbsp;<span class="op" id="6394179">(</span><span class="ident" id="6394180">dr</span>&nbsp;<span class="ident" id="6394183"><a href="/database/sql/sql.go.html#6393971">driverResult</a></span><span class="op" id="6394195">)</span>&nbsp;<span class="ident" id="6394197">RowsAffected</span><span class="op" id="6394209">(</span><span class="op" id="6394210">)</span>&nbsp;<span class="op" id="6394212">(</span><span class="ident" id="6394213">int64</span><span class="op" id="6394218">,</span>&nbsp;<span class="builtintype" id="6394220">error</span><span class="op" id="6394225">)</span>&nbsp;<span class="op" id="6394227">{</span><br>
<span class="lineno">1755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394230"><a href="/database/sql/sql.go.html#6394180">dr</a></span><span class="op" id="6394232">.</span><span class="ident" id="6394233">Lock</span><span class="op" id="6394237">(</span><span class="op" id="6394238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394241">defer</span>&nbsp;<span class="ident" id="6394247"><a href="/database/sql/sql.go.html#6394180">dr</a></span><span class="op" id="6394249">.</span><span class="ident" id="6394250">Unlock</span><span class="op" id="6394256">(</span><span class="op" id="6394257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394260">return</span>&nbsp;<span class="ident" id="6394267"><a href="/database/sql/sql.go.html#6394180">dr</a></span><span class="op" id="6394269">.</span><span class="ident" id="6394270">resi</span><span class="op" id="6394274">.</span><span class="ident" id="6394275">RowsAffected</span><span class="op" id="6394287">(</span><span class="op" id="6394288">)</span><br>
<span class="lineno"></span><span class="op" id="6394290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1760</span><span class="keyword" id="6394293">func</span>&nbsp;<span class="ident" id="6394298">stack</span><span class="op" id="6394303">(</span><span class="op" id="6394304">)</span>&nbsp;<span class="builtintype" id="6394306">string</span>&nbsp;<span class="op" id="6394313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394316">var</span>&nbsp;<span class="ident" id="6394320">buf</span>&nbsp;<span class="op" id="6394324">[</span><span class="num" id="6394325">2</span>&nbsp;<span class="op" id="6394327">&lt;&lt;</span>&nbsp;<span class="num" id="6394330">10</span><span class="op" id="6394332">]</span><span class="builtintype" id="6394333">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6394339">return</span>&nbsp;<span class="builtintype" id="6394346">string</span><span class="op" id="6394352">(</span><span class="ident" id="6394353"><a href="/database/sql/sql.go.html#6394320">buf</a></span><span class="op" id="6394356">[</span><span class="op" id="6394357">:</span><span class="ident" id="6394358"><a href="/database/sql/sql.go.html#6349134">runtime</a></span><span class="op" id="6394365">.</span><span class="ident" id="6394366">Stack</span><span class="op" id="6394371">(</span><span class="ident" id="6394372"><a href="/database/sql/sql.go.html#6394320">buf</a></span><span class="op" id="6394375">[</span><span class="op" id="6394376">:</span><span class="op" id="6394377">]</span><span class="op" id="6394378">,</span>&nbsp;<span class="builtintype" id="6394380">false</span><span class="op" id="6394385">)</span><span class="op" id="6394386">]</span><span class="op" id="6394387">)</span><br>
<span class="lineno"></span><span class="op" id="6394389">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1765</span><span class="comment" id="6394392">//&nbsp;withLock&nbsp;runs&nbsp;while&nbsp;holding&nbsp;lk.</span><br>
<span class="lineno"></span><span class="keyword" id="6394427">func</span>&nbsp;<span class="ident" id="6394432">withLock</span><span class="op" id="6394440">(</span><span class="ident" id="6394441">lk</span>&nbsp;<span class="ident" id="6394444"><a href="/database/sql/sql.go.html#6349153">sync</a></span><span class="op" id="6394448">.</span><span class="ident" id="6394449">Locker</span><span class="op" id="6394455">,</span>&nbsp;<span class="ident" id="6394457">fn</span>&nbsp;<span class="keyword" id="6394460">func</span><span class="op" id="6394464">(</span><span class="op" id="6394465">)</span><span class="op" id="6394466">)</span>&nbsp;<span class="op" id="6394468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394471"><a href="/database/sql/sql.go.html#6394441">lk</a></span><span class="op" id="6394473">.</span><span class="ident" id="6394474">Lock</span><span class="op" id="6394478">(</span><span class="op" id="6394479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394482"><a href="/database/sql/sql.go.html#6394457">fn</a></span><span class="op" id="6394484">(</span><span class="op" id="6394485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6394488"><a href="/database/sql/sql.go.html#6394441">lk</a></span><span class="op" id="6394490">.</span><span class="ident" id="6394491">Unlock</span><span class="op" id="6394497">(</span><span class="op" id="6394498">)</span><br>
<span class="lineno">1770</span><span class="op" id="6394500">}</span>
</div>
</body>
</html>
