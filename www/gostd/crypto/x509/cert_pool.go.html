<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/x509</h2>
<ul>
<li><a href="/gostd/crypto/x509/cert_pool.go.html">cert_pool.go</a></li>
<li><a href="/gostd/crypto/x509/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt.go.html">pem_decrypt.go</a></li>
<li><a href="/gostd/crypto/x509/pem_decrypt_test.go.html">pem_decrypt_test.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs1.go.html">pkcs1.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8.go.html">pkcs8.go</a></li>
<li><a href="/gostd/crypto/x509/pkcs8_test.go.html">pkcs8_test.go</a></li>
<li><a href="/gostd/crypto/x509/root.go.html">root.go</a></li>
<li><a href="/gostd/crypto/x509/root_unix.go.html">root_unix.go</a></li>
<li><a href="/gostd/crypto/x509/sec1.go.html">sec1.go</a></li>
<li><a href="/gostd/crypto/x509/sec1_test.go.html">sec1_test.go</a></li>
<li><a href="/gostd/crypto/x509/verify.go.html">verify.go</a></li>
<li><a href="/gostd/crypto/x509/verify_test.go.html">verify_test.go</a></li>
<li><a href="/gostd/crypto/x509/x509.go.html">x509.go</a></li>
<li><a href="/gostd/crypto/x509/x509_test.go.html">x509_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4301240">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4301295">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4301349">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4301400">package</span>&nbsp;<span class="ident" id="4301408">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4301414">import</span>&nbsp;<span class="op" id="4301421">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4301424">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span><span class="op" id="4301439">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4301442">//&nbsp;CertPool&nbsp;is&nbsp;a&nbsp;set&nbsp;of&nbsp;certificates.</span><br>
<span class="lineno"></span><span class="keyword" id="4301480">type</span>&nbsp;<span class="ident" id="4301485">CertPool</span>&nbsp;<span class="keyword" id="4301494">struct</span>&nbsp;<span class="op" id="4301501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301504">bySubjectKeyId</span>&nbsp;<span class="keyword" id="4301519">map</span><span class="op" id="4301522">[</span><span class="builtintype" id="4301523">string</span><span class="op" id="4301529">]</span><span class="op" id="4301530">[</span><span class="op" id="4301531">]</span><span class="builtintype" id="4301532">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301537">byName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4301552">map</span><span class="op" id="4301555">[</span><span class="builtintype" id="4301556">string</span><span class="op" id="4301562">]</span><span class="op" id="4301563">[</span><span class="op" id="4301564">]</span><span class="builtintype" id="4301565">int</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301570">certs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4301585">[</span><span class="op" id="4301586">]</span><span class="op" id="4301587">*</span><span class="ident" id="4301588">Certificate</span><br>
<span class="lineno"></span><span class="op" id="4301600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301603">//&nbsp;NewCertPool&nbsp;returns&nbsp;a&nbsp;new,&nbsp;empty&nbsp;CertPool.</span><br>
<span class="lineno"></span><span class="keyword" id="4301649">func</span>&nbsp;<span class="ident" id="4301654">NewCertPool</span><span class="op" id="4301665">(</span><span class="op" id="4301666">)</span>&nbsp;<span class="op" id="4301668">*</span><span class="ident" id="4301669">CertPool</span>&nbsp;<span class="op" id="4301678">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4301681">return</span>&nbsp;<span class="op" id="4301688">&amp;</span><span class="ident" id="4301689">CertPool</span><span class="op" id="4301697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4301701">make</span><span class="op" id="4301705">(</span><span class="keyword" id="4301706">map</span><span class="op" id="4301709">[</span><span class="builtintype" id="4301710">string</span><span class="op" id="4301716">]</span><span class="op" id="4301717">[</span><span class="op" id="4301718">]</span><span class="builtintype" id="4301719">int</span><span class="op" id="4301722">)</span><span class="op" id="4301723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4301727">make</span><span class="op" id="4301731">(</span><span class="keyword" id="4301732">map</span><span class="op" id="4301735">[</span><span class="builtintype" id="4301736">string</span><span class="op" id="4301742">]</span><span class="op" id="4301743">[</span><span class="op" id="4301744">]</span><span class="builtintype" id="4301745">int</span><span class="op" id="4301748">)</span><span class="op" id="4301749">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4301753">nil</span><span class="op" id="4301756">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4301759">}</span><br>
<span class="lineno">25</span><span class="op" id="4301761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4301764">//&nbsp;findVerifiedParents&nbsp;attempts&nbsp;to&nbsp;find&nbsp;certificates&nbsp;in&nbsp;s&nbsp;which&nbsp;have&nbsp;signed&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4301844">//&nbsp;given&nbsp;certificate.&nbsp;If&nbsp;any&nbsp;candidates&nbsp;were&nbsp;rejected&nbsp;then&nbsp;errCert&nbsp;will&nbsp;be&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4301923">//&nbsp;to&nbsp;one&nbsp;of&nbsp;them,&nbsp;arbitrarily,&nbsp;and&nbsp;err&nbsp;will&nbsp;contain&nbsp;the&nbsp;reason&nbsp;that&nbsp;it&nbsp;was</span><br>
<span class="lineno">30</span><span class="comment" id="4301999">//&nbsp;rejected.</span><br>
<span class="lineno"></span><span class="keyword" id="4302012">func</span>&nbsp;<span class="op" id="4302017">(</span><span class="ident" id="4302018">s</span>&nbsp;<span class="op" id="4302020">*</span><span class="ident" id="4302021">CertPool</span><span class="op" id="4302029">)</span>&nbsp;<span class="ident" id="4302031">findVerifiedParents</span><span class="op" id="4302050">(</span><span class="ident" id="4302051">cert</span>&nbsp;<span class="op" id="4302056">*</span><span class="ident" id="4302057">Certificate</span><span class="op" id="4302068">)</span>&nbsp;<span class="op" id="4302070">(</span><span class="ident" id="4302071">parents</span>&nbsp;<span class="op" id="4302079">[</span><span class="op" id="4302080">]</span><span class="builtintype" id="4302081">int</span><span class="op" id="4302084">,</span>&nbsp;<span class="ident" id="4302086">errCert</span>&nbsp;<span class="op" id="4302094">*</span><span class="ident" id="4302095">Certificate</span><span class="op" id="4302106">,</span>&nbsp;<span class="ident" id="4302108">err</span>&nbsp;<span class="builtintype" id="4302112">error</span><span class="op" id="4302117">)</span>&nbsp;<span class="op" id="4302119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302122">if</span>&nbsp;<span class="ident" id="4302125">s</span>&nbsp;<span class="op" id="4302127">==</span>&nbsp;<span class="ident" id="4302130">nil</span>&nbsp;<span class="op" id="4302134">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302146">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302149">var</span>&nbsp;<span class="ident" id="4302153">candidates</span>&nbsp;<span class="op" id="4302164">[</span><span class="op" id="4302165">]</span><span class="builtintype" id="4302166">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302172">if</span>&nbsp;<span class="builtinfunc" id="4302175">len</span><span class="op" id="4302178">(</span><span class="ident" id="4302179">cert</span><span class="op" id="4302183">.</span><span class="ident" id="4302184">AuthorityKeyId</span><span class="op" id="4302198">)</span>&nbsp;<span class="op" id="4302200">&gt;</span>&nbsp;<span class="num" id="4302202">0</span>&nbsp;<span class="op" id="4302204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302208">candidates</span>&nbsp;<span class="op" id="4302219">=</span>&nbsp;<span class="ident" id="4302221">s</span><span class="op" id="4302222">.</span><span class="ident" id="4302223">bySubjectKeyId</span><span class="op" id="4302237">[</span><span class="builtintype" id="4302238">string</span><span class="op" id="4302244">(</span><span class="ident" id="4302245">cert</span><span class="op" id="4302249">.</span><span class="ident" id="4302250">AuthorityKeyId</span><span class="op" id="4302264">)</span><span class="op" id="4302265">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302268">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302271">if</span>&nbsp;<span class="builtinfunc" id="4302274">len</span><span class="op" id="4302277">(</span><span class="ident" id="4302278">candidates</span><span class="op" id="4302288">)</span>&nbsp;<span class="op" id="4302290">==</span>&nbsp;<span class="num" id="4302293">0</span>&nbsp;<span class="op" id="4302295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302299">candidates</span>&nbsp;<span class="op" id="4302310">=</span>&nbsp;<span class="ident" id="4302312">s</span><span class="op" id="4302313">.</span><span class="ident" id="4302314">byName</span><span class="op" id="4302320">[</span><span class="builtintype" id="4302321">string</span><span class="op" id="4302327">(</span><span class="ident" id="4302328">cert</span><span class="op" id="4302332">.</span><span class="ident" id="4302333">RawIssuer</span><span class="op" id="4302342">)</span><span class="op" id="4302343">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302350">for</span>&nbsp;<span class="ident" id="4302354">_</span><span class="op" id="4302355">,</span>&nbsp;<span class="ident" id="4302357">c</span>&nbsp;<span class="op" id="4302359">:=</span>&nbsp;<span class="keyword" id="4302362">range</span>&nbsp;<span class="ident" id="4302368">candidates</span>&nbsp;<span class="op" id="4302379">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302383">if</span>&nbsp;<span class="ident" id="4302386">err</span>&nbsp;<span class="op" id="4302390">=</span>&nbsp;<span class="ident" id="4302392">cert</span><span class="op" id="4302396">.</span><span class="ident" id="4302397">CheckSignatureFrom</span><span class="op" id="4302415">(</span><span class="ident" id="4302416">s</span><span class="op" id="4302417">.</span><span class="ident" id="4302418">certs</span><span class="op" id="4302423">[</span><span class="ident" id="4302424">c</span><span class="op" id="4302425">]</span><span class="op" id="4302426">)</span><span class="op" id="4302427">;</span>&nbsp;<span class="ident" id="4302429">err</span>&nbsp;<span class="op" id="4302433">==</span>&nbsp;<span class="ident" id="4302436">nil</span>&nbsp;<span class="op" id="4302440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302445">parents</span>&nbsp;<span class="op" id="4302453">=</span>&nbsp;<span class="builtinfunc" id="4302455">append</span><span class="op" id="4302461">(</span><span class="ident" id="4302462">parents</span><span class="op" id="4302469">,</span>&nbsp;<span class="ident" id="4302471">c</span><span class="op" id="4302472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302476">}</span>&nbsp;<span class="keyword" id="4302478">else</span>&nbsp;<span class="op" id="4302483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302488">errCert</span>&nbsp;<span class="op" id="4302496">=</span>&nbsp;<span class="ident" id="4302498">s</span><span class="op" id="4302499">.</span><span class="ident" id="4302500">certs</span><span class="op" id="4302505">[</span><span class="ident" id="4302506">c</span><span class="op" id="4302507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302511">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302514">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302518">return</span><br>
<span class="lineno"></span><span class="op" id="4302525">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="4302528">//&nbsp;AddCert&nbsp;adds&nbsp;a&nbsp;certificate&nbsp;to&nbsp;a&nbsp;pool.</span><br>
<span class="lineno"></span><span class="keyword" id="4302569">func</span>&nbsp;<span class="op" id="4302574">(</span><span class="ident" id="4302575">s</span>&nbsp;<span class="op" id="4302577">*</span><span class="ident" id="4302578">CertPool</span><span class="op" id="4302586">)</span>&nbsp;<span class="ident" id="4302588">AddCert</span><span class="op" id="4302595">(</span><span class="ident" id="4302596">cert</span>&nbsp;<span class="op" id="4302601">*</span><span class="ident" id="4302602">Certificate</span><span class="op" id="4302613">)</span>&nbsp;<span class="op" id="4302615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302618">if</span>&nbsp;<span class="ident" id="4302621">cert</span>&nbsp;<span class="op" id="4302626">==</span>&nbsp;<span class="ident" id="4302629">nil</span>&nbsp;<span class="op" id="4302633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4302637">panic</span><span class="op" id="4302642">(</span><span class="string" id="4302643">&#34;adding&nbsp;nil&nbsp;Certificate&nbsp;to&nbsp;CertPool&#34;</span><span class="op" id="4302679">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302682">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4302686">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;certificate&nbsp;isn&#39;t&nbsp;being&nbsp;added&nbsp;twice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302742">for</span>&nbsp;<span class="ident" id="4302746">_</span><span class="op" id="4302747">,</span>&nbsp;<span class="ident" id="4302749">c</span>&nbsp;<span class="op" id="4302751">:=</span>&nbsp;<span class="keyword" id="4302754">range</span>&nbsp;<span class="ident" id="4302760">s</span><span class="op" id="4302761">.</span><span class="ident" id="4302762">certs</span>&nbsp;<span class="op" id="4302768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302772">if</span>&nbsp;<span class="ident" id="4302775">c</span><span class="op" id="4302776">.</span><span class="ident" id="4302777">Equal</span><span class="op" id="4302782">(</span><span class="ident" id="4302783">cert</span><span class="op" id="4302787">)</span>&nbsp;<span class="op" id="4302789">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302794">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302806">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302810">n</span>&nbsp;<span class="op" id="4302812">:=</span>&nbsp;<span class="builtinfunc" id="4302815">len</span><span class="op" id="4302818">(</span><span class="ident" id="4302819">s</span><span class="op" id="4302820">.</span><span class="ident" id="4302821">certs</span><span class="op" id="4302826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302829">s</span><span class="op" id="4302830">.</span><span class="ident" id="4302831">certs</span>&nbsp;<span class="op" id="4302837">=</span>&nbsp;<span class="builtinfunc" id="4302839">append</span><span class="op" id="4302845">(</span><span class="ident" id="4302846">s</span><span class="op" id="4302847">.</span><span class="ident" id="4302848">certs</span><span class="op" id="4302853">,</span>&nbsp;<span class="ident" id="4302855">cert</span><span class="op" id="4302859">)</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4302863">if</span>&nbsp;<span class="builtinfunc" id="4302866">len</span><span class="op" id="4302869">(</span><span class="ident" id="4302870">cert</span><span class="op" id="4302874">.</span><span class="ident" id="4302875">SubjectKeyId</span><span class="op" id="4302887">)</span>&nbsp;<span class="op" id="4302889">&gt;</span>&nbsp;<span class="num" id="4302891">0</span>&nbsp;<span class="op" id="4302893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302897">keyId</span>&nbsp;<span class="op" id="4302903">:=</span>&nbsp;<span class="builtintype" id="4302906">string</span><span class="op" id="4302912">(</span><span class="ident" id="4302913">cert</span><span class="op" id="4302917">.</span><span class="ident" id="4302918">SubjectKeyId</span><span class="op" id="4302930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302934">s</span><span class="op" id="4302935">.</span><span class="ident" id="4302936">bySubjectKeyId</span><span class="op" id="4302950">[</span><span class="ident" id="4302951">keyId</span><span class="op" id="4302956">]</span>&nbsp;<span class="op" id="4302958">=</span>&nbsp;<span class="builtinfunc" id="4302960">append</span><span class="op" id="4302966">(</span><span class="ident" id="4302967">s</span><span class="op" id="4302968">.</span><span class="ident" id="4302969">bySubjectKeyId</span><span class="op" id="4302983">[</span><span class="ident" id="4302984">keyId</span><span class="op" id="4302989">]</span><span class="op" id="4302990">,</span>&nbsp;<span class="ident" id="4302992">n</span><span class="op" id="4302993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4302996">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4302999">name</span>&nbsp;<span class="op" id="4303004">:=</span>&nbsp;<span class="builtintype" id="4303007">string</span><span class="op" id="4303013">(</span><span class="ident" id="4303014">cert</span><span class="op" id="4303018">.</span><span class="ident" id="4303019">RawSubject</span><span class="op" id="4303029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303032">s</span><span class="op" id="4303033">.</span><span class="ident" id="4303034">byName</span><span class="op" id="4303040">[</span><span class="ident" id="4303041">name</span><span class="op" id="4303045">]</span>&nbsp;<span class="op" id="4303047">=</span>&nbsp;<span class="builtinfunc" id="4303049">append</span><span class="op" id="4303055">(</span><span class="ident" id="4303056">s</span><span class="op" id="4303057">.</span><span class="ident" id="4303058">byName</span><span class="op" id="4303064">[</span><span class="ident" id="4303065">name</span><span class="op" id="4303069">]</span><span class="op" id="4303070">,</span>&nbsp;<span class="ident" id="4303072">n</span><span class="op" id="4303073">)</span><br>
<span class="lineno"></span><span class="op" id="4303075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4303078">//&nbsp;AppendCertsFromPEM&nbsp;attempts&nbsp;to&nbsp;parse&nbsp;a&nbsp;series&nbsp;of&nbsp;PEM&nbsp;encoded&nbsp;certificates.</span><br>
<span class="lineno">80</span><span class="comment" id="4303156">//&nbsp;It&nbsp;appends&nbsp;any&nbsp;certificates&nbsp;found&nbsp;to&nbsp;s&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;any&nbsp;certificates</span><br>
<span class="lineno"></span><span class="comment" id="4303235">//&nbsp;were&nbsp;successfully&nbsp;parsed.</span><br>
<span class="lineno"></span><span class="comment" id="4303264">//</span><br>
<span class="lineno"></span><span class="comment" id="4303267">//&nbsp;On&nbsp;many&nbsp;Linux&nbsp;systems,&nbsp;/etc/ssl/cert.pem&nbsp;will&nbsp;contain&nbsp;the&nbsp;system&nbsp;wide&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4303344">//&nbsp;of&nbsp;root&nbsp;CAs&nbsp;in&nbsp;a&nbsp;format&nbsp;suitable&nbsp;for&nbsp;this&nbsp;function.</span><br>
<span class="lineno">85</span><span class="keyword" id="4303399">func</span>&nbsp;<span class="op" id="4303404">(</span><span class="ident" id="4303405">s</span>&nbsp;<span class="op" id="4303407">*</span><span class="ident" id="4303408">CertPool</span><span class="op" id="4303416">)</span>&nbsp;<span class="ident" id="4303418">AppendCertsFromPEM</span><span class="op" id="4303436">(</span><span class="ident" id="4303437">pemCerts</span>&nbsp;<span class="op" id="4303446">[</span><span class="op" id="4303447">]</span><span class="builtintype" id="4303448">byte</span><span class="op" id="4303452">)</span>&nbsp;<span class="op" id="4303454">(</span><span class="ident" id="4303455">ok</span>&nbsp;<span class="builtintype" id="4303458">bool</span><span class="op" id="4303462">)</span>&nbsp;<span class="op" id="4303464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303467">for</span>&nbsp;<span class="builtinfunc" id="4303471">len</span><span class="op" id="4303474">(</span><span class="ident" id="4303475">pemCerts</span><span class="op" id="4303483">)</span>&nbsp;<span class="op" id="4303485">&gt;</span>&nbsp;<span class="num" id="4303487">0</span>&nbsp;<span class="op" id="4303489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303493">var</span>&nbsp;<span class="ident" id="4303497">block</span>&nbsp;<span class="op" id="4303503">*</span><span class="ident" id="4303504">pem</span><span class="op" id="4303507">.</span><span class="ident" id="4303508">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303516">block</span><span class="op" id="4303521">,</span>&nbsp;<span class="ident" id="4303523">pemCerts</span>&nbsp;<span class="op" id="4303532">=</span>&nbsp;<span class="ident" id="4303534">pem</span><span class="op" id="4303537">.</span><span class="ident" id="4303538">Decode</span><span class="op" id="4303544">(</span><span class="ident" id="4303545">pemCerts</span><span class="op" id="4303553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303557">if</span>&nbsp;<span class="ident" id="4303560">block</span>&nbsp;<span class="op" id="4303566">==</span>&nbsp;<span class="ident" id="4303569">nil</span>&nbsp;<span class="op" id="4303573">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303578">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303590">if</span>&nbsp;<span class="ident" id="4303593">block</span><span class="op" id="4303598">.</span><span class="ident" id="4303599">Type</span>&nbsp;<span class="op" id="4303604">!=</span>&nbsp;<span class="string" id="4303607">&#34;CERTIFICATE&#34;</span>&nbsp;<span class="op" id="4303621">||</span>&nbsp;<span class="builtinfunc" id="4303624">len</span><span class="op" id="4303627">(</span><span class="ident" id="4303628">block</span><span class="op" id="4303633">.</span><span class="ident" id="4303634">Headers</span><span class="op" id="4303641">)</span>&nbsp;<span class="op" id="4303643">!=</span>&nbsp;<span class="num" id="4303646">0</span>&nbsp;<span class="op" id="4303648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303653">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303664">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303669">cert</span><span class="op" id="4303673">,</span>&nbsp;<span class="ident" id="4303675">err</span>&nbsp;<span class="op" id="4303679">:=</span>&nbsp;<span class="ident" id="4303682">ParseCertificate</span><span class="op" id="4303698">(</span><span class="ident" id="4303699">block</span><span class="op" id="4303704">.</span><span class="ident" id="4303705">Bytes</span><span class="op" id="4303710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303714">if</span>&nbsp;<span class="ident" id="4303717">err</span>&nbsp;<span class="op" id="4303721">!=</span>&nbsp;<span class="ident" id="4303724">nil</span>&nbsp;<span class="op" id="4303728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303733">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303744">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303749">s</span><span class="op" id="4303750">.</span><span class="ident" id="4303751">AddCert</span><span class="op" id="4303758">(</span><span class="ident" id="4303759">cert</span><span class="op" id="4303763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303767">ok</span>&nbsp;<span class="op" id="4303770">=</span>&nbsp;<span class="builtintype" id="4303772">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4303778">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303782">return</span><br>
<span class="lineno"></span><span class="op" id="4303789">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4303792">//&nbsp;Subjects&nbsp;returns&nbsp;a&nbsp;list&nbsp;of&nbsp;the&nbsp;DER-encoded&nbsp;subjects&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4303850">//&nbsp;all&nbsp;of&nbsp;the&nbsp;certificates&nbsp;in&nbsp;the&nbsp;pool.</span><br>
<span class="lineno">110</span><span class="keyword" id="4303890">func</span>&nbsp;<span class="op" id="4303895">(</span><span class="ident" id="4303896">s</span>&nbsp;<span class="op" id="4303898">*</span><span class="ident" id="4303899">CertPool</span><span class="op" id="4303907">)</span>&nbsp;<span class="ident" id="4303909">Subjects</span><span class="op" id="4303917">(</span><span class="op" id="4303918">)</span>&nbsp;<span class="op" id="4303920">(</span><span class="ident" id="4303921">res</span>&nbsp;<span class="op" id="4303925">[</span><span class="op" id="4303926">]</span><span class="op" id="4303927">[</span><span class="op" id="4303928">]</span><span class="builtintype" id="4303929">byte</span><span class="op" id="4303933">)</span>&nbsp;<span class="op" id="4303935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4303938">res</span>&nbsp;<span class="op" id="4303942">=</span>&nbsp;<span class="builtinfunc" id="4303944">make</span><span class="op" id="4303948">(</span><span class="op" id="4303949">[</span><span class="op" id="4303950">]</span><span class="op" id="4303951">[</span><span class="op" id="4303952">]</span><span class="builtintype" id="4303953">byte</span><span class="op" id="4303957">,</span>&nbsp;<span class="builtinfunc" id="4303959">len</span><span class="op" id="4303962">(</span><span class="ident" id="4303963">s</span><span class="op" id="4303964">.</span><span class="ident" id="4303965">certs</span><span class="op" id="4303970">)</span><span class="op" id="4303971">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4303974">for</span>&nbsp;<span class="ident" id="4303978">i</span><span class="op" id="4303979">,</span>&nbsp;<span class="ident" id="4303981">c</span>&nbsp;<span class="op" id="4303983">:=</span>&nbsp;<span class="keyword" id="4303986">range</span>&nbsp;<span class="ident" id="4303992">s</span><span class="op" id="4303993">.</span><span class="ident" id="4303994">certs</span>&nbsp;<span class="op" id="4304000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4304004">res</span><span class="op" id="4304007">[</span><span class="ident" id="4304008">i</span><span class="op" id="4304009">]</span>&nbsp;<span class="op" id="4304011">=</span>&nbsp;<span class="ident" id="4304013">c</span><span class="op" id="4304014">.</span><span class="ident" id="4304015">RawSubject</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4304027">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4304030">return</span><br>
<span class="lineno"></span><span class="op" id="4304037">}</span>
</div>
</body>
</html>
