<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="7890979">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7891035">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7891089">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7891140">package</span>&nbsp;<span class="ident" id="7891148">jsonrpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891157">import</span>&nbsp;<span class="op" id="7891164">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891167">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891176">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891193">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891203">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891210">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891216">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891229">&#34;net&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891236">&#34;net/rpc&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891247">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7891258">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7891268">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="7891271">type</span>&nbsp;<span class="ident" id="7891276">Args</span>&nbsp;<span class="keyword" id="7891281">struct</span>&nbsp;<span class="op" id="7891288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891291">A</span><span class="op" id="7891292">,</span>&nbsp;<span class="ident" id="7891294">B</span>&nbsp;<span class="builtintype" id="7891296">int</span><br>
<span class="lineno"></span><span class="op" id="7891300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891303">type</span>&nbsp;<span class="ident" id="7891308">Reply</span>&nbsp;<span class="keyword" id="7891314">struct</span>&nbsp;<span class="op" id="7891321">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891324">C</span>&nbsp;<span class="builtintype" id="7891326">int</span><br>
<span class="lineno"></span><span class="op" id="7891330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891333">type</span>&nbsp;<span class="ident" id="7891338">Arith</span>&nbsp;<span class="builtintype" id="7891344">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="7891349">type</span>&nbsp;<span class="ident" id="7891354">ArithAddResp</span>&nbsp;<span class="keyword" id="7891367">struct</span>&nbsp;<span class="op" id="7891374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891377">Id</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7891384">interface</span><span class="op" id="7891393">{</span><span class="op" id="7891394">}</span>&nbsp;<span class="string" id="7891396">`json:&#34;id&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891409">Result</span>&nbsp;<span class="ident" id="7891416">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7891428">`json:&#34;result&#34;`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891445">Error</span>&nbsp;&nbsp;<span class="keyword" id="7891452">interface</span><span class="op" id="7891461">{</span><span class="op" id="7891462">}</span>&nbsp;<span class="string" id="7891464">`json:&#34;error&#34;`</span><br>
<span class="lineno"></span><span class="op" id="7891479">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="7891482">func</span>&nbsp;<span class="op" id="7891487">(</span><span class="ident" id="7891488">t</span>&nbsp;<span class="op" id="7891490">*</span><span class="ident" id="7891491">Arith</span><span class="op" id="7891496">)</span>&nbsp;<span class="ident" id="7891498">Add</span><span class="op" id="7891501">(</span><span class="ident" id="7891502">args</span>&nbsp;<span class="op" id="7891507">*</span><span class="ident" id="7891508">Args</span><span class="op" id="7891512">,</span>&nbsp;<span class="ident" id="7891514">reply</span>&nbsp;<span class="op" id="7891520">*</span><span class="ident" id="7891521">Reply</span><span class="op" id="7891526">)</span>&nbsp;<span class="builtintype" id="7891528">error</span>&nbsp;<span class="op" id="7891534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891537">reply</span><span class="op" id="7891542">.</span><span class="ident" id="7891543">C</span>&nbsp;<span class="op" id="7891545">=</span>&nbsp;<span class="ident" id="7891547">args</span><span class="op" id="7891551">.</span><span class="ident" id="7891552">A</span>&nbsp;<span class="op" id="7891554">+</span>&nbsp;<span class="ident" id="7891556">args</span><span class="op" id="7891560">.</span><span class="ident" id="7891561">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891564">return</span>&nbsp;<span class="ident" id="7891571">nil</span><br>
<span class="lineno"></span><span class="op" id="7891575">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="7891578">func</span>&nbsp;<span class="op" id="7891583">(</span><span class="ident" id="7891584">t</span>&nbsp;<span class="op" id="7891586">*</span><span class="ident" id="7891587">Arith</span><span class="op" id="7891592">)</span>&nbsp;<span class="ident" id="7891594">Mul</span><span class="op" id="7891597">(</span><span class="ident" id="7891598">args</span>&nbsp;<span class="op" id="7891603">*</span><span class="ident" id="7891604">Args</span><span class="op" id="7891608">,</span>&nbsp;<span class="ident" id="7891610">reply</span>&nbsp;<span class="op" id="7891616">*</span><span class="ident" id="7891617">Reply</span><span class="op" id="7891622">)</span>&nbsp;<span class="builtintype" id="7891624">error</span>&nbsp;<span class="op" id="7891630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891633">reply</span><span class="op" id="7891638">.</span><span class="ident" id="7891639">C</span>&nbsp;<span class="op" id="7891641">=</span>&nbsp;<span class="ident" id="7891643">args</span><span class="op" id="7891647">.</span><span class="ident" id="7891648">A</span>&nbsp;<span class="op" id="7891650">*</span>&nbsp;<span class="ident" id="7891652">args</span><span class="op" id="7891656">.</span><span class="ident" id="7891657">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891660">return</span>&nbsp;<span class="ident" id="7891667">nil</span><br>
<span class="lineno"></span><span class="op" id="7891671">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7891674">func</span>&nbsp;<span class="op" id="7891679">(</span><span class="ident" id="7891680">t</span>&nbsp;<span class="op" id="7891682">*</span><span class="ident" id="7891683">Arith</span><span class="op" id="7891688">)</span>&nbsp;<span class="ident" id="7891690">Div</span><span class="op" id="7891693">(</span><span class="ident" id="7891694">args</span>&nbsp;<span class="op" id="7891699">*</span><span class="ident" id="7891700">Args</span><span class="op" id="7891704">,</span>&nbsp;<span class="ident" id="7891706">reply</span>&nbsp;<span class="op" id="7891712">*</span><span class="ident" id="7891713">Reply</span><span class="op" id="7891718">)</span>&nbsp;<span class="builtintype" id="7891720">error</span>&nbsp;<span class="op" id="7891726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891729">if</span>&nbsp;<span class="ident" id="7891732">args</span><span class="op" id="7891736">.</span><span class="ident" id="7891737">B</span>&nbsp;<span class="op" id="7891739">==</span>&nbsp;<span class="num" id="7891742">0</span>&nbsp;<span class="op" id="7891744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891748">return</span>&nbsp;<span class="ident" id="7891755">errors</span><span class="op" id="7891761">.</span><span class="ident" id="7891762">New</span><span class="op" id="7891765">(</span><span class="string" id="7891766">&#34;divide&nbsp;by&nbsp;zero&#34;</span><span class="op" id="7891782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7891785">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891788">reply</span><span class="op" id="7891793">.</span><span class="ident" id="7891794">C</span>&nbsp;<span class="op" id="7891796">=</span>&nbsp;<span class="ident" id="7891798">args</span><span class="op" id="7891802">.</span><span class="ident" id="7891803">A</span>&nbsp;<span class="op" id="7891805">/</span>&nbsp;<span class="ident" id="7891807">args</span><span class="op" id="7891811">.</span><span class="ident" id="7891812">B</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7891815">return</span>&nbsp;<span class="ident" id="7891822">nil</span><br>
<span class="lineno"></span><span class="op" id="7891826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891829">func</span>&nbsp;<span class="op" id="7891834">(</span><span class="ident" id="7891835">t</span>&nbsp;<span class="op" id="7891837">*</span><span class="ident" id="7891838">Arith</span><span class="op" id="7891843">)</span>&nbsp;<span class="ident" id="7891845">Error</span><span class="op" id="7891850">(</span><span class="ident" id="7891851">args</span>&nbsp;<span class="op" id="7891856">*</span><span class="ident" id="7891857">Args</span><span class="op" id="7891861">,</span>&nbsp;<span class="ident" id="7891863">reply</span>&nbsp;<span class="op" id="7891869">*</span><span class="ident" id="7891870">Reply</span><span class="op" id="7891875">)</span>&nbsp;<span class="builtintype" id="7891877">error</span>&nbsp;<span class="op" id="7891883">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7891886">panic</span><span class="op" id="7891891">(</span><span class="string" id="7891892">&#34;ERROR&#34;</span><span class="op" id="7891899">)</span><br>
<span class="lineno"></span><span class="op" id="7891901">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891904">func</span>&nbsp;<span class="ident" id="7891909">init</span><span class="op" id="7891913">(</span><span class="op" id="7891914">)</span>&nbsp;<span class="op" id="7891916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891919">rpc</span><span class="op" id="7891922">.</span><span class="ident" id="7891923">Register</span><span class="op" id="7891931">(</span><span class="builtinfunc" id="7891932">new</span><span class="op" id="7891935">(</span><span class="ident" id="7891936">Arith</span><span class="op" id="7891941">)</span><span class="op" id="7891942">)</span><br>
<span class="lineno">60</span><span class="op" id="7891944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7891947">func</span>&nbsp;<span class="ident" id="7891952">TestServerNoParams</span><span class="op" id="7891970">(</span><span class="ident" id="7891971">t</span>&nbsp;<span class="op" id="7891973">*</span><span class="ident" id="7891974">testing</span><span class="op" id="7891981">.</span><span class="ident" id="7891982">T</span><span class="op" id="7891983">)</span>&nbsp;<span class="op" id="7891985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7891988">cli</span><span class="op" id="7891991">,</span>&nbsp;<span class="ident" id="7891993">srv</span>&nbsp;<span class="op" id="7891997">:=</span>&nbsp;<span class="ident" id="7892000">net</span><span class="op" id="7892003">.</span><span class="ident" id="7892004">Pipe</span><span class="op" id="7892008">(</span><span class="op" id="7892009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892012">defer</span>&nbsp;<span class="ident" id="7892018">cli</span><span class="op" id="7892021">.</span><span class="ident" id="7892022">Close</span><span class="op" id="7892027">(</span><span class="op" id="7892028">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892031">go</span>&nbsp;<span class="ident" id="7892034">ServeConn</span><span class="op" id="7892043">(</span><span class="ident" id="7892044">srv</span><span class="op" id="7892047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892050">dec</span>&nbsp;<span class="op" id="7892054">:=</span>&nbsp;<span class="ident" id="7892057">json</span><span class="op" id="7892061">.</span><span class="ident" id="7892062">NewDecoder</span><span class="op" id="7892072">(</span><span class="ident" id="7892073">cli</span><span class="op" id="7892076">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892080">fmt</span><span class="op" id="7892083">.</span><span class="ident" id="7892084">Fprintf</span><span class="op" id="7892091">(</span><span class="ident" id="7892092">cli</span><span class="op" id="7892095">,</span>&nbsp;<span class="string" id="7892097">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;}`</span><span class="op" id="7892135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892138">var</span>&nbsp;<span class="ident" id="7892142">resp</span>&nbsp;<span class="ident" id="7892147">ArithAddResp</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892161">if</span>&nbsp;<span class="ident" id="7892164">err</span>&nbsp;<span class="op" id="7892168">:=</span>&nbsp;<span class="ident" id="7892171">dec</span><span class="op" id="7892174">.</span><span class="ident" id="7892175">Decode</span><span class="op" id="7892181">(</span><span class="op" id="7892182">&amp;</span><span class="ident" id="7892183">resp</span><span class="op" id="7892187">)</span><span class="op" id="7892188">;</span>&nbsp;<span class="ident" id="7892190">err</span>&nbsp;<span class="op" id="7892194">!=</span>&nbsp;<span class="ident" id="7892197">nil</span>&nbsp;<span class="op" id="7892201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892205">t</span><span class="op" id="7892206">.</span><span class="ident" id="7892207">Fatalf</span><span class="op" id="7892213">(</span><span class="string" id="7892214">&#34;Decode&nbsp;after&nbsp;no&nbsp;params:&nbsp;%s&#34;</span><span class="op" id="7892242">,</span>&nbsp;<span class="ident" id="7892244">err</span><span class="op" id="7892247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892253">if</span>&nbsp;<span class="ident" id="7892256">resp</span><span class="op" id="7892260">.</span><span class="ident" id="7892261">Error</span>&nbsp;<span class="op" id="7892267">==</span>&nbsp;<span class="ident" id="7892270">nil</span>&nbsp;<span class="op" id="7892274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892278">t</span><span class="op" id="7892279">.</span><span class="ident" id="7892280">Fatalf</span><span class="op" id="7892286">(</span><span class="string" id="7892287">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7892312">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892315">}</span><br>
<span class="lineno"></span><span class="op" id="7892317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892320">func</span>&nbsp;<span class="ident" id="7892325">TestServerEmptyMessage</span><span class="op" id="7892347">(</span><span class="ident" id="7892348">t</span>&nbsp;<span class="op" id="7892350">*</span><span class="ident" id="7892351">testing</span><span class="op" id="7892358">.</span><span class="ident" id="7892359">T</span><span class="op" id="7892360">)</span>&nbsp;<span class="op" id="7892362">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892365">cli</span><span class="op" id="7892368">,</span>&nbsp;<span class="ident" id="7892370">srv</span>&nbsp;<span class="op" id="7892374">:=</span>&nbsp;<span class="ident" id="7892377">net</span><span class="op" id="7892380">.</span><span class="ident" id="7892381">Pipe</span><span class="op" id="7892385">(</span><span class="op" id="7892386">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892389">defer</span>&nbsp;<span class="ident" id="7892395">cli</span><span class="op" id="7892398">.</span><span class="ident" id="7892399">Close</span><span class="op" id="7892404">(</span><span class="op" id="7892405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892408">go</span>&nbsp;<span class="ident" id="7892411">ServeConn</span><span class="op" id="7892420">(</span><span class="ident" id="7892421">srv</span><span class="op" id="7892424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892427">dec</span>&nbsp;<span class="op" id="7892431">:=</span>&nbsp;<span class="ident" id="7892434">json</span><span class="op" id="7892438">.</span><span class="ident" id="7892439">NewDecoder</span><span class="op" id="7892449">(</span><span class="ident" id="7892450">cli</span><span class="op" id="7892453">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892457">fmt</span><span class="op" id="7892460">.</span><span class="ident" id="7892461">Fprintf</span><span class="op" id="7892468">(</span><span class="ident" id="7892469">cli</span><span class="op" id="7892472">,</span>&nbsp;<span class="string" id="7892474">&#34;{}&#34;</span><span class="op" id="7892478">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892481">var</span>&nbsp;<span class="ident" id="7892485">resp</span>&nbsp;<span class="ident" id="7892490">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892504">if</span>&nbsp;<span class="ident" id="7892507">err</span>&nbsp;<span class="op" id="7892511">:=</span>&nbsp;<span class="ident" id="7892514">dec</span><span class="op" id="7892517">.</span><span class="ident" id="7892518">Decode</span><span class="op" id="7892524">(</span><span class="op" id="7892525">&amp;</span><span class="ident" id="7892526">resp</span><span class="op" id="7892530">)</span><span class="op" id="7892531">;</span>&nbsp;<span class="ident" id="7892533">err</span>&nbsp;<span class="op" id="7892537">!=</span>&nbsp;<span class="ident" id="7892540">nil</span>&nbsp;<span class="op" id="7892544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892548">t</span><span class="op" id="7892549">.</span><span class="ident" id="7892550">Fatalf</span><span class="op" id="7892556">(</span><span class="string" id="7892557">&#34;Decode&nbsp;after&nbsp;empty:&nbsp;%s&#34;</span><span class="op" id="7892581">,</span>&nbsp;<span class="ident" id="7892583">err</span><span class="op" id="7892586">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892592">if</span>&nbsp;<span class="ident" id="7892595">resp</span><span class="op" id="7892599">.</span><span class="ident" id="7892600">Error</span>&nbsp;<span class="op" id="7892606">==</span>&nbsp;<span class="ident" id="7892609">nil</span>&nbsp;<span class="op" id="7892613">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892617">t</span><span class="op" id="7892618">.</span><span class="ident" id="7892619">Fatalf</span><span class="op" id="7892625">(</span><span class="string" id="7892626">&#34;Expected&nbsp;error,&nbsp;got&nbsp;nil&#34;</span><span class="op" id="7892651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7892654">}</span><br>
<span class="lineno"></span><span class="op" id="7892656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7892659">func</span>&nbsp;<span class="ident" id="7892664">TestServer</span><span class="op" id="7892674">(</span><span class="ident" id="7892675">t</span>&nbsp;<span class="op" id="7892677">*</span><span class="ident" id="7892678">testing</span><span class="op" id="7892685">.</span><span class="ident" id="7892686">T</span><span class="op" id="7892687">)</span>&nbsp;<span class="op" id="7892689">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892692">cli</span><span class="op" id="7892695">,</span>&nbsp;<span class="ident" id="7892697">srv</span>&nbsp;<span class="op" id="7892701">:=</span>&nbsp;<span class="ident" id="7892704">net</span><span class="op" id="7892707">.</span><span class="ident" id="7892708">Pipe</span><span class="op" id="7892712">(</span><span class="op" id="7892713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892716">defer</span>&nbsp;<span class="ident" id="7892722">cli</span><span class="op" id="7892725">.</span><span class="ident" id="7892726">Close</span><span class="op" id="7892731">(</span><span class="op" id="7892732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892735">go</span>&nbsp;<span class="ident" id="7892738">ServeConn</span><span class="op" id="7892747">(</span><span class="ident" id="7892748">srv</span><span class="op" id="7892751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892754">dec</span>&nbsp;<span class="op" id="7892758">:=</span>&nbsp;<span class="ident" id="7892761">json</span><span class="op" id="7892765">.</span><span class="ident" id="7892766">NewDecoder</span><span class="op" id="7892776">(</span><span class="ident" id="7892777">cli</span><span class="op" id="7892780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7892784">//&nbsp;Send&nbsp;hand-coded&nbsp;requests&nbsp;to&nbsp;server,&nbsp;parse&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892841">for</span>&nbsp;<span class="ident" id="7892845">i</span>&nbsp;<span class="op" id="7892847">:=</span>&nbsp;<span class="num" id="7892850">0</span><span class="op" id="7892851">;</span>&nbsp;<span class="ident" id="7892853">i</span>&nbsp;<span class="op" id="7892855">&lt;</span>&nbsp;<span class="num" id="7892857">10</span><span class="op" id="7892859">;</span>&nbsp;<span class="ident" id="7892861">i</span><span class="op" id="7892862">++</span>&nbsp;<span class="op" id="7892865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892869">fmt</span><span class="op" id="7892872">.</span><span class="ident" id="7892873">Fprintf</span><span class="op" id="7892880">(</span><span class="ident" id="7892881">cli</span><span class="op" id="7892884">,</span>&nbsp;<span class="string" id="7892886">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;\u%04d&#34;,&nbsp;&#34;params&#34;:&nbsp;[{&#34;A&#34;:&nbsp;%d,&nbsp;&#34;B&#34;:&nbsp;%d}]}`</span><span class="op" id="7892959">,</span>&nbsp;<span class="ident" id="7892961">i</span><span class="op" id="7892962">,</span>&nbsp;<span class="ident" id="7892964">i</span><span class="op" id="7892965">,</span>&nbsp;<span class="ident" id="7892967">i</span><span class="op" id="7892968">+</span><span class="num" id="7892969">1</span><span class="op" id="7892970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7892974">var</span>&nbsp;<span class="ident" id="7892978">resp</span>&nbsp;<span class="ident" id="7892983">ArithAddResp</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7892998">err</span>&nbsp;<span class="op" id="7893002">:=</span>&nbsp;<span class="ident" id="7893005">dec</span><span class="op" id="7893008">.</span><span class="ident" id="7893009">Decode</span><span class="op" id="7893015">(</span><span class="op" id="7893016">&amp;</span><span class="ident" id="7893017">resp</span><span class="op" id="7893021">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893025">if</span>&nbsp;<span class="ident" id="7893028">err</span>&nbsp;<span class="op" id="7893032">!=</span>&nbsp;<span class="ident" id="7893035">nil</span>&nbsp;<span class="op" id="7893039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893044">t</span><span class="op" id="7893045">.</span><span class="ident" id="7893046">Fatalf</span><span class="op" id="7893052">(</span><span class="string" id="7893053">&#34;Decode:&nbsp;%s&#34;</span><span class="op" id="7893065">,</span>&nbsp;<span class="ident" id="7893067">err</span><span class="op" id="7893070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893078">if</span>&nbsp;<span class="ident" id="7893081">resp</span><span class="op" id="7893085">.</span><span class="ident" id="7893086">Error</span>&nbsp;<span class="op" id="7893092">!=</span>&nbsp;<span class="ident" id="7893095">nil</span>&nbsp;<span class="op" id="7893099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893104">t</span><span class="op" id="7893105">.</span><span class="ident" id="7893106">Fatalf</span><span class="op" id="7893112">(</span><span class="string" id="7893113">&#34;resp.Error:&nbsp;%s&#34;</span><span class="op" id="7893129">,</span>&nbsp;<span class="ident" id="7893131">resp</span><span class="op" id="7893135">.</span><span class="ident" id="7893136">Error</span><span class="op" id="7893141">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893149">if</span>&nbsp;<span class="ident" id="7893152">resp</span><span class="op" id="7893156">.</span><span class="ident" id="7893157">Id</span><span class="op" id="7893159">.</span><span class="op" id="7893160">(</span><span class="builtintype" id="7893161">string</span><span class="op" id="7893167">)</span>&nbsp;<span class="op" id="7893169">!=</span>&nbsp;<span class="builtintype" id="7893172">string</span><span class="op" id="7893178">(</span><span class="ident" id="7893179">i</span><span class="op" id="7893180">)</span>&nbsp;<span class="op" id="7893182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893187">t</span><span class="op" id="7893188">.</span><span class="ident" id="7893189">Fatalf</span><span class="op" id="7893195">(</span><span class="string" id="7893196">&#34;resp:&nbsp;bad&nbsp;id&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7893221">,</span>&nbsp;<span class="ident" id="7893223">resp</span><span class="op" id="7893227">.</span><span class="ident" id="7893228">Id</span><span class="op" id="7893230">.</span><span class="op" id="7893231">(</span><span class="builtintype" id="7893232">string</span><span class="op" id="7893238">)</span><span class="op" id="7893239">,</span>&nbsp;<span class="builtintype" id="7893241">string</span><span class="op" id="7893247">(</span><span class="ident" id="7893248">i</span><span class="op" id="7893249">)</span><span class="op" id="7893250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893254">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893258">if</span>&nbsp;<span class="ident" id="7893261">resp</span><span class="op" id="7893265">.</span><span class="ident" id="7893266">Result</span><span class="op" id="7893272">.</span><span class="ident" id="7893273">C</span>&nbsp;<span class="op" id="7893275">!=</span>&nbsp;<span class="num" id="7893278">2</span><span class="op" id="7893279">*</span><span class="ident" id="7893280">i</span><span class="op" id="7893281">+</span><span class="num" id="7893282">1</span>&nbsp;<span class="op" id="7893284">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893289">t</span><span class="op" id="7893290">.</span><span class="ident" id="7893291">Fatalf</span><span class="op" id="7893297">(</span><span class="string" id="7893298">&#34;resp:&nbsp;bad&nbsp;result:&nbsp;%d+%d=%d&#34;</span><span class="op" id="7893326">,</span>&nbsp;<span class="ident" id="7893328">i</span><span class="op" id="7893329">,</span>&nbsp;<span class="ident" id="7893331">i</span><span class="op" id="7893332">+</span><span class="num" id="7893333">1</span><span class="op" id="7893334">,</span>&nbsp;<span class="ident" id="7893336">resp</span><span class="op" id="7893340">.</span><span class="ident" id="7893341">Result</span><span class="op" id="7893347">.</span><span class="ident" id="7893348">C</span><span class="op" id="7893349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893356">}</span><br>
<span class="lineno"></span><span class="op" id="7893358">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="keyword" id="7893361">func</span>&nbsp;<span class="ident" id="7893366">TestClient</span><span class="op" id="7893376">(</span><span class="ident" id="7893377">t</span>&nbsp;<span class="op" id="7893379">*</span><span class="ident" id="7893380">testing</span><span class="op" id="7893387">.</span><span class="ident" id="7893388">T</span><span class="op" id="7893389">)</span>&nbsp;<span class="op" id="7893391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893394">//&nbsp;Assume&nbsp;server&nbsp;is&nbsp;okay&nbsp;(TestServer&nbsp;is&nbsp;above).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893443">//&nbsp;Test&nbsp;client&nbsp;against&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893475">cli</span><span class="op" id="7893478">,</span>&nbsp;<span class="ident" id="7893480">srv</span>&nbsp;<span class="op" id="7893484">:=</span>&nbsp;<span class="ident" id="7893487">net</span><span class="op" id="7893490">.</span><span class="ident" id="7893491">Pipe</span><span class="op" id="7893495">(</span><span class="op" id="7893496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893499">go</span>&nbsp;<span class="ident" id="7893502">ServeConn</span><span class="op" id="7893511">(</span><span class="ident" id="7893512">srv</span><span class="op" id="7893515">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893519">client</span>&nbsp;<span class="op" id="7893526">:=</span>&nbsp;<span class="ident" id="7893529">NewClient</span><span class="op" id="7893538">(</span><span class="ident" id="7893539">cli</span><span class="op" id="7893542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893545">defer</span>&nbsp;<span class="ident" id="7893551">client</span><span class="op" id="7893557">.</span><span class="ident" id="7893558">Close</span><span class="op" id="7893563">(</span><span class="op" id="7893564">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7893568">//&nbsp;Synchronous&nbsp;calls</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893590">args</span>&nbsp;<span class="op" id="7893595">:=</span>&nbsp;<span class="op" id="7893598">&amp;</span><span class="ident" id="7893599">Args</span><span class="op" id="7893603">{</span><span class="num" id="7893604">7</span><span class="op" id="7893605">,</span>&nbsp;<span class="num" id="7893607">8</span><span class="op" id="7893608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893611">reply</span>&nbsp;<span class="op" id="7893617">:=</span>&nbsp;<span class="builtinfunc" id="7893620">new</span><span class="op" id="7893623">(</span><span class="ident" id="7893624">Reply</span><span class="op" id="7893629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893632">err</span>&nbsp;<span class="op" id="7893636">:=</span>&nbsp;<span class="ident" id="7893639">client</span><span class="op" id="7893645">.</span><span class="ident" id="7893646">Call</span><span class="op" id="7893650">(</span><span class="string" id="7893651">&#34;Arith.Add&#34;</span><span class="op" id="7893662">,</span>&nbsp;<span class="ident" id="7893664">args</span><span class="op" id="7893668">,</span>&nbsp;<span class="ident" id="7893670">reply</span><span class="op" id="7893675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893678">if</span>&nbsp;<span class="ident" id="7893681">err</span>&nbsp;<span class="op" id="7893685">!=</span>&nbsp;<span class="ident" id="7893688">nil</span>&nbsp;<span class="op" id="7893692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893696">t</span><span class="op" id="7893697">.</span><span class="ident" id="7893698">Errorf</span><span class="op" id="7893704">(</span><span class="string" id="7893705">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7893747">,</span>&nbsp;<span class="ident" id="7893749">err</span><span class="op" id="7893752">.</span><span class="ident" id="7893753">Error</span><span class="op" id="7893758">(</span><span class="op" id="7893759">)</span><span class="op" id="7893760">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893766">if</span>&nbsp;<span class="ident" id="7893769">reply</span><span class="op" id="7893774">.</span><span class="ident" id="7893775">C</span>&nbsp;<span class="op" id="7893777">!=</span>&nbsp;<span class="ident" id="7893780">args</span><span class="op" id="7893784">.</span><span class="ident" id="7893785">A</span><span class="op" id="7893786">+</span><span class="ident" id="7893787">args</span><span class="op" id="7893791">.</span><span class="ident" id="7893792">B</span>&nbsp;<span class="op" id="7893794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893798">t</span><span class="op" id="7893799">.</span><span class="ident" id="7893800">Errorf</span><span class="op" id="7893806">(</span><span class="string" id="7893807">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7893832">,</span>&nbsp;<span class="ident" id="7893834">reply</span><span class="op" id="7893839">.</span><span class="ident" id="7893840">C</span><span class="op" id="7893841">,</span>&nbsp;<span class="ident" id="7893843">args</span><span class="op" id="7893847">.</span><span class="ident" id="7893848">A</span><span class="op" id="7893849">+</span><span class="ident" id="7893850">args</span><span class="op" id="7893854">.</span><span class="ident" id="7893855">B</span><span class="op" id="7893856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7893859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893863">args</span>&nbsp;<span class="op" id="7893868">=</span>&nbsp;<span class="op" id="7893870">&amp;</span><span class="ident" id="7893871">Args</span><span class="op" id="7893875">{</span><span class="num" id="7893876">7</span><span class="op" id="7893877">,</span>&nbsp;<span class="num" id="7893879">8</span><span class="op" id="7893880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893883">reply</span>&nbsp;<span class="op" id="7893889">=</span>&nbsp;<span class="builtinfunc" id="7893891">new</span><span class="op" id="7893894">(</span><span class="ident" id="7893895">Reply</span><span class="op" id="7893900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893903">err</span>&nbsp;<span class="op" id="7893907">=</span>&nbsp;<span class="ident" id="7893909">client</span><span class="op" id="7893915">.</span><span class="ident" id="7893916">Call</span><span class="op" id="7893920">(</span><span class="string" id="7893921">&#34;Arith.Mul&#34;</span><span class="op" id="7893932">,</span>&nbsp;<span class="ident" id="7893934">args</span><span class="op" id="7893938">,</span>&nbsp;<span class="ident" id="7893940">reply</span><span class="op" id="7893945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7893948">if</span>&nbsp;<span class="ident" id="7893951">err</span>&nbsp;<span class="op" id="7893955">!=</span>&nbsp;<span class="ident" id="7893958">nil</span>&nbsp;<span class="op" id="7893962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7893966">t</span><span class="op" id="7893967">.</span><span class="ident" id="7893968">Errorf</span><span class="op" id="7893974">(</span><span class="string" id="7893975">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7894017">,</span>&nbsp;<span class="ident" id="7894019">err</span><span class="op" id="7894022">.</span><span class="ident" id="7894023">Error</span><span class="op" id="7894028">(</span><span class="op" id="7894029">)</span><span class="op" id="7894030">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894036">if</span>&nbsp;<span class="ident" id="7894039">reply</span><span class="op" id="7894044">.</span><span class="ident" id="7894045">C</span>&nbsp;<span class="op" id="7894047">!=</span>&nbsp;<span class="ident" id="7894050">args</span><span class="op" id="7894054">.</span><span class="ident" id="7894055">A</span><span class="op" id="7894056">*</span><span class="ident" id="7894057">args</span><span class="op" id="7894061">.</span><span class="ident" id="7894062">B</span>&nbsp;<span class="op" id="7894064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894068">t</span><span class="op" id="7894069">.</span><span class="ident" id="7894070">Errorf</span><span class="op" id="7894076">(</span><span class="string" id="7894077">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7894102">,</span>&nbsp;<span class="ident" id="7894104">reply</span><span class="op" id="7894109">.</span><span class="ident" id="7894110">C</span><span class="op" id="7894111">,</span>&nbsp;<span class="ident" id="7894113">args</span><span class="op" id="7894117">.</span><span class="ident" id="7894118">A</span><span class="op" id="7894119">*</span><span class="ident" id="7894120">args</span><span class="op" id="7894124">.</span><span class="ident" id="7894125">B</span><span class="op" id="7894126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7894133">//&nbsp;Out&nbsp;of&nbsp;order.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894151">args</span>&nbsp;<span class="op" id="7894156">=</span>&nbsp;<span class="op" id="7894158">&amp;</span><span class="ident" id="7894159">Args</span><span class="op" id="7894163">{</span><span class="num" id="7894164">7</span><span class="op" id="7894165">,</span>&nbsp;<span class="num" id="7894167">8</span><span class="op" id="7894168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894171">mulReply</span>&nbsp;<span class="op" id="7894180">:=</span>&nbsp;<span class="builtinfunc" id="7894183">new</span><span class="op" id="7894186">(</span><span class="ident" id="7894187">Reply</span><span class="op" id="7894192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894195">mulCall</span>&nbsp;<span class="op" id="7894203">:=</span>&nbsp;<span class="ident" id="7894206">client</span><span class="op" id="7894212">.</span><span class="ident" id="7894213">Go</span><span class="op" id="7894215">(</span><span class="string" id="7894216">&#34;Arith.Mul&#34;</span><span class="op" id="7894227">,</span>&nbsp;<span class="ident" id="7894229">args</span><span class="op" id="7894233">,</span>&nbsp;<span class="ident" id="7894235">mulReply</span><span class="op" id="7894243">,</span>&nbsp;<span class="ident" id="7894245">nil</span><span class="op" id="7894248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894251">addReply</span>&nbsp;<span class="op" id="7894260">:=</span>&nbsp;<span class="builtinfunc" id="7894263">new</span><span class="op" id="7894266">(</span><span class="ident" id="7894267">Reply</span><span class="op" id="7894272">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894275">addCall</span>&nbsp;<span class="op" id="7894283">:=</span>&nbsp;<span class="ident" id="7894286">client</span><span class="op" id="7894292">.</span><span class="ident" id="7894293">Go</span><span class="op" id="7894295">(</span><span class="string" id="7894296">&#34;Arith.Add&#34;</span><span class="op" id="7894307">,</span>&nbsp;<span class="ident" id="7894309">args</span><span class="op" id="7894313">,</span>&nbsp;<span class="ident" id="7894315">addReply</span><span class="op" id="7894323">,</span>&nbsp;<span class="ident" id="7894325">nil</span><span class="op" id="7894328">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894332">addCall</span>&nbsp;<span class="op" id="7894340">=</span>&nbsp;<span class="op" id="7894342">&lt;-</span><span class="ident" id="7894344">addCall</span><span class="op" id="7894351">.</span><span class="ident" id="7894352">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894358">if</span>&nbsp;<span class="ident" id="7894361">addCall</span><span class="op" id="7894368">.</span><span class="ident" id="7894369">Error</span>&nbsp;<span class="op" id="7894375">!=</span>&nbsp;<span class="ident" id="7894378">nil</span>&nbsp;<span class="op" id="7894382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894386">t</span><span class="op" id="7894387">.</span><span class="ident" id="7894388">Errorf</span><span class="op" id="7894394">(</span><span class="string" id="7894395">&#34;Add:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7894437">,</span>&nbsp;<span class="ident" id="7894439">addCall</span><span class="op" id="7894446">.</span><span class="ident" id="7894447">Error</span><span class="op" id="7894452">.</span><span class="ident" id="7894453">Error</span><span class="op" id="7894458">(</span><span class="op" id="7894459">)</span><span class="op" id="7894460">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894463">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894466">if</span>&nbsp;<span class="ident" id="7894469">addReply</span><span class="op" id="7894477">.</span><span class="ident" id="7894478">C</span>&nbsp;<span class="op" id="7894480">!=</span>&nbsp;<span class="ident" id="7894483">args</span><span class="op" id="7894487">.</span><span class="ident" id="7894488">A</span><span class="op" id="7894489">+</span><span class="ident" id="7894490">args</span><span class="op" id="7894494">.</span><span class="ident" id="7894495">B</span>&nbsp;<span class="op" id="7894497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894501">t</span><span class="op" id="7894502">.</span><span class="ident" id="7894503">Errorf</span><span class="op" id="7894509">(</span><span class="string" id="7894510">&#34;Add:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7894535">,</span>&nbsp;<span class="ident" id="7894537">addReply</span><span class="op" id="7894545">.</span><span class="ident" id="7894546">C</span><span class="op" id="7894547">,</span>&nbsp;<span class="ident" id="7894549">args</span><span class="op" id="7894553">.</span><span class="ident" id="7894554">A</span><span class="op" id="7894555">+</span><span class="ident" id="7894556">args</span><span class="op" id="7894560">.</span><span class="ident" id="7894561">B</span><span class="op" id="7894562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894569">mulCall</span>&nbsp;<span class="op" id="7894577">=</span>&nbsp;<span class="op" id="7894579">&lt;-</span><span class="ident" id="7894581">mulCall</span><span class="op" id="7894588">.</span><span class="ident" id="7894589">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894595">if</span>&nbsp;<span class="ident" id="7894598">mulCall</span><span class="op" id="7894605">.</span><span class="ident" id="7894606">Error</span>&nbsp;<span class="op" id="7894612">!=</span>&nbsp;<span class="ident" id="7894615">nil</span>&nbsp;<span class="op" id="7894619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894623">t</span><span class="op" id="7894624">.</span><span class="ident" id="7894625">Errorf</span><span class="op" id="7894631">(</span><span class="string" id="7894632">&#34;Mul:&nbsp;expected&nbsp;no&nbsp;error&nbsp;but&nbsp;got&nbsp;string&nbsp;%q&#34;</span><span class="op" id="7894674">,</span>&nbsp;<span class="ident" id="7894676">mulCall</span><span class="op" id="7894683">.</span><span class="ident" id="7894684">Error</span><span class="op" id="7894689">.</span><span class="ident" id="7894690">Error</span><span class="op" id="7894695">(</span><span class="op" id="7894696">)</span><span class="op" id="7894697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894703">if</span>&nbsp;<span class="ident" id="7894706">mulReply</span><span class="op" id="7894714">.</span><span class="ident" id="7894715">C</span>&nbsp;<span class="op" id="7894717">!=</span>&nbsp;<span class="ident" id="7894720">args</span><span class="op" id="7894724">.</span><span class="ident" id="7894725">A</span><span class="op" id="7894726">*</span><span class="ident" id="7894727">args</span><span class="op" id="7894731">.</span><span class="ident" id="7894732">B</span>&nbsp;<span class="op" id="7894734">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894738">t</span><span class="op" id="7894739">.</span><span class="ident" id="7894740">Errorf</span><span class="op" id="7894746">(</span><span class="string" id="7894747">&#34;Mul:&nbsp;got&nbsp;%d&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7894772">,</span>&nbsp;<span class="ident" id="7894774">mulReply</span><span class="op" id="7894782">.</span><span class="ident" id="7894783">C</span><span class="op" id="7894784">,</span>&nbsp;<span class="ident" id="7894786">args</span><span class="op" id="7894790">.</span><span class="ident" id="7894791">A</span><span class="op" id="7894792">*</span><span class="ident" id="7894793">args</span><span class="op" id="7894797">.</span><span class="ident" id="7894798">B</span><span class="op" id="7894799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7894806">//&nbsp;Error&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894821">args</span>&nbsp;<span class="op" id="7894826">=</span>&nbsp;<span class="op" id="7894828">&amp;</span><span class="ident" id="7894829">Args</span><span class="op" id="7894833">{</span><span class="num" id="7894834">7</span><span class="op" id="7894835">,</span>&nbsp;<span class="num" id="7894837">0</span><span class="op" id="7894838">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894841">reply</span>&nbsp;<span class="op" id="7894847">=</span>&nbsp;<span class="builtinfunc" id="7894849">new</span><span class="op" id="7894852">(</span><span class="ident" id="7894853">Reply</span><span class="op" id="7894858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894861">err</span>&nbsp;<span class="op" id="7894865">=</span>&nbsp;<span class="ident" id="7894867">client</span><span class="op" id="7894873">.</span><span class="ident" id="7894874">Call</span><span class="op" id="7894878">(</span><span class="string" id="7894879">&#34;Arith.Div&#34;</span><span class="op" id="7894890">,</span>&nbsp;<span class="ident" id="7894892">args</span><span class="op" id="7894896">,</span>&nbsp;<span class="ident" id="7894898">reply</span><span class="op" id="7894903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7894906">//&nbsp;expect&nbsp;an&nbsp;error:&nbsp;zero&nbsp;divide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7894939">if</span>&nbsp;<span class="ident" id="7894942">err</span>&nbsp;<span class="op" id="7894946">==</span>&nbsp;<span class="ident" id="7894949">nil</span>&nbsp;<span class="op" id="7894953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7894957">t</span><span class="op" id="7894958">.</span><span class="ident" id="7894959">Error</span><span class="op" id="7894964">(</span><span class="string" id="7894965">&#34;Div:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7894986">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7894989">}</span>&nbsp;<span class="keyword" id="7894991">else</span>&nbsp;<span class="keyword" id="7894996">if</span>&nbsp;<span class="ident" id="7894999">err</span><span class="op" id="7895002">.</span><span class="ident" id="7895003">Error</span><span class="op" id="7895008">(</span><span class="op" id="7895009">)</span>&nbsp;<span class="op" id="7895011">!=</span>&nbsp;<span class="string" id="7895014">&#34;divide&nbsp;by&nbsp;zero&#34;</span>&nbsp;<span class="op" id="7895031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895035">t</span><span class="op" id="7895036">.</span><span class="ident" id="7895037">Error</span><span class="op" id="7895042">(</span><span class="string" id="7895043">&#34;Div:&nbsp;expected&nbsp;divide&nbsp;by&nbsp;zero&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7895084">,</span>&nbsp;<span class="ident" id="7895086">err</span><span class="op" id="7895089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895092">}</span><br>
<span class="lineno"></span><span class="op" id="7895094">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="7895097">func</span>&nbsp;<span class="ident" id="7895102">TestMalformedInput</span><span class="op" id="7895120">(</span><span class="ident" id="7895121">t</span>&nbsp;<span class="op" id="7895123">*</span><span class="ident" id="7895124">testing</span><span class="op" id="7895131">.</span><span class="ident" id="7895132">T</span><span class="op" id="7895133">)</span>&nbsp;<span class="op" id="7895135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895138">cli</span><span class="op" id="7895141">,</span>&nbsp;<span class="ident" id="7895143">srv</span>&nbsp;<span class="op" id="7895147">:=</span>&nbsp;<span class="ident" id="7895150">net</span><span class="op" id="7895153">.</span><span class="ident" id="7895154">Pipe</span><span class="op" id="7895158">(</span><span class="op" id="7895159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895162">go</span>&nbsp;<span class="ident" id="7895165">cli</span><span class="op" id="7895168">.</span><span class="ident" id="7895169">Write</span><span class="op" id="7895174">(</span><span class="op" id="7895175">[</span><span class="op" id="7895176">]</span><span class="builtintype" id="7895177">byte</span><span class="op" id="7895181">(</span><span class="string" id="7895182">`{id:1}`</span><span class="op" id="7895190">)</span><span class="op" id="7895191">)</span>&nbsp;<span class="comment" id="7895193">//&nbsp;invalid&nbsp;json</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895210">ServeConn</span><span class="op" id="7895219">(</span><span class="ident" id="7895220">srv</span><span class="op" id="7895223">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7895241">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7895266">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7895269">func</span>&nbsp;<span class="ident" id="7895274">TestMalformedOutput</span><span class="op" id="7895293">(</span><span class="ident" id="7895294">t</span>&nbsp;<span class="op" id="7895296">*</span><span class="ident" id="7895297">testing</span><span class="op" id="7895304">.</span><span class="ident" id="7895305">T</span><span class="op" id="7895306">)</span>&nbsp;<span class="op" id="7895308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895311">cli</span><span class="op" id="7895314">,</span>&nbsp;<span class="ident" id="7895316">srv</span>&nbsp;<span class="op" id="7895320">:=</span>&nbsp;<span class="ident" id="7895323">net</span><span class="op" id="7895326">.</span><span class="ident" id="7895327">Pipe</span><span class="op" id="7895331">(</span><span class="op" id="7895332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895335">go</span>&nbsp;<span class="ident" id="7895338">srv</span><span class="op" id="7895341">.</span><span class="ident" id="7895342">Write</span><span class="op" id="7895347">(</span><span class="op" id="7895348">[</span><span class="op" id="7895349">]</span><span class="builtintype" id="7895350">byte</span><span class="op" id="7895354">(</span><span class="string" id="7895355">`{&#34;id&#34;:0,&#34;result&#34;:null,&#34;error&#34;:null}`</span><span class="op" id="7895392">)</span><span class="op" id="7895393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895396">go</span>&nbsp;<span class="ident" id="7895399">ioutil</span><span class="op" id="7895405">.</span><span class="ident" id="7895406">ReadAll</span><span class="op" id="7895413">(</span><span class="ident" id="7895414">srv</span><span class="op" id="7895417">)</span><br>
<span class="lineno">195</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895421">client</span>&nbsp;<span class="op" id="7895428">:=</span>&nbsp;<span class="ident" id="7895431">NewClient</span><span class="op" id="7895440">(</span><span class="ident" id="7895441">cli</span><span class="op" id="7895444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895447">defer</span>&nbsp;<span class="ident" id="7895453">client</span><span class="op" id="7895459">.</span><span class="ident" id="7895460">Close</span><span class="op" id="7895465">(</span><span class="op" id="7895466">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895470">args</span>&nbsp;<span class="op" id="7895475">:=</span>&nbsp;<span class="op" id="7895478">&amp;</span><span class="ident" id="7895479">Args</span><span class="op" id="7895483">{</span><span class="num" id="7895484">7</span><span class="op" id="7895485">,</span>&nbsp;<span class="num" id="7895487">8</span><span class="op" id="7895488">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895491">reply</span>&nbsp;<span class="op" id="7895497">:=</span>&nbsp;<span class="builtinfunc" id="7895500">new</span><span class="op" id="7895503">(</span><span class="ident" id="7895504">Reply</span><span class="op" id="7895509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895512">err</span>&nbsp;<span class="op" id="7895516">:=</span>&nbsp;<span class="ident" id="7895519">client</span><span class="op" id="7895525">.</span><span class="ident" id="7895526">Call</span><span class="op" id="7895530">(</span><span class="string" id="7895531">&#34;Arith.Add&#34;</span><span class="op" id="7895542">,</span>&nbsp;<span class="ident" id="7895544">args</span><span class="op" id="7895548">,</span>&nbsp;<span class="ident" id="7895550">reply</span><span class="op" id="7895555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895558">if</span>&nbsp;<span class="ident" id="7895561">err</span>&nbsp;<span class="op" id="7895565">==</span>&nbsp;<span class="ident" id="7895568">nil</span>&nbsp;<span class="op" id="7895572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895576">t</span><span class="op" id="7895577">.</span><span class="ident" id="7895578">Error</span><span class="op" id="7895583">(</span><span class="string" id="7895584">&#34;expected&nbsp;error&#34;</span><span class="op" id="7895600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895603">}</span><br>
<span class="lineno">205</span><span class="op" id="7895605">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7895608">func</span>&nbsp;<span class="ident" id="7895613">TestServerErrorHasNullResult</span><span class="op" id="7895641">(</span><span class="ident" id="7895642">t</span>&nbsp;<span class="op" id="7895644">*</span><span class="ident" id="7895645">testing</span><span class="op" id="7895652">.</span><span class="ident" id="7895653">T</span><span class="op" id="7895654">)</span>&nbsp;<span class="op" id="7895656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895659">var</span>&nbsp;<span class="ident" id="7895663">out</span>&nbsp;<span class="ident" id="7895667">bytes</span><span class="op" id="7895672">.</span><span class="ident" id="7895673">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895681">sc</span>&nbsp;<span class="op" id="7895684">:=</span>&nbsp;<span class="ident" id="7895687">NewServerCodec</span><span class="op" id="7895701">(</span><span class="keyword" id="7895702">struct</span>&nbsp;<span class="op" id="7895709">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895713">io</span><span class="op" id="7895715">.</span><span class="ident" id="7895716">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895725">io</span><span class="op" id="7895727">.</span><span class="ident" id="7895728">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895737">io</span><span class="op" id="7895739">.</span><span class="ident" id="7895740">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895748">}</span><span class="op" id="7895749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895753">Reader</span><span class="op" id="7895759">:</span>&nbsp;<span class="ident" id="7895761">strings</span><span class="op" id="7895768">.</span><span class="ident" id="7895769">NewReader</span><span class="op" id="7895778">(</span><span class="string" id="7895779">`{&#34;method&#34;:&nbsp;&#34;Arith.Add&#34;,&nbsp;&#34;id&#34;:&nbsp;&#34;123&#34;,&nbsp;&#34;params&#34;:&nbsp;[]}`</span><span class="op" id="7895831">)</span><span class="op" id="7895832">,</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895836">Writer</span><span class="op" id="7895842">:</span>&nbsp;<span class="op" id="7895844">&amp;</span><span class="ident" id="7895845">out</span><span class="op" id="7895848">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895852">Closer</span><span class="op" id="7895858">:</span>&nbsp;<span class="ident" id="7895860">ioutil</span><span class="op" id="7895866">.</span><span class="ident" id="7895867">NopCloser</span><span class="op" id="7895876">(</span><span class="ident" id="7895877">nil</span><span class="op" id="7895880">)</span><span class="op" id="7895881">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895884">}</span><span class="op" id="7895885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895888">r</span>&nbsp;<span class="op" id="7895890">:=</span>&nbsp;<span class="builtinfunc" id="7895893">new</span><span class="op" id="7895896">(</span><span class="ident" id="7895897">rpc</span><span class="op" id="7895900">.</span><span class="ident" id="7895901">Request</span><span class="op" id="7895908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895911">if</span>&nbsp;<span class="ident" id="7895914">err</span>&nbsp;<span class="op" id="7895918">:=</span>&nbsp;<span class="ident" id="7895921">sc</span><span class="op" id="7895923">.</span><span class="ident" id="7895924">ReadRequestHeader</span><span class="op" id="7895941">(</span><span class="ident" id="7895942">r</span><span class="op" id="7895943">)</span><span class="op" id="7895944">;</span>&nbsp;<span class="ident" id="7895946">err</span>&nbsp;<span class="op" id="7895950">!=</span>&nbsp;<span class="ident" id="7895953">nil</span>&nbsp;<span class="op" id="7895957">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7895961">t</span><span class="op" id="7895962">.</span><span class="ident" id="7895963">Fatal</span><span class="op" id="7895968">(</span><span class="ident" id="7895969">err</span><span class="op" id="7895972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7895975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7895978">const</span>&nbsp;<span class="ident" id="7895984">valueText</span>&nbsp;<span class="op" id="7895994">=</span>&nbsp;<span class="string" id="7895996">&#34;the&nbsp;value&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;see&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896030">const</span>&nbsp;<span class="ident" id="7896036">errorText</span>&nbsp;<span class="op" id="7896046">=</span>&nbsp;<span class="string" id="7896048">&#34;some&nbsp;error&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896062">err</span>&nbsp;<span class="op" id="7896066">:=</span>&nbsp;<span class="ident" id="7896069">sc</span><span class="op" id="7896071">.</span><span class="ident" id="7896072">WriteResponse</span><span class="op" id="7896085">(</span><span class="op" id="7896086">&amp;</span><span class="ident" id="7896087">rpc</span><span class="op" id="7896090">.</span><span class="ident" id="7896091">Response</span><span class="op" id="7896099">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896103">ServiceMethod</span><span class="op" id="7896116">:</span>&nbsp;<span class="string" id="7896118">&#34;Method&#34;</span><span class="op" id="7896126">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896130">Seq</span><span class="op" id="7896133">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7896145">1</span><span class="op" id="7896146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896150">Error</span><span class="op" id="7896155">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7896165">errorText</span><span class="op" id="7896174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896177">}</span><span class="op" id="7896178">,</span>&nbsp;<span class="ident" id="7896180">valueText</span><span class="op" id="7896189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896192">if</span>&nbsp;<span class="ident" id="7896195">err</span>&nbsp;<span class="op" id="7896199">!=</span>&nbsp;<span class="ident" id="7896202">nil</span>&nbsp;<span class="op" id="7896206">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896210">t</span><span class="op" id="7896211">.</span><span class="ident" id="7896212">Fatal</span><span class="op" id="7896217">(</span><span class="ident" id="7896218">err</span><span class="op" id="7896221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896227">if</span>&nbsp;<span class="op" id="7896230">!</span><span class="ident" id="7896231">strings</span><span class="op" id="7896238">.</span><span class="ident" id="7896239">Contains</span><span class="op" id="7896247">(</span><span class="ident" id="7896248">out</span><span class="op" id="7896251">.</span><span class="ident" id="7896252">String</span><span class="op" id="7896258">(</span><span class="op" id="7896259">)</span><span class="op" id="7896260">,</span>&nbsp;<span class="ident" id="7896262">errorText</span><span class="op" id="7896271">)</span>&nbsp;<span class="op" id="7896273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896277">t</span><span class="op" id="7896278">.</span><span class="ident" id="7896279">Fatalf</span><span class="op" id="7896285">(</span><span class="string" id="7896286">&#34;Response&nbsp;didn&#39;t&nbsp;contain&nbsp;expected&nbsp;error&nbsp;%q:&nbsp;%s&#34;</span><span class="op" id="7896333">,</span>&nbsp;<span class="ident" id="7896335">errorText</span><span class="op" id="7896344">,</span>&nbsp;<span class="op" id="7896346">&amp;</span><span class="ident" id="7896347">out</span><span class="op" id="7896350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896353">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896356">if</span>&nbsp;<span class="ident" id="7896359">strings</span><span class="op" id="7896366">.</span><span class="ident" id="7896367">Contains</span><span class="op" id="7896375">(</span><span class="ident" id="7896376">out</span><span class="op" id="7896379">.</span><span class="ident" id="7896380">String</span><span class="op" id="7896386">(</span><span class="op" id="7896387">)</span><span class="op" id="7896388">,</span>&nbsp;<span class="ident" id="7896390">valueText</span><span class="op" id="7896399">)</span>&nbsp;<span class="op" id="7896401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896405">t</span><span class="op" id="7896406">.</span><span class="ident" id="7896407">Errorf</span><span class="op" id="7896413">(</span><span class="string" id="7896414">&#34;Response&nbsp;contains&nbsp;both&nbsp;an&nbsp;error&nbsp;and&nbsp;value:&nbsp;%s&#34;</span><span class="op" id="7896461">,</span>&nbsp;<span class="op" id="7896463">&amp;</span><span class="ident" id="7896464">out</span><span class="op" id="7896467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896470">}</span><br>
<span class="lineno"></span><span class="op" id="7896472">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7896475">func</span>&nbsp;<span class="ident" id="7896480">TestUnexpectedError</span><span class="op" id="7896499">(</span><span class="ident" id="7896500">t</span>&nbsp;<span class="op" id="7896502">*</span><span class="ident" id="7896503">testing</span><span class="op" id="7896510">.</span><span class="ident" id="7896511">T</span><span class="op" id="7896512">)</span>&nbsp;<span class="op" id="7896514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896517">cli</span><span class="op" id="7896520">,</span>&nbsp;<span class="ident" id="7896522">srv</span>&nbsp;<span class="op" id="7896526">:=</span>&nbsp;<span class="ident" id="7896529">myPipe</span><span class="op" id="7896535">(</span><span class="op" id="7896536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896539">go</span>&nbsp;<span class="ident" id="7896542">cli</span><span class="op" id="7896545">.</span><span class="ident" id="7896546">PipeWriter</span><span class="op" id="7896556">.</span><span class="ident" id="7896557">CloseWithError</span><span class="op" id="7896571">(</span><span class="ident" id="7896572">errors</span><span class="op" id="7896578">.</span><span class="ident" id="7896579">New</span><span class="op" id="7896582">(</span><span class="string" id="7896583">&#34;unexpected&nbsp;error!&#34;</span><span class="op" id="7896602">)</span><span class="op" id="7896603">)</span>&nbsp;<span class="comment" id="7896605">//&nbsp;reader&nbsp;will&nbsp;get&nbsp;this&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896636">ServeConn</span><span class="op" id="7896645">(</span><span class="ident" id="7896646">srv</span><span class="op" id="7896649">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7896702">//&nbsp;must&nbsp;return,&nbsp;not&nbsp;loop</span><br>
<span class="lineno"></span><span class="op" id="7896727">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="7896730">//&nbsp;Copied&nbsp;from&nbsp;package&nbsp;net.</span><br>
<span class="lineno"></span><span class="keyword" id="7896758">func</span>&nbsp;<span class="ident" id="7896763">myPipe</span><span class="op" id="7896769">(</span><span class="op" id="7896770">)</span>&nbsp;<span class="op" id="7896772">(</span><span class="op" id="7896773">*</span><span class="ident" id="7896774">pipe</span><span class="op" id="7896778">,</span>&nbsp;<span class="op" id="7896780">*</span><span class="ident" id="7896781">pipe</span><span class="op" id="7896785">)</span>&nbsp;<span class="op" id="7896787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896790">r1</span><span class="op" id="7896792">,</span>&nbsp;<span class="ident" id="7896794">w1</span>&nbsp;<span class="op" id="7896797">:=</span>&nbsp;<span class="ident" id="7896800">io</span><span class="op" id="7896802">.</span><span class="ident" id="7896803">Pipe</span><span class="op" id="7896807">(</span><span class="op" id="7896808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7896811">r2</span><span class="op" id="7896813">,</span>&nbsp;<span class="ident" id="7896815">w2</span>&nbsp;<span class="op" id="7896818">:=</span>&nbsp;<span class="ident" id="7896821">io</span><span class="op" id="7896823">.</span><span class="ident" id="7896824">Pipe</span><span class="op" id="7896828">(</span><span class="op" id="7896829">)</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896833">return</span>&nbsp;<span class="op" id="7896840">&amp;</span><span class="ident" id="7896841">pipe</span><span class="op" id="7896845">{</span><span class="ident" id="7896846">r1</span><span class="op" id="7896848">,</span>&nbsp;<span class="ident" id="7896850">w2</span><span class="op" id="7896852">}</span><span class="op" id="7896853">,</span>&nbsp;<span class="op" id="7896855">&amp;</span><span class="ident" id="7896856">pipe</span><span class="op" id="7896860">{</span><span class="ident" id="7896861">r2</span><span class="op" id="7896863">,</span>&nbsp;<span class="ident" id="7896865">w1</span><span class="op" id="7896867">}</span><br>
<span class="lineno"></span><span class="op" id="7896869">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7896872">type</span>&nbsp;<span class="ident" id="7896877">pipe</span>&nbsp;<span class="keyword" id="7896882">struct</span>&nbsp;<span class="op" id="7896889">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896892">*</span><span class="ident" id="7896893">io</span><span class="op" id="7896895">.</span><span class="ident" id="7896896">PipeReader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7896908">*</span><span class="ident" id="7896909">io</span><span class="op" id="7896911">.</span><span class="ident" id="7896912">PipeWriter</span><br>
<span class="lineno"></span><span class="op" id="7896923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7896926">type</span>&nbsp;<span class="ident" id="7896931">pipeAddr</span>&nbsp;<span class="builtintype" id="7896940">int</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="7896945">func</span>&nbsp;<span class="op" id="7896950">(</span><span class="ident" id="7896951">pipeAddr</span><span class="op" id="7896959">)</span>&nbsp;<span class="ident" id="7896961">Network</span><span class="op" id="7896968">(</span><span class="op" id="7896969">)</span>&nbsp;<span class="builtintype" id="7896971">string</span>&nbsp;<span class="op" id="7896978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7896981">return</span>&nbsp;<span class="string" id="7896988">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7896995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="keyword" id="7896998">func</span>&nbsp;<span class="op" id="7897003">(</span><span class="ident" id="7897004">pipeAddr</span><span class="op" id="7897012">)</span>&nbsp;<span class="ident" id="7897014">String</span><span class="op" id="7897020">(</span><span class="op" id="7897021">)</span>&nbsp;<span class="builtintype" id="7897023">string</span>&nbsp;<span class="op" id="7897030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897033">return</span>&nbsp;<span class="string" id="7897040">&#34;pipe&#34;</span><br>
<span class="lineno"></span><span class="op" id="7897047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897050">func</span>&nbsp;<span class="op" id="7897055">(</span><span class="ident" id="7897056">p</span>&nbsp;<span class="op" id="7897058">*</span><span class="ident" id="7897059">pipe</span><span class="op" id="7897063">)</span>&nbsp;<span class="ident" id="7897065">Close</span><span class="op" id="7897070">(</span><span class="op" id="7897071">)</span>&nbsp;<span class="builtintype" id="7897073">error</span>&nbsp;<span class="op" id="7897079">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897082">err</span>&nbsp;<span class="op" id="7897086">:=</span>&nbsp;<span class="ident" id="7897089">p</span><span class="op" id="7897090">.</span><span class="ident" id="7897091">PipeReader</span><span class="op" id="7897101">.</span><span class="ident" id="7897102">Close</span><span class="op" id="7897107">(</span><span class="op" id="7897108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897111">err1</span>&nbsp;<span class="op" id="7897116">:=</span>&nbsp;<span class="ident" id="7897119">p</span><span class="op" id="7897120">.</span><span class="ident" id="7897121">PipeWriter</span><span class="op" id="7897131">.</span><span class="ident" id="7897132">Close</span><span class="op" id="7897137">(</span><span class="op" id="7897138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897141">if</span>&nbsp;<span class="ident" id="7897144">err</span>&nbsp;<span class="op" id="7897148">==</span>&nbsp;<span class="ident" id="7897151">nil</span>&nbsp;<span class="op" id="7897155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7897159">err</span>&nbsp;<span class="op" id="7897163">=</span>&nbsp;<span class="ident" id="7897165">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7897171">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897174">return</span>&nbsp;<span class="ident" id="7897181">err</span><br>
<span class="lineno"></span><span class="op" id="7897185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897188">func</span>&nbsp;<span class="op" id="7897193">(</span><span class="ident" id="7897194">p</span>&nbsp;<span class="op" id="7897196">*</span><span class="ident" id="7897197">pipe</span><span class="op" id="7897201">)</span>&nbsp;<span class="ident" id="7897203">LocalAddr</span><span class="op" id="7897212">(</span><span class="op" id="7897213">)</span>&nbsp;<span class="ident" id="7897215">net</span><span class="op" id="7897218">.</span><span class="ident" id="7897219">Addr</span>&nbsp;<span class="op" id="7897224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897227">return</span>&nbsp;<span class="ident" id="7897234">pipeAddr</span><span class="op" id="7897242">(</span><span class="num" id="7897243">0</span><span class="op" id="7897244">)</span><br>
<span class="lineno">280</span><span class="op" id="7897246">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897249">func</span>&nbsp;<span class="op" id="7897254">(</span><span class="ident" id="7897255">p</span>&nbsp;<span class="op" id="7897257">*</span><span class="ident" id="7897258">pipe</span><span class="op" id="7897262">)</span>&nbsp;<span class="ident" id="7897264">RemoteAddr</span><span class="op" id="7897274">(</span><span class="op" id="7897275">)</span>&nbsp;<span class="ident" id="7897277">net</span><span class="op" id="7897280">.</span><span class="ident" id="7897281">Addr</span>&nbsp;<span class="op" id="7897286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897289">return</span>&nbsp;<span class="ident" id="7897296">pipeAddr</span><span class="op" id="7897304">(</span><span class="num" id="7897305">0</span><span class="op" id="7897306">)</span><br>
<span class="lineno"></span><span class="op" id="7897308">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span><span class="keyword" id="7897311">func</span>&nbsp;<span class="op" id="7897316">(</span><span class="ident" id="7897317">p</span>&nbsp;<span class="op" id="7897319">*</span><span class="ident" id="7897320">pipe</span><span class="op" id="7897324">)</span>&nbsp;<span class="ident" id="7897326">SetTimeout</span><span class="op" id="7897336">(</span><span class="ident" id="7897337">nsec</span>&nbsp;<span class="ident" id="7897342">int64</span><span class="op" id="7897347">)</span>&nbsp;<span class="builtintype" id="7897349">error</span>&nbsp;<span class="op" id="7897355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897358">return</span>&nbsp;<span class="ident" id="7897365">errors</span><span class="op" id="7897371">.</span><span class="ident" id="7897372">New</span><span class="op" id="7897375">(</span><span class="string" id="7897376">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7897412">)</span><br>
<span class="lineno"></span><span class="op" id="7897414">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">290</span><span class="keyword" id="7897417">func</span>&nbsp;<span class="op" id="7897422">(</span><span class="ident" id="7897423">p</span>&nbsp;<span class="op" id="7897425">*</span><span class="ident" id="7897426">pipe</span><span class="op" id="7897430">)</span>&nbsp;<span class="ident" id="7897432">SetReadTimeout</span><span class="op" id="7897446">(</span><span class="ident" id="7897447">nsec</span>&nbsp;<span class="ident" id="7897452">int64</span><span class="op" id="7897457">)</span>&nbsp;<span class="builtintype" id="7897459">error</span>&nbsp;<span class="op" id="7897465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897468">return</span>&nbsp;<span class="ident" id="7897475">errors</span><span class="op" id="7897481">.</span><span class="ident" id="7897482">New</span><span class="op" id="7897485">(</span><span class="string" id="7897486">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7897522">)</span><br>
<span class="lineno"></span><span class="op" id="7897524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7897527">func</span>&nbsp;<span class="op" id="7897532">(</span><span class="ident" id="7897533">p</span>&nbsp;<span class="op" id="7897535">*</span><span class="ident" id="7897536">pipe</span><span class="op" id="7897540">)</span>&nbsp;<span class="ident" id="7897542">SetWriteTimeout</span><span class="op" id="7897557">(</span><span class="ident" id="7897558">nsec</span>&nbsp;<span class="ident" id="7897563">int64</span><span class="op" id="7897568">)</span>&nbsp;<span class="builtintype" id="7897570">error</span>&nbsp;<span class="op" id="7897576">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7897579">return</span>&nbsp;<span class="ident" id="7897586">errors</span><span class="op" id="7897592">.</span><span class="ident" id="7897593">New</span><span class="op" id="7897596">(</span><span class="string" id="7897597">&#34;net.Pipe&nbsp;does&nbsp;not&nbsp;support&nbsp;timeouts&#34;</span><span class="op" id="7897633">)</span><br>
<span class="lineno"></span><span class="op" id="7897635">}</span>
</div>
</body>
</html>
