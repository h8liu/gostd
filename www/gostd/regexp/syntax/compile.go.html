<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>regexp/syntax</h2>
<ul>
<li><a href="/gostd/regexp/syntax/compile.go.html" class="current">compile.go</a></li>
<li><a href="/gostd/regexp/syntax/doc.go.html">doc.go</a></li>
<li><a href="/gostd/regexp/syntax/parse.go.html">parse.go</a></li>
<li><a href="/gostd/regexp/syntax/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/regexp/syntax/perl_groups.go.html">perl_groups.go</a></li>
<li><a href="/gostd/regexp/syntax/prog.go.html">prog.go</a></li>
<li><a href="/gostd/regexp/syntax/prog_test.go.html">prog_test.go</a></li>
<li><a href="/gostd/regexp/syntax/regexp.go.html">regexp.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify.go.html">simplify.go</a></li>
<li><a href="/gostd/regexp/syntax/simplify_test.go.html">simplify_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3114274">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3114329">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3114383">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3114434">package</span>&nbsp;<span class="ident" id="3114442">syntax</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3114450">import</span>&nbsp;<span class="string" id="3114457">&#34;unicode&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3114468">//&nbsp;A&nbsp;patchList&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;instruction&nbsp;pointers&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;filled&nbsp;in&nbsp;(patched).</span><br>
<span class="lineno">10</span><span class="comment" id="3114554">//&nbsp;Because&nbsp;the&nbsp;pointers&nbsp;haven&#39;t&nbsp;been&nbsp;filled&nbsp;in&nbsp;yet,&nbsp;we&nbsp;can&nbsp;reuse&nbsp;their&nbsp;storage</span><br>
<span class="lineno"></span><span class="comment" id="3114633">//&nbsp;to&nbsp;hold&nbsp;the&nbsp;list.&nbsp;&nbsp;It&#39;s&nbsp;kind&nbsp;of&nbsp;sleazy,&nbsp;but&nbsp;works&nbsp;well&nbsp;in&nbsp;practice.</span><br>
<span class="lineno"></span><span class="comment" id="3114704">//&nbsp;See&nbsp;http://swtch.com/~rsc/regexp/regexp1.html&nbsp;for&nbsp;inspiration.</span><br>
<span class="lineno"></span><span class="comment" id="3114770">//</span><br>
<span class="lineno"></span><span class="comment" id="3114773">//&nbsp;These&nbsp;aren&#39;t&nbsp;really&nbsp;pointers:&nbsp;they&#39;re&nbsp;integers,&nbsp;so&nbsp;we&nbsp;can&nbsp;reinterpret&nbsp;them</span><br>
<span class="lineno">15</span><span class="comment" id="3114851">//&nbsp;this&nbsp;way&nbsp;without&nbsp;using&nbsp;package&nbsp;unsafe.&nbsp;&nbsp;A&nbsp;value&nbsp;l&nbsp;denotes</span><br>
<span class="lineno"></span><span class="comment" id="3114912">//&nbsp;p.inst[l&gt;&gt;1].Out&nbsp;(l&amp;1==0)&nbsp;or&nbsp;.Arg&nbsp;(l&amp;1==1).</span><br>
<span class="lineno"></span><span class="comment" id="3114959">//&nbsp;l&nbsp;==&nbsp;0&nbsp;denotes&nbsp;the&nbsp;empty&nbsp;list,&nbsp;okay&nbsp;because&nbsp;we&nbsp;start&nbsp;every&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="3115029">//&nbsp;with&nbsp;a&nbsp;fail&nbsp;instruction,&nbsp;so&nbsp;we&#39;ll&nbsp;never&nbsp;want&nbsp;to&nbsp;point&nbsp;at&nbsp;its&nbsp;output&nbsp;link.</span><br>
<span class="lineno"></span><span class="keyword" id="3115106">type</span>&nbsp;<span class="ident" id="3115111">patchList</span>&nbsp;<span class="builtintype" id="3115121">uint32</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3115129">func</span>&nbsp;<span class="op" id="3115134">(</span><span class="ident" id="3115135">l</span>&nbsp;<span class="ident" id="3115137">patchList</span><span class="op" id="3115146">)</span>&nbsp;<span class="ident" id="3115148">next</span><span class="op" id="3115152">(</span><span class="ident" id="3115153">p</span>&nbsp;<span class="op" id="3115155">*</span><span class="ident" id="3115156">Prog</span><span class="op" id="3115160">)</span>&nbsp;<span class="ident" id="3115162">patchList</span>&nbsp;<span class="op" id="3115172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115175">i</span>&nbsp;<span class="op" id="3115177">:=</span>&nbsp;<span class="op" id="3115180">&amp;</span><span class="ident" id="3115181">p</span><span class="op" id="3115182">.</span><span class="ident" id="3115183">Inst</span><span class="op" id="3115187">[</span><span class="ident" id="3115188">l</span><span class="op" id="3115189">&gt;&gt;</span><span class="num" id="3115191">1</span><span class="op" id="3115192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115195">if</span>&nbsp;<span class="ident" id="3115198">l</span><span class="op" id="3115199">&amp;</span><span class="num" id="3115200">1</span>&nbsp;<span class="op" id="3115202">==</span>&nbsp;<span class="num" id="3115205">0</span>&nbsp;<span class="op" id="3115207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115211">return</span>&nbsp;<span class="ident" id="3115218">patchList</span><span class="op" id="3115227">(</span><span class="ident" id="3115228">i</span><span class="op" id="3115229">.</span><span class="ident" id="3115230">Out</span><span class="op" id="3115233">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115239">return</span>&nbsp;<span class="ident" id="3115246">patchList</span><span class="op" id="3115255">(</span><span class="ident" id="3115256">i</span><span class="op" id="3115257">.</span><span class="ident" id="3115258">Arg</span><span class="op" id="3115261">)</span><br>
<span class="lineno"></span><span class="op" id="3115263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115266">func</span>&nbsp;<span class="op" id="3115271">(</span><span class="ident" id="3115272">l</span>&nbsp;<span class="ident" id="3115274">patchList</span><span class="op" id="3115283">)</span>&nbsp;<span class="ident" id="3115285">patch</span><span class="op" id="3115290">(</span><span class="ident" id="3115291">p</span>&nbsp;<span class="op" id="3115293">*</span><span class="ident" id="3115294">Prog</span><span class="op" id="3115298">,</span>&nbsp;<span class="ident" id="3115300">val</span>&nbsp;<span class="builtintype" id="3115304">uint32</span><span class="op" id="3115310">)</span>&nbsp;<span class="op" id="3115312">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115315">for</span>&nbsp;<span class="ident" id="3115319">l</span>&nbsp;<span class="op" id="3115321">!=</span>&nbsp;<span class="num" id="3115324">0</span>&nbsp;<span class="op" id="3115326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115330">i</span>&nbsp;<span class="op" id="3115332">:=</span>&nbsp;<span class="op" id="3115335">&amp;</span><span class="ident" id="3115336">p</span><span class="op" id="3115337">.</span><span class="ident" id="3115338">Inst</span><span class="op" id="3115342">[</span><span class="ident" id="3115343">l</span><span class="op" id="3115344">&gt;&gt;</span><span class="num" id="3115346">1</span><span class="op" id="3115347">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115351">if</span>&nbsp;<span class="ident" id="3115354">l</span><span class="op" id="3115355">&amp;</span><span class="num" id="3115356">1</span>&nbsp;<span class="op" id="3115358">==</span>&nbsp;<span class="num" id="3115361">0</span>&nbsp;<span class="op" id="3115363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115368">l</span>&nbsp;<span class="op" id="3115370">=</span>&nbsp;<span class="ident" id="3115372">patchList</span><span class="op" id="3115381">(</span><span class="ident" id="3115382">i</span><span class="op" id="3115383">.</span><span class="ident" id="3115384">Out</span><span class="op" id="3115387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115392">i</span><span class="op" id="3115393">.</span><span class="ident" id="3115394">Out</span>&nbsp;<span class="op" id="3115398">=</span>&nbsp;<span class="ident" id="3115400">val</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115406">}</span>&nbsp;<span class="keyword" id="3115408">else</span>&nbsp;<span class="op" id="3115413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115418">l</span>&nbsp;<span class="op" id="3115420">=</span>&nbsp;<span class="ident" id="3115422">patchList</span><span class="op" id="3115431">(</span><span class="ident" id="3115432">i</span><span class="op" id="3115433">.</span><span class="ident" id="3115434">Arg</span><span class="op" id="3115437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115442">i</span><span class="op" id="3115443">.</span><span class="ident" id="3115444">Arg</span>&nbsp;<span class="op" id="3115448">=</span>&nbsp;<span class="ident" id="3115450">val</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115459">}</span><br>
<span class="lineno">40</span><span class="op" id="3115461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115464">func</span>&nbsp;<span class="op" id="3115469">(</span><span class="ident" id="3115470">l1</span>&nbsp;<span class="ident" id="3115473">patchList</span><span class="op" id="3115482">)</span>&nbsp;<span class="builtinfunc" id="3115484">append</span><span class="op" id="3115490">(</span><span class="ident" id="3115491">p</span>&nbsp;<span class="op" id="3115493">*</span><span class="ident" id="3115494">Prog</span><span class="op" id="3115498">,</span>&nbsp;<span class="ident" id="3115500">l2</span>&nbsp;<span class="ident" id="3115503">patchList</span><span class="op" id="3115512">)</span>&nbsp;<span class="ident" id="3115514">patchList</span>&nbsp;<span class="op" id="3115524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115527">if</span>&nbsp;<span class="ident" id="3115530">l1</span>&nbsp;<span class="op" id="3115533">==</span>&nbsp;<span class="num" id="3115536">0</span>&nbsp;<span class="op" id="3115538">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115542">return</span>&nbsp;<span class="ident" id="3115549">l2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115556">if</span>&nbsp;<span class="ident" id="3115559">l2</span>&nbsp;<span class="op" id="3115562">==</span>&nbsp;<span class="num" id="3115565">0</span>&nbsp;<span class="op" id="3115567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115571">return</span>&nbsp;<span class="ident" id="3115578">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115582">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115586">last</span>&nbsp;<span class="op" id="3115591">:=</span>&nbsp;<span class="ident" id="3115594">l1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115598">for</span>&nbsp;<span class="op" id="3115602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115606">next</span>&nbsp;<span class="op" id="3115611">:=</span>&nbsp;<span class="ident" id="3115614">last</span><span class="op" id="3115618">.</span><span class="ident" id="3115619">next</span><span class="op" id="3115623">(</span><span class="ident" id="3115624">p</span><span class="op" id="3115625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115629">if</span>&nbsp;<span class="ident" id="3115632">next</span>&nbsp;<span class="op" id="3115637">==</span>&nbsp;<span class="num" id="3115640">0</span>&nbsp;<span class="op" id="3115642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115647">break</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115659">last</span>&nbsp;<span class="op" id="3115664">=</span>&nbsp;<span class="ident" id="3115666">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115676">i</span>&nbsp;<span class="op" id="3115678">:=</span>&nbsp;<span class="op" id="3115681">&amp;</span><span class="ident" id="3115682">p</span><span class="op" id="3115683">.</span><span class="ident" id="3115684">Inst</span><span class="op" id="3115688">[</span><span class="ident" id="3115689">last</span><span class="op" id="3115693">&gt;&gt;</span><span class="num" id="3115695">1</span><span class="op" id="3115696">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115699">if</span>&nbsp;<span class="ident" id="3115702">last</span><span class="op" id="3115706">&amp;</span><span class="num" id="3115707">1</span>&nbsp;<span class="op" id="3115709">==</span>&nbsp;<span class="num" id="3115712">0</span>&nbsp;<span class="op" id="3115714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115718">i</span><span class="op" id="3115719">.</span><span class="ident" id="3115720">Out</span>&nbsp;<span class="op" id="3115724">=</span>&nbsp;<span class="builtintype" id="3115726">uint32</span><span class="op" id="3115732">(</span><span class="ident" id="3115733">l2</span><span class="op" id="3115735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115738">}</span>&nbsp;<span class="keyword" id="3115740">else</span>&nbsp;<span class="op" id="3115745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115749">i</span><span class="op" id="3115750">.</span><span class="ident" id="3115751">Arg</span>&nbsp;<span class="op" id="3115755">=</span>&nbsp;<span class="builtintype" id="3115757">uint32</span><span class="op" id="3115763">(</span><span class="ident" id="3115764">l2</span><span class="op" id="3115766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3115769">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3115772">return</span>&nbsp;<span class="ident" id="3115779">l1</span><br>
<span class="lineno"></span><span class="op" id="3115782">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3115785">//&nbsp;A&nbsp;frag&nbsp;represents&nbsp;a&nbsp;compiled&nbsp;program&nbsp;fragment.</span><br>
<span class="lineno"></span><span class="keyword" id="3115835">type</span>&nbsp;<span class="ident" id="3115840">frag</span>&nbsp;<span class="keyword" id="3115845">struct</span>&nbsp;<span class="op" id="3115852">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115855">i</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3115859">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3115869">//&nbsp;index&nbsp;of&nbsp;first&nbsp;instruction</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115900">out</span>&nbsp;<span class="ident" id="3115904">patchList</span>&nbsp;<span class="comment" id="3115914">//&nbsp;where&nbsp;to&nbsp;record&nbsp;end&nbsp;instruction</span><br>
<span class="lineno"></span><span class="op" id="3115949">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3115952">type</span>&nbsp;<span class="ident" id="3115957">compiler</span>&nbsp;<span class="keyword" id="3115966">struct</span>&nbsp;<span class="op" id="3115973">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3115976">p</span>&nbsp;<span class="op" id="3115978">*</span><span class="ident" id="3115979">Prog</span><br>
<span class="lineno"></span><span class="op" id="3115984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3115987">//&nbsp;Compile&nbsp;compiles&nbsp;the&nbsp;regexp&nbsp;into&nbsp;a&nbsp;program&nbsp;to&nbsp;be&nbsp;executed.</span><br>
<span class="lineno"></span><span class="comment" id="3116049">//&nbsp;The&nbsp;regexp&nbsp;should&nbsp;have&nbsp;been&nbsp;simplified&nbsp;already&nbsp;(returned&nbsp;from&nbsp;re.Simplify).</span><br>
<span class="lineno">80</span><span class="keyword" id="3116128">func</span>&nbsp;<span class="ident" id="3116133">Compile</span><span class="op" id="3116140">(</span><span class="ident" id="3116141">re</span>&nbsp;<span class="op" id="3116144">*</span><span class="ident" id="3116145">Regexp</span><span class="op" id="3116151">)</span>&nbsp;<span class="op" id="3116153">(</span><span class="op" id="3116154">*</span><span class="ident" id="3116155">Prog</span><span class="op" id="3116159">,</span>&nbsp;<span class="builtintype" id="3116161">error</span><span class="op" id="3116166">)</span>&nbsp;<span class="op" id="3116168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116171">var</span>&nbsp;<span class="ident" id="3116175">c</span>&nbsp;<span class="ident" id="3116177">compiler</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116187">c</span><span class="op" id="3116188">.</span><span class="ident" id="3116189">init</span><span class="op" id="3116193">(</span><span class="op" id="3116194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116197">f</span>&nbsp;<span class="op" id="3116199">:=</span>&nbsp;<span class="ident" id="3116202">c</span><span class="op" id="3116203">.</span><span class="ident" id="3116204">compile</span><span class="op" id="3116211">(</span><span class="ident" id="3116212">re</span><span class="op" id="3116214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116217">f</span><span class="op" id="3116218">.</span><span class="ident" id="3116219">out</span><span class="op" id="3116222">.</span><span class="ident" id="3116223">patch</span><span class="op" id="3116228">(</span><span class="ident" id="3116229">c</span><span class="op" id="3116230">.</span><span class="ident" id="3116231">p</span><span class="op" id="3116232">,</span>&nbsp;<span class="ident" id="3116234">c</span><span class="op" id="3116235">.</span><span class="ident" id="3116236">inst</span><span class="op" id="3116240">(</span><span class="ident" id="3116241">InstMatch</span><span class="op" id="3116250">)</span><span class="op" id="3116251">.</span><span class="ident" id="3116252">i</span><span class="op" id="3116253">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116256">c</span><span class="op" id="3116257">.</span><span class="ident" id="3116258">p</span><span class="op" id="3116259">.</span><span class="ident" id="3116260">Start</span>&nbsp;<span class="op" id="3116266">=</span>&nbsp;<span class="builtintype" id="3116268">int</span><span class="op" id="3116271">(</span><span class="ident" id="3116272">f</span><span class="op" id="3116273">.</span><span class="ident" id="3116274">i</span><span class="op" id="3116275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116278">return</span>&nbsp;<span class="ident" id="3116285">c</span><span class="op" id="3116286">.</span><span class="ident" id="3116287">p</span><span class="op" id="3116288">,</span>&nbsp;<span class="ident" id="3116290">nil</span><br>
<span class="lineno"></span><span class="op" id="3116294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3116297">func</span>&nbsp;<span class="op" id="3116302">(</span><span class="ident" id="3116303">c</span>&nbsp;<span class="op" id="3116305">*</span><span class="ident" id="3116306">compiler</span><span class="op" id="3116314">)</span>&nbsp;<span class="ident" id="3116316">init</span><span class="op" id="3116320">(</span><span class="op" id="3116321">)</span>&nbsp;<span class="op" id="3116323">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116326">c</span><span class="op" id="3116327">.</span><span class="ident" id="3116328">p</span>&nbsp;<span class="op" id="3116330">=</span>&nbsp;<span class="builtinfunc" id="3116332">new</span><span class="op" id="3116335">(</span><span class="ident" id="3116336">Prog</span><span class="op" id="3116340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116343">c</span><span class="op" id="3116344">.</span><span class="ident" id="3116345">p</span><span class="op" id="3116346">.</span><span class="ident" id="3116347">NumCap</span>&nbsp;<span class="op" id="3116354">=</span>&nbsp;<span class="num" id="3116356">2</span>&nbsp;<span class="comment" id="3116358">//&nbsp;implicit&nbsp;(&nbsp;and&nbsp;)&nbsp;for&nbsp;whole&nbsp;match&nbsp;$0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116398">c</span><span class="op" id="3116399">.</span><span class="ident" id="3116400">inst</span><span class="op" id="3116404">(</span><span class="ident" id="3116405">InstFail</span><span class="op" id="3116413">)</span><br>
<span class="lineno"></span><span class="op" id="3116415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="3116418">var</span>&nbsp;<span class="ident" id="3116422">anyRuneNotNL</span>&nbsp;<span class="op" id="3116435">=</span>&nbsp;<span class="op" id="3116437">[</span><span class="op" id="3116438">]</span><span class="builtintype" id="3116439">rune</span><span class="op" id="3116443">{</span><span class="num" id="3116444">0</span><span class="op" id="3116445">,</span>&nbsp;<span class="string" id="3116447">&#39;\n&#39;</span>&nbsp;<span class="op" id="3116452">-</span>&nbsp;<span class="num" id="3116454">1</span><span class="op" id="3116455">,</span>&nbsp;<span class="string" id="3116457">&#39;\n&#39;</span>&nbsp;<span class="op" id="3116462">+</span>&nbsp;<span class="num" id="3116464">1</span><span class="op" id="3116465">,</span>&nbsp;<span class="ident" id="3116467">unicode</span><span class="op" id="3116474">.</span><span class="ident" id="3116475">MaxRune</span><span class="op" id="3116482">}</span><br>
<span class="lineno"></span><span class="keyword" id="3116484">var</span>&nbsp;<span class="ident" id="3116488">anyRune</span>&nbsp;<span class="op" id="3116496">=</span>&nbsp;<span class="op" id="3116498">[</span><span class="op" id="3116499">]</span><span class="builtintype" id="3116500">rune</span><span class="op" id="3116504">{</span><span class="num" id="3116505">0</span><span class="op" id="3116506">,</span>&nbsp;<span class="ident" id="3116508">unicode</span><span class="op" id="3116515">.</span><span class="ident" id="3116516">MaxRune</span><span class="op" id="3116523">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3116526">func</span>&nbsp;<span class="op" id="3116531">(</span><span class="ident" id="3116532">c</span>&nbsp;<span class="op" id="3116534">*</span><span class="ident" id="3116535">compiler</span><span class="op" id="3116543">)</span>&nbsp;<span class="ident" id="3116545">compile</span><span class="op" id="3116552">(</span><span class="ident" id="3116553">re</span>&nbsp;<span class="op" id="3116556">*</span><span class="ident" id="3116557">Regexp</span><span class="op" id="3116563">)</span>&nbsp;<span class="ident" id="3116565">frag</span>&nbsp;<span class="op" id="3116570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116573">switch</span>&nbsp;<span class="ident" id="3116580">re</span><span class="op" id="3116582">.</span><span class="ident" id="3116583">Op</span>&nbsp;<span class="op" id="3116586">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116589">case</span>&nbsp;<span class="ident" id="3116594">OpNoMatch</span><span class="op" id="3116603">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116607">return</span>&nbsp;<span class="ident" id="3116614">c</span><span class="op" id="3116615">.</span><span class="ident" id="3116616">fail</span><span class="op" id="3116620">(</span><span class="op" id="3116621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116624">case</span>&nbsp;<span class="ident" id="3116629">OpEmptyMatch</span><span class="op" id="3116641">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116645">return</span>&nbsp;<span class="ident" id="3116652">c</span><span class="op" id="3116653">.</span><span class="ident" id="3116654">nop</span><span class="op" id="3116657">(</span><span class="op" id="3116658">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116661">case</span>&nbsp;<span class="ident" id="3116666">OpLiteral</span><span class="op" id="3116675">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116679">if</span>&nbsp;<span class="builtinfunc" id="3116682">len</span><span class="op" id="3116685">(</span><span class="ident" id="3116686">re</span><span class="op" id="3116688">.</span><span class="ident" id="3116689">Rune</span><span class="op" id="3116693">)</span>&nbsp;<span class="op" id="3116695">==</span>&nbsp;<span class="num" id="3116698">0</span>&nbsp;<span class="op" id="3116700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116705">return</span>&nbsp;<span class="ident" id="3116712">c</span><span class="op" id="3116713">.</span><span class="ident" id="3116714">nop</span><span class="op" id="3116717">(</span><span class="op" id="3116718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3116722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116726">var</span>&nbsp;<span class="ident" id="3116730">f</span>&nbsp;<span class="ident" id="3116732">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116739">for</span>&nbsp;<span class="ident" id="3116743">j</span>&nbsp;<span class="op" id="3116745">:=</span>&nbsp;<span class="keyword" id="3116748">range</span>&nbsp;<span class="ident" id="3116754">re</span><span class="op" id="3116756">.</span><span class="ident" id="3116757">Rune</span>&nbsp;<span class="op" id="3116762">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116767">f1</span>&nbsp;<span class="op" id="3116770">:=</span>&nbsp;<span class="ident" id="3116773">c</span><span class="op" id="3116774">.</span><span class="builtintype" id="3116775">rune</span><span class="op" id="3116779">(</span><span class="ident" id="3116780">re</span><span class="op" id="3116782">.</span><span class="ident" id="3116783">Rune</span><span class="op" id="3116787">[</span><span class="ident" id="3116788">j</span><span class="op" id="3116789">:</span><span class="ident" id="3116790">j</span><span class="op" id="3116791">+</span><span class="num" id="3116792">1</span><span class="op" id="3116793">]</span><span class="op" id="3116794">,</span>&nbsp;<span class="ident" id="3116796">re</span><span class="op" id="3116798">.</span><span class="ident" id="3116799">Flags</span><span class="op" id="3116804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116809">if</span>&nbsp;<span class="ident" id="3116812">j</span>&nbsp;<span class="op" id="3116814">==</span>&nbsp;<span class="num" id="3116817">0</span>&nbsp;<span class="op" id="3116819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116825">f</span>&nbsp;<span class="op" id="3116827">=</span>&nbsp;<span class="ident" id="3116829">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3116835">}</span>&nbsp;<span class="keyword" id="3116837">else</span>&nbsp;<span class="op" id="3116842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3116848">f</span>&nbsp;<span class="op" id="3116850">=</span>&nbsp;<span class="ident" id="3116852">c</span><span class="op" id="3116853">.</span><span class="ident" id="3116854">cat</span><span class="op" id="3116857">(</span><span class="ident" id="3116858">f</span><span class="op" id="3116859">,</span>&nbsp;<span class="ident" id="3116861">f1</span><span class="op" id="3116863">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3116868">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3116872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116876">return</span>&nbsp;<span class="ident" id="3116883">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116886">case</span>&nbsp;<span class="ident" id="3116891">OpCharClass</span><span class="op" id="3116902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116906">return</span>&nbsp;<span class="ident" id="3116913">c</span><span class="op" id="3116914">.</span><span class="builtintype" id="3116915">rune</span><span class="op" id="3116919">(</span><span class="ident" id="3116920">re</span><span class="op" id="3116922">.</span><span class="ident" id="3116923">Rune</span><span class="op" id="3116927">,</span>&nbsp;<span class="ident" id="3116929">re</span><span class="op" id="3116931">.</span><span class="ident" id="3116932">Flags</span><span class="op" id="3116937">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116940">case</span>&nbsp;<span class="ident" id="3116945">OpAnyCharNotNL</span><span class="op" id="3116959">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116963">return</span>&nbsp;<span class="ident" id="3116970">c</span><span class="op" id="3116971">.</span><span class="builtintype" id="3116972">rune</span><span class="op" id="3116976">(</span><span class="ident" id="3116977">anyRuneNotNL</span><span class="op" id="3116989">,</span>&nbsp;<span class="num" id="3116991">0</span><span class="op" id="3116992">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3116995">case</span>&nbsp;<span class="ident" id="3117000">OpAnyChar</span><span class="op" id="3117009">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117013">return</span>&nbsp;<span class="ident" id="3117020">c</span><span class="op" id="3117021">.</span><span class="builtintype" id="3117022">rune</span><span class="op" id="3117026">(</span><span class="ident" id="3117027">anyRune</span><span class="op" id="3117034">,</span>&nbsp;<span class="num" id="3117036">0</span><span class="op" id="3117037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117040">case</span>&nbsp;<span class="ident" id="3117045">OpBeginLine</span><span class="op" id="3117056">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117060">return</span>&nbsp;<span class="ident" id="3117067">c</span><span class="op" id="3117068">.</span><span class="ident" id="3117069">empty</span><span class="op" id="3117074">(</span><span class="ident" id="3117075">EmptyBeginLine</span><span class="op" id="3117089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117092">case</span>&nbsp;<span class="ident" id="3117097">OpEndLine</span><span class="op" id="3117106">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117110">return</span>&nbsp;<span class="ident" id="3117117">c</span><span class="op" id="3117118">.</span><span class="ident" id="3117119">empty</span><span class="op" id="3117124">(</span><span class="ident" id="3117125">EmptyEndLine</span><span class="op" id="3117137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117140">case</span>&nbsp;<span class="ident" id="3117145">OpBeginText</span><span class="op" id="3117156">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117160">return</span>&nbsp;<span class="ident" id="3117167">c</span><span class="op" id="3117168">.</span><span class="ident" id="3117169">empty</span><span class="op" id="3117174">(</span><span class="ident" id="3117175">EmptyBeginText</span><span class="op" id="3117189">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117192">case</span>&nbsp;<span class="ident" id="3117197">OpEndText</span><span class="op" id="3117206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117210">return</span>&nbsp;<span class="ident" id="3117217">c</span><span class="op" id="3117218">.</span><span class="ident" id="3117219">empty</span><span class="op" id="3117224">(</span><span class="ident" id="3117225">EmptyEndText</span><span class="op" id="3117237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117240">case</span>&nbsp;<span class="ident" id="3117245">OpWordBoundary</span><span class="op" id="3117259">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117263">return</span>&nbsp;<span class="ident" id="3117270">c</span><span class="op" id="3117271">.</span><span class="ident" id="3117272">empty</span><span class="op" id="3117277">(</span><span class="ident" id="3117278">EmptyWordBoundary</span><span class="op" id="3117295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117298">case</span>&nbsp;<span class="ident" id="3117303">OpNoWordBoundary</span><span class="op" id="3117319">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117323">return</span>&nbsp;<span class="ident" id="3117330">c</span><span class="op" id="3117331">.</span><span class="ident" id="3117332">empty</span><span class="op" id="3117337">(</span><span class="ident" id="3117338">EmptyNoWordBoundary</span><span class="op" id="3117357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117360">case</span>&nbsp;<span class="ident" id="3117365">OpCapture</span><span class="op" id="3117374">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117378">bra</span>&nbsp;<span class="op" id="3117382">:=</span>&nbsp;<span class="ident" id="3117385">c</span><span class="op" id="3117386">.</span><span class="builtinfunc" id="3117387">cap</span><span class="op" id="3117390">(</span><span class="builtintype" id="3117391">uint32</span><span class="op" id="3117397">(</span><span class="ident" id="3117398">re</span><span class="op" id="3117400">.</span><span class="ident" id="3117401">Cap</span>&nbsp;<span class="op" id="3117405">&lt;&lt;</span>&nbsp;<span class="num" id="3117408">1</span><span class="op" id="3117409">)</span><span class="op" id="3117410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117414">sub</span>&nbsp;<span class="op" id="3117418">:=</span>&nbsp;<span class="ident" id="3117421">c</span><span class="op" id="3117422">.</span><span class="ident" id="3117423">compile</span><span class="op" id="3117430">(</span><span class="ident" id="3117431">re</span><span class="op" id="3117433">.</span><span class="ident" id="3117434">Sub</span><span class="op" id="3117437">[</span><span class="num" id="3117438">0</span><span class="op" id="3117439">]</span><span class="op" id="3117440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117444">ket</span>&nbsp;<span class="op" id="3117448">:=</span>&nbsp;<span class="ident" id="3117451">c</span><span class="op" id="3117452">.</span><span class="builtinfunc" id="3117453">cap</span><span class="op" id="3117456">(</span><span class="builtintype" id="3117457">uint32</span><span class="op" id="3117463">(</span><span class="ident" id="3117464">re</span><span class="op" id="3117466">.</span><span class="ident" id="3117467">Cap</span><span class="op" id="3117470">&lt;&lt;</span><span class="num" id="3117472">1</span>&nbsp;<span class="op" id="3117474">|</span>&nbsp;<span class="num" id="3117476">1</span><span class="op" id="3117477">)</span><span class="op" id="3117478">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117482">return</span>&nbsp;<span class="ident" id="3117489">c</span><span class="op" id="3117490">.</span><span class="ident" id="3117491">cat</span><span class="op" id="3117494">(</span><span class="ident" id="3117495">c</span><span class="op" id="3117496">.</span><span class="ident" id="3117497">cat</span><span class="op" id="3117500">(</span><span class="ident" id="3117501">bra</span><span class="op" id="3117504">,</span>&nbsp;<span class="ident" id="3117506">sub</span><span class="op" id="3117509">)</span><span class="op" id="3117510">,</span>&nbsp;<span class="ident" id="3117512">ket</span><span class="op" id="3117515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117518">case</span>&nbsp;<span class="ident" id="3117523">OpStar</span><span class="op" id="3117529">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117533">return</span>&nbsp;<span class="ident" id="3117540">c</span><span class="op" id="3117541">.</span><span class="ident" id="3117542">star</span><span class="op" id="3117546">(</span><span class="ident" id="3117547">c</span><span class="op" id="3117548">.</span><span class="ident" id="3117549">compile</span><span class="op" id="3117556">(</span><span class="ident" id="3117557">re</span><span class="op" id="3117559">.</span><span class="ident" id="3117560">Sub</span><span class="op" id="3117563">[</span><span class="num" id="3117564">0</span><span class="op" id="3117565">]</span><span class="op" id="3117566">)</span><span class="op" id="3117567">,</span>&nbsp;<span class="ident" id="3117569">re</span><span class="op" id="3117571">.</span><span class="ident" id="3117572">Flags</span><span class="op" id="3117577">&amp;</span><span class="ident" id="3117578">NonGreedy</span>&nbsp;<span class="op" id="3117588">!=</span>&nbsp;<span class="num" id="3117591">0</span><span class="op" id="3117592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117595">case</span>&nbsp;<span class="ident" id="3117600">OpPlus</span><span class="op" id="3117606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117610">return</span>&nbsp;<span class="ident" id="3117617">c</span><span class="op" id="3117618">.</span><span class="ident" id="3117619">plus</span><span class="op" id="3117623">(</span><span class="ident" id="3117624">c</span><span class="op" id="3117625">.</span><span class="ident" id="3117626">compile</span><span class="op" id="3117633">(</span><span class="ident" id="3117634">re</span><span class="op" id="3117636">.</span><span class="ident" id="3117637">Sub</span><span class="op" id="3117640">[</span><span class="num" id="3117641">0</span><span class="op" id="3117642">]</span><span class="op" id="3117643">)</span><span class="op" id="3117644">,</span>&nbsp;<span class="ident" id="3117646">re</span><span class="op" id="3117648">.</span><span class="ident" id="3117649">Flags</span><span class="op" id="3117654">&amp;</span><span class="ident" id="3117655">NonGreedy</span>&nbsp;<span class="op" id="3117665">!=</span>&nbsp;<span class="num" id="3117668">0</span><span class="op" id="3117669">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117672">case</span>&nbsp;<span class="ident" id="3117677">OpQuest</span><span class="op" id="3117684">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117688">return</span>&nbsp;<span class="ident" id="3117695">c</span><span class="op" id="3117696">.</span><span class="ident" id="3117697">quest</span><span class="op" id="3117702">(</span><span class="ident" id="3117703">c</span><span class="op" id="3117704">.</span><span class="ident" id="3117705">compile</span><span class="op" id="3117712">(</span><span class="ident" id="3117713">re</span><span class="op" id="3117715">.</span><span class="ident" id="3117716">Sub</span><span class="op" id="3117719">[</span><span class="num" id="3117720">0</span><span class="op" id="3117721">]</span><span class="op" id="3117722">)</span><span class="op" id="3117723">,</span>&nbsp;<span class="ident" id="3117725">re</span><span class="op" id="3117727">.</span><span class="ident" id="3117728">Flags</span><span class="op" id="3117733">&amp;</span><span class="ident" id="3117734">NonGreedy</span>&nbsp;<span class="op" id="3117744">!=</span>&nbsp;<span class="num" id="3117747">0</span><span class="op" id="3117748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117751">case</span>&nbsp;<span class="ident" id="3117756">OpConcat</span><span class="op" id="3117764">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117768">if</span>&nbsp;<span class="builtinfunc" id="3117771">len</span><span class="op" id="3117774">(</span><span class="ident" id="3117775">re</span><span class="op" id="3117777">.</span><span class="ident" id="3117778">Sub</span><span class="op" id="3117781">)</span>&nbsp;<span class="op" id="3117783">==</span>&nbsp;<span class="num" id="3117786">0</span>&nbsp;<span class="op" id="3117788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117793">return</span>&nbsp;<span class="ident" id="3117800">c</span><span class="op" id="3117801">.</span><span class="ident" id="3117802">nop</span><span class="op" id="3117805">(</span><span class="op" id="3117806">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117810">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117814">var</span>&nbsp;<span class="ident" id="3117818">f</span>&nbsp;<span class="ident" id="3117820">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117827">for</span>&nbsp;<span class="ident" id="3117831">i</span><span class="op" id="3117832">,</span>&nbsp;<span class="ident" id="3117834">sub</span>&nbsp;<span class="op" id="3117838">:=</span>&nbsp;<span class="keyword" id="3117841">range</span>&nbsp;<span class="ident" id="3117847">re</span><span class="op" id="3117849">.</span><span class="ident" id="3117850">Sub</span>&nbsp;<span class="op" id="3117854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117859">if</span>&nbsp;<span class="ident" id="3117862">i</span>&nbsp;<span class="op" id="3117864">==</span>&nbsp;<span class="num" id="3117867">0</span>&nbsp;<span class="op" id="3117869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117875">f</span>&nbsp;<span class="op" id="3117877">=</span>&nbsp;<span class="ident" id="3117879">c</span><span class="op" id="3117880">.</span><span class="ident" id="3117881">compile</span><span class="op" id="3117888">(</span><span class="ident" id="3117889">sub</span><span class="op" id="3117892">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117897">}</span>&nbsp;<span class="keyword" id="3117899">else</span>&nbsp;<span class="op" id="3117904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3117910">f</span>&nbsp;<span class="op" id="3117912">=</span>&nbsp;<span class="ident" id="3117914">c</span><span class="op" id="3117915">.</span><span class="ident" id="3117916">cat</span><span class="op" id="3117919">(</span><span class="ident" id="3117920">f</span><span class="op" id="3117921">,</span>&nbsp;<span class="ident" id="3117923">c</span><span class="op" id="3117924">.</span><span class="ident" id="3117925">compile</span><span class="op" id="3117932">(</span><span class="ident" id="3117933">sub</span><span class="op" id="3117936">)</span><span class="op" id="3117937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3117946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117950">return</span>&nbsp;<span class="ident" id="3117957">f</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117960">case</span>&nbsp;<span class="ident" id="3117965">OpAlternate</span><span class="op" id="3117976">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117980">var</span>&nbsp;<span class="ident" id="3117984">f</span>&nbsp;<span class="ident" id="3117986">frag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3117993">for</span>&nbsp;<span class="ident" id="3117997">_</span><span class="op" id="3117998">,</span>&nbsp;<span class="ident" id="3118000">sub</span>&nbsp;<span class="op" id="3118004">:=</span>&nbsp;<span class="keyword" id="3118007">range</span>&nbsp;<span class="ident" id="3118013">re</span><span class="op" id="3118015">.</span><span class="ident" id="3118016">Sub</span>&nbsp;<span class="op" id="3118020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118025">f</span>&nbsp;<span class="op" id="3118027">=</span>&nbsp;<span class="ident" id="3118029">c</span><span class="op" id="3118030">.</span><span class="ident" id="3118031">alt</span><span class="op" id="3118034">(</span><span class="ident" id="3118035">f</span><span class="op" id="3118036">,</span>&nbsp;<span class="ident" id="3118038">c</span><span class="op" id="3118039">.</span><span class="ident" id="3118040">compile</span><span class="op" id="3118047">(</span><span class="ident" id="3118048">sub</span><span class="op" id="3118051">)</span><span class="op" id="3118052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118056">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118060">return</span>&nbsp;<span class="ident" id="3118067">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3118073">panic</span><span class="op" id="3118078">(</span><span class="string" id="3118079">&#34;regexp:&nbsp;unhandled&nbsp;case&nbsp;in&nbsp;compile&#34;</span><span class="op" id="3118114">)</span><br>
<span class="lineno"></span><span class="op" id="3118116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3118119">func</span>&nbsp;<span class="op" id="3118124">(</span><span class="ident" id="3118125">c</span>&nbsp;<span class="op" id="3118127">*</span><span class="ident" id="3118128">compiler</span><span class="op" id="3118136">)</span>&nbsp;<span class="ident" id="3118138">inst</span><span class="op" id="3118142">(</span><span class="ident" id="3118143">op</span>&nbsp;<span class="ident" id="3118146">InstOp</span><span class="op" id="3118152">)</span>&nbsp;<span class="ident" id="3118154">frag</span>&nbsp;<span class="op" id="3118159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3118162">//&nbsp;TODO:&nbsp;impose&nbsp;length&nbsp;limit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118192">f</span>&nbsp;<span class="op" id="3118194">:=</span>&nbsp;<span class="ident" id="3118197">frag</span><span class="op" id="3118201">{</span><span class="ident" id="3118202">i</span><span class="op" id="3118203">:</span>&nbsp;<span class="builtintype" id="3118205">uint32</span><span class="op" id="3118211">(</span><span class="builtinfunc" id="3118212">len</span><span class="op" id="3118215">(</span><span class="ident" id="3118216">c</span><span class="op" id="3118217">.</span><span class="ident" id="3118218">p</span><span class="op" id="3118219">.</span><span class="ident" id="3118220">Inst</span><span class="op" id="3118224">)</span><span class="op" id="3118225">)</span><span class="op" id="3118226">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118229">c</span><span class="op" id="3118230">.</span><span class="ident" id="3118231">p</span><span class="op" id="3118232">.</span><span class="ident" id="3118233">Inst</span>&nbsp;<span class="op" id="3118238">=</span>&nbsp;<span class="builtinfunc" id="3118240">append</span><span class="op" id="3118246">(</span><span class="ident" id="3118247">c</span><span class="op" id="3118248">.</span><span class="ident" id="3118249">p</span><span class="op" id="3118250">.</span><span class="ident" id="3118251">Inst</span><span class="op" id="3118255">,</span>&nbsp;<span class="ident" id="3118257">Inst</span><span class="op" id="3118261">{</span><span class="ident" id="3118262">Op</span><span class="op" id="3118264">:</span>&nbsp;<span class="ident" id="3118266">op</span><span class="op" id="3118268">}</span><span class="op" id="3118269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118272">return</span>&nbsp;<span class="ident" id="3118279">f</span><br>
<span class="lineno">175</span><span class="op" id="3118281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118284">func</span>&nbsp;<span class="op" id="3118289">(</span><span class="ident" id="3118290">c</span>&nbsp;<span class="op" id="3118292">*</span><span class="ident" id="3118293">compiler</span><span class="op" id="3118301">)</span>&nbsp;<span class="ident" id="3118303">nop</span><span class="op" id="3118306">(</span><span class="op" id="3118307">)</span>&nbsp;<span class="ident" id="3118309">frag</span>&nbsp;<span class="op" id="3118314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118317">f</span>&nbsp;<span class="op" id="3118319">:=</span>&nbsp;<span class="ident" id="3118322">c</span><span class="op" id="3118323">.</span><span class="ident" id="3118324">inst</span><span class="op" id="3118328">(</span><span class="ident" id="3118329">InstNop</span><span class="op" id="3118336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118339">f</span><span class="op" id="3118340">.</span><span class="ident" id="3118341">out</span>&nbsp;<span class="op" id="3118345">=</span>&nbsp;<span class="ident" id="3118347">patchList</span><span class="op" id="3118356">(</span><span class="ident" id="3118357">f</span><span class="op" id="3118358">.</span><span class="ident" id="3118359">i</span>&nbsp;<span class="op" id="3118361">&lt;&lt;</span>&nbsp;<span class="num" id="3118364">1</span><span class="op" id="3118365">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118368">return</span>&nbsp;<span class="ident" id="3118375">f</span><br>
<span class="lineno"></span><span class="op" id="3118377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118380">func</span>&nbsp;<span class="op" id="3118385">(</span><span class="ident" id="3118386">c</span>&nbsp;<span class="op" id="3118388">*</span><span class="ident" id="3118389">compiler</span><span class="op" id="3118397">)</span>&nbsp;<span class="ident" id="3118399">fail</span><span class="op" id="3118403">(</span><span class="op" id="3118404">)</span>&nbsp;<span class="ident" id="3118406">frag</span>&nbsp;<span class="op" id="3118411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118414">return</span>&nbsp;<span class="ident" id="3118421">frag</span><span class="op" id="3118425">{</span><span class="op" id="3118426">}</span><br>
<span class="lineno">185</span><span class="op" id="3118428">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118431">func</span>&nbsp;<span class="op" id="3118436">(</span><span class="ident" id="3118437">c</span>&nbsp;<span class="op" id="3118439">*</span><span class="ident" id="3118440">compiler</span><span class="op" id="3118448">)</span>&nbsp;<span class="builtinfunc" id="3118450">cap</span><span class="op" id="3118453">(</span><span class="ident" id="3118454">arg</span>&nbsp;<span class="builtintype" id="3118458">uint32</span><span class="op" id="3118464">)</span>&nbsp;<span class="ident" id="3118466">frag</span>&nbsp;<span class="op" id="3118471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118474">f</span>&nbsp;<span class="op" id="3118476">:=</span>&nbsp;<span class="ident" id="3118479">c</span><span class="op" id="3118480">.</span><span class="ident" id="3118481">inst</span><span class="op" id="3118485">(</span><span class="ident" id="3118486">InstCapture</span><span class="op" id="3118497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118500">f</span><span class="op" id="3118501">.</span><span class="ident" id="3118502">out</span>&nbsp;<span class="op" id="3118506">=</span>&nbsp;<span class="ident" id="3118508">patchList</span><span class="op" id="3118517">(</span><span class="ident" id="3118518">f</span><span class="op" id="3118519">.</span><span class="ident" id="3118520">i</span>&nbsp;<span class="op" id="3118522">&lt;&lt;</span>&nbsp;<span class="num" id="3118525">1</span><span class="op" id="3118526">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118529">c</span><span class="op" id="3118530">.</span><span class="ident" id="3118531">p</span><span class="op" id="3118532">.</span><span class="ident" id="3118533">Inst</span><span class="op" id="3118537">[</span><span class="ident" id="3118538">f</span><span class="op" id="3118539">.</span><span class="ident" id="3118540">i</span><span class="op" id="3118541">]</span><span class="op" id="3118542">.</span><span class="ident" id="3118543">Arg</span>&nbsp;<span class="op" id="3118547">=</span>&nbsp;<span class="ident" id="3118549">arg</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118555">if</span>&nbsp;<span class="ident" id="3118558">c</span><span class="op" id="3118559">.</span><span class="ident" id="3118560">p</span><span class="op" id="3118561">.</span><span class="ident" id="3118562">NumCap</span>&nbsp;<span class="op" id="3118569">&lt;</span>&nbsp;<span class="builtintype" id="3118571">int</span><span class="op" id="3118574">(</span><span class="ident" id="3118575">arg</span><span class="op" id="3118578">)</span><span class="op" id="3118579">+</span><span class="num" id="3118580">1</span>&nbsp;<span class="op" id="3118582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118586">c</span><span class="op" id="3118587">.</span><span class="ident" id="3118588">p</span><span class="op" id="3118589">.</span><span class="ident" id="3118590">NumCap</span>&nbsp;<span class="op" id="3118597">=</span>&nbsp;<span class="builtintype" id="3118599">int</span><span class="op" id="3118602">(</span><span class="ident" id="3118603">arg</span><span class="op" id="3118606">)</span>&nbsp;<span class="op" id="3118608">+</span>&nbsp;<span class="num" id="3118610">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118613">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118616">return</span>&nbsp;<span class="ident" id="3118623">f</span><br>
<span class="lineno"></span><span class="op" id="3118625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3118628">func</span>&nbsp;<span class="op" id="3118633">(</span><span class="ident" id="3118634">c</span>&nbsp;<span class="op" id="3118636">*</span><span class="ident" id="3118637">compiler</span><span class="op" id="3118645">)</span>&nbsp;<span class="ident" id="3118647">cat</span><span class="op" id="3118650">(</span><span class="ident" id="3118651">f1</span><span class="op" id="3118653">,</span>&nbsp;<span class="ident" id="3118655">f2</span>&nbsp;<span class="ident" id="3118658">frag</span><span class="op" id="3118662">)</span>&nbsp;<span class="ident" id="3118664">frag</span>&nbsp;<span class="op" id="3118669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3118672">//&nbsp;concat&nbsp;of&nbsp;failure&nbsp;is&nbsp;failure</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118705">if</span>&nbsp;<span class="ident" id="3118708">f1</span><span class="op" id="3118710">.</span><span class="ident" id="3118711">i</span>&nbsp;<span class="op" id="3118713">==</span>&nbsp;<span class="num" id="3118716">0</span>&nbsp;<span class="op" id="3118718">||</span>&nbsp;<span class="ident" id="3118721">f2</span><span class="op" id="3118723">.</span><span class="ident" id="3118724">i</span>&nbsp;<span class="op" id="3118726">==</span>&nbsp;<span class="num" id="3118729">0</span>&nbsp;<span class="op" id="3118731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118735">return</span>&nbsp;<span class="ident" id="3118742">frag</span><span class="op" id="3118746">{</span><span class="op" id="3118747">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3118754">//&nbsp;TODO:&nbsp;elide&nbsp;nop</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118775">f1</span><span class="op" id="3118777">.</span><span class="ident" id="3118778">out</span><span class="op" id="3118781">.</span><span class="ident" id="3118782">patch</span><span class="op" id="3118787">(</span><span class="ident" id="3118788">c</span><span class="op" id="3118789">.</span><span class="ident" id="3118790">p</span><span class="op" id="3118791">,</span>&nbsp;<span class="ident" id="3118793">f2</span><span class="op" id="3118795">.</span><span class="ident" id="3118796">i</span><span class="op" id="3118797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118800">return</span>&nbsp;<span class="ident" id="3118807">frag</span><span class="op" id="3118811">{</span><span class="ident" id="3118812">f1</span><span class="op" id="3118814">.</span><span class="ident" id="3118815">i</span><span class="op" id="3118816">,</span>&nbsp;<span class="ident" id="3118818">f2</span><span class="op" id="3118820">.</span><span class="ident" id="3118821">out</span><span class="op" id="3118824">}</span><br>
<span class="lineno"></span><span class="op" id="3118826">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="3118829">func</span>&nbsp;<span class="op" id="3118834">(</span><span class="ident" id="3118835">c</span>&nbsp;<span class="op" id="3118837">*</span><span class="ident" id="3118838">compiler</span><span class="op" id="3118846">)</span>&nbsp;<span class="ident" id="3118848">alt</span><span class="op" id="3118851">(</span><span class="ident" id="3118852">f1</span><span class="op" id="3118854">,</span>&nbsp;<span class="ident" id="3118856">f2</span>&nbsp;<span class="ident" id="3118859">frag</span><span class="op" id="3118863">)</span>&nbsp;<span class="ident" id="3118865">frag</span>&nbsp;<span class="op" id="3118870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3118873">//&nbsp;alt&nbsp;of&nbsp;failure&nbsp;is&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118901">if</span>&nbsp;<span class="ident" id="3118904">f1</span><span class="op" id="3118906">.</span><span class="ident" id="3118907">i</span>&nbsp;<span class="op" id="3118909">==</span>&nbsp;<span class="num" id="3118912">0</span>&nbsp;<span class="op" id="3118914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118918">return</span>&nbsp;<span class="ident" id="3118925">f2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118929">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118932">if</span>&nbsp;<span class="ident" id="3118935">f2</span><span class="op" id="3118937">.</span><span class="ident" id="3118938">i</span>&nbsp;<span class="op" id="3118940">==</span>&nbsp;<span class="num" id="3118943">0</span>&nbsp;<span class="op" id="3118945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3118949">return</span>&nbsp;<span class="ident" id="3118956">f1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3118960">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118964">f</span>&nbsp;<span class="op" id="3118966">:=</span>&nbsp;<span class="ident" id="3118969">c</span><span class="op" id="3118970">.</span><span class="ident" id="3118971">inst</span><span class="op" id="3118975">(</span><span class="ident" id="3118976">InstAlt</span><span class="op" id="3118983">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3118986">i</span>&nbsp;<span class="op" id="3118988">:=</span>&nbsp;<span class="op" id="3118991">&amp;</span><span class="ident" id="3118992">c</span><span class="op" id="3118993">.</span><span class="ident" id="3118994">p</span><span class="op" id="3118995">.</span><span class="ident" id="3118996">Inst</span><span class="op" id="3119000">[</span><span class="ident" id="3119001">f</span><span class="op" id="3119002">.</span><span class="ident" id="3119003">i</span><span class="op" id="3119004">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119007">i</span><span class="op" id="3119008">.</span><span class="ident" id="3119009">Out</span>&nbsp;<span class="op" id="3119013">=</span>&nbsp;<span class="ident" id="3119015">f1</span><span class="op" id="3119017">.</span><span class="ident" id="3119018">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119021">i</span><span class="op" id="3119022">.</span><span class="ident" id="3119023">Arg</span>&nbsp;<span class="op" id="3119027">=</span>&nbsp;<span class="ident" id="3119029">f2</span><span class="op" id="3119031">.</span><span class="ident" id="3119032">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119035">f</span><span class="op" id="3119036">.</span><span class="ident" id="3119037">out</span>&nbsp;<span class="op" id="3119041">=</span>&nbsp;<span class="ident" id="3119043">f1</span><span class="op" id="3119045">.</span><span class="ident" id="3119046">out</span><span class="op" id="3119049">.</span><span class="builtinfunc" id="3119050">append</span><span class="op" id="3119056">(</span><span class="ident" id="3119057">c</span><span class="op" id="3119058">.</span><span class="ident" id="3119059">p</span><span class="op" id="3119060">,</span>&nbsp;<span class="ident" id="3119062">f2</span><span class="op" id="3119064">.</span><span class="ident" id="3119065">out</span><span class="op" id="3119068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119071">return</span>&nbsp;<span class="ident" id="3119078">f</span><br>
<span class="lineno">225</span><span class="op" id="3119080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3119083">func</span>&nbsp;<span class="op" id="3119088">(</span><span class="ident" id="3119089">c</span>&nbsp;<span class="op" id="3119091">*</span><span class="ident" id="3119092">compiler</span><span class="op" id="3119100">)</span>&nbsp;<span class="ident" id="3119102">quest</span><span class="op" id="3119107">(</span><span class="ident" id="3119108">f1</span>&nbsp;<span class="ident" id="3119111">frag</span><span class="op" id="3119115">,</span>&nbsp;<span class="ident" id="3119117">nongreedy</span>&nbsp;<span class="builtintype" id="3119127">bool</span><span class="op" id="3119131">)</span>&nbsp;<span class="ident" id="3119133">frag</span>&nbsp;<span class="op" id="3119138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119141">f</span>&nbsp;<span class="op" id="3119143">:=</span>&nbsp;<span class="ident" id="3119146">c</span><span class="op" id="3119147">.</span><span class="ident" id="3119148">inst</span><span class="op" id="3119152">(</span><span class="ident" id="3119153">InstAlt</span><span class="op" id="3119160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119163">i</span>&nbsp;<span class="op" id="3119165">:=</span>&nbsp;<span class="op" id="3119168">&amp;</span><span class="ident" id="3119169">c</span><span class="op" id="3119170">.</span><span class="ident" id="3119171">p</span><span class="op" id="3119172">.</span><span class="ident" id="3119173">Inst</span><span class="op" id="3119177">[</span><span class="ident" id="3119178">f</span><span class="op" id="3119179">.</span><span class="ident" id="3119180">i</span><span class="op" id="3119181">]</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119184">if</span>&nbsp;<span class="ident" id="3119187">nongreedy</span>&nbsp;<span class="op" id="3119197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119201">i</span><span class="op" id="3119202">.</span><span class="ident" id="3119203">Arg</span>&nbsp;<span class="op" id="3119207">=</span>&nbsp;<span class="ident" id="3119209">f1</span><span class="op" id="3119211">.</span><span class="ident" id="3119212">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119216">f</span><span class="op" id="3119217">.</span><span class="ident" id="3119218">out</span>&nbsp;<span class="op" id="3119222">=</span>&nbsp;<span class="ident" id="3119224">patchList</span><span class="op" id="3119233">(</span><span class="ident" id="3119234">f</span><span class="op" id="3119235">.</span><span class="ident" id="3119236">i</span>&nbsp;<span class="op" id="3119238">&lt;&lt;</span>&nbsp;<span class="num" id="3119241">1</span><span class="op" id="3119242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119245">}</span>&nbsp;<span class="keyword" id="3119247">else</span>&nbsp;<span class="op" id="3119252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119256">i</span><span class="op" id="3119257">.</span><span class="ident" id="3119258">Out</span>&nbsp;<span class="op" id="3119262">=</span>&nbsp;<span class="ident" id="3119264">f1</span><span class="op" id="3119266">.</span><span class="ident" id="3119267">i</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119271">f</span><span class="op" id="3119272">.</span><span class="ident" id="3119273">out</span>&nbsp;<span class="op" id="3119277">=</span>&nbsp;<span class="ident" id="3119279">patchList</span><span class="op" id="3119288">(</span><span class="ident" id="3119289">f</span><span class="op" id="3119290">.</span><span class="ident" id="3119291">i</span><span class="op" id="3119292">&lt;&lt;</span><span class="num" id="3119294">1</span>&nbsp;<span class="op" id="3119296">|</span>&nbsp;<span class="num" id="3119298">1</span><span class="op" id="3119299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119305">f</span><span class="op" id="3119306">.</span><span class="ident" id="3119307">out</span>&nbsp;<span class="op" id="3119311">=</span>&nbsp;<span class="ident" id="3119313">f</span><span class="op" id="3119314">.</span><span class="ident" id="3119315">out</span><span class="op" id="3119318">.</span><span class="builtinfunc" id="3119319">append</span><span class="op" id="3119325">(</span><span class="ident" id="3119326">c</span><span class="op" id="3119327">.</span><span class="ident" id="3119328">p</span><span class="op" id="3119329">,</span>&nbsp;<span class="ident" id="3119331">f1</span><span class="op" id="3119333">.</span><span class="ident" id="3119334">out</span><span class="op" id="3119337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119340">return</span>&nbsp;<span class="ident" id="3119347">f</span><br>
<span class="lineno"></span><span class="op" id="3119349">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="3119352">func</span>&nbsp;<span class="op" id="3119357">(</span><span class="ident" id="3119358">c</span>&nbsp;<span class="op" id="3119360">*</span><span class="ident" id="3119361">compiler</span><span class="op" id="3119369">)</span>&nbsp;<span class="ident" id="3119371">star</span><span class="op" id="3119375">(</span><span class="ident" id="3119376">f1</span>&nbsp;<span class="ident" id="3119379">frag</span><span class="op" id="3119383">,</span>&nbsp;<span class="ident" id="3119385">nongreedy</span>&nbsp;<span class="builtintype" id="3119395">bool</span><span class="op" id="3119399">)</span>&nbsp;<span class="ident" id="3119401">frag</span>&nbsp;<span class="op" id="3119406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119409">f</span>&nbsp;<span class="op" id="3119411">:=</span>&nbsp;<span class="ident" id="3119414">c</span><span class="op" id="3119415">.</span><span class="ident" id="3119416">inst</span><span class="op" id="3119420">(</span><span class="ident" id="3119421">InstAlt</span><span class="op" id="3119428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119431">i</span>&nbsp;<span class="op" id="3119433">:=</span>&nbsp;<span class="op" id="3119436">&amp;</span><span class="ident" id="3119437">c</span><span class="op" id="3119438">.</span><span class="ident" id="3119439">p</span><span class="op" id="3119440">.</span><span class="ident" id="3119441">Inst</span><span class="op" id="3119445">[</span><span class="ident" id="3119446">f</span><span class="op" id="3119447">.</span><span class="ident" id="3119448">i</span><span class="op" id="3119449">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119452">if</span>&nbsp;<span class="ident" id="3119455">nongreedy</span>&nbsp;<span class="op" id="3119465">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119469">i</span><span class="op" id="3119470">.</span><span class="ident" id="3119471">Arg</span>&nbsp;<span class="op" id="3119475">=</span>&nbsp;<span class="ident" id="3119477">f1</span><span class="op" id="3119479">.</span><span class="ident" id="3119480">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119484">f</span><span class="op" id="3119485">.</span><span class="ident" id="3119486">out</span>&nbsp;<span class="op" id="3119490">=</span>&nbsp;<span class="ident" id="3119492">patchList</span><span class="op" id="3119501">(</span><span class="ident" id="3119502">f</span><span class="op" id="3119503">.</span><span class="ident" id="3119504">i</span>&nbsp;<span class="op" id="3119506">&lt;&lt;</span>&nbsp;<span class="num" id="3119509">1</span><span class="op" id="3119510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119513">}</span>&nbsp;<span class="keyword" id="3119515">else</span>&nbsp;<span class="op" id="3119520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119524">i</span><span class="op" id="3119525">.</span><span class="ident" id="3119526">Out</span>&nbsp;<span class="op" id="3119530">=</span>&nbsp;<span class="ident" id="3119532">f1</span><span class="op" id="3119534">.</span><span class="ident" id="3119535">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119539">f</span><span class="op" id="3119540">.</span><span class="ident" id="3119541">out</span>&nbsp;<span class="op" id="3119545">=</span>&nbsp;<span class="ident" id="3119547">patchList</span><span class="op" id="3119556">(</span><span class="ident" id="3119557">f</span><span class="op" id="3119558">.</span><span class="ident" id="3119559">i</span><span class="op" id="3119560">&lt;&lt;</span><span class="num" id="3119562">1</span>&nbsp;<span class="op" id="3119564">|</span>&nbsp;<span class="num" id="3119566">1</span><span class="op" id="3119567">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3119570">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119573">f1</span><span class="op" id="3119575">.</span><span class="ident" id="3119576">out</span><span class="op" id="3119579">.</span><span class="ident" id="3119580">patch</span><span class="op" id="3119585">(</span><span class="ident" id="3119586">c</span><span class="op" id="3119587">.</span><span class="ident" id="3119588">p</span><span class="op" id="3119589">,</span>&nbsp;<span class="ident" id="3119591">f</span><span class="op" id="3119592">.</span><span class="ident" id="3119593">i</span><span class="op" id="3119594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119597">return</span>&nbsp;<span class="ident" id="3119604">f</span><br>
<span class="lineno"></span><span class="op" id="3119606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="keyword" id="3119609">func</span>&nbsp;<span class="op" id="3119614">(</span><span class="ident" id="3119615">c</span>&nbsp;<span class="op" id="3119617">*</span><span class="ident" id="3119618">compiler</span><span class="op" id="3119626">)</span>&nbsp;<span class="ident" id="3119628">plus</span><span class="op" id="3119632">(</span><span class="ident" id="3119633">f1</span>&nbsp;<span class="ident" id="3119636">frag</span><span class="op" id="3119640">,</span>&nbsp;<span class="ident" id="3119642">nongreedy</span>&nbsp;<span class="builtintype" id="3119652">bool</span><span class="op" id="3119656">)</span>&nbsp;<span class="ident" id="3119658">frag</span>&nbsp;<span class="op" id="3119663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119666">return</span>&nbsp;<span class="ident" id="3119673">frag</span><span class="op" id="3119677">{</span><span class="ident" id="3119678">f1</span><span class="op" id="3119680">.</span><span class="ident" id="3119681">i</span><span class="op" id="3119682">,</span>&nbsp;<span class="ident" id="3119684">c</span><span class="op" id="3119685">.</span><span class="ident" id="3119686">star</span><span class="op" id="3119690">(</span><span class="ident" id="3119691">f1</span><span class="op" id="3119693">,</span>&nbsp;<span class="ident" id="3119695">nongreedy</span><span class="op" id="3119704">)</span><span class="op" id="3119705">.</span><span class="ident" id="3119706">out</span><span class="op" id="3119709">}</span><br>
<span class="lineno"></span><span class="op" id="3119711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3119714">func</span>&nbsp;<span class="op" id="3119719">(</span><span class="ident" id="3119720">c</span>&nbsp;<span class="op" id="3119722">*</span><span class="ident" id="3119723">compiler</span><span class="op" id="3119731">)</span>&nbsp;<span class="ident" id="3119733">empty</span><span class="op" id="3119738">(</span><span class="ident" id="3119739">op</span>&nbsp;<span class="ident" id="3119742">EmptyOp</span><span class="op" id="3119749">)</span>&nbsp;<span class="ident" id="3119751">frag</span>&nbsp;<span class="op" id="3119756">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119759">f</span>&nbsp;<span class="op" id="3119761">:=</span>&nbsp;<span class="ident" id="3119764">c</span><span class="op" id="3119765">.</span><span class="ident" id="3119766">inst</span><span class="op" id="3119770">(</span><span class="ident" id="3119771">InstEmptyWidth</span><span class="op" id="3119785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119788">c</span><span class="op" id="3119789">.</span><span class="ident" id="3119790">p</span><span class="op" id="3119791">.</span><span class="ident" id="3119792">Inst</span><span class="op" id="3119796">[</span><span class="ident" id="3119797">f</span><span class="op" id="3119798">.</span><span class="ident" id="3119799">i</span><span class="op" id="3119800">]</span><span class="op" id="3119801">.</span><span class="ident" id="3119802">Arg</span>&nbsp;<span class="op" id="3119806">=</span>&nbsp;<span class="builtintype" id="3119808">uint32</span><span class="op" id="3119814">(</span><span class="ident" id="3119815">op</span><span class="op" id="3119817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119820">f</span><span class="op" id="3119821">.</span><span class="ident" id="3119822">out</span>&nbsp;<span class="op" id="3119826">=</span>&nbsp;<span class="ident" id="3119828">patchList</span><span class="op" id="3119837">(</span><span class="ident" id="3119838">f</span><span class="op" id="3119839">.</span><span class="ident" id="3119840">i</span>&nbsp;<span class="op" id="3119842">&lt;&lt;</span>&nbsp;<span class="num" id="3119845">1</span><span class="op" id="3119846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3119849">return</span>&nbsp;<span class="ident" id="3119856">f</span><br>
<span class="lineno"></span><span class="op" id="3119858">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="3119861">func</span>&nbsp;<span class="op" id="3119866">(</span><span class="ident" id="3119867">c</span>&nbsp;<span class="op" id="3119869">*</span><span class="ident" id="3119870">compiler</span><span class="op" id="3119878">)</span>&nbsp;<span class="builtintype" id="3119880">rune</span><span class="op" id="3119884">(</span><span class="ident" id="3119885">r</span>&nbsp;<span class="op" id="3119887">[</span><span class="op" id="3119888">]</span><span class="builtintype" id="3119889">rune</span><span class="op" id="3119893">,</span>&nbsp;<span class="ident" id="3119895">flags</span>&nbsp;<span class="ident" id="3119901">Flags</span><span class="op" id="3119906">)</span>&nbsp;<span class="ident" id="3119908">frag</span>&nbsp;<span class="op" id="3119913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119916">f</span>&nbsp;<span class="op" id="3119918">:=</span>&nbsp;<span class="ident" id="3119921">c</span><span class="op" id="3119922">.</span><span class="ident" id="3119923">inst</span><span class="op" id="3119927">(</span><span class="ident" id="3119928">InstRune</span><span class="op" id="3119936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119939">i</span>&nbsp;<span class="op" id="3119941">:=</span>&nbsp;<span class="op" id="3119944">&amp;</span><span class="ident" id="3119945">c</span><span class="op" id="3119946">.</span><span class="ident" id="3119947">p</span><span class="op" id="3119948">.</span><span class="ident" id="3119949">Inst</span><span class="op" id="3119953">[</span><span class="ident" id="3119954">f</span><span class="op" id="3119955">.</span><span class="ident" id="3119956">i</span><span class="op" id="3119957">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119960">i</span><span class="op" id="3119961">.</span><span class="ident" id="3119962">Rune</span>&nbsp;<span class="op" id="3119967">=</span>&nbsp;<span class="ident" id="3119969">r</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3119972">flags</span>&nbsp;<span class="op" id="3119978">&amp;=</span>&nbsp;<span class="ident" id="3119981">FoldCase</span>&nbsp;<span class="comment" id="3119990">//&nbsp;only&nbsp;relevant&nbsp;flag&nbsp;is&nbsp;FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120025">if</span>&nbsp;<span class="builtinfunc" id="3120028">len</span><span class="op" id="3120031">(</span><span class="ident" id="3120032">r</span><span class="op" id="3120033">)</span>&nbsp;<span class="op" id="3120035">!=</span>&nbsp;<span class="num" id="3120038">1</span>&nbsp;<span class="op" id="3120040">||</span>&nbsp;<span class="ident" id="3120043">unicode</span><span class="op" id="3120050">.</span><span class="ident" id="3120051">SimpleFold</span><span class="op" id="3120061">(</span><span class="ident" id="3120062">r</span><span class="op" id="3120063">[</span><span class="num" id="3120064">0</span><span class="op" id="3120065">]</span><span class="op" id="3120066">)</span>&nbsp;<span class="op" id="3120068">==</span>&nbsp;<span class="ident" id="3120071">r</span><span class="op" id="3120072">[</span><span class="num" id="3120073">0</span><span class="op" id="3120074">]</span>&nbsp;<span class="op" id="3120076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120080">//&nbsp;and&nbsp;sometimes&nbsp;not&nbsp;even&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120113">flags</span>&nbsp;<span class="op" id="3120119">&amp;^=</span>&nbsp;<span class="ident" id="3120123">FoldCase</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120133">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120136">i</span><span class="op" id="3120137">.</span><span class="ident" id="3120138">Arg</span>&nbsp;<span class="op" id="3120142">=</span>&nbsp;<span class="builtintype" id="3120144">uint32</span><span class="op" id="3120150">(</span><span class="ident" id="3120151">flags</span><span class="op" id="3120156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120159">f</span><span class="op" id="3120160">.</span><span class="ident" id="3120161">out</span>&nbsp;<span class="op" id="3120165">=</span>&nbsp;<span class="ident" id="3120167">patchList</span><span class="op" id="3120176">(</span><span class="ident" id="3120177">f</span><span class="op" id="3120178">.</span><span class="ident" id="3120179">i</span>&nbsp;<span class="op" id="3120181">&lt;&lt;</span>&nbsp;<span class="num" id="3120184">1</span><span class="op" id="3120185">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3120189">//&nbsp;Special&nbsp;cases&nbsp;for&nbsp;exec&nbsp;machine.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120225">switch</span>&nbsp;<span class="op" id="3120232">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120235">case</span>&nbsp;<span class="ident" id="3120240">flags</span><span class="op" id="3120245">&amp;</span><span class="ident" id="3120246">FoldCase</span>&nbsp;<span class="op" id="3120255">==</span>&nbsp;<span class="num" id="3120258">0</span>&nbsp;<span class="op" id="3120260">&amp;&amp;</span>&nbsp;<span class="op" id="3120263">(</span><span class="builtinfunc" id="3120264">len</span><span class="op" id="3120267">(</span><span class="ident" id="3120268">r</span><span class="op" id="3120269">)</span>&nbsp;<span class="op" id="3120271">==</span>&nbsp;<span class="num" id="3120274">1</span>&nbsp;<span class="op" id="3120276">||</span>&nbsp;<span class="builtinfunc" id="3120279">len</span><span class="op" id="3120282">(</span><span class="ident" id="3120283">r</span><span class="op" id="3120284">)</span>&nbsp;<span class="op" id="3120286">==</span>&nbsp;<span class="num" id="3120289">2</span>&nbsp;<span class="op" id="3120291">&amp;&amp;</span>&nbsp;<span class="ident" id="3120294">r</span><span class="op" id="3120295">[</span><span class="num" id="3120296">0</span><span class="op" id="3120297">]</span>&nbsp;<span class="op" id="3120299">==</span>&nbsp;<span class="ident" id="3120302">r</span><span class="op" id="3120303">[</span><span class="num" id="3120304">1</span><span class="op" id="3120305">]</span><span class="op" id="3120306">)</span><span class="op" id="3120307">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120311">i</span><span class="op" id="3120312">.</span><span class="ident" id="3120313">Op</span>&nbsp;<span class="op" id="3120316">=</span>&nbsp;<span class="ident" id="3120318">InstRune1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120329">case</span>&nbsp;<span class="builtinfunc" id="3120334">len</span><span class="op" id="3120337">(</span><span class="ident" id="3120338">r</span><span class="op" id="3120339">)</span>&nbsp;<span class="op" id="3120341">==</span>&nbsp;<span class="num" id="3120344">2</span>&nbsp;<span class="op" id="3120346">&amp;&amp;</span>&nbsp;<span class="ident" id="3120349">r</span><span class="op" id="3120350">[</span><span class="num" id="3120351">0</span><span class="op" id="3120352">]</span>&nbsp;<span class="op" id="3120354">==</span>&nbsp;<span class="num" id="3120357">0</span>&nbsp;<span class="op" id="3120359">&amp;&amp;</span>&nbsp;<span class="ident" id="3120362">r</span><span class="op" id="3120363">[</span><span class="num" id="3120364">1</span><span class="op" id="3120365">]</span>&nbsp;<span class="op" id="3120367">==</span>&nbsp;<span class="ident" id="3120370">unicode</span><span class="op" id="3120377">.</span><span class="ident" id="3120378">MaxRune</span><span class="op" id="3120385">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120389">i</span><span class="op" id="3120390">.</span><span class="ident" id="3120391">Op</span>&nbsp;<span class="op" id="3120394">=</span>&nbsp;<span class="ident" id="3120396">InstRuneAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120409">case</span>&nbsp;<span class="builtinfunc" id="3120414">len</span><span class="op" id="3120417">(</span><span class="ident" id="3120418">r</span><span class="op" id="3120419">)</span>&nbsp;<span class="op" id="3120421">==</span>&nbsp;<span class="num" id="3120424">4</span>&nbsp;<span class="op" id="3120426">&amp;&amp;</span>&nbsp;<span class="ident" id="3120429">r</span><span class="op" id="3120430">[</span><span class="num" id="3120431">0</span><span class="op" id="3120432">]</span>&nbsp;<span class="op" id="3120434">==</span>&nbsp;<span class="num" id="3120437">0</span>&nbsp;<span class="op" id="3120439">&amp;&amp;</span>&nbsp;<span class="ident" id="3120442">r</span><span class="op" id="3120443">[</span><span class="num" id="3120444">1</span><span class="op" id="3120445">]</span>&nbsp;<span class="op" id="3120447">==</span>&nbsp;<span class="string" id="3120450">&#39;\n&#39;</span><span class="op" id="3120454">-</span><span class="num" id="3120455">1</span>&nbsp;<span class="op" id="3120457">&amp;&amp;</span>&nbsp;<span class="ident" id="3120460">r</span><span class="op" id="3120461">[</span><span class="num" id="3120462">2</span><span class="op" id="3120463">]</span>&nbsp;<span class="op" id="3120465">==</span>&nbsp;<span class="string" id="3120468">&#39;\n&#39;</span><span class="op" id="3120472">+</span><span class="num" id="3120473">1</span>&nbsp;<span class="op" id="3120475">&amp;&amp;</span>&nbsp;<span class="ident" id="3120478">r</span><span class="op" id="3120479">[</span><span class="num" id="3120480">3</span><span class="op" id="3120481">]</span>&nbsp;<span class="op" id="3120483">==</span>&nbsp;<span class="ident" id="3120486">unicode</span><span class="op" id="3120493">.</span><span class="ident" id="3120494">MaxRune</span><span class="op" id="3120501">:</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3120505">i</span><span class="op" id="3120506">.</span><span class="ident" id="3120507">Op</span>&nbsp;<span class="op" id="3120510">=</span>&nbsp;<span class="ident" id="3120512">InstRuneAnyNotNL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3120530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3120534">return</span>&nbsp;<span class="ident" id="3120541">f</span><br>
<span class="lineno"></span><span class="op" id="3120543">}</span>
</div>
</body>
</html>
