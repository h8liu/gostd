<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/internal</h2>
<ul>
<li><a href="/gostd/net/http/internal/chunked.go.html">chunked.go</a></li>
<li><a href="/gostd/net/http/internal/chunked_test.go.html" class="current">chunked_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8057323">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8057378">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8057432">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8057483">package</span>&nbsp;<span class="ident" id="8057491">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8057501">import</span>&nbsp;<span class="op" id="8057508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057511">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057520">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057529">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057536">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057542">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057555">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8057566">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8057576">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8057579">func</span>&nbsp;<span class="ident" id="8057584">TestChunk</span><span class="op" id="8057593">(</span><span class="ident" id="8057594">t</span>&nbsp;<span class="op" id="8057596">*</span><span class="ident" id="8057597">testing</span><span class="op" id="8057604">.</span><span class="ident" id="8057605">T</span><span class="op" id="8057606">)</span>&nbsp;<span class="op" id="8057608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8057611">var</span>&nbsp;<span class="ident" id="8057615">b</span>&nbsp;<span class="ident" id="8057617">bytes</span><span class="op" id="8057622">.</span><span class="ident" id="8057623">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057632">w</span>&nbsp;<span class="op" id="8057634">:=</span>&nbsp;<span class="ident" id="8057637">NewChunkedWriter</span><span class="op" id="8057653">(</span><span class="op" id="8057654">&amp;</span><span class="ident" id="8057655">b</span><span class="op" id="8057656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8057659">const</span>&nbsp;<span class="ident" id="8057665">chunk1</span>&nbsp;<span class="op" id="8057672">=</span>&nbsp;<span class="string" id="8057674">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8057685">const</span>&nbsp;<span class="ident" id="8057691">chunk2</span>&nbsp;<span class="op" id="8057698">=</span>&nbsp;<span class="string" id="8057700">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057727">w</span><span class="op" id="8057728">.</span><span class="ident" id="8057729">Write</span><span class="op" id="8057734">(</span><span class="op" id="8057735">[</span><span class="op" id="8057736">]</span><span class="builtintype" id="8057737">byte</span><span class="op" id="8057741">(</span><span class="ident" id="8057742">chunk1</span><span class="op" id="8057748">)</span><span class="op" id="8057749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057752">w</span><span class="op" id="8057753">.</span><span class="ident" id="8057754">Write</span><span class="op" id="8057759">(</span><span class="op" id="8057760">[</span><span class="op" id="8057761">]</span><span class="builtintype" id="8057762">byte</span><span class="op" id="8057766">(</span><span class="ident" id="8057767">chunk2</span><span class="op" id="8057773">)</span><span class="op" id="8057774">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057777">w</span><span class="op" id="8057778">.</span><span class="ident" id="8057779">Close</span><span class="op" id="8057784">(</span><span class="op" id="8057785">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8057789">if</span>&nbsp;<span class="ident" id="8057792">g</span><span class="op" id="8057793">,</span>&nbsp;<span class="ident" id="8057795">e</span>&nbsp;<span class="op" id="8057797">:=</span>&nbsp;<span class="ident" id="8057800">b</span><span class="op" id="8057801">.</span><span class="ident" id="8057802">String</span><span class="op" id="8057808">(</span><span class="op" id="8057809">)</span><span class="op" id="8057810">,</span>&nbsp;<span class="string" id="8057812">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="8057868">;</span>&nbsp;<span class="ident" id="8057870">g</span>&nbsp;<span class="op" id="8057872">!=</span>&nbsp;<span class="ident" id="8057875">e</span>&nbsp;<span class="op" id="8057877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057881">t</span><span class="op" id="8057882">.</span><span class="ident" id="8057883">Fatalf</span><span class="op" id="8057889">(</span><span class="string" id="8057890">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8057922">,</span>&nbsp;<span class="ident" id="8057924">g</span><span class="op" id="8057925">,</span>&nbsp;<span class="ident" id="8057927">e</span><span class="op" id="8057928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8057931">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057935">r</span>&nbsp;<span class="op" id="8057937">:=</span>&nbsp;<span class="ident" id="8057940">NewChunkedReader</span><span class="op" id="8057956">(</span><span class="op" id="8057957">&amp;</span><span class="ident" id="8057958">b</span><span class="op" id="8057959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8057962">data</span><span class="op" id="8057966">,</span>&nbsp;<span class="ident" id="8057968">err</span>&nbsp;<span class="op" id="8057972">:=</span>&nbsp;<span class="ident" id="8057975">ioutil</span><span class="op" id="8057981">.</span><span class="ident" id="8057982">ReadAll</span><span class="op" id="8057989">(</span><span class="ident" id="8057990">r</span><span class="op" id="8057991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8057994">if</span>&nbsp;<span class="ident" id="8057997">err</span>&nbsp;<span class="op" id="8058001">!=</span>&nbsp;<span class="builtintype" id="8058004">nil</span>&nbsp;<span class="op" id="8058008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058012">t</span><span class="op" id="8058013">.</span><span class="ident" id="8058014">Logf</span><span class="op" id="8058018">(</span><span class="string" id="8058019">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="8058031">,</span>&nbsp;<span class="ident" id="8058033">data</span><span class="op" id="8058037">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058041">t</span><span class="op" id="8058042">.</span><span class="ident" id="8058043">Fatalf</span><span class="op" id="8058049">(</span><span class="string" id="8058050">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="8058075">,</span>&nbsp;<span class="ident" id="8058077">err</span><span class="op" id="8058080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8058086">if</span>&nbsp;<span class="ident" id="8058089">g</span><span class="op" id="8058090">,</span>&nbsp;<span class="ident" id="8058092">e</span>&nbsp;<span class="op" id="8058094">:=</span>&nbsp;<span class="builtintype" id="8058097">string</span><span class="op" id="8058103">(</span><span class="ident" id="8058104">data</span><span class="op" id="8058108">)</span><span class="op" id="8058109">,</span>&nbsp;<span class="ident" id="8058111">chunk1</span><span class="op" id="8058117">+</span><span class="ident" id="8058118">chunk2</span><span class="op" id="8058124">;</span>&nbsp;<span class="ident" id="8058126">g</span>&nbsp;<span class="op" id="8058128">!=</span>&nbsp;<span class="ident" id="8058131">e</span>&nbsp;<span class="op" id="8058133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058137">t</span><span class="op" id="8058138">.</span><span class="ident" id="8058139">Errorf</span><span class="op" id="8058145">(</span><span class="string" id="8058146">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8058177">,</span>&nbsp;<span class="ident" id="8058179">g</span><span class="op" id="8058180">,</span>&nbsp;<span class="ident" id="8058182">e</span><span class="op" id="8058183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058186">}</span><br>
<span class="lineno">40</span><span class="op" id="8058188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8058191">func</span>&nbsp;<span class="ident" id="8058196">TestChunkReadMultiple</span><span class="op" id="8058217">(</span><span class="ident" id="8058218">t</span>&nbsp;<span class="op" id="8058220">*</span><span class="ident" id="8058221">testing</span><span class="op" id="8058228">.</span><span class="ident" id="8058229">T</span><span class="op" id="8058230">)</span>&nbsp;<span class="op" id="8058232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058235">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058281">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8058285">var</span>&nbsp;<span class="ident" id="8058289">b</span>&nbsp;<span class="ident" id="8058291">bytes</span><span class="op" id="8058296">.</span><span class="ident" id="8058297">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058306">w</span>&nbsp;<span class="op" id="8058308">:=</span>&nbsp;<span class="ident" id="8058311">NewChunkedWriter</span><span class="op" id="8058327">(</span><span class="op" id="8058328">&amp;</span><span class="ident" id="8058329">b</span><span class="op" id="8058330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058334">w</span><span class="op" id="8058335">.</span><span class="ident" id="8058336">Write</span><span class="op" id="8058341">(</span><span class="op" id="8058342">[</span><span class="op" id="8058343">]</span><span class="builtintype" id="8058344">byte</span><span class="op" id="8058348">(</span><span class="string" id="8058349">&#34;foo&#34;</span><span class="op" id="8058354">)</span><span class="op" id="8058355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058359">w</span><span class="op" id="8058360">.</span><span class="ident" id="8058361">Write</span><span class="op" id="8058366">(</span><span class="op" id="8058367">[</span><span class="op" id="8058368">]</span><span class="builtintype" id="8058369">byte</span><span class="op" id="8058373">(</span><span class="string" id="8058374">&#34;bar&#34;</span><span class="op" id="8058379">)</span><span class="op" id="8058380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058384">w</span><span class="op" id="8058385">.</span><span class="ident" id="8058386">Close</span><span class="op" id="8058391">(</span><span class="op" id="8058392">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058397">r</span>&nbsp;<span class="op" id="8058399">:=</span>&nbsp;<span class="ident" id="8058402">NewChunkedReader</span><span class="op" id="8058418">(</span><span class="op" id="8058419">&amp;</span><span class="ident" id="8058420">b</span><span class="op" id="8058421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058425">buf</span>&nbsp;<span class="op" id="8058429">:=</span>&nbsp;<span class="builtinfunc" id="8058432">make</span><span class="op" id="8058436">(</span><span class="op" id="8058437">[</span><span class="op" id="8058438">]</span><span class="builtintype" id="8058439">byte</span><span class="op" id="8058443">,</span>&nbsp;<span class="num" id="8058445">10</span><span class="op" id="8058447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058451">n</span><span class="op" id="8058452">,</span>&nbsp;<span class="ident" id="8058454">err</span>&nbsp;<span class="op" id="8058458">:=</span>&nbsp;<span class="ident" id="8058461">r</span><span class="op" id="8058462">.</span><span class="ident" id="8058463">Read</span><span class="op" id="8058467">(</span><span class="ident" id="8058468">buf</span><span class="op" id="8058471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8058475">if</span>&nbsp;<span class="ident" id="8058478">n</span>&nbsp;<span class="op" id="8058480">!=</span>&nbsp;<span class="num" id="8058483">6</span>&nbsp;<span class="op" id="8058485">||</span>&nbsp;<span class="ident" id="8058488">err</span>&nbsp;<span class="op" id="8058492">!=</span>&nbsp;<span class="ident" id="8058495">io</span><span class="op" id="8058497">.</span><span class="ident" id="8058498">EOF</span>&nbsp;<span class="op" id="8058502">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058507">t</span><span class="op" id="8058508">.</span><span class="ident" id="8058509">Errorf</span><span class="op" id="8058515">(</span><span class="string" id="8058516">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="8058544">,</span>&nbsp;<span class="ident" id="8058546">n</span><span class="op" id="8058547">,</span>&nbsp;<span class="ident" id="8058549">err</span><span class="op" id="8058552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058560">buf</span>&nbsp;<span class="op" id="8058564">=</span>&nbsp;<span class="ident" id="8058566">buf</span><span class="op" id="8058569">[</span><span class="op" id="8058570">:</span><span class="ident" id="8058571">n</span><span class="op" id="8058572">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8058576">if</span>&nbsp;<span class="builtintype" id="8058579">string</span><span class="op" id="8058585">(</span><span class="ident" id="8058586">buf</span><span class="op" id="8058589">)</span>&nbsp;<span class="op" id="8058591">!=</span>&nbsp;<span class="string" id="8058594">&#34;foobar&#34;</span>&nbsp;<span class="op" id="8058603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058608">t</span><span class="op" id="8058609">.</span><span class="ident" id="8058610">Errorf</span><span class="op" id="8058616">(</span><span class="string" id="8058617">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8058637">,</span>&nbsp;<span class="ident" id="8058639">buf</span><span class="op" id="8058642">,</span>&nbsp;<span class="string" id="8058644">&#34;foobar&#34;</span><span class="op" id="8058652">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058663">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058741">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8058801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8058805">var</span>&nbsp;<span class="ident" id="8058809">b</span>&nbsp;<span class="ident" id="8058811">bytes</span><span class="op" id="8058816">.</span><span class="ident" id="8058817">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8058826">w</span>&nbsp;<span class="op" id="8058828">:=</span>&nbsp;<span class="ident" id="8058831">NewChunkedWriter</span><span class="op" id="8058847">(</span><span class="op" id="8058848">&amp;</span><span class="ident" id="8058849">b</span><span class="op" id="8058850">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058854">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058930">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8058997">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8059072">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059135">const</span>&nbsp;<span class="ident" id="8059141">fillBufChunk</span>&nbsp;<span class="op" id="8059154">=</span>&nbsp;<span class="string" id="8059156">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059172">const</span>&nbsp;<span class="ident" id="8059178">shortChunk</span>&nbsp;<span class="op" id="8059189">=</span>&nbsp;<span class="string" id="8059191">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059199">w</span><span class="op" id="8059200">.</span><span class="ident" id="8059201">Write</span><span class="op" id="8059206">(</span><span class="op" id="8059207">[</span><span class="op" id="8059208">]</span><span class="builtintype" id="8059209">byte</span><span class="op" id="8059213">(</span><span class="ident" id="8059214">fillBufChunk</span><span class="op" id="8059226">)</span><span class="op" id="8059227">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059231">w</span><span class="op" id="8059232">.</span><span class="ident" id="8059233">Write</span><span class="op" id="8059238">(</span><span class="op" id="8059239">[</span><span class="op" id="8059240">]</span><span class="builtintype" id="8059241">byte</span><span class="op" id="8059245">(</span><span class="ident" id="8059246">shortChunk</span><span class="op" id="8059256">)</span><span class="op" id="8059257">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059261">w</span><span class="op" id="8059262">.</span><span class="ident" id="8059263">Close</span><span class="op" id="8059268">(</span><span class="op" id="8059269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059274">r</span>&nbsp;<span class="op" id="8059276">:=</span>&nbsp;<span class="ident" id="8059279">NewChunkedReader</span><span class="op" id="8059295">(</span><span class="ident" id="8059296">bufio</span><span class="op" id="8059301">.</span><span class="ident" id="8059302">NewReaderSize</span><span class="op" id="8059315">(</span><span class="op" id="8059316">&amp;</span><span class="ident" id="8059317">b</span><span class="op" id="8059318">,</span>&nbsp;<span class="num" id="8059320">16</span><span class="op" id="8059322">)</span><span class="op" id="8059323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059327">buf</span>&nbsp;<span class="op" id="8059331">:=</span>&nbsp;<span class="builtinfunc" id="8059334">make</span><span class="op" id="8059338">(</span><span class="op" id="8059339">[</span><span class="op" id="8059340">]</span><span class="builtintype" id="8059341">byte</span><span class="op" id="8059345">,</span>&nbsp;<span class="builtinfunc" id="8059347">len</span><span class="op" id="8059350">(</span><span class="ident" id="8059351">fillBufChunk</span><span class="op" id="8059363">)</span><span class="op" id="8059364">+</span><span class="builtinfunc" id="8059365">len</span><span class="op" id="8059368">(</span><span class="ident" id="8059369">shortChunk</span><span class="op" id="8059379">)</span><span class="op" id="8059380">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059384">n</span><span class="op" id="8059385">,</span>&nbsp;<span class="ident" id="8059387">err</span>&nbsp;<span class="op" id="8059391">:=</span>&nbsp;<span class="ident" id="8059394">r</span><span class="op" id="8059395">.</span><span class="ident" id="8059396">Read</span><span class="op" id="8059400">(</span><span class="ident" id="8059401">buf</span><span class="op" id="8059404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059408">if</span>&nbsp;<span class="ident" id="8059411">n</span>&nbsp;<span class="op" id="8059413">!=</span>&nbsp;<span class="builtinfunc" id="8059416">len</span><span class="op" id="8059419">(</span><span class="ident" id="8059420">fillBufChunk</span><span class="op" id="8059432">)</span>&nbsp;<span class="op" id="8059434">||</span>&nbsp;<span class="ident" id="8059437">err</span>&nbsp;<span class="op" id="8059441">!=</span>&nbsp;<span class="builtintype" id="8059444">nil</span>&nbsp;<span class="op" id="8059448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059453">t</span><span class="op" id="8059454">.</span><span class="ident" id="8059455">Errorf</span><span class="op" id="8059461">(</span><span class="string" id="8059462">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="8059491">,</span>&nbsp;<span class="ident" id="8059493">n</span><span class="op" id="8059494">,</span>&nbsp;<span class="ident" id="8059496">err</span><span class="op" id="8059499">,</span>&nbsp;<span class="builtinfunc" id="8059501">len</span><span class="op" id="8059504">(</span><span class="ident" id="8059505">fillBufChunk</span><span class="op" id="8059517">)</span><span class="op" id="8059518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8059522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059526">buf</span>&nbsp;<span class="op" id="8059530">=</span>&nbsp;<span class="ident" id="8059532">buf</span><span class="op" id="8059535">[</span><span class="op" id="8059536">:</span><span class="ident" id="8059537">n</span><span class="op" id="8059538">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059542">if</span>&nbsp;<span class="builtintype" id="8059545">string</span><span class="op" id="8059551">(</span><span class="ident" id="8059552">buf</span><span class="op" id="8059555">)</span>&nbsp;<span class="op" id="8059557">!=</span>&nbsp;<span class="ident" id="8059560">fillBufChunk</span>&nbsp;<span class="op" id="8059573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059578">t</span><span class="op" id="8059579">.</span><span class="ident" id="8059580">Errorf</span><span class="op" id="8059586">(</span><span class="string" id="8059587">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8059607">,</span>&nbsp;<span class="ident" id="8059609">buf</span><span class="op" id="8059612">,</span>&nbsp;<span class="ident" id="8059614">fillBufChunk</span><span class="op" id="8059626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8059630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059635">n</span><span class="op" id="8059636">,</span>&nbsp;<span class="ident" id="8059638">err</span>&nbsp;<span class="op" id="8059642">=</span>&nbsp;<span class="ident" id="8059644">r</span><span class="op" id="8059645">.</span><span class="ident" id="8059646">Read</span><span class="op" id="8059650">(</span><span class="ident" id="8059651">buf</span><span class="op" id="8059654">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059658">if</span>&nbsp;<span class="ident" id="8059661">n</span>&nbsp;<span class="op" id="8059663">!=</span>&nbsp;<span class="builtinfunc" id="8059666">len</span><span class="op" id="8059669">(</span><span class="ident" id="8059670">shortChunk</span><span class="op" id="8059680">)</span>&nbsp;<span class="op" id="8059682">||</span>&nbsp;<span class="ident" id="8059685">err</span>&nbsp;<span class="op" id="8059689">!=</span>&nbsp;<span class="ident" id="8059692">io</span><span class="op" id="8059694">.</span><span class="ident" id="8059695">EOF</span>&nbsp;<span class="op" id="8059699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059704">t</span><span class="op" id="8059705">.</span><span class="ident" id="8059706">Errorf</span><span class="op" id="8059712">(</span><span class="string" id="8059713">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="8059742">,</span>&nbsp;<span class="ident" id="8059744">n</span><span class="op" id="8059745">,</span>&nbsp;<span class="ident" id="8059747">err</span><span class="op" id="8059750">,</span>&nbsp;<span class="builtinfunc" id="8059752">len</span><span class="op" id="8059755">(</span><span class="ident" id="8059756">shortChunk</span><span class="op" id="8059766">)</span><span class="op" id="8059767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8059771">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8059774">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8059778">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8059857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059861">r</span>&nbsp;<span class="op" id="8059863">:=</span>&nbsp;<span class="ident" id="8059866">NewChunkedReader</span><span class="op" id="8059882">(</span><span class="ident" id="8059883">bufio</span><span class="op" id="8059888">.</span><span class="ident" id="8059889">NewReader</span><span class="op" id="8059898">(</span><span class="ident" id="8059899">strings</span><span class="op" id="8059906">.</span><span class="ident" id="8059907">NewReader</span><span class="op" id="8059916">(</span><span class="string" id="8059917">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="8059936">)</span><span class="op" id="8059937">)</span><span class="op" id="8059938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059942">buf</span>&nbsp;<span class="op" id="8059946">:=</span>&nbsp;<span class="builtinfunc" id="8059949">make</span><span class="op" id="8059953">(</span><span class="op" id="8059954">[</span><span class="op" id="8059955">]</span><span class="builtintype" id="8059956">byte</span><span class="op" id="8059960">,</span>&nbsp;<span class="num" id="8059962">3</span><span class="op" id="8059963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8059967">n</span><span class="op" id="8059968">,</span>&nbsp;<span class="ident" id="8059970">err</span>&nbsp;<span class="op" id="8059974">:=</span>&nbsp;<span class="ident" id="8059977">r</span><span class="op" id="8059978">.</span><span class="ident" id="8059979">Read</span><span class="op" id="8059983">(</span><span class="ident" id="8059984">buf</span><span class="op" id="8059987">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8059991">if</span>&nbsp;<span class="ident" id="8059994">n</span>&nbsp;<span class="op" id="8059996">!=</span>&nbsp;<span class="num" id="8059999">3</span>&nbsp;<span class="op" id="8060001">||</span>&nbsp;<span class="ident" id="8060004">err</span>&nbsp;<span class="op" id="8060008">!=</span>&nbsp;<span class="ident" id="8060011">io</span><span class="op" id="8060013">.</span><span class="ident" id="8060014">EOF</span>&nbsp;<span class="op" id="8060018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060023">t</span><span class="op" id="8060024">.</span><span class="ident" id="8060025">Errorf</span><span class="op" id="8060031">(</span><span class="string" id="8060032">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="8060060">,</span>&nbsp;<span class="ident" id="8060062">n</span><span class="op" id="8060063">,</span>&nbsp;<span class="ident" id="8060065">err</span><span class="op" id="8060068">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060076">if</span>&nbsp;<span class="builtintype" id="8060079">string</span><span class="op" id="8060085">(</span><span class="ident" id="8060086">buf</span><span class="op" id="8060089">)</span>&nbsp;<span class="op" id="8060091">!=</span>&nbsp;<span class="string" id="8060094">&#34;foo&#34;</span>&nbsp;<span class="op" id="8060100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060105">t</span><span class="op" id="8060106">.</span><span class="ident" id="8060107">Errorf</span><span class="op" id="8060113">(</span><span class="string" id="8060114">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="8060134">,</span>&nbsp;<span class="ident" id="8060136">buf</span><span class="op" id="8060139">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060146">}</span><br>
<span class="lineno"></span><span class="op" id="8060148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8060151">func</span>&nbsp;<span class="ident" id="8060156">TestChunkReaderAllocs</span><span class="op" id="8060177">(</span><span class="ident" id="8060178">t</span>&nbsp;<span class="op" id="8060180">*</span><span class="ident" id="8060181">testing</span><span class="op" id="8060188">.</span><span class="ident" id="8060189">T</span><span class="op" id="8060190">)</span>&nbsp;<span class="op" id="8060192">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060195">if</span>&nbsp;<span class="ident" id="8060198">testing</span><span class="op" id="8060205">.</span><span class="ident" id="8060206">Short</span><span class="op" id="8060211">(</span><span class="op" id="8060212">)</span>&nbsp;<span class="op" id="8060214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060218">t</span><span class="op" id="8060219">.</span><span class="ident" id="8060220">Skip</span><span class="op" id="8060224">(</span><span class="string" id="8060225">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="8060249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060252">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060255">var</span>&nbsp;<span class="ident" id="8060259">buf</span>&nbsp;<span class="ident" id="8060263">bytes</span><span class="op" id="8060268">.</span><span class="ident" id="8060269">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060277">w</span>&nbsp;<span class="op" id="8060279">:=</span>&nbsp;<span class="ident" id="8060282">NewChunkedWriter</span><span class="op" id="8060298">(</span><span class="op" id="8060299">&amp;</span><span class="ident" id="8060300">buf</span><span class="op" id="8060303">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060306">a</span><span class="op" id="8060307">,</span>&nbsp;<span class="ident" id="8060309">b</span><span class="op" id="8060310">,</span>&nbsp;<span class="ident" id="8060312">c</span>&nbsp;<span class="op" id="8060314">:=</span>&nbsp;<span class="op" id="8060317">[</span><span class="op" id="8060318">]</span><span class="builtintype" id="8060319">byte</span><span class="op" id="8060323">(</span><span class="string" id="8060324">&#34;aaaaaa&#34;</span><span class="op" id="8060332">)</span><span class="op" id="8060333">,</span>&nbsp;<span class="op" id="8060335">[</span><span class="op" id="8060336">]</span><span class="builtintype" id="8060337">byte</span><span class="op" id="8060341">(</span><span class="string" id="8060342">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="8060356">)</span><span class="op" id="8060357">,</span>&nbsp;<span class="op" id="8060359">[</span><span class="op" id="8060360">]</span><span class="builtintype" id="8060361">byte</span><span class="op" id="8060365">(</span><span class="string" id="8060366">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="8060392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060395">w</span><span class="op" id="8060396">.</span><span class="ident" id="8060397">Write</span><span class="op" id="8060402">(</span><span class="ident" id="8060403">a</span><span class="op" id="8060404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060407">w</span><span class="op" id="8060408">.</span><span class="ident" id="8060409">Write</span><span class="op" id="8060414">(</span><span class="ident" id="8060415">b</span><span class="op" id="8060416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060419">w</span><span class="op" id="8060420">.</span><span class="ident" id="8060421">Write</span><span class="op" id="8060426">(</span><span class="ident" id="8060427">c</span><span class="op" id="8060428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060431">w</span><span class="op" id="8060432">.</span><span class="ident" id="8060433">Close</span><span class="op" id="8060438">(</span><span class="op" id="8060439">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060443">readBuf</span>&nbsp;<span class="op" id="8060451">:=</span>&nbsp;<span class="builtinfunc" id="8060454">make</span><span class="op" id="8060458">(</span><span class="op" id="8060459">[</span><span class="op" id="8060460">]</span><span class="builtintype" id="8060461">byte</span><span class="op" id="8060465">,</span>&nbsp;<span class="builtinfunc" id="8060467">len</span><span class="op" id="8060470">(</span><span class="ident" id="8060471">a</span><span class="op" id="8060472">)</span><span class="op" id="8060473">+</span><span class="builtinfunc" id="8060474">len</span><span class="op" id="8060477">(</span><span class="ident" id="8060478">b</span><span class="op" id="8060479">)</span><span class="op" id="8060480">+</span><span class="builtinfunc" id="8060481">len</span><span class="op" id="8060484">(</span><span class="ident" id="8060485">c</span><span class="op" id="8060486">)</span><span class="op" id="8060487">+</span><span class="num" id="8060488">1</span><span class="op" id="8060489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060492">byter</span>&nbsp;<span class="op" id="8060498">:=</span>&nbsp;<span class="ident" id="8060501">bytes</span><span class="op" id="8060506">.</span><span class="ident" id="8060507">NewReader</span><span class="op" id="8060516">(</span><span class="ident" id="8060517">buf</span><span class="op" id="8060520">.</span><span class="ident" id="8060521">Bytes</span><span class="op" id="8060526">(</span><span class="op" id="8060527">)</span><span class="op" id="8060528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060531">bufr</span>&nbsp;<span class="op" id="8060536">:=</span>&nbsp;<span class="ident" id="8060539">bufio</span><span class="op" id="8060544">.</span><span class="ident" id="8060545">NewReader</span><span class="op" id="8060554">(</span><span class="ident" id="8060555">byter</span><span class="op" id="8060560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060563">mallocs</span>&nbsp;<span class="op" id="8060571">:=</span>&nbsp;<span class="ident" id="8060574">testing</span><span class="op" id="8060581">.</span><span class="ident" id="8060582">AllocsPerRun</span><span class="op" id="8060594">(</span><span class="num" id="8060595">100</span><span class="op" id="8060598">,</span>&nbsp;<span class="keyword" id="8060600">func</span><span class="op" id="8060604">(</span><span class="op" id="8060605">)</span>&nbsp;<span class="op" id="8060607">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060611">byter</span><span class="op" id="8060616">.</span><span class="ident" id="8060617">Seek</span><span class="op" id="8060621">(</span><span class="num" id="8060622">0</span><span class="op" id="8060623">,</span>&nbsp;<span class="num" id="8060625">0</span><span class="op" id="8060626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060630">bufr</span><span class="op" id="8060634">.</span><span class="ident" id="8060635">Reset</span><span class="op" id="8060640">(</span><span class="ident" id="8060641">byter</span><span class="op" id="8060646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060650">r</span>&nbsp;<span class="op" id="8060652">:=</span>&nbsp;<span class="ident" id="8060655">NewChunkedReader</span><span class="op" id="8060671">(</span><span class="ident" id="8060672">bufr</span><span class="op" id="8060676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060680">n</span><span class="op" id="8060681">,</span>&nbsp;<span class="ident" id="8060683">err</span>&nbsp;<span class="op" id="8060687">:=</span>&nbsp;<span class="ident" id="8060690">io</span><span class="op" id="8060692">.</span><span class="ident" id="8060693">ReadFull</span><span class="op" id="8060701">(</span><span class="ident" id="8060702">r</span><span class="op" id="8060703">,</span>&nbsp;<span class="ident" id="8060705">readBuf</span><span class="op" id="8060712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060716">if</span>&nbsp;<span class="ident" id="8060719">n</span>&nbsp;<span class="op" id="8060721">!=</span>&nbsp;<span class="builtinfunc" id="8060724">len</span><span class="op" id="8060727">(</span><span class="ident" id="8060728">readBuf</span><span class="op" id="8060735">)</span><span class="op" id="8060736">-</span><span class="num" id="8060737">1</span>&nbsp;<span class="op" id="8060739">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060744">t</span><span class="op" id="8060745">.</span><span class="ident" id="8060746">Fatalf</span><span class="op" id="8060752">(</span><span class="string" id="8060753">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8060777">,</span>&nbsp;<span class="ident" id="8060779">n</span><span class="op" id="8060780">,</span>&nbsp;<span class="builtinfunc" id="8060782">len</span><span class="op" id="8060785">(</span><span class="ident" id="8060786">readBuf</span><span class="op" id="8060793">)</span><span class="op" id="8060794">-</span><span class="num" id="8060795">1</span><span class="op" id="8060796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060804">if</span>&nbsp;<span class="ident" id="8060807">err</span>&nbsp;<span class="op" id="8060811">!=</span>&nbsp;<span class="ident" id="8060814">io</span><span class="op" id="8060816">.</span><span class="ident" id="8060817">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="8060834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060839">t</span><span class="op" id="8060840">.</span><span class="ident" id="8060841">Fatalf</span><span class="op" id="8060847">(</span><span class="string" id="8060848">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="8060888">,</span>&nbsp;<span class="ident" id="8060890">err</span><span class="op" id="8060893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060897">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060900">}</span><span class="op" id="8060901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8060904">if</span>&nbsp;<span class="ident" id="8060907">mallocs</span>&nbsp;<span class="op" id="8060915">&gt;</span>&nbsp;<span class="num" id="8060917">1.5</span>&nbsp;<span class="op" id="8060921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8060925">t</span><span class="op" id="8060926">.</span><span class="ident" id="8060927">Errorf</span><span class="op" id="8060933">(</span><span class="string" id="8060934">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="8060956">,</span>&nbsp;<span class="ident" id="8060958">mallocs</span><span class="op" id="8060965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8060968">}</span><br>
<span class="lineno"></span><span class="op" id="8060970">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="8060973">func</span>&nbsp;<span class="ident" id="8060978">TestParseHexUint</span><span class="op" id="8060994">(</span><span class="ident" id="8060995">t</span>&nbsp;<span class="op" id="8060997">*</span><span class="ident" id="8060998">testing</span><span class="op" id="8061005">.</span><span class="ident" id="8061006">T</span><span class="op" id="8061007">)</span>&nbsp;<span class="op" id="8061009">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061012">for</span>&nbsp;<span class="ident" id="8061016">i</span>&nbsp;<span class="op" id="8061018">:=</span>&nbsp;<span class="builtintype" id="8061021">uint64</span><span class="op" id="8061027">(</span><span class="num" id="8061028">0</span><span class="op" id="8061029">)</span><span class="op" id="8061030">;</span>&nbsp;<span class="ident" id="8061032">i</span>&nbsp;<span class="op" id="8061034">&lt;=</span>&nbsp;<span class="num" id="8061037">1234</span><span class="op" id="8061041">;</span>&nbsp;<span class="ident" id="8061043">i</span><span class="op" id="8061044">++</span>&nbsp;<span class="op" id="8061047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061051">line</span>&nbsp;<span class="op" id="8061056">:=</span>&nbsp;<span class="op" id="8061059">[</span><span class="op" id="8061060">]</span><span class="builtintype" id="8061061">byte</span><span class="op" id="8061065">(</span><span class="ident" id="8061066">fmt</span><span class="op" id="8061069">.</span><span class="ident" id="8061070">Sprintf</span><span class="op" id="8061077">(</span><span class="string" id="8061078">&#34;%x&#34;</span><span class="op" id="8061082">,</span>&nbsp;<span class="ident" id="8061084">i</span><span class="op" id="8061085">)</span><span class="op" id="8061086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061090">got</span><span class="op" id="8061093">,</span>&nbsp;<span class="ident" id="8061095">err</span>&nbsp;<span class="op" id="8061099">:=</span>&nbsp;<span class="ident" id="8061102">parseHexUint</span><span class="op" id="8061114">(</span><span class="ident" id="8061115">line</span><span class="op" id="8061119">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061123">if</span>&nbsp;<span class="ident" id="8061126">err</span>&nbsp;<span class="op" id="8061130">!=</span>&nbsp;<span class="builtintype" id="8061133">nil</span>&nbsp;<span class="op" id="8061137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061142">t</span><span class="op" id="8061143">.</span><span class="ident" id="8061144">Fatalf</span><span class="op" id="8061150">(</span><span class="string" id="8061151">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="8061162">,</span>&nbsp;<span class="ident" id="8061164">i</span><span class="op" id="8061165">,</span>&nbsp;<span class="ident" id="8061167">err</span><span class="op" id="8061170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061178">if</span>&nbsp;<span class="ident" id="8061181">got</span>&nbsp;<span class="op" id="8061185">!=</span>&nbsp;<span class="ident" id="8061188">i</span>&nbsp;<span class="op" id="8061190">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061195">t</span><span class="op" id="8061196">.</span><span class="ident" id="8061197">Errorf</span><span class="op" id="8061203">(</span><span class="string" id="8061204">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8061232">,</span>&nbsp;<span class="ident" id="8061234">line</span><span class="op" id="8061238">,</span>&nbsp;<span class="ident" id="8061240">got</span><span class="op" id="8061243">,</span>&nbsp;<span class="ident" id="8061245">i</span><span class="op" id="8061246">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061253">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061256">_</span><span class="op" id="8061257">,</span>&nbsp;<span class="ident" id="8061259">err</span>&nbsp;<span class="op" id="8061263">:=</span>&nbsp;<span class="ident" id="8061266">parseHexUint</span><span class="op" id="8061278">(</span><span class="op" id="8061279">[</span><span class="op" id="8061280">]</span><span class="builtintype" id="8061281">byte</span><span class="op" id="8061285">(</span><span class="string" id="8061286">&#34;bogus&#34;</span><span class="op" id="8061293">)</span><span class="op" id="8061294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8061297">if</span>&nbsp;<span class="ident" id="8061300">err</span>&nbsp;<span class="op" id="8061304">==</span>&nbsp;<span class="builtintype" id="8061307">nil</span>&nbsp;<span class="op" id="8061311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8061315">t</span><span class="op" id="8061316">.</span><span class="ident" id="8061317">Error</span><span class="op" id="8061322">(</span><span class="string" id="8061323">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="8061354">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8061357">}</span><br>
<span class="lineno"></span><span class="op" id="8061359">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
