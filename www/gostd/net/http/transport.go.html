<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http</h2>
<ul>
<li><a href="/gostd/net/http/client.go.html">client.go</a></li>
<li><a href="/gostd/net/http/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/http/cookie.go.html">cookie.go</a></li>
<li><a href="/gostd/net/http/cookie_test.go.html">cookie_test.go</a></li>
<li><a href="/gostd/net/http/doc.go.html">doc.go</a></li>
<li><a href="/gostd/net/http/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/http/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/net/http/filetransport.go.html">filetransport.go</a></li>
<li><a href="/gostd/net/http/filetransport_test.go.html">filetransport_test.go</a></li>
<li><a href="/gostd/net/http/fs.go.html">fs.go</a></li>
<li><a href="/gostd/net/http/fs_test.go.html">fs_test.go</a></li>
<li><a href="/gostd/net/http/header.go.html">header.go</a></li>
<li><a href="/gostd/net/http/header_test.go.html">header_test.go</a></li>
<li><a href="/gostd/net/http/jar.go.html">jar.go</a></li>
<li><a href="/gostd/net/http/lex.go.html">lex.go</a></li>
<li><a href="/gostd/net/http/lex_test.go.html">lex_test.go</a></li>
<li><a href="/gostd/net/http/main_test.go.html">main_test.go</a></li>
<li><a href="/gostd/net/http/npn_test.go.html">npn_test.go</a></li>
<li><a href="/gostd/net/http/proxy_test.go.html">proxy_test.go</a></li>
<li><a href="/gostd/net/http/range_test.go.html">range_test.go</a></li>
<li><a href="/gostd/net/http/readrequest_test.go.html">readrequest_test.go</a></li>
<li><a href="/gostd/net/http/request.go.html">request.go</a></li>
<li><a href="/gostd/net/http/request_test.go.html">request_test.go</a></li>
<li><a href="/gostd/net/http/requestwrite_test.go.html">requestwrite_test.go</a></li>
<li><a href="/gostd/net/http/response.go.html">response.go</a></li>
<li><a href="/gostd/net/http/response_test.go.html">response_test.go</a></li>
<li><a href="/gostd/net/http/responsewrite_test.go.html">responsewrite_test.go</a></li>
<li><a href="/gostd/net/http/serve_test.go.html">serve_test.go</a></li>
<li><a href="/gostd/net/http/server.go.html">server.go</a></li>
<li><a href="/gostd/net/http/sniff.go.html">sniff.go</a></li>
<li><a href="/gostd/net/http/sniff_test.go.html">sniff_test.go</a></li>
<li><a href="/gostd/net/http/status.go.html">status.go</a></li>
<li><a href="/gostd/net/http/transfer.go.html">transfer.go</a></li>
<li><a href="/gostd/net/http/transfer_test.go.html">transfer_test.go</a></li>
<li><a href="/gostd/net/http/transport.go.html" class="current">transport.go</a></li>
<li><a href="/gostd/net/http/transport_test.go.html">transport_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4259472">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4259527">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4259581">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4259632">//&nbsp;HTTP&nbsp;client&nbsp;implementation.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="4259677">//</span><br>
<span class="lineno"></span><span class="comment" id="4259680">//&nbsp;This&nbsp;is&nbsp;the&nbsp;low-level&nbsp;Transport&nbsp;implementation&nbsp;of&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="comment" id="4259747">//&nbsp;The&nbsp;high-level&nbsp;interface&nbsp;is&nbsp;in&nbsp;client.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4259793">package</span>&nbsp;<span class="ident" id="4259801">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4259807">import</span>&nbsp;<span class="op" id="4259814">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259817">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259826">&#34;compress/gzip&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259843">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259857">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259867">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259874">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259880">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259887">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259894">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259905">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259911">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259922">&#34;sync&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4259930">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4259937">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4259940">//&nbsp;DefaultTransport&nbsp;is&nbsp;the&nbsp;default&nbsp;implementation&nbsp;of&nbsp;Transport&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4260010">//&nbsp;used&nbsp;by&nbsp;DefaultClient.&nbsp;It&nbsp;establishes&nbsp;network&nbsp;connections&nbsp;as&nbsp;needed</span><br>
<span class="lineno">30</span><span class="comment" id="4260081">//&nbsp;and&nbsp;caches&nbsp;them&nbsp;for&nbsp;reuse&nbsp;by&nbsp;subsequent&nbsp;calls.&nbsp;It&nbsp;uses&nbsp;HTTP&nbsp;proxies</span><br>
<span class="lineno"></span><span class="comment" id="4260152">//&nbsp;as&nbsp;directed&nbsp;by&nbsp;the&nbsp;$HTTP_PROXY&nbsp;and&nbsp;$NO_PROXY&nbsp;(or&nbsp;$http_proxy&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4260220">//&nbsp;$no_proxy)&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="keyword" id="4260257">var</span>&nbsp;<span class="ident" id="4260261">DefaultTransport</span>&nbsp;<span class="ident" id="4260278"><a href="/gostd/net/http/client.go.html#4082635">RoundTripper</a></span>&nbsp;<span class="op" id="4260291">=</span>&nbsp;<span class="op" id="4260293">&amp;</span><span class="ident" id="4260294"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4260303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260306"><a href="/gostd/net/http/transport.go.html#4261395">Proxy</a></span><span class="op" id="4260311">:</span>&nbsp;<span class="ident" id="4260313"><a href="/gostd/net/http/transport.go.html#4264282">ProxyFromEnvironment</a></span><span class="op" id="4260333">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260336"><a href="/gostd/net/http/transport.go.html#4261557">Dial</a></span><span class="op" id="4260340">:</span>&nbsp;<span class="op" id="4260342">(</span><span class="op" id="4260343">&amp;</span><span class="ident" id="4260344"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4260347">.</span><span class="ident" id="4260348"><a href="/gostd/net/dial.go.html#3199756">Dialer</a></span><span class="op" id="4260354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260358"><a href="/gostd/net/dial.go.html#3200103">Timeout</a></span><span class="op" id="4260365">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="4260369">30</span>&nbsp;<span class="op" id="4260372">*</span>&nbsp;<span class="ident" id="4260374"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4260378">.</span><span class="ident" id="4260379"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="4260385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260389"><a href="/gostd/net/dial.go.html#3201057">KeepAlive</a></span><span class="op" id="4260398">:</span>&nbsp;<span class="num" id="4260400">30</span>&nbsp;<span class="op" id="4260403">*</span>&nbsp;<span class="ident" id="4260405"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4260409">.</span><span class="ident" id="4260410"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="4260416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4260419">}</span><span class="op" id="4260420">)</span><span class="op" id="4260421">.</span><span class="ident" id="4260422"><a href="/gostd/net/dial.go.html#3203959">Dial</a></span><span class="op" id="4260426">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260429"><a href="/gostd/net/http/transport.go.html#4262333">TLSHandshakeTimeout</a></span><span class="op" id="4260448">:</span>&nbsp;<span class="num" id="4260450">10</span>&nbsp;<span class="op" id="4260453">*</span>&nbsp;<span class="ident" id="4260455"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4260459">.</span><span class="ident" id="4260460"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="4260466">,</span><br>
<span class="lineno">40</span><span class="op" id="4260468">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4260471">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;the&nbsp;default&nbsp;value&nbsp;of&nbsp;Transport&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4260537">//&nbsp;MaxIdleConnsPerHost.</span><br>
<span class="lineno"></span><span class="keyword" id="4260561">const</span>&nbsp;<span class="ident" id="4260567">DefaultMaxIdleConnsPerHost</span>&nbsp;<span class="op" id="4260594">=</span>&nbsp;<span class="num" id="4260596">2</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="4260599">//&nbsp;Transport&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;RoundTripper&nbsp;that&nbsp;supports&nbsp;HTTP,</span><br>
<span class="lineno"></span><span class="comment" id="4260669">//&nbsp;HTTPS,&nbsp;and&nbsp;HTTP&nbsp;proxies&nbsp;(for&nbsp;either&nbsp;HTTP&nbsp;or&nbsp;HTTPS&nbsp;with&nbsp;CONNECT).</span><br>
<span class="lineno"></span><span class="comment" id="4260737">//&nbsp;Transport&nbsp;can&nbsp;also&nbsp;cache&nbsp;connections&nbsp;for&nbsp;future&nbsp;re-use.</span><br>
<span class="lineno"></span><span class="keyword" id="4260796">type</span>&nbsp;<span class="ident" id="4260801">Transport</span>&nbsp;<span class="keyword" id="4260811">struct</span>&nbsp;<span class="op" id="4260818">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260821">idleMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260832"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4260836">.</span><span class="ident" id="4260837"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260844">wantIdle</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4260855">bool</span>&nbsp;<span class="comment" id="4260860">//&nbsp;user&nbsp;has&nbsp;requested&nbsp;to&nbsp;close&nbsp;all&nbsp;idle&nbsp;conns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260907">idleConn</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="4260918">map</span><span class="op" id="4260921">[</span><span class="ident" id="4260922"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4260938">]</span><span class="op" id="4260939">[</span><span class="op" id="4260940">]</span><span class="op" id="4260941">*</span><span class="ident" id="4260942"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4260955">idleConnCh</span>&nbsp;<span class="keyword" id="4260966">map</span><span class="op" id="4260969">[</span><span class="ident" id="4260970"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4260986">]</span><span class="keyword" id="4260987">chan</span>&nbsp;<span class="op" id="4260992">*</span><span class="ident" id="4260993"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261007">reqMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261019"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4261023">.</span><span class="ident" id="4261024"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261031">reqCanceler</span>&nbsp;<span class="keyword" id="4261043">map</span><span class="op" id="4261046">[</span><span class="op" id="4261047">*</span><span class="ident" id="4261048"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4261055">]</span><span class="keyword" id="4261056">func</span><span class="op" id="4261060">(</span><span class="op" id="4261061">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261065">altMu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261074"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4261078">.</span><span class="ident" id="4261079"><a href="/gostd/sync/rwmutex.go.html#1456076">RWMutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261088">altProto</span>&nbsp;<span class="keyword" id="4261097">map</span><span class="op" id="4261100">[</span><span class="builtintype" id="4261101">string</span><span class="op" id="4261107">]</span><span class="ident" id="4261108"><a href="/gostd/net/http/client.go.html#4082635">RoundTripper</a></span>&nbsp;<span class="comment" id="4261121">//&nbsp;nil&nbsp;or&nbsp;map&nbsp;of&nbsp;URI&nbsp;scheme&nbsp;=&gt;&nbsp;RoundTripper</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261167">//&nbsp;Proxy&nbsp;specifies&nbsp;a&nbsp;function&nbsp;to&nbsp;return&nbsp;a&nbsp;proxy&nbsp;for&nbsp;a&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261228">//&nbsp;Request.&nbsp;If&nbsp;the&nbsp;function&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261286">//&nbsp;request&nbsp;is&nbsp;aborted&nbsp;with&nbsp;the&nbsp;provided&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261334">//&nbsp;If&nbsp;Proxy&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;a&nbsp;nil&nbsp;*URL,&nbsp;no&nbsp;proxy&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261395">Proxy</span>&nbsp;<span class="keyword" id="4261401">func</span><span class="op" id="4261405">(</span><span class="op" id="4261406">*</span><span class="ident" id="4261407"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4261414">)</span>&nbsp;<span class="op" id="4261416">(</span><span class="op" id="4261417">*</span><span class="ident" id="4261418"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4261421">.</span><span class="ident" id="4261422"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4261425">,</span>&nbsp;<span class="builtintype" id="4261427">error</span><span class="op" id="4261432">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261436">//&nbsp;Dial&nbsp;specifies&nbsp;the&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating&nbsp;unencrypted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261498">//&nbsp;TCP&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261519">//&nbsp;If&nbsp;Dial&nbsp;is&nbsp;nil,&nbsp;net.Dial&nbsp;is&nbsp;used.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4261557">Dial</span>&nbsp;<span class="keyword" id="4261562">func</span><span class="op" id="4261566">(</span><span class="ident" id="4261567">network</span><span class="op" id="4261574">,</span>&nbsp;<span class="ident" id="4261576">addr</span>&nbsp;<span class="builtintype" id="4261581">string</span><span class="op" id="4261587">)</span>&nbsp;<span class="op" id="4261589">(</span><span class="ident" id="4261590"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4261593">.</span><span class="ident" id="4261594"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4261598">,</span>&nbsp;<span class="builtintype" id="4261600">error</span><span class="op" id="4261605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261609">//&nbsp;DialTLS&nbsp;specifies&nbsp;an&nbsp;optional&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261670">//&nbsp;TLS&nbsp;connections&nbsp;for&nbsp;non-proxied&nbsp;HTTPS&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261722">//</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261726">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;nil,&nbsp;Dial&nbsp;and&nbsp;TLSClientConfig&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261784">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261788">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;set,&nbsp;the&nbsp;Dial&nbsp;hook&nbsp;is&nbsp;not&nbsp;used&nbsp;for&nbsp;HTTPS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261847">//&nbsp;requests&nbsp;and&nbsp;the&nbsp;TLSClientConfig&nbsp;and&nbsp;TLSHandshakeTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261908">//&nbsp;are&nbsp;ignored.&nbsp;The&nbsp;returned&nbsp;net.Conn&nbsp;is&nbsp;assumed&nbsp;to&nbsp;already&nbsp;be</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4261972">//&nbsp;past&nbsp;the&nbsp;TLS&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262000">DialTLS</span>&nbsp;<span class="keyword" id="4262008">func</span><span class="op" id="4262012">(</span><span class="ident" id="4262013">network</span><span class="op" id="4262020">,</span>&nbsp;<span class="ident" id="4262022">addr</span>&nbsp;<span class="builtintype" id="4262027">string</span><span class="op" id="4262033">)</span>&nbsp;<span class="op" id="4262035">(</span><span class="ident" id="4262036"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4262039">.</span><span class="ident" id="4262040"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4262044">,</span>&nbsp;<span class="builtintype" id="4262046">error</span><span class="op" id="4262051">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262055">//&nbsp;TLSClientConfig&nbsp;specifies&nbsp;the&nbsp;TLS&nbsp;configuration&nbsp;to&nbsp;use&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262119">//&nbsp;tls.Client.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;default&nbsp;configuration&nbsp;is&nbsp;used.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262178">TLSClientConfig</span>&nbsp;<span class="op" id="4262194">*</span><span class="ident" id="4262195"><a href="/gostd/net/http/transport.go.html#4259843">tls</a></span><span class="op" id="4262198">.</span><span class="ident" id="4262199"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262208">//&nbsp;TLSHandshakeTimeout&nbsp;specifies&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;waiting&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262280">//&nbsp;wait&nbsp;for&nbsp;a&nbsp;TLS&nbsp;handshake.&nbsp;Zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262333">TLSHandshakeTimeout</span>&nbsp;<span class="ident" id="4262353"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4262357">.</span><span class="ident" id="4262358"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262369">//&nbsp;DisableKeepAlives,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;re-use&nbsp;of&nbsp;TCP&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262436">//&nbsp;between&nbsp;different&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262473">DisableKeepAlives</span>&nbsp;<span class="builtintype" id="4262491">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262498">//&nbsp;DisableCompression,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;the&nbsp;Transport&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262559">//&nbsp;requesting&nbsp;compression&nbsp;with&nbsp;an&nbsp;&#34;Accept-Encoding:&nbsp;gzip&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262618">//&nbsp;request&nbsp;header&nbsp;when&nbsp;the&nbsp;Request&nbsp;contains&nbsp;no&nbsp;existing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262675">//&nbsp;Accept-Encoding&nbsp;value.&nbsp;If&nbsp;the&nbsp;Transport&nbsp;requests&nbsp;gzip&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262736">//&nbsp;its&nbsp;own&nbsp;and&nbsp;gets&nbsp;a&nbsp;gzipped&nbsp;response,&nbsp;it&#39;s&nbsp;transparently</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262796">//&nbsp;decoded&nbsp;in&nbsp;the&nbsp;Response.Body.&nbsp;However,&nbsp;if&nbsp;the&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262851">//&nbsp;explicitly&nbsp;requested&nbsp;gzip&nbsp;it&nbsp;is&nbsp;not&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262905">//&nbsp;uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4262923">DisableCompression</span>&nbsp;<span class="builtintype" id="4262942">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4262949">//&nbsp;MaxIdleConnsPerHost,&nbsp;if&nbsp;non-zero,&nbsp;controls&nbsp;the&nbsp;maximum&nbsp;idle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263013">//&nbsp;(keep-alive)&nbsp;to&nbsp;keep&nbsp;per-host.&nbsp;&nbsp;If&nbsp;zero,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263058">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263098">MaxIdleConnsPerHost</span>&nbsp;<span class="builtintype" id="4263118">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263124">//&nbsp;ResponseHeaderTimeout,&nbsp;if&nbsp;non-zero,&nbsp;specifies&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263188">//&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;a&nbsp;server&#39;s&nbsp;response&nbsp;headers&nbsp;after&nbsp;fully</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263249">//&nbsp;writing&nbsp;the&nbsp;request&nbsp;(including&nbsp;its&nbsp;body,&nbsp;if&nbsp;any).&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263308">//&nbsp;time&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;time&nbsp;to&nbsp;read&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4263370">ResponseHeaderTimeout</span>&nbsp;<span class="ident" id="4263392"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4263396">.</span><span class="ident" id="4263397"><a href="/gostd/time/time.go.html#2734212">Duration</a></span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263408">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;global&nbsp;max&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4263459">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;timeout&nbsp;on&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span><span class="op" id="4263509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="4263512">//&nbsp;ProxyFromEnvironment&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;proxy&nbsp;to&nbsp;use&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4263578">//&nbsp;given&nbsp;request,&nbsp;as&nbsp;indicated&nbsp;by&nbsp;the&nbsp;environment&nbsp;variables</span><br>
<span class="lineno"></span><span class="comment" id="4263638">//&nbsp;HTTP_PROXY,&nbsp;HTTPS_PROXY&nbsp;and&nbsp;NO_PROXY&nbsp;(or&nbsp;the&nbsp;lowercase&nbsp;versions</span><br>
<span class="lineno"></span><span class="comment" id="4263705">//&nbsp;thereof).&nbsp;HTTPS_PROXY&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;HTTP_PROXY&nbsp;for&nbsp;https</span><br>
<span class="lineno"></span><span class="comment" id="4263773">//&nbsp;requests.</span><br>
<span class="lineno">125</span><span class="comment" id="4263786">//</span><br>
<span class="lineno"></span><span class="comment" id="4263789">//&nbsp;The&nbsp;environment&nbsp;values&nbsp;may&nbsp;be&nbsp;either&nbsp;a&nbsp;complete&nbsp;URL&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4263849">//&nbsp;&#34;host[:port]&#34;,&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;&#34;http&#34;&nbsp;scheme&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="4263911">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;different&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="4263969">//</span><br>
<span class="lineno">130</span><span class="comment" id="4263972">//&nbsp;A&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;are&nbsp;returned&nbsp;if&nbsp;no&nbsp;proxy&nbsp;is&nbsp;defined&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4264042">//&nbsp;environment,&nbsp;or&nbsp;a&nbsp;proxy&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;the&nbsp;given&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="4264111">//&nbsp;as&nbsp;defined&nbsp;by&nbsp;NO_PROXY.</span><br>
<span class="lineno"></span><span class="comment" id="4264138">//</span><br>
<span class="lineno"></span><span class="comment" id="4264141">//&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;req.URL.Host&nbsp;is&nbsp;&#34;localhost&#34;&nbsp;(with&nbsp;or&nbsp;without</span><br>
<span class="lineno">135</span><span class="comment" id="4264211">//&nbsp;a&nbsp;port&nbsp;number),&nbsp;then&nbsp;a&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="4264277">func</span>&nbsp;<span class="ident" id="4264282">ProxyFromEnvironment</span><span class="op" id="4264302">(</span><span class="ident" id="4264303">req</span>&nbsp;<span class="op" id="4264307">*</span><span class="ident" id="4264308"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4264315">)</span>&nbsp;<span class="op" id="4264317">(</span><span class="op" id="4264318">*</span><span class="ident" id="4264319"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4264322">.</span><span class="ident" id="4264323"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4264326">,</span>&nbsp;<span class="builtintype" id="4264328">error</span><span class="op" id="4264333">)</span>&nbsp;<span class="op" id="4264335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264338">var</span>&nbsp;<span class="ident" id="4264342">proxy</span>&nbsp;<span class="builtintype" id="4264348">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264356">if</span>&nbsp;<span class="ident" id="4264359"><a href="/gostd/net/http/transport.go.html#4264303">req</a></span><span class="op" id="4264362">.</span><span class="ident" id="4264363"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4264366">.</span><span class="ident" id="4264367"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span>&nbsp;<span class="op" id="4264374">==</span>&nbsp;<span class="string" id="4264377">&#34;https&#34;</span>&nbsp;<span class="op" id="4264385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264389"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span>&nbsp;<span class="op" id="4264395">=</span>&nbsp;<span class="ident" id="4264397"><a href="/gostd/net/http/transport.go.html#4268571">httpsProxyEnv</a></span><span class="op" id="4264410">.</span><span class="ident" id="4264411"><a href="/gostd/net/http/transport.go.html#4268964">Get</a></span><span class="op" id="4264414">(</span><span class="op" id="4264415">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264421">if</span>&nbsp;<span class="ident" id="4264424"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span>&nbsp;<span class="op" id="4264430">==</span>&nbsp;<span class="string" id="4264433">&#34;&#34;</span>&nbsp;<span class="op" id="4264436">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264440"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span>&nbsp;<span class="op" id="4264446">=</span>&nbsp;<span class="ident" id="4264448"><a href="/gostd/net/http/transport.go.html#4268495">httpProxyEnv</a></span><span class="op" id="4264460">.</span><span class="ident" id="4264461"><a href="/gostd/net/http/transport.go.html#4268964">Get</a></span><span class="op" id="4264464">(</span><span class="op" id="4264465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264471">if</span>&nbsp;<span class="ident" id="4264474"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span>&nbsp;<span class="op" id="4264480">==</span>&nbsp;<span class="string" id="4264483">&#34;&#34;</span>&nbsp;<span class="op" id="4264486">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264490">return</span>&nbsp;<span class="builtintype" id="4264497">nil</span><span class="op" id="4264500">,</span>&nbsp;<span class="builtintype" id="4264502">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264507">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264510">if</span>&nbsp;<span class="op" id="4264513">!</span><span class="ident" id="4264514"><a href="/gostd/net/http/transport.go.html#4277528">useProxy</a></span><span class="op" id="4264522">(</span><span class="ident" id="4264523"><a href="/gostd/net/http/transport.go.html#4291171">canonicalAddr</a></span><span class="op" id="4264536">(</span><span class="ident" id="4264537"><a href="/gostd/net/http/transport.go.html#4264303">req</a></span><span class="op" id="4264540">.</span><span class="ident" id="4264541"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4264544">)</span><span class="op" id="4264545">)</span>&nbsp;<span class="op" id="4264547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264551">return</span>&nbsp;<span class="builtintype" id="4264558">nil</span><span class="op" id="4264561">,</span>&nbsp;<span class="builtintype" id="4264563">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264568">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4264571">proxyURL</span><span class="op" id="4264579">,</span>&nbsp;<span class="ident" id="4264581">err</span>&nbsp;<span class="op" id="4264585">:=</span>&nbsp;<span class="ident" id="4264588"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4264591">.</span><span class="ident" id="4264592"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="4264597">(</span><span class="ident" id="4264598"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span><span class="op" id="4264603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264606">if</span>&nbsp;<span class="ident" id="4264609"><a href="/gostd/net/http/transport.go.html#4264581">err</a></span>&nbsp;<span class="op" id="4264613">!=</span>&nbsp;<span class="builtintype" id="4264616">nil</span>&nbsp;<span class="op" id="4264620">||</span>&nbsp;<span class="op" id="4264623">!</span><span class="ident" id="4264624"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4264631">.</span><span class="ident" id="4264632"><a href="/gostd/strings/strings.go.html#2975366">HasPrefix</a></span><span class="op" id="4264641">(</span><span class="ident" id="4264642"><a href="/gostd/net/http/transport.go.html#4264571">proxyURL</a></span><span class="op" id="4264650">.</span><span class="ident" id="4264651"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span><span class="op" id="4264657">,</span>&nbsp;<span class="string" id="4264659">&#34;http&#34;</span><span class="op" id="4264665">)</span>&nbsp;<span class="op" id="4264667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4264671">//&nbsp;proxy&nbsp;was&nbsp;bogus.&nbsp;Try&nbsp;prepending&nbsp;&#34;http://&#34;&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4264728">//&nbsp;see&nbsp;if&nbsp;that&nbsp;parses&nbsp;correctly.&nbsp;If&nbsp;not,&nbsp;we&nbsp;fall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4264779">//&nbsp;through&nbsp;and&nbsp;complain&nbsp;about&nbsp;the&nbsp;original&nbsp;one.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264829">if</span>&nbsp;<span class="ident" id="4264832">proxyURL</span><span class="op" id="4264840">,</span>&nbsp;<span class="ident" id="4264842">err</span>&nbsp;<span class="op" id="4264846">:=</span>&nbsp;<span class="ident" id="4264849"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4264852">.</span><span class="ident" id="4264853"><a href="/gostd/net/url/url.go.html#3754169">Parse</a></span><span class="op" id="4264858">(</span><span class="string" id="4264859">&#34;http://&#34;</span>&nbsp;<span class="op" id="4264869">+</span>&nbsp;<span class="ident" id="4264871"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span><span class="op" id="4264876">)</span><span class="op" id="4264877">;</span>&nbsp;<span class="ident" id="4264879"><a href="/gostd/net/http/transport.go.html#4264842">err</a></span>&nbsp;<span class="op" id="4264883">==</span>&nbsp;<span class="builtintype" id="4264886">nil</span>&nbsp;<span class="op" id="4264890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264895">return</span>&nbsp;<span class="ident" id="4264902"><a href="/gostd/net/http/transport.go.html#4264832">proxyURL</a></span><span class="op" id="4264910">,</span>&nbsp;<span class="builtintype" id="4264912">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4264921">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264924">if</span>&nbsp;<span class="ident" id="4264927"><a href="/gostd/net/http/transport.go.html#4264581">err</a></span>&nbsp;<span class="op" id="4264931">!=</span>&nbsp;<span class="builtintype" id="4264934">nil</span>&nbsp;<span class="op" id="4264938">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4264942">return</span>&nbsp;<span class="builtintype" id="4264949">nil</span><span class="op" id="4264952">,</span>&nbsp;<span class="ident" id="4264954"><a href="/gostd/net/http/transport.go.html#4259867">fmt</a></span><span class="op" id="4264957">.</span><span class="ident" id="4264958"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4264964">(</span><span class="string" id="4264965">&#34;invalid&nbsp;proxy&nbsp;address&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="4264995">,</span>&nbsp;<span class="ident" id="4264997"><a href="/gostd/net/http/transport.go.html#4264342">proxy</a></span><span class="op" id="4265002">,</span>&nbsp;<span class="ident" id="4265004"><a href="/gostd/net/http/transport.go.html#4264581">err</a></span><span class="op" id="4265007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265010">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265013">return</span>&nbsp;<span class="ident" id="4265020"><a href="/gostd/net/http/transport.go.html#4264571">proxyURL</a></span><span class="op" id="4265028">,</span>&nbsp;<span class="builtintype" id="4265030">nil</span><br>
<span class="lineno"></span><span class="op" id="4265034">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4265037">//&nbsp;ProxyURL&nbsp;returns&nbsp;a&nbsp;proxy&nbsp;function&nbsp;(for&nbsp;use&nbsp;in&nbsp;a&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="4265099">//&nbsp;that&nbsp;always&nbsp;returns&nbsp;the&nbsp;same&nbsp;URL.</span><br>
<span class="lineno"></span><span class="keyword" id="4265136">func</span>&nbsp;<span class="ident" id="4265141">ProxyURL</span><span class="op" id="4265149">(</span><span class="ident" id="4265150">fixedURL</span>&nbsp;<span class="op" id="4265159">*</span><span class="ident" id="4265160"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4265163">.</span><span class="ident" id="4265164"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4265167">)</span>&nbsp;<span class="keyword" id="4265169">func</span><span class="op" id="4265173">(</span><span class="op" id="4265174">*</span><span class="ident" id="4265175"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4265182">)</span>&nbsp;<span class="op" id="4265184">(</span><span class="op" id="4265185">*</span><span class="ident" id="4265186"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4265189">.</span><span class="ident" id="4265190"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4265193">,</span>&nbsp;<span class="builtintype" id="4265195">error</span><span class="op" id="4265200">)</span>&nbsp;<span class="op" id="4265202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265205">return</span>&nbsp;<span class="keyword" id="4265212">func</span><span class="op" id="4265216">(</span><span class="op" id="4265217">*</span><span class="ident" id="4265218"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4265225">)</span>&nbsp;<span class="op" id="4265227">(</span><span class="op" id="4265228">*</span><span class="ident" id="4265229"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4265232">.</span><span class="ident" id="4265233"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4265236">,</span>&nbsp;<span class="builtintype" id="4265238">error</span><span class="op" id="4265243">)</span>&nbsp;<span class="op" id="4265245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265249">return</span>&nbsp;<span class="ident" id="4265256"><a href="/gostd/net/http/transport.go.html#4265150">fixedURL</a></span><span class="op" id="4265264">,</span>&nbsp;<span class="builtintype" id="4265266">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265271">}</span><br>
<span class="lineno"></span><span class="op" id="4265273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265276">//&nbsp;transportRequest&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;a&nbsp;*Request&nbsp;that&nbsp;adds</span><br>
<span class="lineno"></span><span class="comment" id="4265337">//&nbsp;optional&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write.</span><br>
<span class="lineno">175</span><span class="keyword" id="4265373">type</span>&nbsp;<span class="ident" id="4265378">transportRequest</span>&nbsp;<span class="keyword" id="4265395">struct</span>&nbsp;<span class="op" id="4265402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265405">*</span><span class="ident" id="4265406"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4265421">//&nbsp;original&nbsp;request,&nbsp;not&nbsp;to&nbsp;be&nbsp;mutated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265461">extra</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265470"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span>&nbsp;<span class="comment" id="4265477">//&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write,&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span><span class="op" id="4265511">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="4265514">func</span>&nbsp;<span class="op" id="4265519">(</span><span class="ident" id="4265520">tr</span>&nbsp;<span class="op" id="4265523">*</span><span class="ident" id="4265524"><a href="/gostd/net/http/transport.go.html#4265378">transportRequest</a></span><span class="op" id="4265540">)</span>&nbsp;<span class="ident" id="4265542">extraHeaders</span><span class="op" id="4265554">(</span><span class="op" id="4265555">)</span>&nbsp;<span class="ident" id="4265557"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span>&nbsp;<span class="op" id="4265564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265567">if</span>&nbsp;<span class="ident" id="4265570"><a href="/gostd/net/http/transport.go.html#4265520">tr</a></span><span class="op" id="4265572">.</span><span class="ident" id="4265573"><a href="/gostd/net/http/transport.go.html#4265461">extra</a></span>&nbsp;<span class="op" id="4265579">==</span>&nbsp;<span class="builtintype" id="4265582">nil</span>&nbsp;<span class="op" id="4265586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265590"><a href="/gostd/net/http/transport.go.html#4265520">tr</a></span><span class="op" id="4265592">.</span><span class="ident" id="4265593"><a href="/gostd/net/http/transport.go.html#4265461">extra</a></span>&nbsp;<span class="op" id="4265599">=</span>&nbsp;<span class="builtinfunc" id="4265601">make</span><span class="op" id="4265605">(</span><span class="ident" id="4265606"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4265612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265618">return</span>&nbsp;<span class="ident" id="4265625"><a href="/gostd/net/http/transport.go.html#4265520">tr</a></span><span class="op" id="4265627">.</span><span class="ident" id="4265628"><a href="/gostd/net/http/transport.go.html#4265461">extra</a></span><br>
<span class="lineno">185</span><span class="op" id="4265634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4265637">//&nbsp;RoundTrip&nbsp;implements&nbsp;the&nbsp;RoundTripper&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="4265689">//</span><br>
<span class="lineno"></span><span class="comment" id="4265692">//&nbsp;For&nbsp;higher-level&nbsp;HTTP&nbsp;client&nbsp;support&nbsp;(such&nbsp;as&nbsp;handling&nbsp;of&nbsp;cookies</span><br>
<span class="lineno">190</span><span class="comment" id="4265761">//&nbsp;and&nbsp;redirects),&nbsp;see&nbsp;Get,&nbsp;Post,&nbsp;and&nbsp;the&nbsp;Client&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="4265816">func</span>&nbsp;<span class="op" id="4265821">(</span><span class="ident" id="4265822">t</span>&nbsp;<span class="op" id="4265824">*</span><span class="ident" id="4265825"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4265834">)</span>&nbsp;<span class="ident" id="4265836">RoundTrip</span><span class="op" id="4265845">(</span><span class="ident" id="4265846">req</span>&nbsp;<span class="op" id="4265850">*</span><span class="ident" id="4265851"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4265858">)</span>&nbsp;<span class="op" id="4265860">(</span><span class="ident" id="4265861">resp</span>&nbsp;<span class="op" id="4265866">*</span><span class="ident" id="4265867"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4265875">,</span>&nbsp;<span class="ident" id="4265877">err</span>&nbsp;<span class="builtintype" id="4265881">error</span><span class="op" id="4265886">)</span>&nbsp;<span class="op" id="4265888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265891">if</span>&nbsp;<span class="ident" id="4265894"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4265897">.</span><span class="ident" id="4265898"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span>&nbsp;<span class="op" id="4265902">==</span>&nbsp;<span class="builtintype" id="4265905">nil</span>&nbsp;<span class="op" id="4265909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4265913"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4265916">.</span><span class="ident" id="4265917"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4265926">(</span><span class="op" id="4265927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265931">return</span>&nbsp;<span class="builtintype" id="4265938">nil</span><span class="op" id="4265941">,</span>&nbsp;<span class="ident" id="4265943"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4265949">.</span><span class="ident" id="4265950"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4265953">(</span><span class="string" id="4265954">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="4265977">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4265980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4265983">if</span>&nbsp;<span class="ident" id="4265986"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4265989">.</span><span class="ident" id="4265990"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span>&nbsp;<span class="op" id="4265997">==</span>&nbsp;<span class="builtintype" id="4266000">nil</span>&nbsp;<span class="op" id="4266004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266008"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266011">.</span><span class="ident" id="4266012"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4266021">(</span><span class="op" id="4266022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266026">return</span>&nbsp;<span class="builtintype" id="4266033">nil</span><span class="op" id="4266036">,</span>&nbsp;<span class="ident" id="4266038"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4266044">.</span><span class="ident" id="4266045"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4266048">(</span><span class="string" id="4266049">&#34;http:&nbsp;nil&nbsp;Request.Header&#34;</span><span class="op" id="4266075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266078">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266081">if</span>&nbsp;<span class="ident" id="4266084"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266087">.</span><span class="ident" id="4266088"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4266091">.</span><span class="ident" id="4266092"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span>&nbsp;<span class="op" id="4266099">!=</span>&nbsp;<span class="string" id="4266102">&#34;http&#34;</span>&nbsp;<span class="op" id="4266109">&amp;&amp;</span>&nbsp;<span class="ident" id="4266112"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266115">.</span><span class="ident" id="4266116"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4266119">.</span><span class="ident" id="4266120"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span>&nbsp;<span class="op" id="4266127">!=</span>&nbsp;<span class="string" id="4266130">&#34;https&#34;</span>&nbsp;<span class="op" id="4266138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266142"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266143">.</span><span class="ident" id="4266144"><a href="/gostd/net/http/transport.go.html#4261065">altMu</a></span><span class="op" id="4266149">.</span><span class="ident" id="4266150"><a href="/gostd/sync/rwmutex.go.html#1456490">RLock</a></span><span class="op" id="4266155">(</span><span class="op" id="4266156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266160">var</span>&nbsp;<span class="ident" id="4266164">rt</span>&nbsp;<span class="ident" id="4266167"><a href="/gostd/net/http/client.go.html#4082635">RoundTripper</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266182">if</span>&nbsp;<span class="ident" id="4266185"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266186">.</span><span class="ident" id="4266187"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span>&nbsp;<span class="op" id="4266196">!=</span>&nbsp;<span class="builtintype" id="4266199">nil</span>&nbsp;<span class="op" id="4266203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266208"><a href="/gostd/net/http/transport.go.html#4266164">rt</a></span>&nbsp;<span class="op" id="4266211">=</span>&nbsp;<span class="ident" id="4266213"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266214">.</span><span class="ident" id="4266215"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span><span class="op" id="4266223">[</span><span class="ident" id="4266224"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266227">.</span><span class="ident" id="4266228"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4266231">.</span><span class="ident" id="4266232"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span><span class="op" id="4266238">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266246"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266247">.</span><span class="ident" id="4266248"><a href="/gostd/net/http/transport.go.html#4261065">altMu</a></span><span class="op" id="4266253">.</span><span class="ident" id="4266254"><a href="/gostd/sync/rwmutex.go.html#1456952">RUnlock</a></span><span class="op" id="4266261">(</span><span class="op" id="4266262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266266">if</span>&nbsp;<span class="ident" id="4266269"><a href="/gostd/net/http/transport.go.html#4266164">rt</a></span>&nbsp;<span class="op" id="4266272">==</span>&nbsp;<span class="builtintype" id="4266275">nil</span>&nbsp;<span class="op" id="4266279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266284"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266287">.</span><span class="ident" id="4266288"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4266297">(</span><span class="op" id="4266298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266303">return</span>&nbsp;<span class="builtintype" id="4266310">nil</span><span class="op" id="4266313">,</span>&nbsp;<span class="op" id="4266315">&amp;</span><span class="ident" id="4266316"><a href="/gostd/net/http/request.go.html#4135248">badStringError</a></span><span class="op" id="4266330">{</span><span class="string" id="4266331">&#34;unsupported&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="4266360">,</span>&nbsp;<span class="ident" id="4266362"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266365">.</span><span class="ident" id="4266366"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4266369">.</span><span class="ident" id="4266370"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span><span class="op" id="4266376">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266384">return</span>&nbsp;<span class="ident" id="4266391"><a href="/gostd/net/http/transport.go.html#4266164">rt</a></span><span class="op" id="4266393">.</span><span class="ident" id="4266394"><a href="/gostd/net/http/client.go.html#4083357">RoundTrip</a></span><span class="op" id="4266403">(</span><span class="ident" id="4266404"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266413">if</span>&nbsp;<span class="ident" id="4266416"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266419">.</span><span class="ident" id="4266420"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4266423">.</span><span class="ident" id="4266424"><a href="/gostd/net/url/url.go.html#3751325">Host</a></span>&nbsp;<span class="op" id="4266429">==</span>&nbsp;<span class="string" id="4266432">&#34;&#34;</span>&nbsp;<span class="op" id="4266435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266439"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266442">.</span><span class="ident" id="4266443"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4266452">(</span><span class="op" id="4266453">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266457">return</span>&nbsp;<span class="builtintype" id="4266464">nil</span><span class="op" id="4266467">,</span>&nbsp;<span class="ident" id="4266469"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4266475">.</span><span class="ident" id="4266476"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4266479">(</span><span class="string" id="4266480">&#34;http:&nbsp;no&nbsp;Host&nbsp;in&nbsp;request&nbsp;URL&#34;</span><span class="op" id="4266510">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266516">treq</span>&nbsp;<span class="op" id="4266521">:=</span>&nbsp;<span class="op" id="4266524">&amp;</span><span class="ident" id="4266525"><a href="/gostd/net/http/transport.go.html#4265378">transportRequest</a></span><span class="op" id="4266541">{</span><span class="ident" id="4266542"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4266549">:</span>&nbsp;<span class="ident" id="4266551"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266557">cm</span><span class="op" id="4266559">,</span>&nbsp;<span class="ident" id="4266561"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span>&nbsp;<span class="op" id="4266565">:=</span>&nbsp;<span class="ident" id="4266568"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266569">.</span><span class="ident" id="4266570"><a href="/gostd/net/http/transport.go.html#4269244">connectMethodForRequest</a></span><span class="op" id="4266593">(</span><span class="ident" id="4266594"><a href="/gostd/net/http/transport.go.html#4266516">treq</a></span><span class="op" id="4266598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266601">if</span>&nbsp;<span class="ident" id="4266604"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span>&nbsp;<span class="op" id="4266608">!=</span>&nbsp;<span class="builtintype" id="4266611">nil</span>&nbsp;<span class="op" id="4266615">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266619"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266622">.</span><span class="ident" id="4266623"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4266632">(</span><span class="op" id="4266633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266637">return</span>&nbsp;<span class="builtintype" id="4266644">nil</span><span class="op" id="4266647">,</span>&nbsp;<span class="ident" id="4266649"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4266658">//&nbsp;Get&nbsp;the&nbsp;cached&nbsp;or&nbsp;newly-created&nbsp;connection&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4266719">//&nbsp;host&nbsp;(for&nbsp;http&nbsp;or&nbsp;https),&nbsp;the&nbsp;http&nbsp;proxy,&nbsp;or&nbsp;the&nbsp;http&nbsp;proxy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4266783">//&nbsp;pre-CONNECTed&nbsp;to&nbsp;https&nbsp;server.&nbsp;&nbsp;In&nbsp;any&nbsp;case,&nbsp;we&#39;ll&nbsp;be&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4266847">//&nbsp;to&nbsp;send&nbsp;it&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266872">pconn</span><span class="op" id="4266877">,</span>&nbsp;<span class="ident" id="4266879"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span>&nbsp;<span class="op" id="4266883">:=</span>&nbsp;<span class="ident" id="4266886"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266887">.</span><span class="ident" id="4266888"><a href="/gostd/net/http/transport.go.html#4273173">getConn</a></span><span class="op" id="4266895">(</span><span class="ident" id="4266896"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266899">,</span>&nbsp;<span class="ident" id="4266901"><a href="/gostd/net/http/transport.go.html#4266557">cm</a></span><span class="op" id="4266903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266906">if</span>&nbsp;<span class="ident" id="4266909"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span>&nbsp;<span class="op" id="4266913">!=</span>&nbsp;<span class="builtintype" id="4266916">nil</span>&nbsp;<span class="op" id="4266920">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266924"><a href="/gostd/net/http/transport.go.html#4265822">t</a></span><span class="op" id="4266925">.</span><span class="ident" id="4266926"><a href="/gostd/net/http/transport.go.html#4272446">setReqCanceler</a></span><span class="op" id="4266940">(</span><span class="ident" id="4266941"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266944">,</span>&nbsp;<span class="builtintype" id="4266946">nil</span><span class="op" id="4266949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4266953"><a href="/gostd/net/http/transport.go.html#4265846">req</a></span><span class="op" id="4266956">.</span><span class="ident" id="4266957"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4266966">(</span><span class="op" id="4266967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266971">return</span>&nbsp;<span class="builtintype" id="4266978">nil</span><span class="op" id="4266981">,</span>&nbsp;<span class="ident" id="4266983"><a href="/gostd/net/http/transport.go.html#4265877">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4266988">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4266992">return</span>&nbsp;<span class="ident" id="4266999"><a href="/gostd/net/http/transport.go.html#4266872">pconn</a></span><span class="op" id="4267004">.</span><span class="ident" id="4267005"><a href="/gostd/net/http/transport.go.html#4287428">roundTrip</a></span><span class="op" id="4267014">(</span><span class="ident" id="4267015"><a href="/gostd/net/http/transport.go.html#4266516">treq</a></span><span class="op" id="4267019">)</span><br>
<span class="lineno"></span><span class="op" id="4267021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4267024">//&nbsp;RegisterProtocol&nbsp;registers&nbsp;a&nbsp;new&nbsp;protocol&nbsp;with&nbsp;scheme.</span><br>
<span class="lineno"></span><span class="comment" id="4267082">//&nbsp;The&nbsp;Transport&nbsp;will&nbsp;pass&nbsp;requests&nbsp;using&nbsp;the&nbsp;given&nbsp;scheme&nbsp;to&nbsp;rt.</span><br>
<span class="lineno">240</span><span class="comment" id="4267148">//&nbsp;It&nbsp;is&nbsp;rt&#39;s&nbsp;responsibility&nbsp;to&nbsp;simulate&nbsp;HTTP&nbsp;request&nbsp;semantics.</span><br>
<span class="lineno"></span><span class="comment" id="4267213">//</span><br>
<span class="lineno"></span><span class="comment" id="4267216">//&nbsp;RegisterProtocol&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;other&nbsp;packages&nbsp;to&nbsp;provide</span><br>
<span class="lineno"></span><span class="comment" id="4267277">//&nbsp;implementations&nbsp;of&nbsp;protocol&nbsp;schemes&nbsp;like&nbsp;&#34;ftp&#34;&nbsp;or&nbsp;&#34;file&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="4267338">func</span>&nbsp;<span class="op" id="4267343">(</span><span class="ident" id="4267344">t</span>&nbsp;<span class="op" id="4267346">*</span><span class="ident" id="4267347"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4267356">)</span>&nbsp;<span class="ident" id="4267358">RegisterProtocol</span><span class="op" id="4267374">(</span><span class="ident" id="4267375">scheme</span>&nbsp;<span class="builtintype" id="4267382">string</span><span class="op" id="4267388">,</span>&nbsp;<span class="ident" id="4267390">rt</span>&nbsp;<span class="ident" id="4267393"><a href="/gostd/net/http/client.go.html#4082635">RoundTripper</a></span><span class="op" id="4267405">)</span>&nbsp;<span class="op" id="4267407">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267410">if</span>&nbsp;<span class="ident" id="4267413"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span>&nbsp;<span class="op" id="4267420">==</span>&nbsp;<span class="string" id="4267423">&#34;http&#34;</span>&nbsp;<span class="op" id="4267430">||</span>&nbsp;<span class="ident" id="4267433"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span>&nbsp;<span class="op" id="4267440">==</span>&nbsp;<span class="string" id="4267443">&#34;https&#34;</span>&nbsp;<span class="op" id="4267451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267455">panic</span><span class="op" id="4267460">(</span><span class="string" id="4267461">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="4267473">+</span>&nbsp;<span class="ident" id="4267475"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span>&nbsp;<span class="op" id="4267482">+</span>&nbsp;<span class="string" id="4267484">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="4267505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267511"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267512">.</span><span class="ident" id="4267513"><a href="/gostd/net/http/transport.go.html#4261065">altMu</a></span><span class="op" id="4267518">.</span><span class="ident" id="4267519"><a href="/gostd/sync/rwmutex.go.html#1457713">Lock</a></span><span class="op" id="4267523">(</span><span class="op" id="4267524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267527">defer</span>&nbsp;<span class="ident" id="4267533"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267534">.</span><span class="ident" id="4267535"><a href="/gostd/net/http/transport.go.html#4261065">altMu</a></span><span class="op" id="4267540">.</span><span class="ident" id="4267541"><a href="/gostd/sync/rwmutex.go.html#1458554">Unlock</a></span><span class="op" id="4267547">(</span><span class="op" id="4267548">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267551">if</span>&nbsp;<span class="ident" id="4267554"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267555">.</span><span class="ident" id="4267556"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span>&nbsp;<span class="op" id="4267565">==</span>&nbsp;<span class="builtintype" id="4267568">nil</span>&nbsp;<span class="op" id="4267572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267576"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267577">.</span><span class="ident" id="4267578"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span>&nbsp;<span class="op" id="4267587">=</span>&nbsp;<span class="builtinfunc" id="4267589">make</span><span class="op" id="4267593">(</span><span class="keyword" id="4267594">map</span><span class="op" id="4267597">[</span><span class="builtintype" id="4267598">string</span><span class="op" id="4267604">]</span><span class="ident" id="4267605"><a href="/gostd/net/http/client.go.html#4082635">RoundTripper</a></span><span class="op" id="4267617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4267623">if</span>&nbsp;<span class="ident" id="4267626">_</span><span class="op" id="4267627">,</span>&nbsp;<span class="ident" id="4267629">exists</span>&nbsp;<span class="op" id="4267636">:=</span>&nbsp;<span class="ident" id="4267639"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267640">.</span><span class="ident" id="4267641"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span><span class="op" id="4267649">[</span><span class="ident" id="4267650"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span><span class="op" id="4267656">]</span><span class="op" id="4267657">;</span>&nbsp;<span class="ident" id="4267659"><a href="/gostd/net/http/transport.go.html#4267629">exists</a></span>&nbsp;<span class="op" id="4267666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4267670">panic</span><span class="op" id="4267675">(</span><span class="string" id="4267676">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="4267688">+</span>&nbsp;<span class="ident" id="4267690"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span>&nbsp;<span class="op" id="4267697">+</span>&nbsp;<span class="string" id="4267699">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="4267720">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4267723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4267726"><a href="/gostd/net/http/transport.go.html#4267344">t</a></span><span class="op" id="4267727">.</span><span class="ident" id="4267728"><a href="/gostd/net/http/transport.go.html#4261088">altProto</a></span><span class="op" id="4267736">[</span><span class="ident" id="4267737"><a href="/gostd/net/http/transport.go.html#4267375">scheme</a></span><span class="op" id="4267743">]</span>&nbsp;<span class="op" id="4267745">=</span>&nbsp;<span class="ident" id="4267747"><a href="/gostd/net/http/transport.go.html#4267390">rt</a></span><br>
<span class="lineno"></span><span class="op" id="4267750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4267753">//&nbsp;CloseIdleConnections&nbsp;closes&nbsp;any&nbsp;connections&nbsp;which&nbsp;were&nbsp;previously</span><br>
<span class="lineno">260</span><span class="comment" id="4267822">//&nbsp;connected&nbsp;from&nbsp;previous&nbsp;requests&nbsp;but&nbsp;are&nbsp;now&nbsp;sitting&nbsp;idle&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="4267886">//&nbsp;a&nbsp;&#34;keep-alive&#34;&nbsp;state.&nbsp;It&nbsp;does&nbsp;not&nbsp;interrupt&nbsp;any&nbsp;connections&nbsp;currently</span><br>
<span class="lineno"></span><span class="comment" id="4267959">//&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="4267970">func</span>&nbsp;<span class="op" id="4267975">(</span><span class="ident" id="4267976">t</span>&nbsp;<span class="op" id="4267978">*</span><span class="ident" id="4267979"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4267988">)</span>&nbsp;<span class="ident" id="4267990">CloseIdleConnections</span><span class="op" id="4268010">(</span><span class="op" id="4268011">)</span>&nbsp;<span class="op" id="4268013">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268016"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268017">.</span><span class="ident" id="4268018"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4268024">.</span><span class="ident" id="4268025"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4268029">(</span><span class="op" id="4268030">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268033">m</span>&nbsp;<span class="op" id="4268035">:=</span>&nbsp;<span class="ident" id="4268038"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268039">.</span><span class="ident" id="4268040"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268050"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268051">.</span><span class="ident" id="4268052"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span>&nbsp;<span class="op" id="4268061">=</span>&nbsp;<span class="builtintype" id="4268063">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268068"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268069">.</span><span class="ident" id="4268070"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span>&nbsp;<span class="op" id="4268081">=</span>&nbsp;<span class="builtintype" id="4268083">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268088"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268089">.</span><span class="ident" id="4268090"><a href="/gostd/net/http/transport.go.html#4260844">wantIdle</a></span>&nbsp;<span class="op" id="4268099">=</span>&nbsp;<span class="builtintype" id="4268101">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268107"><a href="/gostd/net/http/transport.go.html#4267976">t</a></span><span class="op" id="4268108">.</span><span class="ident" id="4268109"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4268115">.</span><span class="ident" id="4268116"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4268122">(</span><span class="op" id="4268123">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4268126">for</span>&nbsp;<span class="ident" id="4268130">_</span><span class="op" id="4268131">,</span>&nbsp;<span class="ident" id="4268133">conns</span>&nbsp;<span class="op" id="4268139">:=</span>&nbsp;<span class="keyword" id="4268142">range</span>&nbsp;<span class="ident" id="4268148"><a href="/gostd/net/http/transport.go.html#4268033">m</a></span>&nbsp;<span class="op" id="4268150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4268154">for</span>&nbsp;<span class="ident" id="4268158">_</span><span class="op" id="4268159">,</span>&nbsp;<span class="ident" id="4268161">pconn</span>&nbsp;<span class="op" id="4268167">:=</span>&nbsp;<span class="keyword" id="4268170">range</span>&nbsp;<span class="ident" id="4268176"><a href="/gostd/net/http/transport.go.html#4268133">conns</a></span>&nbsp;<span class="op" id="4268182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268187"><a href="/gostd/net/http/transport.go.html#4268161">pconn</a></span><span class="op" id="4268192">.</span><span class="builtinfunc" id="4268193"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4268198">(</span><span class="op" id="4268199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268206">}</span><br>
<span class="lineno">275</span><span class="op" id="4268208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4268211">//&nbsp;CancelRequest&nbsp;cancels&nbsp;an&nbsp;in-flight&nbsp;request&nbsp;by&nbsp;closing&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4268272">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4268287">func</span>&nbsp;<span class="op" id="4268292">(</span><span class="ident" id="4268293">t</span>&nbsp;<span class="op" id="4268295">*</span><span class="ident" id="4268296"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4268305">)</span>&nbsp;<span class="ident" id="4268307">CancelRequest</span><span class="op" id="4268320">(</span><span class="ident" id="4268321">req</span>&nbsp;<span class="op" id="4268325">*</span><span class="ident" id="4268326"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4268333">)</span>&nbsp;<span class="op" id="4268335">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268338"><a href="/gostd/net/http/transport.go.html#4268293">t</a></span><span class="op" id="4268339">.</span><span class="ident" id="4268340"><a href="/gostd/net/http/transport.go.html#4261007">reqMu</a></span><span class="op" id="4268345">.</span><span class="ident" id="4268346"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4268350">(</span><span class="op" id="4268351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268354">cancel</span>&nbsp;<span class="op" id="4268361">:=</span>&nbsp;<span class="ident" id="4268364"><a href="/gostd/net/http/transport.go.html#4268293">t</a></span><span class="op" id="4268365">.</span><span class="ident" id="4268366"><a href="/gostd/net/http/transport.go.html#4261031">reqCanceler</a></span><span class="op" id="4268377">[</span><span class="ident" id="4268378"><a href="/gostd/net/http/transport.go.html#4268321">req</a></span><span class="op" id="4268381">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268384"><a href="/gostd/net/http/transport.go.html#4268293">t</a></span><span class="op" id="4268385">.</span><span class="ident" id="4268386"><a href="/gostd/net/http/transport.go.html#4261007">reqMu</a></span><span class="op" id="4268391">.</span><span class="ident" id="4268392"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4268398">(</span><span class="op" id="4268399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4268402">if</span>&nbsp;<span class="ident" id="4268405"><a href="/gostd/net/http/transport.go.html#4268354">cancel</a></span>&nbsp;<span class="op" id="4268412">!=</span>&nbsp;<span class="builtintype" id="4268415">nil</span>&nbsp;<span class="op" id="4268419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268423"><a href="/gostd/net/http/transport.go.html#4268354">cancel</a></span><span class="op" id="4268429">(</span><span class="op" id="4268430">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268433">}</span><br>
<span class="lineno"></span><span class="op" id="4268435">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4268438">//</span><br>
<span class="lineno"></span><span class="comment" id="4268441">//&nbsp;Private&nbsp;implementation&nbsp;past&nbsp;this&nbsp;point.</span><br>
<span class="lineno">290</span><span class="comment" id="4268484">//</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4268488">var</span>&nbsp;<span class="op" id="4268492">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268495">httpProxyEnv</span>&nbsp;<span class="op" id="4268508">=</span>&nbsp;<span class="op" id="4268510">&amp;</span><span class="ident" id="4268511"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4268518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268522"><a href="/gostd/net/http/transport.go.html#4268897">names</a></span><span class="op" id="4268527">:</span>&nbsp;<span class="op" id="4268529">[</span><span class="op" id="4268530">]</span><span class="builtintype" id="4268531">string</span><span class="op" id="4268537">{</span><span class="string" id="4268538">&#34;HTTP_PROXY&#34;</span><span class="op" id="4268550">,</span>&nbsp;<span class="string" id="4268552">&#34;http_proxy&#34;</span><span class="op" id="4268564">}</span><span class="op" id="4268565">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268571">httpsProxyEnv</span>&nbsp;<span class="op" id="4268585">=</span>&nbsp;<span class="op" id="4268587">&amp;</span><span class="ident" id="4268588"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4268595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268599"><a href="/gostd/net/http/transport.go.html#4268897">names</a></span><span class="op" id="4268604">:</span>&nbsp;<span class="op" id="4268606">[</span><span class="op" id="4268607">]</span><span class="builtintype" id="4268608">string</span><span class="op" id="4268614">{</span><span class="string" id="4268615">&#34;HTTPS_PROXY&#34;</span><span class="op" id="4268628">,</span>&nbsp;<span class="string" id="4268630">&#34;https_proxy&#34;</span><span class="op" id="4268643">}</span><span class="op" id="4268644">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268650">noProxyEnv</span>&nbsp;<span class="op" id="4268661">=</span>&nbsp;<span class="op" id="4268663">&amp;</span><span class="ident" id="4268664"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4268671">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268675"><a href="/gostd/net/http/transport.go.html#4268897">names</a></span><span class="op" id="4268680">:</span>&nbsp;<span class="op" id="4268682">[</span><span class="op" id="4268683">]</span><span class="builtintype" id="4268684">string</span><span class="op" id="4268690">{</span><span class="string" id="4268691">&#34;NO_PROXY&#34;</span><span class="op" id="4268701">,</span>&nbsp;<span class="string" id="4268703">&#34;no_proxy&#34;</span><span class="op" id="4268713">}</span><span class="op" id="4268714">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4268717">}</span><br>
<span class="lineno"></span><span class="op" id="4268719">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4268722">//&nbsp;envOnce&nbsp;looks&nbsp;up&nbsp;an&nbsp;environment&nbsp;variable&nbsp;(optionally&nbsp;by&nbsp;multiple</span><br>
<span class="lineno">305</span><span class="comment" id="4268790">//&nbsp;names)&nbsp;once.&nbsp;It&nbsp;mitigates&nbsp;expensive&nbsp;lookups&nbsp;on&nbsp;some&nbsp;platforms</span><br>
<span class="lineno"></span><span class="comment" id="4268855">//&nbsp;(e.g.&nbsp;Windows).</span><br>
<span class="lineno"></span><span class="keyword" id="4268874">type</span>&nbsp;<span class="ident" id="4268879">envOnce</span>&nbsp;<span class="keyword" id="4268887">struct</span>&nbsp;<span class="op" id="4268894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268897">names</span>&nbsp;<span class="op" id="4268903">[</span><span class="op" id="4268904">]</span><span class="builtintype" id="4268905">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268913">once</span>&nbsp;&nbsp;<span class="ident" id="4268919"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4268923">.</span><span class="ident" id="4268924"><a href="/gostd/sync/once.go.html#1446221">Once</a></span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268930">val</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4268936">string</span><br>
<span class="lineno"></span><span class="op" id="4268943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4268946">func</span>&nbsp;<span class="op" id="4268951">(</span><span class="ident" id="4268952">e</span>&nbsp;<span class="op" id="4268954">*</span><span class="ident" id="4268955"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4268962">)</span>&nbsp;<span class="ident" id="4268964">Get</span><span class="op" id="4268967">(</span><span class="op" id="4268968">)</span>&nbsp;<span class="builtintype" id="4268970">string</span>&nbsp;<span class="op" id="4268977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4268980"><a href="/gostd/net/http/transport.go.html#4268952">e</a></span><span class="op" id="4268981">.</span><span class="ident" id="4268982"><a href="/gostd/net/http/transport.go.html#4268913">once</a></span><span class="op" id="4268986">.</span><span class="ident" id="4268987"><a href="/gostd/sync/once.go.html#1447110">Do</a></span><span class="op" id="4268989">(</span><span class="ident" id="4268990"><a href="/gostd/net/http/transport.go.html#4268952">e</a></span><span class="op" id="4268991">.</span><span class="ident" id="4268992"><a href="/gostd/net/http/transport.go.html#4269033">init</a></span><span class="op" id="4268996">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4268999">return</span>&nbsp;<span class="ident" id="4269006"><a href="/gostd/net/http/transport.go.html#4268952">e</a></span><span class="op" id="4269007">.</span><span class="ident" id="4269008"><a href="/gostd/net/http/transport.go.html#4268930">val</a></span><br>
<span class="lineno"></span><span class="op" id="4269012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269015">func</span>&nbsp;<span class="op" id="4269020">(</span><span class="ident" id="4269021">e</span>&nbsp;<span class="op" id="4269023">*</span><span class="ident" id="4269024"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4269031">)</span>&nbsp;<span class="ident" id="4269033">init</span><span class="op" id="4269037">(</span><span class="op" id="4269038">)</span>&nbsp;<span class="op" id="4269040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269043">for</span>&nbsp;<span class="ident" id="4269047">_</span><span class="op" id="4269048">,</span>&nbsp;<span class="ident" id="4269050">n</span>&nbsp;<span class="op" id="4269052">:=</span>&nbsp;<span class="keyword" id="4269055">range</span>&nbsp;<span class="ident" id="4269061"><a href="/gostd/net/http/transport.go.html#4269021">e</a></span><span class="op" id="4269062">.</span><span class="ident" id="4269063"><a href="/gostd/net/http/transport.go.html#4268897">names</a></span>&nbsp;<span class="op" id="4269069">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269073"><a href="/gostd/net/http/transport.go.html#4269021">e</a></span><span class="op" id="4269074">.</span><span class="ident" id="4269075"><a href="/gostd/net/http/transport.go.html#4268930">val</a></span>&nbsp;<span class="op" id="4269079">=</span>&nbsp;<span class="ident" id="4269081"><a href="/gostd/net/http/transport.go.html#4259905">os</a></span><span class="op" id="4269083">.</span><span class="ident" id="4269084"><a href="/gostd/os/env.go.html#2429715">Getenv</a></span><span class="op" id="4269090">(</span><span class="ident" id="4269091"><a href="/gostd/net/http/transport.go.html#4269050">n</a></span><span class="op" id="4269092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269096">if</span>&nbsp;<span class="ident" id="4269099"><a href="/gostd/net/http/transport.go.html#4269021">e</a></span><span class="op" id="4269100">.</span><span class="ident" id="4269101"><a href="/gostd/net/http/transport.go.html#4268930">val</a></span>&nbsp;<span class="op" id="4269105">!=</span>&nbsp;<span class="string" id="4269108">&#34;&#34;</span>&nbsp;<span class="op" id="4269111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269116">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4269125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4269128">}</span><br>
<span class="lineno">325</span><span class="op" id="4269130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4269133">//&nbsp;reset&nbsp;is&nbsp;used&nbsp;by&nbsp;tests</span><br>
<span class="lineno"></span><span class="keyword" id="4269159">func</span>&nbsp;<span class="op" id="4269164">(</span><span class="ident" id="4269165">e</span>&nbsp;<span class="op" id="4269167">*</span><span class="ident" id="4269168"><a href="/gostd/net/http/transport.go.html#4268879">envOnce</a></span><span class="op" id="4269175">)</span>&nbsp;<span class="ident" id="4269177">reset</span><span class="op" id="4269182">(</span><span class="op" id="4269183">)</span>&nbsp;<span class="op" id="4269185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269188"><a href="/gostd/net/http/transport.go.html#4269165">e</a></span><span class="op" id="4269189">.</span><span class="ident" id="4269190"><a href="/gostd/net/http/transport.go.html#4268913">once</a></span>&nbsp;<span class="op" id="4269195">=</span>&nbsp;<span class="ident" id="4269197"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4269201">.</span><span class="ident" id="4269202"><a href="/gostd/sync/once.go.html#1446221">Once</a></span><span class="op" id="4269206">{</span><span class="op" id="4269207">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269210"><a href="/gostd/net/http/transport.go.html#4269165">e</a></span><span class="op" id="4269211">.</span><span class="ident" id="4269212"><a href="/gostd/net/http/transport.go.html#4268930">val</a></span>&nbsp;<span class="op" id="4269216">=</span>&nbsp;<span class="string" id="4269218">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4269221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269224">func</span>&nbsp;<span class="op" id="4269229">(</span><span class="ident" id="4269230">t</span>&nbsp;<span class="op" id="4269232">*</span><span class="ident" id="4269233"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4269242">)</span>&nbsp;<span class="ident" id="4269244">connectMethodForRequest</span><span class="op" id="4269267">(</span><span class="ident" id="4269268">treq</span>&nbsp;<span class="op" id="4269273">*</span><span class="ident" id="4269274"><a href="/gostd/net/http/transport.go.html#4265378">transportRequest</a></span><span class="op" id="4269290">)</span>&nbsp;<span class="op" id="4269292">(</span><span class="ident" id="4269293">cm</span>&nbsp;<span class="ident" id="4269296"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4269309">,</span>&nbsp;<span class="ident" id="4269311">err</span>&nbsp;<span class="builtintype" id="4269315">error</span><span class="op" id="4269320">)</span>&nbsp;<span class="op" id="4269322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269325"><a href="/gostd/net/http/transport.go.html#4269293">cm</a></span><span class="op" id="4269327">.</span><span class="ident" id="4269328"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4269341">=</span>&nbsp;<span class="ident" id="4269343"><a href="/gostd/net/http/transport.go.html#4269268">treq</a></span><span class="op" id="4269347">.</span><span class="ident" id="4269348"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4269351">.</span><span class="ident" id="4269352"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269360"><a href="/gostd/net/http/transport.go.html#4269293">cm</a></span><span class="op" id="4269362">.</span><span class="ident" id="4269363"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span>&nbsp;<span class="op" id="4269374">=</span>&nbsp;<span class="ident" id="4269376"><a href="/gostd/net/http/transport.go.html#4291171">canonicalAddr</a></span><span class="op" id="4269389">(</span><span class="ident" id="4269390"><a href="/gostd/net/http/transport.go.html#4269268">treq</a></span><span class="op" id="4269394">.</span><span class="ident" id="4269395"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4269398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269401">if</span>&nbsp;<span class="ident" id="4269404"><a href="/gostd/net/http/transport.go.html#4269230">t</a></span><span class="op" id="4269405">.</span><span class="ident" id="4269406"><a href="/gostd/net/http/transport.go.html#4261395">Proxy</a></span>&nbsp;<span class="op" id="4269412">!=</span>&nbsp;<span class="builtintype" id="4269415">nil</span>&nbsp;<span class="op" id="4269419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269423"><a href="/gostd/net/http/transport.go.html#4269293">cm</a></span><span class="op" id="4269425">.</span><span class="ident" id="4269426"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span><span class="op" id="4269434">,</span>&nbsp;<span class="ident" id="4269436"><a href="/gostd/net/http/transport.go.html#4269311">err</a></span>&nbsp;<span class="op" id="4269440">=</span>&nbsp;<span class="ident" id="4269442"><a href="/gostd/net/http/transport.go.html#4269230">t</a></span><span class="op" id="4269443">.</span><span class="ident" id="4269444"><a href="/gostd/net/http/transport.go.html#4261395">Proxy</a></span><span class="op" id="4269449">(</span><span class="ident" id="4269450"><a href="/gostd/net/http/transport.go.html#4269268">treq</a></span><span class="op" id="4269454">.</span><span class="ident" id="4269455"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4269462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4269465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269468">return</span>&nbsp;<span class="ident" id="4269475"><a href="/gostd/net/http/transport.go.html#4269293">cm</a></span><span class="op" id="4269477">,</span>&nbsp;<span class="ident" id="4269479"><a href="/gostd/net/http/transport.go.html#4269311">err</a></span><br>
<span class="lineno">340</span><span class="op" id="4269483">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4269486">//&nbsp;proxyAuth&nbsp;returns&nbsp;the&nbsp;Proxy-Authorization&nbsp;header&nbsp;to&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="4269545">//&nbsp;on&nbsp;requests,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="4269576">func</span>&nbsp;<span class="op" id="4269581">(</span><span class="ident" id="4269582">cm</span>&nbsp;<span class="op" id="4269585">*</span><span class="ident" id="4269586"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4269599">)</span>&nbsp;<span class="ident" id="4269601">proxyAuth</span><span class="op" id="4269610">(</span><span class="op" id="4269611">)</span>&nbsp;<span class="builtintype" id="4269613">string</span>&nbsp;<span class="op" id="4269620">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269623">if</span>&nbsp;<span class="ident" id="4269626"><a href="/gostd/net/http/transport.go.html#4269582">cm</a></span><span class="op" id="4269628">.</span><span class="ident" id="4269629"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4269638">==</span>&nbsp;<span class="builtintype" id="4269641">nil</span>&nbsp;<span class="op" id="4269645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269649">return</span>&nbsp;<span class="string" id="4269656">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4269660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269663">if</span>&nbsp;<span class="ident" id="4269666">u</span>&nbsp;<span class="op" id="4269668">:=</span>&nbsp;<span class="ident" id="4269671"><a href="/gostd/net/http/transport.go.html#4269582">cm</a></span><span class="op" id="4269673">.</span><span class="ident" id="4269674"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span><span class="op" id="4269682">.</span><span class="ident" id="4269683"><a href="/gostd/net/url/url.go.html#3751268">User</a></span><span class="op" id="4269687">;</span>&nbsp;<span class="ident" id="4269689"><a href="/gostd/net/http/transport.go.html#4269666">u</a></span>&nbsp;<span class="op" id="4269691">!=</span>&nbsp;<span class="builtintype" id="4269694">nil</span>&nbsp;<span class="op" id="4269698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269702">username</span>&nbsp;<span class="op" id="4269711">:=</span>&nbsp;<span class="ident" id="4269714"><a href="/gostd/net/http/transport.go.html#4269666">u</a></span><span class="op" id="4269715">.</span><span class="ident" id="4269716"><a href="/gostd/net/url/url.go.html#3752535">Username</a></span><span class="op" id="4269724">(</span><span class="op" id="4269725">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4269729">password</span><span class="op" id="4269737">,</span>&nbsp;<span class="ident" id="4269739">_</span>&nbsp;<span class="op" id="4269741">:=</span>&nbsp;<span class="ident" id="4269744"><a href="/gostd/net/http/transport.go.html#4269666">u</a></span><span class="op" id="4269745">.</span><span class="ident" id="4269746"><a href="/gostd/net/url/url.go.html#3752671">Password</a></span><span class="op" id="4269754">(</span><span class="op" id="4269755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269759">return</span>&nbsp;<span class="string" id="4269766">&#34;Basic&nbsp;&#34;</span>&nbsp;<span class="op" id="4269775">+</span>&nbsp;<span class="ident" id="4269777"><a href="/gostd/net/http/client.go.html#4087681">basicAuth</a></span><span class="op" id="4269786">(</span><span class="ident" id="4269787"><a href="/gostd/net/http/transport.go.html#4269702">username</a></span><span class="op" id="4269795">,</span>&nbsp;<span class="ident" id="4269797"><a href="/gostd/net/http/transport.go.html#4269729">password</a></span><span class="op" id="4269805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4269808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4269811">return</span>&nbsp;<span class="string" id="4269818">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4269821">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="4269824">//&nbsp;putIdleConn&nbsp;adds&nbsp;pconn&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;idle&nbsp;persistent&nbsp;connections&nbsp;awaiting</span><br>
<span class="lineno"></span><span class="comment" id="4269902">//&nbsp;a&nbsp;new&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="4269920">//&nbsp;If&nbsp;pconn&nbsp;is&nbsp;no&nbsp;longer&nbsp;needed&nbsp;or&nbsp;not&nbsp;in&nbsp;a&nbsp;good&nbsp;state,&nbsp;putIdleConn</span><br>
<span class="lineno"></span><span class="comment" id="4269988">//&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">360</span><span class="keyword" id="4270006">func</span>&nbsp;<span class="op" id="4270011">(</span><span class="ident" id="4270012">t</span>&nbsp;<span class="op" id="4270014">*</span><span class="ident" id="4270015"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4270024">)</span>&nbsp;<span class="ident" id="4270026">putIdleConn</span><span class="op" id="4270037">(</span><span class="ident" id="4270038">pconn</span>&nbsp;<span class="op" id="4270044">*</span><span class="ident" id="4270045"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4270056">)</span>&nbsp;<span class="builtintype" id="4270058">bool</span>&nbsp;<span class="op" id="4270063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270066">if</span>&nbsp;<span class="ident" id="4270069"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270070">.</span><span class="ident" id="4270071"><a href="/gostd/net/http/transport.go.html#4262473">DisableKeepAlives</a></span>&nbsp;<span class="op" id="4270089">||</span>&nbsp;<span class="ident" id="4270092"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270093">.</span><span class="ident" id="4270094"><a href="/gostd/net/http/transport.go.html#4263098">MaxIdleConnsPerHost</a></span>&nbsp;<span class="op" id="4270114">&lt;</span>&nbsp;<span class="num" id="4270116">0</span>&nbsp;<span class="op" id="4270118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270122"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4270127">.</span><span class="builtinfunc" id="4270128"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4270133">(</span><span class="op" id="4270134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270138">return</span>&nbsp;<span class="builtintype" id="4270145">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270152">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270155">if</span>&nbsp;<span class="ident" id="4270158"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4270163">.</span><span class="ident" id="4270164"><a href="/gostd/net/http/transport.go.html#4281921">isBroken</a></span><span class="op" id="4270172">(</span><span class="op" id="4270173">)</span>&nbsp;<span class="op" id="4270175">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270179">return</span>&nbsp;<span class="builtintype" id="4270186">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270193">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270196">key</span>&nbsp;<span class="op" id="4270200">:=</span>&nbsp;<span class="ident" id="4270203"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4270208">.</span><span class="ident" id="4270209"><a href="/gostd/net/http/transport.go.html#4280633">cacheKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270219">max</span>&nbsp;<span class="op" id="4270223">:=</span>&nbsp;<span class="ident" id="4270226"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270227">.</span><span class="ident" id="4270228"><a href="/gostd/net/http/transport.go.html#4263098">MaxIdleConnsPerHost</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270249">if</span>&nbsp;<span class="ident" id="4270252"><a href="/gostd/net/http/transport.go.html#4270219">max</a></span>&nbsp;<span class="op" id="4270256">==</span>&nbsp;<span class="num" id="4270259">0</span>&nbsp;<span class="op" id="4270261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270265"><a href="/gostd/net/http/transport.go.html#4270219">max</a></span>&nbsp;<span class="op" id="4270269">=</span>&nbsp;<span class="ident" id="4270271"><a href="/gostd/net/http/transport.go.html#4260567">DefaultMaxIdleConnsPerHost</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270302"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270303">.</span><span class="ident" id="4270304"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4270310">.</span><span class="ident" id="4270311"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4270315">(</span><span class="op" id="4270316">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270320">waitingDialer</span>&nbsp;<span class="op" id="4270334">:=</span>&nbsp;<span class="ident" id="4270337"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270338">.</span><span class="ident" id="4270339"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span><span class="op" id="4270349">[</span><span class="ident" id="4270350"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4270353">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270356">select</span>&nbsp;<span class="op" id="4270363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270366">case</span>&nbsp;<span class="ident" id="4270371"><a href="/gostd/net/http/transport.go.html#4270320">waitingDialer</a></span>&nbsp;<span class="op" id="4270385">&lt;-</span>&nbsp;<span class="ident" id="4270388"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4270393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270397">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;pconn&nbsp;and&nbsp;somebody&nbsp;else&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270450">//&nbsp;currently&nbsp;waiting&nbsp;for&nbsp;a&nbsp;conn&nbsp;of&nbsp;this&nbsp;type&nbsp;(they&#39;re</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270506">//&nbsp;actively&nbsp;dialing,&nbsp;but&nbsp;this&nbsp;conn&nbsp;is&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270552">//&nbsp;first).&nbsp;Chrome&nbsp;calls&nbsp;this&nbsp;socket&nbsp;late&nbsp;binding.&nbsp;&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270609">//&nbsp;https://insouciant.org/tech/connection-management-in-chromium/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270677"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270678">.</span><span class="ident" id="4270679"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4270685">.</span><span class="ident" id="4270686"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4270692">(</span><span class="op" id="4270693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270697">return</span>&nbsp;<span class="builtintype" id="4270704">true</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270710">default</span><span class="op" id="4270717">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270721">if</span>&nbsp;<span class="ident" id="4270724"><a href="/gostd/net/http/transport.go.html#4270320">waitingDialer</a></span>&nbsp;<span class="op" id="4270738">!=</span>&nbsp;<span class="builtintype" id="4270741">nil</span>&nbsp;<span class="op" id="4270745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270750">//&nbsp;They&nbsp;had&nbsp;populated&nbsp;this,&nbsp;but&nbsp;their&nbsp;dial&nbsp;won</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4270800">//&nbsp;first,&nbsp;so&nbsp;we&nbsp;can&nbsp;clean&nbsp;up&nbsp;this&nbsp;map&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4270848">delete</span><span class="op" id="4270854">(</span><span class="ident" id="4270855"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270856">.</span><span class="ident" id="4270857"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span><span class="op" id="4270867">,</span>&nbsp;<span class="ident" id="4270869"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4270872">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270882">if</span>&nbsp;<span class="ident" id="4270885"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270886">.</span><span class="ident" id="4270887"><a href="/gostd/net/http/transport.go.html#4260844">wantIdle</a></span>&nbsp;<span class="op" id="4270896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270900"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270901">.</span><span class="ident" id="4270902"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4270908">.</span><span class="ident" id="4270909"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4270915">(</span><span class="op" id="4270916">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270920"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4270925">.</span><span class="builtinfunc" id="4270926"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4270931">(</span><span class="op" id="4270932">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270936">return</span>&nbsp;<span class="builtintype" id="4270943">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4270950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4270953">if</span>&nbsp;<span class="ident" id="4270956"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270957">.</span><span class="ident" id="4270958"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span>&nbsp;<span class="op" id="4270967">==</span>&nbsp;<span class="builtintype" id="4270970">nil</span>&nbsp;<span class="op" id="4270974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4270978"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4270979">.</span><span class="ident" id="4270980"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span>&nbsp;<span class="op" id="4270989">=</span>&nbsp;<span class="builtinfunc" id="4270991">make</span><span class="op" id="4270995">(</span><span class="keyword" id="4270996">map</span><span class="op" id="4270999">[</span><span class="ident" id="4271000"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4271016">]</span><span class="op" id="4271017">[</span><span class="op" id="4271018">]</span><span class="op" id="4271019">*</span><span class="ident" id="4271020"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4271031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271034">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271037">if</span>&nbsp;<span class="builtinfunc" id="4271040">len</span><span class="op" id="4271043">(</span><span class="ident" id="4271044"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271045">.</span><span class="ident" id="4271046"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4271054">[</span><span class="ident" id="4271055"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4271058">]</span><span class="op" id="4271059">)</span>&nbsp;<span class="op" id="4271061">&gt;=</span>&nbsp;<span class="ident" id="4271064"><a href="/gostd/net/http/transport.go.html#4270219">max</a></span>&nbsp;<span class="op" id="4271068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271072"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271073">.</span><span class="ident" id="4271074"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4271080">.</span><span class="ident" id="4271081"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4271087">(</span><span class="op" id="4271088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271092"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4271097">.</span><span class="builtinfunc" id="4271098"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4271103">(</span><span class="op" id="4271104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271108">return</span>&nbsp;<span class="builtintype" id="4271115">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271122">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271125">for</span>&nbsp;<span class="ident" id="4271129">_</span><span class="op" id="4271130">,</span>&nbsp;<span class="ident" id="4271132">exist</span>&nbsp;<span class="op" id="4271138">:=</span>&nbsp;<span class="keyword" id="4271141">range</span>&nbsp;<span class="ident" id="4271147"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271148">.</span><span class="ident" id="4271149"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4271157">[</span><span class="ident" id="4271158"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4271161">]</span>&nbsp;<span class="op" id="4271163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271167">if</span>&nbsp;<span class="ident" id="4271170"><a href="/gostd/net/http/transport.go.html#4271132">exist</a></span>&nbsp;<span class="op" id="4271176">==</span>&nbsp;<span class="ident" id="4271179"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span>&nbsp;<span class="op" id="4271185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271190"><a href="/gostd/net/http/transport.go.html#4259880">log</a></span><span class="op" id="4271193">.</span><span class="ident" id="4271194"><a href="/gostd/log/log.go.html#4079156">Fatalf</a></span><span class="op" id="4271200">(</span><span class="string" id="4271201">&#34;dup&nbsp;idle&nbsp;pconn&nbsp;%p&nbsp;in&nbsp;freelist&#34;</span><span class="op" id="4271232">,</span>&nbsp;<span class="ident" id="4271234"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4271239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271246">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271249"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271250">.</span><span class="ident" id="4271251"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4271259">[</span><span class="ident" id="4271260"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4271263">]</span>&nbsp;<span class="op" id="4271265">=</span>&nbsp;<span class="builtinfunc" id="4271267">append</span><span class="op" id="4271273">(</span><span class="ident" id="4271274"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271275">.</span><span class="ident" id="4271276"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4271284">[</span><span class="ident" id="4271285"><a href="/gostd/net/http/transport.go.html#4270196">key</a></span><span class="op" id="4271288">]</span><span class="op" id="4271289">,</span>&nbsp;<span class="ident" id="4271291"><a href="/gostd/net/http/transport.go.html#4270038">pconn</a></span><span class="op" id="4271296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271299"><a href="/gostd/net/http/transport.go.html#4270012">t</a></span><span class="op" id="4271300">.</span><span class="ident" id="4271301"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4271307">.</span><span class="ident" id="4271308"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4271314">(</span><span class="op" id="4271315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271318">return</span>&nbsp;<span class="builtintype" id="4271325">true</span><br>
<span class="lineno"></span><span class="op" id="4271330">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="4271333">//&nbsp;getIdleConnCh&nbsp;returns&nbsp;a&nbsp;channel&nbsp;to&nbsp;receive&nbsp;and&nbsp;return&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="4271395">//&nbsp;persistent&nbsp;connection&nbsp;for&nbsp;the&nbsp;given&nbsp;connectMethod.</span><br>
<span class="lineno"></span><span class="comment" id="4271449">//&nbsp;It&nbsp;may&nbsp;return&nbsp;nil,&nbsp;if&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;not&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="4271517">func</span>&nbsp;<span class="op" id="4271522">(</span><span class="ident" id="4271523">t</span>&nbsp;<span class="op" id="4271525">*</span><span class="ident" id="4271526"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4271535">)</span>&nbsp;<span class="ident" id="4271537">getIdleConnCh</span><span class="op" id="4271550">(</span><span class="ident" id="4271551">cm</span>&nbsp;<span class="ident" id="4271554"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4271567">)</span>&nbsp;<span class="keyword" id="4271569">chan</span>&nbsp;<span class="op" id="4271574">*</span><span class="ident" id="4271575"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span>&nbsp;<span class="op" id="4271587">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271590">if</span>&nbsp;<span class="ident" id="4271593"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271594">.</span><span class="ident" id="4271595"><a href="/gostd/net/http/transport.go.html#4262473">DisableKeepAlives</a></span>&nbsp;<span class="op" id="4271613">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271617">return</span>&nbsp;<span class="builtintype" id="4271624">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271632">key</span>&nbsp;<span class="op" id="4271636">:=</span>&nbsp;<span class="ident" id="4271639"><a href="/gostd/net/http/transport.go.html#4271551">cm</a></span><span class="op" id="4271641">.</span><span class="ident" id="4271642"><a href="/gostd/net/http/transport.go.html#4279419">key</a></span><span class="op" id="4271645">(</span><span class="op" id="4271646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271649"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271650">.</span><span class="ident" id="4271651"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4271657">.</span><span class="ident" id="4271658"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4271662">(</span><span class="op" id="4271663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271666">defer</span>&nbsp;<span class="ident" id="4271672"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271673">.</span><span class="ident" id="4271674"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4271680">.</span><span class="ident" id="4271681"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4271687">(</span><span class="op" id="4271688">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271691"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271692">.</span><span class="ident" id="4271693"><a href="/gostd/net/http/transport.go.html#4260844">wantIdle</a></span>&nbsp;<span class="op" id="4271702">=</span>&nbsp;<span class="builtintype" id="4271704">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271711">if</span>&nbsp;<span class="ident" id="4271714"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271715">.</span><span class="ident" id="4271716"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span>&nbsp;<span class="op" id="4271727">==</span>&nbsp;<span class="builtintype" id="4271730">nil</span>&nbsp;<span class="op" id="4271734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271738"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271739">.</span><span class="ident" id="4271740"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span>&nbsp;<span class="op" id="4271751">=</span>&nbsp;<span class="builtinfunc" id="4271753">make</span><span class="op" id="4271757">(</span><span class="keyword" id="4271758">map</span><span class="op" id="4271761">[</span><span class="ident" id="4271762"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4271778">]</span><span class="keyword" id="4271779">chan</span>&nbsp;<span class="op" id="4271784">*</span><span class="ident" id="4271785"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4271796">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271802">ch</span><span class="op" id="4271804">,</span>&nbsp;<span class="ident" id="4271806">ok</span>&nbsp;<span class="op" id="4271809">:=</span>&nbsp;<span class="ident" id="4271812"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271813">.</span><span class="ident" id="4271814"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span><span class="op" id="4271824">[</span><span class="ident" id="4271825"><a href="/gostd/net/http/transport.go.html#4271632">key</a></span><span class="op" id="4271828">]</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271831">if</span>&nbsp;<span class="op" id="4271834">!</span><span class="ident" id="4271835"><a href="/gostd/net/http/transport.go.html#4271806">ok</a></span>&nbsp;<span class="op" id="4271838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271842"><a href="/gostd/net/http/transport.go.html#4271802">ch</a></span>&nbsp;<span class="op" id="4271845">=</span>&nbsp;<span class="builtinfunc" id="4271847">make</span><span class="op" id="4271851">(</span><span class="keyword" id="4271852">chan</span>&nbsp;<span class="op" id="4271857">*</span><span class="ident" id="4271858"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4271869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271873"><a href="/gostd/net/http/transport.go.html#4271523">t</a></span><span class="op" id="4271874">.</span><span class="ident" id="4271875"><a href="/gostd/net/http/transport.go.html#4260955">idleConnCh</a></span><span class="op" id="4271885">[</span><span class="ident" id="4271886"><a href="/gostd/net/http/transport.go.html#4271632">key</a></span><span class="op" id="4271889">]</span>&nbsp;<span class="op" id="4271891">=</span>&nbsp;<span class="ident" id="4271893"><a href="/gostd/net/http/transport.go.html#4271802">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4271897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4271900">return</span>&nbsp;<span class="ident" id="4271907"><a href="/gostd/net/http/transport.go.html#4271802">ch</a></span><br>
<span class="lineno">435</span><span class="op" id="4271910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4271913">func</span>&nbsp;<span class="op" id="4271918">(</span><span class="ident" id="4271919">t</span>&nbsp;<span class="op" id="4271921">*</span><span class="ident" id="4271922"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4271931">)</span>&nbsp;<span class="ident" id="4271933">getIdleConn</span><span class="op" id="4271944">(</span><span class="ident" id="4271945">cm</span>&nbsp;<span class="ident" id="4271948"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4271961">)</span>&nbsp;<span class="op" id="4271963">(</span><span class="ident" id="4271964">pconn</span>&nbsp;<span class="op" id="4271970">*</span><span class="ident" id="4271971"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4271982">)</span>&nbsp;<span class="op" id="4271984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4271987">key</span>&nbsp;<span class="op" id="4271991">:=</span>&nbsp;<span class="ident" id="4271994"><a href="/gostd/net/http/transport.go.html#4271945">cm</a></span><span class="op" id="4271996">.</span><span class="ident" id="4271997"><a href="/gostd/net/http/transport.go.html#4279419">key</a></span><span class="op" id="4272000">(</span><span class="op" id="4272001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272004"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272005">.</span><span class="ident" id="4272006"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4272012">.</span><span class="ident" id="4272013"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4272017">(</span><span class="op" id="4272018">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272021">defer</span>&nbsp;<span class="ident" id="4272027"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272028">.</span><span class="ident" id="4272029"><a href="/gostd/net/http/transport.go.html#4260821">idleMu</a></span><span class="op" id="4272035">.</span><span class="ident" id="4272036"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4272042">(</span><span class="op" id="4272043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272046">if</span>&nbsp;<span class="ident" id="4272049"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272050">.</span><span class="ident" id="4272051"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span>&nbsp;<span class="op" id="4272060">==</span>&nbsp;<span class="builtintype" id="4272063">nil</span>&nbsp;<span class="op" id="4272067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272071">return</span>&nbsp;<span class="builtintype" id="4272078">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272086">for</span>&nbsp;<span class="op" id="4272090">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272094">pconns</span><span class="op" id="4272100">,</span>&nbsp;<span class="ident" id="4272102">ok</span>&nbsp;<span class="op" id="4272105">:=</span>&nbsp;<span class="ident" id="4272108"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272109">.</span><span class="ident" id="4272110"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4272118">[</span><span class="ident" id="4272119"><a href="/gostd/net/http/transport.go.html#4271987">key</a></span><span class="op" id="4272122">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272126">if</span>&nbsp;<span class="op" id="4272129">!</span><span class="ident" id="4272130"><a href="/gostd/net/http/transport.go.html#4272102">ok</a></span>&nbsp;<span class="op" id="4272133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272138">return</span>&nbsp;<span class="builtintype" id="4272145">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272155">if</span>&nbsp;<span class="builtinfunc" id="4272158">len</span><span class="op" id="4272161">(</span><span class="ident" id="4272162"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272168">)</span>&nbsp;<span class="op" id="4272170">==</span>&nbsp;<span class="num" id="4272173">1</span>&nbsp;<span class="op" id="4272175">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272180"><a href="/gostd/net/http/transport.go.html#4271964">pconn</a></span>&nbsp;<span class="op" id="4272186">=</span>&nbsp;<span class="ident" id="4272188"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272194">[</span><span class="num" id="4272195">0</span><span class="op" id="4272196">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4272201">delete</span><span class="op" id="4272207">(</span><span class="ident" id="4272208"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272209">.</span><span class="ident" id="4272210"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4272218">,</span>&nbsp;<span class="ident" id="4272220"><a href="/gostd/net/http/transport.go.html#4271987">key</a></span><span class="op" id="4272223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272227">}</span>&nbsp;<span class="keyword" id="4272229">else</span>&nbsp;<span class="op" id="4272234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4272239">//&nbsp;2&nbsp;or&nbsp;more&nbsp;cached&nbsp;connections;&nbsp;pop&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4272284">//&nbsp;TODO:&nbsp;queue?</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272303"><a href="/gostd/net/http/transport.go.html#4271964">pconn</a></span>&nbsp;<span class="op" id="4272309">=</span>&nbsp;<span class="ident" id="4272311"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272317">[</span><span class="builtinfunc" id="4272318">len</span><span class="op" id="4272321">(</span><span class="ident" id="4272322"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272328">)</span><span class="op" id="4272329">-</span><span class="num" id="4272330">1</span><span class="op" id="4272331">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272336"><a href="/gostd/net/http/transport.go.html#4271919">t</a></span><span class="op" id="4272337">.</span><span class="ident" id="4272338"><a href="/gostd/net/http/transport.go.html#4260907">idleConn</a></span><span class="op" id="4272346">[</span><span class="ident" id="4272347"><a href="/gostd/net/http/transport.go.html#4271987">key</a></span><span class="op" id="4272350">]</span>&nbsp;<span class="op" id="4272352">=</span>&nbsp;<span class="ident" id="4272354"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272360">[</span><span class="op" id="4272361">:</span><span class="builtinfunc" id="4272362">len</span><span class="op" id="4272365">(</span><span class="ident" id="4272366"><a href="/gostd/net/http/transport.go.html#4272094">pconns</a></span><span class="op" id="4272372">)</span><span class="op" id="4272373">-</span><span class="num" id="4272374">1</span><span class="op" id="4272375">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272383">if</span>&nbsp;<span class="op" id="4272386">!</span><span class="ident" id="4272387"><a href="/gostd/net/http/transport.go.html#4271964">pconn</a></span><span class="op" id="4272392">.</span><span class="ident" id="4272393"><a href="/gostd/net/http/transport.go.html#4281921">isBroken</a></span><span class="op" id="4272401">(</span><span class="op" id="4272402">)</span>&nbsp;<span class="op" id="4272404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272409">return</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272421">}</span><br>
<span class="lineno"></span><span class="op" id="4272423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4272426">func</span>&nbsp;<span class="op" id="4272431">(</span><span class="ident" id="4272432">t</span>&nbsp;<span class="op" id="4272434">*</span><span class="ident" id="4272435"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4272444">)</span>&nbsp;<span class="ident" id="4272446">setReqCanceler</span><span class="op" id="4272460">(</span><span class="ident" id="4272461">r</span>&nbsp;<span class="op" id="4272463">*</span><span class="ident" id="4272464"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4272471">,</span>&nbsp;<span class="ident" id="4272473">fn</span>&nbsp;<span class="keyword" id="4272476">func</span><span class="op" id="4272480">(</span><span class="op" id="4272481">)</span><span class="op" id="4272482">)</span>&nbsp;<span class="op" id="4272484">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272487"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272488">.</span><span class="ident" id="4272489"><a href="/gostd/net/http/transport.go.html#4261007">reqMu</a></span><span class="op" id="4272494">.</span><span class="ident" id="4272495"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4272499">(</span><span class="op" id="4272500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272503">defer</span>&nbsp;<span class="ident" id="4272509"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272510">.</span><span class="ident" id="4272511"><a href="/gostd/net/http/transport.go.html#4261007">reqMu</a></span><span class="op" id="4272516">.</span><span class="ident" id="4272517"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4272523">(</span><span class="op" id="4272524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272527">if</span>&nbsp;<span class="ident" id="4272530"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272531">.</span><span class="ident" id="4272532"><a href="/gostd/net/http/transport.go.html#4261031">reqCanceler</a></span>&nbsp;<span class="op" id="4272544">==</span>&nbsp;<span class="builtintype" id="4272547">nil</span>&nbsp;<span class="op" id="4272551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272555"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272556">.</span><span class="ident" id="4272557"><a href="/gostd/net/http/transport.go.html#4261031">reqCanceler</a></span>&nbsp;<span class="op" id="4272569">=</span>&nbsp;<span class="builtinfunc" id="4272571">make</span><span class="op" id="4272575">(</span><span class="keyword" id="4272576">map</span><span class="op" id="4272579">[</span><span class="op" id="4272580">*</span><span class="ident" id="4272581"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4272588">]</span><span class="keyword" id="4272589">func</span><span class="op" id="4272593">(</span><span class="op" id="4272594">)</span><span class="op" id="4272595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272598">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272601">if</span>&nbsp;<span class="ident" id="4272604"><a href="/gostd/net/http/transport.go.html#4272473">fn</a></span>&nbsp;<span class="op" id="4272607">!=</span>&nbsp;<span class="builtintype" id="4272610">nil</span>&nbsp;<span class="op" id="4272614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4272618"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272619">.</span><span class="ident" id="4272620"><a href="/gostd/net/http/transport.go.html#4261031">reqCanceler</a></span><span class="op" id="4272631">[</span><span class="ident" id="4272632"><a href="/gostd/net/http/transport.go.html#4272461">r</a></span><span class="op" id="4272633">]</span>&nbsp;<span class="op" id="4272635">=</span>&nbsp;<span class="ident" id="4272637"><a href="/gostd/net/http/transport.go.html#4272473">fn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272641">}</span>&nbsp;<span class="keyword" id="4272643">else</span>&nbsp;<span class="op" id="4272648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4272652">delete</span><span class="op" id="4272658">(</span><span class="ident" id="4272659"><a href="/gostd/net/http/transport.go.html#4272432">t</a></span><span class="op" id="4272660">.</span><span class="ident" id="4272661"><a href="/gostd/net/http/transport.go.html#4261031">reqCanceler</a></span><span class="op" id="4272672">,</span>&nbsp;<span class="ident" id="4272674"><a href="/gostd/net/http/transport.go.html#4272461">r</a></span><span class="op" id="4272675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272678">}</span><br>
<span class="lineno">475</span><span class="op" id="4272680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4272683">func</span>&nbsp;<span class="op" id="4272688">(</span><span class="ident" id="4272689">t</span>&nbsp;<span class="op" id="4272691">*</span><span class="ident" id="4272692"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4272701">)</span>&nbsp;<span class="ident" id="4272703">dial</span><span class="op" id="4272707">(</span><span class="ident" id="4272708">network</span><span class="op" id="4272715">,</span>&nbsp;<span class="ident" id="4272717">addr</span>&nbsp;<span class="builtintype" id="4272722">string</span><span class="op" id="4272728">)</span>&nbsp;<span class="op" id="4272730">(</span><span class="ident" id="4272731">c</span>&nbsp;<span class="ident" id="4272733"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4272736">.</span><span class="ident" id="4272737"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><span class="op" id="4272741">,</span>&nbsp;<span class="ident" id="4272743">err</span>&nbsp;<span class="builtintype" id="4272747">error</span><span class="op" id="4272752">)</span>&nbsp;<span class="op" id="4272754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272757">if</span>&nbsp;<span class="ident" id="4272760"><a href="/gostd/net/http/transport.go.html#4272689">t</a></span><span class="op" id="4272761">.</span><span class="ident" id="4272762"><a href="/gostd/net/http/transport.go.html#4261557">Dial</a></span>&nbsp;<span class="op" id="4272767">!=</span>&nbsp;<span class="builtintype" id="4272770">nil</span>&nbsp;<span class="op" id="4272774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272778">return</span>&nbsp;<span class="ident" id="4272785"><a href="/gostd/net/http/transport.go.html#4272689">t</a></span><span class="op" id="4272786">.</span><span class="ident" id="4272787"><a href="/gostd/net/http/transport.go.html#4261557">Dial</a></span><span class="op" id="4272791">(</span><span class="ident" id="4272792"><a href="/gostd/net/http/transport.go.html#4272708">network</a></span><span class="op" id="4272799">,</span>&nbsp;<span class="ident" id="4272801"><a href="/gostd/net/http/transport.go.html#4272717">addr</a></span><span class="op" id="4272805">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4272808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4272811">return</span>&nbsp;<span class="ident" id="4272818"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4272821">.</span><span class="ident" id="4272822"><a href="/gostd/net/dial.go.html#3203459">Dial</a></span><span class="op" id="4272826">(</span><span class="ident" id="4272827"><a href="/gostd/net/http/transport.go.html#4272708">network</a></span><span class="op" id="4272834">,</span>&nbsp;<span class="ident" id="4272836"><a href="/gostd/net/http/transport.go.html#4272717">addr</a></span><span class="op" id="4272840">)</span><br>
<span class="lineno"></span><span class="op" id="4272842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4272845">//&nbsp;Testing&nbsp;hooks:</span><br>
<span class="lineno">485</span><span class="keyword" id="4272863">var</span>&nbsp;<span class="ident" id="4272867">prePendingDial</span><span class="op" id="4272881">,</span>&nbsp;<span class="ident" id="4272883">postPendingDial</span>&nbsp;<span class="keyword" id="4272899">func</span><span class="op" id="4272903">(</span><span class="op" id="4272904">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4272907">//&nbsp;getConn&nbsp;dials&nbsp;and&nbsp;creates&nbsp;a&nbsp;new&nbsp;persistConn&nbsp;to&nbsp;the&nbsp;target&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="4272971">//&nbsp;specified&nbsp;in&nbsp;the&nbsp;connectMethod.&nbsp;&nbsp;This&nbsp;includes&nbsp;doing&nbsp;a&nbsp;proxy&nbsp;CONNECT</span><br>
<span class="lineno"></span><span class="comment" id="4273043">//&nbsp;and/or&nbsp;setting&nbsp;up&nbsp;TLS.&nbsp;&nbsp;If&nbsp;this&nbsp;doesn&#39;t&nbsp;return&nbsp;an&nbsp;error,&nbsp;the&nbsp;persistConn</span><br>
<span class="lineno">490</span><span class="comment" id="4273119">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;write&nbsp;requests&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="4273153">func</span>&nbsp;<span class="op" id="4273158">(</span><span class="ident" id="4273159">t</span>&nbsp;<span class="op" id="4273161">*</span><span class="ident" id="4273162"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4273171">)</span>&nbsp;<span class="ident" id="4273173">getConn</span><span class="op" id="4273180">(</span><span class="ident" id="4273181">req</span>&nbsp;<span class="op" id="4273185">*</span><span class="ident" id="4273186"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4273193">,</span>&nbsp;<span class="ident" id="4273195">cm</span>&nbsp;<span class="ident" id="4273198"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4273211">)</span>&nbsp;<span class="op" id="4273213">(</span><span class="op" id="4273214">*</span><span class="ident" id="4273215"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4273226">,</span>&nbsp;<span class="builtintype" id="4273228">error</span><span class="op" id="4273233">)</span>&nbsp;<span class="op" id="4273235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273238">if</span>&nbsp;<span class="ident" id="4273241">pc</span>&nbsp;<span class="op" id="4273244">:=</span>&nbsp;<span class="ident" id="4273247"><a href="/gostd/net/http/transport.go.html#4273159">t</a></span><span class="op" id="4273248">.</span><span class="ident" id="4273249"><a href="/gostd/net/http/transport.go.html#4271933">getIdleConn</a></span><span class="op" id="4273260">(</span><span class="ident" id="4273261"><a href="/gostd/net/http/transport.go.html#4273195">cm</a></span><span class="op" id="4273263">)</span><span class="op" id="4273264">;</span>&nbsp;<span class="ident" id="4273266"><a href="/gostd/net/http/transport.go.html#4273241">pc</a></span>&nbsp;<span class="op" id="4273269">!=</span>&nbsp;<span class="builtintype" id="4273272">nil</span>&nbsp;<span class="op" id="4273276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273280">return</span>&nbsp;<span class="ident" id="4273287"><a href="/gostd/net/http/transport.go.html#4273241">pc</a></span><span class="op" id="4273289">,</span>&nbsp;<span class="builtintype" id="4273291">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273296">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273300">type</span>&nbsp;<span class="ident" id="4273305">dialRes</span>&nbsp;<span class="keyword" id="4273313">struct</span>&nbsp;<span class="op" id="4273320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273324">pc</span>&nbsp;&nbsp;<span class="op" id="4273328">*</span><span class="ident" id="4273329"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273343">err</span>&nbsp;<span class="builtintype" id="4273347">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273354">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273357">dialc</span>&nbsp;<span class="op" id="4273363">:=</span>&nbsp;<span class="builtinfunc" id="4273366">make</span><span class="op" id="4273370">(</span><span class="keyword" id="4273371">chan</span>&nbsp;<span class="ident" id="4273376"><a href="/gostd/net/http/transport.go.html#4273305">dialRes</a></span><span class="op" id="4273383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273387">handlePendingDial</span>&nbsp;<span class="op" id="4273405">:=</span>&nbsp;<span class="keyword" id="4273408">func</span><span class="op" id="4273412">(</span><span class="op" id="4273413">)</span>&nbsp;<span class="op" id="4273415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273419">if</span>&nbsp;<span class="ident" id="4273422"><a href="/gostd/net/http/transport.go.html#4272867">prePendingDial</a></span>&nbsp;<span class="op" id="4273437">!=</span>&nbsp;<span class="builtintype" id="4273440">nil</span>&nbsp;<span class="op" id="4273444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273449"><a href="/gostd/net/http/transport.go.html#4272867">prePendingDial</a></span><span class="op" id="4273463">(</span><span class="op" id="4273464">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273472">go</span>&nbsp;<span class="keyword" id="4273475">func</span><span class="op" id="4273479">(</span><span class="op" id="4273480">)</span>&nbsp;<span class="op" id="4273482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273487">if</span>&nbsp;<span class="ident" id="4273490">v</span>&nbsp;<span class="op" id="4273492">:=</span>&nbsp;<span class="op" id="4273495">&lt;-</span><span class="ident" id="4273497"><a href="/gostd/net/http/transport.go.html#4273357">dialc</a></span><span class="op" id="4273502">;</span>&nbsp;<span class="ident" id="4273504"><a href="/gostd/net/http/transport.go.html#4273490">v</a></span><span class="op" id="4273505">.</span><span class="ident" id="4273506"><a href="/gostd/net/http/transport.go.html#4273343">err</a></span>&nbsp;<span class="op" id="4273510">==</span>&nbsp;<span class="builtintype" id="4273513">nil</span>&nbsp;<span class="op" id="4273517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273523"><a href="/gostd/net/http/transport.go.html#4273159">t</a></span><span class="op" id="4273524">.</span><span class="ident" id="4273525"><a href="/gostd/net/http/transport.go.html#4270026">putIdleConn</a></span><span class="op" id="4273536">(</span><span class="ident" id="4273537"><a href="/gostd/net/http/transport.go.html#4273490">v</a></span><span class="op" id="4273538">.</span><span class="ident" id="4273539"><a href="/gostd/net/http/transport.go.html#4273324">pc</a></span><span class="op" id="4273541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273546">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273551">if</span>&nbsp;<span class="ident" id="4273554"><a href="/gostd/net/http/transport.go.html#4272883">postPendingDial</a></span>&nbsp;<span class="op" id="4273570">!=</span>&nbsp;<span class="builtintype" id="4273573">nil</span>&nbsp;<span class="op" id="4273577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273583"><a href="/gostd/net/http/transport.go.html#4272883">postPendingDial</a></span><span class="op" id="4273598">(</span><span class="op" id="4273599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273608">}</span><span class="op" id="4273609">(</span><span class="op" id="4273610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273613">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273617">cancelc</span>&nbsp;<span class="op" id="4273625">:=</span>&nbsp;<span class="builtinfunc" id="4273628">make</span><span class="op" id="4273632">(</span><span class="keyword" id="4273633">chan</span>&nbsp;<span class="keyword" id="4273638">struct</span><span class="op" id="4273644">{</span><span class="op" id="4273645">}</span><span class="op" id="4273646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273649"><a href="/gostd/net/http/transport.go.html#4273159">t</a></span><span class="op" id="4273650">.</span><span class="ident" id="4273651"><a href="/gostd/net/http/transport.go.html#4272446">setReqCanceler</a></span><span class="op" id="4273665">(</span><span class="ident" id="4273666"><a href="/gostd/net/http/transport.go.html#4273181">req</a></span><span class="op" id="4273669">,</span>&nbsp;<span class="keyword" id="4273671">func</span><span class="op" id="4273675">(</span><span class="op" id="4273676">)</span>&nbsp;<span class="op" id="4273678">{</span>&nbsp;<span class="builtinfunc" id="4273680">close</span><span class="op" id="4273685">(</span><span class="ident" id="4273686"><a href="/gostd/net/http/transport.go.html#4273617">cancelc</a></span><span class="op" id="4273693">)</span>&nbsp;<span class="op" id="4273695">}</span><span class="op" id="4273696">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273700">go</span>&nbsp;<span class="keyword" id="4273703">func</span><span class="op" id="4273707">(</span><span class="op" id="4273708">)</span>&nbsp;<span class="op" id="4273710">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273714">pc</span><span class="op" id="4273716">,</span>&nbsp;<span class="ident" id="4273718">err</span>&nbsp;<span class="op" id="4273722">:=</span>&nbsp;<span class="ident" id="4273725"><a href="/gostd/net/http/transport.go.html#4273159">t</a></span><span class="op" id="4273726">.</span><span class="ident" id="4273727"><a href="/gostd/net/http/transport.go.html#4274314">dialConn</a></span><span class="op" id="4273735">(</span><span class="ident" id="4273736"><a href="/gostd/net/http/transport.go.html#4273195">cm</a></span><span class="op" id="4273738">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273742"><a href="/gostd/net/http/transport.go.html#4273357">dialc</a></span>&nbsp;<span class="op" id="4273748">&lt;-</span>&nbsp;<span class="ident" id="4273751"><a href="/gostd/net/http/transport.go.html#4273305">dialRes</a></span><span class="op" id="4273758">{</span><span class="ident" id="4273759"><a href="/gostd/net/http/transport.go.html#4273714">pc</a></span><span class="op" id="4273761">,</span>&nbsp;<span class="ident" id="4273763"><a href="/gostd/net/http/transport.go.html#4273718">err</a></span><span class="op" id="4273766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4273769">}</span><span class="op" id="4273770">(</span><span class="op" id="4273771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4273775">idleConnCh</span>&nbsp;<span class="op" id="4273786">:=</span>&nbsp;<span class="ident" id="4273789"><a href="/gostd/net/http/transport.go.html#4273159">t</a></span><span class="op" id="4273790">.</span><span class="ident" id="4273791"><a href="/gostd/net/http/transport.go.html#4271537">getIdleConnCh</a></span><span class="op" id="4273804">(</span><span class="ident" id="4273805"><a href="/gostd/net/http/transport.go.html#4273195">cm</a></span><span class="op" id="4273807">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273810">select</span>&nbsp;<span class="op" id="4273817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273820">case</span>&nbsp;<span class="ident" id="4273825">v</span>&nbsp;<span class="op" id="4273827">:=</span>&nbsp;<span class="op" id="4273830">&lt;-</span><span class="ident" id="4273832"><a href="/gostd/net/http/transport.go.html#4273357">dialc</a></span><span class="op" id="4273837">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4273841">//&nbsp;Our&nbsp;dial&nbsp;finished.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273865">return</span>&nbsp;<span class="ident" id="4273872"><a href="/gostd/net/http/transport.go.html#4273825">v</a></span><span class="op" id="4273873">.</span><span class="ident" id="4273874"><a href="/gostd/net/http/transport.go.html#4273324">pc</a></span><span class="op" id="4273876">,</span>&nbsp;<span class="ident" id="4273878"><a href="/gostd/net/http/transport.go.html#4273825">v</a></span><span class="op" id="4273879">.</span><span class="ident" id="4273880"><a href="/gostd/net/http/transport.go.html#4273343">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4273885">case</span>&nbsp;<span class="ident" id="4273890">pc</span>&nbsp;<span class="op" id="4273893">:=</span>&nbsp;<span class="op" id="4273896">&lt;-</span><span class="ident" id="4273898"><a href="/gostd/net/http/transport.go.html#4273775">idleConnCh</a></span><span class="op" id="4273908">:</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4273912">//&nbsp;Another&nbsp;request&nbsp;finished&nbsp;first&nbsp;and&nbsp;its&nbsp;net.Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4273965">//&nbsp;became&nbsp;available&nbsp;before&nbsp;our&nbsp;dial.&nbsp;Or&nbsp;somebody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4274016">//&nbsp;else&#39;s&nbsp;dial&nbsp;that&nbsp;they&nbsp;didn&#39;t&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4274055">//&nbsp;But&nbsp;our&nbsp;dial&nbsp;is&nbsp;still&nbsp;going,&nbsp;so&nbsp;give&nbsp;it&nbsp;away</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4274105">//&nbsp;when&nbsp;it&nbsp;finishes:</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274128"><a href="/gostd/net/http/transport.go.html#4273387">handlePendingDial</a></span><span class="op" id="4274145">(</span><span class="op" id="4274146">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274150">return</span>&nbsp;<span class="ident" id="4274157"><a href="/gostd/net/http/transport.go.html#4273890">pc</a></span><span class="op" id="4274159">,</span>&nbsp;<span class="builtintype" id="4274161">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274166">case</span>&nbsp;<span class="op" id="4274171">&lt;-</span><span class="ident" id="4274173"><a href="/gostd/net/http/transport.go.html#4273617">cancelc</a></span><span class="op" id="4274180">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274184"><a href="/gostd/net/http/transport.go.html#4273387">handlePendingDial</a></span><span class="op" id="4274201">(</span><span class="op" id="4274202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274206">return</span>&nbsp;<span class="builtintype" id="4274213">nil</span><span class="op" id="4274216">,</span>&nbsp;<span class="ident" id="4274218"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4274224">.</span><span class="ident" id="4274225"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4274228">(</span><span class="string" id="4274229">&#34;net/http:&nbsp;request&nbsp;canceled&nbsp;while&nbsp;waiting&nbsp;for&nbsp;connection&#34;</span><span class="op" id="4274286">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4274289">}</span><br>
<span class="lineno"></span><span class="op" id="4274291">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4274294">func</span>&nbsp;<span class="op" id="4274299">(</span><span class="ident" id="4274300">t</span>&nbsp;<span class="op" id="4274302">*</span><span class="ident" id="4274303"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><span class="op" id="4274312">)</span>&nbsp;<span class="ident" id="4274314">dialConn</span><span class="op" id="4274322">(</span><span class="ident" id="4274323">cm</span>&nbsp;<span class="ident" id="4274326"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4274339">)</span>&nbsp;<span class="op" id="4274341">(</span><span class="op" id="4274342">*</span><span class="ident" id="4274343"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4274354">,</span>&nbsp;<span class="builtintype" id="4274356">error</span><span class="op" id="4274361">)</span>&nbsp;<span class="op" id="4274363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274366">pconn</span>&nbsp;<span class="op" id="4274372">:=</span>&nbsp;<span class="op" id="4274375">&amp;</span><span class="ident" id="4274376"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4274387">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274391"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4274392">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274403"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4274404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274408"><a href="/gostd/net/http/transport.go.html#4280633">cacheKey</a></span><span class="op" id="4274416">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4274420"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274422">.</span><span class="ident" id="4274423"><a href="/gostd/net/http/transport.go.html#4279419">key</a></span><span class="op" id="4274426">(</span><span class="op" id="4274427">)</span><span class="op" id="4274428">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274432"><a href="/gostd/net/http/transport.go.html#4280879">reqch</a></span><span class="op" id="4274437">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4274444">make</span><span class="op" id="4274448">(</span><span class="keyword" id="4274449">chan</span>&nbsp;<span class="ident" id="4274454"><a href="/gostd/net/http/transport.go.html#4286470">requestAndChan</a></span><span class="op" id="4274468">,</span>&nbsp;<span class="num" id="4274470">1</span><span class="op" id="4274471">)</span><span class="op" id="4274472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274476"><a href="/gostd/net/http/transport.go.html#4280951">writech</a></span><span class="op" id="4274483">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4274488">make</span><span class="op" id="4274492">(</span><span class="keyword" id="4274493">chan</span>&nbsp;<span class="ident" id="4274498"><a href="/gostd/net/http/transport.go.html#4286917">writeRequest</a></span><span class="op" id="4274510">,</span>&nbsp;<span class="num" id="4274512">1</span><span class="op" id="4274513">)</span><span class="op" id="4274514">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274518"><a href="/gostd/net/http/transport.go.html#4281024">closech</a></span><span class="op" id="4274525">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4274530">make</span><span class="op" id="4274534">(</span><span class="keyword" id="4274535">chan</span>&nbsp;<span class="keyword" id="4274540">struct</span><span class="op" id="4274546">{</span><span class="op" id="4274547">}</span><span class="op" id="4274548">)</span><span class="op" id="4274549">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274553"><a href="/gostd/net/http/transport.go.html#4281341">writeErrCh</a></span><span class="op" id="4274563">:</span>&nbsp;<span class="builtinfunc" id="4274565">make</span><span class="op" id="4274569">(</span><span class="keyword" id="4274570">chan</span>&nbsp;<span class="builtintype" id="4274575">error</span><span class="op" id="4274580">,</span>&nbsp;<span class="num" id="4274582">1</span><span class="op" id="4274583">)</span><span class="op" id="4274584">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4274587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274590">tlsDial</span>&nbsp;<span class="op" id="4274598">:=</span>&nbsp;<span class="ident" id="4274601"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4274602">.</span><span class="ident" id="4274603"><a href="/gostd/net/http/transport.go.html#4262000">DialTLS</a></span>&nbsp;<span class="op" id="4274611">!=</span>&nbsp;<span class="builtintype" id="4274614">nil</span>&nbsp;<span class="op" id="4274618">&amp;&amp;</span>&nbsp;<span class="ident" id="4274621"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274623">.</span><span class="ident" id="4274624"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4274637">==</span>&nbsp;<span class="string" id="4274640">&#34;https&#34;</span>&nbsp;<span class="op" id="4274648">&amp;&amp;</span>&nbsp;<span class="ident" id="4274651"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274653">.</span><span class="ident" id="4274654"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4274663">==</span>&nbsp;<span class="builtintype" id="4274666">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274671">if</span>&nbsp;<span class="ident" id="4274674"><a href="/gostd/net/http/transport.go.html#4274590">tlsDial</a></span>&nbsp;<span class="op" id="4274682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274686">var</span>&nbsp;<span class="ident" id="4274690">err</span>&nbsp;<span class="builtintype" id="4274694">error</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274702"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4274707">.</span><span class="ident" id="4274708"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4274712">,</span>&nbsp;<span class="ident" id="4274714"><a href="/gostd/net/http/transport.go.html#4274690">err</a></span>&nbsp;<span class="op" id="4274718">=</span>&nbsp;<span class="ident" id="4274720"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4274721">.</span><span class="ident" id="4274722"><a href="/gostd/net/http/transport.go.html#4262000">DialTLS</a></span><span class="op" id="4274729">(</span><span class="string" id="4274730">&#34;tcp&#34;</span><span class="op" id="4274735">,</span>&nbsp;<span class="ident" id="4274737"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274739">.</span><span class="ident" id="4274740"><a href="/gostd/net/http/transport.go.html#4279808">addr</a></span><span class="op" id="4274744">(</span><span class="op" id="4274745">)</span><span class="op" id="4274746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274750">if</span>&nbsp;<span class="ident" id="4274753"><a href="/gostd/net/http/transport.go.html#4274690">err</a></span>&nbsp;<span class="op" id="4274757">!=</span>&nbsp;<span class="builtintype" id="4274760">nil</span>&nbsp;<span class="op" id="4274764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274769">return</span>&nbsp;<span class="builtintype" id="4274776">nil</span><span class="op" id="4274779">,</span>&nbsp;<span class="ident" id="4274781"><a href="/gostd/net/http/transport.go.html#4274690">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4274787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274791">if</span>&nbsp;<span class="ident" id="4274794">tc</span><span class="op" id="4274796">,</span>&nbsp;<span class="ident" id="4274798">ok</span>&nbsp;<span class="op" id="4274801">:=</span>&nbsp;<span class="ident" id="4274804"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4274809">.</span><span class="ident" id="4274810"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4274814">.</span><span class="op" id="4274815">(</span><span class="op" id="4274816">*</span><span class="ident" id="4274817"><a href="/gostd/net/http/transport.go.html#4259843">tls</a></span><span class="op" id="4274820">.</span><span class="ident" id="4274821"><a href="/gostd/crypto/tls/conn.go.html#4461903">Conn</a></span><span class="op" id="4274825">)</span><span class="op" id="4274826">;</span>&nbsp;<span class="ident" id="4274828"><a href="/gostd/net/http/transport.go.html#4274798">ok</a></span>&nbsp;<span class="op" id="4274831">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274836">cs</span>&nbsp;<span class="op" id="4274839">:=</span>&nbsp;<span class="ident" id="4274842"><a href="/gostd/net/http/transport.go.html#4274794">tc</a></span><span class="op" id="4274844">.</span><span class="ident" id="4274845"><a href="/gostd/crypto/tls/conn.go.html#4488867">ConnectionState</a></span><span class="op" id="4274860">(</span><span class="op" id="4274861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274866"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4274871">.</span><span class="ident" id="4274872"><a href="/gostd/net/http/transport.go.html#4280679">tlsState</a></span>&nbsp;<span class="op" id="4274881">=</span>&nbsp;<span class="op" id="4274883">&amp;</span><span class="ident" id="4274884"><a href="/gostd/net/http/transport.go.html#4274836">cs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4274889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4274892">}</span>&nbsp;<span class="keyword" id="4274894">else</span>&nbsp;<span class="op" id="4274899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274903">conn</span><span class="op" id="4274907">,</span>&nbsp;<span class="ident" id="4274909">err</span>&nbsp;<span class="op" id="4274913">:=</span>&nbsp;<span class="ident" id="4274916"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4274917">.</span><span class="ident" id="4274918"><a href="/gostd/net/http/transport.go.html#4272703">dial</a></span><span class="op" id="4274922">(</span><span class="string" id="4274923">&#34;tcp&#34;</span><span class="op" id="4274928">,</span>&nbsp;<span class="ident" id="4274930"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274932">.</span><span class="ident" id="4274933"><a href="/gostd/net/http/transport.go.html#4279808">addr</a></span><span class="op" id="4274937">(</span><span class="op" id="4274938">)</span><span class="op" id="4274939">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274943">if</span>&nbsp;<span class="ident" id="4274946"><a href="/gostd/net/http/transport.go.html#4274909">err</a></span>&nbsp;<span class="op" id="4274950">!=</span>&nbsp;<span class="builtintype" id="4274953">nil</span>&nbsp;<span class="op" id="4274957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4274962">if</span>&nbsp;<span class="ident" id="4274965"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4274967">.</span><span class="ident" id="4274968"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4274977">!=</span>&nbsp;<span class="builtintype" id="4274980">nil</span>&nbsp;<span class="op" id="4274984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4274990"><a href="/gostd/net/http/transport.go.html#4274909">err</a></span>&nbsp;<span class="op" id="4274994">=</span>&nbsp;<span class="ident" id="4274996"><a href="/gostd/net/http/transport.go.html#4259867">fmt</a></span><span class="op" id="4274999">.</span><span class="ident" id="4275000"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4275006">(</span><span class="string" id="4275007">&#34;http:&nbsp;error&nbsp;connecting&nbsp;to&nbsp;proxy&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="4275047">,</span>&nbsp;<span class="ident" id="4275049"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275051">.</span><span class="ident" id="4275052"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span><span class="op" id="4275060">,</span>&nbsp;<span class="ident" id="4275062"><a href="/gostd/net/http/transport.go.html#4274909">err</a></span><span class="op" id="4275065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275075">return</span>&nbsp;<span class="builtintype" id="4275082">nil</span><span class="op" id="4275085">,</span>&nbsp;<span class="ident" id="4275087"><a href="/gostd/net/http/transport.go.html#4274909">err</a></span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275097"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4275102">.</span><span class="ident" id="4275103"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span>&nbsp;<span class="op" id="4275108">=</span>&nbsp;<span class="ident" id="4275110"><a href="/gostd/net/http/transport.go.html#4274903">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275116">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4275120">//&nbsp;Proxy&nbsp;setup.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275137">switch</span>&nbsp;<span class="op" id="4275144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275147">case</span>&nbsp;<span class="ident" id="4275152"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275154">.</span><span class="ident" id="4275155"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4275164">==</span>&nbsp;<span class="builtintype" id="4275167">nil</span><span class="op" id="4275170">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4275174">//&nbsp;Do&nbsp;nothing.&nbsp;Not&nbsp;using&nbsp;a&nbsp;proxy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275209">case</span>&nbsp;<span class="ident" id="4275214"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275216">.</span><span class="ident" id="4275217"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4275230">==</span>&nbsp;<span class="string" id="4275233">&#34;http&#34;</span><span class="op" id="4275239">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275243"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4275248">.</span><span class="ident" id="4275249"><a href="/gostd/net/http/transport.go.html#4281081">isProxy</a></span>&nbsp;<span class="op" id="4275257">=</span>&nbsp;<span class="builtintype" id="4275259">true</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275266">if</span>&nbsp;<span class="ident" id="4275269">pa</span>&nbsp;<span class="op" id="4275272">:=</span>&nbsp;<span class="ident" id="4275275"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275277">.</span><span class="ident" id="4275278"><a href="/gostd/net/http/transport.go.html#4269601">proxyAuth</a></span><span class="op" id="4275287">(</span><span class="op" id="4275288">)</span><span class="op" id="4275289">;</span>&nbsp;<span class="ident" id="4275291"><a href="/gostd/net/http/transport.go.html#4275269">pa</a></span>&nbsp;<span class="op" id="4275294">!=</span>&nbsp;<span class="string" id="4275297">&#34;&#34;</span>&nbsp;<span class="op" id="4275300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275305"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4275310">.</span><span class="ident" id="4275311"><a href="/gostd/net/http/transport.go.html#4281793">mutateHeaderFunc</a></span>&nbsp;<span class="op" id="4275328">=</span>&nbsp;<span class="keyword" id="4275330">func</span><span class="op" id="4275334">(</span><span class="ident" id="4275335">h</span>&nbsp;<span class="ident" id="4275337"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4275343">)</span>&nbsp;<span class="op" id="4275345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275351"><a href="/gostd/net/http/transport.go.html#4275335">h</a></span><span class="op" id="4275352">.</span><span class="ident" id="4275353"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4275356">(</span><span class="string" id="4275357">&#34;Proxy-Authorization&#34;</span><span class="op" id="4275378">,</span>&nbsp;<span class="ident" id="4275380"><a href="/gostd/net/http/transport.go.html#4275269">pa</a></span><span class="op" id="4275382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275391">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275394">case</span>&nbsp;<span class="ident" id="4275399"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275401">.</span><span class="ident" id="4275402"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4275415">==</span>&nbsp;<span class="string" id="4275418">&#34;https&#34;</span><span class="op" id="4275425">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275429">conn</span>&nbsp;<span class="op" id="4275434">:=</span>&nbsp;<span class="ident" id="4275437"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4275442">.</span><span class="ident" id="4275443"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275450">connectReq</span>&nbsp;<span class="op" id="4275461">:=</span>&nbsp;<span class="op" id="4275464">&amp;</span><span class="ident" id="4275465"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><span class="op" id="4275472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275477"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span><span class="op" id="4275483">:</span>&nbsp;<span class="string" id="4275485">&#34;CONNECT&#34;</span><span class="op" id="4275494">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275499"><a href="/gostd/net/http/request.go.html#4136640">URL</a></span><span class="op" id="4275502">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275507">&amp;</span><span class="ident" id="4275508"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4275511">.</span><span class="ident" id="4275512"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4275515">{</span><span class="ident" id="4275516"><a href="/gostd/net/url/url.go.html#3751225">Opaque</a></span><span class="op" id="4275522">:</span>&nbsp;<span class="ident" id="4275524"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275526">.</span><span class="ident" id="4275527"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span><span class="op" id="4275537">}</span><span class="op" id="4275538">,</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275543"><a href="/gostd/net/http/request.go.html#4139164">Host</a></span><span class="op" id="4275547">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4275551"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275553">.</span><span class="ident" id="4275554"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span><span class="op" id="4275564">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275569"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4275575">:</span>&nbsp;<span class="builtinfunc" id="4275577">make</span><span class="op" id="4275581">(</span><span class="ident" id="4275582"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4275588">)</span><span class="op" id="4275589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275597">if</span>&nbsp;<span class="ident" id="4275600">pa</span>&nbsp;<span class="op" id="4275603">:=</span>&nbsp;<span class="ident" id="4275606"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4275608">.</span><span class="ident" id="4275609"><a href="/gostd/net/http/transport.go.html#4269601">proxyAuth</a></span><span class="op" id="4275618">(</span><span class="op" id="4275619">)</span><span class="op" id="4275620">;</span>&nbsp;<span class="ident" id="4275622"><a href="/gostd/net/http/transport.go.html#4275600">pa</a></span>&nbsp;<span class="op" id="4275625">!=</span>&nbsp;<span class="string" id="4275628">&#34;&#34;</span>&nbsp;<span class="op" id="4275631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275636"><a href="/gostd/net/http/transport.go.html#4275450">connectReq</a></span><span class="op" id="4275646">.</span><span class="ident" id="4275647"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4275653">.</span><span class="ident" id="4275654"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4275657">(</span><span class="string" id="4275658">&#34;Proxy-Authorization&#34;</span><span class="op" id="4275679">,</span>&nbsp;<span class="ident" id="4275681"><a href="/gostd/net/http/transport.go.html#4275600">pa</a></span><span class="op" id="4275683">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275691"><a href="/gostd/net/http/transport.go.html#4275450">connectReq</a></span><span class="op" id="4275701">.</span><span class="ident" id="4275702"><a href="/gostd/net/http/request.go.html#4146008">Write</a></span><span class="op" id="4275707">(</span><span class="ident" id="4275708"><a href="/gostd/net/http/transport.go.html#4275429">conn</a></span><span class="op" id="4275712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4275717">//&nbsp;Read&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4275737">//&nbsp;Okay&nbsp;to&nbsp;use&nbsp;and&nbsp;discard&nbsp;buffered&nbsp;reader&nbsp;here,&nbsp;because</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4275796">//&nbsp;TLS&nbsp;server&nbsp;will&nbsp;not&nbsp;speak&nbsp;until&nbsp;spoken&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275844">br</span>&nbsp;<span class="op" id="4275847">:=</span>&nbsp;<span class="ident" id="4275850"><a href="/gostd/net/http/transport.go.html#4259817">bufio</a></span><span class="op" id="4275855">.</span><span class="ident" id="4275856"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="4275865">(</span><span class="ident" id="4275866"><a href="/gostd/net/http/transport.go.html#4275429">conn</a></span><span class="op" id="4275870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275874">resp</span><span class="op" id="4275878">,</span>&nbsp;<span class="ident" id="4275880">err</span>&nbsp;<span class="op" id="4275884">:=</span>&nbsp;<span class="ident" id="4275887"><a href="/gostd/net/http/response.go.html#4164712">ReadResponse</a></span><span class="op" id="4275899">(</span><span class="ident" id="4275900"><a href="/gostd/net/http/transport.go.html#4275844">br</a></span><span class="op" id="4275902">,</span>&nbsp;<span class="ident" id="4275904"><a href="/gostd/net/http/transport.go.html#4275450">connectReq</a></span><span class="op" id="4275914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275918">if</span>&nbsp;<span class="ident" id="4275921"><a href="/gostd/net/http/transport.go.html#4275880">err</a></span>&nbsp;<span class="op" id="4275925">!=</span>&nbsp;<span class="builtintype" id="4275928">nil</span>&nbsp;<span class="op" id="4275932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4275937"><a href="/gostd/net/http/transport.go.html#4275429">conn</a></span><span class="op" id="4275941">.</span><span class="ident" id="4275942"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4275947">(</span><span class="op" id="4275948">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275953">return</span>&nbsp;<span class="builtintype" id="4275960">nil</span><span class="op" id="4275963">,</span>&nbsp;<span class="ident" id="4275965"><a href="/gostd/net/http/transport.go.html#4275880">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4275971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4275975">if</span>&nbsp;<span class="ident" id="4275978"><a href="/gostd/net/http/transport.go.html#4275874">resp</a></span><span class="op" id="4275982">.</span><span class="ident" id="4275983"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span>&nbsp;<span class="op" id="4275994">!=</span>&nbsp;<span class="num" id="4275997">200</span>&nbsp;<span class="op" id="4276001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276006">f</span>&nbsp;<span class="op" id="4276008">:=</span>&nbsp;<span class="ident" id="4276011"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4276018">.</span><span class="ident" id="4276019"><a href="/gostd/strings/strings.go.html#2972338">SplitN</a></span><span class="op" id="4276025">(</span><span class="ident" id="4276026"><a href="/gostd/net/http/transport.go.html#4275874">resp</a></span><span class="op" id="4276030">.</span><span class="ident" id="4276031"><a href="/gostd/net/http/response.go.html#4161528">Status</a></span><span class="op" id="4276037">,</span>&nbsp;<span class="string" id="4276039">&#34;&nbsp;&#34;</span><span class="op" id="4276042">,</span>&nbsp;<span class="num" id="4276044">2</span><span class="op" id="4276045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276050"><a href="/gostd/net/http/transport.go.html#4275429">conn</a></span><span class="op" id="4276054">.</span><span class="ident" id="4276055"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4276060">(</span><span class="op" id="4276061">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276066">return</span>&nbsp;<span class="builtintype" id="4276073">nil</span><span class="op" id="4276076">,</span>&nbsp;<span class="ident" id="4276078"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4276084">.</span><span class="ident" id="4276085"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4276088">(</span><span class="ident" id="4276089"><a href="/gostd/net/http/transport.go.html#4276006">f</a></span><span class="op" id="4276090">[</span><span class="num" id="4276091">1</span><span class="op" id="4276092">]</span><span class="op" id="4276093">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276097">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276104">if</span>&nbsp;<span class="ident" id="4276107"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4276109">.</span><span class="ident" id="4276110"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4276123">==</span>&nbsp;<span class="string" id="4276126">&#34;https&#34;</span>&nbsp;<span class="op" id="4276134">&amp;&amp;</span>&nbsp;<span class="op" id="4276137">!</span><span class="ident" id="4276138"><a href="/gostd/net/http/transport.go.html#4274590">tlsDial</a></span>&nbsp;<span class="op" id="4276146">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4276150">//&nbsp;Initiate&nbsp;TLS&nbsp;and&nbsp;check&nbsp;remote&nbsp;host&nbsp;name&nbsp;against&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276216">cfg</span>&nbsp;<span class="op" id="4276220">:=</span>&nbsp;<span class="ident" id="4276223"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4276224">.</span><span class="ident" id="4276225"><a href="/gostd/net/http/transport.go.html#4262178">TLSClientConfig</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276243">if</span>&nbsp;<span class="ident" id="4276246"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span>&nbsp;<span class="op" id="4276250">==</span>&nbsp;<span class="builtintype" id="4276253">nil</span>&nbsp;<span class="op" id="4276257">||</span>&nbsp;<span class="ident" id="4276260"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span><span class="op" id="4276263">.</span><span class="ident" id="4276264"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span>&nbsp;<span class="op" id="4276275">==</span>&nbsp;<span class="string" id="4276278">&#34;&#34;</span>&nbsp;<span class="op" id="4276281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276286">host</span>&nbsp;<span class="op" id="4276291">:=</span>&nbsp;<span class="ident" id="4276294"><a href="/gostd/net/http/transport.go.html#4274323">cm</a></span><span class="op" id="4276296">.</span><span class="ident" id="4276297"><a href="/gostd/net/http/transport.go.html#4280019">tlsHost</a></span><span class="op" id="4276304">(</span><span class="op" id="4276305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276310">if</span>&nbsp;<span class="ident" id="4276313"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span>&nbsp;<span class="op" id="4276317">==</span>&nbsp;<span class="builtintype" id="4276320">nil</span>&nbsp;<span class="op" id="4276324">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276330"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span>&nbsp;<span class="op" id="4276334">=</span>&nbsp;<span class="op" id="4276336">&amp;</span><span class="ident" id="4276337"><a href="/gostd/net/http/transport.go.html#4259843">tls</a></span><span class="op" id="4276340">.</span><span class="ident" id="4276341"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4276347">{</span><span class="ident" id="4276348"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4276358">:</span>&nbsp;<span class="ident" id="4276360"><a href="/gostd/net/http/transport.go.html#4276286">host</a></span><span class="op" id="4276364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276369">}</span>&nbsp;<span class="keyword" id="4276371">else</span>&nbsp;<span class="op" id="4276376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276382">clone</span>&nbsp;<span class="op" id="4276388">:=</span>&nbsp;<span class="op" id="4276391">*</span><span class="ident" id="4276392"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span>&nbsp;<span class="comment" id="4276396">//&nbsp;shallow&nbsp;clone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276417"><a href="/gostd/net/http/transport.go.html#4276382">clone</a></span><span class="op" id="4276422">.</span><span class="ident" id="4276423"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span>&nbsp;<span class="op" id="4276434">=</span>&nbsp;<span class="ident" id="4276436"><a href="/gostd/net/http/transport.go.html#4276286">host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276445"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span>&nbsp;<span class="op" id="4276449">=</span>&nbsp;<span class="op" id="4276451">&amp;</span><span class="ident" id="4276452"><a href="/gostd/net/http/transport.go.html#4276382">clone</a></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276469">plainConn</span>&nbsp;<span class="op" id="4276479">:=</span>&nbsp;<span class="ident" id="4276482"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4276487">.</span><span class="ident" id="4276488"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276495">tlsConn</span>&nbsp;<span class="op" id="4276503">:=</span>&nbsp;<span class="ident" id="4276506"><a href="/gostd/net/http/transport.go.html#4259843">tls</a></span><span class="op" id="4276509">.</span><span class="ident" id="4276510"><a href="/gostd/crypto/tls/tls.go.html#4584036">Client</a></span><span class="op" id="4276516">(</span><span class="ident" id="4276517"><a href="/gostd/net/http/transport.go.html#4276469">plainConn</a></span><span class="op" id="4276526">,</span>&nbsp;<span class="ident" id="4276528"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span><span class="op" id="4276531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276535">errc</span>&nbsp;<span class="op" id="4276540">:=</span>&nbsp;<span class="builtinfunc" id="4276543">make</span><span class="op" id="4276547">(</span><span class="keyword" id="4276548">chan</span>&nbsp;<span class="builtintype" id="4276553">error</span><span class="op" id="4276558">,</span>&nbsp;<span class="num" id="4276560">2</span><span class="op" id="4276561">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276565">var</span>&nbsp;<span class="ident" id="4276569">timer</span>&nbsp;<span class="op" id="4276575">*</span><span class="ident" id="4276576"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4276580">.</span><span class="ident" id="4276581"><a href="/gostd/time/sleep.go.html#2715079">Timer</a></span>&nbsp;<span class="comment" id="4276587">//&nbsp;for&nbsp;canceling&nbsp;TLS&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276620">if</span>&nbsp;<span class="ident" id="4276623">d</span>&nbsp;<span class="op" id="4276625">:=</span>&nbsp;<span class="ident" id="4276628"><a href="/gostd/net/http/transport.go.html#4274300">t</a></span><span class="op" id="4276629">.</span><span class="ident" id="4276630"><a href="/gostd/net/http/transport.go.html#4262333">TLSHandshakeTimeout</a></span><span class="op" id="4276649">;</span>&nbsp;<span class="ident" id="4276651"><a href="/gostd/net/http/transport.go.html#4276623">d</a></span>&nbsp;<span class="op" id="4276653">!=</span>&nbsp;<span class="num" id="4276656">0</span>&nbsp;<span class="op" id="4276658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276663"><a href="/gostd/net/http/transport.go.html#4276569">timer</a></span>&nbsp;<span class="op" id="4276669">=</span>&nbsp;<span class="ident" id="4276671"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4276675">.</span><span class="ident" id="4276676"><a href="/gostd/time/sleep.go.html#2716875">AfterFunc</a></span><span class="op" id="4276685">(</span><span class="ident" id="4276686"><a href="/gostd/net/http/transport.go.html#4276623">d</a></span><span class="op" id="4276687">,</span>&nbsp;<span class="keyword" id="4276689">func</span><span class="op" id="4276693">(</span><span class="op" id="4276694">)</span>&nbsp;<span class="op" id="4276696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276702"><a href="/gostd/net/http/transport.go.html#4276535">errc</a></span>&nbsp;<span class="op" id="4276707">&lt;-</span>&nbsp;<span class="ident" id="4276710"><a href="/gostd/net/http/transport.go.html#4293355">tlsHandshakeTimeoutError</a></span><span class="op" id="4276734">{</span><span class="op" id="4276735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276740">}</span><span class="op" id="4276741">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276749">go</span>&nbsp;<span class="keyword" id="4276752">func</span><span class="op" id="4276756">(</span><span class="op" id="4276757">)</span>&nbsp;<span class="op" id="4276759">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276764">err</span>&nbsp;<span class="op" id="4276768">:=</span>&nbsp;<span class="ident" id="4276771"><a href="/gostd/net/http/transport.go.html#4276495">tlsConn</a></span><span class="op" id="4276778">.</span><span class="ident" id="4276779"><a href="/gostd/crypto/tls/conn.go.html#4488474">Handshake</a></span><span class="op" id="4276788">(</span><span class="op" id="4276789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276794">if</span>&nbsp;<span class="ident" id="4276797"><a href="/gostd/net/http/transport.go.html#4276569">timer</a></span>&nbsp;<span class="op" id="4276803">!=</span>&nbsp;<span class="builtintype" id="4276806">nil</span>&nbsp;<span class="op" id="4276810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276816"><a href="/gostd/net/http/transport.go.html#4276569">timer</a></span><span class="op" id="4276821">.</span><span class="ident" id="4276822"><a href="/gostd/time/sleep.go.html#2715389">Stop</a></span><span class="op" id="4276826">(</span><span class="op" id="4276827">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276837"><a href="/gostd/net/http/transport.go.html#4276535">errc</a></span>&nbsp;<span class="op" id="4276842">&lt;-</span>&nbsp;<span class="ident" id="4276845"><a href="/gostd/net/http/transport.go.html#4276764">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276851">}</span><span class="op" id="4276852">(</span><span class="op" id="4276853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276857">if</span>&nbsp;<span class="ident" id="4276860">err</span>&nbsp;<span class="op" id="4276864">:=</span>&nbsp;<span class="op" id="4276867">&lt;-</span><span class="ident" id="4276869"><a href="/gostd/net/http/transport.go.html#4276535">errc</a></span><span class="op" id="4276873">;</span>&nbsp;<span class="ident" id="4276875"><a href="/gostd/net/http/transport.go.html#4276860">err</a></span>&nbsp;<span class="op" id="4276879">!=</span>&nbsp;<span class="builtintype" id="4276882">nil</span>&nbsp;<span class="op" id="4276886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4276891"><a href="/gostd/net/http/transport.go.html#4276469">plainConn</a></span><span class="op" id="4276900">.</span><span class="ident" id="4276901"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4276906">(</span><span class="op" id="4276907">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276912">return</span>&nbsp;<span class="builtintype" id="4276919">nil</span><span class="op" id="4276922">,</span>&nbsp;<span class="ident" id="4276924"><a href="/gostd/net/http/transport.go.html#4276860">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4276930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276934">if</span>&nbsp;<span class="op" id="4276937">!</span><span class="ident" id="4276938"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span><span class="op" id="4276941">.</span><span class="ident" id="4276942"><a href="/gostd/crypto/tls/common.go.html#4452970">InsecureSkipVerify</a></span>&nbsp;<span class="op" id="4276961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4276966">if</span>&nbsp;<span class="ident" id="4276969">err</span>&nbsp;<span class="op" id="4276973">:=</span>&nbsp;<span class="ident" id="4276976"><a href="/gostd/net/http/transport.go.html#4276495">tlsConn</a></span><span class="op" id="4276983">.</span><span class="ident" id="4276984"><a href="/gostd/crypto/tls/conn.go.html#4489901">VerifyHostname</a></span><span class="op" id="4276998">(</span><span class="ident" id="4276999"><a href="/gostd/net/http/transport.go.html#4276216">cfg</a></span><span class="op" id="4277002">.</span><span class="ident" id="4277003"><a href="/gostd/crypto/tls/common.go.html#4452279">ServerName</a></span><span class="op" id="4277013">)</span><span class="op" id="4277014">;</span>&nbsp;<span class="ident" id="4277016"><a href="/gostd/net/http/transport.go.html#4276969">err</a></span>&nbsp;<span class="op" id="4277020">!=</span>&nbsp;<span class="builtintype" id="4277023">nil</span>&nbsp;<span class="op" id="4277027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277033"><a href="/gostd/net/http/transport.go.html#4276469">plainConn</a></span><span class="op" id="4277042">.</span><span class="ident" id="4277043"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4277048">(</span><span class="op" id="4277049">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277055">return</span>&nbsp;<span class="builtintype" id="4277062">nil</span><span class="op" id="4277065">,</span>&nbsp;<span class="ident" id="4277067"><a href="/gostd/net/http/transport.go.html#4276969">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277082">cs</span>&nbsp;<span class="op" id="4277085">:=</span>&nbsp;<span class="ident" id="4277088"><a href="/gostd/net/http/transport.go.html#4276495">tlsConn</a></span><span class="op" id="4277095">.</span><span class="ident" id="4277096"><a href="/gostd/crypto/tls/conn.go.html#4488867">ConnectionState</a></span><span class="op" id="4277111">(</span><span class="op" id="4277112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277116"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277121">.</span><span class="ident" id="4277122"><a href="/gostd/net/http/transport.go.html#4280679">tlsState</a></span>&nbsp;<span class="op" id="4277131">=</span>&nbsp;<span class="op" id="4277133">&amp;</span><span class="ident" id="4277134"><a href="/gostd/net/http/transport.go.html#4277082">cs</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277139"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277144">.</span><span class="ident" id="4277145"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span>&nbsp;<span class="op" id="4277150">=</span>&nbsp;<span class="ident" id="4277152"><a href="/gostd/net/http/transport.go.html#4276495">tlsConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277165"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277170">.</span><span class="ident" id="4277171"><a href="/gostd/net/http/transport.go.html#4280710">br</a></span>&nbsp;<span class="op" id="4277174">=</span>&nbsp;<span class="ident" id="4277176"><a href="/gostd/net/http/transport.go.html#4259817">bufio</a></span><span class="op" id="4277181">.</span><span class="ident" id="4277182"><a href="/gostd/bufio/bufio.go.html#1355792">NewReader</a></span><span class="op" id="4277191">(</span><span class="ident" id="4277192"><a href="/gostd/net/http/transport.go.html#4293620">noteEOFReader</a></span><span class="op" id="4277205">{</span><span class="ident" id="4277206"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277211">.</span><span class="ident" id="4277212"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4277216">,</span>&nbsp;<span class="op" id="4277218">&amp;</span><span class="ident" id="4277219"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277224">.</span><span class="ident" id="4277225"><a href="/gostd/net/http/transport.go.html#4280753">sawEOF</a></span><span class="op" id="4277231">}</span><span class="op" id="4277232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277235"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277240">.</span><span class="ident" id="4277241"><a href="/gostd/net/http/transport.go.html#4280838">bw</a></span>&nbsp;<span class="op" id="4277244">=</span>&nbsp;<span class="ident" id="4277246"><a href="/gostd/net/http/transport.go.html#4259817">bufio</a></span><span class="op" id="4277251">.</span><span class="ident" id="4277252"><a href="/gostd/bufio/bufio.go.html#1367149">NewWriter</a></span><span class="op" id="4277261">(</span><span class="ident" id="4277262"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277267">.</span><span class="ident" id="4277268"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4277272">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277275">go</span>&nbsp;<span class="ident" id="4277278"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277283">.</span><span class="ident" id="4277284"><a href="/gostd/net/http/transport.go.html#4282316">readLoop</a></span><span class="op" id="4277292">(</span><span class="op" id="4277293">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277296">go</span>&nbsp;<span class="ident" id="4277299"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277304">.</span><span class="ident" id="4277305"><a href="/gostd/net/http/transport.go.html#4284856">writeLoop</a></span><span class="op" id="4277314">(</span><span class="op" id="4277315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277318">return</span>&nbsp;<span class="ident" id="4277325"><a href="/gostd/net/http/transport.go.html#4274366">pconn</a></span><span class="op" id="4277330">,</span>&nbsp;<span class="builtintype" id="4277332">nil</span><br>
<span class="lineno"></span><span class="op" id="4277336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="4277339">//&nbsp;useProxy&nbsp;returns&nbsp;true&nbsp;if&nbsp;requests&nbsp;to&nbsp;addr&nbsp;should&nbsp;use&nbsp;a&nbsp;proxy,</span><br>
<span class="lineno"></span><span class="comment" id="4277404">//&nbsp;according&nbsp;to&nbsp;the&nbsp;NO_PROXY&nbsp;or&nbsp;no_proxy&nbsp;environment&nbsp;variable.</span><br>
<span class="lineno"></span><span class="comment" id="4277467">//&nbsp;addr&nbsp;is&nbsp;always&nbsp;a&nbsp;canonicalAddr&nbsp;with&nbsp;a&nbsp;host&nbsp;and&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="4277523">func</span>&nbsp;<span class="ident" id="4277528">useProxy</span><span class="op" id="4277536">(</span><span class="ident" id="4277537">addr</span>&nbsp;<span class="builtintype" id="4277542">string</span><span class="op" id="4277548">)</span>&nbsp;<span class="builtintype" id="4277550">bool</span>&nbsp;<span class="op" id="4277555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277558">if</span>&nbsp;<span class="builtinfunc" id="4277561">len</span><span class="op" id="4277564">(</span><span class="ident" id="4277565"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277569">)</span>&nbsp;<span class="op" id="4277571">==</span>&nbsp;<span class="num" id="4277574">0</span>&nbsp;<span class="op" id="4277576">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277580">return</span>&nbsp;<span class="builtintype" id="4277587">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277596">host</span><span class="op" id="4277600">,</span>&nbsp;<span class="ident" id="4277602">_</span><span class="op" id="4277603">,</span>&nbsp;<span class="ident" id="4277605">err</span>&nbsp;<span class="op" id="4277609">:=</span>&nbsp;<span class="ident" id="4277612"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4277615">.</span><span class="ident" id="4277616"><a href="/gostd/net/ipsock.go.html#3313208">SplitHostPort</a></span><span class="op" id="4277629">(</span><span class="ident" id="4277630"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277637">if</span>&nbsp;<span class="ident" id="4277640"><a href="/gostd/net/http/transport.go.html#4277605">err</a></span>&nbsp;<span class="op" id="4277644">!=</span>&nbsp;<span class="builtintype" id="4277647">nil</span>&nbsp;<span class="op" id="4277651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277655">return</span>&nbsp;<span class="builtintype" id="4277662">false</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277672">if</span>&nbsp;<span class="ident" id="4277675"><a href="/gostd/net/http/transport.go.html#4277596">host</a></span>&nbsp;<span class="op" id="4277680">==</span>&nbsp;<span class="string" id="4277683">&#34;localhost&#34;</span>&nbsp;<span class="op" id="4277695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277699">return</span>&nbsp;<span class="builtintype" id="4277706">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277716">if</span>&nbsp;<span class="ident" id="4277719">ip</span>&nbsp;<span class="op" id="4277722">:=</span>&nbsp;<span class="ident" id="4277725"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4277728">.</span><span class="ident" id="4277729"><a href="/gostd/net/ip.go.html#3299857">ParseIP</a></span><span class="op" id="4277736">(</span><span class="ident" id="4277737"><a href="/gostd/net/http/transport.go.html#4277596">host</a></span><span class="op" id="4277741">)</span><span class="op" id="4277742">;</span>&nbsp;<span class="ident" id="4277744"><a href="/gostd/net/http/transport.go.html#4277719">ip</a></span>&nbsp;<span class="op" id="4277747">!=</span>&nbsp;<span class="builtintype" id="4277750">nil</span>&nbsp;<span class="op" id="4277754">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277758">if</span>&nbsp;<span class="ident" id="4277761"><a href="/gostd/net/http/transport.go.html#4277719">ip</a></span><span class="op" id="4277763">.</span><span class="ident" id="4277764"><a href="/gostd/net/ip.go.html#3288521">IsLoopback</a></span><span class="op" id="4277774">(</span><span class="op" id="4277775">)</span>&nbsp;<span class="op" id="4277777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277782">return</span>&nbsp;<span class="builtintype" id="4277789">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277797">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277804">no_proxy</span>&nbsp;<span class="op" id="4277813">:=</span>&nbsp;<span class="ident" id="4277816"><a href="/gostd/net/http/transport.go.html#4268650">noProxyEnv</a></span><span class="op" id="4277826">.</span><span class="ident" id="4277827"><a href="/gostd/net/http/transport.go.html#4268964">Get</a></span><span class="op" id="4277830">(</span><span class="op" id="4277831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277834">if</span>&nbsp;<span class="ident" id="4277837"><a href="/gostd/net/http/transport.go.html#4277804">no_proxy</a></span>&nbsp;<span class="op" id="4277846">==</span>&nbsp;<span class="string" id="4277849">&#34;*&#34;</span>&nbsp;<span class="op" id="4277853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277857">return</span>&nbsp;<span class="builtintype" id="4277864">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277871">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277875"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span>&nbsp;<span class="op" id="4277880">=</span>&nbsp;<span class="ident" id="4277882"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4277889">.</span><span class="ident" id="4277890"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4277897">(</span><span class="ident" id="4277898"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4277905">.</span><span class="ident" id="4277906"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4277915">(</span><span class="ident" id="4277916"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277920">)</span><span class="op" id="4277921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277924">if</span>&nbsp;<span class="ident" id="4277927"><a href="/gostd/net/http/client.go.html#4083528">hasPort</a></span><span class="op" id="4277934">(</span><span class="ident" id="4277935"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277939">)</span>&nbsp;<span class="op" id="4277941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4277945"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span>&nbsp;<span class="op" id="4277950">=</span>&nbsp;<span class="ident" id="4277952"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277956">[</span><span class="op" id="4277957">:</span><span class="ident" id="4277958"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4277965">.</span><span class="ident" id="4277966"><a href="/gostd/strings/strings.go.html#2969551">LastIndex</a></span><span class="op" id="4277975">(</span><span class="ident" id="4277976"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4277980">,</span>&nbsp;<span class="string" id="4277982">&#34;:&#34;</span><span class="op" id="4277985">)</span><span class="op" id="4277986">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4277989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4277993">for</span>&nbsp;<span class="ident" id="4277997">_</span><span class="op" id="4277998">,</span>&nbsp;<span class="ident" id="4278000">p</span>&nbsp;<span class="op" id="4278002">:=</span>&nbsp;<span class="keyword" id="4278005">range</span>&nbsp;<span class="ident" id="4278011"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278018">.</span><span class="ident" id="4278019"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="4278024">(</span><span class="ident" id="4278025"><a href="/gostd/net/http/transport.go.html#4277804">no_proxy</a></span><span class="op" id="4278033">,</span>&nbsp;<span class="string" id="4278035">&#34;,&#34;</span><span class="op" id="4278038">)</span>&nbsp;<span class="op" id="4278040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4278044"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span>&nbsp;<span class="op" id="4278046">=</span>&nbsp;<span class="ident" id="4278048"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278055">.</span><span class="ident" id="4278056"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4278063">(</span><span class="ident" id="4278064"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278071">.</span><span class="ident" id="4278072"><a href="/gostd/strings/strings.go.html#2982525">TrimSpace</a></span><span class="op" id="4278081">(</span><span class="ident" id="4278082"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278083">)</span><span class="op" id="4278084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278088">if</span>&nbsp;<span class="builtinfunc" id="4278091">len</span><span class="op" id="4278094">(</span><span class="ident" id="4278095"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278096">)</span>&nbsp;<span class="op" id="4278098">==</span>&nbsp;<span class="num" id="4278101">0</span>&nbsp;<span class="op" id="4278103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278108">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278119">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278123">if</span>&nbsp;<span class="ident" id="4278126"><a href="/gostd/net/http/client.go.html#4083528">hasPort</a></span><span class="op" id="4278133">(</span><span class="ident" id="4278134"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278135">)</span>&nbsp;<span class="op" id="4278137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4278142"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span>&nbsp;<span class="op" id="4278144">=</span>&nbsp;<span class="ident" id="4278146"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278147">[</span><span class="op" id="4278148">:</span><span class="ident" id="4278149"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278156">.</span><span class="ident" id="4278157"><a href="/gostd/strings/strings.go.html#2969551">LastIndex</a></span><span class="op" id="4278166">(</span><span class="ident" id="4278167"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278168">,</span>&nbsp;<span class="string" id="4278170">&#34;:&#34;</span><span class="op" id="4278173">)</span><span class="op" id="4278174">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278182">if</span>&nbsp;<span class="ident" id="4278185"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span>&nbsp;<span class="op" id="4278190">==</span>&nbsp;<span class="ident" id="4278193"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span>&nbsp;<span class="op" id="4278195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278200">return</span>&nbsp;<span class="builtintype" id="4278207">false</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278219">if</span>&nbsp;<span class="ident" id="4278222"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278223">[</span><span class="num" id="4278224">0</span><span class="op" id="4278225">]</span>&nbsp;<span class="op" id="4278227">==</span>&nbsp;<span class="string" id="4278230">&#39;.&#39;</span>&nbsp;<span class="op" id="4278234">&amp;&amp;</span>&nbsp;<span class="op" id="4278237">(</span><span class="ident" id="4278238"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278245">.</span><span class="ident" id="4278246"><a href="/gostd/strings/strings.go.html#2975527">HasSuffix</a></span><span class="op" id="4278255">(</span><span class="ident" id="4278256"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4278260">,</span>&nbsp;<span class="ident" id="4278262"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278263">)</span>&nbsp;<span class="op" id="4278265">||</span>&nbsp;<span class="ident" id="4278268"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span>&nbsp;<span class="op" id="4278273">==</span>&nbsp;<span class="ident" id="4278276"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278277">[</span><span class="num" id="4278278">1</span><span class="op" id="4278279">:</span><span class="op" id="4278280">]</span><span class="op" id="4278281">)</span>&nbsp;<span class="op" id="4278283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4278288">//&nbsp;no_proxy&nbsp;&#34;.foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;&nbsp;or&nbsp;&#34;foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278349">return</span>&nbsp;<span class="builtintype" id="4278356">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278364">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278368">if</span>&nbsp;<span class="ident" id="4278371"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278372">[</span><span class="num" id="4278373">0</span><span class="op" id="4278374">]</span>&nbsp;<span class="op" id="4278376">!=</span>&nbsp;<span class="string" id="4278379">&#39;.&#39;</span>&nbsp;<span class="op" id="4278383">&amp;&amp;</span>&nbsp;<span class="ident" id="4278386"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4278393">.</span><span class="ident" id="4278394"><a href="/gostd/strings/strings.go.html#2975527">HasSuffix</a></span><span class="op" id="4278403">(</span><span class="ident" id="4278404"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4278408">,</span>&nbsp;<span class="ident" id="4278410"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278411">)</span>&nbsp;<span class="op" id="4278413">&amp;&amp;</span>&nbsp;<span class="ident" id="4278416"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4278420">[</span><span class="builtinfunc" id="4278421">len</span><span class="op" id="4278424">(</span><span class="ident" id="4278425"><a href="/gostd/net/http/transport.go.html#4277537">addr</a></span><span class="op" id="4278429">)</span><span class="op" id="4278430">-</span><span class="builtinfunc" id="4278431">len</span><span class="op" id="4278434">(</span><span class="ident" id="4278435"><a href="/gostd/net/http/transport.go.html#4278000">p</a></span><span class="op" id="4278436">)</span><span class="op" id="4278437">-</span><span class="num" id="4278438">1</span><span class="op" id="4278439">]</span>&nbsp;<span class="op" id="4278441">==</span>&nbsp;<span class="string" id="4278444">&#39;.&#39;</span>&nbsp;<span class="op" id="4278448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4278453">//&nbsp;no_proxy&nbsp;&#34;foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278500">return</span>&nbsp;<span class="builtintype" id="4278507">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4278518">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4278521">return</span>&nbsp;<span class="builtintype" id="4278528">true</span><br>
<span class="lineno"></span><span class="op" id="4278533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4278536">//&nbsp;connectMethod&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;(in&nbsp;its&nbsp;String&nbsp;form)&nbsp;for&nbsp;keeping&nbsp;persistent</span><br>
<span class="lineno"></span><span class="comment" id="4278612">//&nbsp;TCP&nbsp;connections&nbsp;alive&nbsp;for&nbsp;subsequent&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno">720</span><span class="comment" id="4278667">//</span><br>
<span class="lineno"></span><span class="comment" id="4278670">//&nbsp;A&nbsp;connect&nbsp;method&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;following&nbsp;types:</span><br>
<span class="lineno"></span><span class="comment" id="4278721">//</span><br>
<span class="lineno"></span><span class="comment" id="4278724">//&nbsp;Cache&nbsp;key&nbsp;form&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description</span><br>
<span class="lineno"></span><span class="comment" id="4278769">//&nbsp;-----------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-------------------------</span><br>
<span class="lineno">725</span><span class="comment" id="4278828">//&nbsp;|http|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="4278895">//&nbsp;|https|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="4278963">//&nbsp;http://proxy.com|https|foo.com&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;then&nbsp;CONNECT&nbsp;to&nbsp;foo.com</span><br>
<span class="lineno"></span><span class="comment" id="4279037">//&nbsp;http://proxy.com|http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;http&nbsp;to&nbsp;anywhere&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4279115">//</span><br>
<span class="lineno">730</span><span class="comment" id="4279118">//&nbsp;Note:&nbsp;no&nbsp;support&nbsp;to&nbsp;https&nbsp;to&nbsp;the&nbsp;proxy&nbsp;yet.</span><br>
<span class="lineno"></span><span class="comment" id="4279165">//</span><br>
<span class="lineno"></span><span class="keyword" id="4279168">type</span>&nbsp;<span class="ident" id="4279173">connectMethod</span>&nbsp;<span class="keyword" id="4279187">struct</span>&nbsp;<span class="op" id="4279194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279197">proxyURL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279210">*</span><span class="ident" id="4279211"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4279214">.</span><span class="ident" id="4279215"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span>&nbsp;<span class="comment" id="4279219">//&nbsp;nil&nbsp;for&nbsp;no&nbsp;proxy,&nbsp;else&nbsp;full&nbsp;proxy&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279261">targetScheme</span>&nbsp;<span class="builtintype" id="4279274">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4279283">//&nbsp;&#34;http&#34;&nbsp;or&nbsp;&#34;https&#34;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279305">targetAddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4279318">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4279327">//&nbsp;Not&nbsp;used&nbsp;if&nbsp;proxy&nbsp;+&nbsp;http&nbsp;targetScheme&nbsp;(4th&nbsp;example&nbsp;in&nbsp;table)</span><br>
<span class="lineno"></span><span class="op" id="4279391">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279394">func</span>&nbsp;<span class="op" id="4279399">(</span><span class="ident" id="4279400">cm</span>&nbsp;<span class="op" id="4279403">*</span><span class="ident" id="4279404"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4279417">)</span>&nbsp;<span class="ident" id="4279419">key</span><span class="op" id="4279422">(</span><span class="op" id="4279423">)</span>&nbsp;<span class="ident" id="4279425"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span>&nbsp;<span class="op" id="4279442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279445">proxyStr</span>&nbsp;<span class="op" id="4279454">:=</span>&nbsp;<span class="string" id="4279457">&#34;&#34;</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279461">targetAddr</span>&nbsp;<span class="op" id="4279472">:=</span>&nbsp;<span class="ident" id="4279475"><a href="/gostd/net/http/transport.go.html#4279400">cm</a></span><span class="op" id="4279477">.</span><span class="ident" id="4279478"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279490">if</span>&nbsp;<span class="ident" id="4279493"><a href="/gostd/net/http/transport.go.html#4279400">cm</a></span><span class="op" id="4279495">.</span><span class="ident" id="4279496"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4279505">!=</span>&nbsp;<span class="builtintype" id="4279508">nil</span>&nbsp;<span class="op" id="4279512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279516"><a href="/gostd/net/http/transport.go.html#4279445">proxyStr</a></span>&nbsp;<span class="op" id="4279525">=</span>&nbsp;<span class="ident" id="4279527"><a href="/gostd/net/http/transport.go.html#4279400">cm</a></span><span class="op" id="4279529">.</span><span class="ident" id="4279530"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span><span class="op" id="4279538">.</span><span class="ident" id="4279539"><a href="/gostd/net/url/url.go.html#3757924">String</a></span><span class="op" id="4279545">(</span><span class="op" id="4279546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279550">if</span>&nbsp;<span class="ident" id="4279553"><a href="/gostd/net/http/transport.go.html#4279400">cm</a></span><span class="op" id="4279555">.</span><span class="ident" id="4279556"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span>&nbsp;<span class="op" id="4279569">==</span>&nbsp;<span class="string" id="4279572">&#34;http&#34;</span>&nbsp;<span class="op" id="4279579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279584"><a href="/gostd/net/http/transport.go.html#4279461">targetAddr</a></span>&nbsp;<span class="op" id="4279595">=</span>&nbsp;<span class="string" id="4279597">&#34;&#34;</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279602">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279608">return</span>&nbsp;<span class="ident" id="4279615"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4279631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279635"><a href="/gostd/net/http/transport.go.html#4280308">proxy</a></span><span class="op" id="4279640">:</span>&nbsp;&nbsp;<span class="ident" id="4279643"><a href="/gostd/net/http/transport.go.html#4279445">proxyStr</a></span><span class="op" id="4279651">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279655"><a href="/gostd/net/http/transport.go.html#4280315">scheme</a></span><span class="op" id="4279661">:</span>&nbsp;<span class="ident" id="4279663"><a href="/gostd/net/http/transport.go.html#4279400">cm</a></span><span class="op" id="4279665">.</span><span class="ident" id="4279666"><a href="/gostd/net/http/transport.go.html#4279261">targetScheme</a></span><span class="op" id="4279678">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279682"><a href="/gostd/net/http/transport.go.html#4280323">addr</a></span><span class="op" id="4279686">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4279690"><a href="/gostd/net/http/transport.go.html#4279461">targetAddr</a></span><span class="op" id="4279700">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279703">}</span><br>
<span class="lineno"></span><span class="op" id="4279705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4279708">//&nbsp;addr&nbsp;returns&nbsp;the&nbsp;first&nbsp;hop&nbsp;&#34;host:port&#34;&nbsp;to&nbsp;which&nbsp;we&nbsp;need&nbsp;to&nbsp;TCP&nbsp;connect.</span><br>
<span class="lineno">755</span><span class="keyword" id="4279783">func</span>&nbsp;<span class="op" id="4279788">(</span><span class="ident" id="4279789">cm</span>&nbsp;<span class="op" id="4279792">*</span><span class="ident" id="4279793"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4279806">)</span>&nbsp;<span class="ident" id="4279808">addr</span><span class="op" id="4279812">(</span><span class="op" id="4279813">)</span>&nbsp;<span class="builtintype" id="4279815">string</span>&nbsp;<span class="op" id="4279822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279825">if</span>&nbsp;<span class="ident" id="4279828"><a href="/gostd/net/http/transport.go.html#4279789">cm</a></span><span class="op" id="4279830">.</span><span class="ident" id="4279831"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span>&nbsp;<span class="op" id="4279840">!=</span>&nbsp;<span class="builtintype" id="4279843">nil</span>&nbsp;<span class="op" id="4279847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279851">return</span>&nbsp;<span class="ident" id="4279858"><a href="/gostd/net/http/transport.go.html#4291171">canonicalAddr</a></span><span class="op" id="4279871">(</span><span class="ident" id="4279872"><a href="/gostd/net/http/transport.go.html#4279789">cm</a></span><span class="op" id="4279874">.</span><span class="ident" id="4279875"><a href="/gostd/net/http/transport.go.html#4279197">proxyURL</a></span><span class="op" id="4279883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279889">return</span>&nbsp;<span class="ident" id="4279896"><a href="/gostd/net/http/transport.go.html#4279789">cm</a></span><span class="op" id="4279898">.</span><span class="ident" id="4279899"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span><br>
<span class="lineno">760</span><span class="op" id="4279910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4279913">//&nbsp;tlsHost&nbsp;returns&nbsp;the&nbsp;host&nbsp;name&nbsp;to&nbsp;match&nbsp;against&nbsp;the&nbsp;peer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4279974">//&nbsp;TLS&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="4279994">func</span>&nbsp;<span class="op" id="4279999">(</span><span class="ident" id="4280000">cm</span>&nbsp;<span class="op" id="4280003">*</span><span class="ident" id="4280004"><a href="/gostd/net/http/transport.go.html#4279173">connectMethod</a></span><span class="op" id="4280017">)</span>&nbsp;<span class="ident" id="4280019">tlsHost</span><span class="op" id="4280026">(</span><span class="op" id="4280027">)</span>&nbsp;<span class="builtintype" id="4280029">string</span>&nbsp;<span class="op" id="4280036">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280039">h</span>&nbsp;<span class="op" id="4280041">:=</span>&nbsp;<span class="ident" id="4280044"><a href="/gostd/net/http/transport.go.html#4280000">cm</a></span><span class="op" id="4280046">.</span><span class="ident" id="4280047"><a href="/gostd/net/http/transport.go.html#4279305">targetAddr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280059">if</span>&nbsp;<span class="ident" id="4280062"><a href="/gostd/net/http/client.go.html#4083528">hasPort</a></span><span class="op" id="4280069">(</span><span class="ident" id="4280070"><a href="/gostd/net/http/transport.go.html#4280039">h</a></span><span class="op" id="4280071">)</span>&nbsp;<span class="op" id="4280073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280077"><a href="/gostd/net/http/transport.go.html#4280039">h</a></span>&nbsp;<span class="op" id="4280079">=</span>&nbsp;<span class="ident" id="4280081"><a href="/gostd/net/http/transport.go.html#4280039">h</a></span><span class="op" id="4280082">[</span><span class="op" id="4280083">:</span><span class="ident" id="4280084"><a href="/gostd/net/http/transport.go.html#4259911">strings</a></span><span class="op" id="4280091">.</span><span class="ident" id="4280092"><a href="/gostd/strings/strings.go.html#2969551">LastIndex</a></span><span class="op" id="4280101">(</span><span class="ident" id="4280102"><a href="/gostd/net/http/transport.go.html#4280039">h</a></span><span class="op" id="4280103">,</span>&nbsp;<span class="string" id="4280105">&#34;:&#34;</span><span class="op" id="4280108">)</span><span class="op" id="4280109">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280115">return</span>&nbsp;<span class="ident" id="4280122"><a href="/gostd/net/http/transport.go.html#4280039">h</a></span><br>
<span class="lineno">770</span><span class="op" id="4280124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4280127">//&nbsp;connectMethodKey&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;version&nbsp;of&nbsp;connectMethod,&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="4280195">//&nbsp;stringified&nbsp;proxy&nbsp;URL&nbsp;(or&nbsp;the&nbsp;empty&nbsp;string)&nbsp;instead&nbsp;of&nbsp;a&nbsp;pointer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4280266">//&nbsp;a&nbsp;URL.</span><br>
<span class="lineno">775</span><span class="keyword" id="4280276">type</span>&nbsp;<span class="ident" id="4280281">connectMethodKey</span>&nbsp;<span class="keyword" id="4280298">struct</span>&nbsp;<span class="op" id="4280305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280308">proxy</span><span class="op" id="4280313">,</span>&nbsp;<span class="ident" id="4280315">scheme</span><span class="op" id="4280321">,</span>&nbsp;<span class="ident" id="4280323">addr</span>&nbsp;<span class="builtintype" id="4280328">string</span><br>
<span class="lineno"></span><span class="op" id="4280335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4280338">func</span>&nbsp;<span class="op" id="4280343">(</span><span class="ident" id="4280344">k</span>&nbsp;<span class="ident" id="4280346"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><span class="op" id="4280362">)</span>&nbsp;<span class="ident" id="4280364">String</span><span class="op" id="4280370">(</span><span class="op" id="4280371">)</span>&nbsp;<span class="builtintype" id="4280373">string</span>&nbsp;<span class="op" id="4280380">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280383">//&nbsp;Only&nbsp;used&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280407">return</span>&nbsp;<span class="ident" id="4280414"><a href="/gostd/net/http/transport.go.html#4259867">fmt</a></span><span class="op" id="4280417">.</span><span class="ident" id="4280418"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="4280425">(</span><span class="string" id="4280426">&#34;%s|%s|%s&#34;</span><span class="op" id="4280436">,</span>&nbsp;<span class="ident" id="4280438"><a href="/gostd/net/http/transport.go.html#4280344">k</a></span><span class="op" id="4280439">.</span><span class="ident" id="4280440"><a href="/gostd/net/http/transport.go.html#4280308">proxy</a></span><span class="op" id="4280445">,</span>&nbsp;<span class="ident" id="4280447"><a href="/gostd/net/http/transport.go.html#4280344">k</a></span><span class="op" id="4280448">.</span><span class="ident" id="4280449"><a href="/gostd/net/http/transport.go.html#4280315">scheme</a></span><span class="op" id="4280455">,</span>&nbsp;<span class="ident" id="4280457"><a href="/gostd/net/http/transport.go.html#4280344">k</a></span><span class="op" id="4280458">.</span><span class="ident" id="4280459"><a href="/gostd/net/http/transport.go.html#4280323">addr</a></span><span class="op" id="4280463">)</span><br>
<span class="lineno"></span><span class="op" id="4280465">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4280468">//&nbsp;persistConn&nbsp;wraps&nbsp;a&nbsp;connection,&nbsp;usually&nbsp;a&nbsp;persistent&nbsp;one</span><br>
<span class="lineno">785</span><span class="comment" id="4280528">//&nbsp;(but&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;non-keep-alive&nbsp;requests&nbsp;as&nbsp;well)</span><br>
<span class="lineno"></span><span class="keyword" id="4280585">type</span>&nbsp;<span class="ident" id="4280590">persistConn</span>&nbsp;<span class="keyword" id="4280602">struct</span>&nbsp;<span class="op" id="4280609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280612">t</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280621">*</span><span class="ident" id="4280622"><a href="/gostd/net/http/transport.go.html#4260801">Transport</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280633">cacheKey</span>&nbsp;<span class="ident" id="4280642"><a href="/gostd/net/http/transport.go.html#4280281">connectMethodKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280660">conn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280669"><a href="/gostd/net/http/transport.go.html#4259887">net</a></span><span class="op" id="4280672">.</span><span class="ident" id="4280673"><a href="/gostd/net/net.go.html#3334417">Conn</a></span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280679">tlsState</span>&nbsp;<span class="op" id="4280688">*</span><span class="ident" id="4280689"><a href="/gostd/net/http/transport.go.html#4259843">tls</a></span><span class="op" id="4280692">.</span><span class="ident" id="4280693"><a href="/gostd/crypto/tls/common.go.html#4446494">ConnectionState</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280710">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280719">*</span><span class="ident" id="4280720"><a href="/gostd/net/http/transport.go.html#4259817">bufio</a></span><span class="op" id="4280725">.</span><span class="ident" id="4280726"><a href="/gostd/bufio/bufio.go.html#1354974">Reader</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280739">//&nbsp;from&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280753">sawEOF</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4280762">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280782">//&nbsp;whether&nbsp;we&#39;ve&nbsp;seen&nbsp;EOF&nbsp;from&nbsp;conn;&nbsp;owned&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280838">bw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280847">*</span><span class="ident" id="4280848"><a href="/gostd/net/http/transport.go.html#4259817">bufio</a></span><span class="op" id="4280853">.</span><span class="ident" id="4280854"><a href="/gostd/bufio/bufio.go.html#1366565">Writer</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280867">//&nbsp;to&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280879">reqch</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280888">chan</span>&nbsp;<span class="ident" id="4280893"><a href="/gostd/net/http/transport.go.html#4286470">requestAndChan</a></span>&nbsp;<span class="comment" id="4280908">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280951">writech</span>&nbsp;&nbsp;<span class="keyword" id="4280960">chan</span>&nbsp;<span class="ident" id="4280965"><a href="/gostd/net/http/transport.go.html#4286917">writeRequest</a></span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4280980">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;writeLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281024">closech</span>&nbsp;&nbsp;<span class="keyword" id="4281033">chan</span>&nbsp;<span class="keyword" id="4281038">struct</span><span class="op" id="4281044">{</span><span class="op" id="4281045">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281053">//&nbsp;closed&nbsp;when&nbsp;conn&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281081">isProxy</span>&nbsp;&nbsp;<span class="builtintype" id="4281090">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281096">//&nbsp;writeErrCh&nbsp;passes&nbsp;the&nbsp;request&nbsp;write&nbsp;error&nbsp;(usually&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281156">//&nbsp;from&nbsp;the&nbsp;writeLoop&nbsp;goroutine&nbsp;to&nbsp;the&nbsp;readLoop&nbsp;which&nbsp;passes</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281218">//&nbsp;it&nbsp;off&nbsp;to&nbsp;the&nbsp;res.Body&nbsp;reader,&nbsp;which&nbsp;then&nbsp;uses&nbsp;it&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281282">//&nbsp;whether&nbsp;or&nbsp;not&nbsp;a&nbsp;connection&nbsp;can&nbsp;be&nbsp;reused.&nbsp;Issue&nbsp;7569.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281341">writeErrCh</span>&nbsp;<span class="keyword" id="4281352">chan</span>&nbsp;<span class="builtintype" id="4281357">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281365">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281386"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4281390">.</span><span class="ident" id="4281391"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;<span class="comment" id="4281397">//&nbsp;guards&nbsp;following&nbsp;fields</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281425">numExpectedResponses</span>&nbsp;<span class="builtintype" id="4281446">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281451">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4281472">bool</span>&nbsp;<span class="comment" id="4281477">//&nbsp;whether&nbsp;conn&nbsp;has&nbsp;been&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281510">broken</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4281531">bool</span>&nbsp;<span class="comment" id="4281536">//&nbsp;an&nbsp;error&nbsp;has&nbsp;happened&nbsp;on&nbsp;this&nbsp;connection;&nbsp;marked&nbsp;broken&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281616">//&nbsp;mutateHeaderFunc&nbsp;is&nbsp;an&nbsp;optional&nbsp;func&nbsp;to&nbsp;modify&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281673">//&nbsp;headers&nbsp;on&nbsp;each&nbsp;outbound&nbsp;request&nbsp;before&nbsp;it&#39;s&nbsp;written.&nbsp;(the</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4281736">//&nbsp;original&nbsp;Request&nbsp;given&nbsp;to&nbsp;RoundTrip&nbsp;is&nbsp;not&nbsp;modified)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281793">mutateHeaderFunc</span>&nbsp;<span class="keyword" id="4281810">func</span><span class="op" id="4281814">(</span><span class="ident" id="4281815"><a href="/gostd/net/http/header.go.html#4126117">Header</a></span><span class="op" id="4281821">)</span><br>
<span class="lineno"></span><span class="op" id="4281823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4281826">//&nbsp;isBroken&nbsp;reports&nbsp;whether&nbsp;this&nbsp;connection&nbsp;is&nbsp;in&nbsp;a&nbsp;known&nbsp;broken&nbsp;state.</span><br>
<span class="lineno">815</span><span class="keyword" id="4281898">func</span>&nbsp;<span class="op" id="4281903">(</span><span class="ident" id="4281904">pc</span>&nbsp;<span class="op" id="4281907">*</span><span class="ident" id="4281908"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4281919">)</span>&nbsp;<span class="ident" id="4281921">isBroken</span><span class="op" id="4281929">(</span><span class="op" id="4281930">)</span>&nbsp;<span class="builtintype" id="4281932">bool</span>&nbsp;<span class="op" id="4281937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281940"><a href="/gostd/net/http/transport.go.html#4281904">pc</a></span><span class="op" id="4281942">.</span><span class="ident" id="4281943"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4281945">.</span><span class="ident" id="4281946"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4281950">(</span><span class="op" id="4281951">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281954">b</span>&nbsp;<span class="op" id="4281956">:=</span>&nbsp;<span class="ident" id="4281959"><a href="/gostd/net/http/transport.go.html#4281904">pc</a></span><span class="op" id="4281961">.</span><span class="ident" id="4281962"><a href="/gostd/net/http/transport.go.html#4281510">broken</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281970"><a href="/gostd/net/http/transport.go.html#4281904">pc</a></span><span class="op" id="4281972">.</span><span class="ident" id="4281973"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4281975">.</span><span class="ident" id="4281976"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4281982">(</span><span class="op" id="4281983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281986">return</span>&nbsp;<span class="ident" id="4281993"><a href="/gostd/net/http/transport.go.html#4281954">b</a></span><br>
<span class="lineno">820</span><span class="op" id="4281995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4281998">func</span>&nbsp;<span class="op" id="4282003">(</span><span class="ident" id="4282004">pc</span>&nbsp;<span class="op" id="4282007">*</span><span class="ident" id="4282008"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4282019">)</span>&nbsp;<span class="ident" id="4282021">cancelRequest</span><span class="op" id="4282034">(</span><span class="op" id="4282035">)</span>&nbsp;<span class="op" id="4282037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282040"><a href="/gostd/net/http/transport.go.html#4282004">pc</a></span><span class="op" id="4282042">.</span><span class="ident" id="4282043"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4282047">.</span><span class="ident" id="4282048"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4282053">(</span><span class="op" id="4282054">)</span><br>
<span class="lineno"></span><span class="op" id="4282056">}</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="keyword" id="4282059">var</span>&nbsp;<span class="ident" id="4282063">remoteSideClosedFunc</span>&nbsp;<span class="keyword" id="4282084">func</span><span class="op" id="4282088">(</span><span class="builtintype" id="4282089">error</span><span class="op" id="4282094">)</span>&nbsp;<span class="builtintype" id="4282096">bool</span>&nbsp;<span class="comment" id="4282101">//&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;default</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4282127">func</span>&nbsp;<span class="ident" id="4282132">remoteSideClosed</span><span class="op" id="4282148">(</span><span class="ident" id="4282149">err</span>&nbsp;<span class="builtintype" id="4282153">error</span><span class="op" id="4282158">)</span>&nbsp;<span class="builtintype" id="4282160">bool</span>&nbsp;<span class="op" id="4282165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282168">if</span>&nbsp;<span class="ident" id="4282171"><a href="/gostd/net/http/transport.go.html#4282149">err</a></span>&nbsp;<span class="op" id="4282175">==</span>&nbsp;<span class="ident" id="4282178"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4282180">.</span><span class="ident" id="4282181"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4282185">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282189">return</span>&nbsp;<span class="builtintype" id="4282196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282205">if</span>&nbsp;<span class="ident" id="4282208"><a href="/gostd/net/http/transport.go.html#4282063">remoteSideClosedFunc</a></span>&nbsp;<span class="op" id="4282229">!=</span>&nbsp;<span class="builtintype" id="4282232">nil</span>&nbsp;<span class="op" id="4282236">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282240">return</span>&nbsp;<span class="ident" id="4282247"><a href="/gostd/net/http/transport.go.html#4282063">remoteSideClosedFunc</a></span><span class="op" id="4282267">(</span><span class="ident" id="4282268"><a href="/gostd/net/http/transport.go.html#4282149">err</a></span><span class="op" id="4282271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282274">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282277">return</span>&nbsp;<span class="builtintype" id="4282284">false</span><br>
<span class="lineno"></span><span class="op" id="4282290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4282293">func</span>&nbsp;<span class="op" id="4282298">(</span><span class="ident" id="4282299">pc</span>&nbsp;<span class="op" id="4282302">*</span><span class="ident" id="4282303"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4282314">)</span>&nbsp;<span class="ident" id="4282316">readLoop</span><span class="op" id="4282324">(</span><span class="op" id="4282325">)</span>&nbsp;<span class="op" id="4282327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282330">alive</span>&nbsp;<span class="op" id="4282336">:=</span>&nbsp;<span class="builtintype" id="4282339">true</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282346">for</span>&nbsp;<span class="ident" id="4282350"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4282356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282360">pb</span><span class="op" id="4282362">,</span>&nbsp;<span class="ident" id="4282364">err</span>&nbsp;<span class="op" id="4282368">:=</span>&nbsp;<span class="ident" id="4282371"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282373">.</span><span class="ident" id="4282374"><a href="/gostd/net/http/transport.go.html#4280710">br</a></span><span class="op" id="4282376">.</span><span class="ident" id="4282377"><a href="/gostd/bufio/bufio.go.html#1357192">Peek</a></span><span class="op" id="4282381">(</span><span class="num" id="4282382">1</span><span class="op" id="4282383">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282388"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282390">.</span><span class="ident" id="4282391"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4282393">.</span><span class="ident" id="4282394"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4282398">(</span><span class="op" id="4282399">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282403">if</span>&nbsp;<span class="ident" id="4282406"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282408">.</span><span class="ident" id="4282409"><a href="/gostd/net/http/transport.go.html#4281425">numExpectedResponses</a></span>&nbsp;<span class="op" id="4282430">==</span>&nbsp;<span class="num" id="4282433">0</span>&nbsp;<span class="op" id="4282435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282440">if</span>&nbsp;<span class="op" id="4282443">!</span><span class="ident" id="4282444"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282446">.</span><span class="ident" id="4282447"><a href="/gostd/net/http/transport.go.html#4281451">closed</a></span>&nbsp;<span class="op" id="4282454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282460"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282462">.</span><span class="ident" id="4282463"><a href="/gostd/net/http/transport.go.html#4290889">closeLocked</a></span><span class="op" id="4282474">(</span><span class="op" id="4282475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282481">if</span>&nbsp;<span class="builtinfunc" id="4282484">len</span><span class="op" id="4282487">(</span><span class="ident" id="4282488"><a href="/gostd/net/http/transport.go.html#4282360">pb</a></span><span class="op" id="4282490">)</span>&nbsp;<span class="op" id="4282492">&gt;</span>&nbsp;<span class="num" id="4282494">0</span>&nbsp;<span class="op" id="4282496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282503"><a href="/gostd/net/http/transport.go.html#4259880">log</a></span><span class="op" id="4282506">.</span><span class="ident" id="4282507"><a href="/gostd/log/log.go.html#4078664">Printf</a></span><span class="op" id="4282513">(</span><span class="string" id="4282514">&#34;Unsolicited&nbsp;response&nbsp;received&nbsp;on&nbsp;idle&nbsp;HTTP&nbsp;channel&nbsp;starting&nbsp;with&nbsp;%q;&nbsp;err=%v&#34;</span><span class="op" id="4282591">,</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4282599">string</span><span class="op" id="4282605">(</span><span class="ident" id="4282606"><a href="/gostd/net/http/transport.go.html#4282360">pb</a></span><span class="op" id="4282608">)</span><span class="op" id="4282609">,</span>&nbsp;<span class="ident" id="4282611"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span><span class="op" id="4282614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282630"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282632">.</span><span class="ident" id="4282633"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4282635">.</span><span class="ident" id="4282636"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4282642">(</span><span class="op" id="4282643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282648">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4282657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282661"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282663">.</span><span class="ident" id="4282664"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4282666">.</span><span class="ident" id="4282667"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4282673">(</span><span class="op" id="4282674">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282679">rc</span>&nbsp;<span class="op" id="4282682">:=</span>&nbsp;<span class="op" id="4282685">&lt;-</span><span class="ident" id="4282687"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282689">.</span><span class="ident" id="4282690"><a href="/gostd/net/http/transport.go.html#4280879">reqch</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282699">var</span>&nbsp;<span class="ident" id="4282703">resp</span>&nbsp;<span class="op" id="4282708">*</span><span class="ident" id="4282709"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282720">if</span>&nbsp;<span class="ident" id="4282723"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4282727">==</span>&nbsp;<span class="builtintype" id="4282730">nil</span>&nbsp;<span class="op" id="4282734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4282739"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4282743">,</span>&nbsp;<span class="ident" id="4282745"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4282749">=</span>&nbsp;<span class="ident" id="4282751"><a href="/gostd/net/http/response.go.html#4164712">ReadResponse</a></span><span class="op" id="4282763">(</span><span class="ident" id="4282764"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4282766">.</span><span class="ident" id="4282767"><a href="/gostd/net/http/transport.go.html#4280710">br</a></span><span class="op" id="4282769">,</span>&nbsp;<span class="ident" id="4282771"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4282773">.</span><span class="ident" id="4282774"><a href="/gostd/net/http/transport.go.html#4286495">req</a></span><span class="op" id="4282777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4282782">if</span>&nbsp;<span class="ident" id="4282785"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4282789">==</span>&nbsp;<span class="builtintype" id="4282792">nil</span>&nbsp;<span class="op" id="4282796">&amp;&amp;</span>&nbsp;<span class="ident" id="4282799"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4282803">.</span><span class="ident" id="4282804"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span>&nbsp;<span class="op" id="4282815">==</span>&nbsp;<span class="num" id="4282818">100</span>&nbsp;<span class="op" id="4282822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4282828">//&nbsp;Skip&nbsp;any&nbsp;100-continue&nbsp;for&nbsp;now.</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4282866">//&nbsp;TODO(bradfitz):&nbsp;if&nbsp;rc.req&nbsp;had&nbsp;&#34;Expect:&nbsp;100-continue&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4282927">//&nbsp;actually&nbsp;block&nbsp;the&nbsp;request&nbsp;body&nbsp;write&nbsp;and&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4282987">//&nbsp;writeLoop&nbsp;now&nbsp;to&nbsp;begin&nbsp;sending&nbsp;it.&nbsp;(Issue&nbsp;2184)&nbsp;For&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283053">//&nbsp;eat&nbsp;it,&nbsp;since&nbsp;we&#39;re&nbsp;never&nbsp;expecting&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283101"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283105">,</span>&nbsp;<span class="ident" id="4283107"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4283111">=</span>&nbsp;<span class="ident" id="4283113"><a href="/gostd/net/http/response.go.html#4164712">ReadResponse</a></span><span class="op" id="4283125">(</span><span class="ident" id="4283126"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4283128">.</span><span class="ident" id="4283129"><a href="/gostd/net/http/transport.go.html#4280710">br</a></span><span class="op" id="4283131">,</span>&nbsp;<span class="ident" id="4283133"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4283135">.</span><span class="ident" id="4283136"><a href="/gostd/net/http/transport.go.html#4286495">req</a></span><span class="op" id="4283139">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283153">if</span>&nbsp;<span class="ident" id="4283156"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span>&nbsp;<span class="op" id="4283161">!=</span>&nbsp;<span class="builtintype" id="4283164">nil</span>&nbsp;<span class="op" id="4283168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283173"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283177">.</span><span class="ident" id="4283178"><a href="/gostd/net/http/response.go.html#4163636">TLS</a></span>&nbsp;<span class="op" id="4283182">=</span>&nbsp;<span class="ident" id="4283184"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4283186">.</span><span class="ident" id="4283187"><a href="/gostd/net/http/transport.go.html#4280679">tlsState</a></span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283198">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283203">hasBody</span>&nbsp;<span class="op" id="4283211">:=</span>&nbsp;<span class="ident" id="4283214"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span>&nbsp;<span class="op" id="4283219">!=</span>&nbsp;<span class="builtintype" id="4283222">nil</span>&nbsp;<span class="op" id="4283226">&amp;&amp;</span>&nbsp;<span class="ident" id="4283229"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4283231">.</span><span class="ident" id="4283232"><a href="/gostd/net/http/transport.go.html#4286495">req</a></span><span class="op" id="4283235">.</span><span class="ident" id="4283236"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="4283243">!=</span>&nbsp;<span class="string" id="4283246">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4283253">&amp;&amp;</span>&nbsp;<span class="ident" id="4283256"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283260">.</span><span class="ident" id="4283261"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span>&nbsp;<span class="op" id="4283275">!=</span>&nbsp;<span class="num" id="4283278">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283283">if</span>&nbsp;<span class="ident" id="4283286"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4283290">!=</span>&nbsp;<span class="builtintype" id="4283293">nil</span>&nbsp;<span class="op" id="4283297">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283302"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4283304">.</span><span class="builtinfunc" id="4283305"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4283310">(</span><span class="op" id="4283311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283315">}</span>&nbsp;<span class="keyword" id="4283317">else</span>&nbsp;<span class="op" id="4283322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283327">if</span>&nbsp;<span class="ident" id="4283330"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4283332">.</span><span class="ident" id="4283333"><a href="/gostd/net/http/transport.go.html#4286693">addedGzip</a></span>&nbsp;<span class="op" id="4283343">&amp;&amp;</span>&nbsp;<span class="ident" id="4283346"><a href="/gostd/net/http/transport.go.html#4283203">hasBody</a></span>&nbsp;<span class="op" id="4283354">&amp;&amp;</span>&nbsp;<span class="ident" id="4283357"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283361">.</span><span class="ident" id="4283362"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="4283368">.</span><span class="ident" id="4283369"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="4283372">(</span><span class="string" id="4283373">&#34;Content-Encoding&#34;</span><span class="op" id="4283391">)</span>&nbsp;<span class="op" id="4283393">==</span>&nbsp;<span class="string" id="4283396">&#34;gzip&#34;</span>&nbsp;<span class="op" id="4283403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283409"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283413">.</span><span class="ident" id="4283414"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="4283420">.</span><span class="ident" id="4283421"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="4283424">(</span><span class="string" id="4283425">&#34;Content-Encoding&#34;</span><span class="op" id="4283443">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283449"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283453">.</span><span class="ident" id="4283454"><a href="/gostd/net/http/response.go.html#4162137">Header</a></span><span class="op" id="4283460">.</span><span class="ident" id="4283461"><a href="/gostd/net/http/header.go.html#4127099">Del</a></span><span class="op" id="4283464">(</span><span class="string" id="4283465">&#34;Content-Length&#34;</span><span class="op" id="4283481">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283487"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283491">.</span><span class="ident" id="4283492"><a href="/gostd/net/http/response.go.html#4162765">ContentLength</a></span>&nbsp;<span class="op" id="4283506">=</span>&nbsp;<span class="op" id="4283508">-</span><span class="num" id="4283509">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283515"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283519">.</span><span class="ident" id="4283520"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="4283525">=</span>&nbsp;<span class="op" id="4283527">&amp;</span><span class="ident" id="4283528"><a href="/gostd/net/http/transport.go.html#4292922">gzipReader</a></span><span class="op" id="4283538">{</span><span class="ident" id="4283539"><a href="/gostd/net/http/transport.go.html#4292943">body</a></span><span class="op" id="4283543">:</span>&nbsp;<span class="ident" id="4283545"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283549">.</span><span class="ident" id="4283550"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="4283554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283564"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283568">.</span><span class="ident" id="4283569"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span>&nbsp;<span class="op" id="4283574">=</span>&nbsp;<span class="op" id="4283576">&amp;</span><span class="ident" id="4283577"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4283590">{</span><span class="ident" id="4283591"><a href="/gostd/net/http/transport.go.html#4291654">body</a></span><span class="op" id="4283595">:</span>&nbsp;<span class="ident" id="4283597"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283601">.</span><span class="ident" id="4283602"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="4283606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283610">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283615">if</span>&nbsp;<span class="ident" id="4283618"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span>&nbsp;<span class="op" id="4283622">!=</span>&nbsp;<span class="builtintype" id="4283625">nil</span>&nbsp;<span class="op" id="4283629">||</span>&nbsp;<span class="ident" id="4283632"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283636">.</span><span class="ident" id="4283637"><a href="/gostd/net/http/response.go.html#4163140">Close</a></span>&nbsp;<span class="op" id="4283643">||</span>&nbsp;<span class="ident" id="4283646"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4283648">.</span><span class="ident" id="4283649"><a href="/gostd/net/http/transport.go.html#4286495">req</a></span><span class="op" id="4283652">.</span><span class="ident" id="4283653"><a href="/gostd/net/http/request.go.html#4138776">Close</a></span>&nbsp;<span class="op" id="4283659">||</span>&nbsp;<span class="ident" id="4283662"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283666">.</span><span class="ident" id="4283667"><a href="/gostd/net/http/response.go.html#4161564">StatusCode</a></span>&nbsp;<span class="op" id="4283678">&lt;=</span>&nbsp;<span class="num" id="4283681">199</span>&nbsp;<span class="op" id="4283685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283690">//&nbsp;Don&#39;t&nbsp;do&nbsp;keep-alive&nbsp;on&nbsp;error&nbsp;if&nbsp;either&nbsp;party&nbsp;requested&nbsp;a&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283759">//&nbsp;or&nbsp;we&nbsp;get&nbsp;an&nbsp;unexpected&nbsp;informational&nbsp;(1xx)&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4283819">//&nbsp;StatusCode&nbsp;100&nbsp;is&nbsp;already&nbsp;handled&nbsp;above.</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283866"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4283872">=</span>&nbsp;<span class="builtintype" id="4283874">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4283882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283887">var</span>&nbsp;<span class="ident" id="4283891">waitForBodyRead</span>&nbsp;<span class="keyword" id="4283907">chan</span>&nbsp;<span class="builtintype" id="4283912">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4283919">if</span>&nbsp;<span class="ident" id="4283922"><a href="/gostd/net/http/transport.go.html#4283203">hasBody</a></span>&nbsp;<span class="op" id="4283930">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283935"><a href="/gostd/net/http/transport.go.html#4283891">waitForBodyRead</a></span>&nbsp;<span class="op" id="4283951">=</span>&nbsp;<span class="builtinfunc" id="4283953">make</span><span class="op" id="4283957">(</span><span class="keyword" id="4283958">chan</span>&nbsp;<span class="builtintype" id="4283963">bool</span><span class="op" id="4283967">,</span>&nbsp;<span class="num" id="4283969">2</span><span class="op" id="4283970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4283975"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4283979">.</span><span class="ident" id="4283980"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="4283984">.</span><span class="op" id="4283985">(</span><span class="op" id="4283986">*</span><span class="ident" id="4283987"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4284000">)</span><span class="op" id="4284001">.</span><span class="ident" id="4284002"><a href="/gostd/net/http/transport.go.html#4291909">earlyCloseFn</a></span>&nbsp;<span class="op" id="4284015">=</span>&nbsp;<span class="keyword" id="4284017">func</span><span class="op" id="4284021">(</span><span class="op" id="4284022">)</span>&nbsp;<span class="builtintype" id="4284024">error</span>&nbsp;<span class="op" id="4284030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4284036">//&nbsp;Sending&nbsp;false&nbsp;here&nbsp;sets&nbsp;alive&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4284076">//&nbsp;false&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4284115">//&nbsp;below.</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284129"><a href="/gostd/net/http/transport.go.html#4283891">waitForBodyRead</a></span>&nbsp;<span class="op" id="4284145">&lt;-</span>&nbsp;<span class="builtintype" id="4284148">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284158">return</span>&nbsp;<span class="builtintype" id="4284165">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284177"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4284181">.</span><span class="ident" id="4284182"><a href="/gostd/net/http/response.go.html#4162507">Body</a></span><span class="op" id="4284186">.</span><span class="op" id="4284187">(</span><span class="op" id="4284188">*</span><span class="ident" id="4284189"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4284202">)</span><span class="op" id="4284203">.</span><span class="ident" id="4284204"><a href="/gostd/net/http/transport.go.html#4291846">fn</a></span>&nbsp;<span class="op" id="4284207">=</span>&nbsp;<span class="keyword" id="4284209">func</span><span class="op" id="4284213">(</span><span class="ident" id="4284214">err</span>&nbsp;<span class="builtintype" id="4284218">error</span><span class="op" id="4284223">)</span>&nbsp;<span class="op" id="4284225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284231"><a href="/gostd/net/http/transport.go.html#4283891">waitForBodyRead</a></span>&nbsp;<span class="op" id="4284247">&lt;-</span>&nbsp;<span class="ident" id="4284250"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284256">&amp;&amp;</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284264"><a href="/gostd/net/http/transport.go.html#4284214">err</a></span>&nbsp;<span class="op" id="4284268">==</span>&nbsp;<span class="builtintype" id="4284271">nil</span>&nbsp;<span class="op" id="4284275">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284283">!</span><span class="ident" id="4284284"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284286">.</span><span class="ident" id="4284287"><a href="/gostd/net/http/transport.go.html#4280753">sawEOF</a></span>&nbsp;<span class="op" id="4284294">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284302"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284304">.</span><span class="ident" id="4284305"><a href="/gostd/net/http/transport.go.html#4285544">wroteRequest</a></span><span class="op" id="4284317">(</span><span class="op" id="4284318">)</span>&nbsp;<span class="op" id="4284320">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284328"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284330">.</span><span class="ident" id="4284331"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4284332">.</span><span class="ident" id="4284333"><a href="/gostd/net/http/transport.go.html#4270026">putIdleConn</a></span><span class="op" id="4284344">(</span><span class="ident" id="4284345"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284352">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284356">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284361">if</span>&nbsp;<span class="ident" id="4284364"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284370">&amp;&amp;</span>&nbsp;<span class="op" id="4284373">!</span><span class="ident" id="4284374"><a href="/gostd/net/http/transport.go.html#4283203">hasBody</a></span>&nbsp;<span class="op" id="4284382">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284387"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284393">=</span>&nbsp;<span class="op" id="4284395">!</span><span class="ident" id="4284396"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284398">.</span><span class="ident" id="4284399"><a href="/gostd/net/http/transport.go.html#4280753">sawEOF</a></span>&nbsp;<span class="op" id="4284406">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284413"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284415">.</span><span class="ident" id="4284416"><a href="/gostd/net/http/transport.go.html#4285544">wroteRequest</a></span><span class="op" id="4284428">(</span><span class="op" id="4284429">)</span>&nbsp;<span class="op" id="4284431">&amp;&amp;</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284438"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284440">.</span><span class="ident" id="4284441"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4284442">.</span><span class="ident" id="4284443"><a href="/gostd/net/http/transport.go.html#4270026">putIdleConn</a></span><span class="op" id="4284454">(</span><span class="ident" id="4284455"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284461">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284466"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4284468">.</span><span class="ident" id="4284469"><a href="/gostd/net/http/transport.go.html#4286509">ch</a></span>&nbsp;<span class="op" id="4284472">&lt;-</span>&nbsp;<span class="ident" id="4284475"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><span class="op" id="4284491">{</span><span class="ident" id="4284492"><a href="/gostd/net/http/transport.go.html#4282703">resp</a></span><span class="op" id="4284496">,</span>&nbsp;<span class="ident" id="4284498"><a href="/gostd/net/http/transport.go.html#4282364">err</a></span><span class="op" id="4284501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4284506">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;just-returned&nbsp;response&nbsp;body&nbsp;to&nbsp;be&nbsp;fully&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4284573">//&nbsp;before&nbsp;we&nbsp;race&nbsp;and&nbsp;peek&nbsp;on&nbsp;the&nbsp;underlying&nbsp;bufio&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284634">if</span>&nbsp;<span class="ident" id="4284637"><a href="/gostd/net/http/transport.go.html#4283891">waitForBodyRead</a></span>&nbsp;<span class="op" id="4284653">!=</span>&nbsp;<span class="builtintype" id="4284656">nil</span>&nbsp;<span class="op" id="4284660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284665">select</span>&nbsp;<span class="op" id="4284672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284677">case</span>&nbsp;<span class="ident" id="4284682"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284688">=</span>&nbsp;<span class="op" id="4284690">&lt;-</span><span class="ident" id="4284692"><a href="/gostd/net/http/transport.go.html#4283891">waitForBodyRead</a></span><span class="op" id="4284707">:</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284712">case</span>&nbsp;<span class="op" id="4284717">&lt;-</span><span class="ident" id="4284719"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284721">.</span><span class="ident" id="4284722"><a href="/gostd/net/http/transport.go.html#4281024">closech</a></span><span class="op" id="4284729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284735"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284741">=</span>&nbsp;<span class="builtintype" id="4284743">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284761"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284763">.</span><span class="ident" id="4284764"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4284765">.</span><span class="ident" id="4284766"><a href="/gostd/net/http/transport.go.html#4272446">setReqCanceler</a></span><span class="op" id="4284780">(</span><span class="ident" id="4284781"><a href="/gostd/net/http/transport.go.html#4282679">rc</a></span><span class="op" id="4284783">.</span><span class="ident" id="4284784"><a href="/gostd/net/http/transport.go.html#4286495">req</a></span><span class="op" id="4284787">,</span>&nbsp;<span class="builtintype" id="4284789">nil</span><span class="op" id="4284792">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284797">if</span>&nbsp;<span class="op" id="4284800">!</span><span class="ident" id="4284801"><a href="/gostd/net/http/transport.go.html#4282330">alive</a></span>&nbsp;<span class="op" id="4284807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284812"><a href="/gostd/net/http/transport.go.html#4282299">pc</a></span><span class="op" id="4284814">.</span><span class="builtinfunc" id="4284815"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4284820">(</span><span class="op" id="4284821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284825">}</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4284828">}</span><br>
<span class="lineno"></span><span class="op" id="4284830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4284833">func</span>&nbsp;<span class="op" id="4284838">(</span><span class="ident" id="4284839">pc</span>&nbsp;<span class="op" id="4284842">*</span><span class="ident" id="4284843"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4284854">)</span>&nbsp;<span class="ident" id="4284856">writeLoop</span><span class="op" id="4284865">(</span><span class="op" id="4284866">)</span>&nbsp;<span class="op" id="4284868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284871">for</span>&nbsp;<span class="op" id="4284875">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284879">select</span>&nbsp;<span class="op" id="4284886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284890">case</span>&nbsp;<span class="ident" id="4284895">wr</span>&nbsp;<span class="op" id="4284898">:=</span>&nbsp;<span class="op" id="4284901">&lt;-</span><span class="ident" id="4284903"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4284905">.</span><span class="ident" id="4284906"><a href="/gostd/net/http/transport.go.html#4280951">writech</a></span><span class="op" id="4284913">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4284918">if</span>&nbsp;<span class="ident" id="4284921"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4284923">.</span><span class="ident" id="4284924"><a href="/gostd/net/http/transport.go.html#4281921">isBroken</a></span><span class="op" id="4284932">(</span><span class="op" id="4284933">)</span>&nbsp;<span class="op" id="4284935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4284941"><a href="/gostd/net/http/transport.go.html#4284895">wr</a></span><span class="op" id="4284943">.</span><span class="ident" id="4284944"><a href="/gostd/net/http/transport.go.html#4286963">ch</a></span>&nbsp;<span class="op" id="4284947">&lt;-</span>&nbsp;<span class="ident" id="4284950"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4284956">.</span><span class="ident" id="4284957"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4284960">(</span><span class="string" id="4284961">&#34;http:&nbsp;can&#39;t&nbsp;write&nbsp;HTTP&nbsp;request&nbsp;on&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="4285014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285020">continue</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285037">err</span>&nbsp;<span class="op" id="4285041">:=</span>&nbsp;<span class="ident" id="4285044"><a href="/gostd/net/http/transport.go.html#4284895">wr</a></span><span class="op" id="4285046">.</span><span class="ident" id="4285047"><a href="/gostd/net/http/transport.go.html#4286940">req</a></span><span class="op" id="4285050">.</span><span class="ident" id="4285051"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4285058">.</span><span class="ident" id="4285059"><a href="/gostd/net/http/request.go.html#4146555">write</a></span><span class="op" id="4285064">(</span><span class="ident" id="4285065"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285067">.</span><span class="ident" id="4285068"><a href="/gostd/net/http/transport.go.html#4280838">bw</a></span><span class="op" id="4285070">,</span>&nbsp;<span class="ident" id="4285072"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285074">.</span><span class="ident" id="4285075"><a href="/gostd/net/http/transport.go.html#4281081">isProxy</a></span><span class="op" id="4285082">,</span>&nbsp;<span class="ident" id="4285084"><a href="/gostd/net/http/transport.go.html#4284895">wr</a></span><span class="op" id="4285086">.</span><span class="ident" id="4285087"><a href="/gostd/net/http/transport.go.html#4286940">req</a></span><span class="op" id="4285090">.</span><span class="ident" id="4285091"><a href="/gostd/net/http/transport.go.html#4265461">extra</a></span><span class="op" id="4285096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285101">if</span>&nbsp;<span class="ident" id="4285104"><a href="/gostd/net/http/transport.go.html#4285037">err</a></span>&nbsp;<span class="op" id="4285108">==</span>&nbsp;<span class="builtintype" id="4285111">nil</span>&nbsp;<span class="op" id="4285115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285121"><a href="/gostd/net/http/transport.go.html#4285037">err</a></span>&nbsp;<span class="op" id="4285125">=</span>&nbsp;<span class="ident" id="4285127"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285129">.</span><span class="ident" id="4285130"><a href="/gostd/net/http/transport.go.html#4280838">bw</a></span><span class="op" id="4285132">.</span><span class="ident" id="4285133"><a href="/gostd/bufio/bufio.go.html#1367486">Flush</a></span><span class="op" id="4285138">(</span><span class="op" id="4285139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285144">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285149">if</span>&nbsp;<span class="ident" id="4285152"><a href="/gostd/net/http/transport.go.html#4285037">err</a></span>&nbsp;<span class="op" id="4285156">!=</span>&nbsp;<span class="builtintype" id="4285159">nil</span>&nbsp;<span class="op" id="4285163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285169"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285171">.</span><span class="ident" id="4285172"><a href="/gostd/net/http/transport.go.html#4290704">markBroken</a></span><span class="op" id="4285182">(</span><span class="op" id="4285183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285189"><a href="/gostd/net/http/transport.go.html#4284895">wr</a></span><span class="op" id="4285191">.</span><span class="ident" id="4285192"><a href="/gostd/net/http/transport.go.html#4286940">req</a></span><span class="op" id="4285195">.</span><span class="ident" id="4285196"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4285203">.</span><span class="ident" id="4285204"><a href="/gostd/net/http/request.go.html#4160935">closeBody</a></span><span class="op" id="4285213">(</span><span class="op" id="4285214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285224"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285226">.</span><span class="ident" id="4285227"><a href="/gostd/net/http/transport.go.html#4281341">writeErrCh</a></span>&nbsp;<span class="op" id="4285238">&lt;-</span>&nbsp;<span class="ident" id="4285241"><a href="/gostd/net/http/transport.go.html#4285037">err</a></span>&nbsp;<span class="comment" id="4285245">//&nbsp;to&nbsp;the&nbsp;body&nbsp;reader,&nbsp;which&nbsp;might&nbsp;recycle&nbsp;us</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4285294"><a href="/gostd/net/http/transport.go.html#4284895">wr</a></span><span class="op" id="4285296">.</span><span class="ident" id="4285297"><a href="/gostd/net/http/transport.go.html#4286963">ch</a></span>&nbsp;<span class="op" id="4285300">&lt;-</span>&nbsp;<span class="ident" id="4285303"><a href="/gostd/net/http/transport.go.html#4285037">err</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285315">//&nbsp;to&nbsp;the&nbsp;roundTrip&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285346">case</span>&nbsp;<span class="op" id="4285351">&lt;-</span><span class="ident" id="4285353"><a href="/gostd/net/http/transport.go.html#4284839">pc</a></span><span class="op" id="4285355">.</span><span class="ident" id="4285356"><a href="/gostd/net/http/transport.go.html#4281024">closech</a></span><span class="op" id="4285363">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285368">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4285380">}</span><br>
<span class="lineno">965</span><span class="op" id="4285382">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4285385">//&nbsp;wroteRequest&nbsp;is&nbsp;a&nbsp;check&nbsp;before&nbsp;recycling&nbsp;a&nbsp;connection&nbsp;that&nbsp;the&nbsp;previous&nbsp;write</span><br>
<span class="lineno"></span><span class="comment" id="4285466">//&nbsp;(from&nbsp;writeLoop&nbsp;above)&nbsp;happened&nbsp;and&nbsp;was&nbsp;successful.</span><br>
<span class="lineno"></span><span class="keyword" id="4285521">func</span>&nbsp;<span class="op" id="4285526">(</span><span class="ident" id="4285527">pc</span>&nbsp;<span class="op" id="4285530">*</span><span class="ident" id="4285531"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4285542">)</span>&nbsp;<span class="ident" id="4285544">wroteRequest</span><span class="op" id="4285556">(</span><span class="op" id="4285557">)</span>&nbsp;<span class="builtintype" id="4285559">bool</span>&nbsp;<span class="op" id="4285564">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285567">select</span>&nbsp;<span class="op" id="4285574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285577">case</span>&nbsp;<span class="ident" id="4285582">err</span>&nbsp;<span class="op" id="4285586">:=</span>&nbsp;<span class="op" id="4285589">&lt;-</span><span class="ident" id="4285591"><a href="/gostd/net/http/transport.go.html#4285527">pc</a></span><span class="op" id="4285593">.</span><span class="ident" id="4285594"><a href="/gostd/net/http/transport.go.html#4281341">writeErrCh</a></span><span class="op" id="4285604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285608">//&nbsp;Common&nbsp;case:&nbsp;the&nbsp;write&nbsp;happened&nbsp;well&nbsp;before&nbsp;the&nbsp;response,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285674">//&nbsp;avoid&nbsp;creating&nbsp;a&nbsp;timer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285703">return</span>&nbsp;<span class="ident" id="4285710"><a href="/gostd/net/http/transport.go.html#4285582">err</a></span>&nbsp;<span class="op" id="4285714">==</span>&nbsp;<span class="builtintype" id="4285717">nil</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4285722">default</span><span class="op" id="4285729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285733">//&nbsp;Rare&nbsp;case:&nbsp;the&nbsp;request&nbsp;was&nbsp;written&nbsp;in&nbsp;writeLoop&nbsp;above&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285796">//&nbsp;before&nbsp;it&nbsp;could&nbsp;send&nbsp;to&nbsp;pc.writeErrCh,&nbsp;the&nbsp;reader&nbsp;read&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285859">//&nbsp;all,&nbsp;processed&nbsp;it,&nbsp;and&nbsp;called&nbsp;us&nbsp;here.&nbsp;In&nbsp;this&nbsp;case,&nbsp;give&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285926">//&nbsp;write&nbsp;goroutine&nbsp;a&nbsp;bit&nbsp;of&nbsp;time&nbsp;to&nbsp;finish&nbsp;its&nbsp;send.</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285981">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4285986">//&nbsp;Less&nbsp;rare&nbsp;case:&nbsp;We&nbsp;also&nbsp;get&nbsp;here&nbsp;in&nbsp;the&nbsp;legitimate&nbsp;case&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286050">//&nbsp;Issue&nbsp;7569,&nbsp;where&nbsp;the&nbsp;writer&nbsp;is&nbsp;still&nbsp;writing&nbsp;(or&nbsp;stalled),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286115">//&nbsp;but&nbsp;the&nbsp;server&nbsp;has&nbsp;already&nbsp;replied.&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286179">//&nbsp;want&nbsp;to&nbsp;wait&nbsp;too&nbsp;long,&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;return&nbsp;false&nbsp;so&nbsp;this</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286243">//&nbsp;connection&nbsp;isn&#39;t&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286274">select</span>&nbsp;<span class="op" id="4286281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286285">case</span>&nbsp;<span class="ident" id="4286290">err</span>&nbsp;<span class="op" id="4286294">:=</span>&nbsp;<span class="op" id="4286297">&lt;-</span><span class="ident" id="4286299"><a href="/gostd/net/http/transport.go.html#4285527">pc</a></span><span class="op" id="4286301">.</span><span class="ident" id="4286302"><a href="/gostd/net/http/transport.go.html#4281341">writeErrCh</a></span><span class="op" id="4286312">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286317">return</span>&nbsp;<span class="ident" id="4286324"><a href="/gostd/net/http/transport.go.html#4286290">err</a></span>&nbsp;<span class="op" id="4286328">==</span>&nbsp;<span class="builtintype" id="4286331">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286337">case</span>&nbsp;<span class="op" id="4286342">&lt;-</span><span class="ident" id="4286344"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4286348">.</span><span class="ident" id="4286349"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="4286354">(</span><span class="num" id="4286355">50</span>&nbsp;<span class="op" id="4286358">*</span>&nbsp;<span class="ident" id="4286360"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4286364">.</span><span class="ident" id="4286365"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="4286376">)</span><span class="op" id="4286377">:</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4286382">return</span>&nbsp;<span class="builtintype" id="4286389">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4286397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4286400">}</span><br>
<span class="lineno"></span><span class="op" id="4286402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="4286405">type</span>&nbsp;<span class="ident" id="4286410">responseAndError</span>&nbsp;<span class="keyword" id="4286427">struct</span>&nbsp;<span class="op" id="4286434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286437">res</span>&nbsp;<span class="op" id="4286441">*</span><span class="ident" id="4286442"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286452">err</span>&nbsp;<span class="builtintype" id="4286456">error</span><br>
<span class="lineno"></span><span class="op" id="4286462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1000</span><span class="keyword" id="4286465">type</span>&nbsp;<span class="ident" id="4286470">requestAndChan</span>&nbsp;<span class="keyword" id="4286485">struct</span>&nbsp;<span class="op" id="4286492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286495">req</span>&nbsp;<span class="op" id="4286499">*</span><span class="ident" id="4286500"><a href="/gostd/net/http/request.go.html#4135954">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286509">ch</span>&nbsp;&nbsp;<span class="keyword" id="4286513">chan</span>&nbsp;<span class="ident" id="4286518"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286537">//&nbsp;did&nbsp;the&nbsp;Transport&nbsp;(as&nbsp;opposed&nbsp;to&nbsp;the&nbsp;client&nbsp;code)&nbsp;add&nbsp;an</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286598">//&nbsp;Accept-Encoding&nbsp;gzip&nbsp;header?&nbsp;only&nbsp;if&nbsp;it&nbsp;we&nbsp;set&nbsp;it&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4286655">//&nbsp;we&nbsp;transparently&nbsp;decode&nbsp;the&nbsp;gzip.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286693">addedGzip</span>&nbsp;<span class="builtintype" id="4286703">bool</span><br>
<span class="lineno"></span><span class="op" id="4286708">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="4286711">//&nbsp;A&nbsp;writeRequest&nbsp;is&nbsp;sent&nbsp;by&nbsp;the&nbsp;readLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4286772">//&nbsp;writeLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;while&nbsp;the&nbsp;read&nbsp;loop</span><br>
<span class="lineno"></span><span class="comment" id="4286836">//&nbsp;concurrently&nbsp;waits&nbsp;on&nbsp;both&nbsp;the&nbsp;write&nbsp;response&nbsp;and&nbsp;the&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="4286902">//&nbsp;reply.</span><br>
<span class="lineno"></span><span class="keyword" id="4286912">type</span>&nbsp;<span class="ident" id="4286917">writeRequest</span>&nbsp;<span class="keyword" id="4286930">struct</span>&nbsp;<span class="op" id="4286937">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286940">req</span>&nbsp;<span class="op" id="4286944">*</span><span class="ident" id="4286945"><a href="/gostd/net/http/transport.go.html#4265378">transportRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4286963">ch</span>&nbsp;&nbsp;<span class="keyword" id="4286967">chan</span><span class="op" id="4286971">&lt;-</span>&nbsp;<span class="builtintype" id="4286974">error</span><br>
<span class="lineno"></span><span class="op" id="4286980">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4286983">type</span>&nbsp;<span class="ident" id="4286988">httpError</span>&nbsp;<span class="keyword" id="4286998">struct</span>&nbsp;<span class="op" id="4287005">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287008">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4287016">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287024">timeout</span>&nbsp;<span class="builtintype" id="4287032">bool</span><br>
<span class="lineno"></span><span class="op" id="4287037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287040">func</span>&nbsp;<span class="op" id="4287045">(</span><span class="ident" id="4287046">e</span>&nbsp;<span class="op" id="4287048">*</span><span class="ident" id="4287049"><a href="/gostd/net/http/transport.go.html#4286988">httpError</a></span><span class="op" id="4287058">)</span>&nbsp;<span class="ident" id="4287060">Error</span><span class="op" id="4287065">(</span><span class="op" id="4287066">)</span>&nbsp;<span class="builtintype" id="4287068">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4287077">{</span>&nbsp;<span class="keyword" id="4287079">return</span>&nbsp;<span class="ident" id="4287086"><a href="/gostd/net/http/transport.go.html#4287046">e</a></span><span class="op" id="4287087">.</span><span class="ident" id="4287088"><a href="/gostd/net/http/transport.go.html#4287008">err</a></span>&nbsp;<span class="op" id="4287092">}</span><br>
<span class="lineno">1025</span><span class="keyword" id="4287094">func</span>&nbsp;<span class="op" id="4287099">(</span><span class="ident" id="4287100">e</span>&nbsp;<span class="op" id="4287102">*</span><span class="ident" id="4287103"><a href="/gostd/net/http/transport.go.html#4286988">httpError</a></span><span class="op" id="4287112">)</span>&nbsp;<span class="ident" id="4287114">Timeout</span><span class="op" id="4287121">(</span><span class="op" id="4287122">)</span>&nbsp;<span class="builtintype" id="4287124">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4287131">{</span>&nbsp;<span class="keyword" id="4287133">return</span>&nbsp;<span class="ident" id="4287140"><a href="/gostd/net/http/transport.go.html#4287100">e</a></span><span class="op" id="4287141">.</span><span class="ident" id="4287142"><a href="/gostd/net/http/transport.go.html#4287024">timeout</a></span>&nbsp;<span class="op" id="4287150">}</span><br>
<span class="lineno"></span><span class="keyword" id="4287152">func</span>&nbsp;<span class="op" id="4287157">(</span><span class="ident" id="4287158">e</span>&nbsp;<span class="op" id="4287160">*</span><span class="ident" id="4287161"><a href="/gostd/net/http/transport.go.html#4286988">httpError</a></span><span class="op" id="4287170">)</span>&nbsp;<span class="ident" id="4287172">Temporary</span><span class="op" id="4287181">(</span><span class="op" id="4287182">)</span>&nbsp;<span class="builtintype" id="4287184">bool</span>&nbsp;<span class="op" id="4287189">{</span>&nbsp;<span class="keyword" id="4287191">return</span>&nbsp;<span class="builtintype" id="4287198">true</span>&nbsp;<span class="op" id="4287203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4287206">var</span>&nbsp;<span class="ident" id="4287210">errTimeout</span>&nbsp;<span class="builtintype" id="4287221">error</span>&nbsp;<span class="op" id="4287227">=</span>&nbsp;<span class="op" id="4287229">&amp;</span><span class="ident" id="4287230"><a href="/gostd/net/http/transport.go.html#4286988">httpError</a></span><span class="op" id="4287239">{</span><span class="ident" id="4287240"><a href="/gostd/net/http/transport.go.html#4287008">err</a></span><span class="op" id="4287243">:</span>&nbsp;<span class="string" id="4287245">&#34;net/http:&nbsp;timeout&nbsp;awaiting&nbsp;response&nbsp;headers&#34;</span><span class="op" id="4287290">,</span>&nbsp;<span class="ident" id="4287292"><a href="/gostd/net/http/transport.go.html#4287024">timeout</a></span><span class="op" id="4287299">:</span>&nbsp;<span class="builtintype" id="4287301">true</span><span class="op" id="4287305">}</span><br>
<span class="lineno"></span><span class="keyword" id="4287307">var</span>&nbsp;<span class="ident" id="4287311">errClosed</span>&nbsp;<span class="builtintype" id="4287321">error</span>&nbsp;<span class="op" id="4287327">=</span>&nbsp;<span class="op" id="4287329">&amp;</span><span class="ident" id="4287330"><a href="/gostd/net/http/transport.go.html#4286988">httpError</a></span><span class="op" id="4287339">{</span><span class="ident" id="4287340"><a href="/gostd/net/http/transport.go.html#4287008">err</a></span><span class="op" id="4287343">:</span>&nbsp;<span class="string" id="4287345">&#34;net/http:&nbsp;transport&nbsp;closed&nbsp;before&nbsp;response&nbsp;was&nbsp;received&#34;</span><span class="op" id="4287402">}</span><br>
<span class="lineno">1030</span><br>
<span class="lineno"></span><span class="keyword" id="4287405">func</span>&nbsp;<span class="op" id="4287410">(</span><span class="ident" id="4287411">pc</span>&nbsp;<span class="op" id="4287414">*</span><span class="ident" id="4287415"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4287426">)</span>&nbsp;<span class="ident" id="4287428">roundTrip</span><span class="op" id="4287437">(</span><span class="ident" id="4287438">req</span>&nbsp;<span class="op" id="4287442">*</span><span class="ident" id="4287443"><a href="/gostd/net/http/transport.go.html#4265378">transportRequest</a></span><span class="op" id="4287459">)</span>&nbsp;<span class="op" id="4287461">(</span><span class="ident" id="4287462">resp</span>&nbsp;<span class="op" id="4287467">*</span><span class="ident" id="4287468"><a href="/gostd/net/http/response.go.html#4161509">Response</a></span><span class="op" id="4287476">,</span>&nbsp;<span class="ident" id="4287478">err</span>&nbsp;<span class="builtintype" id="4287482">error</span><span class="op" id="4287487">)</span>&nbsp;<span class="op" id="4287489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287492"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287494">.</span><span class="ident" id="4287495"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4287496">.</span><span class="ident" id="4287497"><a href="/gostd/net/http/transport.go.html#4272446">setReqCanceler</a></span><span class="op" id="4287511">(</span><span class="ident" id="4287512"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4287515">.</span><span class="ident" id="4287516"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4287523">,</span>&nbsp;<span class="ident" id="4287525"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287527">.</span><span class="ident" id="4287528"><a href="/gostd/net/http/transport.go.html#4282021">cancelRequest</a></span><span class="op" id="4287541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287544"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287546">.</span><span class="ident" id="4287547"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4287549">.</span><span class="ident" id="4287550"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4287554">(</span><span class="op" id="4287555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287558"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287560">.</span><span class="ident" id="4287561"><a href="/gostd/net/http/transport.go.html#4281425">numExpectedResponses</a></span><span class="op" id="4287581">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287585">headerFn</span>&nbsp;<span class="op" id="4287594">:=</span>&nbsp;<span class="ident" id="4287597"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287599">.</span><span class="ident" id="4287600"><a href="/gostd/net/http/transport.go.html#4281793">mutateHeaderFunc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287618"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287620">.</span><span class="ident" id="4287621"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4287623">.</span><span class="ident" id="4287624"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4287630">(</span><span class="op" id="4287631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4287635">if</span>&nbsp;<span class="ident" id="4287638"><a href="/gostd/net/http/transport.go.html#4287585">headerFn</a></span>&nbsp;<span class="op" id="4287647">!=</span>&nbsp;<span class="builtintype" id="4287650">nil</span>&nbsp;<span class="op" id="4287654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287658"><a href="/gostd/net/http/transport.go.html#4287585">headerFn</a></span><span class="op" id="4287666">(</span><span class="ident" id="4287667"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4287670">.</span><span class="ident" id="4287671"><a href="/gostd/net/http/transport.go.html#4265542">extraHeaders</a></span><span class="op" id="4287683">(</span><span class="op" id="4287684">)</span><span class="op" id="4287685">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4287688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4287692">//&nbsp;Ask&nbsp;for&nbsp;a&nbsp;compressed&nbsp;version&nbsp;if&nbsp;the&nbsp;caller&nbsp;didn&#39;t&nbsp;set&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4287756">//&nbsp;own&nbsp;value&nbsp;for&nbsp;Accept-Encoding.&nbsp;We&nbsp;only&nbsp;attempt&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4287810">//&nbsp;uncompress&nbsp;the&nbsp;gzip&nbsp;stream&nbsp;if&nbsp;we&nbsp;were&nbsp;the&nbsp;layer&nbsp;that</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4287867">//&nbsp;requested&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287885">requestedGzip</span>&nbsp;<span class="op" id="4287899">:=</span>&nbsp;<span class="builtintype" id="4287902">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4287909">if</span>&nbsp;<span class="op" id="4287912">!</span><span class="ident" id="4287913"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4287915">.</span><span class="ident" id="4287916"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4287917">.</span><span class="ident" id="4287918"><a href="/gostd/net/http/transport.go.html#4262923">DisableCompression</a></span>&nbsp;<span class="op" id="4287937">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287942"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4287945">.</span><span class="ident" id="4287946"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4287952">.</span><span class="ident" id="4287953"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="4287956">(</span><span class="string" id="4287957">&#34;Accept-Encoding&#34;</span><span class="op" id="4287974">)</span>&nbsp;<span class="op" id="4287976">==</span>&nbsp;<span class="string" id="4287979">&#34;&#34;</span>&nbsp;<span class="op" id="4287982">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4287987"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4287990">.</span><span class="ident" id="4287991"><a href="/gostd/net/http/request.go.html#4137563">Header</a></span><span class="op" id="4287997">.</span><span class="ident" id="4287998"><a href="/gostd/net/http/header.go.html#4126793">Get</a></span><span class="op" id="4288001">(</span><span class="string" id="4288002">&#34;Range&#34;</span><span class="op" id="4288009">)</span>&nbsp;<span class="op" id="4288011">==</span>&nbsp;<span class="string" id="4288014">&#34;&#34;</span>&nbsp;<span class="op" id="4288017">&amp;&amp;</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288022"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4288025">.</span><span class="ident" id="4288026"><a href="/gostd/net/http/request.go.html#4136084">Method</a></span>&nbsp;<span class="op" id="4288033">!=</span>&nbsp;<span class="string" id="4288036">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="4288043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288047">//&nbsp;Request&nbsp;gzip&nbsp;only,&nbsp;not&nbsp;deflate.&nbsp;Deflate&nbsp;is&nbsp;ambiguous&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288109">//&nbsp;not&nbsp;as&nbsp;universally&nbsp;supported&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288151">//&nbsp;See:&nbsp;http://www.gzip.org/zlib/zlib_faq.html#faq38</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288206">//</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288211">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;request&nbsp;this&nbsp;for&nbsp;HEAD&nbsp;requests,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288267">//&nbsp;due&nbsp;to&nbsp;a&nbsp;bug&nbsp;in&nbsp;nginx:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288295">//&nbsp;&nbsp;&nbsp;http://trac.nginx.org/nginx/ticket/358</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288341">//&nbsp;&nbsp;&nbsp;http://golang.org/issue/5522</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288377">//</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288382">//&nbsp;We&nbsp;don&#39;t&nbsp;request&nbsp;gzip&nbsp;if&nbsp;the&nbsp;request&nbsp;is&nbsp;for&nbsp;a&nbsp;range,&nbsp;since</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288446">//&nbsp;auto-decoding&nbsp;a&nbsp;portion&nbsp;of&nbsp;a&nbsp;gzipped&nbsp;document&nbsp;will&nbsp;just&nbsp;fail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288512">//&nbsp;anyway.&nbsp;See&nbsp;http://golang.org/issue/8923</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288558"><a href="/gostd/net/http/transport.go.html#4287885">requestedGzip</a></span>&nbsp;<span class="op" id="4288572">=</span>&nbsp;<span class="builtintype" id="4288574">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288581"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4288584">.</span><span class="ident" id="4288585"><a href="/gostd/net/http/transport.go.html#4265542">extraHeaders</a></span><span class="op" id="4288597">(</span><span class="op" id="4288598">)</span><span class="op" id="4288599">.</span><span class="ident" id="4288600"><a href="/gostd/net/http/header.go.html#4126491">Set</a></span><span class="op" id="4288603">(</span><span class="string" id="4288604">&#34;Accept-Encoding&#34;</span><span class="op" id="4288621">,</span>&nbsp;<span class="string" id="4288623">&#34;gzip&#34;</span><span class="op" id="4288629">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4288632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288636">//&nbsp;Write&nbsp;the&nbsp;request&nbsp;concurrently&nbsp;with&nbsp;waiting&nbsp;for&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288700">//&nbsp;in&nbsp;case&nbsp;the&nbsp;server&nbsp;decides&nbsp;to&nbsp;reply&nbsp;before&nbsp;reading&nbsp;our&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4288764">//&nbsp;request&nbsp;body.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288782">writeErrCh</span>&nbsp;<span class="op" id="4288793">:=</span>&nbsp;<span class="builtinfunc" id="4288796">make</span><span class="op" id="4288800">(</span><span class="keyword" id="4288801">chan</span>&nbsp;<span class="builtintype" id="4288806">error</span><span class="op" id="4288811">,</span>&nbsp;<span class="num" id="4288813">1</span><span class="op" id="4288814">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288817"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4288819">.</span><span class="ident" id="4288820"><a href="/gostd/net/http/transport.go.html#4280951">writech</a></span>&nbsp;<span class="op" id="4288828">&lt;-</span>&nbsp;<span class="ident" id="4288831"><a href="/gostd/net/http/transport.go.html#4286917">writeRequest</a></span><span class="op" id="4288843">{</span><span class="ident" id="4288844"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4288847">,</span>&nbsp;<span class="ident" id="4288849"><a href="/gostd/net/http/transport.go.html#4288782">writeErrCh</a></span><span class="op" id="4288859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288863">resc</span>&nbsp;<span class="op" id="4288868">:=</span>&nbsp;<span class="builtinfunc" id="4288871">make</span><span class="op" id="4288875">(</span><span class="keyword" id="4288876">chan</span>&nbsp;<span class="ident" id="4288881"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><span class="op" id="4288897">,</span>&nbsp;<span class="num" id="4288899">1</span><span class="op" id="4288900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4288903"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4288905">.</span><span class="ident" id="4288906"><a href="/gostd/net/http/transport.go.html#4280879">reqch</a></span>&nbsp;<span class="op" id="4288912">&lt;-</span>&nbsp;<span class="ident" id="4288915"><a href="/gostd/net/http/transport.go.html#4286470">requestAndChan</a></span><span class="op" id="4288929">{</span><span class="ident" id="4288930"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4288933">.</span><span class="ident" id="4288934"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4288941">,</span>&nbsp;<span class="ident" id="4288943"><a href="/gostd/net/http/transport.go.html#4288863">resc</a></span><span class="op" id="4288947">,</span>&nbsp;<span class="ident" id="4288949"><a href="/gostd/net/http/transport.go.html#4287885">requestedGzip</a></span><span class="op" id="4288962">}</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4288966">var</span>&nbsp;<span class="ident" id="4288970">re</span>&nbsp;<span class="ident" id="4288973"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4288991">var</span>&nbsp;<span class="ident" id="4288995">pconnDeadCh</span>&nbsp;<span class="op" id="4289007">=</span>&nbsp;<span class="ident" id="4289009"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4289011">.</span><span class="ident" id="4289012"><a href="/gostd/net/http/transport.go.html#4281024">closech</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289021">var</span>&nbsp;<span class="ident" id="4289025">failTicker</span>&nbsp;<span class="op" id="4289036">&lt;-</span><span class="keyword" id="4289038">chan</span>&nbsp;<span class="ident" id="4289043"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4289047">.</span><span class="ident" id="4289048"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289054">var</span>&nbsp;<span class="ident" id="4289058">respHeaderTimer</span>&nbsp;<span class="op" id="4289074">&lt;-</span><span class="keyword" id="4289076">chan</span>&nbsp;<span class="ident" id="4289081"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4289085">.</span><span class="ident" id="4289086"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno">1080</span><span class="ident" id="4289091">WaitResponse</span><span class="op" id="4289103">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289106">for</span>&nbsp;<span class="op" id="4289110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289114">select</span>&nbsp;<span class="op" id="4289121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289125">case</span>&nbsp;<span class="ident" id="4289130">err</span>&nbsp;<span class="op" id="4289134">:=</span>&nbsp;<span class="op" id="4289137">&lt;-</span><span class="ident" id="4289139"><a href="/gostd/net/http/transport.go.html#4288782">writeErrCh</a></span><span class="op" id="4289149">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289154">if</span>&nbsp;<span class="ident" id="4289157"><a href="/gostd/net/http/transport.go.html#4289130">err</a></span>&nbsp;<span class="op" id="4289161">!=</span>&nbsp;<span class="builtintype" id="4289164">nil</span>&nbsp;<span class="op" id="4289168">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4289174"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span>&nbsp;<span class="op" id="4289177">=</span>&nbsp;<span class="ident" id="4289179"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><span class="op" id="4289195">{</span><span class="builtintype" id="4289196">nil</span><span class="op" id="4289199">,</span>&nbsp;<span class="ident" id="4289201"><a href="/gostd/net/http/transport.go.html#4289130">err</a></span><span class="op" id="4289204">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4289210"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4289212">.</span><span class="builtinfunc" id="4289213"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4289218">(</span><span class="op" id="4289219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289225">break</span>&nbsp;<span class="ident" id="4289231"><a href="/gostd/net/http/transport.go.html#4289091">WaitResponse</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4289247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289252">if</span>&nbsp;<span class="ident" id="4289255">d</span>&nbsp;<span class="op" id="4289257">:=</span>&nbsp;<span class="ident" id="4289260"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4289262">.</span><span class="ident" id="4289263"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4289264">.</span><span class="ident" id="4289265"><a href="/gostd/net/http/transport.go.html#4263370">ResponseHeaderTimeout</a></span><span class="op" id="4289286">;</span>&nbsp;<span class="ident" id="4289288"><a href="/gostd/net/http/transport.go.html#4289255">d</a></span>&nbsp;<span class="op" id="4289290">&gt;</span>&nbsp;<span class="num" id="4289292">0</span>&nbsp;<span class="op" id="4289294">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4289300"><a href="/gostd/net/http/transport.go.html#4289058">respHeaderTimer</a></span>&nbsp;<span class="op" id="4289316">=</span>&nbsp;<span class="ident" id="4289318"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4289322">.</span><span class="ident" id="4289323"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="4289328">(</span><span class="ident" id="4289329"><a href="/gostd/net/http/transport.go.html#4289255">d</a></span><span class="op" id="4289330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4289335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4289339">case</span>&nbsp;<span class="op" id="4289344">&lt;-</span><span class="ident" id="4289346"><a href="/gostd/net/http/transport.go.html#4288995">pconnDeadCh</a></span><span class="op" id="4289357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289362">//&nbsp;The&nbsp;persist&nbsp;connection&nbsp;is&nbsp;dead.&nbsp;This&nbsp;shouldn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289415">//&nbsp;usually&nbsp;happen&nbsp;(only&nbsp;with&nbsp;Connection:&nbsp;close&nbsp;responses</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289475">//&nbsp;with&nbsp;no&nbsp;response&nbsp;bodies),&nbsp;but&nbsp;if&nbsp;it&nbsp;does&nbsp;happen&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289532">//&nbsp;means&nbsp;either&nbsp;a)&nbsp;the&nbsp;remote&nbsp;server&nbsp;hung&nbsp;up&nbsp;on&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289586">//&nbsp;prematurely,&nbsp;or&nbsp;b)&nbsp;the&nbsp;readLoop&nbsp;sent&nbsp;us&nbsp;a&nbsp;response&nbsp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289645">//&nbsp;closed&nbsp;its&nbsp;closech&nbsp;at&nbsp;roughly&nbsp;the&nbsp;same&nbsp;time,&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289703">//&nbsp;selected&nbsp;this&nbsp;case&nbsp;first,&nbsp;in&nbsp;which&nbsp;case&nbsp;a&nbsp;response</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289760">//&nbsp;might&nbsp;still&nbsp;be&nbsp;coming&nbsp;soon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289794">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289800">//&nbsp;We&nbsp;can&#39;t&nbsp;avoid&nbsp;the&nbsp;select&nbsp;race&nbsp;in&nbsp;b)&nbsp;by&nbsp;using&nbsp;a&nbsp;unbuffered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289865">//&nbsp;resc&nbsp;channel&nbsp;instead,&nbsp;because&nbsp;then&nbsp;goroutines&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4289921">//&nbsp;leak&nbsp;if&nbsp;we&nbsp;exit&nbsp;due&nbsp;to&nbsp;other&nbsp;errors.</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4289964"><a href="/gostd/net/http/transport.go.html#4288995">pconnDeadCh</a></span>&nbsp;<span class="op" id="4289976">=</span>&nbsp;<span class="builtintype" id="4289978">nil</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4290012">//&nbsp;avoid&nbsp;spinning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290033"><a href="/gostd/net/http/transport.go.html#4289025">failTicker</a></span>&nbsp;<span class="op" id="4290044">=</span>&nbsp;<span class="ident" id="4290046"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4290050">.</span><span class="ident" id="4290051"><a href="/gostd/time/sleep.go.html#2716644">After</a></span><span class="op" id="4290056">(</span><span class="num" id="4290057">100</span>&nbsp;<span class="op" id="4290061">*</span>&nbsp;<span class="ident" id="4290063"><a href="/gostd/net/http/transport.go.html#4259930">time</a></span><span class="op" id="4290067">.</span><span class="ident" id="4290068"><a href="/gostd/time/time.go.html#2734819">Millisecond</a></span><span class="op" id="4290079">)</span>&nbsp;<span class="comment" id="4290081">//&nbsp;arbitrary&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;resc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290118">case</span>&nbsp;<span class="op" id="4290123">&lt;-</span><span class="ident" id="4290125"><a href="/gostd/net/http/transport.go.html#4289025">failTicker</a></span><span class="op" id="4290135">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290140"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span>&nbsp;<span class="op" id="4290143">=</span>&nbsp;<span class="ident" id="4290145"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><span class="op" id="4290161">{</span><span class="ident" id="4290162"><a href="/gostd/net/http/transport.go.html#4286452">err</a></span><span class="op" id="4290165">:</span>&nbsp;<span class="ident" id="4290167"><a href="/gostd/net/http/transport.go.html#4287311">errClosed</a></span><span class="op" id="4290176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290181">break</span>&nbsp;<span class="ident" id="4290187"><a href="/gostd/net/http/transport.go.html#4289091">WaitResponse</a></span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290202">case</span>&nbsp;<span class="op" id="4290207">&lt;-</span><span class="ident" id="4290209"><a href="/gostd/net/http/transport.go.html#4289058">respHeaderTimer</a></span><span class="op" id="4290224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290229"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4290231">.</span><span class="builtinfunc" id="4290232"><a href="/gostd/net/http/transport.go.html#4290799">close</a></span><span class="op" id="4290237">(</span><span class="op" id="4290238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290243"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span>&nbsp;<span class="op" id="4290246">=</span>&nbsp;<span class="ident" id="4290248"><a href="/gostd/net/http/transport.go.html#4286410">responseAndError</a></span><span class="op" id="4290264">{</span><span class="ident" id="4290265"><a href="/gostd/net/http/transport.go.html#4286452">err</a></span><span class="op" id="4290268">:</span>&nbsp;<span class="ident" id="4290270"><a href="/gostd/net/http/transport.go.html#4287210">errTimeout</a></span><span class="op" id="4290280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290285">break</span>&nbsp;<span class="ident" id="4290291"><a href="/gostd/net/http/transport.go.html#4289091">WaitResponse</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290306">case</span>&nbsp;<span class="ident" id="4290311"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span>&nbsp;<span class="op" id="4290314">=</span>&nbsp;<span class="op" id="4290316">&lt;-</span><span class="ident" id="4290318"><a href="/gostd/net/http/transport.go.html#4288863">resc</a></span><span class="op" id="4290322">:</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290327">break</span>&nbsp;<span class="ident" id="4290333"><a href="/gostd/net/http/transport.go.html#4289091">WaitResponse</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4290348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4290351">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290355"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4290357">.</span><span class="ident" id="4290358"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290360">.</span><span class="ident" id="4290361"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4290365">(</span><span class="op" id="4290366">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290369"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4290371">.</span><span class="ident" id="4290372"><a href="/gostd/net/http/transport.go.html#4281425">numExpectedResponses</a></span><span class="op" id="4290392">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290396"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4290398">.</span><span class="ident" id="4290399"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290401">.</span><span class="ident" id="4290402"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4290408">(</span><span class="op" id="4290409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290413">if</span>&nbsp;<span class="ident" id="4290416"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span><span class="op" id="4290418">.</span><span class="ident" id="4290419"><a href="/gostd/net/http/transport.go.html#4286452">err</a></span>&nbsp;<span class="op" id="4290423">!=</span>&nbsp;<span class="builtintype" id="4290426">nil</span>&nbsp;<span class="op" id="4290430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290434"><a href="/gostd/net/http/transport.go.html#4287411">pc</a></span><span class="op" id="4290436">.</span><span class="ident" id="4290437"><a href="/gostd/net/http/transport.go.html#4280612">t</a></span><span class="op" id="4290438">.</span><span class="ident" id="4290439"><a href="/gostd/net/http/transport.go.html#4272446">setReqCanceler</a></span><span class="op" id="4290453">(</span><span class="ident" id="4290454"><a href="/gostd/net/http/transport.go.html#4287438">req</a></span><span class="op" id="4290457">.</span><span class="ident" id="4290458"><a href="/gostd/net/http/transport.go.html#4265405">Request</a></span><span class="op" id="4290465">,</span>&nbsp;<span class="builtintype" id="4290467">nil</span><span class="op" id="4290470">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4290473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290476">return</span>&nbsp;<span class="ident" id="4290483"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span><span class="op" id="4290485">.</span><span class="ident" id="4290486"><a href="/gostd/net/http/transport.go.html#4286437">res</a></span><span class="op" id="4290489">,</span>&nbsp;<span class="ident" id="4290491"><a href="/gostd/net/http/transport.go.html#4288970">re</a></span><span class="op" id="4290493">.</span><span class="ident" id="4290494"><a href="/gostd/net/http/transport.go.html#4286452">err</a></span><br>
<span class="lineno"></span><span class="op" id="4290498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4290501">//&nbsp;markBroken&nbsp;marks&nbsp;a&nbsp;connection&nbsp;as&nbsp;broken&nbsp;(so&nbsp;it&#39;s&nbsp;not&nbsp;reused).</span><br>
<span class="lineno">1130</span><span class="comment" id="4290566">//&nbsp;It&nbsp;differs&nbsp;from&nbsp;close&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;close&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="4290631">//&nbsp;connection&nbsp;for&nbsp;use&nbsp;when&nbsp;it&#39;s&nbsp;still&nbsp;being&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="4290681">func</span>&nbsp;<span class="op" id="4290686">(</span><span class="ident" id="4290687">pc</span>&nbsp;<span class="op" id="4290690">*</span><span class="ident" id="4290691"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4290702">)</span>&nbsp;<span class="ident" id="4290704">markBroken</span><span class="op" id="4290714">(</span><span class="op" id="4290715">)</span>&nbsp;<span class="op" id="4290717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290720"><a href="/gostd/net/http/transport.go.html#4290687">pc</a></span><span class="op" id="4290722">.</span><span class="ident" id="4290723"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290725">.</span><span class="ident" id="4290726"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4290730">(</span><span class="op" id="4290731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290734">defer</span>&nbsp;<span class="ident" id="4290740"><a href="/gostd/net/http/transport.go.html#4290687">pc</a></span><span class="op" id="4290742">.</span><span class="ident" id="4290743"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290745">.</span><span class="ident" id="4290746"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4290752">(</span><span class="op" id="4290753">)</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290756"><a href="/gostd/net/http/transport.go.html#4290687">pc</a></span><span class="op" id="4290758">.</span><span class="ident" id="4290759"><a href="/gostd/net/http/transport.go.html#4281510">broken</a></span>&nbsp;<span class="op" id="4290766">=</span>&nbsp;<span class="builtintype" id="4290768">true</span><br>
<span class="lineno"></span><span class="op" id="4290773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4290776">func</span>&nbsp;<span class="op" id="4290781">(</span><span class="ident" id="4290782">pc</span>&nbsp;<span class="op" id="4290785">*</span><span class="ident" id="4290786"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4290797">)</span>&nbsp;<span class="builtinfunc" id="4290799">close</span><span class="op" id="4290804">(</span><span class="op" id="4290805">)</span>&nbsp;<span class="op" id="4290807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290810"><a href="/gostd/net/http/transport.go.html#4290782">pc</a></span><span class="op" id="4290812">.</span><span class="ident" id="4290813"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290815">.</span><span class="ident" id="4290816"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4290820">(</span><span class="op" id="4290821">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290824">defer</span>&nbsp;<span class="ident" id="4290830"><a href="/gostd/net/http/transport.go.html#4290782">pc</a></span><span class="op" id="4290832">.</span><span class="ident" id="4290833"><a href="/gostd/net/http/transport.go.html#4281365">lk</a></span><span class="op" id="4290835">.</span><span class="ident" id="4290836"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4290842">(</span><span class="op" id="4290843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290846"><a href="/gostd/net/http/transport.go.html#4290782">pc</a></span><span class="op" id="4290848">.</span><span class="ident" id="4290849"><a href="/gostd/net/http/transport.go.html#4290889">closeLocked</a></span><span class="op" id="4290860">(</span><span class="op" id="4290861">)</span><br>
<span class="lineno"></span><span class="op" id="4290863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4290866">func</span>&nbsp;<span class="op" id="4290871">(</span><span class="ident" id="4290872">pc</span>&nbsp;<span class="op" id="4290875">*</span><span class="ident" id="4290876"><a href="/gostd/net/http/transport.go.html#4280590">persistConn</a></span><span class="op" id="4290887">)</span>&nbsp;<span class="ident" id="4290889">closeLocked</span><span class="op" id="4290900">(</span><span class="op" id="4290901">)</span>&nbsp;<span class="op" id="4290903">{</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290906"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4290908">.</span><span class="ident" id="4290909"><a href="/gostd/net/http/transport.go.html#4281510">broken</a></span>&nbsp;<span class="op" id="4290916">=</span>&nbsp;<span class="builtintype" id="4290918">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4290924">if</span>&nbsp;<span class="op" id="4290927">!</span><span class="ident" id="4290928"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4290930">.</span><span class="ident" id="4290931"><a href="/gostd/net/http/transport.go.html#4281451">closed</a></span>&nbsp;<span class="op" id="4290938">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290942"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4290944">.</span><span class="ident" id="4290945"><a href="/gostd/net/http/transport.go.html#4280660">conn</a></span><span class="op" id="4290949">.</span><span class="ident" id="4290950"><a href="/gostd/net/net.go.html#3334987">Close</a></span><span class="op" id="4290955">(</span><span class="op" id="4290956">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4290960"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4290962">.</span><span class="ident" id="4290963"><a href="/gostd/net/http/transport.go.html#4281451">closed</a></span>&nbsp;<span class="op" id="4290970">=</span>&nbsp;<span class="builtintype" id="4290972">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4290979">close</span><span class="op" id="4290984">(</span><span class="ident" id="4290985"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4290987">.</span><span class="ident" id="4290988"><a href="/gostd/net/http/transport.go.html#4281024">closech</a></span><span class="op" id="4290995">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4290998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291001"><a href="/gostd/net/http/transport.go.html#4290872">pc</a></span><span class="op" id="4291003">.</span><span class="ident" id="4291004"><a href="/gostd/net/http/transport.go.html#4281793">mutateHeaderFunc</a></span>&nbsp;<span class="op" id="4291021">=</span>&nbsp;<span class="builtintype" id="4291023">nil</span><br>
<span class="lineno"></span><span class="op" id="4291027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4291030">var</span>&nbsp;<span class="ident" id="4291034">portMap</span>&nbsp;<span class="op" id="4291042">=</span>&nbsp;<span class="keyword" id="4291044">map</span><span class="op" id="4291047">[</span><span class="builtintype" id="4291048">string</span><span class="op" id="4291054">]</span><span class="builtintype" id="4291055">string</span><span class="op" id="4291061">{</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4291064">&#34;http&#34;</span><span class="op" id="4291070">:</span>&nbsp;&nbsp;<span class="string" id="4291073">&#34;80&#34;</span><span class="op" id="4291077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4291080">&#34;https&#34;</span><span class="op" id="4291087">:</span>&nbsp;<span class="string" id="4291089">&#34;443&#34;</span><span class="op" id="4291094">,</span><br>
<span class="lineno"></span><span class="op" id="4291096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291099">//&nbsp;canonicalAddr&nbsp;returns&nbsp;url.Host&nbsp;but&nbsp;always&nbsp;with&nbsp;a&nbsp;&#34;:port&#34;&nbsp;suffix</span><br>
<span class="lineno">1160</span><span class="keyword" id="4291166">func</span>&nbsp;<span class="ident" id="4291171">canonicalAddr</span><span class="op" id="4291184">(</span><span class="ident" id="4291185">url</span>&nbsp;<span class="op" id="4291189">*</span><span class="ident" id="4291190"><a href="/gostd/net/http/transport.go.html#4259894">url</a></span><span class="op" id="4291193">.</span><span class="ident" id="4291194"><a href="/gostd/net/url/url.go.html#3751194">URL</a></span><span class="op" id="4291197">)</span>&nbsp;<span class="builtintype" id="4291199">string</span>&nbsp;<span class="op" id="4291206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291209">addr</span>&nbsp;<span class="op" id="4291214">:=</span>&nbsp;<span class="ident" id="4291217"><a href="/gostd/net/http/transport.go.html#4291185">url</a></span><span class="op" id="4291220">.</span><span class="ident" id="4291221"><a href="/gostd/net/url/url.go.html#3751325">Host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291227">if</span>&nbsp;<span class="op" id="4291230">!</span><span class="ident" id="4291231"><a href="/gostd/net/http/client.go.html#4083528">hasPort</a></span><span class="op" id="4291238">(</span><span class="ident" id="4291239"><a href="/gostd/net/http/transport.go.html#4291209">addr</a></span><span class="op" id="4291243">)</span>&nbsp;<span class="op" id="4291245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291249">return</span>&nbsp;<span class="ident" id="4291256"><a href="/gostd/net/http/transport.go.html#4291209">addr</a></span>&nbsp;<span class="op" id="4291261">+</span>&nbsp;<span class="string" id="4291263">&#34;:&#34;</span>&nbsp;<span class="op" id="4291267">+</span>&nbsp;<span class="ident" id="4291269"><a href="/gostd/net/http/transport.go.html#4291034">portMap</a></span><span class="op" id="4291276">[</span><span class="ident" id="4291277"><a href="/gostd/net/http/transport.go.html#4291185">url</a></span><span class="op" id="4291280">.</span><span class="ident" id="4291281"><a href="/gostd/net/url/url.go.html#3751208">Scheme</a></span><span class="op" id="4291287">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4291290">}</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291293">return</span>&nbsp;<span class="ident" id="4291300"><a href="/gostd/net/http/transport.go.html#4291209">addr</a></span><br>
<span class="lineno"></span><span class="op" id="4291305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4291308">//&nbsp;bodyEOFSignal&nbsp;wraps&nbsp;a&nbsp;ReadCloser&nbsp;but&nbsp;runs&nbsp;fn&nbsp;(if&nbsp;non-nil)&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="4291377">//&nbsp;once,&nbsp;right&nbsp;before&nbsp;its&nbsp;final&nbsp;(error-producing)&nbsp;Read&nbsp;or&nbsp;Close&nbsp;call</span><br>
<span class="lineno">1170</span><span class="comment" id="4291446">//&nbsp;returns.&nbsp;If&nbsp;earlyCloseFn&nbsp;is&nbsp;non-nil&nbsp;and&nbsp;Close&nbsp;is&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="4291512">//&nbsp;io.EOF&nbsp;is&nbsp;seen,&nbsp;earlyCloseFn&nbsp;is&nbsp;called&nbsp;instead&nbsp;of&nbsp;fn,&nbsp;and&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="4291577">//&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;return&nbsp;value&nbsp;from&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="4291625">type</span>&nbsp;<span class="ident" id="4291630">bodyEOFSignal</span>&nbsp;<span class="keyword" id="4291644">struct</span>&nbsp;<span class="op" id="4291651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291654">body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291667"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4291669">.</span><span class="ident" id="4291670"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291682">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291695"><a href="/gostd/net/http/transport.go.html#4259922">sync</a></span><span class="op" id="4291699">.</span><span class="ident" id="4291700"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4291708">//&nbsp;guards&nbsp;following&nbsp;4&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291738">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4291751">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291764">//&nbsp;whether&nbsp;Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291798">rerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4291811">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4291824">//&nbsp;sticky&nbsp;Read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291846">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4291859">func</span><span class="op" id="4291863">(</span><span class="builtintype" id="4291864">error</span><span class="op" id="4291869">)</span>&nbsp;&nbsp;<span class="comment" id="4291872">//&nbsp;error&nbsp;will&nbsp;be&nbsp;nil&nbsp;on&nbsp;Read&nbsp;io.EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4291909">earlyCloseFn</span>&nbsp;<span class="keyword" id="4291922">func</span><span class="op" id="4291926">(</span><span class="op" id="4291927">)</span>&nbsp;<span class="builtintype" id="4291929">error</span>&nbsp;<span class="comment" id="4291935">//&nbsp;optional&nbsp;alt&nbsp;Close&nbsp;func&nbsp;used&nbsp;if&nbsp;io.EOF&nbsp;not&nbsp;seen</span><br>
<span class="lineno">1180</span><span class="op" id="4291986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4291989">func</span>&nbsp;<span class="op" id="4291994">(</span><span class="ident" id="4291995">es</span>&nbsp;<span class="op" id="4291998">*</span><span class="ident" id="4291999"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4292012">)</span>&nbsp;<span class="ident" id="4292014">Read</span><span class="op" id="4292018">(</span><span class="ident" id="4292019">p</span>&nbsp;<span class="op" id="4292021">[</span><span class="op" id="4292022">]</span><span class="builtintype" id="4292023">byte</span><span class="op" id="4292027">)</span>&nbsp;<span class="op" id="4292029">(</span><span class="ident" id="4292030">n</span>&nbsp;<span class="builtintype" id="4292032">int</span><span class="op" id="4292035">,</span>&nbsp;<span class="ident" id="4292037">err</span>&nbsp;<span class="builtintype" id="4292041">error</span><span class="op" id="4292046">)</span>&nbsp;<span class="op" id="4292048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292051"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292053">.</span><span class="ident" id="4292054"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292056">.</span><span class="ident" id="4292057"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4292061">(</span><span class="op" id="4292062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292065">closed</span><span class="op" id="4292071">,</span>&nbsp;<span class="ident" id="4292073">rerr</span>&nbsp;<span class="op" id="4292078">:=</span>&nbsp;<span class="ident" id="4292081"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292083">.</span><span class="ident" id="4292084"><a href="/gostd/net/http/transport.go.html#4291738">closed</a></span><span class="op" id="4292090">,</span>&nbsp;<span class="ident" id="4292092"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292094">.</span><span class="ident" id="4292095"><a href="/gostd/net/http/transport.go.html#4291798">rerr</a></span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292101"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292103">.</span><span class="ident" id="4292104"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292106">.</span><span class="ident" id="4292107"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4292113">(</span><span class="op" id="4292114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292117">if</span>&nbsp;<span class="ident" id="4292120"><a href="/gostd/net/http/transport.go.html#4292065">closed</a></span>&nbsp;<span class="op" id="4292127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292131">return</span>&nbsp;<span class="num" id="4292138">0</span><span class="op" id="4292139">,</span>&nbsp;<span class="ident" id="4292141"><a href="/gostd/net/http/transport.go.html#4259857">errors</a></span><span class="op" id="4292147">.</span><span class="ident" id="4292148"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4292151">(</span><span class="string" id="4292152">&#34;http:&nbsp;read&nbsp;on&nbsp;closed&nbsp;response&nbsp;body&#34;</span><span class="op" id="4292188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292191">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292194">if</span>&nbsp;<span class="ident" id="4292197"><a href="/gostd/net/http/transport.go.html#4292073">rerr</a></span>&nbsp;<span class="op" id="4292202">!=</span>&nbsp;<span class="builtintype" id="4292205">nil</span>&nbsp;<span class="op" id="4292209">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292213">return</span>&nbsp;<span class="num" id="4292220">0</span><span class="op" id="4292221">,</span>&nbsp;<span class="ident" id="4292223"><a href="/gostd/net/http/transport.go.html#4292073">rerr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292233"><a href="/gostd/net/http/transport.go.html#4292030">n</a></span><span class="op" id="4292234">,</span>&nbsp;<span class="ident" id="4292236"><a href="/gostd/net/http/transport.go.html#4292037">err</a></span>&nbsp;<span class="op" id="4292240">=</span>&nbsp;<span class="ident" id="4292242"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292244">.</span><span class="ident" id="4292245"><a href="/gostd/net/http/transport.go.html#4291654">body</a></span><span class="op" id="4292249">.</span><span class="ident" id="4292250"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="4292254">(</span><span class="ident" id="4292255"><a href="/gostd/net/http/transport.go.html#4292019">p</a></span><span class="op" id="4292256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292259">if</span>&nbsp;<span class="ident" id="4292262"><a href="/gostd/net/http/transport.go.html#4292037">err</a></span>&nbsp;<span class="op" id="4292266">!=</span>&nbsp;<span class="builtintype" id="4292269">nil</span>&nbsp;<span class="op" id="4292273">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292277"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292279">.</span><span class="ident" id="4292280"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292282">.</span><span class="ident" id="4292283"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4292287">(</span><span class="op" id="4292288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292292">defer</span>&nbsp;<span class="ident" id="4292298"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292300">.</span><span class="ident" id="4292301"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292303">.</span><span class="ident" id="4292304"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4292310">(</span><span class="op" id="4292311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292315">if</span>&nbsp;<span class="ident" id="4292318"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292320">.</span><span class="ident" id="4292321"><a href="/gostd/net/http/transport.go.html#4291798">rerr</a></span>&nbsp;<span class="op" id="4292326">==</span>&nbsp;<span class="builtintype" id="4292329">nil</span>&nbsp;<span class="op" id="4292333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292338"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292340">.</span><span class="ident" id="4292341"><a href="/gostd/net/http/transport.go.html#4291798">rerr</a></span>&nbsp;<span class="op" id="4292346">=</span>&nbsp;<span class="ident" id="4292348"><a href="/gostd/net/http/transport.go.html#4292037">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292354">}</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292358"><a href="/gostd/net/http/transport.go.html#4291995">es</a></span><span class="op" id="4292360">.</span><span class="ident" id="4292361"><a href="/gostd/net/http/transport.go.html#4292701">condfn</a></span><span class="op" id="4292367">(</span><span class="ident" id="4292368"><a href="/gostd/net/http/transport.go.html#4292037">err</a></span><span class="op" id="4292371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292374">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292377">return</span><br>
<span class="lineno"></span><span class="op" id="4292384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1205</span><span class="keyword" id="4292387">func</span>&nbsp;<span class="op" id="4292392">(</span><span class="ident" id="4292393">es</span>&nbsp;<span class="op" id="4292396">*</span><span class="ident" id="4292397"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4292410">)</span>&nbsp;<span class="ident" id="4292412">Close</span><span class="op" id="4292417">(</span><span class="op" id="4292418">)</span>&nbsp;<span class="builtintype" id="4292420">error</span>&nbsp;<span class="op" id="4292426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292429"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292431">.</span><span class="ident" id="4292432"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292434">.</span><span class="ident" id="4292435"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4292439">(</span><span class="op" id="4292440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292443">defer</span>&nbsp;<span class="ident" id="4292449"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292451">.</span><span class="ident" id="4292452"><a href="/gostd/net/http/transport.go.html#4291682">mu</a></span><span class="op" id="4292454">.</span><span class="ident" id="4292455"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4292461">(</span><span class="op" id="4292462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292465">if</span>&nbsp;<span class="ident" id="4292468"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292470">.</span><span class="ident" id="4292471"><a href="/gostd/net/http/transport.go.html#4291738">closed</a></span>&nbsp;<span class="op" id="4292478">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292482">return</span>&nbsp;<span class="builtintype" id="4292489">nil</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292497"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292499">.</span><span class="ident" id="4292500"><a href="/gostd/net/http/transport.go.html#4291738">closed</a></span>&nbsp;<span class="op" id="4292507">=</span>&nbsp;<span class="builtintype" id="4292509">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292515">if</span>&nbsp;<span class="ident" id="4292518"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292520">.</span><span class="ident" id="4292521"><a href="/gostd/net/http/transport.go.html#4291909">earlyCloseFn</a></span>&nbsp;<span class="op" id="4292534">!=</span>&nbsp;<span class="builtintype" id="4292537">nil</span>&nbsp;<span class="op" id="4292541">&amp;&amp;</span>&nbsp;<span class="ident" id="4292544"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292546">.</span><span class="ident" id="4292547"><a href="/gostd/net/http/transport.go.html#4291798">rerr</a></span>&nbsp;<span class="op" id="4292552">!=</span>&nbsp;<span class="ident" id="4292555"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4292557">.</span><span class="ident" id="4292558"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4292562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292566">return</span>&nbsp;<span class="ident" id="4292573"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292575">.</span><span class="ident" id="4292576"><a href="/gostd/net/http/transport.go.html#4291909">earlyCloseFn</a></span><span class="op" id="4292588">(</span><span class="op" id="4292589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292592">}</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292595">err</span>&nbsp;<span class="op" id="4292599">:=</span>&nbsp;<span class="ident" id="4292602"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292604">.</span><span class="ident" id="4292605"><a href="/gostd/net/http/transport.go.html#4291654">body</a></span><span class="op" id="4292609">.</span><span class="ident" id="4292610"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4292615">(</span><span class="op" id="4292616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292619"><a href="/gostd/net/http/transport.go.html#4292393">es</a></span><span class="op" id="4292621">.</span><span class="ident" id="4292622"><a href="/gostd/net/http/transport.go.html#4292701">condfn</a></span><span class="op" id="4292628">(</span><span class="ident" id="4292629"><a href="/gostd/net/http/transport.go.html#4292595">err</a></span><span class="op" id="4292632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292635">return</span>&nbsp;<span class="ident" id="4292642"><a href="/gostd/net/http/transport.go.html#4292595">err</a></span><br>
<span class="lineno"></span><span class="op" id="4292646">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span><span class="comment" id="4292649">//&nbsp;caller&nbsp;must&nbsp;hold&nbsp;es.mu.</span><br>
<span class="lineno"></span><span class="keyword" id="4292676">func</span>&nbsp;<span class="op" id="4292681">(</span><span class="ident" id="4292682">es</span>&nbsp;<span class="op" id="4292685">*</span><span class="ident" id="4292686"><a href="/gostd/net/http/transport.go.html#4291630">bodyEOFSignal</a></span><span class="op" id="4292699">)</span>&nbsp;<span class="ident" id="4292701">condfn</span><span class="op" id="4292707">(</span><span class="ident" id="4292708">err</span>&nbsp;<span class="builtintype" id="4292712">error</span><span class="op" id="4292717">)</span>&nbsp;<span class="op" id="4292719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292722">if</span>&nbsp;<span class="ident" id="4292725"><a href="/gostd/net/http/transport.go.html#4292682">es</a></span><span class="op" id="4292727">.</span><span class="ident" id="4292728"><a href="/gostd/net/http/transport.go.html#4291846">fn</a></span>&nbsp;<span class="op" id="4292731">==</span>&nbsp;<span class="builtintype" id="4292734">nil</span>&nbsp;<span class="op" id="4292738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292742">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292750">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4292753">if</span>&nbsp;<span class="ident" id="4292756"><a href="/gostd/net/http/transport.go.html#4292708">err</a></span>&nbsp;<span class="op" id="4292760">==</span>&nbsp;<span class="ident" id="4292763"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4292765">.</span><span class="ident" id="4292766"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4292770">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292774"><a href="/gostd/net/http/transport.go.html#4292708">err</a></span>&nbsp;<span class="op" id="4292778">=</span>&nbsp;<span class="builtintype" id="4292780">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4292785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292788"><a href="/gostd/net/http/transport.go.html#4292682">es</a></span><span class="op" id="4292790">.</span><span class="ident" id="4292791"><a href="/gostd/net/http/transport.go.html#4291846">fn</a></span><span class="op" id="4292793">(</span><span class="ident" id="4292794"><a href="/gostd/net/http/transport.go.html#4292708">err</a></span><span class="op" id="4292797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292800"><a href="/gostd/net/http/transport.go.html#4292682">es</a></span><span class="op" id="4292802">.</span><span class="ident" id="4292803"><a href="/gostd/net/http/transport.go.html#4291846">fn</a></span>&nbsp;<span class="op" id="4292806">=</span>&nbsp;<span class="builtintype" id="4292808">nil</span><br>
<span class="lineno">1230</span><span class="op" id="4292812">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4292815">//&nbsp;gzipReader&nbsp;wraps&nbsp;a&nbsp;response&nbsp;body&nbsp;so&nbsp;it&nbsp;can&nbsp;lazily</span><br>
<span class="lineno"></span><span class="comment" id="4292868">//&nbsp;call&nbsp;gzip.NewReader&nbsp;on&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Read</span><br>
<span class="lineno"></span><span class="keyword" id="4292917">type</span>&nbsp;<span class="ident" id="4292922">gzipReader</span>&nbsp;<span class="keyword" id="4292933">struct</span>&nbsp;<span class="op" id="4292940">{</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292943">body</span>&nbsp;<span class="ident" id="4292948"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4292950">.</span><span class="ident" id="4292951"><a href="/gostd/io/io.go.html#1423414">ReadCloser</a></span>&nbsp;<span class="comment" id="4292962">//&nbsp;underlying&nbsp;Response.Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4292991">zr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4292996"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4292998">.</span><span class="ident" id="4292999"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4293010">//&nbsp;lazily-initialized&nbsp;gzip&nbsp;reader</span><br>
<span class="lineno"></span><span class="op" id="4293044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293047">func</span>&nbsp;<span class="op" id="4293052">(</span><span class="ident" id="4293053">gz</span>&nbsp;<span class="op" id="4293056">*</span><span class="ident" id="4293057"><a href="/gostd/net/http/transport.go.html#4292922">gzipReader</a></span><span class="op" id="4293067">)</span>&nbsp;<span class="ident" id="4293069">Read</span><span class="op" id="4293073">(</span><span class="ident" id="4293074">p</span>&nbsp;<span class="op" id="4293076">[</span><span class="op" id="4293077">]</span><span class="builtintype" id="4293078">byte</span><span class="op" id="4293082">)</span>&nbsp;<span class="op" id="4293084">(</span><span class="ident" id="4293085">n</span>&nbsp;<span class="builtintype" id="4293087">int</span><span class="op" id="4293090">,</span>&nbsp;<span class="ident" id="4293092">err</span>&nbsp;<span class="builtintype" id="4293096">error</span><span class="op" id="4293101">)</span>&nbsp;<span class="op" id="4293103">{</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293106">if</span>&nbsp;<span class="ident" id="4293109"><a href="/gostd/net/http/transport.go.html#4293053">gz</a></span><span class="op" id="4293111">.</span><span class="ident" id="4293112"><a href="/gostd/net/http/transport.go.html#4292991">zr</a></span>&nbsp;<span class="op" id="4293115">==</span>&nbsp;<span class="builtintype" id="4293118">nil</span>&nbsp;<span class="op" id="4293122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293126"><a href="/gostd/net/http/transport.go.html#4293053">gz</a></span><span class="op" id="4293128">.</span><span class="ident" id="4293129"><a href="/gostd/net/http/transport.go.html#4292991">zr</a></span><span class="op" id="4293131">,</span>&nbsp;<span class="ident" id="4293133"><a href="/gostd/net/http/transport.go.html#4293092">err</a></span>&nbsp;<span class="op" id="4293137">=</span>&nbsp;<span class="ident" id="4293139"><a href="/gostd/net/http/transport.go.html#4259826">gzip</a></span><span class="op" id="4293143">.</span><span class="ident" id="4293144"><a href="/gostd/compress/gzip/gunzip.go.html#4779786">NewReader</a></span><span class="op" id="4293153">(</span><span class="ident" id="4293154"><a href="/gostd/net/http/transport.go.html#4293053">gz</a></span><span class="op" id="4293156">.</span><span class="ident" id="4293157"><a href="/gostd/net/http/transport.go.html#4292943">body</a></span><span class="op" id="4293161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293165">if</span>&nbsp;<span class="ident" id="4293168"><a href="/gostd/net/http/transport.go.html#4293092">err</a></span>&nbsp;<span class="op" id="4293172">!=</span>&nbsp;<span class="builtintype" id="4293175">nil</span>&nbsp;<span class="op" id="4293179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293184">return</span>&nbsp;<span class="num" id="4293191">0</span><span class="op" id="4293192">,</span>&nbsp;<span class="ident" id="4293194"><a href="/gostd/net/http/transport.go.html#4293092">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293200">}</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293206">return</span>&nbsp;<span class="ident" id="4293213"><a href="/gostd/net/http/transport.go.html#4293053">gz</a></span><span class="op" id="4293215">.</span><span class="ident" id="4293216"><a href="/gostd/net/http/transport.go.html#4292991">zr</a></span><span class="op" id="4293218">.</span><span class="ident" id="4293219"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="4293223">(</span><span class="ident" id="4293224"><a href="/gostd/net/http/transport.go.html#4293074">p</a></span><span class="op" id="4293225">)</span><br>
<span class="lineno"></span><span class="op" id="4293227">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293230">func</span>&nbsp;<span class="op" id="4293235">(</span><span class="ident" id="4293236">gz</span>&nbsp;<span class="op" id="4293239">*</span><span class="ident" id="4293240"><a href="/gostd/net/http/transport.go.html#4292922">gzipReader</a></span><span class="op" id="4293250">)</span>&nbsp;<span class="ident" id="4293252">Close</span><span class="op" id="4293257">(</span><span class="op" id="4293258">)</span>&nbsp;<span class="builtintype" id="4293260">error</span>&nbsp;<span class="op" id="4293266">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293269">return</span>&nbsp;<span class="ident" id="4293276"><a href="/gostd/net/http/transport.go.html#4293236">gz</a></span><span class="op" id="4293278">.</span><span class="ident" id="4293279"><a href="/gostd/net/http/transport.go.html#4292943">body</a></span><span class="op" id="4293283">.</span><span class="ident" id="4293284"><a href="/gostd/io/io.go.html#1422583">Close</a></span><span class="op" id="4293289">(</span><span class="op" id="4293290">)</span><br>
<span class="lineno"></span><span class="op" id="4293292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293295">type</span>&nbsp;<span class="ident" id="4293300">readerAndCloser</span>&nbsp;<span class="keyword" id="4293316">struct</span>&nbsp;<span class="op" id="4293323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293326"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4293328">.</span><span class="ident" id="4293329"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293337"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4293339">.</span><span class="ident" id="4293340"><a href="/gostd/io/io.go.html#1422563">Closer</a></span><br>
<span class="lineno"></span><span class="op" id="4293347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293350">type</span>&nbsp;<span class="ident" id="4293355">tlsHandshakeTimeoutError</span>&nbsp;<span class="keyword" id="4293380">struct</span><span class="op" id="4293386">{</span><span class="op" id="4293387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1260</span><span class="keyword" id="4293390">func</span>&nbsp;<span class="op" id="4293395">(</span><span class="ident" id="4293396"><a href="/gostd/net/http/transport.go.html#4293355">tlsHandshakeTimeoutError</a></span><span class="op" id="4293420">)</span>&nbsp;<span class="ident" id="4293422">Timeout</span><span class="op" id="4293429">(</span><span class="op" id="4293430">)</span>&nbsp;<span class="builtintype" id="4293432">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4293439">{</span>&nbsp;<span class="keyword" id="4293441">return</span>&nbsp;<span class="builtintype" id="4293448">true</span>&nbsp;<span class="op" id="4293453">}</span><br>
<span class="lineno"></span><span class="keyword" id="4293455">func</span>&nbsp;<span class="op" id="4293460">(</span><span class="ident" id="4293461"><a href="/gostd/net/http/transport.go.html#4293355">tlsHandshakeTimeoutError</a></span><span class="op" id="4293485">)</span>&nbsp;<span class="ident" id="4293487">Temporary</span><span class="op" id="4293496">(</span><span class="op" id="4293497">)</span>&nbsp;<span class="builtintype" id="4293499">bool</span>&nbsp;<span class="op" id="4293504">{</span>&nbsp;<span class="keyword" id="4293506">return</span>&nbsp;<span class="builtintype" id="4293513">true</span>&nbsp;<span class="op" id="4293518">}</span><br>
<span class="lineno"></span><span class="keyword" id="4293520">func</span>&nbsp;<span class="op" id="4293525">(</span><span class="ident" id="4293526"><a href="/gostd/net/http/transport.go.html#4293355">tlsHandshakeTimeoutError</a></span><span class="op" id="4293550">)</span>&nbsp;<span class="ident" id="4293552">Error</span><span class="op" id="4293557">(</span><span class="op" id="4293558">)</span>&nbsp;<span class="builtintype" id="4293560">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4293569">{</span>&nbsp;<span class="keyword" id="4293571">return</span>&nbsp;<span class="string" id="4293578">&#34;net/http:&nbsp;TLS&nbsp;handshake&nbsp;timeout&#34;</span>&nbsp;<span class="op" id="4293612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293615">type</span>&nbsp;<span class="ident" id="4293620">noteEOFReader</span>&nbsp;<span class="keyword" id="4293634">struct</span>&nbsp;<span class="op" id="4293641">{</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293644">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293651"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4293653">.</span><span class="ident" id="4293654"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293662">sawEOF</span>&nbsp;<span class="op" id="4293669">*</span><span class="builtintype" id="4293670">bool</span><br>
<span class="lineno"></span><span class="op" id="4293675">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4293678">func</span>&nbsp;<span class="op" id="4293683">(</span><span class="ident" id="4293684">nr</span>&nbsp;<span class="ident" id="4293687"><a href="/gostd/net/http/transport.go.html#4293620">noteEOFReader</a></span><span class="op" id="4293700">)</span>&nbsp;<span class="ident" id="4293702">Read</span><span class="op" id="4293706">(</span><span class="ident" id="4293707">p</span>&nbsp;<span class="op" id="4293709">[</span><span class="op" id="4293710">]</span><span class="builtintype" id="4293711">byte</span><span class="op" id="4293715">)</span>&nbsp;<span class="op" id="4293717">(</span><span class="ident" id="4293718">n</span>&nbsp;<span class="builtintype" id="4293720">int</span><span class="op" id="4293723">,</span>&nbsp;<span class="ident" id="4293725">err</span>&nbsp;<span class="builtintype" id="4293729">error</span><span class="op" id="4293734">)</span>&nbsp;<span class="op" id="4293736">{</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4293739"><a href="/gostd/net/http/transport.go.html#4293718">n</a></span><span class="op" id="4293740">,</span>&nbsp;<span class="ident" id="4293742"><a href="/gostd/net/http/transport.go.html#4293725">err</a></span>&nbsp;<span class="op" id="4293746">=</span>&nbsp;<span class="ident" id="4293748"><a href="/gostd/net/http/transport.go.html#4293684">nr</a></span><span class="op" id="4293750">.</span><span class="ident" id="4293751"><a href="/gostd/net/http/transport.go.html#4293644">r</a></span><span class="op" id="4293752">.</span><span class="ident" id="4293753"><a href="/gostd/io/io.go.html#1421843">Read</a></span><span class="op" id="4293757">(</span><span class="ident" id="4293758"><a href="/gostd/net/http/transport.go.html#4293707">p</a></span><span class="op" id="4293759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293762">if</span>&nbsp;<span class="ident" id="4293765"><a href="/gostd/net/http/transport.go.html#4293725">err</a></span>&nbsp;<span class="op" id="4293769">==</span>&nbsp;<span class="ident" id="4293772"><a href="/gostd/net/http/transport.go.html#4259874">io</a></span><span class="op" id="4293774">.</span><span class="ident" id="4293775"><a href="/gostd/io/io.go.html#1419950">EOF</a></span>&nbsp;<span class="op" id="4293779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293783">*</span><span class="ident" id="4293784"><a href="/gostd/net/http/transport.go.html#4293684">nr</a></span><span class="op" id="4293786">.</span><span class="ident" id="4293787"><a href="/gostd/net/http/transport.go.html#4293662">sawEOF</a></span>&nbsp;<span class="op" id="4293794">=</span>&nbsp;<span class="builtintype" id="4293796">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4293802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4293805">return</span><br>
<span class="lineno">1275</span><span class="op" id="4293812">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
