<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html" class="current">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4278625">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4278680">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4278734">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4278785">//&nbsp;The&nbsp;file&nbsp;define&nbsp;a&nbsp;quoted-printable&nbsp;decoder,&nbsp;as&nbsp;specified&nbsp;in&nbsp;RFC&nbsp;2045.</span><br>
<span class="lineno"></span><span class="comment" id="4278858">//&nbsp;Deviations:</span><br>
<span class="lineno"></span><span class="comment" id="4278873">//&nbsp;1.&nbsp;in&nbsp;addition&nbsp;to&nbsp;&#34;=\r\n&#34;,&nbsp;&#34;=\n&#34;&nbsp;is&nbsp;also&nbsp;treated&nbsp;as&nbsp;soft&nbsp;line&nbsp;break.</span><br>
<span class="lineno"></span><span class="comment" id="4278945">//&nbsp;2.&nbsp;it&nbsp;will&nbsp;pass&nbsp;through&nbsp;a&nbsp;&#39;\r&#39;&nbsp;or&nbsp;&#39;\n&#39;&nbsp;not&nbsp;preceded&nbsp;by&nbsp;&#39;=&#39;,&nbsp;consistent</span><br>
<span class="lineno"></span><span class="comment" id="4279019">//&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;other&nbsp;broken&nbsp;QP&nbsp;encoders&nbsp;&amp;&nbsp;decoders.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="4279068">package</span>&nbsp;<span class="ident" id="4279076">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279087">import</span>&nbsp;<span class="op" id="4279094">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279097">&#34;bufio&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279106">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279115">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4279122">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4279127">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4279130">type</span>&nbsp;<span class="ident" id="4279135">qpReader</span>&nbsp;<span class="keyword" id="4279144">struct</span>&nbsp;<span class="op" id="4279151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279154">br</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4279159">*</span><span class="ident" id="4279160">bufio</span><span class="op" id="4279165">.</span><span class="ident" id="4279166">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279174">rerr</span>&nbsp;<span class="builtintype" id="4279179">error</span>&nbsp;&nbsp;<span class="comment" id="4279186">//&nbsp;last&nbsp;read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279206">line</span>&nbsp;<span class="op" id="4279211">[</span><span class="op" id="4279212">]</span><span class="builtintype" id="4279213">byte</span>&nbsp;<span class="comment" id="4279218">//&nbsp;to&nbsp;be&nbsp;consumed&nbsp;before&nbsp;more&nbsp;of&nbsp;br</span><br>
<span class="lineno"></span><span class="op" id="4279254">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4279257">func</span>&nbsp;<span class="ident" id="4279262">newQuotedPrintableReader</span><span class="op" id="4279286">(</span><span class="ident" id="4279287">r</span>&nbsp;<span class="ident" id="4279289">io</span><span class="op" id="4279291">.</span><span class="ident" id="4279292">Reader</span><span class="op" id="4279298">)</span>&nbsp;<span class="ident" id="4279300">io</span><span class="op" id="4279302">.</span><span class="ident" id="4279303">Reader</span>&nbsp;<span class="op" id="4279310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279313">return</span>&nbsp;<span class="op" id="4279320">&amp;</span><span class="ident" id="4279321">qpReader</span><span class="op" id="4279329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4279333">br</span><span class="op" id="4279335">:</span>&nbsp;<span class="ident" id="4279337">bufio</span><span class="op" id="4279342">.</span><span class="ident" id="4279343">NewReader</span><span class="op" id="4279352">(</span><span class="ident" id="4279353">r</span><span class="op" id="4279354">)</span><span class="op" id="4279355">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279358">}</span><br>
<span class="lineno">30</span><span class="op" id="4279360">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279363">func</span>&nbsp;<span class="ident" id="4279368">fromHex</span><span class="op" id="4279375">(</span><span class="ident" id="4279376">b</span>&nbsp;<span class="builtintype" id="4279378">byte</span><span class="op" id="4279382">)</span>&nbsp;<span class="op" id="4279384">(</span><span class="builtintype" id="4279385">byte</span><span class="op" id="4279389">,</span>&nbsp;<span class="builtintype" id="4279391">error</span><span class="op" id="4279396">)</span>&nbsp;<span class="op" id="4279398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279401">switch</span>&nbsp;<span class="op" id="4279408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279411">case</span>&nbsp;<span class="ident" id="4279416">b</span>&nbsp;<span class="op" id="4279418">&gt;=</span>&nbsp;<span class="string" id="4279421">&#39;0&#39;</span>&nbsp;<span class="op" id="4279425">&amp;&amp;</span>&nbsp;<span class="ident" id="4279428">b</span>&nbsp;<span class="op" id="4279430">&lt;=</span>&nbsp;<span class="string" id="4279433">&#39;9&#39;</span><span class="op" id="4279436">:</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279440">return</span>&nbsp;<span class="ident" id="4279447">b</span>&nbsp;<span class="op" id="4279449">-</span>&nbsp;<span class="string" id="4279451">&#39;0&#39;</span><span class="op" id="4279454">,</span>&nbsp;<span class="builtintype" id="4279456">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279461">case</span>&nbsp;<span class="ident" id="4279466">b</span>&nbsp;<span class="op" id="4279468">&gt;=</span>&nbsp;<span class="string" id="4279471">&#39;A&#39;</span>&nbsp;<span class="op" id="4279475">&amp;&amp;</span>&nbsp;<span class="ident" id="4279478">b</span>&nbsp;<span class="op" id="4279480">&lt;=</span>&nbsp;<span class="string" id="4279483">&#39;F&#39;</span><span class="op" id="4279486">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279490">return</span>&nbsp;<span class="ident" id="4279497">b</span>&nbsp;<span class="op" id="4279499">-</span>&nbsp;<span class="string" id="4279501">&#39;A&#39;</span>&nbsp;<span class="op" id="4279505">+</span>&nbsp;<span class="num" id="4279507">10</span><span class="op" id="4279509">,</span>&nbsp;<span class="builtintype" id="4279511">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279519">return</span>&nbsp;<span class="num" id="4279526">0</span><span class="op" id="4279527">,</span>&nbsp;<span class="ident" id="4279529">fmt</span><span class="op" id="4279532">.</span><span class="ident" id="4279533">Errorf</span><span class="op" id="4279539">(</span><span class="string" id="4279540">&#34;multipart:&nbsp;invalid&nbsp;quoted-printable&nbsp;hex&nbsp;byte&nbsp;0x%02x&#34;</span><span class="op" id="4279593">,</span>&nbsp;<span class="ident" id="4279595">b</span><span class="op" id="4279596">)</span><br>
<span class="lineno">40</span><span class="op" id="4279598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279601">func</span>&nbsp;<span class="op" id="4279606">(</span><span class="ident" id="4279607">q</span>&nbsp;<span class="op" id="4279609">*</span><span class="ident" id="4279610">qpReader</span><span class="op" id="4279618">)</span>&nbsp;<span class="ident" id="4279620">readHexByte</span><span class="op" id="4279631">(</span><span class="ident" id="4279632">v</span>&nbsp;<span class="op" id="4279634">[</span><span class="op" id="4279635">]</span><span class="builtintype" id="4279636">byte</span><span class="op" id="4279640">)</span>&nbsp;<span class="op" id="4279642">(</span><span class="ident" id="4279643">b</span>&nbsp;<span class="builtintype" id="4279645">byte</span><span class="op" id="4279649">,</span>&nbsp;<span class="ident" id="4279651">err</span>&nbsp;<span class="builtintype" id="4279655">error</span><span class="op" id="4279660">)</span>&nbsp;<span class="op" id="4279662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279665">if</span>&nbsp;<span class="builtinfunc" id="4279668">len</span><span class="op" id="4279671">(</span><span class="ident" id="4279672">v</span><span class="op" id="4279673">)</span>&nbsp;<span class="op" id="4279675">&lt;</span>&nbsp;<span class="num" id="4279677">2</span>&nbsp;<span class="op" id="4279679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279683">return</span>&nbsp;<span class="num" id="4279690">0</span><span class="op" id="4279691">,</span>&nbsp;<span class="ident" id="4279693">io</span><span class="op" id="4279695">.</span><span class="ident" id="4279696">ErrUnexpectedEOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279714">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279717">var</span>&nbsp;<span class="ident" id="4279721">hb</span><span class="op" id="4279723">,</span>&nbsp;<span class="ident" id="4279725">lb</span>&nbsp;<span class="builtintype" id="4279728">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279734">if</span>&nbsp;<span class="ident" id="4279737">hb</span><span class="op" id="4279739">,</span>&nbsp;<span class="ident" id="4279741">err</span>&nbsp;<span class="op" id="4279745">=</span>&nbsp;<span class="ident" id="4279747">fromHex</span><span class="op" id="4279754">(</span><span class="ident" id="4279755">v</span><span class="op" id="4279756">[</span><span class="num" id="4279757">0</span><span class="op" id="4279758">]</span><span class="op" id="4279759">)</span><span class="op" id="4279760">;</span>&nbsp;<span class="ident" id="4279762">err</span>&nbsp;<span class="op" id="4279766">!=</span>&nbsp;<span class="builtintype" id="4279769">nil</span>&nbsp;<span class="op" id="4279773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279777">return</span>&nbsp;<span class="num" id="4279784">0</span><span class="op" id="4279785">,</span>&nbsp;<span class="ident" id="4279787">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279792">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279795">if</span>&nbsp;<span class="ident" id="4279798">lb</span><span class="op" id="4279800">,</span>&nbsp;<span class="ident" id="4279802">err</span>&nbsp;<span class="op" id="4279806">=</span>&nbsp;<span class="ident" id="4279808">fromHex</span><span class="op" id="4279815">(</span><span class="ident" id="4279816">v</span><span class="op" id="4279817">[</span><span class="num" id="4279818">1</span><span class="op" id="4279819">]</span><span class="op" id="4279820">)</span><span class="op" id="4279821">;</span>&nbsp;<span class="ident" id="4279823">err</span>&nbsp;<span class="op" id="4279827">!=</span>&nbsp;<span class="builtintype" id="4279830">nil</span>&nbsp;<span class="op" id="4279834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279838">return</span>&nbsp;<span class="num" id="4279845">0</span><span class="op" id="4279846">,</span>&nbsp;<span class="ident" id="4279848">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279853">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279856">return</span>&nbsp;<span class="ident" id="4279863">hb</span><span class="op" id="4279865">&lt;&lt;</span><span class="num" id="4279867">4</span>&nbsp;<span class="op" id="4279869">|</span>&nbsp;<span class="ident" id="4279871">lb</span><span class="op" id="4279873">,</span>&nbsp;<span class="builtintype" id="4279875">nil</span><br>
<span class="lineno"></span><span class="op" id="4279879">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="4279882">func</span>&nbsp;<span class="ident" id="4279887">isQPDiscardWhitespace</span><span class="op" id="4279908">(</span><span class="ident" id="4279909">r</span>&nbsp;<span class="builtintype" id="4279911">rune</span><span class="op" id="4279915">)</span>&nbsp;<span class="builtintype" id="4279917">bool</span>&nbsp;<span class="op" id="4279922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279925">switch</span>&nbsp;<span class="ident" id="4279932">r</span>&nbsp;<span class="op" id="4279934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279937">case</span>&nbsp;<span class="string" id="4279942">&#39;\n&#39;</span><span class="op" id="4279946">,</span>&nbsp;<span class="string" id="4279948">&#39;\r&#39;</span><span class="op" id="4279952">,</span>&nbsp;<span class="string" id="4279954">&#39;&nbsp;&#39;</span><span class="op" id="4279957">,</span>&nbsp;<span class="string" id="4279959">&#39;\t&#39;</span><span class="op" id="4279963">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279967">return</span>&nbsp;<span class="builtintype" id="4279974">true</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4279980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4279983">return</span>&nbsp;<span class="builtintype" id="4279990">false</span><br>
<span class="lineno"></span><span class="op" id="4279996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4279999">var</span>&nbsp;<span class="op" id="4280003">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280006">crlf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280017">=</span>&nbsp;<span class="op" id="4280019">[</span><span class="op" id="4280020">]</span><span class="builtintype" id="4280021">byte</span><span class="op" id="4280025">(</span><span class="string" id="4280026">&#34;\r\n&#34;</span><span class="op" id="4280032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280035">lf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280046">=</span>&nbsp;<span class="op" id="4280048">[</span><span class="op" id="4280049">]</span><span class="builtintype" id="4280050">byte</span><span class="op" id="4280054">(</span><span class="string" id="4280055">&#34;\n&#34;</span><span class="op" id="4280059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280062">softSuffix</span>&nbsp;<span class="op" id="4280073">=</span>&nbsp;<span class="op" id="4280075">[</span><span class="op" id="4280076">]</span><span class="builtintype" id="4280077">byte</span><span class="op" id="4280081">(</span><span class="string" id="4280082">&#34;=&#34;</span><span class="op" id="4280085">)</span><br>
<span class="lineno"></span><span class="op" id="4280087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="4280090">func</span>&nbsp;<span class="op" id="4280095">(</span><span class="ident" id="4280096">q</span>&nbsp;<span class="op" id="4280098">*</span><span class="ident" id="4280099">qpReader</span><span class="op" id="4280107">)</span>&nbsp;<span class="ident" id="4280109">Read</span><span class="op" id="4280113">(</span><span class="ident" id="4280114">p</span>&nbsp;<span class="op" id="4280116">[</span><span class="op" id="4280117">]</span><span class="builtintype" id="4280118">byte</span><span class="op" id="4280122">)</span>&nbsp;<span class="op" id="4280124">(</span><span class="ident" id="4280125">n</span>&nbsp;<span class="builtintype" id="4280127">int</span><span class="op" id="4280130">,</span>&nbsp;<span class="ident" id="4280132">err</span>&nbsp;<span class="builtintype" id="4280136">error</span><span class="op" id="4280141">)</span>&nbsp;<span class="op" id="4280143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280146">for</span>&nbsp;<span class="builtinfunc" id="4280150">len</span><span class="op" id="4280153">(</span><span class="ident" id="4280154">p</span><span class="op" id="4280155">)</span>&nbsp;<span class="op" id="4280157">&gt;</span>&nbsp;<span class="num" id="4280159">0</span>&nbsp;<span class="op" id="4280161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280165">if</span>&nbsp;<span class="builtinfunc" id="4280168">len</span><span class="op" id="4280171">(</span><span class="ident" id="4280172">q</span><span class="op" id="4280173">.</span><span class="ident" id="4280174">line</span><span class="op" id="4280178">)</span>&nbsp;<span class="op" id="4280180">==</span>&nbsp;<span class="num" id="4280183">0</span>&nbsp;<span class="op" id="4280185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280190">if</span>&nbsp;<span class="ident" id="4280193">q</span><span class="op" id="4280194">.</span><span class="ident" id="4280195">rerr</span>&nbsp;<span class="op" id="4280200">!=</span>&nbsp;<span class="builtintype" id="4280203">nil</span>&nbsp;<span class="op" id="4280207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280213">return</span>&nbsp;<span class="ident" id="4280220">n</span><span class="op" id="4280221">,</span>&nbsp;<span class="ident" id="4280223">q</span><span class="op" id="4280224">.</span><span class="ident" id="4280225">rerr</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280238">q</span><span class="op" id="4280239">.</span><span class="ident" id="4280240">line</span><span class="op" id="4280244">,</span>&nbsp;<span class="ident" id="4280246">q</span><span class="op" id="4280247">.</span><span class="ident" id="4280248">rerr</span>&nbsp;<span class="op" id="4280253">=</span>&nbsp;<span class="ident" id="4280255">q</span><span class="op" id="4280256">.</span><span class="ident" id="4280257">br</span><span class="op" id="4280259">.</span><span class="ident" id="4280260">ReadSlice</span><span class="op" id="4280269">(</span><span class="string" id="4280270">&#39;\n&#39;</span><span class="op" id="4280274">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4280280">//&nbsp;Does&nbsp;the&nbsp;line&nbsp;end&nbsp;in&nbsp;CRLF&nbsp;instead&nbsp;of&nbsp;just&nbsp;LF?</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280332">hasLF</span>&nbsp;<span class="op" id="4280338">:=</span>&nbsp;<span class="ident" id="4280341">bytes</span><span class="op" id="4280346">.</span><span class="ident" id="4280347">HasSuffix</span><span class="op" id="4280356">(</span><span class="ident" id="4280357">q</span><span class="op" id="4280358">.</span><span class="ident" id="4280359">line</span><span class="op" id="4280363">,</span>&nbsp;<span class="ident" id="4280365">lf</span><span class="op" id="4280367">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280372">hasCR</span>&nbsp;<span class="op" id="4280378">:=</span>&nbsp;<span class="ident" id="4280381">bytes</span><span class="op" id="4280386">.</span><span class="ident" id="4280387">HasSuffix</span><span class="op" id="4280396">(</span><span class="ident" id="4280397">q</span><span class="op" id="4280398">.</span><span class="ident" id="4280399">line</span><span class="op" id="4280403">,</span>&nbsp;<span class="ident" id="4280405">crlf</span><span class="op" id="4280409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280414">wholeLine</span>&nbsp;<span class="op" id="4280424">:=</span>&nbsp;<span class="ident" id="4280427">q</span><span class="op" id="4280428">.</span><span class="ident" id="4280429">line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280437">q</span><span class="op" id="4280438">.</span><span class="ident" id="4280439">line</span>&nbsp;<span class="op" id="4280444">=</span>&nbsp;<span class="ident" id="4280446">bytes</span><span class="op" id="4280451">.</span><span class="ident" id="4280452">TrimRightFunc</span><span class="op" id="4280465">(</span><span class="ident" id="4280466">wholeLine</span><span class="op" id="4280475">,</span>&nbsp;<span class="ident" id="4280477">isQPDiscardWhitespace</span><span class="op" id="4280498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280503">if</span>&nbsp;<span class="ident" id="4280506">bytes</span><span class="op" id="4280511">.</span><span class="ident" id="4280512">HasSuffix</span><span class="op" id="4280521">(</span><span class="ident" id="4280522">q</span><span class="op" id="4280523">.</span><span class="ident" id="4280524">line</span><span class="op" id="4280528">,</span>&nbsp;<span class="ident" id="4280530">softSuffix</span><span class="op" id="4280540">)</span>&nbsp;<span class="op" id="4280542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280548">rightStripped</span>&nbsp;<span class="op" id="4280562">:=</span>&nbsp;<span class="ident" id="4280565">wholeLine</span><span class="op" id="4280574">[</span><span class="builtinfunc" id="4280575">len</span><span class="op" id="4280578">(</span><span class="ident" id="4280579">q</span><span class="op" id="4280580">.</span><span class="ident" id="4280581">line</span><span class="op" id="4280585">)</span><span class="op" id="4280586">:</span><span class="op" id="4280587">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280593">q</span><span class="op" id="4280594">.</span><span class="ident" id="4280595">line</span>&nbsp;<span class="op" id="4280600">=</span>&nbsp;<span class="ident" id="4280602">q</span><span class="op" id="4280603">.</span><span class="ident" id="4280604">line</span><span class="op" id="4280608">[</span><span class="op" id="4280609">:</span><span class="builtinfunc" id="4280610">len</span><span class="op" id="4280613">(</span><span class="ident" id="4280614">q</span><span class="op" id="4280615">.</span><span class="ident" id="4280616">line</span><span class="op" id="4280620">)</span><span class="op" id="4280621">-</span><span class="num" id="4280622">1</span><span class="op" id="4280623">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280629">if</span>&nbsp;<span class="op" id="4280632">!</span><span class="ident" id="4280633">bytes</span><span class="op" id="4280638">.</span><span class="ident" id="4280639">HasPrefix</span><span class="op" id="4280648">(</span><span class="ident" id="4280649">rightStripped</span><span class="op" id="4280662">,</span>&nbsp;<span class="ident" id="4280664">lf</span><span class="op" id="4280666">)</span>&nbsp;<span class="op" id="4280668">&amp;&amp;</span>&nbsp;<span class="op" id="4280671">!</span><span class="ident" id="4280672">bytes</span><span class="op" id="4280677">.</span><span class="ident" id="4280678">HasPrefix</span><span class="op" id="4280687">(</span><span class="ident" id="4280688">rightStripped</span><span class="op" id="4280701">,</span>&nbsp;<span class="ident" id="4280703">crlf</span><span class="op" id="4280707">)</span>&nbsp;<span class="op" id="4280709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280716">q</span><span class="op" id="4280717">.</span><span class="ident" id="4280718">rerr</span>&nbsp;<span class="op" id="4280723">=</span>&nbsp;<span class="ident" id="4280725">fmt</span><span class="op" id="4280728">.</span><span class="ident" id="4280729">Errorf</span><span class="op" id="4280735">(</span><span class="string" id="4280736">&#34;multipart:&nbsp;invalid&nbsp;bytes&nbsp;after&nbsp;=:&nbsp;%q&#34;</span><span class="op" id="4280774">,</span>&nbsp;<span class="ident" id="4280776">rightStripped</span><span class="op" id="4280789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280795">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280800">}</span>&nbsp;<span class="keyword" id="4280802">else</span>&nbsp;<span class="keyword" id="4280807">if</span>&nbsp;<span class="ident" id="4280810">hasLF</span>&nbsp;<span class="op" id="4280816">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280822">if</span>&nbsp;<span class="ident" id="4280825">hasCR</span>&nbsp;<span class="op" id="4280831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280838">q</span><span class="op" id="4280839">.</span><span class="ident" id="4280840">line</span>&nbsp;<span class="op" id="4280845">=</span>&nbsp;<span class="builtinfunc" id="4280847">append</span><span class="op" id="4280853">(</span><span class="ident" id="4280854">q</span><span class="op" id="4280855">.</span><span class="ident" id="4280856">line</span><span class="op" id="4280860">,</span>&nbsp;<span class="string" id="4280862">&#39;\r&#39;</span><span class="op" id="4280866">,</span>&nbsp;<span class="string" id="4280868">&#39;\n&#39;</span><span class="op" id="4280872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280878">}</span>&nbsp;<span class="keyword" id="4280880">else</span>&nbsp;<span class="op" id="4280885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280892">q</span><span class="op" id="4280893">.</span><span class="ident" id="4280894">line</span>&nbsp;<span class="op" id="4280899">=</span>&nbsp;<span class="builtinfunc" id="4280901">append</span><span class="op" id="4280907">(</span><span class="ident" id="4280908">q</span><span class="op" id="4280909">.</span><span class="ident" id="4280910">line</span><span class="op" id="4280914">,</span>&nbsp;<span class="string" id="4280916">&#39;\n&#39;</span><span class="op" id="4280920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280926">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280936">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4280947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280951">b</span>&nbsp;<span class="op" id="4280953">:=</span>&nbsp;<span class="ident" id="4280956">q</span><span class="op" id="4280957">.</span><span class="ident" id="4280958">line</span><span class="op" id="4280962">[</span><span class="num" id="4280963">0</span><span class="op" id="4280964">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280969">switch</span>&nbsp;<span class="op" id="4280976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4280980">case</span>&nbsp;<span class="ident" id="4280985">b</span>&nbsp;<span class="op" id="4280987">==</span>&nbsp;<span class="string" id="4280990">&#39;=&#39;</span><span class="op" id="4280993">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4280998">b</span><span class="op" id="4280999">,</span>&nbsp;<span class="ident" id="4281001">err</span>&nbsp;<span class="op" id="4281005">=</span>&nbsp;<span class="ident" id="4281007">q</span><span class="op" id="4281008">.</span><span class="ident" id="4281009">readHexByte</span><span class="op" id="4281020">(</span><span class="ident" id="4281021">q</span><span class="op" id="4281022">.</span><span class="ident" id="4281023">line</span><span class="op" id="4281027">[</span><span class="num" id="4281028">1</span><span class="op" id="4281029">:</span><span class="op" id="4281030">]</span><span class="op" id="4281031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281036">if</span>&nbsp;<span class="ident" id="4281039">err</span>&nbsp;<span class="op" id="4281043">!=</span>&nbsp;<span class="builtintype" id="4281046">nil</span>&nbsp;<span class="op" id="4281050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281056">return</span>&nbsp;<span class="ident" id="4281063">n</span><span class="op" id="4281064">,</span>&nbsp;<span class="ident" id="4281066">err</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281078">q</span><span class="op" id="4281079">.</span><span class="ident" id="4281080">line</span>&nbsp;<span class="op" id="4281085">=</span>&nbsp;<span class="ident" id="4281087">q</span><span class="op" id="4281088">.</span><span class="ident" id="4281089">line</span><span class="op" id="4281093">[</span><span class="num" id="4281094">2</span><span class="op" id="4281095">:</span><span class="op" id="4281096">]</span>&nbsp;<span class="comment" id="4281098">//&nbsp;2&nbsp;of&nbsp;the&nbsp;3;&nbsp;other&nbsp;1&nbsp;is&nbsp;done&nbsp;below</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281137">case</span>&nbsp;<span class="ident" id="4281142">b</span>&nbsp;<span class="op" id="4281144">==</span>&nbsp;<span class="string" id="4281147">&#39;\t&#39;</span>&nbsp;<span class="op" id="4281152">||</span>&nbsp;<span class="ident" id="4281155">b</span>&nbsp;<span class="op" id="4281157">==</span>&nbsp;<span class="string" id="4281160">&#39;\r&#39;</span>&nbsp;<span class="op" id="4281165">||</span>&nbsp;<span class="ident" id="4281168">b</span>&nbsp;<span class="op" id="4281170">==</span>&nbsp;<span class="string" id="4281173">&#39;\n&#39;</span><span class="op" id="4281177">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281182">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281190">case</span>&nbsp;<span class="ident" id="4281195">b</span>&nbsp;<span class="op" id="4281197">&lt;</span>&nbsp;<span class="string" id="4281199">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="4281203">||</span>&nbsp;<span class="ident" id="4281206">b</span>&nbsp;<span class="op" id="4281208">&gt;</span>&nbsp;<span class="string" id="4281210">&#39;~&#39;</span><span class="op" id="4281213">:</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281218">return</span>&nbsp;<span class="ident" id="4281225">n</span><span class="op" id="4281226">,</span>&nbsp;<span class="ident" id="4281228">fmt</span><span class="op" id="4281231">.</span><span class="ident" id="4281232">Errorf</span><span class="op" id="4281238">(</span><span class="string" id="4281239">&#34;multipart:&nbsp;invalid&nbsp;unescaped&nbsp;byte&nbsp;0x%02x&nbsp;in&nbsp;quoted-printable&nbsp;body&#34;</span><span class="op" id="4281306">,</span>&nbsp;<span class="ident" id="4281308">b</span><span class="op" id="4281309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281317">p</span><span class="op" id="4281318">[</span><span class="num" id="4281319">0</span><span class="op" id="4281320">]</span>&nbsp;<span class="op" id="4281322">=</span>&nbsp;<span class="ident" id="4281324">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281328">p</span>&nbsp;<span class="op" id="4281330">=</span>&nbsp;<span class="ident" id="4281332">p</span><span class="op" id="4281333">[</span><span class="num" id="4281334">1</span><span class="op" id="4281335">:</span><span class="op" id="4281336">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281340">q</span><span class="op" id="4281341">.</span><span class="ident" id="4281342">line</span>&nbsp;<span class="op" id="4281347">=</span>&nbsp;<span class="ident" id="4281349">q</span><span class="op" id="4281350">.</span><span class="ident" id="4281351">line</span><span class="op" id="4281355">[</span><span class="num" id="4281356">1</span><span class="op" id="4281357">:</span><span class="op" id="4281358">]</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4281362">n</span><span class="op" id="4281363">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4281367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4281370">return</span>&nbsp;<span class="ident" id="4281377">n</span><span class="op" id="4281378">,</span>&nbsp;<span class="builtintype" id="4281380">nil</span><br>
<span class="lineno"></span><span class="op" id="4281384">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
