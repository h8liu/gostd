<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/token</h2>
<ul>
<li><a href="/gostd/go/token/position.go.html">position.go</a></li>
<li><a href="/gostd/go/token/position_test.go.html">position_test.go</a></li>
<li><a href="/gostd/go/token/serialize.go.html" class="current">serialize.go</a></li>
<li><a href="/gostd/go/token/serialize_test.go.html">serialize_test.go</a></li>
<li><a href="/gostd/go/token/token.go.html">token.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4749287">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4749342">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4749396">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4749447">package</span>&nbsp;<span class="ident" id="4749455">token</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4749462">type</span>&nbsp;<span class="ident" id="4749467">serializedFile</span>&nbsp;<span class="keyword" id="4749482">struct</span>&nbsp;<span class="op" id="4749489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4749492">//&nbsp;fields&nbsp;correspond&nbsp;1:1&nbsp;to&nbsp;fields&nbsp;with&nbsp;same&nbsp;(lower-case)&nbsp;name&nbsp;in&nbsp;File</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749564">Name</span>&nbsp;&nbsp;<span class="builtintype" id="4749570">string</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749578">Base</span>&nbsp;&nbsp;<span class="builtintype" id="4749584">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749589">Size</span>&nbsp;&nbsp;<span class="builtintype" id="4749595">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749600">Lines</span>&nbsp;<span class="op" id="4749606">[</span><span class="op" id="4749607">]</span><span class="builtintype" id="4749608">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749613">Infos</span>&nbsp;<span class="op" id="4749619">[</span><span class="op" id="4749620">]</span><span class="ident" id="4749621">lineInfo</span><br>
<span class="lineno"></span><span class="op" id="4749630">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="4749633">type</span>&nbsp;<span class="ident" id="4749638">serializedFileSet</span>&nbsp;<span class="keyword" id="4749656">struct</span>&nbsp;<span class="op" id="4749663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749666">Base</span>&nbsp;&nbsp;<span class="builtintype" id="4749672">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749677">Files</span>&nbsp;<span class="op" id="4749683">[</span><span class="op" id="4749684">]</span><span class="ident" id="4749685">serializedFile</span><br>
<span class="lineno"></span><span class="op" id="4749700">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="4749703">//&nbsp;Read&nbsp;calls&nbsp;decode&nbsp;to&nbsp;deserialize&nbsp;a&nbsp;file&nbsp;set&nbsp;into&nbsp;s;&nbsp;s&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="4749777">func</span>&nbsp;<span class="op" id="4749782">(</span><span class="ident" id="4749783">s</span>&nbsp;<span class="op" id="4749785">*</span><span class="ident" id="4749786">FileSet</span><span class="op" id="4749793">)</span>&nbsp;<span class="ident" id="4749795">Read</span><span class="op" id="4749799">(</span><span class="ident" id="4749800">decode</span>&nbsp;<span class="keyword" id="4749807">func</span><span class="op" id="4749811">(</span><span class="keyword" id="4749812">interface</span><span class="op" id="4749821">{</span><span class="op" id="4749822">}</span><span class="op" id="4749823">)</span>&nbsp;<span class="builtintype" id="4749825">error</span><span class="op" id="4749830">)</span>&nbsp;<span class="builtintype" id="4749832">error</span>&nbsp;<span class="op" id="4749838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749841">var</span>&nbsp;<span class="ident" id="4749845">ss</span>&nbsp;<span class="ident" id="4749848">serializedFileSet</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749867">if</span>&nbsp;<span class="ident" id="4749870">err</span>&nbsp;<span class="op" id="4749874">:=</span>&nbsp;<span class="ident" id="4749877">decode</span><span class="op" id="4749883">(</span><span class="op" id="4749884">&amp;</span><span class="ident" id="4749885">ss</span><span class="op" id="4749887">)</span><span class="op" id="4749888">;</span>&nbsp;<span class="ident" id="4749890">err</span>&nbsp;<span class="op" id="4749894">!=</span>&nbsp;<span class="ident" id="4749897">nil</span>&nbsp;<span class="op" id="4749901">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749905">return</span>&nbsp;<span class="ident" id="4749912">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4749917">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749921">s</span><span class="op" id="4749922">.</span><span class="ident" id="4749923">mutex</span><span class="op" id="4749928">.</span><span class="ident" id="4749929">Lock</span><span class="op" id="4749933">(</span><span class="op" id="4749934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749937">s</span><span class="op" id="4749938">.</span><span class="ident" id="4749939">base</span>&nbsp;<span class="op" id="4749944">=</span>&nbsp;<span class="ident" id="4749946">ss</span><span class="op" id="4749948">.</span><span class="ident" id="4749949">Base</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4749955">files</span>&nbsp;<span class="op" id="4749961">:=</span>&nbsp;<span class="builtinfunc" id="4749964">make</span><span class="op" id="4749968">(</span><span class="op" id="4749969">[</span><span class="op" id="4749970">]</span><span class="op" id="4749971">*</span><span class="ident" id="4749972">File</span><span class="op" id="4749976">,</span>&nbsp;<span class="builtinfunc" id="4749978">len</span><span class="op" id="4749981">(</span><span class="ident" id="4749982">ss</span><span class="op" id="4749984">.</span><span class="ident" id="4749985">Files</span><span class="op" id="4749990">)</span><span class="op" id="4749991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4749994">for</span>&nbsp;<span class="ident" id="4749998">i</span>&nbsp;<span class="op" id="4750000">:=</span>&nbsp;<span class="num" id="4750003">0</span><span class="op" id="4750004">;</span>&nbsp;<span class="ident" id="4750006">i</span>&nbsp;<span class="op" id="4750008">&lt;</span>&nbsp;<span class="builtinfunc" id="4750010">len</span><span class="op" id="4750013">(</span><span class="ident" id="4750014">ss</span><span class="op" id="4750016">.</span><span class="ident" id="4750017">Files</span><span class="op" id="4750022">)</span><span class="op" id="4750023">;</span>&nbsp;<span class="ident" id="4750025">i</span><span class="op" id="4750026">++</span>&nbsp;<span class="op" id="4750029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750033">f</span>&nbsp;<span class="op" id="4750035">:=</span>&nbsp;<span class="op" id="4750038">&amp;</span><span class="ident" id="4750039">ss</span><span class="op" id="4750041">.</span><span class="ident" id="4750042">Files</span><span class="op" id="4750047">[</span><span class="ident" id="4750048">i</span><span class="op" id="4750049">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750053">files</span><span class="op" id="4750058">[</span><span class="ident" id="4750059">i</span><span class="op" id="4750060">]</span>&nbsp;<span class="op" id="4750062">=</span>&nbsp;<span class="op" id="4750064">&amp;</span><span class="ident" id="4750065">File</span><span class="op" id="4750069">{</span><span class="ident" id="4750070">s</span><span class="op" id="4750071">,</span>&nbsp;<span class="ident" id="4750073">f</span><span class="op" id="4750074">.</span><span class="ident" id="4750075">Name</span><span class="op" id="4750079">,</span>&nbsp;<span class="ident" id="4750081">f</span><span class="op" id="4750082">.</span><span class="ident" id="4750083">Base</span><span class="op" id="4750087">,</span>&nbsp;<span class="ident" id="4750089">f</span><span class="op" id="4750090">.</span><span class="ident" id="4750091">Size</span><span class="op" id="4750095">,</span>&nbsp;<span class="ident" id="4750097">f</span><span class="op" id="4750098">.</span><span class="ident" id="4750099">Lines</span><span class="op" id="4750104">,</span>&nbsp;<span class="ident" id="4750106">f</span><span class="op" id="4750107">.</span><span class="ident" id="4750108">Infos</span><span class="op" id="4750113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750116">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750119">s</span><span class="op" id="4750120">.</span><span class="ident" id="4750121">files</span>&nbsp;<span class="op" id="4750127">=</span>&nbsp;<span class="ident" id="4750129">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750136">s</span><span class="op" id="4750137">.</span><span class="ident" id="4750138">last</span>&nbsp;<span class="op" id="4750143">=</span>&nbsp;<span class="ident" id="4750145">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750150">s</span><span class="op" id="4750151">.</span><span class="ident" id="4750152">mutex</span><span class="op" id="4750157">.</span><span class="ident" id="4750158">Unlock</span><span class="op" id="4750164">(</span><span class="op" id="4750165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750169">return</span>&nbsp;<span class="ident" id="4750176">nil</span><br>
<span class="lineno">40</span><span class="op" id="4750180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4750183">//&nbsp;Write&nbsp;calls&nbsp;encode&nbsp;to&nbsp;serialize&nbsp;the&nbsp;file&nbsp;set&nbsp;s.</span><br>
<span class="lineno"></span><span class="keyword" id="4750234">func</span>&nbsp;<span class="op" id="4750239">(</span><span class="ident" id="4750240">s</span>&nbsp;<span class="op" id="4750242">*</span><span class="ident" id="4750243">FileSet</span><span class="op" id="4750250">)</span>&nbsp;<span class="ident" id="4750252">Write</span><span class="op" id="4750257">(</span><span class="ident" id="4750258">encode</span>&nbsp;<span class="keyword" id="4750265">func</span><span class="op" id="4750269">(</span><span class="keyword" id="4750270">interface</span><span class="op" id="4750279">{</span><span class="op" id="4750280">}</span><span class="op" id="4750281">)</span>&nbsp;<span class="builtintype" id="4750283">error</span><span class="op" id="4750288">)</span>&nbsp;<span class="builtintype" id="4750290">error</span>&nbsp;<span class="op" id="4750296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750299">var</span>&nbsp;<span class="ident" id="4750303">ss</span>&nbsp;<span class="ident" id="4750306">serializedFileSet</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750326">s</span><span class="op" id="4750327">.</span><span class="ident" id="4750328">mutex</span><span class="op" id="4750333">.</span><span class="ident" id="4750334">Lock</span><span class="op" id="4750338">(</span><span class="op" id="4750339">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750342">ss</span><span class="op" id="4750344">.</span><span class="ident" id="4750345">Base</span>&nbsp;<span class="op" id="4750350">=</span>&nbsp;<span class="ident" id="4750352">s</span><span class="op" id="4750353">.</span><span class="ident" id="4750354">base</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750360">files</span>&nbsp;<span class="op" id="4750366">:=</span>&nbsp;<span class="builtinfunc" id="4750369">make</span><span class="op" id="4750373">(</span><span class="op" id="4750374">[</span><span class="op" id="4750375">]</span><span class="ident" id="4750376">serializedFile</span><span class="op" id="4750390">,</span>&nbsp;<span class="builtinfunc" id="4750392">len</span><span class="op" id="4750395">(</span><span class="ident" id="4750396">s</span><span class="op" id="4750397">.</span><span class="ident" id="4750398">files</span><span class="op" id="4750403">)</span><span class="op" id="4750404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750407">for</span>&nbsp;<span class="ident" id="4750411">i</span><span class="op" id="4750412">,</span>&nbsp;<span class="ident" id="4750414">f</span>&nbsp;<span class="op" id="4750416">:=</span>&nbsp;<span class="keyword" id="4750419">range</span>&nbsp;<span class="ident" id="4750425">s</span><span class="op" id="4750426">.</span><span class="ident" id="4750427">files</span>&nbsp;<span class="op" id="4750433">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750437">files</span><span class="op" id="4750442">[</span><span class="ident" id="4750443">i</span><span class="op" id="4750444">]</span>&nbsp;<span class="op" id="4750446">=</span>&nbsp;<span class="ident" id="4750448">serializedFile</span><span class="op" id="4750462">{</span><span class="ident" id="4750463">f</span><span class="op" id="4750464">.</span><span class="ident" id="4750465">name</span><span class="op" id="4750469">,</span>&nbsp;<span class="ident" id="4750471">f</span><span class="op" id="4750472">.</span><span class="ident" id="4750473">base</span><span class="op" id="4750477">,</span>&nbsp;<span class="ident" id="4750479">f</span><span class="op" id="4750480">.</span><span class="ident" id="4750481">size</span><span class="op" id="4750485">,</span>&nbsp;<span class="ident" id="4750487">f</span><span class="op" id="4750488">.</span><span class="ident" id="4750489">lines</span><span class="op" id="4750494">,</span>&nbsp;<span class="ident" id="4750496">f</span><span class="op" id="4750497">.</span><span class="ident" id="4750498">infos</span><span class="op" id="4750503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4750506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750509">ss</span><span class="op" id="4750511">.</span><span class="ident" id="4750512">Files</span>&nbsp;<span class="op" id="4750518">=</span>&nbsp;<span class="ident" id="4750520">files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4750527">s</span><span class="op" id="4750528">.</span><span class="ident" id="4750529">mutex</span><span class="op" id="4750534">.</span><span class="ident" id="4750535">Unlock</span><span class="op" id="4750541">(</span><span class="op" id="4750542">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4750546">return</span>&nbsp;<span class="ident" id="4750553">encode</span><span class="op" id="4750559">(</span><span class="ident" id="4750560">ss</span><span class="op" id="4750562">)</span><br>
<span class="lineno"></span><span class="op" id="4750564">}</span>
</div>
</body>
</html>
