<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/ascii85</h2>
<ul>
<li><a href="/gostd/encoding/ascii85/ascii85.go.html">ascii85.go</a></li>
<li><a href="/gostd/encoding/ascii85/ascii85_test.go.html">ascii85_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6331406">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6331461">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6331515">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6331566">//&nbsp;Package&nbsp;ascii85&nbsp;implements&nbsp;the&nbsp;ascii85&nbsp;data&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6331622">//&nbsp;as&nbsp;used&nbsp;in&nbsp;the&nbsp;btoa&nbsp;tool&nbsp;and&nbsp;Adobe&#39;s&nbsp;PostScript&nbsp;and&nbsp;PDF&nbsp;document&nbsp;formats.</span><br>
<span class="lineno"></span><span class="keyword" id="6331699">package</span>&nbsp;<span class="ident" id="6331707">ascii85</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6331716">import</span>&nbsp;<span class="op" id="6331723">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6331726">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6331732">&#34;strconv&#34;</span><br>
<span class="lineno"></span><span class="op" id="6331742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6331745">/*<br>
<span class="lineno">15</span>&nbsp;*&nbsp;Encoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6331764">//&nbsp;Encode&nbsp;encodes&nbsp;src&nbsp;into&nbsp;at&nbsp;most&nbsp;MaxEncodedLen(len(src))</span><br>
<span class="lineno"></span><span class="comment" id="6331823">//&nbsp;bytes&nbsp;of&nbsp;dst,&nbsp;returning&nbsp;the&nbsp;actual&nbsp;number&nbsp;of&nbsp;bytes&nbsp;written.</span><br>
<span class="lineno">20</span><span class="comment" id="6331886">//</span><br>
<span class="lineno"></span><span class="comment" id="6331889">//&nbsp;The&nbsp;encoding&nbsp;handles&nbsp;4-byte&nbsp;chunks,&nbsp;using&nbsp;a&nbsp;special&nbsp;encoding</span><br>
<span class="lineno"></span><span class="comment" id="6331953">//&nbsp;for&nbsp;the&nbsp;last&nbsp;fragment,&nbsp;so&nbsp;Encode&nbsp;is&nbsp;not&nbsp;appropriate&nbsp;for&nbsp;use&nbsp;on</span><br>
<span class="lineno"></span><span class="comment" id="6332019">//&nbsp;individual&nbsp;blocks&nbsp;of&nbsp;a&nbsp;large&nbsp;data&nbsp;stream.&nbsp;&nbsp;Use&nbsp;NewEncoder()&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="6332091">//</span><br>
<span class="lineno">25</span><span class="comment" id="6332094">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6332158">//&nbsp;Encode&nbsp;does&nbsp;not&nbsp;add&nbsp;these.</span><br>
<span class="lineno"></span><span class="keyword" id="6332188">func</span>&nbsp;<span class="ident" id="6332193">Encode</span><span class="op" id="6332199">(</span><span class="ident" id="6332200">dst</span><span class="op" id="6332203">,</span>&nbsp;<span class="ident" id="6332205">src</span>&nbsp;<span class="op" id="6332209">[</span><span class="op" id="6332210">]</span><span class="builtintype" id="6332211">byte</span><span class="op" id="6332215">)</span>&nbsp;<span class="builtintype" id="6332217">int</span>&nbsp;<span class="op" id="6332221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332224">if</span>&nbsp;<span class="builtinfunc" id="6332227">len</span><span class="op" id="6332230">(</span><span class="ident" id="6332231">src</span><span class="op" id="6332234">)</span>&nbsp;<span class="op" id="6332236">==</span>&nbsp;<span class="num" id="6332239">0</span>&nbsp;<span class="op" id="6332241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332245">return</span>&nbsp;<span class="num" id="6332252">0</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332255">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332259">n</span>&nbsp;<span class="op" id="6332261">:=</span>&nbsp;<span class="num" id="6332264">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332267">for</span>&nbsp;<span class="builtinfunc" id="6332271">len</span><span class="op" id="6332274">(</span><span class="ident" id="6332275">src</span><span class="op" id="6332278">)</span>&nbsp;<span class="op" id="6332280">&gt;</span>&nbsp;<span class="num" id="6332282">0</span>&nbsp;<span class="op" id="6332284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332288">dst</span><span class="op" id="6332291">[</span><span class="num" id="6332292">0</span><span class="op" id="6332293">]</span>&nbsp;<span class="op" id="6332295">=</span>&nbsp;<span class="num" id="6332297">0</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332301">dst</span><span class="op" id="6332304">[</span><span class="num" id="6332305">1</span><span class="op" id="6332306">]</span>&nbsp;<span class="op" id="6332308">=</span>&nbsp;<span class="num" id="6332310">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332314">dst</span><span class="op" id="6332317">[</span><span class="num" id="6332318">2</span><span class="op" id="6332319">]</span>&nbsp;<span class="op" id="6332321">=</span>&nbsp;<span class="num" id="6332323">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332327">dst</span><span class="op" id="6332330">[</span><span class="num" id="6332331">3</span><span class="op" id="6332332">]</span>&nbsp;<span class="op" id="6332334">=</span>&nbsp;<span class="num" id="6332336">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332340">dst</span><span class="op" id="6332343">[</span><span class="num" id="6332344">4</span><span class="op" id="6332345">]</span>&nbsp;<span class="op" id="6332347">=</span>&nbsp;<span class="num" id="6332349">0</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6332354">//&nbsp;Unpack&nbsp;4&nbsp;bytes&nbsp;into&nbsp;uint32&nbsp;to&nbsp;repack&nbsp;into&nbsp;base&nbsp;85&nbsp;5-byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332417">var</span>&nbsp;<span class="ident" id="6332421">v</span>&nbsp;<span class="builtintype" id="6332423">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332432">switch</span>&nbsp;<span class="builtinfunc" id="6332439">len</span><span class="op" id="6332442">(</span><span class="ident" id="6332443">src</span><span class="op" id="6332446">)</span>&nbsp;<span class="op" id="6332448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332452">default</span><span class="op" id="6332459">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332464">v</span>&nbsp;<span class="op" id="6332466">|=</span>&nbsp;<span class="builtintype" id="6332469">uint32</span><span class="op" id="6332475">(</span><span class="ident" id="6332476">src</span><span class="op" id="6332479">[</span><span class="num" id="6332480">3</span><span class="op" id="6332481">]</span><span class="op" id="6332482">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332487">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332501">case</span>&nbsp;<span class="num" id="6332506">3</span><span class="op" id="6332507">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332512">v</span>&nbsp;<span class="op" id="6332514">|=</span>&nbsp;<span class="builtintype" id="6332517">uint32</span><span class="op" id="6332523">(</span><span class="ident" id="6332524">src</span><span class="op" id="6332527">[</span><span class="num" id="6332528">2</span><span class="op" id="6332529">]</span><span class="op" id="6332530">)</span>&nbsp;<span class="op" id="6332532">&lt;&lt;</span>&nbsp;<span class="num" id="6332535">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332540">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332554">case</span>&nbsp;<span class="num" id="6332559">2</span><span class="op" id="6332560">:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332565">v</span>&nbsp;<span class="op" id="6332567">|=</span>&nbsp;<span class="builtintype" id="6332570">uint32</span><span class="op" id="6332576">(</span><span class="ident" id="6332577">src</span><span class="op" id="6332580">[</span><span class="num" id="6332581">1</span><span class="op" id="6332582">]</span><span class="op" id="6332583">)</span>&nbsp;<span class="op" id="6332585">&lt;&lt;</span>&nbsp;<span class="num" id="6332588">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332594">fallthrough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332608">case</span>&nbsp;<span class="num" id="6332613">1</span><span class="op" id="6332614">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332619">v</span>&nbsp;<span class="op" id="6332621">|=</span>&nbsp;<span class="builtintype" id="6332624">uint32</span><span class="op" id="6332630">(</span><span class="ident" id="6332631">src</span><span class="op" id="6332634">[</span><span class="num" id="6332635">0</span><span class="op" id="6332636">]</span><span class="op" id="6332637">)</span>&nbsp;<span class="op" id="6332639">&lt;&lt;</span>&nbsp;<span class="num" id="6332642">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332647">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6332652">//&nbsp;Special&nbsp;case:&nbsp;zero&nbsp;(!!!!!)&nbsp;shortens&nbsp;to&nbsp;z.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332699">if</span>&nbsp;<span class="ident" id="6332702">v</span>&nbsp;<span class="op" id="6332704">==</span>&nbsp;<span class="num" id="6332707">0</span>&nbsp;<span class="op" id="6332709">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6332712">len</span><span class="op" id="6332715">(</span><span class="ident" id="6332716">src</span><span class="op" id="6332719">)</span>&nbsp;<span class="op" id="6332721">&gt;=</span>&nbsp;<span class="num" id="6332724">4</span>&nbsp;<span class="op" id="6332726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332731">dst</span><span class="op" id="6332734">[</span><span class="num" id="6332735">0</span><span class="op" id="6332736">]</span>&nbsp;<span class="op" id="6332738">=</span>&nbsp;<span class="string" id="6332740">&#39;z&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332747">dst</span>&nbsp;<span class="op" id="6332751">=</span>&nbsp;<span class="ident" id="6332753">dst</span><span class="op" id="6332756">[</span><span class="num" id="6332757">1</span><span class="op" id="6332758">:</span><span class="op" id="6332759">]</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332764">src</span>&nbsp;<span class="op" id="6332768">=</span>&nbsp;<span class="ident" id="6332770">src</span><span class="op" id="6332773">[</span><span class="num" id="6332774">4</span><span class="op" id="6332775">:</span><span class="op" id="6332776">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332781">n</span><span class="op" id="6332782">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332788">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6332804">//&nbsp;Otherwise,&nbsp;5&nbsp;base&nbsp;85&nbsp;digits&nbsp;starting&nbsp;at&nbsp;!.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332852">for</span>&nbsp;<span class="ident" id="6332856">i</span>&nbsp;<span class="op" id="6332858">:=</span>&nbsp;<span class="num" id="6332861">4</span><span class="op" id="6332862">;</span>&nbsp;<span class="ident" id="6332864">i</span>&nbsp;<span class="op" id="6332866">&gt;=</span>&nbsp;<span class="num" id="6332869">0</span><span class="op" id="6332870">;</span>&nbsp;<span class="ident" id="6332872">i</span><span class="op" id="6332873">--</span>&nbsp;<span class="op" id="6332876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332881">dst</span><span class="op" id="6332884">[</span><span class="ident" id="6332885">i</span><span class="op" id="6332886">]</span>&nbsp;<span class="op" id="6332888">=</span>&nbsp;<span class="string" id="6332890">&#39;!&#39;</span>&nbsp;<span class="op" id="6332894">+</span>&nbsp;<span class="builtintype" id="6332896">byte</span><span class="op" id="6332900">(</span><span class="ident" id="6332901">v</span><span class="op" id="6332902">%</span><span class="num" id="6332903">85</span><span class="op" id="6332905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332910">v</span>&nbsp;<span class="op" id="6332912">/=</span>&nbsp;<span class="num" id="6332915">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6332920">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6332925">//&nbsp;If&nbsp;src&nbsp;was&nbsp;short,&nbsp;discard&nbsp;the&nbsp;low&nbsp;destination&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6332983">m</span>&nbsp;<span class="op" id="6332985">:=</span>&nbsp;<span class="num" id="6332988">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6332992">if</span>&nbsp;<span class="builtinfunc" id="6332995">len</span><span class="op" id="6332998">(</span><span class="ident" id="6332999">src</span><span class="op" id="6333002">)</span>&nbsp;<span class="op" id="6333004">&lt;</span>&nbsp;<span class="num" id="6333006">4</span>&nbsp;<span class="op" id="6333008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333013">m</span>&nbsp;<span class="op" id="6333015">-=</span>&nbsp;<span class="num" id="6333018">4</span>&nbsp;<span class="op" id="6333020">-</span>&nbsp;<span class="builtinfunc" id="6333022">len</span><span class="op" id="6333025">(</span><span class="ident" id="6333026">src</span><span class="op" id="6333029">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333034">src</span>&nbsp;<span class="op" id="6333038">=</span>&nbsp;<span class="ident" id="6333040">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333046">}</span>&nbsp;<span class="keyword" id="6333048">else</span>&nbsp;<span class="op" id="6333053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333058">src</span>&nbsp;<span class="op" id="6333062">=</span>&nbsp;<span class="ident" id="6333064">src</span><span class="op" id="6333067">[</span><span class="num" id="6333068">4</span><span class="op" id="6333069">:</span><span class="op" id="6333070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333078">dst</span>&nbsp;<span class="op" id="6333082">=</span>&nbsp;<span class="ident" id="6333084">dst</span><span class="op" id="6333087">[</span><span class="ident" id="6333088">m</span><span class="op" id="6333089">:</span><span class="op" id="6333090">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333094">n</span>&nbsp;<span class="op" id="6333096">+=</span>&nbsp;<span class="ident" id="6333099">m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333105">return</span>&nbsp;<span class="ident" id="6333112">n</span><br>
<span class="lineno"></span><span class="op" id="6333114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="6333117">//&nbsp;MaxEncodedLen&nbsp;returns&nbsp;the&nbsp;maximum&nbsp;length&nbsp;of&nbsp;an&nbsp;encoding&nbsp;of&nbsp;n&nbsp;source&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6333195">func</span>&nbsp;<span class="ident" id="6333200">MaxEncodedLen</span><span class="op" id="6333213">(</span><span class="ident" id="6333214">n</span>&nbsp;<span class="builtintype" id="6333216">int</span><span class="op" id="6333219">)</span>&nbsp;<span class="builtintype" id="6333221">int</span>&nbsp;<span class="op" id="6333225">{</span>&nbsp;<span class="keyword" id="6333227">return</span>&nbsp;<span class="op" id="6333234">(</span><span class="ident" id="6333235">n</span>&nbsp;<span class="op" id="6333237">+</span>&nbsp;<span class="num" id="6333239">3</span><span class="op" id="6333240">)</span>&nbsp;<span class="op" id="6333242">/</span>&nbsp;<span class="num" id="6333244">4</span>&nbsp;<span class="op" id="6333246">*</span>&nbsp;<span class="num" id="6333248">5</span>&nbsp;<span class="op" id="6333250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6333253">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;encoder.&nbsp;&nbsp;Data&nbsp;written&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="6333322">//&nbsp;the&nbsp;returned&nbsp;writer&nbsp;will&nbsp;be&nbsp;encoded&nbsp;and&nbsp;then&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno">90</span><span class="comment" id="6333384">//&nbsp;Ascii85&nbsp;encodings&nbsp;operate&nbsp;in&nbsp;32-bit&nbsp;blocks;&nbsp;when&nbsp;finished</span><br>
<span class="lineno"></span><span class="comment" id="6333445">//&nbsp;writing,&nbsp;the&nbsp;caller&nbsp;must&nbsp;Close&nbsp;the&nbsp;returned&nbsp;encoder&nbsp;to&nbsp;flush&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6333513">//&nbsp;trailing&nbsp;partial&nbsp;block.</span><br>
<span class="lineno"></span><span class="keyword" id="6333540">func</span>&nbsp;<span class="ident" id="6333545">NewEncoder</span><span class="op" id="6333555">(</span><span class="ident" id="6333556">w</span>&nbsp;<span class="ident" id="6333558">io</span><span class="op" id="6333560">.</span><span class="ident" id="6333561">Writer</span><span class="op" id="6333567">)</span>&nbsp;<span class="ident" id="6333569">io</span><span class="op" id="6333571">.</span><span class="ident" id="6333572">WriteCloser</span>&nbsp;<span class="op" id="6333584">{</span>&nbsp;<span class="keyword" id="6333586">return</span>&nbsp;<span class="op" id="6333593">&amp;</span><span class="ident" id="6333594">encoder</span><span class="op" id="6333601">{</span><span class="ident" id="6333602">w</span><span class="op" id="6333603">:</span>&nbsp;<span class="ident" id="6333605">w</span><span class="op" id="6333606">}</span>&nbsp;<span class="op" id="6333608">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6333611">type</span>&nbsp;<span class="ident" id="6333616">encoder</span>&nbsp;<span class="keyword" id="6333624">struct</span>&nbsp;<span class="op" id="6333631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333634">err</span>&nbsp;&nbsp;<span class="builtintype" id="6333639">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333646">w</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6333651">io</span><span class="op" id="6333653">.</span><span class="ident" id="6333654">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333662">buf</span>&nbsp;&nbsp;<span class="op" id="6333667">[</span><span class="num" id="6333668">4</span><span class="op" id="6333669">]</span><span class="builtintype" id="6333670">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6333678">//&nbsp;buffered&nbsp;data&nbsp;waiting&nbsp;to&nbsp;be&nbsp;encoded</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333718">nbuf</span>&nbsp;<span class="builtintype" id="6333723">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6333734">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in&nbsp;buf</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333761">out</span>&nbsp;&nbsp;<span class="op" id="6333766">[</span><span class="num" id="6333767">1024</span><span class="op" id="6333771">]</span><span class="builtintype" id="6333772">byte</span>&nbsp;<span class="comment" id="6333777">//&nbsp;output&nbsp;buffer</span><br>
<span class="lineno"></span><span class="op" id="6333794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6333797">func</span>&nbsp;<span class="op" id="6333802">(</span><span class="ident" id="6333803">e</span>&nbsp;<span class="op" id="6333805">*</span><span class="ident" id="6333806">encoder</span><span class="op" id="6333813">)</span>&nbsp;<span class="ident" id="6333815">Write</span><span class="op" id="6333820">(</span><span class="ident" id="6333821">p</span>&nbsp;<span class="op" id="6333823">[</span><span class="op" id="6333824">]</span><span class="builtintype" id="6333825">byte</span><span class="op" id="6333829">)</span>&nbsp;<span class="op" id="6333831">(</span><span class="ident" id="6333832">n</span>&nbsp;<span class="builtintype" id="6333834">int</span><span class="op" id="6333837">,</span>&nbsp;<span class="ident" id="6333839">err</span>&nbsp;<span class="builtintype" id="6333843">error</span><span class="op" id="6333848">)</span>&nbsp;<span class="op" id="6333850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333853">if</span>&nbsp;<span class="ident" id="6333856">e</span><span class="op" id="6333857">.</span><span class="ident" id="6333858">err</span>&nbsp;<span class="op" id="6333862">!=</span>&nbsp;<span class="ident" id="6333865">nil</span>&nbsp;<span class="op" id="6333869">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333873">return</span>&nbsp;<span class="num" id="6333880">0</span><span class="op" id="6333881">,</span>&nbsp;<span class="ident" id="6333883">e</span><span class="op" id="6333884">.</span><span class="ident" id="6333885">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6333890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6333894">//&nbsp;Leading&nbsp;fringe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333914">if</span>&nbsp;<span class="ident" id="6333917">e</span><span class="op" id="6333918">.</span><span class="ident" id="6333919">nbuf</span>&nbsp;<span class="op" id="6333924">&gt;</span>&nbsp;<span class="num" id="6333926">0</span>&nbsp;<span class="op" id="6333928">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333932">var</span>&nbsp;<span class="ident" id="6333936">i</span>&nbsp;<span class="builtintype" id="6333938">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6333944">for</span>&nbsp;<span class="ident" id="6333948">i</span>&nbsp;<span class="op" id="6333950">=</span>&nbsp;<span class="num" id="6333952">0</span><span class="op" id="6333953">;</span>&nbsp;<span class="ident" id="6333955">i</span>&nbsp;<span class="op" id="6333957">&lt;</span>&nbsp;<span class="builtinfunc" id="6333959">len</span><span class="op" id="6333962">(</span><span class="ident" id="6333963">p</span><span class="op" id="6333964">)</span>&nbsp;<span class="op" id="6333966">&amp;&amp;</span>&nbsp;<span class="ident" id="6333969">e</span><span class="op" id="6333970">.</span><span class="ident" id="6333971">nbuf</span>&nbsp;<span class="op" id="6333976">&lt;</span>&nbsp;<span class="num" id="6333978">4</span><span class="op" id="6333979">;</span>&nbsp;<span class="ident" id="6333981">i</span><span class="op" id="6333982">++</span>&nbsp;<span class="op" id="6333985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6333990">e</span><span class="op" id="6333991">.</span><span class="ident" id="6333992">buf</span><span class="op" id="6333995">[</span><span class="ident" id="6333996">e</span><span class="op" id="6333997">.</span><span class="ident" id="6333998">nbuf</span><span class="op" id="6334002">]</span>&nbsp;<span class="op" id="6334004">=</span>&nbsp;<span class="ident" id="6334006">p</span><span class="op" id="6334007">[</span><span class="ident" id="6334008">i</span><span class="op" id="6334009">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334014">e</span><span class="op" id="6334015">.</span><span class="ident" id="6334016">nbuf</span><span class="op" id="6334020">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334025">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334029">n</span>&nbsp;<span class="op" id="6334031">+=</span>&nbsp;<span class="ident" id="6334034">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334038">p</span>&nbsp;<span class="op" id="6334040">=</span>&nbsp;<span class="ident" id="6334042">p</span><span class="op" id="6334043">[</span><span class="ident" id="6334044">i</span><span class="op" id="6334045">:</span><span class="op" id="6334046">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334050">if</span>&nbsp;<span class="ident" id="6334053">e</span><span class="op" id="6334054">.</span><span class="ident" id="6334055">nbuf</span>&nbsp;<span class="op" id="6334060">&lt;</span>&nbsp;<span class="num" id="6334062">4</span>&nbsp;<span class="op" id="6334064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334069">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334078">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334082">nout</span>&nbsp;<span class="op" id="6334087">:=</span>&nbsp;<span class="ident" id="6334090">Encode</span><span class="op" id="6334096">(</span><span class="ident" id="6334097">e</span><span class="op" id="6334098">.</span><span class="ident" id="6334099">out</span><span class="op" id="6334102">[</span><span class="num" id="6334103">0</span><span class="op" id="6334104">:</span><span class="op" id="6334105">]</span><span class="op" id="6334106">,</span>&nbsp;<span class="ident" id="6334108">e</span><span class="op" id="6334109">.</span><span class="ident" id="6334110">buf</span><span class="op" id="6334113">[</span><span class="num" id="6334114">0</span><span class="op" id="6334115">:</span><span class="op" id="6334116">]</span><span class="op" id="6334117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334121">if</span>&nbsp;<span class="ident" id="6334124">_</span><span class="op" id="6334125">,</span>&nbsp;<span class="ident" id="6334127">e</span><span class="op" id="6334128">.</span><span class="ident" id="6334129">err</span>&nbsp;<span class="op" id="6334133">=</span>&nbsp;<span class="ident" id="6334135">e</span><span class="op" id="6334136">.</span><span class="ident" id="6334137">w</span><span class="op" id="6334138">.</span><span class="ident" id="6334139">Write</span><span class="op" id="6334144">(</span><span class="ident" id="6334145">e</span><span class="op" id="6334146">.</span><span class="ident" id="6334147">out</span><span class="op" id="6334150">[</span><span class="num" id="6334151">0</span><span class="op" id="6334152">:</span><span class="ident" id="6334153">nout</span><span class="op" id="6334157">]</span><span class="op" id="6334158">)</span><span class="op" id="6334159">;</span>&nbsp;<span class="ident" id="6334161">e</span><span class="op" id="6334162">.</span><span class="ident" id="6334163">err</span>&nbsp;<span class="op" id="6334167">!=</span>&nbsp;<span class="ident" id="6334170">nil</span>&nbsp;<span class="op" id="6334174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334179">return</span>&nbsp;<span class="ident" id="6334186">n</span><span class="op" id="6334187">,</span>&nbsp;<span class="ident" id="6334189">e</span><span class="op" id="6334190">.</span><span class="ident" id="6334191">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334201">e</span><span class="op" id="6334202">.</span><span class="ident" id="6334203">nbuf</span>&nbsp;<span class="op" id="6334208">=</span>&nbsp;<span class="num" id="6334210">0</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334217">//&nbsp;Large&nbsp;interior&nbsp;chunks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334244">for</span>&nbsp;<span class="builtinfunc" id="6334248">len</span><span class="op" id="6334251">(</span><span class="ident" id="6334252">p</span><span class="op" id="6334253">)</span>&nbsp;<span class="op" id="6334255">&gt;=</span>&nbsp;<span class="num" id="6334258">4</span>&nbsp;<span class="op" id="6334260">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334264">nn</span>&nbsp;<span class="op" id="6334267">:=</span>&nbsp;<span class="builtinfunc" id="6334270">len</span><span class="op" id="6334273">(</span><span class="ident" id="6334274">e</span><span class="op" id="6334275">.</span><span class="ident" id="6334276">out</span><span class="op" id="6334279">)</span>&nbsp;<span class="op" id="6334281">/</span>&nbsp;<span class="num" id="6334283">5</span>&nbsp;<span class="op" id="6334285">*</span>&nbsp;<span class="num" id="6334287">4</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334291">if</span>&nbsp;<span class="ident" id="6334294">nn</span>&nbsp;<span class="op" id="6334297">&gt;</span>&nbsp;<span class="builtinfunc" id="6334299">len</span><span class="op" id="6334302">(</span><span class="ident" id="6334303">p</span><span class="op" id="6334304">)</span>&nbsp;<span class="op" id="6334306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334311">nn</span>&nbsp;<span class="op" id="6334314">=</span>&nbsp;<span class="builtinfunc" id="6334316">len</span><span class="op" id="6334319">(</span><span class="ident" id="6334320">p</span><span class="op" id="6334321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334329">nn</span>&nbsp;<span class="op" id="6334332">-=</span>&nbsp;<span class="ident" id="6334335">nn</span>&nbsp;<span class="op" id="6334338">%</span>&nbsp;<span class="num" id="6334340">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334344">if</span>&nbsp;<span class="ident" id="6334347">nn</span>&nbsp;<span class="op" id="6334350">&gt;</span>&nbsp;<span class="num" id="6334352">0</span>&nbsp;<span class="op" id="6334354">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334359">nout</span>&nbsp;<span class="op" id="6334364">:=</span>&nbsp;<span class="ident" id="6334367">Encode</span><span class="op" id="6334373">(</span><span class="ident" id="6334374">e</span><span class="op" id="6334375">.</span><span class="ident" id="6334376">out</span><span class="op" id="6334379">[</span><span class="num" id="6334380">0</span><span class="op" id="6334381">:</span><span class="op" id="6334382">]</span><span class="op" id="6334383">,</span>&nbsp;<span class="ident" id="6334385">p</span><span class="op" id="6334386">[</span><span class="num" id="6334387">0</span><span class="op" id="6334388">:</span><span class="ident" id="6334389">nn</span><span class="op" id="6334391">]</span><span class="op" id="6334392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334397">if</span>&nbsp;<span class="ident" id="6334400">_</span><span class="op" id="6334401">,</span>&nbsp;<span class="ident" id="6334403">e</span><span class="op" id="6334404">.</span><span class="ident" id="6334405">err</span>&nbsp;<span class="op" id="6334409">=</span>&nbsp;<span class="ident" id="6334411">e</span><span class="op" id="6334412">.</span><span class="ident" id="6334413">w</span><span class="op" id="6334414">.</span><span class="ident" id="6334415">Write</span><span class="op" id="6334420">(</span><span class="ident" id="6334421">e</span><span class="op" id="6334422">.</span><span class="ident" id="6334423">out</span><span class="op" id="6334426">[</span><span class="num" id="6334427">0</span><span class="op" id="6334428">:</span><span class="ident" id="6334429">nout</span><span class="op" id="6334433">]</span><span class="op" id="6334434">)</span><span class="op" id="6334435">;</span>&nbsp;<span class="ident" id="6334437">e</span><span class="op" id="6334438">.</span><span class="ident" id="6334439">err</span>&nbsp;<span class="op" id="6334443">!=</span>&nbsp;<span class="ident" id="6334446">nil</span>&nbsp;<span class="op" id="6334450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334456">return</span>&nbsp;<span class="ident" id="6334463">n</span><span class="op" id="6334464">,</span>&nbsp;<span class="ident" id="6334466">e</span><span class="op" id="6334467">.</span><span class="ident" id="6334468">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334479">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334483">n</span>&nbsp;<span class="op" id="6334485">+=</span>&nbsp;<span class="ident" id="6334488">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334493">p</span>&nbsp;<span class="op" id="6334495">=</span>&nbsp;<span class="ident" id="6334497">p</span><span class="op" id="6334498">[</span><span class="ident" id="6334499">nn</span><span class="op" id="6334501">:</span><span class="op" id="6334502">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334509">//&nbsp;Trailing&nbsp;fringe.</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334530">for</span>&nbsp;<span class="ident" id="6334534">i</span>&nbsp;<span class="op" id="6334536">:=</span>&nbsp;<span class="num" id="6334539">0</span><span class="op" id="6334540">;</span>&nbsp;<span class="ident" id="6334542">i</span>&nbsp;<span class="op" id="6334544">&lt;</span>&nbsp;<span class="builtinfunc" id="6334546">len</span><span class="op" id="6334549">(</span><span class="ident" id="6334550">p</span><span class="op" id="6334551">)</span><span class="op" id="6334552">;</span>&nbsp;<span class="ident" id="6334554">i</span><span class="op" id="6334555">++</span>&nbsp;<span class="op" id="6334558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334562">e</span><span class="op" id="6334563">.</span><span class="ident" id="6334564">buf</span><span class="op" id="6334567">[</span><span class="ident" id="6334568">i</span><span class="op" id="6334569">]</span>&nbsp;<span class="op" id="6334571">=</span>&nbsp;<span class="ident" id="6334573">p</span><span class="op" id="6334574">[</span><span class="ident" id="6334575">i</span><span class="op" id="6334576">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334582">e</span><span class="op" id="6334583">.</span><span class="ident" id="6334584">nbuf</span>&nbsp;<span class="op" id="6334589">=</span>&nbsp;<span class="builtinfunc" id="6334591">len</span><span class="op" id="6334594">(</span><span class="ident" id="6334595">p</span><span class="op" id="6334596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334599">n</span>&nbsp;<span class="op" id="6334601">+=</span>&nbsp;<span class="builtinfunc" id="6334604">len</span><span class="op" id="6334607">(</span><span class="ident" id="6334608">p</span><span class="op" id="6334609">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334612">return</span><br>
<span class="lineno"></span><span class="op" id="6334619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6334622">//&nbsp;Close&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;output&nbsp;from&nbsp;the&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6334676">//&nbsp;It&nbsp;is&nbsp;an&nbsp;error&nbsp;to&nbsp;call&nbsp;Write&nbsp;after&nbsp;calling&nbsp;Close.</span><br>
<span class="lineno">155</span><span class="keyword" id="6334729">func</span>&nbsp;<span class="op" id="6334734">(</span><span class="ident" id="6334735">e</span>&nbsp;<span class="op" id="6334737">*</span><span class="ident" id="6334738">encoder</span><span class="op" id="6334745">)</span>&nbsp;<span class="ident" id="6334747">Close</span><span class="op" id="6334752">(</span><span class="op" id="6334753">)</span>&nbsp;<span class="builtintype" id="6334755">error</span>&nbsp;<span class="op" id="6334761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6334764">//&nbsp;If&nbsp;there&#39;s&nbsp;anything&nbsp;left&nbsp;in&nbsp;the&nbsp;buffer,&nbsp;flush&nbsp;it&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334821">if</span>&nbsp;<span class="ident" id="6334824">e</span><span class="op" id="6334825">.</span><span class="ident" id="6334826">err</span>&nbsp;<span class="op" id="6334830">==</span>&nbsp;<span class="ident" id="6334833">nil</span>&nbsp;<span class="op" id="6334837">&amp;&amp;</span>&nbsp;<span class="ident" id="6334840">e</span><span class="op" id="6334841">.</span><span class="ident" id="6334842">nbuf</span>&nbsp;<span class="op" id="6334847">&gt;</span>&nbsp;<span class="num" id="6334849">0</span>&nbsp;<span class="op" id="6334851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334855">nout</span>&nbsp;<span class="op" id="6334860">:=</span>&nbsp;<span class="ident" id="6334863">Encode</span><span class="op" id="6334869">(</span><span class="ident" id="6334870">e</span><span class="op" id="6334871">.</span><span class="ident" id="6334872">out</span><span class="op" id="6334875">[</span><span class="num" id="6334876">0</span><span class="op" id="6334877">:</span><span class="op" id="6334878">]</span><span class="op" id="6334879">,</span>&nbsp;<span class="ident" id="6334881">e</span><span class="op" id="6334882">.</span><span class="ident" id="6334883">buf</span><span class="op" id="6334886">[</span><span class="num" id="6334887">0</span><span class="op" id="6334888">:</span><span class="ident" id="6334889">e</span><span class="op" id="6334890">.</span><span class="ident" id="6334891">nbuf</span><span class="op" id="6334895">]</span><span class="op" id="6334896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334900">e</span><span class="op" id="6334901">.</span><span class="ident" id="6334902">nbuf</span>&nbsp;<span class="op" id="6334907">=</span>&nbsp;<span class="num" id="6334909">0</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6334913">_</span><span class="op" id="6334914">,</span>&nbsp;<span class="ident" id="6334916">e</span><span class="op" id="6334917">.</span><span class="ident" id="6334918">err</span>&nbsp;<span class="op" id="6334922">=</span>&nbsp;<span class="ident" id="6334924">e</span><span class="op" id="6334925">.</span><span class="ident" id="6334926">w</span><span class="op" id="6334927">.</span><span class="ident" id="6334928">Write</span><span class="op" id="6334933">(</span><span class="ident" id="6334934">e</span><span class="op" id="6334935">.</span><span class="ident" id="6334936">out</span><span class="op" id="6334939">[</span><span class="num" id="6334940">0</span><span class="op" id="6334941">:</span><span class="ident" id="6334942">nout</span><span class="op" id="6334946">]</span><span class="op" id="6334947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6334950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6334953">return</span>&nbsp;<span class="ident" id="6334960">e</span><span class="op" id="6334961">.</span><span class="ident" id="6334962">err</span><br>
<span class="lineno"></span><span class="op" id="6334966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="6334969">/*<br>
<span class="lineno"></span>&nbsp;*&nbsp;Decoder<br>
<span class="lineno"></span>&nbsp;*/</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6334988">type</span>&nbsp;<span class="ident" id="6334993">CorruptInputError</span>&nbsp;<span class="ident" id="6335011">int64</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="6335018">func</span>&nbsp;<span class="op" id="6335023">(</span><span class="ident" id="6335024">e</span>&nbsp;<span class="ident" id="6335026">CorruptInputError</span><span class="op" id="6335043">)</span>&nbsp;<span class="ident" id="6335045">Error</span><span class="op" id="6335050">(</span><span class="op" id="6335051">)</span>&nbsp;<span class="builtintype" id="6335053">string</span>&nbsp;<span class="op" id="6335060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335063">return</span>&nbsp;<span class="string" id="6335070">&#34;illegal&nbsp;ascii85&nbsp;data&nbsp;at&nbsp;input&nbsp;byte&nbsp;&#34;</span>&nbsp;<span class="op" id="6335108">+</span>&nbsp;<span class="ident" id="6335110">strconv</span><span class="op" id="6335117">.</span><span class="ident" id="6335118">FormatInt</span><span class="op" id="6335127">(</span><span class="ident" id="6335128">int64</span><span class="op" id="6335133">(</span><span class="ident" id="6335134">e</span><span class="op" id="6335135">)</span><span class="op" id="6335136">,</span>&nbsp;<span class="num" id="6335138">10</span><span class="op" id="6335140">)</span><br>
<span class="lineno"></span><span class="op" id="6335142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="comment" id="6335145">//&nbsp;Decode&nbsp;decodes&nbsp;src&nbsp;into&nbsp;dst,&nbsp;returning&nbsp;both&nbsp;the&nbsp;number</span><br>
<span class="lineno"></span><span class="comment" id="6335203">//&nbsp;of&nbsp;bytes&nbsp;written&nbsp;to&nbsp;dst&nbsp;and&nbsp;the&nbsp;number&nbsp;consumed&nbsp;from&nbsp;src.</span><br>
<span class="lineno"></span><span class="comment" id="6335264">//&nbsp;If&nbsp;src&nbsp;contains&nbsp;invalid&nbsp;ascii85&nbsp;data,&nbsp;Decode&nbsp;will&nbsp;return&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6335328">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;successfully&nbsp;written&nbsp;and&nbsp;a&nbsp;CorruptInputError.</span><br>
<span class="lineno"></span><span class="comment" id="6335393">//&nbsp;Decode&nbsp;ignores&nbsp;space&nbsp;and&nbsp;control&nbsp;characters&nbsp;in&nbsp;src.</span><br>
<span class="lineno">180</span><span class="comment" id="6335448">//&nbsp;Often,&nbsp;ascii85-encoded&nbsp;data&nbsp;is&nbsp;wrapped&nbsp;in&nbsp;&lt;~&nbsp;and&nbsp;~&gt;&nbsp;symbols.</span><br>
<span class="lineno"></span><span class="comment" id="6335512">//&nbsp;Decode&nbsp;expects&nbsp;these&nbsp;to&nbsp;have&nbsp;been&nbsp;stripped&nbsp;by&nbsp;the&nbsp;caller.</span><br>
<span class="lineno"></span><span class="comment" id="6335573">//</span><br>
<span class="lineno"></span><span class="comment" id="6335576">//&nbsp;If&nbsp;flush&nbsp;is&nbsp;true,&nbsp;Decode&nbsp;assumes&nbsp;that&nbsp;src&nbsp;represents&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6335636">//&nbsp;end&nbsp;of&nbsp;the&nbsp;input&nbsp;stream&nbsp;and&nbsp;processes&nbsp;it&nbsp;completely&nbsp;rather</span><br>
<span class="lineno">185</span><span class="comment" id="6335698">//&nbsp;than&nbsp;wait&nbsp;for&nbsp;the&nbsp;completion&nbsp;of&nbsp;another&nbsp;32-bit&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="6335755">//</span><br>
<span class="lineno"></span><span class="comment" id="6335758">//&nbsp;NewDecoder&nbsp;wraps&nbsp;an&nbsp;io.Reader&nbsp;interface&nbsp;around&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="comment" id="6335816">//</span><br>
<span class="lineno"></span><span class="keyword" id="6335819">func</span>&nbsp;<span class="ident" id="6335824">Decode</span><span class="op" id="6335830">(</span><span class="ident" id="6335831">dst</span><span class="op" id="6335834">,</span>&nbsp;<span class="ident" id="6335836">src</span>&nbsp;<span class="op" id="6335840">[</span><span class="op" id="6335841">]</span><span class="builtintype" id="6335842">byte</span><span class="op" id="6335846">,</span>&nbsp;<span class="ident" id="6335848">flush</span>&nbsp;<span class="builtintype" id="6335854">bool</span><span class="op" id="6335858">)</span>&nbsp;<span class="op" id="6335860">(</span><span class="ident" id="6335861">ndst</span><span class="op" id="6335865">,</span>&nbsp;<span class="ident" id="6335867">nsrc</span>&nbsp;<span class="builtintype" id="6335872">int</span><span class="op" id="6335875">,</span>&nbsp;<span class="ident" id="6335877">err</span>&nbsp;<span class="builtintype" id="6335881">error</span><span class="op" id="6335886">)</span>&nbsp;<span class="op" id="6335888">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335891">var</span>&nbsp;<span class="ident" id="6335895">v</span>&nbsp;<span class="builtintype" id="6335897">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335905">var</span>&nbsp;<span class="ident" id="6335909">nb</span>&nbsp;<span class="builtintype" id="6335912">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335917">for</span>&nbsp;<span class="ident" id="6335921">i</span><span class="op" id="6335922">,</span>&nbsp;<span class="ident" id="6335924">b</span>&nbsp;<span class="op" id="6335926">:=</span>&nbsp;<span class="keyword" id="6335929">range</span>&nbsp;<span class="ident" id="6335935">src</span>&nbsp;<span class="op" id="6335939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335943">if</span>&nbsp;<span class="builtinfunc" id="6335946">len</span><span class="op" id="6335949">(</span><span class="ident" id="6335950">dst</span><span class="op" id="6335953">)</span><span class="op" id="6335954">-</span><span class="ident" id="6335955">ndst</span>&nbsp;<span class="op" id="6335960">&lt;</span>&nbsp;<span class="num" id="6335962">4</span>&nbsp;<span class="op" id="6335964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335969">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6335978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335982">switch</span>&nbsp;<span class="op" id="6335989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6335993">case</span>&nbsp;<span class="ident" id="6335998">b</span>&nbsp;<span class="op" id="6336000">&lt;=</span>&nbsp;<span class="string" id="6336003">&#39;&nbsp;&#39;</span><span class="op" id="6336006">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336011">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336022">case</span>&nbsp;<span class="ident" id="6336027">b</span>&nbsp;<span class="op" id="6336029">==</span>&nbsp;<span class="string" id="6336032">&#39;z&#39;</span>&nbsp;<span class="op" id="6336036">&amp;&amp;</span>&nbsp;<span class="ident" id="6336039">nb</span>&nbsp;<span class="op" id="6336042">==</span>&nbsp;<span class="num" id="6336045">0</span><span class="op" id="6336046">:</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336051">nb</span>&nbsp;<span class="op" id="6336054">=</span>&nbsp;<span class="num" id="6336056">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336061">v</span>&nbsp;<span class="op" id="6336063">=</span>&nbsp;<span class="num" id="6336065">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336069">case</span>&nbsp;<span class="string" id="6336074">&#39;!&#39;</span>&nbsp;<span class="op" id="6336078">&lt;=</span>&nbsp;<span class="ident" id="6336081">b</span>&nbsp;<span class="op" id="6336083">&amp;&amp;</span>&nbsp;<span class="ident" id="6336086">b</span>&nbsp;<span class="op" id="6336088">&lt;=</span>&nbsp;<span class="string" id="6336091">&#39;u&#39;</span><span class="op" id="6336094">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336099">v</span>&nbsp;<span class="op" id="6336101">=</span>&nbsp;<span class="ident" id="6336103">v</span><span class="op" id="6336104">*</span><span class="num" id="6336105">85</span>&nbsp;<span class="op" id="6336108">+</span>&nbsp;<span class="builtintype" id="6336110">uint32</span><span class="op" id="6336116">(</span><span class="ident" id="6336117">b</span><span class="op" id="6336118">-</span><span class="string" id="6336119">&#39;!&#39;</span><span class="op" id="6336122">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336127">nb</span><span class="op" id="6336129">++</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336134">default</span><span class="op" id="6336141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336146">return</span>&nbsp;<span class="num" id="6336153">0</span><span class="op" id="6336154">,</span>&nbsp;<span class="num" id="6336156">0</span><span class="op" id="6336157">,</span>&nbsp;<span class="ident" id="6336159">CorruptInputError</span><span class="op" id="6336176">(</span><span class="ident" id="6336177">i</span><span class="op" id="6336178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336186">if</span>&nbsp;<span class="ident" id="6336189">nb</span>&nbsp;<span class="op" id="6336192">==</span>&nbsp;<span class="num" id="6336195">5</span>&nbsp;<span class="op" id="6336197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336202">nsrc</span>&nbsp;<span class="op" id="6336207">=</span>&nbsp;<span class="ident" id="6336209">i</span>&nbsp;<span class="op" id="6336211">+</span>&nbsp;<span class="num" id="6336213">1</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336218">dst</span><span class="op" id="6336221">[</span><span class="ident" id="6336222">ndst</span><span class="op" id="6336226">]</span>&nbsp;<span class="op" id="6336228">=</span>&nbsp;<span class="builtintype" id="6336230">byte</span><span class="op" id="6336234">(</span><span class="ident" id="6336235">v</span>&nbsp;<span class="op" id="6336237">&gt;&gt;</span>&nbsp;<span class="num" id="6336240">24</span><span class="op" id="6336242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336247">dst</span><span class="op" id="6336250">[</span><span class="ident" id="6336251">ndst</span><span class="op" id="6336255">+</span><span class="num" id="6336256">1</span><span class="op" id="6336257">]</span>&nbsp;<span class="op" id="6336259">=</span>&nbsp;<span class="builtintype" id="6336261">byte</span><span class="op" id="6336265">(</span><span class="ident" id="6336266">v</span>&nbsp;<span class="op" id="6336268">&gt;&gt;</span>&nbsp;<span class="num" id="6336271">16</span><span class="op" id="6336273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336278">dst</span><span class="op" id="6336281">[</span><span class="ident" id="6336282">ndst</span><span class="op" id="6336286">+</span><span class="num" id="6336287">2</span><span class="op" id="6336288">]</span>&nbsp;<span class="op" id="6336290">=</span>&nbsp;<span class="builtintype" id="6336292">byte</span><span class="op" id="6336296">(</span><span class="ident" id="6336297">v</span>&nbsp;<span class="op" id="6336299">&gt;&gt;</span>&nbsp;<span class="num" id="6336302">8</span><span class="op" id="6336303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336308">dst</span><span class="op" id="6336311">[</span><span class="ident" id="6336312">ndst</span><span class="op" id="6336316">+</span><span class="num" id="6336317">3</span><span class="op" id="6336318">]</span>&nbsp;<span class="op" id="6336320">=</span>&nbsp;<span class="builtintype" id="6336322">byte</span><span class="op" id="6336326">(</span><span class="ident" id="6336327">v</span><span class="op" id="6336328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336333">ndst</span>&nbsp;<span class="op" id="6336338">+=</span>&nbsp;<span class="num" id="6336341">4</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336346">nb</span>&nbsp;<span class="op" id="6336349">=</span>&nbsp;<span class="num" id="6336351">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336356">v</span>&nbsp;<span class="op" id="6336358">=</span>&nbsp;<span class="num" id="6336360">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336364">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336367">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336370">if</span>&nbsp;<span class="ident" id="6336373">flush</span>&nbsp;<span class="op" id="6336379">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336383">nsrc</span>&nbsp;<span class="op" id="6336388">=</span>&nbsp;<span class="builtinfunc" id="6336390">len</span><span class="op" id="6336393">(</span><span class="ident" id="6336394">src</span><span class="op" id="6336397">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336401">if</span>&nbsp;<span class="ident" id="6336404">nb</span>&nbsp;<span class="op" id="6336407">&gt;</span>&nbsp;<span class="num" id="6336409">0</span>&nbsp;<span class="op" id="6336411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336416">//&nbsp;The&nbsp;number&nbsp;of&nbsp;output&nbsp;bytes&nbsp;in&nbsp;the&nbsp;last&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336470">//&nbsp;is&nbsp;the&nbsp;number&nbsp;of&nbsp;leftover&nbsp;input&nbsp;bytes&nbsp;-&nbsp;1:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336519">//&nbsp;the&nbsp;extra&nbsp;byte&nbsp;provides&nbsp;enough&nbsp;bits&nbsp;to&nbsp;cover</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336570">//&nbsp;the&nbsp;inefficiency&nbsp;of&nbsp;the&nbsp;encoding&nbsp;for&nbsp;the&nbsp;block.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336624">if</span>&nbsp;<span class="ident" id="6336627">nb</span>&nbsp;<span class="op" id="6336630">==</span>&nbsp;<span class="num" id="6336633">1</span>&nbsp;<span class="op" id="6336635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336641">return</span>&nbsp;<span class="num" id="6336648">0</span><span class="op" id="6336649">,</span>&nbsp;<span class="num" id="6336651">0</span><span class="op" id="6336652">,</span>&nbsp;<span class="ident" id="6336654">CorruptInputError</span><span class="op" id="6336671">(</span><span class="builtinfunc" id="6336672">len</span><span class="op" id="6336675">(</span><span class="ident" id="6336676">src</span><span class="op" id="6336679">)</span><span class="op" id="6336680">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336690">for</span>&nbsp;<span class="ident" id="6336694">i</span>&nbsp;<span class="op" id="6336696">:=</span>&nbsp;<span class="ident" id="6336699">nb</span><span class="op" id="6336701">;</span>&nbsp;<span class="ident" id="6336703">i</span>&nbsp;<span class="op" id="6336705">&lt;</span>&nbsp;<span class="num" id="6336707">5</span><span class="op" id="6336708">;</span>&nbsp;<span class="ident" id="6336710">i</span><span class="op" id="6336711">++</span>&nbsp;<span class="op" id="6336714">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336720">//&nbsp;The&nbsp;short&nbsp;encoding&nbsp;truncated&nbsp;the&nbsp;output&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336774">//&nbsp;We&nbsp;have&nbsp;to&nbsp;assume&nbsp;the&nbsp;worst&nbsp;case&nbsp;values&nbsp;(digit&nbsp;84)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6336832">//&nbsp;in&nbsp;order&nbsp;to&nbsp;ensure&nbsp;that&nbsp;the&nbsp;top&nbsp;bits&nbsp;are&nbsp;correct.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336889">v</span>&nbsp;<span class="op" id="6336891">=</span>&nbsp;<span class="ident" id="6336893">v</span><span class="op" id="6336894">*</span><span class="num" id="6336895">85</span>&nbsp;<span class="op" id="6336898">+</span>&nbsp;<span class="num" id="6336900">84</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336906">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6336911">for</span>&nbsp;<span class="ident" id="6336915">i</span>&nbsp;<span class="op" id="6336917">:=</span>&nbsp;<span class="num" id="6336920">0</span><span class="op" id="6336921">;</span>&nbsp;<span class="ident" id="6336923">i</span>&nbsp;<span class="op" id="6336925">&lt;</span>&nbsp;<span class="ident" id="6336927">nb</span><span class="op" id="6336929">-</span><span class="num" id="6336930">1</span><span class="op" id="6336931">;</span>&nbsp;<span class="ident" id="6336933">i</span><span class="op" id="6336934">++</span>&nbsp;<span class="op" id="6336937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336943">dst</span><span class="op" id="6336946">[</span><span class="ident" id="6336947">ndst</span><span class="op" id="6336951">]</span>&nbsp;<span class="op" id="6336953">=</span>&nbsp;<span class="builtintype" id="6336955">byte</span><span class="op" id="6336959">(</span><span class="ident" id="6336960">v</span>&nbsp;<span class="op" id="6336962">&gt;&gt;</span>&nbsp;<span class="num" id="6336965">24</span><span class="op" id="6336967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336973">v</span>&nbsp;<span class="op" id="6336975">&lt;&lt;=</span>&nbsp;<span class="num" id="6336979">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6336985">ndst</span><span class="op" id="6336989">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336995">}</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6336999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337005">return</span><br>
<span class="lineno"></span><span class="op" id="6337012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="6337015">//&nbsp;NewDecoder&nbsp;constructs&nbsp;a&nbsp;new&nbsp;ascii85&nbsp;stream&nbsp;decoder.</span><br>
<span class="lineno"></span><span class="keyword" id="6337070">func</span>&nbsp;<span class="ident" id="6337075">NewDecoder</span><span class="op" id="6337085">(</span><span class="ident" id="6337086">r</span>&nbsp;<span class="ident" id="6337088">io</span><span class="op" id="6337090">.</span><span class="ident" id="6337091">Reader</span><span class="op" id="6337097">)</span>&nbsp;<span class="ident" id="6337099">io</span><span class="op" id="6337101">.</span><span class="ident" id="6337102">Reader</span>&nbsp;<span class="op" id="6337109">{</span>&nbsp;<span class="keyword" id="6337111">return</span>&nbsp;<span class="op" id="6337118">&amp;</span><span class="ident" id="6337119">decoder</span><span class="op" id="6337126">{</span><span class="ident" id="6337127">r</span><span class="op" id="6337128">:</span>&nbsp;<span class="ident" id="6337130">r</span><span class="op" id="6337131">}</span>&nbsp;<span class="op" id="6337133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6337136">type</span>&nbsp;<span class="ident" id="6337141">decoder</span>&nbsp;<span class="keyword" id="6337149">struct</span>&nbsp;<span class="op" id="6337156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337159">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6337167">error</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337174">readErr</span>&nbsp;<span class="builtintype" id="6337182">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337189">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6337197">io</span><span class="op" id="6337199">.</span><span class="ident" id="6337200">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337208">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337216">[</span><span class="num" id="6337217">1024</span><span class="op" id="6337221">]</span><span class="builtintype" id="6337222">byte</span>&nbsp;<span class="comment" id="6337227">//&nbsp;leftover&nbsp;input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337246">nbuf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6337254">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337259">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6337267">[</span><span class="op" id="6337268">]</span><span class="builtintype" id="6337269">byte</span>&nbsp;<span class="comment" id="6337274">//&nbsp;leftover&nbsp;decoded&nbsp;output</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337302">outbuf</span>&nbsp;&nbsp;<span class="op" id="6337310">[</span><span class="num" id="6337311">1024</span><span class="op" id="6337315">]</span><span class="builtintype" id="6337316">byte</span><br>
<span class="lineno"></span><span class="op" id="6337321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6337324">func</span>&nbsp;<span class="op" id="6337329">(</span><span class="ident" id="6337330">d</span>&nbsp;<span class="op" id="6337332">*</span><span class="ident" id="6337333">decoder</span><span class="op" id="6337340">)</span>&nbsp;<span class="ident" id="6337342">Read</span><span class="op" id="6337346">(</span><span class="ident" id="6337347">p</span>&nbsp;<span class="op" id="6337349">[</span><span class="op" id="6337350">]</span><span class="builtintype" id="6337351">byte</span><span class="op" id="6337355">)</span>&nbsp;<span class="op" id="6337357">(</span><span class="ident" id="6337358">n</span>&nbsp;<span class="builtintype" id="6337360">int</span><span class="op" id="6337363">,</span>&nbsp;<span class="ident" id="6337365">err</span>&nbsp;<span class="builtintype" id="6337369">error</span><span class="op" id="6337374">)</span>&nbsp;<span class="op" id="6337376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337379">if</span>&nbsp;<span class="builtinfunc" id="6337382">len</span><span class="op" id="6337385">(</span><span class="ident" id="6337386">p</span><span class="op" id="6337387">)</span>&nbsp;<span class="op" id="6337389">==</span>&nbsp;<span class="num" id="6337392">0</span>&nbsp;<span class="op" id="6337394">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337398">return</span>&nbsp;<span class="num" id="6337405">0</span><span class="op" id="6337406">,</span>&nbsp;<span class="ident" id="6337408">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337416">if</span>&nbsp;<span class="ident" id="6337419">d</span><span class="op" id="6337420">.</span><span class="ident" id="6337421">err</span>&nbsp;<span class="op" id="6337425">!=</span>&nbsp;<span class="ident" id="6337428">nil</span>&nbsp;<span class="op" id="6337432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337436">return</span>&nbsp;<span class="num" id="6337443">0</span><span class="op" id="6337444">,</span>&nbsp;<span class="ident" id="6337446">d</span><span class="op" id="6337447">.</span><span class="ident" id="6337448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337453">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337457">for</span>&nbsp;<span class="op" id="6337461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337465">//&nbsp;Copy&nbsp;leftover&nbsp;output&nbsp;from&nbsp;last&nbsp;decode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337509">if</span>&nbsp;<span class="builtinfunc" id="6337512">len</span><span class="op" id="6337515">(</span><span class="ident" id="6337516">d</span><span class="op" id="6337517">.</span><span class="ident" id="6337518">out</span><span class="op" id="6337521">)</span>&nbsp;<span class="op" id="6337523">&gt;</span>&nbsp;<span class="num" id="6337525">0</span>&nbsp;<span class="op" id="6337527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337532">n</span>&nbsp;<span class="op" id="6337534">=</span>&nbsp;<span class="builtinfunc" id="6337536">copy</span><span class="op" id="6337540">(</span><span class="ident" id="6337541">p</span><span class="op" id="6337542">,</span>&nbsp;<span class="ident" id="6337544">d</span><span class="op" id="6337545">.</span><span class="ident" id="6337546">out</span><span class="op" id="6337549">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337554">d</span><span class="op" id="6337555">.</span><span class="ident" id="6337556">out</span>&nbsp;<span class="op" id="6337560">=</span>&nbsp;<span class="ident" id="6337562">d</span><span class="op" id="6337563">.</span><span class="ident" id="6337564">out</span><span class="op" id="6337567">[</span><span class="ident" id="6337568">n</span><span class="op" id="6337569">:</span><span class="op" id="6337570">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337575">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337589">//&nbsp;Decode&nbsp;leftover&nbsp;input&nbsp;from&nbsp;last&nbsp;read.</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337632">var</span>&nbsp;<span class="ident" id="6337636">nn</span><span class="op" id="6337638">,</span>&nbsp;<span class="ident" id="6337640">nsrc</span><span class="op" id="6337644">,</span>&nbsp;<span class="ident" id="6337646">ndst</span>&nbsp;<span class="builtintype" id="6337651">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337657">if</span>&nbsp;<span class="ident" id="6337660">d</span><span class="op" id="6337661">.</span><span class="ident" id="6337662">nbuf</span>&nbsp;<span class="op" id="6337667">&gt;</span>&nbsp;<span class="num" id="6337669">0</span>&nbsp;<span class="op" id="6337671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337676">ndst</span><span class="op" id="6337680">,</span>&nbsp;<span class="ident" id="6337682">nsrc</span><span class="op" id="6337686">,</span>&nbsp;<span class="ident" id="6337688">d</span><span class="op" id="6337689">.</span><span class="ident" id="6337690">err</span>&nbsp;<span class="op" id="6337694">=</span>&nbsp;<span class="ident" id="6337696">Decode</span><span class="op" id="6337702">(</span><span class="ident" id="6337703">d</span><span class="op" id="6337704">.</span><span class="ident" id="6337705">outbuf</span><span class="op" id="6337711">[</span><span class="num" id="6337712">0</span><span class="op" id="6337713">:</span><span class="op" id="6337714">]</span><span class="op" id="6337715">,</span>&nbsp;<span class="ident" id="6337717">d</span><span class="op" id="6337718">.</span><span class="ident" id="6337719">buf</span><span class="op" id="6337722">[</span><span class="num" id="6337723">0</span><span class="op" id="6337724">:</span><span class="ident" id="6337725">d</span><span class="op" id="6337726">.</span><span class="ident" id="6337727">nbuf</span><span class="op" id="6337731">]</span><span class="op" id="6337732">,</span>&nbsp;<span class="ident" id="6337734">d</span><span class="op" id="6337735">.</span><span class="ident" id="6337736">readErr</span>&nbsp;<span class="op" id="6337744">!=</span>&nbsp;<span class="ident" id="6337747">nil</span><span class="op" id="6337750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337755">if</span>&nbsp;<span class="ident" id="6337758">ndst</span>&nbsp;<span class="op" id="6337763">&gt;</span>&nbsp;<span class="num" id="6337765">0</span>&nbsp;<span class="op" id="6337767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337773">d</span><span class="op" id="6337774">.</span><span class="ident" id="6337775">out</span>&nbsp;<span class="op" id="6337779">=</span>&nbsp;<span class="ident" id="6337781">d</span><span class="op" id="6337782">.</span><span class="ident" id="6337783">outbuf</span><span class="op" id="6337789">[</span><span class="num" id="6337790">0</span><span class="op" id="6337791">:</span><span class="ident" id="6337792">ndst</span><span class="op" id="6337796">]</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337802">d</span><span class="op" id="6337803">.</span><span class="ident" id="6337804">nbuf</span>&nbsp;<span class="op" id="6337809">=</span>&nbsp;<span class="builtinfunc" id="6337811">copy</span><span class="op" id="6337815">(</span><span class="ident" id="6337816">d</span><span class="op" id="6337817">.</span><span class="ident" id="6337818">buf</span><span class="op" id="6337821">[</span><span class="num" id="6337822">0</span><span class="op" id="6337823">:</span><span class="op" id="6337824">]</span><span class="op" id="6337825">,</span>&nbsp;<span class="ident" id="6337827">d</span><span class="op" id="6337828">.</span><span class="ident" id="6337829">buf</span><span class="op" id="6337832">[</span><span class="ident" id="6337833">nsrc</span><span class="op" id="6337837">:</span><span class="ident" id="6337838">d</span><span class="op" id="6337839">.</span><span class="ident" id="6337840">nbuf</span><span class="op" id="6337844">]</span><span class="op" id="6337845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337851">continue</span>&nbsp;<span class="comment" id="6337860">//&nbsp;copy&nbsp;out&nbsp;and&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6337886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6337891">if</span>&nbsp;<span class="ident" id="6337894">ndst</span>&nbsp;<span class="op" id="6337899">==</span>&nbsp;<span class="num" id="6337902">0</span>&nbsp;<span class="op" id="6337904">&amp;&amp;</span>&nbsp;<span class="ident" id="6337907">d</span><span class="op" id="6337908">.</span><span class="ident" id="6337909">err</span>&nbsp;<span class="op" id="6337913">==</span>&nbsp;<span class="ident" id="6337916">nil</span>&nbsp;<span class="op" id="6337920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337926">//&nbsp;Special&nbsp;case:&nbsp;input&nbsp;buffer&nbsp;is&nbsp;mostly&nbsp;filled&nbsp;with&nbsp;non-data&nbsp;bytes.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337998">//&nbsp;Filter&nbsp;out&nbsp;such&nbsp;bytes&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;more&nbsp;input.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338056">off</span>&nbsp;<span class="op" id="6338060">:=</span>&nbsp;<span class="num" id="6338063">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338069">for</span>&nbsp;<span class="ident" id="6338073">i</span>&nbsp;<span class="op" id="6338075">:=</span>&nbsp;<span class="num" id="6338078">0</span><span class="op" id="6338079">;</span>&nbsp;<span class="ident" id="6338081">i</span>&nbsp;<span class="op" id="6338083">&lt;</span>&nbsp;<span class="ident" id="6338085">d</span><span class="op" id="6338086">.</span><span class="ident" id="6338087">nbuf</span><span class="op" id="6338091">;</span>&nbsp;<span class="ident" id="6338093">i</span><span class="op" id="6338094">++</span>&nbsp;<span class="op" id="6338097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338104">if</span>&nbsp;<span class="ident" id="6338107">d</span><span class="op" id="6338108">.</span><span class="ident" id="6338109">buf</span><span class="op" id="6338112">[</span><span class="ident" id="6338113">i</span><span class="op" id="6338114">]</span>&nbsp;<span class="op" id="6338116">&gt;</span>&nbsp;<span class="string" id="6338118">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="6338122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338130">d</span><span class="op" id="6338131">.</span><span class="ident" id="6338132">buf</span><span class="op" id="6338135">[</span><span class="ident" id="6338136">off</span><span class="op" id="6338139">]</span>&nbsp;<span class="op" id="6338141">=</span>&nbsp;<span class="ident" id="6338143">d</span><span class="op" id="6338144">.</span><span class="ident" id="6338145">buf</span><span class="op" id="6338148">[</span><span class="ident" id="6338149">i</span><span class="op" id="6338150">]</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338158">off</span><span class="op" id="6338161">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338175">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338181">d</span><span class="op" id="6338182">.</span><span class="ident" id="6338183">nbuf</span>&nbsp;<span class="op" id="6338188">=</span>&nbsp;<span class="ident" id="6338190">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338197">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338206">//&nbsp;Out&nbsp;of&nbsp;input,&nbsp;out&nbsp;of&nbsp;decoded&nbsp;output.&nbsp;&nbsp;Check&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338263">if</span>&nbsp;<span class="ident" id="6338266">d</span><span class="op" id="6338267">.</span><span class="ident" id="6338268">err</span>&nbsp;<span class="op" id="6338272">!=</span>&nbsp;<span class="ident" id="6338275">nil</span>&nbsp;<span class="op" id="6338279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338284">return</span>&nbsp;<span class="num" id="6338291">0</span><span class="op" id="6338292">,</span>&nbsp;<span class="ident" id="6338294">d</span><span class="op" id="6338295">.</span><span class="ident" id="6338296">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338306">if</span>&nbsp;<span class="ident" id="6338309">d</span><span class="op" id="6338310">.</span><span class="ident" id="6338311">readErr</span>&nbsp;<span class="op" id="6338319">!=</span>&nbsp;<span class="ident" id="6338322">nil</span>&nbsp;<span class="op" id="6338326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338331">d</span><span class="op" id="6338332">.</span><span class="ident" id="6338333">err</span>&nbsp;<span class="op" id="6338337">=</span>&nbsp;<span class="ident" id="6338339">d</span><span class="op" id="6338340">.</span><span class="ident" id="6338341">readErr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338352">return</span>&nbsp;<span class="num" id="6338359">0</span><span class="op" id="6338360">,</span>&nbsp;<span class="ident" id="6338362">d</span><span class="op" id="6338363">.</span><span class="ident" id="6338364">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338370">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6338375">//&nbsp;Read&nbsp;more&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338396">nn</span><span class="op" id="6338398">,</span>&nbsp;<span class="ident" id="6338400">d</span><span class="op" id="6338401">.</span><span class="ident" id="6338402">readErr</span>&nbsp;<span class="op" id="6338410">=</span>&nbsp;<span class="ident" id="6338412">d</span><span class="op" id="6338413">.</span><span class="ident" id="6338414">r</span><span class="op" id="6338415">.</span><span class="ident" id="6338416">Read</span><span class="op" id="6338420">(</span><span class="ident" id="6338421">d</span><span class="op" id="6338422">.</span><span class="ident" id="6338423">buf</span><span class="op" id="6338426">[</span><span class="ident" id="6338427">d</span><span class="op" id="6338428">.</span><span class="ident" id="6338429">nbuf</span><span class="op" id="6338433">:</span><span class="op" id="6338434">]</span><span class="op" id="6338435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338439">d</span><span class="op" id="6338440">.</span><span class="ident" id="6338441">nbuf</span>&nbsp;<span class="op" id="6338446">+=</span>&nbsp;<span class="ident" id="6338449">nn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338453">}</span><br>
<span class="lineno">310</span><span class="op" id="6338455">}</span>
</div>
</body>
</html>
