<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html" class="current">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3595689">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3595744">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3595798">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3595849">//&nbsp;OFB&nbsp;(Output&nbsp;Feedback)&nbsp;Mode.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3595881">package</span>&nbsp;<span class="ident" id="3595889">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3595897">type</span>&nbsp;<span class="ident" id="3595902">ofb</span>&nbsp;<span class="keyword" id="3595906">struct</span>&nbsp;<span class="op" id="3595913">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595916">b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595924">Block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595931">cipher</span>&nbsp;&nbsp;<span class="op" id="3595939">[</span><span class="op" id="3595940">]</span><span class="builtintype" id="3595941">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595947">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3595955">[</span><span class="op" id="3595956">]</span><span class="builtintype" id="3595957">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3595963">outUsed</span>&nbsp;<span class="builtintype" id="3595971">int</span><br>
<span class="lineno"></span><span class="op" id="3595975">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="3595978">//&nbsp;NewOFB&nbsp;returns&nbsp;a&nbsp;Stream&nbsp;that&nbsp;encrypts&nbsp;or&nbsp;decrypts&nbsp;using&nbsp;the&nbsp;block&nbsp;cipher&nbsp;b</span><br>
<span class="lineno"></span><span class="comment" id="3596056">//&nbsp;in&nbsp;output&nbsp;feedback&nbsp;mode.&nbsp;The&nbsp;initialization&nbsp;vector&nbsp;iv&#39;s&nbsp;length&nbsp;must&nbsp;be&nbsp;equal</span><br>
<span class="lineno"></span><span class="comment" id="3596136">//&nbsp;to&nbsp;b&#39;s&nbsp;block&nbsp;size.</span><br>
<span class="lineno"></span><span class="keyword" id="3596158">func</span>&nbsp;<span class="ident" id="3596163">NewOFB</span><span class="op" id="3596169">(</span><span class="ident" id="3596170">b</span>&nbsp;<span class="ident" id="3596172">Block</span><span class="op" id="3596177">,</span>&nbsp;<span class="ident" id="3596179">iv</span>&nbsp;<span class="op" id="3596182">[</span><span class="op" id="3596183">]</span><span class="builtintype" id="3596184">byte</span><span class="op" id="3596188">)</span>&nbsp;<span class="ident" id="3596190">Stream</span>&nbsp;<span class="op" id="3596197">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596200">blockSize</span>&nbsp;<span class="op" id="3596210">:=</span>&nbsp;<span class="ident" id="3596213">b</span><span class="op" id="3596214">.</span><span class="ident" id="3596215">BlockSize</span><span class="op" id="3596224">(</span><span class="op" id="3596225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596228">if</span>&nbsp;<span class="builtinfunc" id="3596231">len</span><span class="op" id="3596234">(</span><span class="ident" id="3596235">iv</span><span class="op" id="3596237">)</span>&nbsp;<span class="op" id="3596239">!=</span>&nbsp;<span class="ident" id="3596242">blockSize</span>&nbsp;<span class="op" id="3596252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596256">return</span>&nbsp;<span class="builtintype" id="3596263">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596271">bufSize</span>&nbsp;<span class="op" id="3596279">:=</span>&nbsp;<span class="ident" id="3596282">streamBufferSize</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596300">if</span>&nbsp;<span class="ident" id="3596303">bufSize</span>&nbsp;<span class="op" id="3596311">&lt;</span>&nbsp;<span class="ident" id="3596313">blockSize</span>&nbsp;<span class="op" id="3596323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596327">bufSize</span>&nbsp;<span class="op" id="3596335">=</span>&nbsp;<span class="ident" id="3596337">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596348">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596351">x</span>&nbsp;<span class="op" id="3596353">:=</span>&nbsp;<span class="op" id="3596356">&amp;</span><span class="ident" id="3596357">ofb</span><span class="op" id="3596360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596364">b</span><span class="op" id="3596365">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596373">b</span><span class="op" id="3596374">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596378">cipher</span><span class="op" id="3596384">:</span>&nbsp;&nbsp;<span class="builtinfunc" id="3596387">make</span><span class="op" id="3596391">(</span><span class="op" id="3596392">[</span><span class="op" id="3596393">]</span><span class="builtintype" id="3596394">byte</span><span class="op" id="3596398">,</span>&nbsp;<span class="ident" id="3596400">blockSize</span><span class="op" id="3596409">)</span><span class="op" id="3596410">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596414">out</span><span class="op" id="3596417">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3596423">make</span><span class="op" id="3596427">(</span><span class="op" id="3596428">[</span><span class="op" id="3596429">]</span><span class="builtintype" id="3596430">byte</span><span class="op" id="3596434">,</span>&nbsp;<span class="num" id="3596436">0</span><span class="op" id="3596437">,</span>&nbsp;<span class="ident" id="3596439">bufSize</span><span class="op" id="3596446">)</span><span class="op" id="3596447">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596451">outUsed</span><span class="op" id="3596458">:</span>&nbsp;<span class="num" id="3596460">0</span><span class="op" id="3596461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3596468">copy</span><span class="op" id="3596472">(</span><span class="ident" id="3596473">x</span><span class="op" id="3596474">.</span><span class="ident" id="3596475">cipher</span><span class="op" id="3596481">,</span>&nbsp;<span class="ident" id="3596483">iv</span><span class="op" id="3596485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596488">return</span>&nbsp;<span class="ident" id="3596495">x</span><br>
<span class="lineno"></span><span class="op" id="3596497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3596500">func</span>&nbsp;<span class="op" id="3596505">(</span><span class="ident" id="3596506">x</span>&nbsp;<span class="op" id="3596508">*</span><span class="ident" id="3596509">ofb</span><span class="op" id="3596512">)</span>&nbsp;<span class="ident" id="3596514">refill</span><span class="op" id="3596520">(</span><span class="op" id="3596521">)</span>&nbsp;<span class="op" id="3596523">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596526">bs</span>&nbsp;<span class="op" id="3596529">:=</span>&nbsp;<span class="ident" id="3596532">x</span><span class="op" id="3596533">.</span><span class="ident" id="3596534">b</span><span class="op" id="3596535">.</span><span class="ident" id="3596536">BlockSize</span><span class="op" id="3596545">(</span><span class="op" id="3596546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596549">remain</span>&nbsp;<span class="op" id="3596556">:=</span>&nbsp;<span class="builtinfunc" id="3596559">len</span><span class="op" id="3596562">(</span><span class="ident" id="3596563">x</span><span class="op" id="3596564">.</span><span class="ident" id="3596565">out</span><span class="op" id="3596568">)</span>&nbsp;<span class="op" id="3596570">-</span>&nbsp;<span class="ident" id="3596572">x</span><span class="op" id="3596573">.</span><span class="ident" id="3596574">outUsed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596583">if</span>&nbsp;<span class="ident" id="3596586">remain</span>&nbsp;<span class="op" id="3596593">&gt;</span>&nbsp;<span class="ident" id="3596595">x</span><span class="op" id="3596596">.</span><span class="ident" id="3596597">outUsed</span>&nbsp;<span class="op" id="3596605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596609">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596617">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3596620">copy</span><span class="op" id="3596624">(</span><span class="ident" id="3596625">x</span><span class="op" id="3596626">.</span><span class="ident" id="3596627">out</span><span class="op" id="3596630">,</span>&nbsp;<span class="ident" id="3596632">x</span><span class="op" id="3596633">.</span><span class="ident" id="3596634">out</span><span class="op" id="3596637">[</span><span class="ident" id="3596638">x</span><span class="op" id="3596639">.</span><span class="ident" id="3596640">outUsed</span><span class="op" id="3596647">:</span><span class="op" id="3596648">]</span><span class="op" id="3596649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596652">x</span><span class="op" id="3596653">.</span><span class="ident" id="3596654">out</span>&nbsp;<span class="op" id="3596658">=</span>&nbsp;<span class="ident" id="3596660">x</span><span class="op" id="3596661">.</span><span class="ident" id="3596662">out</span><span class="op" id="3596665">[</span><span class="op" id="3596666">:</span><span class="builtinfunc" id="3596667">cap</span><span class="op" id="3596670">(</span><span class="ident" id="3596671">x</span><span class="op" id="3596672">.</span><span class="ident" id="3596673">out</span><span class="op" id="3596676">)</span><span class="op" id="3596677">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596680">for</span>&nbsp;<span class="ident" id="3596684">remain</span>&nbsp;<span class="op" id="3596691">&lt;</span>&nbsp;<span class="builtinfunc" id="3596693">len</span><span class="op" id="3596696">(</span><span class="ident" id="3596697">x</span><span class="op" id="3596698">.</span><span class="ident" id="3596699">out</span><span class="op" id="3596702">)</span><span class="op" id="3596703">-</span><span class="ident" id="3596704">bs</span>&nbsp;<span class="op" id="3596707">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596711">x</span><span class="op" id="3596712">.</span><span class="ident" id="3596713">b</span><span class="op" id="3596714">.</span><span class="ident" id="3596715">Encrypt</span><span class="op" id="3596722">(</span><span class="ident" id="3596723">x</span><span class="op" id="3596724">.</span><span class="ident" id="3596725">cipher</span><span class="op" id="3596731">,</span>&nbsp;<span class="ident" id="3596733">x</span><span class="op" id="3596734">.</span><span class="ident" id="3596735">cipher</span><span class="op" id="3596741">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3596745">copy</span><span class="op" id="3596749">(</span><span class="ident" id="3596750">x</span><span class="op" id="3596751">.</span><span class="ident" id="3596752">out</span><span class="op" id="3596755">[</span><span class="ident" id="3596756">remain</span><span class="op" id="3596762">:</span><span class="op" id="3596763">]</span><span class="op" id="3596764">,</span>&nbsp;<span class="ident" id="3596766">x</span><span class="op" id="3596767">.</span><span class="ident" id="3596768">cipher</span><span class="op" id="3596774">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596778">remain</span>&nbsp;<span class="op" id="3596785">+=</span>&nbsp;<span class="ident" id="3596788">bs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596792">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596795">x</span><span class="op" id="3596796">.</span><span class="ident" id="3596797">out</span>&nbsp;<span class="op" id="3596801">=</span>&nbsp;<span class="ident" id="3596803">x</span><span class="op" id="3596804">.</span><span class="ident" id="3596805">out</span><span class="op" id="3596808">[</span><span class="op" id="3596809">:</span><span class="ident" id="3596810">remain</span><span class="op" id="3596816">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596819">x</span><span class="op" id="3596820">.</span><span class="ident" id="3596821">outUsed</span>&nbsp;<span class="op" id="3596829">=</span>&nbsp;<span class="num" id="3596831">0</span><br>
<span class="lineno"></span><span class="op" id="3596833">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="3596836">func</span>&nbsp;<span class="op" id="3596841">(</span><span class="ident" id="3596842">x</span>&nbsp;<span class="op" id="3596844">*</span><span class="ident" id="3596845">ofb</span><span class="op" id="3596848">)</span>&nbsp;<span class="ident" id="3596850">XORKeyStream</span><span class="op" id="3596862">(</span><span class="ident" id="3596863">dst</span><span class="op" id="3596866">,</span>&nbsp;<span class="ident" id="3596868">src</span>&nbsp;<span class="op" id="3596872">[</span><span class="op" id="3596873">]</span><span class="builtintype" id="3596874">byte</span><span class="op" id="3596878">)</span>&nbsp;<span class="op" id="3596880">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596883">for</span>&nbsp;<span class="builtinfunc" id="3596887">len</span><span class="op" id="3596890">(</span><span class="ident" id="3596891">src</span><span class="op" id="3596894">)</span>&nbsp;<span class="op" id="3596896">&gt;</span>&nbsp;<span class="num" id="3596898">0</span>&nbsp;<span class="op" id="3596900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3596904">if</span>&nbsp;<span class="ident" id="3596907">x</span><span class="op" id="3596908">.</span><span class="ident" id="3596909">outUsed</span>&nbsp;<span class="op" id="3596917">&gt;=</span>&nbsp;<span class="builtinfunc" id="3596920">len</span><span class="op" id="3596923">(</span><span class="ident" id="3596924">x</span><span class="op" id="3596925">.</span><span class="ident" id="3596926">out</span><span class="op" id="3596929">)</span><span class="op" id="3596930">-</span><span class="ident" id="3596931">x</span><span class="op" id="3596932">.</span><span class="ident" id="3596933">b</span><span class="op" id="3596934">.</span><span class="ident" id="3596935">BlockSize</span><span class="op" id="3596944">(</span><span class="op" id="3596945">)</span>&nbsp;<span class="op" id="3596947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596952">x</span><span class="op" id="3596953">.</span><span class="ident" id="3596954">refill</span><span class="op" id="3596960">(</span><span class="op" id="3596961">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3596965">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3596969">n</span>&nbsp;<span class="op" id="3596971">:=</span>&nbsp;<span class="ident" id="3596974">xorBytes</span><span class="op" id="3596982">(</span><span class="ident" id="3596983">dst</span><span class="op" id="3596986">,</span>&nbsp;<span class="ident" id="3596988">src</span><span class="op" id="3596991">,</span>&nbsp;<span class="ident" id="3596993">x</span><span class="op" id="3596994">.</span><span class="ident" id="3596995">out</span><span class="op" id="3596998">[</span><span class="ident" id="3596999">x</span><span class="op" id="3597000">.</span><span class="ident" id="3597001">outUsed</span><span class="op" id="3597008">:</span><span class="op" id="3597009">]</span><span class="op" id="3597010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597014">dst</span>&nbsp;<span class="op" id="3597018">=</span>&nbsp;<span class="ident" id="3597020">dst</span><span class="op" id="3597023">[</span><span class="ident" id="3597024">n</span><span class="op" id="3597025">:</span><span class="op" id="3597026">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597030">src</span>&nbsp;<span class="op" id="3597034">=</span>&nbsp;<span class="ident" id="3597036">src</span><span class="op" id="3597039">[</span><span class="ident" id="3597040">n</span><span class="op" id="3597041">:</span><span class="op" id="3597042">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3597046">x</span><span class="op" id="3597047">.</span><span class="ident" id="3597048">outUsed</span>&nbsp;<span class="op" id="3597056">+=</span>&nbsp;<span class="ident" id="3597059">n</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3597062">}</span><br>
<span class="lineno"></span><span class="op" id="3597064">}</span>
</div>
</body>
</html>
