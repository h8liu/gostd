<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/pprof</h2>
<ul>
<li><a href="/gostd/net/http/pprof/pprof.go.html">pprof.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5153069">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5153125">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5153179">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5153230">//&nbsp;Package&nbsp;pprof&nbsp;serves&nbsp;via&nbsp;its&nbsp;HTTP&nbsp;server&nbsp;runtime&nbsp;profiling&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5153297">//&nbsp;in&nbsp;the&nbsp;format&nbsp;expected&nbsp;by&nbsp;the&nbsp;pprof&nbsp;visualization&nbsp;tool.</span><br>
<span class="lineno"></span><span class="comment" id="5153356">//&nbsp;For&nbsp;more&nbsp;information&nbsp;about&nbsp;pprof,&nbsp;see</span><br>
<span class="lineno"></span><span class="comment" id="5153397">//&nbsp;http://code.google.com/p/google-perftools/.</span><br>
<span class="lineno"></span><span class="comment" id="5153444">//</span><br>
<span class="lineno">10</span><span class="comment" id="5153447">//&nbsp;The&nbsp;package&nbsp;is&nbsp;typically&nbsp;only&nbsp;imported&nbsp;for&nbsp;the&nbsp;side&nbsp;effect&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="5153512">//&nbsp;registering&nbsp;its&nbsp;HTTP&nbsp;handlers.</span><br>
<span class="lineno"></span><span class="comment" id="5153546">//&nbsp;The&nbsp;handled&nbsp;paths&nbsp;all&nbsp;begin&nbsp;with&nbsp;/debug/pprof/.</span><br>
<span class="lineno"></span><span class="comment" id="5153597">//</span><br>
<span class="lineno"></span><span class="comment" id="5153600">//&nbsp;To&nbsp;use&nbsp;pprof,&nbsp;link&nbsp;this&nbsp;package&nbsp;into&nbsp;your&nbsp;program:</span><br>
<span class="lineno">15</span><span class="comment" id="5153654">//&nbsp;&nbsp;&nbsp;&nbspimport&nbsp;_&nbsp;&#34;net/http/pprof&#34;</span><br>
<span class="lineno"></span><span class="comment" id="5153683">//</span><br>
<span class="lineno"></span><span class="comment" id="5153686">//&nbsp;If&nbsp;your&nbsp;application&nbsp;is&nbsp;not&nbsp;already&nbsp;running&nbsp;an&nbsp;http&nbsp;server,&nbsp;you</span><br>
<span class="lineno"></span><span class="comment" id="5153752">//&nbsp;need&nbsp;to&nbsp;start&nbsp;one.&nbsp;&nbsp;Add&nbsp;&#34;net/http&#34;&nbsp;and&nbsp;&#34;log&#34;&nbsp;to&nbsp;your&nbsp;imports&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5153820">//&nbsp;the&nbsp;following&nbsp;code&nbsp;to&nbsp;your&nbsp;main&nbsp;function:</span><br>
<span class="lineno">20</span><span class="comment" id="5153865">//</span><br>
<span class="lineno"></span><span class="comment" id="5153868">//&nbsp;&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="5153884">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsplog.Println(http.ListenAndServe(&#34;localhost:6060&#34;,&nbsp;nil))</span><br>
<span class="lineno"></span><span class="comment" id="5153945">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp}()</span><br>
<span class="lineno"></span><span class="comment" id="5153953">//</span><br>
<span class="lineno">25</span><span class="comment" id="5153956">//&nbsp;Then&nbsp;use&nbsp;the&nbsp;pprof&nbsp;tool&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;heap&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5154012">//</span><br>
<span class="lineno"></span><span class="comment" id="5154015">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/heap</span><br>
<span class="lineno"></span><span class="comment" id="5154071">//</span><br>
<span class="lineno"></span><span class="comment" id="5154074">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;a&nbsp;30-second&nbsp;CPU&nbsp;profile:</span><br>
<span class="lineno">30</span><span class="comment" id="5154116">//</span><br>
<span class="lineno"></span><span class="comment" id="5154119">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/profile</span><br>
<span class="lineno"></span><span class="comment" id="5154178">//</span><br>
<span class="lineno"></span><span class="comment" id="5154181">//&nbsp;Or&nbsp;to&nbsp;look&nbsp;at&nbsp;the&nbsp;goroutine&nbsp;blocking&nbsp;profile:</span><br>
<span class="lineno"></span><span class="comment" id="5154230">//</span><br>
<span class="lineno">35</span><span class="comment" id="5154233">//&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;tool&nbsp;pprof&nbsp;http://localhost:6060/debug/pprof/block</span><br>
<span class="lineno"></span><span class="comment" id="5154290">//</span><br>
<span class="lineno"></span><span class="comment" id="5154293">//&nbsp;To&nbsp;view&nbsp;all&nbsp;available&nbsp;profiles,&nbsp;open&nbsp;http://localhost:6060/debug/pprof/</span><br>
<span class="lineno"></span><span class="comment" id="5154368">//&nbsp;in&nbsp;your&nbsp;browser.</span><br>
<span class="lineno"></span><span class="comment" id="5154388">//</span><br>
<span class="lineno">40</span><span class="comment" id="5154391">//&nbsp;For&nbsp;a&nbsp;study&nbsp;of&nbsp;the&nbsp;facility&nbsp;in&nbsp;action,&nbsp;visit</span><br>
<span class="lineno"></span><span class="comment" id="5154439">//</span><br>
<span class="lineno"></span><span class="comment" id="5154442">//&nbsp;&nbsp;&nbsp;&nbsphttp://blog.golang.org/2011/06/profiling-go-programs.html</span><br>
<span class="lineno"></span><span class="comment" id="5154503">//</span><br>
<span class="lineno"></span><span class="keyword" id="5154506">package</span>&nbsp;<span class="ident" id="5154514">pprof</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="5154521">import</span>&nbsp;<span class="op" id="5154528">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154531">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154540">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154549">&#34;fmt&#34;</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154556">&#34;html/template&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154573">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154579">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154586">&#34;net/http&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154598">&#34;os&#34;</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154604">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154615">&#34;runtime/pprof&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154632">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154643">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5154654">&#34;time&#34;</span><br>
<span class="lineno">60</span><span class="op" id="5154661">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5154664">func</span>&nbsp;<span class="ident" id="5154669">init</span><span class="op" id="5154673">(</span><span class="op" id="5154674">)</span>&nbsp;<span class="op" id="5154676">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5154679">http</span><span class="op" id="5154683">.</span><span class="ident" id="5154684">Handle</span><span class="op" id="5154690">(</span><span class="string" id="5154691">&#34;/debug/pprof/&#34;</span><span class="op" id="5154706">,</span>&nbsp;<span class="ident" id="5154708">http</span><span class="op" id="5154712">.</span><span class="ident" id="5154713">HandlerFunc</span><span class="op" id="5154724">(</span><span class="ident" id="5154725">Index</span><span class="op" id="5154730">)</span><span class="op" id="5154731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5154734">http</span><span class="op" id="5154738">.</span><span class="ident" id="5154739">Handle</span><span class="op" id="5154745">(</span><span class="string" id="5154746">&#34;/debug/pprof/cmdline&#34;</span><span class="op" id="5154768">,</span>&nbsp;<span class="ident" id="5154770">http</span><span class="op" id="5154774">.</span><span class="ident" id="5154775">HandlerFunc</span><span class="op" id="5154786">(</span><span class="ident" id="5154787">Cmdline</span><span class="op" id="5154794">)</span><span class="op" id="5154795">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5154798">http</span><span class="op" id="5154802">.</span><span class="ident" id="5154803">Handle</span><span class="op" id="5154809">(</span><span class="string" id="5154810">&#34;/debug/pprof/profile&#34;</span><span class="op" id="5154832">,</span>&nbsp;<span class="ident" id="5154834">http</span><span class="op" id="5154838">.</span><span class="ident" id="5154839">HandlerFunc</span><span class="op" id="5154850">(</span><span class="ident" id="5154851">Profile</span><span class="op" id="5154858">)</span><span class="op" id="5154859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5154862">http</span><span class="op" id="5154866">.</span><span class="ident" id="5154867">Handle</span><span class="op" id="5154873">(</span><span class="string" id="5154874">&#34;/debug/pprof/symbol&#34;</span><span class="op" id="5154895">,</span>&nbsp;<span class="ident" id="5154897">http</span><span class="op" id="5154901">.</span><span class="ident" id="5154902">HandlerFunc</span><span class="op" id="5154913">(</span><span class="ident" id="5154914">Symbol</span><span class="op" id="5154920">)</span><span class="op" id="5154921">)</span><br>
<span class="lineno"></span><span class="op" id="5154923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5154926">//&nbsp;Cmdline&nbsp;responds&nbsp;with&nbsp;the&nbsp;running&nbsp;program&#39;s</span><br>
<span class="lineno">70</span><span class="comment" id="5154973">//&nbsp;command&nbsp;line,&nbsp;with&nbsp;arguments&nbsp;separated&nbsp;by&nbsp;NUL&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="5155029">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/cmdline.</span><br>
<span class="lineno"></span><span class="keyword" id="5155097">func</span>&nbsp;<span class="ident" id="5155102">Cmdline</span><span class="op" id="5155109">(</span><span class="ident" id="5155110">w</span>&nbsp;<span class="ident" id="5155112">http</span><span class="op" id="5155116">.</span><span class="ident" id="5155117">ResponseWriter</span><span class="op" id="5155131">,</span>&nbsp;<span class="ident" id="5155133">r</span>&nbsp;<span class="op" id="5155135">*</span><span class="ident" id="5155136">http</span><span class="op" id="5155140">.</span><span class="ident" id="5155141">Request</span><span class="op" id="5155148">)</span>&nbsp;<span class="op" id="5155150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155153">w</span><span class="op" id="5155154">.</span><span class="ident" id="5155155">Header</span><span class="op" id="5155161">(</span><span class="op" id="5155162">)</span><span class="op" id="5155163">.</span><span class="ident" id="5155164">Set</span><span class="op" id="5155167">(</span><span class="string" id="5155168">&#34;Content-Type&#34;</span><span class="op" id="5155182">,</span>&nbsp;<span class="string" id="5155184">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5155211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155214">fmt</span><span class="op" id="5155217">.</span><span class="ident" id="5155218">Fprintf</span><span class="op" id="5155225">(</span><span class="ident" id="5155226">w</span><span class="op" id="5155227">,</span>&nbsp;<span class="ident" id="5155229">strings</span><span class="op" id="5155236">.</span><span class="ident" id="5155237">Join</span><span class="op" id="5155241">(</span><span class="ident" id="5155242">os</span><span class="op" id="5155244">.</span><span class="ident" id="5155245">Args</span><span class="op" id="5155249">,</span>&nbsp;<span class="string" id="5155251">&#34;\x00&#34;</span><span class="op" id="5155257">)</span><span class="op" id="5155258">)</span><br>
<span class="lineno">75</span><span class="op" id="5155260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5155263">//&nbsp;Profile&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;cpu&nbsp;profile.</span><br>
<span class="lineno"></span><span class="comment" id="5155321">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/profile.</span><br>
<span class="lineno"></span><span class="keyword" id="5155389">func</span>&nbsp;<span class="ident" id="5155394">Profile</span><span class="op" id="5155401">(</span><span class="ident" id="5155402">w</span>&nbsp;<span class="ident" id="5155404">http</span><span class="op" id="5155408">.</span><span class="ident" id="5155409">ResponseWriter</span><span class="op" id="5155423">,</span>&nbsp;<span class="ident" id="5155425">r</span>&nbsp;<span class="op" id="5155427">*</span><span class="ident" id="5155428">http</span><span class="op" id="5155432">.</span><span class="ident" id="5155433">Request</span><span class="op" id="5155440">)</span>&nbsp;<span class="op" id="5155442">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155445">sec</span><span class="op" id="5155448">,</span>&nbsp;<span class="ident" id="5155450">_</span>&nbsp;<span class="op" id="5155452">:=</span>&nbsp;<span class="ident" id="5155455">strconv</span><span class="op" id="5155462">.</span><span class="ident" id="5155463">ParseInt</span><span class="op" id="5155471">(</span><span class="ident" id="5155472">r</span><span class="op" id="5155473">.</span><span class="ident" id="5155474">FormValue</span><span class="op" id="5155483">(</span><span class="string" id="5155484">&#34;seconds&#34;</span><span class="op" id="5155493">)</span><span class="op" id="5155494">,</span>&nbsp;<span class="num" id="5155496">10</span><span class="op" id="5155498">,</span>&nbsp;<span class="num" id="5155500">64</span><span class="op" id="5155502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5155505">if</span>&nbsp;<span class="ident" id="5155508">sec</span>&nbsp;<span class="op" id="5155512">==</span>&nbsp;<span class="num" id="5155515">0</span>&nbsp;<span class="op" id="5155517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155521">sec</span>&nbsp;<span class="op" id="5155525">=</span>&nbsp;<span class="num" id="5155527">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5155531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5155535">//&nbsp;Set&nbsp;Content&nbsp;Type&nbsp;assuming&nbsp;StartCPUProfile&nbsp;will&nbsp;work,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5155592">//&nbsp;because&nbsp;if&nbsp;it&nbsp;does&nbsp;it&nbsp;starts&nbsp;writing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155634">w</span><span class="op" id="5155635">.</span><span class="ident" id="5155636">Header</span><span class="op" id="5155642">(</span><span class="op" id="5155643">)</span><span class="op" id="5155644">.</span><span class="ident" id="5155645">Set</span><span class="op" id="5155648">(</span><span class="string" id="5155649">&#34;Content-Type&#34;</span><span class="op" id="5155663">,</span>&nbsp;<span class="string" id="5155665">&#34;application/octet-stream&#34;</span><span class="op" id="5155691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5155694">if</span>&nbsp;<span class="ident" id="5155697">err</span>&nbsp;<span class="op" id="5155701">:=</span>&nbsp;<span class="ident" id="5155704">pprof</span><span class="op" id="5155709">.</span><span class="ident" id="5155710">StartCPUProfile</span><span class="op" id="5155725">(</span><span class="ident" id="5155726">w</span><span class="op" id="5155727">)</span><span class="op" id="5155728">;</span>&nbsp;<span class="ident" id="5155730">err</span>&nbsp;<span class="op" id="5155734">!=</span>&nbsp;<span class="ident" id="5155737">nil</span>&nbsp;<span class="op" id="5155741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5155745">//&nbsp;StartCPUProfile&nbsp;failed,&nbsp;so&nbsp;no&nbsp;writes&nbsp;yet.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5155792">//&nbsp;Can&nbsp;change&nbsp;header&nbsp;back&nbsp;to&nbsp;text&nbsp;content</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5155836">//&nbsp;and&nbsp;send&nbsp;error&nbsp;code.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155862">w</span><span class="op" id="5155863">.</span><span class="ident" id="5155864">Header</span><span class="op" id="5155870">(</span><span class="op" id="5155871">)</span><span class="op" id="5155872">.</span><span class="ident" id="5155873">Set</span><span class="op" id="5155876">(</span><span class="string" id="5155877">&#34;Content-Type&#34;</span><span class="op" id="5155891">,</span>&nbsp;<span class="string" id="5155893">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5155920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155924">w</span><span class="op" id="5155925">.</span><span class="ident" id="5155926">WriteHeader</span><span class="op" id="5155937">(</span><span class="ident" id="5155938">http</span><span class="op" id="5155942">.</span><span class="ident" id="5155943">StatusInternalServerError</span><span class="op" id="5155968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5155972">fmt</span><span class="op" id="5155975">.</span><span class="ident" id="5155976">Fprintf</span><span class="op" id="5155983">(</span><span class="ident" id="5155984">w</span><span class="op" id="5155985">,</span>&nbsp;<span class="string" id="5155987">&#34;Could&nbsp;not&nbsp;enable&nbsp;CPU&nbsp;profiling:&nbsp;%s\n&#34;</span><span class="op" id="5156025">,</span>&nbsp;<span class="ident" id="5156027">err</span><span class="op" id="5156030">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156034">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156045">time</span><span class="op" id="5156049">.</span><span class="ident" id="5156050">Sleep</span><span class="op" id="5156055">(</span><span class="ident" id="5156056">time</span><span class="op" id="5156060">.</span><span class="ident" id="5156061">Duration</span><span class="op" id="5156069">(</span><span class="ident" id="5156070">sec</span><span class="op" id="5156073">)</span>&nbsp;<span class="op" id="5156075">*</span>&nbsp;<span class="ident" id="5156077">time</span><span class="op" id="5156081">.</span><span class="ident" id="5156082">Second</span><span class="op" id="5156088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156091">pprof</span><span class="op" id="5156096">.</span><span class="ident" id="5156097">StopCPUProfile</span><span class="op" id="5156111">(</span><span class="op" id="5156112">)</span><br>
<span class="lineno"></span><span class="op" id="5156114">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5156117">//&nbsp;Symbol&nbsp;looks&nbsp;up&nbsp;the&nbsp;program&nbsp;counters&nbsp;listed&nbsp;in&nbsp;the&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="5156180">//&nbsp;responding&nbsp;with&nbsp;a&nbsp;table&nbsp;mapping&nbsp;program&nbsp;counters&nbsp;to&nbsp;function&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="5156251">//&nbsp;The&nbsp;package&nbsp;initialization&nbsp;registers&nbsp;it&nbsp;as&nbsp;/debug/pprof/symbol.</span><br>
<span class="lineno"></span><span class="keyword" id="5156318">func</span>&nbsp;<span class="ident" id="5156323">Symbol</span><span class="op" id="5156329">(</span><span class="ident" id="5156330">w</span>&nbsp;<span class="ident" id="5156332">http</span><span class="op" id="5156336">.</span><span class="ident" id="5156337">ResponseWriter</span><span class="op" id="5156351">,</span>&nbsp;<span class="ident" id="5156353">r</span>&nbsp;<span class="op" id="5156355">*</span><span class="ident" id="5156356">http</span><span class="op" id="5156360">.</span><span class="ident" id="5156361">Request</span><span class="op" id="5156368">)</span>&nbsp;<span class="op" id="5156370">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156373">w</span><span class="op" id="5156374">.</span><span class="ident" id="5156375">Header</span><span class="op" id="5156381">(</span><span class="op" id="5156382">)</span><span class="op" id="5156383">.</span><span class="ident" id="5156384">Set</span><span class="op" id="5156387">(</span><span class="string" id="5156388">&#34;Content-Type&#34;</span><span class="op" id="5156402">,</span>&nbsp;<span class="string" id="5156404">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5156431">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156435">//&nbsp;We&nbsp;have&nbsp;to&nbsp;read&nbsp;the&nbsp;whole&nbsp;POST&nbsp;body&nbsp;before</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156482">//&nbsp;writing&nbsp;any&nbsp;output.&nbsp;&nbsp;Buffer&nbsp;the&nbsp;output&nbsp;here.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156531">var</span>&nbsp;<span class="ident" id="5156535">buf</span>&nbsp;<span class="ident" id="5156539">bytes</span><span class="op" id="5156544">.</span><span class="ident" id="5156545">Buffer</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156554">//&nbsp;We&nbsp;don&#39;t&nbsp;know&nbsp;how&nbsp;many&nbsp;symbols&nbsp;we&nbsp;have,&nbsp;but&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156605">//&nbsp;do&nbsp;have&nbsp;symbol&nbsp;information.&nbsp;&nbsp;Pprof&nbsp;only&nbsp;cares&nbsp;whether</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5156663">//&nbsp;this&nbsp;number&nbsp;is&nbsp;0&nbsp;(no&nbsp;symbols&nbsp;available)&nbsp;or&nbsp;&gt;&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156715">fmt</span><span class="op" id="5156718">.</span><span class="ident" id="5156719">Fprintf</span><span class="op" id="5156726">(</span><span class="op" id="5156727">&amp;</span><span class="ident" id="5156728">buf</span><span class="op" id="5156731">,</span>&nbsp;<span class="string" id="5156733">&#34;num_symbols:&nbsp;1\n&#34;</span><span class="op" id="5156751">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156755">var</span>&nbsp;<span class="ident" id="5156759">b</span>&nbsp;<span class="op" id="5156761">*</span><span class="ident" id="5156762">bufio</span><span class="op" id="5156767">.</span><span class="ident" id="5156768">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156776">if</span>&nbsp;<span class="ident" id="5156779">r</span><span class="op" id="5156780">.</span><span class="ident" id="5156781">Method</span>&nbsp;<span class="op" id="5156788">==</span>&nbsp;<span class="string" id="5156791">&#34;POST&#34;</span>&nbsp;<span class="op" id="5156798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156802">b</span>&nbsp;<span class="op" id="5156804">=</span>&nbsp;<span class="ident" id="5156806">bufio</span><span class="op" id="5156811">.</span><span class="ident" id="5156812">NewReader</span><span class="op" id="5156821">(</span><span class="ident" id="5156822">r</span><span class="op" id="5156823">.</span><span class="ident" id="5156824">Body</span><span class="op" id="5156828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156831">}</span>&nbsp;<span class="keyword" id="5156833">else</span>&nbsp;<span class="op" id="5156838">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156842">b</span>&nbsp;<span class="op" id="5156844">=</span>&nbsp;<span class="ident" id="5156846">bufio</span><span class="op" id="5156851">.</span><span class="ident" id="5156852">NewReader</span><span class="op" id="5156861">(</span><span class="ident" id="5156862">strings</span><span class="op" id="5156869">.</span><span class="ident" id="5156870">NewReader</span><span class="op" id="5156879">(</span><span class="ident" id="5156880">r</span><span class="op" id="5156881">.</span><span class="ident" id="5156882">URL</span><span class="op" id="5156885">.</span><span class="ident" id="5156886">RawQuery</span><span class="op" id="5156894">)</span><span class="op" id="5156895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5156898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156902">for</span>&nbsp;<span class="op" id="5156906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156910">word</span><span class="op" id="5156914">,</span>&nbsp;<span class="ident" id="5156916">err</span>&nbsp;<span class="op" id="5156920">:=</span>&nbsp;<span class="ident" id="5156923">b</span><span class="op" id="5156924">.</span><span class="ident" id="5156925">ReadSlice</span><span class="op" id="5156934">(</span><span class="string" id="5156935">&#39;+&#39;</span><span class="op" id="5156938">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5156942">if</span>&nbsp;<span class="ident" id="5156945">err</span>&nbsp;<span class="op" id="5156949">==</span>&nbsp;<span class="ident" id="5156952">nil</span>&nbsp;<span class="op" id="5156956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5156961">word</span>&nbsp;<span class="op" id="5156966">=</span>&nbsp;<span class="ident" id="5156968">word</span><span class="op" id="5156972">[</span><span class="num" id="5156973">0</span>&nbsp;<span class="op" id="5156975">:</span>&nbsp;<span class="builtinfunc" id="5156977">len</span><span class="op" id="5156980">(</span><span class="ident" id="5156981">word</span><span class="op" id="5156985">)</span><span class="op" id="5156986">-</span><span class="num" id="5156987">1</span><span class="op" id="5156988">]</span>&nbsp;<span class="comment" id="5156990">//&nbsp;trim&nbsp;+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157006">pc</span><span class="op" id="5157008">,</span>&nbsp;<span class="ident" id="5157010">_</span>&nbsp;<span class="op" id="5157012">:=</span>&nbsp;<span class="ident" id="5157015">strconv</span><span class="op" id="5157022">.</span><span class="ident" id="5157023">ParseUint</span><span class="op" id="5157032">(</span><span class="builtintype" id="5157033">string</span><span class="op" id="5157039">(</span><span class="ident" id="5157040">word</span><span class="op" id="5157044">)</span><span class="op" id="5157045">,</span>&nbsp;<span class="num" id="5157047">0</span><span class="op" id="5157048">,</span>&nbsp;<span class="num" id="5157050">64</span><span class="op" id="5157052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157056">if</span>&nbsp;<span class="ident" id="5157059">pc</span>&nbsp;<span class="op" id="5157062">!=</span>&nbsp;<span class="num" id="5157065">0</span>&nbsp;<span class="op" id="5157067">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157072">f</span>&nbsp;<span class="op" id="5157074">:=</span>&nbsp;<span class="ident" id="5157077">runtime</span><span class="op" id="5157084">.</span><span class="ident" id="5157085">FuncForPC</span><span class="op" id="5157094">(</span><span class="builtintype" id="5157095">uintptr</span><span class="op" id="5157102">(</span><span class="ident" id="5157103">pc</span><span class="op" id="5157105">)</span><span class="op" id="5157106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157111">if</span>&nbsp;<span class="ident" id="5157114">f</span>&nbsp;<span class="op" id="5157116">!=</span>&nbsp;<span class="ident" id="5157119">nil</span>&nbsp;<span class="op" id="5157123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157129">fmt</span><span class="op" id="5157132">.</span><span class="ident" id="5157133">Fprintf</span><span class="op" id="5157140">(</span><span class="op" id="5157141">&amp;</span><span class="ident" id="5157142">buf</span><span class="op" id="5157145">,</span>&nbsp;<span class="string" id="5157147">&#34;%#x&nbsp;%s\n&#34;</span><span class="op" id="5157157">,</span>&nbsp;<span class="ident" id="5157159">pc</span><span class="op" id="5157161">,</span>&nbsp;<span class="ident" id="5157163">f</span><span class="op" id="5157164">.</span><span class="ident" id="5157165">Name</span><span class="op" id="5157169">(</span><span class="op" id="5157170">)</span><span class="op" id="5157171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157180">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5157185">//&nbsp;Wait&nbsp;until&nbsp;here&nbsp;to&nbsp;check&nbsp;for&nbsp;err;&nbsp;the&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5157233">//&nbsp;symbol&nbsp;will&nbsp;have&nbsp;an&nbsp;err&nbsp;because&nbsp;it&nbsp;doesn&#39;t&nbsp;end&nbsp;in&nbsp;+.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157291">if</span>&nbsp;<span class="ident" id="5157294">err</span>&nbsp;<span class="op" id="5157298">!=</span>&nbsp;<span class="ident" id="5157301">nil</span>&nbsp;<span class="op" id="5157305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157310">if</span>&nbsp;<span class="ident" id="5157313">err</span>&nbsp;<span class="op" id="5157317">!=</span>&nbsp;<span class="ident" id="5157320">io</span><span class="op" id="5157322">.</span><span class="ident" id="5157323">EOF</span>&nbsp;<span class="op" id="5157327">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157333">fmt</span><span class="op" id="5157336">.</span><span class="ident" id="5157337">Fprintf</span><span class="op" id="5157344">(</span><span class="op" id="5157345">&amp;</span><span class="ident" id="5157346">buf</span><span class="op" id="5157349">,</span>&nbsp;<span class="string" id="5157351">&#34;reading&nbsp;request:&nbsp;%v\n&#34;</span><span class="op" id="5157374">,</span>&nbsp;<span class="ident" id="5157376">err</span><span class="op" id="5157379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157389">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157400">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157404">w</span><span class="op" id="5157405">.</span><span class="ident" id="5157406">Write</span><span class="op" id="5157411">(</span><span class="ident" id="5157412">buf</span><span class="op" id="5157415">.</span><span class="ident" id="5157416">Bytes</span><span class="op" id="5157421">(</span><span class="op" id="5157422">)</span><span class="op" id="5157423">)</span><br>
<span class="lineno"></span><span class="op" id="5157425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5157428">//&nbsp;Handler&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;handler&nbsp;that&nbsp;serves&nbsp;the&nbsp;named&nbsp;profile.</span><br>
<span class="lineno">150</span><span class="keyword" id="5157494">func</span>&nbsp;<span class="ident" id="5157499">Handler</span><span class="op" id="5157506">(</span><span class="ident" id="5157507">name</span>&nbsp;<span class="builtintype" id="5157512">string</span><span class="op" id="5157518">)</span>&nbsp;<span class="ident" id="5157520">http</span><span class="op" id="5157524">.</span><span class="ident" id="5157525">Handler</span>&nbsp;<span class="op" id="5157533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157536">return</span>&nbsp;<span class="ident" id="5157543">handler</span><span class="op" id="5157550">(</span><span class="ident" id="5157551">name</span><span class="op" id="5157555">)</span><br>
<span class="lineno"></span><span class="op" id="5157557">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5157560">type</span>&nbsp;<span class="ident" id="5157565">handler</span>&nbsp;<span class="builtintype" id="5157573">string</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="5157581">func</span>&nbsp;<span class="op" id="5157586">(</span><span class="ident" id="5157587">name</span>&nbsp;<span class="ident" id="5157592">handler</span><span class="op" id="5157599">)</span>&nbsp;<span class="ident" id="5157601">ServeHTTP</span><span class="op" id="5157610">(</span><span class="ident" id="5157611">w</span>&nbsp;<span class="ident" id="5157613">http</span><span class="op" id="5157617">.</span><span class="ident" id="5157618">ResponseWriter</span><span class="op" id="5157632">,</span>&nbsp;<span class="ident" id="5157634">r</span>&nbsp;<span class="op" id="5157636">*</span><span class="ident" id="5157637">http</span><span class="op" id="5157641">.</span><span class="ident" id="5157642">Request</span><span class="op" id="5157649">)</span>&nbsp;<span class="op" id="5157651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157654">w</span><span class="op" id="5157655">.</span><span class="ident" id="5157656">Header</span><span class="op" id="5157662">(</span><span class="op" id="5157663">)</span><span class="op" id="5157664">.</span><span class="ident" id="5157665">Set</span><span class="op" id="5157668">(</span><span class="string" id="5157669">&#34;Content-Type&#34;</span><span class="op" id="5157683">,</span>&nbsp;<span class="string" id="5157685">&#34;text/plain;&nbsp;charset=utf-8&#34;</span><span class="op" id="5157712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157715">debug</span><span class="op" id="5157720">,</span>&nbsp;<span class="ident" id="5157722">_</span>&nbsp;<span class="op" id="5157724">:=</span>&nbsp;<span class="ident" id="5157727">strconv</span><span class="op" id="5157734">.</span><span class="ident" id="5157735">Atoi</span><span class="op" id="5157739">(</span><span class="ident" id="5157740">r</span><span class="op" id="5157741">.</span><span class="ident" id="5157742">FormValue</span><span class="op" id="5157751">(</span><span class="string" id="5157752">&#34;debug&#34;</span><span class="op" id="5157759">)</span><span class="op" id="5157760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157763">p</span>&nbsp;<span class="op" id="5157765">:=</span>&nbsp;<span class="ident" id="5157768">pprof</span><span class="op" id="5157773">.</span><span class="ident" id="5157774">Lookup</span><span class="op" id="5157780">(</span><span class="builtintype" id="5157781">string</span><span class="op" id="5157787">(</span><span class="ident" id="5157788">name</span><span class="op" id="5157792">)</span><span class="op" id="5157793">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157796">if</span>&nbsp;<span class="ident" id="5157799">p</span>&nbsp;<span class="op" id="5157801">==</span>&nbsp;<span class="ident" id="5157804">nil</span>&nbsp;<span class="op" id="5157808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157812">w</span><span class="op" id="5157813">.</span><span class="ident" id="5157814">WriteHeader</span><span class="op" id="5157825">(</span><span class="num" id="5157826">404</span><span class="op" id="5157829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157833">fmt</span><span class="op" id="5157836">.</span><span class="ident" id="5157837">Fprintf</span><span class="op" id="5157844">(</span><span class="ident" id="5157845">w</span><span class="op" id="5157846">,</span>&nbsp;<span class="string" id="5157848">&#34;Unknown&nbsp;profile:&nbsp;%s\n&#34;</span><span class="op" id="5157871">,</span>&nbsp;<span class="ident" id="5157873">name</span><span class="op" id="5157877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157881">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157889">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157892">gc</span><span class="op" id="5157894">,</span>&nbsp;<span class="ident" id="5157896">_</span>&nbsp;<span class="op" id="5157898">:=</span>&nbsp;<span class="ident" id="5157901">strconv</span><span class="op" id="5157908">.</span><span class="ident" id="5157909">Atoi</span><span class="op" id="5157913">(</span><span class="ident" id="5157914">r</span><span class="op" id="5157915">.</span><span class="ident" id="5157916">FormValue</span><span class="op" id="5157925">(</span><span class="string" id="5157926">&#34;gc&#34;</span><span class="op" id="5157930">)</span><span class="op" id="5157931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5157934">if</span>&nbsp;<span class="ident" id="5157937">name</span>&nbsp;<span class="op" id="5157942">==</span>&nbsp;<span class="string" id="5157945">&#34;heap&#34;</span>&nbsp;<span class="op" id="5157952">&amp;&amp;</span>&nbsp;<span class="ident" id="5157955">gc</span>&nbsp;<span class="op" id="5157958">&gt;</span>&nbsp;<span class="num" id="5157960">0</span>&nbsp;<span class="op" id="5157962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157966">runtime</span><span class="op" id="5157973">.</span><span class="ident" id="5157974">GC</span><span class="op" id="5157976">(</span><span class="op" id="5157977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5157980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5157983">p</span><span class="op" id="5157984">.</span><span class="ident" id="5157985">WriteTo</span><span class="op" id="5157992">(</span><span class="ident" id="5157993">w</span><span class="op" id="5157994">,</span>&nbsp;<span class="ident" id="5157996">debug</span><span class="op" id="5158001">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158004">return</span><br>
<span class="lineno"></span><span class="op" id="5158011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5158014">//&nbsp;Index&nbsp;responds&nbsp;with&nbsp;the&nbsp;pprof-formatted&nbsp;profile&nbsp;named&nbsp;by&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="5158087">//&nbsp;For&nbsp;example,&nbsp;&#34;/debug/pprof/heap&#34;&nbsp;serves&nbsp;the&nbsp;&#34;heap&#34;&nbsp;profile.</span><br>
<span class="lineno">175</span><span class="comment" id="5158150">//&nbsp;Index&nbsp;responds&nbsp;to&nbsp;a&nbsp;request&nbsp;for&nbsp;&#34;/debug/pprof/&#34;&nbsp;with&nbsp;an&nbsp;HTML&nbsp;page</span><br>
<span class="lineno"></span><span class="comment" id="5158219">//&nbsp;listing&nbsp;the&nbsp;available&nbsp;profiles.</span><br>
<span class="lineno"></span><span class="keyword" id="5158254">func</span>&nbsp;<span class="ident" id="5158259">Index</span><span class="op" id="5158264">(</span><span class="ident" id="5158265">w</span>&nbsp;<span class="ident" id="5158267">http</span><span class="op" id="5158271">.</span><span class="ident" id="5158272">ResponseWriter</span><span class="op" id="5158286">,</span>&nbsp;<span class="ident" id="5158288">r</span>&nbsp;<span class="op" id="5158290">*</span><span class="ident" id="5158291">http</span><span class="op" id="5158295">.</span><span class="ident" id="5158296">Request</span><span class="op" id="5158303">)</span>&nbsp;<span class="op" id="5158305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158308">if</span>&nbsp;<span class="ident" id="5158311">strings</span><span class="op" id="5158318">.</span><span class="ident" id="5158319">HasPrefix</span><span class="op" id="5158328">(</span><span class="ident" id="5158329">r</span><span class="op" id="5158330">.</span><span class="ident" id="5158331">URL</span><span class="op" id="5158334">.</span><span class="ident" id="5158335">Path</span><span class="op" id="5158339">,</span>&nbsp;<span class="string" id="5158341">&#34;/debug/pprof/&#34;</span><span class="op" id="5158356">)</span>&nbsp;<span class="op" id="5158358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158362">name</span>&nbsp;<span class="op" id="5158367">:=</span>&nbsp;<span class="ident" id="5158370">strings</span><span class="op" id="5158377">.</span><span class="ident" id="5158378">TrimPrefix</span><span class="op" id="5158388">(</span><span class="ident" id="5158389">r</span><span class="op" id="5158390">.</span><span class="ident" id="5158391">URL</span><span class="op" id="5158394">.</span><span class="ident" id="5158395">Path</span><span class="op" id="5158399">,</span>&nbsp;<span class="string" id="5158401">&#34;/debug/pprof/&#34;</span><span class="op" id="5158416">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158420">if</span>&nbsp;<span class="ident" id="5158423">name</span>&nbsp;<span class="op" id="5158428">!=</span>&nbsp;<span class="string" id="5158431">&#34;&#34;</span>&nbsp;<span class="op" id="5158434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158439">handler</span><span class="op" id="5158446">(</span><span class="ident" id="5158447">name</span><span class="op" id="5158451">)</span><span class="op" id="5158452">.</span><span class="ident" id="5158453">ServeHTTP</span><span class="op" id="5158462">(</span><span class="ident" id="5158463">w</span><span class="op" id="5158464">,</span>&nbsp;<span class="ident" id="5158466">r</span><span class="op" id="5158467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158472">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158484">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158488">profiles</span>&nbsp;<span class="op" id="5158497">:=</span>&nbsp;<span class="ident" id="5158500">pprof</span><span class="op" id="5158505">.</span><span class="ident" id="5158506">Profiles</span><span class="op" id="5158514">(</span><span class="op" id="5158515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5158518">if</span>&nbsp;<span class="ident" id="5158521">err</span>&nbsp;<span class="op" id="5158525">:=</span>&nbsp;<span class="ident" id="5158528">indexTmpl</span><span class="op" id="5158537">.</span><span class="ident" id="5158538">Execute</span><span class="op" id="5158545">(</span><span class="ident" id="5158546">w</span><span class="op" id="5158547">,</span>&nbsp;<span class="ident" id="5158549">profiles</span><span class="op" id="5158557">)</span><span class="op" id="5158558">;</span>&nbsp;<span class="ident" id="5158560">err</span>&nbsp;<span class="op" id="5158564">!=</span>&nbsp;<span class="ident" id="5158567">nil</span>&nbsp;<span class="op" id="5158571">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5158575">log</span><span class="op" id="5158578">.</span><span class="ident" id="5158579">Print</span><span class="op" id="5158584">(</span><span class="ident" id="5158585">err</span><span class="op" id="5158588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5158591">}</span><br>
<span class="lineno">190</span><span class="op" id="5158593">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5158596">var</span>&nbsp;<span class="ident" id="5158600">indexTmpl</span>&nbsp;<span class="op" id="5158610">=</span>&nbsp;<span class="ident" id="5158612">template</span><span class="op" id="5158620">.</span><span class="ident" id="5158621">Must</span><span class="op" id="5158625">(</span><span class="ident" id="5158626">template</span><span class="op" id="5158634">.</span><span class="ident" id="5158635">New</span><span class="op" id="5158638">(</span><span class="string" id="5158639">&#34;index&#34;</span><span class="op" id="5158646">)</span><span class="op" id="5158647">.</span><span class="ident" id="5158648">Parse</span><span class="op" id="5158653">(</span><span class="string" id="5158654">`&lt;html&gt;<br>
<span class="lineno"></span>&lt;head&gt;<br>
<span class="lineno"></span>&lt;title&gt;/debug/pprof/&lt;/title&gt;<br>
<span class="lineno">195</span>&lt;/head&gt;<br>
<span class="lineno"></span>/debug/pprof/&lt;br&gt;<br>
<span class="lineno"></span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;body&gt;<br>
<span class="lineno"></span>profiles:&lt;br&gt;<br>
<span class="lineno">200</span>&lt;table&gt;<br>
<span class="lineno"></span>{{range&nbsp;.}}<br>
<span class="lineno"></span>&lt;tr&gt;&lt;td&nbsp;align=right&gt;{{.Count}}&lt;td&gt;&lt;a&nbsp;href=&#34;/debug/pprof/{{.Name}}?debug=1&#34;&gt;{{.Name}}&lt;/a&gt;<br>
<span class="lineno"></span>{{end}}<br>
<span class="lineno"></span>&lt;/table&gt;<br>
<span class="lineno">205</span>&lt;br&gt;<br>
<span class="lineno"></span>&lt;a&nbsp;href=&#34;/debug/pprof/goroutine?debug=2&#34;&gt;full&nbsp;goroutine&nbsp;stack&nbsp;dump&lt;/a&gt;&lt;br&gt;<br>
<span class="lineno"></span>&lt;/body&gt;<br>
<span class="lineno"></span>&lt;/html&gt;<br>
<span class="lineno"></span>`</span><span class="op" id="5158973">)</span><span class="op" id="5158974">)</span>
</div>
</body>
</html>
