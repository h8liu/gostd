<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6938486">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6938541">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6938595">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6938646">package</span>&nbsp;<span class="ident" id="6938654">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6938659">import</span>&nbsp;<span class="op" id="6938666">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938669">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938678">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938685">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938694">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938709">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6938722">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6938732">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="6938735">func</span>&nbsp;<span class="ident" id="6938740">diff</span><span class="op" id="6938744">(</span><span class="ident" id="6938745">m0</span><span class="op" id="6938747">,</span>&nbsp;<span class="ident" id="6938749">m1</span>&nbsp;<span class="ident" id="6938752">image</span><span class="op" id="6938757">.</span><span class="ident" id="6938758">Image</span><span class="op" id="6938763">)</span>&nbsp;<span class="builtintype" id="6938765">error</span>&nbsp;<span class="op" id="6938771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938774">b0</span><span class="op" id="6938776">,</span>&nbsp;<span class="ident" id="6938778">b1</span>&nbsp;<span class="op" id="6938781">:=</span>&nbsp;<span class="ident" id="6938784">m0</span><span class="op" id="6938786">.</span><span class="ident" id="6938787">Bounds</span><span class="op" id="6938793">(</span><span class="op" id="6938794">)</span><span class="op" id="6938795">,</span>&nbsp;<span class="ident" id="6938797">m1</span><span class="op" id="6938799">.</span><span class="ident" id="6938800">Bounds</span><span class="op" id="6938806">(</span><span class="op" id="6938807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6938810">if</span>&nbsp;<span class="op" id="6938813">!</span><span class="ident" id="6938814">b0</span><span class="op" id="6938816">.</span><span class="ident" id="6938817">Size</span><span class="op" id="6938821">(</span><span class="op" id="6938822">)</span><span class="op" id="6938823">.</span><span class="ident" id="6938824">Eq</span><span class="op" id="6938826">(</span><span class="ident" id="6938827">b1</span><span class="op" id="6938829">.</span><span class="ident" id="6938830">Size</span><span class="op" id="6938834">(</span><span class="op" id="6938835">)</span><span class="op" id="6938836">)</span>&nbsp;<span class="op" id="6938838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6938842">return</span>&nbsp;<span class="ident" id="6938849">fmt</span><span class="op" id="6938852">.</span><span class="ident" id="6938853">Errorf</span><span class="op" id="6938859">(</span><span class="string" id="6938860">&#34;dimensions&nbsp;differ:&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="6938889">,</span>&nbsp;<span class="ident" id="6938891">b0</span><span class="op" id="6938893">,</span>&nbsp;<span class="ident" id="6938895">b1</span><span class="op" id="6938897">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6938900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938903">dx</span>&nbsp;<span class="op" id="6938906">:=</span>&nbsp;<span class="ident" id="6938909">b1</span><span class="op" id="6938911">.</span><span class="ident" id="6938912">Min</span><span class="op" id="6938915">.</span><span class="ident" id="6938916">X</span>&nbsp;<span class="op" id="6938918">-</span>&nbsp;<span class="ident" id="6938920">b0</span><span class="op" id="6938922">.</span><span class="ident" id="6938923">Min</span><span class="op" id="6938926">.</span><span class="ident" id="6938927">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6938930">dy</span>&nbsp;<span class="op" id="6938933">:=</span>&nbsp;<span class="ident" id="6938936">b1</span><span class="op" id="6938938">.</span><span class="ident" id="6938939">Min</span><span class="op" id="6938942">.</span><span class="ident" id="6938943">Y</span>&nbsp;<span class="op" id="6938945">-</span>&nbsp;<span class="ident" id="6938947">b0</span><span class="op" id="6938949">.</span><span class="ident" id="6938950">Min</span><span class="op" id="6938953">.</span><span class="ident" id="6938954">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6938957">for</span>&nbsp;<span class="ident" id="6938961">y</span>&nbsp;<span class="op" id="6938963">:=</span>&nbsp;<span class="ident" id="6938966">b0</span><span class="op" id="6938968">.</span><span class="ident" id="6938969">Min</span><span class="op" id="6938972">.</span><span class="ident" id="6938973">Y</span><span class="op" id="6938974">;</span>&nbsp;<span class="ident" id="6938976">y</span>&nbsp;<span class="op" id="6938978">&lt;</span>&nbsp;<span class="ident" id="6938980">b0</span><span class="op" id="6938982">.</span><span class="ident" id="6938983">Max</span><span class="op" id="6938986">.</span><span class="ident" id="6938987">Y</span><span class="op" id="6938988">;</span>&nbsp;<span class="ident" id="6938990">y</span><span class="op" id="6938991">++</span>&nbsp;<span class="op" id="6938994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6938998">for</span>&nbsp;<span class="ident" id="6939002">x</span>&nbsp;<span class="op" id="6939004">:=</span>&nbsp;<span class="ident" id="6939007">b0</span><span class="op" id="6939009">.</span><span class="ident" id="6939010">Min</span><span class="op" id="6939013">.</span><span class="ident" id="6939014">X</span><span class="op" id="6939015">;</span>&nbsp;<span class="ident" id="6939017">x</span>&nbsp;<span class="op" id="6939019">&lt;</span>&nbsp;<span class="ident" id="6939021">b0</span><span class="op" id="6939023">.</span><span class="ident" id="6939024">Max</span><span class="op" id="6939027">.</span><span class="ident" id="6939028">X</span><span class="op" id="6939029">;</span>&nbsp;<span class="ident" id="6939031">x</span><span class="op" id="6939032">++</span>&nbsp;<span class="op" id="6939035">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939040">c0</span>&nbsp;<span class="op" id="6939043">:=</span>&nbsp;<span class="ident" id="6939046">m0</span><span class="op" id="6939048">.</span><span class="ident" id="6939049">At</span><span class="op" id="6939051">(</span><span class="ident" id="6939052">x</span><span class="op" id="6939053">,</span>&nbsp;<span class="ident" id="6939055">y</span><span class="op" id="6939056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939061">c1</span>&nbsp;<span class="op" id="6939064">:=</span>&nbsp;<span class="ident" id="6939067">m1</span><span class="op" id="6939069">.</span><span class="ident" id="6939070">At</span><span class="op" id="6939072">(</span><span class="ident" id="6939073">x</span><span class="op" id="6939074">+</span><span class="ident" id="6939075">dx</span><span class="op" id="6939077">,</span>&nbsp;<span class="ident" id="6939079">y</span><span class="op" id="6939080">+</span><span class="ident" id="6939081">dy</span><span class="op" id="6939083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939088">r0</span><span class="op" id="6939090">,</span>&nbsp;<span class="ident" id="6939092">g0</span><span class="op" id="6939094">,</span>&nbsp;<span class="ident" id="6939096">b0</span><span class="op" id="6939098">,</span>&nbsp;<span class="ident" id="6939100">a0</span>&nbsp;<span class="op" id="6939103">:=</span>&nbsp;<span class="ident" id="6939106">c0</span><span class="op" id="6939108">.</span><span class="ident" id="6939109">RGBA</span><span class="op" id="6939113">(</span><span class="op" id="6939114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939119">r1</span><span class="op" id="6939121">,</span>&nbsp;<span class="ident" id="6939123">g1</span><span class="op" id="6939125">,</span>&nbsp;<span class="ident" id="6939127">b1</span><span class="op" id="6939129">,</span>&nbsp;<span class="ident" id="6939131">a1</span>&nbsp;<span class="op" id="6939134">:=</span>&nbsp;<span class="ident" id="6939137">c1</span><span class="op" id="6939139">.</span><span class="ident" id="6939140">RGBA</span><span class="op" id="6939144">(</span><span class="op" id="6939145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939150">if</span>&nbsp;<span class="ident" id="6939153">r0</span>&nbsp;<span class="op" id="6939156">!=</span>&nbsp;<span class="ident" id="6939159">r1</span>&nbsp;<span class="op" id="6939162">||</span>&nbsp;<span class="ident" id="6939165">g0</span>&nbsp;<span class="op" id="6939168">!=</span>&nbsp;<span class="ident" id="6939171">g1</span>&nbsp;<span class="op" id="6939174">||</span>&nbsp;<span class="ident" id="6939177">b0</span>&nbsp;<span class="op" id="6939180">!=</span>&nbsp;<span class="ident" id="6939183">b1</span>&nbsp;<span class="op" id="6939186">||</span>&nbsp;<span class="ident" id="6939189">a0</span>&nbsp;<span class="op" id="6939192">!=</span>&nbsp;<span class="ident" id="6939195">a1</span>&nbsp;<span class="op" id="6939198">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939204">return</span>&nbsp;<span class="ident" id="6939211">fmt</span><span class="op" id="6939214">.</span><span class="ident" id="6939215">Errorf</span><span class="op" id="6939221">(</span><span class="string" id="6939222">&#34;colors&nbsp;differ&nbsp;at&nbsp;(%d,&nbsp;%d):&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="6939259">,</span>&nbsp;<span class="ident" id="6939261">x</span><span class="op" id="6939262">,</span>&nbsp;<span class="ident" id="6939264">y</span><span class="op" id="6939265">,</span>&nbsp;<span class="ident" id="6939267">c0</span><span class="op" id="6939269">,</span>&nbsp;<span class="ident" id="6939271">c1</span><span class="op" id="6939273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939278">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939288">return</span>&nbsp;<span class="builtintype" id="6939295">nil</span><br>
<span class="lineno">35</span><span class="op" id="6939299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6939302">func</span>&nbsp;<span class="ident" id="6939307">encodeDecode</span><span class="op" id="6939319">(</span><span class="ident" id="6939320">m</span>&nbsp;<span class="ident" id="6939322">image</span><span class="op" id="6939327">.</span><span class="ident" id="6939328">Image</span><span class="op" id="6939333">)</span>&nbsp;<span class="op" id="6939335">(</span><span class="ident" id="6939336">image</span><span class="op" id="6939341">.</span><span class="ident" id="6939342">Image</span><span class="op" id="6939347">,</span>&nbsp;<span class="builtintype" id="6939349">error</span><span class="op" id="6939354">)</span>&nbsp;<span class="op" id="6939356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939359">var</span>&nbsp;<span class="ident" id="6939363">b</span>&nbsp;<span class="ident" id="6939365">bytes</span><span class="op" id="6939370">.</span><span class="ident" id="6939371">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939379">err</span>&nbsp;<span class="op" id="6939383">:=</span>&nbsp;<span class="ident" id="6939386">Encode</span><span class="op" id="6939392">(</span><span class="op" id="6939393">&amp;</span><span class="ident" id="6939394">b</span><span class="op" id="6939395">,</span>&nbsp;<span class="ident" id="6939397">m</span><span class="op" id="6939398">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939401">if</span>&nbsp;<span class="ident" id="6939404">err</span>&nbsp;<span class="op" id="6939408">!=</span>&nbsp;<span class="builtintype" id="6939411">nil</span>&nbsp;<span class="op" id="6939415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939419">return</span>&nbsp;<span class="builtintype" id="6939426">nil</span><span class="op" id="6939429">,</span>&nbsp;<span class="ident" id="6939431">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939439">return</span>&nbsp;<span class="ident" id="6939446">Decode</span><span class="op" id="6939452">(</span><span class="op" id="6939453">&amp;</span><span class="ident" id="6939454">b</span><span class="op" id="6939455">)</span><br>
<span class="lineno"></span><span class="op" id="6939457">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="6939460">func</span>&nbsp;<span class="ident" id="6939465">TestWriter</span><span class="op" id="6939475">(</span><span class="ident" id="6939476">t</span>&nbsp;<span class="op" id="6939478">*</span><span class="ident" id="6939479">testing</span><span class="op" id="6939486">.</span><span class="ident" id="6939487">T</span><span class="op" id="6939488">)</span>&nbsp;<span class="op" id="6939490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6939493">//&nbsp;The&nbsp;filenames&nbsp;variable&nbsp;is&nbsp;declared&nbsp;in&nbsp;reader_test.go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939551">names</span>&nbsp;<span class="op" id="6939557">:=</span>&nbsp;<span class="ident" id="6939560">filenames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939571">if</span>&nbsp;<span class="ident" id="6939574">testing</span><span class="op" id="6939581">.</span><span class="ident" id="6939582">Short</span><span class="op" id="6939587">(</span><span class="op" id="6939588">)</span>&nbsp;<span class="op" id="6939590">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939594">names</span>&nbsp;<span class="op" id="6939600">=</span>&nbsp;<span class="ident" id="6939602">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939621">for</span>&nbsp;<span class="ident" id="6939625">_</span><span class="op" id="6939626">,</span>&nbsp;<span class="ident" id="6939628">fn</span>&nbsp;<span class="op" id="6939631">:=</span>&nbsp;<span class="keyword" id="6939634">range</span>&nbsp;<span class="ident" id="6939640">names</span>&nbsp;<span class="op" id="6939646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939650">qfn</span>&nbsp;<span class="op" id="6939654">:=</span>&nbsp;<span class="string" id="6939657">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="6939678">+</span>&nbsp;<span class="ident" id="6939680">fn</span>&nbsp;<span class="op" id="6939683">+</span>&nbsp;<span class="string" id="6939685">&#34;.png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6939694">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939715">m0</span><span class="op" id="6939717">,</span>&nbsp;<span class="ident" id="6939719">err</span>&nbsp;<span class="op" id="6939723">:=</span>&nbsp;<span class="ident" id="6939726">readPNG</span><span class="op" id="6939733">(</span><span class="ident" id="6939734">qfn</span><span class="op" id="6939737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939741">if</span>&nbsp;<span class="ident" id="6939744">err</span>&nbsp;<span class="op" id="6939748">!=</span>&nbsp;<span class="builtintype" id="6939751">nil</span>&nbsp;<span class="op" id="6939755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939760">t</span><span class="op" id="6939761">.</span><span class="ident" id="6939762">Error</span><span class="op" id="6939767">(</span><span class="ident" id="6939768">fn</span><span class="op" id="6939770">,</span>&nbsp;<span class="ident" id="6939772">err</span><span class="op" id="6939775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939780">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939791">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6939795">//&nbsp;Read&nbsp;the&nbsp;image&nbsp;again,&nbsp;encode&nbsp;it,&nbsp;and&nbsp;decode&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939848">m1</span><span class="op" id="6939850">,</span>&nbsp;<span class="ident" id="6939852">err</span>&nbsp;<span class="op" id="6939856">:=</span>&nbsp;<span class="ident" id="6939859">readPNG</span><span class="op" id="6939866">(</span><span class="ident" id="6939867">qfn</span><span class="op" id="6939870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939874">if</span>&nbsp;<span class="ident" id="6939877">err</span>&nbsp;<span class="op" id="6939881">!=</span>&nbsp;<span class="builtintype" id="6939884">nil</span>&nbsp;<span class="op" id="6939888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939893">t</span><span class="op" id="6939894">.</span><span class="ident" id="6939895">Error</span><span class="op" id="6939900">(</span><span class="ident" id="6939901">fn</span><span class="op" id="6939903">,</span>&nbsp;<span class="ident" id="6939905">err</span><span class="op" id="6939908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939913">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6939922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939926">m2</span><span class="op" id="6939928">,</span>&nbsp;<span class="ident" id="6939930">err</span>&nbsp;<span class="op" id="6939934">:=</span>&nbsp;<span class="ident" id="6939937">encodeDecode</span><span class="op" id="6939949">(</span><span class="ident" id="6939950">m1</span><span class="op" id="6939952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939956">if</span>&nbsp;<span class="ident" id="6939959">err</span>&nbsp;<span class="op" id="6939963">!=</span>&nbsp;<span class="builtintype" id="6939966">nil</span>&nbsp;<span class="op" id="6939970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6939975">t</span><span class="op" id="6939976">.</span><span class="ident" id="6939977">Error</span><span class="op" id="6939982">(</span><span class="ident" id="6939983">fn</span><span class="op" id="6939985">,</span>&nbsp;<span class="ident" id="6939987">err</span><span class="op" id="6939990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6939995">return</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6940008">//&nbsp;Compare&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940030">err</span>&nbsp;<span class="op" id="6940034">=</span>&nbsp;<span class="ident" id="6940036">diff</span><span class="op" id="6940040">(</span><span class="ident" id="6940041">m0</span><span class="op" id="6940043">,</span>&nbsp;<span class="ident" id="6940045">m2</span><span class="op" id="6940047">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940051">if</span>&nbsp;<span class="ident" id="6940054">err</span>&nbsp;<span class="op" id="6940058">!=</span>&nbsp;<span class="builtintype" id="6940061">nil</span>&nbsp;<span class="op" id="6940065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940070">t</span><span class="op" id="6940071">.</span><span class="ident" id="6940072">Error</span><span class="op" id="6940077">(</span><span class="ident" id="6940078">fn</span><span class="op" id="6940080">,</span>&nbsp;<span class="ident" id="6940082">err</span><span class="op" id="6940085">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940090">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940104">}</span><br>
<span class="lineno"></span><span class="op" id="6940106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="6940109">func</span>&nbsp;<span class="ident" id="6940114">TestWriterLevels</span><span class="op" id="6940130">(</span><span class="ident" id="6940131">t</span>&nbsp;<span class="op" id="6940133">*</span><span class="ident" id="6940134">testing</span><span class="op" id="6940141">.</span><span class="ident" id="6940142">T</span><span class="op" id="6940143">)</span>&nbsp;<span class="op" id="6940145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940148">m</span>&nbsp;<span class="op" id="6940150">:=</span>&nbsp;<span class="ident" id="6940153">image</span><span class="op" id="6940158">.</span><span class="ident" id="6940159">NewNRGBA</span><span class="op" id="6940167">(</span><span class="ident" id="6940168">image</span><span class="op" id="6940173">.</span><span class="ident" id="6940174">Rect</span><span class="op" id="6940178">(</span><span class="num" id="6940179">0</span><span class="op" id="6940180">,</span>&nbsp;<span class="num" id="6940182">0</span><span class="op" id="6940183">,</span>&nbsp;<span class="num" id="6940185">100</span><span class="op" id="6940188">,</span>&nbsp;<span class="num" id="6940190">100</span><span class="op" id="6940193">)</span><span class="op" id="6940194">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940198">var</span>&nbsp;<span class="ident" id="6940202">b1</span><span class="op" id="6940204">,</span>&nbsp;<span class="ident" id="6940206">b2</span>&nbsp;<span class="ident" id="6940209">bytes</span><span class="op" id="6940214">.</span><span class="ident" id="6940215">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940223">if</span>&nbsp;<span class="ident" id="6940226">err</span>&nbsp;<span class="op" id="6940230">:=</span>&nbsp;<span class="op" id="6940233">(</span><span class="op" id="6940234">&amp;</span><span class="ident" id="6940235">Encoder</span><span class="op" id="6940242">{</span><span class="op" id="6940243">}</span><span class="op" id="6940244">)</span><span class="op" id="6940245">.</span><span class="ident" id="6940246">Encode</span><span class="op" id="6940252">(</span><span class="op" id="6940253">&amp;</span><span class="ident" id="6940254">b1</span><span class="op" id="6940256">,</span>&nbsp;<span class="ident" id="6940258">m</span><span class="op" id="6940259">)</span><span class="op" id="6940260">;</span>&nbsp;<span class="ident" id="6940262">err</span>&nbsp;<span class="op" id="6940266">!=</span>&nbsp;<span class="builtintype" id="6940269">nil</span>&nbsp;<span class="op" id="6940273">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940277">t</span><span class="op" id="6940278">.</span><span class="ident" id="6940279">Fatal</span><span class="op" id="6940284">(</span><span class="ident" id="6940285">err</span><span class="op" id="6940288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940294">noenc</span>&nbsp;<span class="op" id="6940300">:=</span>&nbsp;<span class="op" id="6940303">&amp;</span><span class="ident" id="6940304">Encoder</span><span class="op" id="6940311">{</span><span class="ident" id="6940312">CompressionLevel</span><span class="op" id="6940328">:</span>&nbsp;<span class="ident" id="6940330">NoCompression</span><span class="op" id="6940343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940346">if</span>&nbsp;<span class="ident" id="6940349">err</span>&nbsp;<span class="op" id="6940353">:=</span>&nbsp;<span class="ident" id="6940356">noenc</span><span class="op" id="6940361">.</span><span class="ident" id="6940362">Encode</span><span class="op" id="6940368">(</span><span class="op" id="6940369">&amp;</span><span class="ident" id="6940370">b2</span><span class="op" id="6940372">,</span>&nbsp;<span class="ident" id="6940374">m</span><span class="op" id="6940375">)</span><span class="op" id="6940376">;</span>&nbsp;<span class="ident" id="6940378">err</span>&nbsp;<span class="op" id="6940382">!=</span>&nbsp;<span class="builtintype" id="6940385">nil</span>&nbsp;<span class="op" id="6940389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940393">t</span><span class="op" id="6940394">.</span><span class="ident" id="6940395">Fatal</span><span class="op" id="6940400">(</span><span class="ident" id="6940401">err</span><span class="op" id="6940404">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940411">if</span>&nbsp;<span class="ident" id="6940414">b2</span><span class="op" id="6940416">.</span><span class="ident" id="6940417">Len</span><span class="op" id="6940420">(</span><span class="op" id="6940421">)</span>&nbsp;<span class="op" id="6940423">&lt;=</span>&nbsp;<span class="ident" id="6940426">b1</span><span class="op" id="6940428">.</span><span class="ident" id="6940429">Len</span><span class="op" id="6940432">(</span><span class="op" id="6940433">)</span>&nbsp;<span class="op" id="6940435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940439">t</span><span class="op" id="6940440">.</span><span class="ident" id="6940441">Error</span><span class="op" id="6940446">(</span><span class="string" id="6940447">&#34;DefaultCompression&nbsp;encoding&nbsp;was&nbsp;larger&nbsp;than&nbsp;NoCompression&nbsp;encoding&#34;</span><span class="op" id="6940515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940518">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940521">if</span>&nbsp;<span class="ident" id="6940524">_</span><span class="op" id="6940525">,</span>&nbsp;<span class="ident" id="6940527">err</span>&nbsp;<span class="op" id="6940531">:=</span>&nbsp;<span class="ident" id="6940534">Decode</span><span class="op" id="6940540">(</span><span class="op" id="6940541">&amp;</span><span class="ident" id="6940542">b1</span><span class="op" id="6940544">)</span><span class="op" id="6940545">;</span>&nbsp;<span class="ident" id="6940547">err</span>&nbsp;<span class="op" id="6940551">!=</span>&nbsp;<span class="builtintype" id="6940554">nil</span>&nbsp;<span class="op" id="6940558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940562">t</span><span class="op" id="6940563">.</span><span class="ident" id="6940564">Error</span><span class="op" id="6940569">(</span><span class="string" id="6940570">&#34;cannot&nbsp;decode&nbsp;DefaultCompression&#34;</span><span class="op" id="6940604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940610">if</span>&nbsp;<span class="ident" id="6940613">_</span><span class="op" id="6940614">,</span>&nbsp;<span class="ident" id="6940616">err</span>&nbsp;<span class="op" id="6940620">:=</span>&nbsp;<span class="ident" id="6940623">Decode</span><span class="op" id="6940629">(</span><span class="op" id="6940630">&amp;</span><span class="ident" id="6940631">b2</span><span class="op" id="6940633">)</span><span class="op" id="6940634">;</span>&nbsp;<span class="ident" id="6940636">err</span>&nbsp;<span class="op" id="6940640">!=</span>&nbsp;<span class="builtintype" id="6940643">nil</span>&nbsp;<span class="op" id="6940647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940651">t</span><span class="op" id="6940652">.</span><span class="ident" id="6940653">Error</span><span class="op" id="6940658">(</span><span class="string" id="6940659">&#34;cannot&nbsp;decode&nbsp;NoCompression&#34;</span><span class="op" id="6940688">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940691">}</span><br>
<span class="lineno"></span><span class="op" id="6940693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6940696">func</span>&nbsp;<span class="ident" id="6940701">TestSubImage</span><span class="op" id="6940713">(</span><span class="ident" id="6940714">t</span>&nbsp;<span class="op" id="6940716">*</span><span class="ident" id="6940717">testing</span><span class="op" id="6940724">.</span><span class="ident" id="6940725">T</span><span class="op" id="6940726">)</span>&nbsp;<span class="op" id="6940728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940731">m0</span>&nbsp;<span class="op" id="6940734">:=</span>&nbsp;<span class="ident" id="6940737">image</span><span class="op" id="6940742">.</span><span class="ident" id="6940743">NewRGBA</span><span class="op" id="6940750">(</span><span class="ident" id="6940751">image</span><span class="op" id="6940756">.</span><span class="ident" id="6940757">Rect</span><span class="op" id="6940761">(</span><span class="num" id="6940762">0</span><span class="op" id="6940763">,</span>&nbsp;<span class="num" id="6940765">0</span><span class="op" id="6940766">,</span>&nbsp;<span class="num" id="6940768">256</span><span class="op" id="6940771">,</span>&nbsp;<span class="num" id="6940773">256</span><span class="op" id="6940776">)</span><span class="op" id="6940777">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940780">for</span>&nbsp;<span class="ident" id="6940784">y</span>&nbsp;<span class="op" id="6940786">:=</span>&nbsp;<span class="num" id="6940789">0</span><span class="op" id="6940790">;</span>&nbsp;<span class="ident" id="6940792">y</span>&nbsp;<span class="op" id="6940794">&lt;</span>&nbsp;<span class="num" id="6940796">256</span><span class="op" id="6940799">;</span>&nbsp;<span class="ident" id="6940801">y</span><span class="op" id="6940802">++</span>&nbsp;<span class="op" id="6940805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940809">for</span>&nbsp;<span class="ident" id="6940813">x</span>&nbsp;<span class="op" id="6940815">:=</span>&nbsp;<span class="num" id="6940818">0</span><span class="op" id="6940819">;</span>&nbsp;<span class="ident" id="6940821">x</span>&nbsp;<span class="op" id="6940823">&lt;</span>&nbsp;<span class="num" id="6940825">256</span><span class="op" id="6940828">;</span>&nbsp;<span class="ident" id="6940830">x</span><span class="op" id="6940831">++</span>&nbsp;<span class="op" id="6940834">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940839">m0</span><span class="op" id="6940841">.</span><span class="ident" id="6940842">Set</span><span class="op" id="6940845">(</span><span class="ident" id="6940846">x</span><span class="op" id="6940847">,</span>&nbsp;<span class="ident" id="6940849">y</span><span class="op" id="6940850">,</span>&nbsp;<span class="ident" id="6940852">color</span><span class="op" id="6940857">.</span><span class="ident" id="6940858">RGBA</span><span class="op" id="6940862">{</span><span class="builtintype" id="6940863">uint8</span><span class="op" id="6940868">(</span><span class="ident" id="6940869">x</span><span class="op" id="6940870">)</span><span class="op" id="6940871">,</span>&nbsp;<span class="builtintype" id="6940873">uint8</span><span class="op" id="6940878">(</span><span class="ident" id="6940879">y</span><span class="op" id="6940880">)</span><span class="op" id="6940881">,</span>&nbsp;<span class="num" id="6940883">0</span><span class="op" id="6940884">,</span>&nbsp;<span class="num" id="6940886">255</span><span class="op" id="6940889">}</span><span class="op" id="6940890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940894">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6940897">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940900">m0</span>&nbsp;<span class="op" id="6940903">=</span>&nbsp;<span class="ident" id="6940905">m0</span><span class="op" id="6940907">.</span><span class="ident" id="6940908">SubImage</span><span class="op" id="6940916">(</span><span class="ident" id="6940917">image</span><span class="op" id="6940922">.</span><span class="ident" id="6940923">Rect</span><span class="op" id="6940927">(</span><span class="num" id="6940928">50</span><span class="op" id="6940930">,</span>&nbsp;<span class="num" id="6940932">30</span><span class="op" id="6940934">,</span>&nbsp;<span class="num" id="6940936">250</span><span class="op" id="6940939">,</span>&nbsp;<span class="num" id="6940941">130</span><span class="op" id="6940944">)</span><span class="op" id="6940945">)</span><span class="op" id="6940946">.</span><span class="op" id="6940947">(</span><span class="op" id="6940948">*</span><span class="ident" id="6940949">image</span><span class="op" id="6940954">.</span><span class="ident" id="6940955">RGBA</span><span class="op" id="6940959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6940962">m1</span><span class="op" id="6940964">,</span>&nbsp;<span class="ident" id="6940966">err</span>&nbsp;<span class="op" id="6940970">:=</span>&nbsp;<span class="ident" id="6940973">encodeDecode</span><span class="op" id="6940985">(</span><span class="ident" id="6940986">m0</span><span class="op" id="6940988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6940991">if</span>&nbsp;<span class="ident" id="6940994">err</span>&nbsp;<span class="op" id="6940998">!=</span>&nbsp;<span class="builtintype" id="6941001">nil</span>&nbsp;<span class="op" id="6941005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941009">t</span><span class="op" id="6941010">.</span><span class="ident" id="6941011">Error</span><span class="op" id="6941016">(</span><span class="ident" id="6941017">err</span><span class="op" id="6941020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941024">return</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941035">err</span>&nbsp;<span class="op" id="6941039">=</span>&nbsp;<span class="ident" id="6941041">diff</span><span class="op" id="6941045">(</span><span class="ident" id="6941046">m0</span><span class="op" id="6941048">,</span>&nbsp;<span class="ident" id="6941050">m1</span><span class="op" id="6941052">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941055">if</span>&nbsp;<span class="ident" id="6941058">err</span>&nbsp;<span class="op" id="6941062">!=</span>&nbsp;<span class="builtintype" id="6941065">nil</span>&nbsp;<span class="op" id="6941069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941073">t</span><span class="op" id="6941074">.</span><span class="ident" id="6941075">Error</span><span class="op" id="6941080">(</span><span class="ident" id="6941081">err</span><span class="op" id="6941084">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941088">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941096">}</span><br>
<span class="lineno"></span><span class="op" id="6941098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941101">func</span>&nbsp;<span class="ident" id="6941106">BenchmarkEncodeGray</span><span class="op" id="6941125">(</span><span class="ident" id="6941126">b</span>&nbsp;<span class="op" id="6941128">*</span><span class="ident" id="6941129">testing</span><span class="op" id="6941136">.</span><span class="ident" id="6941137">B</span><span class="op" id="6941138">)</span>&nbsp;<span class="op" id="6941140">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941143">b</span><span class="op" id="6941144">.</span><span class="ident" id="6941145">StopTimer</span><span class="op" id="6941154">(</span><span class="op" id="6941155">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941158">img</span>&nbsp;<span class="op" id="6941162">:=</span>&nbsp;<span class="ident" id="6941165">image</span><span class="op" id="6941170">.</span><span class="ident" id="6941171">NewGray</span><span class="op" id="6941178">(</span><span class="ident" id="6941179">image</span><span class="op" id="6941184">.</span><span class="ident" id="6941185">Rect</span><span class="op" id="6941189">(</span><span class="num" id="6941190">0</span><span class="op" id="6941191">,</span>&nbsp;<span class="num" id="6941193">0</span><span class="op" id="6941194">,</span>&nbsp;<span class="num" id="6941196">640</span><span class="op" id="6941199">,</span>&nbsp;<span class="num" id="6941201">480</span><span class="op" id="6941204">)</span><span class="op" id="6941205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941208">b</span><span class="op" id="6941209">.</span><span class="ident" id="6941210">SetBytes</span><span class="op" id="6941218">(</span><span class="num" id="6941219">640</span>&nbsp;<span class="op" id="6941223">*</span>&nbsp;<span class="num" id="6941225">480</span>&nbsp;<span class="op" id="6941229">*</span>&nbsp;<span class="num" id="6941231">1</span><span class="op" id="6941232">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941235">b</span><span class="op" id="6941236">.</span><span class="ident" id="6941237">StartTimer</span><span class="op" id="6941247">(</span><span class="op" id="6941248">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941251">for</span>&nbsp;<span class="ident" id="6941255">i</span>&nbsp;<span class="op" id="6941257">:=</span>&nbsp;<span class="num" id="6941260">0</span><span class="op" id="6941261">;</span>&nbsp;<span class="ident" id="6941263">i</span>&nbsp;<span class="op" id="6941265">&lt;</span>&nbsp;<span class="ident" id="6941267">b</span><span class="op" id="6941268">.</span><span class="ident" id="6941269">N</span><span class="op" id="6941270">;</span>&nbsp;<span class="ident" id="6941272">i</span><span class="op" id="6941273">++</span>&nbsp;<span class="op" id="6941276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941280">Encode</span><span class="op" id="6941286">(</span><span class="ident" id="6941287">ioutil</span><span class="op" id="6941293">.</span><span class="ident" id="6941294">Discard</span><span class="op" id="6941301">,</span>&nbsp;<span class="ident" id="6941303">img</span><span class="op" id="6941306">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941309">}</span><br>
<span class="lineno"></span><span class="op" id="6941311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941314">func</span>&nbsp;<span class="ident" id="6941319">BenchmarkEncodeNRGBOpaque</span><span class="op" id="6941344">(</span><span class="ident" id="6941345">b</span>&nbsp;<span class="op" id="6941347">*</span><span class="ident" id="6941348">testing</span><span class="op" id="6941355">.</span><span class="ident" id="6941356">B</span><span class="op" id="6941357">)</span>&nbsp;<span class="op" id="6941359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941362">b</span><span class="op" id="6941363">.</span><span class="ident" id="6941364">StopTimer</span><span class="op" id="6941373">(</span><span class="op" id="6941374">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941377">img</span>&nbsp;<span class="op" id="6941381">:=</span>&nbsp;<span class="ident" id="6941384">image</span><span class="op" id="6941389">.</span><span class="ident" id="6941390">NewNRGBA</span><span class="op" id="6941398">(</span><span class="ident" id="6941399">image</span><span class="op" id="6941404">.</span><span class="ident" id="6941405">Rect</span><span class="op" id="6941409">(</span><span class="num" id="6941410">0</span><span class="op" id="6941411">,</span>&nbsp;<span class="num" id="6941413">0</span><span class="op" id="6941414">,</span>&nbsp;<span class="num" id="6941416">640</span><span class="op" id="6941419">,</span>&nbsp;<span class="num" id="6941421">480</span><span class="op" id="6941424">)</span><span class="op" id="6941425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6941428">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941483">bo</span>&nbsp;<span class="op" id="6941486">:=</span>&nbsp;<span class="ident" id="6941489">img</span><span class="op" id="6941492">.</span><span class="ident" id="6941493">Bounds</span><span class="op" id="6941499">(</span><span class="op" id="6941500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941503">for</span>&nbsp;<span class="ident" id="6941507">y</span>&nbsp;<span class="op" id="6941509">:=</span>&nbsp;<span class="ident" id="6941512">bo</span><span class="op" id="6941514">.</span><span class="ident" id="6941515">Min</span><span class="op" id="6941518">.</span><span class="ident" id="6941519">Y</span><span class="op" id="6941520">;</span>&nbsp;<span class="ident" id="6941522">y</span>&nbsp;<span class="op" id="6941524">&lt;</span>&nbsp;<span class="ident" id="6941526">bo</span><span class="op" id="6941528">.</span><span class="ident" id="6941529">Max</span><span class="op" id="6941532">.</span><span class="ident" id="6941533">Y</span><span class="op" id="6941534">;</span>&nbsp;<span class="ident" id="6941536">y</span><span class="op" id="6941537">++</span>&nbsp;<span class="op" id="6941540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941544">for</span>&nbsp;<span class="ident" id="6941548">x</span>&nbsp;<span class="op" id="6941550">:=</span>&nbsp;<span class="ident" id="6941553">bo</span><span class="op" id="6941555">.</span><span class="ident" id="6941556">Min</span><span class="op" id="6941559">.</span><span class="ident" id="6941560">X</span><span class="op" id="6941561">;</span>&nbsp;<span class="ident" id="6941563">x</span>&nbsp;<span class="op" id="6941565">&lt;</span>&nbsp;<span class="ident" id="6941567">bo</span><span class="op" id="6941569">.</span><span class="ident" id="6941570">Max</span><span class="op" id="6941573">.</span><span class="ident" id="6941574">X</span><span class="op" id="6941575">;</span>&nbsp;<span class="ident" id="6941577">x</span><span class="op" id="6941578">++</span>&nbsp;<span class="op" id="6941581">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941586">img</span><span class="op" id="6941589">.</span><span class="ident" id="6941590">Set</span><span class="op" id="6941593">(</span><span class="ident" id="6941594">x</span><span class="op" id="6941595">,</span>&nbsp;<span class="ident" id="6941597">y</span><span class="op" id="6941598">,</span>&nbsp;<span class="ident" id="6941600">color</span><span class="op" id="6941605">.</span><span class="ident" id="6941606">NRGBA</span><span class="op" id="6941611">{</span><span class="num" id="6941612">0</span><span class="op" id="6941613">,</span>&nbsp;<span class="num" id="6941615">0</span><span class="op" id="6941616">,</span>&nbsp;<span class="num" id="6941618">0</span><span class="op" id="6941619">,</span>&nbsp;<span class="num" id="6941621">255</span><span class="op" id="6941624">}</span><span class="op" id="6941625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941629">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941635">if</span>&nbsp;<span class="op" id="6941638">!</span><span class="ident" id="6941639">img</span><span class="op" id="6941642">.</span><span class="ident" id="6941643">Opaque</span><span class="op" id="6941649">(</span><span class="op" id="6941650">)</span>&nbsp;<span class="op" id="6941652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941656">b</span><span class="op" id="6941657">.</span><span class="ident" id="6941658">Fatal</span><span class="op" id="6941663">(</span><span class="string" id="6941664">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="6941693">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941696">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941699">b</span><span class="op" id="6941700">.</span><span class="ident" id="6941701">SetBytes</span><span class="op" id="6941709">(</span><span class="num" id="6941710">640</span>&nbsp;<span class="op" id="6941714">*</span>&nbsp;<span class="num" id="6941716">480</span>&nbsp;<span class="op" id="6941720">*</span>&nbsp;<span class="num" id="6941722">4</span><span class="op" id="6941723">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941726">b</span><span class="op" id="6941727">.</span><span class="ident" id="6941728">StartTimer</span><span class="op" id="6941738">(</span><span class="op" id="6941739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941742">for</span>&nbsp;<span class="ident" id="6941746">i</span>&nbsp;<span class="op" id="6941748">:=</span>&nbsp;<span class="num" id="6941751">0</span><span class="op" id="6941752">;</span>&nbsp;<span class="ident" id="6941754">i</span>&nbsp;<span class="op" id="6941756">&lt;</span>&nbsp;<span class="ident" id="6941758">b</span><span class="op" id="6941759">.</span><span class="ident" id="6941760">N</span><span class="op" id="6941761">;</span>&nbsp;<span class="ident" id="6941763">i</span><span class="op" id="6941764">++</span>&nbsp;<span class="op" id="6941767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941771">Encode</span><span class="op" id="6941777">(</span><span class="ident" id="6941778">ioutil</span><span class="op" id="6941784">.</span><span class="ident" id="6941785">Discard</span><span class="op" id="6941792">,</span>&nbsp;<span class="ident" id="6941794">img</span><span class="op" id="6941797">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941800">}</span><br>
<span class="lineno"></span><span class="op" id="6941802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6941805">func</span>&nbsp;<span class="ident" id="6941810">BenchmarkEncodeNRGBA</span><span class="op" id="6941830">(</span><span class="ident" id="6941831">b</span>&nbsp;<span class="op" id="6941833">*</span><span class="ident" id="6941834">testing</span><span class="op" id="6941841">.</span><span class="ident" id="6941842">B</span><span class="op" id="6941843">)</span>&nbsp;<span class="op" id="6941845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941848">b</span><span class="op" id="6941849">.</span><span class="ident" id="6941850">StopTimer</span><span class="op" id="6941859">(</span><span class="op" id="6941860">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941863">img</span>&nbsp;<span class="op" id="6941867">:=</span>&nbsp;<span class="ident" id="6941870">image</span><span class="op" id="6941875">.</span><span class="ident" id="6941876">NewNRGBA</span><span class="op" id="6941884">(</span><span class="ident" id="6941885">image</span><span class="op" id="6941890">.</span><span class="ident" id="6941891">Rect</span><span class="op" id="6941895">(</span><span class="num" id="6941896">0</span><span class="op" id="6941897">,</span>&nbsp;<span class="num" id="6941899">0</span><span class="op" id="6941900">,</span>&nbsp;<span class="num" id="6941902">640</span><span class="op" id="6941905">,</span>&nbsp;<span class="num" id="6941907">480</span><span class="op" id="6941910">)</span><span class="op" id="6941911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6941914">if</span>&nbsp;<span class="ident" id="6941917">img</span><span class="op" id="6941920">.</span><span class="ident" id="6941921">Opaque</span><span class="op" id="6941927">(</span><span class="op" id="6941928">)</span>&nbsp;<span class="op" id="6941930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941934">b</span><span class="op" id="6941935">.</span><span class="ident" id="6941936">Fatal</span><span class="op" id="6941941">(</span><span class="string" id="6941942">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="6941975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6941978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6941981">b</span><span class="op" id="6941982">.</span><span class="ident" id="6941983">SetBytes</span><span class="op" id="6941991">(</span><span class="num" id="6941992">640</span>&nbsp;<span class="op" id="6941996">*</span>&nbsp;<span class="num" id="6941998">480</span>&nbsp;<span class="op" id="6942002">*</span>&nbsp;<span class="num" id="6942004">4</span><span class="op" id="6942005">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942008">b</span><span class="op" id="6942009">.</span><span class="ident" id="6942010">StartTimer</span><span class="op" id="6942020">(</span><span class="op" id="6942021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942024">for</span>&nbsp;<span class="ident" id="6942028">i</span>&nbsp;<span class="op" id="6942030">:=</span>&nbsp;<span class="num" id="6942033">0</span><span class="op" id="6942034">;</span>&nbsp;<span class="ident" id="6942036">i</span>&nbsp;<span class="op" id="6942038">&lt;</span>&nbsp;<span class="ident" id="6942040">b</span><span class="op" id="6942041">.</span><span class="ident" id="6942042">N</span><span class="op" id="6942043">;</span>&nbsp;<span class="ident" id="6942045">i</span><span class="op" id="6942046">++</span>&nbsp;<span class="op" id="6942049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942053">Encode</span><span class="op" id="6942059">(</span><span class="ident" id="6942060">ioutil</span><span class="op" id="6942066">.</span><span class="ident" id="6942067">Discard</span><span class="op" id="6942074">,</span>&nbsp;<span class="ident" id="6942076">img</span><span class="op" id="6942079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942082">}</span><br>
<span class="lineno"></span><span class="op" id="6942084">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="6942087">func</span>&nbsp;<span class="ident" id="6942092">BenchmarkEncodePaletted</span><span class="op" id="6942115">(</span><span class="ident" id="6942116">b</span>&nbsp;<span class="op" id="6942118">*</span><span class="ident" id="6942119">testing</span><span class="op" id="6942126">.</span><span class="ident" id="6942127">B</span><span class="op" id="6942128">)</span>&nbsp;<span class="op" id="6942130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942133">b</span><span class="op" id="6942134">.</span><span class="ident" id="6942135">StopTimer</span><span class="op" id="6942144">(</span><span class="op" id="6942145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942148">img</span>&nbsp;<span class="op" id="6942152">:=</span>&nbsp;<span class="ident" id="6942155">image</span><span class="op" id="6942160">.</span><span class="ident" id="6942161">NewPaletted</span><span class="op" id="6942172">(</span><span class="ident" id="6942173">image</span><span class="op" id="6942178">.</span><span class="ident" id="6942179">Rect</span><span class="op" id="6942183">(</span><span class="num" id="6942184">0</span><span class="op" id="6942185">,</span>&nbsp;<span class="num" id="6942187">0</span><span class="op" id="6942188">,</span>&nbsp;<span class="num" id="6942190">640</span><span class="op" id="6942193">,</span>&nbsp;<span class="num" id="6942195">480</span><span class="op" id="6942198">)</span><span class="op" id="6942199">,</span>&nbsp;<span class="ident" id="6942201">color</span><span class="op" id="6942206">.</span><span class="ident" id="6942207">Palette</span><span class="op" id="6942214">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942218">color</span><span class="op" id="6942223">.</span><span class="ident" id="6942224">RGBA</span><span class="op" id="6942228">{</span><span class="num" id="6942229">0</span><span class="op" id="6942230">,</span>&nbsp;<span class="num" id="6942232">0</span><span class="op" id="6942233">,</span>&nbsp;<span class="num" id="6942235">0</span><span class="op" id="6942236">,</span>&nbsp;<span class="num" id="6942238">255</span><span class="op" id="6942241">}</span><span class="op" id="6942242">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942246">color</span><span class="op" id="6942251">.</span><span class="ident" id="6942252">RGBA</span><span class="op" id="6942256">{</span><span class="num" id="6942257">255</span><span class="op" id="6942260">,</span>&nbsp;<span class="num" id="6942262">255</span><span class="op" id="6942265">,</span>&nbsp;<span class="num" id="6942267">255</span><span class="op" id="6942270">,</span>&nbsp;<span class="num" id="6942272">255</span><span class="op" id="6942275">}</span><span class="op" id="6942276">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942279">}</span><span class="op" id="6942280">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942283">b</span><span class="op" id="6942284">.</span><span class="ident" id="6942285">SetBytes</span><span class="op" id="6942293">(</span><span class="num" id="6942294">640</span>&nbsp;<span class="op" id="6942298">*</span>&nbsp;<span class="num" id="6942300">480</span>&nbsp;<span class="op" id="6942304">*</span>&nbsp;<span class="num" id="6942306">1</span><span class="op" id="6942307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942310">b</span><span class="op" id="6942311">.</span><span class="ident" id="6942312">StartTimer</span><span class="op" id="6942322">(</span><span class="op" id="6942323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942326">for</span>&nbsp;<span class="ident" id="6942330">i</span>&nbsp;<span class="op" id="6942332">:=</span>&nbsp;<span class="num" id="6942335">0</span><span class="op" id="6942336">;</span>&nbsp;<span class="ident" id="6942338">i</span>&nbsp;<span class="op" id="6942340">&lt;</span>&nbsp;<span class="ident" id="6942342">b</span><span class="op" id="6942343">.</span><span class="ident" id="6942344">N</span><span class="op" id="6942345">;</span>&nbsp;<span class="ident" id="6942347">i</span><span class="op" id="6942348">++</span>&nbsp;<span class="op" id="6942351">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942355">Encode</span><span class="op" id="6942361">(</span><span class="ident" id="6942362">ioutil</span><span class="op" id="6942368">.</span><span class="ident" id="6942369">Discard</span><span class="op" id="6942376">,</span>&nbsp;<span class="ident" id="6942378">img</span><span class="op" id="6942381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942384">}</span><br>
<span class="lineno"></span><span class="op" id="6942386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6942389">func</span>&nbsp;<span class="ident" id="6942394">BenchmarkEncodeRGBOpaque</span><span class="op" id="6942418">(</span><span class="ident" id="6942419">b</span>&nbsp;<span class="op" id="6942421">*</span><span class="ident" id="6942422">testing</span><span class="op" id="6942429">.</span><span class="ident" id="6942430">B</span><span class="op" id="6942431">)</span>&nbsp;<span class="op" id="6942433">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942436">b</span><span class="op" id="6942437">.</span><span class="ident" id="6942438">StopTimer</span><span class="op" id="6942447">(</span><span class="op" id="6942448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942451">img</span>&nbsp;<span class="op" id="6942455">:=</span>&nbsp;<span class="ident" id="6942458">image</span><span class="op" id="6942463">.</span><span class="ident" id="6942464">NewRGBA</span><span class="op" id="6942471">(</span><span class="ident" id="6942472">image</span><span class="op" id="6942477">.</span><span class="ident" id="6942478">Rect</span><span class="op" id="6942482">(</span><span class="num" id="6942483">0</span><span class="op" id="6942484">,</span>&nbsp;<span class="num" id="6942486">0</span><span class="op" id="6942487">,</span>&nbsp;<span class="num" id="6942489">640</span><span class="op" id="6942492">,</span>&nbsp;<span class="num" id="6942494">480</span><span class="op" id="6942497">)</span><span class="op" id="6942498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6942501">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942556">bo</span>&nbsp;<span class="op" id="6942559">:=</span>&nbsp;<span class="ident" id="6942562">img</span><span class="op" id="6942565">.</span><span class="ident" id="6942566">Bounds</span><span class="op" id="6942572">(</span><span class="op" id="6942573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942576">for</span>&nbsp;<span class="ident" id="6942580">y</span>&nbsp;<span class="op" id="6942582">:=</span>&nbsp;<span class="ident" id="6942585">bo</span><span class="op" id="6942587">.</span><span class="ident" id="6942588">Min</span><span class="op" id="6942591">.</span><span class="ident" id="6942592">Y</span><span class="op" id="6942593">;</span>&nbsp;<span class="ident" id="6942595">y</span>&nbsp;<span class="op" id="6942597">&lt;</span>&nbsp;<span class="ident" id="6942599">bo</span><span class="op" id="6942601">.</span><span class="ident" id="6942602">Max</span><span class="op" id="6942605">.</span><span class="ident" id="6942606">Y</span><span class="op" id="6942607">;</span>&nbsp;<span class="ident" id="6942609">y</span><span class="op" id="6942610">++</span>&nbsp;<span class="op" id="6942613">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942617">for</span>&nbsp;<span class="ident" id="6942621">x</span>&nbsp;<span class="op" id="6942623">:=</span>&nbsp;<span class="ident" id="6942626">bo</span><span class="op" id="6942628">.</span><span class="ident" id="6942629">Min</span><span class="op" id="6942632">.</span><span class="ident" id="6942633">X</span><span class="op" id="6942634">;</span>&nbsp;<span class="ident" id="6942636">x</span>&nbsp;<span class="op" id="6942638">&lt;</span>&nbsp;<span class="ident" id="6942640">bo</span><span class="op" id="6942642">.</span><span class="ident" id="6942643">Max</span><span class="op" id="6942646">.</span><span class="ident" id="6942647">X</span><span class="op" id="6942648">;</span>&nbsp;<span class="ident" id="6942650">x</span><span class="op" id="6942651">++</span>&nbsp;<span class="op" id="6942654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942659">img</span><span class="op" id="6942662">.</span><span class="ident" id="6942663">Set</span><span class="op" id="6942666">(</span><span class="ident" id="6942667">x</span><span class="op" id="6942668">,</span>&nbsp;<span class="ident" id="6942670">y</span><span class="op" id="6942671">,</span>&nbsp;<span class="ident" id="6942673">color</span><span class="op" id="6942678">.</span><span class="ident" id="6942679">RGBA</span><span class="op" id="6942683">{</span><span class="num" id="6942684">0</span><span class="op" id="6942685">,</span>&nbsp;<span class="num" id="6942687">0</span><span class="op" id="6942688">,</span>&nbsp;<span class="num" id="6942690">0</span><span class="op" id="6942691">,</span>&nbsp;<span class="num" id="6942693">255</span><span class="op" id="6942696">}</span><span class="op" id="6942697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942701">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942707">if</span>&nbsp;<span class="op" id="6942710">!</span><span class="ident" id="6942711">img</span><span class="op" id="6942714">.</span><span class="ident" id="6942715">Opaque</span><span class="op" id="6942721">(</span><span class="op" id="6942722">)</span>&nbsp;<span class="op" id="6942724">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942728">b</span><span class="op" id="6942729">.</span><span class="ident" id="6942730">Fatal</span><span class="op" id="6942735">(</span><span class="string" id="6942736">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="6942765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942771">b</span><span class="op" id="6942772">.</span><span class="ident" id="6942773">SetBytes</span><span class="op" id="6942781">(</span><span class="num" id="6942782">640</span>&nbsp;<span class="op" id="6942786">*</span>&nbsp;<span class="num" id="6942788">480</span>&nbsp;<span class="op" id="6942792">*</span>&nbsp;<span class="num" id="6942794">4</span><span class="op" id="6942795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942798">b</span><span class="op" id="6942799">.</span><span class="ident" id="6942800">StartTimer</span><span class="op" id="6942810">(</span><span class="op" id="6942811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942814">for</span>&nbsp;<span class="ident" id="6942818">i</span>&nbsp;<span class="op" id="6942820">:=</span>&nbsp;<span class="num" id="6942823">0</span><span class="op" id="6942824">;</span>&nbsp;<span class="ident" id="6942826">i</span>&nbsp;<span class="op" id="6942828">&lt;</span>&nbsp;<span class="ident" id="6942830">b</span><span class="op" id="6942831">.</span><span class="ident" id="6942832">N</span><span class="op" id="6942833">;</span>&nbsp;<span class="ident" id="6942835">i</span><span class="op" id="6942836">++</span>&nbsp;<span class="op" id="6942839">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942843">Encode</span><span class="op" id="6942849">(</span><span class="ident" id="6942850">ioutil</span><span class="op" id="6942856">.</span><span class="ident" id="6942857">Discard</span><span class="op" id="6942864">,</span>&nbsp;<span class="ident" id="6942866">img</span><span class="op" id="6942869">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6942872">}</span><br>
<span class="lineno"></span><span class="op" id="6942874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6942877">func</span>&nbsp;<span class="ident" id="6942882">BenchmarkEncodeRGBA</span><span class="op" id="6942901">(</span><span class="ident" id="6942902">b</span>&nbsp;<span class="op" id="6942904">*</span><span class="ident" id="6942905">testing</span><span class="op" id="6942912">.</span><span class="ident" id="6942913">B</span><span class="op" id="6942914">)</span>&nbsp;<span class="op" id="6942916">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942919">b</span><span class="op" id="6942920">.</span><span class="ident" id="6942921">StopTimer</span><span class="op" id="6942930">(</span><span class="op" id="6942931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6942934">img</span>&nbsp;<span class="op" id="6942938">:=</span>&nbsp;<span class="ident" id="6942941">image</span><span class="op" id="6942946">.</span><span class="ident" id="6942947">NewRGBA</span><span class="op" id="6942954">(</span><span class="ident" id="6942955">image</span><span class="op" id="6942960">.</span><span class="ident" id="6942961">Rect</span><span class="op" id="6942965">(</span><span class="num" id="6942966">0</span><span class="op" id="6942967">,</span>&nbsp;<span class="num" id="6942969">0</span><span class="op" id="6942970">,</span>&nbsp;<span class="num" id="6942972">640</span><span class="op" id="6942975">,</span>&nbsp;<span class="num" id="6942977">480</span><span class="op" id="6942980">)</span><span class="op" id="6942981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6942984">if</span>&nbsp;<span class="ident" id="6942987">img</span><span class="op" id="6942990">.</span><span class="ident" id="6942991">Opaque</span><span class="op" id="6942997">(</span><span class="op" id="6942998">)</span>&nbsp;<span class="op" id="6943000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6943004">b</span><span class="op" id="6943005">.</span><span class="ident" id="6943006">Fatal</span><span class="op" id="6943011">(</span><span class="string" id="6943012">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="6943045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6943048">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6943051">b</span><span class="op" id="6943052">.</span><span class="ident" id="6943053">SetBytes</span><span class="op" id="6943061">(</span><span class="num" id="6943062">640</span>&nbsp;<span class="op" id="6943066">*</span>&nbsp;<span class="num" id="6943068">480</span>&nbsp;<span class="op" id="6943072">*</span>&nbsp;<span class="num" id="6943074">4</span><span class="op" id="6943075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6943078">b</span><span class="op" id="6943079">.</span><span class="ident" id="6943080">StartTimer</span><span class="op" id="6943090">(</span><span class="op" id="6943091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6943094">for</span>&nbsp;<span class="ident" id="6943098">i</span>&nbsp;<span class="op" id="6943100">:=</span>&nbsp;<span class="num" id="6943103">0</span><span class="op" id="6943104">;</span>&nbsp;<span class="ident" id="6943106">i</span>&nbsp;<span class="op" id="6943108">&lt;</span>&nbsp;<span class="ident" id="6943110">b</span><span class="op" id="6943111">.</span><span class="ident" id="6943112">N</span><span class="op" id="6943113">;</span>&nbsp;<span class="ident" id="6943115">i</span><span class="op" id="6943116">++</span>&nbsp;<span class="op" id="6943119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6943123">Encode</span><span class="op" id="6943129">(</span><span class="ident" id="6943130">ioutil</span><span class="op" id="6943136">.</span><span class="ident" id="6943137">Discard</span><span class="op" id="6943144">,</span>&nbsp;<span class="ident" id="6943146">img</span><span class="op" id="6943149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6943152">}</span><br>
<span class="lineno">210</span><span class="op" id="6943154">}</span>
</div>
</body>
</html>
