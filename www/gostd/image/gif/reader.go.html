<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6288852">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6288907">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6288961">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6289012">//&nbsp;Package&nbsp;gif&nbsp;implements&nbsp;a&nbsp;GIF&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="6289071">//</span><br>
<span class="lineno"></span><span class="comment" id="6289074">//&nbsp;The&nbsp;GIF&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/Graphics/GIF/spec-gif89a.txt.</span><br>
<span class="lineno"></span><span class="keyword" id="6289153">package</span>&nbsp;<span class="ident" id="6289161">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="6289166">import</span>&nbsp;<span class="op" id="6289173">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289176">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289185">&#34;compress/lzw&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289201">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289211">&#34;fmt&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289218">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289227">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6289242">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="6289247">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6289250">var</span>&nbsp;<span class="op" id="6289254">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289257">errNotEnough</span>&nbsp;<span class="op" id="6289270">=</span>&nbsp;<span class="ident" id="6289272">errors</span><span class="op" id="6289278">.</span><span class="ident" id="6289279">New</span><span class="op" id="6289282">(</span><span class="string" id="6289283">&#34;gif:&nbsp;not&nbsp;enough&nbsp;image&nbsp;data&#34;</span><span class="op" id="6289311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289314">errTooMuch</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6289327">=</span>&nbsp;<span class="ident" id="6289329">errors</span><span class="op" id="6289335">.</span><span class="ident" id="6289336">New</span><span class="op" id="6289339">(</span><span class="string" id="6289340">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><span class="op" id="6289366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289369">errBadPixel</span>&nbsp;&nbsp;<span class="op" id="6289382">=</span>&nbsp;<span class="ident" id="6289384">errors</span><span class="op" id="6289390">.</span><span class="ident" id="6289391">New</span><span class="op" id="6289394">(</span><span class="string" id="6289395">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="6289421">)</span><br>
<span class="lineno"></span><span class="op" id="6289423">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="comment" id="6289426">//&nbsp;If&nbsp;the&nbsp;io.Reader&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;ReadByte,&nbsp;then&nbsp;decode&nbsp;will&nbsp;introduce&nbsp;its&nbsp;own&nbsp;buffering.</span><br>
<span class="lineno"></span><span class="keyword" id="6289521">type</span>&nbsp;<span class="ident" id="6289526">reader</span>&nbsp;<span class="keyword" id="6289533">interface</span>&nbsp;<span class="op" id="6289543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289546">io</span><span class="op" id="6289548">.</span><span class="ident" id="6289549">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289557">io</span><span class="op" id="6289559">.</span><span class="ident" id="6289560">ByteReader</span><br>
<span class="lineno">30</span><span class="op" id="6289571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289574">//&nbsp;Masks&nbsp;etc.</span><br>
<span class="lineno"></span><span class="keyword" id="6289588">const</span>&nbsp;<span class="op" id="6289594">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289597">//&nbsp;Fields.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289609">fColorMapFollows</span>&nbsp;<span class="op" id="6289626">=</span>&nbsp;<span class="num" id="6289628">1</span>&nbsp;<span class="op" id="6289630">&lt;&lt;</span>&nbsp;<span class="num" id="6289633">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289637">//&nbsp;Image&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289655">ifLocalColorTable</span>&nbsp;<span class="op" id="6289673">=</span>&nbsp;<span class="num" id="6289675">1</span>&nbsp;<span class="op" id="6289677">&lt;&lt;</span>&nbsp;<span class="num" id="6289680">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289683">ifInterlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289701">=</span>&nbsp;<span class="num" id="6289703">1</span>&nbsp;<span class="op" id="6289705">&lt;&lt;</span>&nbsp;<span class="num" id="6289708">6</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289711">ifPixelSizeMask</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6289729">=</span>&nbsp;<span class="num" id="6289731">7</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289735">//&nbsp;Graphic&nbsp;control&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289762">gcTransparentColorSet</span>&nbsp;<span class="op" id="6289784">=</span>&nbsp;<span class="num" id="6289786">1</span>&nbsp;<span class="op" id="6289788">&lt;&lt;</span>&nbsp;<span class="num" id="6289791">0</span><br>
<span class="lineno"></span><span class="op" id="6289793">)</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6289796">//&nbsp;Section&nbsp;indicators.</span><br>
<span class="lineno"></span><span class="keyword" id="6289819">const</span>&nbsp;<span class="op" id="6289825">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289828">sExtension</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289845">=</span>&nbsp;<span class="num" id="6289847">0x21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289853">sImageDescriptor</span>&nbsp;<span class="op" id="6289870">=</span>&nbsp;<span class="num" id="6289872">0x2C</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289878">sTrailer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289895">=</span>&nbsp;<span class="num" id="6289897">0x3B</span><br>
<span class="lineno"></span><span class="op" id="6289902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6289905">//&nbsp;Extensions.</span><br>
<span class="lineno"></span><span class="keyword" id="6289920">const</span>&nbsp;<span class="op" id="6289926">(</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289929">eText</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6289945">=</span>&nbsp;<span class="num" id="6289947">0x01</span>&nbsp;<span class="comment" id="6289952">//&nbsp;Plain&nbsp;Text</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289967">eGraphicControl</span>&nbsp;<span class="op" id="6289983">=</span>&nbsp;<span class="num" id="6289985">0xF9</span>&nbsp;<span class="comment" id="6289990">//&nbsp;Graphic&nbsp;Control</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290010">eComment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6290026">=</span>&nbsp;<span class="num" id="6290028">0xFE</span>&nbsp;<span class="comment" id="6290033">//&nbsp;Comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290045">eApplication</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6290061">=</span>&nbsp;<span class="num" id="6290063">0xFF</span>&nbsp;<span class="comment" id="6290068">//&nbsp;Application</span><br>
<span class="lineno"></span><span class="op" id="6290083">)</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="comment" id="6290086">//&nbsp;decoder&nbsp;is&nbsp;the&nbsp;type&nbsp;used&nbsp;to&nbsp;decode&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6290136">type</span>&nbsp;<span class="ident" id="6290141">decoder</span>&nbsp;<span class="keyword" id="6290149">struct</span>&nbsp;<span class="op" id="6290156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290159">r</span>&nbsp;<span class="ident" id="6290161">reader</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290170">//&nbsp;From&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290187">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290203">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290211">width</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290227">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290232">height</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290248">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290253">flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290269">byte</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290275">headerFields</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290291">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290297">backgroundIndex</span>&nbsp;<span class="builtintype" id="6290313">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290319">loopCount</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290335">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290340">delayTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290356">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290362">//&nbsp;Unused&nbsp;from&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290386">aspect</span>&nbsp;<span class="builtintype" id="6290393">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290400">//&nbsp;From&nbsp;image&nbsp;descriptor.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290427">imageFields</span>&nbsp;<span class="builtintype" id="6290439">byte</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290446">//&nbsp;From&nbsp;graphics&nbsp;control.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290473">transparentIndex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290493">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290499">hasTransparentIndex</span>&nbsp;<span class="builtintype" id="6290519">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290526">//&nbsp;Computed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290540">pixelSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6290555">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290561">globalColorMap</span>&nbsp;<span class="ident" id="6290576">color</span><span class="op" id="6290581">.</span><span class="ident" id="6290582">Palette</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6290592">//&nbsp;Used&nbsp;when&nbsp;decoding.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290616">delay</span>&nbsp;<span class="op" id="6290622">[</span><span class="op" id="6290623">]</span><span class="builtintype" id="6290624">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290629">image</span>&nbsp;<span class="op" id="6290635">[</span><span class="op" id="6290636">]</span><span class="op" id="6290637">*</span><span class="ident" id="6290638">image</span><span class="op" id="6290643">.</span><span class="ident" id="6290644">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290654">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6290660">[</span><span class="num" id="6290661">1024</span><span class="op" id="6290665">]</span><span class="builtintype" id="6290666">byte</span>&nbsp;<span class="comment" id="6290671">//&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;768&nbsp;so&nbsp;we&nbsp;can&nbsp;read&nbsp;color&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6290720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="6290723">//&nbsp;blockReader&nbsp;parses&nbsp;the&nbsp;block&nbsp;structure&nbsp;of&nbsp;GIF&nbsp;image&nbsp;data,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="6290790">//&nbsp;comprises&nbsp;(n,&nbsp;(n&nbsp;bytes))&nbsp;blocks,&nbsp;with&nbsp;1&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;255.&nbsp;&nbsp;It&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6290857">//&nbsp;reader&nbsp;given&nbsp;to&nbsp;the&nbsp;LZW&nbsp;decoder,&nbsp;which&nbsp;is&nbsp;thus&nbsp;immune&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6290921">//&nbsp;blocking.&nbsp;&nbsp;After&nbsp;the&nbsp;LZW&nbsp;decoder&nbsp;completes,&nbsp;there&nbsp;will&nbsp;be&nbsp;a&nbsp;0-byte</span><br>
<span class="lineno"></span><span class="comment" id="6290991">//&nbsp;block&nbsp;remaining&nbsp;(0,&nbsp;()),&nbsp;which&nbsp;is&nbsp;consumed&nbsp;when&nbsp;checking&nbsp;that&nbsp;the</span><br>
<span class="lineno">100</span><span class="comment" id="6291060">//&nbsp;blockReader&nbsp;is&nbsp;exhausted.</span><br>
<span class="lineno"></span><span class="keyword" id="6291089">type</span>&nbsp;<span class="ident" id="6291094">blockReader</span>&nbsp;<span class="keyword" id="6291106">struct</span>&nbsp;<span class="op" id="6291113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291116">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6291122">reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291130">slice</span>&nbsp;<span class="op" id="6291136">[</span><span class="op" id="6291137">]</span><span class="builtintype" id="6291138">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291144">err</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6291150">error</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291157">tmp</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6291163">[</span><span class="num" id="6291164">256</span><span class="op" id="6291167">]</span><span class="builtintype" id="6291168">byte</span><br>
<span class="lineno"></span><span class="op" id="6291173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6291176">func</span>&nbsp;<span class="op" id="6291181">(</span><span class="ident" id="6291182">b</span>&nbsp;<span class="op" id="6291184">*</span><span class="ident" id="6291185">blockReader</span><span class="op" id="6291196">)</span>&nbsp;<span class="ident" id="6291198">Read</span><span class="op" id="6291202">(</span><span class="ident" id="6291203">p</span>&nbsp;<span class="op" id="6291205">[</span><span class="op" id="6291206">]</span><span class="builtintype" id="6291207">byte</span><span class="op" id="6291211">)</span>&nbsp;<span class="op" id="6291213">(</span><span class="builtintype" id="6291214">int</span><span class="op" id="6291217">,</span>&nbsp;<span class="builtintype" id="6291219">error</span><span class="op" id="6291224">)</span>&nbsp;<span class="op" id="6291226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291229">if</span>&nbsp;<span class="ident" id="6291232">b</span><span class="op" id="6291233">.</span><span class="ident" id="6291234">err</span>&nbsp;<span class="op" id="6291238">!=</span>&nbsp;<span class="ident" id="6291241">nil</span>&nbsp;<span class="op" id="6291245">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291249">return</span>&nbsp;<span class="num" id="6291256">0</span><span class="op" id="6291257">,</span>&nbsp;<span class="ident" id="6291259">b</span><span class="op" id="6291260">.</span><span class="ident" id="6291261">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291269">if</span>&nbsp;<span class="builtinfunc" id="6291272">len</span><span class="op" id="6291275">(</span><span class="ident" id="6291276">p</span><span class="op" id="6291277">)</span>&nbsp;<span class="op" id="6291279">==</span>&nbsp;<span class="num" id="6291282">0</span>&nbsp;<span class="op" id="6291284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291288">return</span>&nbsp;<span class="num" id="6291295">0</span><span class="op" id="6291296">,</span>&nbsp;<span class="ident" id="6291298">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291303">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291306">if</span>&nbsp;<span class="builtinfunc" id="6291309">len</span><span class="op" id="6291312">(</span><span class="ident" id="6291313">b</span><span class="op" id="6291314">.</span><span class="ident" id="6291315">slice</span><span class="op" id="6291320">)</span>&nbsp;<span class="op" id="6291322">==</span>&nbsp;<span class="num" id="6291325">0</span>&nbsp;<span class="op" id="6291327">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291331">var</span>&nbsp;<span class="ident" id="6291335">blockLen</span>&nbsp;<span class="builtintype" id="6291344">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291352">blockLen</span><span class="op" id="6291360">,</span>&nbsp;<span class="ident" id="6291362">b</span><span class="op" id="6291363">.</span><span class="ident" id="6291364">err</span>&nbsp;<span class="op" id="6291368">=</span>&nbsp;<span class="ident" id="6291370">b</span><span class="op" id="6291371">.</span><span class="ident" id="6291372">r</span><span class="op" id="6291373">.</span><span class="ident" id="6291374">ReadByte</span><span class="op" id="6291382">(</span><span class="op" id="6291383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291387">if</span>&nbsp;<span class="ident" id="6291390">b</span><span class="op" id="6291391">.</span><span class="ident" id="6291392">err</span>&nbsp;<span class="op" id="6291396">!=</span>&nbsp;<span class="ident" id="6291399">nil</span>&nbsp;<span class="op" id="6291403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291408">return</span>&nbsp;<span class="num" id="6291415">0</span><span class="op" id="6291416">,</span>&nbsp;<span class="ident" id="6291418">b</span><span class="op" id="6291419">.</span><span class="ident" id="6291420">err</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291430">if</span>&nbsp;<span class="ident" id="6291433">blockLen</span>&nbsp;<span class="op" id="6291442">==</span>&nbsp;<span class="num" id="6291445">0</span>&nbsp;<span class="op" id="6291447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291452">b</span><span class="op" id="6291453">.</span><span class="ident" id="6291454">err</span>&nbsp;<span class="op" id="6291458">=</span>&nbsp;<span class="ident" id="6291460">io</span><span class="op" id="6291462">.</span><span class="ident" id="6291463">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291470">return</span>&nbsp;<span class="num" id="6291477">0</span><span class="op" id="6291478">,</span>&nbsp;<span class="ident" id="6291480">b</span><span class="op" id="6291481">.</span><span class="ident" id="6291482">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291488">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291492">b</span><span class="op" id="6291493">.</span><span class="ident" id="6291494">slice</span>&nbsp;<span class="op" id="6291500">=</span>&nbsp;<span class="ident" id="6291502">b</span><span class="op" id="6291503">.</span><span class="ident" id="6291504">tmp</span><span class="op" id="6291507">[</span><span class="num" id="6291508">0</span><span class="op" id="6291509">:</span><span class="ident" id="6291510">blockLen</span><span class="op" id="6291518">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291522">if</span>&nbsp;<span class="ident" id="6291525">_</span><span class="op" id="6291526">,</span>&nbsp;<span class="ident" id="6291528">b</span><span class="op" id="6291529">.</span><span class="ident" id="6291530">err</span>&nbsp;<span class="op" id="6291534">=</span>&nbsp;<span class="ident" id="6291536">io</span><span class="op" id="6291538">.</span><span class="ident" id="6291539">ReadFull</span><span class="op" id="6291547">(</span><span class="ident" id="6291548">b</span><span class="op" id="6291549">.</span><span class="ident" id="6291550">r</span><span class="op" id="6291551">,</span>&nbsp;<span class="ident" id="6291553">b</span><span class="op" id="6291554">.</span><span class="ident" id="6291555">slice</span><span class="op" id="6291560">)</span><span class="op" id="6291561">;</span>&nbsp;<span class="ident" id="6291563">b</span><span class="op" id="6291564">.</span><span class="ident" id="6291565">err</span>&nbsp;<span class="op" id="6291569">!=</span>&nbsp;<span class="ident" id="6291572">nil</span>&nbsp;<span class="op" id="6291576">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291581">return</span>&nbsp;<span class="num" id="6291588">0</span><span class="op" id="6291589">,</span>&nbsp;<span class="ident" id="6291591">b</span><span class="op" id="6291592">.</span><span class="ident" id="6291593">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291602">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291605">n</span>&nbsp;<span class="op" id="6291607">:=</span>&nbsp;<span class="builtinfunc" id="6291610">copy</span><span class="op" id="6291614">(</span><span class="ident" id="6291615">p</span><span class="op" id="6291616">,</span>&nbsp;<span class="ident" id="6291618">b</span><span class="op" id="6291619">.</span><span class="ident" id="6291620">slice</span><span class="op" id="6291625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291628">b</span><span class="op" id="6291629">.</span><span class="ident" id="6291630">slice</span>&nbsp;<span class="op" id="6291636">=</span>&nbsp;<span class="ident" id="6291638">b</span><span class="op" id="6291639">.</span><span class="ident" id="6291640">slice</span><span class="op" id="6291645">[</span><span class="ident" id="6291646">n</span><span class="op" id="6291647">:</span><span class="op" id="6291648">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291651">return</span>&nbsp;<span class="ident" id="6291658">n</span><span class="op" id="6291659">,</span>&nbsp;<span class="ident" id="6291661">nil</span><br>
<span class="lineno"></span><span class="op" id="6291665">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="6291668">//&nbsp;decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;stores&nbsp;the&nbsp;result&nbsp;in&nbsp;d.</span><br>
<span class="lineno"></span><span class="keyword" id="6291731">func</span>&nbsp;<span class="op" id="6291736">(</span><span class="ident" id="6291737">d</span>&nbsp;<span class="op" id="6291739">*</span><span class="ident" id="6291740">decoder</span><span class="op" id="6291747">)</span>&nbsp;<span class="ident" id="6291749">decode</span><span class="op" id="6291755">(</span><span class="ident" id="6291756">r</span>&nbsp;<span class="ident" id="6291758">io</span><span class="op" id="6291760">.</span><span class="ident" id="6291761">Reader</span><span class="op" id="6291767">,</span>&nbsp;<span class="ident" id="6291769">configOnly</span>&nbsp;<span class="builtintype" id="6291780">bool</span><span class="op" id="6291784">)</span>&nbsp;<span class="builtintype" id="6291786">error</span>&nbsp;<span class="op" id="6291792">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291795">//&nbsp;Add&nbsp;buffering&nbsp;if&nbsp;r&nbsp;does&nbsp;not&nbsp;provide&nbsp;ReadByte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291845">if</span>&nbsp;<span class="ident" id="6291848">rr</span><span class="op" id="6291850">,</span>&nbsp;<span class="ident" id="6291852">ok</span>&nbsp;<span class="op" id="6291855">:=</span>&nbsp;<span class="ident" id="6291858">r</span><span class="op" id="6291859">.</span><span class="op" id="6291860">(</span><span class="ident" id="6291861">reader</span><span class="op" id="6291867">)</span><span class="op" id="6291868">;</span>&nbsp;<span class="ident" id="6291870">ok</span>&nbsp;<span class="op" id="6291873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291877">d</span><span class="op" id="6291878">.</span><span class="ident" id="6291879">r</span>&nbsp;<span class="op" id="6291881">=</span>&nbsp;<span class="ident" id="6291883">rr</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291887">}</span>&nbsp;<span class="keyword" id="6291889">else</span>&nbsp;<span class="op" id="6291894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291898">d</span><span class="op" id="6291899">.</span><span class="ident" id="6291900">r</span>&nbsp;<span class="op" id="6291902">=</span>&nbsp;<span class="ident" id="6291904">bufio</span><span class="op" id="6291909">.</span><span class="ident" id="6291910">NewReader</span><span class="op" id="6291919">(</span><span class="ident" id="6291920">r</span><span class="op" id="6291921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291928">err</span>&nbsp;<span class="op" id="6291932">:=</span>&nbsp;<span class="ident" id="6291935">d</span><span class="op" id="6291936">.</span><span class="ident" id="6291937">readHeaderAndScreenDescriptor</span><span class="op" id="6291966">(</span><span class="op" id="6291967">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291970">if</span>&nbsp;<span class="ident" id="6291973">err</span>&nbsp;<span class="op" id="6291977">!=</span>&nbsp;<span class="ident" id="6291980">nil</span>&nbsp;<span class="op" id="6291984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291988">return</span>&nbsp;<span class="ident" id="6291995">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292003">if</span>&nbsp;<span class="ident" id="6292006">configOnly</span>&nbsp;<span class="op" id="6292017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292021">return</span>&nbsp;<span class="ident" id="6292028">nil</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292037">if</span>&nbsp;<span class="ident" id="6292040">d</span><span class="op" id="6292041">.</span><span class="ident" id="6292042">headerFields</span><span class="op" id="6292054">&amp;</span><span class="ident" id="6292055">fColorMapFollows</span>&nbsp;<span class="op" id="6292072">!=</span>&nbsp;<span class="num" id="6292075">0</span>&nbsp;<span class="op" id="6292077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292081">if</span>&nbsp;<span class="ident" id="6292084">d</span><span class="op" id="6292085">.</span><span class="ident" id="6292086">globalColorMap</span><span class="op" id="6292100">,</span>&nbsp;<span class="ident" id="6292102">err</span>&nbsp;<span class="op" id="6292106">=</span>&nbsp;<span class="ident" id="6292108">d</span><span class="op" id="6292109">.</span><span class="ident" id="6292110">readColorMap</span><span class="op" id="6292122">(</span><span class="op" id="6292123">)</span><span class="op" id="6292124">;</span>&nbsp;<span class="ident" id="6292126">err</span>&nbsp;<span class="op" id="6292130">!=</span>&nbsp;<span class="ident" id="6292133">nil</span>&nbsp;<span class="op" id="6292137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292142">return</span>&nbsp;<span class="ident" id="6292149">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292162">for</span>&nbsp;<span class="op" id="6292166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292170">c</span><span class="op" id="6292171">,</span>&nbsp;<span class="ident" id="6292173">err</span>&nbsp;<span class="op" id="6292177">:=</span>&nbsp;<span class="ident" id="6292180">d</span><span class="op" id="6292181">.</span><span class="ident" id="6292182">r</span><span class="op" id="6292183">.</span><span class="ident" id="6292184">ReadByte</span><span class="op" id="6292192">(</span><span class="op" id="6292193">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292197">if</span>&nbsp;<span class="ident" id="6292200">err</span>&nbsp;<span class="op" id="6292204">!=</span>&nbsp;<span class="ident" id="6292207">nil</span>&nbsp;<span class="op" id="6292211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292216">return</span>&nbsp;<span class="ident" id="6292223">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292233">switch</span>&nbsp;<span class="ident" id="6292240">c</span>&nbsp;<span class="op" id="6292242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292246">case</span>&nbsp;<span class="ident" id="6292251">sExtension</span><span class="op" id="6292261">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292266">if</span>&nbsp;<span class="ident" id="6292269">err</span>&nbsp;<span class="op" id="6292273">=</span>&nbsp;<span class="ident" id="6292275">d</span><span class="op" id="6292276">.</span><span class="ident" id="6292277">readExtension</span><span class="op" id="6292290">(</span><span class="op" id="6292291">)</span><span class="op" id="6292292">;</span>&nbsp;<span class="ident" id="6292294">err</span>&nbsp;<span class="op" id="6292298">!=</span>&nbsp;<span class="ident" id="6292301">nil</span>&nbsp;<span class="op" id="6292305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292311">return</span>&nbsp;<span class="ident" id="6292318">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292330">case</span>&nbsp;<span class="ident" id="6292335">sImageDescriptor</span><span class="op" id="6292351">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292356">m</span><span class="op" id="6292357">,</span>&nbsp;<span class="ident" id="6292359">err</span>&nbsp;<span class="op" id="6292363">:=</span>&nbsp;<span class="ident" id="6292366">d</span><span class="op" id="6292367">.</span><span class="ident" id="6292368">newImageFromDescriptor</span><span class="op" id="6292390">(</span><span class="op" id="6292391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292396">if</span>&nbsp;<span class="ident" id="6292399">err</span>&nbsp;<span class="op" id="6292403">!=</span>&nbsp;<span class="ident" id="6292406">nil</span>&nbsp;<span class="op" id="6292410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292416">return</span>&nbsp;<span class="ident" id="6292423">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292435">useLocalColorMap</span>&nbsp;<span class="op" id="6292452">:=</span>&nbsp;<span class="ident" id="6292455">d</span><span class="op" id="6292456">.</span><span class="ident" id="6292457">imageFields</span><span class="op" id="6292468">&amp;</span><span class="ident" id="6292469">fColorMapFollows</span>&nbsp;<span class="op" id="6292486">!=</span>&nbsp;<span class="num" id="6292489">0</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292494">if</span>&nbsp;<span class="ident" id="6292497">useLocalColorMap</span>&nbsp;<span class="op" id="6292514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292520">m</span><span class="op" id="6292521">.</span><span class="ident" id="6292522">Palette</span><span class="op" id="6292529">,</span>&nbsp;<span class="ident" id="6292531">err</span>&nbsp;<span class="op" id="6292535">=</span>&nbsp;<span class="ident" id="6292537">d</span><span class="op" id="6292538">.</span><span class="ident" id="6292539">readColorMap</span><span class="op" id="6292551">(</span><span class="op" id="6292552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292558">if</span>&nbsp;<span class="ident" id="6292561">err</span>&nbsp;<span class="op" id="6292565">!=</span>&nbsp;<span class="ident" id="6292568">nil</span>&nbsp;<span class="op" id="6292572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292579">return</span>&nbsp;<span class="ident" id="6292586">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292594">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292599">}</span>&nbsp;<span class="keyword" id="6292601">else</span>&nbsp;<span class="op" id="6292606">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292612">m</span><span class="op" id="6292613">.</span><span class="ident" id="6292614">Palette</span>&nbsp;<span class="op" id="6292622">=</span>&nbsp;<span class="ident" id="6292624">d</span><span class="op" id="6292625">.</span><span class="ident" id="6292626">globalColorMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292649">if</span>&nbsp;<span class="ident" id="6292652">d</span><span class="op" id="6292653">.</span><span class="ident" id="6292654">hasTransparentIndex</span>&nbsp;<span class="op" id="6292674">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6292677">int</span><span class="op" id="6292680">(</span><span class="ident" id="6292681">d</span><span class="op" id="6292682">.</span><span class="ident" id="6292683">transparentIndex</span><span class="op" id="6292699">)</span>&nbsp;<span class="op" id="6292701">&lt;</span>&nbsp;<span class="builtinfunc" id="6292703">len</span><span class="op" id="6292706">(</span><span class="ident" id="6292707">m</span><span class="op" id="6292708">.</span><span class="ident" id="6292709">Palette</span><span class="op" id="6292716">)</span>&nbsp;<span class="op" id="6292718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292724">if</span>&nbsp;<span class="op" id="6292727">!</span><span class="ident" id="6292728">useLocalColorMap</span>&nbsp;<span class="op" id="6292745">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292752">//&nbsp;Clone&nbsp;the&nbsp;global&nbsp;color&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292788">m</span><span class="op" id="6292789">.</span><span class="ident" id="6292790">Palette</span>&nbsp;<span class="op" id="6292798">=</span>&nbsp;<span class="builtinfunc" id="6292800">append</span><span class="op" id="6292806">(</span><span class="ident" id="6292807">color</span><span class="op" id="6292812">.</span><span class="ident" id="6292813">Palette</span><span class="op" id="6292820">(</span><span class="ident" id="6292821">nil</span><span class="op" id="6292824">)</span><span class="op" id="6292825">,</span>&nbsp;<span class="ident" id="6292827">d</span><span class="op" id="6292828">.</span><span class="ident" id="6292829">globalColorMap</span><span class="op" id="6292843">...</span><span class="op" id="6292846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292858">m</span><span class="op" id="6292859">.</span><span class="ident" id="6292860">Palette</span><span class="op" id="6292867">[</span><span class="ident" id="6292868">d</span><span class="op" id="6292869">.</span><span class="ident" id="6292870">transparentIndex</span><span class="op" id="6292886">]</span>&nbsp;<span class="op" id="6292888">=</span>&nbsp;<span class="ident" id="6292890">color</span><span class="op" id="6292895">.</span><span class="ident" id="6292896">RGBA</span><span class="op" id="6292900">{</span><span class="op" id="6292901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292906">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292911">litWidth</span><span class="op" id="6292919">,</span>&nbsp;<span class="ident" id="6292921">err</span>&nbsp;<span class="op" id="6292925">:=</span>&nbsp;<span class="ident" id="6292928">d</span><span class="op" id="6292929">.</span><span class="ident" id="6292930">r</span><span class="op" id="6292931">.</span><span class="ident" id="6292932">ReadByte</span><span class="op" id="6292940">(</span><span class="op" id="6292941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292946">if</span>&nbsp;<span class="ident" id="6292949">err</span>&nbsp;<span class="op" id="6292953">!=</span>&nbsp;<span class="ident" id="6292956">nil</span>&nbsp;<span class="op" id="6292960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292966">return</span>&nbsp;<span class="ident" id="6292973">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292985">if</span>&nbsp;<span class="ident" id="6292988">litWidth</span>&nbsp;<span class="op" id="6292997">&lt;</span>&nbsp;<span class="num" id="6292999">2</span>&nbsp;<span class="op" id="6293001">||</span>&nbsp;<span class="ident" id="6293004">litWidth</span>&nbsp;<span class="op" id="6293013">&gt;</span>&nbsp;<span class="num" id="6293015">8</span>&nbsp;<span class="op" id="6293017">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293023">return</span>&nbsp;<span class="ident" id="6293030">fmt</span><span class="op" id="6293033">.</span><span class="ident" id="6293034">Errorf</span><span class="op" id="6293040">(</span><span class="string" id="6293041">&#34;gif:&nbsp;pixel&nbsp;size&nbsp;in&nbsp;decode&nbsp;out&nbsp;of&nbsp;range:&nbsp;%d&#34;</span><span class="op" id="6293085">,</span>&nbsp;<span class="ident" id="6293087">litWidth</span><span class="op" id="6293095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293105">//&nbsp;A&nbsp;wonderfully&nbsp;Go-like&nbsp;piece&nbsp;of&nbsp;magic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293149">br</span>&nbsp;<span class="op" id="6293152">:=</span>&nbsp;<span class="op" id="6293155">&amp;</span><span class="ident" id="6293156">blockReader</span><span class="op" id="6293167">{</span><span class="ident" id="6293168">r</span><span class="op" id="6293169">:</span>&nbsp;<span class="ident" id="6293171">d</span><span class="op" id="6293172">.</span><span class="ident" id="6293173">r</span><span class="op" id="6293174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293179">lzwr</span>&nbsp;<span class="op" id="6293184">:=</span>&nbsp;<span class="ident" id="6293187">lzw</span><span class="op" id="6293190">.</span><span class="ident" id="6293191">NewReader</span><span class="op" id="6293200">(</span><span class="ident" id="6293201">br</span><span class="op" id="6293203">,</span>&nbsp;<span class="ident" id="6293205">lzw</span><span class="op" id="6293208">.</span><span class="ident" id="6293209">LSB</span><span class="op" id="6293212">,</span>&nbsp;<span class="builtintype" id="6293214">int</span><span class="op" id="6293217">(</span><span class="ident" id="6293218">litWidth</span><span class="op" id="6293226">)</span><span class="op" id="6293227">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293232">defer</span>&nbsp;<span class="ident" id="6293238">lzwr</span><span class="op" id="6293242">.</span><span class="ident" id="6293243">Close</span><span class="op" id="6293248">(</span><span class="op" id="6293249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293254">if</span>&nbsp;<span class="ident" id="6293257">_</span><span class="op" id="6293258">,</span>&nbsp;<span class="ident" id="6293260">err</span>&nbsp;<span class="op" id="6293264">=</span>&nbsp;<span class="ident" id="6293266">io</span><span class="op" id="6293268">.</span><span class="ident" id="6293269">ReadFull</span><span class="op" id="6293277">(</span><span class="ident" id="6293278">lzwr</span><span class="op" id="6293282">,</span>&nbsp;<span class="ident" id="6293284">m</span><span class="op" id="6293285">.</span><span class="ident" id="6293286">Pix</span><span class="op" id="6293289">)</span><span class="op" id="6293290">;</span>&nbsp;<span class="ident" id="6293292">err</span>&nbsp;<span class="op" id="6293296">!=</span>&nbsp;<span class="ident" id="6293299">nil</span>&nbsp;<span class="op" id="6293303">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293309">if</span>&nbsp;<span class="ident" id="6293312">err</span>&nbsp;<span class="op" id="6293316">!=</span>&nbsp;<span class="ident" id="6293319">io</span><span class="op" id="6293321">.</span><span class="ident" id="6293322">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6293339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293346">return</span>&nbsp;<span class="ident" id="6293353">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293361">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293367">return</span>&nbsp;<span class="ident" id="6293374">errNotEnough</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293395">//&nbsp;Both&nbsp;lzwr&nbsp;and&nbsp;br&nbsp;should&nbsp;be&nbsp;exhausted.&nbsp;Reading&nbsp;from&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293457">//&nbsp;should&nbsp;yield&nbsp;(0,&nbsp;io.EOF).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293489">if</span>&nbsp;<span class="ident" id="6293492">n</span><span class="op" id="6293493">,</span>&nbsp;<span class="ident" id="6293495">err</span>&nbsp;<span class="op" id="6293499">:=</span>&nbsp;<span class="ident" id="6293502">lzwr</span><span class="op" id="6293506">.</span><span class="ident" id="6293507">Read</span><span class="op" id="6293511">(</span><span class="ident" id="6293512">d</span><span class="op" id="6293513">.</span><span class="ident" id="6293514">tmp</span><span class="op" id="6293517">[</span><span class="op" id="6293518">:</span><span class="num" id="6293519">1</span><span class="op" id="6293520">]</span><span class="op" id="6293521">)</span><span class="op" id="6293522">;</span>&nbsp;<span class="ident" id="6293524">n</span>&nbsp;<span class="op" id="6293526">!=</span>&nbsp;<span class="num" id="6293529">0</span>&nbsp;<span class="op" id="6293531">||</span>&nbsp;<span class="ident" id="6293534">err</span>&nbsp;<span class="op" id="6293538">!=</span>&nbsp;<span class="ident" id="6293541">io</span><span class="op" id="6293543">.</span><span class="ident" id="6293544">EOF</span>&nbsp;<span class="op" id="6293548">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293554">if</span>&nbsp;<span class="ident" id="6293557">err</span>&nbsp;<span class="op" id="6293561">!=</span>&nbsp;<span class="ident" id="6293564">nil</span>&nbsp;<span class="op" id="6293568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293575">return</span>&nbsp;<span class="ident" id="6293582">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293596">return</span>&nbsp;<span class="ident" id="6293603">errTooMuch</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293617">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293622">if</span>&nbsp;<span class="ident" id="6293625">n</span><span class="op" id="6293626">,</span>&nbsp;<span class="ident" id="6293628">err</span>&nbsp;<span class="op" id="6293632">:=</span>&nbsp;<span class="ident" id="6293635">br</span><span class="op" id="6293637">.</span><span class="ident" id="6293638">Read</span><span class="op" id="6293642">(</span><span class="ident" id="6293643">d</span><span class="op" id="6293644">.</span><span class="ident" id="6293645">tmp</span><span class="op" id="6293648">[</span><span class="op" id="6293649">:</span><span class="num" id="6293650">1</span><span class="op" id="6293651">]</span><span class="op" id="6293652">)</span><span class="op" id="6293653">;</span>&nbsp;<span class="ident" id="6293655">n</span>&nbsp;<span class="op" id="6293657">!=</span>&nbsp;<span class="num" id="6293660">0</span>&nbsp;<span class="op" id="6293662">||</span>&nbsp;<span class="ident" id="6293665">err</span>&nbsp;<span class="op" id="6293669">!=</span>&nbsp;<span class="ident" id="6293672">io</span><span class="op" id="6293674">.</span><span class="ident" id="6293675">EOF</span>&nbsp;<span class="op" id="6293679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293685">if</span>&nbsp;<span class="ident" id="6293688">err</span>&nbsp;<span class="op" id="6293692">!=</span>&nbsp;<span class="ident" id="6293695">nil</span>&nbsp;<span class="op" id="6293699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293706">return</span>&nbsp;<span class="ident" id="6293713">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293727">return</span>&nbsp;<span class="ident" id="6293734">errTooMuch</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293754">//&nbsp;Check&nbsp;that&nbsp;the&nbsp;color&nbsp;indexes&nbsp;are&nbsp;inside&nbsp;the&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293813">if</span>&nbsp;<span class="builtinfunc" id="6293816">len</span><span class="op" id="6293819">(</span><span class="ident" id="6293820">m</span><span class="op" id="6293821">.</span><span class="ident" id="6293822">Palette</span><span class="op" id="6293829">)</span>&nbsp;<span class="op" id="6293831">&lt;</span>&nbsp;<span class="num" id="6293833">256</span>&nbsp;<span class="op" id="6293837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293843">for</span>&nbsp;<span class="ident" id="6293847">_</span><span class="op" id="6293848">,</span>&nbsp;<span class="ident" id="6293850">pixel</span>&nbsp;<span class="op" id="6293856">:=</span>&nbsp;<span class="keyword" id="6293859">range</span>&nbsp;<span class="ident" id="6293865">m</span><span class="op" id="6293866">.</span><span class="ident" id="6293867">Pix</span>&nbsp;<span class="op" id="6293871">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293878">if</span>&nbsp;<span class="builtintype" id="6293881">int</span><span class="op" id="6293884">(</span><span class="ident" id="6293885">pixel</span><span class="op" id="6293890">)</span>&nbsp;<span class="op" id="6293892">&gt;=</span>&nbsp;<span class="builtinfunc" id="6293895">len</span><span class="op" id="6293898">(</span><span class="ident" id="6293899">m</span><span class="op" id="6293900">.</span><span class="ident" id="6293901">Palette</span><span class="op" id="6293908">)</span>&nbsp;<span class="op" id="6293910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293918">return</span>&nbsp;<span class="ident" id="6293925">errBadPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293953">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6293959">//&nbsp;Undo&nbsp;the&nbsp;interlacing&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294000">if</span>&nbsp;<span class="ident" id="6294003">d</span><span class="op" id="6294004">.</span><span class="ident" id="6294005">imageFields</span><span class="op" id="6294016">&amp;</span><span class="ident" id="6294017">ifInterlace</span>&nbsp;<span class="op" id="6294029">!=</span>&nbsp;<span class="num" id="6294032">0</span>&nbsp;<span class="op" id="6294034">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294040">uninterlace</span><span class="op" id="6294051">(</span><span class="ident" id="6294052">m</span><span class="op" id="6294053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294058">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294064">d</span><span class="op" id="6294065">.</span><span class="ident" id="6294066">image</span>&nbsp;<span class="op" id="6294072">=</span>&nbsp;<span class="builtinfunc" id="6294074">append</span><span class="op" id="6294080">(</span><span class="ident" id="6294081">d</span><span class="op" id="6294082">.</span><span class="ident" id="6294083">image</span><span class="op" id="6294088">,</span>&nbsp;<span class="ident" id="6294090">m</span><span class="op" id="6294091">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294096">d</span><span class="op" id="6294097">.</span><span class="ident" id="6294098">delay</span>&nbsp;<span class="op" id="6294104">=</span>&nbsp;<span class="builtinfunc" id="6294106">append</span><span class="op" id="6294112">(</span><span class="ident" id="6294113">d</span><span class="op" id="6294114">.</span><span class="ident" id="6294115">delay</span><span class="op" id="6294120">,</span>&nbsp;<span class="ident" id="6294122">d</span><span class="op" id="6294123">.</span><span class="ident" id="6294124">delayTime</span><span class="op" id="6294133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294138">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;23&nbsp;(Graphic&nbsp;Control&nbsp;Extension)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294206">//&nbsp;&#34;The&nbsp;scope&nbsp;of&nbsp;this&nbsp;extension&nbsp;is&nbsp;the&nbsp;first&nbsp;graphic&nbsp;rendering&nbsp;block</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294278">//&nbsp;to&nbsp;follow.&#34;&nbsp;We&nbsp;therefore&nbsp;reset&nbsp;the&nbsp;GCE&nbsp;fields&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294339">d</span><span class="op" id="6294340">.</span><span class="ident" id="6294341">delayTime</span>&nbsp;<span class="op" id="6294351">=</span>&nbsp;<span class="num" id="6294353">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294358">d</span><span class="op" id="6294359">.</span><span class="ident" id="6294360">hasTransparentIndex</span>&nbsp;<span class="op" id="6294380">=</span>&nbsp;<span class="builtintype" id="6294382">false</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294391">case</span>&nbsp;<span class="ident" id="6294396">sTrailer</span><span class="op" id="6294404">:</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294409">if</span>&nbsp;<span class="builtinfunc" id="6294412">len</span><span class="op" id="6294415">(</span><span class="ident" id="6294416">d</span><span class="op" id="6294417">.</span><span class="ident" id="6294418">image</span><span class="op" id="6294423">)</span>&nbsp;<span class="op" id="6294425">==</span>&nbsp;<span class="num" id="6294428">0</span>&nbsp;<span class="op" id="6294430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294436">return</span>&nbsp;<span class="ident" id="6294443">io</span><span class="op" id="6294445">.</span><span class="ident" id="6294446">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294466">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294471">return</span>&nbsp;<span class="ident" id="6294478">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294485">default</span><span class="op" id="6294492">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294497">return</span>&nbsp;<span class="ident" id="6294504">fmt</span><span class="op" id="6294507">.</span><span class="ident" id="6294508">Errorf</span><span class="op" id="6294514">(</span><span class="string" id="6294515">&#34;gif:&nbsp;unknown&nbsp;block&nbsp;type:&nbsp;0x%.2x&#34;</span><span class="op" id="6294548">,</span>&nbsp;<span class="ident" id="6294550">c</span><span class="op" id="6294551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294558">}</span><br>
<span class="lineno"></span><span class="op" id="6294560">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span><span class="keyword" id="6294563">func</span>&nbsp;<span class="op" id="6294568">(</span><span class="ident" id="6294569">d</span>&nbsp;<span class="op" id="6294571">*</span><span class="ident" id="6294572">decoder</span><span class="op" id="6294579">)</span>&nbsp;<span class="ident" id="6294581">readHeaderAndScreenDescriptor</span><span class="op" id="6294610">(</span><span class="op" id="6294611">)</span>&nbsp;<span class="builtintype" id="6294613">error</span>&nbsp;<span class="op" id="6294619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294622">_</span><span class="op" id="6294623">,</span>&nbsp;<span class="ident" id="6294625">err</span>&nbsp;<span class="op" id="6294629">:=</span>&nbsp;<span class="ident" id="6294632">io</span><span class="op" id="6294634">.</span><span class="ident" id="6294635">ReadFull</span><span class="op" id="6294643">(</span><span class="ident" id="6294644">d</span><span class="op" id="6294645">.</span><span class="ident" id="6294646">r</span><span class="op" id="6294647">,</span>&nbsp;<span class="ident" id="6294649">d</span><span class="op" id="6294650">.</span><span class="ident" id="6294651">tmp</span><span class="op" id="6294654">[</span><span class="num" id="6294655">0</span><span class="op" id="6294656">:</span><span class="num" id="6294657">13</span><span class="op" id="6294659">]</span><span class="op" id="6294660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294663">if</span>&nbsp;<span class="ident" id="6294666">err</span>&nbsp;<span class="op" id="6294670">!=</span>&nbsp;<span class="ident" id="6294673">nil</span>&nbsp;<span class="op" id="6294677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294681">return</span>&nbsp;<span class="ident" id="6294688">err</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294696">d</span><span class="op" id="6294697">.</span><span class="ident" id="6294698">vers</span>&nbsp;<span class="op" id="6294703">=</span>&nbsp;<span class="builtintype" id="6294705">string</span><span class="op" id="6294711">(</span><span class="ident" id="6294712">d</span><span class="op" id="6294713">.</span><span class="ident" id="6294714">tmp</span><span class="op" id="6294717">[</span><span class="num" id="6294718">0</span><span class="op" id="6294719">:</span><span class="num" id="6294720">6</span><span class="op" id="6294721">]</span><span class="op" id="6294722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294725">if</span>&nbsp;<span class="ident" id="6294728">d</span><span class="op" id="6294729">.</span><span class="ident" id="6294730">vers</span>&nbsp;<span class="op" id="6294735">!=</span>&nbsp;<span class="string" id="6294738">&#34;GIF87a&#34;</span>&nbsp;<span class="op" id="6294747">&amp;&amp;</span>&nbsp;<span class="ident" id="6294750">d</span><span class="op" id="6294751">.</span><span class="ident" id="6294752">vers</span>&nbsp;<span class="op" id="6294757">!=</span>&nbsp;<span class="string" id="6294760">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="6294769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294773">return</span>&nbsp;<span class="ident" id="6294780">fmt</span><span class="op" id="6294783">.</span><span class="ident" id="6294784">Errorf</span><span class="op" id="6294790">(</span><span class="string" id="6294791">&#34;gif:&nbsp;can&#39;t&nbsp;recognize&nbsp;format&nbsp;%s&#34;</span><span class="op" id="6294823">,</span>&nbsp;<span class="ident" id="6294825">d</span><span class="op" id="6294826">.</span><span class="ident" id="6294827">vers</span><span class="op" id="6294831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294834">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294837">d</span><span class="op" id="6294838">.</span><span class="ident" id="6294839">width</span>&nbsp;<span class="op" id="6294845">=</span>&nbsp;<span class="builtintype" id="6294847">int</span><span class="op" id="6294850">(</span><span class="ident" id="6294851">d</span><span class="op" id="6294852">.</span><span class="ident" id="6294853">tmp</span><span class="op" id="6294856">[</span><span class="num" id="6294857">6</span><span class="op" id="6294858">]</span><span class="op" id="6294859">)</span>&nbsp;<span class="op" id="6294861">+</span>&nbsp;<span class="builtintype" id="6294863">int</span><span class="op" id="6294866">(</span><span class="ident" id="6294867">d</span><span class="op" id="6294868">.</span><span class="ident" id="6294869">tmp</span><span class="op" id="6294872">[</span><span class="num" id="6294873">7</span><span class="op" id="6294874">]</span><span class="op" id="6294875">)</span><span class="op" id="6294876">&lt;&lt;</span><span class="num" id="6294878">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294881">d</span><span class="op" id="6294882">.</span><span class="ident" id="6294883">height</span>&nbsp;<span class="op" id="6294890">=</span>&nbsp;<span class="builtintype" id="6294892">int</span><span class="op" id="6294895">(</span><span class="ident" id="6294896">d</span><span class="op" id="6294897">.</span><span class="ident" id="6294898">tmp</span><span class="op" id="6294901">[</span><span class="num" id="6294902">8</span><span class="op" id="6294903">]</span><span class="op" id="6294904">)</span>&nbsp;<span class="op" id="6294906">+</span>&nbsp;<span class="builtintype" id="6294908">int</span><span class="op" id="6294911">(</span><span class="ident" id="6294912">d</span><span class="op" id="6294913">.</span><span class="ident" id="6294914">tmp</span><span class="op" id="6294917">[</span><span class="num" id="6294918">9</span><span class="op" id="6294919">]</span><span class="op" id="6294920">)</span><span class="op" id="6294921">&lt;&lt;</span><span class="num" id="6294923">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294926">d</span><span class="op" id="6294927">.</span><span class="ident" id="6294928">headerFields</span>&nbsp;<span class="op" id="6294941">=</span>&nbsp;<span class="ident" id="6294943">d</span><span class="op" id="6294944">.</span><span class="ident" id="6294945">tmp</span><span class="op" id="6294948">[</span><span class="num" id="6294949">10</span><span class="op" id="6294951">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294954">d</span><span class="op" id="6294955">.</span><span class="ident" id="6294956">backgroundIndex</span>&nbsp;<span class="op" id="6294972">=</span>&nbsp;<span class="ident" id="6294974">d</span><span class="op" id="6294975">.</span><span class="ident" id="6294976">tmp</span><span class="op" id="6294979">[</span><span class="num" id="6294980">11</span><span class="op" id="6294982">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294985">d</span><span class="op" id="6294986">.</span><span class="ident" id="6294987">aspect</span>&nbsp;<span class="op" id="6294994">=</span>&nbsp;<span class="ident" id="6294996">d</span><span class="op" id="6294997">.</span><span class="ident" id="6294998">tmp</span><span class="op" id="6295001">[</span><span class="num" id="6295002">12</span><span class="op" id="6295004">]</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295007">d</span><span class="op" id="6295008">.</span><span class="ident" id="6295009">loopCount</span>&nbsp;<span class="op" id="6295019">=</span>&nbsp;<span class="op" id="6295021">-</span><span class="num" id="6295022">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295025">d</span><span class="op" id="6295026">.</span><span class="ident" id="6295027">pixelSize</span>&nbsp;<span class="op" id="6295037">=</span>&nbsp;<span class="builtintype" id="6295039">uint</span><span class="op" id="6295043">(</span><span class="ident" id="6295044">d</span><span class="op" id="6295045">.</span><span class="ident" id="6295046">headerFields</span><span class="op" id="6295058">&amp;</span><span class="num" id="6295059">7</span><span class="op" id="6295060">)</span>&nbsp;<span class="op" id="6295062">+</span>&nbsp;<span class="num" id="6295064">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295067">return</span>&nbsp;<span class="ident" id="6295074">nil</span><br>
<span class="lineno"></span><span class="op" id="6295078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span><span class="keyword" id="6295081">func</span>&nbsp;<span class="op" id="6295086">(</span><span class="ident" id="6295087">d</span>&nbsp;<span class="op" id="6295089">*</span><span class="ident" id="6295090">decoder</span><span class="op" id="6295097">)</span>&nbsp;<span class="ident" id="6295099">readColorMap</span><span class="op" id="6295111">(</span><span class="op" id="6295112">)</span>&nbsp;<span class="op" id="6295114">(</span><span class="ident" id="6295115">color</span><span class="op" id="6295120">.</span><span class="ident" id="6295121">Palette</span><span class="op" id="6295128">,</span>&nbsp;<span class="builtintype" id="6295130">error</span><span class="op" id="6295135">)</span>&nbsp;<span class="op" id="6295137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295140">if</span>&nbsp;<span class="ident" id="6295143">d</span><span class="op" id="6295144">.</span><span class="ident" id="6295145">pixelSize</span>&nbsp;<span class="op" id="6295155">&gt;</span>&nbsp;<span class="num" id="6295157">8</span>&nbsp;<span class="op" id="6295159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295163">return</span>&nbsp;<span class="ident" id="6295170">nil</span><span class="op" id="6295173">,</span>&nbsp;<span class="ident" id="6295175">fmt</span><span class="op" id="6295178">.</span><span class="ident" id="6295179">Errorf</span><span class="op" id="6295185">(</span><span class="string" id="6295186">&#34;gif:&nbsp;can&#39;t&nbsp;handle&nbsp;%d&nbsp;bits&nbsp;per&nbsp;pixel&#34;</span><span class="op" id="6295223">,</span>&nbsp;<span class="ident" id="6295225">d</span><span class="op" id="6295226">.</span><span class="ident" id="6295227">pixelSize</span><span class="op" id="6295236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295242">numColors</span>&nbsp;<span class="op" id="6295252">:=</span>&nbsp;<span class="num" id="6295255">1</span>&nbsp;<span class="op" id="6295257">&lt;&lt;</span>&nbsp;<span class="ident" id="6295260">d</span><span class="op" id="6295261">.</span><span class="ident" id="6295262">pixelSize</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295273">if</span>&nbsp;<span class="ident" id="6295276">d</span><span class="op" id="6295277">.</span><span class="ident" id="6295278">imageFields</span><span class="op" id="6295289">&amp;</span><span class="ident" id="6295290">ifLocalColorTable</span>&nbsp;<span class="op" id="6295308">!=</span>&nbsp;<span class="num" id="6295311">0</span>&nbsp;<span class="op" id="6295313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295317">numColors</span>&nbsp;<span class="op" id="6295327">=</span>&nbsp;<span class="num" id="6295329">1</span>&nbsp;<span class="op" id="6295331">&lt;&lt;</span>&nbsp;<span class="op" id="6295334">(</span><span class="op" id="6295335">(</span><span class="ident" id="6295336">d</span><span class="op" id="6295337">.</span><span class="ident" id="6295338">imageFields</span>&nbsp;<span class="op" id="6295350">&amp;</span>&nbsp;<span class="ident" id="6295352">ifPixelSizeMask</span><span class="op" id="6295367">)</span>&nbsp;<span class="op" id="6295369">+</span>&nbsp;<span class="num" id="6295371">1</span><span class="op" id="6295372">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295375">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295378">numValues</span>&nbsp;<span class="op" id="6295388">:=</span>&nbsp;<span class="num" id="6295391">3</span>&nbsp;<span class="op" id="6295393">*</span>&nbsp;<span class="ident" id="6295395">numColors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295406">_</span><span class="op" id="6295407">,</span>&nbsp;<span class="ident" id="6295409">err</span>&nbsp;<span class="op" id="6295413">:=</span>&nbsp;<span class="ident" id="6295416">io</span><span class="op" id="6295418">.</span><span class="ident" id="6295419">ReadFull</span><span class="op" id="6295427">(</span><span class="ident" id="6295428">d</span><span class="op" id="6295429">.</span><span class="ident" id="6295430">r</span><span class="op" id="6295431">,</span>&nbsp;<span class="ident" id="6295433">d</span><span class="op" id="6295434">.</span><span class="ident" id="6295435">tmp</span><span class="op" id="6295438">[</span><span class="num" id="6295439">0</span><span class="op" id="6295440">:</span><span class="ident" id="6295441">numValues</span><span class="op" id="6295450">]</span><span class="op" id="6295451">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295454">if</span>&nbsp;<span class="ident" id="6295457">err</span>&nbsp;<span class="op" id="6295461">!=</span>&nbsp;<span class="ident" id="6295464">nil</span>&nbsp;<span class="op" id="6295468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295472">return</span>&nbsp;<span class="ident" id="6295479">nil</span><span class="op" id="6295482">,</span>&nbsp;<span class="ident" id="6295484">fmt</span><span class="op" id="6295487">.</span><span class="ident" id="6295488">Errorf</span><span class="op" id="6295494">(</span><span class="string" id="6295495">&#34;gif:&nbsp;short&nbsp;read&nbsp;on&nbsp;color&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="6295529">,</span>&nbsp;<span class="ident" id="6295531">err</span><span class="op" id="6295534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295537">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295540">colorMap</span>&nbsp;<span class="op" id="6295549">:=</span>&nbsp;<span class="builtinfunc" id="6295552">make</span><span class="op" id="6295556">(</span><span class="ident" id="6295557">color</span><span class="op" id="6295562">.</span><span class="ident" id="6295563">Palette</span><span class="op" id="6295570">,</span>&nbsp;<span class="ident" id="6295572">numColors</span><span class="op" id="6295581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295584">j</span>&nbsp;<span class="op" id="6295586">:=</span>&nbsp;<span class="num" id="6295589">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295592">for</span>&nbsp;<span class="ident" id="6295596">i</span>&nbsp;<span class="op" id="6295598">:=</span>&nbsp;<span class="keyword" id="6295601">range</span>&nbsp;<span class="ident" id="6295607">colorMap</span>&nbsp;<span class="op" id="6295616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295620">colorMap</span><span class="op" id="6295628">[</span><span class="ident" id="6295629">i</span><span class="op" id="6295630">]</span>&nbsp;<span class="op" id="6295632">=</span>&nbsp;<span class="ident" id="6295634">color</span><span class="op" id="6295639">.</span><span class="ident" id="6295640">RGBA</span><span class="op" id="6295644">{</span><span class="ident" id="6295645">d</span><span class="op" id="6295646">.</span><span class="ident" id="6295647">tmp</span><span class="op" id="6295650">[</span><span class="ident" id="6295651">j</span><span class="op" id="6295652">+</span><span class="num" id="6295653">0</span><span class="op" id="6295654">]</span><span class="op" id="6295655">,</span>&nbsp;<span class="ident" id="6295657">d</span><span class="op" id="6295658">.</span><span class="ident" id="6295659">tmp</span><span class="op" id="6295662">[</span><span class="ident" id="6295663">j</span><span class="op" id="6295664">+</span><span class="num" id="6295665">1</span><span class="op" id="6295666">]</span><span class="op" id="6295667">,</span>&nbsp;<span class="ident" id="6295669">d</span><span class="op" id="6295670">.</span><span class="ident" id="6295671">tmp</span><span class="op" id="6295674">[</span><span class="ident" id="6295675">j</span><span class="op" id="6295676">+</span><span class="num" id="6295677">2</span><span class="op" id="6295678">]</span><span class="op" id="6295679">,</span>&nbsp;<span class="num" id="6295681">0xFF</span><span class="op" id="6295685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295689">j</span>&nbsp;<span class="op" id="6295691">+=</span>&nbsp;<span class="num" id="6295694">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295697">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295700">return</span>&nbsp;<span class="ident" id="6295707">colorMap</span><span class="op" id="6295715">,</span>&nbsp;<span class="ident" id="6295717">nil</span><br>
<span class="lineno">295</span><span class="op" id="6295721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6295724">func</span>&nbsp;<span class="op" id="6295729">(</span><span class="ident" id="6295730">d</span>&nbsp;<span class="op" id="6295732">*</span><span class="ident" id="6295733">decoder</span><span class="op" id="6295740">)</span>&nbsp;<span class="ident" id="6295742">readExtension</span><span class="op" id="6295755">(</span><span class="op" id="6295756">)</span>&nbsp;<span class="builtintype" id="6295758">error</span>&nbsp;<span class="op" id="6295764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295767">extension</span><span class="op" id="6295776">,</span>&nbsp;<span class="ident" id="6295778">err</span>&nbsp;<span class="op" id="6295782">:=</span>&nbsp;<span class="ident" id="6295785">d</span><span class="op" id="6295786">.</span><span class="ident" id="6295787">r</span><span class="op" id="6295788">.</span><span class="ident" id="6295789">ReadByte</span><span class="op" id="6295797">(</span><span class="op" id="6295798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295801">if</span>&nbsp;<span class="ident" id="6295804">err</span>&nbsp;<span class="op" id="6295808">!=</span>&nbsp;<span class="ident" id="6295811">nil</span>&nbsp;<span class="op" id="6295815">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295819">return</span>&nbsp;<span class="ident" id="6295826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295834">size</span>&nbsp;<span class="op" id="6295839">:=</span>&nbsp;<span class="num" id="6295842">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295845">switch</span>&nbsp;<span class="ident" id="6295852">extension</span>&nbsp;<span class="op" id="6295862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295865">case</span>&nbsp;<span class="ident" id="6295870">eText</span><span class="op" id="6295875">:</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295879">size</span>&nbsp;<span class="op" id="6295884">=</span>&nbsp;<span class="num" id="6295886">13</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295890">case</span>&nbsp;<span class="ident" id="6295895">eGraphicControl</span><span class="op" id="6295910">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295914">return</span>&nbsp;<span class="ident" id="6295921">d</span><span class="op" id="6295922">.</span><span class="ident" id="6295923">readGraphicControl</span><span class="op" id="6295941">(</span><span class="op" id="6295942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295945">case</span>&nbsp;<span class="ident" id="6295950">eComment</span><span class="op" id="6295958">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295962">//&nbsp;nothing&nbsp;to&nbsp;do&nbsp;but&nbsp;read&nbsp;the&nbsp;data.</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295999">case</span>&nbsp;<span class="ident" id="6296004">eApplication</span><span class="op" id="6296016">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296020">b</span><span class="op" id="6296021">,</span>&nbsp;<span class="ident" id="6296023">err</span>&nbsp;<span class="op" id="6296027">:=</span>&nbsp;<span class="ident" id="6296030">d</span><span class="op" id="6296031">.</span><span class="ident" id="6296032">r</span><span class="op" id="6296033">.</span><span class="ident" id="6296034">ReadByte</span><span class="op" id="6296042">(</span><span class="op" id="6296043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296047">if</span>&nbsp;<span class="ident" id="6296050">err</span>&nbsp;<span class="op" id="6296054">!=</span>&nbsp;<span class="ident" id="6296057">nil</span>&nbsp;<span class="op" id="6296061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296066">return</span>&nbsp;<span class="ident" id="6296073">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296079">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296083">//&nbsp;The&nbsp;spec&nbsp;requires&nbsp;size&nbsp;be&nbsp;11,&nbsp;but&nbsp;Adobe&nbsp;sometimes&nbsp;uses&nbsp;10.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296147">size</span>&nbsp;<span class="op" id="6296152">=</span>&nbsp;<span class="builtintype" id="6296154">int</span><span class="op" id="6296157">(</span><span class="ident" id="6296158">b</span><span class="op" id="6296159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296162">default</span><span class="op" id="6296169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296173">return</span>&nbsp;<span class="ident" id="6296180">fmt</span><span class="op" id="6296183">.</span><span class="ident" id="6296184">Errorf</span><span class="op" id="6296190">(</span><span class="string" id="6296191">&#34;gif:&nbsp;unknown&nbsp;extension&nbsp;0x%.2x&#34;</span><span class="op" id="6296222">,</span>&nbsp;<span class="ident" id="6296224">extension</span><span class="op" id="6296233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296236">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296239">if</span>&nbsp;<span class="ident" id="6296242">size</span>&nbsp;<span class="op" id="6296247">&gt;</span>&nbsp;<span class="num" id="6296249">0</span>&nbsp;<span class="op" id="6296251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296255">if</span>&nbsp;<span class="ident" id="6296258">_</span><span class="op" id="6296259">,</span>&nbsp;<span class="ident" id="6296261">err</span>&nbsp;<span class="op" id="6296265">:=</span>&nbsp;<span class="ident" id="6296268">io</span><span class="op" id="6296270">.</span><span class="ident" id="6296271">ReadFull</span><span class="op" id="6296279">(</span><span class="ident" id="6296280">d</span><span class="op" id="6296281">.</span><span class="ident" id="6296282">r</span><span class="op" id="6296283">,</span>&nbsp;<span class="ident" id="6296285">d</span><span class="op" id="6296286">.</span><span class="ident" id="6296287">tmp</span><span class="op" id="6296290">[</span><span class="num" id="6296291">0</span><span class="op" id="6296292">:</span><span class="ident" id="6296293">size</span><span class="op" id="6296297">]</span><span class="op" id="6296298">)</span><span class="op" id="6296299">;</span>&nbsp;<span class="ident" id="6296301">err</span>&nbsp;<span class="op" id="6296305">!=</span>&nbsp;<span class="ident" id="6296308">nil</span>&nbsp;<span class="op" id="6296312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296317">return</span>&nbsp;<span class="ident" id="6296324">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296330">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296333">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296337">//&nbsp;Application&nbsp;Extension&nbsp;with&nbsp;&#34;NETSCAPE2.0&#34;&nbsp;as&nbsp;string&nbsp;and&nbsp;1&nbsp;in&nbsp;data&nbsp;means</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6296412">//&nbsp;this&nbsp;extension&nbsp;defines&nbsp;a&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296453">if</span>&nbsp;<span class="ident" id="6296456">extension</span>&nbsp;<span class="op" id="6296466">==</span>&nbsp;<span class="ident" id="6296469">eApplication</span>&nbsp;<span class="op" id="6296482">&amp;&amp;</span>&nbsp;<span class="builtintype" id="6296485">string</span><span class="op" id="6296491">(</span><span class="ident" id="6296492">d</span><span class="op" id="6296493">.</span><span class="ident" id="6296494">tmp</span><span class="op" id="6296497">[</span><span class="op" id="6296498">:</span><span class="ident" id="6296499">size</span><span class="op" id="6296503">]</span><span class="op" id="6296504">)</span>&nbsp;<span class="op" id="6296506">==</span>&nbsp;<span class="string" id="6296509">&#34;NETSCAPE2.0&#34;</span>&nbsp;<span class="op" id="6296523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296527">n</span><span class="op" id="6296528">,</span>&nbsp;<span class="ident" id="6296530">err</span>&nbsp;<span class="op" id="6296534">:=</span>&nbsp;<span class="ident" id="6296537">d</span><span class="op" id="6296538">.</span><span class="ident" id="6296539">readBlock</span><span class="op" id="6296548">(</span><span class="op" id="6296549">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296553">if</span>&nbsp;<span class="ident" id="6296556">n</span>&nbsp;<span class="op" id="6296558">==</span>&nbsp;<span class="num" id="6296561">0</span>&nbsp;<span class="op" id="6296563">||</span>&nbsp;<span class="ident" id="6296566">err</span>&nbsp;<span class="op" id="6296570">!=</span>&nbsp;<span class="ident" id="6296573">nil</span>&nbsp;<span class="op" id="6296577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296582">return</span>&nbsp;<span class="ident" id="6296589">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296599">if</span>&nbsp;<span class="ident" id="6296602">n</span>&nbsp;<span class="op" id="6296604">==</span>&nbsp;<span class="num" id="6296607">3</span>&nbsp;<span class="op" id="6296609">&amp;&amp;</span>&nbsp;<span class="ident" id="6296612">d</span><span class="op" id="6296613">.</span><span class="ident" id="6296614">tmp</span><span class="op" id="6296617">[</span><span class="num" id="6296618">0</span><span class="op" id="6296619">]</span>&nbsp;<span class="op" id="6296621">==</span>&nbsp;<span class="num" id="6296624">1</span>&nbsp;<span class="op" id="6296626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296631">d</span><span class="op" id="6296632">.</span><span class="ident" id="6296633">loopCount</span>&nbsp;<span class="op" id="6296643">=</span>&nbsp;<span class="builtintype" id="6296645">int</span><span class="op" id="6296648">(</span><span class="ident" id="6296649">d</span><span class="op" id="6296650">.</span><span class="ident" id="6296651">tmp</span><span class="op" id="6296654">[</span><span class="num" id="6296655">1</span><span class="op" id="6296656">]</span><span class="op" id="6296657">)</span>&nbsp;<span class="op" id="6296659">|</span>&nbsp;<span class="builtintype" id="6296661">int</span><span class="op" id="6296664">(</span><span class="ident" id="6296665">d</span><span class="op" id="6296666">.</span><span class="ident" id="6296667">tmp</span><span class="op" id="6296670">[</span><span class="num" id="6296671">2</span><span class="op" id="6296672">]</span><span class="op" id="6296673">)</span><span class="op" id="6296674">&lt;&lt;</span><span class="num" id="6296676">8</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296686">for</span>&nbsp;<span class="op" id="6296690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296694">n</span><span class="op" id="6296695">,</span>&nbsp;<span class="ident" id="6296697">err</span>&nbsp;<span class="op" id="6296701">:=</span>&nbsp;<span class="ident" id="6296704">d</span><span class="op" id="6296705">.</span><span class="ident" id="6296706">readBlock</span><span class="op" id="6296715">(</span><span class="op" id="6296716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296720">if</span>&nbsp;<span class="ident" id="6296723">n</span>&nbsp;<span class="op" id="6296725">==</span>&nbsp;<span class="num" id="6296728">0</span>&nbsp;<span class="op" id="6296730">||</span>&nbsp;<span class="ident" id="6296733">err</span>&nbsp;<span class="op" id="6296737">!=</span>&nbsp;<span class="ident" id="6296740">nil</span>&nbsp;<span class="op" id="6296744">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296749">return</span>&nbsp;<span class="ident" id="6296756">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296765">}</span><br>
<span class="lineno"></span><span class="op" id="6296767">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="6296770">func</span>&nbsp;<span class="op" id="6296775">(</span><span class="ident" id="6296776">d</span>&nbsp;<span class="op" id="6296778">*</span><span class="ident" id="6296779">decoder</span><span class="op" id="6296786">)</span>&nbsp;<span class="ident" id="6296788">readGraphicControl</span><span class="op" id="6296806">(</span><span class="op" id="6296807">)</span>&nbsp;<span class="builtintype" id="6296809">error</span>&nbsp;<span class="op" id="6296815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296818">if</span>&nbsp;<span class="ident" id="6296821">_</span><span class="op" id="6296822">,</span>&nbsp;<span class="ident" id="6296824">err</span>&nbsp;<span class="op" id="6296828">:=</span>&nbsp;<span class="ident" id="6296831">io</span><span class="op" id="6296833">.</span><span class="ident" id="6296834">ReadFull</span><span class="op" id="6296842">(</span><span class="ident" id="6296843">d</span><span class="op" id="6296844">.</span><span class="ident" id="6296845">r</span><span class="op" id="6296846">,</span>&nbsp;<span class="ident" id="6296848">d</span><span class="op" id="6296849">.</span><span class="ident" id="6296850">tmp</span><span class="op" id="6296853">[</span><span class="num" id="6296854">0</span><span class="op" id="6296855">:</span><span class="num" id="6296856">6</span><span class="op" id="6296857">]</span><span class="op" id="6296858">)</span><span class="op" id="6296859">;</span>&nbsp;<span class="ident" id="6296861">err</span>&nbsp;<span class="op" id="6296865">!=</span>&nbsp;<span class="ident" id="6296868">nil</span>&nbsp;<span class="op" id="6296872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296876">return</span>&nbsp;<span class="ident" id="6296883">fmt</span><span class="op" id="6296886">.</span><span class="ident" id="6296887">Errorf</span><span class="op" id="6296893">(</span><span class="string" id="6296894">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;graphic&nbsp;control:&nbsp;%s&#34;</span><span class="op" id="6296931">,</span>&nbsp;<span class="ident" id="6296933">err</span><span class="op" id="6296936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296942">d</span><span class="op" id="6296943">.</span><span class="ident" id="6296944">flags</span>&nbsp;<span class="op" id="6296950">=</span>&nbsp;<span class="ident" id="6296952">d</span><span class="op" id="6296953">.</span><span class="ident" id="6296954">tmp</span><span class="op" id="6296957">[</span><span class="num" id="6296958">1</span><span class="op" id="6296959">]</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296962">d</span><span class="op" id="6296963">.</span><span class="ident" id="6296964">delayTime</span>&nbsp;<span class="op" id="6296974">=</span>&nbsp;<span class="builtintype" id="6296976">int</span><span class="op" id="6296979">(</span><span class="ident" id="6296980">d</span><span class="op" id="6296981">.</span><span class="ident" id="6296982">tmp</span><span class="op" id="6296985">[</span><span class="num" id="6296986">2</span><span class="op" id="6296987">]</span><span class="op" id="6296988">)</span>&nbsp;<span class="op" id="6296990">|</span>&nbsp;<span class="builtintype" id="6296992">int</span><span class="op" id="6296995">(</span><span class="ident" id="6296996">d</span><span class="op" id="6296997">.</span><span class="ident" id="6296998">tmp</span><span class="op" id="6297001">[</span><span class="num" id="6297002">3</span><span class="op" id="6297003">]</span><span class="op" id="6297004">)</span><span class="op" id="6297005">&lt;&lt;</span><span class="num" id="6297007">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297010">if</span>&nbsp;<span class="ident" id="6297013">d</span><span class="op" id="6297014">.</span><span class="ident" id="6297015">flags</span><span class="op" id="6297020">&amp;</span><span class="ident" id="6297021">gcTransparentColorSet</span>&nbsp;<span class="op" id="6297043">!=</span>&nbsp;<span class="num" id="6297046">0</span>&nbsp;<span class="op" id="6297048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297052">d</span><span class="op" id="6297053">.</span><span class="ident" id="6297054">transparentIndex</span>&nbsp;<span class="op" id="6297071">=</span>&nbsp;<span class="ident" id="6297073">d</span><span class="op" id="6297074">.</span><span class="ident" id="6297075">tmp</span><span class="op" id="6297078">[</span><span class="num" id="6297079">4</span><span class="op" id="6297080">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297084">d</span><span class="op" id="6297085">.</span><span class="ident" id="6297086">hasTransparentIndex</span>&nbsp;<span class="op" id="6297106">=</span>&nbsp;<span class="builtintype" id="6297108">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297114">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297117">return</span>&nbsp;<span class="ident" id="6297124">nil</span><br>
<span class="lineno"></span><span class="op" id="6297128">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297131">func</span>&nbsp;<span class="op" id="6297136">(</span><span class="ident" id="6297137">d</span>&nbsp;<span class="op" id="6297139">*</span><span class="ident" id="6297140">decoder</span><span class="op" id="6297147">)</span>&nbsp;<span class="ident" id="6297149">newImageFromDescriptor</span><span class="op" id="6297171">(</span><span class="op" id="6297172">)</span>&nbsp;<span class="op" id="6297174">(</span><span class="op" id="6297175">*</span><span class="ident" id="6297176">image</span><span class="op" id="6297181">.</span><span class="ident" id="6297182">Paletted</span><span class="op" id="6297190">,</span>&nbsp;<span class="builtintype" id="6297192">error</span><span class="op" id="6297197">)</span>&nbsp;<span class="op" id="6297199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297202">if</span>&nbsp;<span class="ident" id="6297205">_</span><span class="op" id="6297206">,</span>&nbsp;<span class="ident" id="6297208">err</span>&nbsp;<span class="op" id="6297212">:=</span>&nbsp;<span class="ident" id="6297215">io</span><span class="op" id="6297217">.</span><span class="ident" id="6297218">ReadFull</span><span class="op" id="6297226">(</span><span class="ident" id="6297227">d</span><span class="op" id="6297228">.</span><span class="ident" id="6297229">r</span><span class="op" id="6297230">,</span>&nbsp;<span class="ident" id="6297232">d</span><span class="op" id="6297233">.</span><span class="ident" id="6297234">tmp</span><span class="op" id="6297237">[</span><span class="num" id="6297238">0</span><span class="op" id="6297239">:</span><span class="num" id="6297240">9</span><span class="op" id="6297241">]</span><span class="op" id="6297242">)</span><span class="op" id="6297243">;</span>&nbsp;<span class="ident" id="6297245">err</span>&nbsp;<span class="op" id="6297249">!=</span>&nbsp;<span class="ident" id="6297252">nil</span>&nbsp;<span class="op" id="6297256">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297260">return</span>&nbsp;<span class="ident" id="6297267">nil</span><span class="op" id="6297270">,</span>&nbsp;<span class="ident" id="6297272">fmt</span><span class="op" id="6297275">.</span><span class="ident" id="6297276">Errorf</span><span class="op" id="6297282">(</span><span class="string" id="6297283">&#34;gif:&nbsp;can&#39;t&nbsp;read&nbsp;image&nbsp;descriptor:&nbsp;%s&#34;</span><span class="op" id="6297321">,</span>&nbsp;<span class="ident" id="6297323">err</span><span class="op" id="6297326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297332">left</span>&nbsp;<span class="op" id="6297337">:=</span>&nbsp;<span class="builtintype" id="6297340">int</span><span class="op" id="6297343">(</span><span class="ident" id="6297344">d</span><span class="op" id="6297345">.</span><span class="ident" id="6297346">tmp</span><span class="op" id="6297349">[</span><span class="num" id="6297350">0</span><span class="op" id="6297351">]</span><span class="op" id="6297352">)</span>&nbsp;<span class="op" id="6297354">+</span>&nbsp;<span class="builtintype" id="6297356">int</span><span class="op" id="6297359">(</span><span class="ident" id="6297360">d</span><span class="op" id="6297361">.</span><span class="ident" id="6297362">tmp</span><span class="op" id="6297365">[</span><span class="num" id="6297366">1</span><span class="op" id="6297367">]</span><span class="op" id="6297368">)</span><span class="op" id="6297369">&lt;&lt;</span><span class="num" id="6297371">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297374">top</span>&nbsp;<span class="op" id="6297378">:=</span>&nbsp;<span class="builtintype" id="6297381">int</span><span class="op" id="6297384">(</span><span class="ident" id="6297385">d</span><span class="op" id="6297386">.</span><span class="ident" id="6297387">tmp</span><span class="op" id="6297390">[</span><span class="num" id="6297391">2</span><span class="op" id="6297392">]</span><span class="op" id="6297393">)</span>&nbsp;<span class="op" id="6297395">+</span>&nbsp;<span class="builtintype" id="6297397">int</span><span class="op" id="6297400">(</span><span class="ident" id="6297401">d</span><span class="op" id="6297402">.</span><span class="ident" id="6297403">tmp</span><span class="op" id="6297406">[</span><span class="num" id="6297407">3</span><span class="op" id="6297408">]</span><span class="op" id="6297409">)</span><span class="op" id="6297410">&lt;&lt;</span><span class="num" id="6297412">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297415">width</span>&nbsp;<span class="op" id="6297421">:=</span>&nbsp;<span class="builtintype" id="6297424">int</span><span class="op" id="6297427">(</span><span class="ident" id="6297428">d</span><span class="op" id="6297429">.</span><span class="ident" id="6297430">tmp</span><span class="op" id="6297433">[</span><span class="num" id="6297434">4</span><span class="op" id="6297435">]</span><span class="op" id="6297436">)</span>&nbsp;<span class="op" id="6297438">+</span>&nbsp;<span class="builtintype" id="6297440">int</span><span class="op" id="6297443">(</span><span class="ident" id="6297444">d</span><span class="op" id="6297445">.</span><span class="ident" id="6297446">tmp</span><span class="op" id="6297449">[</span><span class="num" id="6297450">5</span><span class="op" id="6297451">]</span><span class="op" id="6297452">)</span><span class="op" id="6297453">&lt;&lt;</span><span class="num" id="6297455">8</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297458">height</span>&nbsp;<span class="op" id="6297465">:=</span>&nbsp;<span class="builtintype" id="6297468">int</span><span class="op" id="6297471">(</span><span class="ident" id="6297472">d</span><span class="op" id="6297473">.</span><span class="ident" id="6297474">tmp</span><span class="op" id="6297477">[</span><span class="num" id="6297478">6</span><span class="op" id="6297479">]</span><span class="op" id="6297480">)</span>&nbsp;<span class="op" id="6297482">+</span>&nbsp;<span class="builtintype" id="6297484">int</span><span class="op" id="6297487">(</span><span class="ident" id="6297488">d</span><span class="op" id="6297489">.</span><span class="ident" id="6297490">tmp</span><span class="op" id="6297493">[</span><span class="num" id="6297494">7</span><span class="op" id="6297495">]</span><span class="op" id="6297496">)</span><span class="op" id="6297497">&lt;&lt;</span><span class="num" id="6297499">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297502">d</span><span class="op" id="6297503">.</span><span class="ident" id="6297504">imageFields</span>&nbsp;<span class="op" id="6297516">=</span>&nbsp;<span class="ident" id="6297518">d</span><span class="op" id="6297519">.</span><span class="ident" id="6297520">tmp</span><span class="op" id="6297523">[</span><span class="num" id="6297524">8</span><span class="op" id="6297525">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297529">//&nbsp;The&nbsp;GIF89a&nbsp;spec,&nbsp;Section&nbsp;20&nbsp;(Image&nbsp;Descriptor)&nbsp;says:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297586">//&nbsp;&#34;Each&nbsp;image&nbsp;must&nbsp;fit&nbsp;within&nbsp;the&nbsp;boundaries&nbsp;of&nbsp;the&nbsp;Logical</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297648">//&nbsp;Screen,&nbsp;as&nbsp;defined&nbsp;in&nbsp;the&nbsp;Logical&nbsp;Screen&nbsp;Descriptor.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297706">bounds</span>&nbsp;<span class="op" id="6297713">:=</span>&nbsp;<span class="ident" id="6297716">image</span><span class="op" id="6297721">.</span><span class="ident" id="6297722">Rect</span><span class="op" id="6297726">(</span><span class="ident" id="6297727">left</span><span class="op" id="6297731">,</span>&nbsp;<span class="ident" id="6297733">top</span><span class="op" id="6297736">,</span>&nbsp;<span class="ident" id="6297738">left</span><span class="op" id="6297742">+</span><span class="ident" id="6297743">width</span><span class="op" id="6297748">,</span>&nbsp;<span class="ident" id="6297750">top</span><span class="op" id="6297753">+</span><span class="ident" id="6297754">height</span><span class="op" id="6297760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297763">if</span>&nbsp;<span class="ident" id="6297766">bounds</span>&nbsp;<span class="op" id="6297773">!=</span>&nbsp;<span class="ident" id="6297776">bounds</span><span class="op" id="6297782">.</span><span class="ident" id="6297783">Intersect</span><span class="op" id="6297792">(</span><span class="ident" id="6297793">image</span><span class="op" id="6297798">.</span><span class="ident" id="6297799">Rect</span><span class="op" id="6297803">(</span><span class="num" id="6297804">0</span><span class="op" id="6297805">,</span>&nbsp;<span class="num" id="6297807">0</span><span class="op" id="6297808">,</span>&nbsp;<span class="ident" id="6297810">d</span><span class="op" id="6297811">.</span><span class="ident" id="6297812">width</span><span class="op" id="6297817">,</span>&nbsp;<span class="ident" id="6297819">d</span><span class="op" id="6297820">.</span><span class="ident" id="6297821">height</span><span class="op" id="6297827">)</span><span class="op" id="6297828">)</span>&nbsp;<span class="op" id="6297830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297834">return</span>&nbsp;<span class="ident" id="6297841">nil</span><span class="op" id="6297844">,</span>&nbsp;<span class="ident" id="6297846">errors</span><span class="op" id="6297852">.</span><span class="ident" id="6297853">New</span><span class="op" id="6297856">(</span><span class="string" id="6297857">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><span class="op" id="6297901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297904">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297907">return</span>&nbsp;<span class="ident" id="6297914">image</span><span class="op" id="6297919">.</span><span class="ident" id="6297920">NewPaletted</span><span class="op" id="6297931">(</span><span class="ident" id="6297932">bounds</span><span class="op" id="6297938">,</span>&nbsp;<span class="ident" id="6297940">nil</span><span class="op" id="6297943">)</span><span class="op" id="6297944">,</span>&nbsp;<span class="ident" id="6297946">nil</span><br>
<span class="lineno"></span><span class="op" id="6297950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6297953">func</span>&nbsp;<span class="op" id="6297958">(</span><span class="ident" id="6297959">d</span>&nbsp;<span class="op" id="6297961">*</span><span class="ident" id="6297962">decoder</span><span class="op" id="6297969">)</span>&nbsp;<span class="ident" id="6297971">readBlock</span><span class="op" id="6297980">(</span><span class="op" id="6297981">)</span>&nbsp;<span class="op" id="6297983">(</span><span class="builtintype" id="6297984">int</span><span class="op" id="6297987">,</span>&nbsp;<span class="builtintype" id="6297989">error</span><span class="op" id="6297994">)</span>&nbsp;<span class="op" id="6297996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297999">n</span><span class="op" id="6298000">,</span>&nbsp;<span class="ident" id="6298002">err</span>&nbsp;<span class="op" id="6298006">:=</span>&nbsp;<span class="ident" id="6298009">d</span><span class="op" id="6298010">.</span><span class="ident" id="6298011">r</span><span class="op" id="6298012">.</span><span class="ident" id="6298013">ReadByte</span><span class="op" id="6298021">(</span><span class="op" id="6298022">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298025">if</span>&nbsp;<span class="ident" id="6298028">n</span>&nbsp;<span class="op" id="6298030">==</span>&nbsp;<span class="num" id="6298033">0</span>&nbsp;<span class="op" id="6298035">||</span>&nbsp;<span class="ident" id="6298038">err</span>&nbsp;<span class="op" id="6298042">!=</span>&nbsp;<span class="ident" id="6298045">nil</span>&nbsp;<span class="op" id="6298049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298053">return</span>&nbsp;<span class="num" id="6298060">0</span><span class="op" id="6298061">,</span>&nbsp;<span class="ident" id="6298063">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298071">return</span>&nbsp;<span class="ident" id="6298078">io</span><span class="op" id="6298080">.</span><span class="ident" id="6298081">ReadFull</span><span class="op" id="6298089">(</span><span class="ident" id="6298090">d</span><span class="op" id="6298091">.</span><span class="ident" id="6298092">r</span><span class="op" id="6298093">,</span>&nbsp;<span class="ident" id="6298095">d</span><span class="op" id="6298096">.</span><span class="ident" id="6298097">tmp</span><span class="op" id="6298100">[</span><span class="num" id="6298101">0</span><span class="op" id="6298102">:</span><span class="ident" id="6298103">n</span><span class="op" id="6298104">]</span><span class="op" id="6298105">)</span><br>
<span class="lineno"></span><span class="op" id="6298107">}</span><br>
<span class="lineno">385</span><br>
<span class="lineno"></span><span class="comment" id="6298110">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;ordering&nbsp;for&nbsp;a&nbsp;pass&nbsp;of&nbsp;the&nbsp;interlace&nbsp;algorithm.</span><br>
<span class="lineno"></span><span class="keyword" id="6298187">type</span>&nbsp;<span class="ident" id="6298192">interlaceScan</span>&nbsp;<span class="keyword" id="6298206">struct</span>&nbsp;<span class="op" id="6298213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298216">skip</span><span class="op" id="6298220">,</span>&nbsp;<span class="ident" id="6298222">start</span>&nbsp;<span class="builtintype" id="6298228">int</span><br>
<span class="lineno"></span><span class="op" id="6298232">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span><span class="comment" id="6298235">//&nbsp;interlacing&nbsp;represents&nbsp;the&nbsp;set&nbsp;of&nbsp;scans&nbsp;in&nbsp;an&nbsp;interlaced&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6298306">var</span>&nbsp;<span class="ident" id="6298310">interlacing</span>&nbsp;<span class="op" id="6298322">=</span>&nbsp;<span class="op" id="6298324">[</span><span class="op" id="6298325">]</span><span class="ident" id="6298326">interlaceScan</span><span class="op" id="6298339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298342">{</span><span class="num" id="6298343">8</span><span class="op" id="6298344">,</span>&nbsp;<span class="num" id="6298346">0</span><span class="op" id="6298347">}</span><span class="op" id="6298348">,</span>&nbsp;<span class="comment" id="6298350">//&nbsp;Group&nbsp;1&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298401">{</span><span class="num" id="6298402">8</span><span class="op" id="6298403">,</span>&nbsp;<span class="num" id="6298405">4</span><span class="op" id="6298406">}</span><span class="op" id="6298407">,</span>&nbsp;<span class="comment" id="6298409">//&nbsp;Group&nbsp;2&nbsp;:&nbsp;Every&nbsp;8th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;4.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298460">{</span><span class="num" id="6298461">4</span><span class="op" id="6298462">,</span>&nbsp;<span class="num" id="6298464">2</span><span class="op" id="6298465">}</span><span class="op" id="6298466">,</span>&nbsp;<span class="comment" id="6298468">//&nbsp;Group&nbsp;3&nbsp;:&nbsp;Every&nbsp;4th.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298519">{</span><span class="num" id="6298520">2</span><span class="op" id="6298521">,</span>&nbsp;<span class="num" id="6298523">1</span><span class="op" id="6298524">}</span><span class="op" id="6298525">,</span>&nbsp;<span class="comment" id="6298527">//&nbsp;Group&nbsp;4&nbsp;:&nbsp;Every&nbsp;2nd.&nbsp;row,&nbsp;starting&nbsp;with&nbsp;row&nbsp;1.</span><br>
<span class="lineno"></span><span class="op" id="6298577">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6298580">//&nbsp;uninterlace&nbsp;rearranges&nbsp;the&nbsp;pixels&nbsp;in&nbsp;m&nbsp;to&nbsp;account&nbsp;for&nbsp;interlaced&nbsp;input.</span><br>
<span class="lineno">400</span><span class="keyword" id="6298655">func</span>&nbsp;<span class="ident" id="6298660">uninterlace</span><span class="op" id="6298671">(</span><span class="ident" id="6298672">m</span>&nbsp;<span class="op" id="6298674">*</span><span class="ident" id="6298675">image</span><span class="op" id="6298680">.</span><span class="ident" id="6298681">Paletted</span><span class="op" id="6298689">)</span>&nbsp;<span class="op" id="6298691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298694">var</span>&nbsp;<span class="ident" id="6298698">nPix</span>&nbsp;<span class="op" id="6298703">[</span><span class="op" id="6298704">]</span><span class="builtintype" id="6298705">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298712">dx</span>&nbsp;<span class="op" id="6298715">:=</span>&nbsp;<span class="ident" id="6298718">m</span><span class="op" id="6298719">.</span><span class="ident" id="6298720">Bounds</span><span class="op" id="6298726">(</span><span class="op" id="6298727">)</span><span class="op" id="6298728">.</span><span class="ident" id="6298729">Dx</span><span class="op" id="6298731">(</span><span class="op" id="6298732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298735">dy</span>&nbsp;<span class="op" id="6298738">:=</span>&nbsp;<span class="ident" id="6298741">m</span><span class="op" id="6298742">.</span><span class="ident" id="6298743">Bounds</span><span class="op" id="6298749">(</span><span class="op" id="6298750">)</span><span class="op" id="6298751">.</span><span class="ident" id="6298752">Dy</span><span class="op" id="6298754">(</span><span class="op" id="6298755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298758">nPix</span>&nbsp;<span class="op" id="6298763">=</span>&nbsp;<span class="builtinfunc" id="6298765">make</span><span class="op" id="6298769">(</span><span class="op" id="6298770">[</span><span class="op" id="6298771">]</span><span class="builtintype" id="6298772">uint8</span><span class="op" id="6298777">,</span>&nbsp;<span class="ident" id="6298779">dx</span><span class="op" id="6298781">*</span><span class="ident" id="6298782">dy</span><span class="op" id="6298784">)</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298787">offset</span>&nbsp;<span class="op" id="6298794">:=</span>&nbsp;<span class="num" id="6298797">0</span>&nbsp;<span class="comment" id="6298799">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;input&nbsp;by&nbsp;sequential&nbsp;scan&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298853">for</span>&nbsp;<span class="ident" id="6298857">_</span><span class="op" id="6298858">,</span>&nbsp;<span class="ident" id="6298860">pass</span>&nbsp;<span class="op" id="6298865">:=</span>&nbsp;<span class="keyword" id="6298868">range</span>&nbsp;<span class="ident" id="6298874">interlacing</span>&nbsp;<span class="op" id="6298886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298890">nOffset</span>&nbsp;<span class="op" id="6298898">:=</span>&nbsp;<span class="ident" id="6298901">pass</span><span class="op" id="6298905">.</span><span class="ident" id="6298906">start</span>&nbsp;<span class="op" id="6298912">*</span>&nbsp;<span class="ident" id="6298914">dx</span>&nbsp;<span class="comment" id="6298917">//&nbsp;steps&nbsp;through&nbsp;the&nbsp;output&nbsp;as&nbsp;defined&nbsp;by&nbsp;pass.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298967">for</span>&nbsp;<span class="ident" id="6298971">y</span>&nbsp;<span class="op" id="6298973">:=</span>&nbsp;<span class="ident" id="6298976">pass</span><span class="op" id="6298980">.</span><span class="ident" id="6298981">start</span><span class="op" id="6298986">;</span>&nbsp;<span class="ident" id="6298988">y</span>&nbsp;<span class="op" id="6298990">&lt;</span>&nbsp;<span class="ident" id="6298992">dy</span><span class="op" id="6298994">;</span>&nbsp;<span class="ident" id="6298996">y</span>&nbsp;<span class="op" id="6298998">+=</span>&nbsp;<span class="ident" id="6299001">pass</span><span class="op" id="6299005">.</span><span class="ident" id="6299006">skip</span>&nbsp;<span class="op" id="6299011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6299016">copy</span><span class="op" id="6299020">(</span><span class="ident" id="6299021">nPix</span><span class="op" id="6299025">[</span><span class="ident" id="6299026">nOffset</span><span class="op" id="6299033">:</span><span class="ident" id="6299034">nOffset</span><span class="op" id="6299041">+</span><span class="ident" id="6299042">dx</span><span class="op" id="6299044">]</span><span class="op" id="6299045">,</span>&nbsp;<span class="ident" id="6299047">m</span><span class="op" id="6299048">.</span><span class="ident" id="6299049">Pix</span><span class="op" id="6299052">[</span><span class="ident" id="6299053">offset</span><span class="op" id="6299059">:</span><span class="ident" id="6299060">offset</span><span class="op" id="6299066">+</span><span class="ident" id="6299067">dx</span><span class="op" id="6299069">]</span><span class="op" id="6299070">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299075">offset</span>&nbsp;<span class="op" id="6299082">+=</span>&nbsp;<span class="ident" id="6299085">dx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299091">nOffset</span>&nbsp;<span class="op" id="6299099">+=</span>&nbsp;<span class="ident" id="6299102">dx</span>&nbsp;<span class="op" id="6299105">*</span>&nbsp;<span class="ident" id="6299107">pass</span><span class="op" id="6299111">.</span><span class="ident" id="6299112">skip</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299119">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299125">m</span><span class="op" id="6299126">.</span><span class="ident" id="6299127">Pix</span>&nbsp;<span class="op" id="6299131">=</span>&nbsp;<span class="ident" id="6299133">nPix</span><br>
<span class="lineno">415</span><span class="op" id="6299138">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299141">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;first&nbsp;embedded</span><br>
<span class="lineno"></span><span class="comment" id="6299207">//&nbsp;image&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="keyword" id="6299235">func</span>&nbsp;<span class="ident" id="6299240">Decode</span><span class="op" id="6299246">(</span><span class="ident" id="6299247">r</span>&nbsp;<span class="ident" id="6299249">io</span><span class="op" id="6299251">.</span><span class="ident" id="6299252">Reader</span><span class="op" id="6299258">)</span>&nbsp;<span class="op" id="6299260">(</span><span class="ident" id="6299261">image</span><span class="op" id="6299266">.</span><span class="ident" id="6299267">Image</span><span class="op" id="6299272">,</span>&nbsp;<span class="builtintype" id="6299274">error</span><span class="op" id="6299279">)</span>&nbsp;<span class="op" id="6299281">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299284">var</span>&nbsp;<span class="ident" id="6299288">d</span>&nbsp;<span class="ident" id="6299290">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299299">if</span>&nbsp;<span class="ident" id="6299302">err</span>&nbsp;<span class="op" id="6299306">:=</span>&nbsp;<span class="ident" id="6299309">d</span><span class="op" id="6299310">.</span><span class="ident" id="6299311">decode</span><span class="op" id="6299317">(</span><span class="ident" id="6299318">r</span><span class="op" id="6299319">,</span>&nbsp;<span class="builtintype" id="6299321">false</span><span class="op" id="6299326">)</span><span class="op" id="6299327">;</span>&nbsp;<span class="ident" id="6299329">err</span>&nbsp;<span class="op" id="6299333">!=</span>&nbsp;<span class="ident" id="6299336">nil</span>&nbsp;<span class="op" id="6299340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299344">return</span>&nbsp;<span class="ident" id="6299351">nil</span><span class="op" id="6299354">,</span>&nbsp;<span class="ident" id="6299356">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299364">return</span>&nbsp;<span class="ident" id="6299371">d</span><span class="op" id="6299372">.</span><span class="ident" id="6299373">image</span><span class="op" id="6299378">[</span><span class="num" id="6299379">0</span><span class="op" id="6299380">]</span><span class="op" id="6299381">,</span>&nbsp;<span class="ident" id="6299383">nil</span><br>
<span class="lineno">425</span><span class="op" id="6299387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299390">//&nbsp;GIF&nbsp;represents&nbsp;the&nbsp;possibly&nbsp;multiple&nbsp;images&nbsp;stored&nbsp;in&nbsp;a&nbsp;GIF&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="6299459">type</span>&nbsp;<span class="ident" id="6299464">GIF</span>&nbsp;<span class="keyword" id="6299468">struct</span>&nbsp;<span class="op" id="6299475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299478">Image</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299488">[</span><span class="op" id="6299489">]</span><span class="op" id="6299490">*</span><span class="ident" id="6299491">image</span><span class="op" id="6299496">.</span><span class="ident" id="6299497">Paletted</span>&nbsp;<span class="comment" id="6299506">//&nbsp;The&nbsp;successive&nbsp;images.</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299533">Delay</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299543">[</span><span class="op" id="6299544">]</span><span class="builtintype" id="6299545">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299561">//&nbsp;The&nbsp;successive&nbsp;delay&nbsp;times,&nbsp;one&nbsp;per&nbsp;frame,&nbsp;in&nbsp;100ths&nbsp;of&nbsp;a&nbsp;second.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299631">LoopCount</span>&nbsp;<span class="builtintype" id="6299641">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6299659">//&nbsp;The&nbsp;loop&nbsp;count.</span><br>
<span class="lineno"></span><span class="op" id="6299678">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299681">//&nbsp;DecodeAll&nbsp;reads&nbsp;a&nbsp;GIF&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;the&nbsp;sequential&nbsp;frames</span><br>
<span class="lineno">435</span><span class="comment" id="6299753">//&nbsp;and&nbsp;timing&nbsp;information.</span><br>
<span class="lineno"></span><span class="keyword" id="6299780">func</span>&nbsp;<span class="ident" id="6299785">DecodeAll</span><span class="op" id="6299794">(</span><span class="ident" id="6299795">r</span>&nbsp;<span class="ident" id="6299797">io</span><span class="op" id="6299799">.</span><span class="ident" id="6299800">Reader</span><span class="op" id="6299806">)</span>&nbsp;<span class="op" id="6299808">(</span><span class="op" id="6299809">*</span><span class="ident" id="6299810">GIF</span><span class="op" id="6299813">,</span>&nbsp;<span class="builtintype" id="6299815">error</span><span class="op" id="6299820">)</span>&nbsp;<span class="op" id="6299822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299825">var</span>&nbsp;<span class="ident" id="6299829">d</span>&nbsp;<span class="ident" id="6299831">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299840">if</span>&nbsp;<span class="ident" id="6299843">err</span>&nbsp;<span class="op" id="6299847">:=</span>&nbsp;<span class="ident" id="6299850">d</span><span class="op" id="6299851">.</span><span class="ident" id="6299852">decode</span><span class="op" id="6299858">(</span><span class="ident" id="6299859">r</span><span class="op" id="6299860">,</span>&nbsp;<span class="builtintype" id="6299862">false</span><span class="op" id="6299867">)</span><span class="op" id="6299868">;</span>&nbsp;<span class="ident" id="6299870">err</span>&nbsp;<span class="op" id="6299874">!=</span>&nbsp;<span class="ident" id="6299877">nil</span>&nbsp;<span class="op" id="6299881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299885">return</span>&nbsp;<span class="ident" id="6299892">nil</span><span class="op" id="6299895">,</span>&nbsp;<span class="ident" id="6299897">err</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299902">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299905">gif</span>&nbsp;<span class="op" id="6299909">:=</span>&nbsp;<span class="op" id="6299912">&amp;</span><span class="ident" id="6299913">GIF</span><span class="op" id="6299916">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299920">Image</span><span class="op" id="6299925">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299931">d</span><span class="op" id="6299932">.</span><span class="ident" id="6299933">image</span><span class="op" id="6299938">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299942">LoopCount</span><span class="op" id="6299951">:</span>&nbsp;<span class="ident" id="6299953">d</span><span class="op" id="6299954">.</span><span class="ident" id="6299955">loopCount</span><span class="op" id="6299964">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299968">Delay</span><span class="op" id="6299973">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6299979">d</span><span class="op" id="6299980">.</span><span class="ident" id="6299981">delay</span><span class="op" id="6299986">,</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299992">return</span>&nbsp;<span class="ident" id="6299999">gif</span><span class="op" id="6300002">,</span>&nbsp;<span class="ident" id="6300004">nil</span><br>
<span class="lineno"></span><span class="op" id="6300008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300011">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;global&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;GIF&nbsp;image</span><br>
<span class="lineno">450</span><span class="comment" id="6300088">//&nbsp;without&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="6300126">func</span>&nbsp;<span class="ident" id="6300131">DecodeConfig</span><span class="op" id="6300143">(</span><span class="ident" id="6300144">r</span>&nbsp;<span class="ident" id="6300146">io</span><span class="op" id="6300148">.</span><span class="ident" id="6300149">Reader</span><span class="op" id="6300155">)</span>&nbsp;<span class="op" id="6300157">(</span><span class="ident" id="6300158">image</span><span class="op" id="6300163">.</span><span class="ident" id="6300164">Config</span><span class="op" id="6300170">,</span>&nbsp;<span class="builtintype" id="6300172">error</span><span class="op" id="6300177">)</span>&nbsp;<span class="op" id="6300179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300182">var</span>&nbsp;<span class="ident" id="6300186">d</span>&nbsp;<span class="ident" id="6300188">decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300197">if</span>&nbsp;<span class="ident" id="6300200">err</span>&nbsp;<span class="op" id="6300204">:=</span>&nbsp;<span class="ident" id="6300207">d</span><span class="op" id="6300208">.</span><span class="ident" id="6300209">decode</span><span class="op" id="6300215">(</span><span class="ident" id="6300216">r</span><span class="op" id="6300217">,</span>&nbsp;<span class="builtintype" id="6300219">true</span><span class="op" id="6300223">)</span><span class="op" id="6300224">;</span>&nbsp;<span class="ident" id="6300226">err</span>&nbsp;<span class="op" id="6300230">!=</span>&nbsp;<span class="ident" id="6300233">nil</span>&nbsp;<span class="op" id="6300237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300241">return</span>&nbsp;<span class="ident" id="6300248">image</span><span class="op" id="6300253">.</span><span class="ident" id="6300254">Config</span><span class="op" id="6300260">{</span><span class="op" id="6300261">}</span><span class="op" id="6300262">,</span>&nbsp;<span class="ident" id="6300264">err</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300272">return</span>&nbsp;<span class="ident" id="6300279">image</span><span class="op" id="6300284">.</span><span class="ident" id="6300285">Config</span><span class="op" id="6300291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300295">ColorModel</span><span class="op" id="6300305">:</span>&nbsp;<span class="ident" id="6300307">d</span><span class="op" id="6300308">.</span><span class="ident" id="6300309">globalColorMap</span><span class="op" id="6300323">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300327">Width</span><span class="op" id="6300332">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300339">d</span><span class="op" id="6300340">.</span><span class="ident" id="6300341">width</span><span class="op" id="6300346">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300350">Height</span><span class="op" id="6300356">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300362">d</span><span class="op" id="6300363">.</span><span class="ident" id="6300364">height</span><span class="op" id="6300370">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300373">}</span><span class="op" id="6300374">,</span>&nbsp;<span class="ident" id="6300376">nil</span><br>
<span class="lineno"></span><span class="op" id="6300380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300383">func</span>&nbsp;<span class="ident" id="6300388">init</span><span class="op" id="6300392">(</span><span class="op" id="6300393">)</span>&nbsp;<span class="op" id="6300395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300398">image</span><span class="op" id="6300403">.</span><span class="ident" id="6300404">RegisterFormat</span><span class="op" id="6300418">(</span><span class="string" id="6300419">&#34;gif&#34;</span><span class="op" id="6300424">,</span>&nbsp;<span class="string" id="6300426">&#34;GIF8?a&#34;</span><span class="op" id="6300434">,</span>&nbsp;<span class="ident" id="6300436">Decode</span><span class="op" id="6300442">,</span>&nbsp;<span class="ident" id="6300444">DecodeConfig</span><span class="op" id="6300456">)</span><br>
<span class="lineno">465</span><span class="op" id="6300458">}</span>
</div>
</body>
</html>
