<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/base64</h2>
<ul>
<li><a href="/gostd/encoding/base64/base64.go.html">base64.go</a></li>
<li><a href="/gostd/encoding/base64/base64_test.go.html">base64_test.go</a></li>
<li><a href="/gostd/encoding/base64/example_test.go.html">example_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6533788">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6533843">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6533897">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6533948">package</span>&nbsp;<span class="ident" id="6533956">base64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6533964">import</span>&nbsp;<span class="op" id="6533971">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533974">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533983">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533993">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6533999">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534012">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534023">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534034">&#34;testing&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534045">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="6534052">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534055">type</span>&nbsp;<span class="ident" id="6534060">testpair</span>&nbsp;<span class="keyword" id="6534069">struct</span>&nbsp;<span class="op" id="6534076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534079">decoded</span><span class="op" id="6534086">,</span>&nbsp;<span class="ident" id="6534088">encoded</span>&nbsp;<span class="builtintype" id="6534096">string</span><br>
<span class="lineno">20</span><span class="op" id="6534103">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534106">var</span>&nbsp;<span class="ident" id="6534110">pairs</span>&nbsp;<span class="op" id="6534116">=</span>&nbsp;<span class="op" id="6534118">[</span><span class="op" id="6534119">]</span><span class="ident" id="6534120">testpair</span><span class="op" id="6534128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534131">//&nbsp;RFC&nbsp;3548&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534153">{</span><span class="string" id="6534154">&#34;\x14\xfb\x9c\x03\xd9\x7e&#34;</span><span class="op" id="6534180">,</span>&nbsp;<span class="string" id="6534182">&#34;FPucA9l+&#34;</span><span class="op" id="6534192">}</span><span class="op" id="6534193">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534196">{</span><span class="string" id="6534197">&#34;\x14\xfb\x9c\x03\xd9&#34;</span><span class="op" id="6534219">,</span>&nbsp;<span class="string" id="6534221">&#34;FPucA9k=&#34;</span><span class="op" id="6534231">}</span><span class="op" id="6534232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534235">{</span><span class="string" id="6534236">&#34;\x14\xfb\x9c\x03&#34;</span><span class="op" id="6534254">,</span>&nbsp;<span class="string" id="6534256">&#34;FPucAw==&#34;</span><span class="op" id="6534266">}</span><span class="op" id="6534267">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534271">//&nbsp;RFC&nbsp;4648&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534293">{</span><span class="string" id="6534294">&#34;&#34;</span><span class="op" id="6534296">,</span>&nbsp;<span class="string" id="6534298">&#34;&#34;</span><span class="op" id="6534300">}</span><span class="op" id="6534301">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534304">{</span><span class="string" id="6534305">&#34;f&#34;</span><span class="op" id="6534308">,</span>&nbsp;<span class="string" id="6534310">&#34;Zg==&#34;</span><span class="op" id="6534316">}</span><span class="op" id="6534317">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534320">{</span><span class="string" id="6534321">&#34;fo&#34;</span><span class="op" id="6534325">,</span>&nbsp;<span class="string" id="6534327">&#34;Zm8=&#34;</span><span class="op" id="6534333">}</span><span class="op" id="6534334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534337">{</span><span class="string" id="6534338">&#34;foo&#34;</span><span class="op" id="6534343">,</span>&nbsp;<span class="string" id="6534345">&#34;Zm9v&#34;</span><span class="op" id="6534351">}</span><span class="op" id="6534352">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534355">{</span><span class="string" id="6534356">&#34;foob&#34;</span><span class="op" id="6534362">,</span>&nbsp;<span class="string" id="6534364">&#34;Zm9vYg==&#34;</span><span class="op" id="6534374">}</span><span class="op" id="6534375">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534378">{</span><span class="string" id="6534379">&#34;fooba&#34;</span><span class="op" id="6534386">,</span>&nbsp;<span class="string" id="6534388">&#34;Zm9vYmE=&#34;</span><span class="op" id="6534398">}</span><span class="op" id="6534399">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534402">{</span><span class="string" id="6534403">&#34;foobar&#34;</span><span class="op" id="6534411">,</span>&nbsp;<span class="string" id="6534413">&#34;Zm9vYmFy&#34;</span><span class="op" id="6534423">}</span><span class="op" id="6534424">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6534428">//&nbsp;Wikipedia&nbsp;examples</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534451">{</span><span class="string" id="6534452">&#34;sure.&#34;</span><span class="op" id="6534459">,</span>&nbsp;<span class="string" id="6534461">&#34;c3VyZS4=&#34;</span><span class="op" id="6534471">}</span><span class="op" id="6534472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534475">{</span><span class="string" id="6534476">&#34;sure&#34;</span><span class="op" id="6534482">,</span>&nbsp;<span class="string" id="6534484">&#34;c3VyZQ==&#34;</span><span class="op" id="6534494">}</span><span class="op" id="6534495">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534498">{</span><span class="string" id="6534499">&#34;sur&#34;</span><span class="op" id="6534504">,</span>&nbsp;<span class="string" id="6534506">&#34;c3Vy&#34;</span><span class="op" id="6534512">}</span><span class="op" id="6534513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534516">{</span><span class="string" id="6534517">&#34;su&#34;</span><span class="op" id="6534521">,</span>&nbsp;<span class="string" id="6534523">&#34;c3U=&#34;</span><span class="op" id="6534529">}</span><span class="op" id="6534530">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534533">{</span><span class="string" id="6534534">&#34;leasure.&#34;</span><span class="op" id="6534544">,</span>&nbsp;<span class="string" id="6534546">&#34;bGVhc3VyZS4=&#34;</span><span class="op" id="6534560">}</span><span class="op" id="6534561">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534564">{</span><span class="string" id="6534565">&#34;easure.&#34;</span><span class="op" id="6534574">,</span>&nbsp;<span class="string" id="6534576">&#34;ZWFzdXJlLg==&#34;</span><span class="op" id="6534590">}</span><span class="op" id="6534591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534594">{</span><span class="string" id="6534595">&#34;asure.&#34;</span><span class="op" id="6534603">,</span>&nbsp;<span class="string" id="6534605">&#34;YXN1cmUu&#34;</span><span class="op" id="6534615">}</span><span class="op" id="6534616">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534619">{</span><span class="string" id="6534620">&#34;sure.&#34;</span><span class="op" id="6534627">,</span>&nbsp;<span class="string" id="6534629">&#34;c3VyZS4=&#34;</span><span class="op" id="6534639">}</span><span class="op" id="6534640">,</span><br>
<span class="lineno"></span><span class="op" id="6534642">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534645">var</span>&nbsp;<span class="ident" id="6534649">bigtest</span>&nbsp;<span class="op" id="6534657">=</span>&nbsp;<span class="ident" id="6534659">testpair</span><span class="op" id="6534667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534670">&#34;Twas&nbsp;brillig,&nbsp;and&nbsp;the&nbsp;slithy&nbsp;toves&#34;</span><span class="op" id="6534706">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6534709">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6534759">,</span><br>
<span class="lineno"></span><span class="op" id="6534761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6534764">func</span>&nbsp;<span class="ident" id="6534769">testEqual</span><span class="op" id="6534778">(</span><span class="ident" id="6534779">t</span>&nbsp;<span class="op" id="6534781">*</span><span class="ident" id="6534782">testing</span><span class="op" id="6534789">.</span><span class="ident" id="6534790">T</span><span class="op" id="6534791">,</span>&nbsp;<span class="ident" id="6534793">msg</span>&nbsp;<span class="builtintype" id="6534797">string</span><span class="op" id="6534803">,</span>&nbsp;<span class="ident" id="6534805">args</span>&nbsp;<span class="op" id="6534810">...</span><span class="keyword" id="6534813">interface</span><span class="op" id="6534822">{</span><span class="op" id="6534823">}</span><span class="op" id="6534824">)</span>&nbsp;<span class="builtintype" id="6534826">bool</span>&nbsp;<span class="op" id="6534831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534834">if</span>&nbsp;<span class="ident" id="6534837">args</span><span class="op" id="6534841">[</span><span class="builtinfunc" id="6534842">len</span><span class="op" id="6534845">(</span><span class="ident" id="6534846">args</span><span class="op" id="6534850">)</span><span class="op" id="6534851">-</span><span class="num" id="6534852">2</span><span class="op" id="6534853">]</span>&nbsp;<span class="op" id="6534855">!=</span>&nbsp;<span class="ident" id="6534858">args</span><span class="op" id="6534862">[</span><span class="builtinfunc" id="6534863">len</span><span class="op" id="6534866">(</span><span class="ident" id="6534867">args</span><span class="op" id="6534871">)</span><span class="op" id="6534872">-</span><span class="num" id="6534873">1</span><span class="op" id="6534874">]</span>&nbsp;<span class="op" id="6534876">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534880">t</span><span class="op" id="6534881">.</span><span class="ident" id="6534882">Errorf</span><span class="op" id="6534888">(</span><span class="ident" id="6534889">msg</span><span class="op" id="6534892">,</span>&nbsp;<span class="ident" id="6534894">args</span><span class="op" id="6534898">...</span><span class="op" id="6534901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534905">return</span>&nbsp;<span class="builtintype" id="6534912">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6534919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534922">return</span>&nbsp;<span class="builtintype" id="6534929">true</span><br>
<span class="lineno"></span><span class="op" id="6534934">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="6534937">func</span>&nbsp;<span class="ident" id="6534942">TestEncode</span><span class="op" id="6534952">(</span><span class="ident" id="6534953">t</span>&nbsp;<span class="op" id="6534955">*</span><span class="ident" id="6534956">testing</span><span class="op" id="6534963">.</span><span class="ident" id="6534964">T</span><span class="op" id="6534965">)</span>&nbsp;<span class="op" id="6534967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6534970">for</span>&nbsp;<span class="ident" id="6534974">_</span><span class="op" id="6534975">,</span>&nbsp;<span class="ident" id="6534977">p</span>&nbsp;<span class="op" id="6534979">:=</span>&nbsp;<span class="keyword" id="6534982">range</span>&nbsp;<span class="ident" id="6534988">pairs</span>&nbsp;<span class="op" id="6534994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6534998">got</span>&nbsp;<span class="op" id="6535002">:=</span>&nbsp;<span class="ident" id="6535005">StdEncoding</span><span class="op" id="6535016">.</span><span class="ident" id="6535017">EncodeToString</span><span class="op" id="6535031">(</span><span class="op" id="6535032">[</span><span class="op" id="6535033">]</span><span class="builtintype" id="6535034">byte</span><span class="op" id="6535038">(</span><span class="ident" id="6535039">p</span><span class="op" id="6535040">.</span><span class="ident" id="6535041">decoded</span><span class="op" id="6535048">)</span><span class="op" id="6535049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535053">testEqual</span><span class="op" id="6535062">(</span><span class="ident" id="6535063">t</span><span class="op" id="6535064">,</span>&nbsp;<span class="string" id="6535066">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6535092">,</span>&nbsp;<span class="ident" id="6535094">p</span><span class="op" id="6535095">.</span><span class="ident" id="6535096">decoded</span><span class="op" id="6535103">,</span>&nbsp;<span class="ident" id="6535105">got</span><span class="op" id="6535108">,</span>&nbsp;<span class="ident" id="6535110">p</span><span class="op" id="6535111">.</span><span class="ident" id="6535112">encoded</span><span class="op" id="6535119">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535122">}</span><br>
<span class="lineno"></span><span class="op" id="6535124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535127">func</span>&nbsp;<span class="ident" id="6535132">TestEncoder</span><span class="op" id="6535143">(</span><span class="ident" id="6535144">t</span>&nbsp;<span class="op" id="6535146">*</span><span class="ident" id="6535147">testing</span><span class="op" id="6535154">.</span><span class="ident" id="6535155">T</span><span class="op" id="6535156">)</span>&nbsp;<span class="op" id="6535158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535161">for</span>&nbsp;<span class="ident" id="6535165">_</span><span class="op" id="6535166">,</span>&nbsp;<span class="ident" id="6535168">p</span>&nbsp;<span class="op" id="6535170">:=</span>&nbsp;<span class="keyword" id="6535173">range</span>&nbsp;<span class="ident" id="6535179">pairs</span>&nbsp;<span class="op" id="6535185">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535189">bb</span>&nbsp;<span class="op" id="6535192">:=</span>&nbsp;<span class="op" id="6535195">&amp;</span><span class="ident" id="6535196">bytes</span><span class="op" id="6535201">.</span><span class="ident" id="6535202">Buffer</span><span class="op" id="6535208">{</span><span class="op" id="6535209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535213">encoder</span>&nbsp;<span class="op" id="6535221">:=</span>&nbsp;<span class="ident" id="6535224">NewEncoder</span><span class="op" id="6535234">(</span><span class="ident" id="6535235">StdEncoding</span><span class="op" id="6535246">,</span>&nbsp;<span class="ident" id="6535248">bb</span><span class="op" id="6535250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535254">encoder</span><span class="op" id="6535261">.</span><span class="ident" id="6535262">Write</span><span class="op" id="6535267">(</span><span class="op" id="6535268">[</span><span class="op" id="6535269">]</span><span class="builtintype" id="6535270">byte</span><span class="op" id="6535274">(</span><span class="ident" id="6535275">p</span><span class="op" id="6535276">.</span><span class="ident" id="6535277">decoded</span><span class="op" id="6535284">)</span><span class="op" id="6535285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535289">encoder</span><span class="op" id="6535296">.</span><span class="ident" id="6535297">Close</span><span class="op" id="6535302">(</span><span class="op" id="6535303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535307">testEqual</span><span class="op" id="6535316">(</span><span class="ident" id="6535317">t</span><span class="op" id="6535318">,</span>&nbsp;<span class="string" id="6535320">&#34;Encode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6535346">,</span>&nbsp;<span class="ident" id="6535348">p</span><span class="op" id="6535349">.</span><span class="ident" id="6535350">decoded</span><span class="op" id="6535357">,</span>&nbsp;<span class="ident" id="6535359">bb</span><span class="op" id="6535361">.</span><span class="ident" id="6535362">String</span><span class="op" id="6535368">(</span><span class="op" id="6535369">)</span><span class="op" id="6535370">,</span>&nbsp;<span class="ident" id="6535372">p</span><span class="op" id="6535373">.</span><span class="ident" id="6535374">encoded</span><span class="op" id="6535381">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535384">}</span><br>
<span class="lineno"></span><span class="op" id="6535386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6535389">func</span>&nbsp;<span class="ident" id="6535394">TestEncoderBuffering</span><span class="op" id="6535414">(</span><span class="ident" id="6535415">t</span>&nbsp;<span class="op" id="6535417">*</span><span class="ident" id="6535418">testing</span><span class="op" id="6535425">.</span><span class="ident" id="6535426">T</span><span class="op" id="6535427">)</span>&nbsp;<span class="op" id="6535429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535432">input</span>&nbsp;<span class="op" id="6535438">:=</span>&nbsp;<span class="op" id="6535441">[</span><span class="op" id="6535442">]</span><span class="builtintype" id="6535443">byte</span><span class="op" id="6535447">(</span><span class="ident" id="6535448">bigtest</span><span class="op" id="6535455">.</span><span class="ident" id="6535456">decoded</span><span class="op" id="6535463">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535466">for</span>&nbsp;<span class="ident" id="6535470">bs</span>&nbsp;<span class="op" id="6535473">:=</span>&nbsp;<span class="num" id="6535476">1</span><span class="op" id="6535477">;</span>&nbsp;<span class="ident" id="6535479">bs</span>&nbsp;<span class="op" id="6535482">&lt;=</span>&nbsp;<span class="num" id="6535485">12</span><span class="op" id="6535487">;</span>&nbsp;<span class="ident" id="6535489">bs</span><span class="op" id="6535491">++</span>&nbsp;<span class="op" id="6535494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535498">bb</span>&nbsp;<span class="op" id="6535501">:=</span>&nbsp;<span class="op" id="6535504">&amp;</span><span class="ident" id="6535505">bytes</span><span class="op" id="6535510">.</span><span class="ident" id="6535511">Buffer</span><span class="op" id="6535517">{</span><span class="op" id="6535518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535522">encoder</span>&nbsp;<span class="op" id="6535530">:=</span>&nbsp;<span class="ident" id="6535533">NewEncoder</span><span class="op" id="6535543">(</span><span class="ident" id="6535544">StdEncoding</span><span class="op" id="6535555">,</span>&nbsp;<span class="ident" id="6535557">bb</span><span class="op" id="6535559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535563">for</span>&nbsp;<span class="ident" id="6535567">pos</span>&nbsp;<span class="op" id="6535571">:=</span>&nbsp;<span class="num" id="6535574">0</span><span class="op" id="6535575">;</span>&nbsp;<span class="ident" id="6535577">pos</span>&nbsp;<span class="op" id="6535581">&lt;</span>&nbsp;<span class="builtinfunc" id="6535583">len</span><span class="op" id="6535586">(</span><span class="ident" id="6535587">input</span><span class="op" id="6535592">)</span><span class="op" id="6535593">;</span>&nbsp;<span class="ident" id="6535595">pos</span>&nbsp;<span class="op" id="6535599">+=</span>&nbsp;<span class="ident" id="6535602">bs</span>&nbsp;<span class="op" id="6535605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535610">end</span>&nbsp;<span class="op" id="6535614">:=</span>&nbsp;<span class="ident" id="6535617">pos</span>&nbsp;<span class="op" id="6535621">+</span>&nbsp;<span class="ident" id="6535623">bs</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6535629">if</span>&nbsp;<span class="ident" id="6535632">end</span>&nbsp;<span class="op" id="6535636">&gt;</span>&nbsp;<span class="builtinfunc" id="6535638">len</span><span class="op" id="6535641">(</span><span class="ident" id="6535642">input</span><span class="op" id="6535647">)</span>&nbsp;<span class="op" id="6535649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535655">end</span>&nbsp;<span class="op" id="6535659">=</span>&nbsp;<span class="builtinfunc" id="6535661">len</span><span class="op" id="6535664">(</span><span class="ident" id="6535665">input</span><span class="op" id="6535670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535675">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535680">n</span><span class="op" id="6535681">,</span>&nbsp;<span class="ident" id="6535683">err</span>&nbsp;<span class="op" id="6535687">:=</span>&nbsp;<span class="ident" id="6535690">encoder</span><span class="op" id="6535697">.</span><span class="ident" id="6535698">Write</span><span class="op" id="6535703">(</span><span class="ident" id="6535704">input</span><span class="op" id="6535709">[</span><span class="ident" id="6535710">pos</span><span class="op" id="6535713">:</span><span class="ident" id="6535714">end</span><span class="op" id="6535717">]</span><span class="op" id="6535718">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535723">testEqual</span><span class="op" id="6535732">(</span><span class="ident" id="6535733">t</span><span class="op" id="6535734">,</span>&nbsp;<span class="string" id="6535736">&#34;Write(%q)&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6535770">,</span>&nbsp;<span class="ident" id="6535772">input</span><span class="op" id="6535777">[</span><span class="ident" id="6535778">pos</span><span class="op" id="6535781">:</span><span class="ident" id="6535782">end</span><span class="op" id="6535785">]</span><span class="op" id="6535786">,</span>&nbsp;<span class="ident" id="6535788">err</span><span class="op" id="6535791">,</span>&nbsp;<span class="builtintype" id="6535793">error</span><span class="op" id="6535798">(</span><span class="ident" id="6535799">nil</span><span class="op" id="6535802">)</span><span class="op" id="6535803">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535808">testEqual</span><span class="op" id="6535817">(</span><span class="ident" id="6535818">t</span><span class="op" id="6535819">,</span>&nbsp;<span class="string" id="6535821">&#34;Write(%q)&nbsp;gave&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6535856">,</span>&nbsp;<span class="ident" id="6535858">input</span><span class="op" id="6535863">[</span><span class="ident" id="6535864">pos</span><span class="op" id="6535867">:</span><span class="ident" id="6535868">end</span><span class="op" id="6535871">]</span><span class="op" id="6535872">,</span>&nbsp;<span class="ident" id="6535874">n</span><span class="op" id="6535875">,</span>&nbsp;<span class="ident" id="6535877">end</span><span class="op" id="6535880">-</span><span class="ident" id="6535881">pos</span><span class="op" id="6535884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6535888">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535892">err</span>&nbsp;<span class="op" id="6535896">:=</span>&nbsp;<span class="ident" id="6535899">encoder</span><span class="op" id="6535906">.</span><span class="ident" id="6535907">Close</span><span class="op" id="6535912">(</span><span class="op" id="6535913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535917">testEqual</span><span class="op" id="6535926">(</span><span class="ident" id="6535927">t</span><span class="op" id="6535928">,</span>&nbsp;<span class="string" id="6535930">&#34;Close&nbsp;gave&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6535960">,</span>&nbsp;<span class="ident" id="6535962">err</span><span class="op" id="6535965">,</span>&nbsp;<span class="builtintype" id="6535967">error</span><span class="op" id="6535972">(</span><span class="ident" id="6535973">nil</span><span class="op" id="6535976">)</span><span class="op" id="6535977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6535981">testEqual</span><span class="op" id="6535990">(</span><span class="ident" id="6535991">t</span><span class="op" id="6535992">,</span>&nbsp;<span class="string" id="6535994">&#34;Encoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6536027">,</span>&nbsp;<span class="ident" id="6536029">bs</span><span class="op" id="6536031">,</span>&nbsp;<span class="ident" id="6536033">bigtest</span><span class="op" id="6536040">.</span><span class="ident" id="6536041">decoded</span><span class="op" id="6536048">,</span>&nbsp;<span class="ident" id="6536050">bb</span><span class="op" id="6536052">.</span><span class="ident" id="6536053">String</span><span class="op" id="6536059">(</span><span class="op" id="6536060">)</span><span class="op" id="6536061">,</span>&nbsp;<span class="ident" id="6536063">bigtest</span><span class="op" id="6536070">.</span><span class="ident" id="6536071">encoded</span><span class="op" id="6536078">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536081">}</span><br>
<span class="lineno"></span><span class="op" id="6536083">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6536086">func</span>&nbsp;<span class="ident" id="6536091">TestDecode</span><span class="op" id="6536101">(</span><span class="ident" id="6536102">t</span>&nbsp;<span class="op" id="6536104">*</span><span class="ident" id="6536105">testing</span><span class="op" id="6536112">.</span><span class="ident" id="6536113">T</span><span class="op" id="6536114">)</span>&nbsp;<span class="op" id="6536116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536119">for</span>&nbsp;<span class="ident" id="6536123">_</span><span class="op" id="6536124">,</span>&nbsp;<span class="ident" id="6536126">p</span>&nbsp;<span class="op" id="6536128">:=</span>&nbsp;<span class="keyword" id="6536131">range</span>&nbsp;<span class="ident" id="6536137">pairs</span>&nbsp;<span class="op" id="6536143">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536147">dbuf</span>&nbsp;<span class="op" id="6536152">:=</span>&nbsp;<span class="builtinfunc" id="6536155">make</span><span class="op" id="6536159">(</span><span class="op" id="6536160">[</span><span class="op" id="6536161">]</span><span class="builtintype" id="6536162">byte</span><span class="op" id="6536166">,</span>&nbsp;<span class="ident" id="6536168">StdEncoding</span><span class="op" id="6536179">.</span><span class="ident" id="6536180">DecodedLen</span><span class="op" id="6536190">(</span><span class="builtinfunc" id="6536191">len</span><span class="op" id="6536194">(</span><span class="ident" id="6536195">p</span><span class="op" id="6536196">.</span><span class="ident" id="6536197">encoded</span><span class="op" id="6536204">)</span><span class="op" id="6536205">)</span><span class="op" id="6536206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536210">count</span><span class="op" id="6536215">,</span>&nbsp;<span class="ident" id="6536217">end</span><span class="op" id="6536220">,</span>&nbsp;<span class="ident" id="6536222">err</span>&nbsp;<span class="op" id="6536226">:=</span>&nbsp;<span class="ident" id="6536229">StdEncoding</span><span class="op" id="6536240">.</span><span class="ident" id="6536241">decode</span><span class="op" id="6536247">(</span><span class="ident" id="6536248">dbuf</span><span class="op" id="6536252">,</span>&nbsp;<span class="op" id="6536254">[</span><span class="op" id="6536255">]</span><span class="builtintype" id="6536256">byte</span><span class="op" id="6536260">(</span><span class="ident" id="6536261">p</span><span class="op" id="6536262">.</span><span class="ident" id="6536263">encoded</span><span class="op" id="6536270">)</span><span class="op" id="6536271">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536275">testEqual</span><span class="op" id="6536284">(</span><span class="ident" id="6536285">t</span><span class="op" id="6536286">,</span>&nbsp;<span class="string" id="6536288">&#34;Decode(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6536320">,</span>&nbsp;<span class="ident" id="6536322">p</span><span class="op" id="6536323">.</span><span class="ident" id="6536324">encoded</span><span class="op" id="6536331">,</span>&nbsp;<span class="ident" id="6536333">err</span><span class="op" id="6536336">,</span>&nbsp;<span class="builtintype" id="6536338">error</span><span class="op" id="6536343">(</span><span class="ident" id="6536344">nil</span><span class="op" id="6536347">)</span><span class="op" id="6536348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536352">testEqual</span><span class="op" id="6536361">(</span><span class="ident" id="6536362">t</span><span class="op" id="6536363">,</span>&nbsp;<span class="string" id="6536365">&#34;Decode(%q)&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6536398">,</span>&nbsp;<span class="ident" id="6536400">p</span><span class="op" id="6536401">.</span><span class="ident" id="6536402">encoded</span><span class="op" id="6536409">,</span>&nbsp;<span class="ident" id="6536411">count</span><span class="op" id="6536416">,</span>&nbsp;<span class="builtinfunc" id="6536418">len</span><span class="op" id="6536421">(</span><span class="ident" id="6536422">p</span><span class="op" id="6536423">.</span><span class="ident" id="6536424">decoded</span><span class="op" id="6536431">)</span><span class="op" id="6536432">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536436">if</span>&nbsp;<span class="builtinfunc" id="6536439">len</span><span class="op" id="6536442">(</span><span class="ident" id="6536443">p</span><span class="op" id="6536444">.</span><span class="ident" id="6536445">encoded</span><span class="op" id="6536452">)</span>&nbsp;<span class="op" id="6536454">&gt;</span>&nbsp;<span class="num" id="6536456">0</span>&nbsp;<span class="op" id="6536458">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536463">testEqual</span><span class="op" id="6536472">(</span><span class="ident" id="6536473">t</span><span class="op" id="6536474">,</span>&nbsp;<span class="string" id="6536476">&#34;Decode(%q)&nbsp;=&nbsp;end&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6536506">,</span>&nbsp;<span class="ident" id="6536508">p</span><span class="op" id="6536509">.</span><span class="ident" id="6536510">encoded</span><span class="op" id="6536517">,</span>&nbsp;<span class="ident" id="6536519">end</span><span class="op" id="6536522">,</span>&nbsp;<span class="op" id="6536524">(</span><span class="ident" id="6536525">p</span><span class="op" id="6536526">.</span><span class="ident" id="6536527">encoded</span><span class="op" id="6536534">[</span><span class="builtinfunc" id="6536535">len</span><span class="op" id="6536538">(</span><span class="ident" id="6536539">p</span><span class="op" id="6536540">.</span><span class="ident" id="6536541">encoded</span><span class="op" id="6536548">)</span><span class="op" id="6536549">-</span><span class="num" id="6536550">1</span><span class="op" id="6536551">]</span>&nbsp;<span class="op" id="6536553">==</span>&nbsp;<span class="string" id="6536556">&#39;=&#39;</span><span class="op" id="6536559">)</span><span class="op" id="6536560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536568">testEqual</span><span class="op" id="6536577">(</span><span class="ident" id="6536578">t</span><span class="op" id="6536579">,</span>&nbsp;<span class="string" id="6536581">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6536607">,</span>&nbsp;<span class="ident" id="6536609">p</span><span class="op" id="6536610">.</span><span class="ident" id="6536611">encoded</span><span class="op" id="6536618">,</span>&nbsp;<span class="builtintype" id="6536620">string</span><span class="op" id="6536626">(</span><span class="ident" id="6536627">dbuf</span><span class="op" id="6536631">[</span><span class="num" id="6536632">0</span><span class="op" id="6536633">:</span><span class="ident" id="6536634">count</span><span class="op" id="6536639">]</span><span class="op" id="6536640">)</span><span class="op" id="6536641">,</span>&nbsp;<span class="ident" id="6536643">p</span><span class="op" id="6536644">.</span><span class="ident" id="6536645">decoded</span><span class="op" id="6536652">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536657">dbuf</span><span class="op" id="6536661">,</span>&nbsp;<span class="ident" id="6536663">err</span>&nbsp;<span class="op" id="6536667">=</span>&nbsp;<span class="ident" id="6536669">StdEncoding</span><span class="op" id="6536680">.</span><span class="ident" id="6536681">DecodeString</span><span class="op" id="6536693">(</span><span class="ident" id="6536694">p</span><span class="op" id="6536695">.</span><span class="ident" id="6536696">encoded</span><span class="op" id="6536703">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536707">testEqual</span><span class="op" id="6536716">(</span><span class="ident" id="6536717">t</span><span class="op" id="6536718">,</span>&nbsp;<span class="string" id="6536720">&#34;DecodeString(%q)&nbsp;=&nbsp;error&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6536758">,</span>&nbsp;<span class="ident" id="6536760">p</span><span class="op" id="6536761">.</span><span class="ident" id="6536762">encoded</span><span class="op" id="6536769">,</span>&nbsp;<span class="ident" id="6536771">err</span><span class="op" id="6536774">,</span>&nbsp;<span class="builtintype" id="6536776">error</span><span class="op" id="6536781">(</span><span class="ident" id="6536782">nil</span><span class="op" id="6536785">)</span><span class="op" id="6536786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536790">testEqual</span><span class="op" id="6536799">(</span><span class="ident" id="6536800">t</span><span class="op" id="6536801">,</span>&nbsp;<span class="string" id="6536803">&#34;DecodeString(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6536835">,</span>&nbsp;<span class="builtintype" id="6536837">string</span><span class="op" id="6536843">(</span><span class="ident" id="6536844">dbuf</span><span class="op" id="6536848">)</span><span class="op" id="6536849">,</span>&nbsp;<span class="ident" id="6536851">p</span><span class="op" id="6536852">.</span><span class="ident" id="6536853">decoded</span><span class="op" id="6536860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6536863">}</span><br>
<span class="lineno"></span><span class="op" id="6536865">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="6536868">func</span>&nbsp;<span class="ident" id="6536873">TestDecoder</span><span class="op" id="6536884">(</span><span class="ident" id="6536885">t</span>&nbsp;<span class="op" id="6536887">*</span><span class="ident" id="6536888">testing</span><span class="op" id="6536895">.</span><span class="ident" id="6536896">T</span><span class="op" id="6536897">)</span>&nbsp;<span class="op" id="6536899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6536902">for</span>&nbsp;<span class="ident" id="6536906">_</span><span class="op" id="6536907">,</span>&nbsp;<span class="ident" id="6536909">p</span>&nbsp;<span class="op" id="6536911">:=</span>&nbsp;<span class="keyword" id="6536914">range</span>&nbsp;<span class="ident" id="6536920">pairs</span>&nbsp;<span class="op" id="6536926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536930">decoder</span>&nbsp;<span class="op" id="6536938">:=</span>&nbsp;<span class="ident" id="6536941">NewDecoder</span><span class="op" id="6536951">(</span><span class="ident" id="6536952">StdEncoding</span><span class="op" id="6536963">,</span>&nbsp;<span class="ident" id="6536965">strings</span><span class="op" id="6536972">.</span><span class="ident" id="6536973">NewReader</span><span class="op" id="6536982">(</span><span class="ident" id="6536983">p</span><span class="op" id="6536984">.</span><span class="ident" id="6536985">encoded</span><span class="op" id="6536992">)</span><span class="op" id="6536993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6536997">dbuf</span>&nbsp;<span class="op" id="6537002">:=</span>&nbsp;<span class="builtinfunc" id="6537005">make</span><span class="op" id="6537009">(</span><span class="op" id="6537010">[</span><span class="op" id="6537011">]</span><span class="builtintype" id="6537012">byte</span><span class="op" id="6537016">,</span>&nbsp;<span class="ident" id="6537018">StdEncoding</span><span class="op" id="6537029">.</span><span class="ident" id="6537030">DecodedLen</span><span class="op" id="6537040">(</span><span class="builtinfunc" id="6537041">len</span><span class="op" id="6537044">(</span><span class="ident" id="6537045">p</span><span class="op" id="6537046">.</span><span class="ident" id="6537047">encoded</span><span class="op" id="6537054">)</span><span class="op" id="6537055">)</span><span class="op" id="6537056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537060">count</span><span class="op" id="6537065">,</span>&nbsp;<span class="ident" id="6537067">err</span>&nbsp;<span class="op" id="6537071">:=</span>&nbsp;<span class="ident" id="6537074">decoder</span><span class="op" id="6537081">.</span><span class="ident" id="6537082">Read</span><span class="op" id="6537086">(</span><span class="ident" id="6537087">dbuf</span><span class="op" id="6537091">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537095">if</span>&nbsp;<span class="ident" id="6537098">err</span>&nbsp;<span class="op" id="6537102">!=</span>&nbsp;<span class="ident" id="6537105">nil</span>&nbsp;<span class="op" id="6537109">&amp;&amp;</span>&nbsp;<span class="ident" id="6537112">err</span>&nbsp;<span class="op" id="6537116">!=</span>&nbsp;<span class="ident" id="6537119">io</span><span class="op" id="6537121">.</span><span class="ident" id="6537122">EOF</span>&nbsp;<span class="op" id="6537126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537131">t</span><span class="op" id="6537132">.</span><span class="ident" id="6537133">Fatal</span><span class="op" id="6537138">(</span><span class="string" id="6537139">&#34;Read&nbsp;failed&#34;</span><span class="op" id="6537152">,</span>&nbsp;<span class="ident" id="6537154">err</span><span class="op" id="6537157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537165">testEqual</span><span class="op" id="6537174">(</span><span class="ident" id="6537175">t</span><span class="op" id="6537176">,</span>&nbsp;<span class="string" id="6537178">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;length&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6537213">,</span>&nbsp;<span class="ident" id="6537215">p</span><span class="op" id="6537216">.</span><span class="ident" id="6537217">encoded</span><span class="op" id="6537224">,</span>&nbsp;<span class="ident" id="6537226">count</span><span class="op" id="6537231">,</span>&nbsp;<span class="builtinfunc" id="6537233">len</span><span class="op" id="6537236">(</span><span class="ident" id="6537237">p</span><span class="op" id="6537238">.</span><span class="ident" id="6537239">decoded</span><span class="op" id="6537246">)</span><span class="op" id="6537247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537251">testEqual</span><span class="op" id="6537260">(</span><span class="ident" id="6537261">t</span><span class="op" id="6537262">,</span>&nbsp;<span class="string" id="6537264">&#34;Decoding&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6537294">,</span>&nbsp;<span class="ident" id="6537296">p</span><span class="op" id="6537297">.</span><span class="ident" id="6537298">encoded</span><span class="op" id="6537305">,</span>&nbsp;<span class="builtintype" id="6537307">string</span><span class="op" id="6537313">(</span><span class="ident" id="6537314">dbuf</span><span class="op" id="6537318">[</span><span class="num" id="6537319">0</span><span class="op" id="6537320">:</span><span class="ident" id="6537321">count</span><span class="op" id="6537326">]</span><span class="op" id="6537327">)</span><span class="op" id="6537328">,</span>&nbsp;<span class="ident" id="6537330">p</span><span class="op" id="6537331">.</span><span class="ident" id="6537332">decoded</span><span class="op" id="6537339">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537343">if</span>&nbsp;<span class="ident" id="6537346">err</span>&nbsp;<span class="op" id="6537350">!=</span>&nbsp;<span class="ident" id="6537353">io</span><span class="op" id="6537355">.</span><span class="ident" id="6537356">EOF</span>&nbsp;<span class="op" id="6537360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537365">count</span><span class="op" id="6537370">,</span>&nbsp;<span class="ident" id="6537372">err</span>&nbsp;<span class="op" id="6537376">=</span>&nbsp;<span class="ident" id="6537378">decoder</span><span class="op" id="6537385">.</span><span class="ident" id="6537386">Read</span><span class="op" id="6537390">(</span><span class="ident" id="6537391">dbuf</span><span class="op" id="6537395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537403">testEqual</span><span class="op" id="6537412">(</span><span class="ident" id="6537413">t</span><span class="op" id="6537414">,</span>&nbsp;<span class="string" id="6537416">&#34;Read&nbsp;from&nbsp;%q&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6537444">,</span>&nbsp;<span class="ident" id="6537446">p</span><span class="op" id="6537447">.</span><span class="ident" id="6537448">encoded</span><span class="op" id="6537455">,</span>&nbsp;<span class="ident" id="6537457">err</span><span class="op" id="6537460">,</span>&nbsp;<span class="ident" id="6537462">io</span><span class="op" id="6537464">.</span><span class="ident" id="6537465">EOF</span><span class="op" id="6537468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537471">}</span><br>
<span class="lineno">130</span><span class="op" id="6537473">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6537476">func</span>&nbsp;<span class="ident" id="6537481">TestDecoderBuffering</span><span class="op" id="6537501">(</span><span class="ident" id="6537502">t</span>&nbsp;<span class="op" id="6537504">*</span><span class="ident" id="6537505">testing</span><span class="op" id="6537512">.</span><span class="ident" id="6537513">T</span><span class="op" id="6537514">)</span>&nbsp;<span class="op" id="6537516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537519">for</span>&nbsp;<span class="ident" id="6537523">bs</span>&nbsp;<span class="op" id="6537526">:=</span>&nbsp;<span class="num" id="6537529">1</span><span class="op" id="6537530">;</span>&nbsp;<span class="ident" id="6537532">bs</span>&nbsp;<span class="op" id="6537535">&lt;=</span>&nbsp;<span class="num" id="6537538">12</span><span class="op" id="6537540">;</span>&nbsp;<span class="ident" id="6537542">bs</span><span class="op" id="6537544">++</span>&nbsp;<span class="op" id="6537547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537551">decoder</span>&nbsp;<span class="op" id="6537559">:=</span>&nbsp;<span class="ident" id="6537562">NewDecoder</span><span class="op" id="6537572">(</span><span class="ident" id="6537573">StdEncoding</span><span class="op" id="6537584">,</span>&nbsp;<span class="ident" id="6537586">strings</span><span class="op" id="6537593">.</span><span class="ident" id="6537594">NewReader</span><span class="op" id="6537603">(</span><span class="ident" id="6537604">bigtest</span><span class="op" id="6537611">.</span><span class="ident" id="6537612">encoded</span><span class="op" id="6537619">)</span><span class="op" id="6537620">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537624">buf</span>&nbsp;<span class="op" id="6537628">:=</span>&nbsp;<span class="builtinfunc" id="6537631">make</span><span class="op" id="6537635">(</span><span class="op" id="6537636">[</span><span class="op" id="6537637">]</span><span class="builtintype" id="6537638">byte</span><span class="op" id="6537642">,</span>&nbsp;<span class="builtinfunc" id="6537644">len</span><span class="op" id="6537647">(</span><span class="ident" id="6537648">bigtest</span><span class="op" id="6537655">.</span><span class="ident" id="6537656">decoded</span><span class="op" id="6537663">)</span><span class="op" id="6537664">+</span><span class="num" id="6537665">12</span><span class="op" id="6537667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537671">var</span>&nbsp;<span class="ident" id="6537675">total</span>&nbsp;<span class="builtintype" id="6537681">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6537687">for</span>&nbsp;<span class="ident" id="6537691">total</span>&nbsp;<span class="op" id="6537697">=</span>&nbsp;<span class="num" id="6537699">0</span><span class="op" id="6537700">;</span>&nbsp;<span class="ident" id="6537702">total</span>&nbsp;<span class="op" id="6537708">&lt;</span>&nbsp;<span class="builtinfunc" id="6537710">len</span><span class="op" id="6537713">(</span><span class="ident" id="6537714">bigtest</span><span class="op" id="6537721">.</span><span class="ident" id="6537722">decoded</span><span class="op" id="6537729">)</span><span class="op" id="6537730">;</span>&nbsp;<span class="op" id="6537732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537737">n</span><span class="op" id="6537738">,</span>&nbsp;<span class="ident" id="6537740">err</span>&nbsp;<span class="op" id="6537744">:=</span>&nbsp;<span class="ident" id="6537747">decoder</span><span class="op" id="6537754">.</span><span class="ident" id="6537755">Read</span><span class="op" id="6537759">(</span><span class="ident" id="6537760">buf</span><span class="op" id="6537763">[</span><span class="ident" id="6537764">total</span>&nbsp;<span class="op" id="6537770">:</span>&nbsp;<span class="ident" id="6537772">total</span><span class="op" id="6537777">+</span><span class="ident" id="6537778">bs</span><span class="op" id="6537780">]</span><span class="op" id="6537781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537786">testEqual</span><span class="op" id="6537795">(</span><span class="ident" id="6537796">t</span><span class="op" id="6537797">,</span>&nbsp;<span class="string" id="6537799">&#34;Read&nbsp;from&nbsp;%q&nbsp;at&nbsp;pos&nbsp;%d&nbsp;=&nbsp;%d,&nbsp;%v,&nbsp;want&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="6537844">,</span>&nbsp;<span class="ident" id="6537846">bigtest</span><span class="op" id="6537853">.</span><span class="ident" id="6537854">encoded</span><span class="op" id="6537861">,</span>&nbsp;<span class="ident" id="6537863">total</span><span class="op" id="6537868">,</span>&nbsp;<span class="ident" id="6537870">n</span><span class="op" id="6537871">,</span>&nbsp;<span class="ident" id="6537873">err</span><span class="op" id="6537876">,</span>&nbsp;<span class="builtintype" id="6537878">error</span><span class="op" id="6537883">(</span><span class="ident" id="6537884">nil</span><span class="op" id="6537887">)</span><span class="op" id="6537888">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537893">total</span>&nbsp;<span class="op" id="6537899">+=</span>&nbsp;<span class="ident" id="6537902">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6537906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6537910">testEqual</span><span class="op" id="6537919">(</span><span class="ident" id="6537920">t</span><span class="op" id="6537921">,</span>&nbsp;<span class="string" id="6537923">&#34;Decoding/%d&nbsp;of&nbsp;%q&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6537956">,</span>&nbsp;<span class="ident" id="6537958">bs</span><span class="op" id="6537960">,</span>&nbsp;<span class="ident" id="6537962">bigtest</span><span class="op" id="6537969">.</span><span class="ident" id="6537970">encoded</span><span class="op" id="6537977">,</span>&nbsp;<span class="builtintype" id="6537979">string</span><span class="op" id="6537985">(</span><span class="ident" id="6537986">buf</span><span class="op" id="6537989">[</span><span class="num" id="6537990">0</span><span class="op" id="6537991">:</span><span class="ident" id="6537992">total</span><span class="op" id="6537997">]</span><span class="op" id="6537998">)</span><span class="op" id="6537999">,</span>&nbsp;<span class="ident" id="6538001">bigtest</span><span class="op" id="6538008">.</span><span class="ident" id="6538009">decoded</span><span class="op" id="6538016">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538019">}</span><br>
<span class="lineno"></span><span class="op" id="6538021">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="keyword" id="6538024">func</span>&nbsp;<span class="ident" id="6538029">TestDecodeCorrupt</span><span class="op" id="6538046">(</span><span class="ident" id="6538047">t</span>&nbsp;<span class="op" id="6538049">*</span><span class="ident" id="6538050">testing</span><span class="op" id="6538057">.</span><span class="ident" id="6538058">T</span><span class="op" id="6538059">)</span>&nbsp;<span class="op" id="6538061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538064">testCases</span>&nbsp;<span class="op" id="6538074">:=</span>&nbsp;<span class="op" id="6538077">[</span><span class="op" id="6538078">]</span><span class="keyword" id="6538079">struct</span>&nbsp;<span class="op" id="6538086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538090">input</span>&nbsp;&nbsp;<span class="builtintype" id="6538097">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538106">offset</span>&nbsp;<span class="builtintype" id="6538113">int</span>&nbsp;<span class="comment" id="6538117">//&nbsp;-1&nbsp;means&nbsp;no&nbsp;corruption.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538145">}</span><span class="op" id="6538146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538150">{</span><span class="string" id="6538151">&#34;&#34;</span><span class="op" id="6538153">,</span>&nbsp;<span class="op" id="6538155">-</span><span class="num" id="6538156">1</span><span class="op" id="6538157">}</span><span class="op" id="6538158">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538162">{</span><span class="string" id="6538163">&#34;!!!!&#34;</span><span class="op" id="6538169">,</span>&nbsp;<span class="num" id="6538171">0</span><span class="op" id="6538172">}</span><span class="op" id="6538173">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538177">{</span><span class="string" id="6538178">&#34;====&#34;</span><span class="op" id="6538184">,</span>&nbsp;<span class="num" id="6538186">0</span><span class="op" id="6538187">}</span><span class="op" id="6538188">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538192">{</span><span class="string" id="6538193">&#34;x===&#34;</span><span class="op" id="6538199">,</span>&nbsp;<span class="num" id="6538201">1</span><span class="op" id="6538202">}</span><span class="op" id="6538203">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538207">{</span><span class="string" id="6538208">&#34;=AAA&#34;</span><span class="op" id="6538214">,</span>&nbsp;<span class="num" id="6538216">0</span><span class="op" id="6538217">}</span><span class="op" id="6538218">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538222">{</span><span class="string" id="6538223">&#34;A=AA&#34;</span><span class="op" id="6538229">,</span>&nbsp;<span class="num" id="6538231">1</span><span class="op" id="6538232">}</span><span class="op" id="6538233">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538237">{</span><span class="string" id="6538238">&#34;AA=A&#34;</span><span class="op" id="6538244">,</span>&nbsp;<span class="num" id="6538246">2</span><span class="op" id="6538247">}</span><span class="op" id="6538248">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538252">{</span><span class="string" id="6538253">&#34;AA==A&#34;</span><span class="op" id="6538260">,</span>&nbsp;<span class="num" id="6538262">4</span><span class="op" id="6538263">}</span><span class="op" id="6538264">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538268">{</span><span class="string" id="6538269">&#34;AAA=AAAA&#34;</span><span class="op" id="6538279">,</span>&nbsp;<span class="num" id="6538281">4</span><span class="op" id="6538282">}</span><span class="op" id="6538283">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538287">{</span><span class="string" id="6538288">&#34;AAAAA&#34;</span><span class="op" id="6538295">,</span>&nbsp;<span class="num" id="6538297">4</span><span class="op" id="6538298">}</span><span class="op" id="6538299">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538303">{</span><span class="string" id="6538304">&#34;AAAAAA&#34;</span><span class="op" id="6538312">,</span>&nbsp;<span class="num" id="6538314">4</span><span class="op" id="6538315">}</span><span class="op" id="6538316">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538320">{</span><span class="string" id="6538321">&#34;A=&#34;</span><span class="op" id="6538325">,</span>&nbsp;<span class="num" id="6538327">1</span><span class="op" id="6538328">}</span><span class="op" id="6538329">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538333">{</span><span class="string" id="6538334">&#34;A==&#34;</span><span class="op" id="6538339">,</span>&nbsp;<span class="num" id="6538341">1</span><span class="op" id="6538342">}</span><span class="op" id="6538343">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538347">{</span><span class="string" id="6538348">&#34;AA=&#34;</span><span class="op" id="6538353">,</span>&nbsp;<span class="num" id="6538355">3</span><span class="op" id="6538356">}</span><span class="op" id="6538357">,</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538361">{</span><span class="string" id="6538362">&#34;AA==&#34;</span><span class="op" id="6538368">,</span>&nbsp;<span class="op" id="6538370">-</span><span class="num" id="6538371">1</span><span class="op" id="6538372">}</span><span class="op" id="6538373">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538377">{</span><span class="string" id="6538378">&#34;AAA=&#34;</span><span class="op" id="6538384">,</span>&nbsp;<span class="op" id="6538386">-</span><span class="num" id="6538387">1</span><span class="op" id="6538388">}</span><span class="op" id="6538389">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538393">{</span><span class="string" id="6538394">&#34;AAAA&#34;</span><span class="op" id="6538400">,</span>&nbsp;<span class="op" id="6538402">-</span><span class="num" id="6538403">1</span><span class="op" id="6538404">}</span><span class="op" id="6538405">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538409">{</span><span class="string" id="6538410">&#34;AAAAAA=&#34;</span><span class="op" id="6538419">,</span>&nbsp;<span class="num" id="6538421">7</span><span class="op" id="6538422">}</span><span class="op" id="6538423">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538427">{</span><span class="string" id="6538428">&#34;YWJjZA=====&#34;</span><span class="op" id="6538441">,</span>&nbsp;<span class="num" id="6538443">8</span><span class="op" id="6538444">}</span><span class="op" id="6538445">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538451">for</span>&nbsp;<span class="ident" id="6538455">_</span><span class="op" id="6538456">,</span>&nbsp;<span class="ident" id="6538458">tc</span>&nbsp;<span class="op" id="6538461">:=</span>&nbsp;<span class="keyword" id="6538464">range</span>&nbsp;<span class="ident" id="6538470">testCases</span>&nbsp;<span class="op" id="6538480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538484">dbuf</span>&nbsp;<span class="op" id="6538489">:=</span>&nbsp;<span class="builtinfunc" id="6538492">make</span><span class="op" id="6538496">(</span><span class="op" id="6538497">[</span><span class="op" id="6538498">]</span><span class="builtintype" id="6538499">byte</span><span class="op" id="6538503">,</span>&nbsp;<span class="ident" id="6538505">StdEncoding</span><span class="op" id="6538516">.</span><span class="ident" id="6538517">DecodedLen</span><span class="op" id="6538527">(</span><span class="builtinfunc" id="6538528">len</span><span class="op" id="6538531">(</span><span class="ident" id="6538532">tc</span><span class="op" id="6538534">.</span><span class="ident" id="6538535">input</span><span class="op" id="6538540">)</span><span class="op" id="6538541">)</span><span class="op" id="6538542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538546">_</span><span class="op" id="6538547">,</span>&nbsp;<span class="ident" id="6538549">err</span>&nbsp;<span class="op" id="6538553">:=</span>&nbsp;<span class="ident" id="6538556">StdEncoding</span><span class="op" id="6538567">.</span><span class="ident" id="6538568">Decode</span><span class="op" id="6538574">(</span><span class="ident" id="6538575">dbuf</span><span class="op" id="6538579">,</span>&nbsp;<span class="op" id="6538581">[</span><span class="op" id="6538582">]</span><span class="builtintype" id="6538583">byte</span><span class="op" id="6538587">(</span><span class="ident" id="6538588">tc</span><span class="op" id="6538590">.</span><span class="ident" id="6538591">input</span><span class="op" id="6538596">)</span><span class="op" id="6538597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538601">if</span>&nbsp;<span class="ident" id="6538604">tc</span><span class="op" id="6538606">.</span><span class="ident" id="6538607">offset</span>&nbsp;<span class="op" id="6538614">==</span>&nbsp;<span class="op" id="6538617">-</span><span class="num" id="6538618">1</span>&nbsp;<span class="op" id="6538620">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538625">if</span>&nbsp;<span class="ident" id="6538628">err</span>&nbsp;<span class="op" id="6538632">!=</span>&nbsp;<span class="ident" id="6538635">nil</span>&nbsp;<span class="op" id="6538639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538645">t</span><span class="op" id="6538646">.</span><span class="ident" id="6538647">Error</span><span class="op" id="6538652">(</span><span class="string" id="6538653">&#34;Decoder&nbsp;wrongly&nbsp;detected&nbsp;coruption&nbsp;in&#34;</span><span class="op" id="6538692">,</span>&nbsp;<span class="ident" id="6538694">tc</span><span class="op" id="6538696">.</span><span class="ident" id="6538697">input</span><span class="op" id="6538702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538712">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538723">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538727">switch</span>&nbsp;<span class="ident" id="6538734">err</span>&nbsp;<span class="op" id="6538738">:=</span>&nbsp;<span class="ident" id="6538741">err</span><span class="op" id="6538744">.</span><span class="op" id="6538745">(</span><span class="keyword" id="6538746">type</span><span class="op" id="6538750">)</span>&nbsp;<span class="op" id="6538752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538756">case</span>&nbsp;<span class="ident" id="6538761">CorruptInputError</span><span class="op" id="6538778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538783">testEqual</span><span class="op" id="6538792">(</span><span class="ident" id="6538793">t</span><span class="op" id="6538794">,</span>&nbsp;<span class="string" id="6538796">&#34;Corruption&nbsp;in&nbsp;%q&nbsp;at&nbsp;offset&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6538836">,</span>&nbsp;<span class="ident" id="6538838">tc</span><span class="op" id="6538840">.</span><span class="ident" id="6538841">input</span><span class="op" id="6538846">,</span>&nbsp;<span class="builtintype" id="6538848">int</span><span class="op" id="6538851">(</span><span class="ident" id="6538852">err</span><span class="op" id="6538855">)</span><span class="op" id="6538856">,</span>&nbsp;<span class="ident" id="6538858">tc</span><span class="op" id="6538860">.</span><span class="ident" id="6538861">offset</span><span class="op" id="6538867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6538871">default</span><span class="op" id="6538878">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538883">t</span><span class="op" id="6538884">.</span><span class="ident" id="6538885">Error</span><span class="op" id="6538890">(</span><span class="string" id="6538891">&#34;Decoder&nbsp;failed&nbsp;to&nbsp;detect&nbsp;corruption&nbsp;in&#34;</span><span class="op" id="6538931">,</span>&nbsp;<span class="ident" id="6538933">tc</span><span class="op" id="6538935">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6538942">}</span><br>
<span class="lineno"></span><span class="op" id="6538944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6538947">func</span>&nbsp;<span class="ident" id="6538952">TestBig</span><span class="op" id="6538959">(</span><span class="ident" id="6538960">t</span>&nbsp;<span class="op" id="6538962">*</span><span class="ident" id="6538963">testing</span><span class="op" id="6538970">.</span><span class="ident" id="6538971">T</span><span class="op" id="6538972">)</span>&nbsp;<span class="op" id="6538974">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538977">n</span>&nbsp;<span class="op" id="6538979">:=</span>&nbsp;<span class="num" id="6538982">3</span><span class="op" id="6538983">*</span><span class="num" id="6538984">1000</span>&nbsp;<span class="op" id="6538989">+</span>&nbsp;<span class="num" id="6538991">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6538994">raw</span>&nbsp;<span class="op" id="6538998">:=</span>&nbsp;<span class="builtinfunc" id="6539001">make</span><span class="op" id="6539005">(</span><span class="op" id="6539006">[</span><span class="op" id="6539007">]</span><span class="builtintype" id="6539008">byte</span><span class="op" id="6539012">,</span>&nbsp;<span class="ident" id="6539014">n</span><span class="op" id="6539015">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539018">const</span>&nbsp;<span class="ident" id="6539024">alpha</span>&nbsp;<span class="op" id="6539030">=</span>&nbsp;<span class="string" id="6539032">&#34;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539098">for</span>&nbsp;<span class="ident" id="6539102">i</span>&nbsp;<span class="op" id="6539104">:=</span>&nbsp;<span class="num" id="6539107">0</span><span class="op" id="6539108">;</span>&nbsp;<span class="ident" id="6539110">i</span>&nbsp;<span class="op" id="6539112">&lt;</span>&nbsp;<span class="ident" id="6539114">n</span><span class="op" id="6539115">;</span>&nbsp;<span class="ident" id="6539117">i</span><span class="op" id="6539118">++</span>&nbsp;<span class="op" id="6539121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539125">raw</span><span class="op" id="6539128">[</span><span class="ident" id="6539129">i</span><span class="op" id="6539130">]</span>&nbsp;<span class="op" id="6539132">=</span>&nbsp;<span class="ident" id="6539134">alpha</span><span class="op" id="6539139">[</span><span class="ident" id="6539140">i</span><span class="op" id="6539141">%</span><span class="builtinfunc" id="6539142">len</span><span class="op" id="6539145">(</span><span class="ident" id="6539146">alpha</span><span class="op" id="6539151">)</span><span class="op" id="6539152">]</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539158">encoded</span>&nbsp;<span class="op" id="6539166">:=</span>&nbsp;<span class="builtinfunc" id="6539169">new</span><span class="op" id="6539172">(</span><span class="ident" id="6539173">bytes</span><span class="op" id="6539178">.</span><span class="ident" id="6539179">Buffer</span><span class="op" id="6539185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539188">w</span>&nbsp;<span class="op" id="6539190">:=</span>&nbsp;<span class="ident" id="6539193">NewEncoder</span><span class="op" id="6539203">(</span><span class="ident" id="6539204">StdEncoding</span><span class="op" id="6539215">,</span>&nbsp;<span class="ident" id="6539217">encoded</span><span class="op" id="6539224">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539227">nn</span><span class="op" id="6539229">,</span>&nbsp;<span class="ident" id="6539231">err</span>&nbsp;<span class="op" id="6539235">:=</span>&nbsp;<span class="ident" id="6539238">w</span><span class="op" id="6539239">.</span><span class="ident" id="6539240">Write</span><span class="op" id="6539245">(</span><span class="ident" id="6539246">raw</span><span class="op" id="6539249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539252">if</span>&nbsp;<span class="ident" id="6539255">nn</span>&nbsp;<span class="op" id="6539258">!=</span>&nbsp;<span class="ident" id="6539261">n</span>&nbsp;<span class="op" id="6539263">||</span>&nbsp;<span class="ident" id="6539266">err</span>&nbsp;<span class="op" id="6539270">!=</span>&nbsp;<span class="ident" id="6539273">nil</span>&nbsp;<span class="op" id="6539277">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539281">t</span><span class="op" id="6539282">.</span><span class="ident" id="6539283">Fatalf</span><span class="op" id="6539289">(</span><span class="string" id="6539290">&#34;Encoder.Write(raw)&nbsp;=&nbsp;%d,&nbsp;%v&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="6539332">,</span>&nbsp;<span class="ident" id="6539334">nn</span><span class="op" id="6539336">,</span>&nbsp;<span class="ident" id="6539338">err</span><span class="op" id="6539341">,</span>&nbsp;<span class="ident" id="6539343">n</span><span class="op" id="6539344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539347">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539350">err</span>&nbsp;<span class="op" id="6539354">=</span>&nbsp;<span class="ident" id="6539356">w</span><span class="op" id="6539357">.</span><span class="ident" id="6539358">Close</span><span class="op" id="6539363">(</span><span class="op" id="6539364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539367">if</span>&nbsp;<span class="ident" id="6539370">err</span>&nbsp;<span class="op" id="6539374">!=</span>&nbsp;<span class="ident" id="6539377">nil</span>&nbsp;<span class="op" id="6539381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539385">t</span><span class="op" id="6539386">.</span><span class="ident" id="6539387">Fatalf</span><span class="op" id="6539393">(</span><span class="string" id="6539394">&#34;Encoder.Close()&nbsp;=&nbsp;%v&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6539425">,</span>&nbsp;<span class="ident" id="6539427">err</span><span class="op" id="6539430">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539436">decoded</span><span class="op" id="6539443">,</span>&nbsp;<span class="ident" id="6539445">err</span>&nbsp;<span class="op" id="6539449">:=</span>&nbsp;<span class="ident" id="6539452">ioutil</span><span class="op" id="6539458">.</span><span class="ident" id="6539459">ReadAll</span><span class="op" id="6539466">(</span><span class="ident" id="6539467">NewDecoder</span><span class="op" id="6539477">(</span><span class="ident" id="6539478">StdEncoding</span><span class="op" id="6539489">,</span>&nbsp;<span class="ident" id="6539491">encoded</span><span class="op" id="6539498">)</span><span class="op" id="6539499">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539502">if</span>&nbsp;<span class="ident" id="6539505">err</span>&nbsp;<span class="op" id="6539509">!=</span>&nbsp;<span class="ident" id="6539512">nil</span>&nbsp;<span class="op" id="6539516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539520">t</span><span class="op" id="6539521">.</span><span class="ident" id="6539522">Fatalf</span><span class="op" id="6539528">(</span><span class="string" id="6539529">&#34;ioutil.ReadAll(NewDecoder(...)):&nbsp;%v&#34;</span><span class="op" id="6539566">,</span>&nbsp;<span class="ident" id="6539568">err</span><span class="op" id="6539571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539574">}</span><br>
<span class="lineno">210</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539578">if</span>&nbsp;<span class="op" id="6539581">!</span><span class="ident" id="6539582">bytes</span><span class="op" id="6539587">.</span><span class="ident" id="6539588">Equal</span><span class="op" id="6539593">(</span><span class="ident" id="6539594">raw</span><span class="op" id="6539597">,</span>&nbsp;<span class="ident" id="6539599">decoded</span><span class="op" id="6539606">)</span>&nbsp;<span class="op" id="6539608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539612">var</span>&nbsp;<span class="ident" id="6539616">i</span>&nbsp;<span class="builtintype" id="6539618">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539624">for</span>&nbsp;<span class="ident" id="6539628">i</span>&nbsp;<span class="op" id="6539630">=</span>&nbsp;<span class="num" id="6539632">0</span><span class="op" id="6539633">;</span>&nbsp;<span class="ident" id="6539635">i</span>&nbsp;<span class="op" id="6539637">&lt;</span>&nbsp;<span class="builtinfunc" id="6539639">len</span><span class="op" id="6539642">(</span><span class="ident" id="6539643">decoded</span><span class="op" id="6539650">)</span>&nbsp;<span class="op" id="6539652">&amp;&amp;</span>&nbsp;<span class="ident" id="6539655">i</span>&nbsp;<span class="op" id="6539657">&lt;</span>&nbsp;<span class="builtinfunc" id="6539659">len</span><span class="op" id="6539662">(</span><span class="ident" id="6539663">raw</span><span class="op" id="6539666">)</span><span class="op" id="6539667">;</span>&nbsp;<span class="ident" id="6539669">i</span><span class="op" id="6539670">++</span>&nbsp;<span class="op" id="6539673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539678">if</span>&nbsp;<span class="ident" id="6539681">decoded</span><span class="op" id="6539688">[</span><span class="ident" id="6539689">i</span><span class="op" id="6539690">]</span>&nbsp;<span class="op" id="6539692">!=</span>&nbsp;<span class="ident" id="6539695">raw</span><span class="op" id="6539698">[</span><span class="ident" id="6539699">i</span><span class="op" id="6539700">]</span>&nbsp;<span class="op" id="6539702">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539708">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539721">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539725">t</span><span class="op" id="6539726">.</span><span class="ident" id="6539727">Errorf</span><span class="op" id="6539733">(</span><span class="string" id="6539734">&#34;Decode(Encode(%d-byte&nbsp;string))&nbsp;failed&nbsp;at&nbsp;offset&nbsp;%d&#34;</span><span class="op" id="6539786">,</span>&nbsp;<span class="ident" id="6539788">n</span><span class="op" id="6539789">,</span>&nbsp;<span class="ident" id="6539791">i</span><span class="op" id="6539792">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6539795">}</span><br>
<span class="lineno">220</span><span class="op" id="6539797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6539800">func</span>&nbsp;<span class="ident" id="6539805">TestNewLineCharacters</span><span class="op" id="6539826">(</span><span class="ident" id="6539827">t</span>&nbsp;<span class="op" id="6539829">*</span><span class="ident" id="6539830">testing</span><span class="op" id="6539837">.</span><span class="ident" id="6539838">T</span><span class="op" id="6539839">)</span>&nbsp;<span class="op" id="6539841">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6539844">//&nbsp;Each&nbsp;of&nbsp;these&nbsp;should&nbsp;decode&nbsp;to&nbsp;the&nbsp;string&nbsp;&#34;sure&#34;,&nbsp;without&nbsp;errors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6539914">const</span>&nbsp;<span class="ident" id="6539920">expected</span>&nbsp;<span class="op" id="6539929">=</span>&nbsp;<span class="string" id="6539931">&#34;sure&#34;</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6539939">examples</span>&nbsp;<span class="op" id="6539948">:=</span>&nbsp;<span class="op" id="6539951">[</span><span class="op" id="6539952">]</span><span class="builtintype" id="6539953">string</span><span class="op" id="6539959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6539963">&#34;c3VyZQ==&#34;</span><span class="op" id="6539973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6539977">&#34;c3VyZQ==\r&#34;</span><span class="op" id="6539989">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6539993">&#34;c3VyZQ==\n&#34;</span><span class="op" id="6540005">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540009">&#34;c3VyZQ==\r\n&#34;</span><span class="op" id="6540023">,</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540027">&#34;c3VyZ\r\nQ==&#34;</span><span class="op" id="6540041">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540045">&#34;c3V\ryZ\nQ==&#34;</span><span class="op" id="6540059">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540063">&#34;c3V\nyZ\rQ==&#34;</span><span class="op" id="6540077">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540081">&#34;c3VyZ\nQ==&#34;</span><span class="op" id="6540093">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540097">&#34;c3VyZQ\n==&#34;</span><span class="op" id="6540109">,</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540113">&#34;c3VyZQ=\n=&#34;</span><span class="op" id="6540125">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6540129">&#34;c3VyZQ=\r\n\r\n=&#34;</span><span class="op" id="6540147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540153">for</span>&nbsp;<span class="ident" id="6540157">_</span><span class="op" id="6540158">,</span>&nbsp;<span class="ident" id="6540160">e</span>&nbsp;<span class="op" id="6540162">:=</span>&nbsp;<span class="keyword" id="6540165">range</span>&nbsp;<span class="ident" id="6540171">examples</span>&nbsp;<span class="op" id="6540180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540184">buf</span><span class="op" id="6540187">,</span>&nbsp;<span class="ident" id="6540189">err</span>&nbsp;<span class="op" id="6540193">:=</span>&nbsp;<span class="ident" id="6540196">StdEncoding</span><span class="op" id="6540207">.</span><span class="ident" id="6540208">DecodeString</span><span class="op" id="6540220">(</span><span class="ident" id="6540221">e</span><span class="op" id="6540222">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540226">if</span>&nbsp;<span class="ident" id="6540229">err</span>&nbsp;<span class="op" id="6540233">!=</span>&nbsp;<span class="ident" id="6540236">nil</span>&nbsp;<span class="op" id="6540240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540245">t</span><span class="op" id="6540246">.</span><span class="ident" id="6540247">Errorf</span><span class="op" id="6540253">(</span><span class="string" id="6540254">&#34;Decode(%q)&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6540277">,</span>&nbsp;<span class="ident" id="6540279">e</span><span class="op" id="6540280">,</span>&nbsp;<span class="ident" id="6540282">err</span><span class="op" id="6540285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540290">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540305">if</span>&nbsp;<span class="ident" id="6540308">s</span>&nbsp;<span class="op" id="6540310">:=</span>&nbsp;<span class="builtintype" id="6540313">string</span><span class="op" id="6540319">(</span><span class="ident" id="6540320">buf</span><span class="op" id="6540323">)</span><span class="op" id="6540324">;</span>&nbsp;<span class="ident" id="6540326">s</span>&nbsp;<span class="op" id="6540328">!=</span>&nbsp;<span class="ident" id="6540331">expected</span>&nbsp;<span class="op" id="6540340">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540345">t</span><span class="op" id="6540346">.</span><span class="ident" id="6540347">Errorf</span><span class="op" id="6540353">(</span><span class="string" id="6540354">&#34;Decode(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6540380">,</span>&nbsp;<span class="ident" id="6540382">e</span><span class="op" id="6540383">,</span>&nbsp;<span class="ident" id="6540385">s</span><span class="op" id="6540386">,</span>&nbsp;<span class="ident" id="6540388">expected</span><span class="op" id="6540396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540403">}</span><br>
<span class="lineno"></span><span class="op" id="6540405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6540408">type</span>&nbsp;<span class="ident" id="6540413">nextRead</span>&nbsp;<span class="keyword" id="6540422">struct</span>&nbsp;<span class="op" id="6540429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540432">n</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6540436">int</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6540442">//&nbsp;bytes&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540462">err</span>&nbsp;<span class="builtintype" id="6540466">error</span>&nbsp;<span class="comment" id="6540472">//&nbsp;error&nbsp;to&nbsp;return</span><br>
<span class="lineno"></span><span class="op" id="6540491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6540494">//&nbsp;faultInjectReader&nbsp;returns&nbsp;data&nbsp;from&nbsp;source,&nbsp;rate-limited</span><br>
<span class="lineno"></span><span class="comment" id="6540554">//&nbsp;and&nbsp;with&nbsp;the&nbsp;errors&nbsp;as&nbsp;written&nbsp;to&nbsp;nextc.</span><br>
<span class="lineno"></span><span class="keyword" id="6540598">type</span>&nbsp;<span class="ident" id="6540603">faultInjectReader</span>&nbsp;<span class="keyword" id="6540621">struct</span>&nbsp;<span class="op" id="6540628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540631">source</span>&nbsp;<span class="builtintype" id="6540638">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540646">nextc</span>&nbsp;&nbsp;<span class="op" id="6540653">&lt;-</span><span class="keyword" id="6540655">chan</span>&nbsp;<span class="ident" id="6540660">nextRead</span><br>
<span class="lineno">260</span><span class="op" id="6540669">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6540672">func</span>&nbsp;<span class="op" id="6540677">(</span><span class="ident" id="6540678">r</span>&nbsp;<span class="op" id="6540680">*</span><span class="ident" id="6540681">faultInjectReader</span><span class="op" id="6540698">)</span>&nbsp;<span class="ident" id="6540700">Read</span><span class="op" id="6540704">(</span><span class="ident" id="6540705">p</span>&nbsp;<span class="op" id="6540707">[</span><span class="op" id="6540708">]</span><span class="builtintype" id="6540709">byte</span><span class="op" id="6540713">)</span>&nbsp;<span class="op" id="6540715">(</span><span class="builtintype" id="6540716">int</span><span class="op" id="6540719">,</span>&nbsp;<span class="builtintype" id="6540721">error</span><span class="op" id="6540726">)</span>&nbsp;<span class="op" id="6540728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540731">nr</span>&nbsp;<span class="op" id="6540734">:=</span>&nbsp;<span class="op" id="6540737">&lt;-</span><span class="ident" id="6540739">r</span><span class="op" id="6540740">.</span><span class="ident" id="6540741">nextc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540748">if</span>&nbsp;<span class="builtinfunc" id="6540751">len</span><span class="op" id="6540754">(</span><span class="ident" id="6540755">p</span><span class="op" id="6540756">)</span>&nbsp;<span class="op" id="6540758">&gt;</span>&nbsp;<span class="ident" id="6540760">nr</span><span class="op" id="6540762">.</span><span class="ident" id="6540763">n</span>&nbsp;<span class="op" id="6540765">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540769">p</span>&nbsp;<span class="op" id="6540771">=</span>&nbsp;<span class="ident" id="6540773">p</span><span class="op" id="6540774">[</span><span class="op" id="6540775">:</span><span class="ident" id="6540776">nr</span><span class="op" id="6540778">.</span><span class="ident" id="6540779">n</span><span class="op" id="6540780">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6540783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540786">n</span>&nbsp;<span class="op" id="6540788">:=</span>&nbsp;<span class="builtinfunc" id="6540791">copy</span><span class="op" id="6540795">(</span><span class="ident" id="6540796">p</span><span class="op" id="6540797">,</span>&nbsp;<span class="ident" id="6540799">r</span><span class="op" id="6540800">.</span><span class="ident" id="6540801">source</span><span class="op" id="6540807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540810">r</span><span class="op" id="6540811">.</span><span class="ident" id="6540812">source</span>&nbsp;<span class="op" id="6540819">=</span>&nbsp;<span class="ident" id="6540821">r</span><span class="op" id="6540822">.</span><span class="ident" id="6540823">source</span><span class="op" id="6540829">[</span><span class="ident" id="6540830">n</span><span class="op" id="6540831">:</span><span class="op" id="6540832">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6540835">return</span>&nbsp;<span class="ident" id="6540842">n</span><span class="op" id="6540843">,</span>&nbsp;<span class="ident" id="6540845">nr</span><span class="op" id="6540847">.</span><span class="ident" id="6540848">err</span><br>
<span class="lineno">270</span><span class="op" id="6540852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6540855">//&nbsp;tests&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;ignore&nbsp;errors&nbsp;from&nbsp;our&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span><span class="keyword" id="6540919">func</span>&nbsp;<span class="ident" id="6540924">TestDecoderIssue3577</span><span class="op" id="6540944">(</span><span class="ident" id="6540945">t</span>&nbsp;<span class="op" id="6540947">*</span><span class="ident" id="6540948">testing</span><span class="op" id="6540955">.</span><span class="ident" id="6540956">T</span><span class="op" id="6540957">)</span>&nbsp;<span class="op" id="6540959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540962">next</span>&nbsp;<span class="op" id="6540967">:=</span>&nbsp;<span class="builtinfunc" id="6540970">make</span><span class="op" id="6540974">(</span><span class="keyword" id="6540975">chan</span>&nbsp;<span class="ident" id="6540980">nextRead</span><span class="op" id="6540988">,</span>&nbsp;<span class="num" id="6540990">10</span><span class="op" id="6540992">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6540995">wantErr</span>&nbsp;<span class="op" id="6541003">:=</span>&nbsp;<span class="ident" id="6541006">errors</span><span class="op" id="6541012">.</span><span class="ident" id="6541013">New</span><span class="op" id="6541016">(</span><span class="string" id="6541017">&#34;my&nbsp;error&#34;</span><span class="op" id="6541027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541030">next</span>&nbsp;<span class="op" id="6541035">&lt;-</span>&nbsp;<span class="ident" id="6541038">nextRead</span><span class="op" id="6541046">{</span><span class="num" id="6541047">5</span><span class="op" id="6541048">,</span>&nbsp;<span class="ident" id="6541050">nil</span><span class="op" id="6541053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541056">next</span>&nbsp;<span class="op" id="6541061">&lt;-</span>&nbsp;<span class="ident" id="6541064">nextRead</span><span class="op" id="6541072">{</span><span class="num" id="6541073">10</span><span class="op" id="6541075">,</span>&nbsp;<span class="ident" id="6541077">wantErr</span><span class="op" id="6541084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541087">next</span>&nbsp;<span class="op" id="6541092">&lt;-</span>&nbsp;<span class="ident" id="6541095">nextRead</span><span class="op" id="6541103">{</span><span class="num" id="6541104">0</span><span class="op" id="6541105">,</span>&nbsp;<span class="ident" id="6541107">wantErr</span><span class="op" id="6541114">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541117">d</span>&nbsp;<span class="op" id="6541119">:=</span>&nbsp;<span class="ident" id="6541122">NewDecoder</span><span class="op" id="6541132">(</span><span class="ident" id="6541133">StdEncoding</span><span class="op" id="6541144">,</span>&nbsp;<span class="op" id="6541146">&amp;</span><span class="ident" id="6541147">faultInjectReader</span><span class="op" id="6541164">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541168">source</span><span class="op" id="6541174">:</span>&nbsp;<span class="string" id="6541176">&#34;VHdhcyBicmlsbGlnLCBhbmQgdGhlIHNsaXRoeSB0b3Zlcw==&#34;</span><span class="op" id="6541226">,</span>&nbsp;<span class="comment" id="6541228">//&nbsp;twas&nbsp;brillig...</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541249">nextc</span><span class="op" id="6541254">:</span>&nbsp;&nbsp;<span class="ident" id="6541257">next</span><span class="op" id="6541261">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541264">}</span><span class="op" id="6541265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541268">errc</span>&nbsp;<span class="op" id="6541273">:=</span>&nbsp;<span class="builtinfunc" id="6541276">make</span><span class="op" id="6541280">(</span><span class="keyword" id="6541281">chan</span>&nbsp;<span class="builtintype" id="6541286">error</span><span class="op" id="6541291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541294">go</span>&nbsp;<span class="keyword" id="6541297">func</span><span class="op" id="6541301">(</span><span class="op" id="6541302">)</span>&nbsp;<span class="op" id="6541304">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541308">_</span><span class="op" id="6541309">,</span>&nbsp;<span class="ident" id="6541311">err</span>&nbsp;<span class="op" id="6541315">:=</span>&nbsp;<span class="ident" id="6541318">ioutil</span><span class="op" id="6541324">.</span><span class="ident" id="6541325">ReadAll</span><span class="op" id="6541332">(</span><span class="ident" id="6541333">d</span><span class="op" id="6541334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541338">errc</span>&nbsp;<span class="op" id="6541343">&lt;-</span>&nbsp;<span class="ident" id="6541346">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541351">}</span><span class="op" id="6541352">(</span><span class="op" id="6541353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541356">select</span>&nbsp;<span class="op" id="6541363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541366">case</span>&nbsp;<span class="ident" id="6541371">err</span>&nbsp;<span class="op" id="6541375">:=</span>&nbsp;<span class="op" id="6541378">&lt;-</span><span class="ident" id="6541380">errc</span><span class="op" id="6541384">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541388">if</span>&nbsp;<span class="ident" id="6541391">err</span>&nbsp;<span class="op" id="6541395">!=</span>&nbsp;<span class="ident" id="6541398">wantErr</span>&nbsp;<span class="op" id="6541406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541411">t</span><span class="op" id="6541412">.</span><span class="ident" id="6541413">Errorf</span><span class="op" id="6541419">(</span><span class="string" id="6541420">&#34;got&nbsp;error&nbsp;%v;&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6541443">,</span>&nbsp;<span class="ident" id="6541445">err</span><span class="op" id="6541448">,</span>&nbsp;<span class="ident" id="6541450">wantErr</span><span class="op" id="6541457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541461">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6541464">case</span>&nbsp;<span class="op" id="6541469">&lt;-</span><span class="ident" id="6541471">time</span><span class="op" id="6541475">.</span><span class="ident" id="6541476">After</span><span class="op" id="6541481">(</span><span class="num" id="6541482">5</span>&nbsp;<span class="op" id="6541484">*</span>&nbsp;<span class="ident" id="6541486">time</span><span class="op" id="6541490">.</span><span class="ident" id="6541491">Second</span><span class="op" id="6541497">)</span><span class="op" id="6541498">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541502">t</span><span class="op" id="6541503">.</span><span class="ident" id="6541504">Errorf</span><span class="op" id="6541510">(</span><span class="string" id="6541511">&#34;timeout;&nbsp;Decoder&nbsp;blocked&nbsp;without&nbsp;returning&nbsp;an&nbsp;error&#34;</span><span class="op" id="6541564">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6541567">}</span><br>
<span class="lineno"></span><span class="op" id="6541569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6541572">func</span>&nbsp;<span class="ident" id="6541577">TestDecoderIssue4779</span><span class="op" id="6541597">(</span><span class="ident" id="6541598">t</span>&nbsp;<span class="op" id="6541600">*</span><span class="ident" id="6541601">testing</span><span class="op" id="6541608">.</span><span class="ident" id="6541609">T</span><span class="op" id="6541610">)</span>&nbsp;<span class="op" id="6541612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6541615">encoded</span>&nbsp;<span class="op" id="6541623">:=</span>&nbsp;<span class="string" id="6541626">`CP/EAT8AAAEF<br>
<span class="lineno">300</span>AQEBAQEBAAAAAAAAAAMAAQIEBQYHCAkKCwEAAQUBAQEBAQEAAAAAAAAAAQACAwQFBgcICQoLEAAB<br>
<span class="lineno"></span>BAEDAgQCBQcGCAUDDDMBAAIRAwQhEjEFQVFhEyJxgTIGFJGhsUIjJBVSwWIzNHKC0UMHJZJT8OHx<br>
<span class="lineno"></span>Y3M1FqKygyZEk1RkRcKjdDYX0lXiZfKzhMPTdePzRieUpIW0lcTU5PSltcXV5fVWZnaGlqa2xtbm<br>
<span class="lineno"></span>9jdHV2d3h5ent8fX5/cRAAICAQIEBAMEBQYHBwYFNQEAAhEDITESBEFRYXEiEwUygZEUobFCI8FS<br>
<span class="lineno"></span>0fAzJGLhcoKSQ1MVY3M08SUGFqKygwcmNcLSRJNUoxdkRVU2dGXi8rOEw9N14/NGlKSFtJXE1OT0<br>
<span class="lineno">305</span>pbXF1eX1VmZ2hpamtsbW5vYnN0dXZ3eHl6e3x//aAAwDAQACEQMRAD8A9VSSSSUpJJJJSkkkJ+Tj<br>
<span class="lineno"></span>1kiy1jCJJDnAcCTykpKkuQ6p/jN6FgmxlNduXawwAzaGH+V6jn/R/wCt71zdn+N/qL3kVYFNYB4N<br>
<span class="lineno"></span>ji6PDVjWpKp9TSXnvTf8bFNjg3qOEa2n6VlLpj/rT/pf567DpX1i6L1hs9Py67X8mqdtg/rUWbbf<br>
<span class="lineno"></span>+gkp0kkkklKSSSSUpJJJJT//0PVUkkklKVLq3WMDpGI7KzrNjADtYNXvI/Mqr/Pd/q9W3vaxjnvM<br>
<span class="lineno"></span>NaCXE9gNSvGPrf8AWS3qmba5jjsJhoB0DAf0NDf6sevf+/lf8Hj0JJATfWT6/dV6oXU1uOLQeKKn<br>
<span class="lineno">310</span>EQP+Hubtfe/+R7Mf/g7f5xcocp++Z11JMCJPgFBxOg7/AOuqDx8I/ikpkXkmSdU8mJIJA/O8EMAy<br>
<span class="lineno"></span>j+mSARB/17pKVXYWHXjsj7yIex0PadzXMO1zT5KHoNA3HT8ietoGhgjsfA+CSnvvqh/jJtqsrwOv<br>
<span class="lineno"></span>2b6NGNzXfTYexzJ+nU7/ALkf4P8Awv6P9KvTQQ4AgyDqCF85Pho3CTB7eHwXoH+LT65uZbX9X+o2<br>
<span class="lineno"></span>bqbPb06551Y4<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542657">encodedShort</span>&nbsp;<span class="op" id="6542670">:=</span>&nbsp;<span class="ident" id="6542673">strings</span><span class="op" id="6542680">.</span><span class="ident" id="6542681">Replace</span><span class="op" id="6542688">(</span><span class="ident" id="6542689">encoded</span><span class="op" id="6542696">,</span>&nbsp;<span class="string" id="6542698">&#34;\n&#34;</span><span class="op" id="6542702">,</span>&nbsp;<span class="string" id="6542704">&#34;&#34;</span><span class="op" id="6542706">,</span>&nbsp;<span class="op" id="6542708">-</span><span class="num" id="6542709">1</span><span class="op" id="6542710">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542714">dec</span>&nbsp;<span class="op" id="6542718">:=</span>&nbsp;<span class="ident" id="6542721">NewDecoder</span><span class="op" id="6542731">(</span><span class="ident" id="6542732">StdEncoding</span><span class="op" id="6542743">,</span>&nbsp;<span class="ident" id="6542745">strings</span><span class="op" id="6542752">.</span><span class="ident" id="6542753">NewReader</span><span class="op" id="6542762">(</span><span class="ident" id="6542763">encoded</span><span class="op" id="6542770">)</span><span class="op" id="6542771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542774">res1</span><span class="op" id="6542778">,</span>&nbsp;<span class="ident" id="6542780">err</span>&nbsp;<span class="op" id="6542784">:=</span>&nbsp;<span class="ident" id="6542787">ioutil</span><span class="op" id="6542793">.</span><span class="ident" id="6542794">ReadAll</span><span class="op" id="6542801">(</span><span class="ident" id="6542802">dec</span><span class="op" id="6542805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542808">if</span>&nbsp;<span class="ident" id="6542811">err</span>&nbsp;<span class="op" id="6542815">!=</span>&nbsp;<span class="ident" id="6542818">nil</span>&nbsp;<span class="op" id="6542822">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542826">t</span><span class="op" id="6542827">.</span><span class="ident" id="6542828">Errorf</span><span class="op" id="6542834">(</span><span class="string" id="6542835">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6542855">,</span>&nbsp;<span class="ident" id="6542857">err</span><span class="op" id="6542860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6542863">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542867">dec</span>&nbsp;<span class="op" id="6542871">=</span>&nbsp;<span class="ident" id="6542873">NewDecoder</span><span class="op" id="6542883">(</span><span class="ident" id="6542884">StdEncoding</span><span class="op" id="6542895">,</span>&nbsp;<span class="ident" id="6542897">strings</span><span class="op" id="6542904">.</span><span class="ident" id="6542905">NewReader</span><span class="op" id="6542914">(</span><span class="ident" id="6542915">encodedShort</span><span class="op" id="6542927">)</span><span class="op" id="6542928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542931">var</span>&nbsp;<span class="ident" id="6542935">res2</span>&nbsp;<span class="op" id="6542940">[</span><span class="op" id="6542941">]</span><span class="builtintype" id="6542942">byte</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542948">res2</span><span class="op" id="6542952">,</span>&nbsp;<span class="ident" id="6542954">err</span>&nbsp;<span class="op" id="6542958">=</span>&nbsp;<span class="ident" id="6542960">ioutil</span><span class="op" id="6542966">.</span><span class="ident" id="6542967">ReadAll</span><span class="op" id="6542974">(</span><span class="ident" id="6542975">dec</span><span class="op" id="6542978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6542981">if</span>&nbsp;<span class="ident" id="6542984">err</span>&nbsp;<span class="op" id="6542988">!=</span>&nbsp;<span class="ident" id="6542991">nil</span>&nbsp;<span class="op" id="6542995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6542999">t</span><span class="op" id="6543000">.</span><span class="ident" id="6543001">Errorf</span><span class="op" id="6543007">(</span><span class="string" id="6543008">&#34;ReadAll&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="6543028">,</span>&nbsp;<span class="ident" id="6543030">err</span><span class="op" id="6543033">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543036">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543040">if</span>&nbsp;<span class="op" id="6543043">!</span><span class="ident" id="6543044">bytes</span><span class="op" id="6543049">.</span><span class="ident" id="6543050">Equal</span><span class="op" id="6543055">(</span><span class="ident" id="6543056">res1</span><span class="op" id="6543060">,</span>&nbsp;<span class="ident" id="6543062">res2</span><span class="op" id="6543066">)</span>&nbsp;<span class="op" id="6543068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543072">t</span><span class="op" id="6543073">.</span><span class="ident" id="6543074">Error</span><span class="op" id="6543079">(</span><span class="string" id="6543080">&#34;Decoded&nbsp;results&nbsp;not&nbsp;equal&#34;</span><span class="op" id="6543107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543110">}</span><br>
<span class="lineno"></span><span class="op" id="6543112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span><span class="keyword" id="6543115">func</span>&nbsp;<span class="ident" id="6543120">TestDecoderIssue7733</span><span class="op" id="6543140">(</span><span class="ident" id="6543141">t</span>&nbsp;<span class="op" id="6543143">*</span><span class="ident" id="6543144">testing</span><span class="op" id="6543151">.</span><span class="ident" id="6543152">T</span><span class="op" id="6543153">)</span>&nbsp;<span class="op" id="6543155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543158">s</span><span class="op" id="6543159">,</span>&nbsp;<span class="ident" id="6543161">err</span>&nbsp;<span class="op" id="6543165">:=</span>&nbsp;<span class="ident" id="6543168">StdEncoding</span><span class="op" id="6543179">.</span><span class="ident" id="6543180">DecodeString</span><span class="op" id="6543192">(</span><span class="string" id="6543193">&#34;YWJjZA=====&#34;</span><span class="op" id="6543206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543209">want</span>&nbsp;<span class="op" id="6543214">:=</span>&nbsp;<span class="ident" id="6543217">CorruptInputError</span><span class="op" id="6543234">(</span><span class="num" id="6543235">8</span><span class="op" id="6543236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543239">if</span>&nbsp;<span class="op" id="6543242">!</span><span class="ident" id="6543243">reflect</span><span class="op" id="6543250">.</span><span class="ident" id="6543251">DeepEqual</span><span class="op" id="6543260">(</span><span class="ident" id="6543261">want</span><span class="op" id="6543265">,</span>&nbsp;<span class="ident" id="6543267">err</span><span class="op" id="6543270">)</span>&nbsp;<span class="op" id="6543272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543276">t</span><span class="op" id="6543277">.</span><span class="ident" id="6543278">Errorf</span><span class="op" id="6543284">(</span><span class="string" id="6543285">&#34;Error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;CorruptInputError(8)&#34;</span><span class="op" id="6543324">,</span>&nbsp;<span class="ident" id="6543326">err</span><span class="op" id="6543329">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543335">if</span>&nbsp;<span class="builtintype" id="6543338">string</span><span class="op" id="6543344">(</span><span class="ident" id="6543345">s</span><span class="op" id="6543346">)</span>&nbsp;<span class="op" id="6543348">!=</span>&nbsp;<span class="string" id="6543351">&#34;abcd&#34;</span>&nbsp;<span class="op" id="6543358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543362">t</span><span class="op" id="6543363">.</span><span class="ident" id="6543364">Errorf</span><span class="op" id="6543370">(</span><span class="string" id="6543371">&#34;DecodeString&nbsp;=&nbsp;%q;&nbsp;want&nbsp;abcd&#34;</span><span class="op" id="6543401">,</span>&nbsp;<span class="ident" id="6543403">s</span><span class="op" id="6543404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543407">}</span><br>
<span class="lineno"></span><span class="op" id="6543409">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="keyword" id="6543412">func</span>&nbsp;<span class="ident" id="6543417">BenchmarkEncodeToString</span><span class="op" id="6543440">(</span><span class="ident" id="6543441">b</span>&nbsp;<span class="op" id="6543443">*</span><span class="ident" id="6543444">testing</span><span class="op" id="6543451">.</span><span class="ident" id="6543452">B</span><span class="op" id="6543453">)</span>&nbsp;<span class="op" id="6543455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543458">data</span>&nbsp;<span class="op" id="6543463">:=</span>&nbsp;<span class="builtinfunc" id="6543466">make</span><span class="op" id="6543470">(</span><span class="op" id="6543471">[</span><span class="op" id="6543472">]</span><span class="builtintype" id="6543473">byte</span><span class="op" id="6543477">,</span>&nbsp;<span class="num" id="6543479">8192</span><span class="op" id="6543483">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543486">b</span><span class="op" id="6543487">.</span><span class="ident" id="6543488">SetBytes</span><span class="op" id="6543496">(</span><span class="ident" id="6543497">int64</span><span class="op" id="6543502">(</span><span class="builtinfunc" id="6543503">len</span><span class="op" id="6543506">(</span><span class="ident" id="6543507">data</span><span class="op" id="6543511">)</span><span class="op" id="6543512">)</span><span class="op" id="6543513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543516">for</span>&nbsp;<span class="ident" id="6543520">i</span>&nbsp;<span class="op" id="6543522">:=</span>&nbsp;<span class="num" id="6543525">0</span><span class="op" id="6543526">;</span>&nbsp;<span class="ident" id="6543528">i</span>&nbsp;<span class="op" id="6543530">&lt;</span>&nbsp;<span class="ident" id="6543532">b</span><span class="op" id="6543533">.</span><span class="ident" id="6543534">N</span><span class="op" id="6543535">;</span>&nbsp;<span class="ident" id="6543537">i</span><span class="op" id="6543538">++</span>&nbsp;<span class="op" id="6543541">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543545">StdEncoding</span><span class="op" id="6543556">.</span><span class="ident" id="6543557">EncodeToString</span><span class="op" id="6543571">(</span><span class="ident" id="6543572">data</span><span class="op" id="6543576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543579">}</span><br>
<span class="lineno"></span><span class="op" id="6543581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6543584">func</span>&nbsp;<span class="ident" id="6543589">BenchmarkDecodeString</span><span class="op" id="6543610">(</span><span class="ident" id="6543611">b</span>&nbsp;<span class="op" id="6543613">*</span><span class="ident" id="6543614">testing</span><span class="op" id="6543621">.</span><span class="ident" id="6543622">B</span><span class="op" id="6543623">)</span>&nbsp;<span class="op" id="6543625">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543628">data</span>&nbsp;<span class="op" id="6543633">:=</span>&nbsp;<span class="ident" id="6543636">StdEncoding</span><span class="op" id="6543647">.</span><span class="ident" id="6543648">EncodeToString</span><span class="op" id="6543662">(</span><span class="builtinfunc" id="6543663">make</span><span class="op" id="6543667">(</span><span class="op" id="6543668">[</span><span class="op" id="6543669">]</span><span class="builtintype" id="6543670">byte</span><span class="op" id="6543674">,</span>&nbsp;<span class="num" id="6543676">8192</span><span class="op" id="6543680">)</span><span class="op" id="6543681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543684">b</span><span class="op" id="6543685">.</span><span class="ident" id="6543686">SetBytes</span><span class="op" id="6543694">(</span><span class="ident" id="6543695">int64</span><span class="op" id="6543700">(</span><span class="builtinfunc" id="6543701">len</span><span class="op" id="6543704">(</span><span class="ident" id="6543705">data</span><span class="op" id="6543709">)</span><span class="op" id="6543710">)</span><span class="op" id="6543711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6543714">for</span>&nbsp;<span class="ident" id="6543718">i</span>&nbsp;<span class="op" id="6543720">:=</span>&nbsp;<span class="num" id="6543723">0</span><span class="op" id="6543724">;</span>&nbsp;<span class="ident" id="6543726">i</span>&nbsp;<span class="op" id="6543728">&lt;</span>&nbsp;<span class="ident" id="6543730">b</span><span class="op" id="6543731">.</span><span class="ident" id="6543732">N</span><span class="op" id="6543733">;</span>&nbsp;<span class="ident" id="6543735">i</span><span class="op" id="6543736">++</span>&nbsp;<span class="op" id="6543739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6543743">StdEncoding</span><span class="op" id="6543754">.</span><span class="ident" id="6543755">DecodeString</span><span class="op" id="6543767">(</span><span class="ident" id="6543768">data</span><span class="op" id="6543772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6543775">}</span><br>
<span class="lineno">360</span><span class="op" id="6543777">}</span>
</div>
</body>
</html>
