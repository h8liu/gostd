<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6384144">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6384199">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6384253">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6384304">//&nbsp;This&nbsp;algorithm&nbsp;is&nbsp;based&nbsp;on&nbsp;&#34;Faster&nbsp;Suffix&nbsp;Sorting&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6384358">//&nbsp;&nbsp;&nbsp;by&nbsp;N.&nbsp;Jesper&nbsp;Larsson&nbsp;and&nbsp;Kunihiko&nbsp;Sadakane</span><br>
<span class="lineno"></span><span class="comment" id="6384406">//&nbsp;paper:&nbsp;http://www.larsson.dogma.net/ssrev-tr.pdf</span><br>
<span class="lineno"></span><span class="comment" id="6384458">//&nbsp;code:&nbsp;&nbsp;http://www.larsson.dogma.net/qsufsort.c</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="6384509">//&nbsp;This&nbsp;algorithm&nbsp;computes&nbsp;the&nbsp;suffix&nbsp;array&nbsp;sa&nbsp;by&nbsp;computing&nbsp;its&nbsp;inverse.</span><br>
<span class="lineno"></span><span class="comment" id="6384582">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;in&nbsp;sa&nbsp;are&nbsp;labeled&nbsp;as&nbsp;sorted&nbsp;groups&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6384654">//&nbsp;unsorted&nbsp;groups.&nbsp;For&nbsp;a&nbsp;given&nbsp;pass&nbsp;of&nbsp;the&nbsp;sorter,&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;ordered</span><br>
<span class="lineno"></span><span class="comment" id="6384731">//&nbsp;up&nbsp;to&nbsp;their&nbsp;first&nbsp;h&nbsp;characters,&nbsp;and&nbsp;sa&nbsp;is&nbsp;h-ordered.&nbsp;Suffixes&nbsp;in&nbsp;their</span><br>
<span class="lineno"></span><span class="comment" id="6384805">//&nbsp;final&nbsp;positions&nbsp;and&nbsp;unambiguously&nbsp;sorted&nbsp;in&nbsp;h-order&nbsp;are&nbsp;in&nbsp;a&nbsp;sorted&nbsp;group.</span><br>
<span class="lineno">15</span><span class="comment" id="6384883">//&nbsp;Consecutive&nbsp;groups&nbsp;of&nbsp;suffixes&nbsp;with&nbsp;identical&nbsp;first&nbsp;h&nbsp;characters&nbsp;are&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="6384958">//&nbsp;unsorted&nbsp;group.&nbsp;In&nbsp;each&nbsp;pass&nbsp;of&nbsp;the&nbsp;algorithm,&nbsp;unsorted&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span><span class="comment" id="6385035">//&nbsp;according&nbsp;to&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;their&nbsp;following&nbsp;suffix.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6385096">//&nbsp;In&nbsp;the&nbsp;implementation,&nbsp;if&nbsp;sa[i]&nbsp;is&nbsp;negative,&nbsp;it&nbsp;indicates&nbsp;that&nbsp;i&nbsp;is</span><br>
<span class="lineno">20</span><span class="comment" id="6385167">//&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;a&nbsp;sorted&nbsp;group&nbsp;of&nbsp;length&nbsp;-sa[i],&nbsp;and&nbsp;can&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span><span class="comment" id="6385244">//&nbsp;An&nbsp;unsorted&nbsp;group&nbsp;sa[i:k]&nbsp;is&nbsp;given&nbsp;the&nbsp;group&nbsp;number&nbsp;of&nbsp;the&nbsp;index&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6385319">//&nbsp;last&nbsp;element,&nbsp;k-1.&nbsp;The&nbsp;group&nbsp;numbers&nbsp;are&nbsp;stored&nbsp;in&nbsp;the&nbsp;inverse&nbsp;slice&nbsp;(inv),</span><br>
<span class="lineno"></span><span class="comment" id="6385398">//&nbsp;and&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted,&nbsp;this&nbsp;slice&nbsp;is&nbsp;the&nbsp;inverse&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="6385474">package</span>&nbsp;<span class="ident" id="6385482">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6385495">import</span>&nbsp;<span class="string" id="6385502">&#34;sort&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6385510">func</span>&nbsp;<span class="ident" id="6385515">qsufsort</span><span class="op" id="6385523">(</span><span class="ident" id="6385524">data</span>&nbsp;<span class="op" id="6385529">[</span><span class="op" id="6385530">]</span><span class="builtintype" id="6385531">byte</span><span class="op" id="6385535">)</span>&nbsp;<span class="op" id="6385537">[</span><span class="op" id="6385538">]</span><span class="builtintype" id="6385539">int</span>&nbsp;<span class="op" id="6385543">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385546">//&nbsp;initial&nbsp;sorting&nbsp;by&nbsp;first&nbsp;byte&nbsp;of&nbsp;suffix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385590">sa</span>&nbsp;<span class="op" id="6385593">:=</span>&nbsp;<span class="ident" id="6385596">sortedByFirstByte</span><span class="op" id="6385613">(</span><span class="ident" id="6385614">data</span><span class="op" id="6385618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385621">if</span>&nbsp;<span class="builtinfunc" id="6385624">len</span><span class="op" id="6385627">(</span><span class="ident" id="6385628">sa</span><span class="op" id="6385630">)</span>&nbsp;<span class="op" id="6385632">&lt;</span>&nbsp;<span class="num" id="6385634">2</span>&nbsp;<span class="op" id="6385636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385640">return</span>&nbsp;<span class="ident" id="6385647">sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6385651">}</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385654">//&nbsp;initialize&nbsp;the&nbsp;group&nbsp;lookup&nbsp;table</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385692">//&nbsp;this&nbsp;becomes&nbsp;the&nbsp;inverse&nbsp;of&nbsp;the&nbsp;suffix&nbsp;array&nbsp;when&nbsp;all&nbsp;groups&nbsp;are&nbsp;sorted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385768">inv</span>&nbsp;<span class="op" id="6385772">:=</span>&nbsp;<span class="ident" id="6385775">initGroups</span><span class="op" id="6385785">(</span><span class="ident" id="6385786">sa</span><span class="op" id="6385788">,</span>&nbsp;<span class="ident" id="6385790">data</span><span class="op" id="6385794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385798">//&nbsp;the&nbsp;index&nbsp;starts&nbsp;1-ordered</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6385829">sufSortable</span>&nbsp;<span class="op" id="6385841">:=</span>&nbsp;<span class="op" id="6385844">&amp;</span><span class="ident" id="6385845">suffixSortable</span><span class="op" id="6385859">{</span><span class="ident" id="6385860">sa</span><span class="op" id="6385862">:</span>&nbsp;<span class="ident" id="6385864">sa</span><span class="op" id="6385866">,</span>&nbsp;<span class="ident" id="6385868">inv</span><span class="op" id="6385871">:</span>&nbsp;<span class="ident" id="6385873">inv</span><span class="op" id="6385876">,</span>&nbsp;<span class="ident" id="6385878">h</span><span class="op" id="6385879">:</span>&nbsp;<span class="num" id="6385881">1</span><span class="op" id="6385882">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6385886">for</span>&nbsp;<span class="ident" id="6385890">sa</span><span class="op" id="6385892">[</span><span class="num" id="6385893">0</span><span class="op" id="6385894">]</span>&nbsp;<span class="op" id="6385896">&gt;</span>&nbsp;<span class="op" id="6385898">-</span><span class="builtinfunc" id="6385899">len</span><span class="op" id="6385902">(</span><span class="ident" id="6385903">sa</span><span class="op" id="6385905">)</span>&nbsp;<span class="op" id="6385907">{</span>&nbsp;<span class="comment" id="6385909">//&nbsp;until&nbsp;all&nbsp;suffixes&nbsp;are&nbsp;one&nbsp;big&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6385958">//&nbsp;The&nbsp;suffixes&nbsp;are&nbsp;h-ordered,&nbsp;make&nbsp;them&nbsp;2*h-ordered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386013">pi</span>&nbsp;<span class="op" id="6386016">:=</span>&nbsp;<span class="num" id="6386019">0</span>&nbsp;<span class="comment" id="6386021">//&nbsp;pi&nbsp;is&nbsp;first&nbsp;position&nbsp;of&nbsp;first&nbsp;group</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386062">sl</span>&nbsp;<span class="op" id="6386065">:=</span>&nbsp;<span class="num" id="6386068">0</span>&nbsp;<span class="comment" id="6386070">//&nbsp;sl&nbsp;is&nbsp;negated&nbsp;length&nbsp;of&nbsp;sorted&nbsp;groups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386113">for</span>&nbsp;<span class="ident" id="6386117">pi</span>&nbsp;<span class="op" id="6386120">&lt;</span>&nbsp;<span class="builtinfunc" id="6386122">len</span><span class="op" id="6386125">(</span><span class="ident" id="6386126">sa</span><span class="op" id="6386128">)</span>&nbsp;<span class="op" id="6386130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386135">if</span>&nbsp;<span class="ident" id="6386138">s</span>&nbsp;<span class="op" id="6386140">:=</span>&nbsp;<span class="ident" id="6386143">sa</span><span class="op" id="6386145">[</span><span class="ident" id="6386146">pi</span><span class="op" id="6386148">]</span><span class="op" id="6386149">;</span>&nbsp;<span class="ident" id="6386151">s</span>&nbsp;<span class="op" id="6386153">&lt;</span>&nbsp;<span class="num" id="6386155">0</span>&nbsp;<span class="op" id="6386157">{</span>&nbsp;<span class="comment" id="6386159">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386192">pi</span>&nbsp;<span class="op" id="6386195">-=</span>&nbsp;<span class="ident" id="6386198">s</span>&nbsp;<span class="comment" id="6386200">//&nbsp;skip&nbsp;over&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386230">sl</span>&nbsp;<span class="op" id="6386233">+=</span>&nbsp;<span class="ident" id="6386236">s</span>&nbsp;<span class="comment" id="6386238">//&nbsp;add&nbsp;negated&nbsp;length&nbsp;to&nbsp;sl</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386269">}</span>&nbsp;<span class="keyword" id="6386271">else</span>&nbsp;<span class="op" id="6386276">{</span>&nbsp;<span class="comment" id="6386278">//&nbsp;if&nbsp;pi&nbsp;starts&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386313">if</span>&nbsp;<span class="ident" id="6386316">sl</span>&nbsp;<span class="op" id="6386319">!=</span>&nbsp;<span class="num" id="6386322">0</span>&nbsp;<span class="op" id="6386324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386331">sa</span><span class="op" id="6386333">[</span><span class="ident" id="6386334">pi</span><span class="op" id="6386336">+</span><span class="ident" id="6386337">sl</span><span class="op" id="6386339">]</span>&nbsp;<span class="op" id="6386341">=</span>&nbsp;<span class="ident" id="6386343">sl</span>&nbsp;<span class="comment" id="6386346">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;before&nbsp;pi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386386">sl</span>&nbsp;<span class="op" id="6386389">=</span>&nbsp;<span class="num" id="6386391">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386397">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386403">pk</span>&nbsp;<span class="op" id="6386406">:=</span>&nbsp;<span class="ident" id="6386409">inv</span><span class="op" id="6386412">[</span><span class="ident" id="6386413">s</span><span class="op" id="6386414">]</span>&nbsp;<span class="op" id="6386416">+</span>&nbsp;<span class="num" id="6386418">1</span>&nbsp;<span class="comment" id="6386420">//&nbsp;pk-1&nbsp;is&nbsp;last&nbsp;position&nbsp;of&nbsp;unsorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386467">sufSortable</span><span class="op" id="6386478">.</span><span class="ident" id="6386479">sa</span>&nbsp;<span class="op" id="6386482">=</span>&nbsp;<span class="ident" id="6386484">sa</span><span class="op" id="6386486">[</span><span class="ident" id="6386487">pi</span><span class="op" id="6386489">:</span><span class="ident" id="6386490">pk</span><span class="op" id="6386492">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386498">sort</span><span class="op" id="6386502">.</span><span class="ident" id="6386503">Sort</span><span class="op" id="6386507">(</span><span class="ident" id="6386508">sufSortable</span><span class="op" id="6386519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386525">sufSortable</span><span class="op" id="6386536">.</span><span class="ident" id="6386537">updateGroups</span><span class="op" id="6386549">(</span><span class="ident" id="6386550">pi</span><span class="op" id="6386552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386558">pi</span>&nbsp;<span class="op" id="6386561">=</span>&nbsp;<span class="ident" id="6386563">pk</span>&nbsp;<span class="comment" id="6386566">//&nbsp;next&nbsp;group</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386583">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386591">if</span>&nbsp;<span class="ident" id="6386594">sl</span>&nbsp;<span class="op" id="6386597">!=</span>&nbsp;<span class="num" id="6386600">0</span>&nbsp;<span class="op" id="6386602">{</span>&nbsp;<span class="comment" id="6386604">//&nbsp;if&nbsp;the&nbsp;array&nbsp;ends&nbsp;with&nbsp;a&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386648">sa</span><span class="op" id="6386650">[</span><span class="ident" id="6386651">pi</span><span class="op" id="6386653">+</span><span class="ident" id="6386654">sl</span><span class="op" id="6386656">]</span>&nbsp;<span class="op" id="6386658">=</span>&nbsp;<span class="ident" id="6386660">sl</span>&nbsp;<span class="comment" id="6386663">//&nbsp;combine&nbsp;sorted&nbsp;groups&nbsp;at&nbsp;end&nbsp;of&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386703">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386708">sufSortable</span><span class="op" id="6386719">.</span><span class="ident" id="6386720">h</span>&nbsp;<span class="op" id="6386722">*=</span>&nbsp;<span class="num" id="6386725">2</span>&nbsp;<span class="comment" id="6386727">//&nbsp;double&nbsp;sorted&nbsp;depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386755">for</span>&nbsp;<span class="ident" id="6386759">i</span>&nbsp;<span class="op" id="6386761">:=</span>&nbsp;<span class="keyword" id="6386764">range</span>&nbsp;<span class="ident" id="6386770">sa</span>&nbsp;<span class="op" id="6386773">{</span>&nbsp;<span class="comment" id="6386775">//&nbsp;reconstruct&nbsp;suffix&nbsp;array&nbsp;from&nbsp;inverse</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386818">sa</span><span class="op" id="6386820">[</span><span class="ident" id="6386821">inv</span><span class="op" id="6386824">[</span><span class="ident" id="6386825">i</span><span class="op" id="6386826">]</span><span class="op" id="6386827">]</span>&nbsp;<span class="op" id="6386829">=</span>&nbsp;<span class="ident" id="6386831">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386834">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386837">return</span>&nbsp;<span class="ident" id="6386844">sa</span><br>
<span class="lineno"></span><span class="op" id="6386847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6386850">func</span>&nbsp;<span class="ident" id="6386855">sortedByFirstByte</span><span class="op" id="6386872">(</span><span class="ident" id="6386873">data</span>&nbsp;<span class="op" id="6386878">[</span><span class="op" id="6386879">]</span><span class="builtintype" id="6386880">byte</span><span class="op" id="6386884">)</span>&nbsp;<span class="op" id="6386886">[</span><span class="op" id="6386887">]</span><span class="builtintype" id="6386888">int</span>&nbsp;<span class="op" id="6386892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386895">//&nbsp;total&nbsp;byte&nbsp;counts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386917">var</span>&nbsp;<span class="ident" id="6386921">count</span>&nbsp;<span class="op" id="6386927">[</span><span class="num" id="6386928">256</span><span class="op" id="6386931">]</span><span class="builtintype" id="6386932">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6386937">for</span>&nbsp;<span class="ident" id="6386941">_</span><span class="op" id="6386942">,</span>&nbsp;<span class="ident" id="6386944">b</span>&nbsp;<span class="op" id="6386946">:=</span>&nbsp;<span class="keyword" id="6386949">range</span>&nbsp;<span class="ident" id="6386955">data</span>&nbsp;<span class="op" id="6386960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6386964">count</span><span class="op" id="6386969">[</span><span class="ident" id="6386970">b</span><span class="op" id="6386971">]</span><span class="op" id="6386972">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6386976">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6386979">//&nbsp;make&nbsp;count[b]&nbsp;equal&nbsp;index&nbsp;of&nbsp;first&nbsp;occurrence&nbsp;of&nbsp;b&nbsp;in&nbsp;sorted&nbsp;array</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387050">sum</span>&nbsp;<span class="op" id="6387054">:=</span>&nbsp;<span class="num" id="6387057">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387060">for</span>&nbsp;<span class="ident" id="6387064">b</span>&nbsp;<span class="op" id="6387066">:=</span>&nbsp;<span class="keyword" id="6387069">range</span>&nbsp;<span class="ident" id="6387075">count</span>&nbsp;<span class="op" id="6387081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387085">count</span><span class="op" id="6387090">[</span><span class="ident" id="6387091">b</span><span class="op" id="6387092">]</span><span class="op" id="6387093">,</span>&nbsp;<span class="ident" id="6387095">sum</span>&nbsp;<span class="op" id="6387099">=</span>&nbsp;<span class="ident" id="6387101">sum</span><span class="op" id="6387104">,</span>&nbsp;<span class="ident" id="6387106">count</span><span class="op" id="6387111">[</span><span class="ident" id="6387112">b</span><span class="op" id="6387113">]</span><span class="op" id="6387114">+</span><span class="ident" id="6387115">sum</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387123">//&nbsp;iterate&nbsp;through&nbsp;bytes,&nbsp;placing&nbsp;index&nbsp;into&nbsp;the&nbsp;correct&nbsp;spot&nbsp;in&nbsp;sa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387192">sa</span>&nbsp;<span class="op" id="6387195">:=</span>&nbsp;<span class="builtinfunc" id="6387198">make</span><span class="op" id="6387202">(</span><span class="op" id="6387203">[</span><span class="op" id="6387204">]</span><span class="builtintype" id="6387205">int</span><span class="op" id="6387208">,</span>&nbsp;<span class="builtinfunc" id="6387210">len</span><span class="op" id="6387213">(</span><span class="ident" id="6387214">data</span><span class="op" id="6387218">)</span><span class="op" id="6387219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387222">for</span>&nbsp;<span class="ident" id="6387226">i</span><span class="op" id="6387227">,</span>&nbsp;<span class="ident" id="6387229">b</span>&nbsp;<span class="op" id="6387231">:=</span>&nbsp;<span class="keyword" id="6387234">range</span>&nbsp;<span class="ident" id="6387240">data</span>&nbsp;<span class="op" id="6387245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387249">sa</span><span class="op" id="6387251">[</span><span class="ident" id="6387252">count</span><span class="op" id="6387257">[</span><span class="ident" id="6387258">b</span><span class="op" id="6387259">]</span><span class="op" id="6387260">]</span>&nbsp;<span class="op" id="6387262">=</span>&nbsp;<span class="ident" id="6387264">i</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387268">count</span><span class="op" id="6387273">[</span><span class="ident" id="6387274">b</span><span class="op" id="6387275">]</span><span class="op" id="6387276">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387283">return</span>&nbsp;<span class="ident" id="6387290">sa</span><br>
<span class="lineno"></span><span class="op" id="6387293">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6387296">func</span>&nbsp;<span class="ident" id="6387301">initGroups</span><span class="op" id="6387311">(</span><span class="ident" id="6387312">sa</span>&nbsp;<span class="op" id="6387315">[</span><span class="op" id="6387316">]</span><span class="builtintype" id="6387317">int</span><span class="op" id="6387320">,</span>&nbsp;<span class="ident" id="6387322">data</span>&nbsp;<span class="op" id="6387327">[</span><span class="op" id="6387328">]</span><span class="builtintype" id="6387329">byte</span><span class="op" id="6387333">)</span>&nbsp;<span class="op" id="6387335">[</span><span class="op" id="6387336">]</span><span class="builtintype" id="6387337">int</span>&nbsp;<span class="op" id="6387341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387344">//&nbsp;label&nbsp;contiguous&nbsp;same-letter&nbsp;groups&nbsp;with&nbsp;the&nbsp;same&nbsp;group&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387411">inv</span>&nbsp;<span class="op" id="6387415">:=</span>&nbsp;<span class="builtinfunc" id="6387418">make</span><span class="op" id="6387422">(</span><span class="op" id="6387423">[</span><span class="op" id="6387424">]</span><span class="builtintype" id="6387425">int</span><span class="op" id="6387428">,</span>&nbsp;<span class="builtinfunc" id="6387430">len</span><span class="op" id="6387433">(</span><span class="ident" id="6387434">data</span><span class="op" id="6387438">)</span><span class="op" id="6387439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387442">prevGroup</span>&nbsp;<span class="op" id="6387452">:=</span>&nbsp;<span class="builtinfunc" id="6387455">len</span><span class="op" id="6387458">(</span><span class="ident" id="6387459">sa</span><span class="op" id="6387461">)</span>&nbsp;<span class="op" id="6387463">-</span>&nbsp;<span class="num" id="6387465">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387468">groupByte</span>&nbsp;<span class="op" id="6387478">:=</span>&nbsp;<span class="ident" id="6387481">data</span><span class="op" id="6387485">[</span><span class="ident" id="6387486">sa</span><span class="op" id="6387488">[</span><span class="ident" id="6387489">prevGroup</span><span class="op" id="6387498">]</span><span class="op" id="6387499">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387502">for</span>&nbsp;<span class="ident" id="6387506">i</span>&nbsp;<span class="op" id="6387508">:=</span>&nbsp;<span class="builtinfunc" id="6387511">len</span><span class="op" id="6387514">(</span><span class="ident" id="6387515">sa</span><span class="op" id="6387517">)</span>&nbsp;<span class="op" id="6387519">-</span>&nbsp;<span class="num" id="6387521">1</span><span class="op" id="6387522">;</span>&nbsp;<span class="ident" id="6387524">i</span>&nbsp;<span class="op" id="6387526">&gt;=</span>&nbsp;<span class="num" id="6387529">0</span><span class="op" id="6387530">;</span>&nbsp;<span class="ident" id="6387532">i</span><span class="op" id="6387533">--</span>&nbsp;<span class="op" id="6387536">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387540">if</span>&nbsp;<span class="ident" id="6387543">b</span>&nbsp;<span class="op" id="6387545">:=</span>&nbsp;<span class="ident" id="6387548">data</span><span class="op" id="6387552">[</span><span class="ident" id="6387553">sa</span><span class="op" id="6387555">[</span><span class="ident" id="6387556">i</span><span class="op" id="6387557">]</span><span class="op" id="6387558">]</span><span class="op" id="6387559">;</span>&nbsp;<span class="ident" id="6387561">b</span>&nbsp;<span class="op" id="6387563">&lt;</span>&nbsp;<span class="ident" id="6387565">groupByte</span>&nbsp;<span class="op" id="6387575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387580">if</span>&nbsp;<span class="ident" id="6387583">prevGroup</span>&nbsp;<span class="op" id="6387593">==</span>&nbsp;<span class="ident" id="6387596">i</span><span class="op" id="6387597">+</span><span class="num" id="6387598">1</span>&nbsp;<span class="op" id="6387600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387606">sa</span><span class="op" id="6387608">[</span><span class="ident" id="6387609">i</span><span class="op" id="6387610">+</span><span class="num" id="6387611">1</span><span class="op" id="6387612">]</span>&nbsp;<span class="op" id="6387614">=</span>&nbsp;<span class="op" id="6387616">-</span><span class="num" id="6387617">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387622">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387627">groupByte</span>&nbsp;<span class="op" id="6387637">=</span>&nbsp;<span class="ident" id="6387639">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387644">prevGroup</span>&nbsp;<span class="op" id="6387654">=</span>&nbsp;<span class="ident" id="6387656">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387664">inv</span><span class="op" id="6387667">[</span><span class="ident" id="6387668">sa</span><span class="op" id="6387670">[</span><span class="ident" id="6387671">i</span><span class="op" id="6387672">]</span><span class="op" id="6387673">]</span>&nbsp;<span class="op" id="6387675">=</span>&nbsp;<span class="ident" id="6387677">prevGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387689">if</span>&nbsp;<span class="ident" id="6387692">prevGroup</span>&nbsp;<span class="op" id="6387702">==</span>&nbsp;<span class="num" id="6387705">0</span>&nbsp;<span class="op" id="6387707">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387712">sa</span><span class="op" id="6387714">[</span><span class="num" id="6387715">0</span><span class="op" id="6387716">]</span>&nbsp;<span class="op" id="6387718">=</span>&nbsp;<span class="op" id="6387720">-</span><span class="num" id="6387721">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387725">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6387728">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387731">//&nbsp;Separate&nbsp;out&nbsp;the&nbsp;final&nbsp;suffix&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;its&nbsp;group.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387792">//&nbsp;This&nbsp;is&nbsp;necessary&nbsp;to&nbsp;ensure&nbsp;the&nbsp;suffix&nbsp;&#34;a&#34;&nbsp;is&nbsp;before&nbsp;&#34;aba&#34;</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6387855">//&nbsp;when&nbsp;using&nbsp;a&nbsp;potentially&nbsp;unstable&nbsp;sort.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387899">lastByte</span>&nbsp;<span class="op" id="6387908">:=</span>&nbsp;<span class="ident" id="6387911">data</span><span class="op" id="6387915">[</span><span class="builtinfunc" id="6387916">len</span><span class="op" id="6387919">(</span><span class="ident" id="6387920">data</span><span class="op" id="6387924">)</span><span class="op" id="6387925">-</span><span class="num" id="6387926">1</span><span class="op" id="6387927">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6387930">s</span>&nbsp;<span class="op" id="6387932">:=</span>&nbsp;<span class="op" id="6387935">-</span><span class="num" id="6387936">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387939">for</span>&nbsp;<span class="ident" id="6387943">i</span>&nbsp;<span class="op" id="6387945">:=</span>&nbsp;<span class="keyword" id="6387948">range</span>&nbsp;<span class="ident" id="6387954">sa</span>&nbsp;<span class="op" id="6387957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387961">if</span>&nbsp;<span class="ident" id="6387964">sa</span><span class="op" id="6387966">[</span><span class="ident" id="6387967">i</span><span class="op" id="6387968">]</span>&nbsp;<span class="op" id="6387970">&gt;=</span>&nbsp;<span class="num" id="6387973">0</span>&nbsp;<span class="op" id="6387975">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6387980">if</span>&nbsp;<span class="ident" id="6387983">data</span><span class="op" id="6387987">[</span><span class="ident" id="6387988">sa</span><span class="op" id="6387990">[</span><span class="ident" id="6387991">i</span><span class="op" id="6387992">]</span><span class="op" id="6387993">]</span>&nbsp;<span class="op" id="6387995">==</span>&nbsp;<span class="ident" id="6387998">lastByte</span>&nbsp;<span class="op" id="6388007">&amp;&amp;</span>&nbsp;<span class="ident" id="6388010">s</span>&nbsp;<span class="op" id="6388012">==</span>&nbsp;<span class="op" id="6388015">-</span><span class="num" id="6388016">1</span>&nbsp;<span class="op" id="6388018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388024">s</span>&nbsp;<span class="op" id="6388026">=</span>&nbsp;<span class="ident" id="6388028">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388038">if</span>&nbsp;<span class="ident" id="6388041">sa</span><span class="op" id="6388043">[</span><span class="ident" id="6388044">i</span><span class="op" id="6388045">]</span>&nbsp;<span class="op" id="6388047">==</span>&nbsp;<span class="builtinfunc" id="6388050">len</span><span class="op" id="6388053">(</span><span class="ident" id="6388054">sa</span><span class="op" id="6388056">)</span><span class="op" id="6388057">-</span><span class="num" id="6388058">1</span>&nbsp;<span class="op" id="6388060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388066">sa</span><span class="op" id="6388068">[</span><span class="ident" id="6388069">i</span><span class="op" id="6388070">]</span><span class="op" id="6388071">,</span>&nbsp;<span class="ident" id="6388073">sa</span><span class="op" id="6388075">[</span><span class="ident" id="6388076">s</span><span class="op" id="6388077">]</span>&nbsp;<span class="op" id="6388079">=</span>&nbsp;<span class="ident" id="6388081">sa</span><span class="op" id="6388083">[</span><span class="ident" id="6388084">s</span><span class="op" id="6388085">]</span><span class="op" id="6388086">,</span>&nbsp;<span class="ident" id="6388088">sa</span><span class="op" id="6388090">[</span><span class="ident" id="6388091">i</span><span class="op" id="6388092">]</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388098">inv</span><span class="op" id="6388101">[</span><span class="ident" id="6388102">sa</span><span class="op" id="6388104">[</span><span class="ident" id="6388105">s</span><span class="op" id="6388106">]</span><span class="op" id="6388107">]</span>&nbsp;<span class="op" id="6388109">=</span>&nbsp;<span class="ident" id="6388111">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388117">sa</span><span class="op" id="6388119">[</span><span class="ident" id="6388120">s</span><span class="op" id="6388121">]</span>&nbsp;<span class="op" id="6388123">=</span>&nbsp;<span class="op" id="6388125">-</span><span class="num" id="6388126">1</span>&nbsp;<span class="comment" id="6388128">//&nbsp;mark&nbsp;it&nbsp;as&nbsp;an&nbsp;isolated&nbsp;sorted&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388171">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388184">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388190">return</span>&nbsp;<span class="ident" id="6388197">inv</span><br>
<span class="lineno"></span><span class="op" id="6388201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6388204">type</span>&nbsp;<span class="ident" id="6388209">suffixSortable</span>&nbsp;<span class="keyword" id="6388224">struct</span>&nbsp;<span class="op" id="6388231">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388234">sa</span>&nbsp;&nbsp;<span class="op" id="6388238">[</span><span class="op" id="6388239">]</span><span class="builtintype" id="6388240">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388245">inv</span>&nbsp;<span class="op" id="6388249">[</span><span class="op" id="6388250">]</span><span class="builtintype" id="6388251">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388256">h</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6388260">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388265">buf</span>&nbsp;<span class="op" id="6388269">[</span><span class="op" id="6388270">]</span><span class="builtintype" id="6388271">int</span>&nbsp;<span class="comment" id="6388275">//&nbsp;common&nbsp;scratch&nbsp;space</span><br>
<span class="lineno"></span><span class="op" id="6388299">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="6388302">func</span>&nbsp;<span class="op" id="6388307">(</span><span class="ident" id="6388308">x</span>&nbsp;<span class="op" id="6388310">*</span><span class="ident" id="6388311">suffixSortable</span><span class="op" id="6388325">)</span>&nbsp;<span class="ident" id="6388327">Len</span><span class="op" id="6388330">(</span><span class="op" id="6388331">)</span>&nbsp;<span class="builtintype" id="6388333">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388347">{</span>&nbsp;<span class="keyword" id="6388349">return</span>&nbsp;<span class="builtinfunc" id="6388356">len</span><span class="op" id="6388359">(</span><span class="ident" id="6388360">x</span><span class="op" id="6388361">.</span><span class="ident" id="6388362">sa</span><span class="op" id="6388364">)</span>&nbsp;<span class="op" id="6388366">}</span><br>
<span class="lineno"></span><span class="keyword" id="6388368">func</span>&nbsp;<span class="op" id="6388373">(</span><span class="ident" id="6388374">x</span>&nbsp;<span class="op" id="6388376">*</span><span class="ident" id="6388377">suffixSortable</span><span class="op" id="6388391">)</span>&nbsp;<span class="ident" id="6388393">Less</span><span class="op" id="6388397">(</span><span class="ident" id="6388398">i</span><span class="op" id="6388399">,</span>&nbsp;<span class="ident" id="6388401">j</span>&nbsp;<span class="builtintype" id="6388403">int</span><span class="op" id="6388406">)</span>&nbsp;<span class="builtintype" id="6388408">bool</span>&nbsp;<span class="op" id="6388413">{</span>&nbsp;<span class="keyword" id="6388415">return</span>&nbsp;<span class="ident" id="6388422">x</span><span class="op" id="6388423">.</span><span class="ident" id="6388424">inv</span><span class="op" id="6388427">[</span><span class="ident" id="6388428">x</span><span class="op" id="6388429">.</span><span class="ident" id="6388430">sa</span><span class="op" id="6388432">[</span><span class="ident" id="6388433">i</span><span class="op" id="6388434">]</span><span class="op" id="6388435">+</span><span class="ident" id="6388436">x</span><span class="op" id="6388437">.</span><span class="ident" id="6388438">h</span><span class="op" id="6388439">]</span>&nbsp;<span class="op" id="6388441">&lt;</span>&nbsp;<span class="ident" id="6388443">x</span><span class="op" id="6388444">.</span><span class="ident" id="6388445">inv</span><span class="op" id="6388448">[</span><span class="ident" id="6388449">x</span><span class="op" id="6388450">.</span><span class="ident" id="6388451">sa</span><span class="op" id="6388453">[</span><span class="ident" id="6388454">j</span><span class="op" id="6388455">]</span><span class="op" id="6388456">+</span><span class="ident" id="6388457">x</span><span class="op" id="6388458">.</span><span class="ident" id="6388459">h</span><span class="op" id="6388460">]</span>&nbsp;<span class="op" id="6388462">}</span><br>
<span class="lineno"></span><span class="keyword" id="6388464">func</span>&nbsp;<span class="op" id="6388469">(</span><span class="ident" id="6388470">x</span>&nbsp;<span class="op" id="6388472">*</span><span class="ident" id="6388473">suffixSortable</span><span class="op" id="6388487">)</span>&nbsp;<span class="ident" id="6388489">Swap</span><span class="op" id="6388493">(</span><span class="ident" id="6388494">i</span><span class="op" id="6388495">,</span>&nbsp;<span class="ident" id="6388497">j</span>&nbsp;<span class="builtintype" id="6388499">int</span><span class="op" id="6388502">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6388509">{</span>&nbsp;<span class="ident" id="6388511">x</span><span class="op" id="6388512">.</span><span class="ident" id="6388513">sa</span><span class="op" id="6388515">[</span><span class="ident" id="6388516">i</span><span class="op" id="6388517">]</span><span class="op" id="6388518">,</span>&nbsp;<span class="ident" id="6388520">x</span><span class="op" id="6388521">.</span><span class="ident" id="6388522">sa</span><span class="op" id="6388524">[</span><span class="ident" id="6388525">j</span><span class="op" id="6388526">]</span>&nbsp;<span class="op" id="6388528">=</span>&nbsp;<span class="ident" id="6388530">x</span><span class="op" id="6388531">.</span><span class="ident" id="6388532">sa</span><span class="op" id="6388534">[</span><span class="ident" id="6388535">j</span><span class="op" id="6388536">]</span><span class="op" id="6388537">,</span>&nbsp;<span class="ident" id="6388539">x</span><span class="op" id="6388540">.</span><span class="ident" id="6388541">sa</span><span class="op" id="6388543">[</span><span class="ident" id="6388544">i</span><span class="op" id="6388545">]</span>&nbsp;<span class="op" id="6388547">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="keyword" id="6388550">func</span>&nbsp;<span class="op" id="6388555">(</span><span class="ident" id="6388556">x</span>&nbsp;<span class="op" id="6388558">*</span><span class="ident" id="6388559">suffixSortable</span><span class="op" id="6388573">)</span>&nbsp;<span class="ident" id="6388575">updateGroups</span><span class="op" id="6388587">(</span><span class="ident" id="6388588">offset</span>&nbsp;<span class="builtintype" id="6388595">int</span><span class="op" id="6388598">)</span>&nbsp;<span class="op" id="6388600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388603">bounds</span>&nbsp;<span class="op" id="6388610">:=</span>&nbsp;<span class="ident" id="6388613">x</span><span class="op" id="6388614">.</span><span class="ident" id="6388615">buf</span><span class="op" id="6388618">[</span><span class="num" id="6388619">0</span><span class="op" id="6388620">:</span><span class="num" id="6388621">0</span><span class="op" id="6388622">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388625">group</span>&nbsp;<span class="op" id="6388631">:=</span>&nbsp;<span class="ident" id="6388634">x</span><span class="op" id="6388635">.</span><span class="ident" id="6388636">inv</span><span class="op" id="6388639">[</span><span class="ident" id="6388640">x</span><span class="op" id="6388641">.</span><span class="ident" id="6388642">sa</span><span class="op" id="6388644">[</span><span class="num" id="6388645">0</span><span class="op" id="6388646">]</span><span class="op" id="6388647">+</span><span class="ident" id="6388648">x</span><span class="op" id="6388649">.</span><span class="ident" id="6388650">h</span><span class="op" id="6388651">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388654">for</span>&nbsp;<span class="ident" id="6388658">i</span>&nbsp;<span class="op" id="6388660">:=</span>&nbsp;<span class="num" id="6388663">1</span><span class="op" id="6388664">;</span>&nbsp;<span class="ident" id="6388666">i</span>&nbsp;<span class="op" id="6388668">&lt;</span>&nbsp;<span class="builtinfunc" id="6388670">len</span><span class="op" id="6388673">(</span><span class="ident" id="6388674">x</span><span class="op" id="6388675">.</span><span class="ident" id="6388676">sa</span><span class="op" id="6388678">)</span><span class="op" id="6388679">;</span>&nbsp;<span class="ident" id="6388681">i</span><span class="op" id="6388682">++</span>&nbsp;<span class="op" id="6388685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388689">if</span>&nbsp;<span class="ident" id="6388692">g</span>&nbsp;<span class="op" id="6388694">:=</span>&nbsp;<span class="ident" id="6388697">x</span><span class="op" id="6388698">.</span><span class="ident" id="6388699">inv</span><span class="op" id="6388702">[</span><span class="ident" id="6388703">x</span><span class="op" id="6388704">.</span><span class="ident" id="6388705">sa</span><span class="op" id="6388707">[</span><span class="ident" id="6388708">i</span><span class="op" id="6388709">]</span><span class="op" id="6388710">+</span><span class="ident" id="6388711">x</span><span class="op" id="6388712">.</span><span class="ident" id="6388713">h</span><span class="op" id="6388714">]</span><span class="op" id="6388715">;</span>&nbsp;<span class="ident" id="6388717">g</span>&nbsp;<span class="op" id="6388719">&gt;</span>&nbsp;<span class="ident" id="6388721">group</span>&nbsp;<span class="op" id="6388727">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388732">bounds</span>&nbsp;<span class="op" id="6388739">=</span>&nbsp;<span class="builtinfunc" id="6388741">append</span><span class="op" id="6388747">(</span><span class="ident" id="6388748">bounds</span><span class="op" id="6388754">,</span>&nbsp;<span class="ident" id="6388756">i</span><span class="op" id="6388757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388762">group</span>&nbsp;<span class="op" id="6388768">=</span>&nbsp;<span class="ident" id="6388770">g</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388774">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6388777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388780">bounds</span>&nbsp;<span class="op" id="6388787">=</span>&nbsp;<span class="builtinfunc" id="6388789">append</span><span class="op" id="6388795">(</span><span class="ident" id="6388796">bounds</span><span class="op" id="6388802">,</span>&nbsp;<span class="builtinfunc" id="6388804">len</span><span class="op" id="6388807">(</span><span class="ident" id="6388808">x</span><span class="op" id="6388809">.</span><span class="ident" id="6388810">sa</span><span class="op" id="6388812">)</span><span class="op" id="6388813">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388816">x</span><span class="op" id="6388817">.</span><span class="ident" id="6388818">buf</span>&nbsp;<span class="op" id="6388822">=</span>&nbsp;<span class="ident" id="6388824">bounds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6388833">//&nbsp;update&nbsp;the&nbsp;group&nbsp;numberings&nbsp;after&nbsp;all&nbsp;new&nbsp;groups&nbsp;are&nbsp;determined</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388901">prev</span>&nbsp;<span class="op" id="6388906">:=</span>&nbsp;<span class="num" id="6388909">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388912">for</span>&nbsp;<span class="ident" id="6388916">_</span><span class="op" id="6388917">,</span>&nbsp;<span class="ident" id="6388919">b</span>&nbsp;<span class="op" id="6388921">:=</span>&nbsp;<span class="keyword" id="6388924">range</span>&nbsp;<span class="ident" id="6388930">bounds</span>&nbsp;<span class="op" id="6388937">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6388941">for</span>&nbsp;<span class="ident" id="6388945">i</span>&nbsp;<span class="op" id="6388947">:=</span>&nbsp;<span class="ident" id="6388950">prev</span><span class="op" id="6388954">;</span>&nbsp;<span class="ident" id="6388956">i</span>&nbsp;<span class="op" id="6388958">&lt;</span>&nbsp;<span class="ident" id="6388960">b</span><span class="op" id="6388961">;</span>&nbsp;<span class="ident" id="6388963">i</span><span class="op" id="6388964">++</span>&nbsp;<span class="op" id="6388967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6388972">x</span><span class="op" id="6388973">.</span><span class="ident" id="6388974">inv</span><span class="op" id="6388977">[</span><span class="ident" id="6388978">x</span><span class="op" id="6388979">.</span><span class="ident" id="6388980">sa</span><span class="op" id="6388982">[</span><span class="ident" id="6388983">i</span><span class="op" id="6388984">]</span><span class="op" id="6388985">]</span>&nbsp;<span class="op" id="6388987">=</span>&nbsp;<span class="ident" id="6388989">offset</span>&nbsp;<span class="op" id="6388996">+</span>&nbsp;<span class="ident" id="6388998">b</span>&nbsp;<span class="op" id="6389000">-</span>&nbsp;<span class="num" id="6389002">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389006">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6389010">if</span>&nbsp;<span class="ident" id="6389013">b</span><span class="op" id="6389014">-</span><span class="ident" id="6389015">prev</span>&nbsp;<span class="op" id="6389020">==</span>&nbsp;<span class="num" id="6389023">1</span>&nbsp;<span class="op" id="6389025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389030">x</span><span class="op" id="6389031">.</span><span class="ident" id="6389032">sa</span><span class="op" id="6389034">[</span><span class="ident" id="6389035">prev</span><span class="op" id="6389039">]</span>&nbsp;<span class="op" id="6389041">=</span>&nbsp;<span class="op" id="6389043">-</span><span class="num" id="6389044">1</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6389052">prev</span>&nbsp;<span class="op" id="6389057">=</span>&nbsp;<span class="ident" id="6389059">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6389062">}</span><br>
<span class="lineno"></span><span class="op" id="6389064">}</span>
</div>
</body>
</html>
