<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="2205342">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2205397">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2205451">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2205502">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2205567">//&nbsp;Fork,&nbsp;exec,&nbsp;wait,&nbsp;etc.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2205594">package</span>&nbsp;<span class="ident" id="2205602">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2205611">import</span>&nbsp;<span class="op" id="2205618">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2205621">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2205632">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2205640">&#34;unsafe&#34;</span><br>
<span class="lineno">15</span><span class="op" id="2205649">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2205652">//&nbsp;Lock&nbsp;synchronizing&nbsp;creation&nbsp;of&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;with&nbsp;fork.</span><br>
<span class="lineno"></span><span class="comment" id="2205718">//</span><br>
<span class="lineno"></span><span class="comment" id="2205721">//&nbsp;We&nbsp;want&nbsp;the&nbsp;child&nbsp;in&nbsp;a&nbsp;fork/exec&nbsp;sequence&nbsp;to&nbsp;inherit&nbsp;only&nbsp;the</span><br>
<span class="lineno">20</span><span class="comment" id="2205786">//&nbsp;file&nbsp;descriptors&nbsp;we&nbsp;intend.&nbsp;&nbsp;To&nbsp;do&nbsp;that,&nbsp;we&nbsp;mark&nbsp;all&nbsp;file</span><br>
<span class="lineno"></span><span class="comment" id="2205847">//&nbsp;descriptors&nbsp;close-on-exec&nbsp;and&nbsp;then,&nbsp;in&nbsp;the&nbsp;child,&nbsp;explicitly</span><br>
<span class="lineno"></span><span class="comment" id="2205911">//&nbsp;unmark&nbsp;the&nbsp;ones&nbsp;we&nbsp;want&nbsp;the&nbsp;exec&#39;ed&nbsp;program&nbsp;to&nbsp;keep.</span><br>
<span class="lineno"></span><span class="comment" id="2205967">//&nbsp;Unix&nbsp;doesn&#39;t&nbsp;make&nbsp;this&nbsp;easy:&nbsp;there&nbsp;is,&nbsp;in&nbsp;general,&nbsp;no&nbsp;way&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2206031">//&nbsp;allocate&nbsp;a&nbsp;new&nbsp;file&nbsp;descriptor&nbsp;close-on-exec.&nbsp;&nbsp;Instead&nbsp;you</span><br>
<span class="lineno">25</span><span class="comment" id="2206093">//&nbsp;have&nbsp;to&nbsp;allocate&nbsp;the&nbsp;descriptor&nbsp;and&nbsp;then&nbsp;mark&nbsp;it&nbsp;close-on-exec.</span><br>
<span class="lineno"></span><span class="comment" id="2206160">//&nbsp;If&nbsp;a&nbsp;fork&nbsp;happens&nbsp;between&nbsp;those&nbsp;two&nbsp;events,&nbsp;the&nbsp;child&#39;s&nbsp;exec</span><br>
<span class="lineno"></span><span class="comment" id="2206224">//&nbsp;will&nbsp;inherit&nbsp;an&nbsp;unwanted&nbsp;file&nbsp;descriptor.</span><br>
<span class="lineno"></span><span class="comment" id="2206269">//</span><br>
<span class="lineno"></span><span class="comment" id="2206272">//&nbsp;This&nbsp;lock&nbsp;solves&nbsp;that&nbsp;race:&nbsp;the&nbsp;create&nbsp;new&nbsp;fd/mark&nbsp;close-on-exec</span><br>
<span class="lineno">30</span><span class="comment" id="2206340">//&nbsp;operation&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;reading,&nbsp;and&nbsp;the&nbsp;fork&nbsp;itself</span><br>
<span class="lineno"></span><span class="comment" id="2206411">//&nbsp;is&nbsp;done&nbsp;holding&nbsp;ForkLock&nbsp;for&nbsp;writing.&nbsp;&nbsp;At&nbsp;least,&nbsp;that&#39;s&nbsp;the&nbsp;idea.</span><br>
<span class="lineno"></span><span class="comment" id="2206480">//&nbsp;There&nbsp;are&nbsp;some&nbsp;complications.</span><br>
<span class="lineno"></span><span class="comment" id="2206513">//</span><br>
<span class="lineno"></span><span class="comment" id="2206516">//&nbsp;Some&nbsp;system&nbsp;calls&nbsp;that&nbsp;create&nbsp;new&nbsp;file&nbsp;descriptors&nbsp;can&nbsp;block</span><br>
<span class="lineno">35</span><span class="comment" id="2206580">//&nbsp;for&nbsp;arbitrarily&nbsp;long&nbsp;times:&nbsp;open&nbsp;on&nbsp;a&nbsp;hung&nbsp;NFS&nbsp;server&nbsp;or&nbsp;named</span><br>
<span class="lineno"></span><span class="comment" id="2206646">//&nbsp;pipe,&nbsp;accept&nbsp;on&nbsp;a&nbsp;socket,&nbsp;and&nbsp;so&nbsp;on.&nbsp;&nbsp;We&nbsp;can&#39;t&nbsp;reasonably&nbsp;grab</span><br>
<span class="lineno"></span><span class="comment" id="2206712">//&nbsp;the&nbsp;lock&nbsp;across&nbsp;those&nbsp;operations.</span><br>
<span class="lineno"></span><span class="comment" id="2206749">//</span><br>
<span class="lineno"></span><span class="comment" id="2206752">//&nbsp;It&nbsp;is&nbsp;worse&nbsp;to&nbsp;inherit&nbsp;some&nbsp;file&nbsp;descriptors&nbsp;than&nbsp;others.</span><br>
<span class="lineno">40</span><span class="comment" id="2206813">//&nbsp;If&nbsp;a&nbsp;non-malicious&nbsp;child&nbsp;accidentally&nbsp;inherits&nbsp;an&nbsp;open&nbsp;ordinary&nbsp;file,</span><br>
<span class="lineno"></span><span class="comment" id="2206886">//&nbsp;that&#39;s&nbsp;not&nbsp;a&nbsp;big&nbsp;deal.&nbsp;&nbsp;On&nbsp;the&nbsp;other&nbsp;hand,&nbsp;if&nbsp;a&nbsp;long-lived&nbsp;child</span><br>
<span class="lineno"></span><span class="comment" id="2206954">//&nbsp;accidentally&nbsp;inherits&nbsp;the&nbsp;write&nbsp;end&nbsp;of&nbsp;a&nbsp;pipe,&nbsp;then&nbsp;the&nbsp;reader</span><br>
<span class="lineno"></span><span class="comment" id="2207020">//&nbsp;of&nbsp;that&nbsp;pipe&nbsp;will&nbsp;not&nbsp;see&nbsp;EOF&nbsp;until&nbsp;that&nbsp;child&nbsp;exits,&nbsp;potentially</span><br>
<span class="lineno"></span><span class="comment" id="2207089">//&nbsp;causing&nbsp;the&nbsp;parent&nbsp;program&nbsp;to&nbsp;hang.&nbsp;&nbsp;This&nbsp;is&nbsp;a&nbsp;common&nbsp;problem</span><br>
<span class="lineno">45</span><span class="comment" id="2207154">//&nbsp;in&nbsp;threaded&nbsp;C&nbsp;programs&nbsp;that&nbsp;use&nbsp;popen.</span><br>
<span class="lineno"></span><span class="comment" id="2207196">//</span><br>
<span class="lineno"></span><span class="comment" id="2207199">//&nbsp;Luckily,&nbsp;the&nbsp;file&nbsp;descriptors&nbsp;that&nbsp;are&nbsp;most&nbsp;important&nbsp;not&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2207263">//&nbsp;inherit&nbsp;are&nbsp;not&nbsp;the&nbsp;ones&nbsp;that&nbsp;can&nbsp;take&nbsp;an&nbsp;arbitrarily&nbsp;long&nbsp;time</span><br>
<span class="lineno"></span><span class="comment" id="2207330">//&nbsp;to&nbsp;create:&nbsp;pipe&nbsp;returns&nbsp;instantly,&nbsp;and&nbsp;the&nbsp;net&nbsp;package&nbsp;uses</span><br>
<span class="lineno">50</span><span class="comment" id="2207393">//&nbsp;non-blocking&nbsp;I/O&nbsp;to&nbsp;accept&nbsp;on&nbsp;a&nbsp;listening&nbsp;socket.</span><br>
<span class="lineno"></span><span class="comment" id="2207446">//&nbsp;The&nbsp;rules&nbsp;for&nbsp;which&nbsp;file&nbsp;descriptor-creating&nbsp;operations&nbsp;use&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2207513">//&nbsp;ForkLock&nbsp;are&nbsp;as&nbsp;follows:</span><br>
<span class="lineno"></span><span class="comment" id="2207541">//</span><br>
<span class="lineno"></span><span class="comment" id="2207544">//&nbsp;1)&nbsp;Pipe.&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno">55</span><span class="comment" id="2207594">//&nbsp;2)&nbsp;Socket.&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2207644">//&nbsp;3)&nbsp;Accept.&nbsp;&nbsp;If&nbsp;using&nbsp;non-blocking&nbsp;mode,&nbsp;use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2207705">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno"></span><span class="comment" id="2207751">//&nbsp;4)&nbsp;Open.&nbsp;&nbsp;&nbsp;&nbsp;Can&nbsp;block.&nbsp;&nbsp;Use&nbsp;O_CLOEXEC&nbsp;if&nbsp;available&nbsp;(Linux).</span><br>
<span class="lineno"></span><span class="comment" id="2207814">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Otherwise,&nbsp;live&nbsp;with&nbsp;the&nbsp;race.</span><br>
<span class="lineno">60</span><span class="comment" id="2207860">//&nbsp;5)&nbsp;Dup.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Does&nbsp;not&nbsp;block.&nbsp;&nbsp;Use&nbsp;the&nbsp;ForkLock.</span><br>
<span class="lineno"></span><span class="comment" id="2207910">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On&nbsp;Linux,&nbsp;could&nbsp;use&nbsp;fcntl&nbsp;F_DUPFD_CLOEXEC</span><br>
<span class="lineno"></span><span class="comment" id="2207967">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;instead&nbsp;of&nbsp;the&nbsp;ForkLock,&nbsp;but&nbsp;only&nbsp;for&nbsp;dup(fd,&nbsp;-1).</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2208034">var</span>&nbsp;<span class="ident" id="2208038">ForkLock</span>&nbsp;<span class="ident" id="2208047">sync</span><span class="op" id="2208051">.</span><span class="ident" id="2208052">RWMutex</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="2208061">//&nbsp;StringSlicePtr&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;SlicePtrFromStrings&nbsp;instead.</span><br>
<span class="lineno"></span><span class="comment" id="2208127">//&nbsp;If&nbsp;any&nbsp;string&nbsp;contains&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;this&nbsp;function&nbsp;panics&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="2208193">//&nbsp;of&nbsp;returning&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span><span class="keyword" id="2208219">func</span>&nbsp;<span class="ident" id="2208224">StringSlicePtr</span><span class="op" id="2208238">(</span><span class="ident" id="2208239">ss</span>&nbsp;<span class="op" id="2208242">[</span><span class="op" id="2208243">]</span><span class="builtintype" id="2208244">string</span><span class="op" id="2208250">)</span>&nbsp;<span class="op" id="2208252">[</span><span class="op" id="2208253">]</span><span class="op" id="2208254">*</span><span class="builtintype" id="2208255">byte</span>&nbsp;<span class="op" id="2208260">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208263">bb</span>&nbsp;<span class="op" id="2208266">:=</span>&nbsp;<span class="builtinfunc" id="2208269">make</span><span class="op" id="2208273">(</span><span class="op" id="2208274">[</span><span class="op" id="2208275">]</span><span class="op" id="2208276">*</span><span class="builtintype" id="2208277">byte</span><span class="op" id="2208281">,</span>&nbsp;<span class="builtinfunc" id="2208283">len</span><span class="op" id="2208286">(</span><span class="ident" id="2208287">ss</span><span class="op" id="2208289">)</span><span class="op" id="2208290">+</span><span class="num" id="2208291">1</span><span class="op" id="2208292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208295">for</span>&nbsp;<span class="ident" id="2208299">i</span>&nbsp;<span class="op" id="2208301">:=</span>&nbsp;<span class="num" id="2208304">0</span><span class="op" id="2208305">;</span>&nbsp;<span class="ident" id="2208307">i</span>&nbsp;<span class="op" id="2208309">&lt;</span>&nbsp;<span class="builtinfunc" id="2208311">len</span><span class="op" id="2208314">(</span><span class="ident" id="2208315">ss</span><span class="op" id="2208317">)</span><span class="op" id="2208318">;</span>&nbsp;<span class="ident" id="2208320">i</span><span class="op" id="2208321">++</span>&nbsp;<span class="op" id="2208324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208328">bb</span><span class="op" id="2208330">[</span><span class="ident" id="2208331">i</span><span class="op" id="2208332">]</span>&nbsp;<span class="op" id="2208334">=</span>&nbsp;<span class="ident" id="2208336">StringBytePtr</span><span class="op" id="2208349">(</span><span class="ident" id="2208350">ss</span><span class="op" id="2208352">[</span><span class="ident" id="2208353">i</span><span class="op" id="2208354">]</span><span class="op" id="2208355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208358">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208361">bb</span><span class="op" id="2208363">[</span><span class="builtinfunc" id="2208364">len</span><span class="op" id="2208367">(</span><span class="ident" id="2208368">ss</span><span class="op" id="2208370">)</span><span class="op" id="2208371">]</span>&nbsp;<span class="op" id="2208373">=</span>&nbsp;<span class="ident" id="2208375">nil</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208380">return</span>&nbsp;<span class="ident" id="2208387">bb</span><br>
<span class="lineno"></span><span class="op" id="2208390">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2208393">//&nbsp;SlicePtrFromStrings&nbsp;converts&nbsp;a&nbsp;slice&nbsp;of&nbsp;strings&nbsp;to&nbsp;a&nbsp;slice&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2208458">//&nbsp;pointers&nbsp;to&nbsp;NUL-terminated&nbsp;byte&nbsp;slices.&nbsp;If&nbsp;any&nbsp;string&nbsp;contains</span><br>
<span class="lineno">80</span><span class="comment" id="2208524">//&nbsp;a&nbsp;NUL&nbsp;byte,&nbsp;it&nbsp;returns&nbsp;(nil,&nbsp;EINVAL).</span><br>
<span class="lineno"></span><span class="keyword" id="2208565">func</span>&nbsp;<span class="ident" id="2208570">SlicePtrFromStrings</span><span class="op" id="2208589">(</span><span class="ident" id="2208590">ss</span>&nbsp;<span class="op" id="2208593">[</span><span class="op" id="2208594">]</span><span class="builtintype" id="2208595">string</span><span class="op" id="2208601">)</span>&nbsp;<span class="op" id="2208603">(</span><span class="op" id="2208604">[</span><span class="op" id="2208605">]</span><span class="op" id="2208606">*</span><span class="builtintype" id="2208607">byte</span><span class="op" id="2208611">,</span>&nbsp;<span class="builtintype" id="2208613">error</span><span class="op" id="2208618">)</span>&nbsp;<span class="op" id="2208620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208623">var</span>&nbsp;<span class="ident" id="2208627">err</span>&nbsp;<span class="builtintype" id="2208631">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208638">bb</span>&nbsp;<span class="op" id="2208641">:=</span>&nbsp;<span class="builtinfunc" id="2208644">make</span><span class="op" id="2208648">(</span><span class="op" id="2208649">[</span><span class="op" id="2208650">]</span><span class="op" id="2208651">*</span><span class="builtintype" id="2208652">byte</span><span class="op" id="2208656">,</span>&nbsp;<span class="builtinfunc" id="2208658">len</span><span class="op" id="2208661">(</span><span class="ident" id="2208662">ss</span><span class="op" id="2208664">)</span><span class="op" id="2208665">+</span><span class="num" id="2208666">1</span><span class="op" id="2208667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208670">for</span>&nbsp;<span class="ident" id="2208674">i</span>&nbsp;<span class="op" id="2208676">:=</span>&nbsp;<span class="num" id="2208679">0</span><span class="op" id="2208680">;</span>&nbsp;<span class="ident" id="2208682">i</span>&nbsp;<span class="op" id="2208684">&lt;</span>&nbsp;<span class="builtinfunc" id="2208686">len</span><span class="op" id="2208689">(</span><span class="ident" id="2208690">ss</span><span class="op" id="2208692">)</span><span class="op" id="2208693">;</span>&nbsp;<span class="ident" id="2208695">i</span><span class="op" id="2208696">++</span>&nbsp;<span class="op" id="2208699">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208703">bb</span><span class="op" id="2208705">[</span><span class="ident" id="2208706">i</span><span class="op" id="2208707">]</span><span class="op" id="2208708">,</span>&nbsp;<span class="ident" id="2208710">err</span>&nbsp;<span class="op" id="2208714">=</span>&nbsp;<span class="ident" id="2208716">BytePtrFromString</span><span class="op" id="2208733">(</span><span class="ident" id="2208734">ss</span><span class="op" id="2208736">[</span><span class="ident" id="2208737">i</span><span class="op" id="2208738">]</span><span class="op" id="2208739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208743">if</span>&nbsp;<span class="ident" id="2208746">err</span>&nbsp;<span class="op" id="2208750">!=</span>&nbsp;<span class="ident" id="2208753">nil</span>&nbsp;<span class="op" id="2208757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208762">return</span>&nbsp;<span class="ident" id="2208769">nil</span><span class="op" id="2208772">,</span>&nbsp;<span class="ident" id="2208774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2208783">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208786">bb</span><span class="op" id="2208788">[</span><span class="builtinfunc" id="2208789">len</span><span class="op" id="2208792">(</span><span class="ident" id="2208793">ss</span><span class="op" id="2208795">)</span><span class="op" id="2208796">]</span>&nbsp;<span class="op" id="2208798">=</span>&nbsp;<span class="ident" id="2208800">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208805">return</span>&nbsp;<span class="ident" id="2208812">bb</span><span class="op" id="2208814">,</span>&nbsp;<span class="ident" id="2208816">nil</span><br>
<span class="lineno"></span><span class="op" id="2208820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2208823">func</span>&nbsp;<span class="ident" id="2208828">CloseOnExec</span><span class="op" id="2208839">(</span><span class="ident" id="2208840">fd</span>&nbsp;<span class="builtintype" id="2208843">int</span><span class="op" id="2208846">)</span>&nbsp;<span class="op" id="2208848">{</span>&nbsp;<span class="ident" id="2208850">fcntl</span><span class="op" id="2208855">(</span><span class="ident" id="2208856">fd</span><span class="op" id="2208858">,</span>&nbsp;<span class="ident" id="2208860">F_SETFD</span><span class="op" id="2208867">,</span>&nbsp;<span class="ident" id="2208869">FD_CLOEXEC</span><span class="op" id="2208879">)</span>&nbsp;<span class="op" id="2208881">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="2208884">func</span>&nbsp;<span class="ident" id="2208889">SetNonblock</span><span class="op" id="2208900">(</span><span class="ident" id="2208901">fd</span>&nbsp;<span class="builtintype" id="2208904">int</span><span class="op" id="2208907">,</span>&nbsp;<span class="ident" id="2208909">nonblocking</span>&nbsp;<span class="builtintype" id="2208921">bool</span><span class="op" id="2208925">)</span>&nbsp;<span class="op" id="2208927">(</span><span class="ident" id="2208928">err</span>&nbsp;<span class="builtintype" id="2208932">error</span><span class="op" id="2208937">)</span>&nbsp;<span class="op" id="2208939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2208942">flag</span><span class="op" id="2208946">,</span>&nbsp;<span class="ident" id="2208948">err</span>&nbsp;<span class="op" id="2208952">:=</span>&nbsp;<span class="ident" id="2208955">fcntl</span><span class="op" id="2208960">(</span><span class="ident" id="2208961">fd</span><span class="op" id="2208963">,</span>&nbsp;<span class="ident" id="2208965">F_GETFL</span><span class="op" id="2208972">,</span>&nbsp;<span class="num" id="2208974">0</span><span class="op" id="2208975">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208978">if</span>&nbsp;<span class="ident" id="2208981">err</span>&nbsp;<span class="op" id="2208985">!=</span>&nbsp;<span class="ident" id="2208988">nil</span>&nbsp;<span class="op" id="2208992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2208996">return</span>&nbsp;<span class="ident" id="2209003">err</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209011">if</span>&nbsp;<span class="ident" id="2209014">nonblocking</span>&nbsp;<span class="op" id="2209026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209030">flag</span>&nbsp;<span class="op" id="2209035">|=</span>&nbsp;<span class="ident" id="2209038">O_NONBLOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209050">}</span>&nbsp;<span class="keyword" id="2209052">else</span>&nbsp;<span class="op" id="2209057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209061">flag</span>&nbsp;<span class="op" id="2209066">&amp;=</span>&nbsp;<span class="op" id="2209069">^</span><span class="ident" id="2209070">O_NONBLOCK</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209085">_</span><span class="op" id="2209086">,</span>&nbsp;<span class="ident" id="2209088">err</span>&nbsp;<span class="op" id="2209092">=</span>&nbsp;<span class="ident" id="2209094">fcntl</span><span class="op" id="2209099">(</span><span class="ident" id="2209100">fd</span><span class="op" id="2209102">,</span>&nbsp;<span class="ident" id="2209104">F_SETFL</span><span class="op" id="2209111">,</span>&nbsp;<span class="ident" id="2209113">flag</span><span class="op" id="2209117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209120">return</span>&nbsp;<span class="ident" id="2209127">err</span><br>
<span class="lineno"></span><span class="op" id="2209131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="2209134">//&nbsp;Credential&nbsp;holds&nbsp;user&nbsp;and&nbsp;group&nbsp;identities&nbsp;to&nbsp;be&nbsp;assumed</span><br>
<span class="lineno"></span><span class="comment" id="2209194">//&nbsp;by&nbsp;a&nbsp;child&nbsp;process&nbsp;started&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno"></span><span class="keyword" id="2209241">type</span>&nbsp;<span class="ident" id="2209246">Credential</span>&nbsp;<span class="keyword" id="2209257">struct</span>&nbsp;<span class="op" id="2209264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209267">Uid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2209274">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2209283">//&nbsp;User&nbsp;ID.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209296">Gid</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2209303">uint32</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="2209312">//&nbsp;Group&nbsp;ID.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209326">Groups</span>&nbsp;<span class="op" id="2209333">[</span><span class="op" id="2209334">]</span><span class="builtintype" id="2209335">uint32</span>&nbsp;<span class="comment" id="2209342">//&nbsp;Supplementary&nbsp;group&nbsp;IDs.</span><br>
<span class="lineno"></span><span class="op" id="2209370">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2209373">//&nbsp;ProcAttr&nbsp;holds&nbsp;attributes&nbsp;that&nbsp;will&nbsp;be&nbsp;applied&nbsp;to&nbsp;a&nbsp;new&nbsp;process&nbsp;started</span><br>
<span class="lineno"></span><span class="comment" id="2209448">//&nbsp;by&nbsp;StartProcess.</span><br>
<span class="lineno">120</span><span class="keyword" id="2209468">type</span>&nbsp;<span class="ident" id="2209473">ProcAttr</span>&nbsp;<span class="keyword" id="2209482">struct</span>&nbsp;<span class="op" id="2209489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209492">Dir</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2209498">string</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2209508">//&nbsp;Current&nbsp;working&nbsp;directory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209539">Env</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2209545">[</span><span class="op" id="2209546">]</span><span class="builtintype" id="2209547">string</span>&nbsp;&nbsp;<span class="comment" id="2209555">//&nbsp;Environment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209572">Files</span>&nbsp;<span class="op" id="2209578">[</span><span class="op" id="2209579">]</span><span class="builtintype" id="2209580">uintptr</span>&nbsp;<span class="comment" id="2209588">//&nbsp;File&nbsp;descriptors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209610">Sys</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2209616">*</span><span class="ident" id="2209617">SysProcAttr</span><br>
<span class="lineno">125</span><span class="op" id="2209629">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2209632">var</span>&nbsp;<span class="ident" id="2209636">zeroProcAttr</span>&nbsp;<span class="ident" id="2209649">ProcAttr</span><br>
<span class="lineno"></span><span class="keyword" id="2209658">var</span>&nbsp;<span class="ident" id="2209662">zeroSysProcAttr</span>&nbsp;<span class="ident" id="2209678">SysProcAttr</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2209691">func</span>&nbsp;<span class="ident" id="2209696">forkExec</span><span class="op" id="2209704">(</span><span class="ident" id="2209705">argv0</span>&nbsp;<span class="builtintype" id="2209711">string</span><span class="op" id="2209717">,</span>&nbsp;<span class="ident" id="2209719">argv</span>&nbsp;<span class="op" id="2209724">[</span><span class="op" id="2209725">]</span><span class="builtintype" id="2209726">string</span><span class="op" id="2209732">,</span>&nbsp;<span class="ident" id="2209734">attr</span>&nbsp;<span class="op" id="2209739">*</span><span class="ident" id="2209740">ProcAttr</span><span class="op" id="2209748">)</span>&nbsp;<span class="op" id="2209750">(</span><span class="ident" id="2209751">pid</span>&nbsp;<span class="builtintype" id="2209755">int</span><span class="op" id="2209758">,</span>&nbsp;<span class="ident" id="2209760">err</span>&nbsp;<span class="builtintype" id="2209764">error</span><span class="op" id="2209769">)</span>&nbsp;<span class="op" id="2209771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209774">var</span>&nbsp;<span class="ident" id="2209778">p</span>&nbsp;<span class="op" id="2209780">[</span><span class="num" id="2209781">2</span><span class="op" id="2209782">]</span><span class="builtintype" id="2209783">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209788">var</span>&nbsp;<span class="ident" id="2209792">n</span>&nbsp;<span class="builtintype" id="2209794">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209799">var</span>&nbsp;<span class="ident" id="2209803">err1</span>&nbsp;<span class="ident" id="2209808">Errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209815">var</span>&nbsp;<span class="ident" id="2209819">wstatus</span>&nbsp;<span class="ident" id="2209827">WaitStatus</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209840">if</span>&nbsp;<span class="ident" id="2209843">attr</span>&nbsp;<span class="op" id="2209848">==</span>&nbsp;<span class="ident" id="2209851">nil</span>&nbsp;<span class="op" id="2209855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209859">attr</span>&nbsp;<span class="op" id="2209864">=</span>&nbsp;<span class="op" id="2209866">&amp;</span><span class="ident" id="2209867">zeroProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209881">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209884">sys</span>&nbsp;<span class="op" id="2209888">:=</span>&nbsp;<span class="ident" id="2209891">attr</span><span class="op" id="2209895">.</span><span class="ident" id="2209896">Sys</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2209901">if</span>&nbsp;<span class="ident" id="2209904">sys</span>&nbsp;<span class="op" id="2209908">==</span>&nbsp;<span class="ident" id="2209911">nil</span>&nbsp;<span class="op" id="2209915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209919">sys</span>&nbsp;<span class="op" id="2209923">=</span>&nbsp;<span class="op" id="2209925">&amp;</span><span class="ident" id="2209926">zeroSysProcAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2209943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209947">p</span><span class="op" id="2209948">[</span><span class="num" id="2209949">0</span><span class="op" id="2209950">]</span>&nbsp;<span class="op" id="2209952">=</span>&nbsp;<span class="op" id="2209954">-</span><span class="num" id="2209955">1</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209958">p</span><span class="op" id="2209959">[</span><span class="num" id="2209960">1</span><span class="op" id="2209961">]</span>&nbsp;<span class="op" id="2209963">=</span>&nbsp;<span class="op" id="2209965">-</span><span class="num" id="2209966">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2209970">//&nbsp;Convert&nbsp;args&nbsp;to&nbsp;C&nbsp;form.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2209998">argv0p</span><span class="op" id="2210004">,</span>&nbsp;<span class="ident" id="2210006">err</span>&nbsp;<span class="op" id="2210010">:=</span>&nbsp;<span class="ident" id="2210013">BytePtrFromString</span><span class="op" id="2210030">(</span><span class="ident" id="2210031">argv0</span><span class="op" id="2210036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210039">if</span>&nbsp;<span class="ident" id="2210042">err</span>&nbsp;<span class="op" id="2210046">!=</span>&nbsp;<span class="ident" id="2210049">nil</span>&nbsp;<span class="op" id="2210053">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210057">return</span>&nbsp;<span class="num" id="2210064">0</span><span class="op" id="2210065">,</span>&nbsp;<span class="ident" id="2210067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210072">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210075">argvp</span><span class="op" id="2210080">,</span>&nbsp;<span class="ident" id="2210082">err</span>&nbsp;<span class="op" id="2210086">:=</span>&nbsp;<span class="ident" id="2210089">SlicePtrFromStrings</span><span class="op" id="2210108">(</span><span class="ident" id="2210109">argv</span><span class="op" id="2210113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210116">if</span>&nbsp;<span class="ident" id="2210119">err</span>&nbsp;<span class="op" id="2210123">!=</span>&nbsp;<span class="ident" id="2210126">nil</span>&nbsp;<span class="op" id="2210130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210134">return</span>&nbsp;<span class="num" id="2210141">0</span><span class="op" id="2210142">,</span>&nbsp;<span class="ident" id="2210144">err</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210152">envvp</span><span class="op" id="2210157">,</span>&nbsp;<span class="ident" id="2210159">err</span>&nbsp;<span class="op" id="2210163">:=</span>&nbsp;<span class="ident" id="2210166">SlicePtrFromStrings</span><span class="op" id="2210185">(</span><span class="ident" id="2210186">attr</span><span class="op" id="2210190">.</span><span class="ident" id="2210191">Env</span><span class="op" id="2210194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210197">if</span>&nbsp;<span class="ident" id="2210200">err</span>&nbsp;<span class="op" id="2210204">!=</span>&nbsp;<span class="ident" id="2210207">nil</span>&nbsp;<span class="op" id="2210211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210215">return</span>&nbsp;<span class="num" id="2210222">0</span><span class="op" id="2210223">,</span>&nbsp;<span class="ident" id="2210225">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210230">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210234">if</span>&nbsp;<span class="op" id="2210237">(</span><span class="ident" id="2210238">runtime</span><span class="op" id="2210245">.</span><span class="ident" id="2210246">GOOS</span>&nbsp;<span class="op" id="2210251">==</span>&nbsp;<span class="string" id="2210254">&#34;freebsd&#34;</span>&nbsp;<span class="op" id="2210264">||</span>&nbsp;<span class="ident" id="2210267">runtime</span><span class="op" id="2210274">.</span><span class="ident" id="2210275">GOOS</span>&nbsp;<span class="op" id="2210280">==</span>&nbsp;<span class="string" id="2210283">&#34;dragonfly&#34;</span><span class="op" id="2210294">)</span>&nbsp;<span class="op" id="2210296">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2210299">len</span><span class="op" id="2210302">(</span><span class="ident" id="2210303">argv</span><span class="op" id="2210307">[</span><span class="num" id="2210308">0</span><span class="op" id="2210309">]</span><span class="op" id="2210310">)</span>&nbsp;<span class="op" id="2210312">&gt;</span>&nbsp;<span class="builtinfunc" id="2210314">len</span><span class="op" id="2210317">(</span><span class="ident" id="2210318">argv0</span><span class="op" id="2210323">)</span>&nbsp;<span class="op" id="2210325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210329">argvp</span><span class="op" id="2210334">[</span><span class="num" id="2210335">0</span><span class="op" id="2210336">]</span>&nbsp;<span class="op" id="2210338">=</span>&nbsp;<span class="ident" id="2210340">argv0p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210348">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210352">var</span>&nbsp;<span class="ident" id="2210356">chroot</span>&nbsp;<span class="op" id="2210363">*</span><span class="builtintype" id="2210364">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210370">if</span>&nbsp;<span class="ident" id="2210373">sys</span><span class="op" id="2210376">.</span><span class="ident" id="2210377">Chroot</span>&nbsp;<span class="op" id="2210384">!=</span>&nbsp;<span class="string" id="2210387">&#34;&#34;</span>&nbsp;<span class="op" id="2210390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210394">chroot</span><span class="op" id="2210400">,</span>&nbsp;<span class="ident" id="2210402">err</span>&nbsp;<span class="op" id="2210406">=</span>&nbsp;<span class="ident" id="2210408">BytePtrFromString</span><span class="op" id="2210425">(</span><span class="ident" id="2210426">sys</span><span class="op" id="2210429">.</span><span class="ident" id="2210430">Chroot</span><span class="op" id="2210436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210440">if</span>&nbsp;<span class="ident" id="2210443">err</span>&nbsp;<span class="op" id="2210447">!=</span>&nbsp;<span class="ident" id="2210450">nil</span>&nbsp;<span class="op" id="2210454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210459">return</span>&nbsp;<span class="num" id="2210466">0</span><span class="op" id="2210467">,</span>&nbsp;<span class="ident" id="2210469">err</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210481">var</span>&nbsp;<span class="ident" id="2210485">dir</span>&nbsp;<span class="op" id="2210489">*</span><span class="builtintype" id="2210490">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210496">if</span>&nbsp;<span class="ident" id="2210499">attr</span><span class="op" id="2210503">.</span><span class="ident" id="2210504">Dir</span>&nbsp;<span class="op" id="2210508">!=</span>&nbsp;<span class="string" id="2210511">&#34;&#34;</span>&nbsp;<span class="op" id="2210514">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210518">dir</span><span class="op" id="2210521">,</span>&nbsp;<span class="ident" id="2210523">err</span>&nbsp;<span class="op" id="2210527">=</span>&nbsp;<span class="ident" id="2210529">BytePtrFromString</span><span class="op" id="2210546">(</span><span class="ident" id="2210547">attr</span><span class="op" id="2210551">.</span><span class="ident" id="2210552">Dir</span><span class="op" id="2210555">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210559">if</span>&nbsp;<span class="ident" id="2210562">err</span>&nbsp;<span class="op" id="2210566">!=</span>&nbsp;<span class="ident" id="2210569">nil</span>&nbsp;<span class="op" id="2210573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210578">return</span>&nbsp;<span class="num" id="2210585">0</span><span class="op" id="2210586">,</span>&nbsp;<span class="ident" id="2210588">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210601">//&nbsp;Acquire&nbsp;the&nbsp;fork&nbsp;lock&nbsp;so&nbsp;that&nbsp;no&nbsp;other&nbsp;threads</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210652">//&nbsp;create&nbsp;new&nbsp;fds&nbsp;that&nbsp;are&nbsp;not&nbsp;yet&nbsp;close-on-exec</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210702">//&nbsp;before&nbsp;we&nbsp;fork.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210722">ForkLock</span><span class="op" id="2210730">.</span><span class="ident" id="2210731">Lock</span><span class="op" id="2210735">(</span><span class="op" id="2210736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210740">//&nbsp;Allocate&nbsp;child&nbsp;status&nbsp;pipe&nbsp;close&nbsp;on&nbsp;exec.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210786">if</span>&nbsp;<span class="ident" id="2210789">err</span>&nbsp;<span class="op" id="2210793">=</span>&nbsp;<span class="ident" id="2210795">forkExecPipe</span><span class="op" id="2210807">(</span><span class="ident" id="2210808">p</span><span class="op" id="2210809">[</span><span class="op" id="2210810">:</span><span class="op" id="2210811">]</span><span class="op" id="2210812">)</span><span class="op" id="2210813">;</span>&nbsp;<span class="ident" id="2210815">err</span>&nbsp;<span class="op" id="2210819">!=</span>&nbsp;<span class="ident" id="2210822">nil</span>&nbsp;<span class="op" id="2210826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210830">goto</span>&nbsp;<span class="builtintype" id="2210835">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2210846">//&nbsp;Kick&nbsp;off&nbsp;child.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210866">pid</span><span class="op" id="2210869">,</span>&nbsp;<span class="ident" id="2210871">err1</span>&nbsp;<span class="op" id="2210876">=</span>&nbsp;<span class="ident" id="2210878">forkAndExecInChild</span><span class="op" id="2210896">(</span><span class="ident" id="2210897">argv0p</span><span class="op" id="2210903">,</span>&nbsp;<span class="ident" id="2210905">argvp</span><span class="op" id="2210910">,</span>&nbsp;<span class="ident" id="2210912">envvp</span><span class="op" id="2210917">,</span>&nbsp;<span class="ident" id="2210919">chroot</span><span class="op" id="2210925">,</span>&nbsp;<span class="ident" id="2210927">dir</span><span class="op" id="2210930">,</span>&nbsp;<span class="ident" id="2210932">attr</span><span class="op" id="2210936">,</span>&nbsp;<span class="ident" id="2210938">sys</span><span class="op" id="2210941">,</span>&nbsp;<span class="ident" id="2210943">p</span><span class="op" id="2210944">[</span><span class="num" id="2210945">1</span><span class="op" id="2210946">]</span><span class="op" id="2210947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210950">if</span>&nbsp;<span class="ident" id="2210953">err1</span>&nbsp;<span class="op" id="2210958">!=</span>&nbsp;<span class="num" id="2210961">0</span>&nbsp;<span class="op" id="2210963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2210967">err</span>&nbsp;<span class="op" id="2210971">=</span>&nbsp;<span class="ident" id="2210973">Errno</span><span class="op" id="2210978">(</span><span class="ident" id="2210979">err1</span><span class="op" id="2210983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2210987">goto</span>&nbsp;<span class="builtintype" id="2210992">error</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2210999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211002">ForkLock</span><span class="op" id="2211010">.</span><span class="ident" id="2211011">Unlock</span><span class="op" id="2211017">(</span><span class="op" id="2211018">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211022">//&nbsp;Read&nbsp;child&nbsp;error&nbsp;status&nbsp;from&nbsp;pipe.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211061">Close</span><span class="op" id="2211066">(</span><span class="ident" id="2211067">p</span><span class="op" id="2211068">[</span><span class="num" id="2211069">1</span><span class="op" id="2211070">]</span><span class="op" id="2211071">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211074">n</span><span class="op" id="2211075">,</span>&nbsp;<span class="ident" id="2211077">err</span>&nbsp;<span class="op" id="2211081">=</span>&nbsp;<span class="ident" id="2211083">readlen</span><span class="op" id="2211090">(</span><span class="ident" id="2211091">p</span><span class="op" id="2211092">[</span><span class="num" id="2211093">0</span><span class="op" id="2211094">]</span><span class="op" id="2211095">,</span>&nbsp;<span class="op" id="2211097">(</span><span class="op" id="2211098">*</span><span class="builtintype" id="2211099">byte</span><span class="op" id="2211103">)</span><span class="op" id="2211104">(</span><span class="ident" id="2211105">unsafe</span><span class="op" id="2211111">.</span><span class="ident" id="2211112">Pointer</span><span class="op" id="2211119">(</span><span class="op" id="2211120">&amp;</span><span class="ident" id="2211121">err1</span><span class="op" id="2211125">)</span><span class="op" id="2211126">)</span><span class="op" id="2211127">,</span>&nbsp;<span class="builtintype" id="2211129">int</span><span class="op" id="2211132">(</span><span class="ident" id="2211133">unsafe</span><span class="op" id="2211139">.</span><span class="ident" id="2211140">Sizeof</span><span class="op" id="2211146">(</span><span class="ident" id="2211147">err1</span><span class="op" id="2211151">)</span><span class="op" id="2211152">)</span><span class="op" id="2211153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211156">Close</span><span class="op" id="2211161">(</span><span class="ident" id="2211162">p</span><span class="op" id="2211163">[</span><span class="num" id="2211164">0</span><span class="op" id="2211165">]</span><span class="op" id="2211166">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211169">if</span>&nbsp;<span class="ident" id="2211172">err</span>&nbsp;<span class="op" id="2211176">!=</span>&nbsp;<span class="ident" id="2211179">nil</span>&nbsp;<span class="op" id="2211183">||</span>&nbsp;<span class="ident" id="2211186">n</span>&nbsp;<span class="op" id="2211188">!=</span>&nbsp;<span class="num" id="2211191">0</span>&nbsp;<span class="op" id="2211193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211197">if</span>&nbsp;<span class="ident" id="2211200">n</span>&nbsp;<span class="op" id="2211202">==</span>&nbsp;<span class="builtintype" id="2211205">int</span><span class="op" id="2211208">(</span><span class="ident" id="2211209">unsafe</span><span class="op" id="2211215">.</span><span class="ident" id="2211216">Sizeof</span><span class="op" id="2211222">(</span><span class="ident" id="2211223">err1</span><span class="op" id="2211227">)</span><span class="op" id="2211228">)</span>&nbsp;<span class="op" id="2211230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211235">err</span>&nbsp;<span class="op" id="2211239">=</span>&nbsp;<span class="ident" id="2211241">Errno</span><span class="op" id="2211246">(</span><span class="ident" id="2211247">err1</span><span class="op" id="2211251">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211259">if</span>&nbsp;<span class="ident" id="2211262">err</span>&nbsp;<span class="op" id="2211266">==</span>&nbsp;<span class="ident" id="2211269">nil</span>&nbsp;<span class="op" id="2211273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211278">err</span>&nbsp;<span class="op" id="2211282">=</span>&nbsp;<span class="ident" id="2211284">EPIPE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211292">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211297">//&nbsp;Child&nbsp;failed;&nbsp;wait&nbsp;for&nbsp;it&nbsp;to&nbsp;exit,&nbsp;to&nbsp;make&nbsp;sure</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211350">//&nbsp;the&nbsp;zombies&nbsp;don&#39;t&nbsp;accumulate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211385">_</span><span class="op" id="2211386">,</span>&nbsp;<span class="ident" id="2211388">err1</span>&nbsp;<span class="op" id="2211393">:=</span>&nbsp;<span class="ident" id="2211396">Wait4</span><span class="op" id="2211401">(</span><span class="ident" id="2211402">pid</span><span class="op" id="2211405">,</span>&nbsp;<span class="op" id="2211407">&amp;</span><span class="ident" id="2211408">wstatus</span><span class="op" id="2211415">,</span>&nbsp;<span class="num" id="2211417">0</span><span class="op" id="2211418">,</span>&nbsp;<span class="ident" id="2211420">nil</span><span class="op" id="2211423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211427">for</span>&nbsp;<span class="ident" id="2211431">err1</span>&nbsp;<span class="op" id="2211436">==</span>&nbsp;<span class="ident" id="2211439">EINTR</span>&nbsp;<span class="op" id="2211445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211450">_</span><span class="op" id="2211451">,</span>&nbsp;<span class="ident" id="2211453">err1</span>&nbsp;<span class="op" id="2211458">=</span>&nbsp;<span class="ident" id="2211460">Wait4</span><span class="op" id="2211465">(</span><span class="ident" id="2211466">pid</span><span class="op" id="2211469">,</span>&nbsp;<span class="op" id="2211471">&amp;</span><span class="ident" id="2211472">wstatus</span><span class="op" id="2211479">,</span>&nbsp;<span class="num" id="2211481">0</span><span class="op" id="2211482">,</span>&nbsp;<span class="ident" id="2211484">nil</span><span class="op" id="2211487">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211491">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211495">return</span>&nbsp;<span class="num" id="2211502">0</span><span class="op" id="2211503">,</span>&nbsp;<span class="ident" id="2211505">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2211514">//&nbsp;Read&nbsp;got&nbsp;EOF,&nbsp;so&nbsp;pipe&nbsp;closed&nbsp;on&nbsp;exec,&nbsp;so&nbsp;exec&nbsp;succeeded.</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211575">return</span>&nbsp;<span class="ident" id="2211582">pid</span><span class="op" id="2211585">,</span>&nbsp;<span class="ident" id="2211587">nil</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="builtintype" id="2211592">error</span><span class="op" id="2211597">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211600">if</span>&nbsp;<span class="ident" id="2211603">p</span><span class="op" id="2211604">[</span><span class="num" id="2211605">0</span><span class="op" id="2211606">]</span>&nbsp;<span class="op" id="2211608">&gt;=</span>&nbsp;<span class="num" id="2211611">0</span>&nbsp;<span class="op" id="2211613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211617">Close</span><span class="op" id="2211622">(</span><span class="ident" id="2211623">p</span><span class="op" id="2211624">[</span><span class="num" id="2211625">0</span><span class="op" id="2211626">]</span><span class="op" id="2211627">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211631">Close</span><span class="op" id="2211636">(</span><span class="ident" id="2211637">p</span><span class="op" id="2211638">[</span><span class="num" id="2211639">1</span><span class="op" id="2211640">]</span><span class="op" id="2211641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2211644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2211647">ForkLock</span><span class="op" id="2211655">.</span><span class="ident" id="2211656">Unlock</span><span class="op" id="2211662">(</span><span class="op" id="2211663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211666">return</span>&nbsp;<span class="num" id="2211673">0</span><span class="op" id="2211674">,</span>&nbsp;<span class="ident" id="2211676">err</span><br>
<span class="lineno"></span><span class="op" id="2211680">}</span><br>
<span class="lineno">230</span><br>
<span class="lineno"></span><span class="comment" id="2211683">//&nbsp;Combination&nbsp;of&nbsp;fork&nbsp;and&nbsp;exec,&nbsp;careful&nbsp;to&nbsp;be&nbsp;thread&nbsp;safe.</span><br>
<span class="lineno"></span><span class="keyword" id="2211743">func</span>&nbsp;<span class="ident" id="2211748">ForkExec</span><span class="op" id="2211756">(</span><span class="ident" id="2211757">argv0</span>&nbsp;<span class="builtintype" id="2211763">string</span><span class="op" id="2211769">,</span>&nbsp;<span class="ident" id="2211771">argv</span>&nbsp;<span class="op" id="2211776">[</span><span class="op" id="2211777">]</span><span class="builtintype" id="2211778">string</span><span class="op" id="2211784">,</span>&nbsp;<span class="ident" id="2211786">attr</span>&nbsp;<span class="op" id="2211791">*</span><span class="ident" id="2211792">ProcAttr</span><span class="op" id="2211800">)</span>&nbsp;<span class="op" id="2211802">(</span><span class="ident" id="2211803">pid</span>&nbsp;<span class="builtintype" id="2211807">int</span><span class="op" id="2211810">,</span>&nbsp;<span class="ident" id="2211812">err</span>&nbsp;<span class="builtintype" id="2211816">error</span><span class="op" id="2211821">)</span>&nbsp;<span class="op" id="2211823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2211826">return</span>&nbsp;<span class="ident" id="2211833">forkExec</span><span class="op" id="2211841">(</span><span class="ident" id="2211842">argv0</span><span class="op" id="2211847">,</span>&nbsp;<span class="ident" id="2211849">argv</span><span class="op" id="2211853">,</span>&nbsp;<span class="ident" id="2211855">attr</span><span class="op" id="2211859">)</span><br>
<span class="lineno"></span><span class="op" id="2211861">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="2211864">//&nbsp;StartProcess&nbsp;wraps&nbsp;ForkExec&nbsp;for&nbsp;package&nbsp;os.</span><br>
<span class="lineno"></span><span class="keyword" id="2211911">func</span>&nbsp;<span class="ident" id="2211916">StartProcess</span><span class="op" id="2211928">(</span><span class="ident" id="2211929">argv0</span>&nbsp;<span class="builtintype" id="2211935">string</span><span class="op" id="2211941">,</span>&nbsp;<span class="ident" id="2211943">argv</span>&nbsp;<span class="op" id="2211948">[</span><span class="op" id="2211949">]</span><span class="builtintype" id="2211950">string</span><span class="op" id="2211956">,</span>&nbsp;<span class="ident" id="2211958">attr</span>&nbsp;<span class="op" id="2211963">*</span><span class="ident" id="2211964">ProcAttr</span><span class="op" id="2211972">)</span>&nbsp;<span class="op" id="2211974">(</span><span class="ident" id="2211975">pid</span>&nbsp;<span class="builtintype" id="2211979">int</span><span class="op" id="2211982">,</span>&nbsp;<span class="ident" id="2211984">handle</span>&nbsp;<span class="builtintype" id="2211991">uintptr</span><span class="op" id="2211998">,</span>&nbsp;<span class="ident" id="2212000">err</span>&nbsp;<span class="builtintype" id="2212004">error</span><span class="op" id="2212009">)</span>&nbsp;<span class="op" id="2212011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212014">pid</span><span class="op" id="2212017">,</span>&nbsp;<span class="ident" id="2212019">err</span>&nbsp;<span class="op" id="2212023">=</span>&nbsp;<span class="ident" id="2212025">forkExec</span><span class="op" id="2212033">(</span><span class="ident" id="2212034">argv0</span><span class="op" id="2212039">,</span>&nbsp;<span class="ident" id="2212041">argv</span><span class="op" id="2212045">,</span>&nbsp;<span class="ident" id="2212047">attr</span><span class="op" id="2212051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212054">return</span>&nbsp;<span class="ident" id="2212061">pid</span><span class="op" id="2212064">,</span>&nbsp;<span class="num" id="2212066">0</span><span class="op" id="2212067">,</span>&nbsp;<span class="ident" id="2212069">err</span><br>
<span class="lineno">240</span><span class="op" id="2212073">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2212076">//&nbsp;Ordinary&nbsp;exec.</span><br>
<span class="lineno"></span><span class="keyword" id="2212094">func</span>&nbsp;<span class="ident" id="2212099">Exec</span><span class="op" id="2212103">(</span><span class="ident" id="2212104">argv0</span>&nbsp;<span class="builtintype" id="2212110">string</span><span class="op" id="2212116">,</span>&nbsp;<span class="ident" id="2212118">argv</span>&nbsp;<span class="op" id="2212123">[</span><span class="op" id="2212124">]</span><span class="builtintype" id="2212125">string</span><span class="op" id="2212131">,</span>&nbsp;<span class="ident" id="2212133">envv</span>&nbsp;<span class="op" id="2212138">[</span><span class="op" id="2212139">]</span><span class="builtintype" id="2212140">string</span><span class="op" id="2212146">)</span>&nbsp;<span class="op" id="2212148">(</span><span class="ident" id="2212149">err</span>&nbsp;<span class="builtintype" id="2212153">error</span><span class="op" id="2212158">)</span>&nbsp;<span class="op" id="2212160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212163">argv0p</span><span class="op" id="2212169">,</span>&nbsp;<span class="ident" id="2212171">err</span>&nbsp;<span class="op" id="2212175">:=</span>&nbsp;<span class="ident" id="2212178">BytePtrFromString</span><span class="op" id="2212195">(</span><span class="ident" id="2212196">argv0</span><span class="op" id="2212201">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212204">if</span>&nbsp;<span class="ident" id="2212207">err</span>&nbsp;<span class="op" id="2212211">!=</span>&nbsp;<span class="ident" id="2212214">nil</span>&nbsp;<span class="op" id="2212218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212222">return</span>&nbsp;<span class="ident" id="2212229">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212234">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212237">argvp</span><span class="op" id="2212242">,</span>&nbsp;<span class="ident" id="2212244">err</span>&nbsp;<span class="op" id="2212248">:=</span>&nbsp;<span class="ident" id="2212251">SlicePtrFromStrings</span><span class="op" id="2212270">(</span><span class="ident" id="2212271">argv</span><span class="op" id="2212275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212278">if</span>&nbsp;<span class="ident" id="2212281">err</span>&nbsp;<span class="op" id="2212285">!=</span>&nbsp;<span class="ident" id="2212288">nil</span>&nbsp;<span class="op" id="2212292">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212296">return</span>&nbsp;<span class="ident" id="2212303">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212311">envvp</span><span class="op" id="2212316">,</span>&nbsp;<span class="ident" id="2212318">err</span>&nbsp;<span class="op" id="2212322">:=</span>&nbsp;<span class="ident" id="2212325">SlicePtrFromStrings</span><span class="op" id="2212344">(</span><span class="ident" id="2212345">envv</span><span class="op" id="2212349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212352">if</span>&nbsp;<span class="ident" id="2212355">err</span>&nbsp;<span class="op" id="2212359">!=</span>&nbsp;<span class="ident" id="2212362">nil</span>&nbsp;<span class="op" id="2212366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212370">return</span>&nbsp;<span class="ident" id="2212377">err</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2212382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2212385">_</span><span class="op" id="2212386">,</span>&nbsp;<span class="ident" id="2212388">_</span><span class="op" id="2212389">,</span>&nbsp;<span class="ident" id="2212391">err1</span>&nbsp;<span class="op" id="2212396">:=</span>&nbsp;<span class="ident" id="2212399">RawSyscall</span><span class="op" id="2212409">(</span><span class="ident" id="2212410">SYS_EXECVE</span><span class="op" id="2212420">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2212424">uintptr</span><span class="op" id="2212431">(</span><span class="ident" id="2212432">unsafe</span><span class="op" id="2212438">.</span><span class="ident" id="2212439">Pointer</span><span class="op" id="2212446">(</span><span class="ident" id="2212447">argv0p</span><span class="op" id="2212453">)</span><span class="op" id="2212454">)</span><span class="op" id="2212455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2212459">uintptr</span><span class="op" id="2212466">(</span><span class="ident" id="2212467">unsafe</span><span class="op" id="2212473">.</span><span class="ident" id="2212474">Pointer</span><span class="op" id="2212481">(</span><span class="op" id="2212482">&amp;</span><span class="ident" id="2212483">argvp</span><span class="op" id="2212488">[</span><span class="num" id="2212489">0</span><span class="op" id="2212490">]</span><span class="op" id="2212491">)</span><span class="op" id="2212492">)</span><span class="op" id="2212493">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2212497">uintptr</span><span class="op" id="2212504">(</span><span class="ident" id="2212505">unsafe</span><span class="op" id="2212511">.</span><span class="ident" id="2212512">Pointer</span><span class="op" id="2212519">(</span><span class="op" id="2212520">&amp;</span><span class="ident" id="2212521">envvp</span><span class="op" id="2212526">[</span><span class="num" id="2212527">0</span><span class="op" id="2212528">]</span><span class="op" id="2212529">)</span><span class="op" id="2212530">)</span><span class="op" id="2212531">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2212534">return</span>&nbsp;<span class="ident" id="2212541">Errno</span><span class="op" id="2212546">(</span><span class="ident" id="2212547">err1</span><span class="op" id="2212551">)</span><br>
<span class="lineno"></span><span class="op" id="2212553">}</span>
</div>
</body>
</html>
