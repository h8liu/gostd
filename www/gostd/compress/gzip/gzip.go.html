<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/gzip</h2>
<ul>
<li><a href="/gostd/compress/gzip/gunzip.go.html">gunzip.go</a></li>
<li><a href="/gostd/compress/gzip/gunzip_test.go.html">gunzip_test.go</a></li>
<li><a href="/gostd/compress/gzip/gzip.go.html">gzip.go</a></li>
<li><a href="/gostd/compress/gzip/gzip_test.go.html">gzip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5266493">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5266548">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5266602">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5266653">package</span>&nbsp;<span class="ident" id="5266661">gzip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5266667">import</span>&nbsp;<span class="op" id="5266674">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266677">&#34;compress/flate&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266695">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266705">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266712">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266720">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5266734">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5266739">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="5266742">//&nbsp;These&nbsp;constants&nbsp;are&nbsp;copied&nbsp;from&nbsp;the&nbsp;flate&nbsp;package,&nbsp;so&nbsp;that&nbsp;code&nbsp;that&nbsp;imports</span><br>
<span class="lineno"></span><span class="comment" id="5266822">//&nbsp;&#34;compress/gzip&#34;&nbsp;does&nbsp;not&nbsp;also&nbsp;have&nbsp;to&nbsp;import&nbsp;&#34;compress/flate&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="5266888">const</span>&nbsp;<span class="op" id="5266894">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266897">NoCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5266916">=</span>&nbsp;<span class="ident" id="5266918">flate</span><span class="op" id="5266923">.</span><span class="ident" id="5266924">NoCompression</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266939">BestSpeed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5266958">=</span>&nbsp;<span class="ident" id="5266960">flate</span><span class="op" id="5266965">.</span><span class="ident" id="5266966">BestSpeed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266977">BestCompression</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5266996">=</span>&nbsp;<span class="ident" id="5266998">flate</span><span class="op" id="5267003">.</span><span class="ident" id="5267004">BestCompression</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267021">DefaultCompression</span>&nbsp;<span class="op" id="5267040">=</span>&nbsp;<span class="ident" id="5267042">flate</span><span class="op" id="5267047">.</span><span class="ident" id="5267048">DefaultCompression</span><br>
<span class="lineno"></span><span class="op" id="5267067">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="5267070">//&nbsp;A&nbsp;Writer&nbsp;is&nbsp;an&nbsp;io.WriteCloser.</span><br>
<span class="lineno"></span><span class="comment" id="5267104">//&nbsp;Writes&nbsp;to&nbsp;a&nbsp;Writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5267159">type</span>&nbsp;<span class="ident" id="5267164">Writer</span>&nbsp;<span class="keyword" id="5267171">struct</span>&nbsp;<span class="op" id="5267178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267181">Header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267189">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267201">io</span><span class="op" id="5267203">.</span><span class="ident" id="5267204">Writer</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267212">level</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5267224">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267229">wroteHeader</span>&nbsp;<span class="builtintype" id="5267241">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267247">compressor</span>&nbsp;&nbsp;<span class="op" id="5267259">*</span><span class="ident" id="5267260">flate</span><span class="op" id="5267265">.</span><span class="ident" id="5267266">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267274">digest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5267286">hash</span><span class="op" id="5267290">.</span><span class="ident" id="5267291">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267299">size</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5267311">uint32</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267319">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5267331">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267337">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5267349">[</span><span class="num" id="5267350">10</span><span class="op" id="5267352">]</span><span class="builtintype" id="5267353">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267359">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5267371">error</span><br>
<span class="lineno"></span><span class="op" id="5267377">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="5267380">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;Writer.</span><br>
<span class="lineno"></span><span class="comment" id="5267415">//&nbsp;Writes&nbsp;to&nbsp;the&nbsp;returned&nbsp;writer&nbsp;are&nbsp;compressed&nbsp;and&nbsp;written&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="comment" id="5267481">//</span><br>
<span class="lineno"></span><span class="comment" id="5267484">//&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;call&nbsp;Close&nbsp;on&nbsp;the&nbsp;WriteCloser&nbsp;when&nbsp;done.</span><br>
<span class="lineno"></span><span class="comment" id="5267565">//&nbsp;Writes&nbsp;may&nbsp;be&nbsp;buffered&nbsp;and&nbsp;not&nbsp;flushed&nbsp;until&nbsp;Close.</span><br>
<span class="lineno">45</span><span class="comment" id="5267620">//</span><br>
<span class="lineno"></span><span class="comment" id="5267623">//&nbsp;Callers&nbsp;that&nbsp;wish&nbsp;to&nbsp;set&nbsp;the&nbsp;fields&nbsp;in&nbsp;Writer.Header&nbsp;must&nbsp;do&nbsp;so&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="5267697">//&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Write&nbsp;or&nbsp;Close.&nbsp;The&nbsp;Comment&nbsp;and&nbsp;Name&nbsp;header&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="5267773">//&nbsp;UTF-8&nbsp;strings&nbsp;in&nbsp;Go,&nbsp;but&nbsp;the&nbsp;underlying&nbsp;format&nbsp;requires&nbsp;NUL-terminated&nbsp;ISO</span><br>
<span class="lineno"></span><span class="comment" id="5267851">//&nbsp;8859-1&nbsp;(Latin-1).&nbsp;NUL&nbsp;or&nbsp;non-Latin-1&nbsp;runes&nbsp;in&nbsp;those&nbsp;strings&nbsp;will&nbsp;lead&nbsp;to&nbsp;an</span><br>
<span class="lineno">50</span><span class="comment" id="5267930">//&nbsp;error&nbsp;on&nbsp;Write.</span><br>
<span class="lineno"></span><span class="keyword" id="5267949">func</span>&nbsp;<span class="ident" id="5267954">NewWriter</span><span class="op" id="5267963">(</span><span class="ident" id="5267964">w</span>&nbsp;<span class="ident" id="5267966">io</span><span class="op" id="5267968">.</span><span class="ident" id="5267969">Writer</span><span class="op" id="5267975">)</span>&nbsp;<span class="op" id="5267977">*</span><span class="ident" id="5267978">Writer</span>&nbsp;<span class="op" id="5267985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267988">z</span><span class="op" id="5267989">,</span>&nbsp;<span class="ident" id="5267991">_</span>&nbsp;<span class="op" id="5267993">:=</span>&nbsp;<span class="ident" id="5267996">NewWriterLevel</span><span class="op" id="5268010">(</span><span class="ident" id="5268011">w</span><span class="op" id="5268012">,</span>&nbsp;<span class="ident" id="5268014">DefaultCompression</span><span class="op" id="5268032">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268035">return</span>&nbsp;<span class="ident" id="5268042">z</span><br>
<span class="lineno"></span><span class="op" id="5268044">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="comment" id="5268047">//&nbsp;NewWriterLevel&nbsp;is&nbsp;like&nbsp;NewWriter&nbsp;but&nbsp;specifies&nbsp;the&nbsp;compression&nbsp;level&nbsp;instead</span><br>
<span class="lineno"></span><span class="comment" id="5268127">//&nbsp;of&nbsp;assuming&nbsp;DefaultCompression.</span><br>
<span class="lineno"></span><span class="comment" id="5268162">//</span><br>
<span class="lineno"></span><span class="comment" id="5268165">//&nbsp;The&nbsp;compression&nbsp;level&nbsp;can&nbsp;be&nbsp;DefaultCompression,&nbsp;NoCompression,&nbsp;or&nbsp;any</span><br>
<span class="lineno">60</span><span class="comment" id="5268239">//&nbsp;integer&nbsp;value&nbsp;between&nbsp;BestSpeed&nbsp;and&nbsp;BestCompression&nbsp;inclusive.&nbsp;The&nbsp;error</span><br>
<span class="lineno"></span><span class="comment" id="5268315">//&nbsp;returned&nbsp;will&nbsp;be&nbsp;nil&nbsp;if&nbsp;the&nbsp;level&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span><span class="keyword" id="5268362">func</span>&nbsp;<span class="ident" id="5268367">NewWriterLevel</span><span class="op" id="5268381">(</span><span class="ident" id="5268382">w</span>&nbsp;<span class="ident" id="5268384">io</span><span class="op" id="5268386">.</span><span class="ident" id="5268387">Writer</span><span class="op" id="5268393">,</span>&nbsp;<span class="ident" id="5268395">level</span>&nbsp;<span class="builtintype" id="5268401">int</span><span class="op" id="5268404">)</span>&nbsp;<span class="op" id="5268406">(</span><span class="op" id="5268407">*</span><span class="ident" id="5268408">Writer</span><span class="op" id="5268414">,</span>&nbsp;<span class="builtintype" id="5268416">error</span><span class="op" id="5268421">)</span>&nbsp;<span class="op" id="5268423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268426">if</span>&nbsp;<span class="ident" id="5268429">level</span>&nbsp;<span class="op" id="5268435">&lt;</span>&nbsp;<span class="ident" id="5268437">DefaultCompression</span>&nbsp;<span class="op" id="5268456">||</span>&nbsp;<span class="ident" id="5268459">level</span>&nbsp;<span class="op" id="5268465">&gt;</span>&nbsp;<span class="ident" id="5268467">BestCompression</span>&nbsp;<span class="op" id="5268483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268487">return</span>&nbsp;<span class="ident" id="5268494">nil</span><span class="op" id="5268497">,</span>&nbsp;<span class="ident" id="5268499">fmt</span><span class="op" id="5268502">.</span><span class="ident" id="5268503">Errorf</span><span class="op" id="5268509">(</span><span class="string" id="5268510">&#34;gzip:&nbsp;invalid&nbsp;compression&nbsp;level:&nbsp;%d&#34;</span><span class="op" id="5268547">,</span>&nbsp;<span class="ident" id="5268549">level</span><span class="op" id="5268554">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268560">z</span>&nbsp;<span class="op" id="5268562">:=</span>&nbsp;<span class="builtinfunc" id="5268565">new</span><span class="op" id="5268568">(</span><span class="ident" id="5268569">Writer</span><span class="op" id="5268575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268578">z</span><span class="op" id="5268579">.</span><span class="ident" id="5268580">init</span><span class="op" id="5268584">(</span><span class="ident" id="5268585">w</span><span class="op" id="5268586">,</span>&nbsp;<span class="ident" id="5268588">level</span><span class="op" id="5268593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268596">return</span>&nbsp;<span class="ident" id="5268603">z</span><span class="op" id="5268604">,</span>&nbsp;<span class="ident" id="5268606">nil</span><br>
<span class="lineno"></span><span class="op" id="5268610">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5268613">func</span>&nbsp;<span class="op" id="5268618">(</span><span class="ident" id="5268619">z</span>&nbsp;<span class="op" id="5268621">*</span><span class="ident" id="5268622">Writer</span><span class="op" id="5268628">)</span>&nbsp;<span class="ident" id="5268630">init</span><span class="op" id="5268634">(</span><span class="ident" id="5268635">w</span>&nbsp;<span class="ident" id="5268637">io</span><span class="op" id="5268639">.</span><span class="ident" id="5268640">Writer</span><span class="op" id="5268646">,</span>&nbsp;<span class="ident" id="5268648">level</span>&nbsp;<span class="builtintype" id="5268654">int</span><span class="op" id="5268657">)</span>&nbsp;<span class="op" id="5268659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268662">digest</span>&nbsp;<span class="op" id="5268669">:=</span>&nbsp;<span class="ident" id="5268672">z</span><span class="op" id="5268673">.</span><span class="ident" id="5268674">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268682">if</span>&nbsp;<span class="ident" id="5268685">digest</span>&nbsp;<span class="op" id="5268692">!=</span>&nbsp;<span class="ident" id="5268695">nil</span>&nbsp;<span class="op" id="5268699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268703">digest</span><span class="op" id="5268709">.</span><span class="ident" id="5268710">Reset</span><span class="op" id="5268715">(</span><span class="op" id="5268716">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268719">}</span>&nbsp;<span class="keyword" id="5268721">else</span>&nbsp;<span class="op" id="5268726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268730">digest</span>&nbsp;<span class="op" id="5268737">=</span>&nbsp;<span class="ident" id="5268739">crc32</span><span class="op" id="5268744">.</span><span class="ident" id="5268745">NewIEEE</span><span class="op" id="5268752">(</span><span class="op" id="5268753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268759">compressor</span>&nbsp;<span class="op" id="5268770">:=</span>&nbsp;<span class="ident" id="5268773">z</span><span class="op" id="5268774">.</span><span class="ident" id="5268775">compressor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268787">if</span>&nbsp;<span class="ident" id="5268790">compressor</span>&nbsp;<span class="op" id="5268801">!=</span>&nbsp;<span class="ident" id="5268804">nil</span>&nbsp;<span class="op" id="5268808">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268812">compressor</span><span class="op" id="5268822">.</span><span class="ident" id="5268823">Reset</span><span class="op" id="5268828">(</span><span class="ident" id="5268829">w</span><span class="op" id="5268830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268833">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268836">*</span><span class="ident" id="5268837">z</span>&nbsp;<span class="op" id="5268839">=</span>&nbsp;<span class="ident" id="5268841">Writer</span><span class="op" id="5268847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268851">Header</span><span class="op" id="5268857">:</span>&nbsp;<span class="ident" id="5268859">Header</span><span class="op" id="5268865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268870">OS</span><span class="op" id="5268872">:</span>&nbsp;<span class="num" id="5268874">255</span><span class="op" id="5268877">,</span>&nbsp;<span class="comment" id="5268879">//&nbsp;unknown</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268892">}</span><span class="op" id="5268893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268897">w</span><span class="op" id="5268898">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268909">w</span><span class="op" id="5268910">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268914">level</span><span class="op" id="5268919">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268926">level</span><span class="op" id="5268931">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268935">digest</span><span class="op" id="5268941">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5268947">digest</span><span class="op" id="5268953">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268957">compressor</span><span class="op" id="5268967">:</span>&nbsp;<span class="ident" id="5268969">compressor</span><span class="op" id="5268979">,</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268982">}</span><br>
<span class="lineno"></span><span class="op" id="5268984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5268987">//&nbsp;Reset&nbsp;discards&nbsp;the&nbsp;Writer&nbsp;z&#39;s&nbsp;state&nbsp;and&nbsp;makes&nbsp;it&nbsp;equivalent&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5269057">//&nbsp;result&nbsp;of&nbsp;its&nbsp;original&nbsp;state&nbsp;from&nbsp;NewWriter&nbsp;or&nbsp;NewWriterLevel,&nbsp;but</span><br>
<span class="lineno">95</span><span class="comment" id="5269127">//&nbsp;writing&nbsp;to&nbsp;w&nbsp;instead.&nbsp;This&nbsp;permits&nbsp;reusing&nbsp;a&nbsp;Writer&nbsp;rather&nbsp;than</span><br>
<span class="lineno"></span><span class="comment" id="5269194">//&nbsp;allocating&nbsp;a&nbsp;new&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="5269219">func</span>&nbsp;<span class="op" id="5269224">(</span><span class="ident" id="5269225">z</span>&nbsp;<span class="op" id="5269227">*</span><span class="ident" id="5269228">Writer</span><span class="op" id="5269234">)</span>&nbsp;<span class="ident" id="5269236">Reset</span><span class="op" id="5269241">(</span><span class="ident" id="5269242">w</span>&nbsp;<span class="ident" id="5269244">io</span><span class="op" id="5269246">.</span><span class="ident" id="5269247">Writer</span><span class="op" id="5269253">)</span>&nbsp;<span class="op" id="5269255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269258">z</span><span class="op" id="5269259">.</span><span class="ident" id="5269260">init</span><span class="op" id="5269264">(</span><span class="ident" id="5269265">w</span><span class="op" id="5269266">,</span>&nbsp;<span class="ident" id="5269268">z</span><span class="op" id="5269269">.</span><span class="ident" id="5269270">level</span><span class="op" id="5269275">)</span><br>
<span class="lineno"></span><span class="op" id="5269277">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5269280">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;is&nbsp;little-endian,&nbsp;unlike&nbsp;ZLIB&nbsp;(RFC&nbsp;1950).</span><br>
<span class="lineno"></span><span class="keyword" id="5269341">func</span>&nbsp;<span class="ident" id="5269346">put2</span><span class="op" id="5269350">(</span><span class="ident" id="5269351">p</span>&nbsp;<span class="op" id="5269353">[</span><span class="op" id="5269354">]</span><span class="builtintype" id="5269355">byte</span><span class="op" id="5269359">,</span>&nbsp;<span class="ident" id="5269361">v</span>&nbsp;<span class="builtintype" id="5269363">uint16</span><span class="op" id="5269369">)</span>&nbsp;<span class="op" id="5269371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269374">p</span><span class="op" id="5269375">[</span><span class="num" id="5269376">0</span><span class="op" id="5269377">]</span>&nbsp;<span class="op" id="5269379">=</span>&nbsp;<span class="builtintype" id="5269381">uint8</span><span class="op" id="5269386">(</span><span class="ident" id="5269387">v</span>&nbsp;<span class="op" id="5269389">&gt;&gt;</span>&nbsp;<span class="num" id="5269392">0</span><span class="op" id="5269393">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269396">p</span><span class="op" id="5269397">[</span><span class="num" id="5269398">1</span><span class="op" id="5269399">]</span>&nbsp;<span class="op" id="5269401">=</span>&nbsp;<span class="builtintype" id="5269403">uint8</span><span class="op" id="5269408">(</span><span class="ident" id="5269409">v</span>&nbsp;<span class="op" id="5269411">&gt;&gt;</span>&nbsp;<span class="num" id="5269414">8</span><span class="op" id="5269415">)</span><br>
<span class="lineno">105</span><span class="op" id="5269417">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5269420">func</span>&nbsp;<span class="ident" id="5269425">put4</span><span class="op" id="5269429">(</span><span class="ident" id="5269430">p</span>&nbsp;<span class="op" id="5269432">[</span><span class="op" id="5269433">]</span><span class="builtintype" id="5269434">byte</span><span class="op" id="5269438">,</span>&nbsp;<span class="ident" id="5269440">v</span>&nbsp;<span class="builtintype" id="5269442">uint32</span><span class="op" id="5269448">)</span>&nbsp;<span class="op" id="5269450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269453">p</span><span class="op" id="5269454">[</span><span class="num" id="5269455">0</span><span class="op" id="5269456">]</span>&nbsp;<span class="op" id="5269458">=</span>&nbsp;<span class="builtintype" id="5269460">uint8</span><span class="op" id="5269465">(</span><span class="ident" id="5269466">v</span>&nbsp;<span class="op" id="5269468">&gt;&gt;</span>&nbsp;<span class="num" id="5269471">0</span><span class="op" id="5269472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269475">p</span><span class="op" id="5269476">[</span><span class="num" id="5269477">1</span><span class="op" id="5269478">]</span>&nbsp;<span class="op" id="5269480">=</span>&nbsp;<span class="builtintype" id="5269482">uint8</span><span class="op" id="5269487">(</span><span class="ident" id="5269488">v</span>&nbsp;<span class="op" id="5269490">&gt;&gt;</span>&nbsp;<span class="num" id="5269493">8</span><span class="op" id="5269494">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269497">p</span><span class="op" id="5269498">[</span><span class="num" id="5269499">2</span><span class="op" id="5269500">]</span>&nbsp;<span class="op" id="5269502">=</span>&nbsp;<span class="builtintype" id="5269504">uint8</span><span class="op" id="5269509">(</span><span class="ident" id="5269510">v</span>&nbsp;<span class="op" id="5269512">&gt;&gt;</span>&nbsp;<span class="num" id="5269515">16</span><span class="op" id="5269517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269520">p</span><span class="op" id="5269521">[</span><span class="num" id="5269522">3</span><span class="op" id="5269523">]</span>&nbsp;<span class="op" id="5269525">=</span>&nbsp;<span class="builtintype" id="5269527">uint8</span><span class="op" id="5269532">(</span><span class="ident" id="5269533">v</span>&nbsp;<span class="op" id="5269535">&gt;&gt;</span>&nbsp;<span class="num" id="5269538">24</span><span class="op" id="5269540">)</span><br>
<span class="lineno"></span><span class="op" id="5269542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269545">//&nbsp;writeBytes&nbsp;writes&nbsp;a&nbsp;length-prefixed&nbsp;byte&nbsp;slice&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno">115</span><span class="keyword" id="5269603">func</span>&nbsp;<span class="op" id="5269608">(</span><span class="ident" id="5269609">z</span>&nbsp;<span class="op" id="5269611">*</span><span class="ident" id="5269612">Writer</span><span class="op" id="5269618">)</span>&nbsp;<span class="ident" id="5269620">writeBytes</span><span class="op" id="5269630">(</span><span class="ident" id="5269631">b</span>&nbsp;<span class="op" id="5269633">[</span><span class="op" id="5269634">]</span><span class="builtintype" id="5269635">byte</span><span class="op" id="5269639">)</span>&nbsp;<span class="builtintype" id="5269641">error</span>&nbsp;<span class="op" id="5269647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269650">if</span>&nbsp;<span class="builtinfunc" id="5269653">len</span><span class="op" id="5269656">(</span><span class="ident" id="5269657">b</span><span class="op" id="5269658">)</span>&nbsp;<span class="op" id="5269660">&gt;</span>&nbsp;<span class="num" id="5269662">0xffff</span>&nbsp;<span class="op" id="5269669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269673">return</span>&nbsp;<span class="ident" id="5269680">errors</span><span class="op" id="5269686">.</span><span class="ident" id="5269687">New</span><span class="op" id="5269690">(</span><span class="string" id="5269691">&#34;gzip.Write:&nbsp;Extra&nbsp;data&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="5269728">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269731">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269734">put2</span><span class="op" id="5269738">(</span><span class="ident" id="5269739">z</span><span class="op" id="5269740">.</span><span class="ident" id="5269741">buf</span><span class="op" id="5269744">[</span><span class="num" id="5269745">0</span><span class="op" id="5269746">:</span><span class="num" id="5269747">2</span><span class="op" id="5269748">]</span><span class="op" id="5269749">,</span>&nbsp;<span class="builtintype" id="5269751">uint16</span><span class="op" id="5269757">(</span><span class="builtinfunc" id="5269758">len</span><span class="op" id="5269761">(</span><span class="ident" id="5269762">b</span><span class="op" id="5269763">)</span><span class="op" id="5269764">)</span><span class="op" id="5269765">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269768">_</span><span class="op" id="5269769">,</span>&nbsp;<span class="ident" id="5269771">err</span>&nbsp;<span class="op" id="5269775">:=</span>&nbsp;<span class="ident" id="5269778">z</span><span class="op" id="5269779">.</span><span class="ident" id="5269780">w</span><span class="op" id="5269781">.</span><span class="ident" id="5269782">Write</span><span class="op" id="5269787">(</span><span class="ident" id="5269788">z</span><span class="op" id="5269789">.</span><span class="ident" id="5269790">buf</span><span class="op" id="5269793">[</span><span class="num" id="5269794">0</span><span class="op" id="5269795">:</span><span class="num" id="5269796">2</span><span class="op" id="5269797">]</span><span class="op" id="5269798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269801">if</span>&nbsp;<span class="ident" id="5269804">err</span>&nbsp;<span class="op" id="5269808">!=</span>&nbsp;<span class="ident" id="5269811">nil</span>&nbsp;<span class="op" id="5269815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269819">return</span>&nbsp;<span class="ident" id="5269826">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269831">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269834">_</span><span class="op" id="5269835">,</span>&nbsp;<span class="ident" id="5269837">err</span>&nbsp;<span class="op" id="5269841">=</span>&nbsp;<span class="ident" id="5269843">z</span><span class="op" id="5269844">.</span><span class="ident" id="5269845">w</span><span class="op" id="5269846">.</span><span class="ident" id="5269847">Write</span><span class="op" id="5269852">(</span><span class="ident" id="5269853">b</span><span class="op" id="5269854">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269857">return</span>&nbsp;<span class="ident" id="5269864">err</span><br>
<span class="lineno"></span><span class="op" id="5269868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269871">//&nbsp;writeString&nbsp;writes&nbsp;a&nbsp;UTF-8&nbsp;string&nbsp;s&nbsp;in&nbsp;GZIP&#39;s&nbsp;format&nbsp;to&nbsp;z.w.</span><br>
<span class="lineno"></span><span class="comment" id="5269935">//&nbsp;GZIP&nbsp;(RFC&nbsp;1952)&nbsp;specifies&nbsp;that&nbsp;strings&nbsp;are&nbsp;NUL-terminated&nbsp;ISO&nbsp;8859-1&nbsp;(Latin-1).</span><br>
<span class="lineno">130</span><span class="keyword" id="5270018">func</span>&nbsp;<span class="op" id="5270023">(</span><span class="ident" id="5270024">z</span>&nbsp;<span class="op" id="5270026">*</span><span class="ident" id="5270027">Writer</span><span class="op" id="5270033">)</span>&nbsp;<span class="ident" id="5270035">writeString</span><span class="op" id="5270046">(</span><span class="ident" id="5270047">s</span>&nbsp;<span class="builtintype" id="5270049">string</span><span class="op" id="5270055">)</span>&nbsp;<span class="op" id="5270057">(</span><span class="ident" id="5270058">err</span>&nbsp;<span class="builtintype" id="5270062">error</span><span class="op" id="5270067">)</span>&nbsp;<span class="op" id="5270069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270072">//&nbsp;GZIP&nbsp;stores&nbsp;Latin-1&nbsp;strings;&nbsp;error&nbsp;if&nbsp;non-Latin-1;&nbsp;convert&nbsp;if&nbsp;non-ASCII.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270149">needconv</span>&nbsp;<span class="op" id="5270158">:=</span>&nbsp;<span class="builtintype" id="5270161">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270168">for</span>&nbsp;<span class="ident" id="5270172">_</span><span class="op" id="5270173">,</span>&nbsp;<span class="ident" id="5270175">v</span>&nbsp;<span class="op" id="5270177">:=</span>&nbsp;<span class="keyword" id="5270180">range</span>&nbsp;<span class="ident" id="5270186">s</span>&nbsp;<span class="op" id="5270188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270192">if</span>&nbsp;<span class="ident" id="5270195">v</span>&nbsp;<span class="op" id="5270197">==</span>&nbsp;<span class="num" id="5270200">0</span>&nbsp;<span class="op" id="5270202">||</span>&nbsp;<span class="ident" id="5270205">v</span>&nbsp;<span class="op" id="5270207">&gt;</span>&nbsp;<span class="num" id="5270209">0xff</span>&nbsp;<span class="op" id="5270214">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270219">return</span>&nbsp;<span class="ident" id="5270226">errors</span><span class="op" id="5270232">.</span><span class="ident" id="5270233">New</span><span class="op" id="5270236">(</span><span class="string" id="5270237">&#34;gzip.Write:&nbsp;non-Latin-1&nbsp;header&nbsp;string&#34;</span><span class="op" id="5270276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270280">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270284">if</span>&nbsp;<span class="ident" id="5270287">v</span>&nbsp;<span class="op" id="5270289">&gt;</span>&nbsp;<span class="num" id="5270291">0x7f</span>&nbsp;<span class="op" id="5270296">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270301">needconv</span>&nbsp;<span class="op" id="5270310">=</span>&nbsp;<span class="builtintype" id="5270312">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270319">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270322">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270325">if</span>&nbsp;<span class="ident" id="5270328">needconv</span>&nbsp;<span class="op" id="5270337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270341">b</span>&nbsp;<span class="op" id="5270343">:=</span>&nbsp;<span class="builtinfunc" id="5270346">make</span><span class="op" id="5270350">(</span><span class="op" id="5270351">[</span><span class="op" id="5270352">]</span><span class="builtintype" id="5270353">byte</span><span class="op" id="5270357">,</span>&nbsp;<span class="num" id="5270359">0</span><span class="op" id="5270360">,</span>&nbsp;<span class="builtinfunc" id="5270362">len</span><span class="op" id="5270365">(</span><span class="ident" id="5270366">s</span><span class="op" id="5270367">)</span><span class="op" id="5270368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270372">for</span>&nbsp;<span class="ident" id="5270376">_</span><span class="op" id="5270377">,</span>&nbsp;<span class="ident" id="5270379">v</span>&nbsp;<span class="op" id="5270381">:=</span>&nbsp;<span class="keyword" id="5270384">range</span>&nbsp;<span class="ident" id="5270390">s</span>&nbsp;<span class="op" id="5270392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270397">b</span>&nbsp;<span class="op" id="5270399">=</span>&nbsp;<span class="builtinfunc" id="5270401">append</span><span class="op" id="5270407">(</span><span class="ident" id="5270408">b</span><span class="op" id="5270409">,</span>&nbsp;<span class="builtintype" id="5270411">byte</span><span class="op" id="5270415">(</span><span class="ident" id="5270416">v</span><span class="op" id="5270417">)</span><span class="op" id="5270418">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270426">_</span><span class="op" id="5270427">,</span>&nbsp;<span class="ident" id="5270429">err</span>&nbsp;<span class="op" id="5270433">=</span>&nbsp;<span class="ident" id="5270435">z</span><span class="op" id="5270436">.</span><span class="ident" id="5270437">w</span><span class="op" id="5270438">.</span><span class="ident" id="5270439">Write</span><span class="op" id="5270444">(</span><span class="ident" id="5270445">b</span><span class="op" id="5270446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270449">}</span>&nbsp;<span class="keyword" id="5270451">else</span>&nbsp;<span class="op" id="5270456">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270460">_</span><span class="op" id="5270461">,</span>&nbsp;<span class="ident" id="5270463">err</span>&nbsp;<span class="op" id="5270467">=</span>&nbsp;<span class="ident" id="5270469">io</span><span class="op" id="5270471">.</span><span class="ident" id="5270472">WriteString</span><span class="op" id="5270483">(</span><span class="ident" id="5270484">z</span><span class="op" id="5270485">.</span><span class="ident" id="5270486">w</span><span class="op" id="5270487">,</span>&nbsp;<span class="ident" id="5270489">s</span><span class="op" id="5270490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270493">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270496">if</span>&nbsp;<span class="ident" id="5270499">err</span>&nbsp;<span class="op" id="5270503">!=</span>&nbsp;<span class="ident" id="5270506">nil</span>&nbsp;<span class="op" id="5270510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270514">return</span>&nbsp;<span class="ident" id="5270521">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270529">//&nbsp;GZIP&nbsp;strings&nbsp;are&nbsp;NUL-terminated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270566">z</span><span class="op" id="5270567">.</span><span class="ident" id="5270568">buf</span><span class="op" id="5270571">[</span><span class="num" id="5270572">0</span><span class="op" id="5270573">]</span>&nbsp;<span class="op" id="5270575">=</span>&nbsp;<span class="num" id="5270577">0</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270580">_</span><span class="op" id="5270581">,</span>&nbsp;<span class="ident" id="5270583">err</span>&nbsp;<span class="op" id="5270587">=</span>&nbsp;<span class="ident" id="5270589">z</span><span class="op" id="5270590">.</span><span class="ident" id="5270591">w</span><span class="op" id="5270592">.</span><span class="ident" id="5270593">Write</span><span class="op" id="5270598">(</span><span class="ident" id="5270599">z</span><span class="op" id="5270600">.</span><span class="ident" id="5270601">buf</span><span class="op" id="5270604">[</span><span class="num" id="5270605">0</span><span class="op" id="5270606">:</span><span class="num" id="5270607">1</span><span class="op" id="5270608">]</span><span class="op" id="5270609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270612">return</span>&nbsp;<span class="ident" id="5270619">err</span><br>
<span class="lineno"></span><span class="op" id="5270623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5270626">//&nbsp;Write&nbsp;writes&nbsp;a&nbsp;compressed&nbsp;form&nbsp;of&nbsp;p&nbsp;to&nbsp;the&nbsp;underlying&nbsp;io.Writer.&nbsp;The</span><br>
<span class="lineno">160</span><span class="comment" id="5270698">//&nbsp;compressed&nbsp;bytes&nbsp;are&nbsp;not&nbsp;necessarily&nbsp;flushed&nbsp;until&nbsp;the&nbsp;Writer&nbsp;is&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="5270774">func</span>&nbsp;<span class="op" id="5270779">(</span><span class="ident" id="5270780">z</span>&nbsp;<span class="op" id="5270782">*</span><span class="ident" id="5270783">Writer</span><span class="op" id="5270789">)</span>&nbsp;<span class="ident" id="5270791">Write</span><span class="op" id="5270796">(</span><span class="ident" id="5270797">p</span>&nbsp;<span class="op" id="5270799">[</span><span class="op" id="5270800">]</span><span class="builtintype" id="5270801">byte</span><span class="op" id="5270805">)</span>&nbsp;<span class="op" id="5270807">(</span><span class="builtintype" id="5270808">int</span><span class="op" id="5270811">,</span>&nbsp;<span class="builtintype" id="5270813">error</span><span class="op" id="5270818">)</span>&nbsp;<span class="op" id="5270820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270823">if</span>&nbsp;<span class="ident" id="5270826">z</span><span class="op" id="5270827">.</span><span class="ident" id="5270828">err</span>&nbsp;<span class="op" id="5270832">!=</span>&nbsp;<span class="ident" id="5270835">nil</span>&nbsp;<span class="op" id="5270839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270843">return</span>&nbsp;<span class="num" id="5270850">0</span><span class="op" id="5270851">,</span>&nbsp;<span class="ident" id="5270853">z</span><span class="op" id="5270854">.</span><span class="ident" id="5270855">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270860">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270863">var</span>&nbsp;<span class="ident" id="5270867">n</span>&nbsp;<span class="builtintype" id="5270869">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270874">//&nbsp;Write&nbsp;the&nbsp;GZIP&nbsp;header&nbsp;lazily.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270908">if</span>&nbsp;<span class="op" id="5270911">!</span><span class="ident" id="5270912">z</span><span class="op" id="5270913">.</span><span class="ident" id="5270914">wroteHeader</span>&nbsp;<span class="op" id="5270926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270930">z</span><span class="op" id="5270931">.</span><span class="ident" id="5270932">wroteHeader</span>&nbsp;<span class="op" id="5270944">=</span>&nbsp;<span class="builtintype" id="5270946">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270953">z</span><span class="op" id="5270954">.</span><span class="ident" id="5270955">buf</span><span class="op" id="5270958">[</span><span class="num" id="5270959">0</span><span class="op" id="5270960">]</span>&nbsp;<span class="op" id="5270962">=</span>&nbsp;<span class="ident" id="5270964">gzipID1</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270974">z</span><span class="op" id="5270975">.</span><span class="ident" id="5270976">buf</span><span class="op" id="5270979">[</span><span class="num" id="5270980">1</span><span class="op" id="5270981">]</span>&nbsp;<span class="op" id="5270983">=</span>&nbsp;<span class="ident" id="5270985">gzipID2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270995">z</span><span class="op" id="5270996">.</span><span class="ident" id="5270997">buf</span><span class="op" id="5271000">[</span><span class="num" id="5271001">2</span><span class="op" id="5271002">]</span>&nbsp;<span class="op" id="5271004">=</span>&nbsp;<span class="ident" id="5271006">gzipDeflate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271020">z</span><span class="op" id="5271021">.</span><span class="ident" id="5271022">buf</span><span class="op" id="5271025">[</span><span class="num" id="5271026">3</span><span class="op" id="5271027">]</span>&nbsp;<span class="op" id="5271029">=</span>&nbsp;<span class="num" id="5271031">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271035">if</span>&nbsp;<span class="ident" id="5271038">z</span><span class="op" id="5271039">.</span><span class="ident" id="5271040">Extra</span>&nbsp;<span class="op" id="5271046">!=</span>&nbsp;<span class="ident" id="5271049">nil</span>&nbsp;<span class="op" id="5271053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271058">z</span><span class="op" id="5271059">.</span><span class="ident" id="5271060">buf</span><span class="op" id="5271063">[</span><span class="num" id="5271064">3</span><span class="op" id="5271065">]</span>&nbsp;<span class="op" id="5271067">|=</span>&nbsp;<span class="num" id="5271070">0x04</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271081">if</span>&nbsp;<span class="ident" id="5271084">z</span><span class="op" id="5271085">.</span><span class="ident" id="5271086">Name</span>&nbsp;<span class="op" id="5271091">!=</span>&nbsp;<span class="string" id="5271094">&#34;&#34;</span>&nbsp;<span class="op" id="5271097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271102">z</span><span class="op" id="5271103">.</span><span class="ident" id="5271104">buf</span><span class="op" id="5271107">[</span><span class="num" id="5271108">3</span><span class="op" id="5271109">]</span>&nbsp;<span class="op" id="5271111">|=</span>&nbsp;<span class="num" id="5271114">0x08</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271125">if</span>&nbsp;<span class="ident" id="5271128">z</span><span class="op" id="5271129">.</span><span class="ident" id="5271130">Comment</span>&nbsp;<span class="op" id="5271138">!=</span>&nbsp;<span class="string" id="5271141">&#34;&#34;</span>&nbsp;<span class="op" id="5271144">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271149">z</span><span class="op" id="5271150">.</span><span class="ident" id="5271151">buf</span><span class="op" id="5271154">[</span><span class="num" id="5271155">3</span><span class="op" id="5271156">]</span>&nbsp;<span class="op" id="5271158">|=</span>&nbsp;<span class="num" id="5271161">0x10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271172">put4</span><span class="op" id="5271176">(</span><span class="ident" id="5271177">z</span><span class="op" id="5271178">.</span><span class="ident" id="5271179">buf</span><span class="op" id="5271182">[</span><span class="num" id="5271183">4</span><span class="op" id="5271184">:</span><span class="num" id="5271185">8</span><span class="op" id="5271186">]</span><span class="op" id="5271187">,</span>&nbsp;<span class="builtintype" id="5271189">uint32</span><span class="op" id="5271195">(</span><span class="ident" id="5271196">z</span><span class="op" id="5271197">.</span><span class="ident" id="5271198">ModTime</span><span class="op" id="5271205">.</span><span class="ident" id="5271206">Unix</span><span class="op" id="5271210">(</span><span class="op" id="5271211">)</span><span class="op" id="5271212">)</span><span class="op" id="5271213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271217">if</span>&nbsp;<span class="ident" id="5271220">z</span><span class="op" id="5271221">.</span><span class="ident" id="5271222">level</span>&nbsp;<span class="op" id="5271228">==</span>&nbsp;<span class="ident" id="5271231">BestCompression</span>&nbsp;<span class="op" id="5271247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271252">z</span><span class="op" id="5271253">.</span><span class="ident" id="5271254">buf</span><span class="op" id="5271257">[</span><span class="num" id="5271258">8</span><span class="op" id="5271259">]</span>&nbsp;<span class="op" id="5271261">=</span>&nbsp;<span class="num" id="5271263">2</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271267">}</span>&nbsp;<span class="keyword" id="5271269">else</span>&nbsp;<span class="keyword" id="5271274">if</span>&nbsp;<span class="ident" id="5271277">z</span><span class="op" id="5271278">.</span><span class="ident" id="5271279">level</span>&nbsp;<span class="op" id="5271285">==</span>&nbsp;<span class="ident" id="5271288">BestSpeed</span>&nbsp;<span class="op" id="5271298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271303">z</span><span class="op" id="5271304">.</span><span class="ident" id="5271305">buf</span><span class="op" id="5271308">[</span><span class="num" id="5271309">8</span><span class="op" id="5271310">]</span>&nbsp;<span class="op" id="5271312">=</span>&nbsp;<span class="num" id="5271314">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271318">}</span>&nbsp;<span class="keyword" id="5271320">else</span>&nbsp;<span class="op" id="5271325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271330">z</span><span class="op" id="5271331">.</span><span class="ident" id="5271332">buf</span><span class="op" id="5271335">[</span><span class="num" id="5271336">8</span><span class="op" id="5271337">]</span>&nbsp;<span class="op" id="5271339">=</span>&nbsp;<span class="num" id="5271341">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271345">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271349">z</span><span class="op" id="5271350">.</span><span class="ident" id="5271351">buf</span><span class="op" id="5271354">[</span><span class="num" id="5271355">9</span><span class="op" id="5271356">]</span>&nbsp;<span class="op" id="5271358">=</span>&nbsp;<span class="ident" id="5271360">z</span><span class="op" id="5271361">.</span><span class="ident" id="5271362">OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271367">n</span><span class="op" id="5271368">,</span>&nbsp;<span class="ident" id="5271370">z</span><span class="op" id="5271371">.</span><span class="ident" id="5271372">err</span>&nbsp;<span class="op" id="5271376">=</span>&nbsp;<span class="ident" id="5271378">z</span><span class="op" id="5271379">.</span><span class="ident" id="5271380">w</span><span class="op" id="5271381">.</span><span class="ident" id="5271382">Write</span><span class="op" id="5271387">(</span><span class="ident" id="5271388">z</span><span class="op" id="5271389">.</span><span class="ident" id="5271390">buf</span><span class="op" id="5271393">[</span><span class="num" id="5271394">0</span><span class="op" id="5271395">:</span><span class="num" id="5271396">10</span><span class="op" id="5271398">]</span><span class="op" id="5271399">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271403">if</span>&nbsp;<span class="ident" id="5271406">z</span><span class="op" id="5271407">.</span><span class="ident" id="5271408">err</span>&nbsp;<span class="op" id="5271412">!=</span>&nbsp;<span class="ident" id="5271415">nil</span>&nbsp;<span class="op" id="5271419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271424">return</span>&nbsp;<span class="ident" id="5271431">n</span><span class="op" id="5271432">,</span>&nbsp;<span class="ident" id="5271434">z</span><span class="op" id="5271435">.</span><span class="ident" id="5271436">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271442">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271446">if</span>&nbsp;<span class="ident" id="5271449">z</span><span class="op" id="5271450">.</span><span class="ident" id="5271451">Extra</span>&nbsp;<span class="op" id="5271457">!=</span>&nbsp;<span class="ident" id="5271460">nil</span>&nbsp;<span class="op" id="5271464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271469">z</span><span class="op" id="5271470">.</span><span class="ident" id="5271471">err</span>&nbsp;<span class="op" id="5271475">=</span>&nbsp;<span class="ident" id="5271477">z</span><span class="op" id="5271478">.</span><span class="ident" id="5271479">writeBytes</span><span class="op" id="5271489">(</span><span class="ident" id="5271490">z</span><span class="op" id="5271491">.</span><span class="ident" id="5271492">Extra</span><span class="op" id="5271497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271502">if</span>&nbsp;<span class="ident" id="5271505">z</span><span class="op" id="5271506">.</span><span class="ident" id="5271507">err</span>&nbsp;<span class="op" id="5271511">!=</span>&nbsp;<span class="ident" id="5271514">nil</span>&nbsp;<span class="op" id="5271518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271524">return</span>&nbsp;<span class="ident" id="5271531">n</span><span class="op" id="5271532">,</span>&nbsp;<span class="ident" id="5271534">z</span><span class="op" id="5271535">.</span><span class="ident" id="5271536">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271543">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271551">if</span>&nbsp;<span class="ident" id="5271554">z</span><span class="op" id="5271555">.</span><span class="ident" id="5271556">Name</span>&nbsp;<span class="op" id="5271561">!=</span>&nbsp;<span class="string" id="5271564">&#34;&#34;</span>&nbsp;<span class="op" id="5271567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271572">z</span><span class="op" id="5271573">.</span><span class="ident" id="5271574">err</span>&nbsp;<span class="op" id="5271578">=</span>&nbsp;<span class="ident" id="5271580">z</span><span class="op" id="5271581">.</span><span class="ident" id="5271582">writeString</span><span class="op" id="5271593">(</span><span class="ident" id="5271594">z</span><span class="op" id="5271595">.</span><span class="ident" id="5271596">Name</span><span class="op" id="5271600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271605">if</span>&nbsp;<span class="ident" id="5271608">z</span><span class="op" id="5271609">.</span><span class="ident" id="5271610">err</span>&nbsp;<span class="op" id="5271614">!=</span>&nbsp;<span class="ident" id="5271617">nil</span>&nbsp;<span class="op" id="5271621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271627">return</span>&nbsp;<span class="ident" id="5271634">n</span><span class="op" id="5271635">,</span>&nbsp;<span class="ident" id="5271637">z</span><span class="op" id="5271638">.</span><span class="ident" id="5271639">err</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271654">if</span>&nbsp;<span class="ident" id="5271657">z</span><span class="op" id="5271658">.</span><span class="ident" id="5271659">Comment</span>&nbsp;<span class="op" id="5271667">!=</span>&nbsp;<span class="string" id="5271670">&#34;&#34;</span>&nbsp;<span class="op" id="5271673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271678">z</span><span class="op" id="5271679">.</span><span class="ident" id="5271680">err</span>&nbsp;<span class="op" id="5271684">=</span>&nbsp;<span class="ident" id="5271686">z</span><span class="op" id="5271687">.</span><span class="ident" id="5271688">writeString</span><span class="op" id="5271699">(</span><span class="ident" id="5271700">z</span><span class="op" id="5271701">.</span><span class="ident" id="5271702">Comment</span><span class="op" id="5271709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271714">if</span>&nbsp;<span class="ident" id="5271717">z</span><span class="op" id="5271718">.</span><span class="ident" id="5271719">err</span>&nbsp;<span class="op" id="5271723">!=</span>&nbsp;<span class="ident" id="5271726">nil</span>&nbsp;<span class="op" id="5271730">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271736">return</span>&nbsp;<span class="ident" id="5271743">n</span><span class="op" id="5271744">,</span>&nbsp;<span class="ident" id="5271746">z</span><span class="op" id="5271747">.</span><span class="ident" id="5271748">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271755">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271763">if</span>&nbsp;<span class="ident" id="5271766">z</span><span class="op" id="5271767">.</span><span class="ident" id="5271768">compressor</span>&nbsp;<span class="op" id="5271779">==</span>&nbsp;<span class="ident" id="5271782">nil</span>&nbsp;<span class="op" id="5271786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271791">z</span><span class="op" id="5271792">.</span><span class="ident" id="5271793">compressor</span><span class="op" id="5271803">,</span>&nbsp;<span class="ident" id="5271805">_</span>&nbsp;<span class="op" id="5271807">=</span>&nbsp;<span class="ident" id="5271809">flate</span><span class="op" id="5271814">.</span><span class="ident" id="5271815">NewWriter</span><span class="op" id="5271824">(</span><span class="ident" id="5271825">z</span><span class="op" id="5271826">.</span><span class="ident" id="5271827">w</span><span class="op" id="5271828">,</span>&nbsp;<span class="ident" id="5271830">z</span><span class="op" id="5271831">.</span><span class="ident" id="5271832">level</span><span class="op" id="5271837">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271847">z</span><span class="op" id="5271848">.</span><span class="ident" id="5271849">size</span>&nbsp;<span class="op" id="5271854">+=</span>&nbsp;<span class="builtintype" id="5271857">uint32</span><span class="op" id="5271863">(</span><span class="builtinfunc" id="5271864">len</span><span class="op" id="5271867">(</span><span class="ident" id="5271868">p</span><span class="op" id="5271869">)</span><span class="op" id="5271870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271873">z</span><span class="op" id="5271874">.</span><span class="ident" id="5271875">digest</span><span class="op" id="5271881">.</span><span class="ident" id="5271882">Write</span><span class="op" id="5271887">(</span><span class="ident" id="5271888">p</span><span class="op" id="5271889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271892">n</span><span class="op" id="5271893">,</span>&nbsp;<span class="ident" id="5271895">z</span><span class="op" id="5271896">.</span><span class="ident" id="5271897">err</span>&nbsp;<span class="op" id="5271901">=</span>&nbsp;<span class="ident" id="5271903">z</span><span class="op" id="5271904">.</span><span class="ident" id="5271905">compressor</span><span class="op" id="5271915">.</span><span class="ident" id="5271916">Write</span><span class="op" id="5271921">(</span><span class="ident" id="5271922">p</span><span class="op" id="5271923">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271926">return</span>&nbsp;<span class="ident" id="5271933">n</span><span class="op" id="5271934">,</span>&nbsp;<span class="ident" id="5271936">z</span><span class="op" id="5271937">.</span><span class="ident" id="5271938">err</span><br>
<span class="lineno"></span><span class="op" id="5271942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5271945">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;pending&nbsp;compressed&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="comment" id="5272016">//</span><br>
<span class="lineno">225</span><span class="comment" id="5272019">//&nbsp;It&nbsp;is&nbsp;useful&nbsp;mainly&nbsp;in&nbsp;compressed&nbsp;network&nbsp;protocols,&nbsp;to&nbsp;ensure&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="5272090">//&nbsp;a&nbsp;remote&nbsp;reader&nbsp;has&nbsp;enough&nbsp;data&nbsp;to&nbsp;reconstruct&nbsp;a&nbsp;packet.&nbsp;Flush&nbsp;does</span><br>
<span class="lineno"></span><span class="comment" id="5272161">//&nbsp;not&nbsp;return&nbsp;until&nbsp;the&nbsp;data&nbsp;has&nbsp;been&nbsp;written.&nbsp;If&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5272226">//&nbsp;writer&nbsp;returns&nbsp;an&nbsp;error,&nbsp;Flush&nbsp;returns&nbsp;that&nbsp;error.</span><br>
<span class="lineno"></span><span class="comment" id="5272280">//</span><br>
<span class="lineno">230</span><span class="comment" id="5272283">//&nbsp;In&nbsp;the&nbsp;terminology&nbsp;of&nbsp;the&nbsp;zlib&nbsp;library,&nbsp;Flush&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;Z_SYNC_FLUSH.</span><br>
<span class="lineno"></span><span class="keyword" id="5272363">func</span>&nbsp;<span class="op" id="5272368">(</span><span class="ident" id="5272369">z</span>&nbsp;<span class="op" id="5272371">*</span><span class="ident" id="5272372">Writer</span><span class="op" id="5272378">)</span>&nbsp;<span class="ident" id="5272380">Flush</span><span class="op" id="5272385">(</span><span class="op" id="5272386">)</span>&nbsp;<span class="builtintype" id="5272388">error</span>&nbsp;<span class="op" id="5272394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272397">if</span>&nbsp;<span class="ident" id="5272400">z</span><span class="op" id="5272401">.</span><span class="ident" id="5272402">err</span>&nbsp;<span class="op" id="5272406">!=</span>&nbsp;<span class="ident" id="5272409">nil</span>&nbsp;<span class="op" id="5272413">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272417">return</span>&nbsp;<span class="ident" id="5272424">z</span><span class="op" id="5272425">.</span><span class="ident" id="5272426">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272431">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272434">if</span>&nbsp;<span class="ident" id="5272437">z</span><span class="op" id="5272438">.</span><span class="ident" id="5272439">closed</span>&nbsp;<span class="op" id="5272446">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272450">return</span>&nbsp;<span class="ident" id="5272457">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272465">if</span>&nbsp;<span class="op" id="5272468">!</span><span class="ident" id="5272469">z</span><span class="op" id="5272470">.</span><span class="ident" id="5272471">wroteHeader</span>&nbsp;<span class="op" id="5272483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272487">z</span><span class="op" id="5272488">.</span><span class="ident" id="5272489">Write</span><span class="op" id="5272494">(</span><span class="ident" id="5272495">nil</span><span class="op" id="5272498">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272502">if</span>&nbsp;<span class="ident" id="5272505">z</span><span class="op" id="5272506">.</span><span class="ident" id="5272507">err</span>&nbsp;<span class="op" id="5272511">!=</span>&nbsp;<span class="ident" id="5272514">nil</span>&nbsp;<span class="op" id="5272518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272523">return</span>&nbsp;<span class="ident" id="5272530">z</span><span class="op" id="5272531">.</span><span class="ident" id="5272532">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272544">z</span><span class="op" id="5272545">.</span><span class="ident" id="5272546">err</span>&nbsp;<span class="op" id="5272550">=</span>&nbsp;<span class="ident" id="5272552">z</span><span class="op" id="5272553">.</span><span class="ident" id="5272554">compressor</span><span class="op" id="5272564">.</span><span class="ident" id="5272565">Flush</span><span class="op" id="5272570">(</span><span class="op" id="5272571">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272574">return</span>&nbsp;<span class="ident" id="5272581">z</span><span class="op" id="5272582">.</span><span class="ident" id="5272583">err</span><br>
<span class="lineno"></span><span class="op" id="5272587">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5272590">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;Writer,&nbsp;flushing&nbsp;any&nbsp;unwritten&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="5272664">//&nbsp;io.Writer,&nbsp;but&nbsp;does&nbsp;not&nbsp;close&nbsp;the&nbsp;underlying&nbsp;io.Writer.</span><br>
<span class="lineno">250</span><span class="keyword" id="5272723">func</span>&nbsp;<span class="op" id="5272728">(</span><span class="ident" id="5272729">z</span>&nbsp;<span class="op" id="5272731">*</span><span class="ident" id="5272732">Writer</span><span class="op" id="5272738">)</span>&nbsp;<span class="ident" id="5272740">Close</span><span class="op" id="5272745">(</span><span class="op" id="5272746">)</span>&nbsp;<span class="builtintype" id="5272748">error</span>&nbsp;<span class="op" id="5272754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272757">if</span>&nbsp;<span class="ident" id="5272760">z</span><span class="op" id="5272761">.</span><span class="ident" id="5272762">err</span>&nbsp;<span class="op" id="5272766">!=</span>&nbsp;<span class="ident" id="5272769">nil</span>&nbsp;<span class="op" id="5272773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272777">return</span>&nbsp;<span class="ident" id="5272784">z</span><span class="op" id="5272785">.</span><span class="ident" id="5272786">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272794">if</span>&nbsp;<span class="ident" id="5272797">z</span><span class="op" id="5272798">.</span><span class="ident" id="5272799">closed</span>&nbsp;<span class="op" id="5272806">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272810">return</span>&nbsp;<span class="ident" id="5272817">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272822">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272825">z</span><span class="op" id="5272826">.</span><span class="ident" id="5272827">closed</span>&nbsp;<span class="op" id="5272834">=</span>&nbsp;<span class="builtintype" id="5272836">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272842">if</span>&nbsp;<span class="op" id="5272845">!</span><span class="ident" id="5272846">z</span><span class="op" id="5272847">.</span><span class="ident" id="5272848">wroteHeader</span>&nbsp;<span class="op" id="5272860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272864">z</span><span class="op" id="5272865">.</span><span class="ident" id="5272866">Write</span><span class="op" id="5272871">(</span><span class="ident" id="5272872">nil</span><span class="op" id="5272875">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272879">if</span>&nbsp;<span class="ident" id="5272882">z</span><span class="op" id="5272883">.</span><span class="ident" id="5272884">err</span>&nbsp;<span class="op" id="5272888">!=</span>&nbsp;<span class="ident" id="5272891">nil</span>&nbsp;<span class="op" id="5272895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272900">return</span>&nbsp;<span class="ident" id="5272907">z</span><span class="op" id="5272908">.</span><span class="ident" id="5272909">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272918">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272921">z</span><span class="op" id="5272922">.</span><span class="ident" id="5272923">err</span>&nbsp;<span class="op" id="5272927">=</span>&nbsp;<span class="ident" id="5272929">z</span><span class="op" id="5272930">.</span><span class="ident" id="5272931">compressor</span><span class="op" id="5272941">.</span><span class="ident" id="5272942">Close</span><span class="op" id="5272947">(</span><span class="op" id="5272948">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272951">if</span>&nbsp;<span class="ident" id="5272954">z</span><span class="op" id="5272955">.</span><span class="ident" id="5272956">err</span>&nbsp;<span class="op" id="5272960">!=</span>&nbsp;<span class="ident" id="5272963">nil</span>&nbsp;<span class="op" id="5272967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272971">return</span>&nbsp;<span class="ident" id="5272978">z</span><span class="op" id="5272979">.</span><span class="ident" id="5272980">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272988">put4</span><span class="op" id="5272992">(</span><span class="ident" id="5272993">z</span><span class="op" id="5272994">.</span><span class="ident" id="5272995">buf</span><span class="op" id="5272998">[</span><span class="num" id="5272999">0</span><span class="op" id="5273000">:</span><span class="num" id="5273001">4</span><span class="op" id="5273002">]</span><span class="op" id="5273003">,</span>&nbsp;<span class="ident" id="5273005">z</span><span class="op" id="5273006">.</span><span class="ident" id="5273007">digest</span><span class="op" id="5273013">.</span><span class="ident" id="5273014">Sum32</span><span class="op" id="5273019">(</span><span class="op" id="5273020">)</span><span class="op" id="5273021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273024">put4</span><span class="op" id="5273028">(</span><span class="ident" id="5273029">z</span><span class="op" id="5273030">.</span><span class="ident" id="5273031">buf</span><span class="op" id="5273034">[</span><span class="num" id="5273035">4</span><span class="op" id="5273036">:</span><span class="num" id="5273037">8</span><span class="op" id="5273038">]</span><span class="op" id="5273039">,</span>&nbsp;<span class="ident" id="5273041">z</span><span class="op" id="5273042">.</span><span class="ident" id="5273043">size</span><span class="op" id="5273047">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5273050">_</span><span class="op" id="5273051">,</span>&nbsp;<span class="ident" id="5273053">z</span><span class="op" id="5273054">.</span><span class="ident" id="5273055">err</span>&nbsp;<span class="op" id="5273059">=</span>&nbsp;<span class="ident" id="5273061">z</span><span class="op" id="5273062">.</span><span class="ident" id="5273063">w</span><span class="op" id="5273064">.</span><span class="ident" id="5273065">Write</span><span class="op" id="5273070">(</span><span class="ident" id="5273071">z</span><span class="op" id="5273072">.</span><span class="ident" id="5273073">buf</span><span class="op" id="5273076">[</span><span class="num" id="5273077">0</span><span class="op" id="5273078">:</span><span class="num" id="5273079">8</span><span class="op" id="5273080">]</span><span class="op" id="5273081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5273084">return</span>&nbsp;<span class="ident" id="5273091">z</span><span class="op" id="5273092">.</span><span class="ident" id="5273093">err</span><br>
<span class="lineno"></span><span class="op" id="5273097">}</span>
</div>
</body>
</html>
