<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8166281">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8166336">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8166390">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8166441">package</span>&nbsp;<span class="ident" id="8166449">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8166454">import</span>&nbsp;<span class="op" id="8166461">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166464">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166473">&#34;encoding/hex&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166489">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166499">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166507">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166514">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166520">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166533">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166540">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166551">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8166562">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="8166569">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="8166572">//&nbsp;TLS&nbsp;reference&nbsp;tests&nbsp;run&nbsp;a&nbsp;connection&nbsp;against&nbsp;a&nbsp;reference&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="8166647">//&nbsp;(OpenSSL)&nbsp;of&nbsp;TLS&nbsp;and&nbsp;record&nbsp;the&nbsp;bytes&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;The&nbsp;Go</span><br>
<span class="lineno"></span><span class="comment" id="8166724">//&nbsp;code,&nbsp;during&nbsp;a&nbsp;test,&nbsp;is&nbsp;configured&nbsp;with&nbsp;deterministic&nbsp;randomness&nbsp;and&nbsp;so&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8166803">//&nbsp;reference&nbsp;test&nbsp;can&nbsp;be&nbsp;reproduced&nbsp;exactly&nbsp;in&nbsp;the&nbsp;future.</span><br>
<span class="lineno">25</span><span class="comment" id="8166862">//</span><br>
<span class="lineno"></span><span class="comment" id="8166865">//&nbsp;In&nbsp;order&nbsp;to&nbsp;save&nbsp;everyone&nbsp;who&nbsp;wishes&nbsp;to&nbsp;run&nbsp;the&nbsp;tests&nbsp;from&nbsp;needing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="8166939">//&nbsp;reference&nbsp;implementation&nbsp;installed,&nbsp;the&nbsp;reference&nbsp;connections&nbsp;are&nbsp;saved&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="8167017">//&nbsp;files&nbsp;in&nbsp;the&nbsp;testdata&nbsp;directory.&nbsp;Thus&nbsp;running&nbsp;the&nbsp;tests&nbsp;involves&nbsp;nothing</span><br>
<span class="lineno"></span><span class="comment" id="8167093">//&nbsp;external,&nbsp;but&nbsp;creating&nbsp;and&nbsp;updating&nbsp;them&nbsp;requires&nbsp;the&nbsp;reference</span><br>
<span class="lineno">30</span><span class="comment" id="8167160">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="comment" id="8167179">//</span><br>
<span class="lineno"></span><span class="comment" id="8167182">//&nbsp;Tests&nbsp;can&nbsp;be&nbsp;updated&nbsp;by&nbsp;running&nbsp;them&nbsp;with&nbsp;the&nbsp;-update&nbsp;flag.&nbsp;This&nbsp;will&nbsp;cause</span><br>
<span class="lineno"></span><span class="comment" id="8167261">//&nbsp;the&nbsp;test&nbsp;files.&nbsp;Generally&nbsp;one&nbsp;should&nbsp;combine&nbsp;the&nbsp;-update&nbsp;flag&nbsp;with&nbsp;-test.run</span><br>
<span class="lineno"></span><span class="comment" id="8167341">//&nbsp;to&nbsp;updated&nbsp;a&nbsp;specific&nbsp;test.&nbsp;Since&nbsp;the&nbsp;reference&nbsp;implementation&nbsp;will&nbsp;always</span><br>
<span class="lineno">35</span><span class="comment" id="8167419">//&nbsp;generate&nbsp;fresh&nbsp;random&nbsp;numbers,&nbsp;large&nbsp;parts&nbsp;of&nbsp;the&nbsp;reference&nbsp;connection&nbsp;will</span><br>
<span class="lineno"></span><span class="comment" id="8167498">//&nbsp;always&nbsp;change.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8167517">var</span>&nbsp;<span class="ident" id="8167521">update</span>&nbsp;<span class="op" id="8167528">=</span>&nbsp;<span class="ident" id="8167530">flag</span><span class="op" id="8167534">.</span><span class="ident" id="8167535">Bool</span><span class="op" id="8167539">(</span><span class="string" id="8167540">&#34;update&#34;</span><span class="op" id="8167548">,</span>&nbsp;<span class="builtintype" id="8167550">false</span><span class="op" id="8167555">,</span>&nbsp;<span class="string" id="8167557">&#34;update&nbsp;golden&nbsp;files&nbsp;on&nbsp;disk&#34;</span><span class="op" id="8167586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="8167589">//&nbsp;recordingConn&nbsp;is&nbsp;a&nbsp;net.Conn&nbsp;that&nbsp;records&nbsp;the&nbsp;traffic&nbsp;that&nbsp;passes&nbsp;through&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="8167669">//&nbsp;WriteTo&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;produce&nbsp;output&nbsp;that&nbsp;can&nbsp;be&nbsp;later&nbsp;be&nbsp;loaded&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="8167743">//&nbsp;ParseTestData.</span><br>
<span class="lineno"></span><span class="keyword" id="8167761">type</span>&nbsp;<span class="ident" id="8167766">recordingConn</span>&nbsp;<span class="keyword" id="8167780">struct</span>&nbsp;<span class="op" id="8167787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167790">net</span><span class="op" id="8167793">.</span><span class="ident" id="8167794">Conn</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167800">sync</span><span class="op" id="8167804">.</span><span class="ident" id="8167805">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167812">flows</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8167820">[</span><span class="op" id="8167821">]</span><span class="op" id="8167822">[</span><span class="op" id="8167823">]</span><span class="builtintype" id="8167824">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167830">reading</span>&nbsp;<span class="builtintype" id="8167838">bool</span><br>
<span class="lineno"></span><span class="op" id="8167843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="keyword" id="8167846">func</span>&nbsp;<span class="op" id="8167851">(</span><span class="ident" id="8167852">r</span>&nbsp;<span class="op" id="8167854">*</span><span class="ident" id="8167855">recordingConn</span><span class="op" id="8167868">)</span>&nbsp;<span class="ident" id="8167870">Read</span><span class="op" id="8167874">(</span><span class="ident" id="8167875">b</span>&nbsp;<span class="op" id="8167877">[</span><span class="op" id="8167878">]</span><span class="builtintype" id="8167879">byte</span><span class="op" id="8167883">)</span>&nbsp;<span class="op" id="8167885">(</span><span class="ident" id="8167886">n</span>&nbsp;<span class="builtintype" id="8167888">int</span><span class="op" id="8167891">,</span>&nbsp;<span class="ident" id="8167893">err</span>&nbsp;<span class="builtintype" id="8167897">error</span><span class="op" id="8167902">)</span>&nbsp;<span class="op" id="8167904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8167907">if</span>&nbsp;<span class="ident" id="8167910">n</span><span class="op" id="8167911">,</span>&nbsp;<span class="ident" id="8167913">err</span>&nbsp;<span class="op" id="8167917">=</span>&nbsp;<span class="ident" id="8167919">r</span><span class="op" id="8167920">.</span><span class="ident" id="8167921">Conn</span><span class="op" id="8167925">.</span><span class="ident" id="8167926">Read</span><span class="op" id="8167930">(</span><span class="ident" id="8167931">b</span><span class="op" id="8167932">)</span><span class="op" id="8167933">;</span>&nbsp;<span class="ident" id="8167935">n</span>&nbsp;<span class="op" id="8167937">==</span>&nbsp;<span class="num" id="8167940">0</span>&nbsp;<span class="op" id="8167942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8167946">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8167954">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167957">b</span>&nbsp;<span class="op" id="8167959">=</span>&nbsp;<span class="ident" id="8167961">b</span><span class="op" id="8167962">[</span><span class="op" id="8167963">:</span><span class="ident" id="8167964">n</span><span class="op" id="8167965">]</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8167969">r</span><span class="op" id="8167970">.</span><span class="ident" id="8167971">Lock</span><span class="op" id="8167975">(</span><span class="op" id="8167976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8167979">defer</span>&nbsp;<span class="ident" id="8167985">r</span><span class="op" id="8167986">.</span><span class="ident" id="8167987">Unlock</span><span class="op" id="8167993">(</span><span class="op" id="8167994">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8167998">if</span>&nbsp;<span class="ident" id="8168001">l</span>&nbsp;<span class="op" id="8168003">:=</span>&nbsp;<span class="builtinfunc" id="8168006">len</span><span class="op" id="8168009">(</span><span class="ident" id="8168010">r</span><span class="op" id="8168011">.</span><span class="ident" id="8168012">flows</span><span class="op" id="8168017">)</span><span class="op" id="8168018">;</span>&nbsp;<span class="ident" id="8168020">l</span>&nbsp;<span class="op" id="8168022">==</span>&nbsp;<span class="num" id="8168025">0</span>&nbsp;<span class="op" id="8168027">||</span>&nbsp;<span class="op" id="8168030">!</span><span class="ident" id="8168031">r</span><span class="op" id="8168032">.</span><span class="ident" id="8168033">reading</span>&nbsp;<span class="op" id="8168041">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168045">buf</span>&nbsp;<span class="op" id="8168049">:=</span>&nbsp;<span class="builtinfunc" id="8168052">make</span><span class="op" id="8168056">(</span><span class="op" id="8168057">[</span><span class="op" id="8168058">]</span><span class="builtintype" id="8168059">byte</span><span class="op" id="8168063">,</span>&nbsp;<span class="builtinfunc" id="8168065">len</span><span class="op" id="8168068">(</span><span class="ident" id="8168069">b</span><span class="op" id="8168070">)</span><span class="op" id="8168071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8168075">copy</span><span class="op" id="8168079">(</span><span class="ident" id="8168080">buf</span><span class="op" id="8168083">,</span>&nbsp;<span class="ident" id="8168085">b</span><span class="op" id="8168086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168090">r</span><span class="op" id="8168091">.</span><span class="ident" id="8168092">flows</span>&nbsp;<span class="op" id="8168098">=</span>&nbsp;<span class="builtinfunc" id="8168100">append</span><span class="op" id="8168106">(</span><span class="ident" id="8168107">r</span><span class="op" id="8168108">.</span><span class="ident" id="8168109">flows</span><span class="op" id="8168114">,</span>&nbsp;<span class="ident" id="8168116">buf</span><span class="op" id="8168119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168122">}</span>&nbsp;<span class="keyword" id="8168124">else</span>&nbsp;<span class="op" id="8168129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168133">r</span><span class="op" id="8168134">.</span><span class="ident" id="8168135">flows</span><span class="op" id="8168140">[</span><span class="ident" id="8168141">l</span><span class="op" id="8168142">-</span><span class="num" id="8168143">1</span><span class="op" id="8168144">]</span>&nbsp;<span class="op" id="8168146">=</span>&nbsp;<span class="builtinfunc" id="8168148">append</span><span class="op" id="8168154">(</span><span class="ident" id="8168155">r</span><span class="op" id="8168156">.</span><span class="ident" id="8168157">flows</span><span class="op" id="8168162">[</span><span class="ident" id="8168163">l</span><span class="op" id="8168164">-</span><span class="num" id="8168165">1</span><span class="op" id="8168166">]</span><span class="op" id="8168167">,</span>&nbsp;<span class="ident" id="8168169">b</span><span class="op" id="8168170">[</span><span class="op" id="8168171">:</span><span class="ident" id="8168172">n</span><span class="op" id="8168173">]</span><span class="op" id="8168174">...</span><span class="op" id="8168177">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168183">r</span><span class="op" id="8168184">.</span><span class="ident" id="8168185">reading</span>&nbsp;<span class="op" id="8168193">=</span>&nbsp;<span class="builtintype" id="8168195">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168201">return</span><br>
<span class="lineno"></span><span class="op" id="8168208">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="8168211">func</span>&nbsp;<span class="op" id="8168216">(</span><span class="ident" id="8168217">r</span>&nbsp;<span class="op" id="8168219">*</span><span class="ident" id="8168220">recordingConn</span><span class="op" id="8168233">)</span>&nbsp;<span class="ident" id="8168235">Write</span><span class="op" id="8168240">(</span><span class="ident" id="8168241">b</span>&nbsp;<span class="op" id="8168243">[</span><span class="op" id="8168244">]</span><span class="builtintype" id="8168245">byte</span><span class="op" id="8168249">)</span>&nbsp;<span class="op" id="8168251">(</span><span class="ident" id="8168252">n</span>&nbsp;<span class="builtintype" id="8168254">int</span><span class="op" id="8168257">,</span>&nbsp;<span class="ident" id="8168259">err</span>&nbsp;<span class="builtintype" id="8168263">error</span><span class="op" id="8168268">)</span>&nbsp;<span class="op" id="8168270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168273">if</span>&nbsp;<span class="ident" id="8168276">n</span><span class="op" id="8168277">,</span>&nbsp;<span class="ident" id="8168279">err</span>&nbsp;<span class="op" id="8168283">=</span>&nbsp;<span class="ident" id="8168285">r</span><span class="op" id="8168286">.</span><span class="ident" id="8168287">Conn</span><span class="op" id="8168291">.</span><span class="ident" id="8168292">Write</span><span class="op" id="8168297">(</span><span class="ident" id="8168298">b</span><span class="op" id="8168299">)</span><span class="op" id="8168300">;</span>&nbsp;<span class="ident" id="8168302">n</span>&nbsp;<span class="op" id="8168304">==</span>&nbsp;<span class="num" id="8168307">0</span>&nbsp;<span class="op" id="8168309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168313">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168321">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168324">b</span>&nbsp;<span class="op" id="8168326">=</span>&nbsp;<span class="ident" id="8168328">b</span><span class="op" id="8168329">[</span><span class="op" id="8168330">:</span><span class="ident" id="8168331">n</span><span class="op" id="8168332">]</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168336">r</span><span class="op" id="8168337">.</span><span class="ident" id="8168338">Lock</span><span class="op" id="8168342">(</span><span class="op" id="8168343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168346">defer</span>&nbsp;<span class="ident" id="8168352">r</span><span class="op" id="8168353">.</span><span class="ident" id="8168354">Unlock</span><span class="op" id="8168360">(</span><span class="op" id="8168361">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168365">if</span>&nbsp;<span class="ident" id="8168368">l</span>&nbsp;<span class="op" id="8168370">:=</span>&nbsp;<span class="builtinfunc" id="8168373">len</span><span class="op" id="8168376">(</span><span class="ident" id="8168377">r</span><span class="op" id="8168378">.</span><span class="ident" id="8168379">flows</span><span class="op" id="8168384">)</span><span class="op" id="8168385">;</span>&nbsp;<span class="ident" id="8168387">l</span>&nbsp;<span class="op" id="8168389">==</span>&nbsp;<span class="num" id="8168392">0</span>&nbsp;<span class="op" id="8168394">||</span>&nbsp;<span class="ident" id="8168397">r</span><span class="op" id="8168398">.</span><span class="ident" id="8168399">reading</span>&nbsp;<span class="op" id="8168407">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168411">buf</span>&nbsp;<span class="op" id="8168415">:=</span>&nbsp;<span class="builtinfunc" id="8168418">make</span><span class="op" id="8168422">(</span><span class="op" id="8168423">[</span><span class="op" id="8168424">]</span><span class="builtintype" id="8168425">byte</span><span class="op" id="8168429">,</span>&nbsp;<span class="builtinfunc" id="8168431">len</span><span class="op" id="8168434">(</span><span class="ident" id="8168435">b</span><span class="op" id="8168436">)</span><span class="op" id="8168437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8168441">copy</span><span class="op" id="8168445">(</span><span class="ident" id="8168446">buf</span><span class="op" id="8168449">,</span>&nbsp;<span class="ident" id="8168451">b</span><span class="op" id="8168452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168456">r</span><span class="op" id="8168457">.</span><span class="ident" id="8168458">flows</span>&nbsp;<span class="op" id="8168464">=</span>&nbsp;<span class="builtinfunc" id="8168466">append</span><span class="op" id="8168472">(</span><span class="ident" id="8168473">r</span><span class="op" id="8168474">.</span><span class="ident" id="8168475">flows</span><span class="op" id="8168480">,</span>&nbsp;<span class="ident" id="8168482">buf</span><span class="op" id="8168485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168488">}</span>&nbsp;<span class="keyword" id="8168490">else</span>&nbsp;<span class="op" id="8168495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168499">r</span><span class="op" id="8168500">.</span><span class="ident" id="8168501">flows</span><span class="op" id="8168506">[</span><span class="ident" id="8168507">l</span><span class="op" id="8168508">-</span><span class="num" id="8168509">1</span><span class="op" id="8168510">]</span>&nbsp;<span class="op" id="8168512">=</span>&nbsp;<span class="builtinfunc" id="8168514">append</span><span class="op" id="8168520">(</span><span class="ident" id="8168521">r</span><span class="op" id="8168522">.</span><span class="ident" id="8168523">flows</span><span class="op" id="8168528">[</span><span class="ident" id="8168529">l</span><span class="op" id="8168530">-</span><span class="num" id="8168531">1</span><span class="op" id="8168532">]</span><span class="op" id="8168533">,</span>&nbsp;<span class="ident" id="8168535">b</span><span class="op" id="8168536">[</span><span class="op" id="8168537">:</span><span class="ident" id="8168538">n</span><span class="op" id="8168539">]</span><span class="op" id="8168540">...</span><span class="op" id="8168543">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168549">r</span><span class="op" id="8168550">.</span><span class="ident" id="8168551">reading</span>&nbsp;<span class="op" id="8168559">=</span>&nbsp;<span class="builtintype" id="8168561">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168568">return</span><br>
<span class="lineno"></span><span class="op" id="8168575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="comment" id="8168578">//&nbsp;WriteTo&nbsp;writes&nbsp;Go&nbsp;source&nbsp;code&nbsp;to&nbsp;w&nbsp;that&nbsp;contains&nbsp;the&nbsp;recorded&nbsp;traffic.</span><br>
<span class="lineno"></span><span class="keyword" id="8168652">func</span>&nbsp;<span class="op" id="8168657">(</span><span class="ident" id="8168658">r</span>&nbsp;<span class="op" id="8168660">*</span><span class="ident" id="8168661">recordingConn</span><span class="op" id="8168674">)</span>&nbsp;<span class="ident" id="8168676">WriteTo</span><span class="op" id="8168683">(</span><span class="ident" id="8168684">w</span>&nbsp;<span class="ident" id="8168686">io</span><span class="op" id="8168688">.</span><span class="ident" id="8168689">Writer</span><span class="op" id="8168695">)</span>&nbsp;<span class="op" id="8168697">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8168700">//&nbsp;TLS&nbsp;always&nbsp;starts&nbsp;with&nbsp;a&nbsp;client&nbsp;to&nbsp;server&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168752">clientToServer</span>&nbsp;<span class="op" id="8168767">:=</span>&nbsp;<span class="builtintype" id="8168770">true</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168777">for</span>&nbsp;<span class="ident" id="8168781">i</span><span class="op" id="8168782">,</span>&nbsp;<span class="ident" id="8168784">flow</span>&nbsp;<span class="op" id="8168789">:=</span>&nbsp;<span class="keyword" id="8168792">range</span>&nbsp;<span class="ident" id="8168798">r</span><span class="op" id="8168799">.</span><span class="ident" id="8168800">flows</span>&nbsp;<span class="op" id="8168806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168810">source</span><span class="op" id="8168816">,</span>&nbsp;<span class="ident" id="8168818">dest</span>&nbsp;<span class="op" id="8168823">:=</span>&nbsp;<span class="string" id="8168826">&#34;client&#34;</span><span class="op" id="8168834">,</span>&nbsp;<span class="string" id="8168836">&#34;server&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8168847">if</span>&nbsp;<span class="op" id="8168850">!</span><span class="ident" id="8168851">clientToServer</span>&nbsp;<span class="op" id="8168866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168871">source</span><span class="op" id="8168877">,</span>&nbsp;<span class="ident" id="8168879">dest</span>&nbsp;<span class="op" id="8168884">=</span>&nbsp;<span class="ident" id="8168886">dest</span><span class="op" id="8168890">,</span>&nbsp;<span class="ident" id="8168892">source</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8168901">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168905">fmt</span><span class="op" id="8168908">.</span><span class="ident" id="8168909">Fprintf</span><span class="op" id="8168916">(</span><span class="ident" id="8168917">w</span><span class="op" id="8168918">,</span>&nbsp;<span class="string" id="8168920">&#34;&gt;&gt;&gt;&nbsp;Flow&nbsp;%d&nbsp;(%s&nbsp;to&nbsp;%s)\n&#34;</span><span class="op" id="8168946">,</span>&nbsp;<span class="ident" id="8168948">i</span><span class="op" id="8168949">+</span><span class="num" id="8168950">1</span><span class="op" id="8168951">,</span>&nbsp;<span class="ident" id="8168953">source</span><span class="op" id="8168959">,</span>&nbsp;<span class="ident" id="8168961">dest</span><span class="op" id="8168965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168969">dumper</span>&nbsp;<span class="op" id="8168976">:=</span>&nbsp;<span class="ident" id="8168979">hex</span><span class="op" id="8168982">.</span><span class="ident" id="8168983">Dumper</span><span class="op" id="8168989">(</span><span class="ident" id="8168990">w</span><span class="op" id="8168991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8168995">dumper</span><span class="op" id="8169001">.</span><span class="ident" id="8169002">Write</span><span class="op" id="8169007">(</span><span class="ident" id="8169008">flow</span><span class="op" id="8169012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169016">dumper</span><span class="op" id="8169022">.</span><span class="ident" id="8169023">Close</span><span class="op" id="8169028">(</span><span class="op" id="8169029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169033">clientToServer</span>&nbsp;<span class="op" id="8169048">=</span>&nbsp;<span class="op" id="8169050">!</span><span class="ident" id="8169051">clientToServer</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169067">}</span><br>
<span class="lineno"></span><span class="op" id="8169069">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8169072">func</span>&nbsp;<span class="ident" id="8169077">parseTestData</span><span class="op" id="8169090">(</span><span class="ident" id="8169091">r</span>&nbsp;<span class="ident" id="8169093">io</span><span class="op" id="8169095">.</span><span class="ident" id="8169096">Reader</span><span class="op" id="8169102">)</span>&nbsp;<span class="op" id="8169104">(</span><span class="ident" id="8169105">flows</span>&nbsp;<span class="op" id="8169111">[</span><span class="op" id="8169112">]</span><span class="op" id="8169113">[</span><span class="op" id="8169114">]</span><span class="builtintype" id="8169115">byte</span><span class="op" id="8169119">,</span>&nbsp;<span class="ident" id="8169121">err</span>&nbsp;<span class="builtintype" id="8169125">error</span><span class="op" id="8169130">)</span>&nbsp;<span class="op" id="8169132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169135">var</span>&nbsp;<span class="ident" id="8169139">currentFlow</span>&nbsp;<span class="op" id="8169151">[</span><span class="op" id="8169152">]</span><span class="builtintype" id="8169153">byte</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169160">scanner</span>&nbsp;<span class="op" id="8169168">:=</span>&nbsp;<span class="ident" id="8169171">bufio</span><span class="op" id="8169176">.</span><span class="ident" id="8169177">NewScanner</span><span class="op" id="8169187">(</span><span class="ident" id="8169188">r</span><span class="op" id="8169189">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169192">for</span>&nbsp;<span class="ident" id="8169196">scanner</span><span class="op" id="8169203">.</span><span class="ident" id="8169204">Scan</span><span class="op" id="8169208">(</span><span class="op" id="8169209">)</span>&nbsp;<span class="op" id="8169211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169215">line</span>&nbsp;<span class="op" id="8169220">:=</span>&nbsp;<span class="ident" id="8169223">scanner</span><span class="op" id="8169230">.</span><span class="ident" id="8169231">Text</span><span class="op" id="8169235">(</span><span class="op" id="8169236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8169240">//&nbsp;If&nbsp;the&nbsp;line&nbsp;starts&nbsp;with&nbsp;&#34;&gt;&gt;&gt;&nbsp;&#34;&nbsp;then&nbsp;it&nbsp;marks&nbsp;the&nbsp;beginning</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8169304">//&nbsp;of&nbsp;a&nbsp;new&nbsp;flow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169324">if</span>&nbsp;<span class="ident" id="8169327">strings</span><span class="op" id="8169334">.</span><span class="ident" id="8169335">HasPrefix</span><span class="op" id="8169344">(</span><span class="ident" id="8169345">line</span><span class="op" id="8169349">,</span>&nbsp;<span class="string" id="8169351">&#34;&gt;&gt;&gt;&nbsp;&#34;</span><span class="op" id="8169357">)</span>&nbsp;<span class="op" id="8169359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169364">if</span>&nbsp;<span class="builtinfunc" id="8169367">len</span><span class="op" id="8169370">(</span><span class="ident" id="8169371">currentFlow</span><span class="op" id="8169382">)</span>&nbsp;<span class="op" id="8169384">&gt;</span>&nbsp;<span class="num" id="8169386">0</span>&nbsp;<span class="op" id="8169388">||</span>&nbsp;<span class="builtinfunc" id="8169391">len</span><span class="op" id="8169394">(</span><span class="ident" id="8169395">flows</span><span class="op" id="8169400">)</span>&nbsp;<span class="op" id="8169402">&gt;</span>&nbsp;<span class="num" id="8169404">0</span>&nbsp;<span class="op" id="8169406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169412">flows</span>&nbsp;<span class="op" id="8169418">=</span>&nbsp;<span class="builtinfunc" id="8169420">append</span><span class="op" id="8169426">(</span><span class="ident" id="8169427">flows</span><span class="op" id="8169432">,</span>&nbsp;<span class="ident" id="8169434">currentFlow</span><span class="op" id="8169445">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169451">currentFlow</span>&nbsp;<span class="op" id="8169463">=</span>&nbsp;<span class="ident" id="8169465">nil</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169477">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8169493">//&nbsp;Otherwise&nbsp;the&nbsp;line&nbsp;is&nbsp;a&nbsp;line&nbsp;of&nbsp;hex&nbsp;dump&nbsp;that&nbsp;looks&nbsp;like:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8169556">//&nbsp;00000170&nbsp;&nbsp;fc&nbsp;f5&nbsp;06&nbsp;bf&nbsp;(...)&nbsp;&nbsp;|.....X{&amp;?......!|</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8169609">//&nbsp;(Some&nbsp;bytes&nbsp;have&nbsp;been&nbsp;omitted&nbsp;from&nbsp;the&nbsp;middle&nbsp;section.)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169671">if</span>&nbsp;<span class="ident" id="8169674">i</span>&nbsp;<span class="op" id="8169676">:=</span>&nbsp;<span class="ident" id="8169679">strings</span><span class="op" id="8169686">.</span><span class="ident" id="8169687">IndexByte</span><span class="op" id="8169696">(</span><span class="ident" id="8169697">line</span><span class="op" id="8169701">,</span>&nbsp;<span class="string" id="8169703">&#39;&nbsp;&#39;</span><span class="op" id="8169706">)</span><span class="op" id="8169707">;</span>&nbsp;<span class="ident" id="8169709">i</span>&nbsp;<span class="op" id="8169711">&gt;=</span>&nbsp;<span class="num" id="8169714">0</span>&nbsp;<span class="op" id="8169716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169721">line</span>&nbsp;<span class="op" id="8169726">=</span>&nbsp;<span class="ident" id="8169728">line</span><span class="op" id="8169732">[</span><span class="ident" id="8169733">i</span><span class="op" id="8169734">:</span><span class="op" id="8169735">]</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169739">}</span>&nbsp;<span class="keyword" id="8169741">else</span>&nbsp;<span class="op" id="8169746">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169751">return</span>&nbsp;<span class="ident" id="8169758">nil</span><span class="op" id="8169761">,</span>&nbsp;<span class="ident" id="8169763">errors</span><span class="op" id="8169769">.</span><span class="ident" id="8169770">New</span><span class="op" id="8169773">(</span><span class="string" id="8169774">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8169793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169797">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169802">if</span>&nbsp;<span class="ident" id="8169805">i</span>&nbsp;<span class="op" id="8169807">:=</span>&nbsp;<span class="ident" id="8169810">strings</span><span class="op" id="8169817">.</span><span class="ident" id="8169818">IndexByte</span><span class="op" id="8169827">(</span><span class="ident" id="8169828">line</span><span class="op" id="8169832">,</span>&nbsp;<span class="string" id="8169834">&#39;|&#39;</span><span class="op" id="8169837">)</span><span class="op" id="8169838">;</span>&nbsp;<span class="ident" id="8169840">i</span>&nbsp;<span class="op" id="8169842">&gt;=</span>&nbsp;<span class="num" id="8169845">0</span>&nbsp;<span class="op" id="8169847">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169852">line</span>&nbsp;<span class="op" id="8169857">=</span>&nbsp;<span class="ident" id="8169859">line</span><span class="op" id="8169863">[</span><span class="op" id="8169864">:</span><span class="ident" id="8169865">i</span><span class="op" id="8169866">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169870">}</span>&nbsp;<span class="keyword" id="8169872">else</span>&nbsp;<span class="op" id="8169877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169882">return</span>&nbsp;<span class="ident" id="8169889">nil</span><span class="op" id="8169892">,</span>&nbsp;<span class="ident" id="8169894">errors</span><span class="op" id="8169900">.</span><span class="ident" id="8169901">New</span><span class="op" id="8169904">(</span><span class="string" id="8169905">&#34;invalid&nbsp;test&nbsp;data&#34;</span><span class="op" id="8169924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8169928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8169933">hexBytes</span>&nbsp;<span class="op" id="8169942">:=</span>&nbsp;<span class="ident" id="8169945">strings</span><span class="op" id="8169952">.</span><span class="ident" id="8169953">Fields</span><span class="op" id="8169959">(</span><span class="ident" id="8169960">line</span><span class="op" id="8169964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8169968">for</span>&nbsp;<span class="ident" id="8169972">_</span><span class="op" id="8169973">,</span>&nbsp;<span class="ident" id="8169975">hexByte</span>&nbsp;<span class="op" id="8169983">:=</span>&nbsp;<span class="keyword" id="8169986">range</span>&nbsp;<span class="ident" id="8169992">hexBytes</span>&nbsp;<span class="op" id="8170001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170006">val</span><span class="op" id="8170009">,</span>&nbsp;<span class="ident" id="8170011">err</span>&nbsp;<span class="op" id="8170015">:=</span>&nbsp;<span class="ident" id="8170018">strconv</span><span class="op" id="8170025">.</span><span class="ident" id="8170026">ParseUint</span><span class="op" id="8170035">(</span><span class="ident" id="8170036">hexByte</span><span class="op" id="8170043">,</span>&nbsp;<span class="num" id="8170045">16</span><span class="op" id="8170047">,</span>&nbsp;<span class="num" id="8170049">8</span><span class="op" id="8170050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170055">if</span>&nbsp;<span class="ident" id="8170058">err</span>&nbsp;<span class="op" id="8170062">!=</span>&nbsp;<span class="ident" id="8170065">nil</span>&nbsp;<span class="op" id="8170069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170075">return</span>&nbsp;<span class="ident" id="8170082">nil</span><span class="op" id="8170085">,</span>&nbsp;<span class="ident" id="8170087">errors</span><span class="op" id="8170093">.</span><span class="ident" id="8170094">New</span><span class="op" id="8170097">(</span><span class="string" id="8170098">&#34;invalid&nbsp;hex&nbsp;byte&nbsp;in&nbsp;test&nbsp;data:&nbsp;&#34;</span>&nbsp;<span class="op" id="8170132">+</span>&nbsp;<span class="ident" id="8170134">err</span><span class="op" id="8170137">.</span><span class="ident" id="8170138">Error</span><span class="op" id="8170143">(</span><span class="op" id="8170144">)</span><span class="op" id="8170145">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170150">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170155">currentFlow</span>&nbsp;<span class="op" id="8170167">=</span>&nbsp;<span class="builtinfunc" id="8170169">append</span><span class="op" id="8170175">(</span><span class="ident" id="8170176">currentFlow</span><span class="op" id="8170187">,</span>&nbsp;<span class="builtintype" id="8170189">byte</span><span class="op" id="8170193">(</span><span class="ident" id="8170194">val</span><span class="op" id="8170197">)</span><span class="op" id="8170198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170205">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170209">if</span>&nbsp;<span class="builtinfunc" id="8170212">len</span><span class="op" id="8170215">(</span><span class="ident" id="8170216">currentFlow</span><span class="op" id="8170227">)</span>&nbsp;<span class="op" id="8170229">&gt;</span>&nbsp;<span class="num" id="8170231">0</span>&nbsp;<span class="op" id="8170233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170237">flows</span>&nbsp;<span class="op" id="8170243">=</span>&nbsp;<span class="builtinfunc" id="8170245">append</span><span class="op" id="8170251">(</span><span class="ident" id="8170252">flows</span><span class="op" id="8170257">,</span>&nbsp;<span class="ident" id="8170259">currentFlow</span><span class="op" id="8170270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170273">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170277">return</span>&nbsp;<span class="ident" id="8170284">flows</span><span class="op" id="8170289">,</span>&nbsp;<span class="ident" id="8170291">nil</span><br>
<span class="lineno">155</span><span class="op" id="8170295">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8170298">//&nbsp;tempFile&nbsp;creates&nbsp;a&nbsp;temp&nbsp;file&nbsp;containing&nbsp;contents&nbsp;and&nbsp;returns&nbsp;its&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="8170372">func</span>&nbsp;<span class="ident" id="8170377">tempFile</span><span class="op" id="8170385">(</span><span class="ident" id="8170386">contents</span>&nbsp;<span class="builtintype" id="8170395">string</span><span class="op" id="8170401">)</span>&nbsp;<span class="builtintype" id="8170403">string</span>&nbsp;<span class="op" id="8170410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170413">file</span><span class="op" id="8170417">,</span>&nbsp;<span class="ident" id="8170419">err</span>&nbsp;<span class="op" id="8170423">:=</span>&nbsp;<span class="ident" id="8170426">ioutil</span><span class="op" id="8170432">.</span><span class="ident" id="8170433">TempFile</span><span class="op" id="8170441">(</span><span class="string" id="8170442">&#34;&#34;</span><span class="op" id="8170444">,</span>&nbsp;<span class="string" id="8170446">&#34;go-tls-test&#34;</span><span class="op" id="8170459">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170462">if</span>&nbsp;<span class="ident" id="8170465">err</span>&nbsp;<span class="op" id="8170469">!=</span>&nbsp;<span class="ident" id="8170472">nil</span>&nbsp;<span class="op" id="8170476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8170480">panic</span><span class="op" id="8170485">(</span><span class="string" id="8170486">&#34;failed&nbsp;to&nbsp;create&nbsp;temp&nbsp;file:&nbsp;&#34;</span>&nbsp;<span class="op" id="8170517">+</span>&nbsp;<span class="ident" id="8170519">err</span><span class="op" id="8170522">.</span><span class="ident" id="8170523">Error</span><span class="op" id="8170528">(</span><span class="op" id="8170529">)</span><span class="op" id="8170530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8170533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170536">path</span>&nbsp;<span class="op" id="8170541">:=</span>&nbsp;<span class="ident" id="8170544">file</span><span class="op" id="8170548">.</span><span class="ident" id="8170549">Name</span><span class="op" id="8170553">(</span><span class="op" id="8170554">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170557">file</span><span class="op" id="8170561">.</span><span class="ident" id="8170562">WriteString</span><span class="op" id="8170573">(</span><span class="ident" id="8170574">contents</span><span class="op" id="8170582">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8170585">file</span><span class="op" id="8170589">.</span><span class="ident" id="8170590">Close</span><span class="op" id="8170595">(</span><span class="op" id="8170596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8170599">return</span>&nbsp;<span class="ident" id="8170606">path</span><br>
<span class="lineno"></span><span class="op" id="8170611">}</span>
</div>
</body>
</html>
