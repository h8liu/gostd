<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/http/internal</h2>
<ul>
<li><a href="/gostd/net/http/internal/chunked.go.html">chunked.go</a></li>
<li><a href="/gostd/net/http/internal/chunked_test.go.html" class="current">chunked_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7069183">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7069238">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7069292">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7069343">package</span>&nbsp;<span class="ident" id="7069351">internal</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7069361">import</span>&nbsp;<span class="op" id="7069368">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069371">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069380">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069389">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069396">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069402">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069415">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7069426">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="7069436">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7069439">func</span>&nbsp;<span class="ident" id="7069444">TestChunk</span><span class="op" id="7069453">(</span><span class="ident" id="7069454">t</span>&nbsp;<span class="op" id="7069456">*</span><span class="ident" id="7069457">testing</span><span class="op" id="7069464">.</span><span class="ident" id="7069465">T</span><span class="op" id="7069466">)</span>&nbsp;<span class="op" id="7069468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069471">var</span>&nbsp;<span class="ident" id="7069475">b</span>&nbsp;<span class="ident" id="7069477">bytes</span><span class="op" id="7069482">.</span><span class="ident" id="7069483">Buffer</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069492">w</span>&nbsp;<span class="op" id="7069494">:=</span>&nbsp;<span class="ident" id="7069497">NewChunkedWriter</span><span class="op" id="7069513">(</span><span class="op" id="7069514">&amp;</span><span class="ident" id="7069515">b</span><span class="op" id="7069516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069519">const</span>&nbsp;<span class="ident" id="7069525">chunk1</span>&nbsp;<span class="op" id="7069532">=</span>&nbsp;<span class="string" id="7069534">&#34;hello,&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069545">const</span>&nbsp;<span class="ident" id="7069551">chunk2</span>&nbsp;<span class="op" id="7069558">=</span>&nbsp;<span class="string" id="7069560">&#34;world!&nbsp;0123456789abcdef&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069587">w</span><span class="op" id="7069588">.</span><span class="ident" id="7069589">Write</span><span class="op" id="7069594">(</span><span class="op" id="7069595">[</span><span class="op" id="7069596">]</span><span class="builtintype" id="7069597">byte</span><span class="op" id="7069601">(</span><span class="ident" id="7069602">chunk1</span><span class="op" id="7069608">)</span><span class="op" id="7069609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069612">w</span><span class="op" id="7069613">.</span><span class="ident" id="7069614">Write</span><span class="op" id="7069619">(</span><span class="op" id="7069620">[</span><span class="op" id="7069621">]</span><span class="builtintype" id="7069622">byte</span><span class="op" id="7069626">(</span><span class="ident" id="7069627">chunk2</span><span class="op" id="7069633">)</span><span class="op" id="7069634">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069637">w</span><span class="op" id="7069638">.</span><span class="ident" id="7069639">Close</span><span class="op" id="7069644">(</span><span class="op" id="7069645">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069649">if</span>&nbsp;<span class="ident" id="7069652">g</span><span class="op" id="7069653">,</span>&nbsp;<span class="ident" id="7069655">e</span>&nbsp;<span class="op" id="7069657">:=</span>&nbsp;<span class="ident" id="7069660">b</span><span class="op" id="7069661">.</span><span class="ident" id="7069662">String</span><span class="op" id="7069668">(</span><span class="op" id="7069669">)</span><span class="op" id="7069670">,</span>&nbsp;<span class="string" id="7069672">&#34;7\r\nhello,&nbsp;\r\n17\r\nworld!&nbsp;0123456789abcdef\r\n0\r\n&#34;</span><span class="op" id="7069728">;</span>&nbsp;<span class="ident" id="7069730">g</span>&nbsp;<span class="op" id="7069732">!=</span>&nbsp;<span class="ident" id="7069735">e</span>&nbsp;<span class="op" id="7069737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069741">t</span><span class="op" id="7069742">.</span><span class="ident" id="7069743">Fatalf</span><span class="op" id="7069749">(</span><span class="string" id="7069750">&#34;chunk&nbsp;writer&nbsp;wrote&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7069782">,</span>&nbsp;<span class="ident" id="7069784">g</span><span class="op" id="7069785">,</span>&nbsp;<span class="ident" id="7069787">e</span><span class="op" id="7069788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7069791">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069795">r</span>&nbsp;<span class="op" id="7069797">:=</span>&nbsp;<span class="ident" id="7069800">NewChunkedReader</span><span class="op" id="7069816">(</span><span class="op" id="7069817">&amp;</span><span class="ident" id="7069818">b</span><span class="op" id="7069819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069822">data</span><span class="op" id="7069826">,</span>&nbsp;<span class="ident" id="7069828">err</span>&nbsp;<span class="op" id="7069832">:=</span>&nbsp;<span class="ident" id="7069835">ioutil</span><span class="op" id="7069841">.</span><span class="ident" id="7069842">ReadAll</span><span class="op" id="7069849">(</span><span class="ident" id="7069850">r</span><span class="op" id="7069851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069854">if</span>&nbsp;<span class="ident" id="7069857">err</span>&nbsp;<span class="op" id="7069861">!=</span>&nbsp;<span class="ident" id="7069864">nil</span>&nbsp;<span class="op" id="7069868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069872">t</span><span class="op" id="7069873">.</span><span class="ident" id="7069874">Logf</span><span class="op" id="7069878">(</span><span class="string" id="7069879">`data:&nbsp;&#34;%s&#34;`</span><span class="op" id="7069891">,</span>&nbsp;<span class="ident" id="7069893">data</span><span class="op" id="7069897">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069901">t</span><span class="op" id="7069902">.</span><span class="ident" id="7069903">Fatalf</span><span class="op" id="7069909">(</span><span class="string" id="7069910">&#34;ReadAll&nbsp;from&nbsp;reader:&nbsp;%v&#34;</span><span class="op" id="7069935">,</span>&nbsp;<span class="ident" id="7069937">err</span><span class="op" id="7069940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7069943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7069946">if</span>&nbsp;<span class="ident" id="7069949">g</span><span class="op" id="7069950">,</span>&nbsp;<span class="ident" id="7069952">e</span>&nbsp;<span class="op" id="7069954">:=</span>&nbsp;<span class="builtintype" id="7069957">string</span><span class="op" id="7069963">(</span><span class="ident" id="7069964">data</span><span class="op" id="7069968">)</span><span class="op" id="7069969">,</span>&nbsp;<span class="ident" id="7069971">chunk1</span><span class="op" id="7069977">+</span><span class="ident" id="7069978">chunk2</span><span class="op" id="7069984">;</span>&nbsp;<span class="ident" id="7069986">g</span>&nbsp;<span class="op" id="7069988">!=</span>&nbsp;<span class="ident" id="7069991">e</span>&nbsp;<span class="op" id="7069993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7069997">t</span><span class="op" id="7069998">.</span><span class="ident" id="7069999">Errorf</span><span class="op" id="7070005">(</span><span class="string" id="7070006">&#34;chunk&nbsp;reader&nbsp;read&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7070037">,</span>&nbsp;<span class="ident" id="7070039">g</span><span class="op" id="7070040">,</span>&nbsp;<span class="ident" id="7070042">e</span><span class="op" id="7070043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070046">}</span><br>
<span class="lineno">40</span><span class="op" id="7070048">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7070051">func</span>&nbsp;<span class="ident" id="7070056">TestChunkReadMultiple</span><span class="op" id="7070077">(</span><span class="ident" id="7070078">t</span>&nbsp;<span class="op" id="7070080">*</span><span class="ident" id="7070081">testing</span><span class="op" id="7070088">.</span><span class="ident" id="7070089">T</span><span class="op" id="7070090">)</span>&nbsp;<span class="op" id="7070092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070095">//&nbsp;Bunch&nbsp;of&nbsp;small&nbsp;chunks,&nbsp;all&nbsp;read&nbsp;together.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070141">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7070145">var</span>&nbsp;<span class="ident" id="7070149">b</span>&nbsp;<span class="ident" id="7070151">bytes</span><span class="op" id="7070156">.</span><span class="ident" id="7070157">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070166">w</span>&nbsp;<span class="op" id="7070168">:=</span>&nbsp;<span class="ident" id="7070171">NewChunkedWriter</span><span class="op" id="7070187">(</span><span class="op" id="7070188">&amp;</span><span class="ident" id="7070189">b</span><span class="op" id="7070190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070194">w</span><span class="op" id="7070195">.</span><span class="ident" id="7070196">Write</span><span class="op" id="7070201">(</span><span class="op" id="7070202">[</span><span class="op" id="7070203">]</span><span class="builtintype" id="7070204">byte</span><span class="op" id="7070208">(</span><span class="string" id="7070209">&#34;foo&#34;</span><span class="op" id="7070214">)</span><span class="op" id="7070215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070219">w</span><span class="op" id="7070220">.</span><span class="ident" id="7070221">Write</span><span class="op" id="7070226">(</span><span class="op" id="7070227">[</span><span class="op" id="7070228">]</span><span class="builtintype" id="7070229">byte</span><span class="op" id="7070233">(</span><span class="string" id="7070234">&#34;bar&#34;</span><span class="op" id="7070239">)</span><span class="op" id="7070240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070244">w</span><span class="op" id="7070245">.</span><span class="ident" id="7070246">Close</span><span class="op" id="7070251">(</span><span class="op" id="7070252">)</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070257">r</span>&nbsp;<span class="op" id="7070259">:=</span>&nbsp;<span class="ident" id="7070262">NewChunkedReader</span><span class="op" id="7070278">(</span><span class="op" id="7070279">&amp;</span><span class="ident" id="7070280">b</span><span class="op" id="7070281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070285">buf</span>&nbsp;<span class="op" id="7070289">:=</span>&nbsp;<span class="builtinfunc" id="7070292">make</span><span class="op" id="7070296">(</span><span class="op" id="7070297">[</span><span class="op" id="7070298">]</span><span class="builtintype" id="7070299">byte</span><span class="op" id="7070303">,</span>&nbsp;<span class="num" id="7070305">10</span><span class="op" id="7070307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070311">n</span><span class="op" id="7070312">,</span>&nbsp;<span class="ident" id="7070314">err</span>&nbsp;<span class="op" id="7070318">:=</span>&nbsp;<span class="ident" id="7070321">r</span><span class="op" id="7070322">.</span><span class="ident" id="7070323">Read</span><span class="op" id="7070327">(</span><span class="ident" id="7070328">buf</span><span class="op" id="7070331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7070335">if</span>&nbsp;<span class="ident" id="7070338">n</span>&nbsp;<span class="op" id="7070340">!=</span>&nbsp;<span class="num" id="7070343">6</span>&nbsp;<span class="op" id="7070345">||</span>&nbsp;<span class="ident" id="7070348">err</span>&nbsp;<span class="op" id="7070352">!=</span>&nbsp;<span class="ident" id="7070355">io</span><span class="op" id="7070357">.</span><span class="ident" id="7070358">EOF</span>&nbsp;<span class="op" id="7070362">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070367">t</span><span class="op" id="7070368">.</span><span class="ident" id="7070369">Errorf</span><span class="op" id="7070375">(</span><span class="string" id="7070376">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;6,&nbsp;EOF&#34;</span><span class="op" id="7070404">,</span>&nbsp;<span class="ident" id="7070406">n</span><span class="op" id="7070407">,</span>&nbsp;<span class="ident" id="7070409">err</span><span class="op" id="7070412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070416">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070420">buf</span>&nbsp;<span class="op" id="7070424">=</span>&nbsp;<span class="ident" id="7070426">buf</span><span class="op" id="7070429">[</span><span class="op" id="7070430">:</span><span class="ident" id="7070431">n</span><span class="op" id="7070432">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7070436">if</span>&nbsp;<span class="builtintype" id="7070439">string</span><span class="op" id="7070445">(</span><span class="ident" id="7070446">buf</span><span class="op" id="7070449">)</span>&nbsp;<span class="op" id="7070451">!=</span>&nbsp;<span class="string" id="7070454">&#34;foobar&#34;</span>&nbsp;<span class="op" id="7070463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070468">t</span><span class="op" id="7070469">.</span><span class="ident" id="7070470">Errorf</span><span class="op" id="7070476">(</span><span class="string" id="7070477">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7070497">,</span>&nbsp;<span class="ident" id="7070499">buf</span><span class="op" id="7070502">,</span>&nbsp;<span class="string" id="7070504">&#34;foobar&#34;</span><span class="op" id="7070512">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070523">//&nbsp;One&nbsp;big&nbsp;chunk&nbsp;followed&nbsp;by&nbsp;a&nbsp;little&nbsp;chunk,&nbsp;but&nbsp;the&nbsp;small&nbsp;bufio.Reader&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070601">//&nbsp;should&nbsp;prevent&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;from&nbsp;being&nbsp;read.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7070661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7070665">var</span>&nbsp;<span class="ident" id="7070669">b</span>&nbsp;<span class="ident" id="7070671">bytes</span><span class="op" id="7070676">.</span><span class="ident" id="7070677">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7070686">w</span>&nbsp;<span class="op" id="7070688">:=</span>&nbsp;<span class="ident" id="7070691">NewChunkedWriter</span><span class="op" id="7070707">(</span><span class="op" id="7070708">&amp;</span><span class="ident" id="7070709">b</span><span class="op" id="7070710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070714">//&nbsp;fillBufChunk&nbsp;is&nbsp;11&nbsp;bytes&nbsp;+&nbsp;3&nbsp;bytes&nbsp;header&nbsp;+&nbsp;2&nbsp;bytes&nbsp;footer&nbsp;=&nbsp;16&nbsp;bytes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070790">//&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;bufio&nbsp;ReaderSize&nbsp;below&nbsp;(the&nbsp;minimum),&nbsp;so&nbsp;even</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070857">//&nbsp;though&nbsp;we&#39;re&nbsp;going&nbsp;to&nbsp;try&nbsp;to&nbsp;Read&nbsp;with&nbsp;a&nbsp;buffer&nbsp;larger&nbsp;enough&nbsp;to&nbsp;also</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7070932">//&nbsp;receive&nbsp;&#34;foo&#34;,&nbsp;the&nbsp;second&nbsp;chunk&nbsp;header&nbsp;won&#39;t&nbsp;be&nbsp;read&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7070995">const</span>&nbsp;<span class="ident" id="7071001">fillBufChunk</span>&nbsp;<span class="op" id="7071014">=</span>&nbsp;<span class="string" id="7071016">&#34;0123456789a&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071032">const</span>&nbsp;<span class="ident" id="7071038">shortChunk</span>&nbsp;<span class="op" id="7071049">=</span>&nbsp;<span class="string" id="7071051">&#34;foo&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071059">w</span><span class="op" id="7071060">.</span><span class="ident" id="7071061">Write</span><span class="op" id="7071066">(</span><span class="op" id="7071067">[</span><span class="op" id="7071068">]</span><span class="builtintype" id="7071069">byte</span><span class="op" id="7071073">(</span><span class="ident" id="7071074">fillBufChunk</span><span class="op" id="7071086">)</span><span class="op" id="7071087">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071091">w</span><span class="op" id="7071092">.</span><span class="ident" id="7071093">Write</span><span class="op" id="7071098">(</span><span class="op" id="7071099">[</span><span class="op" id="7071100">]</span><span class="builtintype" id="7071101">byte</span><span class="op" id="7071105">(</span><span class="ident" id="7071106">shortChunk</span><span class="op" id="7071116">)</span><span class="op" id="7071117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071121">w</span><span class="op" id="7071122">.</span><span class="ident" id="7071123">Close</span><span class="op" id="7071128">(</span><span class="op" id="7071129">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071134">r</span>&nbsp;<span class="op" id="7071136">:=</span>&nbsp;<span class="ident" id="7071139">NewChunkedReader</span><span class="op" id="7071155">(</span><span class="ident" id="7071156">bufio</span><span class="op" id="7071161">.</span><span class="ident" id="7071162">NewReaderSize</span><span class="op" id="7071175">(</span><span class="op" id="7071176">&amp;</span><span class="ident" id="7071177">b</span><span class="op" id="7071178">,</span>&nbsp;<span class="num" id="7071180">16</span><span class="op" id="7071182">)</span><span class="op" id="7071183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071187">buf</span>&nbsp;<span class="op" id="7071191">:=</span>&nbsp;<span class="builtinfunc" id="7071194">make</span><span class="op" id="7071198">(</span><span class="op" id="7071199">[</span><span class="op" id="7071200">]</span><span class="builtintype" id="7071201">byte</span><span class="op" id="7071205">,</span>&nbsp;<span class="builtinfunc" id="7071207">len</span><span class="op" id="7071210">(</span><span class="ident" id="7071211">fillBufChunk</span><span class="op" id="7071223">)</span><span class="op" id="7071224">+</span><span class="builtinfunc" id="7071225">len</span><span class="op" id="7071228">(</span><span class="ident" id="7071229">shortChunk</span><span class="op" id="7071239">)</span><span class="op" id="7071240">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071244">n</span><span class="op" id="7071245">,</span>&nbsp;<span class="ident" id="7071247">err</span>&nbsp;<span class="op" id="7071251">:=</span>&nbsp;<span class="ident" id="7071254">r</span><span class="op" id="7071255">.</span><span class="ident" id="7071256">Read</span><span class="op" id="7071260">(</span><span class="ident" id="7071261">buf</span><span class="op" id="7071264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071268">if</span>&nbsp;<span class="ident" id="7071271">n</span>&nbsp;<span class="op" id="7071273">!=</span>&nbsp;<span class="builtinfunc" id="7071276">len</span><span class="op" id="7071279">(</span><span class="ident" id="7071280">fillBufChunk</span><span class="op" id="7071292">)</span>&nbsp;<span class="op" id="7071294">||</span>&nbsp;<span class="ident" id="7071297">err</span>&nbsp;<span class="op" id="7071301">!=</span>&nbsp;<span class="ident" id="7071304">nil</span>&nbsp;<span class="op" id="7071308">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071313">t</span><span class="op" id="7071314">.</span><span class="ident" id="7071315">Errorf</span><span class="op" id="7071321">(</span><span class="string" id="7071322">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7071351">,</span>&nbsp;<span class="ident" id="7071353">n</span><span class="op" id="7071354">,</span>&nbsp;<span class="ident" id="7071356">err</span><span class="op" id="7071359">,</span>&nbsp;<span class="builtinfunc" id="7071361">len</span><span class="op" id="7071364">(</span><span class="ident" id="7071365">fillBufChunk</span><span class="op" id="7071377">)</span><span class="op" id="7071378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071386">buf</span>&nbsp;<span class="op" id="7071390">=</span>&nbsp;<span class="ident" id="7071392">buf</span><span class="op" id="7071395">[</span><span class="op" id="7071396">:</span><span class="ident" id="7071397">n</span><span class="op" id="7071398">]</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071402">if</span>&nbsp;<span class="builtintype" id="7071405">string</span><span class="op" id="7071411">(</span><span class="ident" id="7071412">buf</span><span class="op" id="7071415">)</span>&nbsp;<span class="op" id="7071417">!=</span>&nbsp;<span class="ident" id="7071420">fillBufChunk</span>&nbsp;<span class="op" id="7071433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071438">t</span><span class="op" id="7071439">.</span><span class="ident" id="7071440">Errorf</span><span class="op" id="7071446">(</span><span class="string" id="7071447">&#34;Read&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7071467">,</span>&nbsp;<span class="ident" id="7071469">buf</span><span class="op" id="7071472">,</span>&nbsp;<span class="ident" id="7071474">fillBufChunk</span><span class="op" id="7071486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071495">n</span><span class="op" id="7071496">,</span>&nbsp;<span class="ident" id="7071498">err</span>&nbsp;<span class="op" id="7071502">=</span>&nbsp;<span class="ident" id="7071504">r</span><span class="op" id="7071505">.</span><span class="ident" id="7071506">Read</span><span class="op" id="7071510">(</span><span class="ident" id="7071511">buf</span><span class="op" id="7071514">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071518">if</span>&nbsp;<span class="ident" id="7071521">n</span>&nbsp;<span class="op" id="7071523">!=</span>&nbsp;<span class="builtinfunc" id="7071526">len</span><span class="op" id="7071529">(</span><span class="ident" id="7071530">shortChunk</span><span class="op" id="7071540">)</span>&nbsp;<span class="op" id="7071542">||</span>&nbsp;<span class="ident" id="7071545">err</span>&nbsp;<span class="op" id="7071549">!=</span>&nbsp;<span class="ident" id="7071552">io</span><span class="op" id="7071554">.</span><span class="ident" id="7071555">EOF</span>&nbsp;<span class="op" id="7071559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071564">t</span><span class="op" id="7071565">.</span><span class="ident" id="7071566">Errorf</span><span class="op" id="7071572">(</span><span class="string" id="7071573">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;EOF&#34;</span><span class="op" id="7071602">,</span>&nbsp;<span class="ident" id="7071604">n</span><span class="op" id="7071605">,</span>&nbsp;<span class="ident" id="7071607">err</span><span class="op" id="7071610">,</span>&nbsp;<span class="builtinfunc" id="7071612">len</span><span class="op" id="7071615">(</span><span class="ident" id="7071616">shortChunk</span><span class="op" id="7071626">)</span><span class="op" id="7071627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071631">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7071638">//&nbsp;And&nbsp;test&nbsp;that&nbsp;we&nbsp;see&nbsp;an&nbsp;EOF&nbsp;chunk,&nbsp;even&nbsp;though&nbsp;our&nbsp;buffer&nbsp;is&nbsp;already&nbsp;full:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071721">r</span>&nbsp;<span class="op" id="7071723">:=</span>&nbsp;<span class="ident" id="7071726">NewChunkedReader</span><span class="op" id="7071742">(</span><span class="ident" id="7071743">bufio</span><span class="op" id="7071748">.</span><span class="ident" id="7071749">NewReader</span><span class="op" id="7071758">(</span><span class="ident" id="7071759">strings</span><span class="op" id="7071766">.</span><span class="ident" id="7071767">NewReader</span><span class="op" id="7071776">(</span><span class="string" id="7071777">&#34;3\r\nfoo\r\n0\r\n&#34;</span><span class="op" id="7071796">)</span><span class="op" id="7071797">)</span><span class="op" id="7071798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071802">buf</span>&nbsp;<span class="op" id="7071806">:=</span>&nbsp;<span class="builtinfunc" id="7071809">make</span><span class="op" id="7071813">(</span><span class="op" id="7071814">[</span><span class="op" id="7071815">]</span><span class="builtintype" id="7071816">byte</span><span class="op" id="7071820">,</span>&nbsp;<span class="num" id="7071822">3</span><span class="op" id="7071823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071827">n</span><span class="op" id="7071828">,</span>&nbsp;<span class="ident" id="7071830">err</span>&nbsp;<span class="op" id="7071834">:=</span>&nbsp;<span class="ident" id="7071837">r</span><span class="op" id="7071838">.</span><span class="ident" id="7071839">Read</span><span class="op" id="7071843">(</span><span class="ident" id="7071844">buf</span><span class="op" id="7071847">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071851">if</span>&nbsp;<span class="ident" id="7071854">n</span>&nbsp;<span class="op" id="7071856">!=</span>&nbsp;<span class="num" id="7071859">3</span>&nbsp;<span class="op" id="7071861">||</span>&nbsp;<span class="ident" id="7071864">err</span>&nbsp;<span class="op" id="7071868">!=</span>&nbsp;<span class="ident" id="7071871">io</span><span class="op" id="7071873">.</span><span class="ident" id="7071874">EOF</span>&nbsp;<span class="op" id="7071878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071883">t</span><span class="op" id="7071884">.</span><span class="ident" id="7071885">Errorf</span><span class="op" id="7071891">(</span><span class="string" id="7071892">&#34;Read&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;3,&nbsp;EOF&#34;</span><span class="op" id="7071920">,</span>&nbsp;<span class="ident" id="7071922">n</span><span class="op" id="7071923">,</span>&nbsp;<span class="ident" id="7071925">err</span><span class="op" id="7071928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7071932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7071936">if</span>&nbsp;<span class="builtintype" id="7071939">string</span><span class="op" id="7071945">(</span><span class="ident" id="7071946">buf</span><span class="op" id="7071949">)</span>&nbsp;<span class="op" id="7071951">!=</span>&nbsp;<span class="string" id="7071954">&#34;foo&#34;</span>&nbsp;<span class="op" id="7071960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7071965">t</span><span class="op" id="7071966">.</span><span class="ident" id="7071967">Errorf</span><span class="op" id="7071973">(</span><span class="string" id="7071974">&#34;buf&nbsp;=&nbsp;%q;&nbsp;want&nbsp;foo&#34;</span><span class="op" id="7071994">,</span>&nbsp;<span class="ident" id="7071996">buf</span><span class="op" id="7071999">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072003">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072006">}</span><br>
<span class="lineno"></span><span class="op" id="7072008">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7072011">func</span>&nbsp;<span class="ident" id="7072016">TestChunkReaderAllocs</span><span class="op" id="7072037">(</span><span class="ident" id="7072038">t</span>&nbsp;<span class="op" id="7072040">*</span><span class="ident" id="7072041">testing</span><span class="op" id="7072048">.</span><span class="ident" id="7072049">T</span><span class="op" id="7072050">)</span>&nbsp;<span class="op" id="7072052">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072055">if</span>&nbsp;<span class="ident" id="7072058">testing</span><span class="op" id="7072065">.</span><span class="ident" id="7072066">Short</span><span class="op" id="7072071">(</span><span class="op" id="7072072">)</span>&nbsp;<span class="op" id="7072074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072078">t</span><span class="op" id="7072079">.</span><span class="ident" id="7072080">Skip</span><span class="op" id="7072084">(</span><span class="string" id="7072085">&#34;skipping&nbsp;in&nbsp;short&nbsp;mode&#34;</span><span class="op" id="7072109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072115">var</span>&nbsp;<span class="ident" id="7072119">buf</span>&nbsp;<span class="ident" id="7072123">bytes</span><span class="op" id="7072128">.</span><span class="ident" id="7072129">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072137">w</span>&nbsp;<span class="op" id="7072139">:=</span>&nbsp;<span class="ident" id="7072142">NewChunkedWriter</span><span class="op" id="7072158">(</span><span class="op" id="7072159">&amp;</span><span class="ident" id="7072160">buf</span><span class="op" id="7072163">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072166">a</span><span class="op" id="7072167">,</span>&nbsp;<span class="ident" id="7072169">b</span><span class="op" id="7072170">,</span>&nbsp;<span class="ident" id="7072172">c</span>&nbsp;<span class="op" id="7072174">:=</span>&nbsp;<span class="op" id="7072177">[</span><span class="op" id="7072178">]</span><span class="builtintype" id="7072179">byte</span><span class="op" id="7072183">(</span><span class="string" id="7072184">&#34;aaaaaa&#34;</span><span class="op" id="7072192">)</span><span class="op" id="7072193">,</span>&nbsp;<span class="op" id="7072195">[</span><span class="op" id="7072196">]</span><span class="builtintype" id="7072197">byte</span><span class="op" id="7072201">(</span><span class="string" id="7072202">&#34;bbbbbbbbbbbb&#34;</span><span class="op" id="7072216">)</span><span class="op" id="7072217">,</span>&nbsp;<span class="op" id="7072219">[</span><span class="op" id="7072220">]</span><span class="builtintype" id="7072221">byte</span><span class="op" id="7072225">(</span><span class="string" id="7072226">&#34;cccccccccccccccccccccccc&#34;</span><span class="op" id="7072252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072255">w</span><span class="op" id="7072256">.</span><span class="ident" id="7072257">Write</span><span class="op" id="7072262">(</span><span class="ident" id="7072263">a</span><span class="op" id="7072264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072267">w</span><span class="op" id="7072268">.</span><span class="ident" id="7072269">Write</span><span class="op" id="7072274">(</span><span class="ident" id="7072275">b</span><span class="op" id="7072276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072279">w</span><span class="op" id="7072280">.</span><span class="ident" id="7072281">Write</span><span class="op" id="7072286">(</span><span class="ident" id="7072287">c</span><span class="op" id="7072288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072291">w</span><span class="op" id="7072292">.</span><span class="ident" id="7072293">Close</span><span class="op" id="7072298">(</span><span class="op" id="7072299">)</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072303">readBuf</span>&nbsp;<span class="op" id="7072311">:=</span>&nbsp;<span class="builtinfunc" id="7072314">make</span><span class="op" id="7072318">(</span><span class="op" id="7072319">[</span><span class="op" id="7072320">]</span><span class="builtintype" id="7072321">byte</span><span class="op" id="7072325">,</span>&nbsp;<span class="builtinfunc" id="7072327">len</span><span class="op" id="7072330">(</span><span class="ident" id="7072331">a</span><span class="op" id="7072332">)</span><span class="op" id="7072333">+</span><span class="builtinfunc" id="7072334">len</span><span class="op" id="7072337">(</span><span class="ident" id="7072338">b</span><span class="op" id="7072339">)</span><span class="op" id="7072340">+</span><span class="builtinfunc" id="7072341">len</span><span class="op" id="7072344">(</span><span class="ident" id="7072345">c</span><span class="op" id="7072346">)</span><span class="op" id="7072347">+</span><span class="num" id="7072348">1</span><span class="op" id="7072349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072352">byter</span>&nbsp;<span class="op" id="7072358">:=</span>&nbsp;<span class="ident" id="7072361">bytes</span><span class="op" id="7072366">.</span><span class="ident" id="7072367">NewReader</span><span class="op" id="7072376">(</span><span class="ident" id="7072377">buf</span><span class="op" id="7072380">.</span><span class="ident" id="7072381">Bytes</span><span class="op" id="7072386">(</span><span class="op" id="7072387">)</span><span class="op" id="7072388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072391">bufr</span>&nbsp;<span class="op" id="7072396">:=</span>&nbsp;<span class="ident" id="7072399">bufio</span><span class="op" id="7072404">.</span><span class="ident" id="7072405">NewReader</span><span class="op" id="7072414">(</span><span class="ident" id="7072415">byter</span><span class="op" id="7072420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072423">mallocs</span>&nbsp;<span class="op" id="7072431">:=</span>&nbsp;<span class="ident" id="7072434">testing</span><span class="op" id="7072441">.</span><span class="ident" id="7072442">AllocsPerRun</span><span class="op" id="7072454">(</span><span class="num" id="7072455">100</span><span class="op" id="7072458">,</span>&nbsp;<span class="keyword" id="7072460">func</span><span class="op" id="7072464">(</span><span class="op" id="7072465">)</span>&nbsp;<span class="op" id="7072467">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072471">byter</span><span class="op" id="7072476">.</span><span class="ident" id="7072477">Seek</span><span class="op" id="7072481">(</span><span class="num" id="7072482">0</span><span class="op" id="7072483">,</span>&nbsp;<span class="num" id="7072485">0</span><span class="op" id="7072486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072490">bufr</span><span class="op" id="7072494">.</span><span class="ident" id="7072495">Reset</span><span class="op" id="7072500">(</span><span class="ident" id="7072501">byter</span><span class="op" id="7072506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072510">r</span>&nbsp;<span class="op" id="7072512">:=</span>&nbsp;<span class="ident" id="7072515">NewChunkedReader</span><span class="op" id="7072531">(</span><span class="ident" id="7072532">bufr</span><span class="op" id="7072536">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072540">n</span><span class="op" id="7072541">,</span>&nbsp;<span class="ident" id="7072543">err</span>&nbsp;<span class="op" id="7072547">:=</span>&nbsp;<span class="ident" id="7072550">io</span><span class="op" id="7072552">.</span><span class="ident" id="7072553">ReadFull</span><span class="op" id="7072561">(</span><span class="ident" id="7072562">r</span><span class="op" id="7072563">,</span>&nbsp;<span class="ident" id="7072565">readBuf</span><span class="op" id="7072572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072576">if</span>&nbsp;<span class="ident" id="7072579">n</span>&nbsp;<span class="op" id="7072581">!=</span>&nbsp;<span class="builtinfunc" id="7072584">len</span><span class="op" id="7072587">(</span><span class="ident" id="7072588">readBuf</span><span class="op" id="7072595">)</span><span class="op" id="7072596">-</span><span class="num" id="7072597">1</span>&nbsp;<span class="op" id="7072599">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072604">t</span><span class="op" id="7072605">.</span><span class="ident" id="7072606">Fatalf</span><span class="op" id="7072612">(</span><span class="string" id="7072613">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7072637">,</span>&nbsp;<span class="ident" id="7072639">n</span><span class="op" id="7072640">,</span>&nbsp;<span class="builtinfunc" id="7072642">len</span><span class="op" id="7072645">(</span><span class="ident" id="7072646">readBuf</span><span class="op" id="7072653">)</span><span class="op" id="7072654">-</span><span class="num" id="7072655">1</span><span class="op" id="7072656">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072664">if</span>&nbsp;<span class="ident" id="7072667">err</span>&nbsp;<span class="op" id="7072671">!=</span>&nbsp;<span class="ident" id="7072674">io</span><span class="op" id="7072676">.</span><span class="ident" id="7072677">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="7072694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072699">t</span><span class="op" id="7072700">.</span><span class="ident" id="7072701">Fatalf</span><span class="op" id="7072707">(</span><span class="string" id="7072708">&#34;read&nbsp;error&nbsp;=&nbsp;%v;&nbsp;want&nbsp;ErrUnexpectedEOF&#34;</span><span class="op" id="7072748">,</span>&nbsp;<span class="ident" id="7072750">err</span><span class="op" id="7072753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072757">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072760">}</span><span class="op" id="7072761">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072764">if</span>&nbsp;<span class="ident" id="7072767">mallocs</span>&nbsp;<span class="op" id="7072775">&gt;</span>&nbsp;<span class="num" id="7072777">1.5</span>&nbsp;<span class="op" id="7072781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072785">t</span><span class="op" id="7072786">.</span><span class="ident" id="7072787">Errorf</span><span class="op" id="7072793">(</span><span class="string" id="7072794">&#34;mallocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;1&#34;</span><span class="op" id="7072816">,</span>&nbsp;<span class="ident" id="7072818">mallocs</span><span class="op" id="7072825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7072828">}</span><br>
<span class="lineno"></span><span class="op" id="7072830">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="7072833">func</span>&nbsp;<span class="ident" id="7072838">TestParseHexUint</span><span class="op" id="7072854">(</span><span class="ident" id="7072855">t</span>&nbsp;<span class="op" id="7072857">*</span><span class="ident" id="7072858">testing</span><span class="op" id="7072865">.</span><span class="ident" id="7072866">T</span><span class="op" id="7072867">)</span>&nbsp;<span class="op" id="7072869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072872">for</span>&nbsp;<span class="ident" id="7072876">i</span>&nbsp;<span class="op" id="7072878">:=</span>&nbsp;<span class="ident" id="7072881">uint64</span><span class="op" id="7072887">(</span><span class="num" id="7072888">0</span><span class="op" id="7072889">)</span><span class="op" id="7072890">;</span>&nbsp;<span class="ident" id="7072892">i</span>&nbsp;<span class="op" id="7072894">&lt;=</span>&nbsp;<span class="num" id="7072897">1234</span><span class="op" id="7072901">;</span>&nbsp;<span class="ident" id="7072903">i</span><span class="op" id="7072904">++</span>&nbsp;<span class="op" id="7072907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072911">line</span>&nbsp;<span class="op" id="7072916">:=</span>&nbsp;<span class="op" id="7072919">[</span><span class="op" id="7072920">]</span><span class="builtintype" id="7072921">byte</span><span class="op" id="7072925">(</span><span class="ident" id="7072926">fmt</span><span class="op" id="7072929">.</span><span class="ident" id="7072930">Sprintf</span><span class="op" id="7072937">(</span><span class="string" id="7072938">&#34;%x&#34;</span><span class="op" id="7072942">,</span>&nbsp;<span class="ident" id="7072944">i</span><span class="op" id="7072945">)</span><span class="op" id="7072946">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7072950">got</span><span class="op" id="7072953">,</span>&nbsp;<span class="ident" id="7072955">err</span>&nbsp;<span class="op" id="7072959">:=</span>&nbsp;<span class="ident" id="7072962">parseHexUint</span><span class="op" id="7072974">(</span><span class="ident" id="7072975">line</span><span class="op" id="7072979">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7072983">if</span>&nbsp;<span class="ident" id="7072986">err</span>&nbsp;<span class="op" id="7072990">!=</span>&nbsp;<span class="ident" id="7072993">nil</span>&nbsp;<span class="op" id="7072997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073002">t</span><span class="op" id="7073003">.</span><span class="ident" id="7073004">Fatalf</span><span class="op" id="7073010">(</span><span class="string" id="7073011">&#34;on&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7073022">,</span>&nbsp;<span class="ident" id="7073024">i</span><span class="op" id="7073025">,</span>&nbsp;<span class="ident" id="7073027">err</span><span class="op" id="7073030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073034">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073038">if</span>&nbsp;<span class="ident" id="7073041">got</span>&nbsp;<span class="op" id="7073045">!=</span>&nbsp;<span class="ident" id="7073048">i</span>&nbsp;<span class="op" id="7073050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073055">t</span><span class="op" id="7073056">.</span><span class="ident" id="7073057">Errorf</span><span class="op" id="7073063">(</span><span class="string" id="7073064">&#34;for&nbsp;input&nbsp;%q&nbsp;=&nbsp;%d;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7073092">,</span>&nbsp;<span class="ident" id="7073094">line</span><span class="op" id="7073098">,</span>&nbsp;<span class="ident" id="7073100">got</span><span class="op" id="7073103">,</span>&nbsp;<span class="ident" id="7073105">i</span><span class="op" id="7073106">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073116">_</span><span class="op" id="7073117">,</span>&nbsp;<span class="ident" id="7073119">err</span>&nbsp;<span class="op" id="7073123">:=</span>&nbsp;<span class="ident" id="7073126">parseHexUint</span><span class="op" id="7073138">(</span><span class="op" id="7073139">[</span><span class="op" id="7073140">]</span><span class="builtintype" id="7073141">byte</span><span class="op" id="7073145">(</span><span class="string" id="7073146">&#34;bogus&#34;</span><span class="op" id="7073153">)</span><span class="op" id="7073154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7073157">if</span>&nbsp;<span class="ident" id="7073160">err</span>&nbsp;<span class="op" id="7073164">==</span>&nbsp;<span class="ident" id="7073167">nil</span>&nbsp;<span class="op" id="7073171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7073175">t</span><span class="op" id="7073176">.</span><span class="ident" id="7073177">Error</span><span class="op" id="7073182">(</span><span class="string" id="7073183">&#34;expected&nbsp;error&nbsp;on&nbsp;bogus&nbsp;input&#34;</span><span class="op" id="7073214">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7073217">}</span><br>
<span class="lineno"></span><span class="op" id="7073219">}</span>
</div>
</body>
</html>
