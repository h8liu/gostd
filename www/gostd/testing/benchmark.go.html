<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing</h2>
<ul>
<li><a href="/gostd/testing/allocs.go.html">allocs.go</a></li>
<li><a href="/gostd/testing/allocs_test.go.html">allocs_test.go</a></li>
<li><a href="/gostd/testing/benchmark.go.html" class="current">benchmark.go</a></li>
<li><a href="/gostd/testing/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/testing/cover.go.html">cover.go</a></li>
<li><a href="/gostd/testing/example.go.html">example.go</a></li>
<li><a href="/gostd/testing/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/testing/testing.go.html">testing.go</a></li>
<li><a href="/gostd/testing/testing_test.go.html">testing_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5449921">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5449976">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5450030">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5450081">package</span>&nbsp;<span class="ident" id="5450089">testing</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450098">import</span>&nbsp;<span class="op" id="5450105">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450108">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450116">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450123">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450129">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450140">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450148">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5450163">&#34;time&#34;</span><br>
<span class="lineno">15</span><span class="op" id="5450170">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5450173">var</span>&nbsp;<span class="ident" id="5450177">matchBenchmarks</span>&nbsp;<span class="op" id="5450193">=</span>&nbsp;<span class="ident" id="5450195"><a href="/gostd/testing/benchmark.go.html#5450108">flag</a></span><span class="op" id="5450199">.</span><span class="ident" id="5450200"><a href="/gostd/flag/flag.go.html#3954331">String</a></span><span class="op" id="5450206">(</span><span class="string" id="5450207">&#34;test.bench&#34;</span><span class="op" id="5450219">,</span>&nbsp;<span class="string" id="5450221">&#34;&#34;</span><span class="op" id="5450223">,</span>&nbsp;<span class="string" id="5450225">&#34;regular&nbsp;expression&nbsp;to&nbsp;select&nbsp;benchmarks&nbsp;to&nbsp;run&#34;</span><span class="op" id="5450273">)</span><br>
<span class="lineno"></span><span class="keyword" id="5450275">var</span>&nbsp;<span class="ident" id="5450279">benchTime</span>&nbsp;<span class="op" id="5450289">=</span>&nbsp;<span class="ident" id="5450291"><a href="/gostd/testing/benchmark.go.html#5450108">flag</a></span><span class="op" id="5450295">.</span><span class="ident" id="5450296"><a href="/gostd/flag/flag.go.html#3957175">Duration</a></span><span class="op" id="5450304">(</span><span class="string" id="5450305">&#34;test.benchtime&#34;</span><span class="op" id="5450321">,</span>&nbsp;<span class="num" id="5450323">1</span><span class="op" id="5450324">*</span><span class="ident" id="5450325"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5450329">.</span><span class="ident" id="5450330"><a href="/gostd/time/time.go.html#2734862">Second</a></span><span class="op" id="5450336">,</span>&nbsp;<span class="string" id="5450338">&#34;approximate&nbsp;run&nbsp;time&nbsp;for&nbsp;each&nbsp;benchmark&#34;</span><span class="op" id="5450379">)</span><br>
<span class="lineno"></span><span class="keyword" id="5450381">var</span>&nbsp;<span class="ident" id="5450385">benchmarkMemory</span>&nbsp;<span class="op" id="5450401">=</span>&nbsp;<span class="ident" id="5450403"><a href="/gostd/testing/benchmark.go.html#5450108">flag</a></span><span class="op" id="5450407">.</span><span class="ident" id="5450408"><a href="/gostd/flag/flag.go.html#3948389">Bool</a></span><span class="op" id="5450412">(</span><span class="string" id="5450413">&#34;test.benchmem&#34;</span><span class="op" id="5450428">,</span>&nbsp;<span class="builtintype" id="5450430">false</span><span class="op" id="5450435">,</span>&nbsp;<span class="string" id="5450437">&#34;print&nbsp;memory&nbsp;allocations&nbsp;for&nbsp;benchmarks&#34;</span><span class="op" id="5450478">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5450481">//&nbsp;Global&nbsp;lock&nbsp;to&nbsp;ensure&nbsp;only&nbsp;one&nbsp;benchmark&nbsp;runs&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="5450541">var</span>&nbsp;<span class="ident" id="5450545">benchmarkLock</span>&nbsp;<span class="ident" id="5450559"><a href="/gostd/testing/benchmark.go.html#5450140">sync</a></span><span class="op" id="5450563">.</span><span class="ident" id="5450564"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450571">//&nbsp;Used&nbsp;for&nbsp;every&nbsp;benchmark&nbsp;for&nbsp;measuring&nbsp;memory.</span><br>
<span class="lineno">25</span><span class="keyword" id="5450621">var</span>&nbsp;<span class="ident" id="5450625">memStats</span>&nbsp;<span class="ident" id="5450634"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5450641">.</span><span class="ident" id="5450642"><a href="/gostd/runtime/mem.go.html#1613431">MemStats</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450652">//&nbsp;An&nbsp;internal&nbsp;type&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5450741">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5450770">type</span>&nbsp;<span class="ident" id="5450775">InternalBenchmark</span>&nbsp;<span class="keyword" id="5450793">struct</span>&nbsp;<span class="op" id="5450800">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450803">Name</span>&nbsp;<span class="builtintype" id="5450808">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450816">F</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5450821">func</span><span class="op" id="5450825">(</span><span class="ident" id="5450826">b</span>&nbsp;<span class="op" id="5450828">*</span><span class="ident" id="5450829"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5450830">)</span><br>
<span class="lineno"></span><span class="op" id="5450832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5450835">//&nbsp;B&nbsp;is&nbsp;a&nbsp;type&nbsp;passed&nbsp;to&nbsp;Benchmark&nbsp;functions&nbsp;to&nbsp;manage&nbsp;benchmark</span><br>
<span class="lineno">35</span><span class="comment" id="5450900">//&nbsp;timing&nbsp;and&nbsp;to&nbsp;specify&nbsp;the&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5450958">type</span>&nbsp;<span class="ident" id="5450963">B</span>&nbsp;<span class="keyword" id="5450965">struct</span>&nbsp;<span class="op" id="5450972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450975"><a href="/gostd/testing/testing.go.html#5474828">common</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5450983">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5451000">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451005">previousN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5451022">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451036">//&nbsp;number&nbsp;of&nbsp;iterations&nbsp;in&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451081">previousDuration</span>&nbsp;<span class="ident" id="5451098"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5451102">.</span><span class="ident" id="5451103"><a href="/gostd/time/time.go.html#2734212">Duration</a></span>&nbsp;<span class="comment" id="5451112">//&nbsp;total&nbsp;duration&nbsp;of&nbsp;the&nbsp;previous&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451151">benchmark</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451168"><a href="/gostd/testing/benchmark.go.html#5450775">InternalBenchmark</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451187">bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5451204">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451211">timerOn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5451228">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451234">showAllocResult</span>&nbsp;&nbsp;<span class="builtintype" id="5451251">bool</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451257">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451274"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451291">parallelism</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5451308">int</span>&nbsp;<span class="comment" id="5451312">//&nbsp;RunParallel&nbsp;creates&nbsp;parallelism*GOMAXPROCS&nbsp;goroutines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451370">//&nbsp;The&nbsp;initial&nbsp;states&nbsp;of&nbsp;memStats.Mallocs&nbsp;and&nbsp;memStats.TotalAlloc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451438">startAllocs</span>&nbsp;<span class="builtintype" id="5451450">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451458">startBytes</span>&nbsp;&nbsp;<span class="builtintype" id="5451470">uint64</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5451478">//&nbsp;The&nbsp;net&nbsp;total&nbsp;of&nbsp;this&nbsp;test&nbsp;after&nbsp;being&nbsp;run.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451526">netAllocs</span>&nbsp;<span class="builtintype" id="5451536">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451544">netBytes</span>&nbsp;&nbsp;<span class="builtintype" id="5451554">uint64</span><br>
<span class="lineno"></span><span class="op" id="5451561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="5451564">//&nbsp;StartTimer&nbsp;starts&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;function&nbsp;is&nbsp;called&nbsp;automatically</span><br>
<span class="lineno"></span><span class="comment" id="5451639">//&nbsp;before&nbsp;a&nbsp;benchmark&nbsp;starts,&nbsp;but&nbsp;it&nbsp;can&nbsp;also&nbsp;used&nbsp;to&nbsp;resume&nbsp;timing&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="5451713">//&nbsp;a&nbsp;call&nbsp;to&nbsp;StopTimer.</span><br>
<span class="lineno"></span><span class="keyword" id="5451737">func</span>&nbsp;<span class="op" id="5451742">(</span><span class="ident" id="5451743">b</span>&nbsp;<span class="op" id="5451745">*</span><span class="ident" id="5451746"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5451747">)</span>&nbsp;<span class="ident" id="5451749">StartTimer</span><span class="op" id="5451759">(</span><span class="op" id="5451760">)</span>&nbsp;<span class="op" id="5451762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5451765">if</span>&nbsp;<span class="op" id="5451768">!</span><span class="ident" id="5451769"><a href="/gostd/testing/benchmark.go.html#5451743">b</a></span><span class="op" id="5451770">.</span><span class="ident" id="5451771"><a href="/gostd/testing/benchmark.go.html#5451211">timerOn</a></span>&nbsp;<span class="op" id="5451779">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451783"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5451790">.</span><span class="ident" id="5451791"><a href="/gostd/runtime/mem.go.html#1615506">ReadMemStats</a></span><span class="op" id="5451803">(</span><span class="op" id="5451804">&amp;</span><span class="ident" id="5451805"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5451813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451817"><a href="/gostd/testing/benchmark.go.html#5451743">b</a></span><span class="op" id="5451818">.</span><span class="ident" id="5451819"><a href="/gostd/testing/benchmark.go.html#5451438">startAllocs</a></span>&nbsp;<span class="op" id="5451831">=</span>&nbsp;<span class="ident" id="5451833"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5451841">.</span><span class="ident" id="5451842"><a href="/gostd/runtime/mem.go.html#1613702">Mallocs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451852"><a href="/gostd/testing/benchmark.go.html#5451743">b</a></span><span class="op" id="5451853">.</span><span class="ident" id="5451854"><a href="/gostd/testing/benchmark.go.html#5451458">startBytes</a></span>&nbsp;<span class="op" id="5451865">=</span>&nbsp;<span class="ident" id="5451867"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5451875">.</span><span class="ident" id="5451876"><a href="/gostd/runtime/mem.go.html#1613529">TotalAlloc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451889"><a href="/gostd/testing/benchmark.go.html#5451743">b</a></span><span class="op" id="5451890">.</span><span class="ident" id="5451891"><a href="/gostd/testing/testing.go.html#5475095">start</a></span>&nbsp;<span class="op" id="5451897">=</span>&nbsp;<span class="ident" id="5451899"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5451903">.</span><span class="ident" id="5451904"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="5451907">(</span><span class="op" id="5451908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5451912"><a href="/gostd/testing/benchmark.go.html#5451743">b</a></span><span class="op" id="5451913">.</span><span class="ident" id="5451914"><a href="/gostd/testing/benchmark.go.html#5451211">timerOn</a></span>&nbsp;<span class="op" id="5451922">=</span>&nbsp;<span class="builtintype" id="5451924">true</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5451930">}</span><br>
<span class="lineno"></span><span class="op" id="5451932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5451935">//&nbsp;StopTimer&nbsp;stops&nbsp;timing&nbsp;a&nbsp;test.&nbsp;&nbsp;This&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;pause&nbsp;the&nbsp;timer</span><br>
<span class="lineno"></span><span class="comment" id="5452006">//&nbsp;while&nbsp;performing&nbsp;complex&nbsp;initialization&nbsp;that&nbsp;you&nbsp;don&#39;t</span><br>
<span class="lineno">70</span><span class="comment" id="5452064">//&nbsp;want&nbsp;to&nbsp;measure.</span><br>
<span class="lineno"></span><span class="keyword" id="5452084">func</span>&nbsp;<span class="op" id="5452089">(</span><span class="ident" id="5452090">b</span>&nbsp;<span class="op" id="5452092">*</span><span class="ident" id="5452093"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5452094">)</span>&nbsp;<span class="ident" id="5452096">StopTimer</span><span class="op" id="5452105">(</span><span class="op" id="5452106">)</span>&nbsp;<span class="op" id="5452108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452111">if</span>&nbsp;<span class="ident" id="5452114"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452115">.</span><span class="ident" id="5452116"><a href="/gostd/testing/benchmark.go.html#5451211">timerOn</a></span>&nbsp;<span class="op" id="5452124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452128"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452129">.</span><span class="ident" id="5452130"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span>&nbsp;<span class="op" id="5452139">+=</span>&nbsp;<span class="ident" id="5452142"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5452146">.</span><span class="ident" id="5452147"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="5452150">(</span><span class="op" id="5452151">)</span><span class="op" id="5452152">.</span><span class="ident" id="5452153"><a href="/gostd/time/time.go.html#2739063">Sub</a></span><span class="op" id="5452156">(</span><span class="ident" id="5452157"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452158">.</span><span class="ident" id="5452159"><a href="/gostd/testing/testing.go.html#5475095">start</a></span><span class="op" id="5452164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452168"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5452175">.</span><span class="ident" id="5452176"><a href="/gostd/runtime/mem.go.html#1615506">ReadMemStats</a></span><span class="op" id="5452188">(</span><span class="op" id="5452189">&amp;</span><span class="ident" id="5452190"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452198">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452202"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452203">.</span><span class="ident" id="5452204"><a href="/gostd/testing/benchmark.go.html#5451526">netAllocs</a></span>&nbsp;<span class="op" id="5452214">+=</span>&nbsp;<span class="ident" id="5452217"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452225">.</span><span class="ident" id="5452226"><a href="/gostd/runtime/mem.go.html#1613702">Mallocs</a></span>&nbsp;<span class="op" id="5452234">-</span>&nbsp;<span class="ident" id="5452236"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452237">.</span><span class="ident" id="5452238"><a href="/gostd/testing/benchmark.go.html#5451438">startAllocs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452252"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452253">.</span><span class="ident" id="5452254"><a href="/gostd/testing/benchmark.go.html#5451544">netBytes</a></span>&nbsp;<span class="op" id="5452263">+=</span>&nbsp;<span class="ident" id="5452266"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452274">.</span><span class="ident" id="5452275"><a href="/gostd/runtime/mem.go.html#1613529">TotalAlloc</a></span>&nbsp;<span class="op" id="5452286">-</span>&nbsp;<span class="ident" id="5452288"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452289">.</span><span class="ident" id="5452290"><a href="/gostd/testing/benchmark.go.html#5451458">startBytes</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452303"><a href="/gostd/testing/benchmark.go.html#5452090">b</a></span><span class="op" id="5452304">.</span><span class="ident" id="5452305"><a href="/gostd/testing/benchmark.go.html#5451211">timerOn</a></span>&nbsp;<span class="op" id="5452313">=</span>&nbsp;<span class="builtintype" id="5452315">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452322">}</span><br>
<span class="lineno"></span><span class="op" id="5452324">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="5452327">//&nbsp;ResetTimer&nbsp;zeros&nbsp;the&nbsp;elapsed&nbsp;benchmark&nbsp;time&nbsp;and&nbsp;memory&nbsp;allocation&nbsp;counters.</span><br>
<span class="lineno"></span><span class="comment" id="5452406">//&nbsp;It&nbsp;does&nbsp;not&nbsp;affect&nbsp;whether&nbsp;the&nbsp;timer&nbsp;is&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="5452458">func</span>&nbsp;<span class="op" id="5452463">(</span><span class="ident" id="5452464">b</span>&nbsp;<span class="op" id="5452466">*</span><span class="ident" id="5452467"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5452468">)</span>&nbsp;<span class="ident" id="5452470">ResetTimer</span><span class="op" id="5452480">(</span><span class="op" id="5452481">)</span>&nbsp;<span class="op" id="5452483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5452486">if</span>&nbsp;<span class="ident" id="5452489"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452490">.</span><span class="ident" id="5452491"><a href="/gostd/testing/benchmark.go.html#5451211">timerOn</a></span>&nbsp;<span class="op" id="5452499">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452503"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5452510">.</span><span class="ident" id="5452511"><a href="/gostd/runtime/mem.go.html#1615506">ReadMemStats</a></span><span class="op" id="5452523">(</span><span class="op" id="5452524">&amp;</span><span class="ident" id="5452525"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452537"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452538">.</span><span class="ident" id="5452539"><a href="/gostd/testing/benchmark.go.html#5451438">startAllocs</a></span>&nbsp;<span class="op" id="5452551">=</span>&nbsp;<span class="ident" id="5452553"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452561">.</span><span class="ident" id="5452562"><a href="/gostd/runtime/mem.go.html#1613702">Mallocs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452572"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452573">.</span><span class="ident" id="5452574"><a href="/gostd/testing/benchmark.go.html#5451458">startBytes</a></span>&nbsp;<span class="op" id="5452585">=</span>&nbsp;<span class="ident" id="5452587"><a href="/gostd/testing/benchmark.go.html#5450625">memStats</a></span><span class="op" id="5452595">.</span><span class="ident" id="5452596"><a href="/gostd/runtime/mem.go.html#1613529">TotalAlloc</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452609"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452610">.</span><span class="ident" id="5452611"><a href="/gostd/testing/testing.go.html#5475095">start</a></span>&nbsp;<span class="op" id="5452617">=</span>&nbsp;<span class="ident" id="5452619"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5452623">.</span><span class="ident" id="5452624"><a href="/gostd/time/time.go.html#2743088">Now</a></span><span class="op" id="5452627">(</span><span class="op" id="5452628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5452631">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452634"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452635">.</span><span class="ident" id="5452636"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span>&nbsp;<span class="op" id="5452645">=</span>&nbsp;<span class="num" id="5452647">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452650"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452651">.</span><span class="ident" id="5452652"><a href="/gostd/testing/benchmark.go.html#5451526">netAllocs</a></span>&nbsp;<span class="op" id="5452662">=</span>&nbsp;<span class="num" id="5452664">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5452667"><a href="/gostd/testing/benchmark.go.html#5452464">b</a></span><span class="op" id="5452668">.</span><span class="ident" id="5452669"><a href="/gostd/testing/benchmark.go.html#5451544">netBytes</a></span>&nbsp;<span class="op" id="5452678">=</span>&nbsp;<span class="num" id="5452680">0</span><br>
<span class="lineno"></span><span class="op" id="5452682">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="5452685">//&nbsp;SetBytes&nbsp;records&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;processed&nbsp;in&nbsp;a&nbsp;single&nbsp;operation.</span><br>
<span class="lineno"></span><span class="comment" id="5452758">//&nbsp;If&nbsp;this&nbsp;is&nbsp;called,&nbsp;the&nbsp;benchmark&nbsp;will&nbsp;report&nbsp;ns/op&nbsp;and&nbsp;MB/s.</span><br>
<span class="lineno"></span><span class="keyword" id="5452822">func</span>&nbsp;<span class="op" id="5452827">(</span><span class="ident" id="5452828">b</span>&nbsp;<span class="op" id="5452830">*</span><span class="ident" id="5452831"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5452832">)</span>&nbsp;<span class="ident" id="5452834">SetBytes</span><span class="op" id="5452842">(</span><span class="ident" id="5452843">n</span>&nbsp;<span class="builtintype" id="5452845">int64</span><span class="op" id="5452850">)</span>&nbsp;<span class="op" id="5452852">{</span>&nbsp;<span class="ident" id="5452854"><a href="/gostd/testing/benchmark.go.html#5452828">b</a></span><span class="op" id="5452855">.</span><span class="ident" id="5452856"><a href="/gostd/testing/benchmark.go.html#5451187">bytes</a></span>&nbsp;<span class="op" id="5452862">=</span>&nbsp;<span class="ident" id="5452864"><a href="/gostd/testing/benchmark.go.html#5452843">n</a></span>&nbsp;<span class="op" id="5452866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5452869">//&nbsp;ReportAllocs&nbsp;enables&nbsp;malloc&nbsp;statistics&nbsp;for&nbsp;this&nbsp;benchmark.</span><br>
<span class="lineno">100</span><span class="comment" id="5452931">//&nbsp;It&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;setting&nbsp;-test.benchmem,&nbsp;but&nbsp;it&nbsp;only&nbsp;affects&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5453002">//&nbsp;benchmark&nbsp;function&nbsp;that&nbsp;calls&nbsp;ReportAllocs.</span><br>
<span class="lineno"></span><span class="keyword" id="5453049">func</span>&nbsp;<span class="op" id="5453054">(</span><span class="ident" id="5453055">b</span>&nbsp;<span class="op" id="5453057">*</span><span class="ident" id="5453058"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5453059">)</span>&nbsp;<span class="ident" id="5453061">ReportAllocs</span><span class="op" id="5453073">(</span><span class="op" id="5453074">)</span>&nbsp;<span class="op" id="5453076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453079"><a href="/gostd/testing/benchmark.go.html#5453055">b</a></span><span class="op" id="5453080">.</span><span class="ident" id="5453081"><a href="/gostd/testing/benchmark.go.html#5451234">showAllocResult</a></span>&nbsp;<span class="op" id="5453097">=</span>&nbsp;<span class="builtintype" id="5453099">true</span><br>
<span class="lineno"></span><span class="op" id="5453104">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="keyword" id="5453107">func</span>&nbsp;<span class="op" id="5453112">(</span><span class="ident" id="5453113">b</span>&nbsp;<span class="op" id="5453115">*</span><span class="ident" id="5453116"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5453117">)</span>&nbsp;<span class="ident" id="5453119">nsPerOp</span><span class="op" id="5453126">(</span><span class="op" id="5453127">)</span>&nbsp;<span class="builtintype" id="5453129">int64</span>&nbsp;<span class="op" id="5453135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453138">if</span>&nbsp;<span class="ident" id="5453141"><a href="/gostd/testing/benchmark.go.html#5453113">b</a></span><span class="op" id="5453142">.</span><span class="ident" id="5453143"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span>&nbsp;<span class="op" id="5453145">&lt;=</span>&nbsp;<span class="num" id="5453148">0</span>&nbsp;<span class="op" id="5453150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453154">return</span>&nbsp;<span class="num" id="5453161">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453164">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453167">return</span>&nbsp;<span class="ident" id="5453174"><a href="/gostd/testing/benchmark.go.html#5453113">b</a></span><span class="op" id="5453175">.</span><span class="ident" id="5453176"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span><span class="op" id="5453184">.</span><span class="ident" id="5453185"><a href="/gostd/time/time.go.html#2737484">Nanoseconds</a></span><span class="op" id="5453196">(</span><span class="op" id="5453197">)</span>&nbsp;<span class="op" id="5453199">/</span>&nbsp;<span class="builtintype" id="5453201">int64</span><span class="op" id="5453206">(</span><span class="ident" id="5453207"><a href="/gostd/testing/benchmark.go.html#5453113">b</a></span><span class="op" id="5453208">.</span><span class="ident" id="5453209"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="5453210">)</span><br>
<span class="lineno"></span><span class="op" id="5453212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453215">//&nbsp;runN&nbsp;runs&nbsp;a&nbsp;single&nbsp;benchmark&nbsp;for&nbsp;the&nbsp;specified&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span><span class="keyword" id="5453287">func</span>&nbsp;<span class="op" id="5453292">(</span><span class="ident" id="5453293">b</span>&nbsp;<span class="op" id="5453295">*</span><span class="ident" id="5453296"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5453297">)</span>&nbsp;<span class="ident" id="5453299">runN</span><span class="op" id="5453303">(</span><span class="ident" id="5453304">n</span>&nbsp;<span class="builtintype" id="5453306">int</span><span class="op" id="5453309">)</span>&nbsp;<span class="op" id="5453311">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453314"><a href="/gostd/testing/benchmark.go.html#5450545">benchmarkLock</a></span><span class="op" id="5453327">.</span><span class="ident" id="5453328"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="5453332">(</span><span class="op" id="5453333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453336">defer</span>&nbsp;<span class="ident" id="5453342"><a href="/gostd/testing/benchmark.go.html#5450545">benchmarkLock</a></span><span class="op" id="5453355">.</span><span class="ident" id="5453356"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="5453362">(</span><span class="op" id="5453363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453366">//&nbsp;Try&nbsp;to&nbsp;get&nbsp;a&nbsp;comparable&nbsp;environment&nbsp;for&nbsp;each&nbsp;run</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453419">//&nbsp;by&nbsp;clearing&nbsp;garbage&nbsp;from&nbsp;previous&nbsp;runs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453463"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5453470">.</span><span class="ident" id="5453471"><a href="/gostd/runtime/malloc.go.html#1602269">GC</a></span><span class="op" id="5453473">(</span><span class="op" id="5453474">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453477"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453478">.</span><span class="ident" id="5453479"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span>&nbsp;<span class="op" id="5453481">=</span>&nbsp;<span class="ident" id="5453483"><a href="/gostd/testing/benchmark.go.html#5453304">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453486"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453487">.</span><span class="ident" id="5453488"><a href="/gostd/testing/benchmark.go.html#5451291">parallelism</a></span>&nbsp;<span class="op" id="5453500">=</span>&nbsp;<span class="num" id="5453502">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453505"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453506">.</span><span class="ident" id="5453507"><a href="/gostd/testing/benchmark.go.html#5452470">ResetTimer</a></span><span class="op" id="5453517">(</span><span class="op" id="5453518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453521"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453522">.</span><span class="ident" id="5453523"><a href="/gostd/testing/benchmark.go.html#5451749">StartTimer</a></span><span class="op" id="5453533">(</span><span class="op" id="5453534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453537"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453538">.</span><span class="ident" id="5453539"><a href="/gostd/testing/benchmark.go.html#5451151">benchmark</a></span><span class="op" id="5453548">.</span><span class="ident" id="5453549"><a href="/gostd/testing/benchmark.go.html#5450816">F</a></span><span class="op" id="5453550">(</span><span class="ident" id="5453551"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453552">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453555"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453556">.</span><span class="ident" id="5453557"><a href="/gostd/testing/benchmark.go.html#5452096">StopTimer</a></span><span class="op" id="5453566">(</span><span class="op" id="5453567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453570"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453571">.</span><span class="ident" id="5453572"><a href="/gostd/testing/benchmark.go.html#5451005">previousN</a></span>&nbsp;<span class="op" id="5453582">=</span>&nbsp;<span class="ident" id="5453584"><a href="/gostd/testing/benchmark.go.html#5453304">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453587"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453588">.</span><span class="ident" id="5453589"><a href="/gostd/testing/benchmark.go.html#5451081">previousDuration</a></span>&nbsp;<span class="op" id="5453606">=</span>&nbsp;<span class="ident" id="5453608"><a href="/gostd/testing/benchmark.go.html#5453293">b</a></span><span class="op" id="5453609">.</span><span class="ident" id="5453610"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span><br>
<span class="lineno"></span><span class="op" id="5453619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5453622">func</span>&nbsp;<span class="ident" id="5453627">min</span><span class="op" id="5453630">(</span><span class="ident" id="5453631">x</span><span class="op" id="5453632">,</span>&nbsp;<span class="ident" id="5453634">y</span>&nbsp;<span class="builtintype" id="5453636">int</span><span class="op" id="5453639">)</span>&nbsp;<span class="builtintype" id="5453641">int</span>&nbsp;<span class="op" id="5453645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453648">if</span>&nbsp;<span class="ident" id="5453651"><a href="/gostd/testing/benchmark.go.html#5453631">x</a></span>&nbsp;<span class="op" id="5453653">&gt;</span>&nbsp;<span class="ident" id="5453655"><a href="/gostd/testing/benchmark.go.html#5453634">y</a></span>&nbsp;<span class="op" id="5453657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453661">return</span>&nbsp;<span class="ident" id="5453668"><a href="/gostd/testing/benchmark.go.html#5453634">y</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453671">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453674">return</span>&nbsp;<span class="ident" id="5453681"><a href="/gostd/testing/benchmark.go.html#5453631">x</a></span><br>
<span class="lineno">135</span><span class="op" id="5453683">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5453686">func</span>&nbsp;<span class="ident" id="5453691">max</span><span class="op" id="5453694">(</span><span class="ident" id="5453695">x</span><span class="op" id="5453696">,</span>&nbsp;<span class="ident" id="5453698">y</span>&nbsp;<span class="builtintype" id="5453700">int</span><span class="op" id="5453703">)</span>&nbsp;<span class="builtintype" id="5453705">int</span>&nbsp;<span class="op" id="5453709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453712">if</span>&nbsp;<span class="ident" id="5453715"><a href="/gostd/testing/benchmark.go.html#5453695">x</a></span>&nbsp;<span class="op" id="5453717">&lt;</span>&nbsp;<span class="ident" id="5453719"><a href="/gostd/testing/benchmark.go.html#5453698">y</a></span>&nbsp;<span class="op" id="5453721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453725">return</span>&nbsp;<span class="ident" id="5453732"><a href="/gostd/testing/benchmark.go.html#5453698">y</a></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453735">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453738">return</span>&nbsp;<span class="ident" id="5453745"><a href="/gostd/testing/benchmark.go.html#5453695">x</a></span><br>
<span class="lineno"></span><span class="op" id="5453747">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5453750">//&nbsp;roundDown10&nbsp;rounds&nbsp;a&nbsp;number&nbsp;down&nbsp;to&nbsp;the&nbsp;nearest&nbsp;power&nbsp;of&nbsp;10.</span><br>
<span class="lineno">145</span><span class="keyword" id="5453814">func</span>&nbsp;<span class="ident" id="5453819">roundDown10</span><span class="op" id="5453830">(</span><span class="ident" id="5453831">n</span>&nbsp;<span class="builtintype" id="5453833">int</span><span class="op" id="5453836">)</span>&nbsp;<span class="builtintype" id="5453838">int</span>&nbsp;<span class="op" id="5453842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453845">var</span>&nbsp;<span class="ident" id="5453849">tens</span>&nbsp;<span class="op" id="5453854">=</span>&nbsp;<span class="num" id="5453856">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453859">//&nbsp;tens&nbsp;=&nbsp;floor(log_10(n))</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453887">for</span>&nbsp;<span class="ident" id="5453891"><a href="/gostd/testing/benchmark.go.html#5453831">n</a></span>&nbsp;<span class="op" id="5453893">&gt;=</span>&nbsp;<span class="num" id="5453896">10</span>&nbsp;<span class="op" id="5453899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453903"><a href="/gostd/testing/benchmark.go.html#5453831">n</a></span>&nbsp;<span class="op" id="5453905">=</span>&nbsp;<span class="ident" id="5453907"><a href="/gostd/testing/benchmark.go.html#5453831">n</a></span>&nbsp;<span class="op" id="5453909">/</span>&nbsp;<span class="num" id="5453911">10</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453916"><a href="/gostd/testing/benchmark.go.html#5453849">tens</a></span><span class="op" id="5453920">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5453924">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5453927">//&nbsp;result&nbsp;=&nbsp;10^tens</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453948">result</span>&nbsp;<span class="op" id="5453955">:=</span>&nbsp;<span class="num" id="5453958">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5453961">for</span>&nbsp;<span class="ident" id="5453965">i</span>&nbsp;<span class="op" id="5453967">:=</span>&nbsp;<span class="num" id="5453970">0</span><span class="op" id="5453971">;</span>&nbsp;<span class="ident" id="5453973"><a href="/gostd/testing/benchmark.go.html#5453965">i</a></span>&nbsp;<span class="op" id="5453975">&lt;</span>&nbsp;<span class="ident" id="5453977"><a href="/gostd/testing/benchmark.go.html#5453849">tens</a></span><span class="op" id="5453981">;</span>&nbsp;<span class="ident" id="5453983"><a href="/gostd/testing/benchmark.go.html#5453965">i</a></span><span class="op" id="5453984">++</span>&nbsp;<span class="op" id="5453987">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5453991"><a href="/gostd/testing/benchmark.go.html#5453948">result</a></span>&nbsp;<span class="op" id="5453998">*=</span>&nbsp;<span class="num" id="5454001">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454005">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454008">return</span>&nbsp;<span class="ident" id="5454015"><a href="/gostd/testing/benchmark.go.html#5453948">result</a></span><br>
<span class="lineno"></span><span class="op" id="5454022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="5454025">//&nbsp;roundUp&nbsp;rounds&nbsp;x&nbsp;up&nbsp;to&nbsp;a&nbsp;number&nbsp;of&nbsp;the&nbsp;form&nbsp;[1eX,&nbsp;2eX,&nbsp;3eX,&nbsp;5eX].</span><br>
<span class="lineno"></span><span class="keyword" id="5454094">func</span>&nbsp;<span class="ident" id="5454099">roundUp</span><span class="op" id="5454106">(</span><span class="ident" id="5454107">n</span>&nbsp;<span class="builtintype" id="5454109">int</span><span class="op" id="5454112">)</span>&nbsp;<span class="builtintype" id="5454114">int</span>&nbsp;<span class="op" id="5454118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454121">base</span>&nbsp;<span class="op" id="5454126">:=</span>&nbsp;<span class="ident" id="5454129"><a href="/gostd/testing/benchmark.go.html#5453819">roundDown10</a></span><span class="op" id="5454140">(</span><span class="ident" id="5454141"><a href="/gostd/testing/benchmark.go.html#5454107">n</a></span><span class="op" id="5454142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454145">switch</span>&nbsp;<span class="op" id="5454152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454155">case</span>&nbsp;<span class="ident" id="5454160"><a href="/gostd/testing/benchmark.go.html#5454107">n</a></span>&nbsp;<span class="op" id="5454162">&lt;=</span>&nbsp;<span class="ident" id="5454165"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><span class="op" id="5454169">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454173">return</span>&nbsp;<span class="ident" id="5454180"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454186">case</span>&nbsp;<span class="ident" id="5454191"><a href="/gostd/testing/benchmark.go.html#5454107">n</a></span>&nbsp;<span class="op" id="5454193">&lt;=</span>&nbsp;<span class="op" id="5454196">(</span><span class="num" id="5454197">2</span>&nbsp;<span class="op" id="5454199">*</span>&nbsp;<span class="ident" id="5454201"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><span class="op" id="5454205">)</span><span class="op" id="5454206">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454210">return</span>&nbsp;<span class="num" id="5454217">2</span>&nbsp;<span class="op" id="5454219">*</span>&nbsp;<span class="ident" id="5454221"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454227">case</span>&nbsp;<span class="ident" id="5454232"><a href="/gostd/testing/benchmark.go.html#5454107">n</a></span>&nbsp;<span class="op" id="5454234">&lt;=</span>&nbsp;<span class="op" id="5454237">(</span><span class="num" id="5454238">3</span>&nbsp;<span class="op" id="5454240">*</span>&nbsp;<span class="ident" id="5454242"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><span class="op" id="5454246">)</span><span class="op" id="5454247">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454251">return</span>&nbsp;<span class="num" id="5454258">3</span>&nbsp;<span class="op" id="5454260">*</span>&nbsp;<span class="ident" id="5454262"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454268">case</span>&nbsp;<span class="ident" id="5454273"><a href="/gostd/testing/benchmark.go.html#5454107">n</a></span>&nbsp;<span class="op" id="5454275">&lt;=</span>&nbsp;<span class="op" id="5454278">(</span><span class="num" id="5454279">5</span>&nbsp;<span class="op" id="5454281">*</span>&nbsp;<span class="ident" id="5454283"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><span class="op" id="5454287">)</span><span class="op" id="5454288">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454292">return</span>&nbsp;<span class="num" id="5454299">5</span>&nbsp;<span class="op" id="5454301">*</span>&nbsp;<span class="ident" id="5454303"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454309">default</span><span class="op" id="5454316">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454320">return</span>&nbsp;<span class="num" id="5454327">10</span>&nbsp;<span class="op" id="5454330">*</span>&nbsp;<span class="ident" id="5454332"><a href="/gostd/testing/benchmark.go.html#5454121">base</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454338">}</span><br>
<span class="lineno">175</span><span class="op" id="5454340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454343">//&nbsp;run&nbsp;times&nbsp;the&nbsp;benchmark&nbsp;function&nbsp;in&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5454404">func</span>&nbsp;<span class="op" id="5454409">(</span><span class="ident" id="5454410">b</span>&nbsp;<span class="op" id="5454412">*</span><span class="ident" id="5454413"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5454414">)</span>&nbsp;<span class="ident" id="5454416">run</span><span class="op" id="5454419">(</span><span class="op" id="5454420">)</span>&nbsp;<span class="ident" id="5454422"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span>&nbsp;<span class="op" id="5454438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454441">go</span>&nbsp;<span class="ident" id="5454444"><a href="/gostd/testing/benchmark.go.html#5454410">b</a></span><span class="op" id="5454445">.</span><span class="ident" id="5454446"><a href="/gostd/testing/benchmark.go.html#5454809">launch</a></span><span class="op" id="5454452">(</span><span class="op" id="5454453">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5454456">&lt;-</span><span class="ident" id="5454458"><a href="/gostd/testing/benchmark.go.html#5454410">b</a></span><span class="op" id="5454459">.</span><span class="ident" id="5454460"><a href="/gostd/testing/testing.go.html#5475243">signal</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454468">return</span>&nbsp;<span class="ident" id="5454475"><a href="/gostd/testing/benchmark.go.html#5454410">b</a></span><span class="op" id="5454476">.</span><span class="ident" id="5454477"><a href="/gostd/testing/benchmark.go.html#5451257">result</a></span><br>
<span class="lineno"></span><span class="op" id="5454484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5454487">//&nbsp;launch&nbsp;launches&nbsp;the&nbsp;benchmark&nbsp;function.&nbsp;&nbsp;It&nbsp;gradually&nbsp;increases&nbsp;the&nbsp;number</span><br>
<span class="lineno">185</span><span class="comment" id="5454565">//&nbsp;of&nbsp;benchmark&nbsp;iterations&nbsp;until&nbsp;the&nbsp;benchmark&nbsp;runs&nbsp;for&nbsp;the&nbsp;requested&nbsp;benchtime.</span><br>
<span class="lineno"></span><span class="comment" id="5454646">//&nbsp;It&nbsp;prints&nbsp;timing&nbsp;information&nbsp;in&nbsp;this&nbsp;form</span><br>
<span class="lineno"></span><span class="comment" id="5454691">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;testing.BenchmarkHello&nbsp;&nbsp;&nbsp;&nbsp;100000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;19&nbsp;ns/op</span><br>
<span class="lineno"></span><span class="comment" id="5454735">//&nbsp;launch&nbsp;is&nbsp;run&nbsp;by&nbsp;the&nbsp;run&nbsp;function&nbsp;as&nbsp;a&nbsp;separate&nbsp;goroutine.</span><br>
<span class="lineno"></span><span class="keyword" id="5454797">func</span>&nbsp;<span class="op" id="5454802">(</span><span class="ident" id="5454803">b</span>&nbsp;<span class="op" id="5454805">*</span><span class="ident" id="5454806"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5454807">)</span>&nbsp;<span class="ident" id="5454809">launch</span><span class="op" id="5454815">(</span><span class="op" id="5454816">)</span>&nbsp;<span class="op" id="5454818">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454821">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;a&nbsp;single&nbsp;iteration&nbsp;in&nbsp;case&nbsp;it&#39;s&nbsp;expensive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5454890">n</span>&nbsp;<span class="op" id="5454892">:=</span>&nbsp;<span class="num" id="5454895">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454899">//&nbsp;Signal&nbsp;that&nbsp;we&#39;re&nbsp;done&nbsp;whether&nbsp;we&nbsp;return&nbsp;normally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5454953">//&nbsp;or&nbsp;by&nbsp;FailNow&#39;s&nbsp;runtime.Goexit.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5454989">defer</span>&nbsp;<span class="keyword" id="5454995">func</span><span class="op" id="5454999">(</span><span class="op" id="5455000">)</span>&nbsp;<span class="op" id="5455002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455006"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455007">.</span><span class="ident" id="5455008"><a href="/gostd/testing/testing.go.html#5475243">signal</a></span>&nbsp;<span class="op" id="5455015">&lt;-</span>&nbsp;<span class="ident" id="5455018"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455021">}</span><span class="op" id="5455022">(</span><span class="op" id="5455023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455027"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455028">.</span><span class="ident" id="5455029"><a href="/gostd/testing/benchmark.go.html#5453299">runN</a></span><span class="op" id="5455033">(</span><span class="ident" id="5455034"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><span class="op" id="5455035">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455038">//&nbsp;Run&nbsp;the&nbsp;benchmark&nbsp;for&nbsp;at&nbsp;least&nbsp;the&nbsp;specified&nbsp;amount&nbsp;of&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455103">d</span>&nbsp;<span class="op" id="5455105">:=</span>&nbsp;<span class="op" id="5455108">*</span><span class="ident" id="5455109"><a href="/gostd/testing/benchmark.go.html#5450279">benchTime</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455120">for</span>&nbsp;<span class="op" id="5455124">!</span><span class="ident" id="5455125"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455126">.</span><span class="ident" id="5455127"><a href="/gostd/testing/testing.go.html#5474961">failed</a></span>&nbsp;<span class="op" id="5455134">&amp;&amp;</span>&nbsp;<span class="ident" id="5455137"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455138">.</span><span class="ident" id="5455139"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span>&nbsp;<span class="op" id="5455148">&lt;</span>&nbsp;<span class="ident" id="5455150"><a href="/gostd/testing/benchmark.go.html#5455103">d</a></span>&nbsp;<span class="op" id="5455152">&amp;&amp;</span>&nbsp;<span class="ident" id="5455155"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span>&nbsp;<span class="op" id="5455157">&lt;</span>&nbsp;<span class="num" id="5455159">1e9</span>&nbsp;<span class="op" id="5455163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455167">last</span>&nbsp;<span class="op" id="5455172">:=</span>&nbsp;<span class="ident" id="5455175"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455179">//&nbsp;Predict&nbsp;required&nbsp;iterations.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5455213">if</span>&nbsp;<span class="ident" id="5455216"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455217">.</span><span class="ident" id="5455218"><a href="/gostd/testing/benchmark.go.html#5453119">nsPerOp</a></span><span class="op" id="5455225">(</span><span class="op" id="5455226">)</span>&nbsp;<span class="op" id="5455228">==</span>&nbsp;<span class="num" id="5455231">0</span>&nbsp;<span class="op" id="5455233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455238"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span>&nbsp;<span class="op" id="5455240">=</span>&nbsp;<span class="num" id="5455242">1e9</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455248">}</span>&nbsp;<span class="keyword" id="5455250">else</span>&nbsp;<span class="op" id="5455255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455260"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span>&nbsp;<span class="op" id="5455262">=</span>&nbsp;<span class="builtintype" id="5455264">int</span><span class="op" id="5455267">(</span><span class="ident" id="5455268"><a href="/gostd/testing/benchmark.go.html#5455103">d</a></span><span class="op" id="5455269">.</span><span class="ident" id="5455270"><a href="/gostd/time/time.go.html#2737484">Nanoseconds</a></span><span class="op" id="5455281">(</span><span class="op" id="5455282">)</span>&nbsp;<span class="op" id="5455284">/</span>&nbsp;<span class="ident" id="5455286"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455287">.</span><span class="ident" id="5455288"><a href="/gostd/testing/benchmark.go.html#5453119">nsPerOp</a></span><span class="op" id="5455295">(</span><span class="op" id="5455296">)</span><span class="op" id="5455297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455301">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455305">//&nbsp;Run&nbsp;more&nbsp;iterations&nbsp;than&nbsp;we&nbsp;think&nbsp;we&#39;ll&nbsp;need&nbsp;(1.2x).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455363">//&nbsp;Don&#39;t&nbsp;grow&nbsp;too&nbsp;fast&nbsp;in&nbsp;case&nbsp;we&nbsp;had&nbsp;timing&nbsp;errors&nbsp;previously.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455429">//&nbsp;Be&nbsp;sure&nbsp;to&nbsp;run&nbsp;at&nbsp;least&nbsp;one&nbsp;more&nbsp;than&nbsp;last&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455483"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span>&nbsp;<span class="op" id="5455485">=</span>&nbsp;<span class="ident" id="5455487"><a href="/gostd/testing/benchmark.go.html#5453691">max</a></span><span class="op" id="5455490">(</span><span class="ident" id="5455491"><a href="/gostd/testing/benchmark.go.html#5453627">min</a></span><span class="op" id="5455494">(</span><span class="ident" id="5455495"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><span class="op" id="5455496">+</span><span class="ident" id="5455497"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><span class="op" id="5455498">/</span><span class="num" id="5455499">5</span><span class="op" id="5455500">,</span>&nbsp;<span class="num" id="5455502">100</span><span class="op" id="5455505">*</span><span class="ident" id="5455506"><a href="/gostd/testing/benchmark.go.html#5455167">last</a></span><span class="op" id="5455510">)</span><span class="op" id="5455511">,</span>&nbsp;<span class="ident" id="5455513"><a href="/gostd/testing/benchmark.go.html#5455167">last</a></span><span class="op" id="5455517">+</span><span class="num" id="5455518">1</span><span class="op" id="5455519">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455523">//&nbsp;Round&nbsp;up&nbsp;to&nbsp;something&nbsp;easy&nbsp;to&nbsp;read.</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455564"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span>&nbsp;<span class="op" id="5455566">=</span>&nbsp;<span class="ident" id="5455568"><a href="/gostd/testing/benchmark.go.html#5454099">roundUp</a></span><span class="op" id="5455575">(</span><span class="ident" id="5455576"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><span class="op" id="5455577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455581"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455582">.</span><span class="ident" id="5455583"><a href="/gostd/testing/benchmark.go.html#5453299">runN</a></span><span class="op" id="5455587">(</span><span class="ident" id="5455588"><a href="/gostd/testing/benchmark.go.html#5454890">n</a></span><span class="op" id="5455589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5455592">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455595"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455596">.</span><span class="ident" id="5455597"><a href="/gostd/testing/benchmark.go.html#5451257">result</a></span>&nbsp;<span class="op" id="5455604">=</span>&nbsp;<span class="ident" id="5455606"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5455621">{</span><span class="ident" id="5455622"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455623">.</span><span class="ident" id="5455624"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="5455625">,</span>&nbsp;<span class="ident" id="5455627"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455628">.</span><span class="ident" id="5455629"><a href="/gostd/testing/testing.go.html#5475149">duration</a></span><span class="op" id="5455637">,</span>&nbsp;<span class="ident" id="5455639"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455640">.</span><span class="ident" id="5455641"><a href="/gostd/testing/benchmark.go.html#5451187">bytes</a></span><span class="op" id="5455646">,</span>&nbsp;<span class="ident" id="5455648"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455649">.</span><span class="ident" id="5455650"><a href="/gostd/testing/benchmark.go.html#5451526">netAllocs</a></span><span class="op" id="5455659">,</span>&nbsp;<span class="ident" id="5455661"><a href="/gostd/testing/benchmark.go.html#5454803">b</a></span><span class="op" id="5455662">.</span><span class="ident" id="5455663"><a href="/gostd/testing/benchmark.go.html#5451544">netBytes</a></span><span class="op" id="5455671">}</span><br>
<span class="lineno"></span><span class="op" id="5455673">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span><span class="comment" id="5455676">//&nbsp;The&nbsp;results&nbsp;of&nbsp;a&nbsp;benchmark&nbsp;run.</span><br>
<span class="lineno"></span><span class="keyword" id="5455711">type</span>&nbsp;<span class="ident" id="5455716">BenchmarkResult</span>&nbsp;<span class="keyword" id="5455732">struct</span>&nbsp;<span class="op" id="5455739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455742">N</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5455752">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455766">//&nbsp;The&nbsp;number&nbsp;of&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455796">T</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455806"><a href="/gostd/testing/benchmark.go.html#5450163">time</a></span><span class="op" id="5455810">.</span><span class="ident" id="5455811"><a href="/gostd/time/time.go.html#2734212">Duration</a></span>&nbsp;<span class="comment" id="5455820">//&nbsp;The&nbsp;total&nbsp;time&nbsp;taken.</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455846">Bytes</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5455856">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455870">//&nbsp;Bytes&nbsp;processed&nbsp;in&nbsp;one&nbsp;iteration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455908">MemAllocs</span>&nbsp;<span class="builtintype" id="5455918">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5455932">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;memory&nbsp;allocations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5455976">MemBytes</span>&nbsp;&nbsp;<span class="builtintype" id="5455986">uint64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456000">//&nbsp;The&nbsp;total&nbsp;number&nbsp;of&nbsp;bytes&nbsp;allocated.</span><br>
<span class="lineno"></span><span class="op" id="5456040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5456043">func</span>&nbsp;<span class="op" id="5456048">(</span><span class="ident" id="5456049">r</span>&nbsp;<span class="ident" id="5456051"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5456066">)</span>&nbsp;<span class="ident" id="5456068">NsPerOp</span><span class="op" id="5456075">(</span><span class="op" id="5456076">)</span>&nbsp;<span class="builtintype" id="5456078">int64</span>&nbsp;<span class="op" id="5456084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456087">if</span>&nbsp;<span class="ident" id="5456090"><a href="/gostd/testing/benchmark.go.html#5456049">r</a></span><span class="op" id="5456091">.</span><span class="ident" id="5456092"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span>&nbsp;<span class="op" id="5456094">&lt;=</span>&nbsp;<span class="num" id="5456097">0</span>&nbsp;<span class="op" id="5456099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456103">return</span>&nbsp;<span class="num" id="5456110">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456113">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456116">return</span>&nbsp;<span class="ident" id="5456123"><a href="/gostd/testing/benchmark.go.html#5456049">r</a></span><span class="op" id="5456124">.</span><span class="ident" id="5456125"><a href="/gostd/testing/benchmark.go.html#5455796">T</a></span><span class="op" id="5456126">.</span><span class="ident" id="5456127"><a href="/gostd/time/time.go.html#2737484">Nanoseconds</a></span><span class="op" id="5456138">(</span><span class="op" id="5456139">)</span>&nbsp;<span class="op" id="5456141">/</span>&nbsp;<span class="builtintype" id="5456143">int64</span><span class="op" id="5456148">(</span><span class="ident" id="5456149"><a href="/gostd/testing/benchmark.go.html#5456049">r</a></span><span class="op" id="5456150">.</span><span class="ident" id="5456151"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5456152">)</span><br>
<span class="lineno">235</span><span class="op" id="5456154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456157">func</span>&nbsp;<span class="op" id="5456162">(</span><span class="ident" id="5456163">r</span>&nbsp;<span class="ident" id="5456165"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5456180">)</span>&nbsp;<span class="ident" id="5456182">mbPerSec</span><span class="op" id="5456190">(</span><span class="op" id="5456191">)</span>&nbsp;<span class="builtintype" id="5456193">float64</span>&nbsp;<span class="op" id="5456201">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456204">if</span>&nbsp;<span class="ident" id="5456207"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456208">.</span><span class="ident" id="5456209"><a href="/gostd/testing/benchmark.go.html#5455846">Bytes</a></span>&nbsp;<span class="op" id="5456215">&lt;=</span>&nbsp;<span class="num" id="5456218">0</span>&nbsp;<span class="op" id="5456220">||</span>&nbsp;<span class="ident" id="5456223"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456224">.</span><span class="ident" id="5456225"><a href="/gostd/testing/benchmark.go.html#5455796">T</a></span>&nbsp;<span class="op" id="5456227">&lt;=</span>&nbsp;<span class="num" id="5456230">0</span>&nbsp;<span class="op" id="5456232">||</span>&nbsp;<span class="ident" id="5456235"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456236">.</span><span class="ident" id="5456237"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span>&nbsp;<span class="op" id="5456239">&lt;=</span>&nbsp;<span class="num" id="5456242">0</span>&nbsp;<span class="op" id="5456244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456248">return</span>&nbsp;<span class="num" id="5456255">0</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456258">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456261">return</span>&nbsp;<span class="op" id="5456268">(</span><span class="builtintype" id="5456269">float64</span><span class="op" id="5456276">(</span><span class="ident" id="5456277"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456278">.</span><span class="ident" id="5456279"><a href="/gostd/testing/benchmark.go.html#5455846">Bytes</a></span><span class="op" id="5456284">)</span>&nbsp;<span class="op" id="5456286">*</span>&nbsp;<span class="builtintype" id="5456288">float64</span><span class="op" id="5456295">(</span><span class="ident" id="5456296"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456297">.</span><span class="ident" id="5456298"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5456299">)</span>&nbsp;<span class="op" id="5456301">/</span>&nbsp;<span class="num" id="5456303">1e6</span><span class="op" id="5456306">)</span>&nbsp;<span class="op" id="5456308">/</span>&nbsp;<span class="ident" id="5456310"><a href="/gostd/testing/benchmark.go.html#5456163">r</a></span><span class="op" id="5456311">.</span><span class="ident" id="5456312"><a href="/gostd/testing/benchmark.go.html#5455796">T</a></span><span class="op" id="5456313">.</span><span class="ident" id="5456314"><a href="/gostd/time/time.go.html#2738077">Seconds</a></span><span class="op" id="5456321">(</span><span class="op" id="5456322">)</span><br>
<span class="lineno"></span><span class="op" id="5456324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456327">func</span>&nbsp;<span class="op" id="5456332">(</span><span class="ident" id="5456333">r</span>&nbsp;<span class="ident" id="5456335"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5456350">)</span>&nbsp;<span class="ident" id="5456352">AllocsPerOp</span><span class="op" id="5456363">(</span><span class="op" id="5456364">)</span>&nbsp;<span class="builtintype" id="5456366">int64</span>&nbsp;<span class="op" id="5456372">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456375">if</span>&nbsp;<span class="ident" id="5456378"><a href="/gostd/testing/benchmark.go.html#5456333">r</a></span><span class="op" id="5456379">.</span><span class="ident" id="5456380"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span>&nbsp;<span class="op" id="5456382">&lt;=</span>&nbsp;<span class="num" id="5456385">0</span>&nbsp;<span class="op" id="5456387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456391">return</span>&nbsp;<span class="num" id="5456398">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456404">return</span>&nbsp;<span class="builtintype" id="5456411">int64</span><span class="op" id="5456416">(</span><span class="ident" id="5456417"><a href="/gostd/testing/benchmark.go.html#5456333">r</a></span><span class="op" id="5456418">.</span><span class="ident" id="5456419"><a href="/gostd/testing/benchmark.go.html#5455908">MemAllocs</a></span><span class="op" id="5456428">)</span>&nbsp;<span class="op" id="5456430">/</span>&nbsp;<span class="builtintype" id="5456432">int64</span><span class="op" id="5456437">(</span><span class="ident" id="5456438"><a href="/gostd/testing/benchmark.go.html#5456333">r</a></span><span class="op" id="5456439">.</span><span class="ident" id="5456440"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5456441">)</span><br>
<span class="lineno"></span><span class="op" id="5456443">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="5456446">func</span>&nbsp;<span class="op" id="5456451">(</span><span class="ident" id="5456452">r</span>&nbsp;<span class="ident" id="5456454"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5456469">)</span>&nbsp;<span class="ident" id="5456471">AllocedBytesPerOp</span><span class="op" id="5456488">(</span><span class="op" id="5456489">)</span>&nbsp;<span class="builtintype" id="5456491">int64</span>&nbsp;<span class="op" id="5456497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456500">if</span>&nbsp;<span class="ident" id="5456503"><a href="/gostd/testing/benchmark.go.html#5456452">r</a></span><span class="op" id="5456504">.</span><span class="ident" id="5456505"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span>&nbsp;<span class="op" id="5456507">&lt;=</span>&nbsp;<span class="num" id="5456510">0</span>&nbsp;<span class="op" id="5456512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456516">return</span>&nbsp;<span class="num" id="5456523">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456526">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456529">return</span>&nbsp;<span class="builtintype" id="5456536">int64</span><span class="op" id="5456541">(</span><span class="ident" id="5456542"><a href="/gostd/testing/benchmark.go.html#5456452">r</a></span><span class="op" id="5456543">.</span><span class="ident" id="5456544"><a href="/gostd/testing/benchmark.go.html#5455976">MemBytes</a></span><span class="op" id="5456552">)</span>&nbsp;<span class="op" id="5456554">/</span>&nbsp;<span class="builtintype" id="5456556">int64</span><span class="op" id="5456561">(</span><span class="ident" id="5456562"><a href="/gostd/testing/benchmark.go.html#5456452">r</a></span><span class="op" id="5456563">.</span><span class="ident" id="5456564"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5456565">)</span><br>
<span class="lineno"></span><span class="op" id="5456567">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5456570">func</span>&nbsp;<span class="op" id="5456575">(</span><span class="ident" id="5456576">r</span>&nbsp;<span class="ident" id="5456578"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5456593">)</span>&nbsp;<span class="ident" id="5456595">String</span><span class="op" id="5456601">(</span><span class="op" id="5456602">)</span>&nbsp;<span class="builtintype" id="5456604">string</span>&nbsp;<span class="op" id="5456611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456614">mbs</span>&nbsp;<span class="op" id="5456618">:=</span>&nbsp;<span class="ident" id="5456621"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5456622">.</span><span class="ident" id="5456623"><a href="/gostd/testing/benchmark.go.html#5456182">mbPerSec</a></span><span class="op" id="5456631">(</span><span class="op" id="5456632">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456635">mb</span>&nbsp;<span class="op" id="5456638">:=</span>&nbsp;<span class="string" id="5456641">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456645">if</span>&nbsp;<span class="ident" id="5456648"><a href="/gostd/testing/benchmark.go.html#5456614">mbs</a></span>&nbsp;<span class="op" id="5456652">!=</span>&nbsp;<span class="num" id="5456655">0</span>&nbsp;<span class="op" id="5456657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456661"><a href="/gostd/testing/benchmark.go.html#5456635">mb</a></span>&nbsp;<span class="op" id="5456664">=</span>&nbsp;<span class="ident" id="5456666"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5456669">.</span><span class="ident" id="5456670"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5456677">(</span><span class="string" id="5456678">&#34;\t%7.2f&nbsp;MB/s&#34;</span><span class="op" id="5456692">,</span>&nbsp;<span class="ident" id="5456694"><a href="/gostd/testing/benchmark.go.html#5456614">mbs</a></span><span class="op" id="5456697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456703">nsop</span>&nbsp;<span class="op" id="5456708">:=</span>&nbsp;<span class="ident" id="5456711"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5456712">.</span><span class="ident" id="5456713"><a href="/gostd/testing/benchmark.go.html#5456068">NsPerOp</a></span><span class="op" id="5456720">(</span><span class="op" id="5456721">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456724">ns</span>&nbsp;<span class="op" id="5456727">:=</span>&nbsp;<span class="ident" id="5456730"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5456733">.</span><span class="ident" id="5456734"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5456741">(</span><span class="string" id="5456742">&#34;%10d&nbsp;ns/op&#34;</span><span class="op" id="5456754">,</span>&nbsp;<span class="ident" id="5456756"><a href="/gostd/testing/benchmark.go.html#5456703">nsop</a></span><span class="op" id="5456760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456763">if</span>&nbsp;<span class="ident" id="5456766"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5456767">.</span><span class="ident" id="5456768"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span>&nbsp;<span class="op" id="5456770">&gt;</span>&nbsp;<span class="num" id="5456772">0</span>&nbsp;<span class="op" id="5456774">&amp;&amp;</span>&nbsp;<span class="ident" id="5456777"><a href="/gostd/testing/benchmark.go.html#5456703">nsop</a></span>&nbsp;<span class="op" id="5456782">&lt;</span>&nbsp;<span class="num" id="5456784">100</span>&nbsp;<span class="op" id="5456788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456792">//&nbsp;The&nbsp;format&nbsp;specifiers&nbsp;here&nbsp;make&nbsp;sure&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5456839">//&nbsp;the&nbsp;ones&nbsp;digits&nbsp;line&nbsp;up&nbsp;for&nbsp;all&nbsp;three&nbsp;possible&nbsp;formats.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5456900">if</span>&nbsp;<span class="ident" id="5456903"><a href="/gostd/testing/benchmark.go.html#5456703">nsop</a></span>&nbsp;<span class="op" id="5456908">&lt;</span>&nbsp;<span class="num" id="5456910">10</span>&nbsp;<span class="op" id="5456913">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5456918"><a href="/gostd/testing/benchmark.go.html#5456724">ns</a></span>&nbsp;<span class="op" id="5456921">=</span>&nbsp;<span class="ident" id="5456923"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5456926">.</span><span class="ident" id="5456927"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5456934">(</span><span class="string" id="5456935">&#34;%13.2f&nbsp;ns/op&#34;</span><span class="op" id="5456949">,</span>&nbsp;<span class="builtintype" id="5456951">float64</span><span class="op" id="5456958">(</span><span class="ident" id="5456959"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5456960">.</span><span class="ident" id="5456961"><a href="/gostd/testing/benchmark.go.html#5455796">T</a></span><span class="op" id="5456962">.</span><span class="ident" id="5456963"><a href="/gostd/time/time.go.html#2737484">Nanoseconds</a></span><span class="op" id="5456974">(</span><span class="op" id="5456975">)</span><span class="op" id="5456976">)</span><span class="op" id="5456977">/</span><span class="builtintype" id="5456978">float64</span><span class="op" id="5456985">(</span><span class="ident" id="5456986"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5456987">.</span><span class="ident" id="5456988"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5456989">)</span><span class="op" id="5456990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5456994">}</span>&nbsp;<span class="keyword" id="5456996">else</span>&nbsp;<span class="op" id="5457001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457006"><a href="/gostd/testing/benchmark.go.html#5456724">ns</a></span>&nbsp;<span class="op" id="5457009">=</span>&nbsp;<span class="ident" id="5457011"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5457014">.</span><span class="ident" id="5457015"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5457022">(</span><span class="string" id="5457023">&#34;%12.1f&nbsp;ns/op&#34;</span><span class="op" id="5457037">,</span>&nbsp;<span class="builtintype" id="5457039">float64</span><span class="op" id="5457046">(</span><span class="ident" id="5457047"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5457048">.</span><span class="ident" id="5457049"><a href="/gostd/testing/benchmark.go.html#5455796">T</a></span><span class="op" id="5457050">.</span><span class="ident" id="5457051"><a href="/gostd/time/time.go.html#2737484">Nanoseconds</a></span><span class="op" id="5457062">(</span><span class="op" id="5457063">)</span><span class="op" id="5457064">)</span><span class="op" id="5457065">/</span><span class="builtintype" id="5457066">float64</span><span class="op" id="5457073">(</span><span class="ident" id="5457074"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5457075">.</span><span class="ident" id="5457076"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5457077">)</span><span class="op" id="5457078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457085">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457088">return</span>&nbsp;<span class="ident" id="5457095"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5457098">.</span><span class="ident" id="5457099"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5457106">(</span><span class="string" id="5457107">&#34;%8d\t%s%s&#34;</span><span class="op" id="5457118">,</span>&nbsp;<span class="ident" id="5457120"><a href="/gostd/testing/benchmark.go.html#5456576">r</a></span><span class="op" id="5457121">.</span><span class="ident" id="5457122"><a href="/gostd/testing/benchmark.go.html#5455742">N</a></span><span class="op" id="5457123">,</span>&nbsp;<span class="ident" id="5457125"><a href="/gostd/testing/benchmark.go.html#5456724">ns</a></span><span class="op" id="5457127">,</span>&nbsp;<span class="ident" id="5457129"><a href="/gostd/testing/benchmark.go.html#5456635">mb</a></span><span class="op" id="5457131">)</span><br>
<span class="lineno"></span><span class="op" id="5457133">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5457136">func</span>&nbsp;<span class="op" id="5457141">(</span><span class="ident" id="5457142">r</span>&nbsp;<span class="ident" id="5457144"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span><span class="op" id="5457159">)</span>&nbsp;<span class="ident" id="5457161">MemString</span><span class="op" id="5457170">(</span><span class="op" id="5457171">)</span>&nbsp;<span class="builtintype" id="5457173">string</span>&nbsp;<span class="op" id="5457180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457183">return</span>&nbsp;<span class="ident" id="5457190"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5457193">.</span><span class="ident" id="5457194"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5457201">(</span><span class="string" id="5457202">&#34;%8d&nbsp;B/op\t%8d&nbsp;allocs/op&#34;</span><span class="op" id="5457227">,</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457231"><a href="/gostd/testing/benchmark.go.html#5457142">r</a></span><span class="op" id="5457232">.</span><span class="ident" id="5457233"><a href="/gostd/testing/benchmark.go.html#5456471">AllocedBytesPerOp</a></span><span class="op" id="5457250">(</span><span class="op" id="5457251">)</span><span class="op" id="5457252">,</span>&nbsp;<span class="ident" id="5457254"><a href="/gostd/testing/benchmark.go.html#5457142">r</a></span><span class="op" id="5457255">.</span><span class="ident" id="5457256"><a href="/gostd/testing/benchmark.go.html#5456352">AllocsPerOp</a></span><span class="op" id="5457267">(</span><span class="op" id="5457268">)</span><span class="op" id="5457269">)</span><br>
<span class="lineno"></span><span class="op" id="5457271">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5457274">//&nbsp;An&nbsp;internal&nbsp;function&nbsp;but&nbsp;exported&nbsp;because&nbsp;it&nbsp;is&nbsp;cross-package;&nbsp;part&nbsp;of&nbsp;the&nbsp;implementation</span><br>
<span class="lineno"></span><span class="comment" id="5457367">//&nbsp;of&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno">285</span><span class="keyword" id="5457396">func</span>&nbsp;<span class="ident" id="5457401">RunBenchmarks</span><span class="op" id="5457414">(</span><span class="ident" id="5457415">matchString</span>&nbsp;<span class="keyword" id="5457427">func</span><span class="op" id="5457431">(</span><span class="ident" id="5457432">pat</span><span class="op" id="5457435">,</span>&nbsp;<span class="ident" id="5457437">str</span>&nbsp;<span class="builtintype" id="5457441">string</span><span class="op" id="5457447">)</span>&nbsp;<span class="op" id="5457449">(</span><span class="builtintype" id="5457450">bool</span><span class="op" id="5457454">,</span>&nbsp;<span class="builtintype" id="5457456">error</span><span class="op" id="5457461">)</span><span class="op" id="5457462">,</span>&nbsp;<span class="ident" id="5457464">benchmarks</span>&nbsp;<span class="op" id="5457475">[</span><span class="op" id="5457476">]</span><span class="ident" id="5457477"><a href="/gostd/testing/benchmark.go.html#5450775">InternalBenchmark</a></span><span class="op" id="5457494">)</span>&nbsp;<span class="op" id="5457496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5457499">//&nbsp;If&nbsp;no&nbsp;flag&nbsp;was&nbsp;specified,&nbsp;don&#39;t&nbsp;run&nbsp;benchmarks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457551">if</span>&nbsp;<span class="builtinfunc" id="5457554">len</span><span class="op" id="5457557">(</span><span class="op" id="5457558">*</span><span class="ident" id="5457559"><a href="/gostd/testing/benchmark.go.html#5450177">matchBenchmarks</a></span><span class="op" id="5457574">)</span>&nbsp;<span class="op" id="5457576">==</span>&nbsp;<span class="num" id="5457579">0</span>&nbsp;<span class="op" id="5457581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457585">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457593">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457596">for</span>&nbsp;<span class="ident" id="5457600">_</span><span class="op" id="5457601">,</span>&nbsp;<span class="ident" id="5457603">Benchmark</span>&nbsp;<span class="op" id="5457613">:=</span>&nbsp;<span class="keyword" id="5457616">range</span>&nbsp;<span class="ident" id="5457622"><a href="/gostd/testing/benchmark.go.html#5457464">benchmarks</a></span>&nbsp;<span class="op" id="5457633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457637">matched</span><span class="op" id="5457644">,</span>&nbsp;<span class="ident" id="5457646">err</span>&nbsp;<span class="op" id="5457650">:=</span>&nbsp;<span class="ident" id="5457653"><a href="/gostd/testing/benchmark.go.html#5457415">matchString</a></span><span class="op" id="5457664">(</span><span class="op" id="5457665">*</span><span class="ident" id="5457666"><a href="/gostd/testing/benchmark.go.html#5450177">matchBenchmarks</a></span><span class="op" id="5457681">,</span>&nbsp;<span class="ident" id="5457683"><a href="/gostd/testing/benchmark.go.html#5457603">Benchmark</a></span><span class="op" id="5457692">.</span><span class="ident" id="5457693"><a href="/gostd/testing/benchmark.go.html#5450803">Name</a></span><span class="op" id="5457697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457701">if</span>&nbsp;<span class="ident" id="5457704"><a href="/gostd/testing/benchmark.go.html#5457646">err</a></span>&nbsp;<span class="op" id="5457708">!=</span>&nbsp;<span class="builtintype" id="5457711">nil</span>&nbsp;<span class="op" id="5457715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457720"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5457723">.</span><span class="ident" id="5457724"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="5457731">(</span><span class="ident" id="5457732"><a href="/gostd/testing/benchmark.go.html#5450123">os</a></span><span class="op" id="5457734">.</span><span class="ident" id="5457735"><a href="/gostd/os/file.go.html#2441872">Stderr</a></span><span class="op" id="5457741">,</span>&nbsp;<span class="string" id="5457743">&#34;testing:&nbsp;invalid&nbsp;regexp&nbsp;for&nbsp;-test.bench:&nbsp;%s\n&#34;</span><span class="op" id="5457790">,</span>&nbsp;<span class="ident" id="5457792"><a href="/gostd/testing/benchmark.go.html#5457646">err</a></span><span class="op" id="5457795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457800"><a href="/gostd/testing/benchmark.go.html#5450123">os</a></span><span class="op" id="5457802">.</span><span class="ident" id="5457803"><a href="/gostd/os/proc.go.html#2469766">Exit</a></span><span class="op" id="5457807">(</span><span class="num" id="5457808">1</span><span class="op" id="5457809">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457813">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457817">if</span>&nbsp;<span class="op" id="5457820">!</span><span class="ident" id="5457821"><a href="/gostd/testing/benchmark.go.html#5457637">matched</a></span>&nbsp;<span class="op" id="5457829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457834">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5457849">for</span>&nbsp;<span class="ident" id="5457853">_</span><span class="op" id="5457854">,</span>&nbsp;<span class="ident" id="5457856">procs</span>&nbsp;<span class="op" id="5457862">:=</span>&nbsp;<span class="keyword" id="5457865">range</span>&nbsp;<span class="ident" id="5457871"><a href="/gostd/testing/testing.go.html#5474707">cpuList</a></span>&nbsp;<span class="op" id="5457879">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457884"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5457891">.</span><span class="ident" id="5457892"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="5457902">(</span><span class="ident" id="5457903"><a href="/gostd/testing/benchmark.go.html#5457856">procs</a></span><span class="op" id="5457908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457913">b</span>&nbsp;<span class="op" id="5457915">:=</span>&nbsp;<span class="op" id="5457918">&amp;</span><span class="ident" id="5457919"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5457920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457926"><a href="/gostd/testing/benchmark.go.html#5450975">common</a></span><span class="op" id="5457932">:</span>&nbsp;<span class="ident" id="5457934"><a href="/gostd/testing/testing.go.html#5474828">common</a></span><span class="op" id="5457940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457947"><a href="/gostd/testing/testing.go.html#5475243">signal</a></span><span class="op" id="5457953">:</span>&nbsp;<span class="builtinfunc" id="5457955">make</span><span class="op" id="5457959">(</span><span class="keyword" id="5457960">chan</span>&nbsp;<span class="keyword" id="5457965">interface</span><span class="op" id="5457974">{</span><span class="op" id="5457975">}</span><span class="op" id="5457976">)</span><span class="op" id="5457977">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5457983">}</span><span class="op" id="5457984">,</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5457990"><a href="/gostd/testing/benchmark.go.html#5451151">benchmark</a></span><span class="op" id="5457999">:</span>&nbsp;<span class="ident" id="5458001"><a href="/gostd/testing/benchmark.go.html#5457603">Benchmark</a></span><span class="op" id="5458010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458020">benchName</span>&nbsp;<span class="op" id="5458030">:=</span>&nbsp;<span class="ident" id="5458033"><a href="/gostd/testing/benchmark.go.html#5457603">Benchmark</a></span><span class="op" id="5458042">.</span><span class="ident" id="5458043"><a href="/gostd/testing/benchmark.go.html#5450803">Name</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458051">if</span>&nbsp;<span class="ident" id="5458054"><a href="/gostd/testing/benchmark.go.html#5457856">procs</a></span>&nbsp;<span class="op" id="5458060">!=</span>&nbsp;<span class="num" id="5458063">1</span>&nbsp;<span class="op" id="5458065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458071"><a href="/gostd/testing/benchmark.go.html#5458020">benchName</a></span>&nbsp;<span class="op" id="5458081">=</span>&nbsp;<span class="ident" id="5458083"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458086">.</span><span class="ident" id="5458087"><a href="/gostd/fmt/print.go.html#2143637">Sprintf</a></span><span class="op" id="5458094">(</span><span class="string" id="5458095">&#34;%s-%d&#34;</span><span class="op" id="5458102">,</span>&nbsp;<span class="ident" id="5458104"><a href="/gostd/testing/benchmark.go.html#5457603">Benchmark</a></span><span class="op" id="5458113">.</span><span class="ident" id="5458114"><a href="/gostd/testing/benchmark.go.html#5450803">Name</a></span><span class="op" id="5458118">,</span>&nbsp;<span class="ident" id="5458120"><a href="/gostd/testing/benchmark.go.html#5457856">procs</a></span><span class="op" id="5458125">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458135"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458138">.</span><span class="ident" id="5458139"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="5458145">(</span><span class="string" id="5458146">&#34;%s\t&#34;</span><span class="op" id="5458152">,</span>&nbsp;<span class="ident" id="5458154"><a href="/gostd/testing/benchmark.go.html#5458020">benchName</a></span><span class="op" id="5458163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458168">r</span>&nbsp;<span class="op" id="5458170">:=</span>&nbsp;<span class="ident" id="5458173"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458174">.</span><span class="ident" id="5458175"><a href="/gostd/testing/benchmark.go.html#5454416">run</a></span><span class="op" id="5458178">(</span><span class="op" id="5458179">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458184">if</span>&nbsp;<span class="ident" id="5458187"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458188">.</span><span class="ident" id="5458189"><a href="/gostd/testing/testing.go.html#5474961">failed</a></span>&nbsp;<span class="op" id="5458196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458202">//&nbsp;The&nbsp;output&nbsp;could&nbsp;be&nbsp;very&nbsp;long&nbsp;here,&nbsp;but&nbsp;probably&nbsp;isn&#39;t.</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458265">//&nbsp;We&nbsp;print&nbsp;it&nbsp;all,&nbsp;regardless,&nbsp;because&nbsp;we&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;trim&nbsp;the&nbsp;reason</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458342">//&nbsp;the&nbsp;benchmark&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458371"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458374">.</span><span class="ident" id="5458375"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="5458381">(</span><span class="string" id="5458382">&#34;---&nbsp;FAIL:&nbsp;%s\n%s&#34;</span><span class="op" id="5458400">,</span>&nbsp;<span class="ident" id="5458402"><a href="/gostd/testing/benchmark.go.html#5458020">benchName</a></span><span class="op" id="5458411">,</span>&nbsp;<span class="ident" id="5458413"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458414">.</span><span class="ident" id="5458415"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5458421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458427">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458439">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458444">results</span>&nbsp;<span class="op" id="5458452">:=</span>&nbsp;<span class="ident" id="5458455"><a href="/gostd/testing/benchmark.go.html#5458168">r</a></span><span class="op" id="5458456">.</span><span class="ident" id="5458457"><a href="/gostd/testing/benchmark.go.html#5456595">String</a></span><span class="op" id="5458463">(</span><span class="op" id="5458464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458469">if</span>&nbsp;<span class="op" id="5458472">*</span><span class="ident" id="5458473"><a href="/gostd/testing/benchmark.go.html#5450385">benchmarkMemory</a></span>&nbsp;<span class="op" id="5458489">||</span>&nbsp;<span class="ident" id="5458492"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458493">.</span><span class="ident" id="5458494"><a href="/gostd/testing/benchmark.go.html#5451234">showAllocResult</a></span>&nbsp;<span class="op" id="5458510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458516"><a href="/gostd/testing/benchmark.go.html#5458444">results</a></span>&nbsp;<span class="op" id="5458524">+=</span>&nbsp;<span class="string" id="5458527">&#34;\t&#34;</span>&nbsp;<span class="op" id="5458532">+</span>&nbsp;<span class="ident" id="5458534"><a href="/gostd/testing/benchmark.go.html#5458168">r</a></span><span class="op" id="5458535">.</span><span class="ident" id="5458536"><a href="/gostd/testing/benchmark.go.html#5457161">MemString</a></span><span class="op" id="5458545">(</span><span class="op" id="5458546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458556"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458559">.</span><span class="ident" id="5458560"><a href="/gostd/fmt/print.go.html#2145772">Println</a></span><span class="op" id="5458567">(</span><span class="ident" id="5458568"><a href="/gostd/testing/benchmark.go.html#5458444">results</a></span><span class="op" id="5458575">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458580">//&nbsp;Unlike&nbsp;with&nbsp;tests,&nbsp;we&nbsp;ignore&nbsp;the&nbsp;-chatty&nbsp;flag&nbsp;and&nbsp;always&nbsp;print&nbsp;output&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5458660">//&nbsp;benchmarks&nbsp;since&nbsp;the&nbsp;output&nbsp;generation&nbsp;time&nbsp;will&nbsp;skew&nbsp;the&nbsp;results.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458733">if</span>&nbsp;<span class="builtinfunc" id="5458736">len</span><span class="op" id="5458739">(</span><span class="ident" id="5458740"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458741">.</span><span class="ident" id="5458742"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5458748">)</span>&nbsp;<span class="op" id="5458750">&gt;</span>&nbsp;<span class="num" id="5458752">0</span>&nbsp;<span class="op" id="5458754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458760"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458761">.</span><span class="ident" id="5458762"><a href="/gostd/testing/benchmark.go.html#5459072">trimOutput</a></span><span class="op" id="5458772">(</span><span class="op" id="5458773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458779"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458782">.</span><span class="ident" id="5458783"><a href="/gostd/fmt/print.go.html#2143442">Printf</a></span><span class="op" id="5458789">(</span><span class="string" id="5458790">&#34;---&nbsp;BENCH:&nbsp;%s\n%s&#34;</span><span class="op" id="5458809">,</span>&nbsp;<span class="ident" id="5458811"><a href="/gostd/testing/benchmark.go.html#5458020">benchName</a></span><span class="op" id="5458820">,</span>&nbsp;<span class="ident" id="5458822"><a href="/gostd/testing/benchmark.go.html#5457913">b</a></span><span class="op" id="5458823">.</span><span class="ident" id="5458824"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5458830">)</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5458840">if</span>&nbsp;<span class="ident" id="5458843">p</span>&nbsp;<span class="op" id="5458845">:=</span>&nbsp;<span class="ident" id="5458848"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5458855">.</span><span class="ident" id="5458856"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="5458866">(</span><span class="op" id="5458867">-</span><span class="num" id="5458868">1</span><span class="op" id="5458869">)</span><span class="op" id="5458870">;</span>&nbsp;<span class="ident" id="5458872"><a href="/gostd/testing/benchmark.go.html#5458843">p</a></span>&nbsp;<span class="op" id="5458874">!=</span>&nbsp;<span class="ident" id="5458877"><a href="/gostd/testing/benchmark.go.html#5457856">procs</a></span>&nbsp;<span class="op" id="5458883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5458889"><a href="/gostd/testing/benchmark.go.html#5450116">fmt</a></span><span class="op" id="5458892">.</span><span class="ident" id="5458893"><a href="/gostd/fmt/print.go.html#2143118">Fprintf</a></span><span class="op" id="5458900">(</span><span class="ident" id="5458901"><a href="/gostd/testing/benchmark.go.html#5450123">os</a></span><span class="op" id="5458903">.</span><span class="ident" id="5458904"><a href="/gostd/os/file.go.html#2441872">Stderr</a></span><span class="op" id="5458910">,</span>&nbsp;<span class="string" id="5458912">&#34;testing:&nbsp;%s&nbsp;left&nbsp;GOMAXPROCS&nbsp;set&nbsp;to&nbsp;%d\n&#34;</span><span class="op" id="5458953">,</span>&nbsp;<span class="ident" id="5458955"><a href="/gostd/testing/benchmark.go.html#5458020">benchName</a></span><span class="op" id="5458964">,</span>&nbsp;<span class="ident" id="5458966"><a href="/gostd/testing/benchmark.go.html#5458843">p</a></span><span class="op" id="5458967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458976">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5458979">}</span><br>
<span class="lineno"></span><span class="op" id="5458981">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5458984">//&nbsp;trimOutput&nbsp;shortens&nbsp;the&nbsp;output&nbsp;from&nbsp;a&nbsp;benchmark,&nbsp;which&nbsp;can&nbsp;be&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="5459060">func</span>&nbsp;<span class="op" id="5459065">(</span><span class="ident" id="5459066">b</span>&nbsp;<span class="op" id="5459068">*</span><span class="ident" id="5459069"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5459070">)</span>&nbsp;<span class="ident" id="5459072">trimOutput</span><span class="op" id="5459082">(</span><span class="op" id="5459083">)</span>&nbsp;<span class="op" id="5459085">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459088">//&nbsp;The&nbsp;output&nbsp;is&nbsp;likely&nbsp;to&nbsp;appear&nbsp;multiple&nbsp;times&nbsp;because&nbsp;the&nbsp;benchmark</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459160">//&nbsp;is&nbsp;run&nbsp;multiple&nbsp;times,&nbsp;but&nbsp;at&nbsp;least&nbsp;it&nbsp;will&nbsp;be&nbsp;seen.&nbsp;This&nbsp;is&nbsp;not&nbsp;a&nbsp;big&nbsp;deal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5459240">//&nbsp;because&nbsp;benchmarks&nbsp;rarely&nbsp;print,&nbsp;but&nbsp;just&nbsp;in&nbsp;case,&nbsp;we&nbsp;trim&nbsp;it&nbsp;if&nbsp;it&#39;s&nbsp;too&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459324">const</span>&nbsp;<span class="ident" id="5459330">maxNewlines</span>&nbsp;<span class="op" id="5459342">=</span>&nbsp;<span class="num" id="5459344">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459348">for</span>&nbsp;<span class="ident" id="5459352">nlCount</span><span class="op" id="5459359">,</span>&nbsp;<span class="ident" id="5459361">j</span>&nbsp;<span class="op" id="5459363">:=</span>&nbsp;<span class="num" id="5459366">0</span><span class="op" id="5459367">,</span>&nbsp;<span class="num" id="5459369">0</span><span class="op" id="5459370">;</span>&nbsp;<span class="ident" id="5459372"><a href="/gostd/testing/benchmark.go.html#5459361">j</a></span>&nbsp;<span class="op" id="5459374">&lt;</span>&nbsp;<span class="builtinfunc" id="5459376">len</span><span class="op" id="5459379">(</span><span class="ident" id="5459380"><a href="/gostd/testing/benchmark.go.html#5459066">b</a></span><span class="op" id="5459381">.</span><span class="ident" id="5459382"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5459388">)</span><span class="op" id="5459389">;</span>&nbsp;<span class="ident" id="5459391"><a href="/gostd/testing/benchmark.go.html#5459361">j</a></span><span class="op" id="5459392">++</span>&nbsp;<span class="op" id="5459395">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459399">if</span>&nbsp;<span class="ident" id="5459402"><a href="/gostd/testing/benchmark.go.html#5459066">b</a></span><span class="op" id="5459403">.</span><span class="ident" id="5459404"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5459410">[</span><span class="ident" id="5459411"><a href="/gostd/testing/benchmark.go.html#5459361">j</a></span><span class="op" id="5459412">]</span>&nbsp;<span class="op" id="5459414">==</span>&nbsp;<span class="string" id="5459417">&#39;\n&#39;</span>&nbsp;<span class="op" id="5459422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459427"><a href="/gostd/testing/benchmark.go.html#5459352">nlCount</a></span><span class="op" id="5459434">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459440">if</span>&nbsp;<span class="ident" id="5459443"><a href="/gostd/testing/benchmark.go.html#5459352">nlCount</a></span>&nbsp;<span class="op" id="5459451">&gt;=</span>&nbsp;<span class="ident" id="5459454"><a href="/gostd/testing/benchmark.go.html#5459330">maxNewlines</a></span>&nbsp;<span class="op" id="5459466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459472"><a href="/gostd/testing/benchmark.go.html#5459066">b</a></span><span class="op" id="5459473">.</span><span class="ident" id="5459474"><a href="/gostd/testing/testing.go.html#5474896">output</a></span>&nbsp;<span class="op" id="5459481">=</span>&nbsp;<span class="builtinfunc" id="5459483">append</span><span class="op" id="5459489">(</span><span class="ident" id="5459490"><a href="/gostd/testing/benchmark.go.html#5459066">b</a></span><span class="op" id="5459491">.</span><span class="ident" id="5459492"><a href="/gostd/testing/testing.go.html#5474896">output</a></span><span class="op" id="5459498">[</span><span class="op" id="5459499">:</span><span class="ident" id="5459500"><a href="/gostd/testing/benchmark.go.html#5459361">j</a></span><span class="op" id="5459501">]</span><span class="op" id="5459502">,</span>&nbsp;<span class="string" id="5459504">&#34;\n\t...&nbsp;[output&nbsp;truncated]\n&#34;</span><span class="op" id="5459534">...</span><span class="op" id="5459537">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5459543">break</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5459559">}</span><br>
<span class="lineno"></span><span class="op" id="5459561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span><span class="comment" id="5459564">//&nbsp;A&nbsp;PB&nbsp;is&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;for&nbsp;running&nbsp;parallel&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="keyword" id="5459628">type</span>&nbsp;<span class="ident" id="5459633">PB</span>&nbsp;<span class="keyword" id="5459636">struct</span>&nbsp;<span class="op" id="5459643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459646">globalN</span>&nbsp;<span class="op" id="5459654">*</span><span class="builtintype" id="5459655">uint64</span>&nbsp;<span class="comment" id="5459662">//&nbsp;shared&nbsp;between&nbsp;all&nbsp;worker&nbsp;goroutines&nbsp;iteration&nbsp;counter</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459721">grain</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459729">uint64</span>&nbsp;&nbsp;<span class="comment" id="5459737">//&nbsp;acquire&nbsp;that&nbsp;many&nbsp;iterations&nbsp;from&nbsp;globalN&nbsp;at&nbsp;once</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459791">cache</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459799">uint64</span>&nbsp;&nbsp;<span class="comment" id="5459807">//&nbsp;local&nbsp;cache&nbsp;of&nbsp;acquired&nbsp;iterations</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5459846">bN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5459854">uint64</span>&nbsp;&nbsp;<span class="comment" id="5459862">//&nbsp;total&nbsp;number&nbsp;of&nbsp;iterations&nbsp;to&nbsp;execute&nbsp;(b.N)</span><br>
<span class="lineno"></span><span class="op" id="5459909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5459912">//&nbsp;Next&nbsp;reports&nbsp;whether&nbsp;there&nbsp;are&nbsp;more&nbsp;iterations&nbsp;to&nbsp;execute.</span><br>
<span class="lineno"></span><span class="keyword" id="5459974">func</span>&nbsp;<span class="op" id="5459979">(</span><span class="ident" id="5459980">pb</span>&nbsp;<span class="op" id="5459983">*</span><span class="ident" id="5459984"><a href="/gostd/testing/benchmark.go.html#5459633">PB</a></span><span class="op" id="5459986">)</span>&nbsp;<span class="ident" id="5459988">Next</span><span class="op" id="5459992">(</span><span class="op" id="5459993">)</span>&nbsp;<span class="builtintype" id="5459995">bool</span>&nbsp;<span class="op" id="5460000">{</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460003">if</span>&nbsp;<span class="ident" id="5460006"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460008">.</span><span class="ident" id="5460009"><a href="/gostd/testing/benchmark.go.html#5459791">cache</a></span>&nbsp;<span class="op" id="5460015">==</span>&nbsp;<span class="num" id="5460018">0</span>&nbsp;<span class="op" id="5460020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460024">n</span>&nbsp;<span class="op" id="5460026">:=</span>&nbsp;<span class="ident" id="5460029"><a href="/gostd/testing/benchmark.go.html#5450148">atomic</a></span><span class="op" id="5460035">.</span><span class="ident" id="5460036"><a href="/gostd/sync/atomic/doc.go.html#1467619">AddUint64</a></span><span class="op" id="5460045">(</span><span class="ident" id="5460046"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460048">.</span><span class="ident" id="5460049"><a href="/gostd/testing/benchmark.go.html#5459646">globalN</a></span><span class="op" id="5460056">,</span>&nbsp;<span class="ident" id="5460058"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460060">.</span><span class="ident" id="5460061"><a href="/gostd/testing/benchmark.go.html#5459721">grain</a></span><span class="op" id="5460066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460070">if</span>&nbsp;<span class="ident" id="5460073"><a href="/gostd/testing/benchmark.go.html#5460024">n</a></span>&nbsp;<span class="op" id="5460075">&lt;=</span>&nbsp;<span class="ident" id="5460078"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460080">.</span><span class="ident" id="5460081"><a href="/gostd/testing/benchmark.go.html#5459846">bN</a></span>&nbsp;<span class="op" id="5460084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460089"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460091">.</span><span class="ident" id="5460092"><a href="/gostd/testing/benchmark.go.html#5459791">cache</a></span>&nbsp;<span class="op" id="5460098">=</span>&nbsp;<span class="ident" id="5460100"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460102">.</span><span class="ident" id="5460103"><a href="/gostd/testing/benchmark.go.html#5459721">grain</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460111">}</span>&nbsp;<span class="keyword" id="5460113">else</span>&nbsp;<span class="keyword" id="5460118">if</span>&nbsp;<span class="ident" id="5460121"><a href="/gostd/testing/benchmark.go.html#5460024">n</a></span>&nbsp;<span class="op" id="5460123">&lt;</span>&nbsp;<span class="ident" id="5460125"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460127">.</span><span class="ident" id="5460128"><a href="/gostd/testing/benchmark.go.html#5459846">bN</a></span><span class="op" id="5460130">+</span><span class="ident" id="5460131"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460133">.</span><span class="ident" id="5460134"><a href="/gostd/testing/benchmark.go.html#5459721">grain</a></span>&nbsp;<span class="op" id="5460140">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460145"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460147">.</span><span class="ident" id="5460148"><a href="/gostd/testing/benchmark.go.html#5459791">cache</a></span>&nbsp;<span class="op" id="5460154">=</span>&nbsp;<span class="ident" id="5460156"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460158">.</span><span class="ident" id="5460159"><a href="/gostd/testing/benchmark.go.html#5459846">bN</a></span>&nbsp;<span class="op" id="5460162">+</span>&nbsp;<span class="ident" id="5460164"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460166">.</span><span class="ident" id="5460167"><a href="/gostd/testing/benchmark.go.html#5459721">grain</a></span>&nbsp;<span class="op" id="5460173">-</span>&nbsp;<span class="ident" id="5460175"><a href="/gostd/testing/benchmark.go.html#5460024">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460179">}</span>&nbsp;<span class="keyword" id="5460181">else</span>&nbsp;<span class="op" id="5460186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460191">return</span>&nbsp;<span class="builtintype" id="5460198">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5460209">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5460212"><a href="/gostd/testing/benchmark.go.html#5459980">pb</a></span><span class="op" id="5460214">.</span><span class="ident" id="5460215"><a href="/gostd/testing/benchmark.go.html#5459791">cache</a></span><span class="op" id="5460220">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5460224">return</span>&nbsp;<span class="builtintype" id="5460231">true</span><br>
<span class="lineno"></span><span class="op" id="5460236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5460239">//&nbsp;RunParallel&nbsp;runs&nbsp;a&nbsp;benchmark&nbsp;in&nbsp;parallel.</span><br>
<span class="lineno">380</span><span class="comment" id="5460284">//&nbsp;It&nbsp;creates&nbsp;multiple&nbsp;goroutines&nbsp;and&nbsp;distributes&nbsp;b.N&nbsp;iterations&nbsp;among&nbsp;them.</span><br>
<span class="lineno"></span><span class="comment" id="5460361">//&nbsp;The&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;defaults&nbsp;to&nbsp;GOMAXPROCS.&nbsp;To&nbsp;increase&nbsp;parallelism&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="5460441">//&nbsp;non-CPU-bound&nbsp;benchmarks,&nbsp;call&nbsp;SetParallelism&nbsp;before&nbsp;RunParallel.</span><br>
<span class="lineno"></span><span class="comment" id="5460510">//&nbsp;RunParallel&nbsp;is&nbsp;usually&nbsp;used&nbsp;with&nbsp;the&nbsp;go&nbsp;test&nbsp;-cpu&nbsp;flag.</span><br>
<span class="lineno"></span><span class="comment" id="5460569">//</span><br>
<span class="lineno">385</span><span class="comment" id="5460572">//&nbsp;The&nbsp;body&nbsp;function&nbsp;will&nbsp;be&nbsp;run&nbsp;in&nbsp;each&nbsp;goroutine.&nbsp;It&nbsp;should&nbsp;set&nbsp;up&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="5460645">//&nbsp;goroutine-local&nbsp;state&nbsp;and&nbsp;then&nbsp;iterate&nbsp;until&nbsp;pb.Next&nbsp;returns&nbsp;false.</span><br>
<span class="lineno"></span><span class="comment" id="5460716">//&nbsp;It&nbsp;should&nbsp;not&nbsp;use&nbsp;the&nbsp;StartTimer,&nbsp;StopTimer,&nbsp;or&nbsp;ResetTimer&nbsp;functions,</span><br>
<span class="lineno"></span><span class="comment" id="5460789">//&nbsp;because&nbsp;they&nbsp;have&nbsp;global&nbsp;effect.</span><br>
<span class="lineno"></span><span class="keyword" id="5460825">func</span>&nbsp;<span class="op" id="5460830">(</span><span class="ident" id="5460831">b</span>&nbsp;<span class="op" id="5460833">*</span><span class="ident" id="5460834"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5460835">)</span>&nbsp;<span class="ident" id="5460837">RunParallel</span><span class="op" id="5460848">(</span><span class="ident" id="5460849">body</span>&nbsp;<span class="keyword" id="5460854">func</span><span class="op" id="5460858">(</span><span class="op" id="5460859">*</span><span class="ident" id="5460860"><a href="/gostd/testing/benchmark.go.html#5459633">PB</a></span><span class="op" id="5460862">)</span><span class="op" id="5460863">)</span>&nbsp;<span class="op" id="5460865">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460868">//&nbsp;Calculate&nbsp;grain&nbsp;size&nbsp;as&nbsp;number&nbsp;of&nbsp;iterations&nbsp;that&nbsp;take&nbsp;~100s.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5460936">//&nbsp;100s&nbsp;is&nbsp;enough&nbsp;to&nbsp;amortize&nbsp;the&nbsp;overhead&nbsp;and&nbsp;provide&nbsp;sufficient</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5461005">//&nbsp;dynamic&nbsp;load&nbsp;balancing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461033">grain</span>&nbsp;<span class="op" id="5461039">:=</span>&nbsp;<span class="builtintype" id="5461042">uint64</span><span class="op" id="5461048">(</span><span class="num" id="5461049">0</span><span class="op" id="5461050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461053">if</span>&nbsp;<span class="ident" id="5461056"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461057">.</span><span class="ident" id="5461058"><a href="/gostd/testing/benchmark.go.html#5451005">previousN</a></span>&nbsp;<span class="op" id="5461068">&gt;</span>&nbsp;<span class="num" id="5461070">0</span>&nbsp;<span class="op" id="5461072">&amp;&amp;</span>&nbsp;<span class="ident" id="5461075"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461076">.</span><span class="ident" id="5461077"><a href="/gostd/testing/benchmark.go.html#5451081">previousDuration</a></span>&nbsp;<span class="op" id="5461094">&gt;</span>&nbsp;<span class="num" id="5461096">0</span>&nbsp;<span class="op" id="5461098">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461102"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span>&nbsp;<span class="op" id="5461108">=</span>&nbsp;<span class="num" id="5461110">1e5</span>&nbsp;<span class="op" id="5461114">*</span>&nbsp;<span class="builtintype" id="5461116">uint64</span><span class="op" id="5461122">(</span><span class="ident" id="5461123"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461124">.</span><span class="ident" id="5461125"><a href="/gostd/testing/benchmark.go.html#5451005">previousN</a></span><span class="op" id="5461134">)</span>&nbsp;<span class="op" id="5461136">/</span>&nbsp;<span class="builtintype" id="5461138">uint64</span><span class="op" id="5461144">(</span><span class="ident" id="5461145"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461146">.</span><span class="ident" id="5461147"><a href="/gostd/testing/benchmark.go.html#5451081">previousDuration</a></span><span class="op" id="5461163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461169">if</span>&nbsp;<span class="ident" id="5461172"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span>&nbsp;<span class="op" id="5461178">&lt;</span>&nbsp;<span class="num" id="5461180">1</span>&nbsp;<span class="op" id="5461182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461186"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span>&nbsp;<span class="op" id="5461192">=</span>&nbsp;<span class="num" id="5461194">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461197">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5461200">//&nbsp;We&nbsp;expect&nbsp;the&nbsp;inner&nbsp;loop&nbsp;and&nbsp;function&nbsp;call&nbsp;to&nbsp;take&nbsp;at&nbsp;least&nbsp;10ns,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5461270">//&nbsp;so&nbsp;do&nbsp;not&nbsp;do&nbsp;more&nbsp;than&nbsp;100s/10ns=1e4&nbsp;iterations.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461325">if</span>&nbsp;<span class="ident" id="5461328"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span>&nbsp;<span class="op" id="5461334">&gt;</span>&nbsp;<span class="num" id="5461336">1e4</span>&nbsp;<span class="op" id="5461340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461344"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span>&nbsp;<span class="op" id="5461350">=</span>&nbsp;<span class="num" id="5461352">1e4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461357">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461361">n</span>&nbsp;<span class="op" id="5461363">:=</span>&nbsp;<span class="builtintype" id="5461366">uint64</span><span class="op" id="5461372">(</span><span class="num" id="5461373">0</span><span class="op" id="5461374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461377">numProcs</span>&nbsp;<span class="op" id="5461386">:=</span>&nbsp;<span class="ident" id="5461389"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461390">.</span><span class="ident" id="5461391"><a href="/gostd/testing/benchmark.go.html#5451291">parallelism</a></span>&nbsp;<span class="op" id="5461403">*</span>&nbsp;<span class="ident" id="5461405"><a href="/gostd/testing/benchmark.go.html#5450129">runtime</a></span><span class="op" id="5461412">.</span><span class="ident" id="5461413"><a href="/gostd/runtime/debug.go.html#1521359">GOMAXPROCS</a></span><span class="op" id="5461423">(</span><span class="num" id="5461424">0</span><span class="op" id="5461425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461428">var</span>&nbsp;<span class="ident" id="5461432">wg</span>&nbsp;<span class="ident" id="5461435"><a href="/gostd/testing/benchmark.go.html#5450140">sync</a></span><span class="op" id="5461439">.</span><span class="ident" id="5461440"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461451"><a href="/gostd/testing/benchmark.go.html#5461432">wg</a></span><span class="op" id="5461453">.</span><span class="ident" id="5461454"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="5461457">(</span><span class="ident" id="5461458"><a href="/gostd/testing/benchmark.go.html#5461377">numProcs</a></span><span class="op" id="5461466">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461469">for</span>&nbsp;<span class="ident" id="5461473">p</span>&nbsp;<span class="op" id="5461475">:=</span>&nbsp;<span class="num" id="5461478">0</span><span class="op" id="5461479">;</span>&nbsp;<span class="ident" id="5461481"><a href="/gostd/testing/benchmark.go.html#5461473">p</a></span>&nbsp;<span class="op" id="5461483">&lt;</span>&nbsp;<span class="ident" id="5461485"><a href="/gostd/testing/benchmark.go.html#5461377">numProcs</a></span><span class="op" id="5461493">;</span>&nbsp;<span class="ident" id="5461495"><a href="/gostd/testing/benchmark.go.html#5461473">p</a></span><span class="op" id="5461496">++</span>&nbsp;<span class="op" id="5461499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461503">go</span>&nbsp;<span class="keyword" id="5461506">func</span><span class="op" id="5461510">(</span><span class="op" id="5461511">)</span>&nbsp;<span class="op" id="5461513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461518">defer</span>&nbsp;<span class="ident" id="5461524"><a href="/gostd/testing/benchmark.go.html#5461432">wg</a></span><span class="op" id="5461526">.</span><span class="ident" id="5461527"><a href="/gostd/sync/waitgroup.go.html#1462065">Done</a></span><span class="op" id="5461531">(</span><span class="op" id="5461532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461537">pb</span>&nbsp;<span class="op" id="5461540">:=</span>&nbsp;<span class="op" id="5461543">&amp;</span><span class="ident" id="5461544"><a href="/gostd/testing/benchmark.go.html#5459633">PB</a></span><span class="op" id="5461546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461552"><a href="/gostd/testing/benchmark.go.html#5459646">globalN</a></span><span class="op" id="5461559">:</span>&nbsp;<span class="op" id="5461561">&amp;</span><span class="ident" id="5461562"><a href="/gostd/testing/benchmark.go.html#5461361">n</a></span><span class="op" id="5461563">,</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461569"><a href="/gostd/testing/benchmark.go.html#5459721">grain</a></span><span class="op" id="5461574">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5461578"><a href="/gostd/testing/benchmark.go.html#5461033">grain</a></span><span class="op" id="5461583">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461589"><a href="/gostd/testing/benchmark.go.html#5459846">bN</a></span><span class="op" id="5461591">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5461598">uint64</span><span class="op" id="5461604">(</span><span class="ident" id="5461605"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461606">.</span><span class="ident" id="5461607"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="5461608">)</span><span class="op" id="5461609">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461619"><a href="/gostd/testing/benchmark.go.html#5460849">body</a></span><span class="op" id="5461623">(</span><span class="ident" id="5461624"><a href="/gostd/testing/benchmark.go.html#5461537">pb</a></span><span class="op" id="5461626">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461630">}</span><span class="op" id="5461631">(</span><span class="op" id="5461632">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461638"><a href="/gostd/testing/benchmark.go.html#5461432">wg</a></span><span class="op" id="5461640">.</span><span class="ident" id="5461641"><a href="/gostd/sync/waitgroup.go.html#1462162">Wait</a></span><span class="op" id="5461645">(</span><span class="op" id="5461646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5461649">if</span>&nbsp;<span class="ident" id="5461652"><a href="/gostd/testing/benchmark.go.html#5461361">n</a></span>&nbsp;<span class="op" id="5461654">&lt;=</span>&nbsp;<span class="builtintype" id="5461657">uint64</span><span class="op" id="5461663">(</span><span class="ident" id="5461664"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461665">.</span><span class="ident" id="5461666"><a href="/gostd/testing/benchmark.go.html#5450983">N</a></span><span class="op" id="5461667">)</span>&nbsp;<span class="op" id="5461669">&amp;&amp;</span>&nbsp;<span class="op" id="5461672">!</span><span class="ident" id="5461673"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461674">.</span><span class="ident" id="5461675"><a href="/gostd/testing/testing.go.html#5477786">Failed</a></span><span class="op" id="5461681">(</span><span class="op" id="5461682">)</span>&nbsp;<span class="op" id="5461684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5461688"><a href="/gostd/testing/benchmark.go.html#5460831">b</a></span><span class="op" id="5461689">.</span><span class="ident" id="5461690"><a href="/gostd/testing/testing.go.html#5480265">Fatal</a></span><span class="op" id="5461695">(</span><span class="string" id="5461696">&#34;RunParallel:&nbsp;body&nbsp;exited&nbsp;without&nbsp;pb.Next()&nbsp;==&nbsp;false&#34;</span><span class="op" id="5461749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5461752">}</span><br>
<span class="lineno">425</span><span class="op" id="5461754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5461757">//&nbsp;SetParallelism&nbsp;sets&nbsp;the&nbsp;number&nbsp;of&nbsp;goroutines&nbsp;used&nbsp;by&nbsp;RunParallel&nbsp;to&nbsp;p*GOMAXPROCS.</span><br>
<span class="lineno"></span><span class="comment" id="5461842">//&nbsp;There&nbsp;is&nbsp;usually&nbsp;no&nbsp;need&nbsp;to&nbsp;call&nbsp;SetParallelism&nbsp;for&nbsp;CPU-bound&nbsp;benchmarks.</span><br>
<span class="lineno"></span><span class="comment" id="5461919">//&nbsp;If&nbsp;p&nbsp;is&nbsp;less&nbsp;than&nbsp;1,&nbsp;this&nbsp;call&nbsp;will&nbsp;have&nbsp;no&nbsp;effect.</span><br>
<span class="lineno">430</span><span class="keyword" id="5461974">func</span>&nbsp;<span class="op" id="5461979">(</span><span class="ident" id="5461980">b</span>&nbsp;<span class="op" id="5461982">*</span><span class="ident" id="5461983"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5461984">)</span>&nbsp;<span class="ident" id="5461986">SetParallelism</span><span class="op" id="5462000">(</span><span class="ident" id="5462001">p</span>&nbsp;<span class="builtintype" id="5462003">int</span><span class="op" id="5462006">)</span>&nbsp;<span class="op" id="5462008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462011">if</span>&nbsp;<span class="ident" id="5462014"><a href="/gostd/testing/benchmark.go.html#5462001">p</a></span>&nbsp;<span class="op" id="5462016">&gt;=</span>&nbsp;<span class="num" id="5462019">1</span>&nbsp;<span class="op" id="5462021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462025"><a href="/gostd/testing/benchmark.go.html#5461980">b</a></span><span class="op" id="5462026">.</span><span class="ident" id="5462027"><a href="/gostd/testing/benchmark.go.html#5451291">parallelism</a></span>&nbsp;<span class="op" id="5462039">=</span>&nbsp;<span class="ident" id="5462041"><a href="/gostd/testing/benchmark.go.html#5462001">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462044">}</span><br>
<span class="lineno"></span><span class="op" id="5462046">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="comment" id="5462049">//&nbsp;Benchmark&nbsp;benchmarks&nbsp;a&nbsp;single&nbsp;function.&nbsp;Useful&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span><span class="comment" id="5462112">//&nbsp;custom&nbsp;benchmarks&nbsp;that&nbsp;do&nbsp;not&nbsp;use&nbsp;the&nbsp;&#34;go&nbsp;test&#34;&nbsp;command.</span><br>
<span class="lineno"></span><span class="keyword" id="5462172">func</span>&nbsp;<span class="ident" id="5462177">Benchmark</span><span class="op" id="5462186">(</span><span class="ident" id="5462187">f</span>&nbsp;<span class="keyword" id="5462189">func</span><span class="op" id="5462193">(</span><span class="ident" id="5462194">b</span>&nbsp;<span class="op" id="5462196">*</span><span class="ident" id="5462197"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5462198">)</span><span class="op" id="5462199">)</span>&nbsp;<span class="ident" id="5462201"><a href="/gostd/testing/benchmark.go.html#5455716">BenchmarkResult</a></span>&nbsp;<span class="op" id="5462217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462220">b</span>&nbsp;<span class="op" id="5462222">:=</span>&nbsp;<span class="op" id="5462225">&amp;</span><span class="ident" id="5462226"><a href="/gostd/testing/benchmark.go.html#5450963">B</a></span><span class="op" id="5462227">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462231"><a href="/gostd/testing/benchmark.go.html#5450975">common</a></span><span class="op" id="5462237">:</span>&nbsp;<span class="ident" id="5462239"><a href="/gostd/testing/testing.go.html#5474828">common</a></span><span class="op" id="5462245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462250"><a href="/gostd/testing/testing.go.html#5475243">signal</a></span><span class="op" id="5462256">:</span>&nbsp;<span class="builtinfunc" id="5462258">make</span><span class="op" id="5462262">(</span><span class="keyword" id="5462263">chan</span>&nbsp;<span class="keyword" id="5462268">interface</span><span class="op" id="5462277">{</span><span class="op" id="5462278">}</span><span class="op" id="5462279">)</span><span class="op" id="5462280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462284">}</span><span class="op" id="5462285">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5462289"><a href="/gostd/testing/benchmark.go.html#5451151">benchmark</a></span><span class="op" id="5462298">:</span>&nbsp;<span class="ident" id="5462300"><a href="/gostd/testing/benchmark.go.html#5450775">InternalBenchmark</a></span><span class="op" id="5462317">{</span><span class="string" id="5462318">&#34;&#34;</span><span class="op" id="5462320">,</span>&nbsp;<span class="ident" id="5462322"><a href="/gostd/testing/benchmark.go.html#5462187">f</a></span><span class="op" id="5462323">}</span><span class="op" id="5462324">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5462327">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5462330">return</span>&nbsp;<span class="ident" id="5462337"><a href="/gostd/testing/benchmark.go.html#5462220">b</a></span><span class="op" id="5462338">.</span><span class="ident" id="5462339"><a href="/gostd/testing/benchmark.go.html#5454416">run</a></span><span class="op" id="5462342">(</span><span class="op" id="5462343">)</span><br>
<span class="lineno"></span><span class="op" id="5462345">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
