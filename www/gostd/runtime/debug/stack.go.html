<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6349659">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6349714">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6349768">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6349819">//&nbsp;Package&nbsp;debug&nbsp;contains&nbsp;facilities&nbsp;for&nbsp;programs&nbsp;to&nbsp;debug&nbsp;themselves&nbsp;while</span><br>
<span class="lineno"></span><span class="comment" id="6349895">//&nbsp;they&nbsp;are&nbsp;running.</span><br>
<span class="lineno"></span><span class="keyword" id="6349916">package</span>&nbsp;<span class="ident" id="6349924">debug</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6349931">import</span>&nbsp;<span class="op" id="6349938">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349941">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349950">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349957">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349970">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6349976">&#34;runtime&#34;</span><br>
<span class="lineno">15</span><span class="op" id="6349986">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6349989">var</span>&nbsp;<span class="op" id="6349993">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6349996">dunno</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6350006">=</span>&nbsp;<span class="op" id="6350008">[</span><span class="op" id="6350009">]</span><span class="builtintype" id="6350010">byte</span><span class="op" id="6350014">(</span><span class="string" id="6350015">&#34;???&#34;</span><span class="op" id="6350020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350023">centerDot</span>&nbsp;<span class="op" id="6350033">=</span>&nbsp;<span class="op" id="6350035">[</span><span class="op" id="6350036">]</span><span class="builtintype" id="6350037">byte</span><span class="op" id="6350041">(</span><span class="string" id="6350042">&#34;·&#34;</span><span class="op" id="6350046">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350049">dot</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6350059">=</span>&nbsp;<span class="op" id="6350061">[</span><span class="op" id="6350062">]</span><span class="builtintype" id="6350063">byte</span><span class="op" id="6350067">(</span><span class="string" id="6350068">&#34;.&#34;</span><span class="op" id="6350071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350074">slash</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6350084">=</span>&nbsp;<span class="op" id="6350086">[</span><span class="op" id="6350087">]</span><span class="builtintype" id="6350088">byte</span><span class="op" id="6350092">(</span><span class="string" id="6350093">&#34;/&#34;</span><span class="op" id="6350096">)</span><br>
<span class="lineno"></span><span class="op" id="6350098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6350101">//&nbsp;PrintStack&nbsp;prints&nbsp;to&nbsp;standard&nbsp;error&nbsp;the&nbsp;stack&nbsp;trace&nbsp;returned&nbsp;by&nbsp;Stack.</span><br>
<span class="lineno">25</span><span class="keyword" id="6350175">func</span>&nbsp;<span class="ident" id="6350180">PrintStack</span><span class="op" id="6350190">(</span><span class="op" id="6350191">)</span>&nbsp;<span class="op" id="6350193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350196">os</span><span class="op" id="6350198">.</span><span class="ident" id="6350199">Stderr</span><span class="op" id="6350205">.</span><span class="ident" id="6350206">Write</span><span class="op" id="6350211">(</span><span class="ident" id="6350212">stack</span><span class="op" id="6350217">(</span><span class="op" id="6350218">)</span><span class="op" id="6350219">)</span><br>
<span class="lineno"></span><span class="op" id="6350221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6350224">//&nbsp;Stack&nbsp;returns&nbsp;a&nbsp;formatted&nbsp;stack&nbsp;trace&nbsp;of&nbsp;the&nbsp;goroutine&nbsp;that&nbsp;calls&nbsp;it.</span><br>
<span class="lineno">30</span><span class="comment" id="6350297">//&nbsp;For&nbsp;each&nbsp;routine,&nbsp;it&nbsp;includes&nbsp;the&nbsp;source&nbsp;line&nbsp;information&nbsp;and&nbsp;PC&nbsp;value,</span><br>
<span class="lineno"></span><span class="comment" id="6350372">//&nbsp;then&nbsp;attempts&nbsp;to&nbsp;discover,&nbsp;for&nbsp;Go&nbsp;functions,&nbsp;the&nbsp;calling&nbsp;function&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6350444">//&nbsp;method&nbsp;and&nbsp;the&nbsp;text&nbsp;of&nbsp;the&nbsp;line&nbsp;containing&nbsp;the&nbsp;invocation.</span><br>
<span class="lineno"></span><span class="comment" id="6350506">//</span><br>
<span class="lineno"></span><span class="comment" id="6350509">//&nbsp;This&nbsp;function&nbsp;is&nbsp;deprecated.&nbsp;Use&nbsp;package&nbsp;runtime&#39;s&nbsp;Stack&nbsp;instead.</span><br>
<span class="lineno">35</span><span class="keyword" id="6350578">func</span>&nbsp;<span class="ident" id="6350583">Stack</span><span class="op" id="6350588">(</span><span class="op" id="6350589">)</span>&nbsp;<span class="op" id="6350591">[</span><span class="op" id="6350592">]</span><span class="builtintype" id="6350593">byte</span>&nbsp;<span class="op" id="6350598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350601">return</span>&nbsp;<span class="ident" id="6350608">stack</span><span class="op" id="6350613">(</span><span class="op" id="6350614">)</span><br>
<span class="lineno"></span><span class="op" id="6350616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6350619">//&nbsp;stack&nbsp;implements&nbsp;Stack,&nbsp;skipping&nbsp;2&nbsp;frames</span><br>
<span class="lineno">40</span><span class="keyword" id="6350664">func</span>&nbsp;<span class="ident" id="6350669">stack</span><span class="op" id="6350674">(</span><span class="op" id="6350675">)</span>&nbsp;<span class="op" id="6350677">[</span><span class="op" id="6350678">]</span><span class="builtintype" id="6350679">byte</span>&nbsp;<span class="op" id="6350684">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350687">buf</span>&nbsp;<span class="op" id="6350691">:=</span>&nbsp;<span class="builtinfunc" id="6350694">new</span><span class="op" id="6350697">(</span><span class="ident" id="6350698">bytes</span><span class="op" id="6350703">.</span><span class="ident" id="6350704">Buffer</span><span class="op" id="6350710">)</span>&nbsp;<span class="comment" id="6350712">//&nbsp;the&nbsp;returned&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6350734">//&nbsp;As&nbsp;we&nbsp;loop,&nbsp;we&nbsp;open&nbsp;files&nbsp;and&nbsp;read&nbsp;them.&nbsp;These&nbsp;variables&nbsp;record&nbsp;the&nbsp;currently</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6350816">//&nbsp;loaded&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350833">var</span>&nbsp;<span class="ident" id="6350837">lines</span>&nbsp;<span class="op" id="6350843">[</span><span class="op" id="6350844">]</span><span class="op" id="6350845">[</span><span class="op" id="6350846">]</span><span class="builtintype" id="6350847">byte</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350853">var</span>&nbsp;<span class="ident" id="6350857">lastFile</span>&nbsp;<span class="builtintype" id="6350866">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350874">for</span>&nbsp;<span class="ident" id="6350878">i</span>&nbsp;<span class="op" id="6350880">:=</span>&nbsp;<span class="num" id="6350883">2</span><span class="op" id="6350884">;</span>&nbsp;<span class="op" id="6350886">;</span>&nbsp;<span class="ident" id="6350888">i</span><span class="op" id="6350889">++</span>&nbsp;<span class="op" id="6350892">{</span>&nbsp;<span class="comment" id="6350894">//&nbsp;Caller&nbsp;we&nbsp;care&nbsp;about&nbsp;is&nbsp;the&nbsp;user,&nbsp;2&nbsp;frames&nbsp;up</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6350945">pc</span><span class="op" id="6350947">,</span>&nbsp;<span class="ident" id="6350949">file</span><span class="op" id="6350953">,</span>&nbsp;<span class="ident" id="6350955">line</span><span class="op" id="6350959">,</span>&nbsp;<span class="ident" id="6350961">ok</span>&nbsp;<span class="op" id="6350964">:=</span>&nbsp;<span class="ident" id="6350967">runtime</span><span class="op" id="6350974">.</span><span class="ident" id="6350975">Caller</span><span class="op" id="6350981">(</span><span class="ident" id="6350982">i</span><span class="op" id="6350983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350987">if</span>&nbsp;<span class="op" id="6350990">!</span><span class="ident" id="6350991">ok</span>&nbsp;<span class="op" id="6350994">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6350999">break</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6351011">//&nbsp;Print&nbsp;this&nbsp;much&nbsp;at&nbsp;least.&nbsp;&nbsp;If&nbsp;we&nbsp;can&#39;t&nbsp;find&nbsp;the&nbsp;source,&nbsp;it&nbsp;won&#39;t&nbsp;show.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351087">fmt</span><span class="op" id="6351090">.</span><span class="ident" id="6351091">Fprintf</span><span class="op" id="6351098">(</span><span class="ident" id="6351099">buf</span><span class="op" id="6351102">,</span>&nbsp;<span class="string" id="6351104">&#34;%s:%d&nbsp;(0x%x)\n&#34;</span><span class="op" id="6351120">,</span>&nbsp;<span class="ident" id="6351122">file</span><span class="op" id="6351126">,</span>&nbsp;<span class="ident" id="6351128">line</span><span class="op" id="6351132">,</span>&nbsp;<span class="ident" id="6351134">pc</span><span class="op" id="6351136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351140">if</span>&nbsp;<span class="ident" id="6351143">file</span>&nbsp;<span class="op" id="6351148">!=</span>&nbsp;<span class="ident" id="6351151">lastFile</span>&nbsp;<span class="op" id="6351160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351165">data</span><span class="op" id="6351169">,</span>&nbsp;<span class="ident" id="6351171">err</span>&nbsp;<span class="op" id="6351175">:=</span>&nbsp;<span class="ident" id="6351178">ioutil</span><span class="op" id="6351184">.</span><span class="ident" id="6351185">ReadFile</span><span class="op" id="6351193">(</span><span class="ident" id="6351194">file</span><span class="op" id="6351198">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351203">if</span>&nbsp;<span class="ident" id="6351206">err</span>&nbsp;<span class="op" id="6351210">!=</span>&nbsp;<span class="ident" id="6351213">nil</span>&nbsp;<span class="op" id="6351217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351223">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351235">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351240">lines</span>&nbsp;<span class="op" id="6351246">=</span>&nbsp;<span class="ident" id="6351248">bytes</span><span class="op" id="6351253">.</span><span class="ident" id="6351254">Split</span><span class="op" id="6351259">(</span><span class="ident" id="6351260">data</span><span class="op" id="6351264">,</span>&nbsp;<span class="op" id="6351266">[</span><span class="op" id="6351267">]</span><span class="builtintype" id="6351268">byte</span><span class="op" id="6351272">{</span><span class="string" id="6351273">&#39;\n&#39;</span><span class="op" id="6351277">}</span><span class="op" id="6351278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351283">lastFile</span>&nbsp;<span class="op" id="6351292">=</span>&nbsp;<span class="ident" id="6351294">file</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351305">line</span><span class="op" id="6351309">--</span>&nbsp;<span class="comment" id="6351312">//&nbsp;in&nbsp;stack&nbsp;trace,&nbsp;lines&nbsp;are&nbsp;1-indexed&nbsp;but&nbsp;our&nbsp;array&nbsp;is&nbsp;0-indexed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351380">fmt</span><span class="op" id="6351383">.</span><span class="ident" id="6351384">Fprintf</span><span class="op" id="6351391">(</span><span class="ident" id="6351392">buf</span><span class="op" id="6351395">,</span>&nbsp;<span class="string" id="6351397">&#34;\t%s:&nbsp;%s\n&#34;</span><span class="op" id="6351409">,</span>&nbsp;<span class="ident" id="6351411">function</span><span class="op" id="6351419">(</span><span class="ident" id="6351420">pc</span><span class="op" id="6351422">)</span><span class="op" id="6351423">,</span>&nbsp;<span class="ident" id="6351425">source</span><span class="op" id="6351431">(</span><span class="ident" id="6351432">lines</span><span class="op" id="6351437">,</span>&nbsp;<span class="ident" id="6351439">line</span><span class="op" id="6351443">)</span><span class="op" id="6351444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351450">return</span>&nbsp;<span class="ident" id="6351457">buf</span><span class="op" id="6351460">.</span><span class="ident" id="6351461">Bytes</span><span class="op" id="6351466">(</span><span class="op" id="6351467">)</span><br>
<span class="lineno">65</span><span class="op" id="6351469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6351472">//&nbsp;source&nbsp;returns&nbsp;a&nbsp;space-trimmed&nbsp;slice&nbsp;of&nbsp;the&nbsp;n&#39;th&nbsp;line.</span><br>
<span class="lineno"></span><span class="keyword" id="6351530">func</span>&nbsp;<span class="ident" id="6351535">source</span><span class="op" id="6351541">(</span><span class="ident" id="6351542">lines</span>&nbsp;<span class="op" id="6351548">[</span><span class="op" id="6351549">]</span><span class="op" id="6351550">[</span><span class="op" id="6351551">]</span><span class="builtintype" id="6351552">byte</span><span class="op" id="6351556">,</span>&nbsp;<span class="ident" id="6351558">n</span>&nbsp;<span class="builtintype" id="6351560">int</span><span class="op" id="6351563">)</span>&nbsp;<span class="op" id="6351565">[</span><span class="op" id="6351566">]</span><span class="builtintype" id="6351567">byte</span>&nbsp;<span class="op" id="6351572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351575">if</span>&nbsp;<span class="ident" id="6351578">n</span>&nbsp;<span class="op" id="6351580">&lt;</span>&nbsp;<span class="num" id="6351582">0</span>&nbsp;<span class="op" id="6351584">||</span>&nbsp;<span class="ident" id="6351587">n</span>&nbsp;<span class="op" id="6351589">&gt;=</span>&nbsp;<span class="builtinfunc" id="6351592">len</span><span class="op" id="6351595">(</span><span class="ident" id="6351596">lines</span><span class="op" id="6351601">)</span>&nbsp;<span class="op" id="6351603">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351607">return</span>&nbsp;<span class="ident" id="6351614">dunno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351624">return</span>&nbsp;<span class="ident" id="6351631">bytes</span><span class="op" id="6351636">.</span><span class="ident" id="6351637">Trim</span><span class="op" id="6351641">(</span><span class="ident" id="6351642">lines</span><span class="op" id="6351647">[</span><span class="ident" id="6351648">n</span><span class="op" id="6351649">]</span><span class="op" id="6351650">,</span>&nbsp;<span class="string" id="6351652">&#34;&nbsp;\t&#34;</span><span class="op" id="6351657">)</span><br>
<span class="lineno"></span><span class="op" id="6351659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="6351662">//&nbsp;function&nbsp;returns,&nbsp;if&nbsp;possible,&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;function&nbsp;containing&nbsp;the&nbsp;PC.</span><br>
<span class="lineno"></span><span class="keyword" id="6351740">func</span>&nbsp;<span class="ident" id="6351745">function</span><span class="op" id="6351753">(</span><span class="ident" id="6351754">pc</span>&nbsp;<span class="builtintype" id="6351757">uintptr</span><span class="op" id="6351764">)</span>&nbsp;<span class="op" id="6351766">[</span><span class="op" id="6351767">]</span><span class="builtintype" id="6351768">byte</span>&nbsp;<span class="op" id="6351773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351776">fn</span>&nbsp;<span class="op" id="6351779">:=</span>&nbsp;<span class="ident" id="6351782">runtime</span><span class="op" id="6351789">.</span><span class="ident" id="6351790">FuncForPC</span><span class="op" id="6351799">(</span><span class="ident" id="6351800">pc</span><span class="op" id="6351802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351805">if</span>&nbsp;<span class="ident" id="6351808">fn</span>&nbsp;<span class="op" id="6351811">==</span>&nbsp;<span class="ident" id="6351814">nil</span>&nbsp;<span class="op" id="6351818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6351822">return</span>&nbsp;<span class="ident" id="6351829">dunno</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6351836">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6351839">name</span>&nbsp;<span class="op" id="6351844">:=</span>&nbsp;<span class="op" id="6351847">[</span><span class="op" id="6351848">]</span><span class="builtintype" id="6351849">byte</span><span class="op" id="6351853">(</span><span class="ident" id="6351854">fn</span><span class="op" id="6351856">.</span><span class="ident" id="6351857">Name</span><span class="op" id="6351861">(</span><span class="op" id="6351862">)</span><span class="op" id="6351863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6351866">//&nbsp;The&nbsp;name&nbsp;includes&nbsp;the&nbsp;path&nbsp;name&nbsp;to&nbsp;the&nbsp;package,&nbsp;which&nbsp;is&nbsp;unnecessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6351939">//&nbsp;since&nbsp;the&nbsp;file&nbsp;name&nbsp;is&nbsp;already&nbsp;included.&nbsp;&nbsp;Plus,&nbsp;it&nbsp;has&nbsp;center&nbsp;dots.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352011">//&nbsp;That&nbsp;is,&nbsp;we&nbsp;see</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352031">//&nbsp;&nbsp;&nbsp;&nbspruntime/debug.*T·ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352063">//&nbsp;and&nbsp;want</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352076">//&nbsp;&nbsp;&nbsp;&nbsp*T.ptrmethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352093">//&nbsp;Since&nbsp;the&nbsp;package&nbsp;path&nbsp;might&nbsp;contains&nbsp;dots&nbsp;(e.g.&nbsp;code.google.com/...),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6352168">//&nbsp;we&nbsp;first&nbsp;remove&nbsp;the&nbsp;path&nbsp;prefix&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352221">if</span>&nbsp;<span class="ident" id="6352224">lastslash</span>&nbsp;<span class="op" id="6352234">:=</span>&nbsp;<span class="ident" id="6352237">bytes</span><span class="op" id="6352242">.</span><span class="ident" id="6352243">LastIndex</span><span class="op" id="6352252">(</span><span class="ident" id="6352253">name</span><span class="op" id="6352257">,</span>&nbsp;<span class="ident" id="6352259">slash</span><span class="op" id="6352264">)</span><span class="op" id="6352265">;</span>&nbsp;<span class="ident" id="6352267">lastslash</span>&nbsp;<span class="op" id="6352277">&gt;=</span>&nbsp;<span class="num" id="6352280">0</span>&nbsp;<span class="op" id="6352282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352286">name</span>&nbsp;<span class="op" id="6352291">=</span>&nbsp;<span class="ident" id="6352293">name</span><span class="op" id="6352297">[</span><span class="ident" id="6352298">lastslash</span><span class="op" id="6352307">+</span><span class="num" id="6352308">1</span><span class="op" id="6352309">:</span><span class="op" id="6352310">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352313">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352316">if</span>&nbsp;<span class="ident" id="6352319">period</span>&nbsp;<span class="op" id="6352326">:=</span>&nbsp;<span class="ident" id="6352329">bytes</span><span class="op" id="6352334">.</span><span class="ident" id="6352335">Index</span><span class="op" id="6352340">(</span><span class="ident" id="6352341">name</span><span class="op" id="6352345">,</span>&nbsp;<span class="ident" id="6352347">dot</span><span class="op" id="6352350">)</span><span class="op" id="6352351">;</span>&nbsp;<span class="ident" id="6352353">period</span>&nbsp;<span class="op" id="6352360">&gt;=</span>&nbsp;<span class="num" id="6352363">0</span>&nbsp;<span class="op" id="6352365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352369">name</span>&nbsp;<span class="op" id="6352374">=</span>&nbsp;<span class="ident" id="6352376">name</span><span class="op" id="6352380">[</span><span class="ident" id="6352381">period</span><span class="op" id="6352387">+</span><span class="num" id="6352388">1</span><span class="op" id="6352389">:</span><span class="op" id="6352390">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6352393">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6352396">name</span>&nbsp;<span class="op" id="6352401">=</span>&nbsp;<span class="ident" id="6352403">bytes</span><span class="op" id="6352408">.</span><span class="ident" id="6352409">Replace</span><span class="op" id="6352416">(</span><span class="ident" id="6352417">name</span><span class="op" id="6352421">,</span>&nbsp;<span class="ident" id="6352423">centerDot</span><span class="op" id="6352432">,</span>&nbsp;<span class="ident" id="6352434">dot</span><span class="op" id="6352437">,</span>&nbsp;<span class="op" id="6352439">-</span><span class="num" id="6352440">1</span><span class="op" id="6352441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6352444">return</span>&nbsp;<span class="ident" id="6352451">name</span><br>
<span class="lineno"></span><span class="op" id="6352456">}</span>
</div>
</body>
</html>
