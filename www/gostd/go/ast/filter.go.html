<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2306414">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2306469">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2306523">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2306574">package</span>&nbsp;<span class="ident" id="2306582">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2306587">import</span>&nbsp;<span class="op" id="2306594">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2306597">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2306609">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2306616">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2306619">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2306699">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="2306720">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="2306792">func</span>&nbsp;<span class="ident" id="2306797">exportFilter</span><span class="op" id="2306809">(</span><span class="ident" id="2306810">name</span>&nbsp;<span class="builtintype" id="2306815">string</span><span class="op" id="2306821">)</span>&nbsp;<span class="builtintype" id="2306823">bool</span>&nbsp;<span class="op" id="2306828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2306831">return</span>&nbsp;<span class="ident" id="2306838">IsExported</span><span class="op" id="2306848">(</span><span class="ident" id="2306849">name</span><span class="op" id="2306853">)</span><br>
<span class="lineno"></span><span class="op" id="2306855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="2306858">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2306927">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="2307007">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="2307085">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="2307161">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="2307213">//</span><br>
<span class="lineno"></span><span class="comment" id="2307216">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="2307280">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2307311">//</span><br>
<span class="lineno"></span><span class="keyword" id="2307314">func</span>&nbsp;<span class="ident" id="2307319">FileExports</span><span class="op" id="2307330">(</span><span class="ident" id="2307331">src</span>&nbsp;<span class="op" id="2307335">*</span><span class="ident" id="2307336">File</span><span class="op" id="2307340">)</span>&nbsp;<span class="builtintype" id="2307342">bool</span>&nbsp;<span class="op" id="2307347">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307350">return</span>&nbsp;<span class="ident" id="2307357">filterFile</span><span class="op" id="2307367">(</span><span class="ident" id="2307368">src</span><span class="op" id="2307371">,</span>&nbsp;<span class="ident" id="2307373">exportFilter</span><span class="op" id="2307385">,</span>&nbsp;<span class="builtintype" id="2307387">true</span><span class="op" id="2307391">)</span><br>
<span class="lineno"></span><span class="op" id="2307393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2307396">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="2307464">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="2307538">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="2307599">//</span><br>
<span class="lineno"></span><span class="comment" id="2307602">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="2307669">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2307700">//</span><br>
<span class="lineno">40</span><span class="keyword" id="2307703">func</span>&nbsp;<span class="ident" id="2307708">PackageExports</span><span class="op" id="2307722">(</span><span class="ident" id="2307723">pkg</span>&nbsp;<span class="op" id="2307727">*</span><span class="ident" id="2307728">Package</span><span class="op" id="2307735">)</span>&nbsp;<span class="builtintype" id="2307737">bool</span>&nbsp;<span class="op" id="2307742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307745">return</span>&nbsp;<span class="ident" id="2307752">filterPackage</span><span class="op" id="2307765">(</span><span class="ident" id="2307766">pkg</span><span class="op" id="2307769">,</span>&nbsp;<span class="ident" id="2307771">exportFilter</span><span class="op" id="2307783">,</span>&nbsp;<span class="builtintype" id="2307785">true</span><span class="op" id="2307789">)</span><br>
<span class="lineno"></span><span class="op" id="2307791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2307794">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="2307874">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2307896">type</span>&nbsp;<span class="ident" id="2307901">Filter</span>&nbsp;<span class="keyword" id="2307908">func</span><span class="op" id="2307912">(</span><span class="builtintype" id="2307913">string</span><span class="op" id="2307919">)</span>&nbsp;<span class="builtintype" id="2307921">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2307927">func</span>&nbsp;<span class="ident" id="2307932">filterIdentList</span><span class="op" id="2307947">(</span><span class="ident" id="2307948">list</span>&nbsp;<span class="op" id="2307953">[</span><span class="op" id="2307954">]</span><span class="op" id="2307955">*</span><span class="ident" id="2307956">Ident</span><span class="op" id="2307961">,</span>&nbsp;<span class="ident" id="2307963">f</span>&nbsp;<span class="ident" id="2307965">Filter</span><span class="op" id="2307971">)</span>&nbsp;<span class="op" id="2307973">[</span><span class="op" id="2307974">]</span><span class="op" id="2307975">*</span><span class="ident" id="2307976">Ident</span>&nbsp;<span class="op" id="2307982">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2307985">j</span>&nbsp;<span class="op" id="2307987">:=</span>&nbsp;<span class="num" id="2307990">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2307993">for</span>&nbsp;<span class="ident" id="2307997">_</span><span class="op" id="2307998">,</span>&nbsp;<span class="ident" id="2308000">x</span>&nbsp;<span class="op" id="2308002">:=</span>&nbsp;<span class="keyword" id="2308005">range</span>&nbsp;<span class="ident" id="2308011">list</span>&nbsp;<span class="op" id="2308016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308020">if</span>&nbsp;<span class="ident" id="2308023">f</span><span class="op" id="2308024">(</span><span class="ident" id="2308025">x</span><span class="op" id="2308026">.</span><span class="ident" id="2308027">Name</span><span class="op" id="2308031">)</span>&nbsp;<span class="op" id="2308033">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308038">list</span><span class="op" id="2308042">[</span><span class="ident" id="2308043">j</span><span class="op" id="2308044">]</span>&nbsp;<span class="op" id="2308046">=</span>&nbsp;<span class="ident" id="2308048">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308053">j</span><span class="op" id="2308054">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308059">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308065">return</span>&nbsp;<span class="ident" id="2308072">list</span><span class="op" id="2308076">[</span><span class="num" id="2308077">0</span><span class="op" id="2308078">:</span><span class="ident" id="2308079">j</span><span class="op" id="2308080">]</span><br>
<span class="lineno"></span><span class="op" id="2308082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="2308085">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2308151">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="2308218">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="2308257">//</span><br>
<span class="lineno"></span><span class="keyword" id="2308260">func</span>&nbsp;<span class="ident" id="2308265">fieldName</span><span class="op" id="2308274">(</span><span class="ident" id="2308275">x</span>&nbsp;<span class="ident" id="2308277">Expr</span><span class="op" id="2308281">)</span>&nbsp;<span class="op" id="2308283">*</span><span class="ident" id="2308284">Ident</span>&nbsp;<span class="op" id="2308290">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308293">switch</span>&nbsp;<span class="ident" id="2308300">t</span>&nbsp;<span class="op" id="2308302">:=</span>&nbsp;<span class="ident" id="2308305">x</span><span class="op" id="2308306">.</span><span class="op" id="2308307">(</span><span class="keyword" id="2308308">type</span><span class="op" id="2308312">)</span>&nbsp;<span class="op" id="2308314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308317">case</span>&nbsp;<span class="op" id="2308322">*</span><span class="ident" id="2308323">Ident</span><span class="op" id="2308328">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308332">return</span>&nbsp;<span class="ident" id="2308339">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308342">case</span>&nbsp;<span class="op" id="2308347">*</span><span class="ident" id="2308348">SelectorExpr</span><span class="op" id="2308360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308364">if</span>&nbsp;<span class="ident" id="2308367">_</span><span class="op" id="2308368">,</span>&nbsp;<span class="ident" id="2308370">ok</span>&nbsp;<span class="op" id="2308373">:=</span>&nbsp;<span class="ident" id="2308376">t</span><span class="op" id="2308377">.</span><span class="ident" id="2308378">X</span><span class="op" id="2308379">.</span><span class="op" id="2308380">(</span><span class="op" id="2308381">*</span><span class="ident" id="2308382">Ident</span><span class="op" id="2308387">)</span><span class="op" id="2308388">;</span>&nbsp;<span class="ident" id="2308390">ok</span>&nbsp;<span class="op" id="2308393">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308398">return</span>&nbsp;<span class="ident" id="2308405">t</span><span class="op" id="2308406">.</span><span class="ident" id="2308407">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308416">case</span>&nbsp;<span class="op" id="2308421">*</span><span class="ident" id="2308422">StarExpr</span><span class="op" id="2308430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308434">return</span>&nbsp;<span class="ident" id="2308441">fieldName</span><span class="op" id="2308450">(</span><span class="ident" id="2308451">t</span><span class="op" id="2308452">.</span><span class="ident" id="2308453">X</span><span class="op" id="2308454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308457">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308460">return</span>&nbsp;<span class="ident" id="2308467">nil</span><br>
<span class="lineno"></span><span class="op" id="2308471">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2308474">func</span>&nbsp;<span class="ident" id="2308479">filterFieldList</span><span class="op" id="2308494">(</span><span class="ident" id="2308495">fields</span>&nbsp;<span class="op" id="2308502">*</span><span class="ident" id="2308503">FieldList</span><span class="op" id="2308512">,</span>&nbsp;<span class="ident" id="2308514">filter</span>&nbsp;<span class="ident" id="2308521">Filter</span><span class="op" id="2308527">,</span>&nbsp;<span class="ident" id="2308529">export</span>&nbsp;<span class="builtintype" id="2308536">bool</span><span class="op" id="2308540">)</span>&nbsp;<span class="op" id="2308542">(</span><span class="ident" id="2308543">removedFields</span>&nbsp;<span class="builtintype" id="2308557">bool</span><span class="op" id="2308561">)</span>&nbsp;<span class="op" id="2308563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308566">if</span>&nbsp;<span class="ident" id="2308569">fields</span>&nbsp;<span class="op" id="2308576">==</span>&nbsp;<span class="ident" id="2308579">nil</span>&nbsp;<span class="op" id="2308583">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308587">return</span>&nbsp;<span class="builtintype" id="2308594">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308604">list</span>&nbsp;<span class="op" id="2308609">:=</span>&nbsp;<span class="ident" id="2308612">fields</span><span class="op" id="2308618">.</span><span class="ident" id="2308619">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308625">j</span>&nbsp;<span class="op" id="2308627">:=</span>&nbsp;<span class="num" id="2308630">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308633">for</span>&nbsp;<span class="ident" id="2308637">_</span><span class="op" id="2308638">,</span>&nbsp;<span class="ident" id="2308640">f</span>&nbsp;<span class="op" id="2308642">:=</span>&nbsp;<span class="keyword" id="2308645">range</span>&nbsp;<span class="ident" id="2308651">list</span>&nbsp;<span class="op" id="2308656">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308660">keepField</span>&nbsp;<span class="op" id="2308670">:=</span>&nbsp;<span class="builtintype" id="2308673">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308681">if</span>&nbsp;<span class="builtinfunc" id="2308684">len</span><span class="op" id="2308687">(</span><span class="ident" id="2308688">f</span><span class="op" id="2308689">.</span><span class="ident" id="2308690">Names</span><span class="op" id="2308695">)</span>&nbsp;<span class="op" id="2308697">==</span>&nbsp;<span class="num" id="2308700">0</span>&nbsp;<span class="op" id="2308702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2308707">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308729">name</span>&nbsp;<span class="op" id="2308734">:=</span>&nbsp;<span class="ident" id="2308737">fieldName</span><span class="op" id="2308746">(</span><span class="ident" id="2308747">f</span><span class="op" id="2308748">.</span><span class="ident" id="2308749">Type</span><span class="op" id="2308753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308758">keepField</span>&nbsp;<span class="op" id="2308768">=</span>&nbsp;<span class="ident" id="2308770">name</span>&nbsp;<span class="op" id="2308775">!=</span>&nbsp;<span class="ident" id="2308778">nil</span>&nbsp;<span class="op" id="2308782">&amp;&amp;</span>&nbsp;<span class="ident" id="2308785">filter</span><span class="op" id="2308791">(</span><span class="ident" id="2308792">name</span><span class="op" id="2308796">.</span><span class="ident" id="2308797">Name</span><span class="op" id="2308801">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308805">}</span>&nbsp;<span class="keyword" id="2308807">else</span>&nbsp;<span class="op" id="2308812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308817">n</span>&nbsp;<span class="op" id="2308819">:=</span>&nbsp;<span class="builtinfunc" id="2308822">len</span><span class="op" id="2308825">(</span><span class="ident" id="2308826">f</span><span class="op" id="2308827">.</span><span class="ident" id="2308828">Names</span><span class="op" id="2308833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308838">f</span><span class="op" id="2308839">.</span><span class="ident" id="2308840">Names</span>&nbsp;<span class="op" id="2308846">=</span>&nbsp;<span class="ident" id="2308848">filterIdentList</span><span class="op" id="2308863">(</span><span class="ident" id="2308864">f</span><span class="op" id="2308865">.</span><span class="ident" id="2308866">Names</span><span class="op" id="2308871">,</span>&nbsp;<span class="ident" id="2308873">filter</span><span class="op" id="2308879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308884">if</span>&nbsp;<span class="builtinfunc" id="2308887">len</span><span class="op" id="2308890">(</span><span class="ident" id="2308891">f</span><span class="op" id="2308892">.</span><span class="ident" id="2308893">Names</span><span class="op" id="2308898">)</span>&nbsp;<span class="op" id="2308900">&lt;</span>&nbsp;<span class="ident" id="2308902">n</span>&nbsp;<span class="op" id="2308904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308910">removedFields</span>&nbsp;<span class="op" id="2308924">=</span>&nbsp;<span class="builtintype" id="2308926">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2308939">keepField</span>&nbsp;<span class="op" id="2308949">=</span>&nbsp;<span class="builtinfunc" id="2308951">len</span><span class="op" id="2308954">(</span><span class="ident" id="2308955">f</span><span class="op" id="2308956">.</span><span class="ident" id="2308957">Names</span><span class="op" id="2308962">)</span>&nbsp;<span class="op" id="2308964">&gt;</span>&nbsp;<span class="num" id="2308966">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2308970">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308974">if</span>&nbsp;<span class="ident" id="2308977">keepField</span>&nbsp;<span class="op" id="2308987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2308992">if</span>&nbsp;<span class="ident" id="2308995">export</span>&nbsp;<span class="op" id="2309002">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309008">filterType</span><span class="op" id="2309018">(</span><span class="ident" id="2309019">f</span><span class="op" id="2309020">.</span><span class="ident" id="2309021">Type</span><span class="op" id="2309025">,</span>&nbsp;<span class="ident" id="2309027">filter</span><span class="op" id="2309033">,</span>&nbsp;<span class="ident" id="2309035">export</span><span class="op" id="2309041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309046">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309051">list</span><span class="op" id="2309055">[</span><span class="ident" id="2309056">j</span><span class="op" id="2309057">]</span>&nbsp;<span class="op" id="2309059">=</span>&nbsp;<span class="ident" id="2309061">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309066">j</span><span class="op" id="2309067">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309072">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309075">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309078">if</span>&nbsp;<span class="ident" id="2309081">j</span>&nbsp;<span class="op" id="2309083">&lt;</span>&nbsp;<span class="builtinfunc" id="2309085">len</span><span class="op" id="2309088">(</span><span class="ident" id="2309089">list</span><span class="op" id="2309093">)</span>&nbsp;<span class="op" id="2309095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309099">removedFields</span>&nbsp;<span class="op" id="2309113">=</span>&nbsp;<span class="builtintype" id="2309115">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309124">fields</span><span class="op" id="2309130">.</span><span class="ident" id="2309131">List</span>&nbsp;<span class="op" id="2309136">=</span>&nbsp;<span class="ident" id="2309138">list</span><span class="op" id="2309142">[</span><span class="num" id="2309143">0</span><span class="op" id="2309144">:</span><span class="ident" id="2309145">j</span><span class="op" id="2309146">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309149">return</span><br>
<span class="lineno"></span><span class="op" id="2309156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2309159">func</span>&nbsp;<span class="ident" id="2309164">filterParamList</span><span class="op" id="2309179">(</span><span class="ident" id="2309180">fields</span>&nbsp;<span class="op" id="2309187">*</span><span class="ident" id="2309188">FieldList</span><span class="op" id="2309197">,</span>&nbsp;<span class="ident" id="2309199">filter</span>&nbsp;<span class="ident" id="2309206">Filter</span><span class="op" id="2309212">,</span>&nbsp;<span class="ident" id="2309214">export</span>&nbsp;<span class="builtintype" id="2309221">bool</span><span class="op" id="2309225">)</span>&nbsp;<span class="builtintype" id="2309227">bool</span>&nbsp;<span class="op" id="2309232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309235">if</span>&nbsp;<span class="ident" id="2309238">fields</span>&nbsp;<span class="op" id="2309245">==</span>&nbsp;<span class="ident" id="2309248">nil</span>&nbsp;<span class="op" id="2309252">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309256">return</span>&nbsp;<span class="builtintype" id="2309263">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309273">var</span>&nbsp;<span class="ident" id="2309277">b</span>&nbsp;<span class="builtintype" id="2309279">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309285">for</span>&nbsp;<span class="ident" id="2309289">_</span><span class="op" id="2309290">,</span>&nbsp;<span class="ident" id="2309292">f</span>&nbsp;<span class="op" id="2309294">:=</span>&nbsp;<span class="keyword" id="2309297">range</span>&nbsp;<span class="ident" id="2309303">fields</span><span class="op" id="2309309">.</span><span class="ident" id="2309310">List</span>&nbsp;<span class="op" id="2309315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309319">if</span>&nbsp;<span class="ident" id="2309322">filterType</span><span class="op" id="2309332">(</span><span class="ident" id="2309333">f</span><span class="op" id="2309334">.</span><span class="ident" id="2309335">Type</span><span class="op" id="2309339">,</span>&nbsp;<span class="ident" id="2309341">filter</span><span class="op" id="2309347">,</span>&nbsp;<span class="ident" id="2309349">export</span><span class="op" id="2309355">)</span>&nbsp;<span class="op" id="2309357">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309362">b</span>&nbsp;<span class="op" id="2309364">=</span>&nbsp;<span class="builtintype" id="2309366">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309373">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309379">return</span>&nbsp;<span class="ident" id="2309386">b</span><br>
<span class="lineno"></span><span class="op" id="2309388">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="2309391">func</span>&nbsp;<span class="ident" id="2309396">filterType</span><span class="op" id="2309406">(</span><span class="ident" id="2309407">typ</span>&nbsp;<span class="ident" id="2309411">Expr</span><span class="op" id="2309415">,</span>&nbsp;<span class="ident" id="2309417">f</span>&nbsp;<span class="ident" id="2309419">Filter</span><span class="op" id="2309425">,</span>&nbsp;<span class="ident" id="2309427">export</span>&nbsp;<span class="builtintype" id="2309434">bool</span><span class="op" id="2309438">)</span>&nbsp;<span class="builtintype" id="2309440">bool</span>&nbsp;<span class="op" id="2309445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309448">switch</span>&nbsp;<span class="ident" id="2309455">t</span>&nbsp;<span class="op" id="2309457">:=</span>&nbsp;<span class="ident" id="2309460">typ</span><span class="op" id="2309463">.</span><span class="op" id="2309464">(</span><span class="keyword" id="2309465">type</span><span class="op" id="2309469">)</span>&nbsp;<span class="op" id="2309471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309474">case</span>&nbsp;<span class="op" id="2309479">*</span><span class="ident" id="2309480">Ident</span><span class="op" id="2309485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309489">return</span>&nbsp;<span class="ident" id="2309496">f</span><span class="op" id="2309497">(</span><span class="ident" id="2309498">t</span><span class="op" id="2309499">.</span><span class="ident" id="2309500">Name</span><span class="op" id="2309504">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309507">case</span>&nbsp;<span class="op" id="2309512">*</span><span class="ident" id="2309513">ParenExpr</span><span class="op" id="2309522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309526">return</span>&nbsp;<span class="ident" id="2309533">filterType</span><span class="op" id="2309543">(</span><span class="ident" id="2309544">t</span><span class="op" id="2309545">.</span><span class="ident" id="2309546">X</span><span class="op" id="2309547">,</span>&nbsp;<span class="ident" id="2309549">f</span><span class="op" id="2309550">,</span>&nbsp;<span class="ident" id="2309552">export</span><span class="op" id="2309558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309561">case</span>&nbsp;<span class="op" id="2309566">*</span><span class="ident" id="2309567">ArrayType</span><span class="op" id="2309576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309580">return</span>&nbsp;<span class="ident" id="2309587">filterType</span><span class="op" id="2309597">(</span><span class="ident" id="2309598">t</span><span class="op" id="2309599">.</span><span class="ident" id="2309600">Elt</span><span class="op" id="2309603">,</span>&nbsp;<span class="ident" id="2309605">f</span><span class="op" id="2309606">,</span>&nbsp;<span class="ident" id="2309608">export</span><span class="op" id="2309614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309617">case</span>&nbsp;<span class="op" id="2309622">*</span><span class="ident" id="2309623">StructType</span><span class="op" id="2309633">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309637">if</span>&nbsp;<span class="ident" id="2309640">filterFieldList</span><span class="op" id="2309655">(</span><span class="ident" id="2309656">t</span><span class="op" id="2309657">.</span><span class="ident" id="2309658">Fields</span><span class="op" id="2309664">,</span>&nbsp;<span class="ident" id="2309666">f</span><span class="op" id="2309667">,</span>&nbsp;<span class="ident" id="2309669">export</span><span class="op" id="2309675">)</span>&nbsp;<span class="op" id="2309677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309682">t</span><span class="op" id="2309683">.</span><span class="ident" id="2309684">Incomplete</span>&nbsp;<span class="op" id="2309695">=</span>&nbsp;<span class="builtintype" id="2309697">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309708">return</span>&nbsp;<span class="builtinfunc" id="2309715">len</span><span class="op" id="2309718">(</span><span class="ident" id="2309719">t</span><span class="op" id="2309720">.</span><span class="ident" id="2309721">Fields</span><span class="op" id="2309727">.</span><span class="ident" id="2309728">List</span><span class="op" id="2309732">)</span>&nbsp;<span class="op" id="2309734">&gt;</span>&nbsp;<span class="num" id="2309736">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309739">case</span>&nbsp;<span class="op" id="2309744">*</span><span class="ident" id="2309745">FuncType</span><span class="op" id="2309753">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309757">b1</span>&nbsp;<span class="op" id="2309760">:=</span>&nbsp;<span class="ident" id="2309763">filterParamList</span><span class="op" id="2309778">(</span><span class="ident" id="2309779">t</span><span class="op" id="2309780">.</span><span class="ident" id="2309781">Params</span><span class="op" id="2309787">,</span>&nbsp;<span class="ident" id="2309789">f</span><span class="op" id="2309790">,</span>&nbsp;<span class="ident" id="2309792">export</span><span class="op" id="2309798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309802">b2</span>&nbsp;<span class="op" id="2309805">:=</span>&nbsp;<span class="ident" id="2309808">filterParamList</span><span class="op" id="2309823">(</span><span class="ident" id="2309824">t</span><span class="op" id="2309825">.</span><span class="ident" id="2309826">Results</span><span class="op" id="2309833">,</span>&nbsp;<span class="ident" id="2309835">f</span><span class="op" id="2309836">,</span>&nbsp;<span class="ident" id="2309838">export</span><span class="op" id="2309844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309848">return</span>&nbsp;<span class="ident" id="2309855">b1</span>&nbsp;<span class="op" id="2309858">||</span>&nbsp;<span class="ident" id="2309861">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309865">case</span>&nbsp;<span class="op" id="2309870">*</span><span class="ident" id="2309871">InterfaceType</span><span class="op" id="2309884">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309888">if</span>&nbsp;<span class="ident" id="2309891">filterFieldList</span><span class="op" id="2309906">(</span><span class="ident" id="2309907">t</span><span class="op" id="2309908">.</span><span class="ident" id="2309909">Methods</span><span class="op" id="2309916">,</span>&nbsp;<span class="ident" id="2309918">f</span><span class="op" id="2309919">,</span>&nbsp;<span class="ident" id="2309921">export</span><span class="op" id="2309927">)</span>&nbsp;<span class="op" id="2309929">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2309934">t</span><span class="op" id="2309935">.</span><span class="ident" id="2309936">Incomplete</span>&nbsp;<span class="op" id="2309947">=</span>&nbsp;<span class="builtintype" id="2309949">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2309956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309960">return</span>&nbsp;<span class="builtinfunc" id="2309967">len</span><span class="op" id="2309970">(</span><span class="ident" id="2309971">t</span><span class="op" id="2309972">.</span><span class="ident" id="2309973">Methods</span><span class="op" id="2309980">.</span><span class="ident" id="2309981">List</span><span class="op" id="2309985">)</span>&nbsp;<span class="op" id="2309987">&gt;</span>&nbsp;<span class="num" id="2309989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2309992">case</span>&nbsp;<span class="op" id="2309997">*</span><span class="ident" id="2309998">MapType</span><span class="op" id="2310005">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310009">b1</span>&nbsp;<span class="op" id="2310012">:=</span>&nbsp;<span class="ident" id="2310015">filterType</span><span class="op" id="2310025">(</span><span class="ident" id="2310026">t</span><span class="op" id="2310027">.</span><span class="ident" id="2310028">Key</span><span class="op" id="2310031">,</span>&nbsp;<span class="ident" id="2310033">f</span><span class="op" id="2310034">,</span>&nbsp;<span class="ident" id="2310036">export</span><span class="op" id="2310042">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310046">b2</span>&nbsp;<span class="op" id="2310049">:=</span>&nbsp;<span class="ident" id="2310052">filterType</span><span class="op" id="2310062">(</span><span class="ident" id="2310063">t</span><span class="op" id="2310064">.</span><span class="ident" id="2310065">Value</span><span class="op" id="2310070">,</span>&nbsp;<span class="ident" id="2310072">f</span><span class="op" id="2310073">,</span>&nbsp;<span class="ident" id="2310075">export</span><span class="op" id="2310081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310085">return</span>&nbsp;<span class="ident" id="2310092">b1</span>&nbsp;<span class="op" id="2310095">||</span>&nbsp;<span class="ident" id="2310098">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310102">case</span>&nbsp;<span class="op" id="2310107">*</span><span class="ident" id="2310108">ChanType</span><span class="op" id="2310116">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310120">return</span>&nbsp;<span class="ident" id="2310127">filterType</span><span class="op" id="2310137">(</span><span class="ident" id="2310138">t</span><span class="op" id="2310139">.</span><span class="ident" id="2310140">Value</span><span class="op" id="2310145">,</span>&nbsp;<span class="ident" id="2310147">f</span><span class="op" id="2310148">,</span>&nbsp;<span class="ident" id="2310150">export</span><span class="op" id="2310156">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310159">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310162">return</span>&nbsp;<span class="builtintype" id="2310169">false</span><br>
<span class="lineno"></span><span class="op" id="2310175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2310178">func</span>&nbsp;<span class="ident" id="2310183">filterSpec</span><span class="op" id="2310193">(</span><span class="ident" id="2310194">spec</span>&nbsp;<span class="ident" id="2310199">Spec</span><span class="op" id="2310203">,</span>&nbsp;<span class="ident" id="2310205">f</span>&nbsp;<span class="ident" id="2310207">Filter</span><span class="op" id="2310213">,</span>&nbsp;<span class="ident" id="2310215">export</span>&nbsp;<span class="builtintype" id="2310222">bool</span><span class="op" id="2310226">)</span>&nbsp;<span class="builtintype" id="2310228">bool</span>&nbsp;<span class="op" id="2310233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310236">switch</span>&nbsp;<span class="ident" id="2310243">s</span>&nbsp;<span class="op" id="2310245">:=</span>&nbsp;<span class="ident" id="2310248">spec</span><span class="op" id="2310252">.</span><span class="op" id="2310253">(</span><span class="keyword" id="2310254">type</span><span class="op" id="2310258">)</span>&nbsp;<span class="op" id="2310260">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310263">case</span>&nbsp;<span class="op" id="2310268">*</span><span class="ident" id="2310269">ValueSpec</span><span class="op" id="2310278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310282">s</span><span class="op" id="2310283">.</span><span class="ident" id="2310284">Names</span>&nbsp;<span class="op" id="2310290">=</span>&nbsp;<span class="ident" id="2310292">filterIdentList</span><span class="op" id="2310307">(</span><span class="ident" id="2310308">s</span><span class="op" id="2310309">.</span><span class="ident" id="2310310">Names</span><span class="op" id="2310315">,</span>&nbsp;<span class="ident" id="2310317">f</span><span class="op" id="2310318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310322">if</span>&nbsp;<span class="builtinfunc" id="2310325">len</span><span class="op" id="2310328">(</span><span class="ident" id="2310329">s</span><span class="op" id="2310330">.</span><span class="ident" id="2310331">Names</span><span class="op" id="2310336">)</span>&nbsp;<span class="op" id="2310338">&gt;</span>&nbsp;<span class="num" id="2310340">0</span>&nbsp;<span class="op" id="2310342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310347">if</span>&nbsp;<span class="ident" id="2310350">export</span>&nbsp;<span class="op" id="2310357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310363">filterType</span><span class="op" id="2310373">(</span><span class="ident" id="2310374">s</span><span class="op" id="2310375">.</span><span class="ident" id="2310376">Type</span><span class="op" id="2310380">,</span>&nbsp;<span class="ident" id="2310382">f</span><span class="op" id="2310383">,</span>&nbsp;<span class="ident" id="2310385">export</span><span class="op" id="2310391">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310401">return</span>&nbsp;<span class="builtintype" id="2310408">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310418">case</span>&nbsp;<span class="op" id="2310423">*</span><span class="ident" id="2310424">TypeSpec</span><span class="op" id="2310432">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310436">if</span>&nbsp;<span class="ident" id="2310439">f</span><span class="op" id="2310440">(</span><span class="ident" id="2310441">s</span><span class="op" id="2310442">.</span><span class="ident" id="2310443">Name</span><span class="op" id="2310447">.</span><span class="ident" id="2310448">Name</span><span class="op" id="2310452">)</span>&nbsp;<span class="op" id="2310454">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310459">if</span>&nbsp;<span class="ident" id="2310462">export</span>&nbsp;<span class="op" id="2310469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310475">filterType</span><span class="op" id="2310485">(</span><span class="ident" id="2310486">s</span><span class="op" id="2310487">.</span><span class="ident" id="2310488">Type</span><span class="op" id="2310492">,</span>&nbsp;<span class="ident" id="2310494">f</span><span class="op" id="2310495">,</span>&nbsp;<span class="ident" id="2310497">export</span><span class="op" id="2310503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310513">return</span>&nbsp;<span class="builtintype" id="2310520">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310527">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310531">if</span>&nbsp;<span class="op" id="2310534">!</span><span class="ident" id="2310535">export</span>&nbsp;<span class="op" id="2310542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2310547">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2310595">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2310642">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2310653">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2310699">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310727">return</span>&nbsp;<span class="ident" id="2310734">filterType</span><span class="op" id="2310744">(</span><span class="ident" id="2310745">s</span><span class="op" id="2310746">.</span><span class="ident" id="2310747">Type</span><span class="op" id="2310751">,</span>&nbsp;<span class="ident" id="2310753">f</span><span class="op" id="2310754">,</span>&nbsp;<span class="ident" id="2310756">export</span><span class="op" id="2310762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310772">return</span>&nbsp;<span class="builtintype" id="2310779">false</span><br>
<span class="lineno">185</span><span class="op" id="2310785">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2310788">func</span>&nbsp;<span class="ident" id="2310793">filterSpecList</span><span class="op" id="2310807">(</span><span class="ident" id="2310808">list</span>&nbsp;<span class="op" id="2310813">[</span><span class="op" id="2310814">]</span><span class="ident" id="2310815">Spec</span><span class="op" id="2310819">,</span>&nbsp;<span class="ident" id="2310821">f</span>&nbsp;<span class="ident" id="2310823">Filter</span><span class="op" id="2310829">,</span>&nbsp;<span class="ident" id="2310831">export</span>&nbsp;<span class="builtintype" id="2310838">bool</span><span class="op" id="2310842">)</span>&nbsp;<span class="op" id="2310844">[</span><span class="op" id="2310845">]</span><span class="ident" id="2310846">Spec</span>&nbsp;<span class="op" id="2310851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310854">j</span>&nbsp;<span class="op" id="2310856">:=</span>&nbsp;<span class="num" id="2310859">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310862">for</span>&nbsp;<span class="ident" id="2310866">_</span><span class="op" id="2310867">,</span>&nbsp;<span class="ident" id="2310869">s</span>&nbsp;<span class="op" id="2310871">:=</span>&nbsp;<span class="keyword" id="2310874">range</span>&nbsp;<span class="ident" id="2310880">list</span>&nbsp;<span class="op" id="2310885">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310889">if</span>&nbsp;<span class="ident" id="2310892">filterSpec</span><span class="op" id="2310902">(</span><span class="ident" id="2310903">s</span><span class="op" id="2310904">,</span>&nbsp;<span class="ident" id="2310906">f</span><span class="op" id="2310907">,</span>&nbsp;<span class="ident" id="2310909">export</span><span class="op" id="2310915">)</span>&nbsp;<span class="op" id="2310917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310922">list</span><span class="op" id="2310926">[</span><span class="ident" id="2310927">j</span><span class="op" id="2310928">]</span>&nbsp;<span class="op" id="2310930">=</span>&nbsp;<span class="ident" id="2310932">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2310937">j</span><span class="op" id="2310938">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2310946">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2310949">return</span>&nbsp;<span class="ident" id="2310956">list</span><span class="op" id="2310960">[</span><span class="num" id="2310961">0</span><span class="op" id="2310962">:</span><span class="ident" id="2310963">j</span><span class="op" id="2310964">]</span><br>
<span class="lineno"></span><span class="op" id="2310966">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2310969">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="2311039">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="2311108">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="2311175">//</span><br>
<span class="lineno"></span><span class="comment" id="2311178">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="2311248">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2311290">//</span><br>
<span class="lineno">205</span><span class="keyword" id="2311293">func</span>&nbsp;<span class="ident" id="2311298">FilterDecl</span><span class="op" id="2311308">(</span><span class="ident" id="2311309">decl</span>&nbsp;<span class="ident" id="2311314">Decl</span><span class="op" id="2311318">,</span>&nbsp;<span class="ident" id="2311320">f</span>&nbsp;<span class="ident" id="2311322">Filter</span><span class="op" id="2311328">)</span>&nbsp;<span class="builtintype" id="2311330">bool</span>&nbsp;<span class="op" id="2311335">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311338">return</span>&nbsp;<span class="ident" id="2311345">filterDecl</span><span class="op" id="2311355">(</span><span class="ident" id="2311356">decl</span><span class="op" id="2311360">,</span>&nbsp;<span class="ident" id="2311362">f</span><span class="op" id="2311363">,</span>&nbsp;<span class="builtintype" id="2311365">false</span><span class="op" id="2311370">)</span><br>
<span class="lineno"></span><span class="op" id="2311372">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2311375">func</span>&nbsp;<span class="ident" id="2311380">filterDecl</span><span class="op" id="2311390">(</span><span class="ident" id="2311391">decl</span>&nbsp;<span class="ident" id="2311396">Decl</span><span class="op" id="2311400">,</span>&nbsp;<span class="ident" id="2311402">f</span>&nbsp;<span class="ident" id="2311404">Filter</span><span class="op" id="2311410">,</span>&nbsp;<span class="ident" id="2311412">export</span>&nbsp;<span class="builtintype" id="2311419">bool</span><span class="op" id="2311423">)</span>&nbsp;<span class="builtintype" id="2311425">bool</span>&nbsp;<span class="op" id="2311430">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311433">switch</span>&nbsp;<span class="ident" id="2311440">d</span>&nbsp;<span class="op" id="2311442">:=</span>&nbsp;<span class="ident" id="2311445">decl</span><span class="op" id="2311449">.</span><span class="op" id="2311450">(</span><span class="keyword" id="2311451">type</span><span class="op" id="2311455">)</span>&nbsp;<span class="op" id="2311457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311460">case</span>&nbsp;<span class="op" id="2311465">*</span><span class="ident" id="2311466">GenDecl</span><span class="op" id="2311473">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2311477">d</span><span class="op" id="2311478">.</span><span class="ident" id="2311479">Specs</span>&nbsp;<span class="op" id="2311485">=</span>&nbsp;<span class="ident" id="2311487">filterSpecList</span><span class="op" id="2311501">(</span><span class="ident" id="2311502">d</span><span class="op" id="2311503">.</span><span class="ident" id="2311504">Specs</span><span class="op" id="2311509">,</span>&nbsp;<span class="ident" id="2311511">f</span><span class="op" id="2311512">,</span>&nbsp;<span class="ident" id="2311514">export</span><span class="op" id="2311520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311524">return</span>&nbsp;<span class="builtinfunc" id="2311531">len</span><span class="op" id="2311534">(</span><span class="ident" id="2311535">d</span><span class="op" id="2311536">.</span><span class="ident" id="2311537">Specs</span><span class="op" id="2311542">)</span>&nbsp;<span class="op" id="2311544">&gt;</span>&nbsp;<span class="num" id="2311546">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311549">case</span>&nbsp;<span class="op" id="2311554">*</span><span class="ident" id="2311555">FuncDecl</span><span class="op" id="2311563">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311567">return</span>&nbsp;<span class="ident" id="2311574">f</span><span class="op" id="2311575">(</span><span class="ident" id="2311576">d</span><span class="op" id="2311577">.</span><span class="ident" id="2311578">Name</span><span class="op" id="2311582">.</span><span class="ident" id="2311583">Name</span><span class="op" id="2311587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2311590">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2311593">return</span>&nbsp;<span class="builtintype" id="2311600">false</span><br>
<span class="lineno"></span><span class="op" id="2311606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="2311609">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="2311676">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2311741">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="2311809">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="2311879">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="2311946">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="2311965">//</span><br>
<span class="lineno"></span><span class="comment" id="2311968">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="2312035">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2312088">//</span><br>
<span class="lineno">230</span><span class="keyword" id="2312091">func</span>&nbsp;<span class="ident" id="2312096">FilterFile</span><span class="op" id="2312106">(</span><span class="ident" id="2312107">src</span>&nbsp;<span class="op" id="2312111">*</span><span class="ident" id="2312112">File</span><span class="op" id="2312116">,</span>&nbsp;<span class="ident" id="2312118">f</span>&nbsp;<span class="ident" id="2312120">Filter</span><span class="op" id="2312126">)</span>&nbsp;<span class="builtintype" id="2312128">bool</span>&nbsp;<span class="op" id="2312133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312136">return</span>&nbsp;<span class="ident" id="2312143">filterFile</span><span class="op" id="2312153">(</span><span class="ident" id="2312154">src</span><span class="op" id="2312157">,</span>&nbsp;<span class="ident" id="2312159">f</span><span class="op" id="2312160">,</span>&nbsp;<span class="builtintype" id="2312162">false</span><span class="op" id="2312167">)</span><br>
<span class="lineno"></span><span class="op" id="2312169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2312172">func</span>&nbsp;<span class="ident" id="2312177">filterFile</span><span class="op" id="2312187">(</span><span class="ident" id="2312188">src</span>&nbsp;<span class="op" id="2312192">*</span><span class="ident" id="2312193">File</span><span class="op" id="2312197">,</span>&nbsp;<span class="ident" id="2312199">f</span>&nbsp;<span class="ident" id="2312201">Filter</span><span class="op" id="2312207">,</span>&nbsp;<span class="ident" id="2312209">export</span>&nbsp;<span class="builtintype" id="2312216">bool</span><span class="op" id="2312220">)</span>&nbsp;<span class="builtintype" id="2312222">bool</span>&nbsp;<span class="op" id="2312227">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312230">j</span>&nbsp;<span class="op" id="2312232">:=</span>&nbsp;<span class="num" id="2312235">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312238">for</span>&nbsp;<span class="ident" id="2312242">_</span><span class="op" id="2312243">,</span>&nbsp;<span class="ident" id="2312245">d</span>&nbsp;<span class="op" id="2312247">:=</span>&nbsp;<span class="keyword" id="2312250">range</span>&nbsp;<span class="ident" id="2312256">src</span><span class="op" id="2312259">.</span><span class="ident" id="2312260">Decls</span>&nbsp;<span class="op" id="2312266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312270">if</span>&nbsp;<span class="ident" id="2312273">filterDecl</span><span class="op" id="2312283">(</span><span class="ident" id="2312284">d</span><span class="op" id="2312285">,</span>&nbsp;<span class="ident" id="2312287">f</span><span class="op" id="2312288">,</span>&nbsp;<span class="ident" id="2312290">export</span><span class="op" id="2312296">)</span>&nbsp;<span class="op" id="2312298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312303">src</span><span class="op" id="2312306">.</span><span class="ident" id="2312307">Decls</span><span class="op" id="2312312">[</span><span class="ident" id="2312313">j</span><span class="op" id="2312314">]</span>&nbsp;<span class="op" id="2312316">=</span>&nbsp;<span class="ident" id="2312318">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312323">j</span><span class="op" id="2312324">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2312332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2312335">src</span><span class="op" id="2312338">.</span><span class="ident" id="2312339">Decls</span>&nbsp;<span class="op" id="2312345">=</span>&nbsp;<span class="ident" id="2312347">src</span><span class="op" id="2312350">.</span><span class="ident" id="2312351">Decls</span><span class="op" id="2312356">[</span><span class="num" id="2312357">0</span><span class="op" id="2312358">:</span><span class="ident" id="2312359">j</span><span class="op" id="2312360">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312363">return</span>&nbsp;<span class="ident" id="2312370">j</span>&nbsp;<span class="op" id="2312372">&gt;</span>&nbsp;<span class="num" id="2312374">0</span><br>
<span class="lineno"></span><span class="op" id="2312376">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="2312379">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="2312448">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2312517">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="2312585">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="2312655">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="2312725">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="2312797">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="2312806">//</span><br>
<span class="lineno"></span><span class="comment" id="2312809">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="2312879">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="2312932">//</span><br>
<span class="lineno"></span><span class="keyword" id="2312935">func</span>&nbsp;<span class="ident" id="2312940">FilterPackage</span><span class="op" id="2312953">(</span><span class="ident" id="2312954">pkg</span>&nbsp;<span class="op" id="2312958">*</span><span class="ident" id="2312959">Package</span><span class="op" id="2312966">,</span>&nbsp;<span class="ident" id="2312968">f</span>&nbsp;<span class="ident" id="2312970">Filter</span><span class="op" id="2312976">)</span>&nbsp;<span class="builtintype" id="2312978">bool</span>&nbsp;<span class="op" id="2312983">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2312986">return</span>&nbsp;<span class="ident" id="2312993">filterPackage</span><span class="op" id="2313006">(</span><span class="ident" id="2313007">pkg</span><span class="op" id="2313010">,</span>&nbsp;<span class="ident" id="2313012">f</span><span class="op" id="2313013">,</span>&nbsp;<span class="builtintype" id="2313015">false</span><span class="op" id="2313020">)</span><br>
<span class="lineno"></span><span class="op" id="2313022">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="2313025">func</span>&nbsp;<span class="ident" id="2313030">filterPackage</span><span class="op" id="2313043">(</span><span class="ident" id="2313044">pkg</span>&nbsp;<span class="op" id="2313048">*</span><span class="ident" id="2313049">Package</span><span class="op" id="2313056">,</span>&nbsp;<span class="ident" id="2313058">f</span>&nbsp;<span class="ident" id="2313060">Filter</span><span class="op" id="2313066">,</span>&nbsp;<span class="ident" id="2313068">export</span>&nbsp;<span class="builtintype" id="2313075">bool</span><span class="op" id="2313079">)</span>&nbsp;<span class="builtintype" id="2313081">bool</span>&nbsp;<span class="op" id="2313086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2313089">hasDecls</span>&nbsp;<span class="op" id="2313098">:=</span>&nbsp;<span class="builtintype" id="2313101">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2313108">for</span>&nbsp;<span class="ident" id="2313112">_</span><span class="op" id="2313113">,</span>&nbsp;<span class="ident" id="2313115">src</span>&nbsp;<span class="op" id="2313119">:=</span>&nbsp;<span class="keyword" id="2313122">range</span>&nbsp;<span class="ident" id="2313128">pkg</span><span class="op" id="2313131">.</span><span class="ident" id="2313132">Files</span>&nbsp;<span class="op" id="2313138">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2313142">if</span>&nbsp;<span class="ident" id="2313145">filterFile</span><span class="op" id="2313155">(</span><span class="ident" id="2313156">src</span><span class="op" id="2313159">,</span>&nbsp;<span class="ident" id="2313161">f</span><span class="op" id="2313162">,</span>&nbsp;<span class="ident" id="2313164">export</span><span class="op" id="2313170">)</span>&nbsp;<span class="op" id="2313172">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2313177">hasDecls</span>&nbsp;<span class="op" id="2313186">=</span>&nbsp;<span class="builtintype" id="2313188">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2313195">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2313198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2313201">return</span>&nbsp;<span class="ident" id="2313208">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="2313217">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="2313220">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="2313300">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2313329">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="2313395">type</span>&nbsp;<span class="ident" id="2313400">MergeMode</span>&nbsp;<span class="builtintype" id="2313410">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2313416">const</span>&nbsp;<span class="op" id="2313422">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2313425">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2313483">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="2313504">MergeMode</span>&nbsp;<span class="op" id="2313514">=</span>&nbsp;<span class="num" id="2313516">1</span>&nbsp;<span class="op" id="2313518">&lt;&lt;</span>&nbsp;<span class="ident" id="2313521">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2313527">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2313588">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2313635">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2313663">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2313719">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="2313742">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2313745">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="2313811">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2313878">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="2313922">//</span><br>
<span class="lineno"></span><span class="keyword" id="2313925">func</span>&nbsp;<span class="ident" id="2313930">nameOf</span><span class="op" id="2313936">(</span><span class="ident" id="2313937">f</span>&nbsp;<span class="op" id="2313939">*</span><span class="ident" id="2313940">FuncDecl</span><span class="op" id="2313948">)</span>&nbsp;<span class="builtintype" id="2313950">string</span>&nbsp;<span class="op" id="2313957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2313960">if</span>&nbsp;<span class="ident" id="2313963">r</span>&nbsp;<span class="op" id="2313965">:=</span>&nbsp;<span class="ident" id="2313968">f</span><span class="op" id="2313969">.</span><span class="ident" id="2313970">Recv</span><span class="op" id="2313974">;</span>&nbsp;<span class="ident" id="2313976">r</span>&nbsp;<span class="op" id="2313978">!=</span>&nbsp;<span class="ident" id="2313981">nil</span>&nbsp;<span class="op" id="2313985">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2313988">len</span><span class="op" id="2313991">(</span><span class="ident" id="2313992">r</span><span class="op" id="2313993">.</span><span class="ident" id="2313994">List</span><span class="op" id="2313998">)</span>&nbsp;<span class="op" id="2314000">==</span>&nbsp;<span class="num" id="2314003">1</span>&nbsp;<span class="op" id="2314005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314009">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2314056">t</span>&nbsp;<span class="op" id="2314058">:=</span>&nbsp;<span class="ident" id="2314061">r</span><span class="op" id="2314062">.</span><span class="ident" id="2314063">List</span><span class="op" id="2314067">[</span><span class="num" id="2314068">0</span><span class="op" id="2314069">]</span><span class="op" id="2314070">.</span><span class="ident" id="2314071">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314078">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2314118">if</span>&nbsp;<span class="ident" id="2314121">p</span><span class="op" id="2314122">,</span>&nbsp;<span class="ident" id="2314124">_</span>&nbsp;<span class="op" id="2314126">:=</span>&nbsp;<span class="ident" id="2314129">t</span><span class="op" id="2314130">.</span><span class="op" id="2314131">(</span><span class="op" id="2314132">*</span><span class="ident" id="2314133">StarExpr</span><span class="op" id="2314141">)</span><span class="op" id="2314142">;</span>&nbsp;<span class="ident" id="2314144">p</span>&nbsp;<span class="op" id="2314146">!=</span>&nbsp;<span class="ident" id="2314149">nil</span>&nbsp;<span class="op" id="2314153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2314158">t</span>&nbsp;<span class="op" id="2314160">=</span>&nbsp;<span class="ident" id="2314162">p</span><span class="op" id="2314163">.</span><span class="ident" id="2314164">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2314168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314172">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2314215">if</span>&nbsp;<span class="ident" id="2314218">p</span><span class="op" id="2314219">,</span>&nbsp;<span class="ident" id="2314221">_</span>&nbsp;<span class="op" id="2314223">:=</span>&nbsp;<span class="ident" id="2314226">t</span><span class="op" id="2314227">.</span><span class="op" id="2314228">(</span><span class="op" id="2314229">*</span><span class="ident" id="2314230">Ident</span><span class="op" id="2314235">)</span><span class="op" id="2314236">;</span>&nbsp;<span class="ident" id="2314238">p</span>&nbsp;<span class="op" id="2314240">!=</span>&nbsp;<span class="ident" id="2314243">nil</span>&nbsp;<span class="op" id="2314247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2314252">return</span>&nbsp;<span class="ident" id="2314259">p</span><span class="op" id="2314260">.</span><span class="ident" id="2314261">Name</span>&nbsp;<span class="op" id="2314266">+</span>&nbsp;<span class="string" id="2314268">&#34;.&#34;</span>&nbsp;<span class="op" id="2314272">+</span>&nbsp;<span class="ident" id="2314274">f</span><span class="op" id="2314275">.</span><span class="ident" id="2314276">Name</span><span class="op" id="2314280">.</span><span class="ident" id="2314281">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2314288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314292">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2314332">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2314335">return</span>&nbsp;<span class="ident" id="2314342">f</span><span class="op" id="2314343">.</span><span class="ident" id="2314344">Name</span><span class="op" id="2314348">.</span><span class="ident" id="2314349">Name</span><br>
<span class="lineno"></span><span class="op" id="2314354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2314357">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="2314428">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="2314503">//</span><br>
<span class="lineno"></span><span class="keyword" id="2314506">var</span>&nbsp;<span class="ident" id="2314510">separator</span>&nbsp;<span class="op" id="2314520">=</span>&nbsp;<span class="op" id="2314522">&amp;</span><span class="ident" id="2314523">Comment</span><span class="op" id="2314530">{</span><span class="ident" id="2314531">token</span><span class="op" id="2314536">.</span><span class="ident" id="2314537">NoPos</span><span class="op" id="2314542">,</span>&nbsp;<span class="string" id="2314544">&#34;//&#34;</span><span class="op" id="2314548">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2314551">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2314618">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="2314692">//</span><br>
<span class="lineno"></span><span class="keyword" id="2314695">func</span>&nbsp;<span class="ident" id="2314700">MergePackageFiles</span><span class="op" id="2314717">(</span><span class="ident" id="2314718">pkg</span>&nbsp;<span class="op" id="2314722">*</span><span class="ident" id="2314723">Package</span><span class="op" id="2314730">,</span>&nbsp;<span class="ident" id="2314732">mode</span>&nbsp;<span class="ident" id="2314737">MergeMode</span><span class="op" id="2314746">)</span>&nbsp;<span class="op" id="2314748">*</span><span class="ident" id="2314749">File</span>&nbsp;<span class="op" id="2314754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314757">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314828">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2314899">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2314963">ndocs</span>&nbsp;<span class="op" id="2314969">:=</span>&nbsp;<span class="num" id="2314972">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2314975">ncomments</span>&nbsp;<span class="op" id="2314985">:=</span>&nbsp;<span class="num" id="2314988">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2314991">ndecls</span>&nbsp;<span class="op" id="2314998">:=</span>&nbsp;<span class="num" id="2315001">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315004">filenames</span>&nbsp;<span class="op" id="2315014">:=</span>&nbsp;<span class="builtinfunc" id="2315017">make</span><span class="op" id="2315021">(</span><span class="op" id="2315022">[</span><span class="op" id="2315023">]</span><span class="builtintype" id="2315024">string</span><span class="op" id="2315030">,</span>&nbsp;<span class="builtinfunc" id="2315032">len</span><span class="op" id="2315035">(</span><span class="ident" id="2315036">pkg</span><span class="op" id="2315039">.</span><span class="ident" id="2315040">Files</span><span class="op" id="2315045">)</span><span class="op" id="2315046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315049">i</span>&nbsp;<span class="op" id="2315051">:=</span>&nbsp;<span class="num" id="2315054">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315057">for</span>&nbsp;<span class="ident" id="2315061">filename</span><span class="op" id="2315069">,</span>&nbsp;<span class="ident" id="2315071">f</span>&nbsp;<span class="op" id="2315073">:=</span>&nbsp;<span class="keyword" id="2315076">range</span>&nbsp;<span class="ident" id="2315082">pkg</span><span class="op" id="2315085">.</span><span class="ident" id="2315086">Files</span>&nbsp;<span class="op" id="2315092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315096">filenames</span><span class="op" id="2315105">[</span><span class="ident" id="2315106">i</span><span class="op" id="2315107">]</span>&nbsp;<span class="op" id="2315109">=</span>&nbsp;<span class="ident" id="2315111">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315122">i</span><span class="op" id="2315123">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315128">if</span>&nbsp;<span class="ident" id="2315131">f</span><span class="op" id="2315132">.</span><span class="ident" id="2315133">Doc</span>&nbsp;<span class="op" id="2315137">!=</span>&nbsp;<span class="ident" id="2315140">nil</span>&nbsp;<span class="op" id="2315144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315149">ndocs</span>&nbsp;<span class="op" id="2315155">+=</span>&nbsp;<span class="builtinfunc" id="2315158">len</span><span class="op" id="2315161">(</span><span class="ident" id="2315162">f</span><span class="op" id="2315163">.</span><span class="ident" id="2315164">Doc</span><span class="op" id="2315167">.</span><span class="ident" id="2315168">List</span><span class="op" id="2315172">)</span>&nbsp;<span class="op" id="2315174">+</span>&nbsp;<span class="num" id="2315176">1</span>&nbsp;<span class="comment" id="2315178">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2315200">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315204">ncomments</span>&nbsp;<span class="op" id="2315214">+=</span>&nbsp;<span class="builtinfunc" id="2315217">len</span><span class="op" id="2315220">(</span><span class="ident" id="2315221">f</span><span class="op" id="2315222">.</span><span class="ident" id="2315223">Comments</span><span class="op" id="2315231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315235">ndecls</span>&nbsp;<span class="op" id="2315242">+=</span>&nbsp;<span class="builtinfunc" id="2315245">len</span><span class="op" id="2315248">(</span><span class="ident" id="2315249">f</span><span class="op" id="2315250">.</span><span class="ident" id="2315251">Decls</span><span class="op" id="2315256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2315259">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315262">sort</span><span class="op" id="2315266">.</span><span class="ident" id="2315267">Strings</span><span class="op" id="2315274">(</span><span class="ident" id="2315275">filenames</span><span class="op" id="2315284">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315288">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315354">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315421">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315488">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315554">var</span>&nbsp;<span class="ident" id="2315558">doc</span>&nbsp;<span class="op" id="2315562">*</span><span class="ident" id="2315563">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315577">var</span>&nbsp;<span class="ident" id="2315581">pos</span>&nbsp;<span class="ident" id="2315585">token</span><span class="op" id="2315590">.</span><span class="ident" id="2315591">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315596">if</span>&nbsp;<span class="ident" id="2315599">ndocs</span>&nbsp;<span class="op" id="2315605">&gt;</span>&nbsp;<span class="num" id="2315607">0</span>&nbsp;<span class="op" id="2315609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315613">list</span>&nbsp;<span class="op" id="2315618">:=</span>&nbsp;<span class="builtinfunc" id="2315621">make</span><span class="op" id="2315625">(</span><span class="op" id="2315626">[</span><span class="op" id="2315627">]</span><span class="op" id="2315628">*</span><span class="ident" id="2315629">Comment</span><span class="op" id="2315636">,</span>&nbsp;<span class="ident" id="2315638">ndocs</span><span class="op" id="2315643">-</span><span class="num" id="2315644">1</span><span class="op" id="2315645">)</span>&nbsp;<span class="comment" id="2315647">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315688">i</span>&nbsp;<span class="op" id="2315690">:=</span>&nbsp;<span class="num" id="2315693">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315697">for</span>&nbsp;<span class="ident" id="2315701">_</span><span class="op" id="2315702">,</span>&nbsp;<span class="ident" id="2315704">filename</span>&nbsp;<span class="op" id="2315713">:=</span>&nbsp;<span class="keyword" id="2315716">range</span>&nbsp;<span class="ident" id="2315722">filenames</span>&nbsp;<span class="op" id="2315732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315737">f</span>&nbsp;<span class="op" id="2315739">:=</span>&nbsp;<span class="ident" id="2315742">pkg</span><span class="op" id="2315745">.</span><span class="ident" id="2315746">Files</span><span class="op" id="2315751">[</span><span class="ident" id="2315752">filename</span><span class="op" id="2315760">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315765">if</span>&nbsp;<span class="ident" id="2315768">f</span><span class="op" id="2315769">.</span><span class="ident" id="2315770">Doc</span>&nbsp;<span class="op" id="2315774">!=</span>&nbsp;<span class="ident" id="2315777">nil</span>&nbsp;<span class="op" id="2315781">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315787">if</span>&nbsp;<span class="ident" id="2315790">i</span>&nbsp;<span class="op" id="2315792">&gt;</span>&nbsp;<span class="num" id="2315794">0</span>&nbsp;<span class="op" id="2315796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315803">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315847">list</span><span class="op" id="2315851">[</span><span class="ident" id="2315852">i</span><span class="op" id="2315853">]</span>&nbsp;<span class="op" id="2315855">=</span>&nbsp;<span class="ident" id="2315857">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315872">i</span><span class="op" id="2315873">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2315880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315886">for</span>&nbsp;<span class="ident" id="2315890">_</span><span class="op" id="2315891">,</span>&nbsp;<span class="ident" id="2315893">c</span>&nbsp;<span class="op" id="2315895">:=</span>&nbsp;<span class="keyword" id="2315898">range</span>&nbsp;<span class="ident" id="2315904">f</span><span class="op" id="2315905">.</span><span class="ident" id="2315906">Doc</span><span class="op" id="2315909">.</span><span class="ident" id="2315910">List</span>&nbsp;<span class="op" id="2315915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315922">list</span><span class="op" id="2315926">[</span><span class="ident" id="2315927">i</span><span class="op" id="2315928">]</span>&nbsp;<span class="op" id="2315930">=</span>&nbsp;<span class="ident" id="2315932">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2315939">i</span><span class="op" id="2315940">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2315947">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2315953">if</span>&nbsp;<span class="ident" id="2315956">f</span><span class="op" id="2315957">.</span><span class="ident" id="2315958">Package</span>&nbsp;<span class="op" id="2315966">&gt;</span>&nbsp;<span class="ident" id="2315968">pos</span>&nbsp;<span class="op" id="2315972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2315979">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316031">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316085">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316100">pos</span>&nbsp;<span class="op" id="2316104">=</span>&nbsp;<span class="ident" id="2316106">f</span><span class="op" id="2316107">.</span><span class="ident" id="2316108">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316129">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316133">doc</span>&nbsp;<span class="op" id="2316137">=</span>&nbsp;<span class="op" id="2316139">&amp;</span><span class="ident" id="2316140">CommentGroup</span><span class="op" id="2316152">{</span><span class="ident" id="2316153">list</span><span class="op" id="2316157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2316160">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316164">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316213">var</span>&nbsp;<span class="ident" id="2316217">decls</span>&nbsp;<span class="op" id="2316223">[</span><span class="op" id="2316224">]</span><span class="ident" id="2316225">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316231">if</span>&nbsp;<span class="ident" id="2316234">ndecls</span>&nbsp;<span class="op" id="2316241">&gt;</span>&nbsp;<span class="num" id="2316243">0</span>&nbsp;<span class="op" id="2316245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316249">decls</span>&nbsp;<span class="op" id="2316255">=</span>&nbsp;<span class="builtinfunc" id="2316257">make</span><span class="op" id="2316261">(</span><span class="op" id="2316262">[</span><span class="op" id="2316263">]</span><span class="ident" id="2316264">Decl</span><span class="op" id="2316268">,</span>&nbsp;<span class="ident" id="2316270">ndecls</span><span class="op" id="2316276">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316280">funcs</span>&nbsp;<span class="op" id="2316286">:=</span>&nbsp;<span class="builtinfunc" id="2316289">make</span><span class="op" id="2316293">(</span><span class="keyword" id="2316294">map</span><span class="op" id="2316297">[</span><span class="builtintype" id="2316298">string</span><span class="op" id="2316304">]</span><span class="builtintype" id="2316305">int</span><span class="op" id="2316308">)</span>&nbsp;<span class="comment" id="2316310">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316347">i</span>&nbsp;<span class="op" id="2316349">:=</span>&nbsp;<span class="num" id="2316352">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2316377">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316396">n</span>&nbsp;<span class="op" id="2316398">:=</span>&nbsp;<span class="num" id="2316401">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2316426">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316458">for</span>&nbsp;<span class="ident" id="2316462">_</span><span class="op" id="2316463">,</span>&nbsp;<span class="ident" id="2316465">filename</span>&nbsp;<span class="op" id="2316474">:=</span>&nbsp;<span class="keyword" id="2316477">range</span>&nbsp;<span class="ident" id="2316483">filenames</span>&nbsp;<span class="op" id="2316493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2316498">f</span>&nbsp;<span class="op" id="2316500">:=</span>&nbsp;<span class="ident" id="2316503">pkg</span><span class="op" id="2316506">.</span><span class="ident" id="2316507">Files</span><span class="op" id="2316512">[</span><span class="ident" id="2316513">filename</span><span class="op" id="2316521">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316526">for</span>&nbsp;<span class="ident" id="2316530">_</span><span class="op" id="2316531">,</span>&nbsp;<span class="ident" id="2316533">d</span>&nbsp;<span class="op" id="2316535">:=</span>&nbsp;<span class="keyword" id="2316538">range</span>&nbsp;<span class="ident" id="2316544">f</span><span class="op" id="2316545">.</span><span class="ident" id="2316546">Decls</span>&nbsp;<span class="op" id="2316552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2316558">if</span>&nbsp;<span class="ident" id="2316561">mode</span><span class="op" id="2316565">&amp;</span><span class="ident" id="2316566">FilterFuncDuplicates</span>&nbsp;<span class="op" id="2316587">!=</span>&nbsp;<span class="num" id="2316590">0</span>&nbsp;<span class="op" id="2316592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316599">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316650">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316700">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316748">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316798">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316851">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316859">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2316960">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317013">if</span>&nbsp;<span class="ident" id="2317016">f</span><span class="op" id="2317017">,</span>&nbsp;<span class="ident" id="2317019">isFun</span>&nbsp;<span class="op" id="2317025">:=</span>&nbsp;<span class="ident" id="2317028">d</span><span class="op" id="2317029">.</span><span class="op" id="2317030">(</span><span class="op" id="2317031">*</span><span class="ident" id="2317032">FuncDecl</span><span class="op" id="2317040">)</span><span class="op" id="2317041">;</span>&nbsp;<span class="ident" id="2317043">isFun</span>&nbsp;<span class="op" id="2317049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317057">name</span>&nbsp;<span class="op" id="2317062">:=</span>&nbsp;<span class="ident" id="2317065">nameOf</span><span class="op" id="2317071">(</span><span class="ident" id="2317072">f</span><span class="op" id="2317073">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317081">if</span>&nbsp;<span class="ident" id="2317084">j</span><span class="op" id="2317085">,</span>&nbsp;<span class="ident" id="2317087">exists</span>&nbsp;<span class="op" id="2317094">:=</span>&nbsp;<span class="ident" id="2317097">funcs</span><span class="op" id="2317102">[</span><span class="ident" id="2317103">name</span><span class="op" id="2317107">]</span><span class="op" id="2317108">;</span>&nbsp;<span class="ident" id="2317110">exists</span>&nbsp;<span class="op" id="2317117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317126">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317162">if</span>&nbsp;<span class="ident" id="2317165">decls</span><span class="op" id="2317170">[</span><span class="ident" id="2317171">j</span><span class="op" id="2317172">]</span>&nbsp;<span class="op" id="2317174">!=</span>&nbsp;<span class="ident" id="2317177">nil</span>&nbsp;<span class="op" id="2317181">&amp;&amp;</span>&nbsp;<span class="ident" id="2317184">decls</span><span class="op" id="2317189">[</span><span class="ident" id="2317190">j</span><span class="op" id="2317191">]</span><span class="op" id="2317192">.</span><span class="op" id="2317193">(</span><span class="op" id="2317194">*</span><span class="ident" id="2317195">FuncDecl</span><span class="op" id="2317203">)</span><span class="op" id="2317204">.</span><span class="ident" id="2317205">Doc</span>&nbsp;<span class="op" id="2317209">==</span>&nbsp;<span class="ident" id="2317212">nil</span>&nbsp;<span class="op" id="2317216">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317226">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317280">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317323">decls</span><span class="op" id="2317328">[</span><span class="ident" id="2317329">j</span><span class="op" id="2317330">]</span>&nbsp;<span class="op" id="2317332">=</span>&nbsp;<span class="ident" id="2317334">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317345">}</span>&nbsp;<span class="keyword" id="2317347">else</span>&nbsp;<span class="op" id="2317352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317362">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317400">d</span>&nbsp;<span class="op" id="2317402">=</span>&nbsp;<span class="ident" id="2317404">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317415">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317424">n</span><span class="op" id="2317425">++</span>&nbsp;<span class="comment" id="2317428">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317455">}</span>&nbsp;<span class="keyword" id="2317457">else</span>&nbsp;<span class="op" id="2317462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317471">funcs</span><span class="op" id="2317476">[</span><span class="ident" id="2317477">name</span><span class="op" id="2317481">]</span>&nbsp;<span class="op" id="2317483">=</span>&nbsp;<span class="ident" id="2317485">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317500">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317506">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317512">decls</span><span class="op" id="2317517">[</span><span class="ident" id="2317518">i</span><span class="op" id="2317519">]</span>&nbsp;<span class="op" id="2317521">=</span>&nbsp;<span class="ident" id="2317523">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317529">i</span><span class="op" id="2317530">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317540">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317545">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317608">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317675">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317742">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317807">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317840">if</span>&nbsp;<span class="ident" id="2317843">n</span>&nbsp;<span class="op" id="2317845">&gt;</span>&nbsp;<span class="num" id="2317847">0</span>&nbsp;<span class="op" id="2317849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317854">i</span>&nbsp;<span class="op" id="2317856">=</span>&nbsp;<span class="num" id="2317858">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317863">for</span>&nbsp;<span class="ident" id="2317867">_</span><span class="op" id="2317868">,</span>&nbsp;<span class="ident" id="2317870">d</span>&nbsp;<span class="op" id="2317872">:=</span>&nbsp;<span class="keyword" id="2317875">range</span>&nbsp;<span class="ident" id="2317881">decls</span>&nbsp;<span class="op" id="2317887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2317893">if</span>&nbsp;<span class="ident" id="2317896">d</span>&nbsp;<span class="op" id="2317898">!=</span>&nbsp;<span class="ident" id="2317901">nil</span>&nbsp;<span class="op" id="2317905">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317912">decls</span><span class="op" id="2317917">[</span><span class="ident" id="2317918">i</span><span class="op" id="2317919">]</span>&nbsp;<span class="op" id="2317921">=</span>&nbsp;<span class="ident" id="2317923">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317930">i</span><span class="op" id="2317931">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317943">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2317948">decls</span>&nbsp;<span class="op" id="2317954">=</span>&nbsp;<span class="ident" id="2317956">decls</span><span class="op" id="2317961">[</span><span class="num" id="2317962">0</span><span class="op" id="2317963">:</span><span class="ident" id="2317964">i</span><span class="op" id="2317965">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317969">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2317972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2317976">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318025">var</span>&nbsp;<span class="ident" id="2318029">imports</span>&nbsp;<span class="op" id="2318037">[</span><span class="op" id="2318038">]</span><span class="op" id="2318039">*</span><span class="ident" id="2318040">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318052">if</span>&nbsp;<span class="ident" id="2318055">mode</span><span class="op" id="2318059">&amp;</span><span class="ident" id="2318060">FilterImportDuplicates</span>&nbsp;<span class="op" id="2318083">!=</span>&nbsp;<span class="num" id="2318086">0</span>&nbsp;<span class="op" id="2318088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318092">seen</span>&nbsp;<span class="op" id="2318097">:=</span>&nbsp;<span class="builtinfunc" id="2318100">make</span><span class="op" id="2318104">(</span><span class="keyword" id="2318105">map</span><span class="op" id="2318108">[</span><span class="builtintype" id="2318109">string</span><span class="op" id="2318115">]</span><span class="builtintype" id="2318116">bool</span><span class="op" id="2318120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318124">for</span>&nbsp;<span class="ident" id="2318128">_</span><span class="op" id="2318129">,</span>&nbsp;<span class="ident" id="2318131">filename</span>&nbsp;<span class="op" id="2318140">:=</span>&nbsp;<span class="keyword" id="2318143">range</span>&nbsp;<span class="ident" id="2318149">filenames</span>&nbsp;<span class="op" id="2318159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318164">f</span>&nbsp;<span class="op" id="2318166">:=</span>&nbsp;<span class="ident" id="2318169">pkg</span><span class="op" id="2318172">.</span><span class="ident" id="2318173">Files</span><span class="op" id="2318178">[</span><span class="ident" id="2318179">filename</span><span class="op" id="2318187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318192">for</span>&nbsp;<span class="ident" id="2318196">_</span><span class="op" id="2318197">,</span>&nbsp;<span class="ident" id="2318199">imp</span>&nbsp;<span class="op" id="2318203">:=</span>&nbsp;<span class="keyword" id="2318206">range</span>&nbsp;<span class="ident" id="2318212">f</span><span class="op" id="2318213">.</span><span class="ident" id="2318214">Imports</span>&nbsp;<span class="op" id="2318222">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318228">if</span>&nbsp;<span class="ident" id="2318231">path</span>&nbsp;<span class="op" id="2318236">:=</span>&nbsp;<span class="ident" id="2318239">imp</span><span class="op" id="2318242">.</span><span class="ident" id="2318243">Path</span><span class="op" id="2318247">.</span><span class="ident" id="2318248">Value</span><span class="op" id="2318253">;</span>&nbsp;<span class="op" id="2318255">!</span><span class="ident" id="2318256">seen</span><span class="op" id="2318260">[</span><span class="ident" id="2318261">path</span><span class="op" id="2318265">]</span>&nbsp;<span class="op" id="2318267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318274">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318319">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318375">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318433">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318462">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318515">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318570">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318600">imports</span>&nbsp;<span class="op" id="2318608">=</span>&nbsp;<span class="builtinfunc" id="2318610">append</span><span class="op" id="2318616">(</span><span class="ident" id="2318617">imports</span><span class="op" id="2318624">,</span>&nbsp;<span class="ident" id="2318626">imp</span><span class="op" id="2318629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318636">seen</span><span class="op" id="2318640">[</span><span class="ident" id="2318641">path</span><span class="op" id="2318645">]</span>&nbsp;<span class="op" id="2318647">=</span>&nbsp;<span class="builtintype" id="2318649">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318658">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318670">}</span>&nbsp;<span class="keyword" id="2318672">else</span>&nbsp;<span class="op" id="2318677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318681">for</span>&nbsp;<span class="ident" id="2318685">_</span><span class="op" id="2318686">,</span>&nbsp;<span class="ident" id="2318688">f</span>&nbsp;<span class="op" id="2318690">:=</span>&nbsp;<span class="keyword" id="2318693">range</span>&nbsp;<span class="ident" id="2318699">pkg</span><span class="op" id="2318702">.</span><span class="ident" id="2318703">Files</span>&nbsp;<span class="op" id="2318709">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318714">imports</span>&nbsp;<span class="op" id="2318722">=</span>&nbsp;<span class="builtinfunc" id="2318724">append</span><span class="op" id="2318730">(</span><span class="ident" id="2318731">imports</span><span class="op" id="2318738">,</span>&nbsp;<span class="ident" id="2318740">f</span><span class="op" id="2318741">.</span><span class="ident" id="2318742">Imports</span><span class="op" id="2318749">...</span><span class="op" id="2318752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2318759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2318763">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318808">var</span>&nbsp;<span class="ident" id="2318812">comments</span>&nbsp;<span class="op" id="2318821">[</span><span class="op" id="2318822">]</span><span class="op" id="2318823">*</span><span class="ident" id="2318824">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318838">if</span>&nbsp;<span class="ident" id="2318841">mode</span><span class="op" id="2318845">&amp;</span><span class="ident" id="2318846">FilterUnassociatedComments</span>&nbsp;<span class="op" id="2318873">==</span>&nbsp;<span class="num" id="2318876">0</span>&nbsp;<span class="op" id="2318878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318882">comments</span>&nbsp;<span class="op" id="2318891">=</span>&nbsp;<span class="builtinfunc" id="2318893">make</span><span class="op" id="2318897">(</span><span class="op" id="2318898">[</span><span class="op" id="2318899">]</span><span class="op" id="2318900">*</span><span class="ident" id="2318901">CommentGroup</span><span class="op" id="2318913">,</span>&nbsp;<span class="ident" id="2318915">ncomments</span><span class="op" id="2318924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318928">i</span>&nbsp;<span class="op" id="2318930">:=</span>&nbsp;<span class="num" id="2318933">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2318937">for</span>&nbsp;<span class="ident" id="2318941">_</span><span class="op" id="2318942">,</span>&nbsp;<span class="ident" id="2318944">f</span>&nbsp;<span class="op" id="2318946">:=</span>&nbsp;<span class="keyword" id="2318949">range</span>&nbsp;<span class="ident" id="2318955">pkg</span><span class="op" id="2318958">.</span><span class="ident" id="2318959">Files</span>&nbsp;<span class="op" id="2318965">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2318970">i</span>&nbsp;<span class="op" id="2318972">+=</span>&nbsp;<span class="builtinfunc" id="2318975">copy</span><span class="op" id="2318979">(</span><span class="ident" id="2318980">comments</span><span class="op" id="2318988">[</span><span class="ident" id="2318989">i</span><span class="op" id="2318990">:</span><span class="op" id="2318991">]</span><span class="op" id="2318992">,</span>&nbsp;<span class="ident" id="2318994">f</span><span class="op" id="2318995">.</span><span class="ident" id="2318996">Comments</span><span class="op" id="2319004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2319011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2319015">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2319069">return</span>&nbsp;<span class="op" id="2319076">&amp;</span><span class="ident" id="2319077">File</span><span class="op" id="2319081">{</span><span class="ident" id="2319082">doc</span><span class="op" id="2319085">,</span>&nbsp;<span class="ident" id="2319087">pos</span><span class="op" id="2319090">,</span>&nbsp;<span class="ident" id="2319092">NewIdent</span><span class="op" id="2319100">(</span><span class="ident" id="2319101">pkg</span><span class="op" id="2319104">.</span><span class="ident" id="2319105">Name</span><span class="op" id="2319109">)</span><span class="op" id="2319110">,</span>&nbsp;<span class="ident" id="2319112">decls</span><span class="op" id="2319117">,</span>&nbsp;<span class="ident" id="2319119">pkg</span><span class="op" id="2319122">.</span><span class="ident" id="2319123">Scope</span><span class="op" id="2319128">,</span>&nbsp;<span class="ident" id="2319130">imports</span><span class="op" id="2319137">,</span>&nbsp;<span class="ident" id="2319139">nil</span><span class="op" id="2319142">,</span>&nbsp;<span class="ident" id="2319144">comments</span><span class="op" id="2319152">}</span><br>
<span class="lineno"></span><span class="op" id="2319154">}</span>
</div>
</body>
</html>
