<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/ast</h2>
<ul>
<li><a href="/gostd/go/ast/ast.go.html">ast.go</a></li>
<li><a href="/gostd/go/ast/ast_test.go.html">ast_test.go</a></li>
<li><a href="/gostd/go/ast/commentmap.go.html">commentmap.go</a></li>
<li><a href="/gostd/go/ast/commentmap_test.go.html">commentmap_test.go</a></li>
<li><a href="/gostd/go/ast/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/ast/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/ast/filter_test.go.html">filter_test.go</a></li>
<li><a href="/gostd/go/ast/import.go.html">import.go</a></li>
<li><a href="/gostd/go/ast/print.go.html">print.go</a></li>
<li><a href="/gostd/go/ast/print_test.go.html">print_test.go</a></li>
<li><a href="/gostd/go/ast/resolve.go.html">resolve.go</a></li>
<li><a href="/gostd/go/ast/scope.go.html">scope.go</a></li>
<li><a href="/gostd/go/ast/walk.go.html">walk.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4266554">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4266609">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4266663">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4266714">package</span>&nbsp;<span class="ident" id="4266722">ast</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4266727">import</span>&nbsp;<span class="op" id="4266734">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4266737">&#34;go/token&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4266749">&#34;sort&#34;</span><br>
<span class="lineno">10</span><span class="op" id="4266756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4266759">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4266839">//&nbsp;Export&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4266860">//&nbsp;exportFilter&nbsp;is&nbsp;a&nbsp;special&nbsp;filter&nbsp;function&nbsp;to&nbsp;extract&nbsp;exported&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="4266932">func</span>&nbsp;<span class="ident" id="4266937">exportFilter</span><span class="op" id="4266949">(</span><span class="ident" id="4266950">name</span>&nbsp;<span class="builtintype" id="4266955">string</span><span class="op" id="4266961">)</span>&nbsp;<span class="builtintype" id="4266963">bool</span>&nbsp;<span class="op" id="4266968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4266971">return</span>&nbsp;<span class="ident" id="4266978">IsExported</span><span class="op" id="4266988">(</span><span class="ident" id="4266989">name</span><span class="op" id="4266993">)</span><br>
<span class="lineno"></span><span class="op" id="4266995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="4266998">//&nbsp;FileExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;source&nbsp;file&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4267067">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain:&nbsp;all&nbsp;top-level&nbsp;identifiers&nbsp;which&nbsp;are&nbsp;not&nbsp;exported</span><br>
<span class="lineno"></span><span class="comment" id="4267147">//&nbsp;and&nbsp;their&nbsp;associated&nbsp;information&nbsp;(such&nbsp;as&nbsp;type,&nbsp;initial&nbsp;value,&nbsp;or&nbsp;function</span><br>
<span class="lineno"></span><span class="comment" id="4267225">//&nbsp;body)&nbsp;are&nbsp;removed.&nbsp;Non-exported&nbsp;fields&nbsp;and&nbsp;methods&nbsp;of&nbsp;exported&nbsp;types&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="4267301">//&nbsp;stripped.&nbsp;The&nbsp;File.Comments&nbsp;list&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno">25</span><span class="comment" id="4267353">//</span><br>
<span class="lineno"></span><span class="comment" id="4267356">//&nbsp;FileExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4267420">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4267451">//</span><br>
<span class="lineno"></span><span class="keyword" id="4267454">func</span>&nbsp;<span class="ident" id="4267459">FileExports</span><span class="op" id="4267470">(</span><span class="ident" id="4267471">src</span>&nbsp;<span class="op" id="4267475">*</span><span class="ident" id="4267476">File</span><span class="op" id="4267480">)</span>&nbsp;<span class="builtintype" id="4267482">bool</span>&nbsp;<span class="op" id="4267487">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267490">return</span>&nbsp;<span class="ident" id="4267497">filterFile</span><span class="op" id="4267507">(</span><span class="ident" id="4267508">src</span><span class="op" id="4267511">,</span>&nbsp;<span class="ident" id="4267513">exportFilter</span><span class="op" id="4267525">,</span>&nbsp;<span class="builtintype" id="4267527">true</span><span class="op" id="4267531">)</span><br>
<span class="lineno"></span><span class="op" id="4267533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4267536">//&nbsp;PackageExports&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;such&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="4267604">//&nbsp;only&nbsp;exported&nbsp;nodes&nbsp;remain.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not&nbsp;changed,&nbsp;so&nbsp;that</span><br>
<span class="lineno">35</span><span class="comment" id="4267678">//&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4267739">//</span><br>
<span class="lineno"></span><span class="comment" id="4267742">//&nbsp;PackageExports&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;exported&nbsp;declarations;</span><br>
<span class="lineno"></span><span class="comment" id="4267809">//&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4267840">//</span><br>
<span class="lineno">40</span><span class="keyword" id="4267843">func</span>&nbsp;<span class="ident" id="4267848">PackageExports</span><span class="op" id="4267862">(</span><span class="ident" id="4267863">pkg</span>&nbsp;<span class="op" id="4267867">*</span><span class="ident" id="4267868">Package</span><span class="op" id="4267875">)</span>&nbsp;<span class="builtintype" id="4267877">bool</span>&nbsp;<span class="op" id="4267882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4267885">return</span>&nbsp;<span class="ident" id="4267892">filterPackage</span><span class="op" id="4267905">(</span><span class="ident" id="4267906">pkg</span><span class="op" id="4267909">,</span>&nbsp;<span class="ident" id="4267911">exportFilter</span><span class="op" id="4267923">,</span>&nbsp;<span class="builtintype" id="4267925">true</span><span class="op" id="4267929">)</span><br>
<span class="lineno"></span><span class="op" id="4267931">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4267934">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno">45</span><span class="comment" id="4268014">//&nbsp;General&nbsp;filtering</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4268036">type</span>&nbsp;<span class="ident" id="4268041">Filter</span>&nbsp;<span class="keyword" id="4268048">func</span><span class="op" id="4268052">(</span><span class="builtintype" id="4268053">string</span><span class="op" id="4268059">)</span>&nbsp;<span class="builtintype" id="4268061">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4268067">func</span>&nbsp;<span class="ident" id="4268072">filterIdentList</span><span class="op" id="4268087">(</span><span class="ident" id="4268088">list</span>&nbsp;<span class="op" id="4268093">[</span><span class="op" id="4268094">]</span><span class="op" id="4268095">*</span><span class="ident" id="4268096">Ident</span><span class="op" id="4268101">,</span>&nbsp;<span class="ident" id="4268103">f</span>&nbsp;<span class="ident" id="4268105">Filter</span><span class="op" id="4268111">)</span>&nbsp;<span class="op" id="4268113">[</span><span class="op" id="4268114">]</span><span class="op" id="4268115">*</span><span class="ident" id="4268116">Ident</span>&nbsp;<span class="op" id="4268122">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268125">j</span>&nbsp;<span class="op" id="4268127">:=</span>&nbsp;<span class="num" id="4268130">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268133">for</span>&nbsp;<span class="ident" id="4268137">_</span><span class="op" id="4268138">,</span>&nbsp;<span class="ident" id="4268140">x</span>&nbsp;<span class="op" id="4268142">:=</span>&nbsp;<span class="keyword" id="4268145">range</span>&nbsp;<span class="ident" id="4268151">list</span>&nbsp;<span class="op" id="4268156">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268160">if</span>&nbsp;<span class="ident" id="4268163">f</span><span class="op" id="4268164">(</span><span class="ident" id="4268165">x</span><span class="op" id="4268166">.</span><span class="ident" id="4268167">Name</span><span class="op" id="4268171">)</span>&nbsp;<span class="op" id="4268173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268178">list</span><span class="op" id="4268182">[</span><span class="ident" id="4268183">j</span><span class="op" id="4268184">]</span>&nbsp;<span class="op" id="4268186">=</span>&nbsp;<span class="ident" id="4268188">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268193">j</span><span class="op" id="4268194">++</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268205">return</span>&nbsp;<span class="ident" id="4268212">list</span><span class="op" id="4268216">[</span><span class="num" id="4268217">0</span><span class="op" id="4268218">:</span><span class="ident" id="4268219">j</span><span class="op" id="4268220">]</span><br>
<span class="lineno"></span><span class="op" id="4268222">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="4268225">//&nbsp;fieldName&nbsp;assumes&nbsp;that&nbsp;x&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;an&nbsp;anonymous&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4268291">//&nbsp;returns&nbsp;the&nbsp;corresponding&nbsp;field&nbsp;name.&nbsp;If&nbsp;x&nbsp;is&nbsp;not&nbsp;an&nbsp;acceptable</span><br>
<span class="lineno"></span><span class="comment" id="4268358">//&nbsp;anonymous&nbsp;field,&nbsp;the&nbsp;result&nbsp;is&nbsp;nil.</span><br>
<span class="lineno"></span><span class="comment" id="4268397">//</span><br>
<span class="lineno"></span><span class="keyword" id="4268400">func</span>&nbsp;<span class="ident" id="4268405">fieldName</span><span class="op" id="4268414">(</span><span class="ident" id="4268415">x</span>&nbsp;<span class="ident" id="4268417">Expr</span><span class="op" id="4268421">)</span>&nbsp;<span class="op" id="4268423">*</span><span class="ident" id="4268424">Ident</span>&nbsp;<span class="op" id="4268430">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268433">switch</span>&nbsp;<span class="ident" id="4268440">t</span>&nbsp;<span class="op" id="4268442">:=</span>&nbsp;<span class="ident" id="4268445">x</span><span class="op" id="4268446">.</span><span class="op" id="4268447">(</span><span class="keyword" id="4268448">type</span><span class="op" id="4268452">)</span>&nbsp;<span class="op" id="4268454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268457">case</span>&nbsp;<span class="op" id="4268462">*</span><span class="ident" id="4268463">Ident</span><span class="op" id="4268468">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268472">return</span>&nbsp;<span class="ident" id="4268479">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268482">case</span>&nbsp;<span class="op" id="4268487">*</span><span class="ident" id="4268488">SelectorExpr</span><span class="op" id="4268500">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268504">if</span>&nbsp;<span class="ident" id="4268507">_</span><span class="op" id="4268508">,</span>&nbsp;<span class="ident" id="4268510">ok</span>&nbsp;<span class="op" id="4268513">:=</span>&nbsp;<span class="ident" id="4268516">t</span><span class="op" id="4268517">.</span><span class="ident" id="4268518">X</span><span class="op" id="4268519">.</span><span class="op" id="4268520">(</span><span class="op" id="4268521">*</span><span class="ident" id="4268522">Ident</span><span class="op" id="4268527">)</span><span class="op" id="4268528">;</span>&nbsp;<span class="ident" id="4268530">ok</span>&nbsp;<span class="op" id="4268533">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268538">return</span>&nbsp;<span class="ident" id="4268545">t</span><span class="op" id="4268546">.</span><span class="ident" id="4268547">Sel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268556">case</span>&nbsp;<span class="op" id="4268561">*</span><span class="ident" id="4268562">StarExpr</span><span class="op" id="4268570">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268574">return</span>&nbsp;<span class="ident" id="4268581">fieldName</span><span class="op" id="4268590">(</span><span class="ident" id="4268591">t</span><span class="op" id="4268592">.</span><span class="ident" id="4268593">X</span><span class="op" id="4268594">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268597">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268600">return</span>&nbsp;<span class="ident" id="4268607">nil</span><br>
<span class="lineno"></span><span class="op" id="4268611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4268614">func</span>&nbsp;<span class="ident" id="4268619">filterFieldList</span><span class="op" id="4268634">(</span><span class="ident" id="4268635">fields</span>&nbsp;<span class="op" id="4268642">*</span><span class="ident" id="4268643">FieldList</span><span class="op" id="4268652">,</span>&nbsp;<span class="ident" id="4268654">filter</span>&nbsp;<span class="ident" id="4268661">Filter</span><span class="op" id="4268667">,</span>&nbsp;<span class="ident" id="4268669">export</span>&nbsp;<span class="builtintype" id="4268676">bool</span><span class="op" id="4268680">)</span>&nbsp;<span class="op" id="4268682">(</span><span class="ident" id="4268683">removedFields</span>&nbsp;<span class="builtintype" id="4268697">bool</span><span class="op" id="4268701">)</span>&nbsp;<span class="op" id="4268703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268706">if</span>&nbsp;<span class="ident" id="4268709">fields</span>&nbsp;<span class="op" id="4268716">==</span>&nbsp;<span class="ident" id="4268719">nil</span>&nbsp;<span class="op" id="4268723">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268727">return</span>&nbsp;<span class="builtintype" id="4268734">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268744">list</span>&nbsp;<span class="op" id="4268749">:=</span>&nbsp;<span class="ident" id="4268752">fields</span><span class="op" id="4268758">.</span><span class="ident" id="4268759">List</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268765">j</span>&nbsp;<span class="op" id="4268767">:=</span>&nbsp;<span class="num" id="4268770">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268773">for</span>&nbsp;<span class="ident" id="4268777">_</span><span class="op" id="4268778">,</span>&nbsp;<span class="ident" id="4268780">f</span>&nbsp;<span class="op" id="4268782">:=</span>&nbsp;<span class="keyword" id="4268785">range</span>&nbsp;<span class="ident" id="4268791">list</span>&nbsp;<span class="op" id="4268796">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268800">keepField</span>&nbsp;<span class="op" id="4268810">:=</span>&nbsp;<span class="builtintype" id="4268813">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4268821">if</span>&nbsp;<span class="builtinfunc" id="4268824">len</span><span class="op" id="4268827">(</span><span class="ident" id="4268828">f</span><span class="op" id="4268829">.</span><span class="ident" id="4268830">Names</span><span class="op" id="4268835">)</span>&nbsp;<span class="op" id="4268837">==</span>&nbsp;<span class="num" id="4268840">0</span>&nbsp;<span class="op" id="4268842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4268847">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268869">name</span>&nbsp;<span class="op" id="4268874">:=</span>&nbsp;<span class="ident" id="4268877">fieldName</span><span class="op" id="4268886">(</span><span class="ident" id="4268887">f</span><span class="op" id="4268888">.</span><span class="ident" id="4268889">Type</span><span class="op" id="4268893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268898">keepField</span>&nbsp;<span class="op" id="4268908">=</span>&nbsp;<span class="ident" id="4268910">name</span>&nbsp;<span class="op" id="4268915">!=</span>&nbsp;<span class="ident" id="4268918">nil</span>&nbsp;<span class="op" id="4268922">&amp;&amp;</span>&nbsp;<span class="ident" id="4268925">filter</span><span class="op" id="4268931">(</span><span class="ident" id="4268932">name</span><span class="op" id="4268936">.</span><span class="ident" id="4268937">Name</span><span class="op" id="4268941">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4268945">}</span>&nbsp;<span class="keyword" id="4268947">else</span>&nbsp;<span class="op" id="4268952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268957">n</span>&nbsp;<span class="op" id="4268959">:=</span>&nbsp;<span class="builtinfunc" id="4268962">len</span><span class="op" id="4268965">(</span><span class="ident" id="4268966">f</span><span class="op" id="4268967">.</span><span class="ident" id="4268968">Names</span><span class="op" id="4268973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4268978">f</span><span class="op" id="4268979">.</span><span class="ident" id="4268980">Names</span>&nbsp;<span class="op" id="4268986">=</span>&nbsp;<span class="ident" id="4268988">filterIdentList</span><span class="op" id="4269003">(</span><span class="ident" id="4269004">f</span><span class="op" id="4269005">.</span><span class="ident" id="4269006">Names</span><span class="op" id="4269011">,</span>&nbsp;<span class="ident" id="4269013">filter</span><span class="op" id="4269019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269024">if</span>&nbsp;<span class="builtinfunc" id="4269027">len</span><span class="op" id="4269030">(</span><span class="ident" id="4269031">f</span><span class="op" id="4269032">.</span><span class="ident" id="4269033">Names</span><span class="op" id="4269038">)</span>&nbsp;<span class="op" id="4269040">&lt;</span>&nbsp;<span class="ident" id="4269042">n</span>&nbsp;<span class="op" id="4269044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269050">removedFields</span>&nbsp;<span class="op" id="4269064">=</span>&nbsp;<span class="builtintype" id="4269066">true</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269079">keepField</span>&nbsp;<span class="op" id="4269089">=</span>&nbsp;<span class="builtinfunc" id="4269091">len</span><span class="op" id="4269094">(</span><span class="ident" id="4269095">f</span><span class="op" id="4269096">.</span><span class="ident" id="4269097">Names</span><span class="op" id="4269102">)</span>&nbsp;<span class="op" id="4269104">&gt;</span>&nbsp;<span class="num" id="4269106">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269114">if</span>&nbsp;<span class="ident" id="4269117">keepField</span>&nbsp;<span class="op" id="4269127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269132">if</span>&nbsp;<span class="ident" id="4269135">export</span>&nbsp;<span class="op" id="4269142">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269148">filterType</span><span class="op" id="4269158">(</span><span class="ident" id="4269159">f</span><span class="op" id="4269160">.</span><span class="ident" id="4269161">Type</span><span class="op" id="4269165">,</span>&nbsp;<span class="ident" id="4269167">filter</span><span class="op" id="4269173">,</span>&nbsp;<span class="ident" id="4269175">export</span><span class="op" id="4269181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269186">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269191">list</span><span class="op" id="4269195">[</span><span class="ident" id="4269196">j</span><span class="op" id="4269197">]</span>&nbsp;<span class="op" id="4269199">=</span>&nbsp;<span class="ident" id="4269201">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269206">j</span><span class="op" id="4269207">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269212">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269215">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269218">if</span>&nbsp;<span class="ident" id="4269221">j</span>&nbsp;<span class="op" id="4269223">&lt;</span>&nbsp;<span class="builtinfunc" id="4269225">len</span><span class="op" id="4269228">(</span><span class="ident" id="4269229">list</span><span class="op" id="4269233">)</span>&nbsp;<span class="op" id="4269235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269239">removedFields</span>&nbsp;<span class="op" id="4269253">=</span>&nbsp;<span class="builtintype" id="4269255">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269264">fields</span><span class="op" id="4269270">.</span><span class="ident" id="4269271">List</span>&nbsp;<span class="op" id="4269276">=</span>&nbsp;<span class="ident" id="4269278">list</span><span class="op" id="4269282">[</span><span class="num" id="4269283">0</span><span class="op" id="4269284">:</span><span class="ident" id="4269285">j</span><span class="op" id="4269286">]</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269289">return</span><br>
<span class="lineno"></span><span class="op" id="4269296">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4269299">func</span>&nbsp;<span class="ident" id="4269304">filterParamList</span><span class="op" id="4269319">(</span><span class="ident" id="4269320">fields</span>&nbsp;<span class="op" id="4269327">*</span><span class="ident" id="4269328">FieldList</span><span class="op" id="4269337">,</span>&nbsp;<span class="ident" id="4269339">filter</span>&nbsp;<span class="ident" id="4269346">Filter</span><span class="op" id="4269352">,</span>&nbsp;<span class="ident" id="4269354">export</span>&nbsp;<span class="builtintype" id="4269361">bool</span><span class="op" id="4269365">)</span>&nbsp;<span class="builtintype" id="4269367">bool</span>&nbsp;<span class="op" id="4269372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269375">if</span>&nbsp;<span class="ident" id="4269378">fields</span>&nbsp;<span class="op" id="4269385">==</span>&nbsp;<span class="ident" id="4269388">nil</span>&nbsp;<span class="op" id="4269392">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269396">return</span>&nbsp;<span class="builtintype" id="4269403">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269410">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269413">var</span>&nbsp;<span class="ident" id="4269417">b</span>&nbsp;<span class="builtintype" id="4269419">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269425">for</span>&nbsp;<span class="ident" id="4269429">_</span><span class="op" id="4269430">,</span>&nbsp;<span class="ident" id="4269432">f</span>&nbsp;<span class="op" id="4269434">:=</span>&nbsp;<span class="keyword" id="4269437">range</span>&nbsp;<span class="ident" id="4269443">fields</span><span class="op" id="4269449">.</span><span class="ident" id="4269450">List</span>&nbsp;<span class="op" id="4269455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269459">if</span>&nbsp;<span class="ident" id="4269462">filterType</span><span class="op" id="4269472">(</span><span class="ident" id="4269473">f</span><span class="op" id="4269474">.</span><span class="ident" id="4269475">Type</span><span class="op" id="4269479">,</span>&nbsp;<span class="ident" id="4269481">filter</span><span class="op" id="4269487">,</span>&nbsp;<span class="ident" id="4269489">export</span><span class="op" id="4269495">)</span>&nbsp;<span class="op" id="4269497">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269502">b</span>&nbsp;<span class="op" id="4269504">=</span>&nbsp;<span class="builtintype" id="4269506">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269513">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269519">return</span>&nbsp;<span class="ident" id="4269526">b</span><br>
<span class="lineno"></span><span class="op" id="4269528">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="4269531">func</span>&nbsp;<span class="ident" id="4269536">filterType</span><span class="op" id="4269546">(</span><span class="ident" id="4269547">typ</span>&nbsp;<span class="ident" id="4269551">Expr</span><span class="op" id="4269555">,</span>&nbsp;<span class="ident" id="4269557">f</span>&nbsp;<span class="ident" id="4269559">Filter</span><span class="op" id="4269565">,</span>&nbsp;<span class="ident" id="4269567">export</span>&nbsp;<span class="builtintype" id="4269574">bool</span><span class="op" id="4269578">)</span>&nbsp;<span class="builtintype" id="4269580">bool</span>&nbsp;<span class="op" id="4269585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269588">switch</span>&nbsp;<span class="ident" id="4269595">t</span>&nbsp;<span class="op" id="4269597">:=</span>&nbsp;<span class="ident" id="4269600">typ</span><span class="op" id="4269603">.</span><span class="op" id="4269604">(</span><span class="keyword" id="4269605">type</span><span class="op" id="4269609">)</span>&nbsp;<span class="op" id="4269611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269614">case</span>&nbsp;<span class="op" id="4269619">*</span><span class="ident" id="4269620">Ident</span><span class="op" id="4269625">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269629">return</span>&nbsp;<span class="ident" id="4269636">f</span><span class="op" id="4269637">(</span><span class="ident" id="4269638">t</span><span class="op" id="4269639">.</span><span class="ident" id="4269640">Name</span><span class="op" id="4269644">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269647">case</span>&nbsp;<span class="op" id="4269652">*</span><span class="ident" id="4269653">ParenExpr</span><span class="op" id="4269662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269666">return</span>&nbsp;<span class="ident" id="4269673">filterType</span><span class="op" id="4269683">(</span><span class="ident" id="4269684">t</span><span class="op" id="4269685">.</span><span class="ident" id="4269686">X</span><span class="op" id="4269687">,</span>&nbsp;<span class="ident" id="4269689">f</span><span class="op" id="4269690">,</span>&nbsp;<span class="ident" id="4269692">export</span><span class="op" id="4269698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269701">case</span>&nbsp;<span class="op" id="4269706">*</span><span class="ident" id="4269707">ArrayType</span><span class="op" id="4269716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269720">return</span>&nbsp;<span class="ident" id="4269727">filterType</span><span class="op" id="4269737">(</span><span class="ident" id="4269738">t</span><span class="op" id="4269739">.</span><span class="ident" id="4269740">Elt</span><span class="op" id="4269743">,</span>&nbsp;<span class="ident" id="4269745">f</span><span class="op" id="4269746">,</span>&nbsp;<span class="ident" id="4269748">export</span><span class="op" id="4269754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269757">case</span>&nbsp;<span class="op" id="4269762">*</span><span class="ident" id="4269763">StructType</span><span class="op" id="4269773">:</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269777">if</span>&nbsp;<span class="ident" id="4269780">filterFieldList</span><span class="op" id="4269795">(</span><span class="ident" id="4269796">t</span><span class="op" id="4269797">.</span><span class="ident" id="4269798">Fields</span><span class="op" id="4269804">,</span>&nbsp;<span class="ident" id="4269806">f</span><span class="op" id="4269807">,</span>&nbsp;<span class="ident" id="4269809">export</span><span class="op" id="4269815">)</span>&nbsp;<span class="op" id="4269817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269822">t</span><span class="op" id="4269823">.</span><span class="ident" id="4269824">Incomplete</span>&nbsp;<span class="op" id="4269835">=</span>&nbsp;<span class="builtintype" id="4269837">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4269844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269848">return</span>&nbsp;<span class="builtinfunc" id="4269855">len</span><span class="op" id="4269858">(</span><span class="ident" id="4269859">t</span><span class="op" id="4269860">.</span><span class="ident" id="4269861">Fields</span><span class="op" id="4269867">.</span><span class="ident" id="4269868">List</span><span class="op" id="4269872">)</span>&nbsp;<span class="op" id="4269874">&gt;</span>&nbsp;<span class="num" id="4269876">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269879">case</span>&nbsp;<span class="op" id="4269884">*</span><span class="ident" id="4269885">FuncType</span><span class="op" id="4269893">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269897">b1</span>&nbsp;<span class="op" id="4269900">:=</span>&nbsp;<span class="ident" id="4269903">filterParamList</span><span class="op" id="4269918">(</span><span class="ident" id="4269919">t</span><span class="op" id="4269920">.</span><span class="ident" id="4269921">Params</span><span class="op" id="4269927">,</span>&nbsp;<span class="ident" id="4269929">f</span><span class="op" id="4269930">,</span>&nbsp;<span class="ident" id="4269932">export</span><span class="op" id="4269938">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4269942">b2</span>&nbsp;<span class="op" id="4269945">:=</span>&nbsp;<span class="ident" id="4269948">filterParamList</span><span class="op" id="4269963">(</span><span class="ident" id="4269964">t</span><span class="op" id="4269965">.</span><span class="ident" id="4269966">Results</span><span class="op" id="4269973">,</span>&nbsp;<span class="ident" id="4269975">f</span><span class="op" id="4269976">,</span>&nbsp;<span class="ident" id="4269978">export</span><span class="op" id="4269984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4269988">return</span>&nbsp;<span class="ident" id="4269995">b1</span>&nbsp;<span class="op" id="4269998">||</span>&nbsp;<span class="ident" id="4270001">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270005">case</span>&nbsp;<span class="op" id="4270010">*</span><span class="ident" id="4270011">InterfaceType</span><span class="op" id="4270024">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270028">if</span>&nbsp;<span class="ident" id="4270031">filterFieldList</span><span class="op" id="4270046">(</span><span class="ident" id="4270047">t</span><span class="op" id="4270048">.</span><span class="ident" id="4270049">Methods</span><span class="op" id="4270056">,</span>&nbsp;<span class="ident" id="4270058">f</span><span class="op" id="4270059">,</span>&nbsp;<span class="ident" id="4270061">export</span><span class="op" id="4270067">)</span>&nbsp;<span class="op" id="4270069">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270074">t</span><span class="op" id="4270075">.</span><span class="ident" id="4270076">Incomplete</span>&nbsp;<span class="op" id="4270087">=</span>&nbsp;<span class="builtintype" id="4270089">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270100">return</span>&nbsp;<span class="builtinfunc" id="4270107">len</span><span class="op" id="4270110">(</span><span class="ident" id="4270111">t</span><span class="op" id="4270112">.</span><span class="ident" id="4270113">Methods</span><span class="op" id="4270120">.</span><span class="ident" id="4270121">List</span><span class="op" id="4270125">)</span>&nbsp;<span class="op" id="4270127">&gt;</span>&nbsp;<span class="num" id="4270129">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270132">case</span>&nbsp;<span class="op" id="4270137">*</span><span class="ident" id="4270138">MapType</span><span class="op" id="4270145">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270149">b1</span>&nbsp;<span class="op" id="4270152">:=</span>&nbsp;<span class="ident" id="4270155">filterType</span><span class="op" id="4270165">(</span><span class="ident" id="4270166">t</span><span class="op" id="4270167">.</span><span class="ident" id="4270168">Key</span><span class="op" id="4270171">,</span>&nbsp;<span class="ident" id="4270173">f</span><span class="op" id="4270174">,</span>&nbsp;<span class="ident" id="4270176">export</span><span class="op" id="4270182">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270186">b2</span>&nbsp;<span class="op" id="4270189">:=</span>&nbsp;<span class="ident" id="4270192">filterType</span><span class="op" id="4270202">(</span><span class="ident" id="4270203">t</span><span class="op" id="4270204">.</span><span class="ident" id="4270205">Value</span><span class="op" id="4270210">,</span>&nbsp;<span class="ident" id="4270212">f</span><span class="op" id="4270213">,</span>&nbsp;<span class="ident" id="4270215">export</span><span class="op" id="4270221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270225">return</span>&nbsp;<span class="ident" id="4270232">b1</span>&nbsp;<span class="op" id="4270235">||</span>&nbsp;<span class="ident" id="4270238">b2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270242">case</span>&nbsp;<span class="op" id="4270247">*</span><span class="ident" id="4270248">ChanType</span><span class="op" id="4270256">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270260">return</span>&nbsp;<span class="ident" id="4270267">filterType</span><span class="op" id="4270277">(</span><span class="ident" id="4270278">t</span><span class="op" id="4270279">.</span><span class="ident" id="4270280">Value</span><span class="op" id="4270285">,</span>&nbsp;<span class="ident" id="4270287">f</span><span class="op" id="4270288">,</span>&nbsp;<span class="ident" id="4270290">export</span><span class="op" id="4270296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270299">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270302">return</span>&nbsp;<span class="builtintype" id="4270309">false</span><br>
<span class="lineno"></span><span class="op" id="4270315">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4270318">func</span>&nbsp;<span class="ident" id="4270323">filterSpec</span><span class="op" id="4270333">(</span><span class="ident" id="4270334">spec</span>&nbsp;<span class="ident" id="4270339">Spec</span><span class="op" id="4270343">,</span>&nbsp;<span class="ident" id="4270345">f</span>&nbsp;<span class="ident" id="4270347">Filter</span><span class="op" id="4270353">,</span>&nbsp;<span class="ident" id="4270355">export</span>&nbsp;<span class="builtintype" id="4270362">bool</span><span class="op" id="4270366">)</span>&nbsp;<span class="builtintype" id="4270368">bool</span>&nbsp;<span class="op" id="4270373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270376">switch</span>&nbsp;<span class="ident" id="4270383">s</span>&nbsp;<span class="op" id="4270385">:=</span>&nbsp;<span class="ident" id="4270388">spec</span><span class="op" id="4270392">.</span><span class="op" id="4270393">(</span><span class="keyword" id="4270394">type</span><span class="op" id="4270398">)</span>&nbsp;<span class="op" id="4270400">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270403">case</span>&nbsp;<span class="op" id="4270408">*</span><span class="ident" id="4270409">ValueSpec</span><span class="op" id="4270418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270422">s</span><span class="op" id="4270423">.</span><span class="ident" id="4270424">Names</span>&nbsp;<span class="op" id="4270430">=</span>&nbsp;<span class="ident" id="4270432">filterIdentList</span><span class="op" id="4270447">(</span><span class="ident" id="4270448">s</span><span class="op" id="4270449">.</span><span class="ident" id="4270450">Names</span><span class="op" id="4270455">,</span>&nbsp;<span class="ident" id="4270457">f</span><span class="op" id="4270458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270462">if</span>&nbsp;<span class="builtinfunc" id="4270465">len</span><span class="op" id="4270468">(</span><span class="ident" id="4270469">s</span><span class="op" id="4270470">.</span><span class="ident" id="4270471">Names</span><span class="op" id="4270476">)</span>&nbsp;<span class="op" id="4270478">&gt;</span>&nbsp;<span class="num" id="4270480">0</span>&nbsp;<span class="op" id="4270482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270487">if</span>&nbsp;<span class="ident" id="4270490">export</span>&nbsp;<span class="op" id="4270497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270503">filterType</span><span class="op" id="4270513">(</span><span class="ident" id="4270514">s</span><span class="op" id="4270515">.</span><span class="ident" id="4270516">Type</span><span class="op" id="4270520">,</span>&nbsp;<span class="ident" id="4270522">f</span><span class="op" id="4270523">,</span>&nbsp;<span class="ident" id="4270525">export</span><span class="op" id="4270531">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270541">return</span>&nbsp;<span class="builtintype" id="4270548">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270558">case</span>&nbsp;<span class="op" id="4270563">*</span><span class="ident" id="4270564">TypeSpec</span><span class="op" id="4270572">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270576">if</span>&nbsp;<span class="ident" id="4270579">f</span><span class="op" id="4270580">(</span><span class="ident" id="4270581">s</span><span class="op" id="4270582">.</span><span class="ident" id="4270583">Name</span><span class="op" id="4270587">.</span><span class="ident" id="4270588">Name</span><span class="op" id="4270592">)</span>&nbsp;<span class="op" id="4270594">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270599">if</span>&nbsp;<span class="ident" id="4270602">export</span>&nbsp;<span class="op" id="4270609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270615">filterType</span><span class="op" id="4270625">(</span><span class="ident" id="4270626">s</span><span class="op" id="4270627">.</span><span class="ident" id="4270628">Type</span><span class="op" id="4270632">,</span>&nbsp;<span class="ident" id="4270634">f</span><span class="op" id="4270635">,</span>&nbsp;<span class="ident" id="4270637">export</span><span class="op" id="4270643">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270648">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270653">return</span>&nbsp;<span class="builtintype" id="4270660">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270667">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270671">if</span>&nbsp;<span class="op" id="4270674">!</span><span class="ident" id="4270675">export</span>&nbsp;<span class="op" id="4270682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270687">//&nbsp;For&nbsp;general&nbsp;filtering&nbsp;(not&nbsp;just&nbsp;exports),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270735">//&nbsp;filter&nbsp;type&nbsp;even&nbsp;if&nbsp;name&nbsp;is&nbsp;not&nbsp;filtered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270782">//&nbsp;out.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270793">//&nbsp;If&nbsp;the&nbsp;type&nbsp;contains&nbsp;filtered&nbsp;elements,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4270839">//&nbsp;keep&nbsp;the&nbsp;declaration.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270867">return</span>&nbsp;<span class="ident" id="4270874">filterType</span><span class="op" id="4270884">(</span><span class="ident" id="4270885">s</span><span class="op" id="4270886">.</span><span class="ident" id="4270887">Type</span><span class="op" id="4270891">,</span>&nbsp;<span class="ident" id="4270893">f</span><span class="op" id="4270894">,</span>&nbsp;<span class="ident" id="4270896">export</span><span class="op" id="4270902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270906">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4270909">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4270912">return</span>&nbsp;<span class="builtintype" id="4270919">false</span><br>
<span class="lineno">185</span><span class="op" id="4270925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4270928">func</span>&nbsp;<span class="ident" id="4270933">filterSpecList</span><span class="op" id="4270947">(</span><span class="ident" id="4270948">list</span>&nbsp;<span class="op" id="4270953">[</span><span class="op" id="4270954">]</span><span class="ident" id="4270955">Spec</span><span class="op" id="4270959">,</span>&nbsp;<span class="ident" id="4270961">f</span>&nbsp;<span class="ident" id="4270963">Filter</span><span class="op" id="4270969">,</span>&nbsp;<span class="ident" id="4270971">export</span>&nbsp;<span class="builtintype" id="4270978">bool</span><span class="op" id="4270982">)</span>&nbsp;<span class="op" id="4270984">[</span><span class="op" id="4270985">]</span><span class="ident" id="4270986">Spec</span>&nbsp;<span class="op" id="4270991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4270994">j</span>&nbsp;<span class="op" id="4270996">:=</span>&nbsp;<span class="num" id="4270999">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271002">for</span>&nbsp;<span class="ident" id="4271006">_</span><span class="op" id="4271007">,</span>&nbsp;<span class="ident" id="4271009">s</span>&nbsp;<span class="op" id="4271011">:=</span>&nbsp;<span class="keyword" id="4271014">range</span>&nbsp;<span class="ident" id="4271020">list</span>&nbsp;<span class="op" id="4271025">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271029">if</span>&nbsp;<span class="ident" id="4271032">filterSpec</span><span class="op" id="4271042">(</span><span class="ident" id="4271043">s</span><span class="op" id="4271044">,</span>&nbsp;<span class="ident" id="4271046">f</span><span class="op" id="4271047">,</span>&nbsp;<span class="ident" id="4271049">export</span><span class="op" id="4271055">)</span>&nbsp;<span class="op" id="4271057">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271062">list</span><span class="op" id="4271066">[</span><span class="ident" id="4271067">j</span><span class="op" id="4271068">]</span>&nbsp;<span class="op" id="4271070">=</span>&nbsp;<span class="ident" id="4271072">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271077">j</span><span class="op" id="4271078">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271086">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271089">return</span>&nbsp;<span class="ident" id="4271096">list</span><span class="op" id="4271100">[</span><span class="num" id="4271101">0</span><span class="op" id="4271102">:</span><span class="ident" id="4271103">j</span><span class="op" id="4271104">]</span><br>
<span class="lineno"></span><span class="op" id="4271106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4271109">//&nbsp;FilterDecl&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;declaration&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4271179">//&nbsp;all&nbsp;names&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but</span><br>
<span class="lineno">200</span><span class="comment" id="4271248">//&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.</span><br>
<span class="lineno"></span><span class="comment" id="4271315">//</span><br>
<span class="lineno"></span><span class="comment" id="4271318">//&nbsp;FilterDecl&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;declared&nbsp;names&nbsp;left&nbsp;after</span><br>
<span class="lineno"></span><span class="comment" id="4271388">//&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4271430">//</span><br>
<span class="lineno">205</span><span class="keyword" id="4271433">func</span>&nbsp;<span class="ident" id="4271438">FilterDecl</span><span class="op" id="4271448">(</span><span class="ident" id="4271449">decl</span>&nbsp;<span class="ident" id="4271454">Decl</span><span class="op" id="4271458">,</span>&nbsp;<span class="ident" id="4271460">f</span>&nbsp;<span class="ident" id="4271462">Filter</span><span class="op" id="4271468">)</span>&nbsp;<span class="builtintype" id="4271470">bool</span>&nbsp;<span class="op" id="4271475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271478">return</span>&nbsp;<span class="ident" id="4271485">filterDecl</span><span class="op" id="4271495">(</span><span class="ident" id="4271496">decl</span><span class="op" id="4271500">,</span>&nbsp;<span class="ident" id="4271502">f</span><span class="op" id="4271503">,</span>&nbsp;<span class="builtintype" id="4271505">false</span><span class="op" id="4271510">)</span><br>
<span class="lineno"></span><span class="op" id="4271512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4271515">func</span>&nbsp;<span class="ident" id="4271520">filterDecl</span><span class="op" id="4271530">(</span><span class="ident" id="4271531">decl</span>&nbsp;<span class="ident" id="4271536">Decl</span><span class="op" id="4271540">,</span>&nbsp;<span class="ident" id="4271542">f</span>&nbsp;<span class="ident" id="4271544">Filter</span><span class="op" id="4271550">,</span>&nbsp;<span class="ident" id="4271552">export</span>&nbsp;<span class="builtintype" id="4271559">bool</span><span class="op" id="4271563">)</span>&nbsp;<span class="builtintype" id="4271565">bool</span>&nbsp;<span class="op" id="4271570">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271573">switch</span>&nbsp;<span class="ident" id="4271580">d</span>&nbsp;<span class="op" id="4271582">:=</span>&nbsp;<span class="ident" id="4271585">decl</span><span class="op" id="4271589">.</span><span class="op" id="4271590">(</span><span class="keyword" id="4271591">type</span><span class="op" id="4271595">)</span>&nbsp;<span class="op" id="4271597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271600">case</span>&nbsp;<span class="op" id="4271605">*</span><span class="ident" id="4271606">GenDecl</span><span class="op" id="4271613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4271617">d</span><span class="op" id="4271618">.</span><span class="ident" id="4271619">Specs</span>&nbsp;<span class="op" id="4271625">=</span>&nbsp;<span class="ident" id="4271627">filterSpecList</span><span class="op" id="4271641">(</span><span class="ident" id="4271642">d</span><span class="op" id="4271643">.</span><span class="ident" id="4271644">Specs</span><span class="op" id="4271649">,</span>&nbsp;<span class="ident" id="4271651">f</span><span class="op" id="4271652">,</span>&nbsp;<span class="ident" id="4271654">export</span><span class="op" id="4271660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271664">return</span>&nbsp;<span class="builtinfunc" id="4271671">len</span><span class="op" id="4271674">(</span><span class="ident" id="4271675">d</span><span class="op" id="4271676">.</span><span class="ident" id="4271677">Specs</span><span class="op" id="4271682">)</span>&nbsp;<span class="op" id="4271684">&gt;</span>&nbsp;<span class="num" id="4271686">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271689">case</span>&nbsp;<span class="op" id="4271694">*</span><span class="ident" id="4271695">FuncDecl</span><span class="op" id="4271703">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271707">return</span>&nbsp;<span class="ident" id="4271714">f</span><span class="op" id="4271715">(</span><span class="ident" id="4271716">d</span><span class="op" id="4271717">.</span><span class="ident" id="4271718">Name</span><span class="op" id="4271722">.</span><span class="ident" id="4271723">Name</span><span class="op" id="4271727">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4271730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4271733">return</span>&nbsp;<span class="builtintype" id="4271740">false</span><br>
<span class="lineno"></span><span class="op" id="4271746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span><span class="comment" id="4271749">//&nbsp;FilterFile&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;file&nbsp;in&nbsp;place&nbsp;by&nbsp;removing&nbsp;all</span><br>
<span class="lineno"></span><span class="comment" id="4271816">//&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4271881">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4271949">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno"></span><span class="comment" id="4272019">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;File.Comments&nbsp;list</span><br>
<span class="lineno">225</span><span class="comment" id="4272086">//&nbsp;is&nbsp;not&nbsp;changed.</span><br>
<span class="lineno"></span><span class="comment" id="4272105">//</span><br>
<span class="lineno"></span><span class="comment" id="4272108">//&nbsp;FilterFile&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno"></span><span class="comment" id="4272175">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4272228">//</span><br>
<span class="lineno">230</span><span class="keyword" id="4272231">func</span>&nbsp;<span class="ident" id="4272236">FilterFile</span><span class="op" id="4272246">(</span><span class="ident" id="4272247">src</span>&nbsp;<span class="op" id="4272251">*</span><span class="ident" id="4272252">File</span><span class="op" id="4272256">,</span>&nbsp;<span class="ident" id="4272258">f</span>&nbsp;<span class="ident" id="4272260">Filter</span><span class="op" id="4272266">)</span>&nbsp;<span class="builtintype" id="4272268">bool</span>&nbsp;<span class="op" id="4272273">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272276">return</span>&nbsp;<span class="ident" id="4272283">filterFile</span><span class="op" id="4272293">(</span><span class="ident" id="4272294">src</span><span class="op" id="4272297">,</span>&nbsp;<span class="ident" id="4272299">f</span><span class="op" id="4272300">,</span>&nbsp;<span class="builtintype" id="4272302">false</span><span class="op" id="4272307">)</span><br>
<span class="lineno"></span><span class="op" id="4272309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4272312">func</span>&nbsp;<span class="ident" id="4272317">filterFile</span><span class="op" id="4272327">(</span><span class="ident" id="4272328">src</span>&nbsp;<span class="op" id="4272332">*</span><span class="ident" id="4272333">File</span><span class="op" id="4272337">,</span>&nbsp;<span class="ident" id="4272339">f</span>&nbsp;<span class="ident" id="4272341">Filter</span><span class="op" id="4272347">,</span>&nbsp;<span class="ident" id="4272349">export</span>&nbsp;<span class="builtintype" id="4272356">bool</span><span class="op" id="4272360">)</span>&nbsp;<span class="builtintype" id="4272362">bool</span>&nbsp;<span class="op" id="4272367">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272370">j</span>&nbsp;<span class="op" id="4272372">:=</span>&nbsp;<span class="num" id="4272375">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272378">for</span>&nbsp;<span class="ident" id="4272382">_</span><span class="op" id="4272383">,</span>&nbsp;<span class="ident" id="4272385">d</span>&nbsp;<span class="op" id="4272387">:=</span>&nbsp;<span class="keyword" id="4272390">range</span>&nbsp;<span class="ident" id="4272396">src</span><span class="op" id="4272399">.</span><span class="ident" id="4272400">Decls</span>&nbsp;<span class="op" id="4272406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272410">if</span>&nbsp;<span class="ident" id="4272413">filterDecl</span><span class="op" id="4272423">(</span><span class="ident" id="4272424">d</span><span class="op" id="4272425">,</span>&nbsp;<span class="ident" id="4272427">f</span><span class="op" id="4272428">,</span>&nbsp;<span class="ident" id="4272430">export</span><span class="op" id="4272436">)</span>&nbsp;<span class="op" id="4272438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272443">src</span><span class="op" id="4272446">.</span><span class="ident" id="4272447">Decls</span><span class="op" id="4272452">[</span><span class="ident" id="4272453">j</span><span class="op" id="4272454">]</span>&nbsp;<span class="op" id="4272456">=</span>&nbsp;<span class="ident" id="4272458">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272463">j</span><span class="op" id="4272464">++</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4272472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4272475">src</span><span class="op" id="4272478">.</span><span class="ident" id="4272479">Decls</span>&nbsp;<span class="op" id="4272485">=</span>&nbsp;<span class="ident" id="4272487">src</span><span class="op" id="4272490">.</span><span class="ident" id="4272491">Decls</span><span class="op" id="4272496">[</span><span class="num" id="4272497">0</span><span class="op" id="4272498">:</span><span class="ident" id="4272499">j</span><span class="op" id="4272500">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4272503">return</span>&nbsp;<span class="ident" id="4272510">j</span>&nbsp;<span class="op" id="4272512">&gt;</span>&nbsp;<span class="num" id="4272514">0</span><br>
<span class="lineno"></span><span class="op" id="4272516">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="comment" id="4272519">//&nbsp;FilterPackage&nbsp;trims&nbsp;the&nbsp;AST&nbsp;for&nbsp;a&nbsp;Go&nbsp;package&nbsp;in&nbsp;place&nbsp;by&nbsp;removing</span><br>
<span class="lineno"></span><span class="comment" id="4272588">//&nbsp;all&nbsp;names&nbsp;from&nbsp;top-level&nbsp;declarations&nbsp;(including&nbsp;struct&nbsp;field&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4272657">//&nbsp;interface&nbsp;method&nbsp;names,&nbsp;but&nbsp;not&nbsp;from&nbsp;parameter&nbsp;lists)&nbsp;that&nbsp;don&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4272725">//&nbsp;pass&nbsp;through&nbsp;the&nbsp;filter&nbsp;f.&nbsp;If&nbsp;the&nbsp;declaration&nbsp;is&nbsp;empty&nbsp;afterwards,</span><br>
<span class="lineno">250</span><span class="comment" id="4272795">//&nbsp;the&nbsp;declaration&nbsp;is&nbsp;removed&nbsp;from&nbsp;the&nbsp;AST.&nbsp;The&nbsp;pkg.Files&nbsp;list&nbsp;is&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4272865">//&nbsp;changed,&nbsp;so&nbsp;that&nbsp;file&nbsp;names&nbsp;and&nbsp;top-level&nbsp;package&nbsp;comments&nbsp;don&#39;t&nbsp;get</span><br>
<span class="lineno"></span><span class="comment" id="4272937">//&nbsp;lost.</span><br>
<span class="lineno"></span><span class="comment" id="4272946">//</span><br>
<span class="lineno"></span><span class="comment" id="4272949">//&nbsp;FilterPackage&nbsp;returns&nbsp;true&nbsp;if&nbsp;there&nbsp;are&nbsp;any&nbsp;top-level&nbsp;declarations</span><br>
<span class="lineno">255</span><span class="comment" id="4273019">//&nbsp;left&nbsp;after&nbsp;filtering;&nbsp;it&nbsp;returns&nbsp;false&nbsp;otherwise.</span><br>
<span class="lineno"></span><span class="comment" id="4273072">//</span><br>
<span class="lineno"></span><span class="keyword" id="4273075">func</span>&nbsp;<span class="ident" id="4273080">FilterPackage</span><span class="op" id="4273093">(</span><span class="ident" id="4273094">pkg</span>&nbsp;<span class="op" id="4273098">*</span><span class="ident" id="4273099">Package</span><span class="op" id="4273106">,</span>&nbsp;<span class="ident" id="4273108">f</span>&nbsp;<span class="ident" id="4273110">Filter</span><span class="op" id="4273116">)</span>&nbsp;<span class="builtintype" id="4273118">bool</span>&nbsp;<span class="op" id="4273123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273126">return</span>&nbsp;<span class="ident" id="4273133">filterPackage</span><span class="op" id="4273146">(</span><span class="ident" id="4273147">pkg</span><span class="op" id="4273150">,</span>&nbsp;<span class="ident" id="4273152">f</span><span class="op" id="4273153">,</span>&nbsp;<span class="builtintype" id="4273155">false</span><span class="op" id="4273160">)</span><br>
<span class="lineno"></span><span class="op" id="4273162">}</span><br>
<span class="lineno">260</span><br>
<span class="lineno"></span><span class="keyword" id="4273165">func</span>&nbsp;<span class="ident" id="4273170">filterPackage</span><span class="op" id="4273183">(</span><span class="ident" id="4273184">pkg</span>&nbsp;<span class="op" id="4273188">*</span><span class="ident" id="4273189">Package</span><span class="op" id="4273196">,</span>&nbsp;<span class="ident" id="4273198">f</span>&nbsp;<span class="ident" id="4273200">Filter</span><span class="op" id="4273206">,</span>&nbsp;<span class="ident" id="4273208">export</span>&nbsp;<span class="builtintype" id="4273215">bool</span><span class="op" id="4273219">)</span>&nbsp;<span class="builtintype" id="4273221">bool</span>&nbsp;<span class="op" id="4273226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273229">hasDecls</span>&nbsp;<span class="op" id="4273238">:=</span>&nbsp;<span class="builtintype" id="4273241">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273248">for</span>&nbsp;<span class="ident" id="4273252">_</span><span class="op" id="4273253">,</span>&nbsp;<span class="ident" id="4273255">src</span>&nbsp;<span class="op" id="4273259">:=</span>&nbsp;<span class="keyword" id="4273262">range</span>&nbsp;<span class="ident" id="4273268">pkg</span><span class="op" id="4273271">.</span><span class="ident" id="4273272">Files</span>&nbsp;<span class="op" id="4273278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273282">if</span>&nbsp;<span class="ident" id="4273285">filterFile</span><span class="op" id="4273295">(</span><span class="ident" id="4273296">src</span><span class="op" id="4273299">,</span>&nbsp;<span class="ident" id="4273301">f</span><span class="op" id="4273302">,</span>&nbsp;<span class="ident" id="4273304">export</span><span class="op" id="4273310">)</span>&nbsp;<span class="op" id="4273312">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273317">hasDecls</span>&nbsp;<span class="op" id="4273326">=</span>&nbsp;<span class="builtintype" id="4273328">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4273338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4273341">return</span>&nbsp;<span class="ident" id="4273348">hasDecls</span><br>
<span class="lineno"></span><span class="op" id="4273357">}</span><br>
<span class="lineno">270</span><br>
<span class="lineno"></span><span class="comment" id="4273360">//&nbsp;----------------------------------------------------------------------------</span><br>
<span class="lineno"></span><span class="comment" id="4273440">//&nbsp;Merging&nbsp;of&nbsp;package&nbsp;files</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4273469">//&nbsp;The&nbsp;MergeMode&nbsp;flags&nbsp;control&nbsp;the&nbsp;behavior&nbsp;of&nbsp;MergePackageFiles.</span><br>
<span class="lineno">275</span><span class="keyword" id="4273535">type</span>&nbsp;<span class="ident" id="4273540">MergeMode</span>&nbsp;<span class="builtintype" id="4273550">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4273556">const</span>&nbsp;<span class="op" id="4273562">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273565">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;function&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273623">FilterFuncDuplicates</span>&nbsp;<span class="ident" id="4273644">MergeMode</span>&nbsp;<span class="op" id="4273654">=</span>&nbsp;<span class="num" id="4273656">1</span>&nbsp;<span class="op" id="4273658">&lt;&lt;</span>&nbsp;<span class="ident" id="4273661">iota</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273667">//&nbsp;If&nbsp;set,&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;associated&nbsp;with&nbsp;a&nbsp;specific</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273728">//&nbsp;AST&nbsp;node&nbsp;(as&nbsp;Doc&nbsp;or&nbsp;Comment)&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273775">FilterUnassociatedComments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4273803">//&nbsp;If&nbsp;set,&nbsp;duplicate&nbsp;import&nbsp;declarations&nbsp;are&nbsp;excluded.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4273859">FilterImportDuplicates</span><br>
<span class="lineno">285</span><span class="op" id="4273882">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4273885">//&nbsp;nameOf&nbsp;returns&nbsp;the&nbsp;function&nbsp;(foo)&nbsp;or&nbsp;method&nbsp;name&nbsp;(foo.bar)&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4273951">//&nbsp;the&nbsp;given&nbsp;function&nbsp;declaration.&nbsp;If&nbsp;the&nbsp;AST&nbsp;is&nbsp;incorrect&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4274018">//&nbsp;receiver,&nbsp;it&nbsp;assumes&nbsp;a&nbsp;function&nbsp;instead.</span><br>
<span class="lineno">290</span><span class="comment" id="4274062">//</span><br>
<span class="lineno"></span><span class="keyword" id="4274065">func</span>&nbsp;<span class="ident" id="4274070">nameOf</span><span class="op" id="4274076">(</span><span class="ident" id="4274077">f</span>&nbsp;<span class="op" id="4274079">*</span><span class="ident" id="4274080">FuncDecl</span><span class="op" id="4274088">)</span>&nbsp;<span class="builtintype" id="4274090">string</span>&nbsp;<span class="op" id="4274097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274100">if</span>&nbsp;<span class="ident" id="4274103">r</span>&nbsp;<span class="op" id="4274105">:=</span>&nbsp;<span class="ident" id="4274108">f</span><span class="op" id="4274109">.</span><span class="ident" id="4274110">Recv</span><span class="op" id="4274114">;</span>&nbsp;<span class="ident" id="4274116">r</span>&nbsp;<span class="op" id="4274118">!=</span>&nbsp;<span class="ident" id="4274121">nil</span>&nbsp;<span class="op" id="4274125">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="4274128">len</span><span class="op" id="4274131">(</span><span class="ident" id="4274132">r</span><span class="op" id="4274133">.</span><span class="ident" id="4274134">List</span><span class="op" id="4274138">)</span>&nbsp;<span class="op" id="4274140">==</span>&nbsp;<span class="num" id="4274143">1</span>&nbsp;<span class="op" id="4274145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274149">//&nbsp;looks&nbsp;like&nbsp;a&nbsp;correct&nbsp;receiver&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274196">t</span>&nbsp;<span class="op" id="4274198">:=</span>&nbsp;<span class="ident" id="4274201">r</span><span class="op" id="4274202">.</span><span class="ident" id="4274203">List</span><span class="op" id="4274207">[</span><span class="num" id="4274208">0</span><span class="op" id="4274209">]</span><span class="op" id="4274210">.</span><span class="ident" id="4274211">Type</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274218">//&nbsp;dereference&nbsp;pointer&nbsp;receiver&nbsp;types</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274258">if</span>&nbsp;<span class="ident" id="4274261">p</span><span class="op" id="4274262">,</span>&nbsp;<span class="ident" id="4274264">_</span>&nbsp;<span class="op" id="4274266">:=</span>&nbsp;<span class="ident" id="4274269">t</span><span class="op" id="4274270">.</span><span class="op" id="4274271">(</span><span class="op" id="4274272">*</span><span class="ident" id="4274273">StarExpr</span><span class="op" id="4274281">)</span><span class="op" id="4274282">;</span>&nbsp;<span class="ident" id="4274284">p</span>&nbsp;<span class="op" id="4274286">!=</span>&nbsp;<span class="ident" id="4274289">nil</span>&nbsp;<span class="op" id="4274293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4274298">t</span>&nbsp;<span class="op" id="4274300">=</span>&nbsp;<span class="ident" id="4274302">p</span><span class="op" id="4274303">.</span><span class="ident" id="4274304">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274308">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274312">//&nbsp;the&nbsp;receiver&nbsp;type&nbsp;must&nbsp;be&nbsp;a&nbsp;type&nbsp;name</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274355">if</span>&nbsp;<span class="ident" id="4274358">p</span><span class="op" id="4274359">,</span>&nbsp;<span class="ident" id="4274361">_</span>&nbsp;<span class="op" id="4274363">:=</span>&nbsp;<span class="ident" id="4274366">t</span><span class="op" id="4274367">.</span><span class="op" id="4274368">(</span><span class="op" id="4274369">*</span><span class="ident" id="4274370">Ident</span><span class="op" id="4274375">)</span><span class="op" id="4274376">;</span>&nbsp;<span class="ident" id="4274378">p</span>&nbsp;<span class="op" id="4274380">!=</span>&nbsp;<span class="ident" id="4274383">nil</span>&nbsp;<span class="op" id="4274387">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274392">return</span>&nbsp;<span class="ident" id="4274399">p</span><span class="op" id="4274400">.</span><span class="ident" id="4274401">Name</span>&nbsp;<span class="op" id="4274406">+</span>&nbsp;<span class="string" id="4274408">&#34;.&#34;</span>&nbsp;<span class="op" id="4274412">+</span>&nbsp;<span class="ident" id="4274414">f</span><span class="op" id="4274415">.</span><span class="ident" id="4274416">Name</span><span class="op" id="4274420">.</span><span class="ident" id="4274421">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274432">//&nbsp;otherwise&nbsp;assume&nbsp;a&nbsp;function&nbsp;instead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4274472">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4274475">return</span>&nbsp;<span class="ident" id="4274482">f</span><span class="op" id="4274483">.</span><span class="ident" id="4274484">Name</span><span class="op" id="4274488">.</span><span class="ident" id="4274489">Name</span><br>
<span class="lineno"></span><span class="op" id="4274494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4274497">//&nbsp;separator&nbsp;is&nbsp;an&nbsp;empty&nbsp;//-style&nbsp;comment&nbsp;that&nbsp;is&nbsp;interspersed&nbsp;between</span><br>
<span class="lineno"></span><span class="comment" id="4274568">//&nbsp;different&nbsp;comment&nbsp;groups&nbsp;when&nbsp;they&nbsp;are&nbsp;concatenated&nbsp;into&nbsp;a&nbsp;single&nbsp;group</span><br>
<span class="lineno">310</span><span class="comment" id="4274643">//</span><br>
<span class="lineno"></span><span class="keyword" id="4274646">var</span>&nbsp;<span class="ident" id="4274650">separator</span>&nbsp;<span class="op" id="4274660">=</span>&nbsp;<span class="op" id="4274662">&amp;</span><span class="ident" id="4274663">Comment</span><span class="op" id="4274670">{</span><span class="ident" id="4274671">token</span><span class="op" id="4274676">.</span><span class="ident" id="4274677">NoPos</span><span class="op" id="4274682">,</span>&nbsp;<span class="string" id="4274684">&#34;//&#34;</span><span class="op" id="4274688">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4274691">//&nbsp;MergePackageFiles&nbsp;creates&nbsp;a&nbsp;file&nbsp;AST&nbsp;by&nbsp;merging&nbsp;the&nbsp;ASTs&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4274758">//&nbsp;files&nbsp;belonging&nbsp;to&nbsp;a&nbsp;package.&nbsp;The&nbsp;mode&nbsp;flags&nbsp;control&nbsp;merging&nbsp;behavior.</span><br>
<span class="lineno">315</span><span class="comment" id="4274832">//</span><br>
<span class="lineno"></span><span class="keyword" id="4274835">func</span>&nbsp;<span class="ident" id="4274840">MergePackageFiles</span><span class="op" id="4274857">(</span><span class="ident" id="4274858">pkg</span>&nbsp;<span class="op" id="4274862">*</span><span class="ident" id="4274863">Package</span><span class="op" id="4274870">,</span>&nbsp;<span class="ident" id="4274872">mode</span>&nbsp;<span class="ident" id="4274877">MergeMode</span><span class="op" id="4274886">)</span>&nbsp;<span class="op" id="4274888">*</span><span class="ident" id="4274889">File</span>&nbsp;<span class="op" id="4274894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274897">//&nbsp;Count&nbsp;the&nbsp;number&nbsp;of&nbsp;package&nbsp;docs,&nbsp;comments&nbsp;and&nbsp;declarations&nbsp;across</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4274968">//&nbsp;all&nbsp;package&nbsp;files.&nbsp;Also,&nbsp;compute&nbsp;sorted&nbsp;list&nbsp;of&nbsp;filenames,&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275039">//&nbsp;subsequent&nbsp;iterations&nbsp;can&nbsp;always&nbsp;iterate&nbsp;in&nbsp;the&nbsp;same&nbsp;order.</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275103">ndocs</span>&nbsp;<span class="op" id="4275109">:=</span>&nbsp;<span class="num" id="4275112">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275115">ncomments</span>&nbsp;<span class="op" id="4275125">:=</span>&nbsp;<span class="num" id="4275128">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275131">ndecls</span>&nbsp;<span class="op" id="4275138">:=</span>&nbsp;<span class="num" id="4275141">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275144">filenames</span>&nbsp;<span class="op" id="4275154">:=</span>&nbsp;<span class="builtinfunc" id="4275157">make</span><span class="op" id="4275161">(</span><span class="op" id="4275162">[</span><span class="op" id="4275163">]</span><span class="builtintype" id="4275164">string</span><span class="op" id="4275170">,</span>&nbsp;<span class="builtinfunc" id="4275172">len</span><span class="op" id="4275175">(</span><span class="ident" id="4275176">pkg</span><span class="op" id="4275179">.</span><span class="ident" id="4275180">Files</span><span class="op" id="4275185">)</span><span class="op" id="4275186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275189">i</span>&nbsp;<span class="op" id="4275191">:=</span>&nbsp;<span class="num" id="4275194">0</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275197">for</span>&nbsp;<span class="ident" id="4275201">filename</span><span class="op" id="4275209">,</span>&nbsp;<span class="ident" id="4275211">f</span>&nbsp;<span class="op" id="4275213">:=</span>&nbsp;<span class="keyword" id="4275216">range</span>&nbsp;<span class="ident" id="4275222">pkg</span><span class="op" id="4275225">.</span><span class="ident" id="4275226">Files</span>&nbsp;<span class="op" id="4275232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275236">filenames</span><span class="op" id="4275245">[</span><span class="ident" id="4275246">i</span><span class="op" id="4275247">]</span>&nbsp;<span class="op" id="4275249">=</span>&nbsp;<span class="ident" id="4275251">filename</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275262">i</span><span class="op" id="4275263">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275268">if</span>&nbsp;<span class="ident" id="4275271">f</span><span class="op" id="4275272">.</span><span class="ident" id="4275273">Doc</span>&nbsp;<span class="op" id="4275277">!=</span>&nbsp;<span class="ident" id="4275280">nil</span>&nbsp;<span class="op" id="4275284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275289">ndocs</span>&nbsp;<span class="op" id="4275295">+=</span>&nbsp;<span class="builtinfunc" id="4275298">len</span><span class="op" id="4275301">(</span><span class="ident" id="4275302">f</span><span class="op" id="4275303">.</span><span class="ident" id="4275304">Doc</span><span class="op" id="4275307">.</span><span class="ident" id="4275308">List</span><span class="op" id="4275312">)</span>&nbsp;<span class="op" id="4275314">+</span>&nbsp;<span class="num" id="4275316">1</span>&nbsp;<span class="comment" id="4275318">//&nbsp;+1&nbsp;for&nbsp;separator</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275344">ncomments</span>&nbsp;<span class="op" id="4275354">+=</span>&nbsp;<span class="builtinfunc" id="4275357">len</span><span class="op" id="4275360">(</span><span class="ident" id="4275361">f</span><span class="op" id="4275362">.</span><span class="ident" id="4275363">Comments</span><span class="op" id="4275371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275375">ndecls</span>&nbsp;<span class="op" id="4275382">+=</span>&nbsp;<span class="builtinfunc" id="4275385">len</span><span class="op" id="4275388">(</span><span class="ident" id="4275389">f</span><span class="op" id="4275390">.</span><span class="ident" id="4275391">Decls</span><span class="op" id="4275396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4275399">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275402">sort</span><span class="op" id="4275406">.</span><span class="ident" id="4275407">Strings</span><span class="op" id="4275414">(</span><span class="ident" id="4275415">filenames</span><span class="op" id="4275424">)</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275428">//&nbsp;Collect&nbsp;package&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files&nbsp;into&nbsp;a&nbsp;single</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275494">//&nbsp;CommentGroup&nbsp;-&nbsp;the&nbsp;collected&nbsp;package&nbsp;documentation.&nbsp;In&nbsp;general</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275561">//&nbsp;there&nbsp;should&nbsp;be&nbsp;only&nbsp;one&nbsp;file&nbsp;with&nbsp;a&nbsp;package&nbsp;comment;&nbsp;but&nbsp;it&#39;s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275628">//&nbsp;better&nbsp;to&nbsp;collect&nbsp;extra&nbsp;comments&nbsp;than&nbsp;drop&nbsp;them&nbsp;on&nbsp;the&nbsp;floor.</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275694">var</span>&nbsp;<span class="ident" id="4275698">doc</span>&nbsp;<span class="op" id="4275702">*</span><span class="ident" id="4275703">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275717">var</span>&nbsp;<span class="ident" id="4275721">pos</span>&nbsp;<span class="ident" id="4275725">token</span><span class="op" id="4275730">.</span><span class="ident" id="4275731">Pos</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275736">if</span>&nbsp;<span class="ident" id="4275739">ndocs</span>&nbsp;<span class="op" id="4275745">&gt;</span>&nbsp;<span class="num" id="4275747">0</span>&nbsp;<span class="op" id="4275749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275753">list</span>&nbsp;<span class="op" id="4275758">:=</span>&nbsp;<span class="builtinfunc" id="4275761">make</span><span class="op" id="4275765">(</span><span class="op" id="4275766">[</span><span class="op" id="4275767">]</span><span class="op" id="4275768">*</span><span class="ident" id="4275769">Comment</span><span class="op" id="4275776">,</span>&nbsp;<span class="ident" id="4275778">ndocs</span><span class="op" id="4275783">-</span><span class="num" id="4275784">1</span><span class="op" id="4275785">)</span>&nbsp;<span class="comment" id="4275787">//&nbsp;-1:&nbsp;no&nbsp;separator&nbsp;before&nbsp;first&nbsp;group</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275828">i</span>&nbsp;<span class="op" id="4275830">:=</span>&nbsp;<span class="num" id="4275833">0</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275837">for</span>&nbsp;<span class="ident" id="4275841">_</span><span class="op" id="4275842">,</span>&nbsp;<span class="ident" id="4275844">filename</span>&nbsp;<span class="op" id="4275853">:=</span>&nbsp;<span class="keyword" id="4275856">range</span>&nbsp;<span class="ident" id="4275862">filenames</span>&nbsp;<span class="op" id="4275872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275877">f</span>&nbsp;<span class="op" id="4275879">:=</span>&nbsp;<span class="ident" id="4275882">pkg</span><span class="op" id="4275885">.</span><span class="ident" id="4275886">Files</span><span class="op" id="4275891">[</span><span class="ident" id="4275892">filename</span><span class="op" id="4275900">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275905">if</span>&nbsp;<span class="ident" id="4275908">f</span><span class="op" id="4275909">.</span><span class="ident" id="4275910">Doc</span>&nbsp;<span class="op" id="4275914">!=</span>&nbsp;<span class="ident" id="4275917">nil</span>&nbsp;<span class="op" id="4275921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4275927">if</span>&nbsp;<span class="ident" id="4275930">i</span>&nbsp;<span class="op" id="4275932">&gt;</span>&nbsp;<span class="num" id="4275934">0</span>&nbsp;<span class="op" id="4275936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4275943">//&nbsp;not&nbsp;the&nbsp;first&nbsp;group&nbsp;-&nbsp;add&nbsp;separator</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4275987">list</span><span class="op" id="4275991">[</span><span class="ident" id="4275992">i</span><span class="op" id="4275993">]</span>&nbsp;<span class="op" id="4275995">=</span>&nbsp;<span class="ident" id="4275997">separator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276012">i</span><span class="op" id="4276013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276026">for</span>&nbsp;<span class="ident" id="4276030">_</span><span class="op" id="4276031">,</span>&nbsp;<span class="ident" id="4276033">c</span>&nbsp;<span class="op" id="4276035">:=</span>&nbsp;<span class="keyword" id="4276038">range</span>&nbsp;<span class="ident" id="4276044">f</span><span class="op" id="4276045">.</span><span class="ident" id="4276046">Doc</span><span class="op" id="4276049">.</span><span class="ident" id="4276050">List</span>&nbsp;<span class="op" id="4276055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276062">list</span><span class="op" id="4276066">[</span><span class="ident" id="4276067">i</span><span class="op" id="4276068">]</span>&nbsp;<span class="op" id="4276070">=</span>&nbsp;<span class="ident" id="4276072">c</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276079">i</span><span class="op" id="4276080">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276093">if</span>&nbsp;<span class="ident" id="4276096">f</span><span class="op" id="4276097">.</span><span class="ident" id="4276098">Package</span>&nbsp;<span class="op" id="4276106">&gt;</span>&nbsp;<span class="ident" id="4276108">pos</span>&nbsp;<span class="op" id="4276112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276119">//&nbsp;Keep&nbsp;the&nbsp;maximum&nbsp;package&nbsp;clause&nbsp;position&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276171">//&nbsp;position&nbsp;for&nbsp;the&nbsp;package&nbsp;clause&nbsp;of&nbsp;the&nbsp;merged</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276225">//&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276240">pos</span>&nbsp;<span class="op" id="4276244">=</span>&nbsp;<span class="ident" id="4276246">f</span><span class="op" id="4276247">.</span><span class="ident" id="4276248">Package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276265">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276269">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276273">doc</span>&nbsp;<span class="op" id="4276277">=</span>&nbsp;<span class="op" id="4276279">&amp;</span><span class="ident" id="4276280">CommentGroup</span><span class="op" id="4276292">{</span><span class="ident" id="4276293">list</span><span class="op" id="4276297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4276300">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276304">//&nbsp;Collect&nbsp;declarations&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276353">var</span>&nbsp;<span class="ident" id="4276357">decls</span>&nbsp;<span class="op" id="4276363">[</span><span class="op" id="4276364">]</span><span class="ident" id="4276365">Decl</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276371">if</span>&nbsp;<span class="ident" id="4276374">ndecls</span>&nbsp;<span class="op" id="4276381">&gt;</span>&nbsp;<span class="num" id="4276383">0</span>&nbsp;<span class="op" id="4276385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276389">decls</span>&nbsp;<span class="op" id="4276395">=</span>&nbsp;<span class="builtinfunc" id="4276397">make</span><span class="op" id="4276401">(</span><span class="op" id="4276402">[</span><span class="op" id="4276403">]</span><span class="ident" id="4276404">Decl</span><span class="op" id="4276408">,</span>&nbsp;<span class="ident" id="4276410">ndecls</span><span class="op" id="4276416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276420">funcs</span>&nbsp;<span class="op" id="4276426">:=</span>&nbsp;<span class="builtinfunc" id="4276429">make</span><span class="op" id="4276433">(</span><span class="keyword" id="4276434">map</span><span class="op" id="4276437">[</span><span class="builtintype" id="4276438">string</span><span class="op" id="4276444">]</span><span class="builtintype" id="4276445">int</span><span class="op" id="4276448">)</span>&nbsp;<span class="comment" id="4276450">//&nbsp;map&nbsp;of&nbsp;func&nbsp;name&nbsp;-&gt;&nbsp;decls&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276487">i</span>&nbsp;<span class="op" id="4276489">:=</span>&nbsp;<span class="num" id="4276492">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4276517">//&nbsp;current&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276536">n</span>&nbsp;<span class="op" id="4276538">:=</span>&nbsp;<span class="num" id="4276541">0</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4276566">//&nbsp;number&nbsp;of&nbsp;filtered&nbsp;entries</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276598">for</span>&nbsp;<span class="ident" id="4276602">_</span><span class="op" id="4276603">,</span>&nbsp;<span class="ident" id="4276605">filename</span>&nbsp;<span class="op" id="4276614">:=</span>&nbsp;<span class="keyword" id="4276617">range</span>&nbsp;<span class="ident" id="4276623">filenames</span>&nbsp;<span class="op" id="4276633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4276638">f</span>&nbsp;<span class="op" id="4276640">:=</span>&nbsp;<span class="ident" id="4276643">pkg</span><span class="op" id="4276646">.</span><span class="ident" id="4276647">Files</span><span class="op" id="4276652">[</span><span class="ident" id="4276653">filename</span><span class="op" id="4276661">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276666">for</span>&nbsp;<span class="ident" id="4276670">_</span><span class="op" id="4276671">,</span>&nbsp;<span class="ident" id="4276673">d</span>&nbsp;<span class="op" id="4276675">:=</span>&nbsp;<span class="keyword" id="4276678">range</span>&nbsp;<span class="ident" id="4276684">f</span><span class="op" id="4276685">.</span><span class="ident" id="4276686">Decls</span>&nbsp;<span class="op" id="4276692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4276698">if</span>&nbsp;<span class="ident" id="4276701">mode</span><span class="op" id="4276705">&amp;</span><span class="ident" id="4276706">FilterFuncDuplicates</span>&nbsp;<span class="op" id="4276727">!=</span>&nbsp;<span class="num" id="4276730">0</span>&nbsp;<span class="op" id="4276732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276739">//&nbsp;A&nbsp;language&nbsp;entity&nbsp;may&nbsp;be&nbsp;declared&nbsp;multiple</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276790">//&nbsp;times&nbsp;in&nbsp;different&nbsp;package&nbsp;files;&nbsp;only&nbsp;at</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276840">//&nbsp;build&nbsp;time&nbsp;declarations&nbsp;must&nbsp;be&nbsp;unique.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276888">//&nbsp;For&nbsp;now,&nbsp;exclude&nbsp;multiple&nbsp;declarations&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276938">//&nbsp;functions&nbsp;-&nbsp;keep&nbsp;the&nbsp;one&nbsp;with&nbsp;documentation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276991">//</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4276999">//&nbsp;TODO(gri):&nbsp;Expand&nbsp;this&nbsp;filtering&nbsp;to&nbsp;other</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277049">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entities&nbsp;(const,&nbsp;type,&nbsp;vars)&nbsp;if</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277100">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;multiple&nbsp;declarations&nbsp;are&nbsp;common.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277153">if</span>&nbsp;<span class="ident" id="4277156">f</span><span class="op" id="4277157">,</span>&nbsp;<span class="ident" id="4277159">isFun</span>&nbsp;<span class="op" id="4277165">:=</span>&nbsp;<span class="ident" id="4277168">d</span><span class="op" id="4277169">.</span><span class="op" id="4277170">(</span><span class="op" id="4277171">*</span><span class="ident" id="4277172">FuncDecl</span><span class="op" id="4277180">)</span><span class="op" id="4277181">;</span>&nbsp;<span class="ident" id="4277183">isFun</span>&nbsp;<span class="op" id="4277189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277197">name</span>&nbsp;<span class="op" id="4277202">:=</span>&nbsp;<span class="ident" id="4277205">nameOf</span><span class="op" id="4277211">(</span><span class="ident" id="4277212">f</span><span class="op" id="4277213">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277221">if</span>&nbsp;<span class="ident" id="4277224">j</span><span class="op" id="4277225">,</span>&nbsp;<span class="ident" id="4277227">exists</span>&nbsp;<span class="op" id="4277234">:=</span>&nbsp;<span class="ident" id="4277237">funcs</span><span class="op" id="4277242">[</span><span class="ident" id="4277243">name</span><span class="op" id="4277247">]</span><span class="op" id="4277248">;</span>&nbsp;<span class="ident" id="4277250">exists</span>&nbsp;<span class="op" id="4277257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277266">//&nbsp;function&nbsp;declared&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277302">if</span>&nbsp;<span class="ident" id="4277305">decls</span><span class="op" id="4277310">[</span><span class="ident" id="4277311">j</span><span class="op" id="4277312">]</span>&nbsp;<span class="op" id="4277314">!=</span>&nbsp;<span class="ident" id="4277317">nil</span>&nbsp;<span class="op" id="4277321">&amp;&amp;</span>&nbsp;<span class="ident" id="4277324">decls</span><span class="op" id="4277329">[</span><span class="ident" id="4277330">j</span><span class="op" id="4277331">]</span><span class="op" id="4277332">.</span><span class="op" id="4277333">(</span><span class="op" id="4277334">*</span><span class="ident" id="4277335">FuncDecl</span><span class="op" id="4277343">)</span><span class="op" id="4277344">.</span><span class="ident" id="4277345">Doc</span>&nbsp;<span class="op" id="4277349">==</span>&nbsp;<span class="ident" id="4277352">nil</span>&nbsp;<span class="op" id="4277356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277366">//&nbsp;existing&nbsp;declaration&nbsp;has&nbsp;no&nbsp;documentation;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277420">//&nbsp;ignore&nbsp;the&nbsp;existing&nbsp;declaration</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277463">decls</span><span class="op" id="4277468">[</span><span class="ident" id="4277469">j</span><span class="op" id="4277470">]</span>&nbsp;<span class="op" id="4277472">=</span>&nbsp;<span class="ident" id="4277474">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277485">}</span>&nbsp;<span class="keyword" id="4277487">else</span>&nbsp;<span class="op" id="4277492">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277502">//&nbsp;ignore&nbsp;the&nbsp;new&nbsp;declaration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277540">d</span>&nbsp;<span class="op" id="4277542">=</span>&nbsp;<span class="ident" id="4277544">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277555">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277564">n</span><span class="op" id="4277565">++</span>&nbsp;<span class="comment" id="4277568">//&nbsp;filtered&nbsp;an&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277595">}</span>&nbsp;<span class="keyword" id="4277597">else</span>&nbsp;<span class="op" id="4277602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277611">funcs</span><span class="op" id="4277616">[</span><span class="ident" id="4277617">name</span><span class="op" id="4277621">]</span>&nbsp;<span class="op" id="4277623">=</span>&nbsp;<span class="ident" id="4277625">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277640">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277652">decls</span><span class="op" id="4277657">[</span><span class="ident" id="4277658">i</span><span class="op" id="4277659">]</span>&nbsp;<span class="op" id="4277661">=</span>&nbsp;<span class="ident" id="4277663">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277669">i</span><span class="op" id="4277670">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4277680">}</span><br>
<span class="lineno">410</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277685">//&nbsp;Eliminate&nbsp;nil&nbsp;entries&nbsp;from&nbsp;the&nbsp;decls&nbsp;list&nbsp;if&nbsp;entries&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277748">//&nbsp;filtered.&nbsp;We&nbsp;do&nbsp;this&nbsp;using&nbsp;a&nbsp;2nd&nbsp;pass&nbsp;in&nbsp;order&nbsp;to&nbsp;not&nbsp;disturb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277815">//&nbsp;the&nbsp;original&nbsp;declaration&nbsp;order&nbsp;in&nbsp;the&nbsp;source&nbsp;(otherwise,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277882">//&nbsp;would&nbsp;also&nbsp;invalidate&nbsp;the&nbsp;monotonically&nbsp;increasing&nbsp;position</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4277947">//&nbsp;info&nbsp;within&nbsp;a&nbsp;single&nbsp;file).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4277980">if</span>&nbsp;<span class="ident" id="4277983">n</span>&nbsp;<span class="op" id="4277985">&gt;</span>&nbsp;<span class="num" id="4277987">0</span>&nbsp;<span class="op" id="4277989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4277994">i</span>&nbsp;<span class="op" id="4277996">=</span>&nbsp;<span class="num" id="4277998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278003">for</span>&nbsp;<span class="ident" id="4278007">_</span><span class="op" id="4278008">,</span>&nbsp;<span class="ident" id="4278010">d</span>&nbsp;<span class="op" id="4278012">:=</span>&nbsp;<span class="keyword" id="4278015">range</span>&nbsp;<span class="ident" id="4278021">decls</span>&nbsp;<span class="op" id="4278027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278033">if</span>&nbsp;<span class="ident" id="4278036">d</span>&nbsp;<span class="op" id="4278038">!=</span>&nbsp;<span class="ident" id="4278041">nil</span>&nbsp;<span class="op" id="4278045">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278052">decls</span><span class="op" id="4278057">[</span><span class="ident" id="4278058">i</span><span class="op" id="4278059">]</span>&nbsp;<span class="op" id="4278061">=</span>&nbsp;<span class="ident" id="4278063">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278070">i</span><span class="op" id="4278071">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278078">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278083">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278088">decls</span>&nbsp;<span class="op" id="4278094">=</span>&nbsp;<span class="ident" id="4278096">decls</span><span class="op" id="4278101">[</span><span class="num" id="4278102">0</span><span class="op" id="4278103">:</span><span class="ident" id="4278104">i</span><span class="op" id="4278105">]</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278116">//&nbsp;Collect&nbsp;import&nbsp;specs&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278165">var</span>&nbsp;<span class="ident" id="4278169">imports</span>&nbsp;<span class="op" id="4278177">[</span><span class="op" id="4278178">]</span><span class="op" id="4278179">*</span><span class="ident" id="4278180">ImportSpec</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278192">if</span>&nbsp;<span class="ident" id="4278195">mode</span><span class="op" id="4278199">&amp;</span><span class="ident" id="4278200">FilterImportDuplicates</span>&nbsp;<span class="op" id="4278223">!=</span>&nbsp;<span class="num" id="4278226">0</span>&nbsp;<span class="op" id="4278228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278232">seen</span>&nbsp;<span class="op" id="4278237">:=</span>&nbsp;<span class="builtinfunc" id="4278240">make</span><span class="op" id="4278244">(</span><span class="keyword" id="4278245">map</span><span class="op" id="4278248">[</span><span class="builtintype" id="4278249">string</span><span class="op" id="4278255">]</span><span class="builtintype" id="4278256">bool</span><span class="op" id="4278260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278264">for</span>&nbsp;<span class="ident" id="4278268">_</span><span class="op" id="4278269">,</span>&nbsp;<span class="ident" id="4278271">filename</span>&nbsp;<span class="op" id="4278280">:=</span>&nbsp;<span class="keyword" id="4278283">range</span>&nbsp;<span class="ident" id="4278289">filenames</span>&nbsp;<span class="op" id="4278299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278304">f</span>&nbsp;<span class="op" id="4278306">:=</span>&nbsp;<span class="ident" id="4278309">pkg</span><span class="op" id="4278312">.</span><span class="ident" id="4278313">Files</span><span class="op" id="4278318">[</span><span class="ident" id="4278319">filename</span><span class="op" id="4278327">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278332">for</span>&nbsp;<span class="ident" id="4278336">_</span><span class="op" id="4278337">,</span>&nbsp;<span class="ident" id="4278339">imp</span>&nbsp;<span class="op" id="4278343">:=</span>&nbsp;<span class="keyword" id="4278346">range</span>&nbsp;<span class="ident" id="4278352">f</span><span class="op" id="4278353">.</span><span class="ident" id="4278354">Imports</span>&nbsp;<span class="op" id="4278362">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278368">if</span>&nbsp;<span class="ident" id="4278371">path</span>&nbsp;<span class="op" id="4278376">:=</span>&nbsp;<span class="ident" id="4278379">imp</span><span class="op" id="4278382">.</span><span class="ident" id="4278383">Path</span><span class="op" id="4278387">.</span><span class="ident" id="4278388">Value</span><span class="op" id="4278393">;</span>&nbsp;<span class="op" id="4278395">!</span><span class="ident" id="4278396">seen</span><span class="op" id="4278400">[</span><span class="ident" id="4278401">path</span><span class="op" id="4278405">]</span>&nbsp;<span class="op" id="4278407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278414">//&nbsp;TODO:&nbsp;consider&nbsp;handling&nbsp;cases&nbsp;where:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278459">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;with&nbsp;the&nbsp;same&nbsp;import&nbsp;path&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278515">//&nbsp;&nbsp;&nbsp;have&nbsp;different&nbsp;local&nbsp;names&nbsp;(one&nbsp;should&nbsp;probably</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278573">//&nbsp;&nbsp;&nbsp;keep&nbsp;both&nbsp;of&nbsp;them)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278602">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;but&nbsp;only&nbsp;one&nbsp;has&nbsp;a&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278655">//&nbsp;-&nbsp;2&nbsp;imports&nbsp;exist&nbsp;and&nbsp;they&nbsp;both&nbsp;have&nbsp;(possibly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278710">//&nbsp;&nbsp;&nbsp;different)&nbsp;comments</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278740">imports</span>&nbsp;<span class="op" id="4278748">=</span>&nbsp;<span class="builtinfunc" id="4278750">append</span><span class="op" id="4278756">(</span><span class="ident" id="4278757">imports</span><span class="op" id="4278764">,</span>&nbsp;<span class="ident" id="4278766">imp</span><span class="op" id="4278769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278776">seen</span><span class="op" id="4278780">[</span><span class="ident" id="4278781">path</span><span class="op" id="4278785">]</span>&nbsp;<span class="op" id="4278787">=</span>&nbsp;<span class="builtintype" id="4278789">true</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278807">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278810">}</span>&nbsp;<span class="keyword" id="4278812">else</span>&nbsp;<span class="op" id="4278817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278821">for</span>&nbsp;<span class="ident" id="4278825">_</span><span class="op" id="4278826">,</span>&nbsp;<span class="ident" id="4278828">f</span>&nbsp;<span class="op" id="4278830">:=</span>&nbsp;<span class="keyword" id="4278833">range</span>&nbsp;<span class="ident" id="4278839">pkg</span><span class="op" id="4278842">.</span><span class="ident" id="4278843">Files</span>&nbsp;<span class="op" id="4278849">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4278854">imports</span>&nbsp;<span class="op" id="4278862">=</span>&nbsp;<span class="builtinfunc" id="4278864">append</span><span class="op" id="4278870">(</span><span class="ident" id="4278871">imports</span><span class="op" id="4278878">,</span>&nbsp;<span class="ident" id="4278880">f</span><span class="op" id="4278881">.</span><span class="ident" id="4278882">Imports</span><span class="op" id="4278889">...</span><span class="op" id="4278892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4278899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4278903">//&nbsp;Collect&nbsp;comments&nbsp;from&nbsp;all&nbsp;package&nbsp;files.</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278948">var</span>&nbsp;<span class="ident" id="4278952">comments</span>&nbsp;<span class="op" id="4278961">[</span><span class="op" id="4278962">]</span><span class="op" id="4278963">*</span><span class="ident" id="4278964">CommentGroup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4278978">if</span>&nbsp;<span class="ident" id="4278981">mode</span><span class="op" id="4278985">&amp;</span><span class="ident" id="4278986">FilterUnassociatedComments</span>&nbsp;<span class="op" id="4279013">==</span>&nbsp;<span class="num" id="4279016">0</span>&nbsp;<span class="op" id="4279018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279022">comments</span>&nbsp;<span class="op" id="4279031">=</span>&nbsp;<span class="builtinfunc" id="4279033">make</span><span class="op" id="4279037">(</span><span class="op" id="4279038">[</span><span class="op" id="4279039">]</span><span class="op" id="4279040">*</span><span class="ident" id="4279041">CommentGroup</span><span class="op" id="4279053">,</span>&nbsp;<span class="ident" id="4279055">ncomments</span><span class="op" id="4279064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279068">i</span>&nbsp;<span class="op" id="4279070">:=</span>&nbsp;<span class="num" id="4279073">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279077">for</span>&nbsp;<span class="ident" id="4279081">_</span><span class="op" id="4279082">,</span>&nbsp;<span class="ident" id="4279084">f</span>&nbsp;<span class="op" id="4279086">:=</span>&nbsp;<span class="keyword" id="4279089">range</span>&nbsp;<span class="ident" id="4279095">pkg</span><span class="op" id="4279098">.</span><span class="ident" id="4279099">Files</span>&nbsp;<span class="op" id="4279105">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4279110">i</span>&nbsp;<span class="op" id="4279112">+=</span>&nbsp;<span class="builtinfunc" id="4279115">copy</span><span class="op" id="4279119">(</span><span class="ident" id="4279120">comments</span><span class="op" id="4279128">[</span><span class="ident" id="4279129">i</span><span class="op" id="4279130">:</span><span class="op" id="4279131">]</span><span class="op" id="4279132">,</span>&nbsp;<span class="ident" id="4279134">f</span><span class="op" id="4279135">.</span><span class="ident" id="4279136">Comments</span><span class="op" id="4279144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4279151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4279155">//&nbsp;TODO(gri)&nbsp;need&nbsp;to&nbsp;compute&nbsp;unresolved&nbsp;identifiers!</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4279209">return</span>&nbsp;<span class="op" id="4279216">&amp;</span><span class="ident" id="4279217">File</span><span class="op" id="4279221">{</span><span class="ident" id="4279222">doc</span><span class="op" id="4279225">,</span>&nbsp;<span class="ident" id="4279227">pos</span><span class="op" id="4279230">,</span>&nbsp;<span class="ident" id="4279232">NewIdent</span><span class="op" id="4279240">(</span><span class="ident" id="4279241">pkg</span><span class="op" id="4279244">.</span><span class="ident" id="4279245">Name</span><span class="op" id="4279249">)</span><span class="op" id="4279250">,</span>&nbsp;<span class="ident" id="4279252">decls</span><span class="op" id="4279257">,</span>&nbsp;<span class="ident" id="4279259">pkg</span><span class="op" id="4279262">.</span><span class="ident" id="4279263">Scope</span><span class="op" id="4279268">,</span>&nbsp;<span class="ident" id="4279270">imports</span><span class="op" id="4279277">,</span>&nbsp;<span class="ident" id="4279279">nil</span><span class="op" id="4279282">,</span>&nbsp;<span class="ident" id="4279284">comments</span><span class="op" id="4279292">}</span><br>
<span class="lineno"></span><span class="op" id="4279294">}</span>
</div>
</body>
</html>
