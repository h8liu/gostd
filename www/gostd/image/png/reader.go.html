<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5941182">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5941237">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5941291">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5941342">//&nbsp;Package&nbsp;png&nbsp;implements&nbsp;a&nbsp;PNG&nbsp;image&nbsp;decoder&nbsp;and&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="5941401">//</span><br>
<span class="lineno"></span><span class="comment" id="5941404">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;is&nbsp;at&nbsp;http://www.w3.org/TR/PNG/.</span><br>
<span class="lineno"></span><span class="keyword" id="5941462">package</span>&nbsp;<span class="ident" id="5941470">png</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5941475">import</span>&nbsp;<span class="op" id="5941482">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941485">&#34;compress/zlib&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941502">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941521">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941528">&#34;hash&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941536">&#34;hash/crc32&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941550">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941559">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5941574">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5941579">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="comment" id="5941582">//&nbsp;Color&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5941618">const</span>&nbsp;<span class="op" id="5941624">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941627">ctGrayscale</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941644">=</span>&nbsp;<span class="num" id="5941646">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941649">ctTrueColor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941666">=</span>&nbsp;<span class="num" id="5941668">2</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941671">ctPaletted</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941688">=</span>&nbsp;<span class="num" id="5941690">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941693">ctGrayscaleAlpha</span>&nbsp;<span class="op" id="5941710">=</span>&nbsp;<span class="num" id="5941712">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941715">ctTrueColorAlpha</span>&nbsp;<span class="op" id="5941732">=</span>&nbsp;<span class="num" id="5941734">6</span><br>
<span class="lineno"></span><span class="op" id="5941736">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5941739">//&nbsp;A&nbsp;cb&nbsp;is&nbsp;a&nbsp;combination&nbsp;of&nbsp;color&nbsp;type&nbsp;and&nbsp;bit&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="5941793">const</span>&nbsp;<span class="op" id="5941799">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941802">cbInvalid</span>&nbsp;<span class="op" id="5941812">=</span>&nbsp;<span class="ident" id="5941814">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941820">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941826">cbG2</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941832">cbG4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941838">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941844">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941851">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941858">cbP1</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941864">cbP2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941870">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941876">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941882">cbTCA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941890">cbG16</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941897">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941905">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941913">cbTCA16</span><br>
<span class="lineno"></span><span class="op" id="5941921">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="5941924">//&nbsp;Filter&nbsp;type,&nbsp;as&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec.</span><br>
<span class="lineno"></span><span class="keyword" id="5941961">const</span>&nbsp;<span class="op" id="5941967">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941970">ftNone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941980">=</span>&nbsp;<span class="num" id="5941982">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5941985">ftSub</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5941995">=</span>&nbsp;<span class="num" id="5941997">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942000">ftUp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942010">=</span>&nbsp;<span class="num" id="5942012">2</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942015">ftAverage</span>&nbsp;<span class="op" id="5942025">=</span>&nbsp;<span class="num" id="5942027">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942030">ftPaeth</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5942040">=</span>&nbsp;<span class="num" id="5942042">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942045">nFilter</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5942055">=</span>&nbsp;<span class="num" id="5942057">5</span><br>
<span class="lineno"></span><span class="op" id="5942059">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5942062">//&nbsp;Interlace&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="5942081">const</span>&nbsp;<span class="op" id="5942087">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942090">itNone</span>&nbsp;&nbsp;<span class="op" id="5942098">=</span>&nbsp;<span class="num" id="5942100">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942103">itAdam7</span>&nbsp;<span class="op" id="5942111">=</span>&nbsp;<span class="num" id="5942113">1</span><br>
<span class="lineno"></span><span class="op" id="5942115">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="comment" id="5942118">//&nbsp;interlaceScan&nbsp;defines&nbsp;the&nbsp;placement&nbsp;and&nbsp;size&nbsp;of&nbsp;a&nbsp;pass&nbsp;for&nbsp;Adam7&nbsp;interlacing.</span><br>
<span class="lineno"></span><span class="keyword" id="5942199">type</span>&nbsp;<span class="ident" id="5942204">interlaceScan</span>&nbsp;<span class="keyword" id="5942218">struct</span>&nbsp;<span class="op" id="5942225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942228">xFactor</span><span class="op" id="5942235">,</span>&nbsp;<span class="ident" id="5942237">yFactor</span><span class="op" id="5942244">,</span>&nbsp;<span class="ident" id="5942246">xOffset</span><span class="op" id="5942253">,</span>&nbsp;<span class="ident" id="5942255">yOffset</span>&nbsp;<span class="builtintype" id="5942263">int</span><br>
<span class="lineno"></span><span class="op" id="5942267">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5942270">//&nbsp;interlacing&nbsp;defines&nbsp;Adam7&nbsp;interlacing,&nbsp;with&nbsp;7&nbsp;passes&nbsp;of&nbsp;reduced&nbsp;images.</span><br>
<span class="lineno"></span><span class="comment" id="5942345">//&nbsp;See&nbsp;http://www.w3.org/TR/PNG/#8Interlace</span><br>
<span class="lineno"></span><span class="keyword" id="5942389">var</span>&nbsp;<span class="ident" id="5942393">interlacing</span>&nbsp;<span class="op" id="5942405">=</span>&nbsp;<span class="op" id="5942407">[</span><span class="op" id="5942408">]</span><span class="ident" id="5942409">interlaceScan</span><span class="op" id="5942422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942425">{</span><span class="num" id="5942426">8</span><span class="op" id="5942427">,</span>&nbsp;<span class="num" id="5942429">8</span><span class="op" id="5942430">,</span>&nbsp;<span class="num" id="5942432">0</span><span class="op" id="5942433">,</span>&nbsp;<span class="num" id="5942435">0</span><span class="op" id="5942436">}</span><span class="op" id="5942437">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942440">{</span><span class="num" id="5942441">8</span><span class="op" id="5942442">,</span>&nbsp;<span class="num" id="5942444">8</span><span class="op" id="5942445">,</span>&nbsp;<span class="num" id="5942447">4</span><span class="op" id="5942448">,</span>&nbsp;<span class="num" id="5942450">0</span><span class="op" id="5942451">}</span><span class="op" id="5942452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942455">{</span><span class="num" id="5942456">4</span><span class="op" id="5942457">,</span>&nbsp;<span class="num" id="5942459">8</span><span class="op" id="5942460">,</span>&nbsp;<span class="num" id="5942462">0</span><span class="op" id="5942463">,</span>&nbsp;<span class="num" id="5942465">4</span><span class="op" id="5942466">}</span><span class="op" id="5942467">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942470">{</span><span class="num" id="5942471">4</span><span class="op" id="5942472">,</span>&nbsp;<span class="num" id="5942474">4</span><span class="op" id="5942475">,</span>&nbsp;<span class="num" id="5942477">2</span><span class="op" id="5942478">,</span>&nbsp;<span class="num" id="5942480">0</span><span class="op" id="5942481">}</span><span class="op" id="5942482">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942485">{</span><span class="num" id="5942486">2</span><span class="op" id="5942487">,</span>&nbsp;<span class="num" id="5942489">4</span><span class="op" id="5942490">,</span>&nbsp;<span class="num" id="5942492">0</span><span class="op" id="5942493">,</span>&nbsp;<span class="num" id="5942495">2</span><span class="op" id="5942496">}</span><span class="op" id="5942497">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942500">{</span><span class="num" id="5942501">2</span><span class="op" id="5942502">,</span>&nbsp;<span class="num" id="5942504">2</span><span class="op" id="5942505">,</span>&nbsp;<span class="num" id="5942507">1</span><span class="op" id="5942508">,</span>&nbsp;<span class="num" id="5942510">0</span><span class="op" id="5942511">}</span><span class="op" id="5942512">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5942515">{</span><span class="num" id="5942516">1</span><span class="op" id="5942517">,</span>&nbsp;<span class="num" id="5942519">2</span><span class="op" id="5942520">,</span>&nbsp;<span class="num" id="5942522">0</span><span class="op" id="5942523">,</span>&nbsp;<span class="num" id="5942525">1</span><span class="op" id="5942526">}</span><span class="op" id="5942527">,</span><br>
<span class="lineno"></span><span class="op" id="5942529">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5942532">//&nbsp;Decoding&nbsp;stage.</span><br>
<span class="lineno"></span><span class="comment" id="5942551">//&nbsp;The&nbsp;PNG&nbsp;specification&nbsp;says&nbsp;that&nbsp;the&nbsp;IHDR,&nbsp;PLTE&nbsp;(if&nbsp;present),&nbsp;IDAT&nbsp;and&nbsp;IEND</span><br>
<span class="lineno">85</span><span class="comment" id="5942629">//&nbsp;chunks&nbsp;must&nbsp;appear&nbsp;in&nbsp;that&nbsp;order.&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;IDAT&nbsp;chunks,&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5942705">//&nbsp;IDAT&nbsp;chunks&nbsp;must&nbsp;be&nbsp;sequential&nbsp;(i.e.&nbsp;they&nbsp;may&nbsp;not&nbsp;have&nbsp;any&nbsp;other&nbsp;chunks</span><br>
<span class="lineno"></span><span class="comment" id="5942780">//&nbsp;between&nbsp;them).</span><br>
<span class="lineno"></span><span class="comment" id="5942798">//&nbsp;http://www.w3.org/TR/PNG/#5ChunkOrdering</span><br>
<span class="lineno"></span><span class="keyword" id="5942842">const</span>&nbsp;<span class="op" id="5942848">(</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942851">dsStart</span>&nbsp;<span class="op" id="5942859">=</span>&nbsp;<span class="ident" id="5942861">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942867">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942879">dsSeenPLTE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942891">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942903">dsSeenIEND</span><br>
<span class="lineno">95</span><span class="op" id="5942914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942917">const</span>&nbsp;<span class="ident" id="5942923">pngHeader</span>&nbsp;<span class="op" id="5942933">=</span>&nbsp;<span class="string" id="5942935">&#34;\x89PNG\r\n\x1a\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5942956">type</span>&nbsp;<span class="ident" id="5942961">decoder</span>&nbsp;<span class="keyword" id="5942969">struct</span>&nbsp;<span class="op" id="5942976">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942979">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5942993">io</span><span class="op" id="5942995">.</span><span class="ident" id="5942996">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943004">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943018">image</span><span class="op" id="5943023">.</span><span class="ident" id="5943024">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943031">crc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943045">hash</span><span class="op" id="5943049">.</span><span class="ident" id="5943050">Hash32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943058">width</span><span class="op" id="5943063">,</span>&nbsp;<span class="ident" id="5943065">height</span>&nbsp;<span class="builtintype" id="5943072">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943077">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5943091">int</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943096">palette</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943110">color</span><span class="op" id="5943115">.</span><span class="ident" id="5943116">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943125">cb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5943139">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943144">stage</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5943158">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943163">idatLength</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5943177">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943185">tmp</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5943199">[</span><span class="num" id="5943200">3</span>&nbsp;<span class="op" id="5943202">*</span>&nbsp;<span class="num" id="5943204">256</span><span class="op" id="5943207">]</span><span class="builtintype" id="5943208">byte</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943214">interlace</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5943228">int</span><br>
<span class="lineno"></span><span class="op" id="5943232">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5943235">//&nbsp;A&nbsp;FormatError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;PNG.</span><br>
<span class="lineno"></span><span class="keyword" id="5943295">type</span>&nbsp;<span class="ident" id="5943300">FormatError</span>&nbsp;<span class="builtintype" id="5943312">string</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="5943320">func</span>&nbsp;<span class="op" id="5943325">(</span><span class="ident" id="5943326">e</span>&nbsp;<span class="ident" id="5943328">FormatError</span><span class="op" id="5943339">)</span>&nbsp;<span class="ident" id="5943341">Error</span><span class="op" id="5943346">(</span><span class="op" id="5943347">)</span>&nbsp;<span class="builtintype" id="5943349">string</span>&nbsp;<span class="op" id="5943356">{</span>&nbsp;<span class="keyword" id="5943358">return</span>&nbsp;<span class="string" id="5943365">&#34;png:&nbsp;invalid&nbsp;format:&nbsp;&#34;</span>&nbsp;<span class="op" id="5943389">+</span>&nbsp;<span class="builtintype" id="5943391">string</span><span class="op" id="5943397">(</span><span class="ident" id="5943398">e</span><span class="op" id="5943399">)</span>&nbsp;<span class="op" id="5943401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943404">var</span>&nbsp;<span class="ident" id="5943408">chunkOrderError</span>&nbsp;<span class="op" id="5943424">=</span>&nbsp;<span class="ident" id="5943426">FormatError</span><span class="op" id="5943437">(</span><span class="string" id="5943438">&#34;chunk&nbsp;out&nbsp;of&nbsp;order&#34;</span><span class="op" id="5943458">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="5943461">//&nbsp;An&nbsp;UnsupportedError&nbsp;reports&nbsp;that&nbsp;the&nbsp;input&nbsp;uses&nbsp;a&nbsp;valid&nbsp;but&nbsp;unimplemented&nbsp;PNG&nbsp;feature.</span><br>
<span class="lineno"></span><span class="keyword" id="5943551">type</span>&nbsp;<span class="ident" id="5943556">UnsupportedError</span>&nbsp;<span class="builtintype" id="5943573">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943581">func</span>&nbsp;<span class="op" id="5943586">(</span><span class="ident" id="5943587">e</span>&nbsp;<span class="ident" id="5943589">UnsupportedError</span><span class="op" id="5943605">)</span>&nbsp;<span class="ident" id="5943607">Error</span><span class="op" id="5943612">(</span><span class="op" id="5943613">)</span>&nbsp;<span class="builtintype" id="5943615">string</span>&nbsp;<span class="op" id="5943622">{</span>&nbsp;<span class="keyword" id="5943624">return</span>&nbsp;<span class="string" id="5943631">&#34;png:&nbsp;unsupported&nbsp;feature:&nbsp;&#34;</span>&nbsp;<span class="op" id="5943660">+</span>&nbsp;<span class="builtintype" id="5943662">string</span><span class="op" id="5943668">(</span><span class="ident" id="5943669">e</span><span class="op" id="5943670">)</span>&nbsp;<span class="op" id="5943672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5943675">func</span>&nbsp;<span class="ident" id="5943680">min</span><span class="op" id="5943683">(</span><span class="ident" id="5943684">a</span><span class="op" id="5943685">,</span>&nbsp;<span class="ident" id="5943687">b</span>&nbsp;<span class="builtintype" id="5943689">int</span><span class="op" id="5943692">)</span>&nbsp;<span class="builtintype" id="5943694">int</span>&nbsp;<span class="op" id="5943698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943701">if</span>&nbsp;<span class="ident" id="5943704">a</span>&nbsp;<span class="op" id="5943706">&lt;</span>&nbsp;<span class="ident" id="5943708">b</span>&nbsp;<span class="op" id="5943710">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943714">return</span>&nbsp;<span class="ident" id="5943721">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5943724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943727">return</span>&nbsp;<span class="ident" id="5943734">b</span><br>
<span class="lineno">130</span><span class="op" id="5943736">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5943739">func</span>&nbsp;<span class="op" id="5943744">(</span><span class="ident" id="5943745">d</span>&nbsp;<span class="op" id="5943747">*</span><span class="ident" id="5943748">decoder</span><span class="op" id="5943755">)</span>&nbsp;<span class="ident" id="5943757">parseIHDR</span><span class="op" id="5943766">(</span><span class="ident" id="5943767">length</span>&nbsp;<span class="builtintype" id="5943774">uint32</span><span class="op" id="5943780">)</span>&nbsp;<span class="builtintype" id="5943782">error</span>&nbsp;<span class="op" id="5943788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943791">if</span>&nbsp;<span class="ident" id="5943794">length</span>&nbsp;<span class="op" id="5943801">!=</span>&nbsp;<span class="num" id="5943804">13</span>&nbsp;<span class="op" id="5943807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943811">return</span>&nbsp;<span class="ident" id="5943818">FormatError</span><span class="op" id="5943829">(</span><span class="string" id="5943830">&#34;bad&nbsp;IHDR&nbsp;length&#34;</span><span class="op" id="5943847">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5943850">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943853">if</span>&nbsp;<span class="ident" id="5943856">_</span><span class="op" id="5943857">,</span>&nbsp;<span class="ident" id="5943859">err</span>&nbsp;<span class="op" id="5943863">:=</span>&nbsp;<span class="ident" id="5943866">io</span><span class="op" id="5943868">.</span><span class="ident" id="5943869">ReadFull</span><span class="op" id="5943877">(</span><span class="ident" id="5943878">d</span><span class="op" id="5943879">.</span><span class="ident" id="5943880">r</span><span class="op" id="5943881">,</span>&nbsp;<span class="ident" id="5943883">d</span><span class="op" id="5943884">.</span><span class="ident" id="5943885">tmp</span><span class="op" id="5943888">[</span><span class="op" id="5943889">:</span><span class="num" id="5943890">13</span><span class="op" id="5943892">]</span><span class="op" id="5943893">)</span><span class="op" id="5943894">;</span>&nbsp;<span class="ident" id="5943896">err</span>&nbsp;<span class="op" id="5943900">!=</span>&nbsp;<span class="builtintype" id="5943903">nil</span>&nbsp;<span class="op" id="5943907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943911">return</span>&nbsp;<span class="ident" id="5943918">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5943923">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5943926">d</span><span class="op" id="5943927">.</span><span class="ident" id="5943928">crc</span><span class="op" id="5943931">.</span><span class="ident" id="5943932">Write</span><span class="op" id="5943937">(</span><span class="ident" id="5943938">d</span><span class="op" id="5943939">.</span><span class="ident" id="5943940">tmp</span><span class="op" id="5943943">[</span><span class="op" id="5943944">:</span><span class="num" id="5943945">13</span><span class="op" id="5943947">]</span><span class="op" id="5943948">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943951">if</span>&nbsp;<span class="ident" id="5943954">d</span><span class="op" id="5943955">.</span><span class="ident" id="5943956">tmp</span><span class="op" id="5943959">[</span><span class="num" id="5943960">10</span><span class="op" id="5943962">]</span>&nbsp;<span class="op" id="5943964">!=</span>&nbsp;<span class="num" id="5943967">0</span>&nbsp;<span class="op" id="5943969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5943973">return</span>&nbsp;<span class="ident" id="5943980">UnsupportedError</span><span class="op" id="5943996">(</span><span class="string" id="5943997">&#34;compression&nbsp;method&#34;</span><span class="op" id="5944017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944023">if</span>&nbsp;<span class="ident" id="5944026">d</span><span class="op" id="5944027">.</span><span class="ident" id="5944028">tmp</span><span class="op" id="5944031">[</span><span class="num" id="5944032">11</span><span class="op" id="5944034">]</span>&nbsp;<span class="op" id="5944036">!=</span>&nbsp;<span class="num" id="5944039">0</span>&nbsp;<span class="op" id="5944041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944045">return</span>&nbsp;<span class="ident" id="5944052">UnsupportedError</span><span class="op" id="5944068">(</span><span class="string" id="5944069">&#34;filter&nbsp;method&#34;</span><span class="op" id="5944084">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944090">if</span>&nbsp;<span class="ident" id="5944093">d</span><span class="op" id="5944094">.</span><span class="ident" id="5944095">tmp</span><span class="op" id="5944098">[</span><span class="num" id="5944099">12</span><span class="op" id="5944101">]</span>&nbsp;<span class="op" id="5944103">!=</span>&nbsp;<span class="ident" id="5944106">itNone</span>&nbsp;<span class="op" id="5944113">&amp;&amp;</span>&nbsp;<span class="ident" id="5944116">d</span><span class="op" id="5944117">.</span><span class="ident" id="5944118">tmp</span><span class="op" id="5944121">[</span><span class="num" id="5944122">12</span><span class="op" id="5944124">]</span>&nbsp;<span class="op" id="5944126">!=</span>&nbsp;<span class="ident" id="5944129">itAdam7</span>&nbsp;<span class="op" id="5944137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944141">return</span>&nbsp;<span class="ident" id="5944148">FormatError</span><span class="op" id="5944159">(</span><span class="string" id="5944160">&#34;invalid&nbsp;interlace&nbsp;method&#34;</span><span class="op" id="5944186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944189">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944192">d</span><span class="op" id="5944193">.</span><span class="ident" id="5944194">interlace</span>&nbsp;<span class="op" id="5944204">=</span>&nbsp;<span class="builtintype" id="5944206">int</span><span class="op" id="5944209">(</span><span class="ident" id="5944210">d</span><span class="op" id="5944211">.</span><span class="ident" id="5944212">tmp</span><span class="op" id="5944215">[</span><span class="num" id="5944216">12</span><span class="op" id="5944218">]</span><span class="op" id="5944219">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944222">w</span>&nbsp;<span class="op" id="5944224">:=</span>&nbsp;<span class="builtintype" id="5944227">int32</span><span class="op" id="5944232">(</span><span class="ident" id="5944233">binary</span><span class="op" id="5944239">.</span><span class="ident" id="5944240">BigEndian</span><span class="op" id="5944249">.</span><span class="ident" id="5944250">Uint32</span><span class="op" id="5944256">(</span><span class="ident" id="5944257">d</span><span class="op" id="5944258">.</span><span class="ident" id="5944259">tmp</span><span class="op" id="5944262">[</span><span class="num" id="5944263">0</span><span class="op" id="5944264">:</span><span class="num" id="5944265">4</span><span class="op" id="5944266">]</span><span class="op" id="5944267">)</span><span class="op" id="5944268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944271">h</span>&nbsp;<span class="op" id="5944273">:=</span>&nbsp;<span class="builtintype" id="5944276">int32</span><span class="op" id="5944281">(</span><span class="ident" id="5944282">binary</span><span class="op" id="5944288">.</span><span class="ident" id="5944289">BigEndian</span><span class="op" id="5944298">.</span><span class="ident" id="5944299">Uint32</span><span class="op" id="5944305">(</span><span class="ident" id="5944306">d</span><span class="op" id="5944307">.</span><span class="ident" id="5944308">tmp</span><span class="op" id="5944311">[</span><span class="num" id="5944312">4</span><span class="op" id="5944313">:</span><span class="num" id="5944314">8</span><span class="op" id="5944315">]</span><span class="op" id="5944316">)</span><span class="op" id="5944317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944320">if</span>&nbsp;<span class="ident" id="5944323">w</span>&nbsp;<span class="op" id="5944325">&lt;</span>&nbsp;<span class="num" id="5944327">0</span>&nbsp;<span class="op" id="5944329">||</span>&nbsp;<span class="ident" id="5944332">h</span>&nbsp;<span class="op" id="5944334">&lt;</span>&nbsp;<span class="num" id="5944336">0</span>&nbsp;<span class="op" id="5944338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944342">return</span>&nbsp;<span class="ident" id="5944349">FormatError</span><span class="op" id="5944360">(</span><span class="string" id="5944361">&#34;negative&nbsp;dimension&#34;</span><span class="op" id="5944381">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944384">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944387">nPixels</span>&nbsp;<span class="op" id="5944395">:=</span>&nbsp;<span class="ident" id="5944398">int64</span><span class="op" id="5944403">(</span><span class="ident" id="5944404">w</span><span class="op" id="5944405">)</span>&nbsp;<span class="op" id="5944407">*</span>&nbsp;<span class="ident" id="5944409">int64</span><span class="op" id="5944414">(</span><span class="ident" id="5944415">h</span><span class="op" id="5944416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944419">if</span>&nbsp;<span class="ident" id="5944422">nPixels</span>&nbsp;<span class="op" id="5944430">!=</span>&nbsp;<span class="ident" id="5944433">int64</span><span class="op" id="5944438">(</span><span class="builtintype" id="5944439">int</span><span class="op" id="5944442">(</span><span class="ident" id="5944443">nPixels</span><span class="op" id="5944450">)</span><span class="op" id="5944451">)</span>&nbsp;<span class="op" id="5944453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944457">return</span>&nbsp;<span class="ident" id="5944464">UnsupportedError</span><span class="op" id="5944480">(</span><span class="string" id="5944481">&#34;dimension&nbsp;overflow&#34;</span><span class="op" id="5944501">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944504">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944507">d</span><span class="op" id="5944508">.</span><span class="ident" id="5944509">cb</span>&nbsp;<span class="op" id="5944512">=</span>&nbsp;<span class="ident" id="5944514">cbInvalid</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944525">d</span><span class="op" id="5944526">.</span><span class="ident" id="5944527">depth</span>&nbsp;<span class="op" id="5944533">=</span>&nbsp;<span class="builtintype" id="5944535">int</span><span class="op" id="5944538">(</span><span class="ident" id="5944539">d</span><span class="op" id="5944540">.</span><span class="ident" id="5944541">tmp</span><span class="op" id="5944544">[</span><span class="num" id="5944545">8</span><span class="op" id="5944546">]</span><span class="op" id="5944547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944550">switch</span>&nbsp;<span class="ident" id="5944557">d</span><span class="op" id="5944558">.</span><span class="ident" id="5944559">depth</span>&nbsp;<span class="op" id="5944565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944568">case</span>&nbsp;<span class="num" id="5944573">1</span><span class="op" id="5944574">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944578">switch</span>&nbsp;<span class="ident" id="5944585">d</span><span class="op" id="5944586">.</span><span class="ident" id="5944587">tmp</span><span class="op" id="5944590">[</span><span class="num" id="5944591">9</span><span class="op" id="5944592">]</span>&nbsp;<span class="op" id="5944594">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944598">case</span>&nbsp;<span class="ident" id="5944603">ctGrayscale</span><span class="op" id="5944614">:</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944619">d</span><span class="op" id="5944620">.</span><span class="ident" id="5944621">cb</span>&nbsp;<span class="op" id="5944624">=</span>&nbsp;<span class="ident" id="5944626">cbG1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944633">case</span>&nbsp;<span class="ident" id="5944638">ctPaletted</span><span class="op" id="5944648">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944653">d</span><span class="op" id="5944654">.</span><span class="ident" id="5944655">cb</span>&nbsp;<span class="op" id="5944658">=</span>&nbsp;<span class="ident" id="5944660">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944670">case</span>&nbsp;<span class="num" id="5944675">2</span><span class="op" id="5944676">:</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944680">switch</span>&nbsp;<span class="ident" id="5944687">d</span><span class="op" id="5944688">.</span><span class="ident" id="5944689">tmp</span><span class="op" id="5944692">[</span><span class="num" id="5944693">9</span><span class="op" id="5944694">]</span>&nbsp;<span class="op" id="5944696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944700">case</span>&nbsp;<span class="ident" id="5944705">ctGrayscale</span><span class="op" id="5944716">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944721">d</span><span class="op" id="5944722">.</span><span class="ident" id="5944723">cb</span>&nbsp;<span class="op" id="5944726">=</span>&nbsp;<span class="ident" id="5944728">cbG2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944735">case</span>&nbsp;<span class="ident" id="5944740">ctPaletted</span><span class="op" id="5944750">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944755">d</span><span class="op" id="5944756">.</span><span class="ident" id="5944757">cb</span>&nbsp;<span class="op" id="5944760">=</span>&nbsp;<span class="ident" id="5944762">cbP2</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944769">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944772">case</span>&nbsp;<span class="num" id="5944777">4</span><span class="op" id="5944778">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944782">switch</span>&nbsp;<span class="ident" id="5944789">d</span><span class="op" id="5944790">.</span><span class="ident" id="5944791">tmp</span><span class="op" id="5944794">[</span><span class="num" id="5944795">9</span><span class="op" id="5944796">]</span>&nbsp;<span class="op" id="5944798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944802">case</span>&nbsp;<span class="ident" id="5944807">ctGrayscale</span><span class="op" id="5944818">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944823">d</span><span class="op" id="5944824">.</span><span class="ident" id="5944825">cb</span>&nbsp;<span class="op" id="5944828">=</span>&nbsp;<span class="ident" id="5944830">cbG4</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944837">case</span>&nbsp;<span class="ident" id="5944842">ctPaletted</span><span class="op" id="5944852">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944857">d</span><span class="op" id="5944858">.</span><span class="ident" id="5944859">cb</span>&nbsp;<span class="op" id="5944862">=</span>&nbsp;<span class="ident" id="5944864">cbP4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5944871">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944874">case</span>&nbsp;<span class="num" id="5944879">8</span><span class="op" id="5944880">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944884">switch</span>&nbsp;<span class="ident" id="5944891">d</span><span class="op" id="5944892">.</span><span class="ident" id="5944893">tmp</span><span class="op" id="5944896">[</span><span class="num" id="5944897">9</span><span class="op" id="5944898">]</span>&nbsp;<span class="op" id="5944900">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944904">case</span>&nbsp;<span class="ident" id="5944909">ctGrayscale</span><span class="op" id="5944920">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944925">d</span><span class="op" id="5944926">.</span><span class="ident" id="5944927">cb</span>&nbsp;<span class="op" id="5944930">=</span>&nbsp;<span class="ident" id="5944932">cbG8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944939">case</span>&nbsp;<span class="ident" id="5944944">ctTrueColor</span><span class="op" id="5944955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944960">d</span><span class="op" id="5944961">.</span><span class="ident" id="5944962">cb</span>&nbsp;<span class="op" id="5944965">=</span>&nbsp;<span class="ident" id="5944967">cbTC8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5944975">case</span>&nbsp;<span class="ident" id="5944980">ctPaletted</span><span class="op" id="5944990">:</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5944995">d</span><span class="op" id="5944996">.</span><span class="ident" id="5944997">cb</span>&nbsp;<span class="op" id="5945000">=</span>&nbsp;<span class="ident" id="5945002">cbP8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945009">case</span>&nbsp;<span class="ident" id="5945014">ctGrayscaleAlpha</span><span class="op" id="5945030">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945035">d</span><span class="op" id="5945036">.</span><span class="ident" id="5945037">cb</span>&nbsp;<span class="op" id="5945040">=</span>&nbsp;<span class="ident" id="5945042">cbGA8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945050">case</span>&nbsp;<span class="ident" id="5945055">ctTrueColorAlpha</span><span class="op" id="5945071">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945076">d</span><span class="op" id="5945077">.</span><span class="ident" id="5945078">cb</span>&nbsp;<span class="op" id="5945081">=</span>&nbsp;<span class="ident" id="5945083">cbTCA8</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945095">case</span>&nbsp;<span class="num" id="5945100">16</span><span class="op" id="5945102">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945106">switch</span>&nbsp;<span class="ident" id="5945113">d</span><span class="op" id="5945114">.</span><span class="ident" id="5945115">tmp</span><span class="op" id="5945118">[</span><span class="num" id="5945119">9</span><span class="op" id="5945120">]</span>&nbsp;<span class="op" id="5945122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945126">case</span>&nbsp;<span class="ident" id="5945131">ctGrayscale</span><span class="op" id="5945142">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945147">d</span><span class="op" id="5945148">.</span><span class="ident" id="5945149">cb</span>&nbsp;<span class="op" id="5945152">=</span>&nbsp;<span class="ident" id="5945154">cbG16</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945162">case</span>&nbsp;<span class="ident" id="5945167">ctTrueColor</span><span class="op" id="5945178">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945183">d</span><span class="op" id="5945184">.</span><span class="ident" id="5945185">cb</span>&nbsp;<span class="op" id="5945188">=</span>&nbsp;<span class="ident" id="5945190">cbTC16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945199">case</span>&nbsp;<span class="ident" id="5945204">ctGrayscaleAlpha</span><span class="op" id="5945220">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945225">d</span><span class="op" id="5945226">.</span><span class="ident" id="5945227">cb</span>&nbsp;<span class="op" id="5945230">=</span>&nbsp;<span class="ident" id="5945232">cbGA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945241">case</span>&nbsp;<span class="ident" id="5945246">ctTrueColorAlpha</span><span class="op" id="5945262">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945267">d</span><span class="op" id="5945268">.</span><span class="ident" id="5945269">cb</span>&nbsp;<span class="op" id="5945272">=</span>&nbsp;<span class="ident" id="5945274">cbTCA16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945284">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945290">if</span>&nbsp;<span class="ident" id="5945293">d</span><span class="op" id="5945294">.</span><span class="ident" id="5945295">cb</span>&nbsp;<span class="op" id="5945298">==</span>&nbsp;<span class="ident" id="5945301">cbInvalid</span>&nbsp;<span class="op" id="5945311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945315">return</span>&nbsp;<span class="ident" id="5945322">UnsupportedError</span><span class="op" id="5945338">(</span><span class="ident" id="5945339">fmt</span><span class="op" id="5945342">.</span><span class="ident" id="5945343">Sprintf</span><span class="op" id="5945350">(</span><span class="string" id="5945351">&#34;bit&nbsp;depth&nbsp;%d,&nbsp;color&nbsp;type&nbsp;%d&#34;</span><span class="op" id="5945380">,</span>&nbsp;<span class="ident" id="5945382">d</span><span class="op" id="5945383">.</span><span class="ident" id="5945384">tmp</span><span class="op" id="5945387">[</span><span class="num" id="5945388">8</span><span class="op" id="5945389">]</span><span class="op" id="5945390">,</span>&nbsp;<span class="ident" id="5945392">d</span><span class="op" id="5945393">.</span><span class="ident" id="5945394">tmp</span><span class="op" id="5945397">[</span><span class="num" id="5945398">9</span><span class="op" id="5945399">]</span><span class="op" id="5945400">)</span><span class="op" id="5945401">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945407">d</span><span class="op" id="5945408">.</span><span class="ident" id="5945409">width</span><span class="op" id="5945414">,</span>&nbsp;<span class="ident" id="5945416">d</span><span class="op" id="5945417">.</span><span class="ident" id="5945418">height</span>&nbsp;<span class="op" id="5945425">=</span>&nbsp;<span class="builtintype" id="5945427">int</span><span class="op" id="5945430">(</span><span class="ident" id="5945431">w</span><span class="op" id="5945432">)</span><span class="op" id="5945433">,</span>&nbsp;<span class="builtintype" id="5945435">int</span><span class="op" id="5945438">(</span><span class="ident" id="5945439">h</span><span class="op" id="5945440">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945443">return</span>&nbsp;<span class="ident" id="5945450">d</span><span class="op" id="5945451">.</span><span class="ident" id="5945452">verifyChecksum</span><span class="op" id="5945466">(</span><span class="op" id="5945467">)</span><br>
<span class="lineno"></span><span class="op" id="5945469">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="5945472">func</span>&nbsp;<span class="op" id="5945477">(</span><span class="ident" id="5945478">d</span>&nbsp;<span class="op" id="5945480">*</span><span class="ident" id="5945481">decoder</span><span class="op" id="5945488">)</span>&nbsp;<span class="ident" id="5945490">parsePLTE</span><span class="op" id="5945499">(</span><span class="ident" id="5945500">length</span>&nbsp;<span class="builtintype" id="5945507">uint32</span><span class="op" id="5945513">)</span>&nbsp;<span class="builtintype" id="5945515">error</span>&nbsp;<span class="op" id="5945521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945524">np</span>&nbsp;<span class="op" id="5945527">:=</span>&nbsp;<span class="builtintype" id="5945530">int</span><span class="op" id="5945533">(</span><span class="ident" id="5945534">length</span>&nbsp;<span class="op" id="5945541">/</span>&nbsp;<span class="num" id="5945543">3</span><span class="op" id="5945544">)</span>&nbsp;<span class="comment" id="5945546">//&nbsp;The&nbsp;number&nbsp;of&nbsp;palette&nbsp;entries.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945581">if</span>&nbsp;<span class="ident" id="5945584">length</span><span class="op" id="5945590">%</span><span class="num" id="5945591">3</span>&nbsp;<span class="op" id="5945593">!=</span>&nbsp;<span class="num" id="5945596">0</span>&nbsp;<span class="op" id="5945598">||</span>&nbsp;<span class="ident" id="5945601">np</span>&nbsp;<span class="op" id="5945604">&lt;=</span>&nbsp;<span class="num" id="5945607">0</span>&nbsp;<span class="op" id="5945609">||</span>&nbsp;<span class="ident" id="5945612">np</span>&nbsp;<span class="op" id="5945615">&gt;</span>&nbsp;<span class="num" id="5945617">256</span>&nbsp;<span class="op" id="5945621">||</span>&nbsp;<span class="ident" id="5945624">np</span>&nbsp;<span class="op" id="5945627">&gt;</span>&nbsp;<span class="num" id="5945629">1</span><span class="op" id="5945630">&lt;&lt;</span><span class="builtintype" id="5945632">uint</span><span class="op" id="5945636">(</span><span class="ident" id="5945637">d</span><span class="op" id="5945638">.</span><span class="ident" id="5945639">depth</span><span class="op" id="5945644">)</span>&nbsp;<span class="op" id="5945646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945650">return</span>&nbsp;<span class="ident" id="5945657">FormatError</span><span class="op" id="5945668">(</span><span class="string" id="5945669">&#34;bad&nbsp;PLTE&nbsp;length&#34;</span><span class="op" id="5945686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945689">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945692">n</span><span class="op" id="5945693">,</span>&nbsp;<span class="ident" id="5945695">err</span>&nbsp;<span class="op" id="5945699">:=</span>&nbsp;<span class="ident" id="5945702">io</span><span class="op" id="5945704">.</span><span class="ident" id="5945705">ReadFull</span><span class="op" id="5945713">(</span><span class="ident" id="5945714">d</span><span class="op" id="5945715">.</span><span class="ident" id="5945716">r</span><span class="op" id="5945717">,</span>&nbsp;<span class="ident" id="5945719">d</span><span class="op" id="5945720">.</span><span class="ident" id="5945721">tmp</span><span class="op" id="5945724">[</span><span class="op" id="5945725">:</span><span class="num" id="5945726">3</span><span class="op" id="5945727">*</span><span class="ident" id="5945728">np</span><span class="op" id="5945730">]</span><span class="op" id="5945731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945734">if</span>&nbsp;<span class="ident" id="5945737">err</span>&nbsp;<span class="op" id="5945741">!=</span>&nbsp;<span class="builtintype" id="5945744">nil</span>&nbsp;<span class="op" id="5945748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945752">return</span>&nbsp;<span class="ident" id="5945759">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945764">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945767">d</span><span class="op" id="5945768">.</span><span class="ident" id="5945769">crc</span><span class="op" id="5945772">.</span><span class="ident" id="5945773">Write</span><span class="op" id="5945778">(</span><span class="ident" id="5945779">d</span><span class="op" id="5945780">.</span><span class="ident" id="5945781">tmp</span><span class="op" id="5945784">[</span><span class="op" id="5945785">:</span><span class="ident" id="5945786">n</span><span class="op" id="5945787">]</span><span class="op" id="5945788">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945791">switch</span>&nbsp;<span class="ident" id="5945798">d</span><span class="op" id="5945799">.</span><span class="ident" id="5945800">cb</span>&nbsp;<span class="op" id="5945803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945806">case</span>&nbsp;<span class="ident" id="5945811">cbP1</span><span class="op" id="5945815">,</span>&nbsp;<span class="ident" id="5945817">cbP2</span><span class="op" id="5945821">,</span>&nbsp;<span class="ident" id="5945823">cbP4</span><span class="op" id="5945827">,</span>&nbsp;<span class="ident" id="5945829">cbP8</span><span class="op" id="5945833">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945837">d</span><span class="op" id="5945838">.</span><span class="ident" id="5945839">palette</span>&nbsp;<span class="op" id="5945847">=</span>&nbsp;<span class="builtinfunc" id="5945849">make</span><span class="op" id="5945853">(</span><span class="ident" id="5945854">color</span><span class="op" id="5945859">.</span><span class="ident" id="5945860">Palette</span><span class="op" id="5945867">,</span>&nbsp;<span class="num" id="5945869">256</span><span class="op" id="5945872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945876">for</span>&nbsp;<span class="ident" id="5945880">i</span>&nbsp;<span class="op" id="5945882">:=</span>&nbsp;<span class="num" id="5945885">0</span><span class="op" id="5945886">;</span>&nbsp;<span class="ident" id="5945888">i</span>&nbsp;<span class="op" id="5945890">&lt;</span>&nbsp;<span class="ident" id="5945892">np</span><span class="op" id="5945894">;</span>&nbsp;<span class="ident" id="5945896">i</span><span class="op" id="5945897">++</span>&nbsp;<span class="op" id="5945900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5945905">d</span><span class="op" id="5945906">.</span><span class="ident" id="5945907">palette</span><span class="op" id="5945914">[</span><span class="ident" id="5945915">i</span><span class="op" id="5945916">]</span>&nbsp;<span class="op" id="5945918">=</span>&nbsp;<span class="ident" id="5945920">color</span><span class="op" id="5945925">.</span><span class="ident" id="5945926">RGBA</span><span class="op" id="5945930">{</span><span class="ident" id="5945931">d</span><span class="op" id="5945932">.</span><span class="ident" id="5945933">tmp</span><span class="op" id="5945936">[</span><span class="num" id="5945937">3</span><span class="op" id="5945938">*</span><span class="ident" id="5945939">i</span><span class="op" id="5945940">+</span><span class="num" id="5945941">0</span><span class="op" id="5945942">]</span><span class="op" id="5945943">,</span>&nbsp;<span class="ident" id="5945945">d</span><span class="op" id="5945946">.</span><span class="ident" id="5945947">tmp</span><span class="op" id="5945950">[</span><span class="num" id="5945951">3</span><span class="op" id="5945952">*</span><span class="ident" id="5945953">i</span><span class="op" id="5945954">+</span><span class="num" id="5945955">1</span><span class="op" id="5945956">]</span><span class="op" id="5945957">,</span>&nbsp;<span class="ident" id="5945959">d</span><span class="op" id="5945960">.</span><span class="ident" id="5945961">tmp</span><span class="op" id="5945964">[</span><span class="num" id="5945965">3</span><span class="op" id="5945966">*</span><span class="ident" id="5945967">i</span><span class="op" id="5945968">+</span><span class="num" id="5945969">2</span><span class="op" id="5945970">]</span><span class="op" id="5945971">,</span>&nbsp;<span class="num" id="5945973">0xff</span><span class="op" id="5945977">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5945981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5945985">for</span>&nbsp;<span class="ident" id="5945989">i</span>&nbsp;<span class="op" id="5945991">:=</span>&nbsp;<span class="ident" id="5945994">np</span><span class="op" id="5945996">;</span>&nbsp;<span class="ident" id="5945998">i</span>&nbsp;<span class="op" id="5946000">&lt;</span>&nbsp;<span class="num" id="5946002">256</span><span class="op" id="5946005">;</span>&nbsp;<span class="ident" id="5946007">i</span><span class="op" id="5946008">++</span>&nbsp;<span class="op" id="5946011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946016">//&nbsp;Initialize&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;palette&nbsp;to&nbsp;opaque&nbsp;black.&nbsp;The&nbsp;spec&nbsp;(section</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946092">//&nbsp;11.2.3)&nbsp;says&nbsp;that&nbsp;&#34;any&nbsp;out-of-range&nbsp;pixel&nbsp;value&nbsp;found&nbsp;in&nbsp;the&nbsp;image&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946170">//&nbsp;is&nbsp;an&nbsp;error&#34;,&nbsp;but&nbsp;some&nbsp;real-world&nbsp;PNG&nbsp;files&nbsp;have&nbsp;out-of-range&nbsp;pixel</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946244">//&nbsp;values.&nbsp;We&nbsp;fall&nbsp;back&nbsp;to&nbsp;opaque&nbsp;black,&nbsp;the&nbsp;same&nbsp;as&nbsp;libpng&nbsp;1.5.13;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946315">//&nbsp;ImageMagick&nbsp;6.5.7&nbsp;returns&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946357">d</span><span class="op" id="5946358">.</span><span class="ident" id="5946359">palette</span><span class="op" id="5946366">[</span><span class="ident" id="5946367">i</span><span class="op" id="5946368">]</span>&nbsp;<span class="op" id="5946370">=</span>&nbsp;<span class="ident" id="5946372">color</span><span class="op" id="5946377">.</span><span class="ident" id="5946378">RGBA</span><span class="op" id="5946382">{</span><span class="num" id="5946383">0x00</span><span class="op" id="5946387">,</span>&nbsp;<span class="num" id="5946389">0x00</span><span class="op" id="5946393">,</span>&nbsp;<span class="num" id="5946395">0x00</span><span class="op" id="5946399">,</span>&nbsp;<span class="num" id="5946401">0xff</span><span class="op" id="5946405">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946413">d</span><span class="op" id="5946414">.</span><span class="ident" id="5946415">palette</span>&nbsp;<span class="op" id="5946423">=</span>&nbsp;<span class="ident" id="5946425">d</span><span class="op" id="5946426">.</span><span class="ident" id="5946427">palette</span><span class="op" id="5946434">[</span><span class="op" id="5946435">:</span><span class="ident" id="5946436">np</span><span class="op" id="5946438">]</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946441">case</span>&nbsp;<span class="ident" id="5946446">cbTC8</span><span class="op" id="5946451">,</span>&nbsp;<span class="ident" id="5946453">cbTCA8</span><span class="op" id="5946459">,</span>&nbsp;<span class="ident" id="5946461">cbTC16</span><span class="op" id="5946467">,</span>&nbsp;<span class="ident" id="5946469">cbTCA16</span><span class="op" id="5946476">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946480">//&nbsp;As&nbsp;per&nbsp;the&nbsp;PNG&nbsp;spec,&nbsp;a&nbsp;PLTE&nbsp;chunk&nbsp;is&nbsp;optional&nbsp;(and&nbsp;for&nbsp;practical&nbsp;purposes,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5946560">//&nbsp;ignorable)&nbsp;for&nbsp;the&nbsp;ctTrueColor&nbsp;and&nbsp;ctTrueColorAlpha&nbsp;color&nbsp;types&nbsp;(section&nbsp;4.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946645">default</span><span class="op" id="5946652">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946656">return</span>&nbsp;<span class="ident" id="5946663">FormatError</span><span class="op" id="5946674">(</span><span class="string" id="5946675">&#34;PLTE,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5946702">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946705">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946708">return</span>&nbsp;<span class="ident" id="5946715">d</span><span class="op" id="5946716">.</span><span class="ident" id="5946717">verifyChecksum</span><span class="op" id="5946731">(</span><span class="op" id="5946732">)</span><br>
<span class="lineno"></span><span class="op" id="5946734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5946737">func</span>&nbsp;<span class="op" id="5946742">(</span><span class="ident" id="5946743">d</span>&nbsp;<span class="op" id="5946745">*</span><span class="ident" id="5946746">decoder</span><span class="op" id="5946753">)</span>&nbsp;<span class="ident" id="5946755">parsetRNS</span><span class="op" id="5946764">(</span><span class="ident" id="5946765">length</span>&nbsp;<span class="builtintype" id="5946772">uint32</span><span class="op" id="5946778">)</span>&nbsp;<span class="builtintype" id="5946780">error</span>&nbsp;<span class="op" id="5946786">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946789">if</span>&nbsp;<span class="ident" id="5946792">length</span>&nbsp;<span class="op" id="5946799">&gt;</span>&nbsp;<span class="num" id="5946801">256</span>&nbsp;<span class="op" id="5946805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946809">return</span>&nbsp;<span class="ident" id="5946816">FormatError</span><span class="op" id="5946827">(</span><span class="string" id="5946828">&#34;bad&nbsp;tRNS&nbsp;length&#34;</span><span class="op" id="5946845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946851">n</span><span class="op" id="5946852">,</span>&nbsp;<span class="ident" id="5946854">err</span>&nbsp;<span class="op" id="5946858">:=</span>&nbsp;<span class="ident" id="5946861">io</span><span class="op" id="5946863">.</span><span class="ident" id="5946864">ReadFull</span><span class="op" id="5946872">(</span><span class="ident" id="5946873">d</span><span class="op" id="5946874">.</span><span class="ident" id="5946875">r</span><span class="op" id="5946876">,</span>&nbsp;<span class="ident" id="5946878">d</span><span class="op" id="5946879">.</span><span class="ident" id="5946880">tmp</span><span class="op" id="5946883">[</span><span class="op" id="5946884">:</span><span class="ident" id="5946885">length</span><span class="op" id="5946891">]</span><span class="op" id="5946892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946895">if</span>&nbsp;<span class="ident" id="5946898">err</span>&nbsp;<span class="op" id="5946902">!=</span>&nbsp;<span class="builtintype" id="5946905">nil</span>&nbsp;<span class="op" id="5946909">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946913">return</span>&nbsp;<span class="ident" id="5946920">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5946925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5946928">d</span><span class="op" id="5946929">.</span><span class="ident" id="5946930">crc</span><span class="op" id="5946933">.</span><span class="ident" id="5946934">Write</span><span class="op" id="5946939">(</span><span class="ident" id="5946940">d</span><span class="op" id="5946941">.</span><span class="ident" id="5946942">tmp</span><span class="op" id="5946945">[</span><span class="op" id="5946946">:</span><span class="ident" id="5946947">n</span><span class="op" id="5946948">]</span><span class="op" id="5946949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946952">switch</span>&nbsp;<span class="ident" id="5946959">d</span><span class="op" id="5946960">.</span><span class="ident" id="5946961">cb</span>&nbsp;<span class="op" id="5946964">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946967">case</span>&nbsp;<span class="ident" id="5946972">cbG8</span><span class="op" id="5946976">,</span>&nbsp;<span class="ident" id="5946978">cbG16</span><span class="op" id="5946983">:</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5946987">return</span>&nbsp;<span class="ident" id="5946994">UnsupportedError</span><span class="op" id="5947010">(</span><span class="string" id="5947011">&#34;grayscale&nbsp;transparency&#34;</span><span class="op" id="5947035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947038">case</span>&nbsp;<span class="ident" id="5947043">cbTC8</span><span class="op" id="5947048">,</span>&nbsp;<span class="ident" id="5947050">cbTC16</span><span class="op" id="5947056">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947060">return</span>&nbsp;<span class="ident" id="5947067">UnsupportedError</span><span class="op" id="5947083">(</span><span class="string" id="5947084">&#34;truecolor&nbsp;transparency&#34;</span><span class="op" id="5947108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947111">case</span>&nbsp;<span class="ident" id="5947116">cbP1</span><span class="op" id="5947120">,</span>&nbsp;<span class="ident" id="5947122">cbP2</span><span class="op" id="5947126">,</span>&nbsp;<span class="ident" id="5947128">cbP4</span><span class="op" id="5947132">,</span>&nbsp;<span class="ident" id="5947134">cbP8</span><span class="op" id="5947138">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947142">if</span>&nbsp;<span class="builtinfunc" id="5947145">len</span><span class="op" id="5947148">(</span><span class="ident" id="5947149">d</span><span class="op" id="5947150">.</span><span class="ident" id="5947151">palette</span><span class="op" id="5947158">)</span>&nbsp;<span class="op" id="5947160">&lt;</span>&nbsp;<span class="ident" id="5947162">n</span>&nbsp;<span class="op" id="5947164">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947169">d</span><span class="op" id="5947170">.</span><span class="ident" id="5947171">palette</span>&nbsp;<span class="op" id="5947179">=</span>&nbsp;<span class="ident" id="5947181">d</span><span class="op" id="5947182">.</span><span class="ident" id="5947183">palette</span><span class="op" id="5947190">[</span><span class="op" id="5947191">:</span><span class="ident" id="5947192">n</span><span class="op" id="5947193">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947197">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947201">for</span>&nbsp;<span class="ident" id="5947205">i</span>&nbsp;<span class="op" id="5947207">:=</span>&nbsp;<span class="num" id="5947210">0</span><span class="op" id="5947211">;</span>&nbsp;<span class="ident" id="5947213">i</span>&nbsp;<span class="op" id="5947215">&lt;</span>&nbsp;<span class="ident" id="5947217">n</span><span class="op" id="5947218">;</span>&nbsp;<span class="ident" id="5947220">i</span><span class="op" id="5947221">++</span>&nbsp;<span class="op" id="5947224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947229">rgba</span>&nbsp;<span class="op" id="5947234">:=</span>&nbsp;<span class="ident" id="5947237">d</span><span class="op" id="5947238">.</span><span class="ident" id="5947239">palette</span><span class="op" id="5947246">[</span><span class="ident" id="5947247">i</span><span class="op" id="5947248">]</span><span class="op" id="5947249">.</span><span class="op" id="5947250">(</span><span class="ident" id="5947251">color</span><span class="op" id="5947256">.</span><span class="ident" id="5947257">RGBA</span><span class="op" id="5947261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5947266">d</span><span class="op" id="5947267">.</span><span class="ident" id="5947268">palette</span><span class="op" id="5947275">[</span><span class="ident" id="5947276">i</span><span class="op" id="5947277">]</span>&nbsp;<span class="op" id="5947279">=</span>&nbsp;<span class="ident" id="5947281">color</span><span class="op" id="5947286">.</span><span class="ident" id="5947287">NRGBA</span><span class="op" id="5947292">{</span><span class="ident" id="5947293">rgba</span><span class="op" id="5947297">.</span><span class="ident" id="5947298">R</span><span class="op" id="5947299">,</span>&nbsp;<span class="ident" id="5947301">rgba</span><span class="op" id="5947305">.</span><span class="ident" id="5947306">G</span><span class="op" id="5947307">,</span>&nbsp;<span class="ident" id="5947309">rgba</span><span class="op" id="5947313">.</span><span class="ident" id="5947314">B</span><span class="op" id="5947315">,</span>&nbsp;<span class="ident" id="5947317">d</span><span class="op" id="5947318">.</span><span class="ident" id="5947319">tmp</span><span class="op" id="5947322">[</span><span class="ident" id="5947323">i</span><span class="op" id="5947324">]</span><span class="op" id="5947325">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947332">case</span>&nbsp;<span class="ident" id="5947337">cbGA8</span><span class="op" id="5947342">,</span>&nbsp;<span class="ident" id="5947344">cbGA16</span><span class="op" id="5947350">,</span>&nbsp;<span class="ident" id="5947352">cbTCA8</span><span class="op" id="5947358">,</span>&nbsp;<span class="ident" id="5947360">cbTCA16</span><span class="op" id="5947367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947371">return</span>&nbsp;<span class="ident" id="5947378">FormatError</span><span class="op" id="5947389">(</span><span class="string" id="5947390">&#34;tRNS,&nbsp;color&nbsp;type&nbsp;mismatch&#34;</span><span class="op" id="5947417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5947420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5947423">return</span>&nbsp;<span class="ident" id="5947430">d</span><span class="op" id="5947431">.</span><span class="ident" id="5947432">verifyChecksum</span><span class="op" id="5947446">(</span><span class="op" id="5947447">)</span><br>
<span class="lineno">275</span><span class="op" id="5947449">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5947452">//&nbsp;Read&nbsp;presents&nbsp;one&nbsp;or&nbsp;more&nbsp;IDAT&nbsp;chunks&nbsp;as&nbsp;one&nbsp;continuous&nbsp;stream&nbsp;(minus&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5947529">//&nbsp;intermediate&nbsp;chunk&nbsp;headers&nbsp;and&nbsp;footers).&nbsp;If&nbsp;the&nbsp;PNG&nbsp;data&nbsp;looked&nbsp;like:</span><br>
<span class="lineno"></span><span class="comment" id="5947602">//&nbsp;&nbsp;&nbsp;...&nbsp;len0&nbsp;IDAT&nbsp;xxx&nbsp;crc0&nbsp;len1&nbsp;IDAT&nbsp;yy&nbsp;crc1&nbsp;len2&nbsp;IEND&nbsp;crc2</span><br>
<span class="lineno">280</span><span class="comment" id="5947663">//&nbsp;then&nbsp;this&nbsp;reader&nbsp;presents&nbsp;xxxyy.&nbsp;For&nbsp;well-formed&nbsp;PNG&nbsp;data,&nbsp;the&nbsp;decoder&nbsp;state</span><br>
<span class="lineno"></span><span class="comment" id="5947743">//&nbsp;immediately&nbsp;before&nbsp;the&nbsp;first&nbsp;Read&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5947823">//&nbsp;first&nbsp;IDAT&nbsp;and&nbsp;xxx,&nbsp;and&nbsp;the&nbsp;decoder&nbsp;state&nbsp;immediately&nbsp;after&nbsp;the&nbsp;last&nbsp;Read</span><br>
<span class="lineno"></span><span class="comment" id="5947900">//&nbsp;call&nbsp;is&nbsp;that&nbsp;d.r&nbsp;is&nbsp;positioned&nbsp;between&nbsp;yy&nbsp;and&nbsp;crc1.</span><br>
<span class="lineno"></span><span class="keyword" id="5947955">func</span>&nbsp;<span class="op" id="5947960">(</span><span class="ident" id="5947961">d</span>&nbsp;<span class="op" id="5947963">*</span><span class="ident" id="5947964">decoder</span><span class="op" id="5947971">)</span>&nbsp;<span class="ident" id="5947973">Read</span><span class="op" id="5947977">(</span><span class="ident" id="5947978">p</span>&nbsp;<span class="op" id="5947980">[</span><span class="op" id="5947981">]</span><span class="builtintype" id="5947982">byte</span><span class="op" id="5947986">)</span>&nbsp;<span class="op" id="5947988">(</span><span class="builtintype" id="5947989">int</span><span class="op" id="5947992">,</span>&nbsp;<span class="builtintype" id="5947994">error</span><span class="op" id="5947999">)</span>&nbsp;<span class="op" id="5948001">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948004">if</span>&nbsp;<span class="builtinfunc" id="5948007">len</span><span class="op" id="5948010">(</span><span class="ident" id="5948011">p</span><span class="op" id="5948012">)</span>&nbsp;<span class="op" id="5948014">==</span>&nbsp;<span class="num" id="5948017">0</span>&nbsp;<span class="op" id="5948019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948023">return</span>&nbsp;<span class="num" id="5948030">0</span><span class="op" id="5948031">,</span>&nbsp;<span class="builtintype" id="5948033">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948038">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948041">for</span>&nbsp;<span class="ident" id="5948045">d</span><span class="op" id="5948046">.</span><span class="ident" id="5948047">idatLength</span>&nbsp;<span class="op" id="5948058">==</span>&nbsp;<span class="num" id="5948061">0</span>&nbsp;<span class="op" id="5948063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948067">//&nbsp;We&nbsp;have&nbsp;exhausted&nbsp;an&nbsp;IDAT&nbsp;chunk.&nbsp;Verify&nbsp;the&nbsp;checksum&nbsp;of&nbsp;that&nbsp;chunk.</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948140">if</span>&nbsp;<span class="ident" id="5948143">err</span>&nbsp;<span class="op" id="5948147">:=</span>&nbsp;<span class="ident" id="5948150">d</span><span class="op" id="5948151">.</span><span class="ident" id="5948152">verifyChecksum</span><span class="op" id="5948166">(</span><span class="op" id="5948167">)</span><span class="op" id="5948168">;</span>&nbsp;<span class="ident" id="5948170">err</span>&nbsp;<span class="op" id="5948174">!=</span>&nbsp;<span class="builtintype" id="5948177">nil</span>&nbsp;<span class="op" id="5948181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948186">return</span>&nbsp;<span class="num" id="5948193">0</span><span class="op" id="5948194">,</span>&nbsp;<span class="ident" id="5948196">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948206">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type&nbsp;of&nbsp;the&nbsp;next&nbsp;chunk,&nbsp;and&nbsp;check&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5948276">//&nbsp;it&nbsp;is&nbsp;an&nbsp;IDAT&nbsp;chunk.</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948302">if</span>&nbsp;<span class="ident" id="5948305">_</span><span class="op" id="5948306">,</span>&nbsp;<span class="ident" id="5948308">err</span>&nbsp;<span class="op" id="5948312">:=</span>&nbsp;<span class="ident" id="5948315">io</span><span class="op" id="5948317">.</span><span class="ident" id="5948318">ReadFull</span><span class="op" id="5948326">(</span><span class="ident" id="5948327">d</span><span class="op" id="5948328">.</span><span class="ident" id="5948329">r</span><span class="op" id="5948330">,</span>&nbsp;<span class="ident" id="5948332">d</span><span class="op" id="5948333">.</span><span class="ident" id="5948334">tmp</span><span class="op" id="5948337">[</span><span class="op" id="5948338">:</span><span class="num" id="5948339">8</span><span class="op" id="5948340">]</span><span class="op" id="5948341">)</span><span class="op" id="5948342">;</span>&nbsp;<span class="ident" id="5948344">err</span>&nbsp;<span class="op" id="5948348">!=</span>&nbsp;<span class="builtintype" id="5948351">nil</span>&nbsp;<span class="op" id="5948355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948360">return</span>&nbsp;<span class="num" id="5948367">0</span><span class="op" id="5948368">,</span>&nbsp;<span class="ident" id="5948370">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948376">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948380">d</span><span class="op" id="5948381">.</span><span class="ident" id="5948382">idatLength</span>&nbsp;<span class="op" id="5948393">=</span>&nbsp;<span class="ident" id="5948395">binary</span><span class="op" id="5948401">.</span><span class="ident" id="5948402">BigEndian</span><span class="op" id="5948411">.</span><span class="ident" id="5948412">Uint32</span><span class="op" id="5948418">(</span><span class="ident" id="5948419">d</span><span class="op" id="5948420">.</span><span class="ident" id="5948421">tmp</span><span class="op" id="5948424">[</span><span class="op" id="5948425">:</span><span class="num" id="5948426">4</span><span class="op" id="5948427">]</span><span class="op" id="5948428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948432">if</span>&nbsp;<span class="builtintype" id="5948435">string</span><span class="op" id="5948441">(</span><span class="ident" id="5948442">d</span><span class="op" id="5948443">.</span><span class="ident" id="5948444">tmp</span><span class="op" id="5948447">[</span><span class="num" id="5948448">4</span><span class="op" id="5948449">:</span><span class="num" id="5948450">8</span><span class="op" id="5948451">]</span><span class="op" id="5948452">)</span>&nbsp;<span class="op" id="5948454">!=</span>&nbsp;<span class="string" id="5948457">&#34;IDAT&#34;</span>&nbsp;<span class="op" id="5948464">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948469">return</span>&nbsp;<span class="num" id="5948476">0</span><span class="op" id="5948477">,</span>&nbsp;<span class="ident" id="5948479">FormatError</span><span class="op" id="5948490">(</span><span class="string" id="5948491">&#34;not&nbsp;enough&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5948514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948522">d</span><span class="op" id="5948523">.</span><span class="ident" id="5948524">crc</span><span class="op" id="5948527">.</span><span class="ident" id="5948528">Reset</span><span class="op" id="5948533">(</span><span class="op" id="5948534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948538">d</span><span class="op" id="5948539">.</span><span class="ident" id="5948540">crc</span><span class="op" id="5948543">.</span><span class="ident" id="5948544">Write</span><span class="op" id="5948549">(</span><span class="ident" id="5948550">d</span><span class="op" id="5948551">.</span><span class="ident" id="5948552">tmp</span><span class="op" id="5948555">[</span><span class="num" id="5948556">4</span><span class="op" id="5948557">:</span><span class="num" id="5948558">8</span><span class="op" id="5948559">]</span><span class="op" id="5948560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948563">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948566">if</span>&nbsp;<span class="builtintype" id="5948569">int</span><span class="op" id="5948572">(</span><span class="ident" id="5948573">d</span><span class="op" id="5948574">.</span><span class="ident" id="5948575">idatLength</span><span class="op" id="5948585">)</span>&nbsp;<span class="op" id="5948587">&lt;</span>&nbsp;<span class="num" id="5948589">0</span>&nbsp;<span class="op" id="5948591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948595">return</span>&nbsp;<span class="num" id="5948602">0</span><span class="op" id="5948603">,</span>&nbsp;<span class="ident" id="5948605">UnsupportedError</span><span class="op" id="5948621">(</span><span class="string" id="5948622">&#34;IDAT&nbsp;chunk&nbsp;length&nbsp;overflow&#34;</span><span class="op" id="5948650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948656">n</span><span class="op" id="5948657">,</span>&nbsp;<span class="ident" id="5948659">err</span>&nbsp;<span class="op" id="5948663">:=</span>&nbsp;<span class="ident" id="5948666">d</span><span class="op" id="5948667">.</span><span class="ident" id="5948668">r</span><span class="op" id="5948669">.</span><span class="ident" id="5948670">Read</span><span class="op" id="5948674">(</span><span class="ident" id="5948675">p</span><span class="op" id="5948676">[</span><span class="op" id="5948677">:</span><span class="ident" id="5948678">min</span><span class="op" id="5948681">(</span><span class="builtinfunc" id="5948682">len</span><span class="op" id="5948685">(</span><span class="ident" id="5948686">p</span><span class="op" id="5948687">)</span><span class="op" id="5948688">,</span>&nbsp;<span class="builtintype" id="5948690">int</span><span class="op" id="5948693">(</span><span class="ident" id="5948694">d</span><span class="op" id="5948695">.</span><span class="ident" id="5948696">idatLength</span><span class="op" id="5948706">)</span><span class="op" id="5948707">)</span><span class="op" id="5948708">]</span><span class="op" id="5948709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948712">d</span><span class="op" id="5948713">.</span><span class="ident" id="5948714">crc</span><span class="op" id="5948717">.</span><span class="ident" id="5948718">Write</span><span class="op" id="5948723">(</span><span class="ident" id="5948724">p</span><span class="op" id="5948725">[</span><span class="op" id="5948726">:</span><span class="ident" id="5948727">n</span><span class="op" id="5948728">]</span><span class="op" id="5948729">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948732">d</span><span class="op" id="5948733">.</span><span class="ident" id="5948734">idatLength</span>&nbsp;<span class="op" id="5948745">-=</span>&nbsp;<span class="builtintype" id="5948748">uint32</span><span class="op" id="5948754">(</span><span class="ident" id="5948755">n</span><span class="op" id="5948756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948759">return</span>&nbsp;<span class="ident" id="5948766">n</span><span class="op" id="5948767">,</span>&nbsp;<span class="ident" id="5948769">err</span><br>
<span class="lineno"></span><span class="op" id="5948773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5948776">//&nbsp;decode&nbsp;decodes&nbsp;the&nbsp;IDAT&nbsp;data&nbsp;into&nbsp;an&nbsp;image.</span><br>
<span class="lineno">315</span><span class="keyword" id="5948823">func</span>&nbsp;<span class="op" id="5948828">(</span><span class="ident" id="5948829">d</span>&nbsp;<span class="op" id="5948831">*</span><span class="ident" id="5948832">decoder</span><span class="op" id="5948839">)</span>&nbsp;<span class="ident" id="5948841">decode</span><span class="op" id="5948847">(</span><span class="op" id="5948848">)</span>&nbsp;<span class="op" id="5948850">(</span><span class="ident" id="5948851">image</span><span class="op" id="5948856">.</span><span class="ident" id="5948857">Image</span><span class="op" id="5948862">,</span>&nbsp;<span class="builtintype" id="5948864">error</span><span class="op" id="5948869">)</span>&nbsp;<span class="op" id="5948871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5948874">r</span><span class="op" id="5948875">,</span>&nbsp;<span class="ident" id="5948877">err</span>&nbsp;<span class="op" id="5948881">:=</span>&nbsp;<span class="ident" id="5948884">zlib</span><span class="op" id="5948888">.</span><span class="ident" id="5948889">NewReader</span><span class="op" id="5948898">(</span><span class="ident" id="5948899">d</span><span class="op" id="5948900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948903">if</span>&nbsp;<span class="ident" id="5948906">err</span>&nbsp;<span class="op" id="5948910">!=</span>&nbsp;<span class="builtintype" id="5948913">nil</span>&nbsp;<span class="op" id="5948917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948921">return</span>&nbsp;<span class="builtintype" id="5948928">nil</span><span class="op" id="5948931">,</span>&nbsp;<span class="ident" id="5948933">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5948938">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948941">defer</span>&nbsp;<span class="ident" id="5948947">r</span><span class="op" id="5948948">.</span><span class="ident" id="5948949">Close</span><span class="op" id="5948954">(</span><span class="op" id="5948955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948958">var</span>&nbsp;<span class="ident" id="5948962">img</span>&nbsp;<span class="ident" id="5948966">image</span><span class="op" id="5948971">.</span><span class="ident" id="5948972">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5948979">if</span>&nbsp;<span class="ident" id="5948982">d</span><span class="op" id="5948983">.</span><span class="ident" id="5948984">interlace</span>&nbsp;<span class="op" id="5948994">==</span>&nbsp;<span class="ident" id="5948997">itNone</span>&nbsp;<span class="op" id="5949004">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949008">img</span><span class="op" id="5949011">,</span>&nbsp;<span class="ident" id="5949013">err</span>&nbsp;<span class="op" id="5949017">=</span>&nbsp;<span class="ident" id="5949019">d</span><span class="op" id="5949020">.</span><span class="ident" id="5949021">readImagePass</span><span class="op" id="5949034">(</span><span class="ident" id="5949035">r</span><span class="op" id="5949036">,</span>&nbsp;<span class="num" id="5949038">0</span><span class="op" id="5949039">,</span>&nbsp;<span class="builtintype" id="5949041">false</span><span class="op" id="5949046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949049">}</span>&nbsp;<span class="keyword" id="5949051">else</span>&nbsp;<span class="keyword" id="5949056">if</span>&nbsp;<span class="ident" id="5949059">d</span><span class="op" id="5949060">.</span><span class="ident" id="5949061">interlace</span>&nbsp;<span class="op" id="5949071">==</span>&nbsp;<span class="ident" id="5949074">itAdam7</span>&nbsp;<span class="op" id="5949082">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949086">//&nbsp;Allocate&nbsp;a&nbsp;blank&nbsp;image&nbsp;of&nbsp;the&nbsp;full&nbsp;size.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949132">img</span><span class="op" id="5949135">,</span>&nbsp;<span class="ident" id="5949137">err</span>&nbsp;<span class="op" id="5949141">=</span>&nbsp;<span class="ident" id="5949143">d</span><span class="op" id="5949144">.</span><span class="ident" id="5949145">readImagePass</span><span class="op" id="5949158">(</span><span class="builtintype" id="5949159">nil</span><span class="op" id="5949162">,</span>&nbsp;<span class="num" id="5949164">0</span><span class="op" id="5949165">,</span>&nbsp;<span class="builtintype" id="5949167">true</span><span class="op" id="5949171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949175">for</span>&nbsp;<span class="ident" id="5949179">pass</span>&nbsp;<span class="op" id="5949184">:=</span>&nbsp;<span class="num" id="5949187">0</span><span class="op" id="5949188">;</span>&nbsp;<span class="ident" id="5949190">pass</span>&nbsp;<span class="op" id="5949195">&lt;</span>&nbsp;<span class="num" id="5949197">7</span><span class="op" id="5949198">;</span>&nbsp;<span class="ident" id="5949200">pass</span><span class="op" id="5949204">++</span>&nbsp;<span class="op" id="5949207">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949212">imagePass</span><span class="op" id="5949221">,</span>&nbsp;<span class="ident" id="5949223">err</span>&nbsp;<span class="op" id="5949227">:=</span>&nbsp;<span class="ident" id="5949230">d</span><span class="op" id="5949231">.</span><span class="ident" id="5949232">readImagePass</span><span class="op" id="5949245">(</span><span class="ident" id="5949246">r</span><span class="op" id="5949247">,</span>&nbsp;<span class="ident" id="5949249">pass</span><span class="op" id="5949253">,</span>&nbsp;<span class="builtintype" id="5949255">false</span><span class="op" id="5949260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949265">if</span>&nbsp;<span class="ident" id="5949268">err</span>&nbsp;<span class="op" id="5949272">!=</span>&nbsp;<span class="builtintype" id="5949275">nil</span>&nbsp;<span class="op" id="5949279">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949285">return</span>&nbsp;<span class="builtintype" id="5949292">nil</span><span class="op" id="5949295">,</span>&nbsp;<span class="ident" id="5949297">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949304">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949309">d</span><span class="op" id="5949310">.</span><span class="ident" id="5949311">mergePassInto</span><span class="op" id="5949324">(</span><span class="ident" id="5949325">img</span><span class="op" id="5949328">,</span>&nbsp;<span class="ident" id="5949330">imagePass</span><span class="op" id="5949339">,</span>&nbsp;<span class="ident" id="5949341">pass</span><span class="op" id="5949345">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949352">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5949356">//&nbsp;Check&nbsp;for&nbsp;EOF,&nbsp;to&nbsp;verify&nbsp;the&nbsp;zlib&nbsp;checksum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949404">n</span>&nbsp;<span class="op" id="5949406">:=</span>&nbsp;<span class="num" id="5949409">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949412">for</span>&nbsp;<span class="ident" id="5949416">i</span>&nbsp;<span class="op" id="5949418">:=</span>&nbsp;<span class="num" id="5949421">0</span><span class="op" id="5949422">;</span>&nbsp;<span class="ident" id="5949424">n</span>&nbsp;<span class="op" id="5949426">==</span>&nbsp;<span class="num" id="5949429">0</span>&nbsp;<span class="op" id="5949431">&amp;&amp;</span>&nbsp;<span class="ident" id="5949434">err</span>&nbsp;<span class="op" id="5949438">==</span>&nbsp;<span class="builtintype" id="5949441">nil</span><span class="op" id="5949444">;</span>&nbsp;<span class="ident" id="5949446">i</span><span class="op" id="5949447">++</span>&nbsp;<span class="op" id="5949450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949454">if</span>&nbsp;<span class="ident" id="5949457">i</span>&nbsp;<span class="op" id="5949459">==</span>&nbsp;<span class="num" id="5949462">100</span>&nbsp;<span class="op" id="5949466">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949471">return</span>&nbsp;<span class="builtintype" id="5949478">nil</span><span class="op" id="5949481">,</span>&nbsp;<span class="ident" id="5949483">io</span><span class="op" id="5949485">.</span><span class="ident" id="5949486">ErrNoProgress</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949506">n</span><span class="op" id="5949507">,</span>&nbsp;<span class="ident" id="5949509">err</span>&nbsp;<span class="op" id="5949513">=</span>&nbsp;<span class="ident" id="5949515">r</span><span class="op" id="5949516">.</span><span class="ident" id="5949517">Read</span><span class="op" id="5949521">(</span><span class="ident" id="5949522">d</span><span class="op" id="5949523">.</span><span class="ident" id="5949524">tmp</span><span class="op" id="5949527">[</span><span class="op" id="5949528">:</span><span class="num" id="5949529">1</span><span class="op" id="5949530">]</span><span class="op" id="5949531">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949537">if</span>&nbsp;<span class="ident" id="5949540">err</span>&nbsp;<span class="op" id="5949544">!=</span>&nbsp;<span class="builtintype" id="5949547">nil</span>&nbsp;<span class="op" id="5949551">&amp;&amp;</span>&nbsp;<span class="ident" id="5949554">err</span>&nbsp;<span class="op" id="5949558">!=</span>&nbsp;<span class="ident" id="5949561">io</span><span class="op" id="5949563">.</span><span class="ident" id="5949564">EOF</span>&nbsp;<span class="op" id="5949568">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949572">return</span>&nbsp;<span class="builtintype" id="5949579">nil</span><span class="op" id="5949582">,</span>&nbsp;<span class="ident" id="5949584">FormatError</span><span class="op" id="5949595">(</span><span class="ident" id="5949596">err</span><span class="op" id="5949599">.</span><span class="ident" id="5949600">Error</span><span class="op" id="5949605">(</span><span class="op" id="5949606">)</span><span class="op" id="5949607">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949613">if</span>&nbsp;<span class="ident" id="5949616">n</span>&nbsp;<span class="op" id="5949618">!=</span>&nbsp;<span class="num" id="5949621">0</span>&nbsp;<span class="op" id="5949623">||</span>&nbsp;<span class="ident" id="5949626">d</span><span class="op" id="5949627">.</span><span class="ident" id="5949628">idatLength</span>&nbsp;<span class="op" id="5949639">!=</span>&nbsp;<span class="num" id="5949642">0</span>&nbsp;<span class="op" id="5949644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949648">return</span>&nbsp;<span class="builtintype" id="5949655">nil</span><span class="op" id="5949658">,</span>&nbsp;<span class="ident" id="5949660">FormatError</span><span class="op" id="5949671">(</span><span class="string" id="5949672">&#34;too&nbsp;much&nbsp;pixel&nbsp;data&#34;</span><span class="op" id="5949693">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949696">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949700">return</span>&nbsp;<span class="ident" id="5949707">img</span><span class="op" id="5949710">,</span>&nbsp;<span class="builtintype" id="5949712">nil</span><br>
<span class="lineno"></span><span class="op" id="5949716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5949719">//&nbsp;readImagePass&nbsp;reads&nbsp;a&nbsp;single&nbsp;image&nbsp;pass,&nbsp;sized&nbsp;according&nbsp;to&nbsp;the&nbsp;pass&nbsp;number.</span><br>
<span class="lineno">355</span><span class="keyword" id="5949799">func</span>&nbsp;<span class="op" id="5949804">(</span><span class="ident" id="5949805">d</span>&nbsp;<span class="op" id="5949807">*</span><span class="ident" id="5949808">decoder</span><span class="op" id="5949815">)</span>&nbsp;<span class="ident" id="5949817">readImagePass</span><span class="op" id="5949830">(</span><span class="ident" id="5949831">r</span>&nbsp;<span class="ident" id="5949833">io</span><span class="op" id="5949835">.</span><span class="ident" id="5949836">Reader</span><span class="op" id="5949842">,</span>&nbsp;<span class="ident" id="5949844">pass</span>&nbsp;<span class="builtintype" id="5949849">int</span><span class="op" id="5949852">,</span>&nbsp;<span class="ident" id="5949854">allocateOnly</span>&nbsp;<span class="builtintype" id="5949867">bool</span><span class="op" id="5949871">)</span>&nbsp;<span class="op" id="5949873">(</span><span class="ident" id="5949874">image</span><span class="op" id="5949879">.</span><span class="ident" id="5949880">Image</span><span class="op" id="5949885">,</span>&nbsp;<span class="builtintype" id="5949887">error</span><span class="op" id="5949892">)</span>&nbsp;<span class="op" id="5949894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949897">var</span>&nbsp;<span class="ident" id="5949901">bitsPerPixel</span>&nbsp;<span class="builtintype" id="5949914">int</span>&nbsp;<span class="op" id="5949918">=</span>&nbsp;<span class="num" id="5949920">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949923">pixOffset</span>&nbsp;<span class="op" id="5949933">:=</span>&nbsp;<span class="num" id="5949936">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5949939">var</span>&nbsp;<span class="op" id="5949943">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949947">gray</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949956">*</span><span class="ident" id="5949957">image</span><span class="op" id="5949962">.</span><span class="ident" id="5949963">Gray</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949970">rgba</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5949979">*</span><span class="ident" id="5949980">image</span><span class="op" id="5949985">.</span><span class="ident" id="5949986">RGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5949993">paletted</span>&nbsp;<span class="op" id="5950002">*</span><span class="ident" id="5950003">image</span><span class="op" id="5950008">.</span><span class="ident" id="5950009">Paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950020">nrgba</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950029">*</span><span class="ident" id="5950030">image</span><span class="op" id="5950035">.</span><span class="ident" id="5950036">NRGBA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950044">gray16</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5950053">*</span><span class="ident" id="5950054">image</span><span class="op" id="5950059">.</span><span class="ident" id="5950060">Gray16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950069">rgba64</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5950078">*</span><span class="ident" id="5950079">image</span><span class="op" id="5950084">.</span><span class="ident" id="5950085">RGBA64</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950094">nrgba64</span>&nbsp;&nbsp;<span class="op" id="5950103">*</span><span class="ident" id="5950104">image</span><span class="op" id="5950109">.</span><span class="ident" id="5950110">NRGBA64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950120">img</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950129">image</span><span class="op" id="5950134">.</span><span class="ident" id="5950135">Image</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950145">width</span><span class="op" id="5950150">,</span>&nbsp;<span class="ident" id="5950152">height</span>&nbsp;<span class="op" id="5950159">:=</span>&nbsp;<span class="ident" id="5950162">d</span><span class="op" id="5950163">.</span><span class="ident" id="5950164">width</span><span class="op" id="5950169">,</span>&nbsp;<span class="ident" id="5950171">d</span><span class="op" id="5950172">.</span><span class="ident" id="5950173">height</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950181">if</span>&nbsp;<span class="ident" id="5950184">d</span><span class="op" id="5950185">.</span><span class="ident" id="5950186">interlace</span>&nbsp;<span class="op" id="5950196">==</span>&nbsp;<span class="ident" id="5950199">itAdam7</span>&nbsp;<span class="op" id="5950207">&amp;&amp;</span>&nbsp;<span class="op" id="5950210">!</span><span class="ident" id="5950211">allocateOnly</span>&nbsp;<span class="op" id="5950224">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950228">p</span>&nbsp;<span class="op" id="5950230">:=</span>&nbsp;<span class="ident" id="5950233">interlacing</span><span class="op" id="5950244">[</span><span class="ident" id="5950245">pass</span><span class="op" id="5950249">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5950253">//&nbsp;Add&nbsp;the&nbsp;multiplication&nbsp;factor&nbsp;and&nbsp;subtract&nbsp;one,&nbsp;effectively&nbsp;rounding&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950331">width</span>&nbsp;<span class="op" id="5950337">=</span>&nbsp;<span class="op" id="5950339">(</span><span class="ident" id="5950340">width</span>&nbsp;<span class="op" id="5950346">-</span>&nbsp;<span class="ident" id="5950348">p</span><span class="op" id="5950349">.</span><span class="ident" id="5950350">xOffset</span>&nbsp;<span class="op" id="5950358">+</span>&nbsp;<span class="ident" id="5950360">p</span><span class="op" id="5950361">.</span><span class="ident" id="5950362">xFactor</span>&nbsp;<span class="op" id="5950370">-</span>&nbsp;<span class="num" id="5950372">1</span><span class="op" id="5950373">)</span>&nbsp;<span class="op" id="5950375">/</span>&nbsp;<span class="ident" id="5950377">p</span><span class="op" id="5950378">.</span><span class="ident" id="5950379">xFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950389">height</span>&nbsp;<span class="op" id="5950396">=</span>&nbsp;<span class="op" id="5950398">(</span><span class="ident" id="5950399">height</span>&nbsp;<span class="op" id="5950406">-</span>&nbsp;<span class="ident" id="5950408">p</span><span class="op" id="5950409">.</span><span class="ident" id="5950410">yOffset</span>&nbsp;<span class="op" id="5950418">+</span>&nbsp;<span class="ident" id="5950420">p</span><span class="op" id="5950421">.</span><span class="ident" id="5950422">yFactor</span>&nbsp;<span class="op" id="5950430">-</span>&nbsp;<span class="num" id="5950432">1</span><span class="op" id="5950433">)</span>&nbsp;<span class="op" id="5950435">/</span>&nbsp;<span class="ident" id="5950437">p</span><span class="op" id="5950438">.</span><span class="ident" id="5950439">yFactor</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5950448">}</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950451">switch</span>&nbsp;<span class="ident" id="5950458">d</span><span class="op" id="5950459">.</span><span class="ident" id="5950460">cb</span>&nbsp;<span class="op" id="5950463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950466">case</span>&nbsp;<span class="ident" id="5950471">cbG1</span><span class="op" id="5950475">,</span>&nbsp;<span class="ident" id="5950477">cbG2</span><span class="op" id="5950481">,</span>&nbsp;<span class="ident" id="5950483">cbG4</span><span class="op" id="5950487">,</span>&nbsp;<span class="ident" id="5950489">cbG8</span><span class="op" id="5950493">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950497">bitsPerPixel</span>&nbsp;<span class="op" id="5950510">=</span>&nbsp;<span class="ident" id="5950512">d</span><span class="op" id="5950513">.</span><span class="ident" id="5950514">depth</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950522">gray</span>&nbsp;<span class="op" id="5950527">=</span>&nbsp;<span class="ident" id="5950529">image</span><span class="op" id="5950534">.</span><span class="ident" id="5950535">NewGray</span><span class="op" id="5950542">(</span><span class="ident" id="5950543">image</span><span class="op" id="5950548">.</span><span class="ident" id="5950549">Rect</span><span class="op" id="5950553">(</span><span class="num" id="5950554">0</span><span class="op" id="5950555">,</span>&nbsp;<span class="num" id="5950557">0</span><span class="op" id="5950558">,</span>&nbsp;<span class="ident" id="5950560">width</span><span class="op" id="5950565">,</span>&nbsp;<span class="ident" id="5950567">height</span><span class="op" id="5950573">)</span><span class="op" id="5950574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950578">img</span>&nbsp;<span class="op" id="5950582">=</span>&nbsp;<span class="ident" id="5950584">gray</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950590">case</span>&nbsp;<span class="ident" id="5950595">cbGA8</span><span class="op" id="5950600">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950604">bitsPerPixel</span>&nbsp;<span class="op" id="5950617">=</span>&nbsp;<span class="num" id="5950619">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950624">nrgba</span>&nbsp;<span class="op" id="5950630">=</span>&nbsp;<span class="ident" id="5950632">image</span><span class="op" id="5950637">.</span><span class="ident" id="5950638">NewNRGBA</span><span class="op" id="5950646">(</span><span class="ident" id="5950647">image</span><span class="op" id="5950652">.</span><span class="ident" id="5950653">Rect</span><span class="op" id="5950657">(</span><span class="num" id="5950658">0</span><span class="op" id="5950659">,</span>&nbsp;<span class="num" id="5950661">0</span><span class="op" id="5950662">,</span>&nbsp;<span class="ident" id="5950664">width</span><span class="op" id="5950669">,</span>&nbsp;<span class="ident" id="5950671">height</span><span class="op" id="5950677">)</span><span class="op" id="5950678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950682">img</span>&nbsp;<span class="op" id="5950686">=</span>&nbsp;<span class="ident" id="5950688">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950695">case</span>&nbsp;<span class="ident" id="5950700">cbTC8</span><span class="op" id="5950705">:</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950709">bitsPerPixel</span>&nbsp;<span class="op" id="5950722">=</span>&nbsp;<span class="num" id="5950724">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950729">rgba</span>&nbsp;<span class="op" id="5950734">=</span>&nbsp;<span class="ident" id="5950736">image</span><span class="op" id="5950741">.</span><span class="ident" id="5950742">NewRGBA</span><span class="op" id="5950749">(</span><span class="ident" id="5950750">image</span><span class="op" id="5950755">.</span><span class="ident" id="5950756">Rect</span><span class="op" id="5950760">(</span><span class="num" id="5950761">0</span><span class="op" id="5950762">,</span>&nbsp;<span class="num" id="5950764">0</span><span class="op" id="5950765">,</span>&nbsp;<span class="ident" id="5950767">width</span><span class="op" id="5950772">,</span>&nbsp;<span class="ident" id="5950774">height</span><span class="op" id="5950780">)</span><span class="op" id="5950781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950785">img</span>&nbsp;<span class="op" id="5950789">=</span>&nbsp;<span class="ident" id="5950791">rgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950797">case</span>&nbsp;<span class="ident" id="5950802">cbP1</span><span class="op" id="5950806">,</span>&nbsp;<span class="ident" id="5950808">cbP2</span><span class="op" id="5950812">,</span>&nbsp;<span class="ident" id="5950814">cbP4</span><span class="op" id="5950818">,</span>&nbsp;<span class="ident" id="5950820">cbP8</span><span class="op" id="5950824">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950828">bitsPerPixel</span>&nbsp;<span class="op" id="5950841">=</span>&nbsp;<span class="ident" id="5950843">d</span><span class="op" id="5950844">.</span><span class="ident" id="5950845">depth</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950853">paletted</span>&nbsp;<span class="op" id="5950862">=</span>&nbsp;<span class="ident" id="5950864">image</span><span class="op" id="5950869">.</span><span class="ident" id="5950870">NewPaletted</span><span class="op" id="5950881">(</span><span class="ident" id="5950882">image</span><span class="op" id="5950887">.</span><span class="ident" id="5950888">Rect</span><span class="op" id="5950892">(</span><span class="num" id="5950893">0</span><span class="op" id="5950894">,</span>&nbsp;<span class="num" id="5950896">0</span><span class="op" id="5950897">,</span>&nbsp;<span class="ident" id="5950899">width</span><span class="op" id="5950904">,</span>&nbsp;<span class="ident" id="5950906">height</span><span class="op" id="5950912">)</span><span class="op" id="5950913">,</span>&nbsp;<span class="ident" id="5950915">d</span><span class="op" id="5950916">.</span><span class="ident" id="5950917">palette</span><span class="op" id="5950924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950928">img</span>&nbsp;<span class="op" id="5950932">=</span>&nbsp;<span class="ident" id="5950934">paletted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5950944">case</span>&nbsp;<span class="ident" id="5950949">cbTCA8</span><span class="op" id="5950955">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950959">bitsPerPixel</span>&nbsp;<span class="op" id="5950972">=</span>&nbsp;<span class="num" id="5950974">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5950979">nrgba</span>&nbsp;<span class="op" id="5950985">=</span>&nbsp;<span class="ident" id="5950987">image</span><span class="op" id="5950992">.</span><span class="ident" id="5950993">NewNRGBA</span><span class="op" id="5951001">(</span><span class="ident" id="5951002">image</span><span class="op" id="5951007">.</span><span class="ident" id="5951008">Rect</span><span class="op" id="5951012">(</span><span class="num" id="5951013">0</span><span class="op" id="5951014">,</span>&nbsp;<span class="num" id="5951016">0</span><span class="op" id="5951017">,</span>&nbsp;<span class="ident" id="5951019">width</span><span class="op" id="5951024">,</span>&nbsp;<span class="ident" id="5951026">height</span><span class="op" id="5951032">)</span><span class="op" id="5951033">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951037">img</span>&nbsp;<span class="op" id="5951041">=</span>&nbsp;<span class="ident" id="5951043">nrgba</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951050">case</span>&nbsp;<span class="ident" id="5951055">cbG16</span><span class="op" id="5951060">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951064">bitsPerPixel</span>&nbsp;<span class="op" id="5951077">=</span>&nbsp;<span class="num" id="5951079">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951084">gray16</span>&nbsp;<span class="op" id="5951091">=</span>&nbsp;<span class="ident" id="5951093">image</span><span class="op" id="5951098">.</span><span class="ident" id="5951099">NewGray16</span><span class="op" id="5951108">(</span><span class="ident" id="5951109">image</span><span class="op" id="5951114">.</span><span class="ident" id="5951115">Rect</span><span class="op" id="5951119">(</span><span class="num" id="5951120">0</span><span class="op" id="5951121">,</span>&nbsp;<span class="num" id="5951123">0</span><span class="op" id="5951124">,</span>&nbsp;<span class="ident" id="5951126">width</span><span class="op" id="5951131">,</span>&nbsp;<span class="ident" id="5951133">height</span><span class="op" id="5951139">)</span><span class="op" id="5951140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951144">img</span>&nbsp;<span class="op" id="5951148">=</span>&nbsp;<span class="ident" id="5951150">gray16</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951158">case</span>&nbsp;<span class="ident" id="5951163">cbGA16</span><span class="op" id="5951169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951173">bitsPerPixel</span>&nbsp;<span class="op" id="5951186">=</span>&nbsp;<span class="num" id="5951188">32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951193">nrgba64</span>&nbsp;<span class="op" id="5951201">=</span>&nbsp;<span class="ident" id="5951203">image</span><span class="op" id="5951208">.</span><span class="ident" id="5951209">NewNRGBA64</span><span class="op" id="5951219">(</span><span class="ident" id="5951220">image</span><span class="op" id="5951225">.</span><span class="ident" id="5951226">Rect</span><span class="op" id="5951230">(</span><span class="num" id="5951231">0</span><span class="op" id="5951232">,</span>&nbsp;<span class="num" id="5951234">0</span><span class="op" id="5951235">,</span>&nbsp;<span class="ident" id="5951237">width</span><span class="op" id="5951242">,</span>&nbsp;<span class="ident" id="5951244">height</span><span class="op" id="5951250">)</span><span class="op" id="5951251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951255">img</span>&nbsp;<span class="op" id="5951259">=</span>&nbsp;<span class="ident" id="5951261">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951270">case</span>&nbsp;<span class="ident" id="5951275">cbTC16</span><span class="op" id="5951281">:</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951285">bitsPerPixel</span>&nbsp;<span class="op" id="5951298">=</span>&nbsp;<span class="num" id="5951300">48</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951305">rgba64</span>&nbsp;<span class="op" id="5951312">=</span>&nbsp;<span class="ident" id="5951314">image</span><span class="op" id="5951319">.</span><span class="ident" id="5951320">NewRGBA64</span><span class="op" id="5951329">(</span><span class="ident" id="5951330">image</span><span class="op" id="5951335">.</span><span class="ident" id="5951336">Rect</span><span class="op" id="5951340">(</span><span class="num" id="5951341">0</span><span class="op" id="5951342">,</span>&nbsp;<span class="num" id="5951344">0</span><span class="op" id="5951345">,</span>&nbsp;<span class="ident" id="5951347">width</span><span class="op" id="5951352">,</span>&nbsp;<span class="ident" id="5951354">height</span><span class="op" id="5951360">)</span><span class="op" id="5951361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951365">img</span>&nbsp;<span class="op" id="5951369">=</span>&nbsp;<span class="ident" id="5951371">rgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951379">case</span>&nbsp;<span class="ident" id="5951384">cbTCA16</span><span class="op" id="5951391">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951395">bitsPerPixel</span>&nbsp;<span class="op" id="5951408">=</span>&nbsp;<span class="num" id="5951410">64</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951415">nrgba64</span>&nbsp;<span class="op" id="5951423">=</span>&nbsp;<span class="ident" id="5951425">image</span><span class="op" id="5951430">.</span><span class="ident" id="5951431">NewNRGBA64</span><span class="op" id="5951441">(</span><span class="ident" id="5951442">image</span><span class="op" id="5951447">.</span><span class="ident" id="5951448">Rect</span><span class="op" id="5951452">(</span><span class="num" id="5951453">0</span><span class="op" id="5951454">,</span>&nbsp;<span class="num" id="5951456">0</span><span class="op" id="5951457">,</span>&nbsp;<span class="ident" id="5951459">width</span><span class="op" id="5951464">,</span>&nbsp;<span class="ident" id="5951466">height</span><span class="op" id="5951472">)</span><span class="op" id="5951473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951477">img</span>&nbsp;<span class="op" id="5951481">=</span>&nbsp;<span class="ident" id="5951483">nrgba64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951495">if</span>&nbsp;<span class="ident" id="5951498">allocateOnly</span>&nbsp;<span class="op" id="5951511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951515">return</span>&nbsp;<span class="ident" id="5951522">img</span><span class="op" id="5951525">,</span>&nbsp;<span class="builtintype" id="5951527">nil</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951532">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951535">bytesPerPixel</span>&nbsp;<span class="op" id="5951549">:=</span>&nbsp;<span class="op" id="5951552">(</span><span class="ident" id="5951553">bitsPerPixel</span>&nbsp;<span class="op" id="5951566">+</span>&nbsp;<span class="num" id="5951568">7</span><span class="op" id="5951569">)</span>&nbsp;<span class="op" id="5951571">/</span>&nbsp;<span class="num" id="5951573">8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5951577">//&nbsp;The&nbsp;+1&nbsp;is&nbsp;for&nbsp;the&nbsp;per-row&nbsp;filter&nbsp;type,&nbsp;which&nbsp;is&nbsp;at&nbsp;cr[0].</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951639">rowSize</span>&nbsp;<span class="op" id="5951647">:=</span>&nbsp;<span class="num" id="5951650">1</span>&nbsp;<span class="op" id="5951652">+</span>&nbsp;<span class="op" id="5951654">(</span><span class="ident" id="5951655">bitsPerPixel</span><span class="op" id="5951667">*</span><span class="ident" id="5951668">width</span><span class="op" id="5951673">+</span><span class="num" id="5951674">7</span><span class="op" id="5951675">)</span><span class="op" id="5951676">/</span><span class="num" id="5951677">8</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5951680">//&nbsp;cr&nbsp;and&nbsp;pr&nbsp;are&nbsp;the&nbsp;bytes&nbsp;for&nbsp;the&nbsp;current&nbsp;and&nbsp;previous&nbsp;row.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951742">cr</span>&nbsp;<span class="op" id="5951745">:=</span>&nbsp;<span class="builtinfunc" id="5951748">make</span><span class="op" id="5951752">(</span><span class="op" id="5951753">[</span><span class="op" id="5951754">]</span><span class="builtintype" id="5951755">uint8</span><span class="op" id="5951760">,</span>&nbsp;<span class="ident" id="5951762">rowSize</span><span class="op" id="5951769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951772">pr</span>&nbsp;<span class="op" id="5951775">:=</span>&nbsp;<span class="builtinfunc" id="5951778">make</span><span class="op" id="5951782">(</span><span class="op" id="5951783">[</span><span class="op" id="5951784">]</span><span class="builtintype" id="5951785">uint8</span><span class="op" id="5951790">,</span>&nbsp;<span class="ident" id="5951792">rowSize</span><span class="op" id="5951799">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951803">for</span>&nbsp;<span class="ident" id="5951807">y</span>&nbsp;<span class="op" id="5951809">:=</span>&nbsp;<span class="num" id="5951812">0</span><span class="op" id="5951813">;</span>&nbsp;<span class="ident" id="5951815">y</span>&nbsp;<span class="op" id="5951817">&lt;</span>&nbsp;<span class="ident" id="5951819">height</span><span class="op" id="5951825">;</span>&nbsp;<span class="ident" id="5951827">y</span><span class="op" id="5951828">++</span>&nbsp;<span class="op" id="5951831">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5951835">//&nbsp;Read&nbsp;the&nbsp;decompressed&nbsp;bytes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951869">_</span><span class="op" id="5951870">,</span>&nbsp;<span class="ident" id="5951872">err</span>&nbsp;<span class="op" id="5951876">:=</span>&nbsp;<span class="ident" id="5951879">io</span><span class="op" id="5951881">.</span><span class="ident" id="5951882">ReadFull</span><span class="op" id="5951890">(</span><span class="ident" id="5951891">r</span><span class="op" id="5951892">,</span>&nbsp;<span class="ident" id="5951894">cr</span><span class="op" id="5951896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951900">if</span>&nbsp;<span class="ident" id="5951903">err</span>&nbsp;<span class="op" id="5951907">!=</span>&nbsp;<span class="builtintype" id="5951910">nil</span>&nbsp;<span class="op" id="5951914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951919">return</span>&nbsp;<span class="builtintype" id="5951926">nil</span><span class="op" id="5951929">,</span>&nbsp;<span class="ident" id="5951931">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5951937">}</span><br>
<span class="lineno">430</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5951942">//&nbsp;Apply&nbsp;the&nbsp;filter.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951965">cdat</span>&nbsp;<span class="op" id="5951970">:=</span>&nbsp;<span class="ident" id="5951973">cr</span><span class="op" id="5951975">[</span><span class="num" id="5951976">1</span><span class="op" id="5951977">:</span><span class="op" id="5951978">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5951982">pdat</span>&nbsp;<span class="op" id="5951987">:=</span>&nbsp;<span class="ident" id="5951990">pr</span><span class="op" id="5951992">[</span><span class="num" id="5951993">1</span><span class="op" id="5951994">:</span><span class="op" id="5951995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5951999">switch</span>&nbsp;<span class="ident" id="5952006">cr</span><span class="op" id="5952008">[</span><span class="num" id="5952009">0</span><span class="op" id="5952010">]</span>&nbsp;<span class="op" id="5952012">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952016">case</span>&nbsp;<span class="ident" id="5952021">ftNone</span><span class="op" id="5952027">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952032">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952044">case</span>&nbsp;<span class="ident" id="5952049">ftSub</span><span class="op" id="5952054">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952059">for</span>&nbsp;<span class="ident" id="5952063">i</span>&nbsp;<span class="op" id="5952065">:=</span>&nbsp;<span class="ident" id="5952068">bytesPerPixel</span><span class="op" id="5952081">;</span>&nbsp;<span class="ident" id="5952083">i</span>&nbsp;<span class="op" id="5952085">&lt;</span>&nbsp;<span class="builtinfunc" id="5952087">len</span><span class="op" id="5952090">(</span><span class="ident" id="5952091">cdat</span><span class="op" id="5952095">)</span><span class="op" id="5952096">;</span>&nbsp;<span class="ident" id="5952098">i</span><span class="op" id="5952099">++</span>&nbsp;<span class="op" id="5952102">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952108">cdat</span><span class="op" id="5952112">[</span><span class="ident" id="5952113">i</span><span class="op" id="5952114">]</span>&nbsp;<span class="op" id="5952116">+=</span>&nbsp;<span class="ident" id="5952119">cdat</span><span class="op" id="5952123">[</span><span class="ident" id="5952124">i</span><span class="op" id="5952125">-</span><span class="ident" id="5952126">bytesPerPixel</span><span class="op" id="5952139">]</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952148">case</span>&nbsp;<span class="ident" id="5952153">ftUp</span><span class="op" id="5952157">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952162">for</span>&nbsp;<span class="ident" id="5952166">i</span><span class="op" id="5952167">,</span>&nbsp;<span class="ident" id="5952169">p</span>&nbsp;<span class="op" id="5952171">:=</span>&nbsp;<span class="keyword" id="5952174">range</span>&nbsp;<span class="ident" id="5952180">pdat</span>&nbsp;<span class="op" id="5952185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952191">cdat</span><span class="op" id="5952195">[</span><span class="ident" id="5952196">i</span><span class="op" id="5952197">]</span>&nbsp;<span class="op" id="5952199">+=</span>&nbsp;<span class="ident" id="5952202">p</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952207">}</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952211">case</span>&nbsp;<span class="ident" id="5952216">ftAverage</span><span class="op" id="5952225">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952230">for</span>&nbsp;<span class="ident" id="5952234">i</span>&nbsp;<span class="op" id="5952236">:=</span>&nbsp;<span class="num" id="5952239">0</span><span class="op" id="5952240">;</span>&nbsp;<span class="ident" id="5952242">i</span>&nbsp;<span class="op" id="5952244">&lt;</span>&nbsp;<span class="ident" id="5952246">bytesPerPixel</span><span class="op" id="5952259">;</span>&nbsp;<span class="ident" id="5952261">i</span><span class="op" id="5952262">++</span>&nbsp;<span class="op" id="5952265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952271">cdat</span><span class="op" id="5952275">[</span><span class="ident" id="5952276">i</span><span class="op" id="5952277">]</span>&nbsp;<span class="op" id="5952279">+=</span>&nbsp;<span class="ident" id="5952282">pdat</span><span class="op" id="5952286">[</span><span class="ident" id="5952287">i</span><span class="op" id="5952288">]</span>&nbsp;<span class="op" id="5952290">/</span>&nbsp;<span class="num" id="5952292">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952302">for</span>&nbsp;<span class="ident" id="5952306">i</span>&nbsp;<span class="op" id="5952308">:=</span>&nbsp;<span class="ident" id="5952311">bytesPerPixel</span><span class="op" id="5952324">;</span>&nbsp;<span class="ident" id="5952326">i</span>&nbsp;<span class="op" id="5952328">&lt;</span>&nbsp;<span class="builtinfunc" id="5952330">len</span><span class="op" id="5952333">(</span><span class="ident" id="5952334">cdat</span><span class="op" id="5952338">)</span><span class="op" id="5952339">;</span>&nbsp;<span class="ident" id="5952341">i</span><span class="op" id="5952342">++</span>&nbsp;<span class="op" id="5952345">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952351">cdat</span><span class="op" id="5952355">[</span><span class="ident" id="5952356">i</span><span class="op" id="5952357">]</span>&nbsp;<span class="op" id="5952359">+=</span>&nbsp;<span class="builtintype" id="5952362">uint8</span><span class="op" id="5952367">(</span><span class="op" id="5952368">(</span><span class="builtintype" id="5952369">int</span><span class="op" id="5952372">(</span><span class="ident" id="5952373">cdat</span><span class="op" id="5952377">[</span><span class="ident" id="5952378">i</span><span class="op" id="5952379">-</span><span class="ident" id="5952380">bytesPerPixel</span><span class="op" id="5952393">]</span><span class="op" id="5952394">)</span>&nbsp;<span class="op" id="5952396">+</span>&nbsp;<span class="builtintype" id="5952398">int</span><span class="op" id="5952401">(</span><span class="ident" id="5952402">pdat</span><span class="op" id="5952406">[</span><span class="ident" id="5952407">i</span><span class="op" id="5952408">]</span><span class="op" id="5952409">)</span><span class="op" id="5952410">)</span>&nbsp;<span class="op" id="5952412">/</span>&nbsp;<span class="num" id="5952414">2</span><span class="op" id="5952415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952424">case</span>&nbsp;<span class="ident" id="5952429">ftPaeth</span><span class="op" id="5952436">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952441">filterPaeth</span><span class="op" id="5952452">(</span><span class="ident" id="5952453">cdat</span><span class="op" id="5952457">,</span>&nbsp;<span class="ident" id="5952459">pdat</span><span class="op" id="5952463">,</span>&nbsp;<span class="ident" id="5952465">bytesPerPixel</span><span class="op" id="5952478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952482">default</span><span class="op" id="5952489">:</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952494">return</span>&nbsp;<span class="builtintype" id="5952501">nil</span><span class="op" id="5952504">,</span>&nbsp;<span class="ident" id="5952506">FormatError</span><span class="op" id="5952517">(</span><span class="string" id="5952518">&#34;bad&nbsp;filter&nbsp;type&#34;</span><span class="op" id="5952535">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5952544">//&nbsp;Convert&nbsp;from&nbsp;bytes&nbsp;to&nbsp;colors.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952579">switch</span>&nbsp;<span class="ident" id="5952586">d</span><span class="op" id="5952587">.</span><span class="ident" id="5952588">cb</span>&nbsp;<span class="op" id="5952591">{</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952595">case</span>&nbsp;<span class="ident" id="5952600">cbG1</span><span class="op" id="5952604">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952609">for</span>&nbsp;<span class="ident" id="5952613">x</span>&nbsp;<span class="op" id="5952615">:=</span>&nbsp;<span class="num" id="5952618">0</span><span class="op" id="5952619">;</span>&nbsp;<span class="ident" id="5952621">x</span>&nbsp;<span class="op" id="5952623">&lt;</span>&nbsp;<span class="ident" id="5952625">width</span><span class="op" id="5952630">;</span>&nbsp;<span class="ident" id="5952632">x</span>&nbsp;<span class="op" id="5952634">+=</span>&nbsp;<span class="num" id="5952637">8</span>&nbsp;<span class="op" id="5952639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952645">b</span>&nbsp;<span class="op" id="5952647">:=</span>&nbsp;<span class="ident" id="5952650">cdat</span><span class="op" id="5952654">[</span><span class="ident" id="5952655">x</span><span class="op" id="5952656">/</span><span class="num" id="5952657">8</span><span class="op" id="5952658">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952664">for</span>&nbsp;<span class="ident" id="5952668">x2</span>&nbsp;<span class="op" id="5952671">:=</span>&nbsp;<span class="num" id="5952674">0</span><span class="op" id="5952675">;</span>&nbsp;<span class="ident" id="5952677">x2</span>&nbsp;<span class="op" id="5952680">&lt;</span>&nbsp;<span class="num" id="5952682">8</span>&nbsp;<span class="op" id="5952684">&amp;&amp;</span>&nbsp;<span class="ident" id="5952687">x</span><span class="op" id="5952688">+</span><span class="ident" id="5952689">x2</span>&nbsp;<span class="op" id="5952692">&lt;</span>&nbsp;<span class="ident" id="5952694">width</span><span class="op" id="5952699">;</span>&nbsp;<span class="ident" id="5952701">x2</span><span class="op" id="5952703">++</span>&nbsp;<span class="op" id="5952706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952713">gray</span><span class="op" id="5952717">.</span><span class="ident" id="5952718">SetGray</span><span class="op" id="5952725">(</span><span class="ident" id="5952726">x</span><span class="op" id="5952727">+</span><span class="ident" id="5952728">x2</span><span class="op" id="5952730">,</span>&nbsp;<span class="ident" id="5952732">y</span><span class="op" id="5952733">,</span>&nbsp;<span class="ident" id="5952735">color</span><span class="op" id="5952740">.</span><span class="ident" id="5952741">Gray</span><span class="op" id="5952745">{</span><span class="op" id="5952746">(</span><span class="ident" id="5952747">b</span>&nbsp;<span class="op" id="5952749">&gt;&gt;</span>&nbsp;<span class="num" id="5952752">7</span><span class="op" id="5952753">)</span>&nbsp;<span class="op" id="5952755">*</span>&nbsp;<span class="num" id="5952757">0xff</span><span class="op" id="5952761">}</span><span class="op" id="5952762">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952769">b</span>&nbsp;<span class="op" id="5952771">&lt;&lt;=</span>&nbsp;<span class="num" id="5952775">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952786">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952790">case</span>&nbsp;<span class="ident" id="5952795">cbG2</span><span class="op" id="5952799">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952804">for</span>&nbsp;<span class="ident" id="5952808">x</span>&nbsp;<span class="op" id="5952810">:=</span>&nbsp;<span class="num" id="5952813">0</span><span class="op" id="5952814">;</span>&nbsp;<span class="ident" id="5952816">x</span>&nbsp;<span class="op" id="5952818">&lt;</span>&nbsp;<span class="ident" id="5952820">width</span><span class="op" id="5952825">;</span>&nbsp;<span class="ident" id="5952827">x</span>&nbsp;<span class="op" id="5952829">+=</span>&nbsp;<span class="num" id="5952832">4</span>&nbsp;<span class="op" id="5952834">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952840">b</span>&nbsp;<span class="op" id="5952842">:=</span>&nbsp;<span class="ident" id="5952845">cdat</span><span class="op" id="5952849">[</span><span class="ident" id="5952850">x</span><span class="op" id="5952851">/</span><span class="num" id="5952852">4</span><span class="op" id="5952853">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952859">for</span>&nbsp;<span class="ident" id="5952863">x2</span>&nbsp;<span class="op" id="5952866">:=</span>&nbsp;<span class="num" id="5952869">0</span><span class="op" id="5952870">;</span>&nbsp;<span class="ident" id="5952872">x2</span>&nbsp;<span class="op" id="5952875">&lt;</span>&nbsp;<span class="num" id="5952877">4</span>&nbsp;<span class="op" id="5952879">&amp;&amp;</span>&nbsp;<span class="ident" id="5952882">x</span><span class="op" id="5952883">+</span><span class="ident" id="5952884">x2</span>&nbsp;<span class="op" id="5952887">&lt;</span>&nbsp;<span class="ident" id="5952889">width</span><span class="op" id="5952894">;</span>&nbsp;<span class="ident" id="5952896">x2</span><span class="op" id="5952898">++</span>&nbsp;<span class="op" id="5952901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952908">gray</span><span class="op" id="5952912">.</span><span class="ident" id="5952913">SetGray</span><span class="op" id="5952920">(</span><span class="ident" id="5952921">x</span><span class="op" id="5952922">+</span><span class="ident" id="5952923">x2</span><span class="op" id="5952925">,</span>&nbsp;<span class="ident" id="5952927">y</span><span class="op" id="5952928">,</span>&nbsp;<span class="ident" id="5952930">color</span><span class="op" id="5952935">.</span><span class="ident" id="5952936">Gray</span><span class="op" id="5952940">{</span><span class="op" id="5952941">(</span><span class="ident" id="5952942">b</span>&nbsp;<span class="op" id="5952944">&gt;&gt;</span>&nbsp;<span class="num" id="5952947">6</span><span class="op" id="5952948">)</span>&nbsp;<span class="op" id="5952950">*</span>&nbsp;<span class="num" id="5952952">0x55</span><span class="op" id="5952956">}</span><span class="op" id="5952957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5952964">b</span>&nbsp;<span class="op" id="5952966">&lt;&lt;=</span>&nbsp;<span class="num" id="5952970">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952976">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5952981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952985">case</span>&nbsp;<span class="ident" id="5952990">cbG4</span><span class="op" id="5952994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5952999">for</span>&nbsp;<span class="ident" id="5953003">x</span>&nbsp;<span class="op" id="5953005">:=</span>&nbsp;<span class="num" id="5953008">0</span><span class="op" id="5953009">;</span>&nbsp;<span class="ident" id="5953011">x</span>&nbsp;<span class="op" id="5953013">&lt;</span>&nbsp;<span class="ident" id="5953015">width</span><span class="op" id="5953020">;</span>&nbsp;<span class="ident" id="5953022">x</span>&nbsp;<span class="op" id="5953024">+=</span>&nbsp;<span class="num" id="5953027">2</span>&nbsp;<span class="op" id="5953029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953035">b</span>&nbsp;<span class="op" id="5953037">:=</span>&nbsp;<span class="ident" id="5953040">cdat</span><span class="op" id="5953044">[</span><span class="ident" id="5953045">x</span><span class="op" id="5953046">/</span><span class="num" id="5953047">2</span><span class="op" id="5953048">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953054">for</span>&nbsp;<span class="ident" id="5953058">x2</span>&nbsp;<span class="op" id="5953061">:=</span>&nbsp;<span class="num" id="5953064">0</span><span class="op" id="5953065">;</span>&nbsp;<span class="ident" id="5953067">x2</span>&nbsp;<span class="op" id="5953070">&lt;</span>&nbsp;<span class="num" id="5953072">2</span>&nbsp;<span class="op" id="5953074">&amp;&amp;</span>&nbsp;<span class="ident" id="5953077">x</span><span class="op" id="5953078">+</span><span class="ident" id="5953079">x2</span>&nbsp;<span class="op" id="5953082">&lt;</span>&nbsp;<span class="ident" id="5953084">width</span><span class="op" id="5953089">;</span>&nbsp;<span class="ident" id="5953091">x2</span><span class="op" id="5953093">++</span>&nbsp;<span class="op" id="5953096">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953103">gray</span><span class="op" id="5953107">.</span><span class="ident" id="5953108">SetGray</span><span class="op" id="5953115">(</span><span class="ident" id="5953116">x</span><span class="op" id="5953117">+</span><span class="ident" id="5953118">x2</span><span class="op" id="5953120">,</span>&nbsp;<span class="ident" id="5953122">y</span><span class="op" id="5953123">,</span>&nbsp;<span class="ident" id="5953125">color</span><span class="op" id="5953130">.</span><span class="ident" id="5953131">Gray</span><span class="op" id="5953135">{</span><span class="op" id="5953136">(</span><span class="ident" id="5953137">b</span>&nbsp;<span class="op" id="5953139">&gt;&gt;</span>&nbsp;<span class="num" id="5953142">4</span><span class="op" id="5953143">)</span>&nbsp;<span class="op" id="5953145">*</span>&nbsp;<span class="num" id="5953147">0x11</span><span class="op" id="5953151">}</span><span class="op" id="5953152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953159">b</span>&nbsp;<span class="op" id="5953161">&lt;&lt;=</span>&nbsp;<span class="num" id="5953165">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953171">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953176">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953180">case</span>&nbsp;<span class="ident" id="5953185">cbG8</span><span class="op" id="5953189">:</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5953194">copy</span><span class="op" id="5953198">(</span><span class="ident" id="5953199">gray</span><span class="op" id="5953203">.</span><span class="ident" id="5953204">Pix</span><span class="op" id="5953207">[</span><span class="ident" id="5953208">pixOffset</span><span class="op" id="5953217">:</span><span class="op" id="5953218">]</span><span class="op" id="5953219">,</span>&nbsp;<span class="ident" id="5953221">cdat</span><span class="op" id="5953225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953230">pixOffset</span>&nbsp;<span class="op" id="5953240">+=</span>&nbsp;<span class="ident" id="5953243">gray</span><span class="op" id="5953247">.</span><span class="ident" id="5953248">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953257">case</span>&nbsp;<span class="ident" id="5953262">cbGA8</span><span class="op" id="5953267">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953272">for</span>&nbsp;<span class="ident" id="5953276">x</span>&nbsp;<span class="op" id="5953278">:=</span>&nbsp;<span class="num" id="5953281">0</span><span class="op" id="5953282">;</span>&nbsp;<span class="ident" id="5953284">x</span>&nbsp;<span class="op" id="5953286">&lt;</span>&nbsp;<span class="ident" id="5953288">width</span><span class="op" id="5953293">;</span>&nbsp;<span class="ident" id="5953295">x</span><span class="op" id="5953296">++</span>&nbsp;<span class="op" id="5953299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953305">ycol</span>&nbsp;<span class="op" id="5953310">:=</span>&nbsp;<span class="ident" id="5953313">cdat</span><span class="op" id="5953317">[</span><span class="num" id="5953318">2</span><span class="op" id="5953319">*</span><span class="ident" id="5953320">x</span><span class="op" id="5953321">+</span><span class="num" id="5953322">0</span><span class="op" id="5953323">]</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953329">nrgba</span><span class="op" id="5953334">.</span><span class="ident" id="5953335">SetNRGBA</span><span class="op" id="5953343">(</span><span class="ident" id="5953344">x</span><span class="op" id="5953345">,</span>&nbsp;<span class="ident" id="5953347">y</span><span class="op" id="5953348">,</span>&nbsp;<span class="ident" id="5953350">color</span><span class="op" id="5953355">.</span><span class="ident" id="5953356">NRGBA</span><span class="op" id="5953361">{</span><span class="ident" id="5953362">ycol</span><span class="op" id="5953366">,</span>&nbsp;<span class="ident" id="5953368">ycol</span><span class="op" id="5953372">,</span>&nbsp;<span class="ident" id="5953374">ycol</span><span class="op" id="5953378">,</span>&nbsp;<span class="ident" id="5953380">cdat</span><span class="op" id="5953384">[</span><span class="num" id="5953385">2</span><span class="op" id="5953386">*</span><span class="ident" id="5953387">x</span><span class="op" id="5953388">+</span><span class="num" id="5953389">1</span><span class="op" id="5953390">]</span><span class="op" id="5953391">}</span><span class="op" id="5953392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953401">case</span>&nbsp;<span class="ident" id="5953406">cbTC8</span><span class="op" id="5953411">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953416">pix</span><span class="op" id="5953419">,</span>&nbsp;<span class="ident" id="5953421">i</span><span class="op" id="5953422">,</span>&nbsp;<span class="ident" id="5953424">j</span>&nbsp;<span class="op" id="5953426">:=</span>&nbsp;<span class="ident" id="5953429">rgba</span><span class="op" id="5953433">.</span><span class="ident" id="5953434">Pix</span><span class="op" id="5953437">,</span>&nbsp;<span class="ident" id="5953439">pixOffset</span><span class="op" id="5953448">,</span>&nbsp;<span class="num" id="5953450">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953455">for</span>&nbsp;<span class="ident" id="5953459">x</span>&nbsp;<span class="op" id="5953461">:=</span>&nbsp;<span class="num" id="5953464">0</span><span class="op" id="5953465">;</span>&nbsp;<span class="ident" id="5953467">x</span>&nbsp;<span class="op" id="5953469">&lt;</span>&nbsp;<span class="ident" id="5953471">width</span><span class="op" id="5953476">;</span>&nbsp;<span class="ident" id="5953478">x</span><span class="op" id="5953479">++</span>&nbsp;<span class="op" id="5953482">{</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953488">pix</span><span class="op" id="5953491">[</span><span class="ident" id="5953492">i</span><span class="op" id="5953493">+</span><span class="num" id="5953494">0</span><span class="op" id="5953495">]</span>&nbsp;<span class="op" id="5953497">=</span>&nbsp;<span class="ident" id="5953499">cdat</span><span class="op" id="5953503">[</span><span class="ident" id="5953504">j</span><span class="op" id="5953505">+</span><span class="num" id="5953506">0</span><span class="op" id="5953507">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953513">pix</span><span class="op" id="5953516">[</span><span class="ident" id="5953517">i</span><span class="op" id="5953518">+</span><span class="num" id="5953519">1</span><span class="op" id="5953520">]</span>&nbsp;<span class="op" id="5953522">=</span>&nbsp;<span class="ident" id="5953524">cdat</span><span class="op" id="5953528">[</span><span class="ident" id="5953529">j</span><span class="op" id="5953530">+</span><span class="num" id="5953531">1</span><span class="op" id="5953532">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953538">pix</span><span class="op" id="5953541">[</span><span class="ident" id="5953542">i</span><span class="op" id="5953543">+</span><span class="num" id="5953544">2</span><span class="op" id="5953545">]</span>&nbsp;<span class="op" id="5953547">=</span>&nbsp;<span class="ident" id="5953549">cdat</span><span class="op" id="5953553">[</span><span class="ident" id="5953554">j</span><span class="op" id="5953555">+</span><span class="num" id="5953556">2</span><span class="op" id="5953557">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953563">pix</span><span class="op" id="5953566">[</span><span class="ident" id="5953567">i</span><span class="op" id="5953568">+</span><span class="num" id="5953569">3</span><span class="op" id="5953570">]</span>&nbsp;<span class="op" id="5953572">=</span>&nbsp;<span class="num" id="5953574">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953583">i</span>&nbsp;<span class="op" id="5953585">+=</span>&nbsp;<span class="num" id="5953588">4</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953594">j</span>&nbsp;<span class="op" id="5953596">+=</span>&nbsp;<span class="num" id="5953599">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953604">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953609">pixOffset</span>&nbsp;<span class="op" id="5953619">+=</span>&nbsp;<span class="ident" id="5953622">rgba</span><span class="op" id="5953626">.</span><span class="ident" id="5953627">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953636">case</span>&nbsp;<span class="ident" id="5953641">cbP1</span><span class="op" id="5953645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953650">for</span>&nbsp;<span class="ident" id="5953654">x</span>&nbsp;<span class="op" id="5953656">:=</span>&nbsp;<span class="num" id="5953659">0</span><span class="op" id="5953660">;</span>&nbsp;<span class="ident" id="5953662">x</span>&nbsp;<span class="op" id="5953664">&lt;</span>&nbsp;<span class="ident" id="5953666">width</span><span class="op" id="5953671">;</span>&nbsp;<span class="ident" id="5953673">x</span>&nbsp;<span class="op" id="5953675">+=</span>&nbsp;<span class="num" id="5953678">8</span>&nbsp;<span class="op" id="5953680">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953686">b</span>&nbsp;<span class="op" id="5953688">:=</span>&nbsp;<span class="ident" id="5953691">cdat</span><span class="op" id="5953695">[</span><span class="ident" id="5953696">x</span><span class="op" id="5953697">/</span><span class="num" id="5953698">8</span><span class="op" id="5953699">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953705">for</span>&nbsp;<span class="ident" id="5953709">x2</span>&nbsp;<span class="op" id="5953712">:=</span>&nbsp;<span class="num" id="5953715">0</span><span class="op" id="5953716">;</span>&nbsp;<span class="ident" id="5953718">x2</span>&nbsp;<span class="op" id="5953721">&lt;</span>&nbsp;<span class="num" id="5953723">8</span>&nbsp;<span class="op" id="5953725">&amp;&amp;</span>&nbsp;<span class="ident" id="5953728">x</span><span class="op" id="5953729">+</span><span class="ident" id="5953730">x2</span>&nbsp;<span class="op" id="5953733">&lt;</span>&nbsp;<span class="ident" id="5953735">width</span><span class="op" id="5953740">;</span>&nbsp;<span class="ident" id="5953742">x2</span><span class="op" id="5953744">++</span>&nbsp;<span class="op" id="5953747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953754">idx</span>&nbsp;<span class="op" id="5953758">:=</span>&nbsp;<span class="ident" id="5953761">b</span>&nbsp;<span class="op" id="5953763">&gt;&gt;</span>&nbsp;<span class="num" id="5953766">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953773">if</span>&nbsp;<span class="builtinfunc" id="5953776">len</span><span class="op" id="5953779">(</span><span class="ident" id="5953780">paletted</span><span class="op" id="5953788">.</span><span class="ident" id="5953789">Palette</span><span class="op" id="5953796">)</span>&nbsp;<span class="op" id="5953798">&lt;=</span>&nbsp;<span class="builtintype" id="5953801">int</span><span class="op" id="5953804">(</span><span class="ident" id="5953805">idx</span><span class="op" id="5953808">)</span>&nbsp;<span class="op" id="5953810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953818">paletted</span><span class="op" id="5953826">.</span><span class="ident" id="5953827">Palette</span>&nbsp;<span class="op" id="5953835">=</span>&nbsp;<span class="ident" id="5953837">paletted</span><span class="op" id="5953845">.</span><span class="ident" id="5953846">Palette</span><span class="op" id="5953853">[</span><span class="op" id="5953854">:</span><span class="builtintype" id="5953855">int</span><span class="op" id="5953858">(</span><span class="ident" id="5953859">idx</span><span class="op" id="5953862">)</span><span class="op" id="5953863">+</span><span class="num" id="5953864">1</span><span class="op" id="5953865">]</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953872">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953879">paletted</span><span class="op" id="5953887">.</span><span class="ident" id="5953888">SetColorIndex</span><span class="op" id="5953901">(</span><span class="ident" id="5953902">x</span><span class="op" id="5953903">+</span><span class="ident" id="5953904">x2</span><span class="op" id="5953906">,</span>&nbsp;<span class="ident" id="5953908">y</span><span class="op" id="5953909">,</span>&nbsp;<span class="ident" id="5953911">idx</span><span class="op" id="5953914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953921">b</span>&nbsp;<span class="op" id="5953923">&lt;&lt;=</span>&nbsp;<span class="num" id="5953927">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5953938">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953942">case</span>&nbsp;<span class="ident" id="5953947">cbP2</span><span class="op" id="5953951">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5953956">for</span>&nbsp;<span class="ident" id="5953960">x</span>&nbsp;<span class="op" id="5953962">:=</span>&nbsp;<span class="num" id="5953965">0</span><span class="op" id="5953966">;</span>&nbsp;<span class="ident" id="5953968">x</span>&nbsp;<span class="op" id="5953970">&lt;</span>&nbsp;<span class="ident" id="5953972">width</span><span class="op" id="5953977">;</span>&nbsp;<span class="ident" id="5953979">x</span>&nbsp;<span class="op" id="5953981">+=</span>&nbsp;<span class="num" id="5953984">4</span>&nbsp;<span class="op" id="5953986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5953992">b</span>&nbsp;<span class="op" id="5953994">:=</span>&nbsp;<span class="ident" id="5953997">cdat</span><span class="op" id="5954001">[</span><span class="ident" id="5954002">x</span><span class="op" id="5954003">/</span><span class="num" id="5954004">4</span><span class="op" id="5954005">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954011">for</span>&nbsp;<span class="ident" id="5954015">x2</span>&nbsp;<span class="op" id="5954018">:=</span>&nbsp;<span class="num" id="5954021">0</span><span class="op" id="5954022">;</span>&nbsp;<span class="ident" id="5954024">x2</span>&nbsp;<span class="op" id="5954027">&lt;</span>&nbsp;<span class="num" id="5954029">4</span>&nbsp;<span class="op" id="5954031">&amp;&amp;</span>&nbsp;<span class="ident" id="5954034">x</span><span class="op" id="5954035">+</span><span class="ident" id="5954036">x2</span>&nbsp;<span class="op" id="5954039">&lt;</span>&nbsp;<span class="ident" id="5954041">width</span><span class="op" id="5954046">;</span>&nbsp;<span class="ident" id="5954048">x2</span><span class="op" id="5954050">++</span>&nbsp;<span class="op" id="5954053">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954060">idx</span>&nbsp;<span class="op" id="5954064">:=</span>&nbsp;<span class="ident" id="5954067">b</span>&nbsp;<span class="op" id="5954069">&gt;&gt;</span>&nbsp;<span class="num" id="5954072">6</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954079">if</span>&nbsp;<span class="builtinfunc" id="5954082">len</span><span class="op" id="5954085">(</span><span class="ident" id="5954086">paletted</span><span class="op" id="5954094">.</span><span class="ident" id="5954095">Palette</span><span class="op" id="5954102">)</span>&nbsp;<span class="op" id="5954104">&lt;=</span>&nbsp;<span class="builtintype" id="5954107">int</span><span class="op" id="5954110">(</span><span class="ident" id="5954111">idx</span><span class="op" id="5954114">)</span>&nbsp;<span class="op" id="5954116">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954124">paletted</span><span class="op" id="5954132">.</span><span class="ident" id="5954133">Palette</span>&nbsp;<span class="op" id="5954141">=</span>&nbsp;<span class="ident" id="5954143">paletted</span><span class="op" id="5954151">.</span><span class="ident" id="5954152">Palette</span><span class="op" id="5954159">[</span><span class="op" id="5954160">:</span><span class="builtintype" id="5954161">int</span><span class="op" id="5954164">(</span><span class="ident" id="5954165">idx</span><span class="op" id="5954168">)</span><span class="op" id="5954169">+</span><span class="num" id="5954170">1</span><span class="op" id="5954171">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954185">paletted</span><span class="op" id="5954193">.</span><span class="ident" id="5954194">SetColorIndex</span><span class="op" id="5954207">(</span><span class="ident" id="5954208">x</span><span class="op" id="5954209">+</span><span class="ident" id="5954210">x2</span><span class="op" id="5954212">,</span>&nbsp;<span class="ident" id="5954214">y</span><span class="op" id="5954215">,</span>&nbsp;<span class="ident" id="5954217">idx</span><span class="op" id="5954220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954227">b</span>&nbsp;<span class="op" id="5954229">&lt;&lt;=</span>&nbsp;<span class="num" id="5954233">2</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954248">case</span>&nbsp;<span class="ident" id="5954253">cbP4</span><span class="op" id="5954257">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954262">for</span>&nbsp;<span class="ident" id="5954266">x</span>&nbsp;<span class="op" id="5954268">:=</span>&nbsp;<span class="num" id="5954271">0</span><span class="op" id="5954272">;</span>&nbsp;<span class="ident" id="5954274">x</span>&nbsp;<span class="op" id="5954276">&lt;</span>&nbsp;<span class="ident" id="5954278">width</span><span class="op" id="5954283">;</span>&nbsp;<span class="ident" id="5954285">x</span>&nbsp;<span class="op" id="5954287">+=</span>&nbsp;<span class="num" id="5954290">2</span>&nbsp;<span class="op" id="5954292">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954298">b</span>&nbsp;<span class="op" id="5954300">:=</span>&nbsp;<span class="ident" id="5954303">cdat</span><span class="op" id="5954307">[</span><span class="ident" id="5954308">x</span><span class="op" id="5954309">/</span><span class="num" id="5954310">2</span><span class="op" id="5954311">]</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954317">for</span>&nbsp;<span class="ident" id="5954321">x2</span>&nbsp;<span class="op" id="5954324">:=</span>&nbsp;<span class="num" id="5954327">0</span><span class="op" id="5954328">;</span>&nbsp;<span class="ident" id="5954330">x2</span>&nbsp;<span class="op" id="5954333">&lt;</span>&nbsp;<span class="num" id="5954335">2</span>&nbsp;<span class="op" id="5954337">&amp;&amp;</span>&nbsp;<span class="ident" id="5954340">x</span><span class="op" id="5954341">+</span><span class="ident" id="5954342">x2</span>&nbsp;<span class="op" id="5954345">&lt;</span>&nbsp;<span class="ident" id="5954347">width</span><span class="op" id="5954352">;</span>&nbsp;<span class="ident" id="5954354">x2</span><span class="op" id="5954356">++</span>&nbsp;<span class="op" id="5954359">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954366">idx</span>&nbsp;<span class="op" id="5954370">:=</span>&nbsp;<span class="ident" id="5954373">b</span>&nbsp;<span class="op" id="5954375">&gt;&gt;</span>&nbsp;<span class="num" id="5954378">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954385">if</span>&nbsp;<span class="builtinfunc" id="5954388">len</span><span class="op" id="5954391">(</span><span class="ident" id="5954392">paletted</span><span class="op" id="5954400">.</span><span class="ident" id="5954401">Palette</span><span class="op" id="5954408">)</span>&nbsp;<span class="op" id="5954410">&lt;=</span>&nbsp;<span class="builtintype" id="5954413">int</span><span class="op" id="5954416">(</span><span class="ident" id="5954417">idx</span><span class="op" id="5954420">)</span>&nbsp;<span class="op" id="5954422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954430">paletted</span><span class="op" id="5954438">.</span><span class="ident" id="5954439">Palette</span>&nbsp;<span class="op" id="5954447">=</span>&nbsp;<span class="ident" id="5954449">paletted</span><span class="op" id="5954457">.</span><span class="ident" id="5954458">Palette</span><span class="op" id="5954465">[</span><span class="op" id="5954466">:</span><span class="builtintype" id="5954467">int</span><span class="op" id="5954470">(</span><span class="ident" id="5954471">idx</span><span class="op" id="5954474">)</span><span class="op" id="5954475">+</span><span class="num" id="5954476">1</span><span class="op" id="5954477">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954484">}</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954491">paletted</span><span class="op" id="5954499">.</span><span class="ident" id="5954500">SetColorIndex</span><span class="op" id="5954513">(</span><span class="ident" id="5954514">x</span><span class="op" id="5954515">+</span><span class="ident" id="5954516">x2</span><span class="op" id="5954518">,</span>&nbsp;<span class="ident" id="5954520">y</span><span class="op" id="5954521">,</span>&nbsp;<span class="ident" id="5954523">idx</span><span class="op" id="5954526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954533">b</span>&nbsp;<span class="op" id="5954535">&lt;&lt;=</span>&nbsp;<span class="num" id="5954539">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954554">case</span>&nbsp;<span class="ident" id="5954559">cbP8</span><span class="op" id="5954563">:</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954568">if</span>&nbsp;<span class="builtinfunc" id="5954571">len</span><span class="op" id="5954574">(</span><span class="ident" id="5954575">paletted</span><span class="op" id="5954583">.</span><span class="ident" id="5954584">Palette</span><span class="op" id="5954591">)</span>&nbsp;<span class="op" id="5954593">!=</span>&nbsp;<span class="num" id="5954596">255</span>&nbsp;<span class="op" id="5954600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954606">for</span>&nbsp;<span class="ident" id="5954610">x</span>&nbsp;<span class="op" id="5954612">:=</span>&nbsp;<span class="num" id="5954615">0</span><span class="op" id="5954616">;</span>&nbsp;<span class="ident" id="5954618">x</span>&nbsp;<span class="op" id="5954620">&lt;</span>&nbsp;<span class="ident" id="5954622">width</span><span class="op" id="5954627">;</span>&nbsp;<span class="ident" id="5954629">x</span><span class="op" id="5954630">++</span>&nbsp;<span class="op" id="5954633">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954640">if</span>&nbsp;<span class="builtinfunc" id="5954643">len</span><span class="op" id="5954646">(</span><span class="ident" id="5954647">paletted</span><span class="op" id="5954655">.</span><span class="ident" id="5954656">Palette</span><span class="op" id="5954663">)</span>&nbsp;<span class="op" id="5954665">&lt;=</span>&nbsp;<span class="builtintype" id="5954668">int</span><span class="op" id="5954671">(</span><span class="ident" id="5954672">cdat</span><span class="op" id="5954676">[</span><span class="ident" id="5954677">x</span><span class="op" id="5954678">]</span><span class="op" id="5954679">)</span>&nbsp;<span class="op" id="5954681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954689">paletted</span><span class="op" id="5954697">.</span><span class="ident" id="5954698">Palette</span>&nbsp;<span class="op" id="5954706">=</span>&nbsp;<span class="ident" id="5954708">paletted</span><span class="op" id="5954716">.</span><span class="ident" id="5954717">Palette</span><span class="op" id="5954724">[</span><span class="op" id="5954725">:</span><span class="builtintype" id="5954726">int</span><span class="op" id="5954729">(</span><span class="ident" id="5954730">cdat</span><span class="op" id="5954734">[</span><span class="ident" id="5954735">x</span><span class="op" id="5954736">]</span><span class="op" id="5954737">)</span><span class="op" id="5954738">+</span><span class="num" id="5954739">1</span><span class="op" id="5954740">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954747">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5954758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5954763">copy</span><span class="op" id="5954767">(</span><span class="ident" id="5954768">paletted</span><span class="op" id="5954776">.</span><span class="ident" id="5954777">Pix</span><span class="op" id="5954780">[</span><span class="ident" id="5954781">pixOffset</span><span class="op" id="5954790">:</span><span class="op" id="5954791">]</span><span class="op" id="5954792">,</span>&nbsp;<span class="ident" id="5954794">cdat</span><span class="op" id="5954798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954803">pixOffset</span>&nbsp;<span class="op" id="5954813">+=</span>&nbsp;<span class="ident" id="5954816">paletted</span><span class="op" id="5954824">.</span><span class="ident" id="5954825">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954834">case</span>&nbsp;<span class="ident" id="5954839">cbTCA8</span><span class="op" id="5954845">:</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5954850">copy</span><span class="op" id="5954854">(</span><span class="ident" id="5954855">nrgba</span><span class="op" id="5954860">.</span><span class="ident" id="5954861">Pix</span><span class="op" id="5954864">[</span><span class="ident" id="5954865">pixOffset</span><span class="op" id="5954874">:</span><span class="op" id="5954875">]</span><span class="op" id="5954876">,</span>&nbsp;<span class="ident" id="5954878">cdat</span><span class="op" id="5954882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954887">pixOffset</span>&nbsp;<span class="op" id="5954897">+=</span>&nbsp;<span class="ident" id="5954900">nrgba</span><span class="op" id="5954905">.</span><span class="ident" id="5954906">Stride</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954915">case</span>&nbsp;<span class="ident" id="5954920">cbG16</span><span class="op" id="5954925">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5954930">for</span>&nbsp;<span class="ident" id="5954934">x</span>&nbsp;<span class="op" id="5954936">:=</span>&nbsp;<span class="num" id="5954939">0</span><span class="op" id="5954940">;</span>&nbsp;<span class="ident" id="5954942">x</span>&nbsp;<span class="op" id="5954944">&lt;</span>&nbsp;<span class="ident" id="5954946">width</span><span class="op" id="5954951">;</span>&nbsp;<span class="ident" id="5954953">x</span><span class="op" id="5954954">++</span>&nbsp;<span class="op" id="5954957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5954963">ycol</span>&nbsp;<span class="op" id="5954968">:=</span>&nbsp;<span class="builtintype" id="5954971">uint16</span><span class="op" id="5954977">(</span><span class="ident" id="5954978">cdat</span><span class="op" id="5954982">[</span><span class="num" id="5954983">2</span><span class="op" id="5954984">*</span><span class="ident" id="5954985">x</span><span class="op" id="5954986">+</span><span class="num" id="5954987">0</span><span class="op" id="5954988">]</span><span class="op" id="5954989">)</span><span class="op" id="5954990">&lt;&lt;</span><span class="num" id="5954992">8</span>&nbsp;<span class="op" id="5954994">|</span>&nbsp;<span class="builtintype" id="5954996">uint16</span><span class="op" id="5955002">(</span><span class="ident" id="5955003">cdat</span><span class="op" id="5955007">[</span><span class="num" id="5955008">2</span><span class="op" id="5955009">*</span><span class="ident" id="5955010">x</span><span class="op" id="5955011">+</span><span class="num" id="5955012">1</span><span class="op" id="5955013">]</span><span class="op" id="5955014">)</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955020">gray16</span><span class="op" id="5955026">.</span><span class="ident" id="5955027">SetGray16</span><span class="op" id="5955036">(</span><span class="ident" id="5955037">x</span><span class="op" id="5955038">,</span>&nbsp;<span class="ident" id="5955040">y</span><span class="op" id="5955041">,</span>&nbsp;<span class="ident" id="5955043">color</span><span class="op" id="5955048">.</span><span class="ident" id="5955049">Gray16</span><span class="op" id="5955055">{</span><span class="ident" id="5955056">ycol</span><span class="op" id="5955060">}</span><span class="op" id="5955061">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955070">case</span>&nbsp;<span class="ident" id="5955075">cbGA16</span><span class="op" id="5955081">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955086">for</span>&nbsp;<span class="ident" id="5955090">x</span>&nbsp;<span class="op" id="5955092">:=</span>&nbsp;<span class="num" id="5955095">0</span><span class="op" id="5955096">;</span>&nbsp;<span class="ident" id="5955098">x</span>&nbsp;<span class="op" id="5955100">&lt;</span>&nbsp;<span class="ident" id="5955102">width</span><span class="op" id="5955107">;</span>&nbsp;<span class="ident" id="5955109">x</span><span class="op" id="5955110">++</span>&nbsp;<span class="op" id="5955113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955119">ycol</span>&nbsp;<span class="op" id="5955124">:=</span>&nbsp;<span class="builtintype" id="5955127">uint16</span><span class="op" id="5955133">(</span><span class="ident" id="5955134">cdat</span><span class="op" id="5955138">[</span><span class="num" id="5955139">4</span><span class="op" id="5955140">*</span><span class="ident" id="5955141">x</span><span class="op" id="5955142">+</span><span class="num" id="5955143">0</span><span class="op" id="5955144">]</span><span class="op" id="5955145">)</span><span class="op" id="5955146">&lt;&lt;</span><span class="num" id="5955148">8</span>&nbsp;<span class="op" id="5955150">|</span>&nbsp;<span class="builtintype" id="5955152">uint16</span><span class="op" id="5955158">(</span><span class="ident" id="5955159">cdat</span><span class="op" id="5955163">[</span><span class="num" id="5955164">4</span><span class="op" id="5955165">*</span><span class="ident" id="5955166">x</span><span class="op" id="5955167">+</span><span class="num" id="5955168">1</span><span class="op" id="5955169">]</span><span class="op" id="5955170">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955176">acol</span>&nbsp;<span class="op" id="5955181">:=</span>&nbsp;<span class="builtintype" id="5955184">uint16</span><span class="op" id="5955190">(</span><span class="ident" id="5955191">cdat</span><span class="op" id="5955195">[</span><span class="num" id="5955196">4</span><span class="op" id="5955197">*</span><span class="ident" id="5955198">x</span><span class="op" id="5955199">+</span><span class="num" id="5955200">2</span><span class="op" id="5955201">]</span><span class="op" id="5955202">)</span><span class="op" id="5955203">&lt;&lt;</span><span class="num" id="5955205">8</span>&nbsp;<span class="op" id="5955207">|</span>&nbsp;<span class="builtintype" id="5955209">uint16</span><span class="op" id="5955215">(</span><span class="ident" id="5955216">cdat</span><span class="op" id="5955220">[</span><span class="num" id="5955221">4</span><span class="op" id="5955222">*</span><span class="ident" id="5955223">x</span><span class="op" id="5955224">+</span><span class="num" id="5955225">3</span><span class="op" id="5955226">]</span><span class="op" id="5955227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955233">nrgba64</span><span class="op" id="5955240">.</span><span class="ident" id="5955241">SetNRGBA64</span><span class="op" id="5955251">(</span><span class="ident" id="5955252">x</span><span class="op" id="5955253">,</span>&nbsp;<span class="ident" id="5955255">y</span><span class="op" id="5955256">,</span>&nbsp;<span class="ident" id="5955258">color</span><span class="op" id="5955263">.</span><span class="ident" id="5955264">NRGBA64</span><span class="op" id="5955271">{</span><span class="ident" id="5955272">ycol</span><span class="op" id="5955276">,</span>&nbsp;<span class="ident" id="5955278">ycol</span><span class="op" id="5955282">,</span>&nbsp;<span class="ident" id="5955284">ycol</span><span class="op" id="5955288">,</span>&nbsp;<span class="ident" id="5955290">acol</span><span class="op" id="5955294">}</span><span class="op" id="5955295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955304">case</span>&nbsp;<span class="ident" id="5955309">cbTC16</span><span class="op" id="5955315">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955320">for</span>&nbsp;<span class="ident" id="5955324">x</span>&nbsp;<span class="op" id="5955326">:=</span>&nbsp;<span class="num" id="5955329">0</span><span class="op" id="5955330">;</span>&nbsp;<span class="ident" id="5955332">x</span>&nbsp;<span class="op" id="5955334">&lt;</span>&nbsp;<span class="ident" id="5955336">width</span><span class="op" id="5955341">;</span>&nbsp;<span class="ident" id="5955343">x</span><span class="op" id="5955344">++</span>&nbsp;<span class="op" id="5955347">{</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955353">rcol</span>&nbsp;<span class="op" id="5955358">:=</span>&nbsp;<span class="builtintype" id="5955361">uint16</span><span class="op" id="5955367">(</span><span class="ident" id="5955368">cdat</span><span class="op" id="5955372">[</span><span class="num" id="5955373">6</span><span class="op" id="5955374">*</span><span class="ident" id="5955375">x</span><span class="op" id="5955376">+</span><span class="num" id="5955377">0</span><span class="op" id="5955378">]</span><span class="op" id="5955379">)</span><span class="op" id="5955380">&lt;&lt;</span><span class="num" id="5955382">8</span>&nbsp;<span class="op" id="5955384">|</span>&nbsp;<span class="builtintype" id="5955386">uint16</span><span class="op" id="5955392">(</span><span class="ident" id="5955393">cdat</span><span class="op" id="5955397">[</span><span class="num" id="5955398">6</span><span class="op" id="5955399">*</span><span class="ident" id="5955400">x</span><span class="op" id="5955401">+</span><span class="num" id="5955402">1</span><span class="op" id="5955403">]</span><span class="op" id="5955404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955410">gcol</span>&nbsp;<span class="op" id="5955415">:=</span>&nbsp;<span class="builtintype" id="5955418">uint16</span><span class="op" id="5955424">(</span><span class="ident" id="5955425">cdat</span><span class="op" id="5955429">[</span><span class="num" id="5955430">6</span><span class="op" id="5955431">*</span><span class="ident" id="5955432">x</span><span class="op" id="5955433">+</span><span class="num" id="5955434">2</span><span class="op" id="5955435">]</span><span class="op" id="5955436">)</span><span class="op" id="5955437">&lt;&lt;</span><span class="num" id="5955439">8</span>&nbsp;<span class="op" id="5955441">|</span>&nbsp;<span class="builtintype" id="5955443">uint16</span><span class="op" id="5955449">(</span><span class="ident" id="5955450">cdat</span><span class="op" id="5955454">[</span><span class="num" id="5955455">6</span><span class="op" id="5955456">*</span><span class="ident" id="5955457">x</span><span class="op" id="5955458">+</span><span class="num" id="5955459">3</span><span class="op" id="5955460">]</span><span class="op" id="5955461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955467">bcol</span>&nbsp;<span class="op" id="5955472">:=</span>&nbsp;<span class="builtintype" id="5955475">uint16</span><span class="op" id="5955481">(</span><span class="ident" id="5955482">cdat</span><span class="op" id="5955486">[</span><span class="num" id="5955487">6</span><span class="op" id="5955488">*</span><span class="ident" id="5955489">x</span><span class="op" id="5955490">+</span><span class="num" id="5955491">4</span><span class="op" id="5955492">]</span><span class="op" id="5955493">)</span><span class="op" id="5955494">&lt;&lt;</span><span class="num" id="5955496">8</span>&nbsp;<span class="op" id="5955498">|</span>&nbsp;<span class="builtintype" id="5955500">uint16</span><span class="op" id="5955506">(</span><span class="ident" id="5955507">cdat</span><span class="op" id="5955511">[</span><span class="num" id="5955512">6</span><span class="op" id="5955513">*</span><span class="ident" id="5955514">x</span><span class="op" id="5955515">+</span><span class="num" id="5955516">5</span><span class="op" id="5955517">]</span><span class="op" id="5955518">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955524">rgba64</span><span class="op" id="5955530">.</span><span class="ident" id="5955531">SetRGBA64</span><span class="op" id="5955540">(</span><span class="ident" id="5955541">x</span><span class="op" id="5955542">,</span>&nbsp;<span class="ident" id="5955544">y</span><span class="op" id="5955545">,</span>&nbsp;<span class="ident" id="5955547">color</span><span class="op" id="5955552">.</span><span class="ident" id="5955553">RGBA64</span><span class="op" id="5955559">{</span><span class="ident" id="5955560">rcol</span><span class="op" id="5955564">,</span>&nbsp;<span class="ident" id="5955566">gcol</span><span class="op" id="5955570">,</span>&nbsp;<span class="ident" id="5955572">bcol</span><span class="op" id="5955576">,</span>&nbsp;<span class="num" id="5955578">0xffff</span><span class="op" id="5955584">}</span><span class="op" id="5955585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955590">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955594">case</span>&nbsp;<span class="ident" id="5955599">cbTCA16</span><span class="op" id="5955606">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5955611">for</span>&nbsp;<span class="ident" id="5955615">x</span>&nbsp;<span class="op" id="5955617">:=</span>&nbsp;<span class="num" id="5955620">0</span><span class="op" id="5955621">;</span>&nbsp;<span class="ident" id="5955623">x</span>&nbsp;<span class="op" id="5955625">&lt;</span>&nbsp;<span class="ident" id="5955627">width</span><span class="op" id="5955632">;</span>&nbsp;<span class="ident" id="5955634">x</span><span class="op" id="5955635">++</span>&nbsp;<span class="op" id="5955638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955644">rcol</span>&nbsp;<span class="op" id="5955649">:=</span>&nbsp;<span class="builtintype" id="5955652">uint16</span><span class="op" id="5955658">(</span><span class="ident" id="5955659">cdat</span><span class="op" id="5955663">[</span><span class="num" id="5955664">8</span><span class="op" id="5955665">*</span><span class="ident" id="5955666">x</span><span class="op" id="5955667">+</span><span class="num" id="5955668">0</span><span class="op" id="5955669">]</span><span class="op" id="5955670">)</span><span class="op" id="5955671">&lt;&lt;</span><span class="num" id="5955673">8</span>&nbsp;<span class="op" id="5955675">|</span>&nbsp;<span class="builtintype" id="5955677">uint16</span><span class="op" id="5955683">(</span><span class="ident" id="5955684">cdat</span><span class="op" id="5955688">[</span><span class="num" id="5955689">8</span><span class="op" id="5955690">*</span><span class="ident" id="5955691">x</span><span class="op" id="5955692">+</span><span class="num" id="5955693">1</span><span class="op" id="5955694">]</span><span class="op" id="5955695">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955701">gcol</span>&nbsp;<span class="op" id="5955706">:=</span>&nbsp;<span class="builtintype" id="5955709">uint16</span><span class="op" id="5955715">(</span><span class="ident" id="5955716">cdat</span><span class="op" id="5955720">[</span><span class="num" id="5955721">8</span><span class="op" id="5955722">*</span><span class="ident" id="5955723">x</span><span class="op" id="5955724">+</span><span class="num" id="5955725">2</span><span class="op" id="5955726">]</span><span class="op" id="5955727">)</span><span class="op" id="5955728">&lt;&lt;</span><span class="num" id="5955730">8</span>&nbsp;<span class="op" id="5955732">|</span>&nbsp;<span class="builtintype" id="5955734">uint16</span><span class="op" id="5955740">(</span><span class="ident" id="5955741">cdat</span><span class="op" id="5955745">[</span><span class="num" id="5955746">8</span><span class="op" id="5955747">*</span><span class="ident" id="5955748">x</span><span class="op" id="5955749">+</span><span class="num" id="5955750">3</span><span class="op" id="5955751">]</span><span class="op" id="5955752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955758">bcol</span>&nbsp;<span class="op" id="5955763">:=</span>&nbsp;<span class="builtintype" id="5955766">uint16</span><span class="op" id="5955772">(</span><span class="ident" id="5955773">cdat</span><span class="op" id="5955777">[</span><span class="num" id="5955778">8</span><span class="op" id="5955779">*</span><span class="ident" id="5955780">x</span><span class="op" id="5955781">+</span><span class="num" id="5955782">4</span><span class="op" id="5955783">]</span><span class="op" id="5955784">)</span><span class="op" id="5955785">&lt;&lt;</span><span class="num" id="5955787">8</span>&nbsp;<span class="op" id="5955789">|</span>&nbsp;<span class="builtintype" id="5955791">uint16</span><span class="op" id="5955797">(</span><span class="ident" id="5955798">cdat</span><span class="op" id="5955802">[</span><span class="num" id="5955803">8</span><span class="op" id="5955804">*</span><span class="ident" id="5955805">x</span><span class="op" id="5955806">+</span><span class="num" id="5955807">5</span><span class="op" id="5955808">]</span><span class="op" id="5955809">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955815">acol</span>&nbsp;<span class="op" id="5955820">:=</span>&nbsp;<span class="builtintype" id="5955823">uint16</span><span class="op" id="5955829">(</span><span class="ident" id="5955830">cdat</span><span class="op" id="5955834">[</span><span class="num" id="5955835">8</span><span class="op" id="5955836">*</span><span class="ident" id="5955837">x</span><span class="op" id="5955838">+</span><span class="num" id="5955839">6</span><span class="op" id="5955840">]</span><span class="op" id="5955841">)</span><span class="op" id="5955842">&lt;&lt;</span><span class="num" id="5955844">8</span>&nbsp;<span class="op" id="5955846">|</span>&nbsp;<span class="builtintype" id="5955848">uint16</span><span class="op" id="5955854">(</span><span class="ident" id="5955855">cdat</span><span class="op" id="5955859">[</span><span class="num" id="5955860">8</span><span class="op" id="5955861">*</span><span class="ident" id="5955862">x</span><span class="op" id="5955863">+</span><span class="num" id="5955864">7</span><span class="op" id="5955865">]</span><span class="op" id="5955866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5955872">nrgba64</span><span class="op" id="5955879">.</span><span class="ident" id="5955880">SetNRGBA64</span><span class="op" id="5955890">(</span><span class="ident" id="5955891">x</span><span class="op" id="5955892">,</span>&nbsp;<span class="ident" id="5955894">y</span><span class="op" id="5955895">,</span>&nbsp;<span class="ident" id="5955897">color</span><span class="op" id="5955902">.</span><span class="ident" id="5955903">NRGBA64</span><span class="op" id="5955910">{</span><span class="ident" id="5955911">rcol</span><span class="op" id="5955915">,</span>&nbsp;<span class="ident" id="5955917">gcol</span><span class="op" id="5955921">,</span>&nbsp;<span class="ident" id="5955923">bcol</span><span class="op" id="5955927">,</span>&nbsp;<span class="ident" id="5955929">acol</span><span class="op" id="5955933">}</span><span class="op" id="5955934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5955943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5955948">//&nbsp;The&nbsp;current&nbsp;row&nbsp;for&nbsp;y&nbsp;is&nbsp;the&nbsp;previous&nbsp;row&nbsp;for&nbsp;y+1.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956004">pr</span><span class="op" id="5956006">,</span>&nbsp;<span class="ident" id="5956008">cr</span>&nbsp;<span class="op" id="5956011">=</span>&nbsp;<span class="ident" id="5956013">cr</span><span class="op" id="5956015">,</span>&nbsp;<span class="ident" id="5956017">pr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956025">return</span>&nbsp;<span class="ident" id="5956032">img</span><span class="op" id="5956035">,</span>&nbsp;<span class="builtintype" id="5956037">nil</span><br>
<span class="lineno">585</span><span class="op" id="5956041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5956044">//&nbsp;mergePassInto&nbsp;merges&nbsp;a&nbsp;single&nbsp;pass&nbsp;into&nbsp;a&nbsp;full&nbsp;sized&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5956107">func</span>&nbsp;<span class="op" id="5956112">(</span><span class="ident" id="5956113">d</span>&nbsp;<span class="op" id="5956115">*</span><span class="ident" id="5956116">decoder</span><span class="op" id="5956123">)</span>&nbsp;<span class="ident" id="5956125">mergePassInto</span><span class="op" id="5956138">(</span><span class="ident" id="5956139">dst</span>&nbsp;<span class="ident" id="5956143">image</span><span class="op" id="5956148">.</span><span class="ident" id="5956149">Image</span><span class="op" id="5956154">,</span>&nbsp;<span class="ident" id="5956156">src</span>&nbsp;<span class="ident" id="5956160">image</span><span class="op" id="5956165">.</span><span class="ident" id="5956166">Image</span><span class="op" id="5956171">,</span>&nbsp;<span class="ident" id="5956173">pass</span>&nbsp;<span class="builtintype" id="5956178">int</span><span class="op" id="5956181">)</span>&nbsp;<span class="op" id="5956183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956186">p</span>&nbsp;<span class="op" id="5956188">:=</span>&nbsp;<span class="ident" id="5956191">interlacing</span><span class="op" id="5956202">[</span><span class="ident" id="5956203">pass</span><span class="op" id="5956207">]</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956210">var</span>&nbsp;<span class="op" id="5956214">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956218">srcPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956232">[</span><span class="op" id="5956233">]</span><span class="builtintype" id="5956234">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956242">dstPix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956256">[</span><span class="op" id="5956257">]</span><span class="builtintype" id="5956258">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956266">stride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5956280">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956286">rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956300">image</span><span class="op" id="5956305">.</span><span class="ident" id="5956306">Rectangle</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956318">bytesPerPixel</span>&nbsp;<span class="builtintype" id="5956332">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5956337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956340">switch</span>&nbsp;<span class="ident" id="5956347">target</span>&nbsp;<span class="op" id="5956354">:=</span>&nbsp;<span class="ident" id="5956357">dst</span><span class="op" id="5956360">.</span><span class="op" id="5956361">(</span><span class="keyword" id="5956362">type</span><span class="op" id="5956366">)</span>&nbsp;<span class="op" id="5956368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956371">case</span>&nbsp;<span class="op" id="5956376">*</span><span class="ident" id="5956377">image</span><span class="op" id="5956382">.</span><span class="ident" id="5956383">Alpha</span><span class="op" id="5956388">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956392">srcPix</span>&nbsp;<span class="op" id="5956399">=</span>&nbsp;<span class="ident" id="5956401">src</span><span class="op" id="5956404">.</span><span class="op" id="5956405">(</span><span class="op" id="5956406">*</span><span class="ident" id="5956407">image</span><span class="op" id="5956412">.</span><span class="ident" id="5956413">Alpha</span><span class="op" id="5956418">)</span><span class="op" id="5956419">.</span><span class="ident" id="5956420">Pix</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956426">dstPix</span><span class="op" id="5956432">,</span>&nbsp;<span class="ident" id="5956434">stride</span><span class="op" id="5956440">,</span>&nbsp;<span class="ident" id="5956442">rect</span>&nbsp;<span class="op" id="5956447">=</span>&nbsp;<span class="ident" id="5956449">target</span><span class="op" id="5956455">.</span><span class="ident" id="5956456">Pix</span><span class="op" id="5956459">,</span>&nbsp;<span class="ident" id="5956461">target</span><span class="op" id="5956467">.</span><span class="ident" id="5956468">Stride</span><span class="op" id="5956474">,</span>&nbsp;<span class="ident" id="5956476">target</span><span class="op" id="5956482">.</span><span class="ident" id="5956483">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956490">bytesPerPixel</span>&nbsp;<span class="op" id="5956504">=</span>&nbsp;<span class="num" id="5956506">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956509">case</span>&nbsp;<span class="op" id="5956514">*</span><span class="ident" id="5956515">image</span><span class="op" id="5956520">.</span><span class="ident" id="5956521">Alpha16</span><span class="op" id="5956528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956532">srcPix</span>&nbsp;<span class="op" id="5956539">=</span>&nbsp;<span class="ident" id="5956541">src</span><span class="op" id="5956544">.</span><span class="op" id="5956545">(</span><span class="op" id="5956546">*</span><span class="ident" id="5956547">image</span><span class="op" id="5956552">.</span><span class="ident" id="5956553">Alpha16</span><span class="op" id="5956560">)</span><span class="op" id="5956561">.</span><span class="ident" id="5956562">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956568">dstPix</span><span class="op" id="5956574">,</span>&nbsp;<span class="ident" id="5956576">stride</span><span class="op" id="5956582">,</span>&nbsp;<span class="ident" id="5956584">rect</span>&nbsp;<span class="op" id="5956589">=</span>&nbsp;<span class="ident" id="5956591">target</span><span class="op" id="5956597">.</span><span class="ident" id="5956598">Pix</span><span class="op" id="5956601">,</span>&nbsp;<span class="ident" id="5956603">target</span><span class="op" id="5956609">.</span><span class="ident" id="5956610">Stride</span><span class="op" id="5956616">,</span>&nbsp;<span class="ident" id="5956618">target</span><span class="op" id="5956624">.</span><span class="ident" id="5956625">Rect</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956632">bytesPerPixel</span>&nbsp;<span class="op" id="5956646">=</span>&nbsp;<span class="num" id="5956648">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956651">case</span>&nbsp;<span class="op" id="5956656">*</span><span class="ident" id="5956657">image</span><span class="op" id="5956662">.</span><span class="ident" id="5956663">Gray</span><span class="op" id="5956667">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956671">srcPix</span>&nbsp;<span class="op" id="5956678">=</span>&nbsp;<span class="ident" id="5956680">src</span><span class="op" id="5956683">.</span><span class="op" id="5956684">(</span><span class="op" id="5956685">*</span><span class="ident" id="5956686">image</span><span class="op" id="5956691">.</span><span class="ident" id="5956692">Gray</span><span class="op" id="5956696">)</span><span class="op" id="5956697">.</span><span class="ident" id="5956698">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956704">dstPix</span><span class="op" id="5956710">,</span>&nbsp;<span class="ident" id="5956712">stride</span><span class="op" id="5956718">,</span>&nbsp;<span class="ident" id="5956720">rect</span>&nbsp;<span class="op" id="5956725">=</span>&nbsp;<span class="ident" id="5956727">target</span><span class="op" id="5956733">.</span><span class="ident" id="5956734">Pix</span><span class="op" id="5956737">,</span>&nbsp;<span class="ident" id="5956739">target</span><span class="op" id="5956745">.</span><span class="ident" id="5956746">Stride</span><span class="op" id="5956752">,</span>&nbsp;<span class="ident" id="5956754">target</span><span class="op" id="5956760">.</span><span class="ident" id="5956761">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956768">bytesPerPixel</span>&nbsp;<span class="op" id="5956782">=</span>&nbsp;<span class="num" id="5956784">1</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956787">case</span>&nbsp;<span class="op" id="5956792">*</span><span class="ident" id="5956793">image</span><span class="op" id="5956798">.</span><span class="ident" id="5956799">Gray16</span><span class="op" id="5956805">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956809">srcPix</span>&nbsp;<span class="op" id="5956816">=</span>&nbsp;<span class="ident" id="5956818">src</span><span class="op" id="5956821">.</span><span class="op" id="5956822">(</span><span class="op" id="5956823">*</span><span class="ident" id="5956824">image</span><span class="op" id="5956829">.</span><span class="ident" id="5956830">Gray16</span><span class="op" id="5956836">)</span><span class="op" id="5956837">.</span><span class="ident" id="5956838">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956844">dstPix</span><span class="op" id="5956850">,</span>&nbsp;<span class="ident" id="5956852">stride</span><span class="op" id="5956858">,</span>&nbsp;<span class="ident" id="5956860">rect</span>&nbsp;<span class="op" id="5956865">=</span>&nbsp;<span class="ident" id="5956867">target</span><span class="op" id="5956873">.</span><span class="ident" id="5956874">Pix</span><span class="op" id="5956877">,</span>&nbsp;<span class="ident" id="5956879">target</span><span class="op" id="5956885">.</span><span class="ident" id="5956886">Stride</span><span class="op" id="5956892">,</span>&nbsp;<span class="ident" id="5956894">target</span><span class="op" id="5956900">.</span><span class="ident" id="5956901">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956908">bytesPerPixel</span>&nbsp;<span class="op" id="5956922">=</span>&nbsp;<span class="num" id="5956924">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5956927">case</span>&nbsp;<span class="op" id="5956932">*</span><span class="ident" id="5956933">image</span><span class="op" id="5956938">.</span><span class="ident" id="5956939">NRGBA</span><span class="op" id="5956944">:</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956948">srcPix</span>&nbsp;<span class="op" id="5956955">=</span>&nbsp;<span class="ident" id="5956957">src</span><span class="op" id="5956960">.</span><span class="op" id="5956961">(</span><span class="op" id="5956962">*</span><span class="ident" id="5956963">image</span><span class="op" id="5956968">.</span><span class="ident" id="5956969">NRGBA</span><span class="op" id="5956974">)</span><span class="op" id="5956975">.</span><span class="ident" id="5956976">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5956982">dstPix</span><span class="op" id="5956988">,</span>&nbsp;<span class="ident" id="5956990">stride</span><span class="op" id="5956996">,</span>&nbsp;<span class="ident" id="5956998">rect</span>&nbsp;<span class="op" id="5957003">=</span>&nbsp;<span class="ident" id="5957005">target</span><span class="op" id="5957011">.</span><span class="ident" id="5957012">Pix</span><span class="op" id="5957015">,</span>&nbsp;<span class="ident" id="5957017">target</span><span class="op" id="5957023">.</span><span class="ident" id="5957024">Stride</span><span class="op" id="5957030">,</span>&nbsp;<span class="ident" id="5957032">target</span><span class="op" id="5957038">.</span><span class="ident" id="5957039">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957046">bytesPerPixel</span>&nbsp;<span class="op" id="5957060">=</span>&nbsp;<span class="num" id="5957062">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957065">case</span>&nbsp;<span class="op" id="5957070">*</span><span class="ident" id="5957071">image</span><span class="op" id="5957076">.</span><span class="ident" id="5957077">NRGBA64</span><span class="op" id="5957084">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957088">srcPix</span>&nbsp;<span class="op" id="5957095">=</span>&nbsp;<span class="ident" id="5957097">src</span><span class="op" id="5957100">.</span><span class="op" id="5957101">(</span><span class="op" id="5957102">*</span><span class="ident" id="5957103">image</span><span class="op" id="5957108">.</span><span class="ident" id="5957109">NRGBA64</span><span class="op" id="5957116">)</span><span class="op" id="5957117">.</span><span class="ident" id="5957118">Pix</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957124">dstPix</span><span class="op" id="5957130">,</span>&nbsp;<span class="ident" id="5957132">stride</span><span class="op" id="5957138">,</span>&nbsp;<span class="ident" id="5957140">rect</span>&nbsp;<span class="op" id="5957145">=</span>&nbsp;<span class="ident" id="5957147">target</span><span class="op" id="5957153">.</span><span class="ident" id="5957154">Pix</span><span class="op" id="5957157">,</span>&nbsp;<span class="ident" id="5957159">target</span><span class="op" id="5957165">.</span><span class="ident" id="5957166">Stride</span><span class="op" id="5957172">,</span>&nbsp;<span class="ident" id="5957174">target</span><span class="op" id="5957180">.</span><span class="ident" id="5957181">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957188">bytesPerPixel</span>&nbsp;<span class="op" id="5957202">=</span>&nbsp;<span class="num" id="5957204">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957207">case</span>&nbsp;<span class="op" id="5957212">*</span><span class="ident" id="5957213">image</span><span class="op" id="5957218">.</span><span class="ident" id="5957219">Paletted</span><span class="op" id="5957227">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957231">srcPix</span>&nbsp;<span class="op" id="5957238">=</span>&nbsp;<span class="ident" id="5957240">src</span><span class="op" id="5957243">.</span><span class="op" id="5957244">(</span><span class="op" id="5957245">*</span><span class="ident" id="5957246">image</span><span class="op" id="5957251">.</span><span class="ident" id="5957252">Paletted</span><span class="op" id="5957260">)</span><span class="op" id="5957261">.</span><span class="ident" id="5957262">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957268">dstPix</span><span class="op" id="5957274">,</span>&nbsp;<span class="ident" id="5957276">stride</span><span class="op" id="5957282">,</span>&nbsp;<span class="ident" id="5957284">rect</span>&nbsp;<span class="op" id="5957289">=</span>&nbsp;<span class="ident" id="5957291">target</span><span class="op" id="5957297">.</span><span class="ident" id="5957298">Pix</span><span class="op" id="5957301">,</span>&nbsp;<span class="ident" id="5957303">target</span><span class="op" id="5957309">.</span><span class="ident" id="5957310">Stride</span><span class="op" id="5957316">,</span>&nbsp;<span class="ident" id="5957318">target</span><span class="op" id="5957324">.</span><span class="ident" id="5957325">Rect</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957332">bytesPerPixel</span>&nbsp;<span class="op" id="5957346">=</span>&nbsp;<span class="num" id="5957348">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957351">case</span>&nbsp;<span class="op" id="5957356">*</span><span class="ident" id="5957357">image</span><span class="op" id="5957362">.</span><span class="ident" id="5957363">RGBA</span><span class="op" id="5957367">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957371">srcPix</span>&nbsp;<span class="op" id="5957378">=</span>&nbsp;<span class="ident" id="5957380">src</span><span class="op" id="5957383">.</span><span class="op" id="5957384">(</span><span class="op" id="5957385">*</span><span class="ident" id="5957386">image</span><span class="op" id="5957391">.</span><span class="ident" id="5957392">RGBA</span><span class="op" id="5957396">)</span><span class="op" id="5957397">.</span><span class="ident" id="5957398">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957404">dstPix</span><span class="op" id="5957410">,</span>&nbsp;<span class="ident" id="5957412">stride</span><span class="op" id="5957418">,</span>&nbsp;<span class="ident" id="5957420">rect</span>&nbsp;<span class="op" id="5957425">=</span>&nbsp;<span class="ident" id="5957427">target</span><span class="op" id="5957433">.</span><span class="ident" id="5957434">Pix</span><span class="op" id="5957437">,</span>&nbsp;<span class="ident" id="5957439">target</span><span class="op" id="5957445">.</span><span class="ident" id="5957446">Stride</span><span class="op" id="5957452">,</span>&nbsp;<span class="ident" id="5957454">target</span><span class="op" id="5957460">.</span><span class="ident" id="5957461">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957468">bytesPerPixel</span>&nbsp;<span class="op" id="5957482">=</span>&nbsp;<span class="num" id="5957484">4</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957487">case</span>&nbsp;<span class="op" id="5957492">*</span><span class="ident" id="5957493">image</span><span class="op" id="5957498">.</span><span class="ident" id="5957499">RGBA64</span><span class="op" id="5957505">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957509">srcPix</span>&nbsp;<span class="op" id="5957516">=</span>&nbsp;<span class="ident" id="5957518">src</span><span class="op" id="5957521">.</span><span class="op" id="5957522">(</span><span class="op" id="5957523">*</span><span class="ident" id="5957524">image</span><span class="op" id="5957529">.</span><span class="ident" id="5957530">RGBA64</span><span class="op" id="5957536">)</span><span class="op" id="5957537">.</span><span class="ident" id="5957538">Pix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957544">dstPix</span><span class="op" id="5957550">,</span>&nbsp;<span class="ident" id="5957552">stride</span><span class="op" id="5957558">,</span>&nbsp;<span class="ident" id="5957560">rect</span>&nbsp;<span class="op" id="5957565">=</span>&nbsp;<span class="ident" id="5957567">target</span><span class="op" id="5957573">.</span><span class="ident" id="5957574">Pix</span><span class="op" id="5957577">,</span>&nbsp;<span class="ident" id="5957579">target</span><span class="op" id="5957585">.</span><span class="ident" id="5957586">Stride</span><span class="op" id="5957592">,</span>&nbsp;<span class="ident" id="5957594">target</span><span class="op" id="5957600">.</span><span class="ident" id="5957601">Rect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957608">bytesPerPixel</span>&nbsp;<span class="op" id="5957622">=</span>&nbsp;<span class="num" id="5957624">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957627">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957630">s</span><span class="op" id="5957631">,</span>&nbsp;<span class="ident" id="5957633">bounds</span>&nbsp;<span class="op" id="5957640">:=</span>&nbsp;<span class="num" id="5957643">0</span><span class="op" id="5957644">,</span>&nbsp;<span class="ident" id="5957646">src</span><span class="op" id="5957649">.</span><span class="ident" id="5957650">Bounds</span><span class="op" id="5957656">(</span><span class="op" id="5957657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957660">for</span>&nbsp;<span class="ident" id="5957664">y</span>&nbsp;<span class="op" id="5957666">:=</span>&nbsp;<span class="ident" id="5957669">bounds</span><span class="op" id="5957675">.</span><span class="ident" id="5957676">Min</span><span class="op" id="5957679">.</span><span class="ident" id="5957680">Y</span><span class="op" id="5957681">;</span>&nbsp;<span class="ident" id="5957683">y</span>&nbsp;<span class="op" id="5957685">&lt;</span>&nbsp;<span class="ident" id="5957687">bounds</span><span class="op" id="5957693">.</span><span class="ident" id="5957694">Max</span><span class="op" id="5957697">.</span><span class="ident" id="5957698">Y</span><span class="op" id="5957699">;</span>&nbsp;<span class="ident" id="5957701">y</span><span class="op" id="5957702">++</span>&nbsp;<span class="op" id="5957705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957709">dBase</span>&nbsp;<span class="op" id="5957715">:=</span>&nbsp;<span class="op" id="5957718">(</span><span class="ident" id="5957719">y</span><span class="op" id="5957720">*</span><span class="ident" id="5957721">p</span><span class="op" id="5957722">.</span><span class="ident" id="5957723">yFactor</span><span class="op" id="5957730">+</span><span class="ident" id="5957731">p</span><span class="op" id="5957732">.</span><span class="ident" id="5957733">yOffset</span><span class="op" id="5957740">-</span><span class="ident" id="5957741">rect</span><span class="op" id="5957745">.</span><span class="ident" id="5957746">Min</span><span class="op" id="5957749">.</span><span class="ident" id="5957750">Y</span><span class="op" id="5957751">)</span><span class="op" id="5957752">*</span><span class="ident" id="5957753">stride</span>&nbsp;<span class="op" id="5957760">+</span>&nbsp;<span class="op" id="5957762">(</span><span class="ident" id="5957763">p</span><span class="op" id="5957764">.</span><span class="ident" id="5957765">xOffset</span><span class="op" id="5957772">-</span><span class="ident" id="5957773">rect</span><span class="op" id="5957777">.</span><span class="ident" id="5957778">Min</span><span class="op" id="5957781">.</span><span class="ident" id="5957782">X</span><span class="op" id="5957783">)</span><span class="op" id="5957784">*</span><span class="ident" id="5957785">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5957801">for</span>&nbsp;<span class="ident" id="5957805">x</span>&nbsp;<span class="op" id="5957807">:=</span>&nbsp;<span class="ident" id="5957810">bounds</span><span class="op" id="5957816">.</span><span class="ident" id="5957817">Min</span><span class="op" id="5957820">.</span><span class="ident" id="5957821">X</span><span class="op" id="5957822">;</span>&nbsp;<span class="ident" id="5957824">x</span>&nbsp;<span class="op" id="5957826">&lt;</span>&nbsp;<span class="ident" id="5957828">bounds</span><span class="op" id="5957834">.</span><span class="ident" id="5957835">Max</span><span class="op" id="5957838">.</span><span class="ident" id="5957839">X</span><span class="op" id="5957840">;</span>&nbsp;<span class="ident" id="5957842">x</span><span class="op" id="5957843">++</span>&nbsp;<span class="op" id="5957846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957851">d</span>&nbsp;<span class="op" id="5957853">:=</span>&nbsp;<span class="ident" id="5957856">dBase</span>&nbsp;<span class="op" id="5957862">+</span>&nbsp;<span class="ident" id="5957864">x</span><span class="op" id="5957865">*</span><span class="ident" id="5957866">p</span><span class="op" id="5957867">.</span><span class="ident" id="5957868">xFactor</span><span class="op" id="5957875">*</span><span class="ident" id="5957876">bytesPerPixel</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5957893">copy</span><span class="op" id="5957897">(</span><span class="ident" id="5957898">dstPix</span><span class="op" id="5957904">[</span><span class="ident" id="5957905">d</span><span class="op" id="5957906">:</span><span class="op" id="5957907">]</span><span class="op" id="5957908">,</span>&nbsp;<span class="ident" id="5957910">srcPix</span><span class="op" id="5957916">[</span><span class="ident" id="5957917">s</span><span class="op" id="5957918">:</span><span class="ident" id="5957919">s</span><span class="op" id="5957920">+</span><span class="ident" id="5957921">bytesPerPixel</span><span class="op" id="5957934">]</span><span class="op" id="5957935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5957940">s</span>&nbsp;<span class="op" id="5957942">+=</span>&nbsp;<span class="ident" id="5957945">bytesPerPixel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5957964">}</span><br>
<span class="lineno"></span><span class="op" id="5957966">}</span><br>
<span class="lineno">645</span><br>
<span class="lineno"></span><span class="keyword" id="5957969">func</span>&nbsp;<span class="op" id="5957974">(</span><span class="ident" id="5957975">d</span>&nbsp;<span class="op" id="5957977">*</span><span class="ident" id="5957978">decoder</span><span class="op" id="5957985">)</span>&nbsp;<span class="ident" id="5957987">parseIDAT</span><span class="op" id="5957996">(</span><span class="ident" id="5957997">length</span>&nbsp;<span class="builtintype" id="5958004">uint32</span><span class="op" id="5958010">)</span>&nbsp;<span class="op" id="5958012">(</span><span class="ident" id="5958013">err</span>&nbsp;<span class="builtintype" id="5958017">error</span><span class="op" id="5958022">)</span>&nbsp;<span class="op" id="5958024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958027">d</span><span class="op" id="5958028">.</span><span class="ident" id="5958029">idatLength</span>&nbsp;<span class="op" id="5958040">=</span>&nbsp;<span class="ident" id="5958042">length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958050">d</span><span class="op" id="5958051">.</span><span class="ident" id="5958052">img</span><span class="op" id="5958055">,</span>&nbsp;<span class="ident" id="5958057">err</span>&nbsp;<span class="op" id="5958061">=</span>&nbsp;<span class="ident" id="5958063">d</span><span class="op" id="5958064">.</span><span class="ident" id="5958065">decode</span><span class="op" id="5958071">(</span><span class="op" id="5958072">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958075">if</span>&nbsp;<span class="ident" id="5958078">err</span>&nbsp;<span class="op" id="5958082">!=</span>&nbsp;<span class="builtintype" id="5958085">nil</span>&nbsp;<span class="op" id="5958089">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958093">return</span>&nbsp;<span class="ident" id="5958100">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958108">return</span>&nbsp;<span class="ident" id="5958115">d</span><span class="op" id="5958116">.</span><span class="ident" id="5958117">verifyChecksum</span><span class="op" id="5958131">(</span><span class="op" id="5958132">)</span><br>
<span class="lineno"></span><span class="op" id="5958134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">655</span><span class="keyword" id="5958137">func</span>&nbsp;<span class="op" id="5958142">(</span><span class="ident" id="5958143">d</span>&nbsp;<span class="op" id="5958145">*</span><span class="ident" id="5958146">decoder</span><span class="op" id="5958153">)</span>&nbsp;<span class="ident" id="5958155">parseIEND</span><span class="op" id="5958164">(</span><span class="ident" id="5958165">length</span>&nbsp;<span class="builtintype" id="5958172">uint32</span><span class="op" id="5958178">)</span>&nbsp;<span class="builtintype" id="5958180">error</span>&nbsp;<span class="op" id="5958186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958189">if</span>&nbsp;<span class="ident" id="5958192">length</span>&nbsp;<span class="op" id="5958199">!=</span>&nbsp;<span class="num" id="5958202">0</span>&nbsp;<span class="op" id="5958204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958208">return</span>&nbsp;<span class="ident" id="5958215">FormatError</span><span class="op" id="5958226">(</span><span class="string" id="5958227">&#34;bad&nbsp;IEND&nbsp;length&#34;</span><span class="op" id="5958244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958250">return</span>&nbsp;<span class="ident" id="5958257">d</span><span class="op" id="5958258">.</span><span class="ident" id="5958259">verifyChecksum</span><span class="op" id="5958273">(</span><span class="op" id="5958274">)</span><br>
<span class="lineno">660</span><span class="op" id="5958276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5958279">func</span>&nbsp;<span class="op" id="5958284">(</span><span class="ident" id="5958285">d</span>&nbsp;<span class="op" id="5958287">*</span><span class="ident" id="5958288">decoder</span><span class="op" id="5958295">)</span>&nbsp;<span class="ident" id="5958297">parseChunk</span><span class="op" id="5958307">(</span><span class="op" id="5958308">)</span>&nbsp;<span class="builtintype" id="5958310">error</span>&nbsp;<span class="op" id="5958316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958319">//&nbsp;Read&nbsp;the&nbsp;length&nbsp;and&nbsp;chunk&nbsp;type.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958355">n</span><span class="op" id="5958356">,</span>&nbsp;<span class="ident" id="5958358">err</span>&nbsp;<span class="op" id="5958362">:=</span>&nbsp;<span class="ident" id="5958365">io</span><span class="op" id="5958367">.</span><span class="ident" id="5958368">ReadFull</span><span class="op" id="5958376">(</span><span class="ident" id="5958377">d</span><span class="op" id="5958378">.</span><span class="ident" id="5958379">r</span><span class="op" id="5958380">,</span>&nbsp;<span class="ident" id="5958382">d</span><span class="op" id="5958383">.</span><span class="ident" id="5958384">tmp</span><span class="op" id="5958387">[</span><span class="op" id="5958388">:</span><span class="num" id="5958389">8</span><span class="op" id="5958390">]</span><span class="op" id="5958391">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958394">if</span>&nbsp;<span class="ident" id="5958397">err</span>&nbsp;<span class="op" id="5958401">!=</span>&nbsp;<span class="builtintype" id="5958404">nil</span>&nbsp;<span class="op" id="5958408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958412">return</span>&nbsp;<span class="ident" id="5958419">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958427">length</span>&nbsp;<span class="op" id="5958434">:=</span>&nbsp;<span class="ident" id="5958437">binary</span><span class="op" id="5958443">.</span><span class="ident" id="5958444">BigEndian</span><span class="op" id="5958453">.</span><span class="ident" id="5958454">Uint32</span><span class="op" id="5958460">(</span><span class="ident" id="5958461">d</span><span class="op" id="5958462">.</span><span class="ident" id="5958463">tmp</span><span class="op" id="5958466">[</span><span class="op" id="5958467">:</span><span class="num" id="5958468">4</span><span class="op" id="5958469">]</span><span class="op" id="5958470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958473">d</span><span class="op" id="5958474">.</span><span class="ident" id="5958475">crc</span><span class="op" id="5958478">.</span><span class="ident" id="5958479">Reset</span><span class="op" id="5958484">(</span><span class="op" id="5958485">)</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958488">d</span><span class="op" id="5958489">.</span><span class="ident" id="5958490">crc</span><span class="op" id="5958493">.</span><span class="ident" id="5958494">Write</span><span class="op" id="5958499">(</span><span class="ident" id="5958500">d</span><span class="op" id="5958501">.</span><span class="ident" id="5958502">tmp</span><span class="op" id="5958505">[</span><span class="num" id="5958506">4</span><span class="op" id="5958507">:</span><span class="num" id="5958508">8</span><span class="op" id="5958509">]</span><span class="op" id="5958510">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5958514">//&nbsp;Read&nbsp;the&nbsp;chunk&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958539">switch</span>&nbsp;<span class="builtintype" id="5958546">string</span><span class="op" id="5958552">(</span><span class="ident" id="5958553">d</span><span class="op" id="5958554">.</span><span class="ident" id="5958555">tmp</span><span class="op" id="5958558">[</span><span class="num" id="5958559">4</span><span class="op" id="5958560">:</span><span class="num" id="5958561">8</span><span class="op" id="5958562">]</span><span class="op" id="5958563">)</span>&nbsp;<span class="op" id="5958565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958568">case</span>&nbsp;<span class="string" id="5958573">&#34;IHDR&#34;</span><span class="op" id="5958579">:</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958583">if</span>&nbsp;<span class="ident" id="5958586">d</span><span class="op" id="5958587">.</span><span class="ident" id="5958588">stage</span>&nbsp;<span class="op" id="5958594">!=</span>&nbsp;<span class="ident" id="5958597">dsStart</span>&nbsp;<span class="op" id="5958605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958610">return</span>&nbsp;<span class="ident" id="5958617">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958635">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958639">d</span><span class="op" id="5958640">.</span><span class="ident" id="5958641">stage</span>&nbsp;<span class="op" id="5958647">=</span>&nbsp;<span class="ident" id="5958649">dsSeenIHDR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958662">return</span>&nbsp;<span class="ident" id="5958669">d</span><span class="op" id="5958670">.</span><span class="ident" id="5958671">parseIHDR</span><span class="op" id="5958680">(</span><span class="ident" id="5958681">length</span><span class="op" id="5958687">)</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958690">case</span>&nbsp;<span class="string" id="5958695">&#34;PLTE&#34;</span><span class="op" id="5958701">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958705">if</span>&nbsp;<span class="ident" id="5958708">d</span><span class="op" id="5958709">.</span><span class="ident" id="5958710">stage</span>&nbsp;<span class="op" id="5958716">!=</span>&nbsp;<span class="ident" id="5958719">dsSeenIHDR</span>&nbsp;<span class="op" id="5958730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958735">return</span>&nbsp;<span class="ident" id="5958742">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5958764">d</span><span class="op" id="5958765">.</span><span class="ident" id="5958766">stage</span>&nbsp;<span class="op" id="5958772">=</span>&nbsp;<span class="ident" id="5958774">dsSeenPLTE</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958787">return</span>&nbsp;<span class="ident" id="5958794">d</span><span class="op" id="5958795">.</span><span class="ident" id="5958796">parsePLTE</span><span class="op" id="5958805">(</span><span class="ident" id="5958806">length</span><span class="op" id="5958812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958815">case</span>&nbsp;<span class="string" id="5958820">&#34;tRNS&#34;</span><span class="op" id="5958826">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958830">if</span>&nbsp;<span class="ident" id="5958833">d</span><span class="op" id="5958834">.</span><span class="ident" id="5958835">stage</span>&nbsp;<span class="op" id="5958841">!=</span>&nbsp;<span class="ident" id="5958844">dsSeenPLTE</span>&nbsp;<span class="op" id="5958855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958860">return</span>&nbsp;<span class="ident" id="5958867">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5958885">}</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958889">return</span>&nbsp;<span class="ident" id="5958896">d</span><span class="op" id="5958897">.</span><span class="ident" id="5958898">parsetRNS</span><span class="op" id="5958907">(</span><span class="ident" id="5958908">length</span><span class="op" id="5958914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958917">case</span>&nbsp;<span class="string" id="5958922">&#34;IDAT&#34;</span><span class="op" id="5958928">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5958932">if</span>&nbsp;<span class="ident" id="5958935">d</span><span class="op" id="5958936">.</span><span class="ident" id="5958937">stage</span>&nbsp;<span class="op" id="5958943">&lt;</span>&nbsp;<span class="ident" id="5958945">dsSeenIHDR</span>&nbsp;<span class="op" id="5958956">||</span>&nbsp;<span class="ident" id="5958959">d</span><span class="op" id="5958960">.</span><span class="ident" id="5958961">stage</span>&nbsp;<span class="op" id="5958967">&gt;</span>&nbsp;<span class="ident" id="5958969">dsSeenIDAT</span>&nbsp;<span class="op" id="5958980">||</span>&nbsp;<span class="op" id="5958983">(</span><span class="ident" id="5958984">d</span><span class="op" id="5958985">.</span><span class="ident" id="5958986">cb</span>&nbsp;<span class="op" id="5958989">==</span>&nbsp;<span class="ident" id="5958992">cbP8</span>&nbsp;<span class="op" id="5958997">&amp;&amp;</span>&nbsp;<span class="ident" id="5959000">d</span><span class="op" id="5959001">.</span><span class="ident" id="5959002">stage</span>&nbsp;<span class="op" id="5959008">==</span>&nbsp;<span class="ident" id="5959011">dsSeenIHDR</span><span class="op" id="5959021">)</span>&nbsp;<span class="op" id="5959023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959028">return</span>&nbsp;<span class="ident" id="5959035">chunkOrderError</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959053">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959057">d</span><span class="op" id="5959058">.</span><span class="ident" id="5959059">stage</span>&nbsp;<span class="op" id="5959065">=</span>&nbsp;<span class="ident" id="5959067">dsSeenIDAT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959080">return</span>&nbsp;<span class="ident" id="5959087">d</span><span class="op" id="5959088">.</span><span class="ident" id="5959089">parseIDAT</span><span class="op" id="5959098">(</span><span class="ident" id="5959099">length</span><span class="op" id="5959105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959108">case</span>&nbsp;<span class="string" id="5959113">&#34;IEND&#34;</span><span class="op" id="5959119">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959123">if</span>&nbsp;<span class="ident" id="5959126">d</span><span class="op" id="5959127">.</span><span class="ident" id="5959128">stage</span>&nbsp;<span class="op" id="5959134">!=</span>&nbsp;<span class="ident" id="5959137">dsSeenIDAT</span>&nbsp;<span class="op" id="5959148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959153">return</span>&nbsp;<span class="ident" id="5959160">chunkOrderError</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959182">d</span><span class="op" id="5959183">.</span><span class="ident" id="5959184">stage</span>&nbsp;<span class="op" id="5959190">=</span>&nbsp;<span class="ident" id="5959192">dsSeenIEND</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959205">return</span>&nbsp;<span class="ident" id="5959212">d</span><span class="op" id="5959213">.</span><span class="ident" id="5959214">parseIEND</span><span class="op" id="5959223">(</span><span class="ident" id="5959224">length</span><span class="op" id="5959230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959233">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5959236">//&nbsp;Ignore&nbsp;this&nbsp;chunk&nbsp;(of&nbsp;a&nbsp;known&nbsp;length).</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959279">var</span>&nbsp;<span class="ident" id="5959283">ignored</span>&nbsp;<span class="op" id="5959291">[</span><span class="num" id="5959292">4096</span><span class="op" id="5959296">]</span><span class="builtintype" id="5959297">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959303">for</span>&nbsp;<span class="ident" id="5959307">length</span>&nbsp;<span class="op" id="5959314">&gt;</span>&nbsp;<span class="num" id="5959316">0</span>&nbsp;<span class="op" id="5959318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959322">n</span><span class="op" id="5959323">,</span>&nbsp;<span class="ident" id="5959325">err</span>&nbsp;<span class="op" id="5959329">=</span>&nbsp;<span class="ident" id="5959331">io</span><span class="op" id="5959333">.</span><span class="ident" id="5959334">ReadFull</span><span class="op" id="5959342">(</span><span class="ident" id="5959343">d</span><span class="op" id="5959344">.</span><span class="ident" id="5959345">r</span><span class="op" id="5959346">,</span>&nbsp;<span class="ident" id="5959348">ignored</span><span class="op" id="5959355">[</span><span class="op" id="5959356">:</span><span class="ident" id="5959357">min</span><span class="op" id="5959360">(</span><span class="builtinfunc" id="5959361">len</span><span class="op" id="5959364">(</span><span class="ident" id="5959365">ignored</span><span class="op" id="5959372">)</span><span class="op" id="5959373">,</span>&nbsp;<span class="builtintype" id="5959375">int</span><span class="op" id="5959378">(</span><span class="ident" id="5959379">length</span><span class="op" id="5959385">)</span><span class="op" id="5959386">)</span><span class="op" id="5959387">]</span><span class="op" id="5959388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959392">if</span>&nbsp;<span class="ident" id="5959395">err</span>&nbsp;<span class="op" id="5959399">!=</span>&nbsp;<span class="builtintype" id="5959402">nil</span>&nbsp;<span class="op" id="5959406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959411">return</span>&nbsp;<span class="ident" id="5959418">err</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959428">d</span><span class="op" id="5959429">.</span><span class="ident" id="5959430">crc</span><span class="op" id="5959433">.</span><span class="ident" id="5959434">Write</span><span class="op" id="5959439">(</span><span class="ident" id="5959440">ignored</span><span class="op" id="5959447">[</span><span class="op" id="5959448">:</span><span class="ident" id="5959449">n</span><span class="op" id="5959450">]</span><span class="op" id="5959451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959455">length</span>&nbsp;<span class="op" id="5959462">-=</span>&nbsp;<span class="builtintype" id="5959465">uint32</span><span class="op" id="5959471">(</span><span class="ident" id="5959472">n</span><span class="op" id="5959473">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959476">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959479">return</span>&nbsp;<span class="ident" id="5959486">d</span><span class="op" id="5959487">.</span><span class="ident" id="5959488">verifyChecksum</span><span class="op" id="5959502">(</span><span class="op" id="5959503">)</span><br>
<span class="lineno">715</span><span class="op" id="5959505">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959508">func</span>&nbsp;<span class="op" id="5959513">(</span><span class="ident" id="5959514">d</span>&nbsp;<span class="op" id="5959516">*</span><span class="ident" id="5959517">decoder</span><span class="op" id="5959524">)</span>&nbsp;<span class="ident" id="5959526">verifyChecksum</span><span class="op" id="5959540">(</span><span class="op" id="5959541">)</span>&nbsp;<span class="builtintype" id="5959543">error</span>&nbsp;<span class="op" id="5959549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959552">if</span>&nbsp;<span class="ident" id="5959555">_</span><span class="op" id="5959556">,</span>&nbsp;<span class="ident" id="5959558">err</span>&nbsp;<span class="op" id="5959562">:=</span>&nbsp;<span class="ident" id="5959565">io</span><span class="op" id="5959567">.</span><span class="ident" id="5959568">ReadFull</span><span class="op" id="5959576">(</span><span class="ident" id="5959577">d</span><span class="op" id="5959578">.</span><span class="ident" id="5959579">r</span><span class="op" id="5959580">,</span>&nbsp;<span class="ident" id="5959582">d</span><span class="op" id="5959583">.</span><span class="ident" id="5959584">tmp</span><span class="op" id="5959587">[</span><span class="op" id="5959588">:</span><span class="num" id="5959589">4</span><span class="op" id="5959590">]</span><span class="op" id="5959591">)</span><span class="op" id="5959592">;</span>&nbsp;<span class="ident" id="5959594">err</span>&nbsp;<span class="op" id="5959598">!=</span>&nbsp;<span class="builtintype" id="5959601">nil</span>&nbsp;<span class="op" id="5959605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959609">return</span>&nbsp;<span class="ident" id="5959616">err</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959621">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959624">if</span>&nbsp;<span class="ident" id="5959627">binary</span><span class="op" id="5959633">.</span><span class="ident" id="5959634">BigEndian</span><span class="op" id="5959643">.</span><span class="ident" id="5959644">Uint32</span><span class="op" id="5959650">(</span><span class="ident" id="5959651">d</span><span class="op" id="5959652">.</span><span class="ident" id="5959653">tmp</span><span class="op" id="5959656">[</span><span class="op" id="5959657">:</span><span class="num" id="5959658">4</span><span class="op" id="5959659">]</span><span class="op" id="5959660">)</span>&nbsp;<span class="op" id="5959662">!=</span>&nbsp;<span class="ident" id="5959665">d</span><span class="op" id="5959666">.</span><span class="ident" id="5959667">crc</span><span class="op" id="5959670">.</span><span class="ident" id="5959671">Sum32</span><span class="op" id="5959676">(</span><span class="op" id="5959677">)</span>&nbsp;<span class="op" id="5959679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959683">return</span>&nbsp;<span class="ident" id="5959690">FormatError</span><span class="op" id="5959701">(</span><span class="string" id="5959702">&#34;invalid&nbsp;checksum&#34;</span><span class="op" id="5959720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959723">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959726">return</span>&nbsp;<span class="builtintype" id="5959733">nil</span><br>
<span class="lineno">725</span><span class="op" id="5959737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5959740">func</span>&nbsp;<span class="op" id="5959745">(</span><span class="ident" id="5959746">d</span>&nbsp;<span class="op" id="5959748">*</span><span class="ident" id="5959749">decoder</span><span class="op" id="5959756">)</span>&nbsp;<span class="ident" id="5959758">checkHeader</span><span class="op" id="5959769">(</span><span class="op" id="5959770">)</span>&nbsp;<span class="builtintype" id="5959772">error</span>&nbsp;<span class="op" id="5959778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5959781">_</span><span class="op" id="5959782">,</span>&nbsp;<span class="ident" id="5959784">err</span>&nbsp;<span class="op" id="5959788">:=</span>&nbsp;<span class="ident" id="5959791">io</span><span class="op" id="5959793">.</span><span class="ident" id="5959794">ReadFull</span><span class="op" id="5959802">(</span><span class="ident" id="5959803">d</span><span class="op" id="5959804">.</span><span class="ident" id="5959805">r</span><span class="op" id="5959806">,</span>&nbsp;<span class="ident" id="5959808">d</span><span class="op" id="5959809">.</span><span class="ident" id="5959810">tmp</span><span class="op" id="5959813">[</span><span class="op" id="5959814">:</span><span class="builtinfunc" id="5959815">len</span><span class="op" id="5959818">(</span><span class="ident" id="5959819">pngHeader</span><span class="op" id="5959828">)</span><span class="op" id="5959829">]</span><span class="op" id="5959830">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959833">if</span>&nbsp;<span class="ident" id="5959836">err</span>&nbsp;<span class="op" id="5959840">!=</span>&nbsp;<span class="builtintype" id="5959843">nil</span>&nbsp;<span class="op" id="5959847">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959851">return</span>&nbsp;<span class="ident" id="5959858">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959866">if</span>&nbsp;<span class="builtintype" id="5959869">string</span><span class="op" id="5959875">(</span><span class="ident" id="5959876">d</span><span class="op" id="5959877">.</span><span class="ident" id="5959878">tmp</span><span class="op" id="5959881">[</span><span class="op" id="5959882">:</span><span class="builtinfunc" id="5959883">len</span><span class="op" id="5959886">(</span><span class="ident" id="5959887">pngHeader</span><span class="op" id="5959896">)</span><span class="op" id="5959897">]</span><span class="op" id="5959898">)</span>&nbsp;<span class="op" id="5959900">!=</span>&nbsp;<span class="ident" id="5959903">pngHeader</span>&nbsp;<span class="op" id="5959913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959917">return</span>&nbsp;<span class="ident" id="5959924">FormatError</span><span class="op" id="5959935">(</span><span class="string" id="5959936">&#34;not&nbsp;a&nbsp;PNG&nbsp;file&#34;</span><span class="op" id="5959952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5959955">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5959958">return</span>&nbsp;<span class="builtintype" id="5959965">nil</span><br>
<span class="lineno"></span><span class="op" id="5959969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5959972">//&nbsp;Decode&nbsp;reads&nbsp;a&nbsp;PNG&nbsp;image&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;it&nbsp;as&nbsp;an&nbsp;image.Image.</span><br>
<span class="lineno"></span><span class="comment" id="5960041">//&nbsp;The&nbsp;type&nbsp;of&nbsp;Image&nbsp;returned&nbsp;depends&nbsp;on&nbsp;the&nbsp;PNG&nbsp;contents.</span><br>
<span class="lineno">740</span><span class="keyword" id="5960100">func</span>&nbsp;<span class="ident" id="5960105">Decode</span><span class="op" id="5960111">(</span><span class="ident" id="5960112">r</span>&nbsp;<span class="ident" id="5960114">io</span><span class="op" id="5960116">.</span><span class="ident" id="5960117">Reader</span><span class="op" id="5960123">)</span>&nbsp;<span class="op" id="5960125">(</span><span class="ident" id="5960126">image</span><span class="op" id="5960131">.</span><span class="ident" id="5960132">Image</span><span class="op" id="5960137">,</span>&nbsp;<span class="builtintype" id="5960139">error</span><span class="op" id="5960144">)</span>&nbsp;<span class="op" id="5960146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960149">d</span>&nbsp;<span class="op" id="5960151">:=</span>&nbsp;<span class="op" id="5960154">&amp;</span><span class="ident" id="5960155">decoder</span><span class="op" id="5960162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960166">r</span><span class="op" id="5960167">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5960171">r</span><span class="op" id="5960172">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960176">crc</span><span class="op" id="5960179">:</span>&nbsp;<span class="ident" id="5960181">crc32</span><span class="op" id="5960186">.</span><span class="ident" id="5960187">NewIEEE</span><span class="op" id="5960194">(</span><span class="op" id="5960195">)</span><span class="op" id="5960196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960199">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960202">if</span>&nbsp;<span class="ident" id="5960205">err</span>&nbsp;<span class="op" id="5960209">:=</span>&nbsp;<span class="ident" id="5960212">d</span><span class="op" id="5960213">.</span><span class="ident" id="5960214">checkHeader</span><span class="op" id="5960225">(</span><span class="op" id="5960226">)</span><span class="op" id="5960227">;</span>&nbsp;<span class="ident" id="5960229">err</span>&nbsp;<span class="op" id="5960233">!=</span>&nbsp;<span class="builtintype" id="5960236">nil</span>&nbsp;<span class="op" id="5960240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960244">if</span>&nbsp;<span class="ident" id="5960247">err</span>&nbsp;<span class="op" id="5960251">==</span>&nbsp;<span class="ident" id="5960254">io</span><span class="op" id="5960256">.</span><span class="ident" id="5960257">EOF</span>&nbsp;<span class="op" id="5960261">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960266">err</span>&nbsp;<span class="op" id="5960270">=</span>&nbsp;<span class="ident" id="5960272">io</span><span class="op" id="5960274">.</span><span class="ident" id="5960275">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960294">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960298">return</span>&nbsp;<span class="builtintype" id="5960305">nil</span><span class="op" id="5960308">,</span>&nbsp;<span class="ident" id="5960310">err</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960315">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960318">for</span>&nbsp;<span class="ident" id="5960322">d</span><span class="op" id="5960323">.</span><span class="ident" id="5960324">stage</span>&nbsp;<span class="op" id="5960330">!=</span>&nbsp;<span class="ident" id="5960333">dsSeenIEND</span>&nbsp;<span class="op" id="5960344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960348">if</span>&nbsp;<span class="ident" id="5960351">err</span>&nbsp;<span class="op" id="5960355">:=</span>&nbsp;<span class="ident" id="5960358">d</span><span class="op" id="5960359">.</span><span class="ident" id="5960360">parseChunk</span><span class="op" id="5960370">(</span><span class="op" id="5960371">)</span><span class="op" id="5960372">;</span>&nbsp;<span class="ident" id="5960374">err</span>&nbsp;<span class="op" id="5960378">!=</span>&nbsp;<span class="builtintype" id="5960381">nil</span>&nbsp;<span class="op" id="5960385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960390">if</span>&nbsp;<span class="ident" id="5960393">err</span>&nbsp;<span class="op" id="5960397">==</span>&nbsp;<span class="ident" id="5960400">io</span><span class="op" id="5960402">.</span><span class="ident" id="5960403">EOF</span>&nbsp;<span class="op" id="5960407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960413">err</span>&nbsp;<span class="op" id="5960417">=</span>&nbsp;<span class="ident" id="5960419">io</span><span class="op" id="5960421">.</span><span class="ident" id="5960422">ErrUnexpectedEOF</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960447">return</span>&nbsp;<span class="builtintype" id="5960454">nil</span><span class="op" id="5960457">,</span>&nbsp;<span class="ident" id="5960459">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960465">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960471">return</span>&nbsp;<span class="ident" id="5960478">d</span><span class="op" id="5960479">.</span><span class="ident" id="5960480">img</span><span class="op" id="5960483">,</span>&nbsp;<span class="builtintype" id="5960485">nil</span><br>
<span class="lineno">760</span><span class="op" id="5960489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5960492">//&nbsp;DecodeConfig&nbsp;returns&nbsp;the&nbsp;color&nbsp;model&nbsp;and&nbsp;dimensions&nbsp;of&nbsp;a&nbsp;PNG&nbsp;image&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="5960570">//&nbsp;decoding&nbsp;the&nbsp;entire&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5960600">func</span>&nbsp;<span class="ident" id="5960605">DecodeConfig</span><span class="op" id="5960617">(</span><span class="ident" id="5960618">r</span>&nbsp;<span class="ident" id="5960620">io</span><span class="op" id="5960622">.</span><span class="ident" id="5960623">Reader</span><span class="op" id="5960629">)</span>&nbsp;<span class="op" id="5960631">(</span><span class="ident" id="5960632">image</span><span class="op" id="5960637">.</span><span class="ident" id="5960638">Config</span><span class="op" id="5960644">,</span>&nbsp;<span class="builtintype" id="5960646">error</span><span class="op" id="5960651">)</span>&nbsp;<span class="op" id="5960653">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960656">d</span>&nbsp;<span class="op" id="5960658">:=</span>&nbsp;<span class="op" id="5960661">&amp;</span><span class="ident" id="5960662">decoder</span><span class="op" id="5960669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960673">r</span><span class="op" id="5960674">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5960678">r</span><span class="op" id="5960679">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960683">crc</span><span class="op" id="5960686">:</span>&nbsp;<span class="ident" id="5960688">crc32</span><span class="op" id="5960693">.</span><span class="ident" id="5960694">NewIEEE</span><span class="op" id="5960701">(</span><span class="op" id="5960702">)</span><span class="op" id="5960703">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960709">if</span>&nbsp;<span class="ident" id="5960712">err</span>&nbsp;<span class="op" id="5960716">:=</span>&nbsp;<span class="ident" id="5960719">d</span><span class="op" id="5960720">.</span><span class="ident" id="5960721">checkHeader</span><span class="op" id="5960732">(</span><span class="op" id="5960733">)</span><span class="op" id="5960734">;</span>&nbsp;<span class="ident" id="5960736">err</span>&nbsp;<span class="op" id="5960740">!=</span>&nbsp;<span class="builtintype" id="5960743">nil</span>&nbsp;<span class="op" id="5960747">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960751">if</span>&nbsp;<span class="ident" id="5960754">err</span>&nbsp;<span class="op" id="5960758">==</span>&nbsp;<span class="ident" id="5960761">io</span><span class="op" id="5960763">.</span><span class="ident" id="5960764">EOF</span>&nbsp;<span class="op" id="5960768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960773">err</span>&nbsp;<span class="op" id="5960777">=</span>&nbsp;<span class="ident" id="5960779">io</span><span class="op" id="5960781">.</span><span class="ident" id="5960782">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960805">return</span>&nbsp;<span class="ident" id="5960812">image</span><span class="op" id="5960817">.</span><span class="ident" id="5960818">Config</span><span class="op" id="5960824">{</span><span class="op" id="5960825">}</span><span class="op" id="5960826">,</span>&nbsp;<span class="ident" id="5960828">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960833">}</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960836">for</span>&nbsp;<span class="op" id="5960840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960844">if</span>&nbsp;<span class="ident" id="5960847">err</span>&nbsp;<span class="op" id="5960851">:=</span>&nbsp;<span class="ident" id="5960854">d</span><span class="op" id="5960855">.</span><span class="ident" id="5960856">parseChunk</span><span class="op" id="5960866">(</span><span class="op" id="5960867">)</span><span class="op" id="5960868">;</span>&nbsp;<span class="ident" id="5960870">err</span>&nbsp;<span class="op" id="5960874">!=</span>&nbsp;<span class="builtintype" id="5960877">nil</span>&nbsp;<span class="op" id="5960881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960886">if</span>&nbsp;<span class="ident" id="5960889">err</span>&nbsp;<span class="op" id="5960893">==</span>&nbsp;<span class="ident" id="5960896">io</span><span class="op" id="5960898">.</span><span class="ident" id="5960899">EOF</span>&nbsp;<span class="op" id="5960903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960909">err</span>&nbsp;<span class="op" id="5960913">=</span>&nbsp;<span class="ident" id="5960915">io</span><span class="op" id="5960917">.</span><span class="ident" id="5960918">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960938">}</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5960943">return</span>&nbsp;<span class="ident" id="5960950">image</span><span class="op" id="5960955">.</span><span class="ident" id="5960956">Config</span><span class="op" id="5960962">{</span><span class="op" id="5960963">}</span><span class="op" id="5960964">,</span>&nbsp;<span class="ident" id="5960966">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5960972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5960976">paletted</span>&nbsp;<span class="op" id="5960985">:=</span>&nbsp;<span class="ident" id="5960988">d</span><span class="op" id="5960989">.</span><span class="ident" id="5960990">cb</span>&nbsp;<span class="op" id="5960993">==</span>&nbsp;<span class="ident" id="5960996">cbP8</span>&nbsp;<span class="op" id="5961001">||</span>&nbsp;<span class="ident" id="5961004">d</span><span class="op" id="5961005">.</span><span class="ident" id="5961006">cb</span>&nbsp;<span class="op" id="5961009">==</span>&nbsp;<span class="ident" id="5961012">cbP4</span>&nbsp;<span class="op" id="5961017">||</span>&nbsp;<span class="ident" id="5961020">d</span><span class="op" id="5961021">.</span><span class="ident" id="5961022">cb</span>&nbsp;<span class="op" id="5961025">==</span>&nbsp;<span class="ident" id="5961028">cbP2</span>&nbsp;<span class="op" id="5961033">||</span>&nbsp;<span class="ident" id="5961036">d</span><span class="op" id="5961037">.</span><span class="ident" id="5961038">cb</span>&nbsp;<span class="op" id="5961041">==</span>&nbsp;<span class="ident" id="5961044">cbP1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961051">if</span>&nbsp;<span class="ident" id="5961054">d</span><span class="op" id="5961055">.</span><span class="ident" id="5961056">stage</span>&nbsp;<span class="op" id="5961062">==</span>&nbsp;<span class="ident" id="5961065">dsSeenIHDR</span>&nbsp;<span class="op" id="5961076">&amp;&amp;</span>&nbsp;<span class="op" id="5961079">!</span><span class="ident" id="5961080">paletted</span>&nbsp;<span class="op" id="5961089">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961094">break</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961102">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961106">if</span>&nbsp;<span class="ident" id="5961109">d</span><span class="op" id="5961110">.</span><span class="ident" id="5961111">stage</span>&nbsp;<span class="op" id="5961117">==</span>&nbsp;<span class="ident" id="5961120">dsSeenPLTE</span>&nbsp;<span class="op" id="5961131">&amp;&amp;</span>&nbsp;<span class="ident" id="5961134">paletted</span>&nbsp;<span class="op" id="5961143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961148">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961159">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961162">var</span>&nbsp;<span class="ident" id="5961166">cm</span>&nbsp;<span class="ident" id="5961169">color</span><span class="op" id="5961174">.</span><span class="ident" id="5961175">Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961182">switch</span>&nbsp;<span class="ident" id="5961189">d</span><span class="op" id="5961190">.</span><span class="ident" id="5961191">cb</span>&nbsp;<span class="op" id="5961194">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961197">case</span>&nbsp;<span class="ident" id="5961202">cbG1</span><span class="op" id="5961206">,</span>&nbsp;<span class="ident" id="5961208">cbG2</span><span class="op" id="5961212">,</span>&nbsp;<span class="ident" id="5961214">cbG4</span><span class="op" id="5961218">,</span>&nbsp;<span class="ident" id="5961220">cbG8</span><span class="op" id="5961224">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961228">cm</span>&nbsp;<span class="op" id="5961231">=</span>&nbsp;<span class="ident" id="5961233">color</span><span class="op" id="5961238">.</span><span class="ident" id="5961239">GrayModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961250">case</span>&nbsp;<span class="ident" id="5961255">cbGA8</span><span class="op" id="5961260">:</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961264">cm</span>&nbsp;<span class="op" id="5961267">=</span>&nbsp;<span class="ident" id="5961269">color</span><span class="op" id="5961274">.</span><span class="ident" id="5961275">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961287">case</span>&nbsp;<span class="ident" id="5961292">cbTC8</span><span class="op" id="5961297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961301">cm</span>&nbsp;<span class="op" id="5961304">=</span>&nbsp;<span class="ident" id="5961306">color</span><span class="op" id="5961311">.</span><span class="ident" id="5961312">RGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961323">case</span>&nbsp;<span class="ident" id="5961328">cbP1</span><span class="op" id="5961332">,</span>&nbsp;<span class="ident" id="5961334">cbP2</span><span class="op" id="5961338">,</span>&nbsp;<span class="ident" id="5961340">cbP4</span><span class="op" id="5961344">,</span>&nbsp;<span class="ident" id="5961346">cbP8</span><span class="op" id="5961350">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961354">cm</span>&nbsp;<span class="op" id="5961357">=</span>&nbsp;<span class="ident" id="5961359">d</span><span class="op" id="5961360">.</span><span class="ident" id="5961361">palette</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961370">case</span>&nbsp;<span class="ident" id="5961375">cbTCA8</span><span class="op" id="5961381">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961385">cm</span>&nbsp;<span class="op" id="5961388">=</span>&nbsp;<span class="ident" id="5961390">color</span><span class="op" id="5961395">.</span><span class="ident" id="5961396">NRGBAModel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961408">case</span>&nbsp;<span class="ident" id="5961413">cbG16</span><span class="op" id="5961418">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961422">cm</span>&nbsp;<span class="op" id="5961425">=</span>&nbsp;<span class="ident" id="5961427">color</span><span class="op" id="5961432">.</span><span class="ident" id="5961433">Gray16Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961446">case</span>&nbsp;<span class="ident" id="5961451">cbGA16</span><span class="op" id="5961457">:</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961461">cm</span>&nbsp;<span class="op" id="5961464">=</span>&nbsp;<span class="ident" id="5961466">color</span><span class="op" id="5961471">.</span><span class="ident" id="5961472">NRGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961486">case</span>&nbsp;<span class="ident" id="5961491">cbTC16</span><span class="op" id="5961497">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961501">cm</span>&nbsp;<span class="op" id="5961504">=</span>&nbsp;<span class="ident" id="5961506">color</span><span class="op" id="5961511">.</span><span class="ident" id="5961512">RGBA64Model</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961525">case</span>&nbsp;<span class="ident" id="5961530">cbTCA16</span><span class="op" id="5961537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961541">cm</span>&nbsp;<span class="op" id="5961544">=</span>&nbsp;<span class="ident" id="5961546">color</span><span class="op" id="5961551">.</span><span class="ident" id="5961552">NRGBA64Model</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961566">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5961569">return</span>&nbsp;<span class="ident" id="5961576">image</span><span class="op" id="5961581">.</span><span class="ident" id="5961582">Config</span><span class="op" id="5961588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961592">ColorModel</span><span class="op" id="5961602">:</span>&nbsp;<span class="ident" id="5961604">cm</span><span class="op" id="5961606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961610">Width</span><span class="op" id="5961615">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961622">d</span><span class="op" id="5961623">.</span><span class="ident" id="5961624">width</span><span class="op" id="5961629">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961633">Height</span><span class="op" id="5961639">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961645">d</span><span class="op" id="5961646">.</span><span class="ident" id="5961647">height</span><span class="op" id="5961653">,</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5961656">}</span><span class="op" id="5961657">,</span>&nbsp;<span class="builtintype" id="5961659">nil</span><br>
<span class="lineno"></span><span class="op" id="5961663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5961666">func</span>&nbsp;<span class="ident" id="5961671">init</span><span class="op" id="5961675">(</span><span class="op" id="5961676">)</span>&nbsp;<span class="op" id="5961678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5961681">image</span><span class="op" id="5961686">.</span><span class="ident" id="5961687">RegisterFormat</span><span class="op" id="5961701">(</span><span class="string" id="5961702">&#34;png&#34;</span><span class="op" id="5961707">,</span>&nbsp;<span class="ident" id="5961709">pngHeader</span><span class="op" id="5961718">,</span>&nbsp;<span class="ident" id="5961720">Decode</span><span class="op" id="5961726">,</span>&nbsp;<span class="ident" id="5961728">DecodeConfig</span><span class="op" id="5961740">)</span><br>
<span class="lineno">820</span><span class="op" id="5961742">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
