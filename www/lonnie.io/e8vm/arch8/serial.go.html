<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5987330">package</span>&nbsp;<span class="ident" id="5987338">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987345">import</span>&nbsp;<span class="op" id="5987352">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987355">&#34;bytes&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987364">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987370">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5987377">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="5987382">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="comment" id="5987385">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;serial&nbsp;console&nbsp;device</span><br>
<span class="lineno"></span><span class="comment" id="5987422">//&nbsp;It&nbsp;is&nbsp;basically&nbsp;two&nbsp;DMA&nbsp;pipes&nbsp;of&nbsp;ring&nbsp;buffered&nbsp;bytes:</span><br>
<span class="lineno"></span><span class="comment" id="5987479">//&nbsp;one&nbsp;pipe&nbsp;for&nbsp;input,&nbsp;one&nbsp;pipe&nbsp;for&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="5987523">type</span>&nbsp;<span class="ident" id="5987528">serial</span>&nbsp;<span class="keyword" id="5987535">struct</span>&nbsp;<span class="op" id="5987542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987545">intBus</span>&nbsp;<span class="ident" id="5987552"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5972384">intBus</a></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987560">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987567">*</span><span class="ident" id="5987568"><a href="/lonnie.io/e8vm/arch8/page.go.html#5979913">page</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987575">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5987582">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987588">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="5987595">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987601">IntOut</span>&nbsp;<span class="builtintype" id="5987608">byte</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987615">Output</span>&nbsp;<span class="ident" id="5987622"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987364">io</a></span><span class="op" id="5987624">.</span><span class="ident" id="5987625">Writer</span><br>
<span class="lineno"></span><span class="op" id="5987632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5987635">var</span>&nbsp;<span class="ident" id="5987639">_</span>&nbsp;<span class="ident" id="5987641"><a href="/lonnie.io/e8vm/arch8/device.go.html#5965421">device</a></span>&nbsp;<span class="op" id="5987648">=</span>&nbsp;<span class="builtinfunc" id="5987650">new</span><span class="op" id="5987653">(</span><span class="ident" id="5987654"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5987660">)</span>&nbsp;<span class="comment" id="5987662">//&nbsp;Serial&nbsp;is&nbsp;a&nbsp;device</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5987685">const</span>&nbsp;<span class="op" id="5987691">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987694">serialBase</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5987709">=</span>&nbsp;<span class="num" id="5987711">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987716">serialInHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5987731">=</span>&nbsp;<span class="ident" id="5987733"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5987744">+</span>&nbsp;<span class="num" id="5987746">0</span>&nbsp;&nbsp;<span class="comment" id="5987749">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987773">serialInTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5987788">=</span>&nbsp;<span class="ident" id="5987790"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5987801">+</span>&nbsp;<span class="num" id="5987803">4</span>&nbsp;&nbsp;<span class="comment" id="5987806">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987825">serialInWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5987840">=</span>&nbsp;<span class="ident" id="5987842"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5987853">+</span>&nbsp;<span class="num" id="5987855">8</span>&nbsp;&nbsp;<span class="comment" id="5987858">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987899">serialInThresh</span>&nbsp;<span class="op" id="5987914">=</span>&nbsp;<span class="ident" id="5987916"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5987927">+</span>&nbsp;<span class="num" id="5987929">12</span>&nbsp;<span class="comment" id="5987932">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;input&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5987976">serialOutHead</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5987992">=</span>&nbsp;<span class="ident" id="5987994"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988005">+</span>&nbsp;<span class="num" id="5988007">16</span>&nbsp;<span class="comment" id="5988010">//&nbsp;updated&nbsp;by&nbsp;cpu</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988029">serialOutTail</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5988045">=</span>&nbsp;<span class="ident" id="5988047"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988058">+</span>&nbsp;<span class="num" id="5988060">20</span>&nbsp;<span class="comment" id="5988063">//&nbsp;updated&nbsp;by&nbsp;hardware</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988087">serialOutWait</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5988103">=</span>&nbsp;<span class="ident" id="5988105"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988116">+</span>&nbsp;<span class="num" id="5988118">24</span>&nbsp;<span class="comment" id="5988121">//&nbsp;cycles&nbsp;to&nbsp;wait&nbsp;to&nbsp;raise&nbsp;an&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988162">serialOutThresh</span>&nbsp;<span class="op" id="5988178">=</span>&nbsp;<span class="ident" id="5988180"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988191">+</span>&nbsp;<span class="num" id="5988193">28</span>&nbsp;<span class="comment" id="5988196">//&nbsp;threashold&nbsp;to&nbsp;raise&nbsp;an&nbsp;output&nbsp;interrupt</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988241">serialInBuf</span>&nbsp;&nbsp;<span class="op" id="5988254">=</span>&nbsp;<span class="ident" id="5988256"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988267">+</span>&nbsp;<span class="num" id="5988269">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988273">serialOutBuf</span>&nbsp;<span class="op" id="5988286">=</span>&nbsp;<span class="ident" id="5988288"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987694">serialBase</a></span>&nbsp;<span class="op" id="5988299">+</span>&nbsp;<span class="num" id="5988301">96</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988306">serialCap</span>&nbsp;<span class="op" id="5988316">=</span>&nbsp;<span class="num" id="5988318">30</span>&nbsp;<span class="comment" id="5988321">//&nbsp;30&nbsp;bytes&nbsp;maximum&nbsp;in&nbsp;each&nbsp;pipe</span><br>
<span class="lineno"></span><span class="op" id="5988354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988357">//&nbsp;NewSerial&nbsp;creates&nbsp;a&nbsp;new&nbsp;serial&nbsp;controller.</span><br>
<span class="lineno">45</span><span class="keyword" id="5988403">func</span>&nbsp;<span class="ident" id="5988408">newSerial</span><span class="op" id="5988417">(</span><span class="ident" id="5988418">p</span>&nbsp;<span class="op" id="5988420">*</span><span class="ident" id="5988421"><a href="/lonnie.io/e8vm/arch8/page.go.html#5979913">page</a></span><span class="op" id="5988425">,</span>&nbsp;<span class="ident" id="5988427">i</span>&nbsp;<span class="ident" id="5988429"><a href="/lonnie.io/e8vm/arch8/int_bus.go.html#5972384">intBus</a></span><span class="op" id="5988435">)</span>&nbsp;<span class="op" id="5988437">*</span><span class="ident" id="5988438"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span>&nbsp;<span class="op" id="5988445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988448">ret</span>&nbsp;<span class="op" id="5988452">:=</span>&nbsp;<span class="builtinfunc" id="5988455">new</span><span class="op" id="5988458">(</span><span class="ident" id="5988459"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5988465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988468"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988471">.</span><span class="ident" id="5988472">intBus</span>&nbsp;<span class="op" id="5988479">=</span>&nbsp;<span class="ident" id="5988481"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988427">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988484"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988487">.</span><span class="ident" id="5988488">p</span>&nbsp;<span class="op" id="5988490">=</span>&nbsp;<span class="ident" id="5988492"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988418">p</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5988496">//&nbsp;default&nbsp;interrupts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988519"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988522">.</span><span class="ident" id="5988523">Core</span>&nbsp;<span class="op" id="5988528">=</span>&nbsp;<span class="num" id="5988530">0</span>&nbsp;<span class="comment" id="5988532">//&nbsp;to&nbsp;core&nbsp;0&nbsp;only</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988551"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988554">.</span><span class="ident" id="5988555">IntIn</span>&nbsp;<span class="op" id="5988561">=</span>&nbsp;<span class="num" id="5988563">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988566"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988569">.</span><span class="ident" id="5988570">IntOut</span>&nbsp;<span class="op" id="5988577">=</span>&nbsp;<span class="num" id="5988579">9</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988583"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><span class="op" id="5988586">.</span><span class="ident" id="5988587">Output</span>&nbsp;<span class="op" id="5988594">=</span>&nbsp;<span class="ident" id="5988596"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987377">os</a></span><span class="op" id="5988598">.</span><span class="ident" id="5988599">Stdout</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988608">return</span>&nbsp;<span class="ident" id="5988615"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988448">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5988619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="keyword" id="5988622">func</span>&nbsp;<span class="op" id="5988627">(</span><span class="ident" id="5988628">s</span>&nbsp;<span class="op" id="5988630">*</span><span class="ident" id="5988631"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5988637">)</span>&nbsp;<span class="ident" id="5988639">interrupt</span><span class="op" id="5988648">(</span><span class="ident" id="5988649">code</span>&nbsp;<span class="builtintype" id="5988654">byte</span><span class="op" id="5988658">)</span>&nbsp;<span class="op" id="5988660">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988663"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988628">s</a></span><span class="op" id="5988664">.</span><span class="ident" id="5988665">intBus</span><span class="op" id="5988671">.</span><span class="ident" id="5988672">Interrupt</span><span class="op" id="5988681">(</span><span class="ident" id="5988682"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988649">code</a></span><span class="op" id="5988686">,</span>&nbsp;<span class="ident" id="5988688"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988628">s</a></span><span class="op" id="5988689">.</span><span class="ident" id="5988690">Core</span><span class="op" id="5988694">)</span><br>
<span class="lineno"></span><span class="op" id="5988696">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5988699">//&nbsp;WriteByte&nbsp;appends&nbsp;a&nbsp;byte&nbsp;into&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno">65</span><span class="keyword" id="5988755">func</span>&nbsp;<span class="op" id="5988760">(</span><span class="ident" id="5988761">s</span>&nbsp;<span class="op" id="5988763">*</span><span class="ident" id="5988764"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5988770">)</span>&nbsp;<span class="ident" id="5988772">WriteByte</span><span class="op" id="5988781">(</span><span class="ident" id="5988782">b</span>&nbsp;<span class="builtintype" id="5988784">byte</span><span class="op" id="5988788">)</span>&nbsp;<span class="builtintype" id="5988790">bool</span>&nbsp;<span class="op" id="5988795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988798">head</span>&nbsp;<span class="op" id="5988803">:=</span>&nbsp;<span class="ident" id="5988806"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5988807">.</span><span class="ident" id="5988808">p</span><span class="op" id="5988809">.</span><span class="ident" id="5988810">ReadWord</span><span class="op" id="5988818">(</span><span class="ident" id="5988819"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987716">serialInHead</a></span><span class="op" id="5988831">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988834">tail</span>&nbsp;<span class="op" id="5988839">:=</span>&nbsp;<span class="ident" id="5988842"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5988843">.</span><span class="ident" id="5988844">p</span><span class="op" id="5988845">.</span><span class="ident" id="5988846">ReadWord</span><span class="op" id="5988854">(</span><span class="ident" id="5988855"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987773">serialInTail</a></span><span class="op" id="5988867">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988870">n</span>&nbsp;<span class="op" id="5988872">:=</span>&nbsp;<span class="ident" id="5988875"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988798">head</a></span>&nbsp;<span class="op" id="5988880">-</span>&nbsp;<span class="ident" id="5988882"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988834">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988888">if</span>&nbsp;<span class="ident" id="5988891"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988870">n</a></span>&nbsp;<span class="op" id="5988893">&gt;=</span>&nbsp;<span class="ident" id="5988896"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span>&nbsp;<span class="op" id="5988906">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5988910">return</span>&nbsp;<span class="builtintype" id="5988917">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5988924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988928"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5988929">.</span><span class="ident" id="5988930">p</span><span class="op" id="5988931">.</span><span class="ident" id="5988932">WriteByte</span><span class="op" id="5988941">(</span><span class="ident" id="5988942"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988241">serialInBuf</a></span><span class="op" id="5988953">+</span><span class="ident" id="5988954"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988798">head</a></span><span class="op" id="5988958">%</span><span class="num" id="5988959">32</span><span class="op" id="5988961">,</span>&nbsp;<span class="ident" id="5988963"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988782">b</a></span><span class="op" id="5988964">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988968"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988798">head</a></span><span class="op" id="5988972">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5988976"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5988977">.</span><span class="ident" id="5988978">p</span><span class="op" id="5988979">.</span><span class="ident" id="5988980">WriteWord</span><span class="op" id="5988989">(</span><span class="ident" id="5988990"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987773">serialInTail</a></span><span class="op" id="5989002">,</span>&nbsp;<span class="ident" id="5989004"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988798">head</a></span><span class="op" id="5989008">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989012"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988870">n</a></span><span class="op" id="5989013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989017">thresh</span>&nbsp;<span class="op" id="5989024">:=</span>&nbsp;<span class="ident" id="5989027"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5989028">.</span><span class="ident" id="5989029">p</span><span class="op" id="5989030">.</span><span class="ident" id="5989031">ReadWord</span><span class="op" id="5989039">(</span><span class="ident" id="5989040"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987899">serialInThresh</a></span><span class="op" id="5989054">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989057">if</span>&nbsp;<span class="ident" id="5989060"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988870">n</a></span>&nbsp;<span class="op" id="5989062">&gt;=</span>&nbsp;<span class="ident" id="5989065"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989017">thresh</a></span>&nbsp;<span class="op" id="5989072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989076"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5989077">.</span><span class="ident" id="5989078">interrupt</span><span class="op" id="5989087">(</span><span class="ident" id="5989088"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988761">s</a></span><span class="op" id="5989089">.</span><span class="ident" id="5989090">IntIn</span><span class="op" id="5989095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989102">return</span>&nbsp;<span class="builtintype" id="5989109">true</span><br>
<span class="lineno">85</span><span class="op" id="5989114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5989117">//&nbsp;OutLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5989188">func</span>&nbsp;<span class="op" id="5989193">(</span><span class="ident" id="5989194">s</span>&nbsp;<span class="op" id="5989196">*</span><span class="ident" id="5989197"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5989203">)</span>&nbsp;<span class="ident" id="5989205">OutLen</span><span class="op" id="5989211">(</span><span class="op" id="5989212">)</span>&nbsp;<span class="builtintype" id="5989214">uint32</span>&nbsp;<span class="op" id="5989221">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989224">head</span>&nbsp;<span class="op" id="5989229">:=</span>&nbsp;<span class="ident" id="5989232"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989194">s</a></span><span class="op" id="5989233">.</span><span class="ident" id="5989234">p</span><span class="op" id="5989235">.</span><span class="ident" id="5989236">ReadWord</span><span class="op" id="5989244">(</span><span class="ident" id="5989245"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987976">serialOutHead</a></span><span class="op" id="5989258">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989261">tail</span>&nbsp;<span class="op" id="5989266">:=</span>&nbsp;<span class="ident" id="5989269"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989194">s</a></span><span class="op" id="5989270">.</span><span class="ident" id="5989271">p</span><span class="op" id="5989272">.</span><span class="ident" id="5989273">ReadWord</span><span class="op" id="5989281">(</span><span class="ident" id="5989282"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988029">serialOutTail</a></span><span class="op" id="5989295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989298">ret</span>&nbsp;<span class="op" id="5989302">:=</span>&nbsp;<span class="ident" id="5989305"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989224">head</a></span>&nbsp;<span class="op" id="5989310">-</span>&nbsp;<span class="ident" id="5989312"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989261">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989318">if</span>&nbsp;<span class="ident" id="5989321"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989298">ret</a></span>&nbsp;<span class="op" id="5989325">&gt;</span>&nbsp;<span class="ident" id="5989327"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span>&nbsp;<span class="op" id="5989337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989341"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987370">log</a></span><span class="op" id="5989344">.</span><span class="ident" id="5989345">Printf</span><span class="op" id="5989351">(</span><span class="string" id="5989352">&#34;error&nbsp;output&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5989380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989384">//&nbsp;on&nbsp;error&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;full</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989421">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989453"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989298">ret</a></span>&nbsp;<span class="op" id="5989457">=</span>&nbsp;<span class="ident" id="5989459"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989470">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989473">return</span>&nbsp;<span class="ident" id="5989480"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989298">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5989484">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="comment" id="5989487">//&nbsp;InLen&nbsp;returns&nbsp;the&nbsp;current&nbsp;buffer&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5989556">func</span>&nbsp;<span class="op" id="5989561">(</span><span class="ident" id="5989562">s</span>&nbsp;<span class="op" id="5989564">*</span><span class="ident" id="5989565"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5989571">)</span>&nbsp;<span class="ident" id="5989573">InLen</span><span class="op" id="5989578">(</span><span class="op" id="5989579">)</span>&nbsp;<span class="builtintype" id="5989581">uint32</span>&nbsp;<span class="op" id="5989588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989591">head</span>&nbsp;<span class="op" id="5989596">:=</span>&nbsp;<span class="ident" id="5989599"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989562">s</a></span><span class="op" id="5989600">.</span><span class="ident" id="5989601">p</span><span class="op" id="5989602">.</span><span class="ident" id="5989603">ReadWord</span><span class="op" id="5989611">(</span><span class="ident" id="5989612"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987716">serialInHead</a></span><span class="op" id="5989624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989627">tail</span>&nbsp;<span class="op" id="5989632">:=</span>&nbsp;<span class="ident" id="5989635"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989562">s</a></span><span class="op" id="5989636">.</span><span class="ident" id="5989637">p</span><span class="op" id="5989638">.</span><span class="ident" id="5989639">ReadWord</span><span class="op" id="5989647">(</span><span class="ident" id="5989648"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987773">serialInTail</a></span><span class="op" id="5989660">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989663">ret</span>&nbsp;<span class="op" id="5989667">:=</span>&nbsp;<span class="ident" id="5989670"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989591">head</a></span>&nbsp;<span class="op" id="5989675">-</span>&nbsp;<span class="ident" id="5989677"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989627">tail</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989683">if</span>&nbsp;<span class="ident" id="5989686"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989663">ret</a></span>&nbsp;<span class="op" id="5989690">&gt;</span>&nbsp;<span class="ident" id="5989692"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span>&nbsp;<span class="op" id="5989702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989706"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987370">log</a></span><span class="op" id="5989709">.</span><span class="ident" id="5989710">Printf</span><span class="op" id="5989716">(</span><span class="string" id="5989717">&#34;error&nbsp;input&nbsp;buffer&nbsp;length&#34;</span><span class="op" id="5989744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989748">//&nbsp;on&nbsp;error,&nbsp;set&nbsp;the&nbsp;length&nbsp;to&nbsp;empty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5989787">//&nbsp;to&nbsp;avoid&nbsp;trigger&nbsp;interrupt</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989819"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989663">ret</a></span>&nbsp;<span class="op" id="5989823">=</span>&nbsp;<span class="num" id="5989825">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5989828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5989831">return</span>&nbsp;<span class="ident" id="5989838"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989663">ret</a></span><br>
<span class="lineno"></span><span class="op" id="5989842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="5989845">//&nbsp;ReadByte&nbsp;reads&nbsp;a&nbsp;byte&nbsp;out&nbsp;of&nbsp;serial&nbsp;output&nbsp;ring&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="keyword" id="5989904">func</span>&nbsp;<span class="op" id="5989909">(</span><span class="ident" id="5989910">s</span>&nbsp;<span class="op" id="5989912">*</span><span class="ident" id="5989913"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5989919">)</span>&nbsp;<span class="ident" id="5989921">ReadByte</span><span class="op" id="5989929">(</span><span class="op" id="5989930">)</span>&nbsp;<span class="op" id="5989932">(</span><span class="builtintype" id="5989933">byte</span><span class="op" id="5989937">,</span>&nbsp;<span class="builtintype" id="5989939">bool</span><span class="op" id="5989943">)</span>&nbsp;<span class="op" id="5989945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989948">head</span>&nbsp;<span class="op" id="5989953">:=</span>&nbsp;<span class="ident" id="5989956"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5989957">.</span><span class="ident" id="5989958">p</span><span class="op" id="5989959">.</span><span class="ident" id="5989960">ReadWord</span><span class="op" id="5989968">(</span><span class="ident" id="5989969"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987976">serialOutHead</a></span><span class="op" id="5989982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5989985">tail</span>&nbsp;<span class="op" id="5989990">:=</span>&nbsp;<span class="ident" id="5989993"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5989994">.</span><span class="ident" id="5989995">p</span><span class="op" id="5989996">.</span><span class="ident" id="5989997">ReadWord</span><span class="op" id="5990005">(</span><span class="ident" id="5990006"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988029">serialOutTail</a></span><span class="op" id="5990019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990022">n</span>&nbsp;<span class="op" id="5990024">:=</span>&nbsp;<span class="ident" id="5990027"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989948">head</a></span>&nbsp;<span class="op" id="5990032">-</span>&nbsp;<span class="ident" id="5990034"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989985">tail</a></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990040">if</span>&nbsp;<span class="ident" id="5990043"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990022">n</a></span>&nbsp;<span class="op" id="5990045">==</span>&nbsp;<span class="num" id="5990048">0</span>&nbsp;<span class="op" id="5990050">||</span>&nbsp;<span class="ident" id="5990053"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990022">n</a></span>&nbsp;<span class="op" id="5990055">&gt;</span>&nbsp;<span class="ident" id="5990057"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span>&nbsp;<span class="op" id="5990067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990071">return</span>&nbsp;<span class="num" id="5990078">0</span><span class="op" id="5990079">,</span>&nbsp;<span class="builtintype" id="5990081">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990092">b</span>&nbsp;<span class="op" id="5990094">:=</span>&nbsp;<span class="ident" id="5990097"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5990098">.</span><span class="ident" id="5990099">p</span><span class="op" id="5990100">.</span><span class="ident" id="5990101">ReadByte</span><span class="op" id="5990109">(</span><span class="ident" id="5990110"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988273">serialOutBuf</a></span>&nbsp;<span class="op" id="5990123">+</span>&nbsp;<span class="ident" id="5990125"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989985">tail</a></span><span class="op" id="5990129">%</span><span class="num" id="5990130">32</span><span class="op" id="5990132">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990135"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989985">tail</a></span><span class="op" id="5990139">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990143"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5990144">.</span><span class="ident" id="5990145">p</span><span class="op" id="5990146">.</span><span class="ident" id="5990147">WriteWord</span><span class="op" id="5990156">(</span><span class="ident" id="5990157"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988029">serialOutTail</a></span><span class="op" id="5990170">,</span>&nbsp;<span class="ident" id="5990172"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989985">tail</a></span><span class="op" id="5990176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990180"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990022">n</a></span><span class="op" id="5990181">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990185">thresh</span>&nbsp;<span class="op" id="5990192">:=</span>&nbsp;<span class="ident" id="5990195"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5990196">.</span><span class="ident" id="5990197">p</span><span class="op" id="5990198">.</span><span class="ident" id="5990199">ReadWord</span><span class="op" id="5990207">(</span><span class="ident" id="5990208"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988162">serialOutThresh</a></span><span class="op" id="5990223">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990226">if</span>&nbsp;<span class="ident" id="5990229"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990022">n</a></span>&nbsp;<span class="op" id="5990231">&lt;=</span>&nbsp;<span class="ident" id="5990234"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990185">thresh</a></span>&nbsp;<span class="op" id="5990241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990245"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5990246">.</span><span class="ident" id="5990247">interrupt</span><span class="op" id="5990256">(</span><span class="ident" id="5990257"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5989910">s</a></span><span class="op" id="5990258">.</span><span class="ident" id="5990259">IntOut</span><span class="op" id="5990265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990268">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990272">return</span>&nbsp;<span class="ident" id="5990279"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990092">b</a></span><span class="op" id="5990280">,</span>&nbsp;<span class="builtintype" id="5990282">true</span><br>
<span class="lineno">135</span><span class="op" id="5990287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5990290">func</span>&nbsp;<span class="op" id="5990295">(</span><span class="ident" id="5990296">s</span>&nbsp;<span class="op" id="5990298">*</span><span class="ident" id="5990299"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5990305">)</span>&nbsp;<span class="ident" id="5990307">countDown</span><span class="op" id="5990316">(</span><span class="op" id="5990317">)</span>&nbsp;<span class="op" id="5990319">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990322">inWait</span>&nbsp;<span class="op" id="5990329">:=</span>&nbsp;<span class="ident" id="5990332"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990333">.</span><span class="ident" id="5990334">p</span><span class="op" id="5990335">.</span><span class="ident" id="5990336">ReadWord</span><span class="op" id="5990344">(</span><span class="ident" id="5990345"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987825">serialInWait</a></span><span class="op" id="5990357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990360">outWait</span>&nbsp;<span class="op" id="5990368">:=</span>&nbsp;<span class="ident" id="5990371"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990372">.</span><span class="ident" id="5990373">p</span><span class="op" id="5990374">.</span><span class="ident" id="5990375">ReadWord</span><span class="op" id="5990383">(</span><span class="ident" id="5990384"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988087">serialOutWait</a></span><span class="op" id="5990397">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990401">if</span>&nbsp;<span class="ident" id="5990404"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990322">inWait</a></span>&nbsp;<span class="op" id="5990411">&gt;</span>&nbsp;<span class="num" id="5990413">0</span>&nbsp;<span class="op" id="5990415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990419"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990322">inWait</a></span><span class="op" id="5990425">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990432">if</span>&nbsp;<span class="ident" id="5990435"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990360">outWait</a></span>&nbsp;<span class="op" id="5990443">&gt;</span>&nbsp;<span class="num" id="5990445">0</span>&nbsp;<span class="op" id="5990447">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990451"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990360">outWait</a></span><span class="op" id="5990458">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990466">if</span>&nbsp;<span class="ident" id="5990469"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990322">inWait</a></span>&nbsp;<span class="op" id="5990476">==</span>&nbsp;<span class="num" id="5990479">0</span>&nbsp;<span class="op" id="5990481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990485">if</span>&nbsp;<span class="ident" id="5990488"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990489">.</span><span class="ident" id="5990490">InLen</span><span class="op" id="5990495">(</span><span class="op" id="5990496">)</span>&nbsp;<span class="op" id="5990498">&gt;</span>&nbsp;<span class="num" id="5990500">0</span>&nbsp;<span class="op" id="5990502">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990507"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990508">.</span><span class="ident" id="5990509">interrupt</span><span class="op" id="5990518">(</span><span class="ident" id="5990519"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990520">.</span><span class="ident" id="5990521">IntIn</span><span class="op" id="5990526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990530">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990533">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990537">if</span>&nbsp;<span class="ident" id="5990540"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990360">outWait</a></span>&nbsp;<span class="op" id="5990548">==</span>&nbsp;<span class="num" id="5990551">0</span>&nbsp;<span class="op" id="5990553">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990557">if</span>&nbsp;<span class="ident" id="5990560"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990561">.</span><span class="ident" id="5990562">OutLen</span><span class="op" id="5990568">(</span><span class="op" id="5990569">)</span>&nbsp;<span class="op" id="5990571">&lt;</span>&nbsp;<span class="ident" id="5990573"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988306">serialCap</a></span>&nbsp;<span class="op" id="5990583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990588"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990589">.</span><span class="ident" id="5990590">interrupt</span><span class="op" id="5990599">(</span><span class="ident" id="5990600"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990601">.</span><span class="ident" id="5990602">IntOut</span><span class="op" id="5990608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990612">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990619"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990620">.</span><span class="ident" id="5990621">p</span><span class="op" id="5990622">.</span><span class="ident" id="5990623">WriteWord</span><span class="op" id="5990632">(</span><span class="ident" id="5990633"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987825">serialInWait</a></span><span class="op" id="5990645">,</span>&nbsp;<span class="ident" id="5990647"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990322">inWait</a></span><span class="op" id="5990653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990656"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990296">s</a></span><span class="op" id="5990657">.</span><span class="ident" id="5990658">p</span><span class="op" id="5990659">.</span><span class="ident" id="5990660">WriteWord</span><span class="op" id="5990669">(</span><span class="ident" id="5990670"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5988087">serialOutWait</a></span><span class="op" id="5990683">,</span>&nbsp;<span class="ident" id="5990685"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990360">outWait</a></span><span class="op" id="5990692">)</span><br>
<span class="lineno"></span><span class="op" id="5990694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5990697">func</span>&nbsp;<span class="op" id="5990702">(</span><span class="ident" id="5990703">s</span>&nbsp;<span class="op" id="5990705">*</span><span class="ident" id="5990706"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5990712">)</span>&nbsp;<span class="ident" id="5990714">flush</span><span class="op" id="5990719">(</span><span class="op" id="5990720">)</span>&nbsp;<span class="op" id="5990722">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990725">buf</span>&nbsp;<span class="op" id="5990729">:=</span>&nbsp;<span class="builtinfunc" id="5990732">new</span><span class="op" id="5990735">(</span><span class="ident" id="5990736"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987355">bytes</a></span><span class="op" id="5990741">.</span><span class="ident" id="5990742">Buffer</span><span class="op" id="5990748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990751">for</span>&nbsp;<span class="op" id="5990755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990759">b</span><span class="op" id="5990760">,</span>&nbsp;<span class="ident" id="5990762">valid</span>&nbsp;<span class="op" id="5990768">:=</span>&nbsp;<span class="ident" id="5990771"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990703">s</a></span><span class="op" id="5990772">.</span><span class="ident" id="5990773">ReadByte</span><span class="op" id="5990781">(</span><span class="op" id="5990782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990786">if</span>&nbsp;<span class="ident" id="5990789"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990762">valid</a></span>&nbsp;<span class="op" id="5990795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990800"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990725">buf</a></span><span class="op" id="5990803">.</span><span class="ident" id="5990804">WriteByte</span><span class="op" id="5990813">(</span><span class="ident" id="5990814"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990759">b</a></span><span class="op" id="5990815">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990819">}</span>&nbsp;<span class="keyword" id="5990821">else</span>&nbsp;<span class="op" id="5990826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990831">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990842">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990846">if</span>&nbsp;<span class="ident" id="5990849"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990703">s</a></span><span class="op" id="5990850">.</span><span class="ident" id="5990851">Output</span>&nbsp;<span class="op" id="5990858">!=</span>&nbsp;<span class="ident" id="5990861">nil</span>&nbsp;<span class="op" id="5990865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990869">_</span><span class="op" id="5990870">,</span>&nbsp;<span class="ident" id="5990872">e</span>&nbsp;<span class="op" id="5990874">:=</span>&nbsp;<span class="ident" id="5990877"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990703">s</a></span><span class="op" id="5990878">.</span><span class="ident" id="5990879">Output</span><span class="op" id="5990885">.</span><span class="ident" id="5990886">Write</span><span class="op" id="5990891">(</span><span class="ident" id="5990892"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990725">buf</a></span><span class="op" id="5990895">.</span><span class="ident" id="5990896">Bytes</span><span class="op" id="5990901">(</span><span class="op" id="5990902">)</span><span class="op" id="5990903">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5990907">if</span>&nbsp;<span class="ident" id="5990910"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990872">e</a></span>&nbsp;<span class="op" id="5990912">!=</span>&nbsp;<span class="ident" id="5990915">nil</span>&nbsp;<span class="op" id="5990919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5990924"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987370">log</a></span><span class="op" id="5990927">.</span><span class="ident" id="5990928">Print</span><span class="op" id="5990933">(</span><span class="ident" id="5990934"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5990872">e</a></span><span class="op" id="5990935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990939">}</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5990942">}</span><br>
<span class="lineno"></span><span class="op" id="5990944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5990947">//&nbsp;Tick&nbsp;counts&nbsp;down&nbsp;the&nbsp;waiting&nbsp;counters&nbsp;and&nbsp;triggers</span><br>
<span class="lineno"></span><span class="comment" id="5991001">//&nbsp;interrupt&nbsp;when&nbsp;the&nbsp;count&nbsp;down&nbsp;reaches&nbsp;zero.</span><br>
<span class="lineno">185</span><span class="keyword" id="5991048">func</span>&nbsp;<span class="op" id="5991053">(</span><span class="ident" id="5991054">s</span>&nbsp;<span class="op" id="5991056">*</span><span class="ident" id="5991057"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5987528">serial</a></span><span class="op" id="5991063">)</span>&nbsp;<span class="ident" id="5991065">Tick</span><span class="op" id="5991069">(</span><span class="op" id="5991070">)</span>&nbsp;<span class="op" id="5991072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991075"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5991054">s</a></span><span class="op" id="5991076">.</span><span class="ident" id="5991077">flush</span><span class="op" id="5991082">(</span><span class="op" id="5991083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5991086"><a href="/lonnie.io/e8vm/arch8/serial.go.html#5991054">s</a></span><span class="op" id="5991087">.</span><span class="ident" id="5991088">countDown</span><span class="op" id="5991097">(</span><span class="op" id="5991098">)</span><br>
<span class="lineno"></span><span class="op" id="5991100">}</span>
</div>
</body>
</html>
