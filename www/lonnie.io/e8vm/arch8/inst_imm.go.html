<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="4864323">package</span>&nbsp;<span class="ident" id="4864331">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4864338">//&nbsp;InstImm&nbsp;executes&nbsp;immediate&nbsp;instructions</span><br>
<span class="lineno"></span><span class="keyword" id="4864381">type</span>&nbsp;<span class="ident" id="4864386">instImm</span>&nbsp;<span class="keyword" id="4864394">struct</span><span class="op" id="4864400">{</span><span class="op" id="4864401">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="4864404">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="4864435">//&nbsp;Might&nbsp;return&nbsp;invalid&nbsp;instruction&nbsp;exception,</span><br>
<span class="lineno"></span><span class="comment" id="4864482">//&nbsp;or&nbsp;memory&nbsp;related&nbsp;exceptions.</span><br>
<span class="lineno"></span><span class="keyword" id="4864515">func</span>&nbsp;<span class="op" id="4864520">(</span><span class="ident" id="4864521">i</span>&nbsp;<span class="op" id="4864523">*</span><span class="ident" id="4864524">instImm</span><span class="op" id="4864531">)</span>&nbsp;<span class="ident" id="4864533">I</span><span class="op" id="4864534">(</span><span class="ident" id="4864535">cpu</span>&nbsp;<span class="op" id="4864539">*</span><span class="ident" id="4864540">cpu</span><span class="op" id="4864543">,</span>&nbsp;<span class="ident" id="4864545">in</span>&nbsp;<span class="builtintype" id="4864548">uint32</span><span class="op" id="4864554">)</span>&nbsp;<span class="op" id="4864556">*</span><span class="ident" id="4864557">Excep</span>&nbsp;<span class="op" id="4864563">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864566">op</span>&nbsp;<span class="op" id="4864569">:=</span>&nbsp;<span class="op" id="4864572">(</span><span class="ident" id="4864573">in</span>&nbsp;<span class="op" id="4864576">&gt;&gt;</span>&nbsp;<span class="num" id="4864579">24</span><span class="op" id="4864581">)</span>&nbsp;<span class="op" id="4864583">&amp;</span>&nbsp;<span class="num" id="4864585">0xff</span>&nbsp;&nbsp;<span class="comment" id="4864591">//&nbsp;(32:24]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864603">dest</span>&nbsp;<span class="op" id="4864608">:=</span>&nbsp;<span class="op" id="4864611">(</span><span class="ident" id="4864612">in</span>&nbsp;<span class="op" id="4864615">&gt;&gt;</span>&nbsp;<span class="num" id="4864618">21</span><span class="op" id="4864620">)</span>&nbsp;<span class="op" id="4864622">&amp;</span>&nbsp;<span class="num" id="4864624">0x7</span>&nbsp;<span class="comment" id="4864628">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864640">src</span>&nbsp;<span class="op" id="4864644">:=</span>&nbsp;<span class="op" id="4864647">(</span><span class="ident" id="4864648">in</span>&nbsp;<span class="op" id="4864651">&gt;&gt;</span>&nbsp;<span class="num" id="4864654">18</span><span class="op" id="4864656">)</span>&nbsp;<span class="op" id="4864658">&amp;</span>&nbsp;<span class="num" id="4864660">0x7</span>&nbsp;&nbsp;<span class="comment" id="4864665">//&nbsp;(21:18]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864677">im</span>&nbsp;<span class="op" id="4864680">:=</span>&nbsp;<span class="ident" id="4864683">in</span>&nbsp;<span class="op" id="4864686">&amp;</span>&nbsp;<span class="num" id="4864688">0xffff</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4864702">//&nbsp;(16:0]</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864714">s</span>&nbsp;<span class="op" id="4864716">:=</span>&nbsp;<span class="ident" id="4864719">cpu</span><span class="op" id="4864722">.</span><span class="ident" id="4864723">regs</span><span class="op" id="4864727">[</span><span class="ident" id="4864728">src</span><span class="op" id="4864731">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864734">d</span>&nbsp;<span class="op" id="4864736">:=</span>&nbsp;<span class="ident" id="4864739">cpu</span><span class="op" id="4864742">.</span><span class="ident" id="4864743">regs</span><span class="op" id="4864747">[</span><span class="ident" id="4864748">dest</span><span class="op" id="4864752">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864755">ims</span>&nbsp;<span class="op" id="4864759">:=</span>&nbsp;<span class="builtintype" id="4864762">uint32</span><span class="op" id="4864768">(</span><span class="builtintype" id="4864769">int32</span><span class="op" id="4864774">(</span><span class="ident" id="4864775">im</span><span class="op" id="4864777">&lt;&lt;</span><span class="num" id="4864779">16</span><span class="op" id="4864781">)</span>&nbsp;<span class="op" id="4864783">&gt;&gt;</span>&nbsp;<span class="num" id="4864786">16</span><span class="op" id="4864788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864791">addr</span>&nbsp;<span class="op" id="4864796">:=</span>&nbsp;<span class="ident" id="4864799">s</span>&nbsp;<span class="op" id="4864801">+</span>&nbsp;<span class="ident" id="4864803">ims</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864808">var</span>&nbsp;<span class="ident" id="4864812">e</span>&nbsp;<span class="op" id="4864814">*</span><span class="ident" id="4864815">Excep</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864822">var</span>&nbsp;<span class="ident" id="4864826">b</span>&nbsp;<span class="builtintype" id="4864828">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864835">switch</span>&nbsp;<span class="ident" id="4864842">op</span>&nbsp;<span class="op" id="4864845">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864848">case</span>&nbsp;<span class="num" id="4864853">0</span><span class="op" id="4864854">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4864858">panic</span><span class="op" id="4864863">(</span><span class="string" id="4864864">&#34;register&nbsp;based&nbsp;instruction&#34;</span><span class="op" id="4864892">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864895">case</span>&nbsp;<span class="num" id="4864900">1</span><span class="op" id="4864901">:</span>&nbsp;<span class="comment" id="4864903">//&nbsp;addi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864913">d</span>&nbsp;<span class="op" id="4864915">=</span>&nbsp;<span class="ident" id="4864917">s</span>&nbsp;<span class="op" id="4864919">+</span>&nbsp;<span class="ident" id="4864921">ims</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864926">case</span>&nbsp;<span class="num" id="4864931">2</span><span class="op" id="4864932">:</span>&nbsp;<span class="comment" id="4864934">//&nbsp;slti</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4864944">if</span>&nbsp;<span class="builtintype" id="4864947">int32</span><span class="op" id="4864952">(</span><span class="ident" id="4864953">s</span><span class="op" id="4864954">)</span>&nbsp;<span class="op" id="4864956">&lt;</span>&nbsp;<span class="builtintype" id="4864958">int32</span><span class="op" id="4864963">(</span><span class="ident" id="4864964">ims</span><span class="op" id="4864967">)</span>&nbsp;<span class="op" id="4864969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864974">d</span>&nbsp;<span class="op" id="4864976">=</span>&nbsp;<span class="num" id="4864978">1</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4864982">}</span>&nbsp;<span class="keyword" id="4864984">else</span>&nbsp;<span class="op" id="4864989">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4864994">d</span>&nbsp;<span class="op" id="4864996">=</span>&nbsp;<span class="num" id="4864998">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865005">case</span>&nbsp;<span class="num" id="4865010">3</span><span class="op" id="4865011">:</span>&nbsp;<span class="comment" id="4865013">//&nbsp;andi</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865023">d</span>&nbsp;<span class="op" id="4865025">=</span>&nbsp;<span class="ident" id="4865027">s</span>&nbsp;<span class="op" id="4865029">&amp;</span>&nbsp;<span class="ident" id="4865031">im</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865035">case</span>&nbsp;<span class="num" id="4865040">4</span><span class="op" id="4865041">:</span>&nbsp;<span class="comment" id="4865043">//&nbsp;ori</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865052">d</span>&nbsp;<span class="op" id="4865054">=</span>&nbsp;<span class="ident" id="4865056">s</span>&nbsp;<span class="op" id="4865058">|</span>&nbsp;<span class="ident" id="4865060">im</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865064">case</span>&nbsp;<span class="num" id="4865069">5</span><span class="op" id="4865070">:</span>&nbsp;<span class="comment" id="4865072">//&nbsp;lui</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865081">d</span>&nbsp;<span class="op" id="4865083">=</span>&nbsp;<span class="ident" id="4865085">im</span>&nbsp;<span class="op" id="4865088">&lt;&lt;</span>&nbsp;<span class="num" id="4865091">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865095">case</span>&nbsp;<span class="num" id="4865100">6</span><span class="op" id="4865101">:</span>&nbsp;<span class="comment" id="4865103">//&nbsp;lw</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865111">d</span><span class="op" id="4865112">,</span>&nbsp;<span class="ident" id="4865114">e</span>&nbsp;<span class="op" id="4865116">=</span>&nbsp;<span class="ident" id="4865118">cpu</span><span class="op" id="4865121">.</span><span class="ident" id="4865122">readWord</span><span class="op" id="4865130">(</span><span class="ident" id="4865131">addr</span><span class="op" id="4865135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865138">case</span>&nbsp;<span class="num" id="4865143">7</span><span class="op" id="4865144">:</span>&nbsp;<span class="comment" id="4865146">//&nbsp;lb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865154">b</span><span class="op" id="4865155">,</span>&nbsp;<span class="ident" id="4865157">e</span>&nbsp;<span class="op" id="4865159">=</span>&nbsp;<span class="ident" id="4865161">cpu</span><span class="op" id="4865164">.</span><span class="ident" id="4865165">readByte</span><span class="op" id="4865173">(</span><span class="ident" id="4865174">addr</span><span class="op" id="4865178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865182">d</span>&nbsp;<span class="op" id="4865184">=</span>&nbsp;<span class="builtintype" id="4865186">uint32</span><span class="op" id="4865192">(</span><span class="builtintype" id="4865193">int32</span><span class="op" id="4865198">(</span><span class="builtintype" id="4865199">int8</span><span class="op" id="4865203">(</span><span class="ident" id="4865204">b</span><span class="op" id="4865205">)</span><span class="op" id="4865206">)</span><span class="op" id="4865207">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865210">case</span>&nbsp;<span class="num" id="4865215">8</span><span class="op" id="4865216">:</span>&nbsp;<span class="comment" id="4865218">//&nbsp;lbu</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865227">b</span><span class="op" id="4865228">,</span>&nbsp;<span class="ident" id="4865230">e</span>&nbsp;<span class="op" id="4865232">=</span>&nbsp;<span class="ident" id="4865234">cpu</span><span class="op" id="4865237">.</span><span class="ident" id="4865238">readByte</span><span class="op" id="4865246">(</span><span class="ident" id="4865247">addr</span><span class="op" id="4865251">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865255">d</span>&nbsp;<span class="op" id="4865257">=</span>&nbsp;<span class="builtintype" id="4865259">uint32</span><span class="op" id="4865265">(</span><span class="ident" id="4865266">b</span><span class="op" id="4865267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865270">case</span>&nbsp;<span class="num" id="4865275">9</span><span class="op" id="4865276">:</span>&nbsp;<span class="comment" id="4865278">//&nbsp;sw</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865286">e</span>&nbsp;<span class="op" id="4865288">=</span>&nbsp;<span class="ident" id="4865290">cpu</span><span class="op" id="4865293">.</span><span class="ident" id="4865294">writeWord</span><span class="op" id="4865303">(</span><span class="ident" id="4865304">addr</span><span class="op" id="4865308">,</span>&nbsp;<span class="ident" id="4865310">d</span><span class="op" id="4865311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865314">case</span>&nbsp;<span class="num" id="4865319">10</span><span class="op" id="4865321">:</span>&nbsp;<span class="comment" id="4865323">//&nbsp;sb</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865331">e</span>&nbsp;<span class="op" id="4865333">=</span>&nbsp;<span class="ident" id="4865335">cpu</span><span class="op" id="4865338">.</span><span class="ident" id="4865339">writeByte</span><span class="op" id="4865348">(</span><span class="ident" id="4865349">addr</span><span class="op" id="4865353">,</span>&nbsp;<span class="builtintype" id="4865355">byte</span><span class="op" id="4865359">(</span><span class="ident" id="4865360">d</span><span class="op" id="4865361">)</span><span class="op" id="4865362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865365">default</span><span class="op" id="4865372">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865376">return</span>&nbsp;<span class="ident" id="4865383">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865403">if</span>&nbsp;<span class="ident" id="4865406">e</span>&nbsp;<span class="op" id="4865408">!=</span>&nbsp;<span class="ident" id="4865411">nil</span>&nbsp;<span class="op" id="4865415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865419">return</span>&nbsp;<span class="ident" id="4865426">e</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4865429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4865433">cpu</span><span class="op" id="4865436">.</span><span class="ident" id="4865437">regs</span><span class="op" id="4865441">[</span><span class="ident" id="4865442">dest</span><span class="op" id="4865446">]</span>&nbsp;<span class="op" id="4865448">=</span>&nbsp;<span class="ident" id="4865450">d</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4865453">return</span>&nbsp;<span class="ident" id="4865460">nil</span><br>
<span class="lineno"></span><span class="op" id="4865464">}</span>
</div>
</body>
</html>
