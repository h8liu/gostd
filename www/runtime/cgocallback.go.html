<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="1720498">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1720554">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1720608">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1720659">package</span>&nbsp;<span class="ident" id="1720667">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1720676">import</span>&nbsp;<span class="string" id="1720683">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1720693">//&nbsp;These&nbsp;functions&nbsp;are&nbsp;called&nbsp;from&nbsp;C&nbsp;code&nbsp;via&nbsp;cgo/callbacks.c.</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="1720757">//&nbsp;Allocate&nbsp;memory.&nbsp;&nbsp;This&nbsp;allocates&nbsp;the&nbsp;requested&nbsp;number&nbsp;of&nbsp;bytes&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="1720826">//&nbsp;memory&nbsp;controlled&nbsp;by&nbsp;the&nbsp;Go&nbsp;runtime.&nbsp;&nbsp;The&nbsp;allocated&nbsp;memory&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="1720896">//&nbsp;zeroed.&nbsp;&nbsp;You&nbsp;are&nbsp;responsible&nbsp;for&nbsp;ensuring&nbsp;that&nbsp;the&nbsp;Go&nbsp;garbage</span><br>
<span class="lineno"></span><span class="comment" id="1720961">//&nbsp;collector&nbsp;can&nbsp;see&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;allocated&nbsp;memory&nbsp;for&nbsp;as&nbsp;long&nbsp;as</span><br>
<span class="lineno">15</span><span class="comment" id="1721031">//&nbsp;it&nbsp;is&nbsp;valid,&nbsp;e.g.,&nbsp;by&nbsp;storing&nbsp;a&nbsp;pointer&nbsp;in&nbsp;a&nbsp;local&nbsp;variable&nbsp;in&nbsp;your</span><br>
<span class="lineno"></span><span class="comment" id="1721102">//&nbsp;C&nbsp;function,&nbsp;or&nbsp;in&nbsp;memory&nbsp;allocated&nbsp;by&nbsp;the&nbsp;Go&nbsp;runtime.&nbsp;&nbsp;If&nbsp;the&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="1721172">//&nbsp;pointers&nbsp;are&nbsp;in&nbsp;a&nbsp;C&nbsp;global&nbsp;variable&nbsp;or&nbsp;in&nbsp;memory&nbsp;allocated&nbsp;via</span><br>
<span class="lineno"></span><span class="comment" id="1721238">//&nbsp;malloc,&nbsp;then&nbsp;the&nbsp;Go&nbsp;garbage&nbsp;collector&nbsp;may&nbsp;collect&nbsp;the&nbsp;memory.</span><br>
<span class="lineno"></span><span class="comment" id="1721303">//</span><br>
<span class="lineno">20</span><span class="comment" id="1721306">//&nbsp;TODO(rsc,iant):&nbsp;This&nbsp;memory&nbsp;is&nbsp;untyped.</span><br>
<span class="lineno"></span><span class="comment" id="1721349">//&nbsp;Either&nbsp;we&nbsp;need&nbsp;to&nbsp;add&nbsp;types&nbsp;or&nbsp;we&nbsp;need&nbsp;to&nbsp;stop&nbsp;using&nbsp;it.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1721410">func</span>&nbsp;<span class="ident" id="1721415">_cgo_allocate_internal</span><span class="op" id="1721437">(</span><span class="builtinfunc" id="1721438">len</span>&nbsp;<span class="builtintype" id="1721442">uintptr</span><span class="op" id="1721449">)</span>&nbsp;<span class="ident" id="1721451"><a href="/runtime/cgocallback.go.html#1720683">unsafe</a></span><span class="op" id="1721457">.</span><span class="ident" id="1721458">Pointer</span>&nbsp;<span class="op" id="1721466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1721469">if</span>&nbsp;<span class="builtinfunc" id="1721472"><a href="/runtime/cgocallback.go.html#1721438">len</a></span>&nbsp;<span class="op" id="1721476">==</span>&nbsp;<span class="num" id="1721479">0</span>&nbsp;<span class="op" id="1721481">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1721485"><a href="/runtime/cgocallback.go.html#1721438">len</a></span>&nbsp;<span class="op" id="1721489">=</span>&nbsp;<span class="num" id="1721491">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="1721494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721497">ret</span>&nbsp;<span class="op" id="1721501">:=</span>&nbsp;<span class="ident" id="1721504"><a href="/runtime/cgocallback.go.html#1720683">unsafe</a></span><span class="op" id="1721510">.</span><span class="ident" id="1721511">Pointer</span><span class="op" id="1721518">(</span><span class="op" id="1721519">&amp;</span><span class="builtinfunc" id="1721520">make</span><span class="op" id="1721524">(</span><span class="op" id="1721525">[</span><span class="op" id="1721526">]</span><span class="ident" id="1721527"><a href="/runtime/cgocallback.go.html#1720683">unsafe</a></span><span class="op" id="1721533">.</span><span class="ident" id="1721534">Pointer</span><span class="op" id="1721541">,</span>&nbsp;<span class="op" id="1721543">(</span><span class="builtinfunc" id="1721544"><a href="/runtime/cgocallback.go.html#1721438">len</a></span><span class="op" id="1721547">+</span><span class="ident" id="1721548"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1721555">-</span><span class="num" id="1721556">1</span><span class="op" id="1721557">)</span><span class="op" id="1721558">/</span><span class="ident" id="1721559"><a href="/runtime/stubs.go.html#1968375">ptrSize</a></span><span class="op" id="1721566">)</span><span class="op" id="1721567">[</span><span class="num" id="1721568">0</span><span class="op" id="1721569">]</span><span class="op" id="1721570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721573">c</span>&nbsp;<span class="op" id="1721575">:=</span>&nbsp;<span class="builtinfunc" id="1721578">new</span><span class="op" id="1721581">(</span><span class="ident" id="1721582"><a href="/runtime/zruntime_defs_linux_amd64.go.html#2020156">cgomal</a></span><span class="op" id="1721588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721591"><a href="/runtime/cgocallback.go.html#1721573">c</a></span><span class="op" id="1721592">.</span><span class="ident" id="1721593">alloc</span>&nbsp;<span class="op" id="1721599">=</span>&nbsp;<span class="ident" id="1721601"><a href="/runtime/cgocallback.go.html#1721497">ret</a></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721606">gp</span>&nbsp;<span class="op" id="1721609">:=</span>&nbsp;<span class="ident" id="1721612"><a href="/runtime/stubs.go.html#1968886">getg</a></span><span class="op" id="1721616">(</span><span class="op" id="1721617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721620"><a href="/runtime/cgocallback.go.html#1721573">c</a></span><span class="op" id="1721621">.</span><span class="ident" id="1721622">next</span>&nbsp;<span class="op" id="1721627">=</span>&nbsp;<span class="ident" id="1721629"><a href="/runtime/cgocallback.go.html#1721606">gp</a></span><span class="op" id="1721631">.</span><span class="ident" id="1721632">m</span><span class="op" id="1721633">.</span><span class="ident" id="1721634">cgomal</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="1721642"><a href="/runtime/cgocallback.go.html#1721606">gp</a></span><span class="op" id="1721644">.</span><span class="ident" id="1721645">m</span><span class="op" id="1721646">.</span><span class="ident" id="1721647">cgomal</span>&nbsp;<span class="op" id="1721654">=</span>&nbsp;<span class="ident" id="1721656"><a href="/runtime/cgocallback.go.html#1721573">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="1721659">return</span>&nbsp;<span class="ident" id="1721666"><a href="/runtime/cgocallback.go.html#1721497">ret</a></span><br>
<span class="lineno"></span><span class="op" id="1721670">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1721673">//&nbsp;Panic.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1721684">func</span>&nbsp;<span class="ident" id="1721689">_cgo_panic_internal</span><span class="op" id="1721708">(</span><span class="ident" id="1721709">p</span>&nbsp;<span class="op" id="1721711">*</span><span class="builtintype" id="1721712">byte</span><span class="op" id="1721716">)</span>&nbsp;<span class="op" id="1721718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="1721721">panic</span><span class="op" id="1721726">(</span><span class="ident" id="1721727"><a href="/runtime/stubs.go.html#1974575">gostringnocopy</a></span><span class="op" id="1721741">(</span><span class="ident" id="1721742"><a href="/runtime/cgocallback.go.html#1721709">p</a></span><span class="op" id="1721743">)</span><span class="op" id="1721744">)</span><br>
<span class="lineno">40</span><span class="op" id="1721746">}</span>
</div>
</body>
</html>
