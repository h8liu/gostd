<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html" class="current">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4639070">//&nbsp;Copyright&nbsp;2012&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4639125">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4639179">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4639230">package</span>&nbsp;<span class="ident" id="4639238">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639243">import</span>&nbsp;<span class="op" id="4639250">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639253">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639262">&#34;crypto/aes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639276">&#34;crypto/cipher&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639293">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639308">&#34;crypto/sha256&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639325">&#34;crypto/subtle&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639342">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4639352">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="4639357">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4639360">//&nbsp;sessionState&nbsp;contains&nbsp;the&nbsp;information&nbsp;that&nbsp;is&nbsp;serialized&nbsp;into&nbsp;a&nbsp;session</span><br>
<span class="lineno"></span><span class="comment" id="4639435">//&nbsp;ticket&nbsp;in&nbsp;order&nbsp;to&nbsp;later&nbsp;resume&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4639484">type</span>&nbsp;<span class="ident" id="4639489">sessionState</span>&nbsp;<span class="keyword" id="4639502">struct</span>&nbsp;<span class="op" id="4639509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639512">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4639525">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639533">cipherSuite</span>&nbsp;&nbsp;<span class="builtintype" id="4639546">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639554">masterSecret</span>&nbsp;<span class="op" id="4639567">[</span><span class="op" id="4639568">]</span><span class="builtintype" id="4639569">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639575">certificates</span>&nbsp;<span class="op" id="4639588">[</span><span class="op" id="4639589">]</span><span class="op" id="4639590">[</span><span class="op" id="4639591">]</span><span class="builtintype" id="4639592">byte</span><br>
<span class="lineno">25</span><span class="op" id="4639597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4639600">func</span>&nbsp;<span class="op" id="4639605">(</span><span class="ident" id="4639606">s</span>&nbsp;<span class="op" id="4639608">*</span><span class="ident" id="4639609">sessionState</span><span class="op" id="4639621">)</span>&nbsp;<span class="ident" id="4639623">equal</span><span class="op" id="4639628">(</span><span class="ident" id="4639629">i</span>&nbsp;<span class="keyword" id="4639631">interface</span><span class="op" id="4639640">{</span><span class="op" id="4639641">}</span><span class="op" id="4639642">)</span>&nbsp;<span class="builtintype" id="4639644">bool</span>&nbsp;<span class="op" id="4639649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639652">s1</span><span class="op" id="4639654">,</span>&nbsp;<span class="ident" id="4639656">ok</span>&nbsp;<span class="op" id="4639659">:=</span>&nbsp;<span class="ident" id="4639662">i</span><span class="op" id="4639663">.</span><span class="op" id="4639664">(</span><span class="op" id="4639665">*</span><span class="ident" id="4639666">sessionState</span><span class="op" id="4639678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639681">if</span>&nbsp;<span class="op" id="4639684">!</span><span class="ident" id="4639685">ok</span>&nbsp;<span class="op" id="4639688">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639692">return</span>&nbsp;<span class="builtintype" id="4639699">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639710">if</span>&nbsp;<span class="ident" id="4639713">s</span><span class="op" id="4639714">.</span><span class="ident" id="4639715">vers</span>&nbsp;<span class="op" id="4639720">!=</span>&nbsp;<span class="ident" id="4639723">s1</span><span class="op" id="4639725">.</span><span class="ident" id="4639726">vers</span>&nbsp;<span class="op" id="4639731">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4639736">s</span><span class="op" id="4639737">.</span><span class="ident" id="4639738">cipherSuite</span>&nbsp;<span class="op" id="4639750">!=</span>&nbsp;<span class="ident" id="4639753">s1</span><span class="op" id="4639755">.</span><span class="ident" id="4639756">cipherSuite</span>&nbsp;<span class="op" id="4639768">||</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639773">!</span><span class="ident" id="4639774">bytes</span><span class="op" id="4639779">.</span><span class="ident" id="4639780">Equal</span><span class="op" id="4639785">(</span><span class="ident" id="4639786">s</span><span class="op" id="4639787">.</span><span class="ident" id="4639788">masterSecret</span><span class="op" id="4639800">,</span>&nbsp;<span class="ident" id="4639802">s1</span><span class="op" id="4639804">.</span><span class="ident" id="4639805">masterSecret</span><span class="op" id="4639817">)</span>&nbsp;<span class="op" id="4639819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639823">return</span>&nbsp;<span class="builtintype" id="4639830">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639837">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639841">if</span>&nbsp;<span class="builtinfunc" id="4639844">len</span><span class="op" id="4639847">(</span><span class="ident" id="4639848">s</span><span class="op" id="4639849">.</span><span class="ident" id="4639850">certificates</span><span class="op" id="4639862">)</span>&nbsp;<span class="op" id="4639864">!=</span>&nbsp;<span class="builtinfunc" id="4639867">len</span><span class="op" id="4639870">(</span><span class="ident" id="4639871">s1</span><span class="op" id="4639873">.</span><span class="ident" id="4639874">certificates</span><span class="op" id="4639886">)</span>&nbsp;<span class="op" id="4639888">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639892">return</span>&nbsp;<span class="builtintype" id="4639899">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4639906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639910">for</span>&nbsp;<span class="ident" id="4639914">i</span>&nbsp;<span class="op" id="4639916">:=</span>&nbsp;<span class="keyword" id="4639919">range</span>&nbsp;<span class="ident" id="4639925">s</span><span class="op" id="4639926">.</span><span class="ident" id="4639927">certificates</span>&nbsp;<span class="op" id="4639940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4639944">if</span>&nbsp;<span class="op" id="4639947">!</span><span class="ident" id="4639948">bytes</span><span class="op" id="4639953">.</span><span class="ident" id="4639954">Equal</span><span class="op" id="4639959">(</span><span class="ident" id="4639960">s</span><span class="op" id="4639961">.</span><span class="ident" id="4639962">certificates</span><span class="op" id="4639974">[</span><span class="ident" id="4639975">i</span><span class="op" id="4639976">]</span><span class="op" id="4639977">,</span>&nbsp;<span class="ident" id="4639979">s1</span><span class="op" id="4639981">.</span><span class="ident" id="4639982">certificates</span><span class="op" id="4639994">[</span><span class="ident" id="4639995">i</span><span class="op" id="4639996">]</span><span class="op" id="4639997">)</span>&nbsp;<span class="op" id="4639999">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640004">return</span>&nbsp;<span class="builtintype" id="4640011">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640026">return</span>&nbsp;<span class="builtintype" id="4640033">true</span><br>
<span class="lineno">50</span><span class="op" id="4640038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4640041">func</span>&nbsp;<span class="op" id="4640046">(</span><span class="ident" id="4640047">s</span>&nbsp;<span class="op" id="4640049">*</span><span class="ident" id="4640050">sessionState</span><span class="op" id="4640062">)</span>&nbsp;<span class="ident" id="4640064">marshal</span><span class="op" id="4640071">(</span><span class="op" id="4640072">)</span>&nbsp;<span class="op" id="4640074">[</span><span class="op" id="4640075">]</span><span class="builtintype" id="4640076">byte</span>&nbsp;<span class="op" id="4640081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640084">length</span>&nbsp;<span class="op" id="4640091">:=</span>&nbsp;<span class="num" id="4640094">2</span>&nbsp;<span class="op" id="4640096">+</span>&nbsp;<span class="num" id="4640098">2</span>&nbsp;<span class="op" id="4640100">+</span>&nbsp;<span class="num" id="4640102">2</span>&nbsp;<span class="op" id="4640104">+</span>&nbsp;<span class="builtinfunc" id="4640106">len</span><span class="op" id="4640109">(</span><span class="ident" id="4640110">s</span><span class="op" id="4640111">.</span><span class="ident" id="4640112">masterSecret</span><span class="op" id="4640124">)</span>&nbsp;<span class="op" id="4640126">+</span>&nbsp;<span class="num" id="4640128">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640131">for</span>&nbsp;<span class="ident" id="4640135">_</span><span class="op" id="4640136">,</span>&nbsp;<span class="ident" id="4640138">cert</span>&nbsp;<span class="op" id="4640143">:=</span>&nbsp;<span class="keyword" id="4640146">range</span>&nbsp;<span class="ident" id="4640152">s</span><span class="op" id="4640153">.</span><span class="ident" id="4640154">certificates</span>&nbsp;<span class="op" id="4640167">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640171">length</span>&nbsp;<span class="op" id="4640178">+=</span>&nbsp;<span class="num" id="4640181">4</span>&nbsp;<span class="op" id="4640183">+</span>&nbsp;<span class="builtinfunc" id="4640185">len</span><span class="op" id="4640188">(</span><span class="ident" id="4640189">cert</span><span class="op" id="4640193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640196">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640200">ret</span>&nbsp;<span class="op" id="4640204">:=</span>&nbsp;<span class="builtinfunc" id="4640207">make</span><span class="op" id="4640211">(</span><span class="op" id="4640212">[</span><span class="op" id="4640213">]</span><span class="builtintype" id="4640214">byte</span><span class="op" id="4640218">,</span>&nbsp;<span class="ident" id="4640220">length</span><span class="op" id="4640226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640229">x</span>&nbsp;<span class="op" id="4640231">:=</span>&nbsp;<span class="ident" id="4640234">ret</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640239">x</span><span class="op" id="4640240">[</span><span class="num" id="4640241">0</span><span class="op" id="4640242">]</span>&nbsp;<span class="op" id="4640244">=</span>&nbsp;<span class="builtintype" id="4640246">byte</span><span class="op" id="4640250">(</span><span class="ident" id="4640251">s</span><span class="op" id="4640252">.</span><span class="ident" id="4640253">vers</span>&nbsp;<span class="op" id="4640258">&gt;&gt;</span>&nbsp;<span class="num" id="4640261">8</span><span class="op" id="4640262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640265">x</span><span class="op" id="4640266">[</span><span class="num" id="4640267">1</span><span class="op" id="4640268">]</span>&nbsp;<span class="op" id="4640270">=</span>&nbsp;<span class="builtintype" id="4640272">byte</span><span class="op" id="4640276">(</span><span class="ident" id="4640277">s</span><span class="op" id="4640278">.</span><span class="ident" id="4640279">vers</span><span class="op" id="4640283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640286">x</span><span class="op" id="4640287">[</span><span class="num" id="4640288">2</span><span class="op" id="4640289">]</span>&nbsp;<span class="op" id="4640291">=</span>&nbsp;<span class="builtintype" id="4640293">byte</span><span class="op" id="4640297">(</span><span class="ident" id="4640298">s</span><span class="op" id="4640299">.</span><span class="ident" id="4640300">cipherSuite</span>&nbsp;<span class="op" id="4640312">&gt;&gt;</span>&nbsp;<span class="num" id="4640315">8</span><span class="op" id="4640316">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640319">x</span><span class="op" id="4640320">[</span><span class="num" id="4640321">3</span><span class="op" id="4640322">]</span>&nbsp;<span class="op" id="4640324">=</span>&nbsp;<span class="builtintype" id="4640326">byte</span><span class="op" id="4640330">(</span><span class="ident" id="4640331">s</span><span class="op" id="4640332">.</span><span class="ident" id="4640333">cipherSuite</span><span class="op" id="4640344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640347">x</span><span class="op" id="4640348">[</span><span class="num" id="4640349">4</span><span class="op" id="4640350">]</span>&nbsp;<span class="op" id="4640352">=</span>&nbsp;<span class="builtintype" id="4640354">byte</span><span class="op" id="4640358">(</span><span class="builtinfunc" id="4640359">len</span><span class="op" id="4640362">(</span><span class="ident" id="4640363">s</span><span class="op" id="4640364">.</span><span class="ident" id="4640365">masterSecret</span><span class="op" id="4640377">)</span>&nbsp;<span class="op" id="4640379">&gt;&gt;</span>&nbsp;<span class="num" id="4640382">8</span><span class="op" id="4640383">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640386">x</span><span class="op" id="4640387">[</span><span class="num" id="4640388">5</span><span class="op" id="4640389">]</span>&nbsp;<span class="op" id="4640391">=</span>&nbsp;<span class="builtintype" id="4640393">byte</span><span class="op" id="4640397">(</span><span class="builtinfunc" id="4640398">len</span><span class="op" id="4640401">(</span><span class="ident" id="4640402">s</span><span class="op" id="4640403">.</span><span class="ident" id="4640404">masterSecret</span><span class="op" id="4640416">)</span><span class="op" id="4640417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640420">x</span>&nbsp;<span class="op" id="4640422">=</span>&nbsp;<span class="ident" id="4640424">x</span><span class="op" id="4640425">[</span><span class="num" id="4640426">6</span><span class="op" id="4640427">:</span><span class="op" id="4640428">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4640431">copy</span><span class="op" id="4640435">(</span><span class="ident" id="4640436">x</span><span class="op" id="4640437">,</span>&nbsp;<span class="ident" id="4640439">s</span><span class="op" id="4640440">.</span><span class="ident" id="4640441">masterSecret</span><span class="op" id="4640453">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640456">x</span>&nbsp;<span class="op" id="4640458">=</span>&nbsp;<span class="ident" id="4640460">x</span><span class="op" id="4640461">[</span><span class="builtinfunc" id="4640462">len</span><span class="op" id="4640465">(</span><span class="ident" id="4640466">s</span><span class="op" id="4640467">.</span><span class="ident" id="4640468">masterSecret</span><span class="op" id="4640480">)</span><span class="op" id="4640481">:</span><span class="op" id="4640482">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640486">x</span><span class="op" id="4640487">[</span><span class="num" id="4640488">0</span><span class="op" id="4640489">]</span>&nbsp;<span class="op" id="4640491">=</span>&nbsp;<span class="builtintype" id="4640493">byte</span><span class="op" id="4640497">(</span><span class="builtinfunc" id="4640498">len</span><span class="op" id="4640501">(</span><span class="ident" id="4640502">s</span><span class="op" id="4640503">.</span><span class="ident" id="4640504">certificates</span><span class="op" id="4640516">)</span>&nbsp;<span class="op" id="4640518">&gt;&gt;</span>&nbsp;<span class="num" id="4640521">8</span><span class="op" id="4640522">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640525">x</span><span class="op" id="4640526">[</span><span class="num" id="4640527">1</span><span class="op" id="4640528">]</span>&nbsp;<span class="op" id="4640530">=</span>&nbsp;<span class="builtintype" id="4640532">byte</span><span class="op" id="4640536">(</span><span class="builtinfunc" id="4640537">len</span><span class="op" id="4640540">(</span><span class="ident" id="4640541">s</span><span class="op" id="4640542">.</span><span class="ident" id="4640543">certificates</span><span class="op" id="4640555">)</span><span class="op" id="4640556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640559">x</span>&nbsp;<span class="op" id="4640561">=</span>&nbsp;<span class="ident" id="4640563">x</span><span class="op" id="4640564">[</span><span class="num" id="4640565">2</span><span class="op" id="4640566">:</span><span class="op" id="4640567">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640571">for</span>&nbsp;<span class="ident" id="4640575">_</span><span class="op" id="4640576">,</span>&nbsp;<span class="ident" id="4640578">cert</span>&nbsp;<span class="op" id="4640583">:=</span>&nbsp;<span class="keyword" id="4640586">range</span>&nbsp;<span class="ident" id="4640592">s</span><span class="op" id="4640593">.</span><span class="ident" id="4640594">certificates</span>&nbsp;<span class="op" id="4640607">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640611">x</span><span class="op" id="4640612">[</span><span class="num" id="4640613">0</span><span class="op" id="4640614">]</span>&nbsp;<span class="op" id="4640616">=</span>&nbsp;<span class="builtintype" id="4640618">byte</span><span class="op" id="4640622">(</span><span class="builtinfunc" id="4640623">len</span><span class="op" id="4640626">(</span><span class="ident" id="4640627">cert</span><span class="op" id="4640631">)</span>&nbsp;<span class="op" id="4640633">&gt;&gt;</span>&nbsp;<span class="num" id="4640636">24</span><span class="op" id="4640638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640642">x</span><span class="op" id="4640643">[</span><span class="num" id="4640644">1</span><span class="op" id="4640645">]</span>&nbsp;<span class="op" id="4640647">=</span>&nbsp;<span class="builtintype" id="4640649">byte</span><span class="op" id="4640653">(</span><span class="builtinfunc" id="4640654">len</span><span class="op" id="4640657">(</span><span class="ident" id="4640658">cert</span><span class="op" id="4640662">)</span>&nbsp;<span class="op" id="4640664">&gt;&gt;</span>&nbsp;<span class="num" id="4640667">16</span><span class="op" id="4640669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640673">x</span><span class="op" id="4640674">[</span><span class="num" id="4640675">2</span><span class="op" id="4640676">]</span>&nbsp;<span class="op" id="4640678">=</span>&nbsp;<span class="builtintype" id="4640680">byte</span><span class="op" id="4640684">(</span><span class="builtinfunc" id="4640685">len</span><span class="op" id="4640688">(</span><span class="ident" id="4640689">cert</span><span class="op" id="4640693">)</span>&nbsp;<span class="op" id="4640695">&gt;&gt;</span>&nbsp;<span class="num" id="4640698">8</span><span class="op" id="4640699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640703">x</span><span class="op" id="4640704">[</span><span class="num" id="4640705">3</span><span class="op" id="4640706">]</span>&nbsp;<span class="op" id="4640708">=</span>&nbsp;<span class="builtintype" id="4640710">byte</span><span class="op" id="4640714">(</span><span class="builtinfunc" id="4640715">len</span><span class="op" id="4640718">(</span><span class="ident" id="4640719">cert</span><span class="op" id="4640723">)</span><span class="op" id="4640724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4640728">copy</span><span class="op" id="4640732">(</span><span class="ident" id="4640733">x</span><span class="op" id="4640734">[</span><span class="num" id="4640735">4</span><span class="op" id="4640736">:</span><span class="op" id="4640737">]</span><span class="op" id="4640738">,</span>&nbsp;<span class="ident" id="4640740">cert</span><span class="op" id="4640744">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640748">x</span>&nbsp;<span class="op" id="4640750">=</span>&nbsp;<span class="ident" id="4640752">x</span><span class="op" id="4640753">[</span><span class="num" id="4640754">4</span><span class="op" id="4640755">+</span><span class="builtinfunc" id="4640756">len</span><span class="op" id="4640759">(</span><span class="ident" id="4640760">cert</span><span class="op" id="4640764">)</span><span class="op" id="4640765">:</span><span class="op" id="4640766">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640773">return</span>&nbsp;<span class="ident" id="4640780">ret</span><br>
<span class="lineno"></span><span class="op" id="4640784">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="4640787">func</span>&nbsp;<span class="op" id="4640792">(</span><span class="ident" id="4640793">s</span>&nbsp;<span class="op" id="4640795">*</span><span class="ident" id="4640796">sessionState</span><span class="op" id="4640808">)</span>&nbsp;<span class="ident" id="4640810">unmarshal</span><span class="op" id="4640819">(</span><span class="ident" id="4640820">data</span>&nbsp;<span class="op" id="4640825">[</span><span class="op" id="4640826">]</span><span class="builtintype" id="4640827">byte</span><span class="op" id="4640831">)</span>&nbsp;<span class="builtintype" id="4640833">bool</span>&nbsp;<span class="op" id="4640838">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640841">if</span>&nbsp;<span class="builtinfunc" id="4640844">len</span><span class="op" id="4640847">(</span><span class="ident" id="4640848">data</span><span class="op" id="4640852">)</span>&nbsp;<span class="op" id="4640854">&lt;</span>&nbsp;<span class="num" id="4640856">8</span>&nbsp;<span class="op" id="4640858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4640862">return</span>&nbsp;<span class="builtintype" id="4640869">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4640876">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640880">s</span><span class="op" id="4640881">.</span><span class="ident" id="4640882">vers</span>&nbsp;<span class="op" id="4640887">=</span>&nbsp;<span class="builtintype" id="4640889">uint16</span><span class="op" id="4640895">(</span><span class="ident" id="4640896">data</span><span class="op" id="4640900">[</span><span class="num" id="4640901">0</span><span class="op" id="4640902">]</span><span class="op" id="4640903">)</span><span class="op" id="4640904">&lt;&lt;</span><span class="num" id="4640906">8</span>&nbsp;<span class="op" id="4640908">|</span>&nbsp;<span class="builtintype" id="4640910">uint16</span><span class="op" id="4640916">(</span><span class="ident" id="4640917">data</span><span class="op" id="4640921">[</span><span class="num" id="4640922">1</span><span class="op" id="4640923">]</span><span class="op" id="4640924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640927">s</span><span class="op" id="4640928">.</span><span class="ident" id="4640929">cipherSuite</span>&nbsp;<span class="op" id="4640941">=</span>&nbsp;<span class="builtintype" id="4640943">uint16</span><span class="op" id="4640949">(</span><span class="ident" id="4640950">data</span><span class="op" id="4640954">[</span><span class="num" id="4640955">2</span><span class="op" id="4640956">]</span><span class="op" id="4640957">)</span><span class="op" id="4640958">&lt;&lt;</span><span class="num" id="4640960">8</span>&nbsp;<span class="op" id="4640962">|</span>&nbsp;<span class="builtintype" id="4640964">uint16</span><span class="op" id="4640970">(</span><span class="ident" id="4640971">data</span><span class="op" id="4640975">[</span><span class="num" id="4640976">3</span><span class="op" id="4640977">]</span><span class="op" id="4640978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4640981">masterSecretLen</span>&nbsp;<span class="op" id="4640997">:=</span>&nbsp;<span class="builtintype" id="4641000">int</span><span class="op" id="4641003">(</span><span class="ident" id="4641004">data</span><span class="op" id="4641008">[</span><span class="num" id="4641009">4</span><span class="op" id="4641010">]</span><span class="op" id="4641011">)</span><span class="op" id="4641012">&lt;&lt;</span><span class="num" id="4641014">8</span>&nbsp;<span class="op" id="4641016">|</span>&nbsp;<span class="builtintype" id="4641018">int</span><span class="op" id="4641021">(</span><span class="ident" id="4641022">data</span><span class="op" id="4641026">[</span><span class="num" id="4641027">5</span><span class="op" id="4641028">]</span><span class="op" id="4641029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641032">data</span>&nbsp;<span class="op" id="4641037">=</span>&nbsp;<span class="ident" id="4641039">data</span><span class="op" id="4641043">[</span><span class="num" id="4641044">6</span><span class="op" id="4641045">:</span><span class="op" id="4641046">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641049">if</span>&nbsp;<span class="builtinfunc" id="4641052">len</span><span class="op" id="4641055">(</span><span class="ident" id="4641056">data</span><span class="op" id="4641060">)</span>&nbsp;<span class="op" id="4641062">&lt;</span>&nbsp;<span class="ident" id="4641064">masterSecretLen</span>&nbsp;<span class="op" id="4641080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641084">return</span>&nbsp;<span class="builtintype" id="4641091">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641102">s</span><span class="op" id="4641103">.</span><span class="ident" id="4641104">masterSecret</span>&nbsp;<span class="op" id="4641117">=</span>&nbsp;<span class="ident" id="4641119">data</span><span class="op" id="4641123">[</span><span class="op" id="4641124">:</span><span class="ident" id="4641125">masterSecretLen</span><span class="op" id="4641140">]</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641143">data</span>&nbsp;<span class="op" id="4641148">=</span>&nbsp;<span class="ident" id="4641150">data</span><span class="op" id="4641154">[</span><span class="ident" id="4641155">masterSecretLen</span><span class="op" id="4641170">:</span><span class="op" id="4641171">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641175">if</span>&nbsp;<span class="builtinfunc" id="4641178">len</span><span class="op" id="4641181">(</span><span class="ident" id="4641182">data</span><span class="op" id="4641186">)</span>&nbsp;<span class="op" id="4641188">&lt;</span>&nbsp;<span class="num" id="4641190">2</span>&nbsp;<span class="op" id="4641192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641196">return</span>&nbsp;<span class="builtintype" id="4641203">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641210">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641214">numCerts</span>&nbsp;<span class="op" id="4641223">:=</span>&nbsp;<span class="builtintype" id="4641226">int</span><span class="op" id="4641229">(</span><span class="ident" id="4641230">data</span><span class="op" id="4641234">[</span><span class="num" id="4641235">0</span><span class="op" id="4641236">]</span><span class="op" id="4641237">)</span><span class="op" id="4641238">&lt;&lt;</span><span class="num" id="4641240">8</span>&nbsp;<span class="op" id="4641242">|</span>&nbsp;<span class="builtintype" id="4641244">int</span><span class="op" id="4641247">(</span><span class="ident" id="4641248">data</span><span class="op" id="4641252">[</span><span class="num" id="4641253">1</span><span class="op" id="4641254">]</span><span class="op" id="4641255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641258">data</span>&nbsp;<span class="op" id="4641263">=</span>&nbsp;<span class="ident" id="4641265">data</span><span class="op" id="4641269">[</span><span class="num" id="4641270">2</span><span class="op" id="4641271">:</span><span class="op" id="4641272">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641276">s</span><span class="op" id="4641277">.</span><span class="ident" id="4641278">certificates</span>&nbsp;<span class="op" id="4641291">=</span>&nbsp;<span class="builtinfunc" id="4641293">make</span><span class="op" id="4641297">(</span><span class="op" id="4641298">[</span><span class="op" id="4641299">]</span><span class="op" id="4641300">[</span><span class="op" id="4641301">]</span><span class="builtintype" id="4641302">byte</span><span class="op" id="4641306">,</span>&nbsp;<span class="ident" id="4641308">numCerts</span><span class="op" id="4641316">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641319">for</span>&nbsp;<span class="ident" id="4641323">i</span>&nbsp;<span class="op" id="4641325">:=</span>&nbsp;<span class="keyword" id="4641328">range</span>&nbsp;<span class="ident" id="4641334">s</span><span class="op" id="4641335">.</span><span class="ident" id="4641336">certificates</span>&nbsp;<span class="op" id="4641349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641353">if</span>&nbsp;<span class="builtinfunc" id="4641356">len</span><span class="op" id="4641359">(</span><span class="ident" id="4641360">data</span><span class="op" id="4641364">)</span>&nbsp;<span class="op" id="4641366">&lt;</span>&nbsp;<span class="num" id="4641368">4</span>&nbsp;<span class="op" id="4641370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641375">return</span>&nbsp;<span class="builtintype" id="4641382">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641394">certLen</span>&nbsp;<span class="op" id="4641402">:=</span>&nbsp;<span class="builtintype" id="4641405">int</span><span class="op" id="4641408">(</span><span class="ident" id="4641409">data</span><span class="op" id="4641413">[</span><span class="num" id="4641414">0</span><span class="op" id="4641415">]</span><span class="op" id="4641416">)</span><span class="op" id="4641417">&lt;&lt;</span><span class="num" id="4641419">24</span>&nbsp;<span class="op" id="4641422">|</span>&nbsp;<span class="builtintype" id="4641424">int</span><span class="op" id="4641427">(</span><span class="ident" id="4641428">data</span><span class="op" id="4641432">[</span><span class="num" id="4641433">1</span><span class="op" id="4641434">]</span><span class="op" id="4641435">)</span><span class="op" id="4641436">&lt;&lt;</span><span class="num" id="4641438">16</span>&nbsp;<span class="op" id="4641441">|</span>&nbsp;<span class="builtintype" id="4641443">int</span><span class="op" id="4641446">(</span><span class="ident" id="4641447">data</span><span class="op" id="4641451">[</span><span class="num" id="4641452">2</span><span class="op" id="4641453">]</span><span class="op" id="4641454">)</span><span class="op" id="4641455">&lt;&lt;</span><span class="num" id="4641457">8</span>&nbsp;<span class="op" id="4641459">|</span>&nbsp;<span class="builtintype" id="4641461">int</span><span class="op" id="4641464">(</span><span class="ident" id="4641465">data</span><span class="op" id="4641469">[</span><span class="num" id="4641470">3</span><span class="op" id="4641471">]</span><span class="op" id="4641472">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641476">data</span>&nbsp;<span class="op" id="4641481">=</span>&nbsp;<span class="ident" id="4641483">data</span><span class="op" id="4641487">[</span><span class="num" id="4641488">4</span><span class="op" id="4641489">:</span><span class="op" id="4641490">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641494">if</span>&nbsp;<span class="ident" id="4641497">certLen</span>&nbsp;<span class="op" id="4641505">&lt;</span>&nbsp;<span class="num" id="4641507">0</span>&nbsp;<span class="op" id="4641509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641514">return</span>&nbsp;<span class="builtintype" id="4641521">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641533">if</span>&nbsp;<span class="builtinfunc" id="4641536">len</span><span class="op" id="4641539">(</span><span class="ident" id="4641540">data</span><span class="op" id="4641544">)</span>&nbsp;<span class="op" id="4641546">&lt;</span>&nbsp;<span class="ident" id="4641548">certLen</span>&nbsp;<span class="op" id="4641556">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641561">return</span>&nbsp;<span class="builtintype" id="4641568">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641580">s</span><span class="op" id="4641581">.</span><span class="ident" id="4641582">certificates</span><span class="op" id="4641594">[</span><span class="ident" id="4641595">i</span><span class="op" id="4641596">]</span>&nbsp;<span class="op" id="4641598">=</span>&nbsp;<span class="ident" id="4641600">data</span><span class="op" id="4641604">[</span><span class="op" id="4641605">:</span><span class="ident" id="4641606">certLen</span><span class="op" id="4641613">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641617">data</span>&nbsp;<span class="op" id="4641622">=</span>&nbsp;<span class="ident" id="4641624">data</span><span class="op" id="4641628">[</span><span class="ident" id="4641629">certLen</span><span class="op" id="4641636">:</span><span class="op" id="4641637">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641640">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641644">if</span>&nbsp;<span class="builtinfunc" id="4641647">len</span><span class="op" id="4641650">(</span><span class="ident" id="4641651">data</span><span class="op" id="4641655">)</span>&nbsp;<span class="op" id="4641657">&gt;</span>&nbsp;<span class="num" id="4641659">0</span>&nbsp;<span class="op" id="4641661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641665">return</span>&nbsp;<span class="builtintype" id="4641672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4641679">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641683">return</span>&nbsp;<span class="builtintype" id="4641690">true</span><br>
<span class="lineno"></span><span class="op" id="4641695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4641698">func</span>&nbsp;<span class="op" id="4641703">(</span><span class="ident" id="4641704">c</span>&nbsp;<span class="op" id="4641706">*</span><span class="ident" id="4641707">Conn</span><span class="op" id="4641711">)</span>&nbsp;<span class="ident" id="4641713">encryptTicket</span><span class="op" id="4641726">(</span><span class="ident" id="4641727">state</span>&nbsp;<span class="op" id="4641733">*</span><span class="ident" id="4641734">sessionState</span><span class="op" id="4641746">)</span>&nbsp;<span class="op" id="4641748">(</span><span class="op" id="4641749">[</span><span class="op" id="4641750">]</span><span class="builtintype" id="4641751">byte</span><span class="op" id="4641755">,</span>&nbsp;<span class="builtintype" id="4641757">error</span><span class="op" id="4641762">)</span>&nbsp;<span class="op" id="4641764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641767">serialized</span>&nbsp;<span class="op" id="4641778">:=</span>&nbsp;<span class="ident" id="4641781">state</span><span class="op" id="4641786">.</span><span class="ident" id="4641787">marshal</span><span class="op" id="4641794">(</span><span class="op" id="4641795">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641798">encrypted</span>&nbsp;<span class="op" id="4641808">:=</span>&nbsp;<span class="builtinfunc" id="4641811">make</span><span class="op" id="4641815">(</span><span class="op" id="4641816">[</span><span class="op" id="4641817">]</span><span class="builtintype" id="4641818">byte</span><span class="op" id="4641822">,</span>&nbsp;<span class="ident" id="4641824">aes</span><span class="op" id="4641827">.</span><span class="ident" id="4641828">BlockSize</span><span class="op" id="4641837">+</span><span class="builtinfunc" id="4641838">len</span><span class="op" id="4641841">(</span><span class="ident" id="4641842">serialized</span><span class="op" id="4641852">)</span><span class="op" id="4641853">+</span><span class="ident" id="4641854">sha256</span><span class="op" id="4641860">.</span><span class="ident" id="4641861">Size</span><span class="op" id="4641865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641868">iv</span>&nbsp;<span class="op" id="4641871">:=</span>&nbsp;<span class="ident" id="4641874">encrypted</span><span class="op" id="4641883">[</span><span class="op" id="4641884">:</span><span class="ident" id="4641885">aes</span><span class="op" id="4641888">.</span><span class="ident" id="4641889">BlockSize</span><span class="op" id="4641898">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4641901">macBytes</span>&nbsp;<span class="op" id="4641910">:=</span>&nbsp;<span class="ident" id="4641913">encrypted</span><span class="op" id="4641922">[</span><span class="builtinfunc" id="4641923">len</span><span class="op" id="4641926">(</span><span class="ident" id="4641927">encrypted</span><span class="op" id="4641936">)</span><span class="op" id="4641937">-</span><span class="ident" id="4641938">sha256</span><span class="op" id="4641944">.</span><span class="ident" id="4641945">Size</span><span class="op" id="4641949">:</span><span class="op" id="4641950">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4641954">if</span>&nbsp;<span class="ident" id="4641957">_</span><span class="op" id="4641958">,</span>&nbsp;<span class="ident" id="4641960">err</span>&nbsp;<span class="op" id="4641964">:=</span>&nbsp;<span class="ident" id="4641967">io</span><span class="op" id="4641969">.</span><span class="ident" id="4641970">ReadFull</span><span class="op" id="4641978">(</span><span class="ident" id="4641979">c</span><span class="op" id="4641980">.</span><span class="ident" id="4641981">config</span><span class="op" id="4641987">.</span><span class="ident" id="4641988">rand</span><span class="op" id="4641992">(</span><span class="op" id="4641993">)</span><span class="op" id="4641994">,</span>&nbsp;<span class="ident" id="4641996">iv</span><span class="op" id="4641998">)</span><span class="op" id="4641999">;</span>&nbsp;<span class="ident" id="4642001">err</span>&nbsp;<span class="op" id="4642005">!=</span>&nbsp;<span class="ident" id="4642008">nil</span>&nbsp;<span class="op" id="4642012">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642016">return</span>&nbsp;<span class="ident" id="4642023">nil</span><span class="op" id="4642026">,</span>&nbsp;<span class="ident" id="4642028">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4642033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642036">block</span><span class="op" id="4642041">,</span>&nbsp;<span class="ident" id="4642043">err</span>&nbsp;<span class="op" id="4642047">:=</span>&nbsp;<span class="ident" id="4642050">aes</span><span class="op" id="4642053">.</span><span class="ident" id="4642054">NewCipher</span><span class="op" id="4642063">(</span><span class="ident" id="4642064">c</span><span class="op" id="4642065">.</span><span class="ident" id="4642066">config</span><span class="op" id="4642072">.</span><span class="ident" id="4642073">SessionTicketKey</span><span class="op" id="4642089">[</span><span class="op" id="4642090">:</span><span class="num" id="4642091">16</span><span class="op" id="4642093">]</span><span class="op" id="4642094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642097">if</span>&nbsp;<span class="ident" id="4642100">err</span>&nbsp;<span class="op" id="4642104">!=</span>&nbsp;<span class="ident" id="4642107">nil</span>&nbsp;<span class="op" id="4642111">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642115">return</span>&nbsp;<span class="ident" id="4642122">nil</span><span class="op" id="4642125">,</span>&nbsp;<span class="ident" id="4642127">errors</span><span class="op" id="4642133">.</span><span class="ident" id="4642134">New</span><span class="op" id="4642137">(</span><span class="string" id="4642138">&#34;tls:&nbsp;failed&nbsp;to&nbsp;create&nbsp;cipher&nbsp;while&nbsp;encrypting&nbsp;ticket:&nbsp;&#34;</span>&nbsp;<span class="op" id="4642195">+</span>&nbsp;<span class="ident" id="4642197">err</span><span class="op" id="4642200">.</span><span class="ident" id="4642201">Error</span><span class="op" id="4642206">(</span><span class="op" id="4642207">)</span><span class="op" id="4642208">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4642211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642214">cipher</span><span class="op" id="4642220">.</span><span class="ident" id="4642221">NewCTR</span><span class="op" id="4642227">(</span><span class="ident" id="4642228">block</span><span class="op" id="4642233">,</span>&nbsp;<span class="ident" id="4642235">iv</span><span class="op" id="4642237">)</span><span class="op" id="4642238">.</span><span class="ident" id="4642239">XORKeyStream</span><span class="op" id="4642251">(</span><span class="ident" id="4642252">encrypted</span><span class="op" id="4642261">[</span><span class="ident" id="4642262">aes</span><span class="op" id="4642265">.</span><span class="ident" id="4642266">BlockSize</span><span class="op" id="4642275">:</span><span class="op" id="4642276">]</span><span class="op" id="4642277">,</span>&nbsp;<span class="ident" id="4642279">serialized</span><span class="op" id="4642289">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642293">mac</span>&nbsp;<span class="op" id="4642297">:=</span>&nbsp;<span class="ident" id="4642300">hmac</span><span class="op" id="4642304">.</span><span class="ident" id="4642305">New</span><span class="op" id="4642308">(</span><span class="ident" id="4642309">sha256</span><span class="op" id="4642315">.</span><span class="ident" id="4642316">New</span><span class="op" id="4642319">,</span>&nbsp;<span class="ident" id="4642321">c</span><span class="op" id="4642322">.</span><span class="ident" id="4642323">config</span><span class="op" id="4642329">.</span><span class="ident" id="4642330">SessionTicketKey</span><span class="op" id="4642346">[</span><span class="num" id="4642347">16</span><span class="op" id="4642349">:</span><span class="num" id="4642350">32</span><span class="op" id="4642352">]</span><span class="op" id="4642353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642356">mac</span><span class="op" id="4642359">.</span><span class="ident" id="4642360">Write</span><span class="op" id="4642365">(</span><span class="ident" id="4642366">encrypted</span><span class="op" id="4642375">[</span><span class="op" id="4642376">:</span><span class="builtinfunc" id="4642377">len</span><span class="op" id="4642380">(</span><span class="ident" id="4642381">encrypted</span><span class="op" id="4642390">)</span><span class="op" id="4642391">-</span><span class="ident" id="4642392">sha256</span><span class="op" id="4642398">.</span><span class="ident" id="4642399">Size</span><span class="op" id="4642403">]</span><span class="op" id="4642404">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642407">mac</span><span class="op" id="4642410">.</span><span class="ident" id="4642411">Sum</span><span class="op" id="4642414">(</span><span class="ident" id="4642415">macBytes</span><span class="op" id="4642423">[</span><span class="op" id="4642424">:</span><span class="num" id="4642425">0</span><span class="op" id="4642426">]</span><span class="op" id="4642427">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642431">return</span>&nbsp;<span class="ident" id="4642438">encrypted</span><span class="op" id="4642447">,</span>&nbsp;<span class="ident" id="4642449">nil</span><br>
<span class="lineno"></span><span class="op" id="4642453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">155</span><span class="keyword" id="4642456">func</span>&nbsp;<span class="op" id="4642461">(</span><span class="ident" id="4642462">c</span>&nbsp;<span class="op" id="4642464">*</span><span class="ident" id="4642465">Conn</span><span class="op" id="4642469">)</span>&nbsp;<span class="ident" id="4642471">decryptTicket</span><span class="op" id="4642484">(</span><span class="ident" id="4642485">encrypted</span>&nbsp;<span class="op" id="4642495">[</span><span class="op" id="4642496">]</span><span class="builtintype" id="4642497">byte</span><span class="op" id="4642501">)</span>&nbsp;<span class="op" id="4642503">(</span><span class="op" id="4642504">*</span><span class="ident" id="4642505">sessionState</span><span class="op" id="4642517">,</span>&nbsp;<span class="builtintype" id="4642519">bool</span><span class="op" id="4642523">)</span>&nbsp;<span class="op" id="4642525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642528">if</span>&nbsp;<span class="ident" id="4642531">c</span><span class="op" id="4642532">.</span><span class="ident" id="4642533">config</span><span class="op" id="4642539">.</span><span class="ident" id="4642540">SessionTicketsDisabled</span>&nbsp;<span class="op" id="4642563">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4642568">len</span><span class="op" id="4642571">(</span><span class="ident" id="4642572">encrypted</span><span class="op" id="4642581">)</span>&nbsp;<span class="op" id="4642583">&lt;</span>&nbsp;<span class="ident" id="4642585">aes</span><span class="op" id="4642588">.</span><span class="ident" id="4642589">BlockSize</span><span class="op" id="4642598">+</span><span class="ident" id="4642599">sha256</span><span class="op" id="4642605">.</span><span class="ident" id="4642606">Size</span>&nbsp;<span class="op" id="4642611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642615">return</span>&nbsp;<span class="ident" id="4642622">nil</span><span class="op" id="4642625">,</span>&nbsp;<span class="builtintype" id="4642627">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4642634">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642638">iv</span>&nbsp;<span class="op" id="4642641">:=</span>&nbsp;<span class="ident" id="4642644">encrypted</span><span class="op" id="4642653">[</span><span class="op" id="4642654">:</span><span class="ident" id="4642655">aes</span><span class="op" id="4642658">.</span><span class="ident" id="4642659">BlockSize</span><span class="op" id="4642668">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642671">macBytes</span>&nbsp;<span class="op" id="4642680">:=</span>&nbsp;<span class="ident" id="4642683">encrypted</span><span class="op" id="4642692">[</span><span class="builtinfunc" id="4642693">len</span><span class="op" id="4642696">(</span><span class="ident" id="4642697">encrypted</span><span class="op" id="4642706">)</span><span class="op" id="4642707">-</span><span class="ident" id="4642708">sha256</span><span class="op" id="4642714">.</span><span class="ident" id="4642715">Size</span><span class="op" id="4642719">:</span><span class="op" id="4642720">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642724">mac</span>&nbsp;<span class="op" id="4642728">:=</span>&nbsp;<span class="ident" id="4642731">hmac</span><span class="op" id="4642735">.</span><span class="ident" id="4642736">New</span><span class="op" id="4642739">(</span><span class="ident" id="4642740">sha256</span><span class="op" id="4642746">.</span><span class="ident" id="4642747">New</span><span class="op" id="4642750">,</span>&nbsp;<span class="ident" id="4642752">c</span><span class="op" id="4642753">.</span><span class="ident" id="4642754">config</span><span class="op" id="4642760">.</span><span class="ident" id="4642761">SessionTicketKey</span><span class="op" id="4642777">[</span><span class="num" id="4642778">16</span><span class="op" id="4642780">:</span><span class="num" id="4642781">32</span><span class="op" id="4642783">]</span><span class="op" id="4642784">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642787">mac</span><span class="op" id="4642790">.</span><span class="ident" id="4642791">Write</span><span class="op" id="4642796">(</span><span class="ident" id="4642797">encrypted</span><span class="op" id="4642806">[</span><span class="op" id="4642807">:</span><span class="builtinfunc" id="4642808">len</span><span class="op" id="4642811">(</span><span class="ident" id="4642812">encrypted</span><span class="op" id="4642821">)</span><span class="op" id="4642822">-</span><span class="ident" id="4642823">sha256</span><span class="op" id="4642829">.</span><span class="ident" id="4642830">Size</span><span class="op" id="4642834">]</span><span class="op" id="4642835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642838">expected</span>&nbsp;<span class="op" id="4642847">:=</span>&nbsp;<span class="ident" id="4642850">mac</span><span class="op" id="4642853">.</span><span class="ident" id="4642854">Sum</span><span class="op" id="4642857">(</span><span class="ident" id="4642858">nil</span><span class="op" id="4642861">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642865">if</span>&nbsp;<span class="ident" id="4642868">subtle</span><span class="op" id="4642874">.</span><span class="ident" id="4642875">ConstantTimeCompare</span><span class="op" id="4642894">(</span><span class="ident" id="4642895">macBytes</span><span class="op" id="4642903">,</span>&nbsp;<span class="ident" id="4642905">expected</span><span class="op" id="4642913">)</span>&nbsp;<span class="op" id="4642915">!=</span>&nbsp;<span class="num" id="4642918">1</span>&nbsp;<span class="op" id="4642920">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4642924">return</span>&nbsp;<span class="ident" id="4642931">nil</span><span class="op" id="4642934">,</span>&nbsp;<span class="builtintype" id="4642936">false</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4642943">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4642947">block</span><span class="op" id="4642952">,</span>&nbsp;<span class="ident" id="4642954">err</span>&nbsp;<span class="op" id="4642958">:=</span>&nbsp;<span class="ident" id="4642961">aes</span><span class="op" id="4642964">.</span><span class="ident" id="4642965">NewCipher</span><span class="op" id="4642974">(</span><span class="ident" id="4642975">c</span><span class="op" id="4642976">.</span><span class="ident" id="4642977">config</span><span class="op" id="4642983">.</span><span class="ident" id="4642984">SessionTicketKey</span><span class="op" id="4643000">[</span><span class="op" id="4643001">:</span><span class="num" id="4643002">16</span><span class="op" id="4643004">]</span><span class="op" id="4643005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643008">if</span>&nbsp;<span class="ident" id="4643011">err</span>&nbsp;<span class="op" id="4643015">!=</span>&nbsp;<span class="ident" id="4643018">nil</span>&nbsp;<span class="op" id="4643022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643026">return</span>&nbsp;<span class="ident" id="4643033">nil</span><span class="op" id="4643036">,</span>&nbsp;<span class="builtintype" id="4643038">false</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4643045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643048">ciphertext</span>&nbsp;<span class="op" id="4643059">:=</span>&nbsp;<span class="ident" id="4643062">encrypted</span><span class="op" id="4643071">[</span><span class="ident" id="4643072">aes</span><span class="op" id="4643075">.</span><span class="ident" id="4643076">BlockSize</span>&nbsp;<span class="op" id="4643086">:</span>&nbsp;<span class="builtinfunc" id="4643088">len</span><span class="op" id="4643091">(</span><span class="ident" id="4643092">encrypted</span><span class="op" id="4643101">)</span><span class="op" id="4643102">-</span><span class="ident" id="4643103">sha256</span><span class="op" id="4643109">.</span><span class="ident" id="4643110">Size</span><span class="op" id="4643114">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643117">plaintext</span>&nbsp;<span class="op" id="4643127">:=</span>&nbsp;<span class="ident" id="4643130">ciphertext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643142">cipher</span><span class="op" id="4643148">.</span><span class="ident" id="4643149">NewCTR</span><span class="op" id="4643155">(</span><span class="ident" id="4643156">block</span><span class="op" id="4643161">,</span>&nbsp;<span class="ident" id="4643163">iv</span><span class="op" id="4643165">)</span><span class="op" id="4643166">.</span><span class="ident" id="4643167">XORKeyStream</span><span class="op" id="4643179">(</span><span class="ident" id="4643180">plaintext</span><span class="op" id="4643189">,</span>&nbsp;<span class="ident" id="4643191">ciphertext</span><span class="op" id="4643201">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643205">state</span>&nbsp;<span class="op" id="4643211">:=</span>&nbsp;<span class="builtinfunc" id="4643214">new</span><span class="op" id="4643217">(</span><span class="ident" id="4643218">sessionState</span><span class="op" id="4643230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4643233">ok</span>&nbsp;<span class="op" id="4643236">:=</span>&nbsp;<span class="ident" id="4643239">state</span><span class="op" id="4643244">.</span><span class="ident" id="4643245">unmarshal</span><span class="op" id="4643254">(</span><span class="ident" id="4643255">plaintext</span><span class="op" id="4643264">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4643267">return</span>&nbsp;<span class="ident" id="4643274">state</span><span class="op" id="4643279">,</span>&nbsp;<span class="ident" id="4643281">ok</span><br>
<span class="lineno"></span><span class="op" id="4643284">}</span>
</div>
</body>
</html>
