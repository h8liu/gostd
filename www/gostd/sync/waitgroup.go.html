<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>sync</h2>
<ul>
<li><a href="/gostd/sync/cond.go.html">cond.go</a></li>
<li><a href="/gostd/sync/cond_test.go.html">cond_test.go</a></li>
<li><a href="/gostd/sync/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/sync/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/sync/mutex.go.html">mutex.go</a></li>
<li><a href="/gostd/sync/mutex_test.go.html">mutex_test.go</a></li>
<li><a href="/gostd/sync/once.go.html">once.go</a></li>
<li><a href="/gostd/sync/once_test.go.html">once_test.go</a></li>
<li><a href="/gostd/sync/pool.go.html">pool.go</a></li>
<li><a href="/gostd/sync/pool_test.go.html">pool_test.go</a></li>
<li><a href="/gostd/sync/race0.go.html">race0.go</a></li>
<li><a href="/gostd/sync/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/sync/runtime_sema_test.go.html">runtime_sema_test.go</a></li>
<li><a href="/gostd/sync/rwmutex.go.html">rwmutex.go</a></li>
<li><a href="/gostd/sync/rwmutex_test.go.html">rwmutex_test.go</a></li>
<li><a href="/gostd/sync/waitgroup.go.html" class="current">waitgroup.go</a></li>
<li><a href="/gostd/sync/waitgroup_test.go.html">waitgroup_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1459423">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1459478">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1459532">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1459583">package</span>&nbsp;<span class="ident" id="1459591">sync</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1459597">import</span>&nbsp;<span class="op" id="1459604">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1459607">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="1459622">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><span class="op" id="1459631">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1459634">//&nbsp;A&nbsp;WaitGroup&nbsp;waits&nbsp;for&nbsp;a&nbsp;collection&nbsp;of&nbsp;goroutines&nbsp;to&nbsp;finish.</span><br>
<span class="lineno"></span><span class="comment" id="1459697">//&nbsp;The&nbsp;main&nbsp;goroutine&nbsp;calls&nbsp;Add&nbsp;to&nbsp;set&nbsp;the&nbsp;number&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="1459750">//&nbsp;goroutines&nbsp;to&nbsp;wait&nbsp;for.&nbsp;&nbsp;Then&nbsp;each&nbsp;of&nbsp;the&nbsp;goroutines</span><br>
<span class="lineno">15</span><span class="comment" id="1459806">//&nbsp;runs&nbsp;and&nbsp;calls&nbsp;Done&nbsp;when&nbsp;finished.&nbsp;&nbsp;At&nbsp;the&nbsp;same&nbsp;time,</span><br>
<span class="lineno"></span><span class="comment" id="1459863">//&nbsp;Wait&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;block&nbsp;until&nbsp;all&nbsp;goroutines&nbsp;have&nbsp;finished.</span><br>
<span class="lineno"></span><span class="keyword" id="1459928">type</span>&nbsp;<span class="ident" id="1459933">WaitGroup</span>&nbsp;<span class="keyword" id="1459943">struct</span>&nbsp;<span class="op" id="1459950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1459953">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1459961"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1459968">counter</span>&nbsp;<span class="builtintype" id="1459976">int32</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1459983">waiters</span>&nbsp;<span class="builtintype" id="1459991">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1459998">sema</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1460006">*</span><span class="builtintype" id="1460007">uint32</span><br>
<span class="lineno"></span><span class="op" id="1460014">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1460017">//&nbsp;WaitGroup&nbsp;creates&nbsp;a&nbsp;new&nbsp;semaphore&nbsp;each&nbsp;time&nbsp;the&nbsp;old&nbsp;semaphore</span><br>
<span class="lineno">25</span><span class="comment" id="1460082">//&nbsp;is&nbsp;released.&nbsp;This&nbsp;is&nbsp;to&nbsp;avoid&nbsp;the&nbsp;following&nbsp;race:</span><br>
<span class="lineno"></span><span class="comment" id="1460135">//</span><br>
<span class="lineno"></span><span class="comment" id="1460138">//&nbsp;G1:&nbsp;Add(1)</span><br>
<span class="lineno"></span><span class="comment" id="1460152">//&nbsp;G1:&nbsp;go&nbsp;G2()</span><br>
<span class="lineno"></span><span class="comment" id="1460167">//&nbsp;G1:&nbsp;Wait()&nbsp;//&nbsp;Context&nbsp;switch&nbsp;after&nbsp;Unlock()&nbsp;and&nbsp;before&nbsp;Semacquire().</span><br>
<span class="lineno">30</span><span class="comment" id="1460239">//&nbsp;G2:&nbsp;Done()&nbsp;//&nbsp;Release&nbsp;semaphore:&nbsp;sema&nbsp;==&nbsp;1,&nbsp;waiters&nbsp;==&nbsp;0.&nbsp;G1&nbsp;doesn&#39;t&nbsp;run&nbsp;yet.</span><br>
<span class="lineno"></span><span class="comment" id="1460320">//&nbsp;G3:&nbsp;Wait()&nbsp;//&nbsp;Finds&nbsp;counter&nbsp;==&nbsp;0,&nbsp;waiters&nbsp;==&nbsp;0,&nbsp;doesn&#39;t&nbsp;block.</span><br>
<span class="lineno"></span><span class="comment" id="1460386">//&nbsp;G3:&nbsp;Add(1)&nbsp;//&nbsp;Makes&nbsp;counter&nbsp;==&nbsp;1,&nbsp;waiters&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="1460437">//&nbsp;G3:&nbsp;go&nbsp;G4()</span><br>
<span class="lineno"></span><span class="comment" id="1460452">//&nbsp;G3:&nbsp;Wait()&nbsp;//&nbsp;G1&nbsp;still&nbsp;hasn&#39;t&nbsp;run,&nbsp;G3&nbsp;finds&nbsp;sema&nbsp;==&nbsp;1,&nbsp;unblocked!&nbsp;Bug.</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="comment" id="1460527">//&nbsp;Add&nbsp;adds&nbsp;delta,&nbsp;which&nbsp;may&nbsp;be&nbsp;negative,&nbsp;to&nbsp;the&nbsp;WaitGroup&nbsp;counter.</span><br>
<span class="lineno"></span><span class="comment" id="1460595">//&nbsp;If&nbsp;the&nbsp;counter&nbsp;becomes&nbsp;zero,&nbsp;all&nbsp;goroutines&nbsp;blocked&nbsp;on&nbsp;Wait&nbsp;are&nbsp;released.</span><br>
<span class="lineno"></span><span class="comment" id="1460672">//&nbsp;If&nbsp;the&nbsp;counter&nbsp;goes&nbsp;negative,&nbsp;Add&nbsp;panics.</span><br>
<span class="lineno"></span><span class="comment" id="1460717">//</span><br>
<span class="lineno">40</span><span class="comment" id="1460720">//&nbsp;Note&nbsp;that&nbsp;calls&nbsp;with&nbsp;a&nbsp;positive&nbsp;delta&nbsp;that&nbsp;occur&nbsp;when&nbsp;the&nbsp;counter&nbsp;is&nbsp;zero</span><br>
<span class="lineno"></span><span class="comment" id="1460797">//&nbsp;must&nbsp;happen&nbsp;before&nbsp;a&nbsp;Wait.&nbsp;Calls&nbsp;with&nbsp;a&nbsp;negative&nbsp;delta,&nbsp;or&nbsp;calls&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="1460872">//&nbsp;positive&nbsp;delta&nbsp;that&nbsp;start&nbsp;when&nbsp;the&nbsp;counter&nbsp;is&nbsp;greater&nbsp;than&nbsp;zero,&nbsp;may&nbsp;happen</span><br>
<span class="lineno"></span><span class="comment" id="1460951">//&nbsp;at&nbsp;any&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="1460967">//&nbsp;Typically&nbsp;this&nbsp;means&nbsp;the&nbsp;calls&nbsp;to&nbsp;Add&nbsp;should&nbsp;execute&nbsp;before&nbsp;the&nbsp;statement</span><br>
<span class="lineno">45</span><span class="comment" id="1461044">//&nbsp;creating&nbsp;the&nbsp;goroutine&nbsp;or&nbsp;other&nbsp;event&nbsp;to&nbsp;be&nbsp;waited&nbsp;for.</span><br>
<span class="lineno"></span><span class="comment" id="1461103">//&nbsp;See&nbsp;the&nbsp;WaitGroup&nbsp;example.</span><br>
<span class="lineno"></span><span class="keyword" id="1461133">func</span>&nbsp;<span class="op" id="1461138">(</span><span class="ident" id="1461139">wg</span>&nbsp;<span class="op" id="1461142">*</span><span class="ident" id="1461143"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><span class="op" id="1461152">)</span>&nbsp;<span class="ident" id="1461154">Add</span><span class="op" id="1461157">(</span><span class="ident" id="1461158">delta</span>&nbsp;<span class="builtintype" id="1461164">int</span><span class="op" id="1461167">)</span>&nbsp;<span class="op" id="1461169">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461172">if</span>&nbsp;<span class="ident" id="1461175"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1461187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461191">_</span>&nbsp;<span class="op" id="1461193">=</span>&nbsp;<span class="ident" id="1461195"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461197">.</span><span class="ident" id="1461198"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1461199">.</span><span class="ident" id="1461200"><a href="/gostd/sync/mutex.go.html#1443990">state</a></span>&nbsp;<span class="comment" id="1461206">//&nbsp;trigger&nbsp;nil&nbsp;deref&nbsp;early</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461235">if</span>&nbsp;<span class="ident" id="1461238"><a href="/gostd/sync/waitgroup.go.html#1461158">delta</a></span>&nbsp;<span class="op" id="1461244">&lt;</span>&nbsp;<span class="num" id="1461246">0</span>&nbsp;<span class="op" id="1461248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1461253">//&nbsp;Synchronize&nbsp;decrements&nbsp;with&nbsp;Wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461293"><a href="/gostd/sync/race0.go.html#1454171">raceReleaseMerge</a></span><span class="op" id="1461309">(</span><span class="ident" id="1461310"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1461316">.</span><span class="ident" id="1461317">Pointer</span><span class="op" id="1461324">(</span><span class="ident" id="1461325"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461327">)</span><span class="op" id="1461328">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461332">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461336"><a href="/gostd/sync/race0.go.html#1454219">raceDisable</a></span><span class="op" id="1461347">(</span><span class="op" id="1461348">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461352">defer</span>&nbsp;<span class="ident" id="1461358"><a href="/gostd/sync/race0.go.html#1454243">raceEnable</a></span><span class="op" id="1461368">(</span><span class="op" id="1461369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461372">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461375">v</span>&nbsp;<span class="op" id="1461377">:=</span>&nbsp;<span class="ident" id="1461380"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1461386">.</span><span class="ident" id="1461387"><a href="/gostd/sync/atomic/doc.go.html#1466936">AddInt32</a></span><span class="op" id="1461395">(</span><span class="op" id="1461396">&amp;</span><span class="ident" id="1461397"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461399">.</span><span class="ident" id="1461400"><a href="/gostd/sync/waitgroup.go.html#1459968">counter</a></span><span class="op" id="1461407">,</span>&nbsp;<span class="builtintype" id="1461409">int32</span><span class="op" id="1461414">(</span><span class="ident" id="1461415"><a href="/gostd/sync/waitgroup.go.html#1461158">delta</a></span><span class="op" id="1461420">)</span><span class="op" id="1461421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461424">if</span>&nbsp;<span class="ident" id="1461427"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1461439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461443">if</span>&nbsp;<span class="ident" id="1461446"><a href="/gostd/sync/waitgroup.go.html#1461158">delta</a></span>&nbsp;<span class="op" id="1461452">&gt;</span>&nbsp;<span class="num" id="1461454">0</span>&nbsp;<span class="op" id="1461456">&amp;&amp;</span>&nbsp;<span class="ident" id="1461459"><a href="/gostd/sync/waitgroup.go.html#1461375">v</a></span>&nbsp;<span class="op" id="1461461">==</span>&nbsp;<span class="builtintype" id="1461464">int32</span><span class="op" id="1461469">(</span><span class="ident" id="1461470"><a href="/gostd/sync/waitgroup.go.html#1461158">delta</a></span><span class="op" id="1461475">)</span>&nbsp;<span class="op" id="1461477">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1461482">//&nbsp;The&nbsp;first&nbsp;increment&nbsp;must&nbsp;be&nbsp;synchronized&nbsp;with&nbsp;Wait.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1461540">//&nbsp;Need&nbsp;to&nbsp;model&nbsp;this&nbsp;as&nbsp;a&nbsp;read,&nbsp;because&nbsp;there&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1461597">//&nbsp;several&nbsp;concurrent&nbsp;wg.counter&nbsp;transitions&nbsp;from&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461653"><a href="/gostd/sync/race0.go.html#1454266">raceRead</a></span><span class="op" id="1461661">(</span><span class="ident" id="1461662"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1461668">.</span><span class="ident" id="1461669">Pointer</span><span class="op" id="1461676">(</span><span class="op" id="1461677">&amp;</span><span class="ident" id="1461678"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461680">.</span><span class="ident" id="1461681"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span><span class="op" id="1461685">)</span><span class="op" id="1461686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461690">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461696">if</span>&nbsp;<span class="ident" id="1461699"><a href="/gostd/sync/waitgroup.go.html#1461375">v</a></span>&nbsp;<span class="op" id="1461701">&lt;</span>&nbsp;<span class="num" id="1461703">0</span>&nbsp;<span class="op" id="1461705">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1461709">panic</span><span class="op" id="1461714">(</span><span class="string" id="1461715">&#34;sync:&nbsp;negative&nbsp;WaitGroup&nbsp;counter&#34;</span><span class="op" id="1461749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461755">if</span>&nbsp;<span class="ident" id="1461758"><a href="/gostd/sync/waitgroup.go.html#1461375">v</a></span>&nbsp;<span class="op" id="1461760">&gt;</span>&nbsp;<span class="num" id="1461762">0</span>&nbsp;<span class="op" id="1461764">||</span>&nbsp;<span class="ident" id="1461767"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1461773">.</span><span class="ident" id="1461774"><a href="/gostd/sync/atomic/doc.go.html#1467846">LoadInt32</a></span><span class="op" id="1461783">(</span><span class="op" id="1461784">&amp;</span><span class="ident" id="1461785"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461787">.</span><span class="ident" id="1461788"><a href="/gostd/sync/waitgroup.go.html#1459983">waiters</a></span><span class="op" id="1461795">)</span>&nbsp;<span class="op" id="1461797">==</span>&nbsp;<span class="num" id="1461800">0</span>&nbsp;<span class="op" id="1461802">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461806">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461814">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461817"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461819">.</span><span class="ident" id="1461820"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1461821">.</span><span class="ident" id="1461822"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1461826">(</span><span class="op" id="1461827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461830">if</span>&nbsp;<span class="ident" id="1461833"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1461839">.</span><span class="ident" id="1461840"><a href="/gostd/sync/atomic/doc.go.html#1467846">LoadInt32</a></span><span class="op" id="1461849">(</span><span class="op" id="1461850">&amp;</span><span class="ident" id="1461851"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461853">.</span><span class="ident" id="1461854"><a href="/gostd/sync/waitgroup.go.html#1459968">counter</a></span><span class="op" id="1461861">)</span>&nbsp;<span class="op" id="1461863">==</span>&nbsp;<span class="num" id="1461866">0</span>&nbsp;<span class="op" id="1461868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1461872">for</span>&nbsp;<span class="ident" id="1461876">i</span>&nbsp;<span class="op" id="1461878">:=</span>&nbsp;<span class="builtintype" id="1461881">int32</span><span class="op" id="1461886">(</span><span class="num" id="1461887">0</span><span class="op" id="1461888">)</span><span class="op" id="1461889">;</span>&nbsp;<span class="ident" id="1461891"><a href="/gostd/sync/waitgroup.go.html#1461876">i</a></span>&nbsp;<span class="op" id="1461893">&lt;</span>&nbsp;<span class="ident" id="1461895"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461897">.</span><span class="ident" id="1461898"><a href="/gostd/sync/waitgroup.go.html#1459983">waiters</a></span><span class="op" id="1461905">;</span>&nbsp;<span class="ident" id="1461907"><a href="/gostd/sync/waitgroup.go.html#1461876">i</a></span><span class="op" id="1461908">++</span>&nbsp;<span class="op" id="1461911">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461916"><a href="/gostd/sync/runtime.go.html#1455025">runtime_Semrelease</a></span><span class="op" id="1461934">(</span><span class="ident" id="1461935"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461937">.</span><span class="ident" id="1461938"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span><span class="op" id="1461942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461946">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461950"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461952">.</span><span class="ident" id="1461953"><a href="/gostd/sync/waitgroup.go.html#1459983">waiters</a></span>&nbsp;<span class="op" id="1461961">=</span>&nbsp;<span class="num" id="1461963">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461967"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461969">.</span><span class="ident" id="1461970"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span>&nbsp;<span class="op" id="1461975">=</span>&nbsp;<span class="builtintype" id="1461977">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1461982">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1461985"><a href="/gostd/sync/waitgroup.go.html#1461139">wg</a></span><span class="op" id="1461987">.</span><span class="ident" id="1461988"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1461989">.</span><span class="ident" id="1461990"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1461996">(</span><span class="op" id="1461997">)</span><br>
<span class="lineno"></span><span class="op" id="1461999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462002">//&nbsp;Done&nbsp;decrements&nbsp;the&nbsp;WaitGroup&nbsp;counter.</span><br>
<span class="lineno"></span><span class="keyword" id="1462044">func</span>&nbsp;<span class="op" id="1462049">(</span><span class="ident" id="1462050">wg</span>&nbsp;<span class="op" id="1462053">*</span><span class="ident" id="1462054"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><span class="op" id="1462063">)</span>&nbsp;<span class="ident" id="1462065">Done</span><span class="op" id="1462069">(</span><span class="op" id="1462070">)</span>&nbsp;<span class="op" id="1462072">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462075"><a href="/gostd/sync/waitgroup.go.html#1462050">wg</a></span><span class="op" id="1462077">.</span><span class="ident" id="1462078"><a href="/gostd/sync/waitgroup.go.html#1461154">Add</a></span><span class="op" id="1462081">(</span><span class="op" id="1462082">-</span><span class="num" id="1462083">1</span><span class="op" id="1462084">)</span><br>
<span class="lineno"></span><span class="op" id="1462086">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1462089">//&nbsp;Wait&nbsp;blocks&nbsp;until&nbsp;the&nbsp;WaitGroup&nbsp;counter&nbsp;is&nbsp;zero.</span><br>
<span class="lineno"></span><span class="keyword" id="1462141">func</span>&nbsp;<span class="op" id="1462146">(</span><span class="ident" id="1462147">wg</span>&nbsp;<span class="op" id="1462150">*</span><span class="ident" id="1462151"><a href="/gostd/sync/waitgroup.go.html#1459933">WaitGroup</a></span><span class="op" id="1462160">)</span>&nbsp;<span class="ident" id="1462162">Wait</span><span class="op" id="1462166">(</span><span class="op" id="1462167">)</span>&nbsp;<span class="op" id="1462169">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462172">if</span>&nbsp;<span class="ident" id="1462175"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1462187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462191">_</span>&nbsp;<span class="op" id="1462193">=</span>&nbsp;<span class="ident" id="1462195"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462197">.</span><span class="ident" id="1462198"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1462199">.</span><span class="ident" id="1462200"><a href="/gostd/sync/mutex.go.html#1443990">state</a></span>&nbsp;<span class="comment" id="1462206">//&nbsp;trigger&nbsp;nil&nbsp;deref&nbsp;early</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462235"><a href="/gostd/sync/race0.go.html#1454219">raceDisable</a></span><span class="op" id="1462246">(</span><span class="op" id="1462247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462250">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462253">if</span>&nbsp;<span class="ident" id="1462256"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1462262">.</span><span class="ident" id="1462263"><a href="/gostd/sync/atomic/doc.go.html#1467846">LoadInt32</a></span><span class="op" id="1462272">(</span><span class="op" id="1462273">&amp;</span><span class="ident" id="1462274"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462276">.</span><span class="ident" id="1462277"><a href="/gostd/sync/waitgroup.go.html#1459968">counter</a></span><span class="op" id="1462284">)</span>&nbsp;<span class="op" id="1462286">==</span>&nbsp;<span class="num" id="1462289">0</span>&nbsp;<span class="op" id="1462291">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462295">if</span>&nbsp;<span class="ident" id="1462298"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1462310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462315"><a href="/gostd/sync/race0.go.html#1454243">raceEnable</a></span><span class="op" id="1462325">(</span><span class="op" id="1462326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462331"><a href="/gostd/sync/race0.go.html#1454085">raceAcquire</a></span><span class="op" id="1462342">(</span><span class="ident" id="1462343"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1462349">.</span><span class="ident" id="1462350">Pointer</span><span class="op" id="1462357">(</span><span class="ident" id="1462358"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462360">)</span><span class="op" id="1462361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462365">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462369">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462380"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462382">.</span><span class="ident" id="1462383"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1462384">.</span><span class="ident" id="1462385"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="1462389">(</span><span class="op" id="1462390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462393">w</span>&nbsp;<span class="op" id="1462395">:=</span>&nbsp;<span class="ident" id="1462398"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1462404">.</span><span class="ident" id="1462405"><a href="/gostd/sync/atomic/doc.go.html#1466936">AddInt32</a></span><span class="op" id="1462413">(</span><span class="op" id="1462414">&amp;</span><span class="ident" id="1462415"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462417">.</span><span class="ident" id="1462418"><a href="/gostd/sync/waitgroup.go.html#1459983">waiters</a></span><span class="op" id="1462425">,</span>&nbsp;<span class="num" id="1462427">1</span><span class="op" id="1462428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462431">//&nbsp;This&nbsp;code&nbsp;is&nbsp;racing&nbsp;with&nbsp;the&nbsp;unlocked&nbsp;path&nbsp;in&nbsp;Add&nbsp;above.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462492">//&nbsp;The&nbsp;code&nbsp;above&nbsp;modifies&nbsp;counter&nbsp;and&nbsp;then&nbsp;reads&nbsp;waiters.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462552">//&nbsp;We&nbsp;must&nbsp;modify&nbsp;waiters&nbsp;and&nbsp;then&nbsp;read&nbsp;counter&nbsp;(the&nbsp;opposite&nbsp;order)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462622">//&nbsp;to&nbsp;avoid&nbsp;missing&nbsp;an&nbsp;Add.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462651">if</span>&nbsp;<span class="ident" id="1462654"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1462660">.</span><span class="ident" id="1462661"><a href="/gostd/sync/atomic/doc.go.html#1467846">LoadInt32</a></span><span class="op" id="1462670">(</span><span class="op" id="1462671">&amp;</span><span class="ident" id="1462672"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462674">.</span><span class="ident" id="1462675"><a href="/gostd/sync/waitgroup.go.html#1459968">counter</a></span><span class="op" id="1462682">)</span>&nbsp;<span class="op" id="1462684">==</span>&nbsp;<span class="num" id="1462687">0</span>&nbsp;<span class="op" id="1462689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462693"><a href="/gostd/sync/waitgroup.go.html#1459607">atomic</a></span><span class="op" id="1462699">.</span><span class="ident" id="1462700"><a href="/gostd/sync/atomic/doc.go.html#1466936">AddInt32</a></span><span class="op" id="1462708">(</span><span class="op" id="1462709">&amp;</span><span class="ident" id="1462710"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462712">.</span><span class="ident" id="1462713"><a href="/gostd/sync/waitgroup.go.html#1459983">waiters</a></span><span class="op" id="1462720">,</span>&nbsp;<span class="op" id="1462722">-</span><span class="num" id="1462723">1</span><span class="op" id="1462724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462728">if</span>&nbsp;<span class="ident" id="1462731"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1462743">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462748"><a href="/gostd/sync/race0.go.html#1454243">raceEnable</a></span><span class="op" id="1462758">(</span><span class="op" id="1462759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462764"><a href="/gostd/sync/race0.go.html#1454085">raceAcquire</a></span><span class="op" id="1462775">(</span><span class="ident" id="1462776"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1462782">.</span><span class="ident" id="1462783">Pointer</span><span class="op" id="1462790">(</span><span class="ident" id="1462791"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462793">)</span><span class="op" id="1462794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462799"><a href="/gostd/sync/race0.go.html#1454219">raceDisable</a></span><span class="op" id="1462810">(</span><span class="op" id="1462811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462819"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1462821">.</span><span class="ident" id="1462822"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1462823">.</span><span class="ident" id="1462824"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1462830">(</span><span class="op" id="1462831">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462835">if</span>&nbsp;<span class="ident" id="1462838"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1462850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1462855"><a href="/gostd/sync/race0.go.html#1454243">raceEnable</a></span><span class="op" id="1462865">(</span><span class="op" id="1462866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462874">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1462882">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1462885">if</span>&nbsp;<span class="ident" id="1462888"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1462900">&amp;&amp;</span>&nbsp;<span class="ident" id="1462903"><a href="/gostd/sync/waitgroup.go.html#1462393">w</a></span>&nbsp;<span class="op" id="1462905">==</span>&nbsp;<span class="num" id="1462908">1</span>&nbsp;<span class="op" id="1462910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462914">//&nbsp;Wait&nbsp;must&nbsp;be&nbsp;synchronized&nbsp;with&nbsp;the&nbsp;first&nbsp;Add.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1462965">//&nbsp;Need&nbsp;to&nbsp;model&nbsp;this&nbsp;is&nbsp;as&nbsp;a&nbsp;write&nbsp;to&nbsp;race&nbsp;with&nbsp;the&nbsp;read&nbsp;in&nbsp;Add.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1463033">//&nbsp;As&nbsp;a&nbsp;consequence,&nbsp;can&nbsp;do&nbsp;the&nbsp;write&nbsp;only&nbsp;for&nbsp;the&nbsp;first&nbsp;waiter,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1463100">//&nbsp;otherwise&nbsp;concurrent&nbsp;Waits&nbsp;will&nbsp;race&nbsp;with&nbsp;each&nbsp;other.</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463159"><a href="/gostd/sync/race0.go.html#1454306">raceWrite</a></span><span class="op" id="1463168">(</span><span class="ident" id="1463169"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1463175">.</span><span class="ident" id="1463176">Pointer</span><span class="op" id="1463183">(</span><span class="op" id="1463184">&amp;</span><span class="ident" id="1463185"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463187">.</span><span class="ident" id="1463188"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span><span class="op" id="1463192">)</span><span class="op" id="1463193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1463196">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1463199">if</span>&nbsp;<span class="ident" id="1463202"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463204">.</span><span class="ident" id="1463205"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span>&nbsp;<span class="op" id="1463210">==</span>&nbsp;<span class="builtintype" id="1463213">nil</span>&nbsp;<span class="op" id="1463217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463221"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463223">.</span><span class="ident" id="1463224"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span>&nbsp;<span class="op" id="1463229">=</span>&nbsp;<span class="builtinfunc" id="1463231">new</span><span class="op" id="1463234">(</span><span class="builtintype" id="1463235">uint32</span><span class="op" id="1463241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1463244">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463247">s</span>&nbsp;<span class="op" id="1463249">:=</span>&nbsp;<span class="ident" id="1463252"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463254">.</span><span class="ident" id="1463255"><a href="/gostd/sync/waitgroup.go.html#1459998">sema</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463261"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463263">.</span><span class="ident" id="1463264"><a href="/gostd/sync/waitgroup.go.html#1459953">m</a></span><span class="op" id="1463265">.</span><span class="ident" id="1463266"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="1463272">(</span><span class="op" id="1463273">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463276"><a href="/gostd/sync/runtime.go.html#1454759">runtime_Semacquire</a></span><span class="op" id="1463294">(</span><span class="ident" id="1463295"><a href="/gostd/sync/waitgroup.go.html#1463247">s</a></span><span class="op" id="1463296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1463299">if</span>&nbsp;<span class="ident" id="1463302"><a href="/gostd/sync/race0.go.html#1454059">raceenabled</a></span>&nbsp;<span class="op" id="1463314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463318"><a href="/gostd/sync/race0.go.html#1454243">raceEnable</a></span><span class="op" id="1463328">(</span><span class="op" id="1463329">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1463333"><a href="/gostd/sync/race0.go.html#1454085">raceAcquire</a></span><span class="op" id="1463344">(</span><span class="ident" id="1463345"><a href="/gostd/sync/waitgroup.go.html#1459622">unsafe</a></span><span class="op" id="1463351">.</span><span class="ident" id="1463352">Pointer</span><span class="op" id="1463359">(</span><span class="ident" id="1463360"><a href="/gostd/sync/waitgroup.go.html#1462147">wg</a></span><span class="op" id="1463362">)</span><span class="op" id="1463363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1463366">}</span><br>
<span class="lineno"></span><span class="op" id="1463368">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
