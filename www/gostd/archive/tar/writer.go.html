<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html" class="current">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5750403">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5750458">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5750512">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5750563">package</span>&nbsp;<span class="ident" id="5750571">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5750576">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5750595">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5750643">import</span>&nbsp;<span class="op" id="5750650">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750653">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750662">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750672">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750679">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750685">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750691">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750699">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750710">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="5750721">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5750728">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5750731">var</span>&nbsp;<span class="op" id="5750735">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750738">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5750757">=</span>&nbsp;<span class="ident" id="5750759">errors</span><span class="op" id="5750765">.</span><span class="ident" id="5750766">New</span><span class="op" id="5750769">(</span><span class="string" id="5750770">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="5750799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750802">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5750821">=</span>&nbsp;<span class="ident" id="5750823">errors</span><span class="op" id="5750829">.</span><span class="ident" id="5750830">New</span><span class="op" id="5750833">(</span><span class="string" id="5750834">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="5750870">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750873">ErrWriteAfterClose</span>&nbsp;<span class="op" id="5750892">=</span>&nbsp;<span class="ident" id="5750894">errors</span><span class="op" id="5750900">.</span><span class="ident" id="5750901">New</span><span class="op" id="5750904">(</span><span class="string" id="5750905">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="5750937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5750940">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5750959">=</span>&nbsp;<span class="ident" id="5750961">errors</span><span class="op" id="5750967">.</span><span class="ident" id="5750968">New</span><span class="op" id="5750971">(</span><span class="string" id="5750972">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="5751000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751003">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5751022">=</span>&nbsp;<span class="ident" id="5751024">errors</span><span class="op" id="5751030">.</span><span class="ident" id="5751031">New</span><span class="op" id="5751034">(</span><span class="string" id="5751035">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="5751098">)</span><br>
<span class="lineno"></span><span class="op" id="5751100">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5751103">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5751179">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5751229">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="5751318">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="5751362">type</span>&nbsp;<span class="ident" id="5751367">Writer</span>&nbsp;<span class="keyword" id="5751374">struct</span>&nbsp;<span class="op" id="5751381">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751384">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751395">io</span><span class="op" id="5751397">.</span><span class="ident" id="5751398">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751406">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5751417">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751424">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751435">int64</span>&nbsp;<span class="comment" id="5751441">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751494">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751505">int64</span>&nbsp;<span class="comment" id="5751511">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751567">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5751578">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751584">usedBinary</span>&nbsp;<span class="builtintype" id="5751595">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5751611">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751667">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="5751678">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5751694">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751746">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5751757">[</span><span class="ident" id="5751758">blockSize</span><span class="op" id="5751767">]</span><span class="builtintype" id="5751768">byte</span>&nbsp;<span class="comment" id="5751773">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5751836">paxHdrBuff</span>&nbsp;<span class="op" id="5751847">[</span><span class="ident" id="5751848">blockSize</span><span class="op" id="5751857">]</span><span class="builtintype" id="5751858">byte</span>&nbsp;<span class="comment" id="5751863">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="5751921">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5751924">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5751972">func</span>&nbsp;<span class="ident" id="5751977">NewWriter</span><span class="op" id="5751986">(</span><span class="ident" id="5751987">w</span>&nbsp;<span class="ident" id="5751989">io</span><span class="op" id="5751991">.</span><span class="ident" id="5751992">Writer</span><span class="op" id="5751998">)</span>&nbsp;<span class="op" id="5752000">*</span><span class="ident" id="5752001">Writer</span>&nbsp;<span class="op" id="5752008">{</span>&nbsp;<span class="keyword" id="5752010">return</span>&nbsp;<span class="op" id="5752017">&amp;</span><span class="ident" id="5752018">Writer</span><span class="op" id="5752024">{</span><span class="ident" id="5752025">w</span><span class="op" id="5752026">:</span>&nbsp;<span class="ident" id="5752028">w</span><span class="op" id="5752029">}</span>&nbsp;<span class="op" id="5752031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5752034">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="5752089">func</span>&nbsp;<span class="op" id="5752094">(</span><span class="ident" id="5752095">tw</span>&nbsp;<span class="op" id="5752098">*</span><span class="ident" id="5752099">Writer</span><span class="op" id="5752105">)</span>&nbsp;<span class="ident" id="5752107">Flush</span><span class="op" id="5752112">(</span><span class="op" id="5752113">)</span>&nbsp;<span class="builtintype" id="5752115">error</span>&nbsp;<span class="op" id="5752121">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752124">if</span>&nbsp;<span class="ident" id="5752127">tw</span><span class="op" id="5752129">.</span><span class="ident" id="5752130">nb</span>&nbsp;<span class="op" id="5752133">&gt;</span>&nbsp;<span class="num" id="5752135">0</span>&nbsp;<span class="op" id="5752137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752141">tw</span><span class="op" id="5752143">.</span><span class="ident" id="5752144">err</span>&nbsp;<span class="op" id="5752148">=</span>&nbsp;<span class="ident" id="5752150">fmt</span><span class="op" id="5752153">.</span><span class="ident" id="5752154">Errorf</span><span class="op" id="5752160">(</span><span class="string" id="5752161">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5752199">,</span>&nbsp;<span class="ident" id="5752201">tw</span><span class="op" id="5752203">.</span><span class="ident" id="5752204">nb</span><span class="op" id="5752206">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752210">return</span>&nbsp;<span class="ident" id="5752217">tw</span><span class="op" id="5752219">.</span><span class="ident" id="5752220">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752225">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752229">n</span>&nbsp;<span class="op" id="5752231">:=</span>&nbsp;<span class="ident" id="5752234">tw</span><span class="op" id="5752236">.</span><span class="ident" id="5752237">nb</span>&nbsp;<span class="op" id="5752240">+</span>&nbsp;<span class="ident" id="5752242">tw</span><span class="op" id="5752244">.</span><span class="ident" id="5752245">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752250">for</span>&nbsp;<span class="ident" id="5752254">n</span>&nbsp;<span class="op" id="5752256">&gt;</span>&nbsp;<span class="num" id="5752258">0</span>&nbsp;<span class="op" id="5752260">&amp;&amp;</span>&nbsp;<span class="ident" id="5752263">tw</span><span class="op" id="5752265">.</span><span class="ident" id="5752266">err</span>&nbsp;<span class="op" id="5752270">==</span>&nbsp;<span class="ident" id="5752273">nil</span>&nbsp;<span class="op" id="5752277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752281">nr</span>&nbsp;<span class="op" id="5752284">:=</span>&nbsp;<span class="ident" id="5752287">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752291">if</span>&nbsp;<span class="ident" id="5752294">nr</span>&nbsp;<span class="op" id="5752297">&gt;</span>&nbsp;<span class="ident" id="5752299">blockSize</span>&nbsp;<span class="op" id="5752309">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752314">nr</span>&nbsp;<span class="op" id="5752317">=</span>&nbsp;<span class="ident" id="5752319">blockSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752335">var</span>&nbsp;<span class="ident" id="5752339">nw</span>&nbsp;<span class="builtintype" id="5752342">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752348">nw</span><span class="op" id="5752350">,</span>&nbsp;<span class="ident" id="5752352">tw</span><span class="op" id="5752354">.</span><span class="ident" id="5752355">err</span>&nbsp;<span class="op" id="5752359">=</span>&nbsp;<span class="ident" id="5752361">tw</span><span class="op" id="5752363">.</span><span class="ident" id="5752364">w</span><span class="op" id="5752365">.</span><span class="ident" id="5752366">Write</span><span class="op" id="5752371">(</span><span class="ident" id="5752372">zeroBlock</span><span class="op" id="5752381">[</span><span class="num" id="5752382">0</span><span class="op" id="5752383">:</span><span class="ident" id="5752384">nr</span><span class="op" id="5752386">]</span><span class="op" id="5752387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752391">n</span>&nbsp;<span class="op" id="5752393">-=</span>&nbsp;<span class="ident" id="5752396">int64</span><span class="op" id="5752401">(</span><span class="ident" id="5752402">nw</span><span class="op" id="5752404">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752410">tw</span><span class="op" id="5752412">.</span><span class="ident" id="5752413">nb</span>&nbsp;<span class="op" id="5752416">=</span>&nbsp;<span class="num" id="5752418">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752421">tw</span><span class="op" id="5752423">.</span><span class="ident" id="5752424">pad</span>&nbsp;<span class="op" id="5752428">=</span>&nbsp;<span class="num" id="5752430">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752433">return</span>&nbsp;<span class="ident" id="5752440">tw</span><span class="op" id="5752442">.</span><span class="ident" id="5752443">err</span><br>
<span class="lineno"></span><span class="op" id="5752447">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5752450">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="5752513">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5752607">func</span>&nbsp;<span class="op" id="5752612">(</span><span class="ident" id="5752613">tw</span>&nbsp;<span class="op" id="5752616">*</span><span class="ident" id="5752617">Writer</span><span class="op" id="5752623">)</span>&nbsp;<span class="ident" id="5752625">cString</span><span class="op" id="5752632">(</span><span class="ident" id="5752633">b</span>&nbsp;<span class="op" id="5752635">[</span><span class="op" id="5752636">]</span><span class="builtintype" id="5752637">byte</span><span class="op" id="5752641">,</span>&nbsp;<span class="ident" id="5752643">s</span>&nbsp;<span class="builtintype" id="5752645">string</span><span class="op" id="5752651">,</span>&nbsp;<span class="ident" id="5752653">allowPax</span>&nbsp;<span class="builtintype" id="5752662">bool</span><span class="op" id="5752666">,</span>&nbsp;<span class="ident" id="5752668">paxKeyword</span>&nbsp;<span class="builtintype" id="5752679">string</span><span class="op" id="5752685">,</span>&nbsp;<span class="ident" id="5752687">paxHeaders</span>&nbsp;<span class="keyword" id="5752698">map</span><span class="op" id="5752701">[</span><span class="builtintype" id="5752702">string</span><span class="op" id="5752708">]</span><span class="builtintype" id="5752709">string</span><span class="op" id="5752715">)</span>&nbsp;<span class="op" id="5752717">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752720">needsPaxHeader</span>&nbsp;<span class="op" id="5752735">:=</span>&nbsp;<span class="ident" id="5752738">allowPax</span>&nbsp;<span class="op" id="5752747">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5752750">len</span><span class="op" id="5752753">(</span><span class="ident" id="5752754">s</span><span class="op" id="5752755">)</span>&nbsp;<span class="op" id="5752757">&gt;</span>&nbsp;<span class="builtinfunc" id="5752759">len</span><span class="op" id="5752762">(</span><span class="ident" id="5752763">b</span><span class="op" id="5752764">)</span>&nbsp;<span class="op" id="5752766">||</span>&nbsp;<span class="op" id="5752769">!</span><span class="ident" id="5752770">isASCII</span><span class="op" id="5752777">(</span><span class="ident" id="5752778">s</span><span class="op" id="5752779">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752782">if</span>&nbsp;<span class="ident" id="5752785">needsPaxHeader</span>&nbsp;<span class="op" id="5752800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752804">paxHeaders</span><span class="op" id="5752814">[</span><span class="ident" id="5752815">paxKeyword</span><span class="op" id="5752825">]</span>&nbsp;<span class="op" id="5752827">=</span>&nbsp;<span class="ident" id="5752829">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752833">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752844">if</span>&nbsp;<span class="builtinfunc" id="5752847">len</span><span class="op" id="5752850">(</span><span class="ident" id="5752851">s</span><span class="op" id="5752852">)</span>&nbsp;<span class="op" id="5752854">&gt;</span>&nbsp;<span class="builtinfunc" id="5752856">len</span><span class="op" id="5752859">(</span><span class="ident" id="5752860">b</span><span class="op" id="5752861">)</span>&nbsp;<span class="op" id="5752863">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752867">if</span>&nbsp;<span class="ident" id="5752870">tw</span><span class="op" id="5752872">.</span><span class="ident" id="5752873">err</span>&nbsp;<span class="op" id="5752877">==</span>&nbsp;<span class="ident" id="5752880">nil</span>&nbsp;<span class="op" id="5752884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752889">tw</span><span class="op" id="5752891">.</span><span class="ident" id="5752892">err</span>&nbsp;<span class="op" id="5752896">=</span>&nbsp;<span class="ident" id="5752898">ErrFieldTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752920">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5752928">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752931">ascii</span>&nbsp;<span class="op" id="5752937">:=</span>&nbsp;<span class="ident" id="5752940">toASCII</span><span class="op" id="5752947">(</span><span class="ident" id="5752948">s</span><span class="op" id="5752949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5752952">copy</span><span class="op" id="5752956">(</span><span class="ident" id="5752957">b</span><span class="op" id="5752958">,</span>&nbsp;<span class="ident" id="5752960">ascii</span><span class="op" id="5752965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5752968">if</span>&nbsp;<span class="builtinfunc" id="5752971">len</span><span class="op" id="5752974">(</span><span class="ident" id="5752975">ascii</span><span class="op" id="5752980">)</span>&nbsp;<span class="op" id="5752982">&lt;</span>&nbsp;<span class="builtinfunc" id="5752984">len</span><span class="op" id="5752987">(</span><span class="ident" id="5752988">b</span><span class="op" id="5752989">)</span>&nbsp;<span class="op" id="5752991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5752995">b</span><span class="op" id="5752996">[</span><span class="builtinfunc" id="5752997">len</span><span class="op" id="5753000">(</span><span class="ident" id="5753001">ascii</span><span class="op" id="5753006">)</span><span class="op" id="5753007">]</span>&nbsp;<span class="op" id="5753009">=</span>&nbsp;<span class="num" id="5753011">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5753014">}</span><br>
<span class="lineno">90</span><span class="op" id="5753016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753019">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="5753096">func</span>&nbsp;<span class="op" id="5753101">(</span><span class="ident" id="5753102">tw</span>&nbsp;<span class="op" id="5753105">*</span><span class="ident" id="5753106">Writer</span><span class="op" id="5753112">)</span>&nbsp;<span class="ident" id="5753114">octal</span><span class="op" id="5753119">(</span><span class="ident" id="5753120">b</span>&nbsp;<span class="op" id="5753122">[</span><span class="op" id="5753123">]</span><span class="builtintype" id="5753124">byte</span><span class="op" id="5753128">,</span>&nbsp;<span class="ident" id="5753130">x</span>&nbsp;<span class="ident" id="5753132">int64</span><span class="op" id="5753137">)</span>&nbsp;<span class="op" id="5753139">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753142">s</span>&nbsp;<span class="op" id="5753144">:=</span>&nbsp;<span class="ident" id="5753147">strconv</span><span class="op" id="5753154">.</span><span class="ident" id="5753155">FormatInt</span><span class="op" id="5753164">(</span><span class="ident" id="5753165">x</span><span class="op" id="5753166">,</span>&nbsp;<span class="num" id="5753168">8</span><span class="op" id="5753169">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5753172">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753217">for</span>&nbsp;<span class="builtinfunc" id="5753221">len</span><span class="op" id="5753224">(</span><span class="ident" id="5753225">s</span><span class="op" id="5753226">)</span><span class="op" id="5753227">+</span><span class="num" id="5753228">1</span>&nbsp;<span class="op" id="5753230">&lt;</span>&nbsp;<span class="builtinfunc" id="5753232">len</span><span class="op" id="5753235">(</span><span class="ident" id="5753236">b</span><span class="op" id="5753237">)</span>&nbsp;<span class="op" id="5753239">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753243">s</span>&nbsp;<span class="op" id="5753245">=</span>&nbsp;<span class="string" id="5753247">&#34;0&#34;</span>&nbsp;<span class="op" id="5753251">+</span>&nbsp;<span class="ident" id="5753253">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5753256">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753259">tw</span><span class="op" id="5753261">.</span><span class="ident" id="5753262">cString</span><span class="op" id="5753269">(</span><span class="ident" id="5753270">b</span><span class="op" id="5753271">,</span>&nbsp;<span class="ident" id="5753273">s</span><span class="op" id="5753274">,</span>&nbsp;<span class="builtintype" id="5753276">false</span><span class="op" id="5753281">,</span>&nbsp;<span class="ident" id="5753283">paxNone</span><span class="op" id="5753290">,</span>&nbsp;<span class="ident" id="5753292">nil</span><span class="op" id="5753295">)</span><br>
<span class="lineno">100</span><span class="op" id="5753297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5753300">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="5753373">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5753499">func</span>&nbsp;<span class="op" id="5753504">(</span><span class="ident" id="5753505">tw</span>&nbsp;<span class="op" id="5753508">*</span><span class="ident" id="5753509">Writer</span><span class="op" id="5753515">)</span>&nbsp;<span class="ident" id="5753517">numeric</span><span class="op" id="5753524">(</span><span class="ident" id="5753525">b</span>&nbsp;<span class="op" id="5753527">[</span><span class="op" id="5753528">]</span><span class="builtintype" id="5753529">byte</span><span class="op" id="5753533">,</span>&nbsp;<span class="ident" id="5753535">x</span>&nbsp;<span class="ident" id="5753537">int64</span><span class="op" id="5753542">,</span>&nbsp;<span class="ident" id="5753544">allowPax</span>&nbsp;<span class="builtintype" id="5753553">bool</span><span class="op" id="5753557">,</span>&nbsp;<span class="ident" id="5753559">paxKeyword</span>&nbsp;<span class="builtintype" id="5753570">string</span><span class="op" id="5753576">,</span>&nbsp;<span class="ident" id="5753578">paxHeaders</span>&nbsp;<span class="keyword" id="5753589">map</span><span class="op" id="5753592">[</span><span class="builtintype" id="5753593">string</span><span class="op" id="5753599">]</span><span class="builtintype" id="5753600">string</span><span class="op" id="5753606">)</span>&nbsp;<span class="op" id="5753608">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5753611">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753632">s</span>&nbsp;<span class="op" id="5753634">:=</span>&nbsp;<span class="ident" id="5753637">strconv</span><span class="op" id="5753644">.</span><span class="ident" id="5753645">FormatInt</span><span class="op" id="5753654">(</span><span class="ident" id="5753655">x</span><span class="op" id="5753656">,</span>&nbsp;<span class="num" id="5753658">8</span><span class="op" id="5753659">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753662">if</span>&nbsp;<span class="builtinfunc" id="5753665">len</span><span class="op" id="5753668">(</span><span class="ident" id="5753669">s</span><span class="op" id="5753670">)</span>&nbsp;<span class="op" id="5753672">&lt;</span>&nbsp;<span class="builtinfunc" id="5753674">len</span><span class="op" id="5753677">(</span><span class="ident" id="5753678">b</span><span class="op" id="5753679">)</span>&nbsp;<span class="op" id="5753681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753685">tw</span><span class="op" id="5753687">.</span><span class="ident" id="5753688">octal</span><span class="op" id="5753693">(</span><span class="ident" id="5753694">b</span><span class="op" id="5753695">,</span>&nbsp;<span class="ident" id="5753697">x</span><span class="op" id="5753698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753702">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5753710">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5753714">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753786">if</span>&nbsp;<span class="ident" id="5753789">allowPax</span>&nbsp;<span class="op" id="5753798">&amp;&amp;</span>&nbsp;<span class="ident" id="5753801">tw</span><span class="op" id="5753803">.</span><span class="ident" id="5753804">preferPax</span>&nbsp;<span class="op" id="5753814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753818">tw</span><span class="op" id="5753820">.</span><span class="ident" id="5753821">octal</span><span class="op" id="5753826">(</span><span class="ident" id="5753827">b</span><span class="op" id="5753828">,</span>&nbsp;<span class="num" id="5753830">0</span><span class="op" id="5753831">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753835">s</span>&nbsp;<span class="op" id="5753837">:=</span>&nbsp;<span class="ident" id="5753840">strconv</span><span class="op" id="5753847">.</span><span class="ident" id="5753848">FormatInt</span><span class="op" id="5753857">(</span><span class="ident" id="5753858">x</span><span class="op" id="5753859">,</span>&nbsp;<span class="num" id="5753861">10</span><span class="op" id="5753863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753867">paxHeaders</span><span class="op" id="5753877">[</span><span class="ident" id="5753878">paxKeyword</span><span class="op" id="5753888">]</span>&nbsp;<span class="op" id="5753890">=</span>&nbsp;<span class="ident" id="5753892">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753896">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5753904">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5753908">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5753946">tw</span><span class="op" id="5753948">.</span><span class="ident" id="5753949">usedBinary</span>&nbsp;<span class="op" id="5753960">=</span>&nbsp;<span class="builtintype" id="5753962">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5753968">for</span>&nbsp;<span class="ident" id="5753972">i</span>&nbsp;<span class="op" id="5753974">:=</span>&nbsp;<span class="builtinfunc" id="5753977">len</span><span class="op" id="5753980">(</span><span class="ident" id="5753981">b</span><span class="op" id="5753982">)</span>&nbsp;<span class="op" id="5753984">-</span>&nbsp;<span class="num" id="5753986">1</span><span class="op" id="5753987">;</span>&nbsp;<span class="ident" id="5753989">x</span>&nbsp;<span class="op" id="5753991">&gt;</span>&nbsp;<span class="num" id="5753993">0</span>&nbsp;<span class="op" id="5753995">&amp;&amp;</span>&nbsp;<span class="ident" id="5753998">i</span>&nbsp;<span class="op" id="5754000">&gt;=</span>&nbsp;<span class="num" id="5754003">0</span><span class="op" id="5754004">;</span>&nbsp;<span class="ident" id="5754006">i</span><span class="op" id="5754007">--</span>&nbsp;<span class="op" id="5754010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754014">b</span><span class="op" id="5754015">[</span><span class="ident" id="5754016">i</span><span class="op" id="5754017">]</span>&nbsp;<span class="op" id="5754019">=</span>&nbsp;<span class="builtintype" id="5754021">byte</span><span class="op" id="5754025">(</span><span class="ident" id="5754026">x</span><span class="op" id="5754027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754031">x</span>&nbsp;<span class="op" id="5754033">&gt;&gt;=</span>&nbsp;<span class="num" id="5754037">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5754040">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754043">b</span><span class="op" id="5754044">[</span><span class="num" id="5754045">0</span><span class="op" id="5754046">]</span>&nbsp;<span class="op" id="5754048">|=</span>&nbsp;<span class="num" id="5754051">0x80</span>&nbsp;<span class="comment" id="5754056">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="5754095">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5754098">var</span>&nbsp;<span class="op" id="5754102">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754105">minTime</span>&nbsp;<span class="op" id="5754113">=</span>&nbsp;<span class="ident" id="5754115">time</span><span class="op" id="5754119">.</span><span class="ident" id="5754120">Unix</span><span class="op" id="5754124">(</span><span class="num" id="5754125">0</span><span class="op" id="5754126">,</span>&nbsp;<span class="num" id="5754128">0</span><span class="op" id="5754129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5754132">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754190">maxTime</span>&nbsp;<span class="op" id="5754198">=</span>&nbsp;<span class="ident" id="5754200">minTime</span><span class="op" id="5754207">.</span><span class="ident" id="5754208">Add</span><span class="op" id="5754211">(</span><span class="op" id="5754212">(</span><span class="num" id="5754213">1</span><span class="op" id="5754214">&lt;&lt;</span><span class="num" id="5754216">33</span>&nbsp;<span class="op" id="5754219">-</span>&nbsp;<span class="num" id="5754221">1</span><span class="op" id="5754222">)</span>&nbsp;<span class="op" id="5754224">*</span>&nbsp;<span class="ident" id="5754226">time</span><span class="op" id="5754230">.</span><span class="ident" id="5754231">Second</span><span class="op" id="5754237">)</span><br>
<span class="lineno"></span><span class="op" id="5754239">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5754242">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5754312">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5754370">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="5754427">func</span>&nbsp;<span class="op" id="5754432">(</span><span class="ident" id="5754433">tw</span>&nbsp;<span class="op" id="5754436">*</span><span class="ident" id="5754437">Writer</span><span class="op" id="5754443">)</span>&nbsp;<span class="ident" id="5754445">WriteHeader</span><span class="op" id="5754456">(</span><span class="ident" id="5754457">hdr</span>&nbsp;<span class="op" id="5754461">*</span><span class="ident" id="5754462">Header</span><span class="op" id="5754468">)</span>&nbsp;<span class="builtintype" id="5754470">error</span>&nbsp;<span class="op" id="5754476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754479">return</span>&nbsp;<span class="ident" id="5754486">tw</span><span class="op" id="5754488">.</span><span class="ident" id="5754489">writeHeader</span><span class="op" id="5754500">(</span><span class="ident" id="5754501">hdr</span><span class="op" id="5754504">,</span>&nbsp;<span class="builtintype" id="5754506">true</span><span class="op" id="5754510">)</span><br>
<span class="lineno">140</span><span class="op" id="5754512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5754515">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5754585">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5754643">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="5754700">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5754773">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5754809">func</span>&nbsp;<span class="op" id="5754814">(</span><span class="ident" id="5754815">tw</span>&nbsp;<span class="op" id="5754818">*</span><span class="ident" id="5754819">Writer</span><span class="op" id="5754825">)</span>&nbsp;<span class="ident" id="5754827">writeHeader</span><span class="op" id="5754838">(</span><span class="ident" id="5754839">hdr</span>&nbsp;<span class="op" id="5754843">*</span><span class="ident" id="5754844">Header</span><span class="op" id="5754850">,</span>&nbsp;<span class="ident" id="5754852">allowPax</span>&nbsp;<span class="builtintype" id="5754861">bool</span><span class="op" id="5754865">)</span>&nbsp;<span class="builtintype" id="5754867">error</span>&nbsp;<span class="op" id="5754873">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754876">if</span>&nbsp;<span class="ident" id="5754879">tw</span><span class="op" id="5754881">.</span><span class="ident" id="5754882">closed</span>&nbsp;<span class="op" id="5754889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754893">return</span>&nbsp;<span class="ident" id="5754900">ErrWriteAfterClose</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5754920">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754923">if</span>&nbsp;<span class="ident" id="5754926">tw</span><span class="op" id="5754928">.</span><span class="ident" id="5754929">err</span>&nbsp;<span class="op" id="5754933">==</span>&nbsp;<span class="ident" id="5754936">nil</span>&nbsp;<span class="op" id="5754940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5754944">tw</span><span class="op" id="5754946">.</span><span class="ident" id="5754947">Flush</span><span class="op" id="5754952">(</span><span class="op" id="5754953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5754956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754959">if</span>&nbsp;<span class="ident" id="5754962">tw</span><span class="op" id="5754964">.</span><span class="ident" id="5754965">err</span>&nbsp;<span class="op" id="5754969">!=</span>&nbsp;<span class="ident" id="5754972">nil</span>&nbsp;<span class="op" id="5754976">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5754980">return</span>&nbsp;<span class="ident" id="5754987">tw</span><span class="op" id="5754989">.</span><span class="ident" id="5754990">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5754995">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5754999">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755055">paxHeaders</span>&nbsp;<span class="op" id="5755066">:=</span>&nbsp;<span class="builtinfunc" id="5755069">make</span><span class="op" id="5755073">(</span><span class="keyword" id="5755074">map</span><span class="op" id="5755077">[</span><span class="builtintype" id="5755078">string</span><span class="op" id="5755084">]</span><span class="builtintype" id="5755085">string</span><span class="op" id="5755091">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755095">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755156">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755218">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5755263">var</span>&nbsp;<span class="ident" id="5755267">header</span>&nbsp;<span class="op" id="5755274">[</span><span class="op" id="5755275">]</span><span class="builtintype" id="5755276">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755283">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755344">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755410">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755492">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755572">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755649">header</span>&nbsp;<span class="op" id="5755656">=</span>&nbsp;<span class="ident" id="5755658">tw</span><span class="op" id="5755660">.</span><span class="ident" id="5755661">hdrBuff</span><span class="op" id="5755668">[</span><span class="op" id="5755669">:</span><span class="op" id="5755670">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5755673">if</span>&nbsp;<span class="op" id="5755676">!</span><span class="ident" id="5755677">allowPax</span>&nbsp;<span class="op" id="5755686">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755690">header</span>&nbsp;<span class="op" id="5755697">=</span>&nbsp;<span class="ident" id="5755699">tw</span><span class="op" id="5755701">.</span><span class="ident" id="5755702">paxHdrBuff</span><span class="op" id="5755712">[</span><span class="op" id="5755713">:</span><span class="op" id="5755714">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5755717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5755720">copy</span><span class="op" id="5755724">(</span><span class="ident" id="5755725">header</span><span class="op" id="5755731">,</span>&nbsp;<span class="ident" id="5755733">zeroBlock</span><span class="op" id="5755742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755745">s</span>&nbsp;<span class="op" id="5755747">:=</span>&nbsp;<span class="ident" id="5755750">slicer</span><span class="op" id="5755756">(</span><span class="ident" id="5755757">header</span><span class="op" id="5755763">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5755767">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755895">pathHeaderBytes</span>&nbsp;<span class="op" id="5755911">:=</span>&nbsp;<span class="ident" id="5755914">s</span><span class="op" id="5755915">.</span><span class="ident" id="5755916">next</span><span class="op" id="5755920">(</span><span class="ident" id="5755921">fileNameSize</span><span class="op" id="5755933">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5755937">tw</span><span class="op" id="5755939">.</span><span class="ident" id="5755940">cString</span><span class="op" id="5755947">(</span><span class="ident" id="5755948">pathHeaderBytes</span><span class="op" id="5755963">,</span>&nbsp;<span class="ident" id="5755965">hdr</span><span class="op" id="5755968">.</span><span class="ident" id="5755969">Name</span><span class="op" id="5755973">,</span>&nbsp;<span class="builtintype" id="5755975">true</span><span class="op" id="5755979">,</span>&nbsp;<span class="ident" id="5755981">paxPath</span><span class="op" id="5755988">,</span>&nbsp;<span class="ident" id="5755990">paxHeaders</span><span class="op" id="5756000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756004">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5756047">var</span>&nbsp;<span class="ident" id="5756051">modTime</span>&nbsp;<span class="ident" id="5756059">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5756066">if</span>&nbsp;<span class="op" id="5756069">!</span><span class="ident" id="5756070">hdr</span><span class="op" id="5756073">.</span><span class="ident" id="5756074">ModTime</span><span class="op" id="5756081">.</span><span class="ident" id="5756082">Before</span><span class="op" id="5756088">(</span><span class="ident" id="5756089">minTime</span><span class="op" id="5756096">)</span>&nbsp;<span class="op" id="5756098">&amp;&amp;</span>&nbsp;<span class="op" id="5756101">!</span><span class="ident" id="5756102">hdr</span><span class="op" id="5756105">.</span><span class="ident" id="5756106">ModTime</span><span class="op" id="5756113">.</span><span class="ident" id="5756114">After</span><span class="op" id="5756119">(</span><span class="ident" id="5756120">maxTime</span><span class="op" id="5756127">)</span>&nbsp;<span class="op" id="5756129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756133">modTime</span>&nbsp;<span class="op" id="5756141">=</span>&nbsp;<span class="ident" id="5756143">hdr</span><span class="op" id="5756146">.</span><span class="ident" id="5756147">ModTime</span><span class="op" id="5756154">.</span><span class="ident" id="5756155">Unix</span><span class="op" id="5756159">(</span><span class="op" id="5756160">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5756163">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756167">tw</span><span class="op" id="5756169">.</span><span class="ident" id="5756170">octal</span><span class="op" id="5756175">(</span><span class="ident" id="5756176">s</span><span class="op" id="5756177">.</span><span class="ident" id="5756178">next</span><span class="op" id="5756182">(</span><span class="num" id="5756183">8</span><span class="op" id="5756184">)</span><span class="op" id="5756185">,</span>&nbsp;<span class="ident" id="5756187">hdr</span><span class="op" id="5756190">.</span><span class="ident" id="5756191">Mode</span><span class="op" id="5756195">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756231">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756243">tw</span><span class="op" id="5756245">.</span><span class="ident" id="5756246">numeric</span><span class="op" id="5756253">(</span><span class="ident" id="5756254">s</span><span class="op" id="5756255">.</span><span class="ident" id="5756256">next</span><span class="op" id="5756260">(</span><span class="num" id="5756261">8</span><span class="op" id="5756262">)</span><span class="op" id="5756263">,</span>&nbsp;<span class="ident" id="5756265">int64</span><span class="op" id="5756270">(</span><span class="ident" id="5756271">hdr</span><span class="op" id="5756274">.</span><span class="ident" id="5756275">Uid</span><span class="op" id="5756278">)</span><span class="op" id="5756279">,</span>&nbsp;<span class="builtintype" id="5756281">true</span><span class="op" id="5756285">,</span>&nbsp;<span class="ident" id="5756287">paxUid</span><span class="op" id="5756293">,</span>&nbsp;<span class="ident" id="5756295">paxHeaders</span><span class="op" id="5756305">)</span>&nbsp;<span class="comment" id="5756307">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756319">tw</span><span class="op" id="5756321">.</span><span class="ident" id="5756322">numeric</span><span class="op" id="5756329">(</span><span class="ident" id="5756330">s</span><span class="op" id="5756331">.</span><span class="ident" id="5756332">next</span><span class="op" id="5756336">(</span><span class="num" id="5756337">8</span><span class="op" id="5756338">)</span><span class="op" id="5756339">,</span>&nbsp;<span class="ident" id="5756341">int64</span><span class="op" id="5756346">(</span><span class="ident" id="5756347">hdr</span><span class="op" id="5756350">.</span><span class="ident" id="5756351">Gid</span><span class="op" id="5756354">)</span><span class="op" id="5756355">,</span>&nbsp;<span class="builtintype" id="5756357">true</span><span class="op" id="5756361">,</span>&nbsp;<span class="ident" id="5756363">paxGid</span><span class="op" id="5756369">,</span>&nbsp;<span class="ident" id="5756371">paxHeaders</span><span class="op" id="5756381">)</span>&nbsp;<span class="comment" id="5756383">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756395">tw</span><span class="op" id="5756397">.</span><span class="ident" id="5756398">numeric</span><span class="op" id="5756405">(</span><span class="ident" id="5756406">s</span><span class="op" id="5756407">.</span><span class="ident" id="5756408">next</span><span class="op" id="5756412">(</span><span class="num" id="5756413">12</span><span class="op" id="5756415">)</span><span class="op" id="5756416">,</span>&nbsp;<span class="ident" id="5756418">hdr</span><span class="op" id="5756421">.</span><span class="ident" id="5756422">Size</span><span class="op" id="5756426">,</span>&nbsp;<span class="builtintype" id="5756428">true</span><span class="op" id="5756432">,</span>&nbsp;<span class="ident" id="5756434">paxSize</span><span class="op" id="5756441">,</span>&nbsp;<span class="ident" id="5756443">paxHeaders</span><span class="op" id="5756453">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756459">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756471">tw</span><span class="op" id="5756473">.</span><span class="ident" id="5756474">numeric</span><span class="op" id="5756481">(</span><span class="ident" id="5756482">s</span><span class="op" id="5756483">.</span><span class="ident" id="5756484">next</span><span class="op" id="5756488">(</span><span class="num" id="5756489">12</span><span class="op" id="5756491">)</span><span class="op" id="5756492">,</span>&nbsp;<span class="ident" id="5756494">modTime</span><span class="op" id="5756501">,</span>&nbsp;<span class="builtintype" id="5756503">false</span><span class="op" id="5756508">,</span>&nbsp;<span class="ident" id="5756510">paxNone</span><span class="op" id="5756517">,</span>&nbsp;<span class="ident" id="5756519">nil</span><span class="op" id="5756522">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756535">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756592">s</span><span class="op" id="5756593">.</span><span class="ident" id="5756594">next</span><span class="op" id="5756598">(</span><span class="num" id="5756599">8</span><span class="op" id="5756600">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756656">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756677">s</span><span class="op" id="5756678">.</span><span class="ident" id="5756679">next</span><span class="op" id="5756683">(</span><span class="num" id="5756684">1</span><span class="op" id="5756685">)</span><span class="op" id="5756686">[</span><span class="num" id="5756687">0</span><span class="op" id="5756688">]</span>&nbsp;<span class="op" id="5756690">=</span>&nbsp;<span class="ident" id="5756692">hdr</span><span class="op" id="5756695">.</span><span class="ident" id="5756696">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756741">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756754">tw</span><span class="op" id="5756756">.</span><span class="ident" id="5756757">cString</span><span class="op" id="5756764">(</span><span class="ident" id="5756765">s</span><span class="op" id="5756766">.</span><span class="ident" id="5756767">next</span><span class="op" id="5756771">(</span><span class="num" id="5756772">100</span><span class="op" id="5756775">)</span><span class="op" id="5756776">,</span>&nbsp;<span class="ident" id="5756778">hdr</span><span class="op" id="5756781">.</span><span class="ident" id="5756782">Linkname</span><span class="op" id="5756790">,</span>&nbsp;<span class="builtintype" id="5756792">true</span><span class="op" id="5756796">,</span>&nbsp;<span class="ident" id="5756798">paxLinkpath</span><span class="op" id="5756809">,</span>&nbsp;<span class="ident" id="5756811">paxHeaders</span><span class="op" id="5756821">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5756825">copy</span><span class="op" id="5756829">(</span><span class="ident" id="5756830">s</span><span class="op" id="5756831">.</span><span class="ident" id="5756832">next</span><span class="op" id="5756836">(</span><span class="num" id="5756837">8</span><span class="op" id="5756838">)</span><span class="op" id="5756839">,</span>&nbsp;<span class="op" id="5756841">[</span><span class="op" id="5756842">]</span><span class="builtintype" id="5756843">byte</span><span class="op" id="5756847">(</span><span class="string" id="5756848">&#34;ustar\x0000&#34;</span><span class="op" id="5756861">)</span><span class="op" id="5756862">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5756887">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756899">tw</span><span class="op" id="5756901">.</span><span class="ident" id="5756902">cString</span><span class="op" id="5756909">(</span><span class="ident" id="5756910">s</span><span class="op" id="5756911">.</span><span class="ident" id="5756912">next</span><span class="op" id="5756916">(</span><span class="num" id="5756917">32</span><span class="op" id="5756919">)</span><span class="op" id="5756920">,</span>&nbsp;<span class="ident" id="5756922">hdr</span><span class="op" id="5756925">.</span><span class="ident" id="5756926">Uname</span><span class="op" id="5756931">,</span>&nbsp;<span class="builtintype" id="5756933">true</span><span class="op" id="5756937">,</span>&nbsp;<span class="ident" id="5756939">paxUname</span><span class="op" id="5756947">,</span>&nbsp;<span class="ident" id="5756949">paxHeaders</span><span class="op" id="5756959">)</span>&nbsp;<span class="comment" id="5756961">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5756973">tw</span><span class="op" id="5756975">.</span><span class="ident" id="5756976">cString</span><span class="op" id="5756983">(</span><span class="ident" id="5756984">s</span><span class="op" id="5756985">.</span><span class="ident" id="5756986">next</span><span class="op" id="5756990">(</span><span class="num" id="5756991">32</span><span class="op" id="5756993">)</span><span class="op" id="5756994">,</span>&nbsp;<span class="ident" id="5756996">hdr</span><span class="op" id="5756999">.</span><span class="ident" id="5757000">Gname</span><span class="op" id="5757005">,</span>&nbsp;<span class="builtintype" id="5757007">true</span><span class="op" id="5757011">,</span>&nbsp;<span class="ident" id="5757013">paxGname</span><span class="op" id="5757021">,</span>&nbsp;<span class="ident" id="5757023">paxHeaders</span><span class="op" id="5757033">)</span>&nbsp;<span class="comment" id="5757035">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757047">tw</span><span class="op" id="5757049">.</span><span class="ident" id="5757050">numeric</span><span class="op" id="5757057">(</span><span class="ident" id="5757058">s</span><span class="op" id="5757059">.</span><span class="ident" id="5757060">next</span><span class="op" id="5757064">(</span><span class="num" id="5757065">8</span><span class="op" id="5757066">)</span><span class="op" id="5757067">,</span>&nbsp;<span class="ident" id="5757069">hdr</span><span class="op" id="5757072">.</span><span class="ident" id="5757073">Devmajor</span><span class="op" id="5757081">,</span>&nbsp;<span class="builtintype" id="5757083">false</span><span class="op" id="5757088">,</span>&nbsp;<span class="ident" id="5757090">paxNone</span><span class="op" id="5757097">,</span>&nbsp;<span class="ident" id="5757099">nil</span><span class="op" id="5757102">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757109">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757121">tw</span><span class="op" id="5757123">.</span><span class="ident" id="5757124">numeric</span><span class="op" id="5757131">(</span><span class="ident" id="5757132">s</span><span class="op" id="5757133">.</span><span class="ident" id="5757134">next</span><span class="op" id="5757138">(</span><span class="num" id="5757139">8</span><span class="op" id="5757140">)</span><span class="op" id="5757141">,</span>&nbsp;<span class="ident" id="5757143">hdr</span><span class="op" id="5757146">.</span><span class="ident" id="5757147">Devminor</span><span class="op" id="5757155">,</span>&nbsp;<span class="builtintype" id="5757157">false</span><span class="op" id="5757162">,</span>&nbsp;<span class="ident" id="5757164">paxNone</span><span class="op" id="5757171">,</span>&nbsp;<span class="ident" id="5757173">nil</span><span class="op" id="5757176">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757183">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757196">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757322">prefixHeaderBytes</span>&nbsp;<span class="op" id="5757340">:=</span>&nbsp;<span class="ident" id="5757343">s</span><span class="op" id="5757344">.</span><span class="ident" id="5757345">next</span><span class="op" id="5757349">(</span><span class="num" id="5757350">155</span><span class="op" id="5757353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757356">tw</span><span class="op" id="5757358">.</span><span class="ident" id="5757359">cString</span><span class="op" id="5757366">(</span><span class="ident" id="5757367">prefixHeaderBytes</span><span class="op" id="5757384">,</span>&nbsp;<span class="string" id="5757386">&#34;&#34;</span><span class="op" id="5757388">,</span>&nbsp;<span class="builtintype" id="5757390">false</span><span class="op" id="5757395">,</span>&nbsp;<span class="ident" id="5757397">paxNone</span><span class="op" id="5757404">,</span>&nbsp;<span class="ident" id="5757406">nil</span><span class="op" id="5757409">)</span>&nbsp;<span class="comment" id="5757411">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757432">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5757508">if</span>&nbsp;<span class="ident" id="5757511">tw</span><span class="op" id="5757513">.</span><span class="ident" id="5757514">usedBinary</span>&nbsp;<span class="op" id="5757525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5757529">copy</span><span class="op" id="5757533">(</span><span class="ident" id="5757534">header</span><span class="op" id="5757540">[</span><span class="num" id="5757541">257</span><span class="op" id="5757544">:</span><span class="num" id="5757545">265</span><span class="op" id="5757548">]</span><span class="op" id="5757549">,</span>&nbsp;<span class="op" id="5757551">[</span><span class="op" id="5757552">]</span><span class="builtintype" id="5757553">byte</span><span class="op" id="5757557">(</span><span class="string" id="5757558">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5757571">)</span><span class="op" id="5757572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5757575">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757579">_</span><span class="op" id="5757580">,</span>&nbsp;<span class="ident" id="5757582">paxPathUsed</span>&nbsp;<span class="op" id="5757594">:=</span>&nbsp;<span class="ident" id="5757597">paxHeaders</span><span class="op" id="5757607">[</span><span class="ident" id="5757608">paxPath</span><span class="op" id="5757615">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757618">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5757679">if</span>&nbsp;<span class="op" id="5757682">!</span><span class="ident" id="5757683">tw</span><span class="op" id="5757685">.</span><span class="ident" id="5757686">preferPax</span>&nbsp;<span class="op" id="5757696">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5757699">len</span><span class="op" id="5757702">(</span><span class="ident" id="5757703">paxHeaders</span><span class="op" id="5757713">)</span>&nbsp;<span class="op" id="5757715">==</span>&nbsp;<span class="num" id="5757718">1</span>&nbsp;<span class="op" id="5757720">&amp;&amp;</span>&nbsp;<span class="ident" id="5757723">paxPathUsed</span>&nbsp;<span class="op" id="5757735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757739">suffix</span>&nbsp;<span class="op" id="5757746">:=</span>&nbsp;<span class="ident" id="5757749">hdr</span><span class="op" id="5757752">.</span><span class="ident" id="5757753">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757760">prefix</span>&nbsp;<span class="op" id="5757767">:=</span>&nbsp;<span class="string" id="5757770">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5757775">if</span>&nbsp;<span class="builtinfunc" id="5757778">len</span><span class="op" id="5757781">(</span><span class="ident" id="5757782">hdr</span><span class="op" id="5757785">.</span><span class="ident" id="5757786">Name</span><span class="op" id="5757790">)</span>&nbsp;<span class="op" id="5757792">&gt;</span>&nbsp;<span class="ident" id="5757794">fileNameSize</span>&nbsp;<span class="op" id="5757807">&amp;&amp;</span>&nbsp;<span class="ident" id="5757810">isASCII</span><span class="op" id="5757817">(</span><span class="ident" id="5757818">hdr</span><span class="op" id="5757821">.</span><span class="ident" id="5757822">Name</span><span class="op" id="5757826">)</span>&nbsp;<span class="op" id="5757828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5757833">var</span>&nbsp;<span class="ident" id="5757837">err</span>&nbsp;<span class="builtintype" id="5757841">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5757850">prefix</span><span class="op" id="5757856">,</span>&nbsp;<span class="ident" id="5757858">suffix</span><span class="op" id="5757864">,</span>&nbsp;<span class="ident" id="5757866">err</span>&nbsp;<span class="op" id="5757870">=</span>&nbsp;<span class="ident" id="5757872">tw</span><span class="op" id="5757874">.</span><span class="ident" id="5757875">splitUSTARLongName</span><span class="op" id="5757893">(</span><span class="ident" id="5757894">hdr</span><span class="op" id="5757897">.</span><span class="ident" id="5757898">Name</span><span class="op" id="5757902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5757907">if</span>&nbsp;<span class="ident" id="5757910">err</span>&nbsp;<span class="op" id="5757914">==</span>&nbsp;<span class="ident" id="5757917">nil</span>&nbsp;<span class="op" id="5757921">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5757927">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758006">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5758090">delete</span><span class="op" id="5758096">(</span><span class="ident" id="5758097">paxHeaders</span><span class="op" id="5758107">,</span>&nbsp;<span class="ident" id="5758109">paxPath</span><span class="op" id="5758116">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758123">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758153">tw</span><span class="op" id="5758155">.</span><span class="ident" id="5758156">cString</span><span class="op" id="5758163">(</span><span class="ident" id="5758164">pathHeaderBytes</span><span class="op" id="5758179">,</span>&nbsp;<span class="ident" id="5758181">suffix</span><span class="op" id="5758187">,</span>&nbsp;<span class="builtintype" id="5758189">false</span><span class="op" id="5758194">,</span>&nbsp;<span class="ident" id="5758196">paxNone</span><span class="op" id="5758203">,</span>&nbsp;<span class="ident" id="5758205">nil</span><span class="op" id="5758208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758214">tw</span><span class="op" id="5758216">.</span><span class="ident" id="5758217">cString</span><span class="op" id="5758224">(</span><span class="ident" id="5758225">prefixHeaderBytes</span><span class="op" id="5758242">,</span>&nbsp;<span class="ident" id="5758244">prefix</span><span class="op" id="5758250">,</span>&nbsp;<span class="builtintype" id="5758252">false</span><span class="op" id="5758257">,</span>&nbsp;<span class="ident" id="5758259">paxNone</span><span class="op" id="5758266">,</span>&nbsp;<span class="ident" id="5758268">nil</span><span class="op" id="5758271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758278">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758334">if</span>&nbsp;<span class="builtinfunc" id="5758337">len</span><span class="op" id="5758340">(</span><span class="ident" id="5758341">prefix</span><span class="op" id="5758347">)</span>&nbsp;<span class="op" id="5758349">&gt;</span>&nbsp;<span class="num" id="5758351">0</span>&nbsp;<span class="op" id="5758353">&amp;&amp;</span>&nbsp;<span class="op" id="5758356">!</span><span class="ident" id="5758357">tw</span><span class="op" id="5758359">.</span><span class="ident" id="5758360">usedBinary</span>&nbsp;<span class="op" id="5758371">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="5758378">copy</span><span class="op" id="5758382">(</span><span class="ident" id="5758383">header</span><span class="op" id="5758389">[</span><span class="num" id="5758390">257</span><span class="op" id="5758393">:</span><span class="num" id="5758394">265</span><span class="op" id="5758397">]</span><span class="op" id="5758398">,</span>&nbsp;<span class="op" id="5758400">[</span><span class="op" id="5758401">]</span><span class="builtintype" id="5758402">byte</span><span class="op" id="5758406">(</span><span class="string" id="5758407">&#34;ustar\x00&#34;</span><span class="op" id="5758418">)</span><span class="op" id="5758419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758437">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758441">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758498">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758549">chksum</span><span class="op" id="5758555">,</span>&nbsp;<span class="ident" id="5758557">_</span>&nbsp;<span class="op" id="5758559">:=</span>&nbsp;<span class="ident" id="5758562">checksum</span><span class="op" id="5758570">(</span><span class="ident" id="5758571">header</span><span class="op" id="5758577">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758580">tw</span><span class="op" id="5758582">.</span><span class="ident" id="5758583">octal</span><span class="op" id="5758588">(</span><span class="ident" id="5758589">header</span><span class="op" id="5758595">[</span><span class="num" id="5758596">148</span><span class="op" id="5758599">:</span><span class="num" id="5758600">155</span><span class="op" id="5758603">]</span><span class="op" id="5758604">,</span>&nbsp;<span class="ident" id="5758606">chksum</span><span class="op" id="5758612">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758615">header</span><span class="op" id="5758621">[</span><span class="num" id="5758622">155</span><span class="op" id="5758625">]</span>&nbsp;<span class="op" id="5758627">=</span>&nbsp;<span class="string" id="5758629">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758635">if</span>&nbsp;<span class="ident" id="5758638">tw</span><span class="op" id="5758640">.</span><span class="ident" id="5758641">err</span>&nbsp;<span class="op" id="5758645">!=</span>&nbsp;<span class="ident" id="5758648">nil</span>&nbsp;<span class="op" id="5758652">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5758656">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758720">return</span>&nbsp;<span class="ident" id="5758727">tw</span><span class="op" id="5758729">.</span><span class="ident" id="5758730">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758735">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758739">if</span>&nbsp;<span class="ident" id="5758742">allowPax</span>&nbsp;<span class="op" id="5758751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758755">for</span>&nbsp;<span class="ident" id="5758759">k</span><span class="op" id="5758760">,</span>&nbsp;<span class="ident" id="5758762">v</span>&nbsp;<span class="op" id="5758764">:=</span>&nbsp;<span class="keyword" id="5758767">range</span>&nbsp;<span class="ident" id="5758773">hdr</span><span class="op" id="5758776">.</span><span class="ident" id="5758777">Xattrs</span>&nbsp;<span class="op" id="5758784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758789">paxHeaders</span><span class="op" id="5758799">[</span><span class="ident" id="5758800">paxXattr</span><span class="op" id="5758808">+</span><span class="ident" id="5758809">k</span><span class="op" id="5758810">]</span>&nbsp;<span class="op" id="5758812">=</span>&nbsp;<span class="ident" id="5758814">v</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758818">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758825">if</span>&nbsp;<span class="builtinfunc" id="5758828">len</span><span class="op" id="5758831">(</span><span class="ident" id="5758832">paxHeaders</span><span class="op" id="5758842">)</span>&nbsp;<span class="op" id="5758844">&gt;</span>&nbsp;<span class="num" id="5758846">0</span>&nbsp;<span class="op" id="5758848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758852">if</span>&nbsp;<span class="op" id="5758855">!</span><span class="ident" id="5758856">allowPax</span>&nbsp;<span class="op" id="5758865">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758870">return</span>&nbsp;<span class="ident" id="5758877">errInvalidHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758900">if</span>&nbsp;<span class="ident" id="5758903">err</span>&nbsp;<span class="op" id="5758907">:=</span>&nbsp;<span class="ident" id="5758910">tw</span><span class="op" id="5758912">.</span><span class="ident" id="5758913">writePAXHeader</span><span class="op" id="5758927">(</span><span class="ident" id="5758928">hdr</span><span class="op" id="5758931">,</span>&nbsp;<span class="ident" id="5758933">paxHeaders</span><span class="op" id="5758943">)</span><span class="op" id="5758944">;</span>&nbsp;<span class="ident" id="5758946">err</span>&nbsp;<span class="op" id="5758950">!=</span>&nbsp;<span class="ident" id="5758953">nil</span>&nbsp;<span class="op" id="5758957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5758962">return</span>&nbsp;<span class="ident" id="5758969">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758975">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5758978">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5758981">tw</span><span class="op" id="5758983">.</span><span class="ident" id="5758984">nb</span>&nbsp;<span class="op" id="5758987">=</span>&nbsp;<span class="ident" id="5758989">int64</span><span class="op" id="5758994">(</span><span class="ident" id="5758995">hdr</span><span class="op" id="5758998">.</span><span class="ident" id="5758999">Size</span><span class="op" id="5759003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759006">tw</span><span class="op" id="5759008">.</span><span class="ident" id="5759009">pad</span>&nbsp;<span class="op" id="5759013">=</span>&nbsp;<span class="op" id="5759015">(</span><span class="ident" id="5759016">blockSize</span>&nbsp;<span class="op" id="5759026">-</span>&nbsp;<span class="op" id="5759028">(</span><span class="ident" id="5759029">tw</span><span class="op" id="5759031">.</span><span class="ident" id="5759032">nb</span>&nbsp;<span class="op" id="5759035">%</span>&nbsp;<span class="ident" id="5759037">blockSize</span><span class="op" id="5759046">)</span><span class="op" id="5759047">)</span>&nbsp;<span class="op" id="5759049">%</span>&nbsp;<span class="ident" id="5759051">blockSize</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759063">_</span><span class="op" id="5759064">,</span>&nbsp;<span class="ident" id="5759066">tw</span><span class="op" id="5759068">.</span><span class="ident" id="5759069">err</span>&nbsp;<span class="op" id="5759073">=</span>&nbsp;<span class="ident" id="5759075">tw</span><span class="op" id="5759077">.</span><span class="ident" id="5759078">w</span><span class="op" id="5759079">.</span><span class="ident" id="5759080">Write</span><span class="op" id="5759085">(</span><span class="ident" id="5759086">header</span><span class="op" id="5759092">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759095">return</span>&nbsp;<span class="ident" id="5759102">tw</span><span class="op" id="5759104">.</span><span class="ident" id="5759105">err</span><br>
<span class="lineno"></span><span class="op" id="5759109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759112">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="5759169">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="5759230">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="5759285">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="5759316">func</span>&nbsp;<span class="op" id="5759321">(</span><span class="ident" id="5759322">tw</span>&nbsp;<span class="op" id="5759325">*</span><span class="ident" id="5759326">Writer</span><span class="op" id="5759332">)</span>&nbsp;<span class="ident" id="5759334">splitUSTARLongName</span><span class="op" id="5759352">(</span><span class="ident" id="5759353">name</span>&nbsp;<span class="builtintype" id="5759358">string</span><span class="op" id="5759364">)</span>&nbsp;<span class="op" id="5759366">(</span><span class="ident" id="5759367">prefix</span><span class="op" id="5759373">,</span>&nbsp;<span class="ident" id="5759375">suffix</span>&nbsp;<span class="builtintype" id="5759382">string</span><span class="op" id="5759388">,</span>&nbsp;<span class="ident" id="5759390">err</span>&nbsp;<span class="builtintype" id="5759394">error</span><span class="op" id="5759399">)</span>&nbsp;<span class="op" id="5759401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759404">length</span>&nbsp;<span class="op" id="5759411">:=</span>&nbsp;<span class="builtinfunc" id="5759414">len</span><span class="op" id="5759417">(</span><span class="ident" id="5759418">name</span><span class="op" id="5759422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759425">if</span>&nbsp;<span class="ident" id="5759428">length</span>&nbsp;<span class="op" id="5759435">&gt;</span>&nbsp;<span class="ident" id="5759437">fileNamePrefixSize</span><span class="op" id="5759455">+</span><span class="num" id="5759456">1</span>&nbsp;<span class="op" id="5759458">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759462">length</span>&nbsp;<span class="op" id="5759469">=</span>&nbsp;<span class="ident" id="5759471">fileNamePrefixSize</span>&nbsp;<span class="op" id="5759490">+</span>&nbsp;<span class="num" id="5759492">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5759495">}</span>&nbsp;<span class="keyword" id="5759497">else</span>&nbsp;<span class="keyword" id="5759502">if</span>&nbsp;<span class="ident" id="5759505">name</span><span class="op" id="5759509">[</span><span class="ident" id="5759510">length</span><span class="op" id="5759516">-</span><span class="num" id="5759517">1</span><span class="op" id="5759518">]</span>&nbsp;<span class="op" id="5759520">==</span>&nbsp;<span class="string" id="5759523">&#39;/&#39;</span>&nbsp;<span class="op" id="5759527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759531">length</span><span class="op" id="5759537">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5759541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759544">i</span>&nbsp;<span class="op" id="5759546">:=</span>&nbsp;<span class="ident" id="5759549">strings</span><span class="op" id="5759556">.</span><span class="ident" id="5759557">LastIndex</span><span class="op" id="5759566">(</span><span class="ident" id="5759567">name</span><span class="op" id="5759571">[</span><span class="op" id="5759572">:</span><span class="ident" id="5759573">length</span><span class="op" id="5759579">]</span><span class="op" id="5759580">,</span>&nbsp;<span class="string" id="5759582">&#34;/&#34;</span><span class="op" id="5759585">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5759588">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5759646">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759706">nlen</span>&nbsp;<span class="op" id="5759711">:=</span>&nbsp;<span class="builtinfunc" id="5759714">len</span><span class="op" id="5759717">(</span><span class="ident" id="5759718">name</span><span class="op" id="5759722">)</span>&nbsp;<span class="op" id="5759724">-</span>&nbsp;<span class="ident" id="5759726">i</span>&nbsp;<span class="op" id="5759728">-</span>&nbsp;<span class="num" id="5759730">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759733">plen</span>&nbsp;<span class="op" id="5759738">:=</span>&nbsp;<span class="ident" id="5759741">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759744">if</span>&nbsp;<span class="ident" id="5759747">i</span>&nbsp;<span class="op" id="5759749">&lt;=</span>&nbsp;<span class="num" id="5759752">0</span>&nbsp;<span class="op" id="5759754">||</span>&nbsp;<span class="ident" id="5759757">nlen</span>&nbsp;<span class="op" id="5759762">&gt;</span>&nbsp;<span class="ident" id="5759764">fileNameSize</span>&nbsp;<span class="op" id="5759777">||</span>&nbsp;<span class="ident" id="5759780">nlen</span>&nbsp;<span class="op" id="5759785">==</span>&nbsp;<span class="num" id="5759788">0</span>&nbsp;<span class="op" id="5759790">||</span>&nbsp;<span class="ident" id="5759793">plen</span>&nbsp;<span class="op" id="5759798">&gt;</span>&nbsp;<span class="ident" id="5759800">fileNamePrefixSize</span>&nbsp;<span class="op" id="5759819">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759823">err</span>&nbsp;<span class="op" id="5759827">=</span>&nbsp;<span class="ident" id="5759829">errNameTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759846">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5759854">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5759857">prefix</span><span class="op" id="5759863">,</span>&nbsp;<span class="ident" id="5759865">suffix</span>&nbsp;<span class="op" id="5759872">=</span>&nbsp;<span class="ident" id="5759874">name</span><span class="op" id="5759878">[</span><span class="op" id="5759879">:</span><span class="ident" id="5759880">i</span><span class="op" id="5759881">]</span><span class="op" id="5759882">,</span>&nbsp;<span class="ident" id="5759884">name</span><span class="op" id="5759888">[</span><span class="ident" id="5759889">i</span><span class="op" id="5759890">+</span><span class="num" id="5759891">1</span><span class="op" id="5759892">:</span><span class="op" id="5759893">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5759896">return</span><br>
<span class="lineno">295</span><span class="op" id="5759903">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5759906">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5759961">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5759973">func</span>&nbsp;<span class="op" id="5759978">(</span><span class="ident" id="5759979">tw</span>&nbsp;<span class="op" id="5759982">*</span><span class="ident" id="5759983">Writer</span><span class="op" id="5759989">)</span>&nbsp;<span class="ident" id="5759991">writePAXHeader</span><span class="op" id="5760005">(</span><span class="ident" id="5760006">hdr</span>&nbsp;<span class="op" id="5760010">*</span><span class="ident" id="5760011">Header</span><span class="op" id="5760017">,</span>&nbsp;<span class="ident" id="5760019">paxHeaders</span>&nbsp;<span class="keyword" id="5760030">map</span><span class="op" id="5760033">[</span><span class="builtintype" id="5760034">string</span><span class="op" id="5760040">]</span><span class="builtintype" id="5760041">string</span><span class="op" id="5760047">)</span>&nbsp;<span class="builtintype" id="5760049">error</span>&nbsp;<span class="op" id="5760055">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760058">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760086">ext</span>&nbsp;<span class="op" id="5760090">:=</span>&nbsp;<span class="builtinfunc" id="5760093">new</span><span class="op" id="5760096">(</span><span class="ident" id="5760097">Header</span><span class="op" id="5760103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760106">ext</span><span class="op" id="5760109">.</span><span class="ident" id="5760110">Typeflag</span>&nbsp;<span class="op" id="5760119">=</span>&nbsp;<span class="ident" id="5760121">TypeXHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760134">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760188">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760228">ext</span><span class="op" id="5760231">.</span><span class="ident" id="5760232">ModTime</span>&nbsp;<span class="op" id="5760240">=</span>&nbsp;<span class="ident" id="5760242">hdr</span><span class="op" id="5760245">.</span><span class="ident" id="5760246">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760255">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760308">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760334">pid</span>&nbsp;<span class="op" id="5760338">:=</span>&nbsp;<span class="ident" id="5760341">os</span><span class="op" id="5760343">.</span><span class="ident" id="5760344">Getpid</span><span class="op" id="5760350">(</span><span class="op" id="5760351">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760354">dir</span><span class="op" id="5760357">,</span>&nbsp;<span class="ident" id="5760359">file</span>&nbsp;<span class="op" id="5760364">:=</span>&nbsp;<span class="ident" id="5760367">path</span><span class="op" id="5760371">.</span><span class="ident" id="5760372">Split</span><span class="op" id="5760377">(</span><span class="ident" id="5760378">hdr</span><span class="op" id="5760381">.</span><span class="ident" id="5760382">Name</span><span class="op" id="5760386">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760389">fullName</span>&nbsp;<span class="op" id="5760398">:=</span>&nbsp;<span class="ident" id="5760401">path</span><span class="op" id="5760405">.</span><span class="ident" id="5760406">Join</span><span class="op" id="5760410">(</span><span class="ident" id="5760411">dir</span><span class="op" id="5760414">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760418">fmt</span><span class="op" id="5760421">.</span><span class="ident" id="5760422">Sprintf</span><span class="op" id="5760429">(</span><span class="string" id="5760430">&#34;PaxHeaders.%d&#34;</span><span class="op" id="5760445">,</span>&nbsp;<span class="ident" id="5760447">pid</span><span class="op" id="5760450">)</span><span class="op" id="5760451">,</span>&nbsp;<span class="ident" id="5760453">file</span><span class="op" id="5760457">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760461">ascii</span>&nbsp;<span class="op" id="5760467">:=</span>&nbsp;<span class="ident" id="5760470">toASCII</span><span class="op" id="5760477">(</span><span class="ident" id="5760478">fullName</span><span class="op" id="5760486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760489">if</span>&nbsp;<span class="builtinfunc" id="5760492">len</span><span class="op" id="5760495">(</span><span class="ident" id="5760496">ascii</span><span class="op" id="5760501">)</span>&nbsp;<span class="op" id="5760503">&gt;</span>&nbsp;<span class="num" id="5760505">100</span>&nbsp;<span class="op" id="5760509">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760513">ascii</span>&nbsp;<span class="op" id="5760519">=</span>&nbsp;<span class="ident" id="5760521">ascii</span><span class="op" id="5760526">[</span><span class="op" id="5760527">:</span><span class="num" id="5760528">100</span><span class="op" id="5760531">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5760534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760537">ext</span><span class="op" id="5760540">.</span><span class="ident" id="5760541">Name</span>&nbsp;<span class="op" id="5760546">=</span>&nbsp;<span class="ident" id="5760548">ascii</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5760555">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760578">var</span>&nbsp;<span class="ident" id="5760582">buf</span>&nbsp;<span class="ident" id="5760586">bytes</span><span class="op" id="5760591">.</span><span class="ident" id="5760592">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760601">for</span>&nbsp;<span class="ident" id="5760605">k</span><span class="op" id="5760606">,</span>&nbsp;<span class="ident" id="5760608">v</span>&nbsp;<span class="op" id="5760610">:=</span>&nbsp;<span class="keyword" id="5760613">range</span>&nbsp;<span class="ident" id="5760619">paxHeaders</span>&nbsp;<span class="op" id="5760630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760634">fmt</span><span class="op" id="5760637">.</span><span class="ident" id="5760638">Fprint</span><span class="op" id="5760644">(</span><span class="op" id="5760645">&amp;</span><span class="ident" id="5760646">buf</span><span class="op" id="5760649">,</span>&nbsp;<span class="ident" id="5760651">paxHeader</span><span class="op" id="5760660">(</span><span class="ident" id="5760661">k</span><span class="op" id="5760662">+</span><span class="string" id="5760663">&#34;=&#34;</span><span class="op" id="5760666">+</span><span class="ident" id="5760667">v</span><span class="op" id="5760668">)</span><span class="op" id="5760669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5760672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5760676">ext</span><span class="op" id="5760679">.</span><span class="ident" id="5760680">Size</span>&nbsp;<span class="op" id="5760685">=</span>&nbsp;<span class="ident" id="5760687">int64</span><span class="op" id="5760692">(</span><span class="builtinfunc" id="5760693">len</span><span class="op" id="5760696">(</span><span class="ident" id="5760697">buf</span><span class="op" id="5760700">.</span><span class="ident" id="5760701">Bytes</span><span class="op" id="5760706">(</span><span class="op" id="5760707">)</span><span class="op" id="5760708">)</span><span class="op" id="5760709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760712">if</span>&nbsp;<span class="ident" id="5760715">err</span>&nbsp;<span class="op" id="5760719">:=</span>&nbsp;<span class="ident" id="5760722">tw</span><span class="op" id="5760724">.</span><span class="ident" id="5760725">writeHeader</span><span class="op" id="5760736">(</span><span class="ident" id="5760737">ext</span><span class="op" id="5760740">,</span>&nbsp;<span class="builtintype" id="5760742">false</span><span class="op" id="5760747">)</span><span class="op" id="5760748">;</span>&nbsp;<span class="ident" id="5760750">err</span>&nbsp;<span class="op" id="5760754">!=</span>&nbsp;<span class="ident" id="5760757">nil</span>&nbsp;<span class="op" id="5760761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760765">return</span>&nbsp;<span class="ident" id="5760772">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5760777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760780">if</span>&nbsp;<span class="ident" id="5760783">_</span><span class="op" id="5760784">,</span>&nbsp;<span class="ident" id="5760786">err</span>&nbsp;<span class="op" id="5760790">:=</span>&nbsp;<span class="ident" id="5760793">tw</span><span class="op" id="5760795">.</span><span class="ident" id="5760796">Write</span><span class="op" id="5760801">(</span><span class="ident" id="5760802">buf</span><span class="op" id="5760805">.</span><span class="ident" id="5760806">Bytes</span><span class="op" id="5760811">(</span><span class="op" id="5760812">)</span><span class="op" id="5760813">)</span><span class="op" id="5760814">;</span>&nbsp;<span class="ident" id="5760816">err</span>&nbsp;<span class="op" id="5760820">!=</span>&nbsp;<span class="ident" id="5760823">nil</span>&nbsp;<span class="op" id="5760827">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760831">return</span>&nbsp;<span class="ident" id="5760838">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5760843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760846">if</span>&nbsp;<span class="ident" id="5760849">err</span>&nbsp;<span class="op" id="5760853">:=</span>&nbsp;<span class="ident" id="5760856">tw</span><span class="op" id="5760858">.</span><span class="ident" id="5760859">Flush</span><span class="op" id="5760864">(</span><span class="op" id="5760865">)</span><span class="op" id="5760866">;</span>&nbsp;<span class="ident" id="5760868">err</span>&nbsp;<span class="op" id="5760872">!=</span>&nbsp;<span class="ident" id="5760875">nil</span>&nbsp;<span class="op" id="5760879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760883">return</span>&nbsp;<span class="ident" id="5760890">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5760895">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5760898">return</span>&nbsp;<span class="ident" id="5760905">nil</span><br>
<span class="lineno"></span><span class="op" id="5760909">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5760912">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="5760995">func</span>&nbsp;<span class="ident" id="5761000">paxHeader</span><span class="op" id="5761009">(</span><span class="ident" id="5761010">msg</span>&nbsp;<span class="builtintype" id="5761014">string</span><span class="op" id="5761020">)</span>&nbsp;<span class="builtintype" id="5761022">string</span>&nbsp;<span class="op" id="5761029">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761032">const</span>&nbsp;<span class="ident" id="5761038">padding</span>&nbsp;<span class="op" id="5761046">=</span>&nbsp;<span class="num" id="5761048">2</span>&nbsp;<span class="comment" id="5761050">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761090">size</span>&nbsp;<span class="op" id="5761095">:=</span>&nbsp;<span class="builtinfunc" id="5761098">len</span><span class="op" id="5761101">(</span><span class="ident" id="5761102">msg</span><span class="op" id="5761105">)</span>&nbsp;<span class="op" id="5761107">+</span>&nbsp;<span class="ident" id="5761109">padding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761118">size</span>&nbsp;<span class="op" id="5761123">+=</span>&nbsp;<span class="builtinfunc" id="5761126">len</span><span class="op" id="5761129">(</span><span class="ident" id="5761130">strconv</span><span class="op" id="5761137">.</span><span class="ident" id="5761138">Itoa</span><span class="op" id="5761142">(</span><span class="ident" id="5761143">size</span><span class="op" id="5761147">)</span><span class="op" id="5761148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761151">record</span>&nbsp;<span class="op" id="5761158">:=</span>&nbsp;<span class="ident" id="5761161">fmt</span><span class="op" id="5761164">.</span><span class="ident" id="5761165">Sprintf</span><span class="op" id="5761172">(</span><span class="string" id="5761173">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5761182">,</span>&nbsp;<span class="ident" id="5761184">size</span><span class="op" id="5761188">,</span>&nbsp;<span class="ident" id="5761190">msg</span><span class="op" id="5761193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761196">if</span>&nbsp;<span class="builtinfunc" id="5761199">len</span><span class="op" id="5761202">(</span><span class="ident" id="5761203">record</span><span class="op" id="5761209">)</span>&nbsp;<span class="op" id="5761211">!=</span>&nbsp;<span class="ident" id="5761214">size</span>&nbsp;<span class="op" id="5761219">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5761223">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5761270">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761304">size</span>&nbsp;<span class="op" id="5761309">=</span>&nbsp;<span class="builtinfunc" id="5761311">len</span><span class="op" id="5761314">(</span><span class="ident" id="5761315">record</span><span class="op" id="5761321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761325">record</span>&nbsp;<span class="op" id="5761332">=</span>&nbsp;<span class="ident" id="5761334">fmt</span><span class="op" id="5761337">.</span><span class="ident" id="5761338">Sprintf</span><span class="op" id="5761345">(</span><span class="string" id="5761346">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5761355">,</span>&nbsp;<span class="ident" id="5761357">size</span><span class="op" id="5761361">,</span>&nbsp;<span class="ident" id="5761363">msg</span><span class="op" id="5761366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5761369">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761372">return</span>&nbsp;<span class="ident" id="5761379">record</span><br>
<span class="lineno"></span><span class="op" id="5761386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5761389">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5761446">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="5761502">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5761551">func</span>&nbsp;<span class="op" id="5761556">(</span><span class="ident" id="5761557">tw</span>&nbsp;<span class="op" id="5761560">*</span><span class="ident" id="5761561">Writer</span><span class="op" id="5761567">)</span>&nbsp;<span class="ident" id="5761569">Write</span><span class="op" id="5761574">(</span><span class="ident" id="5761575">b</span>&nbsp;<span class="op" id="5761577">[</span><span class="op" id="5761578">]</span><span class="builtintype" id="5761579">byte</span><span class="op" id="5761583">)</span>&nbsp;<span class="op" id="5761585">(</span><span class="ident" id="5761586">n</span>&nbsp;<span class="builtintype" id="5761588">int</span><span class="op" id="5761591">,</span>&nbsp;<span class="ident" id="5761593">err</span>&nbsp;<span class="builtintype" id="5761597">error</span><span class="op" id="5761602">)</span>&nbsp;<span class="op" id="5761604">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761607">if</span>&nbsp;<span class="ident" id="5761610">tw</span><span class="op" id="5761612">.</span><span class="ident" id="5761613">closed</span>&nbsp;<span class="op" id="5761620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761624">err</span>&nbsp;<span class="op" id="5761628">=</span>&nbsp;<span class="ident" id="5761630">ErrWriteTooLong</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761648">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5761656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761659">overwrite</span>&nbsp;<span class="op" id="5761669">:=</span>&nbsp;<span class="builtintype" id="5761672">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761679">if</span>&nbsp;<span class="ident" id="5761682">int64</span><span class="op" id="5761687">(</span><span class="builtinfunc" id="5761688">len</span><span class="op" id="5761691">(</span><span class="ident" id="5761692">b</span><span class="op" id="5761693">)</span><span class="op" id="5761694">)</span>&nbsp;<span class="op" id="5761696">&gt;</span>&nbsp;<span class="ident" id="5761698">tw</span><span class="op" id="5761700">.</span><span class="ident" id="5761701">nb</span>&nbsp;<span class="op" id="5761704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761708">b</span>&nbsp;<span class="op" id="5761710">=</span>&nbsp;<span class="ident" id="5761712">b</span><span class="op" id="5761713">[</span><span class="num" id="5761714">0</span><span class="op" id="5761715">:</span><span class="ident" id="5761716">tw</span><span class="op" id="5761718">.</span><span class="ident" id="5761719">nb</span><span class="op" id="5761721">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761725">overwrite</span>&nbsp;<span class="op" id="5761735">=</span>&nbsp;<span class="builtintype" id="5761737">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5761743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761746">n</span><span class="op" id="5761747">,</span>&nbsp;<span class="ident" id="5761749">err</span>&nbsp;<span class="op" id="5761753">=</span>&nbsp;<span class="ident" id="5761755">tw</span><span class="op" id="5761757">.</span><span class="ident" id="5761758">w</span><span class="op" id="5761759">.</span><span class="ident" id="5761760">Write</span><span class="op" id="5761765">(</span><span class="ident" id="5761766">b</span><span class="op" id="5761767">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761770">tw</span><span class="op" id="5761772">.</span><span class="ident" id="5761773">nb</span>&nbsp;<span class="op" id="5761776">-=</span>&nbsp;<span class="ident" id="5761779">int64</span><span class="op" id="5761784">(</span><span class="ident" id="5761785">n</span><span class="op" id="5761786">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761789">if</span>&nbsp;<span class="ident" id="5761792">err</span>&nbsp;<span class="op" id="5761796">==</span>&nbsp;<span class="ident" id="5761799">nil</span>&nbsp;<span class="op" id="5761803">&amp;&amp;</span>&nbsp;<span class="ident" id="5761806">overwrite</span>&nbsp;<span class="op" id="5761816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761820">err</span>&nbsp;<span class="op" id="5761824">=</span>&nbsp;<span class="ident" id="5761826">ErrWriteTooLong</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761844">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5761852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5761855">tw</span><span class="op" id="5761857">.</span><span class="ident" id="5761858">err</span>&nbsp;<span class="op" id="5761862">=</span>&nbsp;<span class="ident" id="5761864">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5761869">return</span><br>
<span class="lineno"></span><span class="op" id="5761876">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5761879">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="5761935">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5761969">func</span>&nbsp;<span class="op" id="5761974">(</span><span class="ident" id="5761975">tw</span>&nbsp;<span class="op" id="5761978">*</span><span class="ident" id="5761979">Writer</span><span class="op" id="5761985">)</span>&nbsp;<span class="ident" id="5761987">Close</span><span class="op" id="5761992">(</span><span class="op" id="5761993">)</span>&nbsp;<span class="builtintype" id="5761995">error</span>&nbsp;<span class="op" id="5762001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762004">if</span>&nbsp;<span class="ident" id="5762007">tw</span><span class="op" id="5762009">.</span><span class="ident" id="5762010">err</span>&nbsp;<span class="op" id="5762014">!=</span>&nbsp;<span class="ident" id="5762017">nil</span>&nbsp;<span class="op" id="5762021">||</span>&nbsp;<span class="ident" id="5762024">tw</span><span class="op" id="5762026">.</span><span class="ident" id="5762027">closed</span>&nbsp;<span class="op" id="5762034">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762038">return</span>&nbsp;<span class="ident" id="5762045">tw</span><span class="op" id="5762047">.</span><span class="ident" id="5762048">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5762053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5762056">tw</span><span class="op" id="5762058">.</span><span class="ident" id="5762059">Flush</span><span class="op" id="5762064">(</span><span class="op" id="5762065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5762068">tw</span><span class="op" id="5762070">.</span><span class="ident" id="5762071">closed</span>&nbsp;<span class="op" id="5762078">=</span>&nbsp;<span class="builtintype" id="5762080">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762086">if</span>&nbsp;<span class="ident" id="5762089">tw</span><span class="op" id="5762091">.</span><span class="ident" id="5762092">err</span>&nbsp;<span class="op" id="5762096">!=</span>&nbsp;<span class="ident" id="5762099">nil</span>&nbsp;<span class="op" id="5762103">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762107">return</span>&nbsp;<span class="ident" id="5762114">tw</span><span class="op" id="5762116">.</span><span class="ident" id="5762117">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5762122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5762126">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762155">for</span>&nbsp;<span class="ident" id="5762159">i</span>&nbsp;<span class="op" id="5762161">:=</span>&nbsp;<span class="num" id="5762164">0</span><span class="op" id="5762165">;</span>&nbsp;<span class="ident" id="5762167">i</span>&nbsp;<span class="op" id="5762169">&lt;</span>&nbsp;<span class="num" id="5762171">2</span><span class="op" id="5762172">;</span>&nbsp;<span class="ident" id="5762174">i</span><span class="op" id="5762175">++</span>&nbsp;<span class="op" id="5762178">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5762182">_</span><span class="op" id="5762183">,</span>&nbsp;<span class="ident" id="5762185">tw</span><span class="op" id="5762187">.</span><span class="ident" id="5762188">err</span>&nbsp;<span class="op" id="5762192">=</span>&nbsp;<span class="ident" id="5762194">tw</span><span class="op" id="5762196">.</span><span class="ident" id="5762197">w</span><span class="op" id="5762198">.</span><span class="ident" id="5762199">Write</span><span class="op" id="5762204">(</span><span class="ident" id="5762205">zeroBlock</span><span class="op" id="5762214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762218">if</span>&nbsp;<span class="ident" id="5762221">tw</span><span class="op" id="5762223">.</span><span class="ident" id="5762224">err</span>&nbsp;<span class="op" id="5762228">!=</span>&nbsp;<span class="ident" id="5762231">nil</span>&nbsp;<span class="op" id="5762235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762240">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5762248">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5762251">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5762254">return</span>&nbsp;<span class="ident" id="5762261">tw</span><span class="op" id="5762263">.</span><span class="ident" id="5762264">err</span><br>
<span class="lineno"></span><span class="op" id="5762268">}</span>
</div>
</body>
</html>
