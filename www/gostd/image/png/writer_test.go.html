<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/png</h2>
<ul>
<li><a href="/gostd/image/png/paeth.go.html">paeth.go</a></li>
<li><a href="/gostd/image/png/paeth_test.go.html">paeth_test.go</a></li>
<li><a href="/gostd/image/png/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/png/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/image/png/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/png/writer_test.go.html" class="current">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7021809">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7021864">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7021918">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7021969">package</span>&nbsp;<span class="ident" id="7021977">png</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7021982">import</span>&nbsp;<span class="op" id="7021989">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7021992">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7022001">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7022008">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7022017">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7022032">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7022045">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7022055">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="7022058">func</span>&nbsp;<span class="ident" id="7022063">diff</span><span class="op" id="7022067">(</span><span class="ident" id="7022068">m0</span><span class="op" id="7022070">,</span>&nbsp;<span class="ident" id="7022072">m1</span>&nbsp;<span class="ident" id="7022075">image</span><span class="op" id="7022080">.</span><span class="ident" id="7022081">Image</span><span class="op" id="7022086">)</span>&nbsp;<span class="builtintype" id="7022088">error</span>&nbsp;<span class="op" id="7022094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022097">b0</span><span class="op" id="7022099">,</span>&nbsp;<span class="ident" id="7022101">b1</span>&nbsp;<span class="op" id="7022104">:=</span>&nbsp;<span class="ident" id="7022107">m0</span><span class="op" id="7022109">.</span><span class="ident" id="7022110">Bounds</span><span class="op" id="7022116">(</span><span class="op" id="7022117">)</span><span class="op" id="7022118">,</span>&nbsp;<span class="ident" id="7022120">m1</span><span class="op" id="7022122">.</span><span class="ident" id="7022123">Bounds</span><span class="op" id="7022129">(</span><span class="op" id="7022130">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022133">if</span>&nbsp;<span class="op" id="7022136">!</span><span class="ident" id="7022137">b0</span><span class="op" id="7022139">.</span><span class="ident" id="7022140">Size</span><span class="op" id="7022144">(</span><span class="op" id="7022145">)</span><span class="op" id="7022146">.</span><span class="ident" id="7022147">Eq</span><span class="op" id="7022149">(</span><span class="ident" id="7022150">b1</span><span class="op" id="7022152">.</span><span class="ident" id="7022153">Size</span><span class="op" id="7022157">(</span><span class="op" id="7022158">)</span><span class="op" id="7022159">)</span>&nbsp;<span class="op" id="7022161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022165">return</span>&nbsp;<span class="ident" id="7022172">fmt</span><span class="op" id="7022175">.</span><span class="ident" id="7022176">Errorf</span><span class="op" id="7022182">(</span><span class="string" id="7022183">&#34;dimensions&nbsp;differ:&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="7022212">,</span>&nbsp;<span class="ident" id="7022214">b0</span><span class="op" id="7022216">,</span>&nbsp;<span class="ident" id="7022218">b1</span><span class="op" id="7022220">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022226">dx</span>&nbsp;<span class="op" id="7022229">:=</span>&nbsp;<span class="ident" id="7022232">b1</span><span class="op" id="7022234">.</span><span class="ident" id="7022235">Min</span><span class="op" id="7022238">.</span><span class="ident" id="7022239">X</span>&nbsp;<span class="op" id="7022241">-</span>&nbsp;<span class="ident" id="7022243">b0</span><span class="op" id="7022245">.</span><span class="ident" id="7022246">Min</span><span class="op" id="7022249">.</span><span class="ident" id="7022250">X</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022253">dy</span>&nbsp;<span class="op" id="7022256">:=</span>&nbsp;<span class="ident" id="7022259">b1</span><span class="op" id="7022261">.</span><span class="ident" id="7022262">Min</span><span class="op" id="7022265">.</span><span class="ident" id="7022266">Y</span>&nbsp;<span class="op" id="7022268">-</span>&nbsp;<span class="ident" id="7022270">b0</span><span class="op" id="7022272">.</span><span class="ident" id="7022273">Min</span><span class="op" id="7022276">.</span><span class="ident" id="7022277">Y</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022280">for</span>&nbsp;<span class="ident" id="7022284">y</span>&nbsp;<span class="op" id="7022286">:=</span>&nbsp;<span class="ident" id="7022289">b0</span><span class="op" id="7022291">.</span><span class="ident" id="7022292">Min</span><span class="op" id="7022295">.</span><span class="ident" id="7022296">Y</span><span class="op" id="7022297">;</span>&nbsp;<span class="ident" id="7022299">y</span>&nbsp;<span class="op" id="7022301">&lt;</span>&nbsp;<span class="ident" id="7022303">b0</span><span class="op" id="7022305">.</span><span class="ident" id="7022306">Max</span><span class="op" id="7022309">.</span><span class="ident" id="7022310">Y</span><span class="op" id="7022311">;</span>&nbsp;<span class="ident" id="7022313">y</span><span class="op" id="7022314">++</span>&nbsp;<span class="op" id="7022317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022321">for</span>&nbsp;<span class="ident" id="7022325">x</span>&nbsp;<span class="op" id="7022327">:=</span>&nbsp;<span class="ident" id="7022330">b0</span><span class="op" id="7022332">.</span><span class="ident" id="7022333">Min</span><span class="op" id="7022336">.</span><span class="ident" id="7022337">X</span><span class="op" id="7022338">;</span>&nbsp;<span class="ident" id="7022340">x</span>&nbsp;<span class="op" id="7022342">&lt;</span>&nbsp;<span class="ident" id="7022344">b0</span><span class="op" id="7022346">.</span><span class="ident" id="7022347">Max</span><span class="op" id="7022350">.</span><span class="ident" id="7022351">X</span><span class="op" id="7022352">;</span>&nbsp;<span class="ident" id="7022354">x</span><span class="op" id="7022355">++</span>&nbsp;<span class="op" id="7022358">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022363">c0</span>&nbsp;<span class="op" id="7022366">:=</span>&nbsp;<span class="ident" id="7022369">m0</span><span class="op" id="7022371">.</span><span class="ident" id="7022372">At</span><span class="op" id="7022374">(</span><span class="ident" id="7022375">x</span><span class="op" id="7022376">,</span>&nbsp;<span class="ident" id="7022378">y</span><span class="op" id="7022379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022384">c1</span>&nbsp;<span class="op" id="7022387">:=</span>&nbsp;<span class="ident" id="7022390">m1</span><span class="op" id="7022392">.</span><span class="ident" id="7022393">At</span><span class="op" id="7022395">(</span><span class="ident" id="7022396">x</span><span class="op" id="7022397">+</span><span class="ident" id="7022398">dx</span><span class="op" id="7022400">,</span>&nbsp;<span class="ident" id="7022402">y</span><span class="op" id="7022403">+</span><span class="ident" id="7022404">dy</span><span class="op" id="7022406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022411">r0</span><span class="op" id="7022413">,</span>&nbsp;<span class="ident" id="7022415">g0</span><span class="op" id="7022417">,</span>&nbsp;<span class="ident" id="7022419">b0</span><span class="op" id="7022421">,</span>&nbsp;<span class="ident" id="7022423">a0</span>&nbsp;<span class="op" id="7022426">:=</span>&nbsp;<span class="ident" id="7022429">c0</span><span class="op" id="7022431">.</span><span class="ident" id="7022432">RGBA</span><span class="op" id="7022436">(</span><span class="op" id="7022437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022442">r1</span><span class="op" id="7022444">,</span>&nbsp;<span class="ident" id="7022446">g1</span><span class="op" id="7022448">,</span>&nbsp;<span class="ident" id="7022450">b1</span><span class="op" id="7022452">,</span>&nbsp;<span class="ident" id="7022454">a1</span>&nbsp;<span class="op" id="7022457">:=</span>&nbsp;<span class="ident" id="7022460">c1</span><span class="op" id="7022462">.</span><span class="ident" id="7022463">RGBA</span><span class="op" id="7022467">(</span><span class="op" id="7022468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022473">if</span>&nbsp;<span class="ident" id="7022476">r0</span>&nbsp;<span class="op" id="7022479">!=</span>&nbsp;<span class="ident" id="7022482">r1</span>&nbsp;<span class="op" id="7022485">||</span>&nbsp;<span class="ident" id="7022488">g0</span>&nbsp;<span class="op" id="7022491">!=</span>&nbsp;<span class="ident" id="7022494">g1</span>&nbsp;<span class="op" id="7022497">||</span>&nbsp;<span class="ident" id="7022500">b0</span>&nbsp;<span class="op" id="7022503">!=</span>&nbsp;<span class="ident" id="7022506">b1</span>&nbsp;<span class="op" id="7022509">||</span>&nbsp;<span class="ident" id="7022512">a0</span>&nbsp;<span class="op" id="7022515">!=</span>&nbsp;<span class="ident" id="7022518">a1</span>&nbsp;<span class="op" id="7022521">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022527">return</span>&nbsp;<span class="ident" id="7022534">fmt</span><span class="op" id="7022537">.</span><span class="ident" id="7022538">Errorf</span><span class="op" id="7022544">(</span><span class="string" id="7022545">&#34;colors&nbsp;differ&nbsp;at&nbsp;(%d,&nbsp;%d):&nbsp;%v&nbsp;vs&nbsp;%v&#34;</span><span class="op" id="7022582">,</span>&nbsp;<span class="ident" id="7022584">x</span><span class="op" id="7022585">,</span>&nbsp;<span class="ident" id="7022587">y</span><span class="op" id="7022588">,</span>&nbsp;<span class="ident" id="7022590">c0</span><span class="op" id="7022592">,</span>&nbsp;<span class="ident" id="7022594">c1</span><span class="op" id="7022596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022605">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022611">return</span>&nbsp;<span class="builtintype" id="7022618">nil</span><br>
<span class="lineno">35</span><span class="op" id="7022622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7022625">func</span>&nbsp;<span class="ident" id="7022630">encodeDecode</span><span class="op" id="7022642">(</span><span class="ident" id="7022643">m</span>&nbsp;<span class="ident" id="7022645">image</span><span class="op" id="7022650">.</span><span class="ident" id="7022651">Image</span><span class="op" id="7022656">)</span>&nbsp;<span class="op" id="7022658">(</span><span class="ident" id="7022659">image</span><span class="op" id="7022664">.</span><span class="ident" id="7022665">Image</span><span class="op" id="7022670">,</span>&nbsp;<span class="builtintype" id="7022672">error</span><span class="op" id="7022677">)</span>&nbsp;<span class="op" id="7022679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022682">var</span>&nbsp;<span class="ident" id="7022686">b</span>&nbsp;<span class="ident" id="7022688">bytes</span><span class="op" id="7022693">.</span><span class="ident" id="7022694">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022702">err</span>&nbsp;<span class="op" id="7022706">:=</span>&nbsp;<span class="ident" id="7022709">Encode</span><span class="op" id="7022715">(</span><span class="op" id="7022716">&amp;</span><span class="ident" id="7022717">b</span><span class="op" id="7022718">,</span>&nbsp;<span class="ident" id="7022720">m</span><span class="op" id="7022721">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022724">if</span>&nbsp;<span class="ident" id="7022727">err</span>&nbsp;<span class="op" id="7022731">!=</span>&nbsp;<span class="builtintype" id="7022734">nil</span>&nbsp;<span class="op" id="7022738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022742">return</span>&nbsp;<span class="builtintype" id="7022749">nil</span><span class="op" id="7022752">,</span>&nbsp;<span class="ident" id="7022754">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022762">return</span>&nbsp;<span class="ident" id="7022769">Decode</span><span class="op" id="7022775">(</span><span class="op" id="7022776">&amp;</span><span class="ident" id="7022777">b</span><span class="op" id="7022778">)</span><br>
<span class="lineno"></span><span class="op" id="7022780">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="7022783">func</span>&nbsp;<span class="ident" id="7022788">TestWriter</span><span class="op" id="7022798">(</span><span class="ident" id="7022799">t</span>&nbsp;<span class="op" id="7022801">*</span><span class="ident" id="7022802">testing</span><span class="op" id="7022809">.</span><span class="ident" id="7022810">T</span><span class="op" id="7022811">)</span>&nbsp;<span class="op" id="7022813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7022816">//&nbsp;The&nbsp;filenames&nbsp;variable&nbsp;is&nbsp;declared&nbsp;in&nbsp;reader_test.go.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022874">names</span>&nbsp;<span class="op" id="7022880">:=</span>&nbsp;<span class="ident" id="7022883">filenames</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022894">if</span>&nbsp;<span class="ident" id="7022897">testing</span><span class="op" id="7022904">.</span><span class="ident" id="7022905">Short</span><span class="op" id="7022910">(</span><span class="op" id="7022911">)</span>&nbsp;<span class="op" id="7022913">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022917">names</span>&nbsp;<span class="op" id="7022923">=</span>&nbsp;<span class="ident" id="7022925">filenamesShort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7022941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7022944">for</span>&nbsp;<span class="ident" id="7022948">_</span><span class="op" id="7022949">,</span>&nbsp;<span class="ident" id="7022951">fn</span>&nbsp;<span class="op" id="7022954">:=</span>&nbsp;<span class="keyword" id="7022957">range</span>&nbsp;<span class="ident" id="7022963">names</span>&nbsp;<span class="op" id="7022969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7022973">qfn</span>&nbsp;<span class="op" id="7022977">:=</span>&nbsp;<span class="string" id="7022980">&#34;testdata/pngsuite/&#34;</span>&nbsp;<span class="op" id="7023001">+</span>&nbsp;<span class="ident" id="7023003">fn</span>&nbsp;<span class="op" id="7023006">+</span>&nbsp;<span class="string" id="7023008">&#34;.png&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7023017">//&nbsp;Read&nbsp;the&nbsp;image.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023038">m0</span><span class="op" id="7023040">,</span>&nbsp;<span class="ident" id="7023042">err</span>&nbsp;<span class="op" id="7023046">:=</span>&nbsp;<span class="ident" id="7023049">readPNG</span><span class="op" id="7023056">(</span><span class="ident" id="7023057">qfn</span><span class="op" id="7023060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023064">if</span>&nbsp;<span class="ident" id="7023067">err</span>&nbsp;<span class="op" id="7023071">!=</span>&nbsp;<span class="builtintype" id="7023074">nil</span>&nbsp;<span class="op" id="7023078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023083">t</span><span class="op" id="7023084">.</span><span class="ident" id="7023085">Error</span><span class="op" id="7023090">(</span><span class="ident" id="7023091">fn</span><span class="op" id="7023093">,</span>&nbsp;<span class="ident" id="7023095">err</span><span class="op" id="7023098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023103">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023114">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7023118">//&nbsp;Read&nbsp;the&nbsp;image&nbsp;again,&nbsp;encode&nbsp;it,&nbsp;and&nbsp;decode&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023171">m1</span><span class="op" id="7023173">,</span>&nbsp;<span class="ident" id="7023175">err</span>&nbsp;<span class="op" id="7023179">:=</span>&nbsp;<span class="ident" id="7023182">readPNG</span><span class="op" id="7023189">(</span><span class="ident" id="7023190">qfn</span><span class="op" id="7023193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023197">if</span>&nbsp;<span class="ident" id="7023200">err</span>&nbsp;<span class="op" id="7023204">!=</span>&nbsp;<span class="builtintype" id="7023207">nil</span>&nbsp;<span class="op" id="7023211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023216">t</span><span class="op" id="7023217">.</span><span class="ident" id="7023218">Error</span><span class="op" id="7023223">(</span><span class="ident" id="7023224">fn</span><span class="op" id="7023226">,</span>&nbsp;<span class="ident" id="7023228">err</span><span class="op" id="7023231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023236">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023249">m2</span><span class="op" id="7023251">,</span>&nbsp;<span class="ident" id="7023253">err</span>&nbsp;<span class="op" id="7023257">:=</span>&nbsp;<span class="ident" id="7023260">encodeDecode</span><span class="op" id="7023272">(</span><span class="ident" id="7023273">m1</span><span class="op" id="7023275">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023279">if</span>&nbsp;<span class="ident" id="7023282">err</span>&nbsp;<span class="op" id="7023286">!=</span>&nbsp;<span class="builtintype" id="7023289">nil</span>&nbsp;<span class="op" id="7023293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023298">t</span><span class="op" id="7023299">.</span><span class="ident" id="7023300">Error</span><span class="op" id="7023305">(</span><span class="ident" id="7023306">fn</span><span class="op" id="7023308">,</span>&nbsp;<span class="ident" id="7023310">err</span><span class="op" id="7023313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023318">return</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7023331">//&nbsp;Compare&nbsp;the&nbsp;two.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023353">err</span>&nbsp;<span class="op" id="7023357">=</span>&nbsp;<span class="ident" id="7023359">diff</span><span class="op" id="7023363">(</span><span class="ident" id="7023364">m0</span><span class="op" id="7023366">,</span>&nbsp;<span class="ident" id="7023368">m2</span><span class="op" id="7023370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023374">if</span>&nbsp;<span class="ident" id="7023377">err</span>&nbsp;<span class="op" id="7023381">!=</span>&nbsp;<span class="builtintype" id="7023384">nil</span>&nbsp;<span class="op" id="7023388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023393">t</span><span class="op" id="7023394">.</span><span class="ident" id="7023395">Error</span><span class="op" id="7023400">(</span><span class="ident" id="7023401">fn</span><span class="op" id="7023403">,</span>&nbsp;<span class="ident" id="7023405">err</span><span class="op" id="7023408">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023413">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023424">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023427">}</span><br>
<span class="lineno"></span><span class="op" id="7023429">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="keyword" id="7023432">func</span>&nbsp;<span class="ident" id="7023437">TestWriterLevels</span><span class="op" id="7023453">(</span><span class="ident" id="7023454">t</span>&nbsp;<span class="op" id="7023456">*</span><span class="ident" id="7023457">testing</span><span class="op" id="7023464">.</span><span class="ident" id="7023465">T</span><span class="op" id="7023466">)</span>&nbsp;<span class="op" id="7023468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023471">m</span>&nbsp;<span class="op" id="7023473">:=</span>&nbsp;<span class="ident" id="7023476">image</span><span class="op" id="7023481">.</span><span class="ident" id="7023482">NewNRGBA</span><span class="op" id="7023490">(</span><span class="ident" id="7023491">image</span><span class="op" id="7023496">.</span><span class="ident" id="7023497">Rect</span><span class="op" id="7023501">(</span><span class="num" id="7023502">0</span><span class="op" id="7023503">,</span>&nbsp;<span class="num" id="7023505">0</span><span class="op" id="7023506">,</span>&nbsp;<span class="num" id="7023508">100</span><span class="op" id="7023511">,</span>&nbsp;<span class="num" id="7023513">100</span><span class="op" id="7023516">)</span><span class="op" id="7023517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023521">var</span>&nbsp;<span class="ident" id="7023525">b1</span><span class="op" id="7023527">,</span>&nbsp;<span class="ident" id="7023529">b2</span>&nbsp;<span class="ident" id="7023532">bytes</span><span class="op" id="7023537">.</span><span class="ident" id="7023538">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023546">if</span>&nbsp;<span class="ident" id="7023549">err</span>&nbsp;<span class="op" id="7023553">:=</span>&nbsp;<span class="op" id="7023556">(</span><span class="op" id="7023557">&amp;</span><span class="ident" id="7023558">Encoder</span><span class="op" id="7023565">{</span><span class="op" id="7023566">}</span><span class="op" id="7023567">)</span><span class="op" id="7023568">.</span><span class="ident" id="7023569">Encode</span><span class="op" id="7023575">(</span><span class="op" id="7023576">&amp;</span><span class="ident" id="7023577">b1</span><span class="op" id="7023579">,</span>&nbsp;<span class="ident" id="7023581">m</span><span class="op" id="7023582">)</span><span class="op" id="7023583">;</span>&nbsp;<span class="ident" id="7023585">err</span>&nbsp;<span class="op" id="7023589">!=</span>&nbsp;<span class="builtintype" id="7023592">nil</span>&nbsp;<span class="op" id="7023596">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023600">t</span><span class="op" id="7023601">.</span><span class="ident" id="7023602">Fatal</span><span class="op" id="7023607">(</span><span class="ident" id="7023608">err</span><span class="op" id="7023611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023617">noenc</span>&nbsp;<span class="op" id="7023623">:=</span>&nbsp;<span class="op" id="7023626">&amp;</span><span class="ident" id="7023627">Encoder</span><span class="op" id="7023634">{</span><span class="ident" id="7023635">CompressionLevel</span><span class="op" id="7023651">:</span>&nbsp;<span class="ident" id="7023653">NoCompression</span><span class="op" id="7023666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023669">if</span>&nbsp;<span class="ident" id="7023672">err</span>&nbsp;<span class="op" id="7023676">:=</span>&nbsp;<span class="ident" id="7023679">noenc</span><span class="op" id="7023684">.</span><span class="ident" id="7023685">Encode</span><span class="op" id="7023691">(</span><span class="op" id="7023692">&amp;</span><span class="ident" id="7023693">b2</span><span class="op" id="7023695">,</span>&nbsp;<span class="ident" id="7023697">m</span><span class="op" id="7023698">)</span><span class="op" id="7023699">;</span>&nbsp;<span class="ident" id="7023701">err</span>&nbsp;<span class="op" id="7023705">!=</span>&nbsp;<span class="builtintype" id="7023708">nil</span>&nbsp;<span class="op" id="7023712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023716">t</span><span class="op" id="7023717">.</span><span class="ident" id="7023718">Fatal</span><span class="op" id="7023723">(</span><span class="ident" id="7023724">err</span><span class="op" id="7023727">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023730">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023734">if</span>&nbsp;<span class="ident" id="7023737">b2</span><span class="op" id="7023739">.</span><span class="ident" id="7023740">Len</span><span class="op" id="7023743">(</span><span class="op" id="7023744">)</span>&nbsp;<span class="op" id="7023746">&lt;=</span>&nbsp;<span class="ident" id="7023749">b1</span><span class="op" id="7023751">.</span><span class="ident" id="7023752">Len</span><span class="op" id="7023755">(</span><span class="op" id="7023756">)</span>&nbsp;<span class="op" id="7023758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023762">t</span><span class="op" id="7023763">.</span><span class="ident" id="7023764">Error</span><span class="op" id="7023769">(</span><span class="string" id="7023770">&#34;DefaultCompression&nbsp;encoding&nbsp;was&nbsp;larger&nbsp;than&nbsp;NoCompression&nbsp;encoding&#34;</span><span class="op" id="7023838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023841">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023844">if</span>&nbsp;<span class="ident" id="7023847">_</span><span class="op" id="7023848">,</span>&nbsp;<span class="ident" id="7023850">err</span>&nbsp;<span class="op" id="7023854">:=</span>&nbsp;<span class="ident" id="7023857">Decode</span><span class="op" id="7023863">(</span><span class="op" id="7023864">&amp;</span><span class="ident" id="7023865">b1</span><span class="op" id="7023867">)</span><span class="op" id="7023868">;</span>&nbsp;<span class="ident" id="7023870">err</span>&nbsp;<span class="op" id="7023874">!=</span>&nbsp;<span class="builtintype" id="7023877">nil</span>&nbsp;<span class="op" id="7023881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023885">t</span><span class="op" id="7023886">.</span><span class="ident" id="7023887">Error</span><span class="op" id="7023892">(</span><span class="string" id="7023893">&#34;cannot&nbsp;decode&nbsp;DefaultCompression&#34;</span><span class="op" id="7023927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7023930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7023933">if</span>&nbsp;<span class="ident" id="7023936">_</span><span class="op" id="7023937">,</span>&nbsp;<span class="ident" id="7023939">err</span>&nbsp;<span class="op" id="7023943">:=</span>&nbsp;<span class="ident" id="7023946">Decode</span><span class="op" id="7023952">(</span><span class="op" id="7023953">&amp;</span><span class="ident" id="7023954">b2</span><span class="op" id="7023956">)</span><span class="op" id="7023957">;</span>&nbsp;<span class="ident" id="7023959">err</span>&nbsp;<span class="op" id="7023963">!=</span>&nbsp;<span class="builtintype" id="7023966">nil</span>&nbsp;<span class="op" id="7023970">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7023974">t</span><span class="op" id="7023975">.</span><span class="ident" id="7023976">Error</span><span class="op" id="7023981">(</span><span class="string" id="7023982">&#34;cannot&nbsp;decode&nbsp;NoCompression&#34;</span><span class="op" id="7024011">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024014">}</span><br>
<span class="lineno"></span><span class="op" id="7024016">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024019">func</span>&nbsp;<span class="ident" id="7024024">TestSubImage</span><span class="op" id="7024036">(</span><span class="ident" id="7024037">t</span>&nbsp;<span class="op" id="7024039">*</span><span class="ident" id="7024040">testing</span><span class="op" id="7024047">.</span><span class="ident" id="7024048">T</span><span class="op" id="7024049">)</span>&nbsp;<span class="op" id="7024051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024054">m0</span>&nbsp;<span class="op" id="7024057">:=</span>&nbsp;<span class="ident" id="7024060">image</span><span class="op" id="7024065">.</span><span class="ident" id="7024066">NewRGBA</span><span class="op" id="7024073">(</span><span class="ident" id="7024074">image</span><span class="op" id="7024079">.</span><span class="ident" id="7024080">Rect</span><span class="op" id="7024084">(</span><span class="num" id="7024085">0</span><span class="op" id="7024086">,</span>&nbsp;<span class="num" id="7024088">0</span><span class="op" id="7024089">,</span>&nbsp;<span class="num" id="7024091">256</span><span class="op" id="7024094">,</span>&nbsp;<span class="num" id="7024096">256</span><span class="op" id="7024099">)</span><span class="op" id="7024100">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024103">for</span>&nbsp;<span class="ident" id="7024107">y</span>&nbsp;<span class="op" id="7024109">:=</span>&nbsp;<span class="num" id="7024112">0</span><span class="op" id="7024113">;</span>&nbsp;<span class="ident" id="7024115">y</span>&nbsp;<span class="op" id="7024117">&lt;</span>&nbsp;<span class="num" id="7024119">256</span><span class="op" id="7024122">;</span>&nbsp;<span class="ident" id="7024124">y</span><span class="op" id="7024125">++</span>&nbsp;<span class="op" id="7024128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024132">for</span>&nbsp;<span class="ident" id="7024136">x</span>&nbsp;<span class="op" id="7024138">:=</span>&nbsp;<span class="num" id="7024141">0</span><span class="op" id="7024142">;</span>&nbsp;<span class="ident" id="7024144">x</span>&nbsp;<span class="op" id="7024146">&lt;</span>&nbsp;<span class="num" id="7024148">256</span><span class="op" id="7024151">;</span>&nbsp;<span class="ident" id="7024153">x</span><span class="op" id="7024154">++</span>&nbsp;<span class="op" id="7024157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024162">m0</span><span class="op" id="7024164">.</span><span class="ident" id="7024165">Set</span><span class="op" id="7024168">(</span><span class="ident" id="7024169">x</span><span class="op" id="7024170">,</span>&nbsp;<span class="ident" id="7024172">y</span><span class="op" id="7024173">,</span>&nbsp;<span class="ident" id="7024175">color</span><span class="op" id="7024180">.</span><span class="ident" id="7024181">RGBA</span><span class="op" id="7024185">{</span><span class="builtintype" id="7024186">uint8</span><span class="op" id="7024191">(</span><span class="ident" id="7024192">x</span><span class="op" id="7024193">)</span><span class="op" id="7024194">,</span>&nbsp;<span class="builtintype" id="7024196">uint8</span><span class="op" id="7024201">(</span><span class="ident" id="7024202">y</span><span class="op" id="7024203">)</span><span class="op" id="7024204">,</span>&nbsp;<span class="num" id="7024206">0</span><span class="op" id="7024207">,</span>&nbsp;<span class="num" id="7024209">255</span><span class="op" id="7024212">}</span><span class="op" id="7024213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024220">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024223">m0</span>&nbsp;<span class="op" id="7024226">=</span>&nbsp;<span class="ident" id="7024228">m0</span><span class="op" id="7024230">.</span><span class="ident" id="7024231">SubImage</span><span class="op" id="7024239">(</span><span class="ident" id="7024240">image</span><span class="op" id="7024245">.</span><span class="ident" id="7024246">Rect</span><span class="op" id="7024250">(</span><span class="num" id="7024251">50</span><span class="op" id="7024253">,</span>&nbsp;<span class="num" id="7024255">30</span><span class="op" id="7024257">,</span>&nbsp;<span class="num" id="7024259">250</span><span class="op" id="7024262">,</span>&nbsp;<span class="num" id="7024264">130</span><span class="op" id="7024267">)</span><span class="op" id="7024268">)</span><span class="op" id="7024269">.</span><span class="op" id="7024270">(</span><span class="op" id="7024271">*</span><span class="ident" id="7024272">image</span><span class="op" id="7024277">.</span><span class="ident" id="7024278">RGBA</span><span class="op" id="7024282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024285">m1</span><span class="op" id="7024287">,</span>&nbsp;<span class="ident" id="7024289">err</span>&nbsp;<span class="op" id="7024293">:=</span>&nbsp;<span class="ident" id="7024296">encodeDecode</span><span class="op" id="7024308">(</span><span class="ident" id="7024309">m0</span><span class="op" id="7024311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024314">if</span>&nbsp;<span class="ident" id="7024317">err</span>&nbsp;<span class="op" id="7024321">!=</span>&nbsp;<span class="builtintype" id="7024324">nil</span>&nbsp;<span class="op" id="7024328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024332">t</span><span class="op" id="7024333">.</span><span class="ident" id="7024334">Error</span><span class="op" id="7024339">(</span><span class="ident" id="7024340">err</span><span class="op" id="7024343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024347">return</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024355">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024358">err</span>&nbsp;<span class="op" id="7024362">=</span>&nbsp;<span class="ident" id="7024364">diff</span><span class="op" id="7024368">(</span><span class="ident" id="7024369">m0</span><span class="op" id="7024371">,</span>&nbsp;<span class="ident" id="7024373">m1</span><span class="op" id="7024375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024378">if</span>&nbsp;<span class="ident" id="7024381">err</span>&nbsp;<span class="op" id="7024385">!=</span>&nbsp;<span class="builtintype" id="7024388">nil</span>&nbsp;<span class="op" id="7024392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024396">t</span><span class="op" id="7024397">.</span><span class="ident" id="7024398">Error</span><span class="op" id="7024403">(</span><span class="ident" id="7024404">err</span><span class="op" id="7024407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024411">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024419">}</span><br>
<span class="lineno"></span><span class="op" id="7024421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024424">func</span>&nbsp;<span class="ident" id="7024429">BenchmarkEncodeGray</span><span class="op" id="7024448">(</span><span class="ident" id="7024449">b</span>&nbsp;<span class="op" id="7024451">*</span><span class="ident" id="7024452">testing</span><span class="op" id="7024459">.</span><span class="ident" id="7024460">B</span><span class="op" id="7024461">)</span>&nbsp;<span class="op" id="7024463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024466">b</span><span class="op" id="7024467">.</span><span class="ident" id="7024468">StopTimer</span><span class="op" id="7024477">(</span><span class="op" id="7024478">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024481">img</span>&nbsp;<span class="op" id="7024485">:=</span>&nbsp;<span class="ident" id="7024488">image</span><span class="op" id="7024493">.</span><span class="ident" id="7024494">NewGray</span><span class="op" id="7024501">(</span><span class="ident" id="7024502">image</span><span class="op" id="7024507">.</span><span class="ident" id="7024508">Rect</span><span class="op" id="7024512">(</span><span class="num" id="7024513">0</span><span class="op" id="7024514">,</span>&nbsp;<span class="num" id="7024516">0</span><span class="op" id="7024517">,</span>&nbsp;<span class="num" id="7024519">640</span><span class="op" id="7024522">,</span>&nbsp;<span class="num" id="7024524">480</span><span class="op" id="7024527">)</span><span class="op" id="7024528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024531">b</span><span class="op" id="7024532">.</span><span class="ident" id="7024533">SetBytes</span><span class="op" id="7024541">(</span><span class="num" id="7024542">640</span>&nbsp;<span class="op" id="7024546">*</span>&nbsp;<span class="num" id="7024548">480</span>&nbsp;<span class="op" id="7024552">*</span>&nbsp;<span class="num" id="7024554">1</span><span class="op" id="7024555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024558">b</span><span class="op" id="7024559">.</span><span class="ident" id="7024560">StartTimer</span><span class="op" id="7024570">(</span><span class="op" id="7024571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024574">for</span>&nbsp;<span class="ident" id="7024578">i</span>&nbsp;<span class="op" id="7024580">:=</span>&nbsp;<span class="num" id="7024583">0</span><span class="op" id="7024584">;</span>&nbsp;<span class="ident" id="7024586">i</span>&nbsp;<span class="op" id="7024588">&lt;</span>&nbsp;<span class="ident" id="7024590">b</span><span class="op" id="7024591">.</span><span class="ident" id="7024592">N</span><span class="op" id="7024593">;</span>&nbsp;<span class="ident" id="7024595">i</span><span class="op" id="7024596">++</span>&nbsp;<span class="op" id="7024599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024603">Encode</span><span class="op" id="7024609">(</span><span class="ident" id="7024610">ioutil</span><span class="op" id="7024616">.</span><span class="ident" id="7024617">Discard</span><span class="op" id="7024624">,</span>&nbsp;<span class="ident" id="7024626">img</span><span class="op" id="7024629">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024632">}</span><br>
<span class="lineno"></span><span class="op" id="7024634">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7024637">func</span>&nbsp;<span class="ident" id="7024642">BenchmarkEncodeNRGBOpaque</span><span class="op" id="7024667">(</span><span class="ident" id="7024668">b</span>&nbsp;<span class="op" id="7024670">*</span><span class="ident" id="7024671">testing</span><span class="op" id="7024678">.</span><span class="ident" id="7024679">B</span><span class="op" id="7024680">)</span>&nbsp;<span class="op" id="7024682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024685">b</span><span class="op" id="7024686">.</span><span class="ident" id="7024687">StopTimer</span><span class="op" id="7024696">(</span><span class="op" id="7024697">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024700">img</span>&nbsp;<span class="op" id="7024704">:=</span>&nbsp;<span class="ident" id="7024707">image</span><span class="op" id="7024712">.</span><span class="ident" id="7024713">NewNRGBA</span><span class="op" id="7024721">(</span><span class="ident" id="7024722">image</span><span class="op" id="7024727">.</span><span class="ident" id="7024728">Rect</span><span class="op" id="7024732">(</span><span class="num" id="7024733">0</span><span class="op" id="7024734">,</span>&nbsp;<span class="num" id="7024736">0</span><span class="op" id="7024737">,</span>&nbsp;<span class="num" id="7024739">640</span><span class="op" id="7024742">,</span>&nbsp;<span class="num" id="7024744">480</span><span class="op" id="7024747">)</span><span class="op" id="7024748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7024751">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024806">bo</span>&nbsp;<span class="op" id="7024809">:=</span>&nbsp;<span class="ident" id="7024812">img</span><span class="op" id="7024815">.</span><span class="ident" id="7024816">Bounds</span><span class="op" id="7024822">(</span><span class="op" id="7024823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024826">for</span>&nbsp;<span class="ident" id="7024830">y</span>&nbsp;<span class="op" id="7024832">:=</span>&nbsp;<span class="ident" id="7024835">bo</span><span class="op" id="7024837">.</span><span class="ident" id="7024838">Min</span><span class="op" id="7024841">.</span><span class="ident" id="7024842">Y</span><span class="op" id="7024843">;</span>&nbsp;<span class="ident" id="7024845">y</span>&nbsp;<span class="op" id="7024847">&lt;</span>&nbsp;<span class="ident" id="7024849">bo</span><span class="op" id="7024851">.</span><span class="ident" id="7024852">Max</span><span class="op" id="7024855">.</span><span class="ident" id="7024856">Y</span><span class="op" id="7024857">;</span>&nbsp;<span class="ident" id="7024859">y</span><span class="op" id="7024860">++</span>&nbsp;<span class="op" id="7024863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024867">for</span>&nbsp;<span class="ident" id="7024871">x</span>&nbsp;<span class="op" id="7024873">:=</span>&nbsp;<span class="ident" id="7024876">bo</span><span class="op" id="7024878">.</span><span class="ident" id="7024879">Min</span><span class="op" id="7024882">.</span><span class="ident" id="7024883">X</span><span class="op" id="7024884">;</span>&nbsp;<span class="ident" id="7024886">x</span>&nbsp;<span class="op" id="7024888">&lt;</span>&nbsp;<span class="ident" id="7024890">bo</span><span class="op" id="7024892">.</span><span class="ident" id="7024893">Max</span><span class="op" id="7024896">.</span><span class="ident" id="7024897">X</span><span class="op" id="7024898">;</span>&nbsp;<span class="ident" id="7024900">x</span><span class="op" id="7024901">++</span>&nbsp;<span class="op" id="7024904">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024909">img</span><span class="op" id="7024912">.</span><span class="ident" id="7024913">Set</span><span class="op" id="7024916">(</span><span class="ident" id="7024917">x</span><span class="op" id="7024918">,</span>&nbsp;<span class="ident" id="7024920">y</span><span class="op" id="7024921">,</span>&nbsp;<span class="ident" id="7024923">color</span><span class="op" id="7024928">.</span><span class="ident" id="7024929">NRGBA</span><span class="op" id="7024934">{</span><span class="num" id="7024935">0</span><span class="op" id="7024936">,</span>&nbsp;<span class="num" id="7024938">0</span><span class="op" id="7024939">,</span>&nbsp;<span class="num" id="7024941">0</span><span class="op" id="7024942">,</span>&nbsp;<span class="num" id="7024944">255</span><span class="op" id="7024947">}</span><span class="op" id="7024948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024952">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7024955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7024958">if</span>&nbsp;<span class="op" id="7024961">!</span><span class="ident" id="7024962">img</span><span class="op" id="7024965">.</span><span class="ident" id="7024966">Opaque</span><span class="op" id="7024972">(</span><span class="op" id="7024973">)</span>&nbsp;<span class="op" id="7024975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7024979">b</span><span class="op" id="7024980">.</span><span class="ident" id="7024981">Fatal</span><span class="op" id="7024986">(</span><span class="string" id="7024987">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7025016">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025019">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025022">b</span><span class="op" id="7025023">.</span><span class="ident" id="7025024">SetBytes</span><span class="op" id="7025032">(</span><span class="num" id="7025033">640</span>&nbsp;<span class="op" id="7025037">*</span>&nbsp;<span class="num" id="7025039">480</span>&nbsp;<span class="op" id="7025043">*</span>&nbsp;<span class="num" id="7025045">4</span><span class="op" id="7025046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025049">b</span><span class="op" id="7025050">.</span><span class="ident" id="7025051">StartTimer</span><span class="op" id="7025061">(</span><span class="op" id="7025062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025065">for</span>&nbsp;<span class="ident" id="7025069">i</span>&nbsp;<span class="op" id="7025071">:=</span>&nbsp;<span class="num" id="7025074">0</span><span class="op" id="7025075">;</span>&nbsp;<span class="ident" id="7025077">i</span>&nbsp;<span class="op" id="7025079">&lt;</span>&nbsp;<span class="ident" id="7025081">b</span><span class="op" id="7025082">.</span><span class="ident" id="7025083">N</span><span class="op" id="7025084">;</span>&nbsp;<span class="ident" id="7025086">i</span><span class="op" id="7025087">++</span>&nbsp;<span class="op" id="7025090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025094">Encode</span><span class="op" id="7025100">(</span><span class="ident" id="7025101">ioutil</span><span class="op" id="7025107">.</span><span class="ident" id="7025108">Discard</span><span class="op" id="7025115">,</span>&nbsp;<span class="ident" id="7025117">img</span><span class="op" id="7025120">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025123">}</span><br>
<span class="lineno"></span><span class="op" id="7025125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7025128">func</span>&nbsp;<span class="ident" id="7025133">BenchmarkEncodeNRGBA</span><span class="op" id="7025153">(</span><span class="ident" id="7025154">b</span>&nbsp;<span class="op" id="7025156">*</span><span class="ident" id="7025157">testing</span><span class="op" id="7025164">.</span><span class="ident" id="7025165">B</span><span class="op" id="7025166">)</span>&nbsp;<span class="op" id="7025168">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025171">b</span><span class="op" id="7025172">.</span><span class="ident" id="7025173">StopTimer</span><span class="op" id="7025182">(</span><span class="op" id="7025183">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025186">img</span>&nbsp;<span class="op" id="7025190">:=</span>&nbsp;<span class="ident" id="7025193">image</span><span class="op" id="7025198">.</span><span class="ident" id="7025199">NewNRGBA</span><span class="op" id="7025207">(</span><span class="ident" id="7025208">image</span><span class="op" id="7025213">.</span><span class="ident" id="7025214">Rect</span><span class="op" id="7025218">(</span><span class="num" id="7025219">0</span><span class="op" id="7025220">,</span>&nbsp;<span class="num" id="7025222">0</span><span class="op" id="7025223">,</span>&nbsp;<span class="num" id="7025225">640</span><span class="op" id="7025228">,</span>&nbsp;<span class="num" id="7025230">480</span><span class="op" id="7025233">)</span><span class="op" id="7025234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025237">if</span>&nbsp;<span class="ident" id="7025240">img</span><span class="op" id="7025243">.</span><span class="ident" id="7025244">Opaque</span><span class="op" id="7025250">(</span><span class="op" id="7025251">)</span>&nbsp;<span class="op" id="7025253">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025257">b</span><span class="op" id="7025258">.</span><span class="ident" id="7025259">Fatal</span><span class="op" id="7025264">(</span><span class="string" id="7025265">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7025298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025304">b</span><span class="op" id="7025305">.</span><span class="ident" id="7025306">SetBytes</span><span class="op" id="7025314">(</span><span class="num" id="7025315">640</span>&nbsp;<span class="op" id="7025319">*</span>&nbsp;<span class="num" id="7025321">480</span>&nbsp;<span class="op" id="7025325">*</span>&nbsp;<span class="num" id="7025327">4</span><span class="op" id="7025328">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025331">b</span><span class="op" id="7025332">.</span><span class="ident" id="7025333">StartTimer</span><span class="op" id="7025343">(</span><span class="op" id="7025344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025347">for</span>&nbsp;<span class="ident" id="7025351">i</span>&nbsp;<span class="op" id="7025353">:=</span>&nbsp;<span class="num" id="7025356">0</span><span class="op" id="7025357">;</span>&nbsp;<span class="ident" id="7025359">i</span>&nbsp;<span class="op" id="7025361">&lt;</span>&nbsp;<span class="ident" id="7025363">b</span><span class="op" id="7025364">.</span><span class="ident" id="7025365">N</span><span class="op" id="7025366">;</span>&nbsp;<span class="ident" id="7025368">i</span><span class="op" id="7025369">++</span>&nbsp;<span class="op" id="7025372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025376">Encode</span><span class="op" id="7025382">(</span><span class="ident" id="7025383">ioutil</span><span class="op" id="7025389">.</span><span class="ident" id="7025390">Discard</span><span class="op" id="7025397">,</span>&nbsp;<span class="ident" id="7025399">img</span><span class="op" id="7025402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025405">}</span><br>
<span class="lineno"></span><span class="op" id="7025407">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="7025410">func</span>&nbsp;<span class="ident" id="7025415">BenchmarkEncodePaletted</span><span class="op" id="7025438">(</span><span class="ident" id="7025439">b</span>&nbsp;<span class="op" id="7025441">*</span><span class="ident" id="7025442">testing</span><span class="op" id="7025449">.</span><span class="ident" id="7025450">B</span><span class="op" id="7025451">)</span>&nbsp;<span class="op" id="7025453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025456">b</span><span class="op" id="7025457">.</span><span class="ident" id="7025458">StopTimer</span><span class="op" id="7025467">(</span><span class="op" id="7025468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025471">img</span>&nbsp;<span class="op" id="7025475">:=</span>&nbsp;<span class="ident" id="7025478">image</span><span class="op" id="7025483">.</span><span class="ident" id="7025484">NewPaletted</span><span class="op" id="7025495">(</span><span class="ident" id="7025496">image</span><span class="op" id="7025501">.</span><span class="ident" id="7025502">Rect</span><span class="op" id="7025506">(</span><span class="num" id="7025507">0</span><span class="op" id="7025508">,</span>&nbsp;<span class="num" id="7025510">0</span><span class="op" id="7025511">,</span>&nbsp;<span class="num" id="7025513">640</span><span class="op" id="7025516">,</span>&nbsp;<span class="num" id="7025518">480</span><span class="op" id="7025521">)</span><span class="op" id="7025522">,</span>&nbsp;<span class="ident" id="7025524">color</span><span class="op" id="7025529">.</span><span class="ident" id="7025530">Palette</span><span class="op" id="7025537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025541">color</span><span class="op" id="7025546">.</span><span class="ident" id="7025547">RGBA</span><span class="op" id="7025551">{</span><span class="num" id="7025552">0</span><span class="op" id="7025553">,</span>&nbsp;<span class="num" id="7025555">0</span><span class="op" id="7025556">,</span>&nbsp;<span class="num" id="7025558">0</span><span class="op" id="7025559">,</span>&nbsp;<span class="num" id="7025561">255</span><span class="op" id="7025564">}</span><span class="op" id="7025565">,</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025569">color</span><span class="op" id="7025574">.</span><span class="ident" id="7025575">RGBA</span><span class="op" id="7025579">{</span><span class="num" id="7025580">255</span><span class="op" id="7025583">,</span>&nbsp;<span class="num" id="7025585">255</span><span class="op" id="7025588">,</span>&nbsp;<span class="num" id="7025590">255</span><span class="op" id="7025593">,</span>&nbsp;<span class="num" id="7025595">255</span><span class="op" id="7025598">}</span><span class="op" id="7025599">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025602">}</span><span class="op" id="7025603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025606">b</span><span class="op" id="7025607">.</span><span class="ident" id="7025608">SetBytes</span><span class="op" id="7025616">(</span><span class="num" id="7025617">640</span>&nbsp;<span class="op" id="7025621">*</span>&nbsp;<span class="num" id="7025623">480</span>&nbsp;<span class="op" id="7025627">*</span>&nbsp;<span class="num" id="7025629">1</span><span class="op" id="7025630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025633">b</span><span class="op" id="7025634">.</span><span class="ident" id="7025635">StartTimer</span><span class="op" id="7025645">(</span><span class="op" id="7025646">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025649">for</span>&nbsp;<span class="ident" id="7025653">i</span>&nbsp;<span class="op" id="7025655">:=</span>&nbsp;<span class="num" id="7025658">0</span><span class="op" id="7025659">;</span>&nbsp;<span class="ident" id="7025661">i</span>&nbsp;<span class="op" id="7025663">&lt;</span>&nbsp;<span class="ident" id="7025665">b</span><span class="op" id="7025666">.</span><span class="ident" id="7025667">N</span><span class="op" id="7025668">;</span>&nbsp;<span class="ident" id="7025670">i</span><span class="op" id="7025671">++</span>&nbsp;<span class="op" id="7025674">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025678">Encode</span><span class="op" id="7025684">(</span><span class="ident" id="7025685">ioutil</span><span class="op" id="7025691">.</span><span class="ident" id="7025692">Discard</span><span class="op" id="7025699">,</span>&nbsp;<span class="ident" id="7025701">img</span><span class="op" id="7025704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7025707">}</span><br>
<span class="lineno"></span><span class="op" id="7025709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7025712">func</span>&nbsp;<span class="ident" id="7025717">BenchmarkEncodeRGBOpaque</span><span class="op" id="7025741">(</span><span class="ident" id="7025742">b</span>&nbsp;<span class="op" id="7025744">*</span><span class="ident" id="7025745">testing</span><span class="op" id="7025752">.</span><span class="ident" id="7025753">B</span><span class="op" id="7025754">)</span>&nbsp;<span class="op" id="7025756">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025759">b</span><span class="op" id="7025760">.</span><span class="ident" id="7025761">StopTimer</span><span class="op" id="7025770">(</span><span class="op" id="7025771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025774">img</span>&nbsp;<span class="op" id="7025778">:=</span>&nbsp;<span class="ident" id="7025781">image</span><span class="op" id="7025786">.</span><span class="ident" id="7025787">NewRGBA</span><span class="op" id="7025794">(</span><span class="ident" id="7025795">image</span><span class="op" id="7025800">.</span><span class="ident" id="7025801">Rect</span><span class="op" id="7025805">(</span><span class="num" id="7025806">0</span><span class="op" id="7025807">,</span>&nbsp;<span class="num" id="7025809">0</span><span class="op" id="7025810">,</span>&nbsp;<span class="num" id="7025812">640</span><span class="op" id="7025815">,</span>&nbsp;<span class="num" id="7025817">480</span><span class="op" id="7025820">)</span><span class="op" id="7025821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7025824">//&nbsp;Set&nbsp;all&nbsp;pixels&nbsp;to&nbsp;0xFF&nbsp;alpha&nbsp;to&nbsp;force&nbsp;opaque&nbsp;mode.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025879">bo</span>&nbsp;<span class="op" id="7025882">:=</span>&nbsp;<span class="ident" id="7025885">img</span><span class="op" id="7025888">.</span><span class="ident" id="7025889">Bounds</span><span class="op" id="7025895">(</span><span class="op" id="7025896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025899">for</span>&nbsp;<span class="ident" id="7025903">y</span>&nbsp;<span class="op" id="7025905">:=</span>&nbsp;<span class="ident" id="7025908">bo</span><span class="op" id="7025910">.</span><span class="ident" id="7025911">Min</span><span class="op" id="7025914">.</span><span class="ident" id="7025915">Y</span><span class="op" id="7025916">;</span>&nbsp;<span class="ident" id="7025918">y</span>&nbsp;<span class="op" id="7025920">&lt;</span>&nbsp;<span class="ident" id="7025922">bo</span><span class="op" id="7025924">.</span><span class="ident" id="7025925">Max</span><span class="op" id="7025928">.</span><span class="ident" id="7025929">Y</span><span class="op" id="7025930">;</span>&nbsp;<span class="ident" id="7025932">y</span><span class="op" id="7025933">++</span>&nbsp;<span class="op" id="7025936">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7025940">for</span>&nbsp;<span class="ident" id="7025944">x</span>&nbsp;<span class="op" id="7025946">:=</span>&nbsp;<span class="ident" id="7025949">bo</span><span class="op" id="7025951">.</span><span class="ident" id="7025952">Min</span><span class="op" id="7025955">.</span><span class="ident" id="7025956">X</span><span class="op" id="7025957">;</span>&nbsp;<span class="ident" id="7025959">x</span>&nbsp;<span class="op" id="7025961">&lt;</span>&nbsp;<span class="ident" id="7025963">bo</span><span class="op" id="7025965">.</span><span class="ident" id="7025966">Max</span><span class="op" id="7025969">.</span><span class="ident" id="7025970">X</span><span class="op" id="7025971">;</span>&nbsp;<span class="ident" id="7025973">x</span><span class="op" id="7025974">++</span>&nbsp;<span class="op" id="7025977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7025982">img</span><span class="op" id="7025985">.</span><span class="ident" id="7025986">Set</span><span class="op" id="7025989">(</span><span class="ident" id="7025990">x</span><span class="op" id="7025991">,</span>&nbsp;<span class="ident" id="7025993">y</span><span class="op" id="7025994">,</span>&nbsp;<span class="ident" id="7025996">color</span><span class="op" id="7026001">.</span><span class="ident" id="7026002">RGBA</span><span class="op" id="7026006">{</span><span class="num" id="7026007">0</span><span class="op" id="7026008">,</span>&nbsp;<span class="num" id="7026010">0</span><span class="op" id="7026011">,</span>&nbsp;<span class="num" id="7026013">0</span><span class="op" id="7026014">,</span>&nbsp;<span class="num" id="7026016">255</span><span class="op" id="7026019">}</span><span class="op" id="7026020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026024">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026027">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026030">if</span>&nbsp;<span class="op" id="7026033">!</span><span class="ident" id="7026034">img</span><span class="op" id="7026037">.</span><span class="ident" id="7026038">Opaque</span><span class="op" id="7026044">(</span><span class="op" id="7026045">)</span>&nbsp;<span class="op" id="7026047">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026051">b</span><span class="op" id="7026052">.</span><span class="ident" id="7026053">Fatal</span><span class="op" id="7026058">(</span><span class="string" id="7026059">&#34;expected&nbsp;image&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7026088">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026091">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026094">b</span><span class="op" id="7026095">.</span><span class="ident" id="7026096">SetBytes</span><span class="op" id="7026104">(</span><span class="num" id="7026105">640</span>&nbsp;<span class="op" id="7026109">*</span>&nbsp;<span class="num" id="7026111">480</span>&nbsp;<span class="op" id="7026115">*</span>&nbsp;<span class="num" id="7026117">4</span><span class="op" id="7026118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026121">b</span><span class="op" id="7026122">.</span><span class="ident" id="7026123">StartTimer</span><span class="op" id="7026133">(</span><span class="op" id="7026134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026137">for</span>&nbsp;<span class="ident" id="7026141">i</span>&nbsp;<span class="op" id="7026143">:=</span>&nbsp;<span class="num" id="7026146">0</span><span class="op" id="7026147">;</span>&nbsp;<span class="ident" id="7026149">i</span>&nbsp;<span class="op" id="7026151">&lt;</span>&nbsp;<span class="ident" id="7026153">b</span><span class="op" id="7026154">.</span><span class="ident" id="7026155">N</span><span class="op" id="7026156">;</span>&nbsp;<span class="ident" id="7026158">i</span><span class="op" id="7026159">++</span>&nbsp;<span class="op" id="7026162">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026166">Encode</span><span class="op" id="7026172">(</span><span class="ident" id="7026173">ioutil</span><span class="op" id="7026179">.</span><span class="ident" id="7026180">Discard</span><span class="op" id="7026187">,</span>&nbsp;<span class="ident" id="7026189">img</span><span class="op" id="7026192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026195">}</span><br>
<span class="lineno"></span><span class="op" id="7026197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7026200">func</span>&nbsp;<span class="ident" id="7026205">BenchmarkEncodeRGBA</span><span class="op" id="7026224">(</span><span class="ident" id="7026225">b</span>&nbsp;<span class="op" id="7026227">*</span><span class="ident" id="7026228">testing</span><span class="op" id="7026235">.</span><span class="ident" id="7026236">B</span><span class="op" id="7026237">)</span>&nbsp;<span class="op" id="7026239">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026242">b</span><span class="op" id="7026243">.</span><span class="ident" id="7026244">StopTimer</span><span class="op" id="7026253">(</span><span class="op" id="7026254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026257">img</span>&nbsp;<span class="op" id="7026261">:=</span>&nbsp;<span class="ident" id="7026264">image</span><span class="op" id="7026269">.</span><span class="ident" id="7026270">NewRGBA</span><span class="op" id="7026277">(</span><span class="ident" id="7026278">image</span><span class="op" id="7026283">.</span><span class="ident" id="7026284">Rect</span><span class="op" id="7026288">(</span><span class="num" id="7026289">0</span><span class="op" id="7026290">,</span>&nbsp;<span class="num" id="7026292">0</span><span class="op" id="7026293">,</span>&nbsp;<span class="num" id="7026295">640</span><span class="op" id="7026298">,</span>&nbsp;<span class="num" id="7026300">480</span><span class="op" id="7026303">)</span><span class="op" id="7026304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026307">if</span>&nbsp;<span class="ident" id="7026310">img</span><span class="op" id="7026313">.</span><span class="ident" id="7026314">Opaque</span><span class="op" id="7026320">(</span><span class="op" id="7026321">)</span>&nbsp;<span class="op" id="7026323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026327">b</span><span class="op" id="7026328">.</span><span class="ident" id="7026329">Fatal</span><span class="op" id="7026334">(</span><span class="string" id="7026335">&#34;expected&nbsp;image&nbsp;not&nbsp;to&nbsp;be&nbsp;opaque&#34;</span><span class="op" id="7026368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026371">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026374">b</span><span class="op" id="7026375">.</span><span class="ident" id="7026376">SetBytes</span><span class="op" id="7026384">(</span><span class="num" id="7026385">640</span>&nbsp;<span class="op" id="7026389">*</span>&nbsp;<span class="num" id="7026391">480</span>&nbsp;<span class="op" id="7026395">*</span>&nbsp;<span class="num" id="7026397">4</span><span class="op" id="7026398">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026401">b</span><span class="op" id="7026402">.</span><span class="ident" id="7026403">StartTimer</span><span class="op" id="7026413">(</span><span class="op" id="7026414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7026417">for</span>&nbsp;<span class="ident" id="7026421">i</span>&nbsp;<span class="op" id="7026423">:=</span>&nbsp;<span class="num" id="7026426">0</span><span class="op" id="7026427">;</span>&nbsp;<span class="ident" id="7026429">i</span>&nbsp;<span class="op" id="7026431">&lt;</span>&nbsp;<span class="ident" id="7026433">b</span><span class="op" id="7026434">.</span><span class="ident" id="7026435">N</span><span class="op" id="7026436">;</span>&nbsp;<span class="ident" id="7026438">i</span><span class="op" id="7026439">++</span>&nbsp;<span class="op" id="7026442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7026446">Encode</span><span class="op" id="7026452">(</span><span class="ident" id="7026453">ioutil</span><span class="op" id="7026459">.</span><span class="ident" id="7026460">Discard</span><span class="op" id="7026467">,</span>&nbsp;<span class="ident" id="7026469">img</span><span class="op" id="7026472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7026475">}</span><br>
<span class="lineno">210</span><span class="op" id="7026477">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
