<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html" class="current">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6274251">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6274306">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6274360">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6274411">package</span>&nbsp;<span class="ident" id="6274419">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6274424">import</span>&nbsp;<span class="op" id="6274431">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274434">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274443">&#34;bytes&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274452">&#34;encoding&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274464">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274471">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274477">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274488">&#34;strconv&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6274499">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6274509">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6274512">const</span>&nbsp;<span class="op" id="6274518">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274521">//&nbsp;A&nbsp;generic&nbsp;XML&nbsp;header&nbsp;suitable&nbsp;for&nbsp;use&nbsp;with&nbsp;the&nbsp;output&nbsp;of&nbsp;Marshal.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274591">//&nbsp;This&nbsp;is&nbsp;not&nbsp;automatically&nbsp;added&nbsp;to&nbsp;any&nbsp;output&nbsp;of&nbsp;this&nbsp;package,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6274658">//&nbsp;it&nbsp;is&nbsp;provided&nbsp;as&nbsp;a&nbsp;convenience.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6274695">Header</span>&nbsp;<span class="op" id="6274702">=</span>&nbsp;<span class="string" id="6274704">`&lt;?xml&nbsp;version=&#34;1.0&#34;&nbsp;encoding=&#34;UTF-8&#34;?&gt;`</span>&nbsp;<span class="op" id="6274745">+</span>&nbsp;<span class="string" id="6274747">&#34;\n&#34;</span><br>
<span class="lineno"></span><span class="op" id="6274752">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="6274755">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="6274797">//</span><br>
<span class="lineno"></span><span class="comment" id="6274800">//&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;array&nbsp;or&nbsp;slice&nbsp;by&nbsp;marshalling&nbsp;each&nbsp;of&nbsp;the&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6274874">//&nbsp;Marshal&nbsp;handles&nbsp;a&nbsp;pointer&nbsp;by&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;points&nbsp;at&nbsp;or,&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6274952">//&nbsp;pointer&nbsp;is&nbsp;nil,&nbsp;by&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;an&nbsp;interface&nbsp;value&nbsp;by</span><br>
<span class="lineno">30</span><span class="comment" id="6275030">//&nbsp;marshalling&nbsp;the&nbsp;value&nbsp;it&nbsp;contains&nbsp;or,&nbsp;if&nbsp;the&nbsp;interface&nbsp;value&nbsp;is&nbsp;nil,&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6275105">//&nbsp;writing&nbsp;nothing.&nbsp;&nbsp;Marshal&nbsp;handles&nbsp;all&nbsp;other&nbsp;data&nbsp;by&nbsp;writing&nbsp;one&nbsp;or&nbsp;more&nbsp;XML</span><br>
<span class="lineno"></span><span class="comment" id="6275184">//&nbsp;elements&nbsp;containing&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="6275217">//</span><br>
<span class="lineno"></span><span class="comment" id="6275220">//&nbsp;The&nbsp;name&nbsp;for&nbsp;the&nbsp;XML&nbsp;elements&nbsp;is&nbsp;taken&nbsp;from,&nbsp;in&nbsp;order&nbsp;of&nbsp;preference:</span><br>
<span class="lineno">35</span><span class="comment" id="6275292">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;on&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;if&nbsp;the&nbsp;data&nbsp;is&nbsp;a&nbsp;struct</span><br>
<span class="lineno"></span><span class="comment" id="6275355">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;XMLName&nbsp;field&nbsp;of&nbsp;type&nbsp;xml.Name</span><br>
<span class="lineno"></span><span class="comment" id="6275412">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;tag&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6275473">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;struct&nbsp;field&nbsp;used&nbsp;to&nbsp;obtain&nbsp;the&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="6275535">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;marshalled&nbsp;type</span><br>
<span class="lineno">40</span><span class="comment" id="6275576">//</span><br>
<span class="lineno"></span><span class="comment" id="6275579">//&nbsp;The&nbsp;XML&nbsp;element&nbsp;for&nbsp;a&nbsp;struct&nbsp;contains&nbsp;marshalled&nbsp;elements&nbsp;for&nbsp;each&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6275656">//&nbsp;exported&nbsp;fields&nbsp;of&nbsp;the&nbsp;struct,&nbsp;with&nbsp;these&nbsp;exceptions:</span><br>
<span class="lineno"></span><span class="comment" id="6275713">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;the&nbsp;XMLName&nbsp;field,&nbsp;described&nbsp;above,&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno"></span><span class="comment" id="6275770">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;-&#34;&nbsp;is&nbsp;omitted.</span><br>
<span class="lineno">45</span><span class="comment" id="6275812">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;name,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6275876">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;given&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6275920">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,attr&#34;&nbsp;becomes&nbsp;an&nbsp;attribute&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6275984">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;field&nbsp;name&nbsp;in&nbsp;the&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6276024">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,chardata&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;character&nbsp;data,</span><br>
<span class="lineno">50</span><span class="comment" id="6276092">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;as&nbsp;an&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6276124">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,innerxml&#34;&nbsp;is&nbsp;written&nbsp;verbatim,&nbsp;not&nbsp;subject</span><br>
<span class="lineno"></span><span class="comment" id="6276195">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.</span><br>
<span class="lineno"></span><span class="comment" id="6276240">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;tag&nbsp;&#34;,comment&#34;&nbsp;is&nbsp;written&nbsp;as&nbsp;an&nbsp;XML&nbsp;comment,&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="6276311">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;subject&nbsp;to&nbsp;the&nbsp;usual&nbsp;marshalling&nbsp;procedure.&nbsp;It&nbsp;must&nbsp;not&nbsp;contain</span><br>
<span class="lineno">55</span><span class="comment" id="6276384">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;&#34;--&#34;&nbsp;string&nbsp;within&nbsp;it.</span><br>
<span class="lineno"></span><span class="comment" id="6276420">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;a&nbsp;field&nbsp;with&nbsp;a&nbsp;tag&nbsp;including&nbsp;the&nbsp;&#34;omitempty&#34;&nbsp;option&nbsp;is&nbsp;omitted</span><br>
<span class="lineno"></span><span class="comment" id="6276492">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;the&nbsp;field&nbsp;value&nbsp;is&nbsp;empty.&nbsp;The&nbsp;empty&nbsp;values&nbsp;are&nbsp;false,&nbsp;0,&nbsp;any</span><br>
<span class="lineno"></span><span class="comment" id="6276565">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil&nbsp;pointer&nbsp;or&nbsp;interface&nbsp;value,&nbsp;and&nbsp;any&nbsp;array,&nbsp;slice,&nbsp;map,&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="6276636">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;of&nbsp;length&nbsp;zero.</span><br>
<span class="lineno">60</span><span class="comment" id="6276668">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;an&nbsp;anonymous&nbsp;struct&nbsp;field&nbsp;is&nbsp;handled&nbsp;as&nbsp;if&nbsp;the&nbsp;fields&nbsp;of&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="6276738">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;value&nbsp;were&nbsp;part&nbsp;of&nbsp;the&nbsp;outer&nbsp;struct.</span><br>
<span class="lineno"></span><span class="comment" id="6276784">//</span><br>
<span class="lineno"></span><span class="comment" id="6276787">//&nbsp;If&nbsp;a&nbsp;field&nbsp;uses&nbsp;a&nbsp;tag&nbsp;&#34;a&gt;b&gt;c&#34;,&nbsp;then&nbsp;the&nbsp;element&nbsp;c&nbsp;will&nbsp;be&nbsp;nested&nbsp;inside</span><br>
<span class="lineno"></span><span class="comment" id="6276862">//&nbsp;parent&nbsp;elements&nbsp;a&nbsp;and&nbsp;b.&nbsp;&nbsp;Fields&nbsp;that&nbsp;appear&nbsp;next&nbsp;to&nbsp;each&nbsp;other&nbsp;that&nbsp;name</span><br>
<span class="lineno">65</span><span class="comment" id="6276939">//&nbsp;the&nbsp;same&nbsp;parent&nbsp;will&nbsp;be&nbsp;enclosed&nbsp;in&nbsp;one&nbsp;XML&nbsp;element.</span><br>
<span class="lineno"></span><span class="comment" id="6276995">//</span><br>
<span class="lineno"></span><span class="comment" id="6276998">//&nbsp;See&nbsp;MarshalIndent&nbsp;for&nbsp;an&nbsp;example.</span><br>
<span class="lineno"></span><span class="comment" id="6277035">//</span><br>
<span class="lineno"></span><span class="comment" id="6277038">//&nbsp;Marshal&nbsp;will&nbsp;return&nbsp;an&nbsp;error&nbsp;if&nbsp;asked&nbsp;to&nbsp;marshal&nbsp;a&nbsp;channel,&nbsp;function,&nbsp;or&nbsp;map.</span><br>
<span class="lineno">70</span><span class="keyword" id="6277119">func</span>&nbsp;<span class="ident" id="6277124">Marshal</span><span class="op" id="6277131">(</span><span class="ident" id="6277132">v</span>&nbsp;<span class="keyword" id="6277134">interface</span><span class="op" id="6277143">{</span><span class="op" id="6277144">}</span><span class="op" id="6277145">)</span>&nbsp;<span class="op" id="6277147">(</span><span class="op" id="6277148">[</span><span class="op" id="6277149">]</span><span class="builtintype" id="6277150">byte</span><span class="op" id="6277154">,</span>&nbsp;<span class="builtintype" id="6277156">error</span><span class="op" id="6277161">)</span>&nbsp;<span class="op" id="6277163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277166">var</span>&nbsp;<span class="ident" id="6277170">b</span>&nbsp;<span class="ident" id="6277172">bytes</span><span class="op" id="6277177">.</span><span class="ident" id="6277178">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277186">if</span>&nbsp;<span class="ident" id="6277189">err</span>&nbsp;<span class="op" id="6277193">:=</span>&nbsp;<span class="ident" id="6277196">NewEncoder</span><span class="op" id="6277206">(</span><span class="op" id="6277207">&amp;</span><span class="ident" id="6277208">b</span><span class="op" id="6277209">)</span><span class="op" id="6277210">.</span><span class="ident" id="6277211">Encode</span><span class="op" id="6277217">(</span><span class="ident" id="6277218">v</span><span class="op" id="6277219">)</span><span class="op" id="6277220">;</span>&nbsp;<span class="ident" id="6277222">err</span>&nbsp;<span class="op" id="6277226">!=</span>&nbsp;<span class="ident" id="6277229">nil</span>&nbsp;<span class="op" id="6277233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277237">return</span>&nbsp;<span class="ident" id="6277244">nil</span><span class="op" id="6277247">,</span>&nbsp;<span class="ident" id="6277249">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6277254">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6277257">return</span>&nbsp;<span class="ident" id="6277264">b</span><span class="op" id="6277265">.</span><span class="ident" id="6277266">Bytes</span><span class="op" id="6277271">(</span><span class="op" id="6277272">)</span><span class="op" id="6277273">,</span>&nbsp;<span class="ident" id="6277275">nil</span><br>
<span class="lineno"></span><span class="op" id="6277279">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6277282">//&nbsp;Marshaler&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6277352">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno">80</span><span class="comment" id="6277391">//</span><br>
<span class="lineno"></span><span class="comment" id="6277394">//&nbsp;MarshalXML&nbsp;encodes&nbsp;the&nbsp;receiver&nbsp;as&nbsp;zero&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="comment" id="6277459">//&nbsp;By&nbsp;convention,&nbsp;arrays&nbsp;or&nbsp;slices&nbsp;are&nbsp;typically&nbsp;encoded&nbsp;as&nbsp;a&nbsp;sequence</span><br>
<span class="lineno"></span><span class="comment" id="6277530">//&nbsp;of&nbsp;elements,&nbsp;one&nbsp;per&nbsp;entry.</span><br>
<span class="lineno"></span><span class="comment" id="6277561">//&nbsp;Using&nbsp;start&nbsp;as&nbsp;the&nbsp;element&nbsp;tag&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno">85</span><span class="comment" id="6277625">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;XML&nbsp;elements&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6277691">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno"></span><span class="comment" id="6277708">//&nbsp;One&nbsp;common&nbsp;implementation&nbsp;strategy&nbsp;is&nbsp;to&nbsp;construct&nbsp;a&nbsp;separate</span><br>
<span class="lineno"></span><span class="comment" id="6277773">//&nbsp;value&nbsp;with&nbsp;a&nbsp;layout&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;desired&nbsp;XML&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="6277838">//&nbsp;to&nbsp;encode&nbsp;it&nbsp;using&nbsp;e.EncodeElement.</span><br>
<span class="lineno">90</span><span class="comment" id="6277877">//&nbsp;Another&nbsp;common&nbsp;strategy&nbsp;is&nbsp;to&nbsp;use&nbsp;repeated&nbsp;calls&nbsp;to&nbsp;e.EncodeToken</span><br>
<span class="lineno"></span><span class="comment" id="6277946">//&nbsp;to&nbsp;generate&nbsp;the&nbsp;XML&nbsp;output&nbsp;one&nbsp;token&nbsp;at&nbsp;a&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="6277997">//&nbsp;The&nbsp;sequence&nbsp;of&nbsp;encoded&nbsp;tokens&nbsp;must&nbsp;make&nbsp;up&nbsp;zero&nbsp;or&nbsp;more&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="6278063">//&nbsp;XML&nbsp;elements.</span><br>
<span class="lineno"></span><span class="keyword" id="6278080">type</span>&nbsp;<span class="ident" id="6278085">Marshaler</span>&nbsp;<span class="keyword" id="6278095">interface</span>&nbsp;<span class="op" id="6278105">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278108">MarshalXML</span><span class="op" id="6278118">(</span><span class="ident" id="6278119">e</span>&nbsp;<span class="op" id="6278121">*</span><span class="ident" id="6278122">Encoder</span><span class="op" id="6278129">,</span>&nbsp;<span class="ident" id="6278131">start</span>&nbsp;<span class="ident" id="6278137">StartElement</span><span class="op" id="6278149">)</span>&nbsp;<span class="builtintype" id="6278151">error</span><br>
<span class="lineno"></span><span class="op" id="6278157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6278160">//&nbsp;MarshalerAttr&nbsp;is&nbsp;the&nbsp;interface&nbsp;implemented&nbsp;by&nbsp;objects&nbsp;that&nbsp;can&nbsp;marshal</span><br>
<span class="lineno"></span><span class="comment" id="6278234">//&nbsp;themselves&nbsp;into&nbsp;valid&nbsp;XML&nbsp;attributes.</span><br>
<span class="lineno">100</span><span class="comment" id="6278275">//</span><br>
<span class="lineno"></span><span class="comment" id="6278278">//&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;an&nbsp;XML&nbsp;attribute&nbsp;with&nbsp;the&nbsp;encoded&nbsp;value&nbsp;of&nbsp;the&nbsp;receiver.</span><br>
<span class="lineno"></span><span class="comment" id="6278361">//&nbsp;Using&nbsp;name&nbsp;as&nbsp;the&nbsp;attribute&nbsp;name&nbsp;is&nbsp;not&nbsp;required,&nbsp;but&nbsp;doing&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="6278427">//&nbsp;will&nbsp;enable&nbsp;Unmarshal&nbsp;to&nbsp;match&nbsp;the&nbsp;attribute&nbsp;to&nbsp;the&nbsp;correct</span><br>
<span class="lineno"></span><span class="comment" id="6278490">//&nbsp;struct&nbsp;field.</span><br>
<span class="lineno">105</span><span class="comment" id="6278507">//&nbsp;If&nbsp;MarshalXMLAttr&nbsp;returns&nbsp;the&nbsp;zero&nbsp;attribute&nbsp;Attr{},&nbsp;no&nbsp;attribute</span><br>
<span class="lineno"></span><span class="comment" id="6278576">//&nbsp;will&nbsp;be&nbsp;generated&nbsp;in&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="comment" id="6278612">//&nbsp;MarshalXMLAttr&nbsp;is&nbsp;used&nbsp;only&nbsp;for&nbsp;struct&nbsp;fields&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6278670">//&nbsp;&#34;attr&#34;&nbsp;option&nbsp;in&nbsp;the&nbsp;field&nbsp;tag.</span><br>
<span class="lineno"></span><span class="keyword" id="6278705">type</span>&nbsp;<span class="ident" id="6278710">MarshalerAttr</span>&nbsp;<span class="keyword" id="6278724">interface</span>&nbsp;<span class="op" id="6278734">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6278737">MarshalXMLAttr</span><span class="op" id="6278751">(</span><span class="ident" id="6278752">name</span>&nbsp;<span class="ident" id="6278757">Name</span><span class="op" id="6278761">)</span>&nbsp;<span class="op" id="6278763">(</span><span class="ident" id="6278764">Attr</span><span class="op" id="6278768">,</span>&nbsp;<span class="builtintype" id="6278770">error</span><span class="op" id="6278775">)</span><br>
<span class="lineno"></span><span class="op" id="6278777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6278780">//&nbsp;MarshalIndent&nbsp;works&nbsp;like&nbsp;Marshal,&nbsp;but&nbsp;each&nbsp;XML&nbsp;element&nbsp;begins&nbsp;on&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="6278854">//&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more</span><br>
<span class="lineno">115</span><span class="comment" id="6278926">//&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6278978">func</span>&nbsp;<span class="ident" id="6278983">MarshalIndent</span><span class="op" id="6278996">(</span><span class="ident" id="6278997">v</span>&nbsp;<span class="keyword" id="6278999">interface</span><span class="op" id="6279008">{</span><span class="op" id="6279009">}</span><span class="op" id="6279010">,</span>&nbsp;<span class="ident" id="6279012">prefix</span><span class="op" id="6279018">,</span>&nbsp;<span class="ident" id="6279020">indent</span>&nbsp;<span class="builtintype" id="6279027">string</span><span class="op" id="6279033">)</span>&nbsp;<span class="op" id="6279035">(</span><span class="op" id="6279036">[</span><span class="op" id="6279037">]</span><span class="builtintype" id="6279038">byte</span><span class="op" id="6279042">,</span>&nbsp;<span class="builtintype" id="6279044">error</span><span class="op" id="6279049">)</span>&nbsp;<span class="op" id="6279051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279054">var</span>&nbsp;<span class="ident" id="6279058">b</span>&nbsp;<span class="ident" id="6279060">bytes</span><span class="op" id="6279065">.</span><span class="ident" id="6279066">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279074">enc</span>&nbsp;<span class="op" id="6279078">:=</span>&nbsp;<span class="ident" id="6279081">NewEncoder</span><span class="op" id="6279091">(</span><span class="op" id="6279092">&amp;</span><span class="ident" id="6279093">b</span><span class="op" id="6279094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279097">enc</span><span class="op" id="6279100">.</span><span class="ident" id="6279101">Indent</span><span class="op" id="6279107">(</span><span class="ident" id="6279108">prefix</span><span class="op" id="6279114">,</span>&nbsp;<span class="ident" id="6279116">indent</span><span class="op" id="6279122">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279125">if</span>&nbsp;<span class="ident" id="6279128">err</span>&nbsp;<span class="op" id="6279132">:=</span>&nbsp;<span class="ident" id="6279135">enc</span><span class="op" id="6279138">.</span><span class="ident" id="6279139">Encode</span><span class="op" id="6279145">(</span><span class="ident" id="6279146">v</span><span class="op" id="6279147">)</span><span class="op" id="6279148">;</span>&nbsp;<span class="ident" id="6279150">err</span>&nbsp;<span class="op" id="6279154">!=</span>&nbsp;<span class="ident" id="6279157">nil</span>&nbsp;<span class="op" id="6279161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279165">return</span>&nbsp;<span class="ident" id="6279172">nil</span><span class="op" id="6279175">,</span>&nbsp;<span class="ident" id="6279177">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6279182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279185">return</span>&nbsp;<span class="ident" id="6279192">b</span><span class="op" id="6279193">.</span><span class="ident" id="6279194">Bytes</span><span class="op" id="6279199">(</span><span class="op" id="6279200">)</span><span class="op" id="6279201">,</span>&nbsp;<span class="ident" id="6279203">nil</span><br>
<span class="lineno"></span><span class="op" id="6279207">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="comment" id="6279210">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;XML&nbsp;data&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6279261">type</span>&nbsp;<span class="ident" id="6279266">Encoder</span>&nbsp;<span class="keyword" id="6279274">struct</span>&nbsp;<span class="op" id="6279281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279284">p</span>&nbsp;<span class="ident" id="6279286">printer</span><br>
<span class="lineno"></span><span class="op" id="6279294">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="comment" id="6279297">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="6279351">func</span>&nbsp;<span class="ident" id="6279356">NewEncoder</span><span class="op" id="6279366">(</span><span class="ident" id="6279367">w</span>&nbsp;<span class="ident" id="6279369">io</span><span class="op" id="6279371">.</span><span class="ident" id="6279372">Writer</span><span class="op" id="6279378">)</span>&nbsp;<span class="op" id="6279380">*</span><span class="ident" id="6279381">Encoder</span>&nbsp;<span class="op" id="6279389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279392">e</span>&nbsp;<span class="op" id="6279394">:=</span>&nbsp;<span class="op" id="6279397">&amp;</span><span class="ident" id="6279398">Encoder</span><span class="op" id="6279405">{</span><span class="ident" id="6279406">printer</span><span class="op" id="6279413">{</span><span class="ident" id="6279414">Writer</span><span class="op" id="6279420">:</span>&nbsp;<span class="ident" id="6279422">bufio</span><span class="op" id="6279427">.</span><span class="ident" id="6279428">NewWriter</span><span class="op" id="6279437">(</span><span class="ident" id="6279438">w</span><span class="op" id="6279439">)</span><span class="op" id="6279440">}</span><span class="op" id="6279441">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279444">e</span><span class="op" id="6279445">.</span><span class="ident" id="6279446">p</span><span class="op" id="6279447">.</span><span class="ident" id="6279448">encoder</span>&nbsp;<span class="op" id="6279456">=</span>&nbsp;<span class="ident" id="6279458">e</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6279461">return</span>&nbsp;<span class="ident" id="6279468">e</span><br>
<span class="lineno"></span><span class="op" id="6279470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6279473">//&nbsp;Indent&nbsp;sets&nbsp;the&nbsp;encoder&nbsp;to&nbsp;generate&nbsp;XML&nbsp;in&nbsp;which&nbsp;each&nbsp;element</span><br>
<span class="lineno"></span><span class="comment" id="6279538">//&nbsp;begins&nbsp;on&nbsp;a&nbsp;new&nbsp;indented&nbsp;line&nbsp;that&nbsp;starts&nbsp;with&nbsp;prefix&nbsp;and&nbsp;is&nbsp;followed&nbsp;by</span><br>
<span class="lineno">140</span><span class="comment" id="6279614">//&nbsp;one&nbsp;or&nbsp;more&nbsp;copies&nbsp;of&nbsp;indent&nbsp;according&nbsp;to&nbsp;the&nbsp;nesting&nbsp;depth.</span><br>
<span class="lineno"></span><span class="keyword" id="6279678">func</span>&nbsp;<span class="op" id="6279683">(</span><span class="ident" id="6279684">enc</span>&nbsp;<span class="op" id="6279688">*</span><span class="ident" id="6279689">Encoder</span><span class="op" id="6279696">)</span>&nbsp;<span class="ident" id="6279698">Indent</span><span class="op" id="6279704">(</span><span class="ident" id="6279705">prefix</span><span class="op" id="6279711">,</span>&nbsp;<span class="ident" id="6279713">indent</span>&nbsp;<span class="builtintype" id="6279720">string</span><span class="op" id="6279726">)</span>&nbsp;<span class="op" id="6279728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279731">enc</span><span class="op" id="6279734">.</span><span class="ident" id="6279735">p</span><span class="op" id="6279736">.</span><span class="ident" id="6279737">prefix</span>&nbsp;<span class="op" id="6279744">=</span>&nbsp;<span class="ident" id="6279746">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6279754">enc</span><span class="op" id="6279757">.</span><span class="ident" id="6279758">p</span><span class="op" id="6279759">.</span><span class="ident" id="6279760">indent</span>&nbsp;<span class="op" id="6279767">=</span>&nbsp;<span class="ident" id="6279769">indent</span><br>
<span class="lineno"></span><span class="op" id="6279776">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="6279779">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6279833">//</span><br>
<span class="lineno"></span><span class="comment" id="6279836">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6279906">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">150</span><span class="comment" id="6279930">//</span><br>
<span class="lineno"></span><span class="comment" id="6279933">//&nbsp;Encode&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6279973">func</span>&nbsp;<span class="op" id="6279978">(</span><span class="ident" id="6279979">enc</span>&nbsp;<span class="op" id="6279983">*</span><span class="ident" id="6279984">Encoder</span><span class="op" id="6279991">)</span>&nbsp;<span class="ident" id="6279993">Encode</span><span class="op" id="6279999">(</span><span class="ident" id="6280000">v</span>&nbsp;<span class="keyword" id="6280002">interface</span><span class="op" id="6280011">{</span><span class="op" id="6280012">}</span><span class="op" id="6280013">)</span>&nbsp;<span class="builtintype" id="6280015">error</span>&nbsp;<span class="op" id="6280021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280024">err</span>&nbsp;<span class="op" id="6280028">:=</span>&nbsp;<span class="ident" id="6280031">enc</span><span class="op" id="6280034">.</span><span class="ident" id="6280035">p</span><span class="op" id="6280036">.</span><span class="ident" id="6280037">marshalValue</span><span class="op" id="6280049">(</span><span class="ident" id="6280050">reflect</span><span class="op" id="6280057">.</span><span class="ident" id="6280058">ValueOf</span><span class="op" id="6280065">(</span><span class="ident" id="6280066">v</span><span class="op" id="6280067">)</span><span class="op" id="6280068">,</span>&nbsp;<span class="ident" id="6280070">nil</span><span class="op" id="6280073">,</span>&nbsp;<span class="ident" id="6280075">nil</span><span class="op" id="6280078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280081">if</span>&nbsp;<span class="ident" id="6280084">err</span>&nbsp;<span class="op" id="6280088">!=</span>&nbsp;<span class="ident" id="6280091">nil</span>&nbsp;<span class="op" id="6280095">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280099">return</span>&nbsp;<span class="ident" id="6280106">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280114">return</span>&nbsp;<span class="ident" id="6280121">enc</span><span class="op" id="6280124">.</span><span class="ident" id="6280125">p</span><span class="op" id="6280126">.</span><span class="ident" id="6280127">Flush</span><span class="op" id="6280132">(</span><span class="op" id="6280133">)</span><br>
<span class="lineno"></span><span class="op" id="6280135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6280138">//&nbsp;EncodeElement&nbsp;writes&nbsp;the&nbsp;XML&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="6280199">//&nbsp;using&nbsp;start&nbsp;as&nbsp;the&nbsp;outermost&nbsp;tag&nbsp;in&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="comment" id="6280252">//</span><br>
<span class="lineno"></span><span class="comment" id="6280255">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the&nbsp;conversion</span><br>
<span class="lineno"></span><span class="comment" id="6280325">//&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;XML.</span><br>
<span class="lineno">165</span><span class="comment" id="6280349">//</span><br>
<span class="lineno"></span><span class="comment" id="6280352">//&nbsp;EncodeElement&nbsp;calls&nbsp;Flush&nbsp;before&nbsp;returning.</span><br>
<span class="lineno"></span><span class="keyword" id="6280399">func</span>&nbsp;<span class="op" id="6280404">(</span><span class="ident" id="6280405">enc</span>&nbsp;<span class="op" id="6280409">*</span><span class="ident" id="6280410">Encoder</span><span class="op" id="6280417">)</span>&nbsp;<span class="ident" id="6280419">EncodeElement</span><span class="op" id="6280432">(</span><span class="ident" id="6280433">v</span>&nbsp;<span class="keyword" id="6280435">interface</span><span class="op" id="6280444">{</span><span class="op" id="6280445">}</span><span class="op" id="6280446">,</span>&nbsp;<span class="ident" id="6280448">start</span>&nbsp;<span class="ident" id="6280454">StartElement</span><span class="op" id="6280466">)</span>&nbsp;<span class="builtintype" id="6280468">error</span>&nbsp;<span class="op" id="6280474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280477">err</span>&nbsp;<span class="op" id="6280481">:=</span>&nbsp;<span class="ident" id="6280484">enc</span><span class="op" id="6280487">.</span><span class="ident" id="6280488">p</span><span class="op" id="6280489">.</span><span class="ident" id="6280490">marshalValue</span><span class="op" id="6280502">(</span><span class="ident" id="6280503">reflect</span><span class="op" id="6280510">.</span><span class="ident" id="6280511">ValueOf</span><span class="op" id="6280518">(</span><span class="ident" id="6280519">v</span><span class="op" id="6280520">)</span><span class="op" id="6280521">,</span>&nbsp;<span class="ident" id="6280523">nil</span><span class="op" id="6280526">,</span>&nbsp;<span class="op" id="6280528">&amp;</span><span class="ident" id="6280529">start</span><span class="op" id="6280534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280537">if</span>&nbsp;<span class="ident" id="6280540">err</span>&nbsp;<span class="op" id="6280544">!=</span>&nbsp;<span class="ident" id="6280547">nil</span>&nbsp;<span class="op" id="6280551">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280555">return</span>&nbsp;<span class="ident" id="6280562">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6280567">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6280570">return</span>&nbsp;<span class="ident" id="6280577">enc</span><span class="op" id="6280580">.</span><span class="ident" id="6280581">p</span><span class="op" id="6280582">.</span><span class="ident" id="6280583">Flush</span><span class="op" id="6280588">(</span><span class="op" id="6280589">)</span><br>
<span class="lineno"></span><span class="op" id="6280591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="6280594">var</span>&nbsp;<span class="op" id="6280598">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280601">endComment</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6280614">=</span>&nbsp;<span class="op" id="6280616">[</span><span class="op" id="6280617">]</span><span class="builtintype" id="6280618">byte</span><span class="op" id="6280622">(</span><span class="string" id="6280623">&#34;--&gt;&#34;</span><span class="op" id="6280628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280631">endProcInst</span>&nbsp;&nbsp;<span class="op" id="6280644">=</span>&nbsp;<span class="op" id="6280646">[</span><span class="op" id="6280647">]</span><span class="builtintype" id="6280648">byte</span><span class="op" id="6280652">(</span><span class="string" id="6280653">&#34;?&gt;&#34;</span><span class="op" id="6280657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6280660">endDirective</span>&nbsp;<span class="op" id="6280673">=</span>&nbsp;<span class="op" id="6280675">[</span><span class="op" id="6280676">]</span><span class="builtintype" id="6280677">byte</span><span class="op" id="6280681">(</span><span class="string" id="6280682">&#34;&gt;&#34;</span><span class="op" id="6280685">)</span><br>
<span class="lineno"></span><span class="op" id="6280687">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="comment" id="6280690">//&nbsp;EncodeToken&nbsp;writes&nbsp;the&nbsp;given&nbsp;XML&nbsp;token&nbsp;to&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="comment" id="6280747">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;StartElement&nbsp;and&nbsp;EndElement&nbsp;tokens&nbsp;are&nbsp;not&nbsp;properly&nbsp;matched.</span><br>
<span class="lineno"></span><span class="comment" id="6280834">//</span><br>
<span class="lineno"></span><span class="comment" id="6280837">//&nbsp;EncodeToken&nbsp;does&nbsp;not&nbsp;call&nbsp;Flush,&nbsp;because&nbsp;usually&nbsp;it&nbsp;is&nbsp;part&nbsp;of&nbsp;a&nbsp;larger&nbsp;operation</span><br>
<span class="lineno">185</span><span class="comment" id="6280922">//&nbsp;such&nbsp;as&nbsp;Encode&nbsp;or&nbsp;EncodeElement&nbsp;(or&nbsp;a&nbsp;custom&nbsp;Marshaler&#39;s&nbsp;MarshalXML&nbsp;invoked</span><br>
<span class="lineno"></span><span class="comment" id="6281001">//&nbsp;during&nbsp;those),&nbsp;and&nbsp;those&nbsp;will&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished.</span><br>
<span class="lineno"></span><span class="comment" id="6281060">//&nbsp;Callers&nbsp;that&nbsp;create&nbsp;an&nbsp;Encoder&nbsp;and&nbsp;then&nbsp;invoke&nbsp;EncodeToken&nbsp;directly,&nbsp;without</span><br>
<span class="lineno"></span><span class="comment" id="6281140">//&nbsp;using&nbsp;Encode&nbsp;or&nbsp;EncodeElement,&nbsp;need&nbsp;to&nbsp;call&nbsp;Flush&nbsp;when&nbsp;finished&nbsp;to&nbsp;ensure</span><br>
<span class="lineno"></span><span class="comment" id="6281217">//&nbsp;that&nbsp;the&nbsp;XML&nbsp;is&nbsp;written&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">190</span><span class="comment" id="6281270">//</span><br>
<span class="lineno"></span><span class="comment" id="6281273">//&nbsp;EncodeToken&nbsp;allows&nbsp;writing&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;Target&nbsp;set&nbsp;to&nbsp;&#34;xml&#34;&nbsp;only&nbsp;as&nbsp;the&nbsp;first&nbsp;token</span><br>
<span class="lineno"></span><span class="comment" id="6281363">//&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="6281381">func</span>&nbsp;<span class="op" id="6281386">(</span><span class="ident" id="6281387">enc</span>&nbsp;<span class="op" id="6281391">*</span><span class="ident" id="6281392">Encoder</span><span class="op" id="6281399">)</span>&nbsp;<span class="ident" id="6281401">EncodeToken</span><span class="op" id="6281412">(</span><span class="ident" id="6281413">t</span>&nbsp;<span class="ident" id="6281415">Token</span><span class="op" id="6281420">)</span>&nbsp;<span class="builtintype" id="6281422">error</span>&nbsp;<span class="op" id="6281428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281431">p</span>&nbsp;<span class="op" id="6281433">:=</span>&nbsp;<span class="op" id="6281436">&amp;</span><span class="ident" id="6281437">enc</span><span class="op" id="6281440">.</span><span class="ident" id="6281441">p</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281444">switch</span>&nbsp;<span class="ident" id="6281451">t</span>&nbsp;<span class="op" id="6281453">:=</span>&nbsp;<span class="ident" id="6281456">t</span><span class="op" id="6281457">.</span><span class="op" id="6281458">(</span><span class="keyword" id="6281459">type</span><span class="op" id="6281463">)</span>&nbsp;<span class="op" id="6281465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281468">case</span>&nbsp;<span class="ident" id="6281473">StartElement</span><span class="op" id="6281485">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281489">if</span>&nbsp;<span class="ident" id="6281492">err</span>&nbsp;<span class="op" id="6281496">:=</span>&nbsp;<span class="ident" id="6281499">p</span><span class="op" id="6281500">.</span><span class="ident" id="6281501">writeStart</span><span class="op" id="6281511">(</span><span class="op" id="6281512">&amp;</span><span class="ident" id="6281513">t</span><span class="op" id="6281514">)</span><span class="op" id="6281515">;</span>&nbsp;<span class="ident" id="6281517">err</span>&nbsp;<span class="op" id="6281521">!=</span>&nbsp;<span class="ident" id="6281524">nil</span>&nbsp;<span class="op" id="6281528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281533">return</span>&nbsp;<span class="ident" id="6281540">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281546">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281549">case</span>&nbsp;<span class="ident" id="6281554">EndElement</span><span class="op" id="6281564">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281568">if</span>&nbsp;<span class="ident" id="6281571">err</span>&nbsp;<span class="op" id="6281575">:=</span>&nbsp;<span class="ident" id="6281578">p</span><span class="op" id="6281579">.</span><span class="ident" id="6281580">writeEnd</span><span class="op" id="6281588">(</span><span class="ident" id="6281589">t</span><span class="op" id="6281590">.</span><span class="ident" id="6281591">Name</span><span class="op" id="6281595">)</span><span class="op" id="6281596">;</span>&nbsp;<span class="ident" id="6281598">err</span>&nbsp;<span class="op" id="6281602">!=</span>&nbsp;<span class="ident" id="6281605">nil</span>&nbsp;<span class="op" id="6281609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281614">return</span>&nbsp;<span class="ident" id="6281621">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281630">case</span>&nbsp;<span class="ident" id="6281635">CharData</span><span class="op" id="6281643">:</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281647">EscapeText</span><span class="op" id="6281657">(</span><span class="ident" id="6281658">p</span><span class="op" id="6281659">,</span>&nbsp;<span class="ident" id="6281661">t</span><span class="op" id="6281662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281665">case</span>&nbsp;<span class="ident" id="6281670">Comment</span><span class="op" id="6281677">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281681">if</span>&nbsp;<span class="ident" id="6281684">bytes</span><span class="op" id="6281689">.</span><span class="ident" id="6281690">Contains</span><span class="op" id="6281698">(</span><span class="ident" id="6281699">t</span><span class="op" id="6281700">,</span>&nbsp;<span class="ident" id="6281702">endComment</span><span class="op" id="6281712">)</span>&nbsp;<span class="op" id="6281714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281719">return</span>&nbsp;<span class="ident" id="6281726">fmt</span><span class="op" id="6281729">.</span><span class="ident" id="6281730">Errorf</span><span class="op" id="6281736">(</span><span class="string" id="6281737">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Comment&nbsp;containing&nbsp;--&gt;&nbsp;marker&#34;</span><span class="op" id="6281788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6281792">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281796">p</span><span class="op" id="6281797">.</span><span class="ident" id="6281798">WriteString</span><span class="op" id="6281809">(</span><span class="string" id="6281810">&#34;&lt;!--&#34;</span><span class="op" id="6281816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281820">p</span><span class="op" id="6281821">.</span><span class="ident" id="6281822">Write</span><span class="op" id="6281827">(</span><span class="ident" id="6281828">t</span><span class="op" id="6281829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6281833">p</span><span class="op" id="6281834">.</span><span class="ident" id="6281835">WriteString</span><span class="op" id="6281846">(</span><span class="string" id="6281847">&#34;--&gt;&#34;</span><span class="op" id="6281852">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281856">return</span>&nbsp;<span class="ident" id="6281863">p</span><span class="op" id="6281864">.</span><span class="ident" id="6281865">cachedWriteError</span><span class="op" id="6281881">(</span><span class="op" id="6281882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6281885">case</span>&nbsp;<span class="ident" id="6281890">ProcInst</span><span class="op" id="6281898">:</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6281902">//&nbsp;First&nbsp;token&nbsp;to&nbsp;be&nbsp;encoded&nbsp;which&nbsp;is&nbsp;also&nbsp;a&nbsp;ProcInst&nbsp;with&nbsp;target&nbsp;of&nbsp;xml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6281977">//&nbsp;is&nbsp;the&nbsp;xml&nbsp;declaration.&nbsp;&nbsp;The&nbsp;only&nbsp;ProcInst&nbsp;where&nbsp;target&nbsp;of&nbsp;xml&nbsp;is&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282057">if</span>&nbsp;<span class="ident" id="6282060">t</span><span class="op" id="6282061">.</span><span class="ident" id="6282062">Target</span>&nbsp;<span class="op" id="6282069">==</span>&nbsp;<span class="string" id="6282072">&#34;xml&#34;</span>&nbsp;<span class="op" id="6282078">&amp;&amp;</span>&nbsp;<span class="ident" id="6282081">p</span><span class="op" id="6282082">.</span><span class="ident" id="6282083">Buffered</span><span class="op" id="6282091">(</span><span class="op" id="6282092">)</span>&nbsp;<span class="op" id="6282094">!=</span>&nbsp;<span class="num" id="6282097">0</span>&nbsp;<span class="op" id="6282099">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282104">return</span>&nbsp;<span class="ident" id="6282111">fmt</span><span class="op" id="6282114">.</span><span class="ident" id="6282115">Errorf</span><span class="op" id="6282121">(</span><span class="string" id="6282122">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;xml&nbsp;target&nbsp;only&nbsp;valid&nbsp;for&nbsp;xml&nbsp;declaration,&nbsp;first&nbsp;token&nbsp;encoded&#34;</span><span class="op" id="6282215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282219">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282223">if</span>&nbsp;<span class="op" id="6282226">!</span><span class="ident" id="6282227">isNameString</span><span class="op" id="6282239">(</span><span class="ident" id="6282240">t</span><span class="op" id="6282241">.</span><span class="ident" id="6282242">Target</span><span class="op" id="6282248">)</span>&nbsp;<span class="op" id="6282250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282255">return</span>&nbsp;<span class="ident" id="6282262">fmt</span><span class="op" id="6282265">.</span><span class="ident" id="6282266">Errorf</span><span class="op" id="6282272">(</span><span class="string" id="6282273">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;with&nbsp;invalid&nbsp;Target&#34;</span><span class="op" id="6282323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282331">if</span>&nbsp;<span class="ident" id="6282334">bytes</span><span class="op" id="6282339">.</span><span class="ident" id="6282340">Contains</span><span class="op" id="6282348">(</span><span class="ident" id="6282349">t</span><span class="op" id="6282350">.</span><span class="ident" id="6282351">Inst</span><span class="op" id="6282355">,</span>&nbsp;<span class="ident" id="6282357">endProcInst</span><span class="op" id="6282368">)</span>&nbsp;<span class="op" id="6282370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282375">return</span>&nbsp;<span class="ident" id="6282382">fmt</span><span class="op" id="6282385">.</span><span class="ident" id="6282386">Errorf</span><span class="op" id="6282392">(</span><span class="string" id="6282393">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;ProcInst&nbsp;containing&nbsp;?&gt;&nbsp;marker&#34;</span><span class="op" id="6282444">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282448">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282452">p</span><span class="op" id="6282453">.</span><span class="ident" id="6282454">WriteString</span><span class="op" id="6282465">(</span><span class="string" id="6282466">&#34;&lt;?&#34;</span><span class="op" id="6282470">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282474">p</span><span class="op" id="6282475">.</span><span class="ident" id="6282476">WriteString</span><span class="op" id="6282487">(</span><span class="ident" id="6282488">t</span><span class="op" id="6282489">.</span><span class="ident" id="6282490">Target</span><span class="op" id="6282496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282500">if</span>&nbsp;<span class="builtinfunc" id="6282503">len</span><span class="op" id="6282506">(</span><span class="ident" id="6282507">t</span><span class="op" id="6282508">.</span><span class="ident" id="6282509">Inst</span><span class="op" id="6282513">)</span>&nbsp;<span class="op" id="6282515">&gt;</span>&nbsp;<span class="num" id="6282517">0</span>&nbsp;<span class="op" id="6282519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282524">p</span><span class="op" id="6282525">.</span><span class="ident" id="6282526">WriteByte</span><span class="op" id="6282535">(</span><span class="string" id="6282536">&#39;&nbsp;&#39;</span><span class="op" id="6282539">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282544">p</span><span class="op" id="6282545">.</span><span class="ident" id="6282546">Write</span><span class="op" id="6282551">(</span><span class="ident" id="6282552">t</span><span class="op" id="6282553">.</span><span class="ident" id="6282554">Inst</span><span class="op" id="6282558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282566">p</span><span class="op" id="6282567">.</span><span class="ident" id="6282568">WriteString</span><span class="op" id="6282579">(</span><span class="string" id="6282580">&#34;?&gt;&#34;</span><span class="op" id="6282584">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282587">case</span>&nbsp;<span class="ident" id="6282592">Directive</span><span class="op" id="6282601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282605">if</span>&nbsp;<span class="ident" id="6282608">bytes</span><span class="op" id="6282613">.</span><span class="ident" id="6282614">Contains</span><span class="op" id="6282622">(</span><span class="ident" id="6282623">t</span><span class="op" id="6282624">,</span>&nbsp;<span class="ident" id="6282626">endDirective</span><span class="op" id="6282638">)</span>&nbsp;<span class="op" id="6282640">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282645">return</span>&nbsp;<span class="ident" id="6282652">fmt</span><span class="op" id="6282655">.</span><span class="ident" id="6282656">Errorf</span><span class="op" id="6282662">(</span><span class="string" id="6282663">&#34;xml:&nbsp;EncodeToken&nbsp;of&nbsp;Directive&nbsp;containing&nbsp;&gt;&nbsp;marker&#34;</span><span class="op" id="6282714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282722">p</span><span class="op" id="6282723">.</span><span class="ident" id="6282724">WriteString</span><span class="op" id="6282735">(</span><span class="string" id="6282736">&#34;&lt;!&#34;</span><span class="op" id="6282740">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282744">p</span><span class="op" id="6282745">.</span><span class="ident" id="6282746">Write</span><span class="op" id="6282751">(</span><span class="ident" id="6282752">t</span><span class="op" id="6282753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6282757">p</span><span class="op" id="6282758">.</span><span class="ident" id="6282759">WriteString</span><span class="op" id="6282770">(</span><span class="string" id="6282771">&#34;&gt;&#34;</span><span class="op" id="6282774">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6282777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282780">return</span>&nbsp;<span class="ident" id="6282787">p</span><span class="op" id="6282788">.</span><span class="ident" id="6282789">cachedWriteError</span><span class="op" id="6282805">(</span><span class="op" id="6282806">)</span><br>
<span class="lineno"></span><span class="op" id="6282808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6282811">//&nbsp;Flush&nbsp;flushes&nbsp;any&nbsp;buffered&nbsp;XML&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno">245</span><span class="comment" id="6282871">//&nbsp;See&nbsp;the&nbsp;EncodeToken&nbsp;documentation&nbsp;for&nbsp;details&nbsp;about&nbsp;when&nbsp;it&nbsp;is&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6282948">func</span>&nbsp;<span class="op" id="6282953">(</span><span class="ident" id="6282954">enc</span>&nbsp;<span class="op" id="6282958">*</span><span class="ident" id="6282959">Encoder</span><span class="op" id="6282966">)</span>&nbsp;<span class="ident" id="6282968">Flush</span><span class="op" id="6282973">(</span><span class="op" id="6282974">)</span>&nbsp;<span class="builtintype" id="6282976">error</span>&nbsp;<span class="op" id="6282982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6282985">return</span>&nbsp;<span class="ident" id="6282992">enc</span><span class="op" id="6282995">.</span><span class="ident" id="6282996">p</span><span class="op" id="6282997">.</span><span class="ident" id="6282998">Flush</span><span class="op" id="6283003">(</span><span class="op" id="6283004">)</span><br>
<span class="lineno"></span><span class="op" id="6283006">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="6283009">type</span>&nbsp;<span class="ident" id="6283014">printer</span>&nbsp;<span class="keyword" id="6283022">struct</span>&nbsp;<span class="op" id="6283029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283032">*</span><span class="ident" id="6283033">bufio</span><span class="op" id="6283038">.</span><span class="ident" id="6283039">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283047">encoder</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283058">*</span><span class="ident" id="6283059">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283068">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6283079">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283084">indent</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6283095">string</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283103">prefix</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6283114">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283122">depth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6283133">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283138">indentedIn</span>&nbsp;<span class="builtintype" id="6283149">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283155">putNewline</span>&nbsp;<span class="builtintype" id="6283166">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283172">attrNS</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6283183">map</span><span class="op" id="6283186">[</span><span class="builtintype" id="6283187">string</span><span class="op" id="6283193">]</span><span class="builtintype" id="6283194">string</span>&nbsp;<span class="comment" id="6283201">//&nbsp;map&nbsp;prefix&nbsp;-&gt;&nbsp;name&nbsp;space</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283230">attrPrefix</span>&nbsp;<span class="keyword" id="6283241">map</span><span class="op" id="6283244">[</span><span class="builtintype" id="6283245">string</span><span class="op" id="6283251">]</span><span class="builtintype" id="6283252">string</span>&nbsp;<span class="comment" id="6283259">//&nbsp;map&nbsp;name&nbsp;space&nbsp;-&gt;&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283288">prefixes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="6283299">[</span><span class="op" id="6283300">]</span><span class="builtintype" id="6283301">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283309">tags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6283320">[</span><span class="op" id="6283321">]</span><span class="ident" id="6283322">Name</span><br>
<span class="lineno"></span><span class="op" id="6283327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span><span class="comment" id="6283330">//&nbsp;createAttrPrefix&nbsp;finds&nbsp;the&nbsp;name&nbsp;space&nbsp;prefix&nbsp;attribute&nbsp;to&nbsp;use&nbsp;for&nbsp;the&nbsp;given&nbsp;name&nbsp;space,</span><br>
<span class="lineno"></span><span class="comment" id="6283421">//&nbsp;defining&nbsp;a&nbsp;new&nbsp;prefix&nbsp;if&nbsp;necessary.&nbsp;It&nbsp;returns&nbsp;the&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6283483">func</span>&nbsp;<span class="op" id="6283488">(</span><span class="ident" id="6283489">p</span>&nbsp;<span class="op" id="6283491">*</span><span class="ident" id="6283492">printer</span><span class="op" id="6283499">)</span>&nbsp;<span class="ident" id="6283501">createAttrPrefix</span><span class="op" id="6283517">(</span><span class="ident" id="6283518">url</span>&nbsp;<span class="builtintype" id="6283522">string</span><span class="op" id="6283528">)</span>&nbsp;<span class="builtintype" id="6283530">string</span>&nbsp;<span class="op" id="6283537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283540">if</span>&nbsp;<span class="ident" id="6283543">prefix</span>&nbsp;<span class="op" id="6283550">:=</span>&nbsp;<span class="ident" id="6283553">p</span><span class="op" id="6283554">.</span><span class="ident" id="6283555">attrPrefix</span><span class="op" id="6283565">[</span><span class="ident" id="6283566">url</span><span class="op" id="6283569">]</span><span class="op" id="6283570">;</span>&nbsp;<span class="ident" id="6283572">prefix</span>&nbsp;<span class="op" id="6283579">!=</span>&nbsp;<span class="string" id="6283582">&#34;&#34;</span>&nbsp;<span class="op" id="6283585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283589">return</span>&nbsp;<span class="ident" id="6283596">prefix</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283604">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283608">//&nbsp;The&nbsp;&#34;http://www.w3.org/XML/1998/namespace&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;predefined&nbsp;as&nbsp;&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283689">//&nbsp;and&nbsp;must&nbsp;be&nbsp;referred&nbsp;to&nbsp;that&nbsp;way.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283727">//&nbsp;(The&nbsp;&#34;http://www.w3.org/2000/xmlns/&#34;&nbsp;name&nbsp;space&nbsp;is&nbsp;also&nbsp;predefined&nbsp;as&nbsp;&#34;xmlns&#34;,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283810">//&nbsp;but&nbsp;users&nbsp;should&nbsp;not&nbsp;be&nbsp;trying&nbsp;to&nbsp;use&nbsp;that&nbsp;one&nbsp;directly&nbsp;-&nbsp;that&#39;s&nbsp;our&nbsp;job.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283889">if</span>&nbsp;<span class="ident" id="6283892">url</span>&nbsp;<span class="op" id="6283896">==</span>&nbsp;<span class="ident" id="6283899">xmlURL</span>&nbsp;<span class="op" id="6283906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283910">return</span>&nbsp;<span class="string" id="6283917">&#34;xml&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6283924">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6283928">//&nbsp;Need&nbsp;to&nbsp;define&nbsp;a&nbsp;new&nbsp;name&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6283965">if</span>&nbsp;<span class="ident" id="6283968">p</span><span class="op" id="6283969">.</span><span class="ident" id="6283970">attrPrefix</span>&nbsp;<span class="op" id="6283981">==</span>&nbsp;<span class="ident" id="6283984">nil</span>&nbsp;<span class="op" id="6283988">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6283992">p</span><span class="op" id="6283993">.</span><span class="ident" id="6283994">attrPrefix</span>&nbsp;<span class="op" id="6284005">=</span>&nbsp;<span class="builtinfunc" id="6284007">make</span><span class="op" id="6284011">(</span><span class="keyword" id="6284012">map</span><span class="op" id="6284015">[</span><span class="builtintype" id="6284016">string</span><span class="op" id="6284022">]</span><span class="builtintype" id="6284023">string</span><span class="op" id="6284029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284033">p</span><span class="op" id="6284034">.</span><span class="ident" id="6284035">attrNS</span>&nbsp;<span class="op" id="6284042">=</span>&nbsp;<span class="builtinfunc" id="6284044">make</span><span class="op" id="6284048">(</span><span class="keyword" id="6284049">map</span><span class="op" id="6284052">[</span><span class="builtintype" id="6284053">string</span><span class="op" id="6284059">]</span><span class="builtintype" id="6284060">string</span><span class="op" id="6284066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284069">}</span><br>
<span class="lineno">285</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284073">//&nbsp;Pick&nbsp;a&nbsp;name.&nbsp;We&nbsp;try&nbsp;to&nbsp;use&nbsp;the&nbsp;final&nbsp;element&nbsp;of&nbsp;the&nbsp;path</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284134">//&nbsp;but&nbsp;fall&nbsp;back&nbsp;to&nbsp;_.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284158">prefix</span>&nbsp;<span class="op" id="6284165">:=</span>&nbsp;<span class="ident" id="6284168">strings</span><span class="op" id="6284175">.</span><span class="ident" id="6284176">TrimRight</span><span class="op" id="6284185">(</span><span class="ident" id="6284186">url</span><span class="op" id="6284189">,</span>&nbsp;<span class="string" id="6284191">&#34;/&#34;</span><span class="op" id="6284194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284197">if</span>&nbsp;<span class="ident" id="6284200">i</span>&nbsp;<span class="op" id="6284202">:=</span>&nbsp;<span class="ident" id="6284205">strings</span><span class="op" id="6284212">.</span><span class="ident" id="6284213">LastIndex</span><span class="op" id="6284222">(</span><span class="ident" id="6284223">prefix</span><span class="op" id="6284229">,</span>&nbsp;<span class="string" id="6284231">&#34;/&#34;</span><span class="op" id="6284234">)</span><span class="op" id="6284235">;</span>&nbsp;<span class="ident" id="6284237">i</span>&nbsp;<span class="op" id="6284239">&gt;=</span>&nbsp;<span class="num" id="6284242">0</span>&nbsp;<span class="op" id="6284244">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284248">prefix</span>&nbsp;<span class="op" id="6284255">=</span>&nbsp;<span class="ident" id="6284257">prefix</span><span class="op" id="6284263">[</span><span class="ident" id="6284264">i</span><span class="op" id="6284265">+</span><span class="num" id="6284266">1</span><span class="op" id="6284267">:</span><span class="op" id="6284268">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284274">if</span>&nbsp;<span class="ident" id="6284277">prefix</span>&nbsp;<span class="op" id="6284284">==</span>&nbsp;<span class="string" id="6284287">&#34;&#34;</span>&nbsp;<span class="op" id="6284290">||</span>&nbsp;<span class="op" id="6284293">!</span><span class="ident" id="6284294">isName</span><span class="op" id="6284300">(</span><span class="op" id="6284301">[</span><span class="op" id="6284302">]</span><span class="builtintype" id="6284303">byte</span><span class="op" id="6284307">(</span><span class="ident" id="6284308">prefix</span><span class="op" id="6284314">)</span><span class="op" id="6284315">)</span>&nbsp;<span class="op" id="6284317">||</span>&nbsp;<span class="ident" id="6284320">strings</span><span class="op" id="6284327">.</span><span class="ident" id="6284328">Contains</span><span class="op" id="6284336">(</span><span class="ident" id="6284337">prefix</span><span class="op" id="6284343">,</span>&nbsp;<span class="string" id="6284345">&#34;:&#34;</span><span class="op" id="6284348">)</span>&nbsp;<span class="op" id="6284350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284354">prefix</span>&nbsp;<span class="op" id="6284361">=</span>&nbsp;<span class="string" id="6284363">&#34;_&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284368">}</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284371">if</span>&nbsp;<span class="ident" id="6284374">strings</span><span class="op" id="6284381">.</span><span class="ident" id="6284382">HasPrefix</span><span class="op" id="6284391">(</span><span class="ident" id="6284392">prefix</span><span class="op" id="6284398">,</span>&nbsp;<span class="string" id="6284400">&#34;xml&#34;</span><span class="op" id="6284405">)</span>&nbsp;<span class="op" id="6284407">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284411">//&nbsp;xmlanything&nbsp;is&nbsp;reserved.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284441">prefix</span>&nbsp;<span class="op" id="6284448">=</span>&nbsp;<span class="string" id="6284450">&#34;_&#34;</span>&nbsp;<span class="op" id="6284454">+</span>&nbsp;<span class="ident" id="6284456">prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284464">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284467">if</span>&nbsp;<span class="ident" id="6284470">p</span><span class="op" id="6284471">.</span><span class="ident" id="6284472">attrNS</span><span class="op" id="6284478">[</span><span class="ident" id="6284479">prefix</span><span class="op" id="6284485">]</span>&nbsp;<span class="op" id="6284487">!=</span>&nbsp;<span class="string" id="6284490">&#34;&#34;</span>&nbsp;<span class="op" id="6284493">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6284497">//&nbsp;Name&nbsp;is&nbsp;taken.&nbsp;Find&nbsp;a&nbsp;better&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284536">for</span>&nbsp;<span class="ident" id="6284540">p</span><span class="op" id="6284541">.</span><span class="ident" id="6284542">seq</span><span class="op" id="6284545">++</span><span class="op" id="6284547">;</span>&nbsp;<span class="op" id="6284549">;</span>&nbsp;<span class="ident" id="6284551">p</span><span class="op" id="6284552">.</span><span class="ident" id="6284553">seq</span><span class="op" id="6284556">++</span>&nbsp;<span class="op" id="6284559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284564">if</span>&nbsp;<span class="ident" id="6284567">id</span>&nbsp;<span class="op" id="6284570">:=</span>&nbsp;<span class="ident" id="6284573">prefix</span>&nbsp;<span class="op" id="6284580">+</span>&nbsp;<span class="string" id="6284582">&#34;_&#34;</span>&nbsp;<span class="op" id="6284586">+</span>&nbsp;<span class="ident" id="6284588">strconv</span><span class="op" id="6284595">.</span><span class="ident" id="6284596">Itoa</span><span class="op" id="6284600">(</span><span class="ident" id="6284601">p</span><span class="op" id="6284602">.</span><span class="ident" id="6284603">seq</span><span class="op" id="6284606">)</span><span class="op" id="6284607">;</span>&nbsp;<span class="ident" id="6284609">p</span><span class="op" id="6284610">.</span><span class="ident" id="6284611">attrNS</span><span class="op" id="6284617">[</span><span class="ident" id="6284618">id</span><span class="op" id="6284620">]</span>&nbsp;<span class="op" id="6284622">==</span>&nbsp;<span class="string" id="6284625">&#34;&#34;</span>&nbsp;<span class="op" id="6284628">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284634">prefix</span>&nbsp;<span class="op" id="6284641">=</span>&nbsp;<span class="ident" id="6284643">id</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284650">break</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284659">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284663">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6284666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284670">p</span><span class="op" id="6284671">.</span><span class="ident" id="6284672">attrPrefix</span><span class="op" id="6284682">[</span><span class="ident" id="6284683">url</span><span class="op" id="6284686">]</span>&nbsp;<span class="op" id="6284688">=</span>&nbsp;<span class="ident" id="6284690">prefix</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284698">p</span><span class="op" id="6284699">.</span><span class="ident" id="6284700">attrNS</span><span class="op" id="6284706">[</span><span class="ident" id="6284707">prefix</span><span class="op" id="6284713">]</span>&nbsp;<span class="op" id="6284715">=</span>&nbsp;<span class="ident" id="6284717">url</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284723">p</span><span class="op" id="6284724">.</span><span class="ident" id="6284725">WriteString</span><span class="op" id="6284736">(</span><span class="string" id="6284737">`xmlns:`</span><span class="op" id="6284745">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284748">p</span><span class="op" id="6284749">.</span><span class="ident" id="6284750">WriteString</span><span class="op" id="6284761">(</span><span class="ident" id="6284762">prefix</span><span class="op" id="6284768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284771">p</span><span class="op" id="6284772">.</span><span class="ident" id="6284773">WriteString</span><span class="op" id="6284784">(</span><span class="string" id="6284785">`=&#34;`</span><span class="op" id="6284789">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284792">EscapeText</span><span class="op" id="6284802">(</span><span class="ident" id="6284803">p</span><span class="op" id="6284804">,</span>&nbsp;<span class="op" id="6284806">[</span><span class="op" id="6284807">]</span><span class="builtintype" id="6284808">byte</span><span class="op" id="6284812">(</span><span class="ident" id="6284813">url</span><span class="op" id="6284816">)</span><span class="op" id="6284817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284820">p</span><span class="op" id="6284821">.</span><span class="ident" id="6284822">WriteString</span><span class="op" id="6284833">(</span><span class="string" id="6284834">`&#34;&nbsp;`</span><span class="op" id="6284838">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6284842">p</span><span class="op" id="6284843">.</span><span class="ident" id="6284844">prefixes</span>&nbsp;<span class="op" id="6284853">=</span>&nbsp;<span class="builtinfunc" id="6284855">append</span><span class="op" id="6284861">(</span><span class="ident" id="6284862">p</span><span class="op" id="6284863">.</span><span class="ident" id="6284864">prefixes</span><span class="op" id="6284872">,</span>&nbsp;<span class="ident" id="6284874">prefix</span><span class="op" id="6284880">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6284884">return</span>&nbsp;<span class="ident" id="6284891">prefix</span><br>
<span class="lineno"></span><span class="op" id="6284898">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6284901">//&nbsp;deleteAttrPrefix&nbsp;removes&nbsp;an&nbsp;attribute&nbsp;name&nbsp;space&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6284961">func</span>&nbsp;<span class="op" id="6284966">(</span><span class="ident" id="6284967">p</span>&nbsp;<span class="op" id="6284969">*</span><span class="ident" id="6284970">printer</span><span class="op" id="6284977">)</span>&nbsp;<span class="ident" id="6284979">deleteAttrPrefix</span><span class="op" id="6284995">(</span><span class="ident" id="6284996">prefix</span>&nbsp;<span class="builtintype" id="6285003">string</span><span class="op" id="6285009">)</span>&nbsp;<span class="op" id="6285011">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6285014">delete</span><span class="op" id="6285020">(</span><span class="ident" id="6285021">p</span><span class="op" id="6285022">.</span><span class="ident" id="6285023">attrPrefix</span><span class="op" id="6285033">,</span>&nbsp;<span class="ident" id="6285035">p</span><span class="op" id="6285036">.</span><span class="ident" id="6285037">attrNS</span><span class="op" id="6285043">[</span><span class="ident" id="6285044">prefix</span><span class="op" id="6285050">]</span><span class="op" id="6285051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6285054">delete</span><span class="op" id="6285060">(</span><span class="ident" id="6285061">p</span><span class="op" id="6285062">.</span><span class="ident" id="6285063">attrNS</span><span class="op" id="6285069">,</span>&nbsp;<span class="ident" id="6285071">prefix</span><span class="op" id="6285077">)</span><br>
<span class="lineno"></span><span class="op" id="6285079">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285082">func</span>&nbsp;<span class="op" id="6285087">(</span><span class="ident" id="6285088">p</span>&nbsp;<span class="op" id="6285090">*</span><span class="ident" id="6285091">printer</span><span class="op" id="6285098">)</span>&nbsp;<span class="ident" id="6285100">markPrefix</span><span class="op" id="6285110">(</span><span class="op" id="6285111">)</span>&nbsp;<span class="op" id="6285113">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285116">p</span><span class="op" id="6285117">.</span><span class="ident" id="6285118">prefixes</span>&nbsp;<span class="op" id="6285127">=</span>&nbsp;<span class="builtinfunc" id="6285129">append</span><span class="op" id="6285135">(</span><span class="ident" id="6285136">p</span><span class="op" id="6285137">.</span><span class="ident" id="6285138">prefixes</span><span class="op" id="6285146">,</span>&nbsp;<span class="string" id="6285148">&#34;&#34;</span><span class="op" id="6285150">)</span><br>
<span class="lineno"></span><span class="op" id="6285152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285155">func</span>&nbsp;<span class="op" id="6285160">(</span><span class="ident" id="6285161">p</span>&nbsp;<span class="op" id="6285163">*</span><span class="ident" id="6285164">printer</span><span class="op" id="6285171">)</span>&nbsp;<span class="ident" id="6285173">popPrefix</span><span class="op" id="6285182">(</span><span class="op" id="6285183">)</span>&nbsp;<span class="op" id="6285185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285188">for</span>&nbsp;<span class="builtinfunc" id="6285192">len</span><span class="op" id="6285195">(</span><span class="ident" id="6285196">p</span><span class="op" id="6285197">.</span><span class="ident" id="6285198">prefixes</span><span class="op" id="6285206">)</span>&nbsp;<span class="op" id="6285208">&gt;</span>&nbsp;<span class="num" id="6285210">0</span>&nbsp;<span class="op" id="6285212">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285216">prefix</span>&nbsp;<span class="op" id="6285223">:=</span>&nbsp;<span class="ident" id="6285226">p</span><span class="op" id="6285227">.</span><span class="ident" id="6285228">prefixes</span><span class="op" id="6285236">[</span><span class="builtinfunc" id="6285237">len</span><span class="op" id="6285240">(</span><span class="ident" id="6285241">p</span><span class="op" id="6285242">.</span><span class="ident" id="6285243">prefixes</span><span class="op" id="6285251">)</span><span class="op" id="6285252">-</span><span class="num" id="6285253">1</span><span class="op" id="6285254">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285258">p</span><span class="op" id="6285259">.</span><span class="ident" id="6285260">prefixes</span>&nbsp;<span class="op" id="6285269">=</span>&nbsp;<span class="ident" id="6285271">p</span><span class="op" id="6285272">.</span><span class="ident" id="6285273">prefixes</span><span class="op" id="6285281">[</span><span class="op" id="6285282">:</span><span class="builtinfunc" id="6285283">len</span><span class="op" id="6285286">(</span><span class="ident" id="6285287">p</span><span class="op" id="6285288">.</span><span class="ident" id="6285289">prefixes</span><span class="op" id="6285297">)</span><span class="op" id="6285298">-</span><span class="num" id="6285299">1</span><span class="op" id="6285300">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285304">if</span>&nbsp;<span class="ident" id="6285307">prefix</span>&nbsp;<span class="op" id="6285314">==</span>&nbsp;<span class="string" id="6285317">&#34;&#34;</span>&nbsp;<span class="op" id="6285320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285325">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285333">}</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285337">p</span><span class="op" id="6285338">.</span><span class="ident" id="6285339">deleteAttrPrefix</span><span class="op" id="6285355">(</span><span class="ident" id="6285356">prefix</span><span class="op" id="6285362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285365">}</span><br>
<span class="lineno"></span><span class="op" id="6285367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6285370">var</span>&nbsp;<span class="op" id="6285374">(</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285377">marshalerType</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6285395">=</span>&nbsp;<span class="ident" id="6285397">reflect</span><span class="op" id="6285404">.</span><span class="ident" id="6285405">TypeOf</span><span class="op" id="6285411">(</span><span class="op" id="6285412">(</span><span class="op" id="6285413">*</span><span class="ident" id="6285414">Marshaler</span><span class="op" id="6285423">)</span><span class="op" id="6285424">(</span><span class="ident" id="6285425">nil</span><span class="op" id="6285428">)</span><span class="op" id="6285429">)</span><span class="op" id="6285430">.</span><span class="ident" id="6285431">Elem</span><span class="op" id="6285435">(</span><span class="op" id="6285436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285439">marshalerAttrType</span>&nbsp;<span class="op" id="6285457">=</span>&nbsp;<span class="ident" id="6285459">reflect</span><span class="op" id="6285466">.</span><span class="ident" id="6285467">TypeOf</span><span class="op" id="6285473">(</span><span class="op" id="6285474">(</span><span class="op" id="6285475">*</span><span class="ident" id="6285476">MarshalerAttr</span><span class="op" id="6285489">)</span><span class="op" id="6285490">(</span><span class="ident" id="6285491">nil</span><span class="op" id="6285494">)</span><span class="op" id="6285495">)</span><span class="op" id="6285496">.</span><span class="ident" id="6285497">Elem</span><span class="op" id="6285501">(</span><span class="op" id="6285502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6285505">textMarshalerType</span>&nbsp;<span class="op" id="6285523">=</span>&nbsp;<span class="ident" id="6285525">reflect</span><span class="op" id="6285532">.</span><span class="ident" id="6285533">TypeOf</span><span class="op" id="6285539">(</span><span class="op" id="6285540">(</span><span class="op" id="6285541">*</span><span class="ident" id="6285542">encoding</span><span class="op" id="6285550">.</span><span class="ident" id="6285551">TextMarshaler</span><span class="op" id="6285564">)</span><span class="op" id="6285565">(</span><span class="ident" id="6285566">nil</span><span class="op" id="6285569">)</span><span class="op" id="6285570">)</span><span class="op" id="6285571">.</span><span class="ident" id="6285572">Elem</span><span class="op" id="6285576">(</span><span class="op" id="6285577">)</span><br>
<span class="lineno"></span><span class="op" id="6285579">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="6285582">//&nbsp;marshalValue&nbsp;writes&nbsp;one&nbsp;or&nbsp;more&nbsp;XML&nbsp;elements&nbsp;representing&nbsp;val.</span><br>
<span class="lineno"></span><span class="comment" id="6285648">//&nbsp;If&nbsp;val&nbsp;was&nbsp;obtained&nbsp;from&nbsp;a&nbsp;struct&nbsp;field,&nbsp;finfo&nbsp;must&nbsp;have&nbsp;its&nbsp;details.</span><br>
<span class="lineno"></span><span class="keyword" id="6285721">func</span>&nbsp;<span class="op" id="6285726">(</span><span class="ident" id="6285727">p</span>&nbsp;<span class="op" id="6285729">*</span><span class="ident" id="6285730">printer</span><span class="op" id="6285737">)</span>&nbsp;<span class="ident" id="6285739">marshalValue</span><span class="op" id="6285751">(</span><span class="ident" id="6285752">val</span>&nbsp;<span class="ident" id="6285756">reflect</span><span class="op" id="6285763">.</span><span class="ident" id="6285764">Value</span><span class="op" id="6285769">,</span>&nbsp;<span class="ident" id="6285771">finfo</span>&nbsp;<span class="op" id="6285777">*</span><span class="ident" id="6285778">fieldInfo</span><span class="op" id="6285787">,</span>&nbsp;<span class="ident" id="6285789">startTemplate</span>&nbsp;<span class="op" id="6285803">*</span><span class="ident" id="6285804">StartElement</span><span class="op" id="6285816">)</span>&nbsp;<span class="builtintype" id="6285818">error</span>&nbsp;<span class="op" id="6285824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285827">if</span>&nbsp;<span class="ident" id="6285830">startTemplate</span>&nbsp;<span class="op" id="6285844">!=</span>&nbsp;<span class="ident" id="6285847">nil</span>&nbsp;<span class="op" id="6285851">&amp;&amp;</span>&nbsp;<span class="ident" id="6285854">startTemplate</span><span class="op" id="6285867">.</span><span class="ident" id="6285868">Name</span><span class="op" id="6285872">.</span><span class="ident" id="6285873">Local</span>&nbsp;<span class="op" id="6285879">==</span>&nbsp;<span class="string" id="6285882">&#34;&#34;</span>&nbsp;<span class="op" id="6285885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285889">return</span>&nbsp;<span class="ident" id="6285896">fmt</span><span class="op" id="6285899">.</span><span class="ident" id="6285900">Errorf</span><span class="op" id="6285906">(</span><span class="string" id="6285907">&#34;xml:&nbsp;EncodeElement&nbsp;of&nbsp;StartElement&nbsp;with&nbsp;missing&nbsp;name&#34;</span><span class="op" id="6285961">)</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6285964">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285968">if</span>&nbsp;<span class="op" id="6285971">!</span><span class="ident" id="6285972">val</span><span class="op" id="6285975">.</span><span class="ident" id="6285976">IsValid</span><span class="op" id="6285983">(</span><span class="op" id="6285984">)</span>&nbsp;<span class="op" id="6285986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6285990">return</span>&nbsp;<span class="ident" id="6285997">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286002">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286005">if</span>&nbsp;<span class="ident" id="6286008">finfo</span>&nbsp;<span class="op" id="6286014">!=</span>&nbsp;<span class="ident" id="6286017">nil</span>&nbsp;<span class="op" id="6286021">&amp;&amp;</span>&nbsp;<span class="ident" id="6286024">finfo</span><span class="op" id="6286029">.</span><span class="ident" id="6286030">flags</span><span class="op" id="6286035">&amp;</span><span class="ident" id="6286036">fOmitEmpty</span>&nbsp;<span class="op" id="6286047">!=</span>&nbsp;<span class="num" id="6286050">0</span>&nbsp;<span class="op" id="6286052">&amp;&amp;</span>&nbsp;<span class="ident" id="6286055">isEmptyValue</span><span class="op" id="6286067">(</span><span class="ident" id="6286068">val</span><span class="op" id="6286071">)</span>&nbsp;<span class="op" id="6286073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286077">return</span>&nbsp;<span class="ident" id="6286084">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286093">//&nbsp;Drill&nbsp;into&nbsp;interfaces&nbsp;and&nbsp;pointers.</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286133">//&nbsp;This&nbsp;can&nbsp;turn&nbsp;into&nbsp;an&nbsp;infinite&nbsp;loop&nbsp;given&nbsp;a&nbsp;cyclic&nbsp;chain,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286195">//&nbsp;but&nbsp;it&nbsp;matches&nbsp;the&nbsp;Go&nbsp;1&nbsp;behavior.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286233">for</span>&nbsp;<span class="ident" id="6286237">val</span><span class="op" id="6286240">.</span><span class="ident" id="6286241">Kind</span><span class="op" id="6286245">(</span><span class="op" id="6286246">)</span>&nbsp;<span class="op" id="6286248">==</span>&nbsp;<span class="ident" id="6286251">reflect</span><span class="op" id="6286258">.</span><span class="ident" id="6286259">Interface</span>&nbsp;<span class="op" id="6286269">||</span>&nbsp;<span class="ident" id="6286272">val</span><span class="op" id="6286275">.</span><span class="ident" id="6286276">Kind</span><span class="op" id="6286280">(</span><span class="op" id="6286281">)</span>&nbsp;<span class="op" id="6286283">==</span>&nbsp;<span class="ident" id="6286286">reflect</span><span class="op" id="6286293">.</span><span class="ident" id="6286294">Ptr</span>&nbsp;<span class="op" id="6286298">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286302">if</span>&nbsp;<span class="ident" id="6286305">val</span><span class="op" id="6286308">.</span><span class="ident" id="6286309">IsNil</span><span class="op" id="6286314">(</span><span class="op" id="6286315">)</span>&nbsp;<span class="op" id="6286317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286322">return</span>&nbsp;<span class="ident" id="6286329">nil</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286335">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286339">val</span>&nbsp;<span class="op" id="6286343">=</span>&nbsp;<span class="ident" id="6286345">val</span><span class="op" id="6286348">.</span><span class="ident" id="6286349">Elem</span><span class="op" id="6286353">(</span><span class="op" id="6286354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286357">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286361">kind</span>&nbsp;<span class="op" id="6286366">:=</span>&nbsp;<span class="ident" id="6286369">val</span><span class="op" id="6286372">.</span><span class="ident" id="6286373">Kind</span><span class="op" id="6286377">(</span><span class="op" id="6286378">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286381">typ</span>&nbsp;<span class="op" id="6286385">:=</span>&nbsp;<span class="ident" id="6286388">val</span><span class="op" id="6286391">.</span><span class="ident" id="6286392">Type</span><span class="op" id="6286396">(</span><span class="op" id="6286397">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286401">//&nbsp;Check&nbsp;for&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286426">if</span>&nbsp;<span class="ident" id="6286429">val</span><span class="op" id="6286432">.</span><span class="ident" id="6286433">CanInterface</span><span class="op" id="6286445">(</span><span class="op" id="6286446">)</span>&nbsp;<span class="op" id="6286448">&amp;&amp;</span>&nbsp;<span class="ident" id="6286451">typ</span><span class="op" id="6286454">.</span><span class="ident" id="6286455">Implements</span><span class="op" id="6286465">(</span><span class="ident" id="6286466">marshalerType</span><span class="op" id="6286479">)</span>&nbsp;<span class="op" id="6286481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286485">return</span>&nbsp;<span class="ident" id="6286492">p</span><span class="op" id="6286493">.</span><span class="ident" id="6286494">marshalInterface</span><span class="op" id="6286510">(</span><span class="ident" id="6286511">val</span><span class="op" id="6286514">.</span><span class="ident" id="6286515">Interface</span><span class="op" id="6286524">(</span><span class="op" id="6286525">)</span><span class="op" id="6286526">.</span><span class="op" id="6286527">(</span><span class="ident" id="6286528">Marshaler</span><span class="op" id="6286537">)</span><span class="op" id="6286538">,</span>&nbsp;<span class="ident" id="6286540">defaultStart</span><span class="op" id="6286552">(</span><span class="ident" id="6286553">typ</span><span class="op" id="6286556">,</span>&nbsp;<span class="ident" id="6286558">finfo</span><span class="op" id="6286563">,</span>&nbsp;<span class="ident" id="6286565">startTemplate</span><span class="op" id="6286578">)</span><span class="op" id="6286579">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286585">if</span>&nbsp;<span class="ident" id="6286588">val</span><span class="op" id="6286591">.</span><span class="ident" id="6286592">CanAddr</span><span class="op" id="6286599">(</span><span class="op" id="6286600">)</span>&nbsp;<span class="op" id="6286602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6286606">pv</span>&nbsp;<span class="op" id="6286609">:=</span>&nbsp;<span class="ident" id="6286612">val</span><span class="op" id="6286615">.</span><span class="ident" id="6286616">Addr</span><span class="op" id="6286620">(</span><span class="op" id="6286621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286625">if</span>&nbsp;<span class="ident" id="6286628">pv</span><span class="op" id="6286630">.</span><span class="ident" id="6286631">CanInterface</span><span class="op" id="6286643">(</span><span class="op" id="6286644">)</span>&nbsp;<span class="op" id="6286646">&amp;&amp;</span>&nbsp;<span class="ident" id="6286649">pv</span><span class="op" id="6286651">.</span><span class="ident" id="6286652">Type</span><span class="op" id="6286656">(</span><span class="op" id="6286657">)</span><span class="op" id="6286658">.</span><span class="ident" id="6286659">Implements</span><span class="op" id="6286669">(</span><span class="ident" id="6286670">marshalerType</span><span class="op" id="6286683">)</span>&nbsp;<span class="op" id="6286685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286690">return</span>&nbsp;<span class="ident" id="6286697">p</span><span class="op" id="6286698">.</span><span class="ident" id="6286699">marshalInterface</span><span class="op" id="6286715">(</span><span class="ident" id="6286716">pv</span><span class="op" id="6286718">.</span><span class="ident" id="6286719">Interface</span><span class="op" id="6286728">(</span><span class="op" id="6286729">)</span><span class="op" id="6286730">.</span><span class="op" id="6286731">(</span><span class="ident" id="6286732">Marshaler</span><span class="op" id="6286741">)</span><span class="op" id="6286742">,</span>&nbsp;<span class="ident" id="6286744">defaultStart</span><span class="op" id="6286756">(</span><span class="ident" id="6286757">pv</span><span class="op" id="6286759">.</span><span class="ident" id="6286760">Type</span><span class="op" id="6286764">(</span><span class="op" id="6286765">)</span><span class="op" id="6286766">,</span>&nbsp;<span class="ident" id="6286768">finfo</span><span class="op" id="6286773">,</span>&nbsp;<span class="ident" id="6286775">startTemplate</span><span class="op" id="6286788">)</span><span class="op" id="6286789">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286793">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6286796">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6286800">//&nbsp;Check&nbsp;for&nbsp;text&nbsp;marshaler.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286830">if</span>&nbsp;<span class="ident" id="6286833">val</span><span class="op" id="6286836">.</span><span class="ident" id="6286837">CanInterface</span><span class="op" id="6286849">(</span><span class="op" id="6286850">)</span>&nbsp;<span class="op" id="6286852">&amp;&amp;</span>&nbsp;<span class="ident" id="6286855">typ</span><span class="op" id="6286858">.</span><span class="ident" id="6286859">Implements</span><span class="op" id="6286869">(</span><span class="ident" id="6286870">textMarshalerType</span><span class="op" id="6286887">)</span>&nbsp;<span class="op" id="6286889">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6286893">return</span>&nbsp;<span class="ident" id="6286900">p</span><span class="op" id="6286901">.</span><span class="ident" id="6286902">marshalTextInterface</span><span class="op" id="6286922">(</span><span class="ident" id="6286923">val</span><span class="op" id="6286926">.</span><span class="ident" id="6286927">Interface</span><span class="op" id="6286936">(</span><span class="op" id="6286937">)</span><span class="op" id="6286938">.</span><span class="op" id="6286939">(</span><span class="ident" id="6286940">encoding</span><span class="op" id="6286948">.</span><span class="ident" id="6286949">TextMarshaler</span><span class="op" id="6286962">)</span><span class="op" id="6286963">,</span>&nbsp;<span class="ident" id="6286965">defaultStart</span><span class="op" id="6286977">(</span><span class="ident" id="6286978">typ</span><span class="op" id="6286981">,</span>&nbsp;<span class="ident" id="6286983">finfo</span><span class="op" id="6286988">,</span>&nbsp;<span class="ident" id="6286990">startTemplate</span><span class="op" id="6287003">)</span><span class="op" id="6287004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287010">if</span>&nbsp;<span class="ident" id="6287013">val</span><span class="op" id="6287016">.</span><span class="ident" id="6287017">CanAddr</span><span class="op" id="6287024">(</span><span class="op" id="6287025">)</span>&nbsp;<span class="op" id="6287027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287031">pv</span>&nbsp;<span class="op" id="6287034">:=</span>&nbsp;<span class="ident" id="6287037">val</span><span class="op" id="6287040">.</span><span class="ident" id="6287041">Addr</span><span class="op" id="6287045">(</span><span class="op" id="6287046">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287050">if</span>&nbsp;<span class="ident" id="6287053">pv</span><span class="op" id="6287055">.</span><span class="ident" id="6287056">CanInterface</span><span class="op" id="6287068">(</span><span class="op" id="6287069">)</span>&nbsp;<span class="op" id="6287071">&amp;&amp;</span>&nbsp;<span class="ident" id="6287074">pv</span><span class="op" id="6287076">.</span><span class="ident" id="6287077">Type</span><span class="op" id="6287081">(</span><span class="op" id="6287082">)</span><span class="op" id="6287083">.</span><span class="ident" id="6287084">Implements</span><span class="op" id="6287094">(</span><span class="ident" id="6287095">textMarshalerType</span><span class="op" id="6287112">)</span>&nbsp;<span class="op" id="6287114">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287119">return</span>&nbsp;<span class="ident" id="6287126">p</span><span class="op" id="6287127">.</span><span class="ident" id="6287128">marshalTextInterface</span><span class="op" id="6287148">(</span><span class="ident" id="6287149">pv</span><span class="op" id="6287151">.</span><span class="ident" id="6287152">Interface</span><span class="op" id="6287161">(</span><span class="op" id="6287162">)</span><span class="op" id="6287163">.</span><span class="op" id="6287164">(</span><span class="ident" id="6287165">encoding</span><span class="op" id="6287173">.</span><span class="ident" id="6287174">TextMarshaler</span><span class="op" id="6287187">)</span><span class="op" id="6287188">,</span>&nbsp;<span class="ident" id="6287190">defaultStart</span><span class="op" id="6287202">(</span><span class="ident" id="6287203">pv</span><span class="op" id="6287205">.</span><span class="ident" id="6287206">Type</span><span class="op" id="6287210">(</span><span class="op" id="6287211">)</span><span class="op" id="6287212">,</span>&nbsp;<span class="ident" id="6287214">finfo</span><span class="op" id="6287219">,</span>&nbsp;<span class="ident" id="6287221">startTemplate</span><span class="op" id="6287234">)</span><span class="op" id="6287235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287239">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287246">//&nbsp;Slices&nbsp;and&nbsp;arrays&nbsp;iterate&nbsp;over&nbsp;the&nbsp;elements.&nbsp;They&nbsp;do&nbsp;not&nbsp;have&nbsp;an&nbsp;enclosing&nbsp;tag.</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287330">if</span>&nbsp;<span class="op" id="6287333">(</span><span class="ident" id="6287334">kind</span>&nbsp;<span class="op" id="6287339">==</span>&nbsp;<span class="ident" id="6287342">reflect</span><span class="op" id="6287349">.</span><span class="ident" id="6287350">Slice</span>&nbsp;<span class="op" id="6287356">||</span>&nbsp;<span class="ident" id="6287359">kind</span>&nbsp;<span class="op" id="6287364">==</span>&nbsp;<span class="ident" id="6287367">reflect</span><span class="op" id="6287374">.</span><span class="ident" id="6287375">Array</span><span class="op" id="6287380">)</span>&nbsp;<span class="op" id="6287382">&amp;&amp;</span>&nbsp;<span class="ident" id="6287385">typ</span><span class="op" id="6287388">.</span><span class="ident" id="6287389">Elem</span><span class="op" id="6287393">(</span><span class="op" id="6287394">)</span><span class="op" id="6287395">.</span><span class="ident" id="6287396">Kind</span><span class="op" id="6287400">(</span><span class="op" id="6287401">)</span>&nbsp;<span class="op" id="6287403">!=</span>&nbsp;<span class="ident" id="6287406">reflect</span><span class="op" id="6287413">.</span><span class="ident" id="6287414">Uint8</span>&nbsp;<span class="op" id="6287420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287424">for</span>&nbsp;<span class="ident" id="6287428">i</span><span class="op" id="6287429">,</span>&nbsp;<span class="ident" id="6287431">n</span>&nbsp;<span class="op" id="6287433">:=</span>&nbsp;<span class="num" id="6287436">0</span><span class="op" id="6287437">,</span>&nbsp;<span class="ident" id="6287439">val</span><span class="op" id="6287442">.</span><span class="ident" id="6287443">Len</span><span class="op" id="6287446">(</span><span class="op" id="6287447">)</span><span class="op" id="6287448">;</span>&nbsp;<span class="ident" id="6287450">i</span>&nbsp;<span class="op" id="6287452">&lt;</span>&nbsp;<span class="ident" id="6287454">n</span><span class="op" id="6287455">;</span>&nbsp;<span class="ident" id="6287457">i</span><span class="op" id="6287458">++</span>&nbsp;<span class="op" id="6287461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287466">if</span>&nbsp;<span class="ident" id="6287469">err</span>&nbsp;<span class="op" id="6287473">:=</span>&nbsp;<span class="ident" id="6287476">p</span><span class="op" id="6287477">.</span><span class="ident" id="6287478">marshalValue</span><span class="op" id="6287490">(</span><span class="ident" id="6287491">val</span><span class="op" id="6287494">.</span><span class="ident" id="6287495">Index</span><span class="op" id="6287500">(</span><span class="ident" id="6287501">i</span><span class="op" id="6287502">)</span><span class="op" id="6287503">,</span>&nbsp;<span class="ident" id="6287505">finfo</span><span class="op" id="6287510">,</span>&nbsp;<span class="ident" id="6287512">startTemplate</span><span class="op" id="6287525">)</span><span class="op" id="6287526">;</span>&nbsp;<span class="ident" id="6287528">err</span>&nbsp;<span class="op" id="6287532">!=</span>&nbsp;<span class="ident" id="6287535">nil</span>&nbsp;<span class="op" id="6287539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287545">return</span>&nbsp;<span class="ident" id="6287552">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287559">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287567">return</span>&nbsp;<span class="ident" id="6287574">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287583">tinfo</span><span class="op" id="6287588">,</span>&nbsp;<span class="ident" id="6287590">err</span>&nbsp;<span class="op" id="6287594">:=</span>&nbsp;<span class="ident" id="6287597">getTypeInfo</span><span class="op" id="6287608">(</span><span class="ident" id="6287609">typ</span><span class="op" id="6287612">)</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287615">if</span>&nbsp;<span class="ident" id="6287618">err</span>&nbsp;<span class="op" id="6287622">!=</span>&nbsp;<span class="ident" id="6287625">nil</span>&nbsp;<span class="op" id="6287629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287633">return</span>&nbsp;<span class="ident" id="6287640">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287649">//&nbsp;Create&nbsp;start&nbsp;element.</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287675">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287719">//&nbsp;0.&nbsp;startTemplate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287740">//&nbsp;1.&nbsp;XMLName&nbsp;field&nbsp;in&nbsp;underlying&nbsp;struct;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287783">//&nbsp;2.&nbsp;field&nbsp;name/tag&nbsp;in&nbsp;the&nbsp;struct&nbsp;field;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6287830">//&nbsp;3.&nbsp;type&nbsp;name</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287847">var</span>&nbsp;<span class="ident" id="6287851">start</span>&nbsp;<span class="ident" id="6287857">StartElement</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6287872">if</span>&nbsp;<span class="ident" id="6287875">startTemplate</span>&nbsp;<span class="op" id="6287889">!=</span>&nbsp;<span class="ident" id="6287892">nil</span>&nbsp;<span class="op" id="6287896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287900">start</span><span class="op" id="6287905">.</span><span class="ident" id="6287906">Name</span>&nbsp;<span class="op" id="6287911">=</span>&nbsp;<span class="ident" id="6287913">startTemplate</span><span class="op" id="6287926">.</span><span class="ident" id="6287927">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6287934">start</span><span class="op" id="6287939">.</span><span class="ident" id="6287940">Attr</span>&nbsp;<span class="op" id="6287945">=</span>&nbsp;<span class="builtinfunc" id="6287947">append</span><span class="op" id="6287953">(</span><span class="ident" id="6287954">start</span><span class="op" id="6287959">.</span><span class="ident" id="6287960">Attr</span><span class="op" id="6287964">,</span>&nbsp;<span class="ident" id="6287966">startTemplate</span><span class="op" id="6287979">.</span><span class="ident" id="6287980">Attr</span><span class="op" id="6287984">...</span><span class="op" id="6287987">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6287990">}</span>&nbsp;<span class="keyword" id="6287992">else</span>&nbsp;<span class="keyword" id="6287997">if</span>&nbsp;<span class="ident" id="6288000">tinfo</span><span class="op" id="6288005">.</span><span class="ident" id="6288006">xmlname</span>&nbsp;<span class="op" id="6288014">!=</span>&nbsp;<span class="ident" id="6288017">nil</span>&nbsp;<span class="op" id="6288021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288025">xmlname</span>&nbsp;<span class="op" id="6288033">:=</span>&nbsp;<span class="ident" id="6288036">tinfo</span><span class="op" id="6288041">.</span><span class="ident" id="6288042">xmlname</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288052">if</span>&nbsp;<span class="ident" id="6288055">xmlname</span><span class="op" id="6288062">.</span><span class="ident" id="6288063">name</span>&nbsp;<span class="op" id="6288068">!=</span>&nbsp;<span class="string" id="6288071">&#34;&#34;</span>&nbsp;<span class="op" id="6288074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288079">start</span><span class="op" id="6288084">.</span><span class="ident" id="6288085">Name</span><span class="op" id="6288089">.</span><span class="ident" id="6288090">Space</span><span class="op" id="6288095">,</span>&nbsp;<span class="ident" id="6288097">start</span><span class="op" id="6288102">.</span><span class="ident" id="6288103">Name</span><span class="op" id="6288107">.</span><span class="ident" id="6288108">Local</span>&nbsp;<span class="op" id="6288114">=</span>&nbsp;<span class="ident" id="6288116">xmlname</span><span class="op" id="6288123">.</span><span class="ident" id="6288124">xmlns</span><span class="op" id="6288129">,</span>&nbsp;<span class="ident" id="6288131">xmlname</span><span class="op" id="6288138">.</span><span class="ident" id="6288139">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288146">}</span>&nbsp;<span class="keyword" id="6288148">else</span>&nbsp;<span class="keyword" id="6288153">if</span>&nbsp;<span class="ident" id="6288156">v</span><span class="op" id="6288157">,</span>&nbsp;<span class="ident" id="6288159">ok</span>&nbsp;<span class="op" id="6288162">:=</span>&nbsp;<span class="ident" id="6288165">xmlname</span><span class="op" id="6288172">.</span><span class="ident" id="6288173">value</span><span class="op" id="6288178">(</span><span class="ident" id="6288179">val</span><span class="op" id="6288182">)</span><span class="op" id="6288183">.</span><span class="ident" id="6288184">Interface</span><span class="op" id="6288193">(</span><span class="op" id="6288194">)</span><span class="op" id="6288195">.</span><span class="op" id="6288196">(</span><span class="ident" id="6288197">Name</span><span class="op" id="6288201">)</span><span class="op" id="6288202">;</span>&nbsp;<span class="ident" id="6288204">ok</span>&nbsp;<span class="op" id="6288207">&amp;&amp;</span>&nbsp;<span class="ident" id="6288210">v</span><span class="op" id="6288211">.</span><span class="ident" id="6288212">Local</span>&nbsp;<span class="op" id="6288218">!=</span>&nbsp;<span class="string" id="6288221">&#34;&#34;</span>&nbsp;<span class="op" id="6288224">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288229">start</span><span class="op" id="6288234">.</span><span class="ident" id="6288235">Name</span>&nbsp;<span class="op" id="6288240">=</span>&nbsp;<span class="ident" id="6288242">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288246">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288252">if</span>&nbsp;<span class="ident" id="6288255">start</span><span class="op" id="6288260">.</span><span class="ident" id="6288261">Name</span><span class="op" id="6288265">.</span><span class="ident" id="6288266">Local</span>&nbsp;<span class="op" id="6288272">==</span>&nbsp;<span class="string" id="6288275">&#34;&#34;</span>&nbsp;<span class="op" id="6288278">&amp;&amp;</span>&nbsp;<span class="ident" id="6288281">finfo</span>&nbsp;<span class="op" id="6288287">!=</span>&nbsp;<span class="ident" id="6288290">nil</span>&nbsp;<span class="op" id="6288294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288298">start</span><span class="op" id="6288303">.</span><span class="ident" id="6288304">Name</span><span class="op" id="6288308">.</span><span class="ident" id="6288309">Space</span><span class="op" id="6288314">,</span>&nbsp;<span class="ident" id="6288316">start</span><span class="op" id="6288321">.</span><span class="ident" id="6288322">Name</span><span class="op" id="6288326">.</span><span class="ident" id="6288327">Local</span>&nbsp;<span class="op" id="6288333">=</span>&nbsp;<span class="ident" id="6288335">finfo</span><span class="op" id="6288340">.</span><span class="ident" id="6288341">xmlns</span><span class="op" id="6288346">,</span>&nbsp;<span class="ident" id="6288348">finfo</span><span class="op" id="6288353">.</span><span class="ident" id="6288354">name</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288363">if</span>&nbsp;<span class="ident" id="6288366">start</span><span class="op" id="6288371">.</span><span class="ident" id="6288372">Name</span><span class="op" id="6288376">.</span><span class="ident" id="6288377">Local</span>&nbsp;<span class="op" id="6288383">==</span>&nbsp;<span class="string" id="6288386">&#34;&#34;</span>&nbsp;<span class="op" id="6288389">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288393">name</span>&nbsp;<span class="op" id="6288398">:=</span>&nbsp;<span class="ident" id="6288401">typ</span><span class="op" id="6288404">.</span><span class="ident" id="6288405">Name</span><span class="op" id="6288409">(</span><span class="op" id="6288410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288414">if</span>&nbsp;<span class="ident" id="6288417">name</span>&nbsp;<span class="op" id="6288422">==</span>&nbsp;<span class="string" id="6288425">&#34;&#34;</span>&nbsp;<span class="op" id="6288428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288433">return</span>&nbsp;<span class="op" id="6288440">&amp;</span><span class="ident" id="6288441">UnsupportedTypeError</span><span class="op" id="6288461">{</span><span class="ident" id="6288462">typ</span><span class="op" id="6288465">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288473">start</span><span class="op" id="6288478">.</span><span class="ident" id="6288479">Name</span><span class="op" id="6288483">.</span><span class="ident" id="6288484">Local</span>&nbsp;<span class="op" id="6288490">=</span>&nbsp;<span class="ident" id="6288492">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6288502">//&nbsp;Attributes</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288517">for</span>&nbsp;<span class="ident" id="6288521">i</span>&nbsp;<span class="op" id="6288523">:=</span>&nbsp;<span class="keyword" id="6288526">range</span>&nbsp;<span class="ident" id="6288532">tinfo</span><span class="op" id="6288537">.</span><span class="ident" id="6288538">fields</span>&nbsp;<span class="op" id="6288545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288549">finfo</span>&nbsp;<span class="op" id="6288555">:=</span>&nbsp;<span class="op" id="6288558">&amp;</span><span class="ident" id="6288559">tinfo</span><span class="op" id="6288564">.</span><span class="ident" id="6288565">fields</span><span class="op" id="6288571">[</span><span class="ident" id="6288572">i</span><span class="op" id="6288573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288577">if</span>&nbsp;<span class="ident" id="6288580">finfo</span><span class="op" id="6288585">.</span><span class="ident" id="6288586">flags</span><span class="op" id="6288591">&amp;</span><span class="ident" id="6288592">fAttr</span>&nbsp;<span class="op" id="6288598">==</span>&nbsp;<span class="num" id="6288601">0</span>&nbsp;<span class="op" id="6288603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288608">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288619">}</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288623">fv</span>&nbsp;<span class="op" id="6288626">:=</span>&nbsp;<span class="ident" id="6288629">finfo</span><span class="op" id="6288634">.</span><span class="ident" id="6288635">value</span><span class="op" id="6288640">(</span><span class="ident" id="6288641">val</span><span class="op" id="6288644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288648">name</span>&nbsp;<span class="op" id="6288653">:=</span>&nbsp;<span class="ident" id="6288656">Name</span><span class="op" id="6288660">{</span><span class="ident" id="6288661">Space</span><span class="op" id="6288666">:</span>&nbsp;<span class="ident" id="6288668">finfo</span><span class="op" id="6288673">.</span><span class="ident" id="6288674">xmlns</span><span class="op" id="6288679">,</span>&nbsp;<span class="ident" id="6288681">Local</span><span class="op" id="6288686">:</span>&nbsp;<span class="ident" id="6288688">finfo</span><span class="op" id="6288693">.</span><span class="ident" id="6288694">name</span><span class="op" id="6288698">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288703">if</span>&nbsp;<span class="ident" id="6288706">finfo</span><span class="op" id="6288711">.</span><span class="ident" id="6288712">flags</span><span class="op" id="6288717">&amp;</span><span class="ident" id="6288718">fOmitEmpty</span>&nbsp;<span class="op" id="6288729">!=</span>&nbsp;<span class="num" id="6288732">0</span>&nbsp;<span class="op" id="6288734">&amp;&amp;</span>&nbsp;<span class="ident" id="6288737">isEmptyValue</span><span class="op" id="6288749">(</span><span class="ident" id="6288750">fv</span><span class="op" id="6288752">)</span>&nbsp;<span class="op" id="6288754">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288759">continue</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288775">if</span>&nbsp;<span class="ident" id="6288778">fv</span><span class="op" id="6288780">.</span><span class="ident" id="6288781">Kind</span><span class="op" id="6288785">(</span><span class="op" id="6288786">)</span>&nbsp;<span class="op" id="6288788">==</span>&nbsp;<span class="ident" id="6288791">reflect</span><span class="op" id="6288798">.</span><span class="ident" id="6288799">Interface</span>&nbsp;<span class="op" id="6288809">&amp;&amp;</span>&nbsp;<span class="ident" id="6288812">fv</span><span class="op" id="6288814">.</span><span class="ident" id="6288815">IsNil</span><span class="op" id="6288820">(</span><span class="op" id="6288821">)</span>&nbsp;<span class="op" id="6288823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288828">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6288839">}</span><br>
<span class="lineno">460</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288844">if</span>&nbsp;<span class="ident" id="6288847">fv</span><span class="op" id="6288849">.</span><span class="ident" id="6288850">CanInterface</span><span class="op" id="6288862">(</span><span class="op" id="6288863">)</span>&nbsp;<span class="op" id="6288865">&amp;&amp;</span>&nbsp;<span class="ident" id="6288868">fv</span><span class="op" id="6288870">.</span><span class="ident" id="6288871">Type</span><span class="op" id="6288875">(</span><span class="op" id="6288876">)</span><span class="op" id="6288877">.</span><span class="ident" id="6288878">Implements</span><span class="op" id="6288888">(</span><span class="ident" id="6288889">marshalerAttrType</span><span class="op" id="6288906">)</span>&nbsp;<span class="op" id="6288908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6288913">attr</span><span class="op" id="6288917">,</span>&nbsp;<span class="ident" id="6288919">err</span>&nbsp;<span class="op" id="6288923">:=</span>&nbsp;<span class="ident" id="6288926">fv</span><span class="op" id="6288928">.</span><span class="ident" id="6288929">Interface</span><span class="op" id="6288938">(</span><span class="op" id="6288939">)</span><span class="op" id="6288940">.</span><span class="op" id="6288941">(</span><span class="ident" id="6288942">MarshalerAttr</span><span class="op" id="6288955">)</span><span class="op" id="6288956">.</span><span class="ident" id="6288957">MarshalXMLAttr</span><span class="op" id="6288971">(</span><span class="ident" id="6288972">name</span><span class="op" id="6288976">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6288981">if</span>&nbsp;<span class="ident" id="6288984">err</span>&nbsp;<span class="op" id="6288988">!=</span>&nbsp;<span class="ident" id="6288991">nil</span>&nbsp;<span class="op" id="6288995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289001">return</span>&nbsp;<span class="ident" id="6289008">err</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289020">if</span>&nbsp;<span class="ident" id="6289023">attr</span><span class="op" id="6289027">.</span><span class="ident" id="6289028">Name</span><span class="op" id="6289032">.</span><span class="ident" id="6289033">Local</span>&nbsp;<span class="op" id="6289039">!=</span>&nbsp;<span class="string" id="6289042">&#34;&#34;</span>&nbsp;<span class="op" id="6289045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289051">start</span><span class="op" id="6289056">.</span><span class="ident" id="6289057">Attr</span>&nbsp;<span class="op" id="6289062">=</span>&nbsp;<span class="builtinfunc" id="6289064">append</span><span class="op" id="6289070">(</span><span class="ident" id="6289071">start</span><span class="op" id="6289076">.</span><span class="ident" id="6289077">Attr</span><span class="op" id="6289081">,</span>&nbsp;<span class="ident" id="6289083">attr</span><span class="op" id="6289087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289092">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289097">continue</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289108">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289113">if</span>&nbsp;<span class="ident" id="6289116">fv</span><span class="op" id="6289118">.</span><span class="ident" id="6289119">CanAddr</span><span class="op" id="6289126">(</span><span class="op" id="6289127">)</span>&nbsp;<span class="op" id="6289129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289134">pv</span>&nbsp;<span class="op" id="6289137">:=</span>&nbsp;<span class="ident" id="6289140">fv</span><span class="op" id="6289142">.</span><span class="ident" id="6289143">Addr</span><span class="op" id="6289147">(</span><span class="op" id="6289148">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289153">if</span>&nbsp;<span class="ident" id="6289156">pv</span><span class="op" id="6289158">.</span><span class="ident" id="6289159">CanInterface</span><span class="op" id="6289171">(</span><span class="op" id="6289172">)</span>&nbsp;<span class="op" id="6289174">&amp;&amp;</span>&nbsp;<span class="ident" id="6289177">pv</span><span class="op" id="6289179">.</span><span class="ident" id="6289180">Type</span><span class="op" id="6289184">(</span><span class="op" id="6289185">)</span><span class="op" id="6289186">.</span><span class="ident" id="6289187">Implements</span><span class="op" id="6289197">(</span><span class="ident" id="6289198">marshalerAttrType</span><span class="op" id="6289215">)</span>&nbsp;<span class="op" id="6289217">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289223">attr</span><span class="op" id="6289227">,</span>&nbsp;<span class="ident" id="6289229">err</span>&nbsp;<span class="op" id="6289233">:=</span>&nbsp;<span class="ident" id="6289236">pv</span><span class="op" id="6289238">.</span><span class="ident" id="6289239">Interface</span><span class="op" id="6289248">(</span><span class="op" id="6289249">)</span><span class="op" id="6289250">.</span><span class="op" id="6289251">(</span><span class="ident" id="6289252">MarshalerAttr</span><span class="op" id="6289265">)</span><span class="op" id="6289266">.</span><span class="ident" id="6289267">MarshalXMLAttr</span><span class="op" id="6289281">(</span><span class="ident" id="6289282">name</span><span class="op" id="6289286">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289292">if</span>&nbsp;<span class="ident" id="6289295">err</span>&nbsp;<span class="op" id="6289299">!=</span>&nbsp;<span class="ident" id="6289302">nil</span>&nbsp;<span class="op" id="6289306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289313">return</span>&nbsp;<span class="ident" id="6289320">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289334">if</span>&nbsp;<span class="ident" id="6289337">attr</span><span class="op" id="6289341">.</span><span class="ident" id="6289342">Name</span><span class="op" id="6289346">.</span><span class="ident" id="6289347">Local</span>&nbsp;<span class="op" id="6289353">!=</span>&nbsp;<span class="string" id="6289356">&#34;&#34;</span>&nbsp;<span class="op" id="6289359">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289366">start</span><span class="op" id="6289371">.</span><span class="ident" id="6289372">Attr</span>&nbsp;<span class="op" id="6289377">=</span>&nbsp;<span class="builtinfunc" id="6289379">append</span><span class="op" id="6289385">(</span><span class="ident" id="6289386">start</span><span class="op" id="6289391">.</span><span class="ident" id="6289392">Attr</span><span class="op" id="6289396">,</span>&nbsp;<span class="ident" id="6289398">attr</span><span class="op" id="6289402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289408">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289414">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289430">}</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289435">if</span>&nbsp;<span class="ident" id="6289438">fv</span><span class="op" id="6289440">.</span><span class="ident" id="6289441">CanInterface</span><span class="op" id="6289453">(</span><span class="op" id="6289454">)</span>&nbsp;<span class="op" id="6289456">&amp;&amp;</span>&nbsp;<span class="ident" id="6289459">fv</span><span class="op" id="6289461">.</span><span class="ident" id="6289462">Type</span><span class="op" id="6289466">(</span><span class="op" id="6289467">)</span><span class="op" id="6289468">.</span><span class="ident" id="6289469">Implements</span><span class="op" id="6289479">(</span><span class="ident" id="6289480">textMarshalerType</span><span class="op" id="6289497">)</span>&nbsp;<span class="op" id="6289499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289504">text</span><span class="op" id="6289508">,</span>&nbsp;<span class="ident" id="6289510">err</span>&nbsp;<span class="op" id="6289514">:=</span>&nbsp;<span class="ident" id="6289517">fv</span><span class="op" id="6289519">.</span><span class="ident" id="6289520">Interface</span><span class="op" id="6289529">(</span><span class="op" id="6289530">)</span><span class="op" id="6289531">.</span><span class="op" id="6289532">(</span><span class="ident" id="6289533">encoding</span><span class="op" id="6289541">.</span><span class="ident" id="6289542">TextMarshaler</span><span class="op" id="6289555">)</span><span class="op" id="6289556">.</span><span class="ident" id="6289557">MarshalText</span><span class="op" id="6289568">(</span><span class="op" id="6289569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289574">if</span>&nbsp;<span class="ident" id="6289577">err</span>&nbsp;<span class="op" id="6289581">!=</span>&nbsp;<span class="ident" id="6289584">nil</span>&nbsp;<span class="op" id="6289588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289594">return</span>&nbsp;<span class="ident" id="6289601">err</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289613">start</span><span class="op" id="6289618">.</span><span class="ident" id="6289619">Attr</span>&nbsp;<span class="op" id="6289624">=</span>&nbsp;<span class="builtinfunc" id="6289626">append</span><span class="op" id="6289632">(</span><span class="ident" id="6289633">start</span><span class="op" id="6289638">.</span><span class="ident" id="6289639">Attr</span><span class="op" id="6289643">,</span>&nbsp;<span class="ident" id="6289645">Attr</span><span class="op" id="6289649">{</span><span class="ident" id="6289650">name</span><span class="op" id="6289654">,</span>&nbsp;<span class="builtintype" id="6289656">string</span><span class="op" id="6289662">(</span><span class="ident" id="6289663">text</span><span class="op" id="6289667">)</span><span class="op" id="6289668">}</span><span class="op" id="6289669">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289674">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289690">if</span>&nbsp;<span class="ident" id="6289693">fv</span><span class="op" id="6289695">.</span><span class="ident" id="6289696">CanAddr</span><span class="op" id="6289703">(</span><span class="op" id="6289704">)</span>&nbsp;<span class="op" id="6289706">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289711">pv</span>&nbsp;<span class="op" id="6289714">:=</span>&nbsp;<span class="ident" id="6289717">fv</span><span class="op" id="6289719">.</span><span class="ident" id="6289720">Addr</span><span class="op" id="6289724">(</span><span class="op" id="6289725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289730">if</span>&nbsp;<span class="ident" id="6289733">pv</span><span class="op" id="6289735">.</span><span class="ident" id="6289736">CanInterface</span><span class="op" id="6289748">(</span><span class="op" id="6289749">)</span>&nbsp;<span class="op" id="6289751">&amp;&amp;</span>&nbsp;<span class="ident" id="6289754">pv</span><span class="op" id="6289756">.</span><span class="ident" id="6289757">Type</span><span class="op" id="6289761">(</span><span class="op" id="6289762">)</span><span class="op" id="6289763">.</span><span class="ident" id="6289764">Implements</span><span class="op" id="6289774">(</span><span class="ident" id="6289775">textMarshalerType</span><span class="op" id="6289792">)</span>&nbsp;<span class="op" id="6289794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289800">text</span><span class="op" id="6289804">,</span>&nbsp;<span class="ident" id="6289806">err</span>&nbsp;<span class="op" id="6289810">:=</span>&nbsp;<span class="ident" id="6289813">pv</span><span class="op" id="6289815">.</span><span class="ident" id="6289816">Interface</span><span class="op" id="6289825">(</span><span class="op" id="6289826">)</span><span class="op" id="6289827">.</span><span class="op" id="6289828">(</span><span class="ident" id="6289829">encoding</span><span class="op" id="6289837">.</span><span class="ident" id="6289838">TextMarshaler</span><span class="op" id="6289851">)</span><span class="op" id="6289852">.</span><span class="ident" id="6289853">MarshalText</span><span class="op" id="6289864">(</span><span class="op" id="6289865">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289871">if</span>&nbsp;<span class="ident" id="6289874">err</span>&nbsp;<span class="op" id="6289878">!=</span>&nbsp;<span class="ident" id="6289881">nil</span>&nbsp;<span class="op" id="6289885">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289892">return</span>&nbsp;<span class="ident" id="6289899">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289907">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6289913">start</span><span class="op" id="6289918">.</span><span class="ident" id="6289919">Attr</span>&nbsp;<span class="op" id="6289924">=</span>&nbsp;<span class="builtinfunc" id="6289926">append</span><span class="op" id="6289932">(</span><span class="ident" id="6289933">start</span><span class="op" id="6289938">.</span><span class="ident" id="6289939">Attr</span><span class="op" id="6289943">,</span>&nbsp;<span class="ident" id="6289945">Attr</span><span class="op" id="6289949">{</span><span class="ident" id="6289950">name</span><span class="op" id="6289954">,</span>&nbsp;<span class="builtintype" id="6289956">string</span><span class="op" id="6289962">(</span><span class="ident" id="6289963">text</span><span class="op" id="6289967">)</span><span class="op" id="6289968">}</span><span class="op" id="6289969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6289975">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289987">}</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6289991">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6289996">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290052">switch</span>&nbsp;<span class="ident" id="6290059">fv</span><span class="op" id="6290061">.</span><span class="ident" id="6290062">Kind</span><span class="op" id="6290066">(</span><span class="op" id="6290067">)</span>&nbsp;<span class="op" id="6290069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290073">case</span>&nbsp;<span class="ident" id="6290078">reflect</span><span class="op" id="6290085">.</span><span class="ident" id="6290086">Ptr</span><span class="op" id="6290089">,</span>&nbsp;<span class="ident" id="6290091">reflect</span><span class="op" id="6290098">.</span><span class="ident" id="6290099">Interface</span><span class="op" id="6290108">:</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290113">if</span>&nbsp;<span class="ident" id="6290116">fv</span><span class="op" id="6290118">.</span><span class="ident" id="6290119">IsNil</span><span class="op" id="6290124">(</span><span class="op" id="6290125">)</span>&nbsp;<span class="op" id="6290127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290133">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290150">fv</span>&nbsp;<span class="op" id="6290153">=</span>&nbsp;<span class="ident" id="6290155">fv</span><span class="op" id="6290157">.</span><span class="ident" id="6290158">Elem</span><span class="op" id="6290162">(</span><span class="op" id="6290163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290167">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290172">s</span><span class="op" id="6290173">,</span>&nbsp;<span class="ident" id="6290175">b</span><span class="op" id="6290176">,</span>&nbsp;<span class="ident" id="6290178">err</span>&nbsp;<span class="op" id="6290182">:=</span>&nbsp;<span class="ident" id="6290185">p</span><span class="op" id="6290186">.</span><span class="ident" id="6290187">marshalSimple</span><span class="op" id="6290200">(</span><span class="ident" id="6290201">fv</span><span class="op" id="6290203">.</span><span class="ident" id="6290204">Type</span><span class="op" id="6290208">(</span><span class="op" id="6290209">)</span><span class="op" id="6290210">,</span>&nbsp;<span class="ident" id="6290212">fv</span><span class="op" id="6290214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290218">if</span>&nbsp;<span class="ident" id="6290221">err</span>&nbsp;<span class="op" id="6290225">!=</span>&nbsp;<span class="ident" id="6290228">nil</span>&nbsp;<span class="op" id="6290232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290237">return</span>&nbsp;<span class="ident" id="6290244">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290250">}</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290254">if</span>&nbsp;<span class="ident" id="6290257">b</span>&nbsp;<span class="op" id="6290259">!=</span>&nbsp;<span class="ident" id="6290262">nil</span>&nbsp;<span class="op" id="6290266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290271">s</span>&nbsp;<span class="op" id="6290273">=</span>&nbsp;<span class="builtintype" id="6290275">string</span><span class="op" id="6290281">(</span><span class="ident" id="6290282">b</span><span class="op" id="6290283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290291">start</span><span class="op" id="6290296">.</span><span class="ident" id="6290297">Attr</span>&nbsp;<span class="op" id="6290302">=</span>&nbsp;<span class="builtinfunc" id="6290304">append</span><span class="op" id="6290310">(</span><span class="ident" id="6290311">start</span><span class="op" id="6290316">.</span><span class="ident" id="6290317">Attr</span><span class="op" id="6290321">,</span>&nbsp;<span class="ident" id="6290323">Attr</span><span class="op" id="6290327">{</span><span class="ident" id="6290328">name</span><span class="op" id="6290332">,</span>&nbsp;<span class="ident" id="6290334">s</span><span class="op" id="6290335">}</span><span class="op" id="6290336">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290339">}</span><br>
<span class="lineno">525</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290343">if</span>&nbsp;<span class="ident" id="6290346">err</span>&nbsp;<span class="op" id="6290350">:=</span>&nbsp;<span class="ident" id="6290353">p</span><span class="op" id="6290354">.</span><span class="ident" id="6290355">writeStart</span><span class="op" id="6290365">(</span><span class="op" id="6290366">&amp;</span><span class="ident" id="6290367">start</span><span class="op" id="6290372">)</span><span class="op" id="6290373">;</span>&nbsp;<span class="ident" id="6290375">err</span>&nbsp;<span class="op" id="6290379">!=</span>&nbsp;<span class="ident" id="6290382">nil</span>&nbsp;<span class="op" id="6290386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290390">return</span>&nbsp;<span class="ident" id="6290397">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290402">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290406">if</span>&nbsp;<span class="ident" id="6290409">val</span><span class="op" id="6290412">.</span><span class="ident" id="6290413">Kind</span><span class="op" id="6290417">(</span><span class="op" id="6290418">)</span>&nbsp;<span class="op" id="6290420">==</span>&nbsp;<span class="ident" id="6290423">reflect</span><span class="op" id="6290430">.</span><span class="ident" id="6290431">Struct</span>&nbsp;<span class="op" id="6290438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290442">err</span>&nbsp;<span class="op" id="6290446">=</span>&nbsp;<span class="ident" id="6290448">p</span><span class="op" id="6290449">.</span><span class="ident" id="6290450">marshalStruct</span><span class="op" id="6290463">(</span><span class="ident" id="6290464">tinfo</span><span class="op" id="6290469">,</span>&nbsp;<span class="ident" id="6290471">val</span><span class="op" id="6290474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290477">}</span>&nbsp;<span class="keyword" id="6290479">else</span>&nbsp;<span class="op" id="6290484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290488">s</span><span class="op" id="6290489">,</span>&nbsp;<span class="ident" id="6290491">b</span><span class="op" id="6290492">,</span>&nbsp;<span class="ident" id="6290494">err1</span>&nbsp;<span class="op" id="6290499">:=</span>&nbsp;<span class="ident" id="6290502">p</span><span class="op" id="6290503">.</span><span class="ident" id="6290504">marshalSimple</span><span class="op" id="6290517">(</span><span class="ident" id="6290518">typ</span><span class="op" id="6290521">,</span>&nbsp;<span class="ident" id="6290523">val</span><span class="op" id="6290526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290530">if</span>&nbsp;<span class="ident" id="6290533">err1</span>&nbsp;<span class="op" id="6290538">!=</span>&nbsp;<span class="ident" id="6290541">nil</span>&nbsp;<span class="op" id="6290545">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290550">err</span>&nbsp;<span class="op" id="6290554">=</span>&nbsp;<span class="ident" id="6290556">err1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290563">}</span>&nbsp;<span class="keyword" id="6290565">else</span>&nbsp;<span class="keyword" id="6290570">if</span>&nbsp;<span class="ident" id="6290573">b</span>&nbsp;<span class="op" id="6290575">!=</span>&nbsp;<span class="ident" id="6290578">nil</span>&nbsp;<span class="op" id="6290582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290587">EscapeText</span><span class="op" id="6290597">(</span><span class="ident" id="6290598">p</span><span class="op" id="6290599">,</span>&nbsp;<span class="ident" id="6290601">b</span><span class="op" id="6290602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290606">}</span>&nbsp;<span class="keyword" id="6290608">else</span>&nbsp;<span class="op" id="6290613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6290618">p</span><span class="op" id="6290619">.</span><span class="ident" id="6290620">EscapeString</span><span class="op" id="6290632">(</span><span class="ident" id="6290633">s</span><span class="op" id="6290634">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290638">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290644">if</span>&nbsp;<span class="ident" id="6290647">err</span>&nbsp;<span class="op" id="6290651">!=</span>&nbsp;<span class="ident" id="6290654">nil</span>&nbsp;<span class="op" id="6290658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290662">return</span>&nbsp;<span class="ident" id="6290669">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290674">}</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290678">if</span>&nbsp;<span class="ident" id="6290681">err</span>&nbsp;<span class="op" id="6290685">:=</span>&nbsp;<span class="ident" id="6290688">p</span><span class="op" id="6290689">.</span><span class="ident" id="6290690">writeEnd</span><span class="op" id="6290698">(</span><span class="ident" id="6290699">start</span><span class="op" id="6290704">.</span><span class="ident" id="6290705">Name</span><span class="op" id="6290709">)</span><span class="op" id="6290710">;</span>&nbsp;<span class="ident" id="6290712">err</span>&nbsp;<span class="op" id="6290716">!=</span>&nbsp;<span class="ident" id="6290719">nil</span>&nbsp;<span class="op" id="6290723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290727">return</span>&nbsp;<span class="ident" id="6290734">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6290739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290743">return</span>&nbsp;<span class="ident" id="6290750">p</span><span class="op" id="6290751">.</span><span class="ident" id="6290752">cachedWriteError</span><span class="op" id="6290768">(</span><span class="op" id="6290769">)</span><br>
<span class="lineno"></span><span class="op" id="6290771">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6290774">//&nbsp;defaultStart&nbsp;returns&nbsp;the&nbsp;default&nbsp;start&nbsp;element&nbsp;to&nbsp;use,</span><br>
<span class="lineno"></span><span class="comment" id="6290832">//&nbsp;given&nbsp;the&nbsp;reflect&nbsp;type,&nbsp;field&nbsp;info,&nbsp;and&nbsp;start&nbsp;template.</span><br>
<span class="lineno">555</span><span class="keyword" id="6290891">func</span>&nbsp;<span class="ident" id="6290896">defaultStart</span><span class="op" id="6290908">(</span><span class="ident" id="6290909">typ</span>&nbsp;<span class="ident" id="6290913">reflect</span><span class="op" id="6290920">.</span><span class="ident" id="6290921">Type</span><span class="op" id="6290925">,</span>&nbsp;<span class="ident" id="6290927">finfo</span>&nbsp;<span class="op" id="6290933">*</span><span class="ident" id="6290934">fieldInfo</span><span class="op" id="6290943">,</span>&nbsp;<span class="ident" id="6290945">startTemplate</span>&nbsp;<span class="op" id="6290959">*</span><span class="ident" id="6290960">StartElement</span><span class="op" id="6290972">)</span>&nbsp;<span class="ident" id="6290974">StartElement</span>&nbsp;<span class="op" id="6290987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6290990">var</span>&nbsp;<span class="ident" id="6290994">start</span>&nbsp;<span class="ident" id="6291000">StartElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291014">//&nbsp;Precedence&nbsp;for&nbsp;the&nbsp;XML&nbsp;element&nbsp;name&nbsp;is&nbsp;as&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291067">//&nbsp;except&nbsp;that&nbsp;we&nbsp;do&nbsp;not&nbsp;look&nbsp;inside&nbsp;structs&nbsp;for&nbsp;the&nbsp;first&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291134">if</span>&nbsp;<span class="ident" id="6291137">startTemplate</span>&nbsp;<span class="op" id="6291151">!=</span>&nbsp;<span class="ident" id="6291154">nil</span>&nbsp;<span class="op" id="6291158">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291162">start</span><span class="op" id="6291167">.</span><span class="ident" id="6291168">Name</span>&nbsp;<span class="op" id="6291173">=</span>&nbsp;<span class="ident" id="6291175">startTemplate</span><span class="op" id="6291188">.</span><span class="ident" id="6291189">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291196">start</span><span class="op" id="6291201">.</span><span class="ident" id="6291202">Attr</span>&nbsp;<span class="op" id="6291207">=</span>&nbsp;<span class="builtinfunc" id="6291209">append</span><span class="op" id="6291215">(</span><span class="ident" id="6291216">start</span><span class="op" id="6291221">.</span><span class="ident" id="6291222">Attr</span><span class="op" id="6291226">,</span>&nbsp;<span class="ident" id="6291228">startTemplate</span><span class="op" id="6291241">.</span><span class="ident" id="6291242">Attr</span><span class="op" id="6291246">...</span><span class="op" id="6291249">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291252">}</span>&nbsp;<span class="keyword" id="6291254">else</span>&nbsp;<span class="keyword" id="6291259">if</span>&nbsp;<span class="ident" id="6291262">finfo</span>&nbsp;<span class="op" id="6291268">!=</span>&nbsp;<span class="ident" id="6291271">nil</span>&nbsp;<span class="op" id="6291275">&amp;&amp;</span>&nbsp;<span class="ident" id="6291278">finfo</span><span class="op" id="6291283">.</span><span class="ident" id="6291284">name</span>&nbsp;<span class="op" id="6291289">!=</span>&nbsp;<span class="string" id="6291292">&#34;&#34;</span>&nbsp;<span class="op" id="6291295">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291299">start</span><span class="op" id="6291304">.</span><span class="ident" id="6291305">Name</span><span class="op" id="6291309">.</span><span class="ident" id="6291310">Local</span>&nbsp;<span class="op" id="6291316">=</span>&nbsp;<span class="ident" id="6291318">finfo</span><span class="op" id="6291323">.</span><span class="ident" id="6291324">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291331">start</span><span class="op" id="6291336">.</span><span class="ident" id="6291337">Name</span><span class="op" id="6291341">.</span><span class="ident" id="6291342">Space</span>&nbsp;<span class="op" id="6291348">=</span>&nbsp;<span class="ident" id="6291350">finfo</span><span class="op" id="6291355">.</span><span class="ident" id="6291356">xmlns</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291363">}</span>&nbsp;<span class="keyword" id="6291365">else</span>&nbsp;<span class="keyword" id="6291370">if</span>&nbsp;<span class="ident" id="6291373">typ</span><span class="op" id="6291376">.</span><span class="ident" id="6291377">Name</span><span class="op" id="6291381">(</span><span class="op" id="6291382">)</span>&nbsp;<span class="op" id="6291384">!=</span>&nbsp;<span class="string" id="6291387">&#34;&#34;</span>&nbsp;<span class="op" id="6291390">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291394">start</span><span class="op" id="6291399">.</span><span class="ident" id="6291400">Name</span><span class="op" id="6291404">.</span><span class="ident" id="6291405">Local</span>&nbsp;<span class="op" id="6291411">=</span>&nbsp;<span class="ident" id="6291413">typ</span><span class="op" id="6291416">.</span><span class="ident" id="6291417">Name</span><span class="op" id="6291421">(</span><span class="op" id="6291422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291425">}</span>&nbsp;<span class="keyword" id="6291427">else</span>&nbsp;<span class="op" id="6291432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291436">//&nbsp;Must&nbsp;be&nbsp;a&nbsp;pointer&nbsp;to&nbsp;a&nbsp;named&nbsp;type,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291476">//&nbsp;since&nbsp;it&nbsp;has&nbsp;the&nbsp;Marshaler&nbsp;methods.</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291517">start</span><span class="op" id="6291522">.</span><span class="ident" id="6291523">Name</span><span class="op" id="6291527">.</span><span class="ident" id="6291528">Local</span>&nbsp;<span class="op" id="6291534">=</span>&nbsp;<span class="ident" id="6291536">typ</span><span class="op" id="6291539">.</span><span class="ident" id="6291540">Elem</span><span class="op" id="6291544">(</span><span class="op" id="6291545">)</span><span class="op" id="6291546">.</span><span class="ident" id="6291547">Name</span><span class="op" id="6291551">(</span><span class="op" id="6291552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291558">return</span>&nbsp;<span class="ident" id="6291565">start</span><br>
<span class="lineno"></span><span class="op" id="6291571">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">575</span><span class="comment" id="6291574">//&nbsp;marshalInterface&nbsp;marshals&nbsp;a&nbsp;Marshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6291632">func</span>&nbsp;<span class="op" id="6291637">(</span><span class="ident" id="6291638">p</span>&nbsp;<span class="op" id="6291640">*</span><span class="ident" id="6291641">printer</span><span class="op" id="6291648">)</span>&nbsp;<span class="ident" id="6291650">marshalInterface</span><span class="op" id="6291666">(</span><span class="ident" id="6291667">val</span>&nbsp;<span class="ident" id="6291671">Marshaler</span><span class="op" id="6291680">,</span>&nbsp;<span class="ident" id="6291682">start</span>&nbsp;<span class="ident" id="6291688">StartElement</span><span class="op" id="6291700">)</span>&nbsp;<span class="builtintype" id="6291702">error</span>&nbsp;<span class="op" id="6291708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291711">//&nbsp;Push&nbsp;a&nbsp;marker&nbsp;onto&nbsp;the&nbsp;tag&nbsp;stack&nbsp;so&nbsp;that&nbsp;MarshalXML</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291767">//&nbsp;cannot&nbsp;close&nbsp;the&nbsp;XML&nbsp;tags&nbsp;that&nbsp;it&nbsp;did&nbsp;not&nbsp;open.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291819">p</span><span class="op" id="6291820">.</span><span class="ident" id="6291821">tags</span>&nbsp;<span class="op" id="6291826">=</span>&nbsp;<span class="builtinfunc" id="6291828">append</span><span class="op" id="6291834">(</span><span class="ident" id="6291835">p</span><span class="op" id="6291836">.</span><span class="ident" id="6291837">tags</span><span class="op" id="6291841">,</span>&nbsp;<span class="ident" id="6291843">Name</span><span class="op" id="6291847">{</span><span class="op" id="6291848">}</span><span class="op" id="6291849">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291852">n</span>&nbsp;<span class="op" id="6291854">:=</span>&nbsp;<span class="builtinfunc" id="6291857">len</span><span class="op" id="6291860">(</span><span class="ident" id="6291861">p</span><span class="op" id="6291862">.</span><span class="ident" id="6291863">tags</span><span class="op" id="6291867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6291871">err</span>&nbsp;<span class="op" id="6291875">:=</span>&nbsp;<span class="ident" id="6291878">val</span><span class="op" id="6291881">.</span><span class="ident" id="6291882">MarshalXML</span><span class="op" id="6291892">(</span><span class="ident" id="6291893">p</span><span class="op" id="6291894">.</span><span class="ident" id="6291895">encoder</span><span class="op" id="6291902">,</span>&nbsp;<span class="ident" id="6291904">start</span><span class="op" id="6291909">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291912">if</span>&nbsp;<span class="ident" id="6291915">err</span>&nbsp;<span class="op" id="6291919">!=</span>&nbsp;<span class="ident" id="6291922">nil</span>&nbsp;<span class="op" id="6291926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6291930">return</span>&nbsp;<span class="ident" id="6291937">err</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6291942">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6291946">//&nbsp;Make&nbsp;sure&nbsp;MarshalXML&nbsp;closed&nbsp;all&nbsp;its&nbsp;tags.&nbsp;p.tags[n-1]&nbsp;is&nbsp;the&nbsp;mark.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292017">if</span>&nbsp;<span class="builtinfunc" id="6292020">len</span><span class="op" id="6292023">(</span><span class="ident" id="6292024">p</span><span class="op" id="6292025">.</span><span class="ident" id="6292026">tags</span><span class="op" id="6292030">)</span>&nbsp;<span class="op" id="6292032">&gt;</span>&nbsp;<span class="ident" id="6292034">n</span>&nbsp;<span class="op" id="6292036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292040">return</span>&nbsp;<span class="ident" id="6292047">fmt</span><span class="op" id="6292050">.</span><span class="ident" id="6292051">Errorf</span><span class="op" id="6292057">(</span><span class="string" id="6292058">&#34;xml:&nbsp;%s.MarshalXML&nbsp;wrote&nbsp;invalid&nbsp;XML:&nbsp;&lt;%s&gt;&nbsp;not&nbsp;closed&#34;</span><span class="op" id="6292113">,</span>&nbsp;<span class="ident" id="6292115">receiverType</span><span class="op" id="6292127">(</span><span class="ident" id="6292128">val</span><span class="op" id="6292131">)</span><span class="op" id="6292132">,</span>&nbsp;<span class="ident" id="6292134">p</span><span class="op" id="6292135">.</span><span class="ident" id="6292136">tags</span><span class="op" id="6292140">[</span><span class="builtinfunc" id="6292141">len</span><span class="op" id="6292144">(</span><span class="ident" id="6292145">p</span><span class="op" id="6292146">.</span><span class="ident" id="6292147">tags</span><span class="op" id="6292151">)</span><span class="op" id="6292152">-</span><span class="num" id="6292153">1</span><span class="op" id="6292154">]</span><span class="op" id="6292155">.</span><span class="ident" id="6292156">Local</span><span class="op" id="6292161">)</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292164">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292167">p</span><span class="op" id="6292168">.</span><span class="ident" id="6292169">tags</span>&nbsp;<span class="op" id="6292174">=</span>&nbsp;<span class="ident" id="6292176">p</span><span class="op" id="6292177">.</span><span class="ident" id="6292178">tags</span><span class="op" id="6292182">[</span><span class="op" id="6292183">:</span><span class="ident" id="6292184">n</span><span class="op" id="6292185">-</span><span class="num" id="6292186">1</span><span class="op" id="6292187">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292190">return</span>&nbsp;<span class="ident" id="6292197">nil</span><br>
<span class="lineno"></span><span class="op" id="6292201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">595</span><span class="comment" id="6292204">//&nbsp;marshalTextInterface&nbsp;marshals&nbsp;a&nbsp;TextMarshaler&nbsp;interface&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="6292270">func</span>&nbsp;<span class="op" id="6292275">(</span><span class="ident" id="6292276">p</span>&nbsp;<span class="op" id="6292278">*</span><span class="ident" id="6292279">printer</span><span class="op" id="6292286">)</span>&nbsp;<span class="ident" id="6292288">marshalTextInterface</span><span class="op" id="6292308">(</span><span class="ident" id="6292309">val</span>&nbsp;<span class="ident" id="6292313">encoding</span><span class="op" id="6292321">.</span><span class="ident" id="6292322">TextMarshaler</span><span class="op" id="6292335">,</span>&nbsp;<span class="ident" id="6292337">start</span>&nbsp;<span class="ident" id="6292343">StartElement</span><span class="op" id="6292355">)</span>&nbsp;<span class="builtintype" id="6292357">error</span>&nbsp;<span class="op" id="6292363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292366">if</span>&nbsp;<span class="ident" id="6292369">err</span>&nbsp;<span class="op" id="6292373">:=</span>&nbsp;<span class="ident" id="6292376">p</span><span class="op" id="6292377">.</span><span class="ident" id="6292378">writeStart</span><span class="op" id="6292388">(</span><span class="op" id="6292389">&amp;</span><span class="ident" id="6292390">start</span><span class="op" id="6292395">)</span><span class="op" id="6292396">;</span>&nbsp;<span class="ident" id="6292398">err</span>&nbsp;<span class="op" id="6292402">!=</span>&nbsp;<span class="ident" id="6292405">nil</span>&nbsp;<span class="op" id="6292409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292413">return</span>&nbsp;<span class="ident" id="6292420">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292425">}</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292428">text</span><span class="op" id="6292432">,</span>&nbsp;<span class="ident" id="6292434">err</span>&nbsp;<span class="op" id="6292438">:=</span>&nbsp;<span class="ident" id="6292441">val</span><span class="op" id="6292444">.</span><span class="ident" id="6292445">MarshalText</span><span class="op" id="6292456">(</span><span class="op" id="6292457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292460">if</span>&nbsp;<span class="ident" id="6292463">err</span>&nbsp;<span class="op" id="6292467">!=</span>&nbsp;<span class="ident" id="6292470">nil</span>&nbsp;<span class="op" id="6292474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292478">return</span>&nbsp;<span class="ident" id="6292485">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292490">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292493">EscapeText</span><span class="op" id="6292503">(</span><span class="ident" id="6292504">p</span><span class="op" id="6292505">,</span>&nbsp;<span class="ident" id="6292507">text</span><span class="op" id="6292511">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292514">return</span>&nbsp;<span class="ident" id="6292521">p</span><span class="op" id="6292522">.</span><span class="ident" id="6292523">writeEnd</span><span class="op" id="6292531">(</span><span class="ident" id="6292532">start</span><span class="op" id="6292537">.</span><span class="ident" id="6292538">Name</span><span class="op" id="6292542">)</span><br>
<span class="lineno"></span><span class="op" id="6292544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6292547">//&nbsp;writeStart&nbsp;writes&nbsp;the&nbsp;given&nbsp;start&nbsp;element.</span><br>
<span class="lineno"></span><span class="keyword" id="6292593">func</span>&nbsp;<span class="op" id="6292598">(</span><span class="ident" id="6292599">p</span>&nbsp;<span class="op" id="6292601">*</span><span class="ident" id="6292602">printer</span><span class="op" id="6292609">)</span>&nbsp;<span class="ident" id="6292611">writeStart</span><span class="op" id="6292621">(</span><span class="ident" id="6292622">start</span>&nbsp;<span class="op" id="6292628">*</span><span class="ident" id="6292629">StartElement</span><span class="op" id="6292641">)</span>&nbsp;<span class="builtintype" id="6292643">error</span>&nbsp;<span class="op" id="6292649">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292652">if</span>&nbsp;<span class="ident" id="6292655">start</span><span class="op" id="6292660">.</span><span class="ident" id="6292661">Name</span><span class="op" id="6292665">.</span><span class="ident" id="6292666">Local</span>&nbsp;<span class="op" id="6292672">==</span>&nbsp;<span class="string" id="6292675">&#34;&#34;</span>&nbsp;<span class="op" id="6292678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292682">return</span>&nbsp;<span class="ident" id="6292689">fmt</span><span class="op" id="6292692">.</span><span class="ident" id="6292693">Errorf</span><span class="op" id="6292699">(</span><span class="string" id="6292700">&#34;xml:&nbsp;start&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6292729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292732">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292736">p</span><span class="op" id="6292737">.</span><span class="ident" id="6292738">tags</span>&nbsp;<span class="op" id="6292743">=</span>&nbsp;<span class="builtinfunc" id="6292745">append</span><span class="op" id="6292751">(</span><span class="ident" id="6292752">p</span><span class="op" id="6292753">.</span><span class="ident" id="6292754">tags</span><span class="op" id="6292758">,</span>&nbsp;<span class="ident" id="6292760">start</span><span class="op" id="6292765">.</span><span class="ident" id="6292766">Name</span><span class="op" id="6292770">)</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292773">p</span><span class="op" id="6292774">.</span><span class="ident" id="6292775">markPrefix</span><span class="op" id="6292785">(</span><span class="op" id="6292786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292790">p</span><span class="op" id="6292791">.</span><span class="ident" id="6292792">writeIndent</span><span class="op" id="6292803">(</span><span class="num" id="6292804">1</span><span class="op" id="6292805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292808">p</span><span class="op" id="6292809">.</span><span class="ident" id="6292810">WriteByte</span><span class="op" id="6292819">(</span><span class="string" id="6292820">&#39;&lt;&#39;</span><span class="op" id="6292823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292826">p</span><span class="op" id="6292827">.</span><span class="ident" id="6292828">WriteString</span><span class="op" id="6292839">(</span><span class="ident" id="6292840">start</span><span class="op" id="6292845">.</span><span class="ident" id="6292846">Name</span><span class="op" id="6292850">.</span><span class="ident" id="6292851">Local</span><span class="op" id="6292856">)</span><br>
<span class="lineno">620</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292860">if</span>&nbsp;<span class="ident" id="6292863">start</span><span class="op" id="6292868">.</span><span class="ident" id="6292869">Name</span><span class="op" id="6292873">.</span><span class="ident" id="6292874">Space</span>&nbsp;<span class="op" id="6292880">!=</span>&nbsp;<span class="string" id="6292883">&#34;&#34;</span>&nbsp;<span class="op" id="6292886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292890">p</span><span class="op" id="6292891">.</span><span class="ident" id="6292892">WriteString</span><span class="op" id="6292903">(</span><span class="string" id="6292904">`&nbsp;xmlns=&#34;`</span><span class="op" id="6292914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292918">p</span><span class="op" id="6292919">.</span><span class="ident" id="6292920">EscapeString</span><span class="op" id="6292932">(</span><span class="ident" id="6292933">start</span><span class="op" id="6292938">.</span><span class="ident" id="6292939">Name</span><span class="op" id="6292943">.</span><span class="ident" id="6292944">Space</span><span class="op" id="6292949">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6292953">p</span><span class="op" id="6292954">.</span><span class="ident" id="6292955">WriteByte</span><span class="op" id="6292964">(</span><span class="string" id="6292965">&#39;&#34;&#39;</span><span class="op" id="6292968">)</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6292971">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6292975">//&nbsp;Attributes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6292990">for</span>&nbsp;<span class="ident" id="6292994">_</span><span class="op" id="6292995">,</span>&nbsp;<span class="ident" id="6292997">attr</span>&nbsp;<span class="op" id="6293002">:=</span>&nbsp;<span class="keyword" id="6293005">range</span>&nbsp;<span class="ident" id="6293011">start</span><span class="op" id="6293016">.</span><span class="ident" id="6293017">Attr</span>&nbsp;<span class="op" id="6293022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293026">name</span>&nbsp;<span class="op" id="6293031">:=</span>&nbsp;<span class="ident" id="6293034">attr</span><span class="op" id="6293038">.</span><span class="ident" id="6293039">Name</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293046">if</span>&nbsp;<span class="ident" id="6293049">name</span><span class="op" id="6293053">.</span><span class="ident" id="6293054">Local</span>&nbsp;<span class="op" id="6293060">==</span>&nbsp;<span class="string" id="6293063">&#34;&#34;</span>&nbsp;<span class="op" id="6293066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293071">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293086">p</span><span class="op" id="6293087">.</span><span class="ident" id="6293088">WriteByte</span><span class="op" id="6293097">(</span><span class="string" id="6293098">&#39;&nbsp;&#39;</span><span class="op" id="6293101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293105">if</span>&nbsp;<span class="ident" id="6293108">name</span><span class="op" id="6293112">.</span><span class="ident" id="6293113">Space</span>&nbsp;<span class="op" id="6293119">!=</span>&nbsp;<span class="string" id="6293122">&#34;&#34;</span>&nbsp;<span class="op" id="6293125">{</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293130">p</span><span class="op" id="6293131">.</span><span class="ident" id="6293132">WriteString</span><span class="op" id="6293143">(</span><span class="ident" id="6293144">p</span><span class="op" id="6293145">.</span><span class="ident" id="6293146">createAttrPrefix</span><span class="op" id="6293162">(</span><span class="ident" id="6293163">name</span><span class="op" id="6293167">.</span><span class="ident" id="6293168">Space</span><span class="op" id="6293173">)</span><span class="op" id="6293174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293179">p</span><span class="op" id="6293180">.</span><span class="ident" id="6293181">WriteByte</span><span class="op" id="6293190">(</span><span class="string" id="6293191">&#39;:&#39;</span><span class="op" id="6293194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293202">p</span><span class="op" id="6293203">.</span><span class="ident" id="6293204">WriteString</span><span class="op" id="6293215">(</span><span class="ident" id="6293216">name</span><span class="op" id="6293220">.</span><span class="ident" id="6293221">Local</span><span class="op" id="6293226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293230">p</span><span class="op" id="6293231">.</span><span class="ident" id="6293232">WriteString</span><span class="op" id="6293243">(</span><span class="string" id="6293244">`=&#34;`</span><span class="op" id="6293248">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293252">p</span><span class="op" id="6293253">.</span><span class="ident" id="6293254">EscapeString</span><span class="op" id="6293266">(</span><span class="ident" id="6293267">attr</span><span class="op" id="6293271">.</span><span class="ident" id="6293272">Value</span><span class="op" id="6293277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293281">p</span><span class="op" id="6293282">.</span><span class="ident" id="6293283">WriteByte</span><span class="op" id="6293292">(</span><span class="string" id="6293293">&#39;&#34;&#39;</span><span class="op" id="6293296">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293299">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293302">p</span><span class="op" id="6293303">.</span><span class="ident" id="6293304">WriteByte</span><span class="op" id="6293313">(</span><span class="string" id="6293314">&#39;&gt;&#39;</span><span class="op" id="6293317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293320">return</span>&nbsp;<span class="ident" id="6293327">nil</span><br>
<span class="lineno">645</span><span class="op" id="6293331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6293334">func</span>&nbsp;<span class="op" id="6293339">(</span><span class="ident" id="6293340">p</span>&nbsp;<span class="op" id="6293342">*</span><span class="ident" id="6293343">printer</span><span class="op" id="6293350">)</span>&nbsp;<span class="ident" id="6293352">writeEnd</span><span class="op" id="6293360">(</span><span class="ident" id="6293361">name</span>&nbsp;<span class="ident" id="6293366">Name</span><span class="op" id="6293370">)</span>&nbsp;<span class="builtintype" id="6293372">error</span>&nbsp;<span class="op" id="6293378">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293381">if</span>&nbsp;<span class="ident" id="6293384">name</span><span class="op" id="6293388">.</span><span class="ident" id="6293389">Local</span>&nbsp;<span class="op" id="6293395">==</span>&nbsp;<span class="string" id="6293398">&#34;&#34;</span>&nbsp;<span class="op" id="6293401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293405">return</span>&nbsp;<span class="ident" id="6293412">fmt</span><span class="op" id="6293415">.</span><span class="ident" id="6293416">Errorf</span><span class="op" id="6293422">(</span><span class="string" id="6293423">&#34;xml:&nbsp;end&nbsp;tag&nbsp;with&nbsp;no&nbsp;name&#34;</span><span class="op" id="6293450">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293453">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293456">if</span>&nbsp;<span class="builtinfunc" id="6293459">len</span><span class="op" id="6293462">(</span><span class="ident" id="6293463">p</span><span class="op" id="6293464">.</span><span class="ident" id="6293465">tags</span><span class="op" id="6293469">)</span>&nbsp;<span class="op" id="6293471">==</span>&nbsp;<span class="num" id="6293474">0</span>&nbsp;<span class="op" id="6293476">||</span>&nbsp;<span class="ident" id="6293479">p</span><span class="op" id="6293480">.</span><span class="ident" id="6293481">tags</span><span class="op" id="6293485">[</span><span class="builtinfunc" id="6293486">len</span><span class="op" id="6293489">(</span><span class="ident" id="6293490">p</span><span class="op" id="6293491">.</span><span class="ident" id="6293492">tags</span><span class="op" id="6293496">)</span><span class="op" id="6293497">-</span><span class="num" id="6293498">1</span><span class="op" id="6293499">]</span><span class="op" id="6293500">.</span><span class="ident" id="6293501">Local</span>&nbsp;<span class="op" id="6293507">==</span>&nbsp;<span class="string" id="6293510">&#34;&#34;</span>&nbsp;<span class="op" id="6293513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293517">return</span>&nbsp;<span class="ident" id="6293524">fmt</span><span class="op" id="6293527">.</span><span class="ident" id="6293528">Errorf</span><span class="op" id="6293534">(</span><span class="string" id="6293535">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;without&nbsp;start&nbsp;tag&#34;</span><span class="op" id="6293573">,</span>&nbsp;<span class="ident" id="6293575">name</span><span class="op" id="6293579">.</span><span class="ident" id="6293580">Local</span><span class="op" id="6293585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293591">if</span>&nbsp;<span class="ident" id="6293594">top</span>&nbsp;<span class="op" id="6293598">:=</span>&nbsp;<span class="ident" id="6293601">p</span><span class="op" id="6293602">.</span><span class="ident" id="6293603">tags</span><span class="op" id="6293607">[</span><span class="builtinfunc" id="6293608">len</span><span class="op" id="6293611">(</span><span class="ident" id="6293612">p</span><span class="op" id="6293613">.</span><span class="ident" id="6293614">tags</span><span class="op" id="6293618">)</span><span class="op" id="6293619">-</span><span class="num" id="6293620">1</span><span class="op" id="6293621">]</span><span class="op" id="6293622">;</span>&nbsp;<span class="ident" id="6293624">top</span>&nbsp;<span class="op" id="6293628">!=</span>&nbsp;<span class="ident" id="6293631">name</span>&nbsp;<span class="op" id="6293636">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293640">if</span>&nbsp;<span class="ident" id="6293643">top</span><span class="op" id="6293646">.</span><span class="ident" id="6293647">Local</span>&nbsp;<span class="op" id="6293653">!=</span>&nbsp;<span class="ident" id="6293656">name</span><span class="op" id="6293660">.</span><span class="ident" id="6293661">Local</span>&nbsp;<span class="op" id="6293667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293672">return</span>&nbsp;<span class="ident" id="6293679">fmt</span><span class="op" id="6293682">.</span><span class="ident" id="6293683">Errorf</span><span class="op" id="6293689">(</span><span class="string" id="6293690">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&#34;</span><span class="op" id="6293740">,</span>&nbsp;<span class="ident" id="6293742">name</span><span class="op" id="6293746">.</span><span class="ident" id="6293747">Local</span><span class="op" id="6293752">,</span>&nbsp;<span class="ident" id="6293754">top</span><span class="op" id="6293757">.</span><span class="ident" id="6293758">Local</span><span class="op" id="6293763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293767">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6293771">return</span>&nbsp;<span class="ident" id="6293778">fmt</span><span class="op" id="6293781">.</span><span class="ident" id="6293782">Errorf</span><span class="op" id="6293788">(</span><span class="string" id="6293789">&#34;xml:&nbsp;end&nbsp;tag&nbsp;&lt;/%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&nbsp;does&nbsp;not&nbsp;match&nbsp;start&nbsp;tag&nbsp;&lt;%s&gt;&nbsp;in&nbsp;namespace&nbsp;%s&#34;</span><span class="op" id="6293871">,</span>&nbsp;<span class="ident" id="6293873">name</span><span class="op" id="6293877">.</span><span class="ident" id="6293878">Local</span><span class="op" id="6293883">,</span>&nbsp;<span class="ident" id="6293885">name</span><span class="op" id="6293889">.</span><span class="ident" id="6293890">Space</span><span class="op" id="6293895">,</span>&nbsp;<span class="ident" id="6293897">top</span><span class="op" id="6293900">.</span><span class="ident" id="6293901">Local</span><span class="op" id="6293906">,</span>&nbsp;<span class="ident" id="6293908">top</span><span class="op" id="6293911">.</span><span class="ident" id="6293912">Space</span><span class="op" id="6293917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6293920">}</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293923">p</span><span class="op" id="6293924">.</span><span class="ident" id="6293925">tags</span>&nbsp;<span class="op" id="6293930">=</span>&nbsp;<span class="ident" id="6293932">p</span><span class="op" id="6293933">.</span><span class="ident" id="6293934">tags</span><span class="op" id="6293938">[</span><span class="op" id="6293939">:</span><span class="builtinfunc" id="6293940">len</span><span class="op" id="6293943">(</span><span class="ident" id="6293944">p</span><span class="op" id="6293945">.</span><span class="ident" id="6293946">tags</span><span class="op" id="6293950">)</span><span class="op" id="6293951">-</span><span class="num" id="6293952">1</span><span class="op" id="6293953">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293957">p</span><span class="op" id="6293958">.</span><span class="ident" id="6293959">writeIndent</span><span class="op" id="6293970">(</span><span class="op" id="6293971">-</span><span class="num" id="6293972">1</span><span class="op" id="6293973">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293976">p</span><span class="op" id="6293977">.</span><span class="ident" id="6293978">WriteByte</span><span class="op" id="6293987">(</span><span class="string" id="6293988">&#39;&lt;&#39;</span><span class="op" id="6293991">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6293994">p</span><span class="op" id="6293995">.</span><span class="ident" id="6293996">WriteByte</span><span class="op" id="6294005">(</span><span class="string" id="6294006">&#39;/&#39;</span><span class="op" id="6294009">)</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294012">p</span><span class="op" id="6294013">.</span><span class="ident" id="6294014">WriteString</span><span class="op" id="6294025">(</span><span class="ident" id="6294026">name</span><span class="op" id="6294030">.</span><span class="ident" id="6294031">Local</span><span class="op" id="6294036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294039">p</span><span class="op" id="6294040">.</span><span class="ident" id="6294041">WriteByte</span><span class="op" id="6294050">(</span><span class="string" id="6294051">&#39;&gt;&#39;</span><span class="op" id="6294054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294057">p</span><span class="op" id="6294058">.</span><span class="ident" id="6294059">popPrefix</span><span class="op" id="6294068">(</span><span class="op" id="6294069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294072">return</span>&nbsp;<span class="ident" id="6294079">nil</span><br>
<span class="lineno"></span><span class="op" id="6294083">}</span><br>
<span class="lineno">670</span><br>
<span class="lineno"></span><span class="keyword" id="6294086">func</span>&nbsp;<span class="op" id="6294091">(</span><span class="ident" id="6294092">p</span>&nbsp;<span class="op" id="6294094">*</span><span class="ident" id="6294095">printer</span><span class="op" id="6294102">)</span>&nbsp;<span class="ident" id="6294104">marshalSimple</span><span class="op" id="6294117">(</span><span class="ident" id="6294118">typ</span>&nbsp;<span class="ident" id="6294122">reflect</span><span class="op" id="6294129">.</span><span class="ident" id="6294130">Type</span><span class="op" id="6294134">,</span>&nbsp;<span class="ident" id="6294136">val</span>&nbsp;<span class="ident" id="6294140">reflect</span><span class="op" id="6294147">.</span><span class="ident" id="6294148">Value</span><span class="op" id="6294153">)</span>&nbsp;<span class="op" id="6294155">(</span><span class="builtintype" id="6294156">string</span><span class="op" id="6294162">,</span>&nbsp;<span class="op" id="6294164">[</span><span class="op" id="6294165">]</span><span class="builtintype" id="6294166">byte</span><span class="op" id="6294170">,</span>&nbsp;<span class="builtintype" id="6294172">error</span><span class="op" id="6294177">)</span>&nbsp;<span class="op" id="6294179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294182">switch</span>&nbsp;<span class="ident" id="6294189">val</span><span class="op" id="6294192">.</span><span class="ident" id="6294193">Kind</span><span class="op" id="6294197">(</span><span class="op" id="6294198">)</span>&nbsp;<span class="op" id="6294200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294203">case</span>&nbsp;<span class="ident" id="6294208">reflect</span><span class="op" id="6294215">.</span><span class="ident" id="6294216">Int</span><span class="op" id="6294219">,</span>&nbsp;<span class="ident" id="6294221">reflect</span><span class="op" id="6294228">.</span><span class="ident" id="6294229">Int8</span><span class="op" id="6294233">,</span>&nbsp;<span class="ident" id="6294235">reflect</span><span class="op" id="6294242">.</span><span class="ident" id="6294243">Int16</span><span class="op" id="6294248">,</span>&nbsp;<span class="ident" id="6294250">reflect</span><span class="op" id="6294257">.</span><span class="ident" id="6294258">Int32</span><span class="op" id="6294263">,</span>&nbsp;<span class="ident" id="6294265">reflect</span><span class="op" id="6294272">.</span><span class="ident" id="6294273">Int64</span><span class="op" id="6294278">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294282">return</span>&nbsp;<span class="ident" id="6294289">strconv</span><span class="op" id="6294296">.</span><span class="ident" id="6294297">FormatInt</span><span class="op" id="6294306">(</span><span class="ident" id="6294307">val</span><span class="op" id="6294310">.</span><span class="ident" id="6294311">Int</span><span class="op" id="6294314">(</span><span class="op" id="6294315">)</span><span class="op" id="6294316">,</span>&nbsp;<span class="num" id="6294318">10</span><span class="op" id="6294320">)</span><span class="op" id="6294321">,</span>&nbsp;<span class="ident" id="6294323">nil</span><span class="op" id="6294326">,</span>&nbsp;<span class="ident" id="6294328">nil</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294333">case</span>&nbsp;<span class="ident" id="6294338">reflect</span><span class="op" id="6294345">.</span><span class="ident" id="6294346">Uint</span><span class="op" id="6294350">,</span>&nbsp;<span class="ident" id="6294352">reflect</span><span class="op" id="6294359">.</span><span class="ident" id="6294360">Uint8</span><span class="op" id="6294365">,</span>&nbsp;<span class="ident" id="6294367">reflect</span><span class="op" id="6294374">.</span><span class="ident" id="6294375">Uint16</span><span class="op" id="6294381">,</span>&nbsp;<span class="ident" id="6294383">reflect</span><span class="op" id="6294390">.</span><span class="ident" id="6294391">Uint32</span><span class="op" id="6294397">,</span>&nbsp;<span class="ident" id="6294399">reflect</span><span class="op" id="6294406">.</span><span class="ident" id="6294407">Uint64</span><span class="op" id="6294413">,</span>&nbsp;<span class="ident" id="6294415">reflect</span><span class="op" id="6294422">.</span><span class="ident" id="6294423">Uintptr</span><span class="op" id="6294430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294434">return</span>&nbsp;<span class="ident" id="6294441">strconv</span><span class="op" id="6294448">.</span><span class="ident" id="6294449">FormatUint</span><span class="op" id="6294459">(</span><span class="ident" id="6294460">val</span><span class="op" id="6294463">.</span><span class="ident" id="6294464">Uint</span><span class="op" id="6294468">(</span><span class="op" id="6294469">)</span><span class="op" id="6294470">,</span>&nbsp;<span class="num" id="6294472">10</span><span class="op" id="6294474">)</span><span class="op" id="6294475">,</span>&nbsp;<span class="ident" id="6294477">nil</span><span class="op" id="6294480">,</span>&nbsp;<span class="ident" id="6294482">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294487">case</span>&nbsp;<span class="ident" id="6294492">reflect</span><span class="op" id="6294499">.</span><span class="ident" id="6294500">Float32</span><span class="op" id="6294507">,</span>&nbsp;<span class="ident" id="6294509">reflect</span><span class="op" id="6294516">.</span><span class="ident" id="6294517">Float64</span><span class="op" id="6294524">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294528">return</span>&nbsp;<span class="ident" id="6294535">strconv</span><span class="op" id="6294542">.</span><span class="ident" id="6294543">FormatFloat</span><span class="op" id="6294554">(</span><span class="ident" id="6294555">val</span><span class="op" id="6294558">.</span><span class="ident" id="6294559">Float</span><span class="op" id="6294564">(</span><span class="op" id="6294565">)</span><span class="op" id="6294566">,</span>&nbsp;<span class="string" id="6294568">&#39;g&#39;</span><span class="op" id="6294571">,</span>&nbsp;<span class="op" id="6294573">-</span><span class="num" id="6294574">1</span><span class="op" id="6294575">,</span>&nbsp;<span class="ident" id="6294577">val</span><span class="op" id="6294580">.</span><span class="ident" id="6294581">Type</span><span class="op" id="6294585">(</span><span class="op" id="6294586">)</span><span class="op" id="6294587">.</span><span class="ident" id="6294588">Bits</span><span class="op" id="6294592">(</span><span class="op" id="6294593">)</span><span class="op" id="6294594">)</span><span class="op" id="6294595">,</span>&nbsp;<span class="ident" id="6294597">nil</span><span class="op" id="6294600">,</span>&nbsp;<span class="ident" id="6294602">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294607">case</span>&nbsp;<span class="ident" id="6294612">reflect</span><span class="op" id="6294619">.</span><span class="ident" id="6294620">String</span><span class="op" id="6294626">:</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294630">return</span>&nbsp;<span class="ident" id="6294637">val</span><span class="op" id="6294640">.</span><span class="ident" id="6294641">String</span><span class="op" id="6294647">(</span><span class="op" id="6294648">)</span><span class="op" id="6294649">,</span>&nbsp;<span class="ident" id="6294651">nil</span><span class="op" id="6294654">,</span>&nbsp;<span class="ident" id="6294656">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294661">case</span>&nbsp;<span class="ident" id="6294666">reflect</span><span class="op" id="6294673">.</span><span class="ident" id="6294674">Bool</span><span class="op" id="6294678">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294682">return</span>&nbsp;<span class="ident" id="6294689">strconv</span><span class="op" id="6294696">.</span><span class="ident" id="6294697">FormatBool</span><span class="op" id="6294707">(</span><span class="ident" id="6294708">val</span><span class="op" id="6294711">.</span><span class="ident" id="6294712">Bool</span><span class="op" id="6294716">(</span><span class="op" id="6294717">)</span><span class="op" id="6294718">)</span><span class="op" id="6294719">,</span>&nbsp;<span class="ident" id="6294721">nil</span><span class="op" id="6294724">,</span>&nbsp;<span class="ident" id="6294726">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294731">case</span>&nbsp;<span class="ident" id="6294736">reflect</span><span class="op" id="6294743">.</span><span class="ident" id="6294744">Array</span><span class="op" id="6294749">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294753">if</span>&nbsp;<span class="ident" id="6294756">typ</span><span class="op" id="6294759">.</span><span class="ident" id="6294760">Elem</span><span class="op" id="6294764">(</span><span class="op" id="6294765">)</span><span class="op" id="6294766">.</span><span class="ident" id="6294767">Kind</span><span class="op" id="6294771">(</span><span class="op" id="6294772">)</span>&nbsp;<span class="op" id="6294774">!=</span>&nbsp;<span class="ident" id="6294777">reflect</span><span class="op" id="6294784">.</span><span class="ident" id="6294785">Uint8</span>&nbsp;<span class="op" id="6294791">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294796">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6294808">//&nbsp;[...]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294823">var</span>&nbsp;<span class="ident" id="6294827">bytes</span>&nbsp;<span class="op" id="6294833">[</span><span class="op" id="6294834">]</span><span class="builtintype" id="6294835">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6294842">if</span>&nbsp;<span class="ident" id="6294845">val</span><span class="op" id="6294848">.</span><span class="ident" id="6294849">CanAddr</span><span class="op" id="6294856">(</span><span class="op" id="6294857">)</span>&nbsp;<span class="op" id="6294859">{</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294864">bytes</span>&nbsp;<span class="op" id="6294870">=</span>&nbsp;<span class="ident" id="6294872">val</span><span class="op" id="6294875">.</span><span class="ident" id="6294876">Slice</span><span class="op" id="6294881">(</span><span class="num" id="6294882">0</span><span class="op" id="6294883">,</span>&nbsp;<span class="ident" id="6294885">val</span><span class="op" id="6294888">.</span><span class="ident" id="6294889">Len</span><span class="op" id="6294892">(</span><span class="op" id="6294893">)</span><span class="op" id="6294894">)</span><span class="op" id="6294895">.</span><span class="ident" id="6294896">Bytes</span><span class="op" id="6294901">(</span><span class="op" id="6294902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294906">}</span>&nbsp;<span class="keyword" id="6294908">else</span>&nbsp;<span class="op" id="6294913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294918">bytes</span>&nbsp;<span class="op" id="6294924">=</span>&nbsp;<span class="builtinfunc" id="6294926">make</span><span class="op" id="6294930">(</span><span class="op" id="6294931">[</span><span class="op" id="6294932">]</span><span class="builtintype" id="6294933">byte</span><span class="op" id="6294937">,</span>&nbsp;<span class="ident" id="6294939">val</span><span class="op" id="6294942">.</span><span class="ident" id="6294943">Len</span><span class="op" id="6294946">(</span><span class="op" id="6294947">)</span><span class="op" id="6294948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6294953">reflect</span><span class="op" id="6294960">.</span><span class="ident" id="6294961">Copy</span><span class="op" id="6294965">(</span><span class="ident" id="6294966">reflect</span><span class="op" id="6294973">.</span><span class="ident" id="6294974">ValueOf</span><span class="op" id="6294981">(</span><span class="ident" id="6294982">bytes</span><span class="op" id="6294987">)</span><span class="op" id="6294988">,</span>&nbsp;<span class="ident" id="6294990">val</span><span class="op" id="6294993">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6294997">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295001">return</span>&nbsp;<span class="string" id="6295008">&#34;&#34;</span><span class="op" id="6295010">,</span>&nbsp;<span class="ident" id="6295012">bytes</span><span class="op" id="6295017">,</span>&nbsp;<span class="ident" id="6295019">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295024">case</span>&nbsp;<span class="ident" id="6295029">reflect</span><span class="op" id="6295036">.</span><span class="ident" id="6295037">Slice</span><span class="op" id="6295042">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295046">if</span>&nbsp;<span class="ident" id="6295049">typ</span><span class="op" id="6295052">.</span><span class="ident" id="6295053">Elem</span><span class="op" id="6295057">(</span><span class="op" id="6295058">)</span><span class="op" id="6295059">.</span><span class="ident" id="6295060">Kind</span><span class="op" id="6295064">(</span><span class="op" id="6295065">)</span>&nbsp;<span class="op" id="6295067">!=</span>&nbsp;<span class="ident" id="6295070">reflect</span><span class="op" id="6295077">.</span><span class="ident" id="6295078">Uint8</span>&nbsp;<span class="op" id="6295084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295089">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295097">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295101">//&nbsp;[]byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295113">return</span>&nbsp;<span class="string" id="6295120">&#34;&#34;</span><span class="op" id="6295122">,</span>&nbsp;<span class="ident" id="6295124">val</span><span class="op" id="6295127">.</span><span class="ident" id="6295128">Bytes</span><span class="op" id="6295133">(</span><span class="op" id="6295134">)</span><span class="op" id="6295135">,</span>&nbsp;<span class="ident" id="6295137">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295145">return</span>&nbsp;<span class="string" id="6295152">&#34;&#34;</span><span class="op" id="6295154">,</span>&nbsp;<span class="ident" id="6295156">nil</span><span class="op" id="6295159">,</span>&nbsp;<span class="op" id="6295161">&amp;</span><span class="ident" id="6295162">UnsupportedTypeError</span><span class="op" id="6295182">{</span><span class="ident" id="6295183">typ</span><span class="op" id="6295186">}</span><br>
<span class="lineno"></span><span class="op" id="6295188">}</span><br>
<span class="lineno">705</span><br>
<span class="lineno"></span><span class="keyword" id="6295191">var</span>&nbsp;<span class="ident" id="6295195">ddBytes</span>&nbsp;<span class="op" id="6295203">=</span>&nbsp;<span class="op" id="6295205">[</span><span class="op" id="6295206">]</span><span class="builtintype" id="6295207">byte</span><span class="op" id="6295211">(</span><span class="string" id="6295212">&#34;--&#34;</span><span class="op" id="6295216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6295219">func</span>&nbsp;<span class="op" id="6295224">(</span><span class="ident" id="6295225">p</span>&nbsp;<span class="op" id="6295227">*</span><span class="ident" id="6295228">printer</span><span class="op" id="6295235">)</span>&nbsp;<span class="ident" id="6295237">marshalStruct</span><span class="op" id="6295250">(</span><span class="ident" id="6295251">tinfo</span>&nbsp;<span class="op" id="6295257">*</span><span class="ident" id="6295258">typeInfo</span><span class="op" id="6295266">,</span>&nbsp;<span class="ident" id="6295268">val</span>&nbsp;<span class="ident" id="6295272">reflect</span><span class="op" id="6295279">.</span><span class="ident" id="6295280">Value</span><span class="op" id="6295285">)</span>&nbsp;<span class="builtintype" id="6295287">error</span>&nbsp;<span class="op" id="6295293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295296">s</span>&nbsp;<span class="op" id="6295298">:=</span>&nbsp;<span class="ident" id="6295301">parentStack</span><span class="op" id="6295312">{</span><span class="ident" id="6295313">p</span><span class="op" id="6295314">:</span>&nbsp;<span class="ident" id="6295316">p</span><span class="op" id="6295317">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295320">for</span>&nbsp;<span class="ident" id="6295324">i</span>&nbsp;<span class="op" id="6295326">:=</span>&nbsp;<span class="keyword" id="6295329">range</span>&nbsp;<span class="ident" id="6295335">tinfo</span><span class="op" id="6295340">.</span><span class="ident" id="6295341">fields</span>&nbsp;<span class="op" id="6295348">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295352">finfo</span>&nbsp;<span class="op" id="6295358">:=</span>&nbsp;<span class="op" id="6295361">&amp;</span><span class="ident" id="6295362">tinfo</span><span class="op" id="6295367">.</span><span class="ident" id="6295368">fields</span><span class="op" id="6295374">[</span><span class="ident" id="6295375">i</span><span class="op" id="6295376">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295380">if</span>&nbsp;<span class="ident" id="6295383">finfo</span><span class="op" id="6295388">.</span><span class="ident" id="6295389">flags</span><span class="op" id="6295394">&amp;</span><span class="ident" id="6295395">fAttr</span>&nbsp;<span class="op" id="6295401">!=</span>&nbsp;<span class="num" id="6295404">0</span>&nbsp;<span class="op" id="6295406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295411">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295422">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295426">vf</span>&nbsp;<span class="op" id="6295429">:=</span>&nbsp;<span class="ident" id="6295432">finfo</span><span class="op" id="6295437">.</span><span class="ident" id="6295438">value</span><span class="op" id="6295443">(</span><span class="ident" id="6295444">val</span><span class="op" id="6295447">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6295452">//&nbsp;Dereference&nbsp;or&nbsp;skip&nbsp;nil&nbsp;pointer,&nbsp;interface&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295508">switch</span>&nbsp;<span class="ident" id="6295515">vf</span><span class="op" id="6295517">.</span><span class="ident" id="6295518">Kind</span><span class="op" id="6295522">(</span><span class="op" id="6295523">)</span>&nbsp;<span class="op" id="6295525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295529">case</span>&nbsp;<span class="ident" id="6295534">reflect</span><span class="op" id="6295541">.</span><span class="ident" id="6295542">Ptr</span><span class="op" id="6295545">,</span>&nbsp;<span class="ident" id="6295547">reflect</span><span class="op" id="6295554">.</span><span class="ident" id="6295555">Interface</span><span class="op" id="6295564">:</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295569">if</span>&nbsp;<span class="op" id="6295572">!</span><span class="ident" id="6295573">vf</span><span class="op" id="6295575">.</span><span class="ident" id="6295576">IsNil</span><span class="op" id="6295581">(</span><span class="op" id="6295582">)</span>&nbsp;<span class="op" id="6295584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295590">vf</span>&nbsp;<span class="op" id="6295593">=</span>&nbsp;<span class="ident" id="6295595">vf</span><span class="op" id="6295597">.</span><span class="ident" id="6295598">Elem</span><span class="op" id="6295602">(</span><span class="op" id="6295603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295617">switch</span>&nbsp;<span class="ident" id="6295624">finfo</span><span class="op" id="6295629">.</span><span class="ident" id="6295630">flags</span>&nbsp;<span class="op" id="6295636">&amp;</span>&nbsp;<span class="ident" id="6295638">fMode</span>&nbsp;<span class="op" id="6295644">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295648">case</span>&nbsp;<span class="ident" id="6295653">fCharData</span><span class="op" id="6295662">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295667">if</span>&nbsp;<span class="ident" id="6295670">vf</span><span class="op" id="6295672">.</span><span class="ident" id="6295673">CanInterface</span><span class="op" id="6295685">(</span><span class="op" id="6295686">)</span>&nbsp;<span class="op" id="6295688">&amp;&amp;</span>&nbsp;<span class="ident" id="6295691">vf</span><span class="op" id="6295693">.</span><span class="ident" id="6295694">Type</span><span class="op" id="6295698">(</span><span class="op" id="6295699">)</span><span class="op" id="6295700">.</span><span class="ident" id="6295701">Implements</span><span class="op" id="6295711">(</span><span class="ident" id="6295712">textMarshalerType</span><span class="op" id="6295729">)</span>&nbsp;<span class="op" id="6295731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295737">data</span><span class="op" id="6295741">,</span>&nbsp;<span class="ident" id="6295743">err</span>&nbsp;<span class="op" id="6295747">:=</span>&nbsp;<span class="ident" id="6295750">vf</span><span class="op" id="6295752">.</span><span class="ident" id="6295753">Interface</span><span class="op" id="6295762">(</span><span class="op" id="6295763">)</span><span class="op" id="6295764">.</span><span class="op" id="6295765">(</span><span class="ident" id="6295766">encoding</span><span class="op" id="6295774">.</span><span class="ident" id="6295775">TextMarshaler</span><span class="op" id="6295788">)</span><span class="op" id="6295789">.</span><span class="ident" id="6295790">MarshalText</span><span class="op" id="6295801">(</span><span class="op" id="6295802">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295808">if</span>&nbsp;<span class="ident" id="6295811">err</span>&nbsp;<span class="op" id="6295815">!=</span>&nbsp;<span class="ident" id="6295818">nil</span>&nbsp;<span class="op" id="6295822">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295829">return</span>&nbsp;<span class="ident" id="6295836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295850">Escape</span><span class="op" id="6295856">(</span><span class="ident" id="6295857">p</span><span class="op" id="6295858">,</span>&nbsp;<span class="ident" id="6295860">data</span><span class="op" id="6295864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295870">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6295882">}</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295887">if</span>&nbsp;<span class="ident" id="6295890">vf</span><span class="op" id="6295892">.</span><span class="ident" id="6295893">CanAddr</span><span class="op" id="6295900">(</span><span class="op" id="6295901">)</span>&nbsp;<span class="op" id="6295903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6295909">pv</span>&nbsp;<span class="op" id="6295912">:=</span>&nbsp;<span class="ident" id="6295915">vf</span><span class="op" id="6295917">.</span><span class="ident" id="6295918">Addr</span><span class="op" id="6295922">(</span><span class="op" id="6295923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6295929">if</span>&nbsp;<span class="ident" id="6295932">pv</span><span class="op" id="6295934">.</span><span class="ident" id="6295935">CanInterface</span><span class="op" id="6295947">(</span><span class="op" id="6295948">)</span>&nbsp;<span class="op" id="6295950">&amp;&amp;</span>&nbsp;<span class="ident" id="6295953">pv</span><span class="op" id="6295955">.</span><span class="ident" id="6295956">Type</span><span class="op" id="6295960">(</span><span class="op" id="6295961">)</span><span class="op" id="6295962">.</span><span class="ident" id="6295963">Implements</span><span class="op" id="6295973">(</span><span class="ident" id="6295974">textMarshalerType</span><span class="op" id="6295991">)</span>&nbsp;<span class="op" id="6295993">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296000">data</span><span class="op" id="6296004">,</span>&nbsp;<span class="ident" id="6296006">err</span>&nbsp;<span class="op" id="6296010">:=</span>&nbsp;<span class="ident" id="6296013">pv</span><span class="op" id="6296015">.</span><span class="ident" id="6296016">Interface</span><span class="op" id="6296025">(</span><span class="op" id="6296026">)</span><span class="op" id="6296027">.</span><span class="op" id="6296028">(</span><span class="ident" id="6296029">encoding</span><span class="op" id="6296037">.</span><span class="ident" id="6296038">TextMarshaler</span><span class="op" id="6296051">)</span><span class="op" id="6296052">.</span><span class="ident" id="6296053">MarshalText</span><span class="op" id="6296064">(</span><span class="op" id="6296065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296072">if</span>&nbsp;<span class="ident" id="6296075">err</span>&nbsp;<span class="op" id="6296079">!=</span>&nbsp;<span class="ident" id="6296082">nil</span>&nbsp;<span class="op" id="6296086">{</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296094">return</span>&nbsp;<span class="ident" id="6296101">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296117">Escape</span><span class="op" id="6296123">(</span><span class="ident" id="6296124">p</span><span class="op" id="6296125">,</span>&nbsp;<span class="ident" id="6296127">data</span><span class="op" id="6296131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296138">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296151">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296156">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296161">var</span>&nbsp;<span class="ident" id="6296165">scratch</span>&nbsp;<span class="op" id="6296173">[</span><span class="num" id="6296174">64</span><span class="op" id="6296176">]</span><span class="builtintype" id="6296177">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296185">switch</span>&nbsp;<span class="ident" id="6296192">vf</span><span class="op" id="6296194">.</span><span class="ident" id="6296195">Kind</span><span class="op" id="6296199">(</span><span class="op" id="6296200">)</span>&nbsp;<span class="op" id="6296202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296207">case</span>&nbsp;<span class="ident" id="6296212">reflect</span><span class="op" id="6296219">.</span><span class="ident" id="6296220">Int</span><span class="op" id="6296223">,</span>&nbsp;<span class="ident" id="6296225">reflect</span><span class="op" id="6296232">.</span><span class="ident" id="6296233">Int8</span><span class="op" id="6296237">,</span>&nbsp;<span class="ident" id="6296239">reflect</span><span class="op" id="6296246">.</span><span class="ident" id="6296247">Int16</span><span class="op" id="6296252">,</span>&nbsp;<span class="ident" id="6296254">reflect</span><span class="op" id="6296261">.</span><span class="ident" id="6296262">Int32</span><span class="op" id="6296267">,</span>&nbsp;<span class="ident" id="6296269">reflect</span><span class="op" id="6296276">.</span><span class="ident" id="6296277">Int64</span><span class="op" id="6296282">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296288">Escape</span><span class="op" id="6296294">(</span><span class="ident" id="6296295">p</span><span class="op" id="6296296">,</span>&nbsp;<span class="ident" id="6296298">strconv</span><span class="op" id="6296305">.</span><span class="ident" id="6296306">AppendInt</span><span class="op" id="6296315">(</span><span class="ident" id="6296316">scratch</span><span class="op" id="6296323">[</span><span class="op" id="6296324">:</span><span class="num" id="6296325">0</span><span class="op" id="6296326">]</span><span class="op" id="6296327">,</span>&nbsp;<span class="ident" id="6296329">vf</span><span class="op" id="6296331">.</span><span class="ident" id="6296332">Int</span><span class="op" id="6296335">(</span><span class="op" id="6296336">)</span><span class="op" id="6296337">,</span>&nbsp;<span class="num" id="6296339">10</span><span class="op" id="6296341">)</span><span class="op" id="6296342">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296347">case</span>&nbsp;<span class="ident" id="6296352">reflect</span><span class="op" id="6296359">.</span><span class="ident" id="6296360">Uint</span><span class="op" id="6296364">,</span>&nbsp;<span class="ident" id="6296366">reflect</span><span class="op" id="6296373">.</span><span class="ident" id="6296374">Uint8</span><span class="op" id="6296379">,</span>&nbsp;<span class="ident" id="6296381">reflect</span><span class="op" id="6296388">.</span><span class="ident" id="6296389">Uint16</span><span class="op" id="6296395">,</span>&nbsp;<span class="ident" id="6296397">reflect</span><span class="op" id="6296404">.</span><span class="ident" id="6296405">Uint32</span><span class="op" id="6296411">,</span>&nbsp;<span class="ident" id="6296413">reflect</span><span class="op" id="6296420">.</span><span class="ident" id="6296421">Uint64</span><span class="op" id="6296427">,</span>&nbsp;<span class="ident" id="6296429">reflect</span><span class="op" id="6296436">.</span><span class="ident" id="6296437">Uintptr</span><span class="op" id="6296444">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296450">Escape</span><span class="op" id="6296456">(</span><span class="ident" id="6296457">p</span><span class="op" id="6296458">,</span>&nbsp;<span class="ident" id="6296460">strconv</span><span class="op" id="6296467">.</span><span class="ident" id="6296468">AppendUint</span><span class="op" id="6296478">(</span><span class="ident" id="6296479">scratch</span><span class="op" id="6296486">[</span><span class="op" id="6296487">:</span><span class="num" id="6296488">0</span><span class="op" id="6296489">]</span><span class="op" id="6296490">,</span>&nbsp;<span class="ident" id="6296492">vf</span><span class="op" id="6296494">.</span><span class="ident" id="6296495">Uint</span><span class="op" id="6296499">(</span><span class="op" id="6296500">)</span><span class="op" id="6296501">,</span>&nbsp;<span class="num" id="6296503">10</span><span class="op" id="6296505">)</span><span class="op" id="6296506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296511">case</span>&nbsp;<span class="ident" id="6296516">reflect</span><span class="op" id="6296523">.</span><span class="ident" id="6296524">Float32</span><span class="op" id="6296531">,</span>&nbsp;<span class="ident" id="6296533">reflect</span><span class="op" id="6296540">.</span><span class="ident" id="6296541">Float64</span><span class="op" id="6296548">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296554">Escape</span><span class="op" id="6296560">(</span><span class="ident" id="6296561">p</span><span class="op" id="6296562">,</span>&nbsp;<span class="ident" id="6296564">strconv</span><span class="op" id="6296571">.</span><span class="ident" id="6296572">AppendFloat</span><span class="op" id="6296583">(</span><span class="ident" id="6296584">scratch</span><span class="op" id="6296591">[</span><span class="op" id="6296592">:</span><span class="num" id="6296593">0</span><span class="op" id="6296594">]</span><span class="op" id="6296595">,</span>&nbsp;<span class="ident" id="6296597">vf</span><span class="op" id="6296599">.</span><span class="ident" id="6296600">Float</span><span class="op" id="6296605">(</span><span class="op" id="6296606">)</span><span class="op" id="6296607">,</span>&nbsp;<span class="string" id="6296609">&#39;g&#39;</span><span class="op" id="6296612">,</span>&nbsp;<span class="op" id="6296614">-</span><span class="num" id="6296615">1</span><span class="op" id="6296616">,</span>&nbsp;<span class="ident" id="6296618">vf</span><span class="op" id="6296620">.</span><span class="ident" id="6296621">Type</span><span class="op" id="6296625">(</span><span class="op" id="6296626">)</span><span class="op" id="6296627">.</span><span class="ident" id="6296628">Bits</span><span class="op" id="6296632">(</span><span class="op" id="6296633">)</span><span class="op" id="6296634">)</span><span class="op" id="6296635">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296640">case</span>&nbsp;<span class="ident" id="6296645">reflect</span><span class="op" id="6296652">.</span><span class="ident" id="6296653">Bool</span><span class="op" id="6296657">:</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6296663">Escape</span><span class="op" id="6296669">(</span><span class="ident" id="6296670">p</span><span class="op" id="6296671">,</span>&nbsp;<span class="ident" id="6296673">strconv</span><span class="op" id="6296680">.</span><span class="ident" id="6296681">AppendBool</span><span class="op" id="6296691">(</span><span class="ident" id="6296692">scratch</span><span class="op" id="6296699">[</span><span class="op" id="6296700">:</span><span class="num" id="6296701">0</span><span class="op" id="6296702">]</span><span class="op" id="6296703">,</span>&nbsp;<span class="ident" id="6296705">vf</span><span class="op" id="6296707">.</span><span class="ident" id="6296708">Bool</span><span class="op" id="6296712">(</span><span class="op" id="6296713">)</span><span class="op" id="6296714">)</span><span class="op" id="6296715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296720">case</span>&nbsp;<span class="ident" id="6296725">reflect</span><span class="op" id="6296732">.</span><span class="ident" id="6296733">String</span><span class="op" id="6296739">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296745">if</span>&nbsp;<span class="ident" id="6296748">err</span>&nbsp;<span class="op" id="6296752">:=</span>&nbsp;<span class="ident" id="6296755">EscapeText</span><span class="op" id="6296765">(</span><span class="ident" id="6296766">p</span><span class="op" id="6296767">,</span>&nbsp;<span class="op" id="6296769">[</span><span class="op" id="6296770">]</span><span class="builtintype" id="6296771">byte</span><span class="op" id="6296775">(</span><span class="ident" id="6296776">vf</span><span class="op" id="6296778">.</span><span class="ident" id="6296779">String</span><span class="op" id="6296785">(</span><span class="op" id="6296786">)</span><span class="op" id="6296787">)</span><span class="op" id="6296788">)</span><span class="op" id="6296789">;</span>&nbsp;<span class="ident" id="6296791">err</span>&nbsp;<span class="op" id="6296795">!=</span>&nbsp;<span class="ident" id="6296798">nil</span>&nbsp;<span class="op" id="6296802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296809">return</span>&nbsp;<span class="ident" id="6296816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296824">}</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296829">case</span>&nbsp;<span class="ident" id="6296834">reflect</span><span class="op" id="6296841">.</span><span class="ident" id="6296842">Slice</span><span class="op" id="6296847">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296853">if</span>&nbsp;<span class="ident" id="6296856">elem</span><span class="op" id="6296860">,</span>&nbsp;<span class="ident" id="6296862">ok</span>&nbsp;<span class="op" id="6296865">:=</span>&nbsp;<span class="ident" id="6296868">vf</span><span class="op" id="6296870">.</span><span class="ident" id="6296871">Interface</span><span class="op" id="6296880">(</span><span class="op" id="6296881">)</span><span class="op" id="6296882">.</span><span class="op" id="6296883">(</span><span class="op" id="6296884">[</span><span class="op" id="6296885">]</span><span class="builtintype" id="6296886">byte</span><span class="op" id="6296890">)</span><span class="op" id="6296891">;</span>&nbsp;<span class="ident" id="6296893">ok</span>&nbsp;<span class="op" id="6296896">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296903">if</span>&nbsp;<span class="ident" id="6296906">err</span>&nbsp;<span class="op" id="6296910">:=</span>&nbsp;<span class="ident" id="6296913">EscapeText</span><span class="op" id="6296923">(</span><span class="ident" id="6296924">p</span><span class="op" id="6296925">,</span>&nbsp;<span class="ident" id="6296927">elem</span><span class="op" id="6296931">)</span><span class="op" id="6296932">;</span>&nbsp;<span class="ident" id="6296934">err</span>&nbsp;<span class="op" id="6296938">!=</span>&nbsp;<span class="ident" id="6296941">nil</span>&nbsp;<span class="op" id="6296945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296953">return</span>&nbsp;<span class="ident" id="6296960">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296969">}</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6296980">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296985">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6296997">case</span>&nbsp;<span class="ident" id="6297002">fComment</span><span class="op" id="6297010">:</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297015">k</span>&nbsp;<span class="op" id="6297017">:=</span>&nbsp;<span class="ident" id="6297020">vf</span><span class="op" id="6297022">.</span><span class="ident" id="6297023">Kind</span><span class="op" id="6297027">(</span><span class="op" id="6297028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297033">if</span>&nbsp;<span class="op" id="6297036">!</span><span class="op" id="6297037">(</span><span class="ident" id="6297038">k</span>&nbsp;<span class="op" id="6297040">==</span>&nbsp;<span class="ident" id="6297043">reflect</span><span class="op" id="6297050">.</span><span class="ident" id="6297051">String</span>&nbsp;<span class="op" id="6297058">||</span>&nbsp;<span class="ident" id="6297061">k</span>&nbsp;<span class="op" id="6297063">==</span>&nbsp;<span class="ident" id="6297066">reflect</span><span class="op" id="6297073">.</span><span class="ident" id="6297074">Slice</span>&nbsp;<span class="op" id="6297080">&amp;&amp;</span>&nbsp;<span class="ident" id="6297083">vf</span><span class="op" id="6297085">.</span><span class="ident" id="6297086">Type</span><span class="op" id="6297090">(</span><span class="op" id="6297091">)</span><span class="op" id="6297092">.</span><span class="ident" id="6297093">Elem</span><span class="op" id="6297097">(</span><span class="op" id="6297098">)</span><span class="op" id="6297099">.</span><span class="ident" id="6297100">Kind</span><span class="op" id="6297104">(</span><span class="op" id="6297105">)</span>&nbsp;<span class="op" id="6297107">==</span>&nbsp;<span class="ident" id="6297110">reflect</span><span class="op" id="6297117">.</span><span class="ident" id="6297118">Uint8</span><span class="op" id="6297123">)</span>&nbsp;<span class="op" id="6297125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297131">return</span>&nbsp;<span class="ident" id="6297138">fmt</span><span class="op" id="6297141">.</span><span class="ident" id="6297142">Errorf</span><span class="op" id="6297148">(</span><span class="string" id="6297149">&#34;xml:&nbsp;bad&nbsp;type&nbsp;for&nbsp;comment&nbsp;field&nbsp;of&nbsp;%s&#34;</span><span class="op" id="6297188">,</span>&nbsp;<span class="ident" id="6297190">val</span><span class="op" id="6297193">.</span><span class="ident" id="6297194">Type</span><span class="op" id="6297198">(</span><span class="op" id="6297199">)</span><span class="op" id="6297200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297205">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297210">if</span>&nbsp;<span class="ident" id="6297213">vf</span><span class="op" id="6297215">.</span><span class="ident" id="6297216">Len</span><span class="op" id="6297219">(</span><span class="op" id="6297220">)</span>&nbsp;<span class="op" id="6297222">==</span>&nbsp;<span class="num" id="6297225">0</span>&nbsp;<span class="op" id="6297227">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297233">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297245">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297250">p</span><span class="op" id="6297251">.</span><span class="ident" id="6297252">writeIndent</span><span class="op" id="6297263">(</span><span class="num" id="6297264">0</span><span class="op" id="6297265">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297270">p</span><span class="op" id="6297271">.</span><span class="ident" id="6297272">WriteString</span><span class="op" id="6297283">(</span><span class="string" id="6297284">&#34;&lt;!--&#34;</span><span class="op" id="6297290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297295">dashDash</span>&nbsp;<span class="op" id="6297304">:=</span>&nbsp;<span class="builtintype" id="6297307">false</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297316">dashLast</span>&nbsp;<span class="op" id="6297325">:=</span>&nbsp;<span class="builtintype" id="6297328">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297337">switch</span>&nbsp;<span class="ident" id="6297344">k</span>&nbsp;<span class="op" id="6297346">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297351">case</span>&nbsp;<span class="ident" id="6297356">reflect</span><span class="op" id="6297363">.</span><span class="ident" id="6297364">String</span><span class="op" id="6297370">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297376">s</span>&nbsp;<span class="op" id="6297378">:=</span>&nbsp;<span class="ident" id="6297381">vf</span><span class="op" id="6297383">.</span><span class="ident" id="6297384">String</span><span class="op" id="6297390">(</span><span class="op" id="6297391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297397">dashDash</span>&nbsp;<span class="op" id="6297406">=</span>&nbsp;<span class="ident" id="6297408">strings</span><span class="op" id="6297415">.</span><span class="ident" id="6297416">Index</span><span class="op" id="6297421">(</span><span class="ident" id="6297422">s</span><span class="op" id="6297423">,</span>&nbsp;<span class="string" id="6297425">&#34;--&#34;</span><span class="op" id="6297429">)</span>&nbsp;<span class="op" id="6297431">&gt;=</span>&nbsp;<span class="num" id="6297434">0</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297440">dashLast</span>&nbsp;<span class="op" id="6297449">=</span>&nbsp;<span class="ident" id="6297451">s</span><span class="op" id="6297452">[</span><span class="builtinfunc" id="6297453">len</span><span class="op" id="6297456">(</span><span class="ident" id="6297457">s</span><span class="op" id="6297458">)</span><span class="op" id="6297459">-</span><span class="num" id="6297460">1</span><span class="op" id="6297461">]</span>&nbsp;<span class="op" id="6297463">==</span>&nbsp;<span class="string" id="6297466">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297474">if</span>&nbsp;<span class="op" id="6297477">!</span><span class="ident" id="6297478">dashDash</span>&nbsp;<span class="op" id="6297487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297494">p</span><span class="op" id="6297495">.</span><span class="ident" id="6297496">WriteString</span><span class="op" id="6297507">(</span><span class="ident" id="6297508">s</span><span class="op" id="6297509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297520">case</span>&nbsp;<span class="ident" id="6297525">reflect</span><span class="op" id="6297532">.</span><span class="ident" id="6297533">Slice</span><span class="op" id="6297538">:</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297544">b</span>&nbsp;<span class="op" id="6297546">:=</span>&nbsp;<span class="ident" id="6297549">vf</span><span class="op" id="6297551">.</span><span class="ident" id="6297552">Bytes</span><span class="op" id="6297557">(</span><span class="op" id="6297558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297564">dashDash</span>&nbsp;<span class="op" id="6297573">=</span>&nbsp;<span class="ident" id="6297575">bytes</span><span class="op" id="6297580">.</span><span class="ident" id="6297581">Index</span><span class="op" id="6297586">(</span><span class="ident" id="6297587">b</span><span class="op" id="6297588">,</span>&nbsp;<span class="ident" id="6297590">ddBytes</span><span class="op" id="6297597">)</span>&nbsp;<span class="op" id="6297599">&gt;=</span>&nbsp;<span class="num" id="6297602">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297608">dashLast</span>&nbsp;<span class="op" id="6297617">=</span>&nbsp;<span class="ident" id="6297619">b</span><span class="op" id="6297620">[</span><span class="builtinfunc" id="6297621">len</span><span class="op" id="6297624">(</span><span class="ident" id="6297625">b</span><span class="op" id="6297626">)</span><span class="op" id="6297627">-</span><span class="num" id="6297628">1</span><span class="op" id="6297629">]</span>&nbsp;<span class="op" id="6297631">==</span>&nbsp;<span class="string" id="6297634">&#39;-&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297642">if</span>&nbsp;<span class="op" id="6297645">!</span><span class="ident" id="6297646">dashDash</span>&nbsp;<span class="op" id="6297655">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297662">p</span><span class="op" id="6297663">.</span><span class="ident" id="6297664">Write</span><span class="op" id="6297669">(</span><span class="ident" id="6297670">b</span><span class="op" id="6297671">)</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297682">default</span><span class="op" id="6297689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6297695">panic</span><span class="op" id="6297700">(</span><span class="string" id="6297701">&#34;can&#39;t&nbsp;happen&#34;</span><span class="op" id="6297715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297720">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297725">if</span>&nbsp;<span class="ident" id="6297728">dashDash</span>&nbsp;<span class="op" id="6297737">{</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297743">return</span>&nbsp;<span class="ident" id="6297750">fmt</span><span class="op" id="6297753">.</span><span class="ident" id="6297754">Errorf</span><span class="op" id="6297760">(</span><span class="string" id="6297761">`xml:&nbsp;comments&nbsp;must&nbsp;not&nbsp;contain&nbsp;&#34;--&#34;`</span><span class="op" id="6297798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297808">if</span>&nbsp;<span class="ident" id="6297811">dashLast</span>&nbsp;<span class="op" id="6297820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6297826">//&nbsp;&#34;---&gt;&#34;&nbsp;is&nbsp;invalid&nbsp;grammar.&nbsp;Make&nbsp;it&nbsp;&#34;-&nbsp;--&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297876">p</span><span class="op" id="6297877">.</span><span class="ident" id="6297878">WriteByte</span><span class="op" id="6297887">(</span><span class="string" id="6297888">&#39;&nbsp;&#39;</span><span class="op" id="6297891">)</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6297896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297901">p</span><span class="op" id="6297902">.</span><span class="ident" id="6297903">WriteString</span><span class="op" id="6297914">(</span><span class="string" id="6297915">&#34;--&gt;&#34;</span><span class="op" id="6297920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297925">continue</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297937">case</span>&nbsp;<span class="ident" id="6297942">fInnerXml</span><span class="op" id="6297951">:</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6297956">iface</span>&nbsp;<span class="op" id="6297962">:=</span>&nbsp;<span class="ident" id="6297965">vf</span><span class="op" id="6297967">.</span><span class="ident" id="6297968">Interface</span><span class="op" id="6297977">(</span><span class="op" id="6297978">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6297983">switch</span>&nbsp;<span class="ident" id="6297990">raw</span>&nbsp;<span class="op" id="6297994">:=</span>&nbsp;<span class="ident" id="6297997">iface</span><span class="op" id="6298002">.</span><span class="op" id="6298003">(</span><span class="keyword" id="6298004">type</span><span class="op" id="6298008">)</span>&nbsp;<span class="op" id="6298010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298015">case</span>&nbsp;<span class="op" id="6298020">[</span><span class="op" id="6298021">]</span><span class="builtintype" id="6298022">byte</span><span class="op" id="6298026">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298032">p</span><span class="op" id="6298033">.</span><span class="ident" id="6298034">Write</span><span class="op" id="6298039">(</span><span class="ident" id="6298040">raw</span><span class="op" id="6298043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298049">continue</span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298061">case</span>&nbsp;<span class="builtintype" id="6298066">string</span><span class="op" id="6298072">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298078">p</span><span class="op" id="6298079">.</span><span class="ident" id="6298080">WriteString</span><span class="op" id="6298091">(</span><span class="ident" id="6298092">raw</span><span class="op" id="6298095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298101">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298113">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298118">case</span>&nbsp;<span class="ident" id="6298123">fElement</span><span class="op" id="6298131">,</span>&nbsp;<span class="ident" id="6298133">fElement</span>&nbsp;<span class="op" id="6298142">|</span>&nbsp;<span class="ident" id="6298144">fAny</span><span class="op" id="6298148">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298153">if</span>&nbsp;<span class="ident" id="6298156">err</span>&nbsp;<span class="op" id="6298160">:=</span>&nbsp;<span class="ident" id="6298163">s</span><span class="op" id="6298164">.</span><span class="ident" id="6298165">trim</span><span class="op" id="6298169">(</span><span class="ident" id="6298170">finfo</span><span class="op" id="6298175">.</span><span class="ident" id="6298176">parents</span><span class="op" id="6298183">)</span><span class="op" id="6298184">;</span>&nbsp;<span class="ident" id="6298186">err</span>&nbsp;<span class="op" id="6298190">!=</span>&nbsp;<span class="ident" id="6298193">nil</span>&nbsp;<span class="op" id="6298197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298203">return</span>&nbsp;<span class="ident" id="6298210">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298217">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298222">if</span>&nbsp;<span class="builtinfunc" id="6298225">len</span><span class="op" id="6298228">(</span><span class="ident" id="6298229">finfo</span><span class="op" id="6298234">.</span><span class="ident" id="6298235">parents</span><span class="op" id="6298242">)</span>&nbsp;<span class="op" id="6298244">&gt;</span>&nbsp;<span class="builtinfunc" id="6298246">len</span><span class="op" id="6298249">(</span><span class="ident" id="6298250">s</span><span class="op" id="6298251">.</span><span class="ident" id="6298252">stack</span><span class="op" id="6298257">)</span>&nbsp;<span class="op" id="6298259">{</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298265">if</span>&nbsp;<span class="ident" id="6298268">vf</span><span class="op" id="6298270">.</span><span class="ident" id="6298271">Kind</span><span class="op" id="6298275">(</span><span class="op" id="6298276">)</span>&nbsp;<span class="op" id="6298278">!=</span>&nbsp;<span class="ident" id="6298281">reflect</span><span class="op" id="6298288">.</span><span class="ident" id="6298289">Ptr</span>&nbsp;<span class="op" id="6298293">&amp;&amp;</span>&nbsp;<span class="ident" id="6298296">vf</span><span class="op" id="6298298">.</span><span class="ident" id="6298299">Kind</span><span class="op" id="6298303">(</span><span class="op" id="6298304">)</span>&nbsp;<span class="op" id="6298306">!=</span>&nbsp;<span class="ident" id="6298309">reflect</span><span class="op" id="6298316">.</span><span class="ident" id="6298317">Interface</span>&nbsp;<span class="op" id="6298327">||</span>&nbsp;<span class="op" id="6298330">!</span><span class="ident" id="6298331">vf</span><span class="op" id="6298333">.</span><span class="ident" id="6298334">IsNil</span><span class="op" id="6298339">(</span><span class="op" id="6298340">)</span>&nbsp;<span class="op" id="6298342">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298349">if</span>&nbsp;<span class="ident" id="6298352">err</span>&nbsp;<span class="op" id="6298356">:=</span>&nbsp;<span class="ident" id="6298359">s</span><span class="op" id="6298360">.</span><span class="ident" id="6298361">push</span><span class="op" id="6298365">(</span><span class="ident" id="6298366">finfo</span><span class="op" id="6298371">.</span><span class="ident" id="6298372">parents</span><span class="op" id="6298379">[</span><span class="builtinfunc" id="6298380">len</span><span class="op" id="6298383">(</span><span class="ident" id="6298384">s</span><span class="op" id="6298385">.</span><span class="ident" id="6298386">stack</span><span class="op" id="6298391">)</span><span class="op" id="6298392">:</span><span class="op" id="6298393">]</span><span class="op" id="6298394">)</span><span class="op" id="6298395">;</span>&nbsp;<span class="ident" id="6298397">err</span>&nbsp;<span class="op" id="6298401">!=</span>&nbsp;<span class="ident" id="6298404">nil</span>&nbsp;<span class="op" id="6298408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298416">return</span>&nbsp;<span class="ident" id="6298423">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298432">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298438">}</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298447">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298451">if</span>&nbsp;<span class="ident" id="6298454">err</span>&nbsp;<span class="op" id="6298458">:=</span>&nbsp;<span class="ident" id="6298461">p</span><span class="op" id="6298462">.</span><span class="ident" id="6298463">marshalValue</span><span class="op" id="6298475">(</span><span class="ident" id="6298476">vf</span><span class="op" id="6298478">,</span>&nbsp;<span class="ident" id="6298480">finfo</span><span class="op" id="6298485">,</span>&nbsp;<span class="ident" id="6298487">nil</span><span class="op" id="6298490">)</span><span class="op" id="6298491">;</span>&nbsp;<span class="ident" id="6298493">err</span>&nbsp;<span class="op" id="6298497">!=</span>&nbsp;<span class="ident" id="6298500">nil</span>&nbsp;<span class="op" id="6298504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298509">return</span>&nbsp;<span class="ident" id="6298516">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298522">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298525">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298528">s</span><span class="op" id="6298529">.</span><span class="ident" id="6298530">trim</span><span class="op" id="6298534">(</span><span class="ident" id="6298535">nil</span><span class="op" id="6298538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298541">return</span>&nbsp;<span class="ident" id="6298548">p</span><span class="op" id="6298549">.</span><span class="ident" id="6298550">cachedWriteError</span><span class="op" id="6298566">(</span><span class="op" id="6298567">)</span><br>
<span class="lineno"></span><span class="op" id="6298569">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">840</span><span class="comment" id="6298572">//&nbsp;return&nbsp;the&nbsp;bufio&nbsp;Writer&#39;s&nbsp;cached&nbsp;write&nbsp;error</span><br>
<span class="lineno"></span><span class="keyword" id="6298620">func</span>&nbsp;<span class="op" id="6298625">(</span><span class="ident" id="6298626">p</span>&nbsp;<span class="op" id="6298628">*</span><span class="ident" id="6298629">printer</span><span class="op" id="6298636">)</span>&nbsp;<span class="ident" id="6298638">cachedWriteError</span><span class="op" id="6298654">(</span><span class="op" id="6298655">)</span>&nbsp;<span class="builtintype" id="6298657">error</span>&nbsp;<span class="op" id="6298663">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298666">_</span><span class="op" id="6298667">,</span>&nbsp;<span class="ident" id="6298669">err</span>&nbsp;<span class="op" id="6298673">:=</span>&nbsp;<span class="ident" id="6298676">p</span><span class="op" id="6298677">.</span><span class="ident" id="6298678">Write</span><span class="op" id="6298683">(</span><span class="ident" id="6298684">nil</span><span class="op" id="6298687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298690">return</span>&nbsp;<span class="ident" id="6298697">err</span><br>
<span class="lineno"></span><span class="op" id="6298701">}</span><br>
<span class="lineno">845</span><br>
<span class="lineno"></span><span class="keyword" id="6298704">func</span>&nbsp;<span class="op" id="6298709">(</span><span class="ident" id="6298710">p</span>&nbsp;<span class="op" id="6298712">*</span><span class="ident" id="6298713">printer</span><span class="op" id="6298720">)</span>&nbsp;<span class="ident" id="6298722">writeIndent</span><span class="op" id="6298733">(</span><span class="ident" id="6298734">depthDelta</span>&nbsp;<span class="builtintype" id="6298745">int</span><span class="op" id="6298748">)</span>&nbsp;<span class="op" id="6298750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298753">if</span>&nbsp;<span class="builtinfunc" id="6298756">len</span><span class="op" id="6298759">(</span><span class="ident" id="6298760">p</span><span class="op" id="6298761">.</span><span class="ident" id="6298762">prefix</span><span class="op" id="6298768">)</span>&nbsp;<span class="op" id="6298770">==</span>&nbsp;<span class="num" id="6298773">0</span>&nbsp;<span class="op" id="6298775">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="6298778">len</span><span class="op" id="6298781">(</span><span class="ident" id="6298782">p</span><span class="op" id="6298783">.</span><span class="ident" id="6298784">indent</span><span class="op" id="6298790">)</span>&nbsp;<span class="op" id="6298792">==</span>&nbsp;<span class="num" id="6298795">0</span>&nbsp;<span class="op" id="6298797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298801">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298809">}</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298812">if</span>&nbsp;<span class="ident" id="6298815">depthDelta</span>&nbsp;<span class="op" id="6298826">&lt;</span>&nbsp;<span class="num" id="6298828">0</span>&nbsp;<span class="op" id="6298830">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298834">p</span><span class="op" id="6298835">.</span><span class="ident" id="6298836">depth</span><span class="op" id="6298841">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298846">if</span>&nbsp;<span class="ident" id="6298849">p</span><span class="op" id="6298850">.</span><span class="ident" id="6298851">indentedIn</span>&nbsp;<span class="op" id="6298862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298867">p</span><span class="op" id="6298868">.</span><span class="ident" id="6298869">indentedIn</span>&nbsp;<span class="op" id="6298880">=</span>&nbsp;<span class="builtintype" id="6298882">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298891">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298900">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298904">p</span><span class="op" id="6298905">.</span><span class="ident" id="6298906">indentedIn</span>&nbsp;<span class="op" id="6298917">=</span>&nbsp;<span class="builtintype" id="6298919">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298926">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6298929">if</span>&nbsp;<span class="ident" id="6298932">p</span><span class="op" id="6298933">.</span><span class="ident" id="6298934">putNewline</span>&nbsp;<span class="op" id="6298945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298949">p</span><span class="op" id="6298950">.</span><span class="ident" id="6298951">WriteByte</span><span class="op" id="6298960">(</span><span class="string" id="6298961">&#39;\n&#39;</span><span class="op" id="6298965">)</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6298968">}</span>&nbsp;<span class="keyword" id="6298970">else</span>&nbsp;<span class="op" id="6298975">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6298979">p</span><span class="op" id="6298980">.</span><span class="ident" id="6298981">putNewline</span>&nbsp;<span class="op" id="6298992">=</span>&nbsp;<span class="builtintype" id="6298994">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299003">if</span>&nbsp;<span class="builtinfunc" id="6299006">len</span><span class="op" id="6299009">(</span><span class="ident" id="6299010">p</span><span class="op" id="6299011">.</span><span class="ident" id="6299012">prefix</span><span class="op" id="6299018">)</span>&nbsp;<span class="op" id="6299020">&gt;</span>&nbsp;<span class="num" id="6299022">0</span>&nbsp;<span class="op" id="6299024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299028">p</span><span class="op" id="6299029">.</span><span class="ident" id="6299030">WriteString</span><span class="op" id="6299041">(</span><span class="ident" id="6299042">p</span><span class="op" id="6299043">.</span><span class="ident" id="6299044">prefix</span><span class="op" id="6299050">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299056">if</span>&nbsp;<span class="builtinfunc" id="6299059">len</span><span class="op" id="6299062">(</span><span class="ident" id="6299063">p</span><span class="op" id="6299064">.</span><span class="ident" id="6299065">indent</span><span class="op" id="6299071">)</span>&nbsp;<span class="op" id="6299073">&gt;</span>&nbsp;<span class="num" id="6299075">0</span>&nbsp;<span class="op" id="6299077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299081">for</span>&nbsp;<span class="ident" id="6299085">i</span>&nbsp;<span class="op" id="6299087">:=</span>&nbsp;<span class="num" id="6299090">0</span><span class="op" id="6299091">;</span>&nbsp;<span class="ident" id="6299093">i</span>&nbsp;<span class="op" id="6299095">&lt;</span>&nbsp;<span class="ident" id="6299097">p</span><span class="op" id="6299098">.</span><span class="ident" id="6299099">depth</span><span class="op" id="6299104">;</span>&nbsp;<span class="ident" id="6299106">i</span><span class="op" id="6299107">++</span>&nbsp;<span class="op" id="6299110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299115">p</span><span class="op" id="6299116">.</span><span class="ident" id="6299117">WriteString</span><span class="op" id="6299128">(</span><span class="ident" id="6299129">p</span><span class="op" id="6299130">.</span><span class="ident" id="6299131">indent</span><span class="op" id="6299137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299141">}</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299147">if</span>&nbsp;<span class="ident" id="6299150">depthDelta</span>&nbsp;<span class="op" id="6299161">&gt;</span>&nbsp;<span class="num" id="6299163">0</span>&nbsp;<span class="op" id="6299165">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299169">p</span><span class="op" id="6299170">.</span><span class="ident" id="6299171">depth</span><span class="op" id="6299176">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299181">p</span><span class="op" id="6299182">.</span><span class="ident" id="6299183">indentedIn</span>&nbsp;<span class="op" id="6299194">=</span>&nbsp;<span class="builtintype" id="6299196">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299202">}</span><br>
<span class="lineno">875</span><span class="op" id="6299204">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6299207">type</span>&nbsp;<span class="ident" id="6299212">parentStack</span>&nbsp;<span class="keyword" id="6299224">struct</span>&nbsp;<span class="op" id="6299231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299234">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6299240">*</span><span class="ident" id="6299241">printer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299250">stack</span>&nbsp;<span class="op" id="6299256">[</span><span class="op" id="6299257">]</span><span class="builtintype" id="6299258">string</span><br>
<span class="lineno">880</span><span class="op" id="6299265">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6299268">//&nbsp;trim&nbsp;updates&nbsp;the&nbsp;XML&nbsp;context&nbsp;to&nbsp;match&nbsp;the&nbsp;longest&nbsp;common&nbsp;prefix&nbsp;of&nbsp;the&nbsp;stack</span><br>
<span class="lineno"></span><span class="comment" id="6299348">//&nbsp;and&nbsp;the&nbsp;given&nbsp;parents.&nbsp;&nbsp;A&nbsp;closing&nbsp;tag&nbsp;will&nbsp;be&nbsp;written&nbsp;for&nbsp;every&nbsp;parent</span><br>
<span class="lineno"></span><span class="comment" id="6299422">//&nbsp;popped.&nbsp;&nbsp;Passing&nbsp;a&nbsp;zero&nbsp;slice&nbsp;or&nbsp;nil&nbsp;will&nbsp;close&nbsp;all&nbsp;the&nbsp;elements.</span><br>
<span class="lineno">885</span><span class="keyword" id="6299491">func</span>&nbsp;<span class="op" id="6299496">(</span><span class="ident" id="6299497">s</span>&nbsp;<span class="op" id="6299499">*</span><span class="ident" id="6299500">parentStack</span><span class="op" id="6299511">)</span>&nbsp;<span class="ident" id="6299513">trim</span><span class="op" id="6299517">(</span><span class="ident" id="6299518">parents</span>&nbsp;<span class="op" id="6299526">[</span><span class="op" id="6299527">]</span><span class="builtintype" id="6299528">string</span><span class="op" id="6299534">)</span>&nbsp;<span class="builtintype" id="6299536">error</span>&nbsp;<span class="op" id="6299542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299545">split</span>&nbsp;<span class="op" id="6299551">:=</span>&nbsp;<span class="num" id="6299554">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299557">for</span>&nbsp;<span class="op" id="6299561">;</span>&nbsp;<span class="ident" id="6299563">split</span>&nbsp;<span class="op" id="6299569">&lt;</span>&nbsp;<span class="builtinfunc" id="6299571">len</span><span class="op" id="6299574">(</span><span class="ident" id="6299575">parents</span><span class="op" id="6299582">)</span>&nbsp;<span class="op" id="6299584">&amp;&amp;</span>&nbsp;<span class="ident" id="6299587">split</span>&nbsp;<span class="op" id="6299593">&lt;</span>&nbsp;<span class="builtinfunc" id="6299595">len</span><span class="op" id="6299598">(</span><span class="ident" id="6299599">s</span><span class="op" id="6299600">.</span><span class="ident" id="6299601">stack</span><span class="op" id="6299606">)</span><span class="op" id="6299607">;</span>&nbsp;<span class="ident" id="6299609">split</span><span class="op" id="6299614">++</span>&nbsp;<span class="op" id="6299617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299621">if</span>&nbsp;<span class="ident" id="6299624">parents</span><span class="op" id="6299631">[</span><span class="ident" id="6299632">split</span><span class="op" id="6299637">]</span>&nbsp;<span class="op" id="6299639">!=</span>&nbsp;<span class="ident" id="6299642">s</span><span class="op" id="6299643">.</span><span class="ident" id="6299644">stack</span><span class="op" id="6299649">[</span><span class="ident" id="6299650">split</span><span class="op" id="6299655">]</span>&nbsp;<span class="op" id="6299657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299662">break</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299670">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299676">for</span>&nbsp;<span class="ident" id="6299680">i</span>&nbsp;<span class="op" id="6299682">:=</span>&nbsp;<span class="builtinfunc" id="6299685">len</span><span class="op" id="6299688">(</span><span class="ident" id="6299689">s</span><span class="op" id="6299690">.</span><span class="ident" id="6299691">stack</span><span class="op" id="6299696">)</span>&nbsp;<span class="op" id="6299698">-</span>&nbsp;<span class="num" id="6299700">1</span><span class="op" id="6299701">;</span>&nbsp;<span class="ident" id="6299703">i</span>&nbsp;<span class="op" id="6299705">&gt;=</span>&nbsp;<span class="ident" id="6299708">split</span><span class="op" id="6299713">;</span>&nbsp;<span class="ident" id="6299715">i</span><span class="op" id="6299716">--</span>&nbsp;<span class="op" id="6299719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299723">if</span>&nbsp;<span class="ident" id="6299726">err</span>&nbsp;<span class="op" id="6299730">:=</span>&nbsp;<span class="ident" id="6299733">s</span><span class="op" id="6299734">.</span><span class="ident" id="6299735">p</span><span class="op" id="6299736">.</span><span class="ident" id="6299737">writeEnd</span><span class="op" id="6299745">(</span><span class="ident" id="6299746">Name</span><span class="op" id="6299750">{</span><span class="ident" id="6299751">Local</span><span class="op" id="6299756">:</span>&nbsp;<span class="ident" id="6299758">s</span><span class="op" id="6299759">.</span><span class="ident" id="6299760">stack</span><span class="op" id="6299765">[</span><span class="ident" id="6299766">i</span><span class="op" id="6299767">]</span><span class="op" id="6299768">}</span><span class="op" id="6299769">)</span><span class="op" id="6299770">;</span>&nbsp;<span class="ident" id="6299772">err</span>&nbsp;<span class="op" id="6299776">!=</span>&nbsp;<span class="ident" id="6299779">nil</span>&nbsp;<span class="op" id="6299783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299788">return</span>&nbsp;<span class="ident" id="6299795">err</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6299804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6299807">s</span><span class="op" id="6299808">.</span><span class="ident" id="6299809">stack</span>&nbsp;<span class="op" id="6299815">=</span>&nbsp;<span class="ident" id="6299817">parents</span><span class="op" id="6299824">[</span><span class="op" id="6299825">:</span><span class="ident" id="6299826">split</span><span class="op" id="6299831">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299834">return</span>&nbsp;<span class="ident" id="6299841">nil</span><br>
<span class="lineno"></span><span class="op" id="6299845">}</span><br>
<span class="lineno">900</span><br>
<span class="lineno"></span><span class="comment" id="6299848">//&nbsp;push&nbsp;adds&nbsp;parent&nbsp;elements&nbsp;to&nbsp;the&nbsp;stack&nbsp;and&nbsp;writes&nbsp;open&nbsp;tags.</span><br>
<span class="lineno"></span><span class="keyword" id="6299912">func</span>&nbsp;<span class="op" id="6299917">(</span><span class="ident" id="6299918">s</span>&nbsp;<span class="op" id="6299920">*</span><span class="ident" id="6299921">parentStack</span><span class="op" id="6299932">)</span>&nbsp;<span class="ident" id="6299934">push</span><span class="op" id="6299938">(</span><span class="ident" id="6299939">parents</span>&nbsp;<span class="op" id="6299947">[</span><span class="op" id="6299948">]</span><span class="builtintype" id="6299949">string</span><span class="op" id="6299955">)</span>&nbsp;<span class="builtintype" id="6299957">error</span>&nbsp;<span class="op" id="6299963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6299966">for</span>&nbsp;<span class="ident" id="6299970">i</span>&nbsp;<span class="op" id="6299972">:=</span>&nbsp;<span class="num" id="6299975">0</span><span class="op" id="6299976">;</span>&nbsp;<span class="ident" id="6299978">i</span>&nbsp;<span class="op" id="6299980">&lt;</span>&nbsp;<span class="builtinfunc" id="6299982">len</span><span class="op" id="6299985">(</span><span class="ident" id="6299986">parents</span><span class="op" id="6299993">)</span><span class="op" id="6299994">;</span>&nbsp;<span class="ident" id="6299996">i</span><span class="op" id="6299997">++</span>&nbsp;<span class="op" id="6300000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300004">if</span>&nbsp;<span class="ident" id="6300007">err</span>&nbsp;<span class="op" id="6300011">:=</span>&nbsp;<span class="ident" id="6300014">s</span><span class="op" id="6300015">.</span><span class="ident" id="6300016">p</span><span class="op" id="6300017">.</span><span class="ident" id="6300018">writeStart</span><span class="op" id="6300028">(</span><span class="op" id="6300029">&amp;</span><span class="ident" id="6300030">StartElement</span><span class="op" id="6300042">{</span><span class="ident" id="6300043">Name</span><span class="op" id="6300047">:</span>&nbsp;<span class="ident" id="6300049">Name</span><span class="op" id="6300053">{</span><span class="ident" id="6300054">Local</span><span class="op" id="6300059">:</span>&nbsp;<span class="ident" id="6300061">parents</span><span class="op" id="6300068">[</span><span class="ident" id="6300069">i</span><span class="op" id="6300070">]</span><span class="op" id="6300071">}</span><span class="op" id="6300072">}</span><span class="op" id="6300073">)</span><span class="op" id="6300074">;</span>&nbsp;<span class="ident" id="6300076">err</span>&nbsp;<span class="op" id="6300080">!=</span>&nbsp;<span class="ident" id="6300083">nil</span>&nbsp;<span class="op" id="6300087">{</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300092">return</span>&nbsp;<span class="ident" id="6300099">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300105">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300111">s</span><span class="op" id="6300112">.</span><span class="ident" id="6300113">stack</span>&nbsp;<span class="op" id="6300119">=</span>&nbsp;<span class="builtinfunc" id="6300121">append</span><span class="op" id="6300127">(</span><span class="ident" id="6300128">s</span><span class="op" id="6300129">.</span><span class="ident" id="6300130">stack</span><span class="op" id="6300135">,</span>&nbsp;<span class="ident" id="6300137">parents</span><span class="op" id="6300144">...</span><span class="op" id="6300147">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300150">return</span>&nbsp;<span class="ident" id="6300157">nil</span><br>
<span class="lineno">910</span><span class="op" id="6300161">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300164">//&nbsp;A&nbsp;MarshalXMLError&nbsp;is&nbsp;returned&nbsp;when&nbsp;Marshal&nbsp;encounters&nbsp;a&nbsp;type</span><br>
<span class="lineno"></span><span class="comment" id="6300228">//&nbsp;that&nbsp;cannot&nbsp;be&nbsp;converted&nbsp;into&nbsp;XML.</span><br>
<span class="lineno"></span><span class="keyword" id="6300266">type</span>&nbsp;<span class="ident" id="6300271">UnsupportedTypeError</span>&nbsp;<span class="keyword" id="6300292">struct</span>&nbsp;<span class="op" id="6300299">{</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6300302">Type</span>&nbsp;<span class="ident" id="6300307">reflect</span><span class="op" id="6300314">.</span><span class="ident" id="6300315">Type</span><br>
<span class="lineno"></span><span class="op" id="6300320">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300323">func</span>&nbsp;<span class="op" id="6300328">(</span><span class="ident" id="6300329">e</span>&nbsp;<span class="op" id="6300331">*</span><span class="ident" id="6300332">UnsupportedTypeError</span><span class="op" id="6300352">)</span>&nbsp;<span class="ident" id="6300354">Error</span><span class="op" id="6300359">(</span><span class="op" id="6300360">)</span>&nbsp;<span class="builtintype" id="6300362">string</span>&nbsp;<span class="op" id="6300369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300372">return</span>&nbsp;<span class="string" id="6300379">&#34;xml:&nbsp;unsupported&nbsp;type:&nbsp;&#34;</span>&nbsp;<span class="op" id="6300405">+</span>&nbsp;<span class="ident" id="6300407">e</span><span class="op" id="6300408">.</span><span class="ident" id="6300409">Type</span><span class="op" id="6300413">.</span><span class="ident" id="6300414">String</span><span class="op" id="6300420">(</span><span class="op" id="6300421">)</span><br>
<span class="lineno">920</span><span class="op" id="6300423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300426">func</span>&nbsp;<span class="ident" id="6300431">isEmptyValue</span><span class="op" id="6300443">(</span><span class="ident" id="6300444">v</span>&nbsp;<span class="ident" id="6300446">reflect</span><span class="op" id="6300453">.</span><span class="ident" id="6300454">Value</span><span class="op" id="6300459">)</span>&nbsp;<span class="builtintype" id="6300461">bool</span>&nbsp;<span class="op" id="6300466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300469">switch</span>&nbsp;<span class="ident" id="6300476">v</span><span class="op" id="6300477">.</span><span class="ident" id="6300478">Kind</span><span class="op" id="6300482">(</span><span class="op" id="6300483">)</span>&nbsp;<span class="op" id="6300485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300488">case</span>&nbsp;<span class="ident" id="6300493">reflect</span><span class="op" id="6300500">.</span><span class="ident" id="6300501">Array</span><span class="op" id="6300506">,</span>&nbsp;<span class="ident" id="6300508">reflect</span><span class="op" id="6300515">.</span><span class="ident" id="6300516">Map</span><span class="op" id="6300519">,</span>&nbsp;<span class="ident" id="6300521">reflect</span><span class="op" id="6300528">.</span><span class="ident" id="6300529">Slice</span><span class="op" id="6300534">,</span>&nbsp;<span class="ident" id="6300536">reflect</span><span class="op" id="6300543">.</span><span class="ident" id="6300544">String</span><span class="op" id="6300550">:</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300554">return</span>&nbsp;<span class="ident" id="6300561">v</span><span class="op" id="6300562">.</span><span class="ident" id="6300563">Len</span><span class="op" id="6300566">(</span><span class="op" id="6300567">)</span>&nbsp;<span class="op" id="6300569">==</span>&nbsp;<span class="num" id="6300572">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300575">case</span>&nbsp;<span class="ident" id="6300580">reflect</span><span class="op" id="6300587">.</span><span class="ident" id="6300588">Bool</span><span class="op" id="6300592">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300596">return</span>&nbsp;<span class="op" id="6300603">!</span><span class="ident" id="6300604">v</span><span class="op" id="6300605">.</span><span class="ident" id="6300606">Bool</span><span class="op" id="6300610">(</span><span class="op" id="6300611">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300614">case</span>&nbsp;<span class="ident" id="6300619">reflect</span><span class="op" id="6300626">.</span><span class="ident" id="6300627">Int</span><span class="op" id="6300630">,</span>&nbsp;<span class="ident" id="6300632">reflect</span><span class="op" id="6300639">.</span><span class="ident" id="6300640">Int8</span><span class="op" id="6300644">,</span>&nbsp;<span class="ident" id="6300646">reflect</span><span class="op" id="6300653">.</span><span class="ident" id="6300654">Int16</span><span class="op" id="6300659">,</span>&nbsp;<span class="ident" id="6300661">reflect</span><span class="op" id="6300668">.</span><span class="ident" id="6300669">Int32</span><span class="op" id="6300674">,</span>&nbsp;<span class="ident" id="6300676">reflect</span><span class="op" id="6300683">.</span><span class="ident" id="6300684">Int64</span><span class="op" id="6300689">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300693">return</span>&nbsp;<span class="ident" id="6300700">v</span><span class="op" id="6300701">.</span><span class="ident" id="6300702">Int</span><span class="op" id="6300705">(</span><span class="op" id="6300706">)</span>&nbsp;<span class="op" id="6300708">==</span>&nbsp;<span class="num" id="6300711">0</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300714">case</span>&nbsp;<span class="ident" id="6300719">reflect</span><span class="op" id="6300726">.</span><span class="ident" id="6300727">Uint</span><span class="op" id="6300731">,</span>&nbsp;<span class="ident" id="6300733">reflect</span><span class="op" id="6300740">.</span><span class="ident" id="6300741">Uint8</span><span class="op" id="6300746">,</span>&nbsp;<span class="ident" id="6300748">reflect</span><span class="op" id="6300755">.</span><span class="ident" id="6300756">Uint16</span><span class="op" id="6300762">,</span>&nbsp;<span class="ident" id="6300764">reflect</span><span class="op" id="6300771">.</span><span class="ident" id="6300772">Uint32</span><span class="op" id="6300778">,</span>&nbsp;<span class="ident" id="6300780">reflect</span><span class="op" id="6300787">.</span><span class="ident" id="6300788">Uint64</span><span class="op" id="6300794">,</span>&nbsp;<span class="ident" id="6300796">reflect</span><span class="op" id="6300803">.</span><span class="ident" id="6300804">Uintptr</span><span class="op" id="6300811">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300815">return</span>&nbsp;<span class="ident" id="6300822">v</span><span class="op" id="6300823">.</span><span class="ident" id="6300824">Uint</span><span class="op" id="6300828">(</span><span class="op" id="6300829">)</span>&nbsp;<span class="op" id="6300831">==</span>&nbsp;<span class="num" id="6300834">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300837">case</span>&nbsp;<span class="ident" id="6300842">reflect</span><span class="op" id="6300849">.</span><span class="ident" id="6300850">Float32</span><span class="op" id="6300857">,</span>&nbsp;<span class="ident" id="6300859">reflect</span><span class="op" id="6300866">.</span><span class="ident" id="6300867">Float64</span><span class="op" id="6300874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300878">return</span>&nbsp;<span class="ident" id="6300885">v</span><span class="op" id="6300886">.</span><span class="ident" id="6300887">Float</span><span class="op" id="6300892">(</span><span class="op" id="6300893">)</span>&nbsp;<span class="op" id="6300895">==</span>&nbsp;<span class="num" id="6300898">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300901">case</span>&nbsp;<span class="ident" id="6300906">reflect</span><span class="op" id="6300913">.</span><span class="ident" id="6300914">Interface</span><span class="op" id="6300923">,</span>&nbsp;<span class="ident" id="6300925">reflect</span><span class="op" id="6300932">.</span><span class="ident" id="6300933">Ptr</span><span class="op" id="6300936">:</span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300940">return</span>&nbsp;<span class="ident" id="6300947">v</span><span class="op" id="6300948">.</span><span class="ident" id="6300949">IsNil</span><span class="op" id="6300954">(</span><span class="op" id="6300955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6300958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6300961">return</span>&nbsp;<span class="builtintype" id="6300968">false</span><br>
<span class="lineno"></span><span class="op" id="6300974">}</span>
</div>
</body>
</html>
