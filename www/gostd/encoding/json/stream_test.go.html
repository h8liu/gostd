<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6827387">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6827443">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6827497">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6827548">package</span>&nbsp;<span class="ident" id="6827556">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827562">import</span>&nbsp;<span class="op" id="6827569">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827572">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827581">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827594">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827601">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827612">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827623">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6827633">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="6827636">//&nbsp;Test&nbsp;values&nbsp;for&nbsp;the&nbsp;stream&nbsp;test.</span><br>
<span class="lineno"></span><span class="comment" id="6827672">//&nbsp;One&nbsp;of&nbsp;each&nbsp;JSON&nbsp;kind.</span><br>
<span class="lineno"></span><span class="keyword" id="6827698">var</span>&nbsp;<span class="ident" id="6827702">streamTest</span>&nbsp;<span class="op" id="6827713">=</span>&nbsp;<span class="op" id="6827715">[</span><span class="op" id="6827716">]</span><span class="keyword" id="6827717">interface</span><span class="op" id="6827726">{</span><span class="op" id="6827727">}</span><span class="op" id="6827728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6827731">0.1</span><span class="op" id="6827734">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6827737">&#34;hello&#34;</span><span class="op" id="6827744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6827747">nil</span><span class="op" id="6827750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6827753">true</span><span class="op" id="6827757">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="6827760">false</span><span class="op" id="6827765">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6827768">[</span><span class="op" id="6827769">]</span><span class="keyword" id="6827770">interface</span><span class="op" id="6827779">{</span><span class="op" id="6827780">}</span><span class="op" id="6827781">{</span><span class="string" id="6827782">&#34;a&#34;</span><span class="op" id="6827785">,</span>&nbsp;<span class="string" id="6827787">&#34;b&#34;</span><span class="op" id="6827790">,</span>&nbsp;<span class="string" id="6827792">&#34;c&#34;</span><span class="op" id="6827795">}</span><span class="op" id="6827796">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6827799">map</span><span class="op" id="6827802">[</span><span class="builtintype" id="6827803">string</span><span class="op" id="6827809">]</span><span class="keyword" id="6827810">interface</span><span class="op" id="6827819">{</span><span class="op" id="6827820">}</span><span class="op" id="6827821">{</span><span class="string" id="6827822">&#34;K&#34;</span><span class="op" id="6827827">:</span>&nbsp;<span class="string" id="6827829">&#34;Kelvin&#34;</span><span class="op" id="6827837">,</span>&nbsp;<span class="string" id="6827839">&#34;ß&#34;</span><span class="op" id="6827843">:</span>&nbsp;<span class="string" id="6827845">&#34;long&nbsp;s&#34;</span><span class="op" id="6827853">}</span><span class="op" id="6827854">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="6827857">3.14</span><span class="op" id="6827861">,</span>&nbsp;<span class="comment" id="6827863">//&nbsp;another&nbsp;value&nbsp;to&nbsp;make&nbsp;sure&nbsp;something&nbsp;can&nbsp;follow&nbsp;map</span><br>
<span class="lineno"></span><span class="op" id="6827918">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6827921">var</span>&nbsp;<span class="ident" id="6827925">streamEncoded</span>&nbsp;<span class="op" id="6827939">=</span>&nbsp;<span class="string" id="6827941">`0.1<br>
<span class="lineno">30</span>&#34;hello&#34;<br>
<span class="lineno"></span>null<br>
<span class="lineno"></span>true<br>
<span class="lineno"></span>false<br>
<span class="lineno"></span>[&#34;a&#34;,&#34;b&#34;,&#34;c&#34;]<br>
<span class="lineno">35</span>{&#34;ß&#34;:&#34;long&nbsp;s&#34;,&#34;K&#34;:&#34;Kelvin&#34;}<br>
<span class="lineno"></span>3.14<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6828023">func</span>&nbsp;<span class="ident" id="6828028">TestEncoder</span><span class="op" id="6828039">(</span><span class="ident" id="6828040">t</span>&nbsp;<span class="op" id="6828042">*</span><span class="ident" id="6828043">testing</span><span class="op" id="6828050">.</span><span class="ident" id="6828051">T</span><span class="op" id="6828052">)</span>&nbsp;<span class="op" id="6828054">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828057">for</span>&nbsp;<span class="ident" id="6828061">i</span>&nbsp;<span class="op" id="6828063">:=</span>&nbsp;<span class="num" id="6828066">0</span><span class="op" id="6828067">;</span>&nbsp;<span class="ident" id="6828069">i</span>&nbsp;<span class="op" id="6828071">&lt;=</span>&nbsp;<span class="builtinfunc" id="6828074">len</span><span class="op" id="6828077">(</span><span class="ident" id="6828078">streamTest</span><span class="op" id="6828088">)</span><span class="op" id="6828089">;</span>&nbsp;<span class="ident" id="6828091">i</span><span class="op" id="6828092">++</span>&nbsp;<span class="op" id="6828095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828099">var</span>&nbsp;<span class="ident" id="6828103">buf</span>&nbsp;<span class="ident" id="6828107">bytes</span><span class="op" id="6828112">.</span><span class="ident" id="6828113">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828122">enc</span>&nbsp;<span class="op" id="6828126">:=</span>&nbsp;<span class="ident" id="6828129">NewEncoder</span><span class="op" id="6828139">(</span><span class="op" id="6828140">&amp;</span><span class="ident" id="6828141">buf</span><span class="op" id="6828144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828148">for</span>&nbsp;<span class="ident" id="6828152">j</span><span class="op" id="6828153">,</span>&nbsp;<span class="ident" id="6828155">v</span>&nbsp;<span class="op" id="6828157">:=</span>&nbsp;<span class="keyword" id="6828160">range</span>&nbsp;<span class="ident" id="6828166">streamTest</span><span class="op" id="6828176">[</span><span class="num" id="6828177">0</span><span class="op" id="6828178">:</span><span class="ident" id="6828179">i</span><span class="op" id="6828180">]</span>&nbsp;<span class="op" id="6828182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828187">if</span>&nbsp;<span class="ident" id="6828190">err</span>&nbsp;<span class="op" id="6828194">:=</span>&nbsp;<span class="ident" id="6828197">enc</span><span class="op" id="6828200">.</span><span class="ident" id="6828201">Encode</span><span class="op" id="6828207">(</span><span class="ident" id="6828208">v</span><span class="op" id="6828209">)</span><span class="op" id="6828210">;</span>&nbsp;<span class="ident" id="6828212">err</span>&nbsp;<span class="op" id="6828216">!=</span>&nbsp;<span class="ident" id="6828219">nil</span>&nbsp;<span class="op" id="6828223">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828229">t</span><span class="op" id="6828230">.</span><span class="ident" id="6828231">Fatalf</span><span class="op" id="6828237">(</span><span class="string" id="6828238">&#34;encode&nbsp;#%d:&nbsp;%v&#34;</span><span class="op" id="6828254">,</span>&nbsp;<span class="ident" id="6828256">j</span><span class="op" id="6828257">,</span>&nbsp;<span class="ident" id="6828259">err</span><span class="op" id="6828262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828267">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828275">if</span>&nbsp;<span class="ident" id="6828278">have</span><span class="op" id="6828282">,</span>&nbsp;<span class="ident" id="6828284">want</span>&nbsp;<span class="op" id="6828289">:=</span>&nbsp;<span class="ident" id="6828292">buf</span><span class="op" id="6828295">.</span><span class="ident" id="6828296">String</span><span class="op" id="6828302">(</span><span class="op" id="6828303">)</span><span class="op" id="6828304">,</span>&nbsp;<span class="ident" id="6828306">nlines</span><span class="op" id="6828312">(</span><span class="ident" id="6828313">streamEncoded</span><span class="op" id="6828326">,</span>&nbsp;<span class="ident" id="6828328">i</span><span class="op" id="6828329">)</span><span class="op" id="6828330">;</span>&nbsp;<span class="ident" id="6828332">have</span>&nbsp;<span class="op" id="6828337">!=</span>&nbsp;<span class="ident" id="6828340">want</span>&nbsp;<span class="op" id="6828345">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828350">t</span><span class="op" id="6828351">.</span><span class="ident" id="6828352">Errorf</span><span class="op" id="6828358">(</span><span class="string" id="6828359">&#34;encoding&nbsp;%d&nbsp;items:&nbsp;mismatch&#34;</span><span class="op" id="6828388">,</span>&nbsp;<span class="ident" id="6828390">i</span><span class="op" id="6828391">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828396">diff</span><span class="op" id="6828400">(</span><span class="ident" id="6828401">t</span><span class="op" id="6828402">,</span>&nbsp;<span class="op" id="6828404">[</span><span class="op" id="6828405">]</span><span class="builtintype" id="6828406">byte</span><span class="op" id="6828410">(</span><span class="ident" id="6828411">have</span><span class="op" id="6828415">)</span><span class="op" id="6828416">,</span>&nbsp;<span class="op" id="6828418">[</span><span class="op" id="6828419">]</span><span class="builtintype" id="6828420">byte</span><span class="op" id="6828424">(</span><span class="ident" id="6828425">want</span><span class="op" id="6828429">)</span><span class="op" id="6828430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828435">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828443">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828446">}</span><br>
<span class="lineno"></span><span class="op" id="6828448">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span><span class="keyword" id="6828451">func</span>&nbsp;<span class="ident" id="6828456">TestDecoder</span><span class="op" id="6828467">(</span><span class="ident" id="6828468">t</span>&nbsp;<span class="op" id="6828470">*</span><span class="ident" id="6828471">testing</span><span class="op" id="6828478">.</span><span class="ident" id="6828479">T</span><span class="op" id="6828480">)</span>&nbsp;<span class="op" id="6828482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828485">for</span>&nbsp;<span class="ident" id="6828489">i</span>&nbsp;<span class="op" id="6828491">:=</span>&nbsp;<span class="num" id="6828494">0</span><span class="op" id="6828495">;</span>&nbsp;<span class="ident" id="6828497">i</span>&nbsp;<span class="op" id="6828499">&lt;=</span>&nbsp;<span class="builtinfunc" id="6828502">len</span><span class="op" id="6828505">(</span><span class="ident" id="6828506">streamTest</span><span class="op" id="6828516">)</span><span class="op" id="6828517">;</span>&nbsp;<span class="ident" id="6828519">i</span><span class="op" id="6828520">++</span>&nbsp;<span class="op" id="6828523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828527">//&nbsp;Use&nbsp;stream&nbsp;without&nbsp;newlines&nbsp;as&nbsp;input,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828570">//&nbsp;just&nbsp;to&nbsp;stress&nbsp;the&nbsp;decoder&nbsp;even&nbsp;more.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828613">//&nbsp;Our&nbsp;test&nbsp;input&nbsp;does&nbsp;not&nbsp;include&nbsp;back-to-back&nbsp;numbers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828672">//&nbsp;Otherwise&nbsp;stripping&nbsp;the&nbsp;newlines&nbsp;would</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6828716">//&nbsp;merge&nbsp;two&nbsp;adjacent&nbsp;JSON&nbsp;values.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828753">var</span>&nbsp;<span class="ident" id="6828757">buf</span>&nbsp;<span class="ident" id="6828761">bytes</span><span class="op" id="6828766">.</span><span class="ident" id="6828767">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828776">for</span>&nbsp;<span class="ident" id="6828780">_</span><span class="op" id="6828781">,</span>&nbsp;<span class="ident" id="6828783">c</span>&nbsp;<span class="op" id="6828785">:=</span>&nbsp;<span class="keyword" id="6828788">range</span>&nbsp;<span class="ident" id="6828794">nlines</span><span class="op" id="6828800">(</span><span class="ident" id="6828801">streamEncoded</span><span class="op" id="6828814">,</span>&nbsp;<span class="ident" id="6828816">i</span><span class="op" id="6828817">)</span>&nbsp;<span class="op" id="6828819">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828824">if</span>&nbsp;<span class="ident" id="6828827">c</span>&nbsp;<span class="op" id="6828829">!=</span>&nbsp;<span class="string" id="6828832">&#39;\n&#39;</span>&nbsp;<span class="op" id="6828837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828843">buf</span><span class="op" id="6828846">.</span><span class="ident" id="6828847">WriteRune</span><span class="op" id="6828856">(</span><span class="ident" id="6828857">c</span><span class="op" id="6828858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6828867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828871">out</span>&nbsp;<span class="op" id="6828875">:=</span>&nbsp;<span class="builtinfunc" id="6828878">make</span><span class="op" id="6828882">(</span><span class="op" id="6828883">[</span><span class="op" id="6828884">]</span><span class="keyword" id="6828885">interface</span><span class="op" id="6828894">{</span><span class="op" id="6828895">}</span><span class="op" id="6828896">,</span>&nbsp;<span class="ident" id="6828898">i</span><span class="op" id="6828899">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6828903">dec</span>&nbsp;<span class="op" id="6828907">:=</span>&nbsp;<span class="ident" id="6828910">NewDecoder</span><span class="op" id="6828920">(</span><span class="op" id="6828921">&amp;</span><span class="ident" id="6828922">buf</span><span class="op" id="6828925">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828929">for</span>&nbsp;<span class="ident" id="6828933">j</span>&nbsp;<span class="op" id="6828935">:=</span>&nbsp;<span class="keyword" id="6828938">range</span>&nbsp;<span class="ident" id="6828944">out</span>&nbsp;<span class="op" id="6828948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6828953">if</span>&nbsp;<span class="ident" id="6828956">err</span>&nbsp;<span class="op" id="6828960">:=</span>&nbsp;<span class="ident" id="6828963">dec</span><span class="op" id="6828966">.</span><span class="ident" id="6828967">Decode</span><span class="op" id="6828973">(</span><span class="op" id="6828974">&amp;</span><span class="ident" id="6828975">out</span><span class="op" id="6828978">[</span><span class="ident" id="6828979">j</span><span class="op" id="6828980">]</span><span class="op" id="6828981">)</span><span class="op" id="6828982">;</span>&nbsp;<span class="ident" id="6828984">err</span>&nbsp;<span class="op" id="6828988">!=</span>&nbsp;<span class="ident" id="6828991">nil</span>&nbsp;<span class="op" id="6828995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829001">t</span><span class="op" id="6829002">.</span><span class="ident" id="6829003">Fatalf</span><span class="op" id="6829009">(</span><span class="string" id="6829010">&#34;decode&nbsp;#%d/%d:&nbsp;%v&#34;</span><span class="op" id="6829029">,</span>&nbsp;<span class="ident" id="6829031">j</span><span class="op" id="6829032">,</span>&nbsp;<span class="ident" id="6829034">i</span><span class="op" id="6829035">,</span>&nbsp;<span class="ident" id="6829037">err</span><span class="op" id="6829040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829045">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829049">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829053">if</span>&nbsp;<span class="op" id="6829056">!</span><span class="ident" id="6829057">reflect</span><span class="op" id="6829064">.</span><span class="ident" id="6829065">DeepEqual</span><span class="op" id="6829074">(</span><span class="ident" id="6829075">out</span><span class="op" id="6829078">,</span>&nbsp;<span class="ident" id="6829080">streamTest</span><span class="op" id="6829090">[</span><span class="num" id="6829091">0</span><span class="op" id="6829092">:</span><span class="ident" id="6829093">i</span><span class="op" id="6829094">]</span><span class="op" id="6829095">)</span>&nbsp;<span class="op" id="6829097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829102">t</span><span class="op" id="6829103">.</span><span class="ident" id="6829104">Errorf</span><span class="op" id="6829110">(</span><span class="string" id="6829111">&#34;decoding&nbsp;%d&nbsp;items:&nbsp;mismatch&#34;</span><span class="op" id="6829140">,</span>&nbsp;<span class="ident" id="6829142">i</span><span class="op" id="6829143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829148">for</span>&nbsp;<span class="ident" id="6829152">j</span>&nbsp;<span class="op" id="6829154">:=</span>&nbsp;<span class="keyword" id="6829157">range</span>&nbsp;<span class="ident" id="6829163">out</span>&nbsp;<span class="op" id="6829167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829173">if</span>&nbsp;<span class="op" id="6829176">!</span><span class="ident" id="6829177">reflect</span><span class="op" id="6829184">.</span><span class="ident" id="6829185">DeepEqual</span><span class="op" id="6829194">(</span><span class="ident" id="6829195">out</span><span class="op" id="6829198">[</span><span class="ident" id="6829199">j</span><span class="op" id="6829200">]</span><span class="op" id="6829201">,</span>&nbsp;<span class="ident" id="6829203">streamTest</span><span class="op" id="6829213">[</span><span class="ident" id="6829214">j</span><span class="op" id="6829215">]</span><span class="op" id="6829216">)</span>&nbsp;<span class="op" id="6829218">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829225">t</span><span class="op" id="6829226">.</span><span class="ident" id="6829227">Errorf</span><span class="op" id="6829233">(</span><span class="string" id="6829234">&#34;#%d:&nbsp;have&nbsp;%v&nbsp;want&nbsp;%v&#34;</span><span class="op" id="6829256">,</span>&nbsp;<span class="ident" id="6829258">j</span><span class="op" id="6829259">,</span>&nbsp;<span class="ident" id="6829261">out</span><span class="op" id="6829264">[</span><span class="ident" id="6829265">j</span><span class="op" id="6829266">]</span><span class="op" id="6829267">,</span>&nbsp;<span class="ident" id="6829269">streamTest</span><span class="op" id="6829279">[</span><span class="ident" id="6829280">j</span><span class="op" id="6829281">]</span><span class="op" id="6829282">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829298">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829306">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829309">}</span><br>
<span class="lineno"></span><span class="op" id="6829311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829314">func</span>&nbsp;<span class="ident" id="6829319">TestDecoderBuffered</span><span class="op" id="6829338">(</span><span class="ident" id="6829339">t</span>&nbsp;<span class="op" id="6829341">*</span><span class="ident" id="6829342">testing</span><span class="op" id="6829349">.</span><span class="ident" id="6829350">T</span><span class="op" id="6829351">)</span>&nbsp;<span class="op" id="6829353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829356">r</span>&nbsp;<span class="op" id="6829358">:=</span>&nbsp;<span class="ident" id="6829361">strings</span><span class="op" id="6829368">.</span><span class="ident" id="6829369">NewReader</span><span class="op" id="6829378">(</span><span class="string" id="6829379">`{&#34;Name&#34;:&nbsp;&#34;Gopher&#34;}&nbsp;extra&nbsp;`</span><span class="op" id="6829406">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829409">var</span>&nbsp;<span class="ident" id="6829413">m</span>&nbsp;<span class="keyword" id="6829415">struct</span>&nbsp;<span class="op" id="6829422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829426">Name</span>&nbsp;<span class="builtintype" id="6829431">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829442">d</span>&nbsp;<span class="op" id="6829444">:=</span>&nbsp;<span class="ident" id="6829447">NewDecoder</span><span class="op" id="6829457">(</span><span class="ident" id="6829458">r</span><span class="op" id="6829459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829462">err</span>&nbsp;<span class="op" id="6829466">:=</span>&nbsp;<span class="ident" id="6829469">d</span><span class="op" id="6829470">.</span><span class="ident" id="6829471">Decode</span><span class="op" id="6829477">(</span><span class="op" id="6829478">&amp;</span><span class="ident" id="6829479">m</span><span class="op" id="6829480">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829483">if</span>&nbsp;<span class="ident" id="6829486">err</span>&nbsp;<span class="op" id="6829490">!=</span>&nbsp;<span class="ident" id="6829493">nil</span>&nbsp;<span class="op" id="6829497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829501">t</span><span class="op" id="6829502">.</span><span class="ident" id="6829503">Fatal</span><span class="op" id="6829508">(</span><span class="ident" id="6829509">err</span><span class="op" id="6829512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829518">if</span>&nbsp;<span class="ident" id="6829521">m</span><span class="op" id="6829522">.</span><span class="ident" id="6829523">Name</span>&nbsp;<span class="op" id="6829528">!=</span>&nbsp;<span class="string" id="6829531">&#34;Gopher&#34;</span>&nbsp;<span class="op" id="6829540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829544">t</span><span class="op" id="6829545">.</span><span class="ident" id="6829546">Errorf</span><span class="op" id="6829552">(</span><span class="string" id="6829553">&#34;Name&nbsp;=&nbsp;%q;&nbsp;want&nbsp;Gopher&#34;</span><span class="op" id="6829577">,</span>&nbsp;<span class="ident" id="6829579">m</span><span class="op" id="6829580">.</span><span class="ident" id="6829581">Name</span><span class="op" id="6829585">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829591">rest</span><span class="op" id="6829595">,</span>&nbsp;<span class="ident" id="6829597">err</span>&nbsp;<span class="op" id="6829601">:=</span>&nbsp;<span class="ident" id="6829604">ioutil</span><span class="op" id="6829610">.</span><span class="ident" id="6829611">ReadAll</span><span class="op" id="6829618">(</span><span class="ident" id="6829619">d</span><span class="op" id="6829620">.</span><span class="ident" id="6829621">Buffered</span><span class="op" id="6829629">(</span><span class="op" id="6829630">)</span><span class="op" id="6829631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829634">if</span>&nbsp;<span class="ident" id="6829637">err</span>&nbsp;<span class="op" id="6829641">!=</span>&nbsp;<span class="ident" id="6829644">nil</span>&nbsp;<span class="op" id="6829648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829652">t</span><span class="op" id="6829653">.</span><span class="ident" id="6829654">Fatal</span><span class="op" id="6829659">(</span><span class="ident" id="6829660">err</span><span class="op" id="6829663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829666">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829669">if</span>&nbsp;<span class="ident" id="6829672">g</span><span class="op" id="6829673">,</span>&nbsp;<span class="ident" id="6829675">w</span>&nbsp;<span class="op" id="6829677">:=</span>&nbsp;<span class="builtintype" id="6829680">string</span><span class="op" id="6829686">(</span><span class="ident" id="6829687">rest</span><span class="op" id="6829691">)</span><span class="op" id="6829692">,</span>&nbsp;<span class="string" id="6829694">&#34;&nbsp;extra&nbsp;&#34;</span><span class="op" id="6829703">;</span>&nbsp;<span class="ident" id="6829705">g</span>&nbsp;<span class="op" id="6829707">!=</span>&nbsp;<span class="ident" id="6829710">w</span>&nbsp;<span class="op" id="6829712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6829716">t</span><span class="op" id="6829717">.</span><span class="ident" id="6829718">Errorf</span><span class="op" id="6829724">(</span><span class="string" id="6829725">&#34;Remaining&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6829750">,</span>&nbsp;<span class="ident" id="6829752">g</span><span class="op" id="6829753">,</span>&nbsp;<span class="ident" id="6829755">w</span><span class="op" id="6829756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829759">}</span><br>
<span class="lineno"></span><span class="op" id="6829761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="6829764">func</span>&nbsp;<span class="ident" id="6829769">nlines</span><span class="op" id="6829775">(</span><span class="ident" id="6829776">s</span>&nbsp;<span class="builtintype" id="6829778">string</span><span class="op" id="6829784">,</span>&nbsp;<span class="ident" id="6829786">n</span>&nbsp;<span class="builtintype" id="6829788">int</span><span class="op" id="6829791">)</span>&nbsp;<span class="builtintype" id="6829793">string</span>&nbsp;<span class="op" id="6829800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829803">if</span>&nbsp;<span class="ident" id="6829806">n</span>&nbsp;<span class="op" id="6829808">&lt;=</span>&nbsp;<span class="num" id="6829811">0</span>&nbsp;<span class="op" id="6829813">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829817">return</span>&nbsp;<span class="string" id="6829824">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829831">for</span>&nbsp;<span class="ident" id="6829835">i</span><span class="op" id="6829836">,</span>&nbsp;<span class="ident" id="6829838">c</span>&nbsp;<span class="op" id="6829840">:=</span>&nbsp;<span class="keyword" id="6829843">range</span>&nbsp;<span class="ident" id="6829849">s</span>&nbsp;<span class="op" id="6829851">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829855">if</span>&nbsp;<span class="ident" id="6829858">c</span>&nbsp;<span class="op" id="6829860">==</span>&nbsp;<span class="string" id="6829863">&#39;\n&#39;</span>&nbsp;<span class="op" id="6829868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829873">if</span>&nbsp;<span class="ident" id="6829876">n</span><span class="op" id="6829877">--</span><span class="op" id="6829879">;</span>&nbsp;<span class="ident" id="6829881">n</span>&nbsp;<span class="op" id="6829883">==</span>&nbsp;<span class="num" id="6829886">0</span>&nbsp;<span class="op" id="6829888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829894">return</span>&nbsp;<span class="ident" id="6829901">s</span><span class="op" id="6829902">[</span><span class="num" id="6829903">0</span>&nbsp;<span class="op" id="6829905">:</span>&nbsp;<span class="ident" id="6829907">i</span><span class="op" id="6829908">+</span><span class="num" id="6829909">1</span><span class="op" id="6829910">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829915">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829919">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6829922">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6829925">return</span>&nbsp;<span class="ident" id="6829932">s</span><br>
<span class="lineno"></span><span class="op" id="6829934">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6829937">func</span>&nbsp;<span class="ident" id="6829942">TestRawMessage</span><span class="op" id="6829956">(</span><span class="ident" id="6829957">t</span>&nbsp;<span class="op" id="6829959">*</span><span class="ident" id="6829960">testing</span><span class="op" id="6829967">.</span><span class="ident" id="6829968">T</span><span class="op" id="6829969">)</span>&nbsp;<span class="op" id="6829971">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6829974">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;not&nbsp;need&nbsp;the&nbsp;*&nbsp;in&nbsp;*RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830026">var</span>&nbsp;<span class="ident" id="6830030">data</span>&nbsp;<span class="keyword" id="6830035">struct</span>&nbsp;<span class="op" id="6830042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830046">X</span>&nbsp;&nbsp;<span class="builtintype" id="6830049">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830059">Id</span>&nbsp;<span class="op" id="6830062">*</span><span class="ident" id="6830063">RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830076">Y</span>&nbsp;&nbsp;<span class="builtintype" id="6830079">float32</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830091">const</span>&nbsp;<span class="ident" id="6830097">raw</span>&nbsp;<span class="op" id="6830101">=</span>&nbsp;<span class="string" id="6830103">`[&#34;\u0056&#34;,null]`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830122">const</span>&nbsp;<span class="ident" id="6830128">msg</span>&nbsp;<span class="op" id="6830132">=</span>&nbsp;<span class="string" id="6830134">`{&#34;X&#34;:0.1,&#34;Id&#34;:[&#34;\u0056&#34;,null],&#34;Y&#34;:0.2}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830176">err</span>&nbsp;<span class="op" id="6830180">:=</span>&nbsp;<span class="ident" id="6830183">Unmarshal</span><span class="op" id="6830192">(</span><span class="op" id="6830193">[</span><span class="op" id="6830194">]</span><span class="builtintype" id="6830195">byte</span><span class="op" id="6830199">(</span><span class="ident" id="6830200">msg</span><span class="op" id="6830203">)</span><span class="op" id="6830204">,</span>&nbsp;<span class="op" id="6830206">&amp;</span><span class="ident" id="6830207">data</span><span class="op" id="6830211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830214">if</span>&nbsp;<span class="ident" id="6830217">err</span>&nbsp;<span class="op" id="6830221">!=</span>&nbsp;<span class="ident" id="6830224">nil</span>&nbsp;<span class="op" id="6830228">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830232">t</span><span class="op" id="6830233">.</span><span class="ident" id="6830234">Fatalf</span><span class="op" id="6830240">(</span><span class="string" id="6830241">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6830256">,</span>&nbsp;<span class="ident" id="6830258">err</span><span class="op" id="6830261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830267">if</span>&nbsp;<span class="builtintype" id="6830270">string</span><span class="op" id="6830276">(</span><span class="op" id="6830277">[</span><span class="op" id="6830278">]</span><span class="builtintype" id="6830279">byte</span><span class="op" id="6830283">(</span><span class="op" id="6830284">*</span><span class="ident" id="6830285">data</span><span class="op" id="6830289">.</span><span class="ident" id="6830290">Id</span><span class="op" id="6830292">)</span><span class="op" id="6830293">)</span>&nbsp;<span class="op" id="6830295">!=</span>&nbsp;<span class="ident" id="6830298">raw</span>&nbsp;<span class="op" id="6830302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830306">t</span><span class="op" id="6830307">.</span><span class="ident" id="6830308">Fatalf</span><span class="op" id="6830314">(</span><span class="string" id="6830315">&#34;Raw&nbsp;mismatch:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6830348">,</span>&nbsp;<span class="op" id="6830350">[</span><span class="op" id="6830351">]</span><span class="builtintype" id="6830352">byte</span><span class="op" id="6830356">(</span><span class="op" id="6830357">*</span><span class="ident" id="6830358">data</span><span class="op" id="6830362">.</span><span class="ident" id="6830363">Id</span><span class="op" id="6830365">)</span><span class="op" id="6830366">,</span>&nbsp;<span class="ident" id="6830368">raw</span><span class="op" id="6830371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830374">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830377">b</span><span class="op" id="6830378">,</span>&nbsp;<span class="ident" id="6830380">err</span>&nbsp;<span class="op" id="6830384">:=</span>&nbsp;<span class="ident" id="6830387">Marshal</span><span class="op" id="6830394">(</span><span class="op" id="6830395">&amp;</span><span class="ident" id="6830396">data</span><span class="op" id="6830400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830403">if</span>&nbsp;<span class="ident" id="6830406">err</span>&nbsp;<span class="op" id="6830410">!=</span>&nbsp;<span class="ident" id="6830413">nil</span>&nbsp;<span class="op" id="6830417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830421">t</span><span class="op" id="6830422">.</span><span class="ident" id="6830423">Fatalf</span><span class="op" id="6830429">(</span><span class="string" id="6830430">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6830443">,</span>&nbsp;<span class="ident" id="6830445">err</span><span class="op" id="6830448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830454">if</span>&nbsp;<span class="builtintype" id="6830457">string</span><span class="op" id="6830463">(</span><span class="ident" id="6830464">b</span><span class="op" id="6830465">)</span>&nbsp;<span class="op" id="6830467">!=</span>&nbsp;<span class="ident" id="6830470">msg</span>&nbsp;<span class="op" id="6830474">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830478">t</span><span class="op" id="6830479">.</span><span class="ident" id="6830480">Fatalf</span><span class="op" id="6830486">(</span><span class="string" id="6830487">&#34;Marshal:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6830515">,</span>&nbsp;<span class="ident" id="6830517">b</span><span class="op" id="6830518">,</span>&nbsp;<span class="ident" id="6830520">msg</span><span class="op" id="6830523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830526">}</span><br>
<span class="lineno"></span><span class="op" id="6830528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6830531">func</span>&nbsp;<span class="ident" id="6830536">TestNullRawMessage</span><span class="op" id="6830554">(</span><span class="ident" id="6830555">t</span>&nbsp;<span class="op" id="6830557">*</span><span class="ident" id="6830558">testing</span><span class="op" id="6830565">.</span><span class="ident" id="6830566">T</span><span class="op" id="6830567">)</span>&nbsp;<span class="op" id="6830569">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6830572">//&nbsp;TODO(rsc):&nbsp;Should&nbsp;not&nbsp;need&nbsp;the&nbsp;*&nbsp;in&nbsp;*RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830624">var</span>&nbsp;<span class="ident" id="6830628">data</span>&nbsp;<span class="keyword" id="6830633">struct</span>&nbsp;<span class="op" id="6830640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830644">X</span>&nbsp;&nbsp;<span class="builtintype" id="6830647">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830657">Id</span>&nbsp;<span class="op" id="6830660">*</span><span class="ident" id="6830661">RawMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830674">Y</span>&nbsp;&nbsp;<span class="builtintype" id="6830677">float32</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830689">data</span><span class="op" id="6830693">.</span><span class="ident" id="6830694">Id</span>&nbsp;<span class="op" id="6830697">=</span>&nbsp;<span class="builtinfunc" id="6830699">new</span><span class="op" id="6830702">(</span><span class="ident" id="6830703">RawMessage</span><span class="op" id="6830713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830716">const</span>&nbsp;<span class="ident" id="6830722">msg</span>&nbsp;<span class="op" id="6830726">=</span>&nbsp;<span class="string" id="6830728">`{&#34;X&#34;:0.1,&#34;Id&#34;:null,&#34;Y&#34;:0.2}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830759">err</span>&nbsp;<span class="op" id="6830763">:=</span>&nbsp;<span class="ident" id="6830766">Unmarshal</span><span class="op" id="6830775">(</span><span class="op" id="6830776">[</span><span class="op" id="6830777">]</span><span class="builtintype" id="6830778">byte</span><span class="op" id="6830782">(</span><span class="ident" id="6830783">msg</span><span class="op" id="6830786">)</span><span class="op" id="6830787">,</span>&nbsp;<span class="op" id="6830789">&amp;</span><span class="ident" id="6830790">data</span><span class="op" id="6830794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830797">if</span>&nbsp;<span class="ident" id="6830800">err</span>&nbsp;<span class="op" id="6830804">!=</span>&nbsp;<span class="ident" id="6830807">nil</span>&nbsp;<span class="op" id="6830811">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830815">t</span><span class="op" id="6830816">.</span><span class="ident" id="6830817">Fatalf</span><span class="op" id="6830823">(</span><span class="string" id="6830824">&#34;Unmarshal:&nbsp;%v&#34;</span><span class="op" id="6830839">,</span>&nbsp;<span class="ident" id="6830841">err</span><span class="op" id="6830844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830850">if</span>&nbsp;<span class="ident" id="6830853">data</span><span class="op" id="6830857">.</span><span class="ident" id="6830858">Id</span>&nbsp;<span class="op" id="6830861">!=</span>&nbsp;<span class="ident" id="6830864">nil</span>&nbsp;<span class="op" id="6830868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830872">t</span><span class="op" id="6830873">.</span><span class="ident" id="6830874">Fatalf</span><span class="op" id="6830880">(</span><span class="string" id="6830881">&#34;Raw&nbsp;mismatch:&nbsp;have&nbsp;non-nil,&nbsp;want&nbsp;nil&#34;</span><span class="op" id="6830919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830922">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830925">b</span><span class="op" id="6830926">,</span>&nbsp;<span class="ident" id="6830928">err</span>&nbsp;<span class="op" id="6830932">:=</span>&nbsp;<span class="ident" id="6830935">Marshal</span><span class="op" id="6830942">(</span><span class="op" id="6830943">&amp;</span><span class="ident" id="6830944">data</span><span class="op" id="6830948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6830951">if</span>&nbsp;<span class="ident" id="6830954">err</span>&nbsp;<span class="op" id="6830958">!=</span>&nbsp;<span class="ident" id="6830961">nil</span>&nbsp;<span class="op" id="6830965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6830969">t</span><span class="op" id="6830970">.</span><span class="ident" id="6830971">Fatalf</span><span class="op" id="6830977">(</span><span class="string" id="6830978">&#34;Marshal:&nbsp;%v&#34;</span><span class="op" id="6830991">,</span>&nbsp;<span class="ident" id="6830993">err</span><span class="op" id="6830996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6830999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831002">if</span>&nbsp;<span class="builtintype" id="6831005">string</span><span class="op" id="6831011">(</span><span class="ident" id="6831012">b</span><span class="op" id="6831013">)</span>&nbsp;<span class="op" id="6831015">!=</span>&nbsp;<span class="ident" id="6831018">msg</span>&nbsp;<span class="op" id="6831022">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831026">t</span><span class="op" id="6831027">.</span><span class="ident" id="6831028">Fatalf</span><span class="op" id="6831034">(</span><span class="string" id="6831035">&#34;Marshal:&nbsp;have&nbsp;%#q&nbsp;want&nbsp;%#q&#34;</span><span class="op" id="6831063">,</span>&nbsp;<span class="ident" id="6831065">b</span><span class="op" id="6831066">,</span>&nbsp;<span class="ident" id="6831068">msg</span><span class="op" id="6831071">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831074">}</span><br>
<span class="lineno"></span><span class="op" id="6831076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6831079">var</span>&nbsp;<span class="ident" id="6831083">blockingTests</span>&nbsp;<span class="op" id="6831097">=</span>&nbsp;<span class="op" id="6831099">[</span><span class="op" id="6831100">]</span><span class="builtintype" id="6831101">string</span><span class="op" id="6831107">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6831110">`{&#34;x&#34;:&nbsp;1}`</span><span class="op" id="6831120">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6831123">`[1,&nbsp;2,&nbsp;3]`</span><span class="op" id="6831134">,</span><br>
<span class="lineno"></span><span class="op" id="6831136">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6831139">func</span>&nbsp;<span class="ident" id="6831144">TestBlocking</span><span class="op" id="6831156">(</span><span class="ident" id="6831157">t</span>&nbsp;<span class="op" id="6831159">*</span><span class="ident" id="6831160">testing</span><span class="op" id="6831167">.</span><span class="ident" id="6831168">T</span><span class="op" id="6831169">)</span>&nbsp;<span class="op" id="6831171">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831174">for</span>&nbsp;<span class="ident" id="6831178">_</span><span class="op" id="6831179">,</span>&nbsp;<span class="ident" id="6831181">enc</span>&nbsp;<span class="op" id="6831185">:=</span>&nbsp;<span class="keyword" id="6831188">range</span>&nbsp;<span class="ident" id="6831194">blockingTests</span>&nbsp;<span class="op" id="6831208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831212">r</span><span class="op" id="6831213">,</span>&nbsp;<span class="ident" id="6831215">w</span>&nbsp;<span class="op" id="6831217">:=</span>&nbsp;<span class="ident" id="6831220">net</span><span class="op" id="6831223">.</span><span class="ident" id="6831224">Pipe</span><span class="op" id="6831228">(</span><span class="op" id="6831229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831233">go</span>&nbsp;<span class="ident" id="6831236">w</span><span class="op" id="6831237">.</span><span class="ident" id="6831238">Write</span><span class="op" id="6831243">(</span><span class="op" id="6831244">[</span><span class="op" id="6831245">]</span><span class="builtintype" id="6831246">byte</span><span class="op" id="6831250">(</span><span class="ident" id="6831251">enc</span><span class="op" id="6831254">)</span><span class="op" id="6831255">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831259">var</span>&nbsp;<span class="ident" id="6831263">val</span>&nbsp;<span class="keyword" id="6831267">interface</span><span class="op" id="6831276">{</span><span class="op" id="6831277">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6831282">//&nbsp;If&nbsp;Decode&nbsp;reads&nbsp;beyond&nbsp;what&nbsp;w.Write&nbsp;writes&nbsp;above,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6831337">//&nbsp;it&nbsp;will&nbsp;block,&nbsp;and&nbsp;the&nbsp;test&nbsp;will&nbsp;deadlock.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831385">if</span>&nbsp;<span class="ident" id="6831388">err</span>&nbsp;<span class="op" id="6831392">:=</span>&nbsp;<span class="ident" id="6831395">NewDecoder</span><span class="op" id="6831405">(</span><span class="ident" id="6831406">r</span><span class="op" id="6831407">)</span><span class="op" id="6831408">.</span><span class="ident" id="6831409">Decode</span><span class="op" id="6831415">(</span><span class="op" id="6831416">&amp;</span><span class="ident" id="6831417">val</span><span class="op" id="6831420">)</span><span class="op" id="6831421">;</span>&nbsp;<span class="ident" id="6831423">err</span>&nbsp;<span class="op" id="6831427">!=</span>&nbsp;<span class="ident" id="6831430">nil</span>&nbsp;<span class="op" id="6831434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831439">t</span><span class="op" id="6831440">.</span><span class="ident" id="6831441">Errorf</span><span class="op" id="6831447">(</span><span class="string" id="6831448">&#34;decoding&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="6831465">,</span>&nbsp;<span class="ident" id="6831467">enc</span><span class="op" id="6831470">,</span>&nbsp;<span class="ident" id="6831472">err</span><span class="op" id="6831475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831479">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831483">r</span><span class="op" id="6831484">.</span><span class="ident" id="6831485">Close</span><span class="op" id="6831490">(</span><span class="op" id="6831491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831495">w</span><span class="op" id="6831496">.</span><span class="ident" id="6831497">Close</span><span class="op" id="6831502">(</span><span class="op" id="6831503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831506">}</span><br>
<span class="lineno"></span><span class="op" id="6831508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">195</span><span class="keyword" id="6831511">func</span>&nbsp;<span class="ident" id="6831516">BenchmarkEncoderEncode</span><span class="op" id="6831538">(</span><span class="ident" id="6831539">b</span>&nbsp;<span class="op" id="6831541">*</span><span class="ident" id="6831542">testing</span><span class="op" id="6831549">.</span><span class="ident" id="6831550">B</span><span class="op" id="6831551">)</span>&nbsp;<span class="op" id="6831553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831556">b</span><span class="op" id="6831557">.</span><span class="ident" id="6831558">ReportAllocs</span><span class="op" id="6831570">(</span><span class="op" id="6831571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831574">type</span>&nbsp;<span class="ident" id="6831579">T</span>&nbsp;<span class="keyword" id="6831581">struct</span>&nbsp;<span class="op" id="6831588">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831592">X</span><span class="op" id="6831593">,</span>&nbsp;<span class="ident" id="6831595">Y</span>&nbsp;<span class="builtintype" id="6831597">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831605">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831608">v</span>&nbsp;<span class="op" id="6831610">:=</span>&nbsp;<span class="op" id="6831613">&amp;</span><span class="ident" id="6831614">T</span><span class="op" id="6831615">{</span><span class="string" id="6831616">&#34;foo&#34;</span><span class="op" id="6831621">,</span>&nbsp;<span class="string" id="6831623">&#34;bar&#34;</span><span class="op" id="6831628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831631">for</span>&nbsp;<span class="ident" id="6831635">i</span>&nbsp;<span class="op" id="6831637">:=</span>&nbsp;<span class="num" id="6831640">0</span><span class="op" id="6831641">;</span>&nbsp;<span class="ident" id="6831643">i</span>&nbsp;<span class="op" id="6831645">&lt;</span>&nbsp;<span class="ident" id="6831647">b</span><span class="op" id="6831648">.</span><span class="ident" id="6831649">N</span><span class="op" id="6831650">;</span>&nbsp;<span class="ident" id="6831652">i</span><span class="op" id="6831653">++</span>&nbsp;<span class="op" id="6831656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6831660">if</span>&nbsp;<span class="ident" id="6831663">err</span>&nbsp;<span class="op" id="6831667">:=</span>&nbsp;<span class="ident" id="6831670">NewEncoder</span><span class="op" id="6831680">(</span><span class="ident" id="6831681">ioutil</span><span class="op" id="6831687">.</span><span class="ident" id="6831688">Discard</span><span class="op" id="6831695">)</span><span class="op" id="6831696">.</span><span class="ident" id="6831697">Encode</span><span class="op" id="6831703">(</span><span class="ident" id="6831704">v</span><span class="op" id="6831705">)</span><span class="op" id="6831706">;</span>&nbsp;<span class="ident" id="6831708">err</span>&nbsp;<span class="op" id="6831712">!=</span>&nbsp;<span class="ident" id="6831715">nil</span>&nbsp;<span class="op" id="6831719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6831724">b</span><span class="op" id="6831725">.</span><span class="ident" id="6831726">Fatal</span><span class="op" id="6831731">(</span><span class="ident" id="6831732">err</span><span class="op" id="6831735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831739">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6831742">}</span><br>
<span class="lineno"></span><span class="op" id="6831744">}</span>
</div>
</body>
</html>
