<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/zlib</h2>
<ul>
<li><a href="/gostd/compress/zlib/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/compress/zlib/reader.go.html">reader.go</a></li>
<li><a href="/gostd/compress/zlib/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/zlib/writer.go.html">writer.go</a></li>
<li><a href="/gostd/compress/zlib/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8259377">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8259432">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8259486">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8259537">package</span>&nbsp;<span class="ident" id="8259545">zlib</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8259551">import</span>&nbsp;<span class="op" id="8259558">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259561">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259570">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259577">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259583">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259596">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259602">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8259612">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="8259615">var</span>&nbsp;<span class="ident" id="8259619">filenames</span>&nbsp;<span class="op" id="8259629">=</span>&nbsp;<span class="op" id="8259631">[</span><span class="op" id="8259632">]</span><span class="builtintype" id="8259633">string</span><span class="op" id="8259639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259642">&#34;../testdata/e.txt&#34;</span><span class="op" id="8259661">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259664">&#34;../testdata/pi.txt&#34;</span><span class="op" id="8259684">,</span><br>
<span class="lineno"></span><span class="op" id="8259686">}</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8259689">var</span>&nbsp;<span class="ident" id="8259693">data</span>&nbsp;<span class="op" id="8259698">=</span>&nbsp;<span class="op" id="8259700">[</span><span class="op" id="8259701">]</span><span class="builtintype" id="8259702">string</span><span class="op" id="8259708">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8259711">&#34;test&nbsp;a&nbsp;reasonable&nbsp;sized&nbsp;string&nbsp;that&nbsp;can&nbsp;be&nbsp;compressed&#34;</span><span class="op" id="8259766">,</span><br>
<span class="lineno"></span><span class="op" id="8259768">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="8259771">//&nbsp;Tests&nbsp;that&nbsp;compressing&nbsp;and&nbsp;then&nbsp;decompressing&nbsp;the&nbsp;given&nbsp;file&nbsp;at&nbsp;the&nbsp;given&nbsp;compression&nbsp;level&nbsp;and&nbsp;dictionary</span><br>
<span class="lineno"></span><span class="comment" id="8259881">//&nbsp;yields&nbsp;equivalent&nbsp;bytes&nbsp;to&nbsp;the&nbsp;original&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="8259930">func</span>&nbsp;<span class="ident" id="8259935">testFileLevelDict</span><span class="op" id="8259952">(</span><span class="ident" id="8259953">t</span>&nbsp;<span class="op" id="8259955">*</span><span class="ident" id="8259956">testing</span><span class="op" id="8259963">.</span><span class="ident" id="8259964">T</span><span class="op" id="8259965">,</span>&nbsp;<span class="ident" id="8259967">fn</span>&nbsp;<span class="builtintype" id="8259970">string</span><span class="op" id="8259976">,</span>&nbsp;<span class="ident" id="8259978">level</span>&nbsp;<span class="builtintype" id="8259984">int</span><span class="op" id="8259987">,</span>&nbsp;<span class="ident" id="8259989">d</span>&nbsp;<span class="builtintype" id="8259991">string</span><span class="op" id="8259997">)</span>&nbsp;<span class="op" id="8259999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8260002">//&nbsp;Read&nbsp;the&nbsp;file,&nbsp;as&nbsp;golden&nbsp;output.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260039">golden</span><span class="op" id="8260045">,</span>&nbsp;<span class="ident" id="8260047">err</span>&nbsp;<span class="op" id="8260051">:=</span>&nbsp;<span class="ident" id="8260054">os</span><span class="op" id="8260056">.</span><span class="ident" id="8260057">Open</span><span class="op" id="8260061">(</span><span class="ident" id="8260062">fn</span><span class="op" id="8260064">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260067">if</span>&nbsp;<span class="ident" id="8260070">err</span>&nbsp;<span class="op" id="8260074">!=</span>&nbsp;<span class="ident" id="8260077">nil</span>&nbsp;<span class="op" id="8260081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260085">t</span><span class="op" id="8260086">.</span><span class="ident" id="8260087">Errorf</span><span class="op" id="8260093">(</span><span class="string" id="8260094">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8260122">,</span>&nbsp;<span class="ident" id="8260124">fn</span><span class="op" id="8260126">,</span>&nbsp;<span class="ident" id="8260128">level</span><span class="op" id="8260133">,</span>&nbsp;<span class="ident" id="8260135">d</span><span class="op" id="8260136">,</span>&nbsp;<span class="ident" id="8260138">err</span><span class="op" id="8260141">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260145">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260156">defer</span>&nbsp;<span class="ident" id="8260162">golden</span><span class="op" id="8260168">.</span><span class="ident" id="8260169">Close</span><span class="op" id="8260174">(</span><span class="op" id="8260175">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260178">b0</span><span class="op" id="8260180">,</span>&nbsp;<span class="ident" id="8260182">err0</span>&nbsp;<span class="op" id="8260187">:=</span>&nbsp;<span class="ident" id="8260190">ioutil</span><span class="op" id="8260196">.</span><span class="ident" id="8260197">ReadAll</span><span class="op" id="8260204">(</span><span class="ident" id="8260205">golden</span><span class="op" id="8260211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260214">if</span>&nbsp;<span class="ident" id="8260217">err0</span>&nbsp;<span class="op" id="8260222">!=</span>&nbsp;<span class="ident" id="8260225">nil</span>&nbsp;<span class="op" id="8260229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260233">t</span><span class="op" id="8260234">.</span><span class="ident" id="8260235">Errorf</span><span class="op" id="8260241">(</span><span class="string" id="8260242">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8260270">,</span>&nbsp;<span class="ident" id="8260272">fn</span><span class="op" id="8260274">,</span>&nbsp;<span class="ident" id="8260276">level</span><span class="op" id="8260281">,</span>&nbsp;<span class="ident" id="8260283">d</span><span class="op" id="8260284">,</span>&nbsp;<span class="ident" id="8260286">err0</span><span class="op" id="8260290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260294">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260302">}</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260305">testLevelDict</span><span class="op" id="8260318">(</span><span class="ident" id="8260319">t</span><span class="op" id="8260320">,</span>&nbsp;<span class="ident" id="8260322">fn</span><span class="op" id="8260324">,</span>&nbsp;<span class="ident" id="8260326">b0</span><span class="op" id="8260328">,</span>&nbsp;<span class="ident" id="8260330">level</span><span class="op" id="8260335">,</span>&nbsp;<span class="ident" id="8260337">d</span><span class="op" id="8260338">)</span><br>
<span class="lineno"></span><span class="op" id="8260340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8260343">func</span>&nbsp;<span class="ident" id="8260348">testLevelDict</span><span class="op" id="8260361">(</span><span class="ident" id="8260362">t</span>&nbsp;<span class="op" id="8260364">*</span><span class="ident" id="8260365">testing</span><span class="op" id="8260372">.</span><span class="ident" id="8260373">T</span><span class="op" id="8260374">,</span>&nbsp;<span class="ident" id="8260376">fn</span>&nbsp;<span class="builtintype" id="8260379">string</span><span class="op" id="8260385">,</span>&nbsp;<span class="ident" id="8260387">b0</span>&nbsp;<span class="op" id="8260390">[</span><span class="op" id="8260391">]</span><span class="builtintype" id="8260392">byte</span><span class="op" id="8260396">,</span>&nbsp;<span class="ident" id="8260398">level</span>&nbsp;<span class="builtintype" id="8260404">int</span><span class="op" id="8260407">,</span>&nbsp;<span class="ident" id="8260409">d</span>&nbsp;<span class="builtintype" id="8260411">string</span><span class="op" id="8260417">)</span>&nbsp;<span class="op" id="8260419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8260422">//&nbsp;Make&nbsp;dictionary,&nbsp;if&nbsp;given.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260453">var</span>&nbsp;<span class="ident" id="8260457">dict</span>&nbsp;<span class="op" id="8260462">[</span><span class="op" id="8260463">]</span><span class="builtintype" id="8260464">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260470">if</span>&nbsp;<span class="ident" id="8260473">d</span>&nbsp;<span class="op" id="8260475">!=</span>&nbsp;<span class="string" id="8260478">&#34;&#34;</span>&nbsp;<span class="op" id="8260481">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260485">dict</span>&nbsp;<span class="op" id="8260490">=</span>&nbsp;<span class="op" id="8260492">[</span><span class="op" id="8260493">]</span><span class="builtintype" id="8260494">byte</span><span class="op" id="8260498">(</span><span class="ident" id="8260499">d</span><span class="op" id="8260500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8260507">//&nbsp;Push&nbsp;data&nbsp;through&nbsp;a&nbsp;pipe&nbsp;that&nbsp;compresses&nbsp;at&nbsp;the&nbsp;write&nbsp;end,&nbsp;and&nbsp;decompresses&nbsp;at&nbsp;the&nbsp;read&nbsp;end.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260604">piper</span><span class="op" id="8260609">,</span>&nbsp;<span class="ident" id="8260611">pipew</span>&nbsp;<span class="op" id="8260617">:=</span>&nbsp;<span class="ident" id="8260620">io</span><span class="op" id="8260622">.</span><span class="ident" id="8260623">Pipe</span><span class="op" id="8260627">(</span><span class="op" id="8260628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260631">defer</span>&nbsp;<span class="ident" id="8260637">piper</span><span class="op" id="8260642">.</span><span class="ident" id="8260643">Close</span><span class="op" id="8260648">(</span><span class="op" id="8260649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260652">go</span>&nbsp;<span class="keyword" id="8260655">func</span><span class="op" id="8260659">(</span><span class="op" id="8260660">)</span>&nbsp;<span class="op" id="8260662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260666">defer</span>&nbsp;<span class="ident" id="8260672">pipew</span><span class="op" id="8260677">.</span><span class="ident" id="8260678">Close</span><span class="op" id="8260683">(</span><span class="op" id="8260684">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260688">zlibw</span><span class="op" id="8260693">,</span>&nbsp;<span class="ident" id="8260695">err</span>&nbsp;<span class="op" id="8260699">:=</span>&nbsp;<span class="ident" id="8260702">NewWriterLevelDict</span><span class="op" id="8260720">(</span><span class="ident" id="8260721">pipew</span><span class="op" id="8260726">,</span>&nbsp;<span class="ident" id="8260728">level</span><span class="op" id="8260733">,</span>&nbsp;<span class="ident" id="8260735">dict</span><span class="op" id="8260739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260743">if</span>&nbsp;<span class="ident" id="8260746">err</span>&nbsp;<span class="op" id="8260750">!=</span>&nbsp;<span class="ident" id="8260753">nil</span>&nbsp;<span class="op" id="8260757">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260762">t</span><span class="op" id="8260763">.</span><span class="ident" id="8260764">Errorf</span><span class="op" id="8260770">(</span><span class="string" id="8260771">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8260799">,</span>&nbsp;<span class="ident" id="8260801">fn</span><span class="op" id="8260803">,</span>&nbsp;<span class="ident" id="8260805">level</span><span class="op" id="8260810">,</span>&nbsp;<span class="ident" id="8260812">d</span><span class="op" id="8260813">,</span>&nbsp;<span class="ident" id="8260815">err</span><span class="op" id="8260818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260823">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260832">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260836">defer</span>&nbsp;<span class="ident" id="8260842">zlibw</span><span class="op" id="8260847">.</span><span class="ident" id="8260848">Close</span><span class="op" id="8260853">(</span><span class="op" id="8260854">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260858">_</span><span class="op" id="8260859">,</span>&nbsp;<span class="ident" id="8260861">err</span>&nbsp;<span class="op" id="8260865">=</span>&nbsp;<span class="ident" id="8260867">zlibw</span><span class="op" id="8260872">.</span><span class="ident" id="8260873">Write</span><span class="op" id="8260878">(</span><span class="ident" id="8260879">b0</span><span class="op" id="8260881">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260885">if</span>&nbsp;<span class="ident" id="8260888">err</span>&nbsp;<span class="op" id="8260892">!=</span>&nbsp;<span class="ident" id="8260895">nil</span>&nbsp;<span class="op" id="8260899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260904">t</span><span class="op" id="8260905">.</span><span class="ident" id="8260906">Errorf</span><span class="op" id="8260912">(</span><span class="string" id="8260913">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8260941">,</span>&nbsp;<span class="ident" id="8260943">fn</span><span class="op" id="8260945">,</span>&nbsp;<span class="ident" id="8260947">level</span><span class="op" id="8260952">,</span>&nbsp;<span class="ident" id="8260954">d</span><span class="op" id="8260955">,</span>&nbsp;<span class="ident" id="8260957">err</span><span class="op" id="8260960">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260965">return</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260974">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260977">}</span><span class="op" id="8260978">(</span><span class="op" id="8260979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260982">zlibr</span><span class="op" id="8260987">,</span>&nbsp;<span class="ident" id="8260989">err</span>&nbsp;<span class="op" id="8260993">:=</span>&nbsp;<span class="ident" id="8260996">NewReaderDict</span><span class="op" id="8261009">(</span><span class="ident" id="8261010">piper</span><span class="op" id="8261015">,</span>&nbsp;<span class="ident" id="8261017">dict</span><span class="op" id="8261021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261024">if</span>&nbsp;<span class="ident" id="8261027">err</span>&nbsp;<span class="op" id="8261031">!=</span>&nbsp;<span class="ident" id="8261034">nil</span>&nbsp;<span class="op" id="8261038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261042">t</span><span class="op" id="8261043">.</span><span class="ident" id="8261044">Errorf</span><span class="op" id="8261050">(</span><span class="string" id="8261051">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8261079">,</span>&nbsp;<span class="ident" id="8261081">fn</span><span class="op" id="8261083">,</span>&nbsp;<span class="ident" id="8261085">level</span><span class="op" id="8261090">,</span>&nbsp;<span class="ident" id="8261092">d</span><span class="op" id="8261093">,</span>&nbsp;<span class="ident" id="8261095">err</span><span class="op" id="8261098">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261102">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261113">defer</span>&nbsp;<span class="ident" id="8261119">zlibr</span><span class="op" id="8261124">.</span><span class="ident" id="8261125">Close</span><span class="op" id="8261130">(</span><span class="op" id="8261131">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8261135">//&nbsp;Compare&nbsp;the&nbsp;decompressed&nbsp;data.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261170">b1</span><span class="op" id="8261172">,</span>&nbsp;<span class="ident" id="8261174">err1</span>&nbsp;<span class="op" id="8261179">:=</span>&nbsp;<span class="ident" id="8261182">ioutil</span><span class="op" id="8261188">.</span><span class="ident" id="8261189">ReadAll</span><span class="op" id="8261196">(</span><span class="ident" id="8261197">zlibr</span><span class="op" id="8261202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261205">if</span>&nbsp;<span class="ident" id="8261208">err1</span>&nbsp;<span class="op" id="8261213">!=</span>&nbsp;<span class="ident" id="8261216">nil</span>&nbsp;<span class="op" id="8261220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261224">t</span><span class="op" id="8261225">.</span><span class="ident" id="8261226">Errorf</span><span class="op" id="8261232">(</span><span class="string" id="8261233">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;%v&#34;</span><span class="op" id="8261261">,</span>&nbsp;<span class="ident" id="8261263">fn</span><span class="op" id="8261265">,</span>&nbsp;<span class="ident" id="8261267">level</span><span class="op" id="8261272">,</span>&nbsp;<span class="ident" id="8261274">d</span><span class="op" id="8261275">,</span>&nbsp;<span class="ident" id="8261277">err1</span><span class="op" id="8261281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261285">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261293">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261296">if</span>&nbsp;<span class="builtinfunc" id="8261299">len</span><span class="op" id="8261302">(</span><span class="ident" id="8261303">b0</span><span class="op" id="8261305">)</span>&nbsp;<span class="op" id="8261307">!=</span>&nbsp;<span class="builtinfunc" id="8261310">len</span><span class="op" id="8261313">(</span><span class="ident" id="8261314">b1</span><span class="op" id="8261316">)</span>&nbsp;<span class="op" id="8261318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261322">t</span><span class="op" id="8261323">.</span><span class="ident" id="8261324">Errorf</span><span class="op" id="8261330">(</span><span class="string" id="8261331">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;length&nbsp;mismatch&nbsp;%d&nbsp;versus&nbsp;%d&#34;</span><span class="op" id="8261385">,</span>&nbsp;<span class="ident" id="8261387">fn</span><span class="op" id="8261389">,</span>&nbsp;<span class="ident" id="8261391">level</span><span class="op" id="8261396">,</span>&nbsp;<span class="ident" id="8261398">d</span><span class="op" id="8261399">,</span>&nbsp;<span class="builtinfunc" id="8261401">len</span><span class="op" id="8261404">(</span><span class="ident" id="8261405">b0</span><span class="op" id="8261407">)</span><span class="op" id="8261408">,</span>&nbsp;<span class="builtinfunc" id="8261410">len</span><span class="op" id="8261413">(</span><span class="ident" id="8261414">b1</span><span class="op" id="8261416">)</span><span class="op" id="8261417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261421">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261429">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261432">for</span>&nbsp;<span class="ident" id="8261436">i</span>&nbsp;<span class="op" id="8261438">:=</span>&nbsp;<span class="num" id="8261441">0</span><span class="op" id="8261442">;</span>&nbsp;<span class="ident" id="8261444">i</span>&nbsp;<span class="op" id="8261446">&lt;</span>&nbsp;<span class="builtinfunc" id="8261448">len</span><span class="op" id="8261451">(</span><span class="ident" id="8261452">b0</span><span class="op" id="8261454">)</span><span class="op" id="8261455">;</span>&nbsp;<span class="ident" id="8261457">i</span><span class="op" id="8261458">++</span>&nbsp;<span class="op" id="8261461">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261465">if</span>&nbsp;<span class="ident" id="8261468">b0</span><span class="op" id="8261470">[</span><span class="ident" id="8261471">i</span><span class="op" id="8261472">]</span>&nbsp;<span class="op" id="8261474">!=</span>&nbsp;<span class="ident" id="8261477">b1</span><span class="op" id="8261479">[</span><span class="ident" id="8261480">i</span><span class="op" id="8261481">]</span>&nbsp;<span class="op" id="8261483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261488">t</span><span class="op" id="8261489">.</span><span class="ident" id="8261490">Errorf</span><span class="op" id="8261496">(</span><span class="string" id="8261497">&#34;%s&nbsp;(level=%d,&nbsp;dict=%q):&nbsp;mismatch&nbsp;at&nbsp;%d,&nbsp;0x%02x&nbsp;versus&nbsp;0x%02x\n&#34;</span><span class="op" id="8261561">,</span>&nbsp;<span class="ident" id="8261563">fn</span><span class="op" id="8261565">,</span>&nbsp;<span class="ident" id="8261567">level</span><span class="op" id="8261572">,</span>&nbsp;<span class="ident" id="8261574">d</span><span class="op" id="8261575">,</span>&nbsp;<span class="ident" id="8261577">i</span><span class="op" id="8261578">,</span>&nbsp;<span class="ident" id="8261580">b0</span><span class="op" id="8261582">[</span><span class="ident" id="8261583">i</span><span class="op" id="8261584">]</span><span class="op" id="8261585">,</span>&nbsp;<span class="ident" id="8261587">b1</span><span class="op" id="8261589">[</span><span class="ident" id="8261590">i</span><span class="op" id="8261591">]</span><span class="op" id="8261592">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261597">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261609">}</span><br>
<span class="lineno">90</span><span class="op" id="8261611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8261614">func</span>&nbsp;<span class="ident" id="8261619">testFileLevelDictReset</span><span class="op" id="8261641">(</span><span class="ident" id="8261642">t</span>&nbsp;<span class="op" id="8261644">*</span><span class="ident" id="8261645">testing</span><span class="op" id="8261652">.</span><span class="ident" id="8261653">T</span><span class="op" id="8261654">,</span>&nbsp;<span class="ident" id="8261656">fn</span>&nbsp;<span class="builtintype" id="8261659">string</span><span class="op" id="8261665">,</span>&nbsp;<span class="ident" id="8261667">level</span>&nbsp;<span class="builtintype" id="8261673">int</span><span class="op" id="8261676">,</span>&nbsp;<span class="ident" id="8261678">dict</span>&nbsp;<span class="op" id="8261683">[</span><span class="op" id="8261684">]</span><span class="builtintype" id="8261685">byte</span><span class="op" id="8261689">)</span>&nbsp;<span class="op" id="8261691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261694">var</span>&nbsp;<span class="ident" id="8261698">b0</span>&nbsp;<span class="op" id="8261701">[</span><span class="op" id="8261702">]</span><span class="builtintype" id="8261703">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261709">var</span>&nbsp;<span class="ident" id="8261713">err</span>&nbsp;<span class="builtintype" id="8261717">error</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261724">if</span>&nbsp;<span class="ident" id="8261727">fn</span>&nbsp;<span class="op" id="8261730">!=</span>&nbsp;<span class="string" id="8261733">&#34;&#34;</span>&nbsp;<span class="op" id="8261736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261740">b0</span><span class="op" id="8261742">,</span>&nbsp;<span class="ident" id="8261744">err</span>&nbsp;<span class="op" id="8261748">=</span>&nbsp;<span class="ident" id="8261750">ioutil</span><span class="op" id="8261756">.</span><span class="ident" id="8261757">ReadFile</span><span class="op" id="8261765">(</span><span class="ident" id="8261766">fn</span><span class="op" id="8261768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261772">if</span>&nbsp;<span class="ident" id="8261775">err</span>&nbsp;<span class="op" id="8261779">!=</span>&nbsp;<span class="ident" id="8261782">nil</span>&nbsp;<span class="op" id="8261786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261791">t</span><span class="op" id="8261792">.</span><span class="ident" id="8261793">Errorf</span><span class="op" id="8261799">(</span><span class="string" id="8261800">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8261819">,</span>&nbsp;<span class="ident" id="8261821">fn</span><span class="op" id="8261823">,</span>&nbsp;<span class="ident" id="8261825">level</span><span class="op" id="8261830">,</span>&nbsp;<span class="ident" id="8261832">err</span><span class="op" id="8261835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261840">return</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261849">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261852">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8261856">//&nbsp;Compress&nbsp;once.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261875">buf</span>&nbsp;<span class="op" id="8261879">:=</span>&nbsp;<span class="builtinfunc" id="8261882">new</span><span class="op" id="8261885">(</span><span class="ident" id="8261886">bytes</span><span class="op" id="8261891">.</span><span class="ident" id="8261892">Buffer</span><span class="op" id="8261898">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261901">var</span>&nbsp;<span class="ident" id="8261905">zlibw</span>&nbsp;<span class="op" id="8261911">*</span><span class="ident" id="8261912">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261920">if</span>&nbsp;<span class="ident" id="8261923">dict</span>&nbsp;<span class="op" id="8261928">==</span>&nbsp;<span class="ident" id="8261931">nil</span>&nbsp;<span class="op" id="8261935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261939">zlibw</span><span class="op" id="8261944">,</span>&nbsp;<span class="ident" id="8261946">err</span>&nbsp;<span class="op" id="8261950">=</span>&nbsp;<span class="ident" id="8261952">NewWriterLevel</span><span class="op" id="8261966">(</span><span class="ident" id="8261967">buf</span><span class="op" id="8261970">,</span>&nbsp;<span class="ident" id="8261972">level</span><span class="op" id="8261977">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261980">}</span>&nbsp;<span class="keyword" id="8261982">else</span>&nbsp;<span class="op" id="8261987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261991">zlibw</span><span class="op" id="8261996">,</span>&nbsp;<span class="ident" id="8261998">err</span>&nbsp;<span class="op" id="8262002">=</span>&nbsp;<span class="ident" id="8262004">NewWriterLevelDict</span><span class="op" id="8262022">(</span><span class="ident" id="8262023">buf</span><span class="op" id="8262026">,</span>&nbsp;<span class="ident" id="8262028">level</span><span class="op" id="8262033">,</span>&nbsp;<span class="ident" id="8262035">dict</span><span class="op" id="8262039">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262042">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262045">if</span>&nbsp;<span class="ident" id="8262048">err</span>&nbsp;<span class="op" id="8262052">==</span>&nbsp;<span class="ident" id="8262055">nil</span>&nbsp;<span class="op" id="8262059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262063">_</span><span class="op" id="8262064">,</span>&nbsp;<span class="ident" id="8262066">err</span>&nbsp;<span class="op" id="8262070">=</span>&nbsp;<span class="ident" id="8262072">zlibw</span><span class="op" id="8262077">.</span><span class="ident" id="8262078">Write</span><span class="op" id="8262083">(</span><span class="ident" id="8262084">b0</span><span class="op" id="8262086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262092">if</span>&nbsp;<span class="ident" id="8262095">err</span>&nbsp;<span class="op" id="8262099">==</span>&nbsp;<span class="ident" id="8262102">nil</span>&nbsp;<span class="op" id="8262106">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262110">err</span>&nbsp;<span class="op" id="8262114">=</span>&nbsp;<span class="ident" id="8262116">zlibw</span><span class="op" id="8262121">.</span><span class="ident" id="8262122">Close</span><span class="op" id="8262127">(</span><span class="op" id="8262128">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262134">if</span>&nbsp;<span class="ident" id="8262137">err</span>&nbsp;<span class="op" id="8262141">!=</span>&nbsp;<span class="ident" id="8262144">nil</span>&nbsp;<span class="op" id="8262148">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262152">t</span><span class="op" id="8262153">.</span><span class="ident" id="8262154">Errorf</span><span class="op" id="8262160">(</span><span class="string" id="8262161">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8262180">,</span>&nbsp;<span class="ident" id="8262182">fn</span><span class="op" id="8262184">,</span>&nbsp;<span class="ident" id="8262186">level</span><span class="op" id="8262191">,</span>&nbsp;<span class="ident" id="8262193">err</span><span class="op" id="8262196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262200">return</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262208">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262211">out</span>&nbsp;<span class="op" id="8262215">:=</span>&nbsp;<span class="ident" id="8262218">buf</span><span class="op" id="8262221">.</span><span class="ident" id="8262222">String</span><span class="op" id="8262228">(</span><span class="op" id="8262229">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8262233">//&nbsp;Reset&nbsp;and&nbsp;compress&nbsp;again.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262263">buf2</span>&nbsp;<span class="op" id="8262268">:=</span>&nbsp;<span class="builtinfunc" id="8262271">new</span><span class="op" id="8262274">(</span><span class="ident" id="8262275">bytes</span><span class="op" id="8262280">.</span><span class="ident" id="8262281">Buffer</span><span class="op" id="8262287">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262290">zlibw</span><span class="op" id="8262295">.</span><span class="ident" id="8262296">Reset</span><span class="op" id="8262301">(</span><span class="ident" id="8262302">buf2</span><span class="op" id="8262306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262309">_</span><span class="op" id="8262310">,</span>&nbsp;<span class="ident" id="8262312">err</span>&nbsp;<span class="op" id="8262316">=</span>&nbsp;<span class="ident" id="8262318">zlibw</span><span class="op" id="8262323">.</span><span class="ident" id="8262324">Write</span><span class="op" id="8262329">(</span><span class="ident" id="8262330">b0</span><span class="op" id="8262332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262335">if</span>&nbsp;<span class="ident" id="8262338">err</span>&nbsp;<span class="op" id="8262342">==</span>&nbsp;<span class="ident" id="8262345">nil</span>&nbsp;<span class="op" id="8262349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262353">err</span>&nbsp;<span class="op" id="8262357">=</span>&nbsp;<span class="ident" id="8262359">zlibw</span><span class="op" id="8262364">.</span><span class="ident" id="8262365">Close</span><span class="op" id="8262370">(</span><span class="op" id="8262371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262374">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262377">if</span>&nbsp;<span class="ident" id="8262380">err</span>&nbsp;<span class="op" id="8262384">!=</span>&nbsp;<span class="ident" id="8262387">nil</span>&nbsp;<span class="op" id="8262391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262395">t</span><span class="op" id="8262396">.</span><span class="ident" id="8262397">Errorf</span><span class="op" id="8262403">(</span><span class="string" id="8262404">&#34;%s&nbsp;(level=%d):&nbsp;%v&#34;</span><span class="op" id="8262423">,</span>&nbsp;<span class="ident" id="8262425">fn</span><span class="op" id="8262427">,</span>&nbsp;<span class="ident" id="8262429">level</span><span class="op" id="8262434">,</span>&nbsp;<span class="ident" id="8262436">err</span><span class="op" id="8262439">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262443">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262451">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262454">out2</span>&nbsp;<span class="op" id="8262459">:=</span>&nbsp;<span class="ident" id="8262462">buf2</span><span class="op" id="8262466">.</span><span class="ident" id="8262467">String</span><span class="op" id="8262473">(</span><span class="op" id="8262474">)</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262478">if</span>&nbsp;<span class="ident" id="8262481">out2</span>&nbsp;<span class="op" id="8262486">!=</span>&nbsp;<span class="ident" id="8262489">out</span>&nbsp;<span class="op" id="8262493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262497">t</span><span class="op" id="8262498">.</span><span class="ident" id="8262499">Errorf</span><span class="op" id="8262505">(</span><span class="string" id="8262506">&#34;%s&nbsp;(level=%d):&nbsp;different&nbsp;output&nbsp;after&nbsp;reset&nbsp;(got&nbsp;%d&nbsp;bytes,&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="8262578">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262583">fn</span><span class="op" id="8262585">,</span>&nbsp;<span class="ident" id="8262587">level</span><span class="op" id="8262592">,</span>&nbsp;<span class="builtinfunc" id="8262594">len</span><span class="op" id="8262597">(</span><span class="ident" id="8262598">out2</span><span class="op" id="8262602">)</span><span class="op" id="8262603">,</span>&nbsp;<span class="builtinfunc" id="8262605">len</span><span class="op" id="8262608">(</span><span class="ident" id="8262609">out</span><span class="op" id="8262612">)</span><span class="op" id="8262613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262616">}</span><br>
<span class="lineno">140</span><span class="op" id="8262618">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262621">func</span>&nbsp;<span class="ident" id="8262626">TestWriter</span><span class="op" id="8262636">(</span><span class="ident" id="8262637">t</span>&nbsp;<span class="op" id="8262639">*</span><span class="ident" id="8262640">testing</span><span class="op" id="8262647">.</span><span class="ident" id="8262648">T</span><span class="op" id="8262649">)</span>&nbsp;<span class="op" id="8262651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262654">for</span>&nbsp;<span class="ident" id="8262658">i</span><span class="op" id="8262659">,</span>&nbsp;<span class="ident" id="8262661">s</span>&nbsp;<span class="op" id="8262663">:=</span>&nbsp;<span class="keyword" id="8262666">range</span>&nbsp;<span class="ident" id="8262672">data</span>&nbsp;<span class="op" id="8262677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262681">b</span>&nbsp;<span class="op" id="8262683">:=</span>&nbsp;<span class="op" id="8262686">[</span><span class="op" id="8262687">]</span><span class="builtintype" id="8262688">byte</span><span class="op" id="8262692">(</span><span class="ident" id="8262693">s</span><span class="op" id="8262694">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262698">tag</span>&nbsp;<span class="op" id="8262702">:=</span>&nbsp;<span class="ident" id="8262705">fmt</span><span class="op" id="8262708">.</span><span class="ident" id="8262709">Sprintf</span><span class="op" id="8262716">(</span><span class="string" id="8262717">&#34;#%d&#34;</span><span class="op" id="8262722">,</span>&nbsp;<span class="ident" id="8262724">i</span><span class="op" id="8262725">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262729">testLevelDict</span><span class="op" id="8262742">(</span><span class="ident" id="8262743">t</span><span class="op" id="8262744">,</span>&nbsp;<span class="ident" id="8262746">tag</span><span class="op" id="8262749">,</span>&nbsp;<span class="ident" id="8262751">b</span><span class="op" id="8262752">,</span>&nbsp;<span class="ident" id="8262754">DefaultCompression</span><span class="op" id="8262772">,</span>&nbsp;<span class="string" id="8262774">&#34;&#34;</span><span class="op" id="8262776">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262780">testLevelDict</span><span class="op" id="8262793">(</span><span class="ident" id="8262794">t</span><span class="op" id="8262795">,</span>&nbsp;<span class="ident" id="8262797">tag</span><span class="op" id="8262800">,</span>&nbsp;<span class="ident" id="8262802">b</span><span class="op" id="8262803">,</span>&nbsp;<span class="ident" id="8262805">NoCompression</span><span class="op" id="8262818">,</span>&nbsp;<span class="string" id="8262820">&#34;&#34;</span><span class="op" id="8262822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262826">for</span>&nbsp;<span class="ident" id="8262830">level</span>&nbsp;<span class="op" id="8262836">:=</span>&nbsp;<span class="ident" id="8262839">BestSpeed</span><span class="op" id="8262848">;</span>&nbsp;<span class="ident" id="8262850">level</span>&nbsp;<span class="op" id="8262856">&lt;=</span>&nbsp;<span class="ident" id="8262859">BestCompression</span><span class="op" id="8262874">;</span>&nbsp;<span class="ident" id="8262876">level</span><span class="op" id="8262881">++</span>&nbsp;<span class="op" id="8262884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262889">testLevelDict</span><span class="op" id="8262902">(</span><span class="ident" id="8262903">t</span><span class="op" id="8262904">,</span>&nbsp;<span class="ident" id="8262906">tag</span><span class="op" id="8262909">,</span>&nbsp;<span class="ident" id="8262911">b</span><span class="op" id="8262912">,</span>&nbsp;<span class="ident" id="8262914">level</span><span class="op" id="8262919">,</span>&nbsp;<span class="string" id="8262921">&#34;&#34;</span><span class="op" id="8262923">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262930">}</span><br>
<span class="lineno"></span><span class="op" id="8262932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262935">func</span>&nbsp;<span class="ident" id="8262940">TestWriterBig</span><span class="op" id="8262953">(</span><span class="ident" id="8262954">t</span>&nbsp;<span class="op" id="8262956">*</span><span class="ident" id="8262957">testing</span><span class="op" id="8262964">.</span><span class="ident" id="8262965">T</span><span class="op" id="8262966">)</span>&nbsp;<span class="op" id="8262968">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262971">for</span>&nbsp;<span class="ident" id="8262975">_</span><span class="op" id="8262976">,</span>&nbsp;<span class="ident" id="8262978">fn</span>&nbsp;<span class="op" id="8262981">:=</span>&nbsp;<span class="keyword" id="8262984">range</span>&nbsp;<span class="ident" id="8262990">filenames</span>&nbsp;<span class="op" id="8263000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263004">testFileLevelDict</span><span class="op" id="8263021">(</span><span class="ident" id="8263022">t</span><span class="op" id="8263023">,</span>&nbsp;<span class="ident" id="8263025">fn</span><span class="op" id="8263027">,</span>&nbsp;<span class="ident" id="8263029">DefaultCompression</span><span class="op" id="8263047">,</span>&nbsp;<span class="string" id="8263049">&#34;&#34;</span><span class="op" id="8263051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263055">testFileLevelDict</span><span class="op" id="8263072">(</span><span class="ident" id="8263073">t</span><span class="op" id="8263074">,</span>&nbsp;<span class="ident" id="8263076">fn</span><span class="op" id="8263078">,</span>&nbsp;<span class="ident" id="8263080">NoCompression</span><span class="op" id="8263093">,</span>&nbsp;<span class="string" id="8263095">&#34;&#34;</span><span class="op" id="8263097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263101">for</span>&nbsp;<span class="ident" id="8263105">level</span>&nbsp;<span class="op" id="8263111">:=</span>&nbsp;<span class="ident" id="8263114">BestSpeed</span><span class="op" id="8263123">;</span>&nbsp;<span class="ident" id="8263125">level</span>&nbsp;<span class="op" id="8263131">&lt;=</span>&nbsp;<span class="ident" id="8263134">BestCompression</span><span class="op" id="8263149">;</span>&nbsp;<span class="ident" id="8263151">level</span><span class="op" id="8263156">++</span>&nbsp;<span class="op" id="8263159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263164">testFileLevelDict</span><span class="op" id="8263181">(</span><span class="ident" id="8263182">t</span><span class="op" id="8263183">,</span>&nbsp;<span class="ident" id="8263185">fn</span><span class="op" id="8263187">,</span>&nbsp;<span class="ident" id="8263189">level</span><span class="op" id="8263194">,</span>&nbsp;<span class="string" id="8263196">&#34;&#34;</span><span class="op" id="8263198">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263205">}</span><br>
<span class="lineno"></span><span class="op" id="8263207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263210">func</span>&nbsp;<span class="ident" id="8263215">TestWriterDict</span><span class="op" id="8263229">(</span><span class="ident" id="8263230">t</span>&nbsp;<span class="op" id="8263232">*</span><span class="ident" id="8263233">testing</span><span class="op" id="8263240">.</span><span class="ident" id="8263241">T</span><span class="op" id="8263242">)</span>&nbsp;<span class="op" id="8263244">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263247">const</span>&nbsp;<span class="ident" id="8263253">dictionary</span>&nbsp;<span class="op" id="8263264">=</span>&nbsp;<span class="string" id="8263266">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263281">for</span>&nbsp;<span class="ident" id="8263285">_</span><span class="op" id="8263286">,</span>&nbsp;<span class="ident" id="8263288">fn</span>&nbsp;<span class="op" id="8263291">:=</span>&nbsp;<span class="keyword" id="8263294">range</span>&nbsp;<span class="ident" id="8263300">filenames</span>&nbsp;<span class="op" id="8263310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263314">testFileLevelDict</span><span class="op" id="8263331">(</span><span class="ident" id="8263332">t</span><span class="op" id="8263333">,</span>&nbsp;<span class="ident" id="8263335">fn</span><span class="op" id="8263337">,</span>&nbsp;<span class="ident" id="8263339">DefaultCompression</span><span class="op" id="8263357">,</span>&nbsp;<span class="ident" id="8263359">dictionary</span><span class="op" id="8263369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263373">testFileLevelDict</span><span class="op" id="8263390">(</span><span class="ident" id="8263391">t</span><span class="op" id="8263392">,</span>&nbsp;<span class="ident" id="8263394">fn</span><span class="op" id="8263396">,</span>&nbsp;<span class="ident" id="8263398">NoCompression</span><span class="op" id="8263411">,</span>&nbsp;<span class="ident" id="8263413">dictionary</span><span class="op" id="8263423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263427">for</span>&nbsp;<span class="ident" id="8263431">level</span>&nbsp;<span class="op" id="8263437">:=</span>&nbsp;<span class="ident" id="8263440">BestSpeed</span><span class="op" id="8263449">;</span>&nbsp;<span class="ident" id="8263451">level</span>&nbsp;<span class="op" id="8263457">&lt;=</span>&nbsp;<span class="ident" id="8263460">BestCompression</span><span class="op" id="8263475">;</span>&nbsp;<span class="ident" id="8263477">level</span><span class="op" id="8263482">++</span>&nbsp;<span class="op" id="8263485">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263490">testFileLevelDict</span><span class="op" id="8263507">(</span><span class="ident" id="8263508">t</span><span class="op" id="8263509">,</span>&nbsp;<span class="ident" id="8263511">fn</span><span class="op" id="8263513">,</span>&nbsp;<span class="ident" id="8263515">level</span><span class="op" id="8263520">,</span>&nbsp;<span class="ident" id="8263522">dictionary</span><span class="op" id="8263532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263539">}</span><br>
<span class="lineno"></span><span class="op" id="8263541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="8263544">func</span>&nbsp;<span class="ident" id="8263549">TestWriterReset</span><span class="op" id="8263564">(</span><span class="ident" id="8263565">t</span>&nbsp;<span class="op" id="8263567">*</span><span class="ident" id="8263568">testing</span><span class="op" id="8263575">.</span><span class="ident" id="8263576">T</span><span class="op" id="8263577">)</span>&nbsp;<span class="op" id="8263579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263582">const</span>&nbsp;<span class="ident" id="8263588">dictionary</span>&nbsp;<span class="op" id="8263599">=</span>&nbsp;<span class="string" id="8263601">&#34;0123456789.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263616">for</span>&nbsp;<span class="ident" id="8263620">_</span><span class="op" id="8263621">,</span>&nbsp;<span class="ident" id="8263623">fn</span>&nbsp;<span class="op" id="8263626">:=</span>&nbsp;<span class="keyword" id="8263629">range</span>&nbsp;<span class="ident" id="8263635">filenames</span>&nbsp;<span class="op" id="8263645">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263649">testFileLevelDictReset</span><span class="op" id="8263671">(</span><span class="ident" id="8263672">t</span><span class="op" id="8263673">,</span>&nbsp;<span class="ident" id="8263675">fn</span><span class="op" id="8263677">,</span>&nbsp;<span class="ident" id="8263679">NoCompression</span><span class="op" id="8263692">,</span>&nbsp;<span class="ident" id="8263694">nil</span><span class="op" id="8263697">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263701">testFileLevelDictReset</span><span class="op" id="8263723">(</span><span class="ident" id="8263724">t</span><span class="op" id="8263725">,</span>&nbsp;<span class="ident" id="8263727">fn</span><span class="op" id="8263729">,</span>&nbsp;<span class="ident" id="8263731">DefaultCompression</span><span class="op" id="8263749">,</span>&nbsp;<span class="ident" id="8263751">nil</span><span class="op" id="8263754">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263758">testFileLevelDictReset</span><span class="op" id="8263780">(</span><span class="ident" id="8263781">t</span><span class="op" id="8263782">,</span>&nbsp;<span class="ident" id="8263784">fn</span><span class="op" id="8263786">,</span>&nbsp;<span class="ident" id="8263788">NoCompression</span><span class="op" id="8263801">,</span>&nbsp;<span class="op" id="8263803">[</span><span class="op" id="8263804">]</span><span class="builtintype" id="8263805">byte</span><span class="op" id="8263809">(</span><span class="ident" id="8263810">dictionary</span><span class="op" id="8263820">)</span><span class="op" id="8263821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263825">testFileLevelDictReset</span><span class="op" id="8263847">(</span><span class="ident" id="8263848">t</span><span class="op" id="8263849">,</span>&nbsp;<span class="ident" id="8263851">fn</span><span class="op" id="8263853">,</span>&nbsp;<span class="ident" id="8263855">DefaultCompression</span><span class="op" id="8263873">,</span>&nbsp;<span class="op" id="8263875">[</span><span class="op" id="8263876">]</span><span class="builtintype" id="8263877">byte</span><span class="op" id="8263881">(</span><span class="ident" id="8263882">dictionary</span><span class="op" id="8263892">)</span><span class="op" id="8263893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263897">if</span>&nbsp;<span class="op" id="8263900">!</span><span class="ident" id="8263901">testing</span><span class="op" id="8263908">.</span><span class="ident" id="8263909">Short</span><span class="op" id="8263914">(</span><span class="op" id="8263915">)</span>&nbsp;<span class="op" id="8263917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263922">for</span>&nbsp;<span class="ident" id="8263926">level</span>&nbsp;<span class="op" id="8263932">:=</span>&nbsp;<span class="ident" id="8263935">BestSpeed</span><span class="op" id="8263944">;</span>&nbsp;<span class="ident" id="8263946">level</span>&nbsp;<span class="op" id="8263952">&lt;=</span>&nbsp;<span class="ident" id="8263955">BestCompression</span><span class="op" id="8263970">;</span>&nbsp;<span class="ident" id="8263972">level</span><span class="op" id="8263977">++</span>&nbsp;<span class="op" id="8263980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263986">testFileLevelDictReset</span><span class="op" id="8264008">(</span><span class="ident" id="8264009">t</span><span class="op" id="8264010">,</span>&nbsp;<span class="ident" id="8264012">fn</span><span class="op" id="8264014">,</span>&nbsp;<span class="ident" id="8264016">level</span><span class="op" id="8264021">,</span>&nbsp;<span class="ident" id="8264023">nil</span><span class="op" id="8264026">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264035">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264038">}</span><br>
<span class="lineno"></span><span class="op" id="8264040">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="8264043">func</span>&nbsp;<span class="ident" id="8264048">TestWriterDictIsUsed</span><span class="op" id="8264068">(</span><span class="ident" id="8264069">t</span>&nbsp;<span class="op" id="8264071">*</span><span class="ident" id="8264072">testing</span><span class="op" id="8264079">.</span><span class="ident" id="8264080">T</span><span class="op" id="8264081">)</span>&nbsp;<span class="op" id="8264083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264086">var</span>&nbsp;<span class="ident" id="8264090">input</span>&nbsp;<span class="op" id="8264096">=</span>&nbsp;<span class="op" id="8264098">[</span><span class="op" id="8264099">]</span><span class="builtintype" id="8264100">byte</span><span class="op" id="8264104">(</span><span class="string" id="8264105">&#34;Lorem&nbsp;ipsum&nbsp;dolor&nbsp;sit&nbsp;amet,&nbsp;consectetur&nbsp;adipisicing&nbsp;elit,&nbsp;sed&nbsp;do&nbsp;eiusmod&nbsp;tempor&nbsp;incididunt&nbsp;ut&nbsp;labore&nbsp;et&nbsp;dolore&nbsp;magna&nbsp;aliqua.&#34;</span><span class="op" id="8264231">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264234">var</span>&nbsp;<span class="ident" id="8264238">buf</span>&nbsp;<span class="ident" id="8264242">bytes</span><span class="op" id="8264247">.</span><span class="ident" id="8264248">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264256">compressor</span><span class="op" id="8264266">,</span>&nbsp;<span class="ident" id="8264268">err</span>&nbsp;<span class="op" id="8264272">:=</span>&nbsp;<span class="ident" id="8264275">NewWriterLevelDict</span><span class="op" id="8264293">(</span><span class="op" id="8264294">&amp;</span><span class="ident" id="8264295">buf</span><span class="op" id="8264298">,</span>&nbsp;<span class="ident" id="8264300">BestCompression</span><span class="op" id="8264315">,</span>&nbsp;<span class="ident" id="8264317">input</span><span class="op" id="8264322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264325">if</span>&nbsp;<span class="ident" id="8264328">err</span>&nbsp;<span class="op" id="8264332">!=</span>&nbsp;<span class="ident" id="8264335">nil</span>&nbsp;<span class="op" id="8264339">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264343">t</span><span class="op" id="8264344">.</span><span class="ident" id="8264345">Errorf</span><span class="op" id="8264351">(</span><span class="string" id="8264352">&#34;error&nbsp;in&nbsp;NewWriterLevelDict:&nbsp;%s&#34;</span><span class="op" id="8264385">,</span>&nbsp;<span class="ident" id="8264387">err</span><span class="op" id="8264390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264394">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264402">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264405">compressor</span><span class="op" id="8264415">.</span><span class="ident" id="8264416">Write</span><span class="op" id="8264421">(</span><span class="ident" id="8264422">input</span><span class="op" id="8264427">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264430">compressor</span><span class="op" id="8264440">.</span><span class="ident" id="8264441">Close</span><span class="op" id="8264446">(</span><span class="op" id="8264447">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264450">const</span>&nbsp;<span class="ident" id="8264456">expectedMaxSize</span>&nbsp;<span class="op" id="8264472">=</span>&nbsp;<span class="num" id="8264474">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264478">output</span>&nbsp;<span class="op" id="8264485">:=</span>&nbsp;<span class="ident" id="8264488">buf</span><span class="op" id="8264491">.</span><span class="ident" id="8264492">Bytes</span><span class="op" id="8264497">(</span><span class="op" id="8264498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264501">if</span>&nbsp;<span class="builtinfunc" id="8264504">len</span><span class="op" id="8264507">(</span><span class="ident" id="8264508">output</span><span class="op" id="8264514">)</span>&nbsp;<span class="op" id="8264516">&gt;</span>&nbsp;<span class="ident" id="8264518">expectedMaxSize</span>&nbsp;<span class="op" id="8264534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264538">t</span><span class="op" id="8264539">.</span><span class="ident" id="8264540">Errorf</span><span class="op" id="8264546">(</span><span class="string" id="8264547">&#34;result&nbsp;too&nbsp;large&nbsp;(got&nbsp;%d,&nbsp;want&nbsp;&lt;=&nbsp;%d&nbsp;bytes).&nbsp;Is&nbsp;the&nbsp;dictionary&nbsp;being&nbsp;used?&#34;</span><span class="op" id="8264623">,</span>&nbsp;<span class="builtinfunc" id="8264625">len</span><span class="op" id="8264628">(</span><span class="ident" id="8264629">output</span><span class="op" id="8264635">)</span><span class="op" id="8264636">,</span>&nbsp;<span class="ident" id="8264638">expectedMaxSize</span><span class="op" id="8264653">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264656">}</span><br>
<span class="lineno">205</span><span class="op" id="8264658">}</span>
</div>
</body>
</html>
