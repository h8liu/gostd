<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html" class="current">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2496703">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2496758">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2496812">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2496863">package</span>&nbsp;<span class="ident" id="2496871">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2496875">import</span>&nbsp;<span class="op" id="2496882">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2496885">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2496896">&#34;sync&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2496904">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2496914">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2496917">var</span>&nbsp;<span class="ident" id="2496921">getwdCache</span>&nbsp;<span class="keyword" id="2496932">struct</span>&nbsp;<span class="op" id="2496939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496942">sync</span><span class="op" id="2496946">.</span><span class="ident" id="2496947">Mutex</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2496954">dir</span>&nbsp;<span class="builtintype" id="2496958">string</span><br>
<span class="lineno"></span><span class="op" id="2496965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2496968">//&nbsp;useSyscallwd&nbsp;determines&nbsp;whether&nbsp;to&nbsp;use&nbsp;the&nbsp;return&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2497030">//&nbsp;syscall.Getwd&nbsp;based&nbsp;on&nbsp;its&nbsp;error.</span><br>
<span class="lineno">20</span><span class="keyword" id="2497067">var</span>&nbsp;<span class="ident" id="2497071">useSyscallwd</span>&nbsp;<span class="op" id="2497084">=</span>&nbsp;<span class="keyword" id="2497086">func</span><span class="op" id="2497090">(</span><span class="builtintype" id="2497091">error</span><span class="op" id="2497096">)</span>&nbsp;<span class="builtintype" id="2497098">bool</span>&nbsp;<span class="op" id="2497103">{</span>&nbsp;<span class="keyword" id="2497105">return</span>&nbsp;<span class="builtintype" id="2497112">true</span>&nbsp;<span class="op" id="2497117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2497120">//&nbsp;Getwd&nbsp;returns&nbsp;a&nbsp;rooted&nbsp;path&nbsp;name&nbsp;corresponding&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2497177">//&nbsp;current&nbsp;directory.&nbsp;&nbsp;If&nbsp;the&nbsp;current&nbsp;directory&nbsp;can&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2497232">//&nbsp;reached&nbsp;via&nbsp;multiple&nbsp;paths&nbsp;(due&nbsp;to&nbsp;symbolic&nbsp;links),</span><br>
<span class="lineno">25</span><span class="comment" id="2497287">//&nbsp;Getwd&nbsp;may&nbsp;return&nbsp;any&nbsp;one&nbsp;of&nbsp;them.</span><br>
<span class="lineno"></span><span class="keyword" id="2497324">func</span>&nbsp;<span class="ident" id="2497329">Getwd</span><span class="op" id="2497334">(</span><span class="op" id="2497335">)</span>&nbsp;<span class="op" id="2497337">(</span><span class="ident" id="2497338">dir</span>&nbsp;<span class="builtintype" id="2497342">string</span><span class="op" id="2497348">,</span>&nbsp;<span class="ident" id="2497350">err</span>&nbsp;<span class="builtintype" id="2497354">error</span><span class="op" id="2497359">)</span>&nbsp;<span class="op" id="2497361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497364">if</span>&nbsp;<span class="ident" id="2497367">runtime</span><span class="op" id="2497374">.</span><span class="ident" id="2497375">GOOS</span>&nbsp;<span class="op" id="2497380">==</span>&nbsp;<span class="string" id="2497383">&#34;windows&#34;</span>&nbsp;<span class="op" id="2497393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497397">return</span>&nbsp;<span class="ident" id="2497404">syscall</span><span class="op" id="2497411">.</span><span class="ident" id="2497412">Getwd</span><span class="op" id="2497417">(</span><span class="op" id="2497418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497421">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2497425">//&nbsp;Clumsy&nbsp;but&nbsp;widespread&nbsp;kludge:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2497459">//&nbsp;if&nbsp;$PWD&nbsp;is&nbsp;set&nbsp;and&nbsp;matches&nbsp;&#34;.&#34;,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497503">dot</span><span class="op" id="2497506">,</span>&nbsp;<span class="ident" id="2497508">err</span>&nbsp;<span class="op" id="2497512">:=</span>&nbsp;<span class="ident" id="2497515">Stat</span><span class="op" id="2497519">(</span><span class="string" id="2497520">&#34;.&#34;</span><span class="op" id="2497523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497526">if</span>&nbsp;<span class="ident" id="2497529">err</span>&nbsp;<span class="op" id="2497533">!=</span>&nbsp;<span class="builtintype" id="2497536">nil</span>&nbsp;<span class="op" id="2497540">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497544">return</span>&nbsp;<span class="string" id="2497551">&#34;&#34;</span><span class="op" id="2497553">,</span>&nbsp;<span class="ident" id="2497555">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497563">dir</span>&nbsp;<span class="op" id="2497567">=</span>&nbsp;<span class="ident" id="2497569">Getenv</span><span class="op" id="2497575">(</span><span class="string" id="2497576">&#34;PWD&#34;</span><span class="op" id="2497581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497584">if</span>&nbsp;<span class="builtinfunc" id="2497587">len</span><span class="op" id="2497590">(</span><span class="ident" id="2497591">dir</span><span class="op" id="2497594">)</span>&nbsp;<span class="op" id="2497596">&gt;</span>&nbsp;<span class="num" id="2497598">0</span>&nbsp;<span class="op" id="2497600">&amp;&amp;</span>&nbsp;<span class="ident" id="2497603">dir</span><span class="op" id="2497606">[</span><span class="num" id="2497607">0</span><span class="op" id="2497608">]</span>&nbsp;<span class="op" id="2497610">==</span>&nbsp;<span class="string" id="2497613">&#39;/&#39;</span>&nbsp;<span class="op" id="2497617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497621">d</span><span class="op" id="2497622">,</span>&nbsp;<span class="ident" id="2497624">err</span>&nbsp;<span class="op" id="2497628">:=</span>&nbsp;<span class="ident" id="2497631">Stat</span><span class="op" id="2497635">(</span><span class="ident" id="2497636">dir</span><span class="op" id="2497639">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497643">if</span>&nbsp;<span class="ident" id="2497646">err</span>&nbsp;<span class="op" id="2497650">==</span>&nbsp;<span class="builtintype" id="2497653">nil</span>&nbsp;<span class="op" id="2497657">&amp;&amp;</span>&nbsp;<span class="ident" id="2497660">SameFile</span><span class="op" id="2497668">(</span><span class="ident" id="2497669">dot</span><span class="op" id="2497672">,</span>&nbsp;<span class="ident" id="2497674">d</span><span class="op" id="2497675">)</span>&nbsp;<span class="op" id="2497677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497682">return</span>&nbsp;<span class="ident" id="2497689">dir</span><span class="op" id="2497692">,</span>&nbsp;<span class="builtintype" id="2497694">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497703">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2497707">//&nbsp;If&nbsp;the&nbsp;operating&nbsp;system&nbsp;provides&nbsp;a&nbsp;Getwd&nbsp;call,&nbsp;use&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2497766">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;trying&nbsp;to&nbsp;find&nbsp;our&nbsp;way&nbsp;back&nbsp;to&nbsp;&#34;.&#34;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497823">if</span>&nbsp;<span class="ident" id="2497826">syscall</span><span class="op" id="2497833">.</span><span class="ident" id="2497834">ImplementsGetwd</span>&nbsp;<span class="op" id="2497850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2497854">s</span><span class="op" id="2497855">,</span>&nbsp;<span class="ident" id="2497857">e</span>&nbsp;<span class="op" id="2497859">:=</span>&nbsp;<span class="ident" id="2497862">syscall</span><span class="op" id="2497869">.</span><span class="ident" id="2497870">Getwd</span><span class="op" id="2497875">(</span><span class="op" id="2497876">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497880">if</span>&nbsp;<span class="ident" id="2497883">useSyscallwd</span><span class="op" id="2497895">(</span><span class="ident" id="2497896">e</span><span class="op" id="2497897">)</span>&nbsp;<span class="op" id="2497899">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2497904">return</span>&nbsp;<span class="ident" id="2497911">s</span><span class="op" id="2497912">,</span>&nbsp;<span class="ident" id="2497914">NewSyscallError</span><span class="op" id="2497929">(</span><span class="string" id="2497930">&#34;getwd&#34;</span><span class="op" id="2497937">,</span>&nbsp;<span class="ident" id="2497939">e</span><span class="op" id="2497940">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2497947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2497951">//&nbsp;Apply&nbsp;same&nbsp;kludge&nbsp;but&nbsp;to&nbsp;cached&nbsp;dir&nbsp;instead&nbsp;of&nbsp;$PWD.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498008">getwdCache</span><span class="op" id="2498018">.</span><span class="ident" id="2498019">Lock</span><span class="op" id="2498023">(</span><span class="op" id="2498024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498027">dir</span>&nbsp;<span class="op" id="2498031">=</span>&nbsp;<span class="ident" id="2498033">getwdCache</span><span class="op" id="2498043">.</span><span class="ident" id="2498044">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498049">getwdCache</span><span class="op" id="2498059">.</span><span class="ident" id="2498060">Unlock</span><span class="op" id="2498066">(</span><span class="op" id="2498067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498070">if</span>&nbsp;<span class="builtinfunc" id="2498073">len</span><span class="op" id="2498076">(</span><span class="ident" id="2498077">dir</span><span class="op" id="2498080">)</span>&nbsp;<span class="op" id="2498082">&gt;</span>&nbsp;<span class="num" id="2498084">0</span>&nbsp;<span class="op" id="2498086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498090">d</span><span class="op" id="2498091">,</span>&nbsp;<span class="ident" id="2498093">err</span>&nbsp;<span class="op" id="2498097">:=</span>&nbsp;<span class="ident" id="2498100">Stat</span><span class="op" id="2498104">(</span><span class="ident" id="2498105">dir</span><span class="op" id="2498108">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498112">if</span>&nbsp;<span class="ident" id="2498115">err</span>&nbsp;<span class="op" id="2498119">==</span>&nbsp;<span class="builtintype" id="2498122">nil</span>&nbsp;<span class="op" id="2498126">&amp;&amp;</span>&nbsp;<span class="ident" id="2498129">SameFile</span><span class="op" id="2498137">(</span><span class="ident" id="2498138">dot</span><span class="op" id="2498141">,</span>&nbsp;<span class="ident" id="2498143">d</span><span class="op" id="2498144">)</span>&nbsp;<span class="op" id="2498146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498151">return</span>&nbsp;<span class="ident" id="2498158">dir</span><span class="op" id="2498161">,</span>&nbsp;<span class="builtintype" id="2498163">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498169">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498176">//&nbsp;Root&nbsp;is&nbsp;a&nbsp;special&nbsp;case&nbsp;because&nbsp;it&nbsp;has&nbsp;no&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498228">//&nbsp;and&nbsp;ends&nbsp;in&nbsp;a&nbsp;slash.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498253">root</span><span class="op" id="2498257">,</span>&nbsp;<span class="ident" id="2498259">err</span>&nbsp;<span class="op" id="2498263">:=</span>&nbsp;<span class="ident" id="2498266">Stat</span><span class="op" id="2498270">(</span><span class="string" id="2498271">&#34;/&#34;</span><span class="op" id="2498274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498277">if</span>&nbsp;<span class="ident" id="2498280">err</span>&nbsp;<span class="op" id="2498284">!=</span>&nbsp;<span class="builtintype" id="2498287">nil</span>&nbsp;<span class="op" id="2498291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498295">//&nbsp;Can&#39;t&nbsp;stat&nbsp;root&nbsp;-&nbsp;no&nbsp;hope.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498327">return</span>&nbsp;<span class="string" id="2498334">&#34;&#34;</span><span class="op" id="2498336">,</span>&nbsp;<span class="ident" id="2498338">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498346">if</span>&nbsp;<span class="ident" id="2498349">SameFile</span><span class="op" id="2498357">(</span><span class="ident" id="2498358">root</span><span class="op" id="2498362">,</span>&nbsp;<span class="ident" id="2498364">dot</span><span class="op" id="2498367">)</span>&nbsp;<span class="op" id="2498369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498373">return</span>&nbsp;<span class="string" id="2498380">&#34;/&#34;</span><span class="op" id="2498383">,</span>&nbsp;<span class="builtintype" id="2498385">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498390">}</span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498394">//&nbsp;General&nbsp;algorithm:&nbsp;find&nbsp;name&nbsp;in&nbsp;parent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498437">//&nbsp;and&nbsp;then&nbsp;find&nbsp;name&nbsp;of&nbsp;parent.&nbsp;&nbsp;Each&nbsp;iteration</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2498487">//&nbsp;adds&nbsp;/name&nbsp;to&nbsp;the&nbsp;beginning&nbsp;of&nbsp;dir.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498527">dir</span>&nbsp;<span class="op" id="2498531">=</span>&nbsp;<span class="string" id="2498533">&#34;&#34;</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498537">for</span>&nbsp;<span class="ident" id="2498541">parent</span>&nbsp;<span class="op" id="2498548">:=</span>&nbsp;<span class="string" id="2498551">&#34;..&#34;</span><span class="op" id="2498555">;</span>&nbsp;<span class="op" id="2498557">;</span>&nbsp;<span class="ident" id="2498559">parent</span>&nbsp;<span class="op" id="2498566">=</span>&nbsp;<span class="string" id="2498568">&#34;../&#34;</span>&nbsp;<span class="op" id="2498574">+</span>&nbsp;<span class="ident" id="2498576">parent</span>&nbsp;<span class="op" id="2498583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498587">if</span>&nbsp;<span class="builtinfunc" id="2498590">len</span><span class="op" id="2498593">(</span><span class="ident" id="2498594">parent</span><span class="op" id="2498600">)</span>&nbsp;<span class="op" id="2498602">&gt;=</span>&nbsp;<span class="num" id="2498605">1024</span>&nbsp;<span class="op" id="2498610">{</span>&nbsp;<span class="comment" id="2498612">//&nbsp;Sanity&nbsp;check</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498631">return</span>&nbsp;<span class="string" id="2498638">&#34;&#34;</span><span class="op" id="2498640">,</span>&nbsp;<span class="ident" id="2498642">syscall</span><span class="op" id="2498649">.</span><span class="ident" id="2498650">ENAMETOOLONG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498665">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498669">fd</span><span class="op" id="2498671">,</span>&nbsp;<span class="ident" id="2498673">err</span>&nbsp;<span class="op" id="2498677">:=</span>&nbsp;<span class="ident" id="2498680">Open</span><span class="op" id="2498684">(</span><span class="ident" id="2498685">parent</span><span class="op" id="2498691">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498695">if</span>&nbsp;<span class="ident" id="2498698">err</span>&nbsp;<span class="op" id="2498702">!=</span>&nbsp;<span class="builtintype" id="2498705">nil</span>&nbsp;<span class="op" id="2498709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498714">return</span>&nbsp;<span class="string" id="2498721">&#34;&#34;</span><span class="op" id="2498723">,</span>&nbsp;<span class="ident" id="2498725">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498736">for</span>&nbsp;<span class="op" id="2498740">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498745">names</span><span class="op" id="2498750">,</span>&nbsp;<span class="ident" id="2498752">err</span>&nbsp;<span class="op" id="2498756">:=</span>&nbsp;<span class="ident" id="2498759">fd</span><span class="op" id="2498761">.</span><span class="ident" id="2498762">Readdirnames</span><span class="op" id="2498774">(</span><span class="num" id="2498775">100</span><span class="op" id="2498778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498783">if</span>&nbsp;<span class="ident" id="2498786">err</span>&nbsp;<span class="op" id="2498790">!=</span>&nbsp;<span class="builtintype" id="2498793">nil</span>&nbsp;<span class="op" id="2498797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498803">fd</span><span class="op" id="2498805">.</span><span class="ident" id="2498806">Close</span><span class="op" id="2498811">(</span><span class="op" id="2498812">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498818">return</span>&nbsp;<span class="string" id="2498825">&#34;&#34;</span><span class="op" id="2498827">,</span>&nbsp;<span class="ident" id="2498829">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498836">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498841">for</span>&nbsp;<span class="ident" id="2498845">_</span><span class="op" id="2498846">,</span>&nbsp;<span class="ident" id="2498848">name</span>&nbsp;<span class="op" id="2498853">:=</span>&nbsp;<span class="keyword" id="2498856">range</span>&nbsp;<span class="ident" id="2498862">names</span>&nbsp;<span class="op" id="2498868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498874">d</span><span class="op" id="2498875">,</span>&nbsp;<span class="ident" id="2498877">_</span>&nbsp;<span class="op" id="2498879">:=</span>&nbsp;<span class="ident" id="2498882">Lstat</span><span class="op" id="2498887">(</span><span class="ident" id="2498888">parent</span>&nbsp;<span class="op" id="2498895">+</span>&nbsp;<span class="string" id="2498897">&#34;/&#34;</span>&nbsp;<span class="op" id="2498901">+</span>&nbsp;<span class="ident" id="2498903">name</span><span class="op" id="2498907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498913">if</span>&nbsp;<span class="ident" id="2498916">SameFile</span><span class="op" id="2498924">(</span><span class="ident" id="2498925">d</span><span class="op" id="2498926">,</span>&nbsp;<span class="ident" id="2498928">dot</span><span class="op" id="2498931">)</span>&nbsp;<span class="op" id="2498933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498940">dir</span>&nbsp;<span class="op" id="2498944">=</span>&nbsp;<span class="string" id="2498946">&#34;/&#34;</span>&nbsp;<span class="op" id="2498950">+</span>&nbsp;<span class="ident" id="2498952">name</span>&nbsp;<span class="op" id="2498957">+</span>&nbsp;<span class="ident" id="2498959">dir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2498968">goto</span>&nbsp;<span class="ident" id="2498973">Found</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2498992">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2498996">Found</span><span class="op" id="2499001">:</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499005">pd</span><span class="op" id="2499007">,</span>&nbsp;<span class="ident" id="2499009">err</span>&nbsp;<span class="op" id="2499013">:=</span>&nbsp;<span class="ident" id="2499016">fd</span><span class="op" id="2499018">.</span><span class="ident" id="2499019">Stat</span><span class="op" id="2499023">(</span><span class="op" id="2499024">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2499028">if</span>&nbsp;<span class="ident" id="2499031">err</span>&nbsp;<span class="op" id="2499035">!=</span>&nbsp;<span class="builtintype" id="2499038">nil</span>&nbsp;<span class="op" id="2499042">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2499047">return</span>&nbsp;<span class="string" id="2499054">&#34;&#34;</span><span class="op" id="2499056">,</span>&nbsp;<span class="ident" id="2499058">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2499064">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499068">fd</span><span class="op" id="2499070">.</span><span class="ident" id="2499071">Close</span><span class="op" id="2499076">(</span><span class="op" id="2499077">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2499081">if</span>&nbsp;<span class="ident" id="2499084">SameFile</span><span class="op" id="2499092">(</span><span class="ident" id="2499093">pd</span><span class="op" id="2499095">,</span>&nbsp;<span class="ident" id="2499097">root</span><span class="op" id="2499101">)</span>&nbsp;<span class="op" id="2499103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2499108">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2499116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2499120">//&nbsp;Set&nbsp;up&nbsp;for&nbsp;next&nbsp;round.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499148">dot</span>&nbsp;<span class="op" id="2499152">=</span>&nbsp;<span class="ident" id="2499154">pd</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2499158">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2499162">//&nbsp;Save&nbsp;answer&nbsp;as&nbsp;hint&nbsp;to&nbsp;avoid&nbsp;the&nbsp;expensive&nbsp;path&nbsp;next&nbsp;time.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499225">getwdCache</span><span class="op" id="2499235">.</span><span class="ident" id="2499236">Lock</span><span class="op" id="2499240">(</span><span class="op" id="2499241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499244">getwdCache</span><span class="op" id="2499254">.</span><span class="ident" id="2499255">dir</span>&nbsp;<span class="op" id="2499259">=</span>&nbsp;<span class="ident" id="2499261">dir</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2499266">getwdCache</span><span class="op" id="2499276">.</span><span class="ident" id="2499277">Unlock</span><span class="op" id="2499283">(</span><span class="op" id="2499284">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2499288">return</span>&nbsp;<span class="ident" id="2499295">dir</span><span class="op" id="2499298">,</span>&nbsp;<span class="builtintype" id="2499300">nil</span><br>
<span class="lineno"></span><span class="op" id="2499304">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
