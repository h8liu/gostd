<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html" class="current">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2600476">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2600531">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2600585">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2600636">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600701">package</span>&nbsp;<span class="ident" id="2600709">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2600718">import</span>&nbsp;<span class="op" id="2600725">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2600728">&#34;runtime&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2600739">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2600747">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><span class="op" id="2600756">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="2600759">var</span>&nbsp;<span class="op" id="2600763">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600766">Stdin</span>&nbsp;&nbsp;<span class="op" id="2600773">=</span>&nbsp;<span class="num" id="2600775">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600778">Stdout</span>&nbsp;<span class="op" id="2600785">=</span>&nbsp;<span class="num" id="2600787">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600790">Stderr</span>&nbsp;<span class="op" id="2600797">=</span>&nbsp;<span class="num" id="2600799">2</span><br>
<span class="lineno"></span><span class="op" id="2600801">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="2600804">const</span>&nbsp;<span class="op" id="2600810">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600813">darwin64Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2600828">=</span>&nbsp;<span class="ident" id="2600830">runtime</span><span class="op" id="2600837">.</span><span class="ident" id="2600838">GOOS</span>&nbsp;<span class="op" id="2600843">==</span>&nbsp;<span class="string" id="2600846">&#34;darwin&#34;</span>&nbsp;<span class="op" id="2600855">&amp;&amp;</span>&nbsp;<span class="ident" id="2600858">sizeofPtr</span>&nbsp;<span class="op" id="2600868">==</span>&nbsp;<span class="num" id="2600871">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600874">dragonfly64Bit</span>&nbsp;<span class="op" id="2600889">=</span>&nbsp;<span class="ident" id="2600891">runtime</span><span class="op" id="2600898">.</span><span class="ident" id="2600899">GOOS</span>&nbsp;<span class="op" id="2600904">==</span>&nbsp;<span class="string" id="2600907">&#34;dragonfly&#34;</span>&nbsp;<span class="op" id="2600919">&amp;&amp;</span>&nbsp;<span class="ident" id="2600922">sizeofPtr</span>&nbsp;<span class="op" id="2600932">==</span>&nbsp;<span class="num" id="2600935">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2600938">netbsd32Bit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2600953">=</span>&nbsp;<span class="ident" id="2600955">runtime</span><span class="op" id="2600962">.</span><span class="ident" id="2600963">GOOS</span>&nbsp;<span class="op" id="2600968">==</span>&nbsp;<span class="string" id="2600971">&#34;netbsd&#34;</span>&nbsp;<span class="op" id="2600980">&amp;&amp;</span>&nbsp;<span class="ident" id="2600983">sizeofPtr</span>&nbsp;<span class="op" id="2600993">==</span>&nbsp;<span class="num" id="2600996">4</span><br>
<span class="lineno">25</span><span class="op" id="2600998">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2601001">func</span>&nbsp;<span class="ident" id="2601006">Syscall</span><span class="op" id="2601013">(</span><span class="ident" id="2601014">trap</span><span class="op" id="2601018">,</span>&nbsp;<span class="ident" id="2601020">a1</span><span class="op" id="2601022">,</span>&nbsp;<span class="ident" id="2601024">a2</span><span class="op" id="2601026">,</span>&nbsp;<span class="ident" id="2601028">a3</span>&nbsp;<span class="builtintype" id="2601031">uintptr</span><span class="op" id="2601038">)</span>&nbsp;<span class="op" id="2601040">(</span><span class="ident" id="2601041">r1</span><span class="op" id="2601043">,</span>&nbsp;<span class="ident" id="2601045">r2</span>&nbsp;<span class="builtintype" id="2601048">uintptr</span><span class="op" id="2601055">,</span>&nbsp;<span class="ident" id="2601057">err</span>&nbsp;<span class="ident" id="2601061">Errno</span><span class="op" id="2601066">)</span><br>
<span class="lineno"></span><span class="keyword" id="2601068">func</span>&nbsp;<span class="ident" id="2601073">Syscall6</span><span class="op" id="2601081">(</span><span class="ident" id="2601082">trap</span><span class="op" id="2601086">,</span>&nbsp;<span class="ident" id="2601088">a1</span><span class="op" id="2601090">,</span>&nbsp;<span class="ident" id="2601092">a2</span><span class="op" id="2601094">,</span>&nbsp;<span class="ident" id="2601096">a3</span><span class="op" id="2601098">,</span>&nbsp;<span class="ident" id="2601100">a4</span><span class="op" id="2601102">,</span>&nbsp;<span class="ident" id="2601104">a5</span><span class="op" id="2601106">,</span>&nbsp;<span class="ident" id="2601108">a6</span>&nbsp;<span class="builtintype" id="2601111">uintptr</span><span class="op" id="2601118">)</span>&nbsp;<span class="op" id="2601120">(</span><span class="ident" id="2601121">r1</span><span class="op" id="2601123">,</span>&nbsp;<span class="ident" id="2601125">r2</span>&nbsp;<span class="builtintype" id="2601128">uintptr</span><span class="op" id="2601135">,</span>&nbsp;<span class="ident" id="2601137">err</span>&nbsp;<span class="ident" id="2601141">Errno</span><span class="op" id="2601146">)</span><br>
<span class="lineno"></span><span class="keyword" id="2601148">func</span>&nbsp;<span class="ident" id="2601153">RawSyscall</span><span class="op" id="2601163">(</span><span class="ident" id="2601164">trap</span><span class="op" id="2601168">,</span>&nbsp;<span class="ident" id="2601170">a1</span><span class="op" id="2601172">,</span>&nbsp;<span class="ident" id="2601174">a2</span><span class="op" id="2601176">,</span>&nbsp;<span class="ident" id="2601178">a3</span>&nbsp;<span class="builtintype" id="2601181">uintptr</span><span class="op" id="2601188">)</span>&nbsp;<span class="op" id="2601190">(</span><span class="ident" id="2601191">r1</span><span class="op" id="2601193">,</span>&nbsp;<span class="ident" id="2601195">r2</span>&nbsp;<span class="builtintype" id="2601198">uintptr</span><span class="op" id="2601205">,</span>&nbsp;<span class="ident" id="2601207">err</span>&nbsp;<span class="ident" id="2601211">Errno</span><span class="op" id="2601216">)</span><br>
<span class="lineno">30</span><span class="keyword" id="2601218">func</span>&nbsp;<span class="ident" id="2601223">RawSyscall6</span><span class="op" id="2601234">(</span><span class="ident" id="2601235">trap</span><span class="op" id="2601239">,</span>&nbsp;<span class="ident" id="2601241">a1</span><span class="op" id="2601243">,</span>&nbsp;<span class="ident" id="2601245">a2</span><span class="op" id="2601247">,</span>&nbsp;<span class="ident" id="2601249">a3</span><span class="op" id="2601251">,</span>&nbsp;<span class="ident" id="2601253">a4</span><span class="op" id="2601255">,</span>&nbsp;<span class="ident" id="2601257">a5</span><span class="op" id="2601259">,</span>&nbsp;<span class="ident" id="2601261">a6</span>&nbsp;<span class="builtintype" id="2601264">uintptr</span><span class="op" id="2601271">)</span>&nbsp;<span class="op" id="2601273">(</span><span class="ident" id="2601274">r1</span><span class="op" id="2601276">,</span>&nbsp;<span class="ident" id="2601278">r2</span>&nbsp;<span class="builtintype" id="2601281">uintptr</span><span class="op" id="2601288">,</span>&nbsp;<span class="ident" id="2601290">err</span>&nbsp;<span class="ident" id="2601294">Errno</span><span class="op" id="2601299">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2601302">//&nbsp;Mmap&nbsp;manager,&nbsp;for&nbsp;use&nbsp;by&nbsp;operating&nbsp;system-specific&nbsp;implementations.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2601374">type</span>&nbsp;<span class="ident" id="2601379">mmapper</span>&nbsp;<span class="keyword" id="2601387">struct</span>&nbsp;<span class="op" id="2601394">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601397">sync</span><span class="op" id="2601401">.</span><span class="ident" id="2601402">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601409">active</span>&nbsp;<span class="keyword" id="2601416">map</span><span class="op" id="2601419">[</span><span class="op" id="2601420">*</span><span class="builtintype" id="2601421">byte</span><span class="op" id="2601425">]</span><span class="op" id="2601426">[</span><span class="op" id="2601427">]</span><span class="builtintype" id="2601428">byte</span>&nbsp;<span class="comment" id="2601433">//&nbsp;active&nbsp;mappings;&nbsp;key&nbsp;is&nbsp;last&nbsp;byte&nbsp;in&nbsp;mapping</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601482">mmap</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601489">func</span><span class="op" id="2601493">(</span><span class="ident" id="2601494">addr</span><span class="op" id="2601498">,</span>&nbsp;<span class="ident" id="2601500">length</span>&nbsp;<span class="builtintype" id="2601507">uintptr</span><span class="op" id="2601514">,</span>&nbsp;<span class="ident" id="2601516">prot</span><span class="op" id="2601520">,</span>&nbsp;<span class="ident" id="2601522">flags</span><span class="op" id="2601527">,</span>&nbsp;<span class="ident" id="2601529">fd</span>&nbsp;<span class="builtintype" id="2601532">int</span><span class="op" id="2601535">,</span>&nbsp;<span class="ident" id="2601537">offset</span>&nbsp;<span class="ident" id="2601544">int64</span><span class="op" id="2601549">)</span>&nbsp;<span class="op" id="2601551">(</span><span class="builtintype" id="2601552">uintptr</span><span class="op" id="2601559">,</span>&nbsp;<span class="builtintype" id="2601561">error</span><span class="op" id="2601566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601569">munmap</span>&nbsp;<span class="keyword" id="2601576">func</span><span class="op" id="2601580">(</span><span class="ident" id="2601581">addr</span>&nbsp;<span class="builtintype" id="2601586">uintptr</span><span class="op" id="2601593">,</span>&nbsp;<span class="ident" id="2601595">length</span>&nbsp;<span class="builtintype" id="2601602">uintptr</span><span class="op" id="2601609">)</span>&nbsp;<span class="builtintype" id="2601611">error</span><br>
<span class="lineno"></span><span class="op" id="2601617">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="2601620">func</span>&nbsp;<span class="op" id="2601625">(</span><span class="ident" id="2601626">m</span>&nbsp;<span class="op" id="2601628">*</span><span class="ident" id="2601629">mmapper</span><span class="op" id="2601636">)</span>&nbsp;<span class="ident" id="2601638">Mmap</span><span class="op" id="2601642">(</span><span class="ident" id="2601643">fd</span>&nbsp;<span class="builtintype" id="2601646">int</span><span class="op" id="2601649">,</span>&nbsp;<span class="ident" id="2601651">offset</span>&nbsp;<span class="ident" id="2601658">int64</span><span class="op" id="2601663">,</span>&nbsp;<span class="ident" id="2601665">length</span>&nbsp;<span class="builtintype" id="2601672">int</span><span class="op" id="2601675">,</span>&nbsp;<span class="ident" id="2601677">prot</span>&nbsp;<span class="builtintype" id="2601682">int</span><span class="op" id="2601685">,</span>&nbsp;<span class="ident" id="2601687">flags</span>&nbsp;<span class="builtintype" id="2601693">int</span><span class="op" id="2601696">)</span>&nbsp;<span class="op" id="2601698">(</span><span class="ident" id="2601699">data</span>&nbsp;<span class="op" id="2601704">[</span><span class="op" id="2601705">]</span><span class="builtintype" id="2601706">byte</span><span class="op" id="2601710">,</span>&nbsp;<span class="ident" id="2601712">err</span>&nbsp;<span class="builtintype" id="2601716">error</span><span class="op" id="2601721">)</span>&nbsp;<span class="op" id="2601723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601726">if</span>&nbsp;<span class="ident" id="2601729">length</span>&nbsp;<span class="op" id="2601736">&lt;=</span>&nbsp;<span class="num" id="2601739">0</span>&nbsp;<span class="op" id="2601741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601745">return</span>&nbsp;<span class="ident" id="2601752">nil</span><span class="op" id="2601755">,</span>&nbsp;<span class="ident" id="2601757">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2601765">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2601769">//&nbsp;Map&nbsp;the&nbsp;requested&nbsp;memory.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601799">addr</span><span class="op" id="2601803">,</span>&nbsp;<span class="ident" id="2601805">errno</span>&nbsp;<span class="op" id="2601811">:=</span>&nbsp;<span class="ident" id="2601814">m</span><span class="op" id="2601815">.</span><span class="ident" id="2601816">mmap</span><span class="op" id="2601820">(</span><span class="num" id="2601821">0</span><span class="op" id="2601822">,</span>&nbsp;<span class="builtintype" id="2601824">uintptr</span><span class="op" id="2601831">(</span><span class="ident" id="2601832">length</span><span class="op" id="2601838">)</span><span class="op" id="2601839">,</span>&nbsp;<span class="ident" id="2601841">prot</span><span class="op" id="2601845">,</span>&nbsp;<span class="ident" id="2601847">flags</span><span class="op" id="2601852">,</span>&nbsp;<span class="ident" id="2601854">fd</span><span class="op" id="2601856">,</span>&nbsp;<span class="ident" id="2601858">offset</span><span class="op" id="2601864">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601867">if</span>&nbsp;<span class="ident" id="2601870">errno</span>&nbsp;<span class="op" id="2601876">!=</span>&nbsp;<span class="ident" id="2601879">nil</span>&nbsp;<span class="op" id="2601883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601887">return</span>&nbsp;<span class="ident" id="2601894">nil</span><span class="op" id="2601897">,</span>&nbsp;<span class="ident" id="2601899">errno</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2601906">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2601910">//&nbsp;Slice&nbsp;memory&nbsp;layout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2601934">var</span>&nbsp;<span class="ident" id="2601938">sl</span>&nbsp;<span class="op" id="2601941">=</span>&nbsp;<span class="keyword" id="2601943">struct</span>&nbsp;<span class="op" id="2601950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2601954">addr</span>&nbsp;<span class="builtintype" id="2601959">uintptr</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2601969">len</span>&nbsp;&nbsp;<span class="builtintype" id="2601974">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2601980">cap</span>&nbsp;&nbsp;<span class="builtintype" id="2601985">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2601990">}</span><span class="op" id="2601991">{</span><span class="ident" id="2601992">addr</span><span class="op" id="2601996">,</span>&nbsp;<span class="ident" id="2601998">length</span><span class="op" id="2602004">,</span>&nbsp;<span class="ident" id="2602006">length</span><span class="op" id="2602012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2602016">//&nbsp;Use&nbsp;unsafe&nbsp;to&nbsp;turn&nbsp;sl&nbsp;into&nbsp;a&nbsp;[]byte.</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602057">b</span>&nbsp;<span class="op" id="2602059">:=</span>&nbsp;<span class="op" id="2602062">*</span><span class="op" id="2602063">(</span><span class="op" id="2602064">*</span><span class="op" id="2602065">[</span><span class="op" id="2602066">]</span><span class="builtintype" id="2602067">byte</span><span class="op" id="2602071">)</span><span class="op" id="2602072">(</span><span class="ident" id="2602073">unsafe</span><span class="op" id="2602079">.</span><span class="ident" id="2602080">Pointer</span><span class="op" id="2602087">(</span><span class="op" id="2602088">&amp;</span><span class="ident" id="2602089">sl</span><span class="op" id="2602091">)</span><span class="op" id="2602092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2602096">//&nbsp;Register&nbsp;mapping&nbsp;in&nbsp;m&nbsp;and&nbsp;return&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602137">p</span>&nbsp;<span class="op" id="2602139">:=</span>&nbsp;<span class="op" id="2602142">&amp;</span><span class="ident" id="2602143">b</span><span class="op" id="2602144">[</span><span class="builtinfunc" id="2602145">cap</span><span class="op" id="2602148">(</span><span class="ident" id="2602149">b</span><span class="op" id="2602150">)</span><span class="op" id="2602151">-</span><span class="num" id="2602152">1</span><span class="op" id="2602153">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602156">m</span><span class="op" id="2602157">.</span><span class="ident" id="2602158">Lock</span><span class="op" id="2602162">(</span><span class="op" id="2602163">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602166">defer</span>&nbsp;<span class="ident" id="2602172">m</span><span class="op" id="2602173">.</span><span class="ident" id="2602174">Unlock</span><span class="op" id="2602180">(</span><span class="op" id="2602181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602184">m</span><span class="op" id="2602185">.</span><span class="ident" id="2602186">active</span><span class="op" id="2602192">[</span><span class="ident" id="2602193">p</span><span class="op" id="2602194">]</span>&nbsp;<span class="op" id="2602196">=</span>&nbsp;<span class="ident" id="2602198">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602201">return</span>&nbsp;<span class="ident" id="2602208">b</span><span class="op" id="2602209">,</span>&nbsp;<span class="ident" id="2602211">nil</span><br>
<span class="lineno"></span><span class="op" id="2602215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="keyword" id="2602218">func</span>&nbsp;<span class="op" id="2602223">(</span><span class="ident" id="2602224">m</span>&nbsp;<span class="op" id="2602226">*</span><span class="ident" id="2602227">mmapper</span><span class="op" id="2602234">)</span>&nbsp;<span class="ident" id="2602236">Munmap</span><span class="op" id="2602242">(</span><span class="ident" id="2602243">data</span>&nbsp;<span class="op" id="2602248">[</span><span class="op" id="2602249">]</span><span class="builtintype" id="2602250">byte</span><span class="op" id="2602254">)</span>&nbsp;<span class="op" id="2602256">(</span><span class="ident" id="2602257">err</span>&nbsp;<span class="builtintype" id="2602261">error</span><span class="op" id="2602266">)</span>&nbsp;<span class="op" id="2602268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602271">if</span>&nbsp;<span class="builtinfunc" id="2602274">len</span><span class="op" id="2602277">(</span><span class="ident" id="2602278">data</span><span class="op" id="2602282">)</span>&nbsp;<span class="op" id="2602284">==</span>&nbsp;<span class="num" id="2602287">0</span>&nbsp;<span class="op" id="2602289">||</span>&nbsp;<span class="builtinfunc" id="2602292">len</span><span class="op" id="2602295">(</span><span class="ident" id="2602296">data</span><span class="op" id="2602300">)</span>&nbsp;<span class="op" id="2602302">!=</span>&nbsp;<span class="builtinfunc" id="2602305">cap</span><span class="op" id="2602308">(</span><span class="ident" id="2602309">data</span><span class="op" id="2602313">)</span>&nbsp;<span class="op" id="2602315">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602319">return</span>&nbsp;<span class="ident" id="2602326">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2602334">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2602338">//&nbsp;Find&nbsp;the&nbsp;base&nbsp;of&nbsp;the&nbsp;mapping.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602372">p</span>&nbsp;<span class="op" id="2602374">:=</span>&nbsp;<span class="op" id="2602377">&amp;</span><span class="ident" id="2602378">data</span><span class="op" id="2602382">[</span><span class="builtinfunc" id="2602383">cap</span><span class="op" id="2602386">(</span><span class="ident" id="2602387">data</span><span class="op" id="2602391">)</span><span class="op" id="2602392">-</span><span class="num" id="2602393">1</span><span class="op" id="2602394">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602397">m</span><span class="op" id="2602398">.</span><span class="ident" id="2602399">Lock</span><span class="op" id="2602403">(</span><span class="op" id="2602404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602407">defer</span>&nbsp;<span class="ident" id="2602413">m</span><span class="op" id="2602414">.</span><span class="ident" id="2602415">Unlock</span><span class="op" id="2602421">(</span><span class="op" id="2602422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2602425">b</span>&nbsp;<span class="op" id="2602427">:=</span>&nbsp;<span class="ident" id="2602430">m</span><span class="op" id="2602431">.</span><span class="ident" id="2602432">active</span><span class="op" id="2602438">[</span><span class="ident" id="2602439">p</span><span class="op" id="2602440">]</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602443">if</span>&nbsp;<span class="ident" id="2602446">b</span>&nbsp;<span class="op" id="2602448">==</span>&nbsp;<span class="ident" id="2602451">nil</span>&nbsp;<span class="op" id="2602455">||</span>&nbsp;<span class="op" id="2602458">&amp;</span><span class="ident" id="2602459">b</span><span class="op" id="2602460">[</span><span class="num" id="2602461">0</span><span class="op" id="2602462">]</span>&nbsp;<span class="op" id="2602464">!=</span>&nbsp;<span class="op" id="2602467">&amp;</span><span class="ident" id="2602468">data</span><span class="op" id="2602472">[</span><span class="num" id="2602473">0</span><span class="op" id="2602474">]</span>&nbsp;<span class="op" id="2602476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602480">return</span>&nbsp;<span class="ident" id="2602487">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2602495">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2602499">//&nbsp;Unmap&nbsp;the&nbsp;memory&nbsp;and&nbsp;update&nbsp;m.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602534">if</span>&nbsp;<span class="ident" id="2602537">errno</span>&nbsp;<span class="op" id="2602543">:=</span>&nbsp;<span class="ident" id="2602546">m</span><span class="op" id="2602547">.</span><span class="ident" id="2602548">munmap</span><span class="op" id="2602554">(</span><span class="builtintype" id="2602555">uintptr</span><span class="op" id="2602562">(</span><span class="ident" id="2602563">unsafe</span><span class="op" id="2602569">.</span><span class="ident" id="2602570">Pointer</span><span class="op" id="2602577">(</span><span class="op" id="2602578">&amp;</span><span class="ident" id="2602579">b</span><span class="op" id="2602580">[</span><span class="num" id="2602581">0</span><span class="op" id="2602582">]</span><span class="op" id="2602583">)</span><span class="op" id="2602584">)</span><span class="op" id="2602585">,</span>&nbsp;<span class="builtintype" id="2602587">uintptr</span><span class="op" id="2602594">(</span><span class="builtinfunc" id="2602595">len</span><span class="op" id="2602598">(</span><span class="ident" id="2602599">b</span><span class="op" id="2602600">)</span><span class="op" id="2602601">)</span><span class="op" id="2602602">)</span><span class="op" id="2602603">;</span>&nbsp;<span class="ident" id="2602605">errno</span>&nbsp;<span class="op" id="2602611">!=</span>&nbsp;<span class="ident" id="2602614">nil</span>&nbsp;<span class="op" id="2602618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602622">return</span>&nbsp;<span class="ident" id="2602629">errno</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2602636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2602639">delete</span><span class="op" id="2602645">(</span><span class="ident" id="2602646">m</span><span class="op" id="2602647">.</span><span class="ident" id="2602648">active</span><span class="op" id="2602654">,</span>&nbsp;<span class="ident" id="2602656">p</span><span class="op" id="2602657">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602660">return</span>&nbsp;<span class="ident" id="2602667">nil</span><br>
<span class="lineno">90</span><span class="op" id="2602671">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2602674">//&nbsp;An&nbsp;Errno&nbsp;is&nbsp;an&nbsp;unsigned&nbsp;number&nbsp;describing&nbsp;an&nbsp;error&nbsp;condition.</span><br>
<span class="lineno"></span><span class="comment" id="2602739">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;error&nbsp;interface.&nbsp;&nbsp;The&nbsp;zero&nbsp;Errno&nbsp;is&nbsp;by&nbsp;convention</span><br>
<span class="lineno"></span><span class="comment" id="2602810">//&nbsp;a&nbsp;non-error,&nbsp;so&nbsp;code&nbsp;to&nbsp;convert&nbsp;from&nbsp;Errno&nbsp;to&nbsp;error&nbsp;should&nbsp;use:</span><br>
<span class="lineno">95</span><span class="comment" id="2602877">//&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;nil</span><br>
<span class="lineno"></span><span class="comment" id="2602890">//&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;errno&nbsp;!=&nbsp;0&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="2602909">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;err&nbsp;=&nbsp;errno</span><br>
<span class="lineno"></span><span class="comment" id="2602925">//&nbsp;&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="keyword" id="2602930">type</span>&nbsp;<span class="ident" id="2602935">Errno</span>&nbsp;<span class="builtintype" id="2602941">uintptr</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span><span class="keyword" id="2602950">func</span>&nbsp;<span class="op" id="2602955">(</span><span class="ident" id="2602956">e</span>&nbsp;<span class="ident" id="2602958">Errno</span><span class="op" id="2602963">)</span>&nbsp;<span class="ident" id="2602965">Error</span><span class="op" id="2602970">(</span><span class="op" id="2602971">)</span>&nbsp;<span class="builtintype" id="2602973">string</span>&nbsp;<span class="op" id="2602980">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2602983">if</span>&nbsp;<span class="num" id="2602986">0</span>&nbsp;<span class="op" id="2602988">&lt;=</span>&nbsp;<span class="builtintype" id="2602991">int</span><span class="op" id="2602994">(</span><span class="ident" id="2602995">e</span><span class="op" id="2602996">)</span>&nbsp;<span class="op" id="2602998">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2603001">int</span><span class="op" id="2603004">(</span><span class="ident" id="2603005">e</span><span class="op" id="2603006">)</span>&nbsp;<span class="op" id="2603008">&lt;</span>&nbsp;<span class="builtinfunc" id="2603010">len</span><span class="op" id="2603013">(</span><span class="ident" id="2603014">errors</span><span class="op" id="2603020">)</span>&nbsp;<span class="op" id="2603022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603026">s</span>&nbsp;<span class="op" id="2603028">:=</span>&nbsp;<span class="ident" id="2603031">errors</span><span class="op" id="2603037">[</span><span class="ident" id="2603038">e</span><span class="op" id="2603039">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603043">if</span>&nbsp;<span class="ident" id="2603046">s</span>&nbsp;<span class="op" id="2603048">!=</span>&nbsp;<span class="string" id="2603051">&#34;&#34;</span>&nbsp;<span class="op" id="2603054">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603059">return</span>&nbsp;<span class="ident" id="2603066">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603076">return</span>&nbsp;<span class="string" id="2603083">&#34;errno&nbsp;&#34;</span>&nbsp;<span class="op" id="2603092">+</span>&nbsp;<span class="ident" id="2603094">itoa</span><span class="op" id="2603098">(</span><span class="builtintype" id="2603099">int</span><span class="op" id="2603102">(</span><span class="ident" id="2603103">e</span><span class="op" id="2603104">)</span><span class="op" id="2603105">)</span><br>
<span class="lineno"></span><span class="op" id="2603107">}</span><br>
<span class="lineno">110</span><br>
<span class="lineno"></span><span class="keyword" id="2603110">func</span>&nbsp;<span class="op" id="2603115">(</span><span class="ident" id="2603116">e</span>&nbsp;<span class="ident" id="2603118">Errno</span><span class="op" id="2603123">)</span>&nbsp;<span class="ident" id="2603125">Temporary</span><span class="op" id="2603134">(</span><span class="op" id="2603135">)</span>&nbsp;<span class="builtintype" id="2603137">bool</span>&nbsp;<span class="op" id="2603142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603145">return</span>&nbsp;<span class="ident" id="2603152">e</span>&nbsp;<span class="op" id="2603154">==</span>&nbsp;<span class="ident" id="2603157">EINTR</span>&nbsp;<span class="op" id="2603163">||</span>&nbsp;<span class="ident" id="2603166">e</span>&nbsp;<span class="op" id="2603168">==</span>&nbsp;<span class="ident" id="2603171">EMFILE</span>&nbsp;<span class="op" id="2603178">||</span>&nbsp;<span class="ident" id="2603181">e</span>&nbsp;<span class="op" id="2603183">==</span>&nbsp;<span class="ident" id="2603186">ECONNRESET</span>&nbsp;<span class="op" id="2603197">||</span>&nbsp;<span class="ident" id="2603200">e</span>&nbsp;<span class="op" id="2603202">==</span>&nbsp;<span class="ident" id="2603205">ECONNABORTED</span>&nbsp;<span class="op" id="2603218">||</span>&nbsp;<span class="ident" id="2603221">e</span><span class="op" id="2603222">.</span><span class="ident" id="2603223">Timeout</span><span class="op" id="2603230">(</span><span class="op" id="2603231">)</span><br>
<span class="lineno"></span><span class="op" id="2603233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="2603236">func</span>&nbsp;<span class="op" id="2603241">(</span><span class="ident" id="2603242">e</span>&nbsp;<span class="ident" id="2603244">Errno</span><span class="op" id="2603249">)</span>&nbsp;<span class="ident" id="2603251">Timeout</span><span class="op" id="2603258">(</span><span class="op" id="2603259">)</span>&nbsp;<span class="builtintype" id="2603261">bool</span>&nbsp;<span class="op" id="2603266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603269">return</span>&nbsp;<span class="ident" id="2603276">e</span>&nbsp;<span class="op" id="2603278">==</span>&nbsp;<span class="ident" id="2603281">EAGAIN</span>&nbsp;<span class="op" id="2603288">||</span>&nbsp;<span class="ident" id="2603291">e</span>&nbsp;<span class="op" id="2603293">==</span>&nbsp;<span class="ident" id="2603296">EWOULDBLOCK</span>&nbsp;<span class="op" id="2603308">||</span>&nbsp;<span class="ident" id="2603311">e</span>&nbsp;<span class="op" id="2603313">==</span>&nbsp;<span class="ident" id="2603316">ETIMEDOUT</span><br>
<span class="lineno"></span><span class="op" id="2603326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2603329">//&nbsp;A&nbsp;Signal&nbsp;is&nbsp;a&nbsp;number&nbsp;describing&nbsp;a&nbsp;process&nbsp;signal.</span><br>
<span class="lineno">120</span><span class="comment" id="2603382">//&nbsp;It&nbsp;implements&nbsp;the&nbsp;os.Signal&nbsp;interface.</span><br>
<span class="lineno"></span><span class="keyword" id="2603424">type</span>&nbsp;<span class="ident" id="2603429">Signal</span>&nbsp;<span class="builtintype" id="2603436">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2603441">func</span>&nbsp;<span class="op" id="2603446">(</span><span class="ident" id="2603447">s</span>&nbsp;<span class="ident" id="2603449">Signal</span><span class="op" id="2603455">)</span>&nbsp;<span class="ident" id="2603457">Signal</span><span class="op" id="2603463">(</span><span class="op" id="2603464">)</span>&nbsp;<span class="op" id="2603466">{</span><span class="op" id="2603467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="2603470">func</span>&nbsp;<span class="op" id="2603475">(</span><span class="ident" id="2603476">s</span>&nbsp;<span class="ident" id="2603478">Signal</span><span class="op" id="2603484">)</span>&nbsp;<span class="ident" id="2603486">String</span><span class="op" id="2603492">(</span><span class="op" id="2603493">)</span>&nbsp;<span class="builtintype" id="2603495">string</span>&nbsp;<span class="op" id="2603502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603505">if</span>&nbsp;<span class="num" id="2603508">0</span>&nbsp;<span class="op" id="2603510">&lt;=</span>&nbsp;<span class="ident" id="2603513">s</span>&nbsp;<span class="op" id="2603515">&amp;&amp;</span>&nbsp;<span class="builtintype" id="2603518">int</span><span class="op" id="2603521">(</span><span class="ident" id="2603522">s</span><span class="op" id="2603523">)</span>&nbsp;<span class="op" id="2603525">&lt;</span>&nbsp;<span class="builtinfunc" id="2603527">len</span><span class="op" id="2603530">(</span><span class="ident" id="2603531">signals</span><span class="op" id="2603538">)</span>&nbsp;<span class="op" id="2603540">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603544">str</span>&nbsp;<span class="op" id="2603548">:=</span>&nbsp;<span class="ident" id="2603551">signals</span><span class="op" id="2603558">[</span><span class="ident" id="2603559">s</span><span class="op" id="2603560">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603564">if</span>&nbsp;<span class="ident" id="2603567">str</span>&nbsp;<span class="op" id="2603571">!=</span>&nbsp;<span class="string" id="2603574">&#34;&#34;</span>&nbsp;<span class="op" id="2603577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603582">return</span>&nbsp;<span class="ident" id="2603589">str</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603601">return</span>&nbsp;<span class="string" id="2603608">&#34;signal&nbsp;&#34;</span>&nbsp;<span class="op" id="2603618">+</span>&nbsp;<span class="ident" id="2603620">itoa</span><span class="op" id="2603624">(</span><span class="builtintype" id="2603625">int</span><span class="op" id="2603628">(</span><span class="ident" id="2603629">s</span><span class="op" id="2603630">)</span><span class="op" id="2603631">)</span><br>
<span class="lineno"></span><span class="op" id="2603633">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="keyword" id="2603636">func</span>&nbsp;<span class="ident" id="2603641">Read</span><span class="op" id="2603645">(</span><span class="ident" id="2603646">fd</span>&nbsp;<span class="builtintype" id="2603649">int</span><span class="op" id="2603652">,</span>&nbsp;<span class="ident" id="2603654">p</span>&nbsp;<span class="op" id="2603656">[</span><span class="op" id="2603657">]</span><span class="builtintype" id="2603658">byte</span><span class="op" id="2603662">)</span>&nbsp;<span class="op" id="2603664">(</span><span class="ident" id="2603665">n</span>&nbsp;<span class="builtintype" id="2603667">int</span><span class="op" id="2603670">,</span>&nbsp;<span class="ident" id="2603672">err</span>&nbsp;<span class="builtintype" id="2603676">error</span><span class="op" id="2603681">)</span>&nbsp;<span class="op" id="2603683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603686">n</span><span class="op" id="2603687">,</span>&nbsp;<span class="ident" id="2603689">err</span>&nbsp;<span class="op" id="2603693">=</span>&nbsp;<span class="ident" id="2603695">read</span><span class="op" id="2603699">(</span><span class="ident" id="2603700">fd</span><span class="op" id="2603702">,</span>&nbsp;<span class="ident" id="2603704">p</span><span class="op" id="2603705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603708">if</span>&nbsp;<span class="ident" id="2603711">raceenabled</span>&nbsp;<span class="op" id="2603723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603727">if</span>&nbsp;<span class="ident" id="2603730">n</span>&nbsp;<span class="op" id="2603732">&gt;</span>&nbsp;<span class="num" id="2603734">0</span>&nbsp;<span class="op" id="2603736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603741">raceWriteRange</span><span class="op" id="2603755">(</span><span class="ident" id="2603756">unsafe</span><span class="op" id="2603762">.</span><span class="ident" id="2603763">Pointer</span><span class="op" id="2603770">(</span><span class="op" id="2603771">&amp;</span><span class="ident" id="2603772">p</span><span class="op" id="2603773">[</span><span class="num" id="2603774">0</span><span class="op" id="2603775">]</span><span class="op" id="2603776">)</span><span class="op" id="2603777">,</span>&nbsp;<span class="ident" id="2603779">n</span><span class="op" id="2603780">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603788">if</span>&nbsp;<span class="ident" id="2603791">err</span>&nbsp;<span class="op" id="2603795">==</span>&nbsp;<span class="ident" id="2603798">nil</span>&nbsp;<span class="op" id="2603802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603807">raceAcquire</span><span class="op" id="2603818">(</span><span class="ident" id="2603819">unsafe</span><span class="op" id="2603825">.</span><span class="ident" id="2603826">Pointer</span><span class="op" id="2603833">(</span><span class="op" id="2603834">&amp;</span><span class="ident" id="2603835">ioSync</span><span class="op" id="2603841">)</span><span class="op" id="2603842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603846">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603849">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603852">return</span><br>
<span class="lineno"></span><span class="op" id="2603859">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2603862">func</span>&nbsp;<span class="ident" id="2603867">Write</span><span class="op" id="2603872">(</span><span class="ident" id="2603873">fd</span>&nbsp;<span class="builtintype" id="2603876">int</span><span class="op" id="2603879">,</span>&nbsp;<span class="ident" id="2603881">p</span>&nbsp;<span class="op" id="2603883">[</span><span class="op" id="2603884">]</span><span class="builtintype" id="2603885">byte</span><span class="op" id="2603889">)</span>&nbsp;<span class="op" id="2603891">(</span><span class="ident" id="2603892">n</span>&nbsp;<span class="builtintype" id="2603894">int</span><span class="op" id="2603897">,</span>&nbsp;<span class="ident" id="2603899">err</span>&nbsp;<span class="builtintype" id="2603903">error</span><span class="op" id="2603908">)</span>&nbsp;<span class="op" id="2603910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2603913">if</span>&nbsp;<span class="ident" id="2603916">raceenabled</span>&nbsp;<span class="op" id="2603928">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603932">raceReleaseMerge</span><span class="op" id="2603948">(</span><span class="ident" id="2603949">unsafe</span><span class="op" id="2603955">.</span><span class="ident" id="2603956">Pointer</span><span class="op" id="2603963">(</span><span class="op" id="2603964">&amp;</span><span class="ident" id="2603965">ioSync</span><span class="op" id="2603971">)</span><span class="op" id="2603972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2603975">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2603978">n</span><span class="op" id="2603979">,</span>&nbsp;<span class="ident" id="2603981">err</span>&nbsp;<span class="op" id="2603985">=</span>&nbsp;<span class="ident" id="2603987">write</span><span class="op" id="2603992">(</span><span class="ident" id="2603993">fd</span><span class="op" id="2603995">,</span>&nbsp;<span class="ident" id="2603997">p</span><span class="op" id="2603998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604001">if</span>&nbsp;<span class="ident" id="2604004">raceenabled</span>&nbsp;<span class="op" id="2604016">&amp;&amp;</span>&nbsp;<span class="ident" id="2604019">n</span>&nbsp;<span class="op" id="2604021">&gt;</span>&nbsp;<span class="num" id="2604023">0</span>&nbsp;<span class="op" id="2604025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604029">raceReadRange</span><span class="op" id="2604042">(</span><span class="ident" id="2604043">unsafe</span><span class="op" id="2604049">.</span><span class="ident" id="2604050">Pointer</span><span class="op" id="2604057">(</span><span class="op" id="2604058">&amp;</span><span class="ident" id="2604059">p</span><span class="op" id="2604060">[</span><span class="num" id="2604061">0</span><span class="op" id="2604062">]</span><span class="op" id="2604063">)</span><span class="op" id="2604064">,</span>&nbsp;<span class="ident" id="2604066">n</span><span class="op" id="2604067">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2604070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604073">return</span><br>
<span class="lineno"></span><span class="op" id="2604080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2604083">//&nbsp;For&nbsp;testing:&nbsp;clients&nbsp;can&nbsp;set&nbsp;this&nbsp;flag&nbsp;to&nbsp;force</span><br>
<span class="lineno">160</span><span class="comment" id="2604134">//&nbsp;creation&nbsp;of&nbsp;IPv6&nbsp;sockets&nbsp;to&nbsp;return&nbsp;EAFNOSUPPORT.</span><br>
<span class="lineno"></span><span class="keyword" id="2604186">var</span>&nbsp;<span class="ident" id="2604190">SocketDisableIPv6</span>&nbsp;<span class="builtintype" id="2604208">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2604214">type</span>&nbsp;<span class="ident" id="2604219">Sockaddr</span>&nbsp;<span class="keyword" id="2604228">interface</span>&nbsp;<span class="op" id="2604238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604241">sockaddr</span><span class="op" id="2604249">(</span><span class="op" id="2604250">)</span>&nbsp;<span class="op" id="2604252">(</span><span class="ident" id="2604253">ptr</span>&nbsp;<span class="ident" id="2604257">unsafe</span><span class="op" id="2604263">.</span><span class="ident" id="2604264">Pointer</span><span class="op" id="2604271">,</span>&nbsp;<span class="builtinfunc" id="2604273">len</span>&nbsp;<span class="ident" id="2604277">_Socklen</span><span class="op" id="2604285">,</span>&nbsp;<span class="ident" id="2604287">err</span>&nbsp;<span class="builtintype" id="2604291">error</span><span class="op" id="2604296">)</span>&nbsp;<span class="comment" id="2604298">//&nbsp;lowercase;&nbsp;only&nbsp;we&nbsp;can&nbsp;define&nbsp;Sockaddrs</span><br>
<span class="lineno">165</span><span class="op" id="2604341">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2604344">type</span>&nbsp;<span class="ident" id="2604349">SockaddrInet4</span>&nbsp;<span class="keyword" id="2604363">struct</span>&nbsp;<span class="op" id="2604370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604373">Port</span>&nbsp;<span class="builtintype" id="2604378">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604383">Addr</span>&nbsp;<span class="op" id="2604388">[</span><span class="num" id="2604389">4</span><span class="op" id="2604390">]</span><span class="builtintype" id="2604391">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604397">raw</span>&nbsp;&nbsp;<span class="ident" id="2604402">RawSockaddrInet4</span><br>
<span class="lineno"></span><span class="op" id="2604419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2604422">type</span>&nbsp;<span class="ident" id="2604427">SockaddrInet6</span>&nbsp;<span class="keyword" id="2604441">struct</span>&nbsp;<span class="op" id="2604448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604451">Port</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="2604458">int</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604463">ZoneId</span>&nbsp;<span class="builtintype" id="2604470">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604478">Addr</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2604485">[</span><span class="num" id="2604486">16</span><span class="op" id="2604488">]</span><span class="builtintype" id="2604489">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604495">raw</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604502">RawSockaddrInet6</span><br>
<span class="lineno"></span><span class="op" id="2604519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="2604522">type</span>&nbsp;<span class="ident" id="2604527">SockaddrUnix</span>&nbsp;<span class="keyword" id="2604540">struct</span>&nbsp;<span class="op" id="2604547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604550">Name</span>&nbsp;<span class="builtintype" id="2604555">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604563">raw</span>&nbsp;&nbsp;<span class="ident" id="2604568">RawSockaddrUnix</span><br>
<span class="lineno"></span><span class="op" id="2604584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="keyword" id="2604587">func</span>&nbsp;<span class="ident" id="2604592">Bind</span><span class="op" id="2604596">(</span><span class="ident" id="2604597">fd</span>&nbsp;<span class="builtintype" id="2604600">int</span><span class="op" id="2604603">,</span>&nbsp;<span class="ident" id="2604605">sa</span>&nbsp;<span class="ident" id="2604608">Sockaddr</span><span class="op" id="2604616">)</span>&nbsp;<span class="op" id="2604618">(</span><span class="ident" id="2604619">err</span>&nbsp;<span class="builtintype" id="2604623">error</span><span class="op" id="2604628">)</span>&nbsp;<span class="op" id="2604630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604633">ptr</span><span class="op" id="2604636">,</span>&nbsp;<span class="ident" id="2604638">n</span><span class="op" id="2604639">,</span>&nbsp;<span class="ident" id="2604641">err</span>&nbsp;<span class="op" id="2604645">:=</span>&nbsp;<span class="ident" id="2604648">sa</span><span class="op" id="2604650">.</span><span class="ident" id="2604651">sockaddr</span><span class="op" id="2604659">(</span><span class="op" id="2604660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604663">if</span>&nbsp;<span class="ident" id="2604666">err</span>&nbsp;<span class="op" id="2604670">!=</span>&nbsp;<span class="ident" id="2604673">nil</span>&nbsp;<span class="op" id="2604677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604681">return</span>&nbsp;<span class="ident" id="2604688">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2604693">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604696">return</span>&nbsp;<span class="ident" id="2604703">bind</span><span class="op" id="2604707">(</span><span class="ident" id="2604708">fd</span><span class="op" id="2604710">,</span>&nbsp;<span class="ident" id="2604712">ptr</span><span class="op" id="2604715">,</span>&nbsp;<span class="ident" id="2604717">n</span><span class="op" id="2604718">)</span><br>
<span class="lineno"></span><span class="op" id="2604720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2604723">func</span>&nbsp;<span class="ident" id="2604728">Connect</span><span class="op" id="2604735">(</span><span class="ident" id="2604736">fd</span>&nbsp;<span class="builtintype" id="2604739">int</span><span class="op" id="2604742">,</span>&nbsp;<span class="ident" id="2604744">sa</span>&nbsp;<span class="ident" id="2604747">Sockaddr</span><span class="op" id="2604755">)</span>&nbsp;<span class="op" id="2604757">(</span><span class="ident" id="2604758">err</span>&nbsp;<span class="builtintype" id="2604762">error</span><span class="op" id="2604767">)</span>&nbsp;<span class="op" id="2604769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2604772">ptr</span><span class="op" id="2604775">,</span>&nbsp;<span class="ident" id="2604777">n</span><span class="op" id="2604778">,</span>&nbsp;<span class="ident" id="2604780">err</span>&nbsp;<span class="op" id="2604784">:=</span>&nbsp;<span class="ident" id="2604787">sa</span><span class="op" id="2604789">.</span><span class="ident" id="2604790">sockaddr</span><span class="op" id="2604798">(</span><span class="op" id="2604799">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604802">if</span>&nbsp;<span class="ident" id="2604805">err</span>&nbsp;<span class="op" id="2604809">!=</span>&nbsp;<span class="ident" id="2604812">nil</span>&nbsp;<span class="op" id="2604816">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604820">return</span>&nbsp;<span class="ident" id="2604827">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2604832">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604835">return</span>&nbsp;<span class="ident" id="2604842">connect</span><span class="op" id="2604849">(</span><span class="ident" id="2604850">fd</span><span class="op" id="2604852">,</span>&nbsp;<span class="ident" id="2604854">ptr</span><span class="op" id="2604857">,</span>&nbsp;<span class="ident" id="2604859">n</span><span class="op" id="2604860">)</span><br>
<span class="lineno"></span><span class="op" id="2604862">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="2604865">func</span>&nbsp;<span class="ident" id="2604870">Getpeername</span><span class="op" id="2604881">(</span><span class="ident" id="2604882">fd</span>&nbsp;<span class="builtintype" id="2604885">int</span><span class="op" id="2604888">)</span>&nbsp;<span class="op" id="2604890">(</span><span class="ident" id="2604891">sa</span>&nbsp;<span class="ident" id="2604894">Sockaddr</span><span class="op" id="2604902">,</span>&nbsp;<span class="ident" id="2604904">err</span>&nbsp;<span class="builtintype" id="2604908">error</span><span class="op" id="2604913">)</span>&nbsp;<span class="op" id="2604915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604918">var</span>&nbsp;<span class="ident" id="2604922">rsa</span>&nbsp;<span class="ident" id="2604926">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604942">var</span>&nbsp;<span class="builtinfunc" id="2604946">len</span>&nbsp;<span class="ident" id="2604950">_Socklen</span>&nbsp;<span class="op" id="2604959">=</span>&nbsp;<span class="ident" id="2604961">SizeofSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2604980">if</span>&nbsp;<span class="ident" id="2604983">err</span>&nbsp;<span class="op" id="2604987">=</span>&nbsp;<span class="ident" id="2604989">getpeername</span><span class="op" id="2605000">(</span><span class="ident" id="2605001">fd</span><span class="op" id="2605003">,</span>&nbsp;<span class="op" id="2605005">&amp;</span><span class="ident" id="2605006">rsa</span><span class="op" id="2605009">,</span>&nbsp;<span class="op" id="2605011">&amp;</span><span class="builtinfunc" id="2605012">len</span><span class="op" id="2605015">)</span><span class="op" id="2605016">;</span>&nbsp;<span class="ident" id="2605018">err</span>&nbsp;<span class="op" id="2605022">!=</span>&nbsp;<span class="ident" id="2605025">nil</span>&nbsp;<span class="op" id="2605029">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605033">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2605041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605044">return</span>&nbsp;<span class="ident" id="2605051">anyToSockaddr</span><span class="op" id="2605064">(</span><span class="op" id="2605065">&amp;</span><span class="ident" id="2605066">rsa</span><span class="op" id="2605069">)</span><br>
<span class="lineno"></span><span class="op" id="2605071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2605074">func</span>&nbsp;<span class="ident" id="2605079">GetsockoptInt</span><span class="op" id="2605092">(</span><span class="ident" id="2605093">fd</span><span class="op" id="2605095">,</span>&nbsp;<span class="ident" id="2605097">level</span><span class="op" id="2605102">,</span>&nbsp;<span class="ident" id="2605104">opt</span>&nbsp;<span class="builtintype" id="2605108">int</span><span class="op" id="2605111">)</span>&nbsp;<span class="op" id="2605113">(</span><span class="ident" id="2605114">value</span>&nbsp;<span class="builtintype" id="2605120">int</span><span class="op" id="2605123">,</span>&nbsp;<span class="ident" id="2605125">err</span>&nbsp;<span class="builtintype" id="2605129">error</span><span class="op" id="2605134">)</span>&nbsp;<span class="op" id="2605136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605139">var</span>&nbsp;<span class="ident" id="2605143">n</span>&nbsp;<span class="builtintype" id="2605145">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2605152">vallen</span>&nbsp;<span class="op" id="2605159">:=</span>&nbsp;<span class="ident" id="2605162">_Socklen</span><span class="op" id="2605170">(</span><span class="num" id="2605171">4</span><span class="op" id="2605172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2605175">err</span>&nbsp;<span class="op" id="2605179">=</span>&nbsp;<span class="ident" id="2605181">getsockopt</span><span class="op" id="2605191">(</span><span class="ident" id="2605192">fd</span><span class="op" id="2605194">,</span>&nbsp;<span class="ident" id="2605196">level</span><span class="op" id="2605201">,</span>&nbsp;<span class="ident" id="2605203">opt</span><span class="op" id="2605206">,</span>&nbsp;<span class="ident" id="2605208">unsafe</span><span class="op" id="2605214">.</span><span class="ident" id="2605215">Pointer</span><span class="op" id="2605222">(</span><span class="op" id="2605223">&amp;</span><span class="ident" id="2605224">n</span><span class="op" id="2605225">)</span><span class="op" id="2605226">,</span>&nbsp;<span class="op" id="2605228">&amp;</span><span class="ident" id="2605229">vallen</span><span class="op" id="2605235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605238">return</span>&nbsp;<span class="builtintype" id="2605245">int</span><span class="op" id="2605248">(</span><span class="ident" id="2605249">n</span><span class="op" id="2605250">)</span><span class="op" id="2605251">,</span>&nbsp;<span class="ident" id="2605253">err</span><br>
<span class="lineno">215</span><span class="op" id="2605257">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2605260">func</span>&nbsp;<span class="ident" id="2605265">Recvfrom</span><span class="op" id="2605273">(</span><span class="ident" id="2605274">fd</span>&nbsp;<span class="builtintype" id="2605277">int</span><span class="op" id="2605280">,</span>&nbsp;<span class="ident" id="2605282">p</span>&nbsp;<span class="op" id="2605284">[</span><span class="op" id="2605285">]</span><span class="builtintype" id="2605286">byte</span><span class="op" id="2605290">,</span>&nbsp;<span class="ident" id="2605292">flags</span>&nbsp;<span class="builtintype" id="2605298">int</span><span class="op" id="2605301">)</span>&nbsp;<span class="op" id="2605303">(</span><span class="ident" id="2605304">n</span>&nbsp;<span class="builtintype" id="2605306">int</span><span class="op" id="2605309">,</span>&nbsp;<span class="ident" id="2605311">from</span>&nbsp;<span class="ident" id="2605316">Sockaddr</span><span class="op" id="2605324">,</span>&nbsp;<span class="ident" id="2605326">err</span>&nbsp;<span class="builtintype" id="2605330">error</span><span class="op" id="2605335">)</span>&nbsp;<span class="op" id="2605337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605340">var</span>&nbsp;<span class="ident" id="2605344">rsa</span>&nbsp;<span class="ident" id="2605348">RawSockaddrAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605364">var</span>&nbsp;<span class="builtinfunc" id="2605368">len</span>&nbsp;<span class="ident" id="2605372">_Socklen</span>&nbsp;<span class="op" id="2605381">=</span>&nbsp;<span class="ident" id="2605383">SizeofSockaddrAny</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605402">if</span>&nbsp;<span class="ident" id="2605405">n</span><span class="op" id="2605406">,</span>&nbsp;<span class="ident" id="2605408">err</span>&nbsp;<span class="op" id="2605412">=</span>&nbsp;<span class="ident" id="2605414">recvfrom</span><span class="op" id="2605422">(</span><span class="ident" id="2605423">fd</span><span class="op" id="2605425">,</span>&nbsp;<span class="ident" id="2605427">p</span><span class="op" id="2605428">,</span>&nbsp;<span class="ident" id="2605430">flags</span><span class="op" id="2605435">,</span>&nbsp;<span class="op" id="2605437">&amp;</span><span class="ident" id="2605438">rsa</span><span class="op" id="2605441">,</span>&nbsp;<span class="op" id="2605443">&amp;</span><span class="builtinfunc" id="2605444">len</span><span class="op" id="2605447">)</span><span class="op" id="2605448">;</span>&nbsp;<span class="ident" id="2605450">err</span>&nbsp;<span class="op" id="2605454">!=</span>&nbsp;<span class="ident" id="2605457">nil</span>&nbsp;<span class="op" id="2605461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605465">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2605473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605476">if</span>&nbsp;<span class="ident" id="2605479">rsa</span><span class="op" id="2605482">.</span><span class="ident" id="2605483">Addr</span><span class="op" id="2605487">.</span><span class="ident" id="2605488">Family</span>&nbsp;<span class="op" id="2605495">!=</span>&nbsp;<span class="ident" id="2605498">AF_UNSPEC</span>&nbsp;<span class="op" id="2605508">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2605512">from</span><span class="op" id="2605516">,</span>&nbsp;<span class="ident" id="2605518">err</span>&nbsp;<span class="op" id="2605522">=</span>&nbsp;<span class="ident" id="2605524">anyToSockaddr</span><span class="op" id="2605537">(</span><span class="op" id="2605538">&amp;</span><span class="ident" id="2605539">rsa</span><span class="op" id="2605542">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2605545">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605548">return</span><br>
<span class="lineno"></span><span class="op" id="2605555">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2605558">func</span>&nbsp;<span class="ident" id="2605563">Sendto</span><span class="op" id="2605569">(</span><span class="ident" id="2605570">fd</span>&nbsp;<span class="builtintype" id="2605573">int</span><span class="op" id="2605576">,</span>&nbsp;<span class="ident" id="2605578">p</span>&nbsp;<span class="op" id="2605580">[</span><span class="op" id="2605581">]</span><span class="builtintype" id="2605582">byte</span><span class="op" id="2605586">,</span>&nbsp;<span class="ident" id="2605588">flags</span>&nbsp;<span class="builtintype" id="2605594">int</span><span class="op" id="2605597">,</span>&nbsp;<span class="ident" id="2605599">to</span>&nbsp;<span class="ident" id="2605602">Sockaddr</span><span class="op" id="2605610">)</span>&nbsp;<span class="op" id="2605612">(</span><span class="ident" id="2605613">err</span>&nbsp;<span class="builtintype" id="2605617">error</span><span class="op" id="2605622">)</span>&nbsp;<span class="op" id="2605624">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2605627">ptr</span><span class="op" id="2605630">,</span>&nbsp;<span class="ident" id="2605632">n</span><span class="op" id="2605633">,</span>&nbsp;<span class="ident" id="2605635">err</span>&nbsp;<span class="op" id="2605639">:=</span>&nbsp;<span class="ident" id="2605642">to</span><span class="op" id="2605644">.</span><span class="ident" id="2605645">sockaddr</span><span class="op" id="2605653">(</span><span class="op" id="2605654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605657">if</span>&nbsp;<span class="ident" id="2605660">err</span>&nbsp;<span class="op" id="2605664">!=</span>&nbsp;<span class="ident" id="2605667">nil</span>&nbsp;<span class="op" id="2605671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605675">return</span>&nbsp;<span class="ident" id="2605682">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2605687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605690">return</span>&nbsp;<span class="ident" id="2605697">sendto</span><span class="op" id="2605703">(</span><span class="ident" id="2605704">fd</span><span class="op" id="2605706">,</span>&nbsp;<span class="ident" id="2605708">p</span><span class="op" id="2605709">,</span>&nbsp;<span class="ident" id="2605711">flags</span><span class="op" id="2605716">,</span>&nbsp;<span class="ident" id="2605718">ptr</span><span class="op" id="2605721">,</span>&nbsp;<span class="ident" id="2605723">n</span><span class="op" id="2605724">)</span><br>
<span class="lineno">235</span><span class="op" id="2605726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2605729">func</span>&nbsp;<span class="ident" id="2605734">SetsockoptByte</span><span class="op" id="2605748">(</span><span class="ident" id="2605749">fd</span><span class="op" id="2605751">,</span>&nbsp;<span class="ident" id="2605753">level</span><span class="op" id="2605758">,</span>&nbsp;<span class="ident" id="2605760">opt</span>&nbsp;<span class="builtintype" id="2605764">int</span><span class="op" id="2605767">,</span>&nbsp;<span class="ident" id="2605769">value</span>&nbsp;<span class="builtintype" id="2605775">byte</span><span class="op" id="2605779">)</span>&nbsp;<span class="op" id="2605781">(</span><span class="ident" id="2605782">err</span>&nbsp;<span class="builtintype" id="2605786">error</span><span class="op" id="2605791">)</span>&nbsp;<span class="op" id="2605793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605796">return</span>&nbsp;<span class="ident" id="2605803">setsockopt</span><span class="op" id="2605813">(</span><span class="ident" id="2605814">fd</span><span class="op" id="2605816">,</span>&nbsp;<span class="ident" id="2605818">level</span><span class="op" id="2605823">,</span>&nbsp;<span class="ident" id="2605825">opt</span><span class="op" id="2605828">,</span>&nbsp;<span class="ident" id="2605830">unsafe</span><span class="op" id="2605836">.</span><span class="ident" id="2605837">Pointer</span><span class="op" id="2605844">(</span><span class="op" id="2605845">&amp;</span><span class="ident" id="2605846">value</span><span class="op" id="2605851">)</span><span class="op" id="2605852">,</span>&nbsp;<span class="num" id="2605854">1</span><span class="op" id="2605855">)</span><br>
<span class="lineno"></span><span class="op" id="2605857">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="2605860">func</span>&nbsp;<span class="ident" id="2605865">SetsockoptInt</span><span class="op" id="2605878">(</span><span class="ident" id="2605879">fd</span><span class="op" id="2605881">,</span>&nbsp;<span class="ident" id="2605883">level</span><span class="op" id="2605888">,</span>&nbsp;<span class="ident" id="2605890">opt</span>&nbsp;<span class="builtintype" id="2605894">int</span><span class="op" id="2605897">,</span>&nbsp;<span class="ident" id="2605899">value</span>&nbsp;<span class="builtintype" id="2605905">int</span><span class="op" id="2605908">)</span>&nbsp;<span class="op" id="2605910">(</span><span class="ident" id="2605911">err</span>&nbsp;<span class="builtintype" id="2605915">error</span><span class="op" id="2605920">)</span>&nbsp;<span class="op" id="2605922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605925">var</span>&nbsp;<span class="ident" id="2605929">n</span>&nbsp;<span class="op" id="2605931">=</span>&nbsp;<span class="builtintype" id="2605933">int32</span><span class="op" id="2605938">(</span><span class="ident" id="2605939">value</span><span class="op" id="2605944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2605947">return</span>&nbsp;<span class="ident" id="2605954">setsockopt</span><span class="op" id="2605964">(</span><span class="ident" id="2605965">fd</span><span class="op" id="2605967">,</span>&nbsp;<span class="ident" id="2605969">level</span><span class="op" id="2605974">,</span>&nbsp;<span class="ident" id="2605976">opt</span><span class="op" id="2605979">,</span>&nbsp;<span class="ident" id="2605981">unsafe</span><span class="op" id="2605987">.</span><span class="ident" id="2605988">Pointer</span><span class="op" id="2605995">(</span><span class="op" id="2605996">&amp;</span><span class="ident" id="2605997">n</span><span class="op" id="2605998">)</span><span class="op" id="2605999">,</span>&nbsp;<span class="num" id="2606001">4</span><span class="op" id="2606002">)</span><br>
<span class="lineno"></span><span class="op" id="2606004">}</span><br>
<span class="lineno">245</span><br>
<span class="lineno"></span><span class="keyword" id="2606007">func</span>&nbsp;<span class="ident" id="2606012">SetsockoptInet4Addr</span><span class="op" id="2606031">(</span><span class="ident" id="2606032">fd</span><span class="op" id="2606034">,</span>&nbsp;<span class="ident" id="2606036">level</span><span class="op" id="2606041">,</span>&nbsp;<span class="ident" id="2606043">opt</span>&nbsp;<span class="builtintype" id="2606047">int</span><span class="op" id="2606050">,</span>&nbsp;<span class="ident" id="2606052">value</span>&nbsp;<span class="op" id="2606058">[</span><span class="num" id="2606059">4</span><span class="op" id="2606060">]</span><span class="builtintype" id="2606061">byte</span><span class="op" id="2606065">)</span>&nbsp;<span class="op" id="2606067">(</span><span class="ident" id="2606068">err</span>&nbsp;<span class="builtintype" id="2606072">error</span><span class="op" id="2606077">)</span>&nbsp;<span class="op" id="2606079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606082">return</span>&nbsp;<span class="ident" id="2606089">setsockopt</span><span class="op" id="2606099">(</span><span class="ident" id="2606100">fd</span><span class="op" id="2606102">,</span>&nbsp;<span class="ident" id="2606104">level</span><span class="op" id="2606109">,</span>&nbsp;<span class="ident" id="2606111">opt</span><span class="op" id="2606114">,</span>&nbsp;<span class="ident" id="2606116">unsafe</span><span class="op" id="2606122">.</span><span class="ident" id="2606123">Pointer</span><span class="op" id="2606130">(</span><span class="op" id="2606131">&amp;</span><span class="ident" id="2606132">value</span><span class="op" id="2606137">[</span><span class="num" id="2606138">0</span><span class="op" id="2606139">]</span><span class="op" id="2606140">)</span><span class="op" id="2606141">,</span>&nbsp;<span class="num" id="2606143">4</span><span class="op" id="2606144">)</span><br>
<span class="lineno"></span><span class="op" id="2606146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span><span class="keyword" id="2606149">func</span>&nbsp;<span class="ident" id="2606154">SetsockoptIPMreq</span><span class="op" id="2606170">(</span><span class="ident" id="2606171">fd</span><span class="op" id="2606173">,</span>&nbsp;<span class="ident" id="2606175">level</span><span class="op" id="2606180">,</span>&nbsp;<span class="ident" id="2606182">opt</span>&nbsp;<span class="builtintype" id="2606186">int</span><span class="op" id="2606189">,</span>&nbsp;<span class="ident" id="2606191">mreq</span>&nbsp;<span class="op" id="2606196">*</span><span class="ident" id="2606197">IPMreq</span><span class="op" id="2606203">)</span>&nbsp;<span class="op" id="2606205">(</span><span class="ident" id="2606206">err</span>&nbsp;<span class="builtintype" id="2606210">error</span><span class="op" id="2606215">)</span>&nbsp;<span class="op" id="2606217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606220">return</span>&nbsp;<span class="ident" id="2606227">setsockopt</span><span class="op" id="2606237">(</span><span class="ident" id="2606238">fd</span><span class="op" id="2606240">,</span>&nbsp;<span class="ident" id="2606242">level</span><span class="op" id="2606247">,</span>&nbsp;<span class="ident" id="2606249">opt</span><span class="op" id="2606252">,</span>&nbsp;<span class="ident" id="2606254">unsafe</span><span class="op" id="2606260">.</span><span class="ident" id="2606261">Pointer</span><span class="op" id="2606268">(</span><span class="ident" id="2606269">mreq</span><span class="op" id="2606273">)</span><span class="op" id="2606274">,</span>&nbsp;<span class="ident" id="2606276">SizeofIPMreq</span><span class="op" id="2606288">)</span><br>
<span class="lineno"></span><span class="op" id="2606290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2606293">func</span>&nbsp;<span class="ident" id="2606298">SetsockoptIPv6Mreq</span><span class="op" id="2606316">(</span><span class="ident" id="2606317">fd</span><span class="op" id="2606319">,</span>&nbsp;<span class="ident" id="2606321">level</span><span class="op" id="2606326">,</span>&nbsp;<span class="ident" id="2606328">opt</span>&nbsp;<span class="builtintype" id="2606332">int</span><span class="op" id="2606335">,</span>&nbsp;<span class="ident" id="2606337">mreq</span>&nbsp;<span class="op" id="2606342">*</span><span class="ident" id="2606343">IPv6Mreq</span><span class="op" id="2606351">)</span>&nbsp;<span class="op" id="2606353">(</span><span class="ident" id="2606354">err</span>&nbsp;<span class="builtintype" id="2606358">error</span><span class="op" id="2606363">)</span>&nbsp;<span class="op" id="2606365">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606368">return</span>&nbsp;<span class="ident" id="2606375">setsockopt</span><span class="op" id="2606385">(</span><span class="ident" id="2606386">fd</span><span class="op" id="2606388">,</span>&nbsp;<span class="ident" id="2606390">level</span><span class="op" id="2606395">,</span>&nbsp;<span class="ident" id="2606397">opt</span><span class="op" id="2606400">,</span>&nbsp;<span class="ident" id="2606402">unsafe</span><span class="op" id="2606408">.</span><span class="ident" id="2606409">Pointer</span><span class="op" id="2606416">(</span><span class="ident" id="2606417">mreq</span><span class="op" id="2606421">)</span><span class="op" id="2606422">,</span>&nbsp;<span class="ident" id="2606424">SizeofIPv6Mreq</span><span class="op" id="2606438">)</span><br>
<span class="lineno"></span><span class="op" id="2606440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2606443">func</span>&nbsp;<span class="ident" id="2606448">SetsockoptICMPv6Filter</span><span class="op" id="2606470">(</span><span class="ident" id="2606471">fd</span><span class="op" id="2606473">,</span>&nbsp;<span class="ident" id="2606475">level</span><span class="op" id="2606480">,</span>&nbsp;<span class="ident" id="2606482">opt</span>&nbsp;<span class="builtintype" id="2606486">int</span><span class="op" id="2606489">,</span>&nbsp;<span class="ident" id="2606491">filter</span>&nbsp;<span class="op" id="2606498">*</span><span class="ident" id="2606499">ICMPv6Filter</span><span class="op" id="2606511">)</span>&nbsp;<span class="builtintype" id="2606513">error</span>&nbsp;<span class="op" id="2606519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606522">return</span>&nbsp;<span class="ident" id="2606529">setsockopt</span><span class="op" id="2606539">(</span><span class="ident" id="2606540">fd</span><span class="op" id="2606542">,</span>&nbsp;<span class="ident" id="2606544">level</span><span class="op" id="2606549">,</span>&nbsp;<span class="ident" id="2606551">opt</span><span class="op" id="2606554">,</span>&nbsp;<span class="ident" id="2606556">unsafe</span><span class="op" id="2606562">.</span><span class="ident" id="2606563">Pointer</span><span class="op" id="2606570">(</span><span class="ident" id="2606571">filter</span><span class="op" id="2606577">)</span><span class="op" id="2606578">,</span>&nbsp;<span class="ident" id="2606580">SizeofICMPv6Filter</span><span class="op" id="2606598">)</span><br>
<span class="lineno">260</span><span class="op" id="2606600">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2606603">func</span>&nbsp;<span class="ident" id="2606608">SetsockoptLinger</span><span class="op" id="2606624">(</span><span class="ident" id="2606625">fd</span><span class="op" id="2606627">,</span>&nbsp;<span class="ident" id="2606629">level</span><span class="op" id="2606634">,</span>&nbsp;<span class="ident" id="2606636">opt</span>&nbsp;<span class="builtintype" id="2606640">int</span><span class="op" id="2606643">,</span>&nbsp;<span class="ident" id="2606645">l</span>&nbsp;<span class="op" id="2606647">*</span><span class="ident" id="2606648">Linger</span><span class="op" id="2606654">)</span>&nbsp;<span class="op" id="2606656">(</span><span class="ident" id="2606657">err</span>&nbsp;<span class="builtintype" id="2606661">error</span><span class="op" id="2606666">)</span>&nbsp;<span class="op" id="2606668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606671">return</span>&nbsp;<span class="ident" id="2606678">setsockopt</span><span class="op" id="2606688">(</span><span class="ident" id="2606689">fd</span><span class="op" id="2606691">,</span>&nbsp;<span class="ident" id="2606693">level</span><span class="op" id="2606698">,</span>&nbsp;<span class="ident" id="2606700">opt</span><span class="op" id="2606703">,</span>&nbsp;<span class="ident" id="2606705">unsafe</span><span class="op" id="2606711">.</span><span class="ident" id="2606712">Pointer</span><span class="op" id="2606719">(</span><span class="ident" id="2606720">l</span><span class="op" id="2606721">)</span><span class="op" id="2606722">,</span>&nbsp;<span class="ident" id="2606724">SizeofLinger</span><span class="op" id="2606736">)</span><br>
<span class="lineno"></span><span class="op" id="2606738">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="2606741">func</span>&nbsp;<span class="ident" id="2606746">SetsockoptString</span><span class="op" id="2606762">(</span><span class="ident" id="2606763">fd</span><span class="op" id="2606765">,</span>&nbsp;<span class="ident" id="2606767">level</span><span class="op" id="2606772">,</span>&nbsp;<span class="ident" id="2606774">opt</span>&nbsp;<span class="builtintype" id="2606778">int</span><span class="op" id="2606781">,</span>&nbsp;<span class="ident" id="2606783">s</span>&nbsp;<span class="builtintype" id="2606785">string</span><span class="op" id="2606791">)</span>&nbsp;<span class="op" id="2606793">(</span><span class="ident" id="2606794">err</span>&nbsp;<span class="builtintype" id="2606798">error</span><span class="op" id="2606803">)</span>&nbsp;<span class="op" id="2606805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606808">return</span>&nbsp;<span class="ident" id="2606815">setsockopt</span><span class="op" id="2606825">(</span><span class="ident" id="2606826">fd</span><span class="op" id="2606828">,</span>&nbsp;<span class="ident" id="2606830">level</span><span class="op" id="2606835">,</span>&nbsp;<span class="ident" id="2606837">opt</span><span class="op" id="2606840">,</span>&nbsp;<span class="ident" id="2606842">unsafe</span><span class="op" id="2606848">.</span><span class="ident" id="2606849">Pointer</span><span class="op" id="2606856">(</span><span class="op" id="2606857">&amp;</span><span class="op" id="2606858">[</span><span class="op" id="2606859">]</span><span class="builtintype" id="2606860">byte</span><span class="op" id="2606864">(</span><span class="ident" id="2606865">s</span><span class="op" id="2606866">)</span><span class="op" id="2606867">[</span><span class="num" id="2606868">0</span><span class="op" id="2606869">]</span><span class="op" id="2606870">)</span><span class="op" id="2606871">,</span>&nbsp;<span class="builtintype" id="2606873">uintptr</span><span class="op" id="2606880">(</span><span class="builtinfunc" id="2606881">len</span><span class="op" id="2606884">(</span><span class="ident" id="2606885">s</span><span class="op" id="2606886">)</span><span class="op" id="2606887">)</span><span class="op" id="2606888">)</span><br>
<span class="lineno"></span><span class="op" id="2606890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">270</span><span class="keyword" id="2606893">func</span>&nbsp;<span class="ident" id="2606898">SetsockoptTimeval</span><span class="op" id="2606915">(</span><span class="ident" id="2606916">fd</span><span class="op" id="2606918">,</span>&nbsp;<span class="ident" id="2606920">level</span><span class="op" id="2606925">,</span>&nbsp;<span class="ident" id="2606927">opt</span>&nbsp;<span class="builtintype" id="2606931">int</span><span class="op" id="2606934">,</span>&nbsp;<span class="ident" id="2606936">tv</span>&nbsp;<span class="op" id="2606939">*</span><span class="ident" id="2606940">Timeval</span><span class="op" id="2606947">)</span>&nbsp;<span class="op" id="2606949">(</span><span class="ident" id="2606950">err</span>&nbsp;<span class="builtintype" id="2606954">error</span><span class="op" id="2606959">)</span>&nbsp;<span class="op" id="2606961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2606964">return</span>&nbsp;<span class="ident" id="2606971">setsockopt</span><span class="op" id="2606981">(</span><span class="ident" id="2606982">fd</span><span class="op" id="2606984">,</span>&nbsp;<span class="ident" id="2606986">level</span><span class="op" id="2606991">,</span>&nbsp;<span class="ident" id="2606993">opt</span><span class="op" id="2606996">,</span>&nbsp;<span class="ident" id="2606998">unsafe</span><span class="op" id="2607004">.</span><span class="ident" id="2607005">Pointer</span><span class="op" id="2607012">(</span><span class="ident" id="2607013">tv</span><span class="op" id="2607015">)</span><span class="op" id="2607016">,</span>&nbsp;<span class="ident" id="2607018">unsafe</span><span class="op" id="2607024">.</span><span class="ident" id="2607025">Sizeof</span><span class="op" id="2607031">(</span><span class="op" id="2607032">*</span><span class="ident" id="2607033">tv</span><span class="op" id="2607035">)</span><span class="op" id="2607036">)</span><br>
<span class="lineno"></span><span class="op" id="2607038">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2607041">func</span>&nbsp;<span class="ident" id="2607046">Socket</span><span class="op" id="2607052">(</span><span class="ident" id="2607053">domain</span><span class="op" id="2607059">,</span>&nbsp;<span class="ident" id="2607061">typ</span><span class="op" id="2607064">,</span>&nbsp;<span class="ident" id="2607066">proto</span>&nbsp;<span class="builtintype" id="2607072">int</span><span class="op" id="2607075">)</span>&nbsp;<span class="op" id="2607077">(</span><span class="ident" id="2607078">fd</span>&nbsp;<span class="builtintype" id="2607081">int</span><span class="op" id="2607084">,</span>&nbsp;<span class="ident" id="2607086">err</span>&nbsp;<span class="builtintype" id="2607090">error</span><span class="op" id="2607095">)</span>&nbsp;<span class="op" id="2607097">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607100">if</span>&nbsp;<span class="ident" id="2607103">domain</span>&nbsp;<span class="op" id="2607110">==</span>&nbsp;<span class="ident" id="2607113">AF_INET6</span>&nbsp;<span class="op" id="2607122">&amp;&amp;</span>&nbsp;<span class="ident" id="2607125">SocketDisableIPv6</span>&nbsp;<span class="op" id="2607143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607147">return</span>&nbsp;<span class="op" id="2607154">-</span><span class="num" id="2607155">1</span><span class="op" id="2607156">,</span>&nbsp;<span class="ident" id="2607158">EAFNOSUPPORT</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2607172">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607175">fd</span><span class="op" id="2607177">,</span>&nbsp;<span class="ident" id="2607179">err</span>&nbsp;<span class="op" id="2607183">=</span>&nbsp;<span class="ident" id="2607185">socket</span><span class="op" id="2607191">(</span><span class="ident" id="2607192">domain</span><span class="op" id="2607198">,</span>&nbsp;<span class="ident" id="2607200">typ</span><span class="op" id="2607203">,</span>&nbsp;<span class="ident" id="2607205">proto</span><span class="op" id="2607210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607213">return</span><br>
<span class="lineno">280</span><span class="op" id="2607220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2607223">func</span>&nbsp;<span class="ident" id="2607228">Socketpair</span><span class="op" id="2607238">(</span><span class="ident" id="2607239">domain</span><span class="op" id="2607245">,</span>&nbsp;<span class="ident" id="2607247">typ</span><span class="op" id="2607250">,</span>&nbsp;<span class="ident" id="2607252">proto</span>&nbsp;<span class="builtintype" id="2607258">int</span><span class="op" id="2607261">)</span>&nbsp;<span class="op" id="2607263">(</span><span class="ident" id="2607264">fd</span>&nbsp;<span class="op" id="2607267">[</span><span class="num" id="2607268">2</span><span class="op" id="2607269">]</span><span class="builtintype" id="2607270">int</span><span class="op" id="2607273">,</span>&nbsp;<span class="ident" id="2607275">err</span>&nbsp;<span class="builtintype" id="2607279">error</span><span class="op" id="2607284">)</span>&nbsp;<span class="op" id="2607286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607289">var</span>&nbsp;<span class="ident" id="2607293">fdx</span>&nbsp;<span class="op" id="2607297">[</span><span class="num" id="2607298">2</span><span class="op" id="2607299">]</span><span class="builtintype" id="2607300">int32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607307">err</span>&nbsp;<span class="op" id="2607311">=</span>&nbsp;<span class="ident" id="2607313">socketpair</span><span class="op" id="2607323">(</span><span class="ident" id="2607324">domain</span><span class="op" id="2607330">,</span>&nbsp;<span class="ident" id="2607332">typ</span><span class="op" id="2607335">,</span>&nbsp;<span class="ident" id="2607337">proto</span><span class="op" id="2607342">,</span>&nbsp;<span class="op" id="2607344">&amp;</span><span class="ident" id="2607345">fdx</span><span class="op" id="2607348">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607351">if</span>&nbsp;<span class="ident" id="2607354">err</span>&nbsp;<span class="op" id="2607358">==</span>&nbsp;<span class="ident" id="2607361">nil</span>&nbsp;<span class="op" id="2607365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607369">fd</span><span class="op" id="2607371">[</span><span class="num" id="2607372">0</span><span class="op" id="2607373">]</span>&nbsp;<span class="op" id="2607375">=</span>&nbsp;<span class="builtintype" id="2607377">int</span><span class="op" id="2607380">(</span><span class="ident" id="2607381">fdx</span><span class="op" id="2607384">[</span><span class="num" id="2607385">0</span><span class="op" id="2607386">]</span><span class="op" id="2607387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607391">fd</span><span class="op" id="2607393">[</span><span class="num" id="2607394">1</span><span class="op" id="2607395">]</span>&nbsp;<span class="op" id="2607397">=</span>&nbsp;<span class="builtintype" id="2607399">int</span><span class="op" id="2607402">(</span><span class="ident" id="2607403">fdx</span><span class="op" id="2607406">[</span><span class="num" id="2607407">1</span><span class="op" id="2607408">]</span><span class="op" id="2607409">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2607412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607415">return</span><br>
<span class="lineno">290</span><span class="op" id="2607422">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2607425">func</span>&nbsp;<span class="ident" id="2607430">Sendfile</span><span class="op" id="2607438">(</span><span class="ident" id="2607439">outfd</span>&nbsp;<span class="builtintype" id="2607445">int</span><span class="op" id="2607448">,</span>&nbsp;<span class="ident" id="2607450">infd</span>&nbsp;<span class="builtintype" id="2607455">int</span><span class="op" id="2607458">,</span>&nbsp;<span class="ident" id="2607460">offset</span>&nbsp;<span class="op" id="2607467">*</span><span class="ident" id="2607468">int64</span><span class="op" id="2607473">,</span>&nbsp;<span class="ident" id="2607475">count</span>&nbsp;<span class="builtintype" id="2607481">int</span><span class="op" id="2607484">)</span>&nbsp;<span class="op" id="2607486">(</span><span class="ident" id="2607487">written</span>&nbsp;<span class="builtintype" id="2607495">int</span><span class="op" id="2607498">,</span>&nbsp;<span class="ident" id="2607500">err</span>&nbsp;<span class="builtintype" id="2607504">error</span><span class="op" id="2607509">)</span>&nbsp;<span class="op" id="2607511">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607514">if</span>&nbsp;<span class="ident" id="2607517">raceenabled</span>&nbsp;<span class="op" id="2607529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2607533">raceReleaseMerge</span><span class="op" id="2607549">(</span><span class="ident" id="2607550">unsafe</span><span class="op" id="2607556">.</span><span class="ident" id="2607557">Pointer</span><span class="op" id="2607564">(</span><span class="op" id="2607565">&amp;</span><span class="ident" id="2607566">ioSync</span><span class="op" id="2607572">)</span><span class="op" id="2607573">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2607576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2607579">return</span>&nbsp;<span class="ident" id="2607586">sendfile</span><span class="op" id="2607594">(</span><span class="ident" id="2607595">outfd</span><span class="op" id="2607600">,</span>&nbsp;<span class="ident" id="2607602">infd</span><span class="op" id="2607606">,</span>&nbsp;<span class="ident" id="2607608">offset</span><span class="op" id="2607614">,</span>&nbsp;<span class="ident" id="2607616">count</span><span class="op" id="2607621">)</span><br>
<span class="lineno"></span><span class="op" id="2607623">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2607626">var</span>&nbsp;<span class="ident" id="2607630">ioSync</span>&nbsp;<span class="ident" id="2607637">int64</span>
</div>
</body>
</html>
