<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html" class="current">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8256204">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8256259">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8256313">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8256364">package</span>&nbsp;<span class="ident" id="8256372">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8256377">import</span>&nbsp;<span class="op" id="8256384">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256387">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256396">&#34;crypto/ecdsa&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256412">&#34;crypto/rsa&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256426">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256441">&#34;encoding/pem&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256457">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256464">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256470">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256477">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256483">&#34;os/exec&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256494">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256511">&#34;strconv&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256522">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8256533">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8256540">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8256543">//&nbsp;Note:&nbsp;see&nbsp;comment&nbsp;in&nbsp;handshake_test.go&nbsp;for&nbsp;details&nbsp;of&nbsp;how&nbsp;the&nbsp;reference</span><br>
<span class="lineno">25</span><span class="comment" id="8256618">//&nbsp;tests&nbsp;work.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8256634">//&nbsp;blockingSource&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;that&nbsp;blocks&nbsp;a&nbsp;Read&nbsp;call&nbsp;until&nbsp;it&#39;s&nbsp;closed.</span><br>
<span class="lineno"></span><span class="keyword" id="8256711">type</span>&nbsp;<span class="ident" id="8256716">blockingSource</span>&nbsp;<span class="keyword" id="8256731">chan</span>&nbsp;<span class="builtintype" id="8256736">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8256742">func</span>&nbsp;<span class="op" id="8256747">(</span><span class="ident" id="8256748">b</span>&nbsp;<span class="ident" id="8256750">blockingSource</span><span class="op" id="8256764">)</span>&nbsp;<span class="ident" id="8256766">Read</span><span class="op" id="8256770">(</span><span class="op" id="8256771">[</span><span class="op" id="8256772">]</span><span class="builtintype" id="8256773">byte</span><span class="op" id="8256777">)</span>&nbsp;<span class="op" id="8256779">(</span><span class="ident" id="8256780">n</span>&nbsp;<span class="builtintype" id="8256782">int</span><span class="op" id="8256785">,</span>&nbsp;<span class="ident" id="8256787">err</span>&nbsp;<span class="builtintype" id="8256791">error</span><span class="op" id="8256796">)</span>&nbsp;<span class="op" id="8256798">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8256801">&lt;-</span><span class="ident" id="8256803">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8256806">return</span>&nbsp;<span class="num" id="8256813">0</span><span class="op" id="8256814">,</span>&nbsp;<span class="ident" id="8256816">io</span><span class="op" id="8256818">.</span><span class="ident" id="8256819">EOF</span><br>
<span class="lineno"></span><span class="op" id="8256823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="8256826">//&nbsp;clientTest&nbsp;represents&nbsp;a&nbsp;test&nbsp;of&nbsp;the&nbsp;TLS&nbsp;client&nbsp;handshake&nbsp;against&nbsp;a&nbsp;reference</span><br>
<span class="lineno"></span><span class="comment" id="8256906">//&nbsp;implementation.</span><br>
<span class="lineno"></span><span class="keyword" id="8256925">type</span>&nbsp;<span class="ident" id="8256930">clientTest</span>&nbsp;<span class="keyword" id="8256941">struct</span>&nbsp;<span class="op" id="8256948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8256951">//&nbsp;name&nbsp;is&nbsp;a&nbsp;freeform&nbsp;string&nbsp;identifying&nbsp;the&nbsp;test&nbsp;and&nbsp;the&nbsp;file&nbsp;in&nbsp;which</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257024">//&nbsp;the&nbsp;expected&nbsp;results&nbsp;will&nbsp;be&nbsp;stored.</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257065">name</span>&nbsp;<span class="builtintype" id="8257070">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257078">//&nbsp;command,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;series&nbsp;of&nbsp;arguments&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257144">//&nbsp;command&nbsp;to&nbsp;run&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257189">command</span>&nbsp;<span class="op" id="8257197">[</span><span class="op" id="8257198">]</span><span class="builtintype" id="8257199">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257207">//&nbsp;config,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;a&nbsp;custom&nbsp;Config&nbsp;to&nbsp;use&nbsp;for&nbsp;this&nbsp;test.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257278">config</span>&nbsp;<span class="op" id="8257285">*</span><span class="ident" id="8257286">Config</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257294">//&nbsp;cert,&nbsp;if&nbsp;not&nbsp;empty,&nbsp;contains&nbsp;a&nbsp;DER-encoded&nbsp;certificate&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257361">//&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257383">cert</span>&nbsp;<span class="op" id="8257388">[</span><span class="op" id="8257389">]</span><span class="builtintype" id="8257390">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257396">//&nbsp;key,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;contains&nbsp;either&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257454">//&nbsp;*ecdsa.PrivateKey&nbsp;which&nbsp;is&nbsp;the&nbsp;private&nbsp;key&nbsp;for&nbsp;the&nbsp;reference&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257527">key</span>&nbsp;<span class="keyword" id="8257531">interface</span><span class="op" id="8257540">{</span><span class="op" id="8257541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257544">//&nbsp;validate,&nbsp;if&nbsp;not&nbsp;nil,&nbsp;is&nbsp;a&nbsp;function&nbsp;that&nbsp;will&nbsp;be&nbsp;called&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257613">//&nbsp;ConnectionState&nbsp;of&nbsp;the&nbsp;resulting&nbsp;connection.&nbsp;It&nbsp;returns&nbsp;a&nbsp;non-nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8257683">//&nbsp;error&nbsp;if&nbsp;the&nbsp;ConnectionState&nbsp;is&nbsp;unacceptable.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8257733">validate</span>&nbsp;<span class="keyword" id="8257742">func</span><span class="op" id="8257746">(</span><span class="ident" id="8257747">ConnectionState</span><span class="op" id="8257762">)</span>&nbsp;<span class="builtintype" id="8257764">error</span><br>
<span class="lineno"></span><span class="op" id="8257770">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8257773">var</span>&nbsp;<span class="ident" id="8257777">defaultServerCommand</span>&nbsp;<span class="op" id="8257798">=</span>&nbsp;<span class="op" id="8257800">[</span><span class="op" id="8257801">]</span><span class="builtintype" id="8257802">string</span><span class="op" id="8257808">{</span><span class="string" id="8257809">&#34;openssl&#34;</span><span class="op" id="8257818">,</span>&nbsp;<span class="string" id="8257820">&#34;s_server&#34;</span><span class="op" id="8257830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="8257833">//&nbsp;connFromCommand&nbsp;starts&nbsp;the&nbsp;reference&nbsp;server&nbsp;process,&nbsp;connects&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="8257908">//&nbsp;returns&nbsp;a&nbsp;recordingConn&nbsp;for&nbsp;the&nbsp;connection.&nbsp;The&nbsp;stdin&nbsp;return&nbsp;value&nbsp;is&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="8257983">//&nbsp;blockingSource&nbsp;for&nbsp;the&nbsp;stdin&nbsp;of&nbsp;the&nbsp;child&nbsp;process.&nbsp;It&nbsp;must&nbsp;be&nbsp;closed&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="8258062">//&nbsp;Waiting&nbsp;for&nbsp;child.</span><br>
<span class="lineno"></span><span class="keyword" id="8258084">func</span>&nbsp;<span class="op" id="8258089">(</span><span class="ident" id="8258090">test</span>&nbsp;<span class="op" id="8258095">*</span><span class="ident" id="8258096">clientTest</span><span class="op" id="8258106">)</span>&nbsp;<span class="ident" id="8258108">connFromCommand</span><span class="op" id="8258123">(</span><span class="op" id="8258124">)</span>&nbsp;<span class="op" id="8258126">(</span><span class="ident" id="8258127">conn</span>&nbsp;<span class="op" id="8258132">*</span><span class="ident" id="8258133">recordingConn</span><span class="op" id="8258146">,</span>&nbsp;<span class="ident" id="8258148">child</span>&nbsp;<span class="op" id="8258154">*</span><span class="ident" id="8258155">exec</span><span class="op" id="8258159">.</span><span class="ident" id="8258160">Cmd</span><span class="op" id="8258163">,</span>&nbsp;<span class="ident" id="8258165">stdin</span>&nbsp;<span class="ident" id="8258171">blockingSource</span><span class="op" id="8258185">,</span>&nbsp;<span class="ident" id="8258187">err</span>&nbsp;<span class="builtintype" id="8258191">error</span><span class="op" id="8258196">)</span>&nbsp;<span class="op" id="8258198">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258201">cert</span>&nbsp;<span class="op" id="8258206">:=</span>&nbsp;<span class="ident" id="8258209">testRSACertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258229">if</span>&nbsp;<span class="builtinfunc" id="8258232">len</span><span class="op" id="8258235">(</span><span class="ident" id="8258236">test</span><span class="op" id="8258240">.</span><span class="ident" id="8258241">cert</span><span class="op" id="8258245">)</span>&nbsp;<span class="op" id="8258247">&gt;</span>&nbsp;<span class="num" id="8258249">0</span>&nbsp;<span class="op" id="8258251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258255">cert</span>&nbsp;<span class="op" id="8258260">=</span>&nbsp;<span class="ident" id="8258262">test</span><span class="op" id="8258266">.</span><span class="ident" id="8258267">cert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258276">certPath</span>&nbsp;<span class="op" id="8258285">:=</span>&nbsp;<span class="ident" id="8258288">tempFile</span><span class="op" id="8258296">(</span><span class="builtintype" id="8258297">string</span><span class="op" id="8258303">(</span><span class="ident" id="8258304">cert</span><span class="op" id="8258308">)</span><span class="op" id="8258309">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258312">defer</span>&nbsp;<span class="ident" id="8258318">os</span><span class="op" id="8258320">.</span><span class="ident" id="8258321">Remove</span><span class="op" id="8258327">(</span><span class="ident" id="8258328">certPath</span><span class="op" id="8258336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258340">var</span>&nbsp;<span class="ident" id="8258344">key</span>&nbsp;<span class="keyword" id="8258348">interface</span><span class="op" id="8258357">{</span><span class="op" id="8258358">}</span>&nbsp;<span class="op" id="8258360">=</span>&nbsp;<span class="ident" id="8258362">testRSAPrivateKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258381">if</span>&nbsp;<span class="ident" id="8258384">test</span><span class="op" id="8258388">.</span><span class="ident" id="8258389">key</span>&nbsp;<span class="op" id="8258393">!=</span>&nbsp;<span class="ident" id="8258396">nil</span>&nbsp;<span class="op" id="8258400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258404">key</span>&nbsp;<span class="op" id="8258408">=</span>&nbsp;<span class="ident" id="8258410">test</span><span class="op" id="8258414">.</span><span class="ident" id="8258415">key</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258420">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258423">var</span>&nbsp;<span class="ident" id="8258427">pemType</span>&nbsp;<span class="builtintype" id="8258435">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258443">var</span>&nbsp;<span class="ident" id="8258447">derBytes</span>&nbsp;<span class="op" id="8258456">[</span><span class="op" id="8258457">]</span><span class="builtintype" id="8258458">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258464">switch</span>&nbsp;<span class="ident" id="8258471">key</span>&nbsp;<span class="op" id="8258475">:=</span>&nbsp;<span class="ident" id="8258478">key</span><span class="op" id="8258481">.</span><span class="op" id="8258482">(</span><span class="keyword" id="8258483">type</span><span class="op" id="8258487">)</span>&nbsp;<span class="op" id="8258489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258492">case</span>&nbsp;<span class="op" id="8258497">*</span><span class="ident" id="8258498">rsa</span><span class="op" id="8258501">.</span><span class="ident" id="8258502">PrivateKey</span><span class="op" id="8258512">:</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258516">pemType</span>&nbsp;<span class="op" id="8258524">=</span>&nbsp;<span class="string" id="8258526">&#34;RSA&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258534">derBytes</span>&nbsp;<span class="op" id="8258543">=</span>&nbsp;<span class="ident" id="8258545">x509</span><span class="op" id="8258549">.</span><span class="ident" id="8258550">MarshalPKCS1PrivateKey</span><span class="op" id="8258572">(</span><span class="ident" id="8258573">key</span><span class="op" id="8258576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258579">case</span>&nbsp;<span class="op" id="8258584">*</span><span class="ident" id="8258585">ecdsa</span><span class="op" id="8258590">.</span><span class="ident" id="8258591">PrivateKey</span><span class="op" id="8258601">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258605">pemType</span>&nbsp;<span class="op" id="8258613">=</span>&nbsp;<span class="string" id="8258615">&#34;EC&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258622">var</span>&nbsp;<span class="ident" id="8258626">err</span>&nbsp;<span class="builtintype" id="8258630">error</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258638">derBytes</span><span class="op" id="8258646">,</span>&nbsp;<span class="ident" id="8258648">err</span>&nbsp;<span class="op" id="8258652">=</span>&nbsp;<span class="ident" id="8258654">x509</span><span class="op" id="8258658">.</span><span class="ident" id="8258659">MarshalECPrivateKey</span><span class="op" id="8258678">(</span><span class="ident" id="8258679">key</span><span class="op" id="8258682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258686">if</span>&nbsp;<span class="ident" id="8258689">err</span>&nbsp;<span class="op" id="8258693">!=</span>&nbsp;<span class="ident" id="8258696">nil</span>&nbsp;<span class="op" id="8258700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8258705">panic</span><span class="op" id="8258710">(</span><span class="ident" id="8258711">err</span><span class="op" id="8258714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258721">default</span><span class="op" id="8258728">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8258732">panic</span><span class="op" id="8258737">(</span><span class="string" id="8258738">&#34;unknown&nbsp;key&nbsp;type&#34;</span><span class="op" id="8258756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8258759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258763">var</span>&nbsp;<span class="ident" id="8258767">pemOut</span>&nbsp;<span class="ident" id="8258774">bytes</span><span class="op" id="8258779">.</span><span class="ident" id="8258780">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258788">pem</span><span class="op" id="8258791">.</span><span class="ident" id="8258792">Encode</span><span class="op" id="8258798">(</span><span class="op" id="8258799">&amp;</span><span class="ident" id="8258800">pemOut</span><span class="op" id="8258806">,</span>&nbsp;<span class="op" id="8258808">&amp;</span><span class="ident" id="8258809">pem</span><span class="op" id="8258812">.</span><span class="ident" id="8258813">Block</span><span class="op" id="8258818">{</span><span class="ident" id="8258819">Type</span><span class="op" id="8258823">:</span>&nbsp;<span class="ident" id="8258825">pemType</span>&nbsp;<span class="op" id="8258833">+</span>&nbsp;<span class="string" id="8258835">&#34;&nbsp;PRIVATE&nbsp;KEY&#34;</span><span class="op" id="8258849">,</span>&nbsp;<span class="ident" id="8258851">Bytes</span><span class="op" id="8258856">:</span>&nbsp;<span class="ident" id="8258858">derBytes</span><span class="op" id="8258866">}</span><span class="op" id="8258867">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258871">keyPath</span>&nbsp;<span class="op" id="8258879">:=</span>&nbsp;<span class="ident" id="8258882">tempFile</span><span class="op" id="8258890">(</span><span class="builtintype" id="8258891">string</span><span class="op" id="8258897">(</span><span class="ident" id="8258898">pemOut</span><span class="op" id="8258904">.</span><span class="ident" id="8258905">Bytes</span><span class="op" id="8258910">(</span><span class="op" id="8258911">)</span><span class="op" id="8258912">)</span><span class="op" id="8258913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258916">defer</span>&nbsp;<span class="ident" id="8258922">os</span><span class="op" id="8258924">.</span><span class="ident" id="8258925">Remove</span><span class="op" id="8258931">(</span><span class="ident" id="8258932">keyPath</span><span class="op" id="8258939">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258943">var</span>&nbsp;<span class="ident" id="8258947">command</span>&nbsp;<span class="op" id="8258955">[</span><span class="op" id="8258956">]</span><span class="builtintype" id="8258957">string</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8258965">if</span>&nbsp;<span class="builtinfunc" id="8258968">len</span><span class="op" id="8258971">(</span><span class="ident" id="8258972">test</span><span class="op" id="8258976">.</span><span class="ident" id="8258977">command</span><span class="op" id="8258984">)</span>&nbsp;<span class="op" id="8258986">&gt;</span>&nbsp;<span class="num" id="8258988">0</span>&nbsp;<span class="op" id="8258990">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8258994">command</span>&nbsp;<span class="op" id="8259002">=</span>&nbsp;<span class="builtinfunc" id="8259004">append</span><span class="op" id="8259010">(</span><span class="ident" id="8259011">command</span><span class="op" id="8259018">,</span>&nbsp;<span class="ident" id="8259020">test</span><span class="op" id="8259024">.</span><span class="ident" id="8259025">command</span><span class="op" id="8259032">...</span><span class="op" id="8259035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259038">}</span>&nbsp;<span class="keyword" id="8259040">else</span>&nbsp;<span class="op" id="8259045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259049">command</span>&nbsp;<span class="op" id="8259057">=</span>&nbsp;<span class="builtinfunc" id="8259059">append</span><span class="op" id="8259065">(</span><span class="ident" id="8259066">command</span><span class="op" id="8259073">,</span>&nbsp;<span class="ident" id="8259075">defaultServerCommand</span><span class="op" id="8259095">...</span><span class="op" id="8259098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259101">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259104">command</span>&nbsp;<span class="op" id="8259112">=</span>&nbsp;<span class="builtinfunc" id="8259114">append</span><span class="op" id="8259120">(</span><span class="ident" id="8259121">command</span><span class="op" id="8259128">,</span>&nbsp;<span class="string" id="8259130">&#34;-cert&#34;</span><span class="op" id="8259137">,</span>&nbsp;<span class="ident" id="8259139">certPath</span><span class="op" id="8259147">,</span>&nbsp;<span class="string" id="8259149">&#34;-certform&#34;</span><span class="op" id="8259160">,</span>&nbsp;<span class="string" id="8259162">&#34;DER&#34;</span><span class="op" id="8259167">,</span>&nbsp;<span class="string" id="8259169">&#34;-key&#34;</span><span class="op" id="8259175">,</span>&nbsp;<span class="ident" id="8259177">keyPath</span><span class="op" id="8259184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259187">//&nbsp;serverPort&nbsp;contains&nbsp;the&nbsp;port&nbsp;that&nbsp;OpenSSL&nbsp;will&nbsp;listen&nbsp;on.&nbsp;OpenSSL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259257">//&nbsp;can&#39;t&nbsp;take&nbsp;&#34;0&#34;&nbsp;as&nbsp;an&nbsp;argument&nbsp;here&nbsp;so&nbsp;we&nbsp;have&nbsp;to&nbsp;pick&nbsp;a&nbsp;number&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259328">//&nbsp;hope&nbsp;that&nbsp;it&#39;s&nbsp;not&nbsp;in&nbsp;use&nbsp;on&nbsp;the&nbsp;machine.&nbsp;Since&nbsp;this&nbsp;only&nbsp;occurs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259397">//&nbsp;when&nbsp;-update&nbsp;is&nbsp;given&nbsp;and&nbsp;thus&nbsp;when&nbsp;there&#39;s&nbsp;a&nbsp;human&nbsp;watching&nbsp;the</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259466">//&nbsp;test,&nbsp;this&nbsp;isn&#39;t&nbsp;too&nbsp;bad.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259496">const</span>&nbsp;<span class="ident" id="8259502">serverPort</span>&nbsp;<span class="op" id="8259513">=</span>&nbsp;<span class="num" id="8259515">24323</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259522">command</span>&nbsp;<span class="op" id="8259530">=</span>&nbsp;<span class="builtinfunc" id="8259532">append</span><span class="op" id="8259538">(</span><span class="ident" id="8259539">command</span><span class="op" id="8259546">,</span>&nbsp;<span class="string" id="8259548">&#34;-accept&#34;</span><span class="op" id="8259557">,</span>&nbsp;<span class="ident" id="8259559">strconv</span><span class="op" id="8259566">.</span><span class="ident" id="8259567">Itoa</span><span class="op" id="8259571">(</span><span class="ident" id="8259572">serverPort</span><span class="op" id="8259582">)</span><span class="op" id="8259583">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259587">cmd</span>&nbsp;<span class="op" id="8259591">:=</span>&nbsp;<span class="ident" id="8259594">exec</span><span class="op" id="8259598">.</span><span class="ident" id="8259599">Command</span><span class="op" id="8259606">(</span><span class="ident" id="8259607">command</span><span class="op" id="8259614">[</span><span class="num" id="8259615">0</span><span class="op" id="8259616">]</span><span class="op" id="8259617">,</span>&nbsp;<span class="ident" id="8259619">command</span><span class="op" id="8259626">[</span><span class="num" id="8259627">1</span><span class="op" id="8259628">:</span><span class="op" id="8259629">]</span><span class="op" id="8259630">...</span><span class="op" id="8259633">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259636">stdin</span>&nbsp;<span class="op" id="8259642">=</span>&nbsp;<span class="ident" id="8259644">blockingSource</span><span class="op" id="8259658">(</span><span class="builtinfunc" id="8259659">make</span><span class="op" id="8259663">(</span><span class="keyword" id="8259664">chan</span>&nbsp;<span class="builtintype" id="8259669">bool</span><span class="op" id="8259673">)</span><span class="op" id="8259674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259677">cmd</span><span class="op" id="8259680">.</span><span class="ident" id="8259681">Stdin</span>&nbsp;<span class="op" id="8259687">=</span>&nbsp;<span class="ident" id="8259689">stdin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259696">var</span>&nbsp;<span class="ident" id="8259700">out</span>&nbsp;<span class="ident" id="8259704">bytes</span><span class="op" id="8259709">.</span><span class="ident" id="8259710">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259718">cmd</span><span class="op" id="8259721">.</span><span class="ident" id="8259722">Stdout</span>&nbsp;<span class="op" id="8259729">=</span>&nbsp;<span class="op" id="8259731">&amp;</span><span class="ident" id="8259732">out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8259737">cmd</span><span class="op" id="8259740">.</span><span class="ident" id="8259741">Stderr</span>&nbsp;<span class="op" id="8259748">=</span>&nbsp;<span class="op" id="8259750">&amp;</span><span class="ident" id="8259751">out</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259756">if</span>&nbsp;<span class="ident" id="8259759">err</span>&nbsp;<span class="op" id="8259763">:=</span>&nbsp;<span class="ident" id="8259766">cmd</span><span class="op" id="8259769">.</span><span class="ident" id="8259770">Start</span><span class="op" id="8259775">(</span><span class="op" id="8259776">)</span><span class="op" id="8259777">;</span>&nbsp;<span class="ident" id="8259779">err</span>&nbsp;<span class="op" id="8259783">!=</span>&nbsp;<span class="ident" id="8259786">nil</span>&nbsp;<span class="op" id="8259790">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8259794">return</span>&nbsp;<span class="ident" id="8259801">nil</span><span class="op" id="8259804">,</span>&nbsp;<span class="ident" id="8259806">nil</span><span class="op" id="8259809">,</span>&nbsp;<span class="ident" id="8259811">nil</span><span class="op" id="8259814">,</span>&nbsp;<span class="ident" id="8259816">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8259821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259825">//&nbsp;OpenSSL&nbsp;does&nbsp;print&nbsp;an&nbsp;&#34;ACCEPT&#34;&nbsp;banner,&nbsp;but&nbsp;it&nbsp;does&nbsp;so&nbsp;*before*</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259892">//&nbsp;opening&nbsp;the&nbsp;listening&nbsp;socket,&nbsp;so&nbsp;we&nbsp;can&#39;t&nbsp;use&nbsp;that&nbsp;to&nbsp;wait&nbsp;until&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8259964">//&nbsp;has&nbsp;started&nbsp;listening.&nbsp;Thus&nbsp;we&nbsp;are&nbsp;forced&nbsp;to&nbsp;poll&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8260033">//&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260049">var</span>&nbsp;<span class="ident" id="8260053">tcpConn</span>&nbsp;<span class="ident" id="8260061">net</span><span class="op" id="8260064">.</span><span class="ident" id="8260065">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260071">for</span>&nbsp;<span class="ident" id="8260075">i</span>&nbsp;<span class="op" id="8260077">:=</span>&nbsp;<span class="builtintype" id="8260080">uint</span><span class="op" id="8260084">(</span><span class="num" id="8260085">0</span><span class="op" id="8260086">)</span><span class="op" id="8260087">;</span>&nbsp;<span class="ident" id="8260089">i</span>&nbsp;<span class="op" id="8260091">&lt;</span>&nbsp;<span class="num" id="8260093">5</span><span class="op" id="8260094">;</span>&nbsp;<span class="ident" id="8260096">i</span><span class="op" id="8260097">++</span>&nbsp;<span class="op" id="8260100">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260104">var</span>&nbsp;<span class="ident" id="8260108">err</span>&nbsp;<span class="builtintype" id="8260112">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260120">tcpConn</span><span class="op" id="8260127">,</span>&nbsp;<span class="ident" id="8260129">err</span>&nbsp;<span class="op" id="8260133">=</span>&nbsp;<span class="ident" id="8260135">net</span><span class="op" id="8260138">.</span><span class="ident" id="8260139">DialTCP</span><span class="op" id="8260146">(</span><span class="string" id="8260147">&#34;tcp&#34;</span><span class="op" id="8260152">,</span>&nbsp;<span class="ident" id="8260154">nil</span><span class="op" id="8260157">,</span>&nbsp;<span class="op" id="8260159">&amp;</span><span class="ident" id="8260160">net</span><span class="op" id="8260163">.</span><span class="ident" id="8260164">TCPAddr</span><span class="op" id="8260171">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260176">IP</span><span class="op" id="8260178">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="8260182">net</span><span class="op" id="8260185">.</span><span class="ident" id="8260186">IPv4</span><span class="op" id="8260190">(</span><span class="num" id="8260191">127</span><span class="op" id="8260194">,</span>&nbsp;<span class="num" id="8260196">0</span><span class="op" id="8260197">,</span>&nbsp;<span class="num" id="8260199">0</span><span class="op" id="8260200">,</span>&nbsp;<span class="num" id="8260202">1</span><span class="op" id="8260203">)</span><span class="op" id="8260204">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260209">Port</span><span class="op" id="8260213">:</span>&nbsp;<span class="ident" id="8260215">serverPort</span><span class="op" id="8260225">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260229">}</span><span class="op" id="8260230">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260234">if</span>&nbsp;<span class="ident" id="8260237">err</span>&nbsp;<span class="op" id="8260241">==</span>&nbsp;<span class="ident" id="8260244">nil</span>&nbsp;<span class="op" id="8260248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260253">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260265">time</span><span class="op" id="8260269">.</span><span class="ident" id="8260270">Sleep</span><span class="op" id="8260275">(</span><span class="op" id="8260276">(</span><span class="num" id="8260277">1</span>&nbsp;<span class="op" id="8260279">&lt;&lt;</span>&nbsp;<span class="ident" id="8260282">i</span><span class="op" id="8260283">)</span>&nbsp;<span class="op" id="8260285">*</span>&nbsp;<span class="num" id="8260287">5</span>&nbsp;<span class="op" id="8260289">*</span>&nbsp;<span class="ident" id="8260291">time</span><span class="op" id="8260295">.</span><span class="ident" id="8260296">Millisecond</span><span class="op" id="8260307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260310">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260313">if</span>&nbsp;<span class="ident" id="8260316">tcpConn</span>&nbsp;<span class="op" id="8260324">==</span>&nbsp;<span class="ident" id="8260327">nil</span>&nbsp;<span class="op" id="8260331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8260335">close</span><span class="op" id="8260340">(</span><span class="ident" id="8260341">stdin</span><span class="op" id="8260346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260350">out</span><span class="op" id="8260353">.</span><span class="ident" id="8260354">WriteTo</span><span class="op" id="8260361">(</span><span class="ident" id="8260362">os</span><span class="op" id="8260364">.</span><span class="ident" id="8260365">Stdout</span><span class="op" id="8260371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260375">cmd</span><span class="op" id="8260378">.</span><span class="ident" id="8260379">Process</span><span class="op" id="8260386">.</span><span class="ident" id="8260387">Kill</span><span class="op" id="8260391">(</span><span class="op" id="8260392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260396">return</span>&nbsp;<span class="ident" id="8260403">nil</span><span class="op" id="8260406">,</span>&nbsp;<span class="ident" id="8260408">nil</span><span class="op" id="8260411">,</span>&nbsp;<span class="ident" id="8260413">nil</span><span class="op" id="8260416">,</span>&nbsp;<span class="ident" id="8260418">cmd</span><span class="op" id="8260421">.</span><span class="ident" id="8260422">Wait</span><span class="op" id="8260426">(</span><span class="op" id="8260427">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260434">record</span>&nbsp;<span class="op" id="8260441">:=</span>&nbsp;<span class="op" id="8260444">&amp;</span><span class="ident" id="8260445">recordingConn</span><span class="op" id="8260458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260462">Conn</span><span class="op" id="8260466">:</span>&nbsp;<span class="ident" id="8260468">tcpConn</span><span class="op" id="8260475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260478">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260482">return</span>&nbsp;<span class="ident" id="8260489">record</span><span class="op" id="8260495">,</span>&nbsp;<span class="ident" id="8260497">cmd</span><span class="op" id="8260500">,</span>&nbsp;<span class="ident" id="8260502">stdin</span><span class="op" id="8260507">,</span>&nbsp;<span class="ident" id="8260509">nil</span><br>
<span class="lineno"></span><span class="op" id="8260513">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8260516">func</span>&nbsp;<span class="op" id="8260521">(</span><span class="ident" id="8260522">test</span>&nbsp;<span class="op" id="8260527">*</span><span class="ident" id="8260528">clientTest</span><span class="op" id="8260538">)</span>&nbsp;<span class="ident" id="8260540">dataPath</span><span class="op" id="8260548">(</span><span class="op" id="8260549">)</span>&nbsp;<span class="builtintype" id="8260551">string</span>&nbsp;<span class="op" id="8260558">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260561">return</span>&nbsp;<span class="ident" id="8260568">filepath</span><span class="op" id="8260576">.</span><span class="ident" id="8260577">Join</span><span class="op" id="8260581">(</span><span class="string" id="8260582">&#34;testdata&#34;</span><span class="op" id="8260592">,</span>&nbsp;<span class="string" id="8260594">&#34;Client-&#34;</span><span class="op" id="8260603">+</span><span class="ident" id="8260604">test</span><span class="op" id="8260608">.</span><span class="ident" id="8260609">name</span><span class="op" id="8260613">)</span><br>
<span class="lineno"></span><span class="op" id="8260615">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8260618">func</span>&nbsp;<span class="op" id="8260623">(</span><span class="ident" id="8260624">test</span>&nbsp;<span class="op" id="8260629">*</span><span class="ident" id="8260630">clientTest</span><span class="op" id="8260640">)</span>&nbsp;<span class="ident" id="8260642">loadData</span><span class="op" id="8260650">(</span><span class="op" id="8260651">)</span>&nbsp;<span class="op" id="8260653">(</span><span class="ident" id="8260654">flows</span>&nbsp;<span class="op" id="8260660">[</span><span class="op" id="8260661">]</span><span class="op" id="8260662">[</span><span class="op" id="8260663">]</span><span class="builtintype" id="8260664">byte</span><span class="op" id="8260668">,</span>&nbsp;<span class="ident" id="8260670">err</span>&nbsp;<span class="builtintype" id="8260674">error</span><span class="op" id="8260679">)</span>&nbsp;<span class="op" id="8260681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8260684">in</span><span class="op" id="8260686">,</span>&nbsp;<span class="ident" id="8260688">err</span>&nbsp;<span class="op" id="8260692">:=</span>&nbsp;<span class="ident" id="8260695">os</span><span class="op" id="8260697">.</span><span class="ident" id="8260698">Open</span><span class="op" id="8260702">(</span><span class="ident" id="8260703">test</span><span class="op" id="8260707">.</span><span class="ident" id="8260708">dataPath</span><span class="op" id="8260716">(</span><span class="op" id="8260717">)</span><span class="op" id="8260718">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260721">if</span>&nbsp;<span class="ident" id="8260724">err</span>&nbsp;<span class="op" id="8260728">!=</span>&nbsp;<span class="ident" id="8260731">nil</span>&nbsp;<span class="op" id="8260735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260739">return</span>&nbsp;<span class="ident" id="8260746">nil</span><span class="op" id="8260749">,</span>&nbsp;<span class="ident" id="8260751">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8260756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260759">defer</span>&nbsp;<span class="ident" id="8260765">in</span><span class="op" id="8260767">.</span><span class="ident" id="8260768">Close</span><span class="op" id="8260773">(</span><span class="op" id="8260774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260777">return</span>&nbsp;<span class="ident" id="8260784">parseTestData</span><span class="op" id="8260797">(</span><span class="ident" id="8260798">in</span><span class="op" id="8260800">)</span><br>
<span class="lineno">165</span><span class="op" id="8260802">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8260805">func</span>&nbsp;<span class="op" id="8260810">(</span><span class="ident" id="8260811">test</span>&nbsp;<span class="op" id="8260816">*</span><span class="ident" id="8260817">clientTest</span><span class="op" id="8260827">)</span>&nbsp;<span class="ident" id="8260829">run</span><span class="op" id="8260832">(</span><span class="ident" id="8260833">t</span>&nbsp;<span class="op" id="8260835">*</span><span class="ident" id="8260836">testing</span><span class="op" id="8260843">.</span><span class="ident" id="8260844">T</span><span class="op" id="8260845">,</span>&nbsp;<span class="ident" id="8260847">write</span>&nbsp;<span class="builtintype" id="8260853">bool</span><span class="op" id="8260857">)</span>&nbsp;<span class="op" id="8260859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260862">var</span>&nbsp;<span class="ident" id="8260866">clientConn</span><span class="op" id="8260876">,</span>&nbsp;<span class="ident" id="8260878">serverConn</span>&nbsp;<span class="ident" id="8260889">net</span><span class="op" id="8260892">.</span><span class="ident" id="8260893">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260899">var</span>&nbsp;<span class="ident" id="8260903">recordingConn</span>&nbsp;<span class="op" id="8260917">*</span><span class="ident" id="8260918">recordingConn</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260933">var</span>&nbsp;<span class="ident" id="8260937">childProcess</span>&nbsp;<span class="op" id="8260950">*</span><span class="ident" id="8260951">exec</span><span class="op" id="8260955">.</span><span class="ident" id="8260956">Cmd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260961">var</span>&nbsp;<span class="ident" id="8260965">stdin</span>&nbsp;<span class="ident" id="8260971">blockingSource</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8260988">if</span>&nbsp;<span class="ident" id="8260991">write</span>&nbsp;<span class="op" id="8260997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261001">var</span>&nbsp;<span class="ident" id="8261005">err</span>&nbsp;<span class="builtintype" id="8261009">error</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261017">recordingConn</span><span class="op" id="8261030">,</span>&nbsp;<span class="ident" id="8261032">childProcess</span><span class="op" id="8261044">,</span>&nbsp;<span class="ident" id="8261046">stdin</span><span class="op" id="8261051">,</span>&nbsp;<span class="ident" id="8261053">err</span>&nbsp;<span class="op" id="8261057">=</span>&nbsp;<span class="ident" id="8261059">test</span><span class="op" id="8261063">.</span><span class="ident" id="8261064">connFromCommand</span><span class="op" id="8261079">(</span><span class="op" id="8261080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261084">if</span>&nbsp;<span class="ident" id="8261087">err</span>&nbsp;<span class="op" id="8261091">!=</span>&nbsp;<span class="ident" id="8261094">nil</span>&nbsp;<span class="op" id="8261098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261103">t</span><span class="op" id="8261104">.</span><span class="ident" id="8261105">Fatalf</span><span class="op" id="8261111">(</span><span class="string" id="8261112">&#34;Failed&nbsp;to&nbsp;start&nbsp;subcommand:&nbsp;%s&#34;</span><span class="op" id="8261144">,</span>&nbsp;<span class="ident" id="8261146">err</span><span class="op" id="8261149">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261157">clientConn</span>&nbsp;<span class="op" id="8261168">=</span>&nbsp;<span class="ident" id="8261170">recordingConn</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261185">}</span>&nbsp;<span class="keyword" id="8261187">else</span>&nbsp;<span class="op" id="8261192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261196">clientConn</span><span class="op" id="8261206">,</span>&nbsp;<span class="ident" id="8261208">serverConn</span>&nbsp;<span class="op" id="8261219">=</span>&nbsp;<span class="ident" id="8261221">net</span><span class="op" id="8261224">.</span><span class="ident" id="8261225">Pipe</span><span class="op" id="8261229">(</span><span class="op" id="8261230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261237">config</span>&nbsp;<span class="op" id="8261244">:=</span>&nbsp;<span class="ident" id="8261247">test</span><span class="op" id="8261251">.</span><span class="ident" id="8261252">config</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261260">if</span>&nbsp;<span class="ident" id="8261263">config</span>&nbsp;<span class="op" id="8261270">==</span>&nbsp;<span class="ident" id="8261273">nil</span>&nbsp;<span class="op" id="8261277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261281">config</span>&nbsp;<span class="op" id="8261288">=</span>&nbsp;<span class="ident" id="8261290">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261302">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261305">client</span>&nbsp;<span class="op" id="8261312">:=</span>&nbsp;<span class="ident" id="8261315">Client</span><span class="op" id="8261321">(</span><span class="ident" id="8261322">clientConn</span><span class="op" id="8261332">,</span>&nbsp;<span class="ident" id="8261334">config</span><span class="op" id="8261340">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261344">doneChan</span>&nbsp;<span class="op" id="8261353">:=</span>&nbsp;<span class="builtinfunc" id="8261356">make</span><span class="op" id="8261360">(</span><span class="keyword" id="8261361">chan</span>&nbsp;<span class="builtintype" id="8261366">bool</span><span class="op" id="8261370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261373">go</span>&nbsp;<span class="keyword" id="8261376">func</span><span class="op" id="8261380">(</span><span class="op" id="8261381">)</span>&nbsp;<span class="op" id="8261383">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261387">if</span>&nbsp;<span class="ident" id="8261390">_</span><span class="op" id="8261391">,</span>&nbsp;<span class="ident" id="8261393">err</span>&nbsp;<span class="op" id="8261397">:=</span>&nbsp;<span class="ident" id="8261400">client</span><span class="op" id="8261406">.</span><span class="ident" id="8261407">Write</span><span class="op" id="8261412">(</span><span class="op" id="8261413">[</span><span class="op" id="8261414">]</span><span class="builtintype" id="8261415">byte</span><span class="op" id="8261419">(</span><span class="string" id="8261420">&#34;hello\n&#34;</span><span class="op" id="8261429">)</span><span class="op" id="8261430">)</span><span class="op" id="8261431">;</span>&nbsp;<span class="ident" id="8261433">err</span>&nbsp;<span class="op" id="8261437">!=</span>&nbsp;<span class="ident" id="8261440">nil</span>&nbsp;<span class="op" id="8261444">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261449">t</span><span class="op" id="8261450">.</span><span class="ident" id="8261451">Logf</span><span class="op" id="8261455">(</span><span class="string" id="8261456">&#34;Client.Write&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8261481">,</span>&nbsp;<span class="ident" id="8261483">err</span><span class="op" id="8261486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261490">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261494">if</span>&nbsp;<span class="ident" id="8261497">test</span><span class="op" id="8261501">.</span><span class="ident" id="8261502">validate</span>&nbsp;<span class="op" id="8261511">!=</span>&nbsp;<span class="ident" id="8261514">nil</span>&nbsp;<span class="op" id="8261518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261523">if</span>&nbsp;<span class="ident" id="8261526">err</span>&nbsp;<span class="op" id="8261530">:=</span>&nbsp;<span class="ident" id="8261533">test</span><span class="op" id="8261537">.</span><span class="ident" id="8261538">validate</span><span class="op" id="8261546">(</span><span class="ident" id="8261547">client</span><span class="op" id="8261553">.</span><span class="ident" id="8261554">ConnectionState</span><span class="op" id="8261569">(</span><span class="op" id="8261570">)</span><span class="op" id="8261571">)</span><span class="op" id="8261572">;</span>&nbsp;<span class="ident" id="8261574">err</span>&nbsp;<span class="op" id="8261578">!=</span>&nbsp;<span class="ident" id="8261581">nil</span>&nbsp;<span class="op" id="8261585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261591">t</span><span class="op" id="8261592">.</span><span class="ident" id="8261593">Logf</span><span class="op" id="8261597">(</span><span class="string" id="8261598">&#34;validate&nbsp;callback&nbsp;returned&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8261636">,</span>&nbsp;<span class="ident" id="8261638">err</span><span class="op" id="8261641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261646">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261650">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261654">client</span><span class="op" id="8261660">.</span><span class="ident" id="8261661">Close</span><span class="op" id="8261666">(</span><span class="op" id="8261667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261671">clientConn</span><span class="op" id="8261681">.</span><span class="ident" id="8261682">Close</span><span class="op" id="8261687">(</span><span class="op" id="8261688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261692">doneChan</span>&nbsp;<span class="op" id="8261701">&lt;-</span>&nbsp;<span class="builtintype" id="8261704">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261710">}</span><span class="op" id="8261711">(</span><span class="op" id="8261712">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261716">if</span>&nbsp;<span class="op" id="8261719">!</span><span class="ident" id="8261720">write</span>&nbsp;<span class="op" id="8261726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261730">flows</span><span class="op" id="8261735">,</span>&nbsp;<span class="ident" id="8261737">err</span>&nbsp;<span class="op" id="8261741">:=</span>&nbsp;<span class="ident" id="8261744">test</span><span class="op" id="8261748">.</span><span class="ident" id="8261749">loadData</span><span class="op" id="8261757">(</span><span class="op" id="8261758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261762">if</span>&nbsp;<span class="ident" id="8261765">err</span>&nbsp;<span class="op" id="8261769">!=</span>&nbsp;<span class="ident" id="8261772">nil</span>&nbsp;<span class="op" id="8261776">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261781">t</span><span class="op" id="8261782">.</span><span class="ident" id="8261783">Fatalf</span><span class="op" id="8261789">(</span><span class="string" id="8261790">&#34;%s:&nbsp;failed&nbsp;to&nbsp;load&nbsp;data&nbsp;from&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="8261827">,</span>&nbsp;<span class="ident" id="8261829">test</span><span class="op" id="8261833">.</span><span class="ident" id="8261834">name</span><span class="op" id="8261838">,</span>&nbsp;<span class="ident" id="8261840">test</span><span class="op" id="8261844">.</span><span class="ident" id="8261845">dataPath</span><span class="op" id="8261853">(</span><span class="op" id="8261854">)</span><span class="op" id="8261855">,</span>&nbsp;<span class="ident" id="8261857">err</span><span class="op" id="8261860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261864">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261868">for</span>&nbsp;<span class="ident" id="8261872">i</span><span class="op" id="8261873">,</span>&nbsp;<span class="ident" id="8261875">b</span>&nbsp;<span class="op" id="8261877">:=</span>&nbsp;<span class="keyword" id="8261880">range</span>&nbsp;<span class="ident" id="8261886">flows</span>&nbsp;<span class="op" id="8261892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261897">if</span>&nbsp;<span class="ident" id="8261900">i</span><span class="op" id="8261901">%</span><span class="num" id="8261902">2</span>&nbsp;<span class="op" id="8261904">==</span>&nbsp;<span class="num" id="8261907">1</span>&nbsp;<span class="op" id="8261909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261915">serverConn</span><span class="op" id="8261925">.</span><span class="ident" id="8261926">Write</span><span class="op" id="8261931">(</span><span class="ident" id="8261932">b</span><span class="op" id="8261933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8261939">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8261951">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261956">bb</span>&nbsp;<span class="op" id="8261959">:=</span>&nbsp;<span class="builtinfunc" id="8261962">make</span><span class="op" id="8261966">(</span><span class="op" id="8261967">[</span><span class="op" id="8261968">]</span><span class="builtintype" id="8261969">byte</span><span class="op" id="8261973">,</span>&nbsp;<span class="builtinfunc" id="8261975">len</span><span class="op" id="8261978">(</span><span class="ident" id="8261979">b</span><span class="op" id="8261980">)</span><span class="op" id="8261981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8261986">_</span><span class="op" id="8261987">,</span>&nbsp;<span class="ident" id="8261989">err</span>&nbsp;<span class="op" id="8261993">:=</span>&nbsp;<span class="ident" id="8261996">io</span><span class="op" id="8261998">.</span><span class="ident" id="8261999">ReadFull</span><span class="op" id="8262007">(</span><span class="ident" id="8262008">serverConn</span><span class="op" id="8262018">,</span>&nbsp;<span class="ident" id="8262020">bb</span><span class="op" id="8262022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262027">if</span>&nbsp;<span class="ident" id="8262030">err</span>&nbsp;<span class="op" id="8262034">!=</span>&nbsp;<span class="ident" id="8262037">nil</span>&nbsp;<span class="op" id="8262041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262047">t</span><span class="op" id="8262048">.</span><span class="ident" id="8262049">Fatalf</span><span class="op" id="8262055">(</span><span class="string" id="8262056">&#34;%s&nbsp;#%d:&nbsp;%s&#34;</span><span class="op" id="8262068">,</span>&nbsp;<span class="ident" id="8262070">test</span><span class="op" id="8262074">.</span><span class="ident" id="8262075">name</span><span class="op" id="8262079">,</span>&nbsp;<span class="ident" id="8262081">i</span><span class="op" id="8262082">,</span>&nbsp;<span class="ident" id="8262084">err</span><span class="op" id="8262087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262092">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262097">if</span>&nbsp;<span class="op" id="8262100">!</span><span class="ident" id="8262101">bytes</span><span class="op" id="8262106">.</span><span class="ident" id="8262107">Equal</span><span class="op" id="8262112">(</span><span class="ident" id="8262113">b</span><span class="op" id="8262114">,</span>&nbsp;<span class="ident" id="8262116">bb</span><span class="op" id="8262118">)</span>&nbsp;<span class="op" id="8262120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262126">t</span><span class="op" id="8262127">.</span><span class="ident" id="8262128">Fatalf</span><span class="op" id="8262134">(</span><span class="string" id="8262135">&#34;%s&nbsp;#%d:&nbsp;mismatch&nbsp;on&nbsp;read:&nbsp;got:%x&nbsp;want:%x&#34;</span><span class="op" id="8262177">,</span>&nbsp;<span class="ident" id="8262179">test</span><span class="op" id="8262183">.</span><span class="ident" id="8262184">name</span><span class="op" id="8262188">,</span>&nbsp;<span class="ident" id="8262190">i</span><span class="op" id="8262191">,</span>&nbsp;<span class="ident" id="8262193">bb</span><span class="op" id="8262195">,</span>&nbsp;<span class="ident" id="8262197">b</span><span class="op" id="8262198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262203">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262207">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262211">serverConn</span><span class="op" id="8262221">.</span><span class="ident" id="8262222">Close</span><span class="op" id="8262227">(</span><span class="op" id="8262228">)</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262231">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262235">&lt;-</span><span class="ident" id="8262237">doneChan</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262248">if</span>&nbsp;<span class="ident" id="8262251">write</span>&nbsp;<span class="op" id="8262257">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262261">path</span>&nbsp;<span class="op" id="8262266">:=</span>&nbsp;<span class="ident" id="8262269">test</span><span class="op" id="8262273">.</span><span class="ident" id="8262274">dataPath</span><span class="op" id="8262282">(</span><span class="op" id="8262283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262287">out</span><span class="op" id="8262290">,</span>&nbsp;<span class="ident" id="8262292">err</span>&nbsp;<span class="op" id="8262296">:=</span>&nbsp;<span class="ident" id="8262299">os</span><span class="op" id="8262301">.</span><span class="ident" id="8262302">OpenFile</span><span class="op" id="8262310">(</span><span class="ident" id="8262311">path</span><span class="op" id="8262315">,</span>&nbsp;<span class="ident" id="8262317">os</span><span class="op" id="8262319">.</span><span class="ident" id="8262320">O_WRONLY</span><span class="op" id="8262328">|</span><span class="ident" id="8262329">os</span><span class="op" id="8262331">.</span><span class="ident" id="8262332">O_CREATE</span><span class="op" id="8262340">|</span><span class="ident" id="8262341">os</span><span class="op" id="8262343">.</span><span class="ident" id="8262344">O_TRUNC</span><span class="op" id="8262351">,</span>&nbsp;<span class="num" id="8262353">0644</span><span class="op" id="8262357">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262361">if</span>&nbsp;<span class="ident" id="8262364">err</span>&nbsp;<span class="op" id="8262368">!=</span>&nbsp;<span class="ident" id="8262371">nil</span>&nbsp;<span class="op" id="8262375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262380">t</span><span class="op" id="8262381">.</span><span class="ident" id="8262382">Fatalf</span><span class="op" id="8262388">(</span><span class="string" id="8262389">&#34;Failed&nbsp;to&nbsp;create&nbsp;output&nbsp;file:&nbsp;%s&#34;</span><span class="op" id="8262423">,</span>&nbsp;<span class="ident" id="8262425">err</span><span class="op" id="8262428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262432">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262436">defer</span>&nbsp;<span class="ident" id="8262442">out</span><span class="op" id="8262445">.</span><span class="ident" id="8262446">Close</span><span class="op" id="8262451">(</span><span class="op" id="8262452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262456">recordingConn</span><span class="op" id="8262469">.</span><span class="ident" id="8262470">Close</span><span class="op" id="8262475">(</span><span class="op" id="8262476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8262480">close</span><span class="op" id="8262485">(</span><span class="ident" id="8262486">stdin</span><span class="op" id="8262491">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262495">childProcess</span><span class="op" id="8262507">.</span><span class="ident" id="8262508">Process</span><span class="op" id="8262515">.</span><span class="ident" id="8262516">Kill</span><span class="op" id="8262520">(</span><span class="op" id="8262521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262525">childProcess</span><span class="op" id="8262537">.</span><span class="ident" id="8262538">Wait</span><span class="op" id="8262542">(</span><span class="op" id="8262543">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262547">if</span>&nbsp;<span class="builtinfunc" id="8262550">len</span><span class="op" id="8262553">(</span><span class="ident" id="8262554">recordingConn</span><span class="op" id="8262567">.</span><span class="ident" id="8262568">flows</span><span class="op" id="8262573">)</span>&nbsp;<span class="op" id="8262575">&lt;</span>&nbsp;<span class="num" id="8262577">3</span>&nbsp;<span class="op" id="8262579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262584">childProcess</span><span class="op" id="8262596">.</span><span class="ident" id="8262597">Stdout</span><span class="op" id="8262603">.</span><span class="op" id="8262604">(</span><span class="op" id="8262605">*</span><span class="ident" id="8262606">bytes</span><span class="op" id="8262611">.</span><span class="ident" id="8262612">Buffer</span><span class="op" id="8262618">)</span><span class="op" id="8262619">.</span><span class="ident" id="8262620">WriteTo</span><span class="op" id="8262627">(</span><span class="ident" id="8262628">os</span><span class="op" id="8262630">.</span><span class="ident" id="8262631">Stdout</span><span class="op" id="8262637">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262642">t</span><span class="op" id="8262643">.</span><span class="ident" id="8262644">Fatalf</span><span class="op" id="8262650">(</span><span class="string" id="8262651">&#34;Client&nbsp;connection&nbsp;didn&#39;t&nbsp;work&#34;</span><span class="op" id="8262682">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262690">recordingConn</span><span class="op" id="8262703">.</span><span class="ident" id="8262704">WriteTo</span><span class="op" id="8262711">(</span><span class="ident" id="8262712">out</span><span class="op" id="8262715">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262719">fmt</span><span class="op" id="8262722">.</span><span class="ident" id="8262723">Printf</span><span class="op" id="8262729">(</span><span class="string" id="8262730">&#34;Wrote&nbsp;%s\n&#34;</span><span class="op" id="8262742">,</span>&nbsp;<span class="ident" id="8262744">path</span><span class="op" id="8262748">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262751">}</span><br>
<span class="lineno"></span><span class="op" id="8262753">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8262756">func</span>&nbsp;<span class="ident" id="8262761">runClientTestForVersion</span><span class="op" id="8262784">(</span><span class="ident" id="8262785">t</span>&nbsp;<span class="op" id="8262787">*</span><span class="ident" id="8262788">testing</span><span class="op" id="8262795">.</span><span class="ident" id="8262796">T</span><span class="op" id="8262797">,</span>&nbsp;<span class="ident" id="8262799">template</span>&nbsp;<span class="op" id="8262808">*</span><span class="ident" id="8262809">clientTest</span><span class="op" id="8262819">,</span>&nbsp;<span class="ident" id="8262821">prefix</span><span class="op" id="8262827">,</span>&nbsp;<span class="ident" id="8262829">option</span>&nbsp;<span class="builtintype" id="8262836">string</span><span class="op" id="8262842">)</span>&nbsp;<span class="op" id="8262844">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262847">test</span>&nbsp;<span class="op" id="8262852">:=</span>&nbsp;<span class="op" id="8262855">*</span><span class="ident" id="8262856">template</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262866">test</span><span class="op" id="8262870">.</span><span class="ident" id="8262871">name</span>&nbsp;<span class="op" id="8262876">=</span>&nbsp;<span class="ident" id="8262878">prefix</span>&nbsp;<span class="op" id="8262885">+</span>&nbsp;<span class="ident" id="8262887">test</span><span class="op" id="8262891">.</span><span class="ident" id="8262892">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8262898">if</span>&nbsp;<span class="builtinfunc" id="8262901">len</span><span class="op" id="8262904">(</span><span class="ident" id="8262905">test</span><span class="op" id="8262909">.</span><span class="ident" id="8262910">command</span><span class="op" id="8262917">)</span>&nbsp;<span class="op" id="8262919">==</span>&nbsp;<span class="num" id="8262922">0</span>&nbsp;<span class="op" id="8262924">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262928">test</span><span class="op" id="8262932">.</span><span class="ident" id="8262933">command</span>&nbsp;<span class="op" id="8262941">=</span>&nbsp;<span class="ident" id="8262943">defaultClientCommand</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8262965">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8262968">test</span><span class="op" id="8262972">.</span><span class="ident" id="8262973">command</span>&nbsp;<span class="op" id="8262981">=</span>&nbsp;<span class="builtinfunc" id="8262983">append</span><span class="op" id="8262989">(</span><span class="op" id="8262990">[</span><span class="op" id="8262991">]</span><span class="builtintype" id="8262992">string</span><span class="op" id="8262998">(</span><span class="ident" id="8262999">nil</span><span class="op" id="8263002">)</span><span class="op" id="8263003">,</span>&nbsp;<span class="ident" id="8263005">test</span><span class="op" id="8263009">.</span><span class="ident" id="8263010">command</span><span class="op" id="8263017">...</span><span class="op" id="8263020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263023">test</span><span class="op" id="8263027">.</span><span class="ident" id="8263028">command</span>&nbsp;<span class="op" id="8263036">=</span>&nbsp;<span class="builtinfunc" id="8263038">append</span><span class="op" id="8263044">(</span><span class="ident" id="8263045">test</span><span class="op" id="8263049">.</span><span class="ident" id="8263050">command</span><span class="op" id="8263057">,</span>&nbsp;<span class="ident" id="8263059">option</span><span class="op" id="8263065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263068">test</span><span class="op" id="8263072">.</span><span class="ident" id="8263073">run</span><span class="op" id="8263076">(</span><span class="ident" id="8263077">t</span><span class="op" id="8263078">,</span>&nbsp;<span class="op" id="8263080">*</span><span class="ident" id="8263081">update</span><span class="op" id="8263087">)</span><br>
<span class="lineno"></span><span class="op" id="8263089">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="keyword" id="8263092">func</span>&nbsp;<span class="ident" id="8263097">runClientTestTLS10</span><span class="op" id="8263115">(</span><span class="ident" id="8263116">t</span>&nbsp;<span class="op" id="8263118">*</span><span class="ident" id="8263119">testing</span><span class="op" id="8263126">.</span><span class="ident" id="8263127">T</span><span class="op" id="8263128">,</span>&nbsp;<span class="ident" id="8263130">template</span>&nbsp;<span class="op" id="8263139">*</span><span class="ident" id="8263140">clientTest</span><span class="op" id="8263150">)</span>&nbsp;<span class="op" id="8263152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263155">runClientTestForVersion</span><span class="op" id="8263178">(</span><span class="ident" id="8263179">t</span><span class="op" id="8263180">,</span>&nbsp;<span class="ident" id="8263182">template</span><span class="op" id="8263190">,</span>&nbsp;<span class="string" id="8263192">&#34;TLSv10-&#34;</span><span class="op" id="8263201">,</span>&nbsp;<span class="string" id="8263203">&#34;-tls1&#34;</span><span class="op" id="8263210">)</span><br>
<span class="lineno"></span><span class="op" id="8263212">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263215">func</span>&nbsp;<span class="ident" id="8263220">runClientTestTLS11</span><span class="op" id="8263238">(</span><span class="ident" id="8263239">t</span>&nbsp;<span class="op" id="8263241">*</span><span class="ident" id="8263242">testing</span><span class="op" id="8263249">.</span><span class="ident" id="8263250">T</span><span class="op" id="8263251">,</span>&nbsp;<span class="ident" id="8263253">template</span>&nbsp;<span class="op" id="8263262">*</span><span class="ident" id="8263263">clientTest</span><span class="op" id="8263273">)</span>&nbsp;<span class="op" id="8263275">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263278">runClientTestForVersion</span><span class="op" id="8263301">(</span><span class="ident" id="8263302">t</span><span class="op" id="8263303">,</span>&nbsp;<span class="ident" id="8263305">template</span><span class="op" id="8263313">,</span>&nbsp;<span class="string" id="8263315">&#34;TLSv11-&#34;</span><span class="op" id="8263324">,</span>&nbsp;<span class="string" id="8263326">&#34;-tls1_1&#34;</span><span class="op" id="8263335">)</span><br>
<span class="lineno"></span><span class="op" id="8263337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263340">func</span>&nbsp;<span class="ident" id="8263345">runClientTestTLS12</span><span class="op" id="8263363">(</span><span class="ident" id="8263364">t</span>&nbsp;<span class="op" id="8263366">*</span><span class="ident" id="8263367">testing</span><span class="op" id="8263374">.</span><span class="ident" id="8263375">T</span><span class="op" id="8263376">,</span>&nbsp;<span class="ident" id="8263378">template</span>&nbsp;<span class="op" id="8263387">*</span><span class="ident" id="8263388">clientTest</span><span class="op" id="8263398">)</span>&nbsp;<span class="op" id="8263400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263403">runClientTestForVersion</span><span class="op" id="8263426">(</span><span class="ident" id="8263427">t</span><span class="op" id="8263428">,</span>&nbsp;<span class="ident" id="8263430">template</span><span class="op" id="8263438">,</span>&nbsp;<span class="string" id="8263440">&#34;TLSv12-&#34;</span><span class="op" id="8263449">,</span>&nbsp;<span class="string" id="8263451">&#34;-tls1_2&#34;</span><span class="op" id="8263460">)</span><br>
<span class="lineno">270</span><span class="op" id="8263462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263465">func</span>&nbsp;<span class="ident" id="8263470">TestHandshakeClientRSARC4</span><span class="op" id="8263495">(</span><span class="ident" id="8263496">t</span>&nbsp;<span class="op" id="8263498">*</span><span class="ident" id="8263499">testing</span><span class="op" id="8263506">.</span><span class="ident" id="8263507">T</span><span class="op" id="8263508">)</span>&nbsp;<span class="op" id="8263510">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263513">test</span>&nbsp;<span class="op" id="8263518">:=</span>&nbsp;<span class="op" id="8263521">&amp;</span><span class="ident" id="8263522">clientTest</span><span class="op" id="8263532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263536">name</span><span class="op" id="8263540">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8263545">&#34;RSA-RC4&#34;</span><span class="op" id="8263554">,</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263558">command</span><span class="op" id="8263565">:</span>&nbsp;<span class="op" id="8263567">[</span><span class="op" id="8263568">]</span><span class="builtintype" id="8263569">string</span><span class="op" id="8263575">{</span><span class="string" id="8263576">&#34;openssl&#34;</span><span class="op" id="8263585">,</span>&nbsp;<span class="string" id="8263587">&#34;s_server&#34;</span><span class="op" id="8263597">,</span>&nbsp;<span class="string" id="8263599">&#34;-cipher&#34;</span><span class="op" id="8263608">,</span>&nbsp;<span class="string" id="8263610">&#34;RC4-SHA&#34;</span><span class="op" id="8263619">}</span><span class="op" id="8263620">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263623">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263626">runClientTestTLS10</span><span class="op" id="8263644">(</span><span class="ident" id="8263645">t</span><span class="op" id="8263646">,</span>&nbsp;<span class="ident" id="8263648">test</span><span class="op" id="8263652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263655">runClientTestTLS11</span><span class="op" id="8263673">(</span><span class="ident" id="8263674">t</span><span class="op" id="8263675">,</span>&nbsp;<span class="ident" id="8263677">test</span><span class="op" id="8263681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263684">runClientTestTLS12</span><span class="op" id="8263702">(</span><span class="ident" id="8263703">t</span><span class="op" id="8263704">,</span>&nbsp;<span class="ident" id="8263706">test</span><span class="op" id="8263710">)</span><br>
<span class="lineno">280</span><span class="op" id="8263712">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263715">func</span>&nbsp;<span class="ident" id="8263720">TestHandshakeClientECDHERSAAES</span><span class="op" id="8263750">(</span><span class="ident" id="8263751">t</span>&nbsp;<span class="op" id="8263753">*</span><span class="ident" id="8263754">testing</span><span class="op" id="8263761">.</span><span class="ident" id="8263762">T</span><span class="op" id="8263763">)</span>&nbsp;<span class="op" id="8263765">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263768">test</span>&nbsp;<span class="op" id="8263773">:=</span>&nbsp;<span class="op" id="8263776">&amp;</span><span class="ident" id="8263777">clientTest</span><span class="op" id="8263787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263791">name</span><span class="op" id="8263795">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8263800">&#34;ECDHE-RSA-AES&#34;</span><span class="op" id="8263815">,</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263819">command</span><span class="op" id="8263826">:</span>&nbsp;<span class="op" id="8263828">[</span><span class="op" id="8263829">]</span><span class="builtintype" id="8263830">string</span><span class="op" id="8263836">{</span><span class="string" id="8263837">&#34;openssl&#34;</span><span class="op" id="8263846">,</span>&nbsp;<span class="string" id="8263848">&#34;s_server&#34;</span><span class="op" id="8263858">,</span>&nbsp;<span class="string" id="8263860">&#34;-cipher&#34;</span><span class="op" id="8263869">,</span>&nbsp;<span class="string" id="8263871">&#34;ECDHE-RSA-AES128-SHA&#34;</span><span class="op" id="8263893">}</span><span class="op" id="8263894">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8263897">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263900">runClientTestTLS10</span><span class="op" id="8263918">(</span><span class="ident" id="8263919">t</span><span class="op" id="8263920">,</span>&nbsp;<span class="ident" id="8263922">test</span><span class="op" id="8263926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263929">runClientTestTLS11</span><span class="op" id="8263947">(</span><span class="ident" id="8263948">t</span><span class="op" id="8263949">,</span>&nbsp;<span class="ident" id="8263951">test</span><span class="op" id="8263955">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263958">runClientTestTLS12</span><span class="op" id="8263976">(</span><span class="ident" id="8263977">t</span><span class="op" id="8263978">,</span>&nbsp;<span class="ident" id="8263980">test</span><span class="op" id="8263984">)</span><br>
<span class="lineno">290</span><span class="op" id="8263986">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263989">func</span>&nbsp;<span class="ident" id="8263994">TestHandshakeClientECDHEECDSAAES</span><span class="op" id="8264026">(</span><span class="ident" id="8264027">t</span>&nbsp;<span class="op" id="8264029">*</span><span class="ident" id="8264030">testing</span><span class="op" id="8264037">.</span><span class="ident" id="8264038">T</span><span class="op" id="8264039">)</span>&nbsp;<span class="op" id="8264041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264044">test</span>&nbsp;<span class="op" id="8264049">:=</span>&nbsp;<span class="op" id="8264052">&amp;</span><span class="ident" id="8264053">clientTest</span><span class="op" id="8264063">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264067">name</span><span class="op" id="8264071">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8264076">&#34;ECDHE-ECDSA-AES&#34;</span><span class="op" id="8264093">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264097">command</span><span class="op" id="8264104">:</span>&nbsp;<span class="op" id="8264106">[</span><span class="op" id="8264107">]</span><span class="builtintype" id="8264108">string</span><span class="op" id="8264114">{</span><span class="string" id="8264115">&#34;openssl&#34;</span><span class="op" id="8264124">,</span>&nbsp;<span class="string" id="8264126">&#34;s_server&#34;</span><span class="op" id="8264136">,</span>&nbsp;<span class="string" id="8264138">&#34;-cipher&#34;</span><span class="op" id="8264147">,</span>&nbsp;<span class="string" id="8264149">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8264173">}</span><span class="op" id="8264174">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264178">cert</span><span class="op" id="8264182">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8264187">testECDSACertificate</span><span class="op" id="8264207">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264211">key</span><span class="op" id="8264214">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8264220">testECDSAPrivateKey</span><span class="op" id="8264239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264245">runClientTestTLS10</span><span class="op" id="8264263">(</span><span class="ident" id="8264264">t</span><span class="op" id="8264265">,</span>&nbsp;<span class="ident" id="8264267">test</span><span class="op" id="8264271">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264274">runClientTestTLS11</span><span class="op" id="8264292">(</span><span class="ident" id="8264293">t</span><span class="op" id="8264294">,</span>&nbsp;<span class="ident" id="8264296">test</span><span class="op" id="8264300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264303">runClientTestTLS12</span><span class="op" id="8264321">(</span><span class="ident" id="8264322">t</span><span class="op" id="8264323">,</span>&nbsp;<span class="ident" id="8264325">test</span><span class="op" id="8264329">)</span><br>
<span class="lineno"></span><span class="op" id="8264331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8264334">func</span>&nbsp;<span class="ident" id="8264339">TestHandshakeClientECDHEECDSAAESGCM</span><span class="op" id="8264374">(</span><span class="ident" id="8264375">t</span>&nbsp;<span class="op" id="8264377">*</span><span class="ident" id="8264378">testing</span><span class="op" id="8264385">.</span><span class="ident" id="8264386">T</span><span class="op" id="8264387">)</span>&nbsp;<span class="op" id="8264389">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264392">test</span>&nbsp;<span class="op" id="8264397">:=</span>&nbsp;<span class="op" id="8264400">&amp;</span><span class="ident" id="8264401">clientTest</span><span class="op" id="8264411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264415">name</span><span class="op" id="8264419">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8264424">&#34;ECDHE-ECDSA-AES-GCM&#34;</span><span class="op" id="8264445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264449">command</span><span class="op" id="8264456">:</span>&nbsp;<span class="op" id="8264458">[</span><span class="op" id="8264459">]</span><span class="builtintype" id="8264460">string</span><span class="op" id="8264466">{</span><span class="string" id="8264467">&#34;openssl&#34;</span><span class="op" id="8264476">,</span>&nbsp;<span class="string" id="8264478">&#34;s_server&#34;</span><span class="op" id="8264488">,</span>&nbsp;<span class="string" id="8264490">&#34;-cipher&#34;</span><span class="op" id="8264499">,</span>&nbsp;<span class="string" id="8264501">&#34;ECDHE-ECDSA-AES128-GCM-SHA256&#34;</span><span class="op" id="8264532">}</span><span class="op" id="8264533">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264537">cert</span><span class="op" id="8264541">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8264546">testECDSACertificate</span><span class="op" id="8264566">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264570">key</span><span class="op" id="8264573">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8264579">testECDSAPrivateKey</span><span class="op" id="8264598">,</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264604">runClientTestTLS12</span><span class="op" id="8264622">(</span><span class="ident" id="8264623">t</span><span class="op" id="8264624">,</span>&nbsp;<span class="ident" id="8264626">test</span><span class="op" id="8264630">)</span><br>
<span class="lineno"></span><span class="op" id="8264632">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8264635">func</span>&nbsp;<span class="ident" id="8264640">TestHandshakeClientCertRSA</span><span class="op" id="8264666">(</span><span class="ident" id="8264667">t</span>&nbsp;<span class="op" id="8264669">*</span><span class="ident" id="8264670">testing</span><span class="op" id="8264677">.</span><span class="ident" id="8264678">T</span><span class="op" id="8264679">)</span>&nbsp;<span class="op" id="8264681">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264684">config</span>&nbsp;<span class="op" id="8264691">:=</span>&nbsp;<span class="op" id="8264694">*</span><span class="ident" id="8264695">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264707">cert</span><span class="op" id="8264711">,</span>&nbsp;<span class="ident" id="8264713">_</span>&nbsp;<span class="op" id="8264715">:=</span>&nbsp;<span class="ident" id="8264718">X509KeyPair</span><span class="op" id="8264729">(</span><span class="op" id="8264730">[</span><span class="op" id="8264731">]</span><span class="builtintype" id="8264732">byte</span><span class="op" id="8264736">(</span><span class="ident" id="8264737">clientCertificatePEM</span><span class="op" id="8264757">)</span><span class="op" id="8264758">,</span>&nbsp;<span class="op" id="8264760">[</span><span class="op" id="8264761">]</span><span class="builtintype" id="8264762">byte</span><span class="op" id="8264766">(</span><span class="ident" id="8264767">clientKeyPEM</span><span class="op" id="8264779">)</span><span class="op" id="8264780">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264783">config</span><span class="op" id="8264789">.</span><span class="ident" id="8264790">Certificates</span>&nbsp;<span class="op" id="8264803">=</span>&nbsp;<span class="op" id="8264805">[</span><span class="op" id="8264806">]</span><span class="ident" id="8264807">Certificate</span><span class="op" id="8264818">{</span><span class="ident" id="8264819">cert</span><span class="op" id="8264823">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264827">test</span>&nbsp;<span class="op" id="8264832">:=</span>&nbsp;<span class="op" id="8264835">&amp;</span><span class="ident" id="8264836">clientTest</span><span class="op" id="8264846">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264850">name</span><span class="op" id="8264854">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8264859">&#34;ClientCert-RSA-RSA&#34;</span><span class="op" id="8264879">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264883">command</span><span class="op" id="8264890">:</span>&nbsp;<span class="op" id="8264892">[</span><span class="op" id="8264893">]</span><span class="builtintype" id="8264894">string</span><span class="op" id="8264900">{</span><span class="string" id="8264901">&#34;openssl&#34;</span><span class="op" id="8264910">,</span>&nbsp;<span class="string" id="8264912">&#34;s_server&#34;</span><span class="op" id="8264922">,</span>&nbsp;<span class="string" id="8264924">&#34;-cipher&#34;</span><span class="op" id="8264933">,</span>&nbsp;<span class="string" id="8264935">&#34;RC4-SHA&#34;</span><span class="op" id="8264944">,</span>&nbsp;<span class="string" id="8264946">&#34;-verify&#34;</span><span class="op" id="8264955">,</span>&nbsp;<span class="string" id="8264957">&#34;1&#34;</span><span class="op" id="8264960">}</span><span class="op" id="8264961">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264965">config</span><span class="op" id="8264971">:</span>&nbsp;&nbsp;<span class="op" id="8264974">&amp;</span><span class="ident" id="8264975">config</span><span class="op" id="8264981">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264984">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264988">runClientTestTLS10</span><span class="op" id="8265006">(</span><span class="ident" id="8265007">t</span><span class="op" id="8265008">,</span>&nbsp;<span class="ident" id="8265010">test</span><span class="op" id="8265014">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265017">runClientTestTLS12</span><span class="op" id="8265035">(</span><span class="ident" id="8265036">t</span><span class="op" id="8265037">,</span>&nbsp;<span class="ident" id="8265039">test</span><span class="op" id="8265043">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265047">test</span>&nbsp;<span class="op" id="8265052">=</span>&nbsp;<span class="op" id="8265054">&amp;</span><span class="ident" id="8265055">clientTest</span><span class="op" id="8265065">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265069">name</span><span class="op" id="8265073">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8265078">&#34;ClientCert-RSA-ECDSA&#34;</span><span class="op" id="8265100">,</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265104">command</span><span class="op" id="8265111">:</span>&nbsp;<span class="op" id="8265113">[</span><span class="op" id="8265114">]</span><span class="builtintype" id="8265115">string</span><span class="op" id="8265121">{</span><span class="string" id="8265122">&#34;openssl&#34;</span><span class="op" id="8265131">,</span>&nbsp;<span class="string" id="8265133">&#34;s_server&#34;</span><span class="op" id="8265143">,</span>&nbsp;<span class="string" id="8265145">&#34;-cipher&#34;</span><span class="op" id="8265154">,</span>&nbsp;<span class="string" id="8265156">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8265180">,</span>&nbsp;<span class="string" id="8265182">&#34;-verify&#34;</span><span class="op" id="8265191">,</span>&nbsp;<span class="string" id="8265193">&#34;1&#34;</span><span class="op" id="8265196">}</span><span class="op" id="8265197">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265201">config</span><span class="op" id="8265207">:</span>&nbsp;&nbsp;<span class="op" id="8265210">&amp;</span><span class="ident" id="8265211">config</span><span class="op" id="8265217">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265221">cert</span><span class="op" id="8265225">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8265230">testECDSACertificate</span><span class="op" id="8265250">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265254">key</span><span class="op" id="8265257">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8265263">testECDSAPrivateKey</span><span class="op" id="8265282">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265285">}</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265289">runClientTestTLS10</span><span class="op" id="8265307">(</span><span class="ident" id="8265308">t</span><span class="op" id="8265309">,</span>&nbsp;<span class="ident" id="8265311">test</span><span class="op" id="8265315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265318">runClientTestTLS12</span><span class="op" id="8265336">(</span><span class="ident" id="8265337">t</span><span class="op" id="8265338">,</span>&nbsp;<span class="ident" id="8265340">test</span><span class="op" id="8265344">)</span><br>
<span class="lineno"></span><span class="op" id="8265346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="keyword" id="8265349">func</span>&nbsp;<span class="ident" id="8265354">TestHandshakeClientCertECDSA</span><span class="op" id="8265382">(</span><span class="ident" id="8265383">t</span>&nbsp;<span class="op" id="8265385">*</span><span class="ident" id="8265386">testing</span><span class="op" id="8265393">.</span><span class="ident" id="8265394">T</span><span class="op" id="8265395">)</span>&nbsp;<span class="op" id="8265397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265400">config</span>&nbsp;<span class="op" id="8265407">:=</span>&nbsp;<span class="op" id="8265410">*</span><span class="ident" id="8265411">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265423">cert</span><span class="op" id="8265427">,</span>&nbsp;<span class="ident" id="8265429">_</span>&nbsp;<span class="op" id="8265431">:=</span>&nbsp;<span class="ident" id="8265434">X509KeyPair</span><span class="op" id="8265445">(</span><span class="op" id="8265446">[</span><span class="op" id="8265447">]</span><span class="builtintype" id="8265448">byte</span><span class="op" id="8265452">(</span><span class="ident" id="8265453">clientECDSACertificatePEM</span><span class="op" id="8265478">)</span><span class="op" id="8265479">,</span>&nbsp;<span class="op" id="8265481">[</span><span class="op" id="8265482">]</span><span class="builtintype" id="8265483">byte</span><span class="op" id="8265487">(</span><span class="ident" id="8265488">clientECDSAKeyPEM</span><span class="op" id="8265505">)</span><span class="op" id="8265506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265509">config</span><span class="op" id="8265515">.</span><span class="ident" id="8265516">Certificates</span>&nbsp;<span class="op" id="8265529">=</span>&nbsp;<span class="op" id="8265531">[</span><span class="op" id="8265532">]</span><span class="ident" id="8265533">Certificate</span><span class="op" id="8265544">{</span><span class="ident" id="8265545">cert</span><span class="op" id="8265549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265553">test</span>&nbsp;<span class="op" id="8265558">:=</span>&nbsp;<span class="op" id="8265561">&amp;</span><span class="ident" id="8265562">clientTest</span><span class="op" id="8265572">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265576">name</span><span class="op" id="8265580">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8265585">&#34;ClientCert-ECDSA-RSA&#34;</span><span class="op" id="8265607">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265611">command</span><span class="op" id="8265618">:</span>&nbsp;<span class="op" id="8265620">[</span><span class="op" id="8265621">]</span><span class="builtintype" id="8265622">string</span><span class="op" id="8265628">{</span><span class="string" id="8265629">&#34;openssl&#34;</span><span class="op" id="8265638">,</span>&nbsp;<span class="string" id="8265640">&#34;s_server&#34;</span><span class="op" id="8265650">,</span>&nbsp;<span class="string" id="8265652">&#34;-cipher&#34;</span><span class="op" id="8265661">,</span>&nbsp;<span class="string" id="8265663">&#34;RC4-SHA&#34;</span><span class="op" id="8265672">,</span>&nbsp;<span class="string" id="8265674">&#34;-verify&#34;</span><span class="op" id="8265683">,</span>&nbsp;<span class="string" id="8265685">&#34;1&#34;</span><span class="op" id="8265688">}</span><span class="op" id="8265689">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265693">config</span><span class="op" id="8265699">:</span>&nbsp;&nbsp;<span class="op" id="8265702">&amp;</span><span class="ident" id="8265703">config</span><span class="op" id="8265709">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265712">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265716">runClientTestTLS10</span><span class="op" id="8265734">(</span><span class="ident" id="8265735">t</span><span class="op" id="8265736">,</span>&nbsp;<span class="ident" id="8265738">test</span><span class="op" id="8265742">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265745">runClientTestTLS12</span><span class="op" id="8265763">(</span><span class="ident" id="8265764">t</span><span class="op" id="8265765">,</span>&nbsp;<span class="ident" id="8265767">test</span><span class="op" id="8265771">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265775">test</span>&nbsp;<span class="op" id="8265780">=</span>&nbsp;<span class="op" id="8265782">&amp;</span><span class="ident" id="8265783">clientTest</span><span class="op" id="8265793">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265797">name</span><span class="op" id="8265801">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8265806">&#34;ClientCert-ECDSA-ECDSA&#34;</span><span class="op" id="8265830">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265834">command</span><span class="op" id="8265841">:</span>&nbsp;<span class="op" id="8265843">[</span><span class="op" id="8265844">]</span><span class="builtintype" id="8265845">string</span><span class="op" id="8265851">{</span><span class="string" id="8265852">&#34;openssl&#34;</span><span class="op" id="8265861">,</span>&nbsp;<span class="string" id="8265863">&#34;s_server&#34;</span><span class="op" id="8265873">,</span>&nbsp;<span class="string" id="8265875">&#34;-cipher&#34;</span><span class="op" id="8265884">,</span>&nbsp;<span class="string" id="8265886">&#34;ECDHE-ECDSA-AES128-SHA&#34;</span><span class="op" id="8265910">,</span>&nbsp;<span class="string" id="8265912">&#34;-verify&#34;</span><span class="op" id="8265921">,</span>&nbsp;<span class="string" id="8265923">&#34;1&#34;</span><span class="op" id="8265926">}</span><span class="op" id="8265927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265931">config</span><span class="op" id="8265937">:</span>&nbsp;&nbsp;<span class="op" id="8265940">&amp;</span><span class="ident" id="8265941">config</span><span class="op" id="8265947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265951">cert</span><span class="op" id="8265955">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8265960">testECDSACertificate</span><span class="op" id="8265980">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265984">key</span><span class="op" id="8265987">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8265993">testECDSAPrivateKey</span><span class="op" id="8266012">,</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266015">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266019">runClientTestTLS10</span><span class="op" id="8266037">(</span><span class="ident" id="8266038">t</span><span class="op" id="8266039">,</span>&nbsp;<span class="ident" id="8266041">test</span><span class="op" id="8266045">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266048">runClientTestTLS12</span><span class="op" id="8266066">(</span><span class="ident" id="8266067">t</span><span class="op" id="8266068">,</span>&nbsp;<span class="ident" id="8266070">test</span><span class="op" id="8266074">)</span><br>
<span class="lineno"></span><span class="op" id="8266076">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="8266079">func</span>&nbsp;<span class="ident" id="8266084">TestClientResumption</span><span class="op" id="8266104">(</span><span class="ident" id="8266105">t</span>&nbsp;<span class="op" id="8266107">*</span><span class="ident" id="8266108">testing</span><span class="op" id="8266115">.</span><span class="ident" id="8266116">T</span><span class="op" id="8266117">)</span>&nbsp;<span class="op" id="8266119">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266122">serverConfig</span>&nbsp;<span class="op" id="8266135">:=</span>&nbsp;<span class="op" id="8266138">&amp;</span><span class="ident" id="8266139">Config</span><span class="op" id="8266145">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266149">CipherSuites</span><span class="op" id="8266161">:</span>&nbsp;<span class="op" id="8266163">[</span><span class="op" id="8266164">]</span><span class="builtintype" id="8266165">uint16</span><span class="op" id="8266171">{</span><span class="ident" id="8266172">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8266196">,</span>&nbsp;<span class="ident" id="8266198">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8266228">}</span><span class="op" id="8266229">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266233">Certificates</span><span class="op" id="8266245">:</span>&nbsp;<span class="ident" id="8266247">testConfig</span><span class="op" id="8266257">.</span><span class="ident" id="8266258">Certificates</span><span class="op" id="8266270">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266273">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266276">clientConfig</span>&nbsp;<span class="op" id="8266289">:=</span>&nbsp;<span class="op" id="8266292">&amp;</span><span class="ident" id="8266293">Config</span><span class="op" id="8266299">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266303">CipherSuites</span><span class="op" id="8266315">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8266323">[</span><span class="op" id="8266324">]</span><span class="builtintype" id="8266325">uint16</span><span class="op" id="8266331">{</span><span class="ident" id="8266332">TLS_RSA_WITH_RC4_128_SHA</span><span class="op" id="8266356">}</span><span class="op" id="8266357">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266361">InsecureSkipVerify</span><span class="op" id="8266379">:</span>&nbsp;<span class="builtintype" id="8266381">true</span><span class="op" id="8266385">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266389">ClientSessionCache</span><span class="op" id="8266407">:</span>&nbsp;<span class="ident" id="8266409">NewLRUClientSessionCache</span><span class="op" id="8266433">(</span><span class="num" id="8266434">32</span><span class="op" id="8266436">)</span><span class="op" id="8266437">,</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266444">testResumeState</span>&nbsp;<span class="op" id="8266460">:=</span>&nbsp;<span class="keyword" id="8266463">func</span><span class="op" id="8266467">(</span><span class="ident" id="8266468">test</span>&nbsp;<span class="builtintype" id="8266473">string</span><span class="op" id="8266479">,</span>&nbsp;<span class="ident" id="8266481">didResume</span>&nbsp;<span class="builtintype" id="8266491">bool</span><span class="op" id="8266495">)</span>&nbsp;<span class="op" id="8266497">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266501">hs</span><span class="op" id="8266503">,</span>&nbsp;<span class="ident" id="8266505">err</span>&nbsp;<span class="op" id="8266509">:=</span>&nbsp;<span class="ident" id="8266512">testHandshake</span><span class="op" id="8266525">(</span><span class="ident" id="8266526">clientConfig</span><span class="op" id="8266538">,</span>&nbsp;<span class="ident" id="8266540">serverConfig</span><span class="op" id="8266552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266556">if</span>&nbsp;<span class="ident" id="8266559">err</span>&nbsp;<span class="op" id="8266563">!=</span>&nbsp;<span class="ident" id="8266566">nil</span>&nbsp;<span class="op" id="8266570">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266575">t</span><span class="op" id="8266576">.</span><span class="ident" id="8266577">Fatalf</span><span class="op" id="8266583">(</span><span class="string" id="8266584">&#34;%s:&nbsp;handshake&nbsp;failed:&nbsp;%s&#34;</span><span class="op" id="8266610">,</span>&nbsp;<span class="ident" id="8266612">test</span><span class="op" id="8266616">,</span>&nbsp;<span class="ident" id="8266618">err</span><span class="op" id="8266621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266625">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266629">if</span>&nbsp;<span class="ident" id="8266632">hs</span><span class="op" id="8266634">.</span><span class="ident" id="8266635">DidResume</span>&nbsp;<span class="op" id="8266645">!=</span>&nbsp;<span class="ident" id="8266648">didResume</span>&nbsp;<span class="op" id="8266658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266663">t</span><span class="op" id="8266664">.</span><span class="ident" id="8266665">Fatalf</span><span class="op" id="8266671">(</span><span class="string" id="8266672">&#34;%s&nbsp;resumed:&nbsp;%v,&nbsp;expected:&nbsp;%v&#34;</span><span class="op" id="8266702">,</span>&nbsp;<span class="ident" id="8266704">test</span><span class="op" id="8266708">,</span>&nbsp;<span class="ident" id="8266710">hs</span><span class="op" id="8266712">.</span><span class="ident" id="8266713">DidResume</span><span class="op" id="8266722">,</span>&nbsp;<span class="ident" id="8266724">didResume</span><span class="op" id="8266733">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266737">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266744">testResumeState</span><span class="op" id="8266759">(</span><span class="string" id="8266760">&#34;Handshake&#34;</span><span class="op" id="8266771">,</span>&nbsp;<span class="builtintype" id="8266773">false</span><span class="op" id="8266778">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266781">testResumeState</span><span class="op" id="8266796">(</span><span class="string" id="8266797">&#34;Resume&#34;</span><span class="op" id="8266805">,</span>&nbsp;<span class="builtintype" id="8266807">true</span><span class="op" id="8266811">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8266815">if</span>&nbsp;<span class="ident" id="8266818">_</span><span class="op" id="8266819">,</span>&nbsp;<span class="ident" id="8266821">err</span>&nbsp;<span class="op" id="8266825">:=</span>&nbsp;<span class="ident" id="8266828">io</span><span class="op" id="8266830">.</span><span class="ident" id="8266831">ReadFull</span><span class="op" id="8266839">(</span><span class="ident" id="8266840">serverConfig</span><span class="op" id="8266852">.</span><span class="ident" id="8266853">rand</span><span class="op" id="8266857">(</span><span class="op" id="8266858">)</span><span class="op" id="8266859">,</span>&nbsp;<span class="ident" id="8266861">serverConfig</span><span class="op" id="8266873">.</span><span class="ident" id="8266874">SessionTicketKey</span><span class="op" id="8266890">[</span><span class="op" id="8266891">:</span><span class="op" id="8266892">]</span><span class="op" id="8266893">)</span><span class="op" id="8266894">;</span>&nbsp;<span class="ident" id="8266896">err</span>&nbsp;<span class="op" id="8266900">!=</span>&nbsp;<span class="ident" id="8266903">nil</span>&nbsp;<span class="op" id="8266907">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266911">t</span><span class="op" id="8266912">.</span><span class="ident" id="8266913">Fatalf</span><span class="op" id="8266919">(</span><span class="string" id="8266920">&#34;Failed&nbsp;to&nbsp;invalidate&nbsp;SessionTicketKey&#34;</span><span class="op" id="8266959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8266962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8266965">testResumeState</span><span class="op" id="8266980">(</span><span class="string" id="8266981">&#34;InvalidSessionTicketKey&#34;</span><span class="op" id="8267006">,</span>&nbsp;<span class="builtintype" id="8267008">false</span><span class="op" id="8267013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267016">testResumeState</span><span class="op" id="8267031">(</span><span class="string" id="8267032">&#34;ResumeAfterInvalidSessionTicketKey&#34;</span><span class="op" id="8267068">,</span>&nbsp;<span class="builtintype" id="8267070">true</span><span class="op" id="8267074">)</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267078">clientConfig</span><span class="op" id="8267090">.</span><span class="ident" id="8267091">CipherSuites</span>&nbsp;<span class="op" id="8267104">=</span>&nbsp;<span class="op" id="8267106">[</span><span class="op" id="8267107">]</span><span class="builtintype" id="8267108">uint16</span><span class="op" id="8267114">{</span><span class="ident" id="8267115">TLS_ECDHE_RSA_WITH_RC4_128_SHA</span><span class="op" id="8267145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267148">testResumeState</span><span class="op" id="8267163">(</span><span class="string" id="8267164">&#34;DifferentCipherSuite&#34;</span><span class="op" id="8267186">,</span>&nbsp;<span class="builtintype" id="8267188">false</span><span class="op" id="8267193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267196">testResumeState</span><span class="op" id="8267211">(</span><span class="string" id="8267212">&#34;DifferentCipherSuiteRecovers&#34;</span><span class="op" id="8267242">,</span>&nbsp;<span class="builtintype" id="8267244">true</span><span class="op" id="8267248">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267252">clientConfig</span><span class="op" id="8267264">.</span><span class="ident" id="8267265">ClientSessionCache</span>&nbsp;<span class="op" id="8267284">=</span>&nbsp;<span class="ident" id="8267286">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267291">testResumeState</span><span class="op" id="8267306">(</span><span class="string" id="8267307">&#34;WithoutSessionCache&#34;</span><span class="op" id="8267328">,</span>&nbsp;<span class="builtintype" id="8267330">false</span><span class="op" id="8267335">)</span><br>
<span class="lineno"></span><span class="op" id="8267337">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8267340">func</span>&nbsp;<span class="ident" id="8267345">TestLRUClientSessionCache</span><span class="op" id="8267370">(</span><span class="ident" id="8267371">t</span>&nbsp;<span class="op" id="8267373">*</span><span class="ident" id="8267374">testing</span><span class="op" id="8267381">.</span><span class="ident" id="8267382">T</span><span class="op" id="8267383">)</span>&nbsp;<span class="op" id="8267385">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8267388">//&nbsp;Initialize&nbsp;cache&nbsp;of&nbsp;capacity&nbsp;4.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267424">cache</span>&nbsp;<span class="op" id="8267430">:=</span>&nbsp;<span class="ident" id="8267433">NewLRUClientSessionCache</span><span class="op" id="8267457">(</span><span class="num" id="8267458">4</span><span class="op" id="8267459">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267462">cs</span>&nbsp;<span class="op" id="8267465">:=</span>&nbsp;<span class="builtinfunc" id="8267468">make</span><span class="op" id="8267472">(</span><span class="op" id="8267473">[</span><span class="op" id="8267474">]</span><span class="ident" id="8267475">ClientSessionState</span><span class="op" id="8267493">,</span>&nbsp;<span class="num" id="8267495">6</span><span class="op" id="8267496">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267499">keys</span>&nbsp;<span class="op" id="8267504">:=</span>&nbsp;<span class="op" id="8267507">[</span><span class="op" id="8267508">]</span><span class="builtintype" id="8267509">string</span><span class="op" id="8267515">{</span><span class="string" id="8267516">&#34;0&#34;</span><span class="op" id="8267519">,</span>&nbsp;<span class="string" id="8267521">&#34;1&#34;</span><span class="op" id="8267524">,</span>&nbsp;<span class="string" id="8267526">&#34;2&#34;</span><span class="op" id="8267529">,</span>&nbsp;<span class="string" id="8267531">&#34;3&#34;</span><span class="op" id="8267534">,</span>&nbsp;<span class="string" id="8267536">&#34;4&#34;</span><span class="op" id="8267539">,</span>&nbsp;<span class="string" id="8267541">&#34;5&#34;</span><span class="op" id="8267544">,</span>&nbsp;<span class="string" id="8267546">&#34;6&#34;</span><span class="op" id="8267549">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8267553">//&nbsp;Add&nbsp;4&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache&nbsp;and&nbsp;look&nbsp;them&nbsp;up.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267602">for</span>&nbsp;<span class="ident" id="8267606">i</span>&nbsp;<span class="op" id="8267608">:=</span>&nbsp;<span class="num" id="8267611">0</span><span class="op" id="8267612">;</span>&nbsp;<span class="ident" id="8267614">i</span>&nbsp;<span class="op" id="8267616">&lt;</span>&nbsp;<span class="num" id="8267618">4</span><span class="op" id="8267619">;</span>&nbsp;<span class="ident" id="8267621">i</span><span class="op" id="8267622">++</span>&nbsp;<span class="op" id="8267625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267629">cache</span><span class="op" id="8267634">.</span><span class="ident" id="8267635">Put</span><span class="op" id="8267638">(</span><span class="ident" id="8267639">keys</span><span class="op" id="8267643">[</span><span class="ident" id="8267644">i</span><span class="op" id="8267645">]</span><span class="op" id="8267646">,</span>&nbsp;<span class="op" id="8267648">&amp;</span><span class="ident" id="8267649">cs</span><span class="op" id="8267651">[</span><span class="ident" id="8267652">i</span><span class="op" id="8267653">]</span><span class="op" id="8267654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267660">for</span>&nbsp;<span class="ident" id="8267664">i</span>&nbsp;<span class="op" id="8267666">:=</span>&nbsp;<span class="num" id="8267669">0</span><span class="op" id="8267670">;</span>&nbsp;<span class="ident" id="8267672">i</span>&nbsp;<span class="op" id="8267674">&lt;</span>&nbsp;<span class="num" id="8267676">4</span><span class="op" id="8267677">;</span>&nbsp;<span class="ident" id="8267679">i</span><span class="op" id="8267680">++</span>&nbsp;<span class="op" id="8267683">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267687">if</span>&nbsp;<span class="ident" id="8267690">s</span><span class="op" id="8267691">,</span>&nbsp;<span class="ident" id="8267693">ok</span>&nbsp;<span class="op" id="8267696">:=</span>&nbsp;<span class="ident" id="8267699">cache</span><span class="op" id="8267704">.</span><span class="ident" id="8267705">Get</span><span class="op" id="8267708">(</span><span class="ident" id="8267709">keys</span><span class="op" id="8267713">[</span><span class="ident" id="8267714">i</span><span class="op" id="8267715">]</span><span class="op" id="8267716">)</span><span class="op" id="8267717">;</span>&nbsp;<span class="op" id="8267719">!</span><span class="ident" id="8267720">ok</span>&nbsp;<span class="op" id="8267723">||</span>&nbsp;<span class="ident" id="8267726">s</span>&nbsp;<span class="op" id="8267728">!=</span>&nbsp;<span class="op" id="8267731">&amp;</span><span class="ident" id="8267732">cs</span><span class="op" id="8267734">[</span><span class="ident" id="8267735">i</span><span class="op" id="8267736">]</span>&nbsp;<span class="op" id="8267738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267743">t</span><span class="op" id="8267744">.</span><span class="ident" id="8267745">Fatalf</span><span class="op" id="8267751">(</span><span class="string" id="8267752">&#34;session&nbsp;cache&nbsp;failed&nbsp;lookup&nbsp;for&nbsp;added&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8267799">,</span>&nbsp;<span class="ident" id="8267801">keys</span><span class="op" id="8267805">[</span><span class="ident" id="8267806">i</span><span class="op" id="8267807">]</span><span class="op" id="8267808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8267819">//&nbsp;Add&nbsp;2&nbsp;more&nbsp;entries&nbsp;to&nbsp;the&nbsp;cache.&nbsp;First&nbsp;2&nbsp;should&nbsp;be&nbsp;evicted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267883">for</span>&nbsp;<span class="ident" id="8267887">i</span>&nbsp;<span class="op" id="8267889">:=</span>&nbsp;<span class="num" id="8267892">4</span><span class="op" id="8267893">;</span>&nbsp;<span class="ident" id="8267895">i</span>&nbsp;<span class="op" id="8267897">&lt;</span>&nbsp;<span class="num" id="8267899">6</span><span class="op" id="8267900">;</span>&nbsp;<span class="ident" id="8267902">i</span><span class="op" id="8267903">++</span>&nbsp;<span class="op" id="8267906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8267910">cache</span><span class="op" id="8267915">.</span><span class="ident" id="8267916">Put</span><span class="op" id="8267919">(</span><span class="ident" id="8267920">keys</span><span class="op" id="8267924">[</span><span class="ident" id="8267925">i</span><span class="op" id="8267926">]</span><span class="op" id="8267927">,</span>&nbsp;<span class="op" id="8267929">&amp;</span><span class="ident" id="8267930">cs</span><span class="op" id="8267932">[</span><span class="ident" id="8267933">i</span><span class="op" id="8267934">]</span><span class="op" id="8267935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8267938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267941">for</span>&nbsp;<span class="ident" id="8267945">i</span>&nbsp;<span class="op" id="8267947">:=</span>&nbsp;<span class="num" id="8267950">0</span><span class="op" id="8267951">;</span>&nbsp;<span class="ident" id="8267953">i</span>&nbsp;<span class="op" id="8267955">&lt;</span>&nbsp;<span class="num" id="8267957">2</span><span class="op" id="8267958">;</span>&nbsp;<span class="ident" id="8267960">i</span><span class="op" id="8267961">++</span>&nbsp;<span class="op" id="8267964">{</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8267968">if</span>&nbsp;<span class="ident" id="8267971">s</span><span class="op" id="8267972">,</span>&nbsp;<span class="ident" id="8267974">ok</span>&nbsp;<span class="op" id="8267977">:=</span>&nbsp;<span class="ident" id="8267980">cache</span><span class="op" id="8267985">.</span><span class="ident" id="8267986">Get</span><span class="op" id="8267989">(</span><span class="ident" id="8267990">keys</span><span class="op" id="8267994">[</span><span class="ident" id="8267995">i</span><span class="op" id="8267996">]</span><span class="op" id="8267997">)</span><span class="op" id="8267998">;</span>&nbsp;<span class="ident" id="8268000">ok</span>&nbsp;<span class="op" id="8268003">||</span>&nbsp;<span class="ident" id="8268006">s</span>&nbsp;<span class="op" id="8268008">!=</span>&nbsp;<span class="ident" id="8268011">nil</span>&nbsp;<span class="op" id="8268015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268020">t</span><span class="op" id="8268021">.</span><span class="ident" id="8268022">Fatalf</span><span class="op" id="8268028">(</span><span class="string" id="8268029">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key:&nbsp;%s&#34;</span><span class="op" id="8268072">,</span>&nbsp;<span class="ident" id="8268074">keys</span><span class="op" id="8268078">[</span><span class="ident" id="8268079">i</span><span class="op" id="8268080">]</span><span class="op" id="8268081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268088">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268092">//&nbsp;Touch&nbsp;entry&nbsp;2.&nbsp;LRU&nbsp;should&nbsp;evict&nbsp;3&nbsp;next.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268136">cache</span><span class="op" id="8268141">.</span><span class="ident" id="8268142">Get</span><span class="op" id="8268145">(</span><span class="ident" id="8268146">keys</span><span class="op" id="8268150">[</span><span class="num" id="8268151">2</span><span class="op" id="8268152">]</span><span class="op" id="8268153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268156">cache</span><span class="op" id="8268161">.</span><span class="ident" id="8268162">Put</span><span class="op" id="8268165">(</span><span class="ident" id="8268166">keys</span><span class="op" id="8268170">[</span><span class="num" id="8268171">0</span><span class="op" id="8268172">]</span><span class="op" id="8268173">,</span>&nbsp;<span class="op" id="8268175">&amp;</span><span class="ident" id="8268176">cs</span><span class="op" id="8268178">[</span><span class="num" id="8268179">0</span><span class="op" id="8268180">]</span><span class="op" id="8268181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268184">if</span>&nbsp;<span class="ident" id="8268187">s</span><span class="op" id="8268188">,</span>&nbsp;<span class="ident" id="8268190">ok</span>&nbsp;<span class="op" id="8268193">:=</span>&nbsp;<span class="ident" id="8268196">cache</span><span class="op" id="8268201">.</span><span class="ident" id="8268202">Get</span><span class="op" id="8268205">(</span><span class="ident" id="8268206">keys</span><span class="op" id="8268210">[</span><span class="num" id="8268211">3</span><span class="op" id="8268212">]</span><span class="op" id="8268213">)</span><span class="op" id="8268214">;</span>&nbsp;<span class="ident" id="8268216">ok</span>&nbsp;<span class="op" id="8268219">||</span>&nbsp;<span class="ident" id="8268222">s</span>&nbsp;<span class="op" id="8268224">!=</span>&nbsp;<span class="ident" id="8268227">nil</span>&nbsp;<span class="op" id="8268231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268235">t</span><span class="op" id="8268236">.</span><span class="ident" id="8268237">Fatalf</span><span class="op" id="8268243">(</span><span class="string" id="8268244">&#34;session&nbsp;cache&nbsp;should&nbsp;have&nbsp;evicted&nbsp;key&nbsp;3&#34;</span><span class="op" id="8268285">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268288">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268292">//&nbsp;Update&nbsp;entry&nbsp;0&nbsp;in&nbsp;place.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268321">cache</span><span class="op" id="8268326">.</span><span class="ident" id="8268327">Put</span><span class="op" id="8268330">(</span><span class="ident" id="8268331">keys</span><span class="op" id="8268335">[</span><span class="num" id="8268336">0</span><span class="op" id="8268337">]</span><span class="op" id="8268338">,</span>&nbsp;<span class="op" id="8268340">&amp;</span><span class="ident" id="8268341">cs</span><span class="op" id="8268343">[</span><span class="num" id="8268344">3</span><span class="op" id="8268345">]</span><span class="op" id="8268346">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268349">if</span>&nbsp;<span class="ident" id="8268352">s</span><span class="op" id="8268353">,</span>&nbsp;<span class="ident" id="8268355">ok</span>&nbsp;<span class="op" id="8268358">:=</span>&nbsp;<span class="ident" id="8268361">cache</span><span class="op" id="8268366">.</span><span class="ident" id="8268367">Get</span><span class="op" id="8268370">(</span><span class="ident" id="8268371">keys</span><span class="op" id="8268375">[</span><span class="num" id="8268376">0</span><span class="op" id="8268377">]</span><span class="op" id="8268378">)</span><span class="op" id="8268379">;</span>&nbsp;<span class="op" id="8268381">!</span><span class="ident" id="8268382">ok</span>&nbsp;<span class="op" id="8268385">||</span>&nbsp;<span class="ident" id="8268388">s</span>&nbsp;<span class="op" id="8268390">!=</span>&nbsp;<span class="op" id="8268393">&amp;</span><span class="ident" id="8268394">cs</span><span class="op" id="8268396">[</span><span class="num" id="8268397">3</span><span class="op" id="8268398">]</span>&nbsp;<span class="op" id="8268400">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268404">t</span><span class="op" id="8268405">.</span><span class="ident" id="8268406">Fatalf</span><span class="op" id="8268412">(</span><span class="string" id="8268413">&#34;session&nbsp;cache&nbsp;failed&nbsp;update&nbsp;for&nbsp;key&nbsp;0&#34;</span><span class="op" id="8268452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268455">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268459">//&nbsp;Adding&nbsp;a&nbsp;nil&nbsp;entry&nbsp;is&nbsp;valid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268492">cache</span><span class="op" id="8268497">.</span><span class="ident" id="8268498">Put</span><span class="op" id="8268501">(</span><span class="ident" id="8268502">keys</span><span class="op" id="8268506">[</span><span class="num" id="8268507">0</span><span class="op" id="8268508">]</span><span class="op" id="8268509">,</span>&nbsp;<span class="ident" id="8268511">nil</span><span class="op" id="8268514">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8268517">if</span>&nbsp;<span class="ident" id="8268520">s</span><span class="op" id="8268521">,</span>&nbsp;<span class="ident" id="8268523">ok</span>&nbsp;<span class="op" id="8268526">:=</span>&nbsp;<span class="ident" id="8268529">cache</span><span class="op" id="8268534">.</span><span class="ident" id="8268535">Get</span><span class="op" id="8268538">(</span><span class="ident" id="8268539">keys</span><span class="op" id="8268543">[</span><span class="num" id="8268544">0</span><span class="op" id="8268545">]</span><span class="op" id="8268546">)</span><span class="op" id="8268547">;</span>&nbsp;<span class="op" id="8268549">!</span><span class="ident" id="8268550">ok</span>&nbsp;<span class="op" id="8268553">||</span>&nbsp;<span class="ident" id="8268556">s</span>&nbsp;<span class="op" id="8268558">!=</span>&nbsp;<span class="ident" id="8268561">nil</span>&nbsp;<span class="op" id="8268565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268569">t</span><span class="op" id="8268570">.</span><span class="ident" id="8268571">Fatalf</span><span class="op" id="8268577">(</span><span class="string" id="8268578">&#34;failed&nbsp;to&nbsp;add&nbsp;nil&nbsp;entry&nbsp;to&nbsp;cache&#34;</span><span class="op" id="8268612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8268615">}</span><br>
<span class="lineno"></span><span class="op" id="8268617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="8268620">func</span>&nbsp;<span class="ident" id="8268625">TestHandshakeClientALPNMatch</span><span class="op" id="8268653">(</span><span class="ident" id="8268654">t</span>&nbsp;<span class="op" id="8268656">*</span><span class="ident" id="8268657">testing</span><span class="op" id="8268664">.</span><span class="ident" id="8268665">T</span><span class="op" id="8268666">)</span>&nbsp;<span class="op" id="8268668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268671">config</span>&nbsp;<span class="op" id="8268678">:=</span>&nbsp;<span class="op" id="8268681">*</span><span class="ident" id="8268682">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268694">config</span><span class="op" id="8268700">.</span><span class="ident" id="8268701">NextProtos</span>&nbsp;<span class="op" id="8268712">=</span>&nbsp;<span class="op" id="8268714">[</span><span class="op" id="8268715">]</span><span class="builtintype" id="8268716">string</span><span class="op" id="8268722">{</span><span class="string" id="8268723">&#34;proto2&#34;</span><span class="op" id="8268731">,</span>&nbsp;<span class="string" id="8268733">&#34;proto1&#34;</span><span class="op" id="8268741">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268745">test</span>&nbsp;<span class="op" id="8268750">:=</span>&nbsp;<span class="op" id="8268753">&amp;</span><span class="ident" id="8268754">clientTest</span><span class="op" id="8268764">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268768">name</span><span class="op" id="8268772">:</span>&nbsp;<span class="string" id="8268774">&#34;ALPN&#34;</span><span class="op" id="8268780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268784">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8268850">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268893">command</span><span class="op" id="8268900">:</span>&nbsp;<span class="op" id="8268902">[</span><span class="op" id="8268903">]</span><span class="builtintype" id="8268904">string</span><span class="op" id="8268910">{</span><span class="string" id="8268911">&#34;openssl&#34;</span><span class="op" id="8268920">,</span>&nbsp;<span class="string" id="8268922">&#34;s_server&#34;</span><span class="op" id="8268932">,</span>&nbsp;<span class="string" id="8268934">&#34;-alpn&#34;</span><span class="op" id="8268941">,</span>&nbsp;<span class="string" id="8268943">&#34;proto1,proto2&#34;</span><span class="op" id="8268958">}</span><span class="op" id="8268959">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268963">config</span><span class="op" id="8268969">:</span>&nbsp;&nbsp;<span class="op" id="8268972">&amp;</span><span class="ident" id="8268973">config</span><span class="op" id="8268979">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8268983">validate</span><span class="op" id="8268991">:</span>&nbsp;<span class="keyword" id="8268993">func</span><span class="op" id="8268997">(</span><span class="ident" id="8268998">state</span>&nbsp;<span class="ident" id="8269004">ConnectionState</span><span class="op" id="8269019">)</span>&nbsp;<span class="builtintype" id="8269021">error</span>&nbsp;<span class="op" id="8269027">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8269032">//&nbsp;The&nbsp;server&#39;s&nbsp;preferences&nbsp;should&nbsp;override&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269091">if</span>&nbsp;<span class="ident" id="8269094">state</span><span class="op" id="8269099">.</span><span class="ident" id="8269100">NegotiatedProtocol</span>&nbsp;<span class="op" id="8269119">!=</span>&nbsp;<span class="string" id="8269122">&#34;proto1&#34;</span>&nbsp;<span class="op" id="8269131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269137">return</span>&nbsp;<span class="ident" id="8269144">fmt</span><span class="op" id="8269147">.</span><span class="ident" id="8269148">Errorf</span><span class="op" id="8269154">(</span><span class="string" id="8269155">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;proto1&#34;</span><span class="op" id="8269187">,</span>&nbsp;<span class="ident" id="8269189">state</span><span class="op" id="8269194">.</span><span class="ident" id="8269195">NegotiatedProtocol</span><span class="op" id="8269213">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269218">}</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269223">return</span>&nbsp;<span class="ident" id="8269230">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269236">}</span><span class="op" id="8269237">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269243">runClientTestTLS12</span><span class="op" id="8269261">(</span><span class="ident" id="8269262">t</span><span class="op" id="8269263">,</span>&nbsp;<span class="ident" id="8269265">test</span><span class="op" id="8269269">)</span><br>
<span class="lineno"></span><span class="op" id="8269271">}</span><br>
<span class="lineno">470</span><br>
<span class="lineno"></span><span class="keyword" id="8269274">func</span>&nbsp;<span class="ident" id="8269279">TestHandshakeClientALPNNoMatch</span><span class="op" id="8269309">(</span><span class="ident" id="8269310">t</span>&nbsp;<span class="op" id="8269312">*</span><span class="ident" id="8269313">testing</span><span class="op" id="8269320">.</span><span class="ident" id="8269321">T</span><span class="op" id="8269322">)</span>&nbsp;<span class="op" id="8269324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269327">config</span>&nbsp;<span class="op" id="8269334">:=</span>&nbsp;<span class="op" id="8269337">*</span><span class="ident" id="8269338">testConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269350">config</span><span class="op" id="8269356">.</span><span class="ident" id="8269357">NextProtos</span>&nbsp;<span class="op" id="8269368">=</span>&nbsp;<span class="op" id="8269370">[</span><span class="op" id="8269371">]</span><span class="builtintype" id="8269372">string</span><span class="op" id="8269378">{</span><span class="string" id="8269379">&#34;proto3&#34;</span><span class="op" id="8269387">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269391">test</span>&nbsp;<span class="op" id="8269396">:=</span>&nbsp;<span class="op" id="8269399">&amp;</span><span class="ident" id="8269400">clientTest</span><span class="op" id="8269410">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269414">name</span><span class="op" id="8269418">:</span>&nbsp;<span class="string" id="8269420">&#34;ALPN-NoMatch&#34;</span><span class="op" id="8269434">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8269438">//&nbsp;Note&nbsp;that&nbsp;this&nbsp;needs&nbsp;OpenSSL&nbsp;1.0.2&nbsp;because&nbsp;that&nbsp;is&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8269504">//&nbsp;version&nbsp;that&nbsp;supports&nbsp;the&nbsp;-alpn&nbsp;flag.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269547">command</span><span class="op" id="8269554">:</span>&nbsp;<span class="op" id="8269556">[</span><span class="op" id="8269557">]</span><span class="builtintype" id="8269558">string</span><span class="op" id="8269564">{</span><span class="string" id="8269565">&#34;openssl&#34;</span><span class="op" id="8269574">,</span>&nbsp;<span class="string" id="8269576">&#34;s_server&#34;</span><span class="op" id="8269586">,</span>&nbsp;<span class="string" id="8269588">&#34;-alpn&#34;</span><span class="op" id="8269595">,</span>&nbsp;<span class="string" id="8269597">&#34;proto1,proto2&#34;</span><span class="op" id="8269612">}</span><span class="op" id="8269613">,</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269617">config</span><span class="op" id="8269623">:</span>&nbsp;&nbsp;<span class="op" id="8269626">&amp;</span><span class="ident" id="8269627">config</span><span class="op" id="8269633">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269637">validate</span><span class="op" id="8269645">:</span>&nbsp;<span class="keyword" id="8269647">func</span><span class="op" id="8269651">(</span><span class="ident" id="8269652">state</span>&nbsp;<span class="ident" id="8269658">ConnectionState</span><span class="op" id="8269673">)</span>&nbsp;<span class="builtintype" id="8269675">error</span>&nbsp;<span class="op" id="8269681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8269686">//&nbsp;There&#39;s&nbsp;no&nbsp;overlap&nbsp;so&nbsp;OpenSSL&nbsp;will&nbsp;not&nbsp;select&nbsp;a&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269750">if</span>&nbsp;<span class="ident" id="8269753">state</span><span class="op" id="8269758">.</span><span class="ident" id="8269759">NegotiatedProtocol</span>&nbsp;<span class="op" id="8269778">!=</span>&nbsp;<span class="string" id="8269781">&#34;&#34;</span>&nbsp;<span class="op" id="8269784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269790">return</span>&nbsp;<span class="ident" id="8269797">fmt</span><span class="op" id="8269800">.</span><span class="ident" id="8269801">Errorf</span><span class="op" id="8269807">(</span><span class="string" id="8269808">&#34;Got&nbsp;protocol&nbsp;%q,&nbsp;wanted&nbsp;&#39;&#39;&#34;</span><span class="op" id="8269836">,</span>&nbsp;<span class="ident" id="8269838">state</span><span class="op" id="8269843">.</span><span class="ident" id="8269844">NegotiatedProtocol</span><span class="op" id="8269862">)</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8269872">return</span>&nbsp;<span class="ident" id="8269879">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269885">}</span><span class="op" id="8269886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8269889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8269892">runClientTestTLS12</span><span class="op" id="8269910">(</span><span class="ident" id="8269911">t</span><span class="op" id="8269912">,</span>&nbsp;<span class="ident" id="8269914">test</span><span class="op" id="8269918">)</span><br>
<span class="lineno">490</span><span class="op" id="8269920">}</span>
</div>
</body>
</html>
