<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4355267">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4355322">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4355376">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4355427">package</span>&nbsp;<span class="ident" id="4355435">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4355440">import</span>&nbsp;<span class="op" id="4355447">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355450">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355459">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355475">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355485">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355491">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355498">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355505">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4355517">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="4355524">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4355527">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="4355590">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="4355632">type</span>&nbsp;<span class="ident" id="4355637">ServerError</span>&nbsp;<span class="builtintype" id="4355649">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4355657">func</span>&nbsp;<span class="op" id="4355662">(</span><span class="ident" id="4355663">e</span>&nbsp;<span class="ident" id="4355665">ServerError</span><span class="op" id="4355676">)</span>&nbsp;<span class="ident" id="4355678">Error</span><span class="op" id="4355683">(</span><span class="op" id="4355684">)</span>&nbsp;<span class="builtintype" id="4355686">string</span>&nbsp;<span class="op" id="4355693">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4355696">return</span>&nbsp;<span class="builtintype" id="4355703">string</span><span class="op" id="4355709">(</span><span class="ident" id="4355710">e</span><span class="op" id="4355711">)</span><br>
<span class="lineno"></span><span class="op" id="4355713">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="4355716">var</span>&nbsp;<span class="ident" id="4355720">ErrShutdown</span>&nbsp;<span class="op" id="4355732">=</span>&nbsp;<span class="ident" id="4355734">errors</span><span class="op" id="4355740">.</span><span class="ident" id="4355741">New</span><span class="op" id="4355744">(</span><span class="string" id="4355745">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="4355770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4355773">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="4355807">type</span>&nbsp;<span class="ident" id="4355812">Call</span>&nbsp;<span class="keyword" id="4355817">struct</span>&nbsp;<span class="op" id="4355824">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355827">ServiceMethod</span>&nbsp;<span class="builtintype" id="4355841">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4355853">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355901">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355915">interface</span><span class="op" id="4355924">{</span><span class="op" id="4355925">}</span>&nbsp;<span class="comment" id="4355927">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4355971">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4355985">interface</span><span class="op" id="4355994">{</span><span class="op" id="4355995">}</span>&nbsp;<span class="comment" id="4355997">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356040">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4356054">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4356066">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356106">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4356120">chan</span>&nbsp;<span class="op" id="4356125">*</span><span class="ident" id="4356126">Call</span>&nbsp;&nbsp;<span class="comment" id="4356132">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="4356166">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4356169">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="4356205">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="4356259">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="4356312">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="4356351">type</span>&nbsp;<span class="ident" id="4356356">Client</span>&nbsp;<span class="keyword" id="4356363">struct</span>&nbsp;<span class="op" id="4356370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356373">codec</span>&nbsp;<span class="ident" id="4356379">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356393">reqMutex</span>&nbsp;<span class="ident" id="4356402">sync</span><span class="op" id="4356406">.</span><span class="ident" id="4356407">Mutex</span>&nbsp;<span class="comment" id="4356413">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356436">request</span>&nbsp;&nbsp;<span class="ident" id="4356445">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356455">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356464">sync</span><span class="op" id="4356468">.</span><span class="ident" id="4356469">Mutex</span>&nbsp;<span class="comment" id="4356475">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356498">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4356507">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356515">pending</span>&nbsp;&nbsp;<span class="keyword" id="4356524">map</span><span class="op" id="4356527">[</span><span class="ident" id="4356528">uint64</span><span class="op" id="4356534">]</span><span class="op" id="4356535">*</span><span class="ident" id="4356536">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356542">closing</span>&nbsp;&nbsp;<span class="builtintype" id="4356551">bool</span>&nbsp;<span class="comment" id="4356556">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4356582">shutdown</span>&nbsp;<span class="builtintype" id="4356591">bool</span>&nbsp;<span class="comment" id="4356596">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="4356626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4356629">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="4356685">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="4356752">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="4356822">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="4356884">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4356953">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="4357010">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="4357076">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="4357090">type</span>&nbsp;<span class="ident" id="4357095">ClientCodec</span>&nbsp;<span class="keyword" id="4357107">interface</span>&nbsp;<span class="op" id="4357117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357120">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357193">WriteRequest</span><span class="op" id="4357205">(</span><span class="op" id="4357206">*</span><span class="ident" id="4357207">Request</span><span class="op" id="4357214">,</span>&nbsp;<span class="keyword" id="4357216">interface</span><span class="op" id="4357225">{</span><span class="op" id="4357226">}</span><span class="op" id="4357227">)</span>&nbsp;<span class="builtintype" id="4357229">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357236">ReadResponseHeader</span><span class="op" id="4357254">(</span><span class="op" id="4357255">*</span><span class="ident" id="4357256">Response</span><span class="op" id="4357264">)</span>&nbsp;<span class="builtintype" id="4357266">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357273">ReadResponseBody</span><span class="op" id="4357289">(</span><span class="keyword" id="4357290">interface</span><span class="op" id="4357299">{</span><span class="op" id="4357300">}</span><span class="op" id="4357301">)</span>&nbsp;<span class="builtintype" id="4357303">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357311">Close</span><span class="op" id="4357316">(</span><span class="op" id="4357317">)</span>&nbsp;<span class="builtintype" id="4357319">error</span><br>
<span class="lineno"></span><span class="op" id="4357325">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="4357328">func</span>&nbsp;<span class="op" id="4357333">(</span><span class="ident" id="4357334">client</span>&nbsp;<span class="op" id="4357341">*</span><span class="ident" id="4357342">Client</span><span class="op" id="4357348">)</span>&nbsp;<span class="ident" id="4357350">send</span><span class="op" id="4357354">(</span><span class="ident" id="4357355">call</span>&nbsp;<span class="op" id="4357360">*</span><span class="ident" id="4357361">Call</span><span class="op" id="4357365">)</span>&nbsp;<span class="op" id="4357367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357370">client</span><span class="op" id="4357376">.</span><span class="ident" id="4357377">reqMutex</span><span class="op" id="4357385">.</span><span class="ident" id="4357386">Lock</span><span class="op" id="4357390">(</span><span class="op" id="4357391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357394">defer</span>&nbsp;<span class="ident" id="4357400">client</span><span class="op" id="4357406">.</span><span class="ident" id="4357407">reqMutex</span><span class="op" id="4357415">.</span><span class="ident" id="4357416">Unlock</span><span class="op" id="4357422">(</span><span class="op" id="4357423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357427">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357451">client</span><span class="op" id="4357457">.</span><span class="ident" id="4357458">mutex</span><span class="op" id="4357463">.</span><span class="ident" id="4357464">Lock</span><span class="op" id="4357468">(</span><span class="op" id="4357469">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357472">if</span>&nbsp;<span class="ident" id="4357475">client</span><span class="op" id="4357481">.</span><span class="ident" id="4357482">shutdown</span>&nbsp;<span class="op" id="4357491">||</span>&nbsp;<span class="ident" id="4357494">client</span><span class="op" id="4357500">.</span><span class="ident" id="4357501">closing</span>&nbsp;<span class="op" id="4357509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357513">call</span><span class="op" id="4357517">.</span><span class="ident" id="4357518">Error</span>&nbsp;<span class="op" id="4357524">=</span>&nbsp;<span class="ident" id="4357526">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357540">client</span><span class="op" id="4357546">.</span><span class="ident" id="4357547">mutex</span><span class="op" id="4357552">.</span><span class="ident" id="4357553">Unlock</span><span class="op" id="4357559">(</span><span class="op" id="4357560">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357564">call</span><span class="op" id="4357568">.</span><span class="ident" id="4357569">done</span><span class="op" id="4357573">(</span><span class="op" id="4357574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357578">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4357586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357589">seq</span>&nbsp;<span class="op" id="4357593">:=</span>&nbsp;<span class="ident" id="4357596">client</span><span class="op" id="4357602">.</span><span class="ident" id="4357603">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357608">client</span><span class="op" id="4357614">.</span><span class="ident" id="4357615">seq</span><span class="op" id="4357618">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357622">client</span><span class="op" id="4357628">.</span><span class="ident" id="4357629">pending</span><span class="op" id="4357636">[</span><span class="ident" id="4357637">seq</span><span class="op" id="4357640">]</span>&nbsp;<span class="op" id="4357642">=</span>&nbsp;<span class="ident" id="4357644">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357650">client</span><span class="op" id="4357656">.</span><span class="ident" id="4357657">mutex</span><span class="op" id="4357662">.</span><span class="ident" id="4357663">Unlock</span><span class="op" id="4357669">(</span><span class="op" id="4357670">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4357674">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357707">client</span><span class="op" id="4357713">.</span><span class="ident" id="4357714">request</span><span class="op" id="4357721">.</span><span class="ident" id="4357722">Seq</span>&nbsp;<span class="op" id="4357726">=</span>&nbsp;<span class="ident" id="4357728">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357733">client</span><span class="op" id="4357739">.</span><span class="ident" id="4357740">request</span><span class="op" id="4357747">.</span><span class="ident" id="4357748">ServiceMethod</span>&nbsp;<span class="op" id="4357762">=</span>&nbsp;<span class="ident" id="4357764">call</span><span class="op" id="4357768">.</span><span class="ident" id="4357769">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357784">err</span>&nbsp;<span class="op" id="4357788">:=</span>&nbsp;<span class="ident" id="4357791">client</span><span class="op" id="4357797">.</span><span class="ident" id="4357798">codec</span><span class="op" id="4357803">.</span><span class="ident" id="4357804">WriteRequest</span><span class="op" id="4357816">(</span><span class="op" id="4357817">&amp;</span><span class="ident" id="4357818">client</span><span class="op" id="4357824">.</span><span class="ident" id="4357825">request</span><span class="op" id="4357832">,</span>&nbsp;<span class="ident" id="4357834">call</span><span class="op" id="4357838">.</span><span class="ident" id="4357839">Args</span><span class="op" id="4357843">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357846">if</span>&nbsp;<span class="ident" id="4357849">err</span>&nbsp;<span class="op" id="4357853">!=</span>&nbsp;<span class="ident" id="4357856">nil</span>&nbsp;<span class="op" id="4357860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357864">client</span><span class="op" id="4357870">.</span><span class="ident" id="4357871">mutex</span><span class="op" id="4357876">.</span><span class="ident" id="4357877">Lock</span><span class="op" id="4357881">(</span><span class="op" id="4357882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357886">call</span>&nbsp;<span class="op" id="4357891">=</span>&nbsp;<span class="ident" id="4357893">client</span><span class="op" id="4357899">.</span><span class="ident" id="4357900">pending</span><span class="op" id="4357907">[</span><span class="ident" id="4357908">seq</span><span class="op" id="4357911">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4357915">delete</span><span class="op" id="4357921">(</span><span class="ident" id="4357922">client</span><span class="op" id="4357928">.</span><span class="ident" id="4357929">pending</span><span class="op" id="4357936">,</span>&nbsp;<span class="ident" id="4357938">seq</span><span class="op" id="4357941">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357945">client</span><span class="op" id="4357951">.</span><span class="ident" id="4357952">mutex</span><span class="op" id="4357957">.</span><span class="ident" id="4357958">Unlock</span><span class="op" id="4357964">(</span><span class="op" id="4357965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4357969">if</span>&nbsp;<span class="ident" id="4357972">call</span>&nbsp;<span class="op" id="4357977">!=</span>&nbsp;<span class="ident" id="4357980">nil</span>&nbsp;<span class="op" id="4357984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4357989">call</span><span class="op" id="4357993">.</span><span class="ident" id="4357994">Error</span>&nbsp;<span class="op" id="4358000">=</span>&nbsp;<span class="ident" id="4358002">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358009">call</span><span class="op" id="4358013">.</span><span class="ident" id="4358014">done</span><span class="op" id="4358018">(</span><span class="op" id="4358019">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358026">}</span><br>
<span class="lineno"></span><span class="op" id="4358028">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4358031">func</span>&nbsp;<span class="op" id="4358036">(</span><span class="ident" id="4358037">client</span>&nbsp;<span class="op" id="4358044">*</span><span class="ident" id="4358045">Client</span><span class="op" id="4358051">)</span>&nbsp;<span class="ident" id="4358053">input</span><span class="op" id="4358058">(</span><span class="op" id="4358059">)</span>&nbsp;<span class="op" id="4358061">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358064">var</span>&nbsp;<span class="ident" id="4358068">err</span>&nbsp;<span class="builtintype" id="4358072">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358079">var</span>&nbsp;<span class="ident" id="4358083">response</span>&nbsp;<span class="ident" id="4358092">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358102">for</span>&nbsp;<span class="ident" id="4358106">err</span>&nbsp;<span class="op" id="4358110">==</span>&nbsp;<span class="ident" id="4358113">nil</span>&nbsp;<span class="op" id="4358117">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358121">response</span>&nbsp;<span class="op" id="4358130">=</span>&nbsp;<span class="ident" id="4358132">Response</span><span class="op" id="4358140">{</span><span class="op" id="4358141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358145">err</span>&nbsp;<span class="op" id="4358149">=</span>&nbsp;<span class="ident" id="4358151">client</span><span class="op" id="4358157">.</span><span class="ident" id="4358158">codec</span><span class="op" id="4358163">.</span><span class="ident" id="4358164">ReadResponseHeader</span><span class="op" id="4358182">(</span><span class="op" id="4358183">&amp;</span><span class="ident" id="4358184">response</span><span class="op" id="4358192">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358196">if</span>&nbsp;<span class="ident" id="4358199">err</span>&nbsp;<span class="op" id="4358203">!=</span>&nbsp;<span class="ident" id="4358206">nil</span>&nbsp;<span class="op" id="4358210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358215">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358223">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358227">seq</span>&nbsp;<span class="op" id="4358231">:=</span>&nbsp;<span class="ident" id="4358234">response</span><span class="op" id="4358242">.</span><span class="ident" id="4358243">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358249">client</span><span class="op" id="4358255">.</span><span class="ident" id="4358256">mutex</span><span class="op" id="4358261">.</span><span class="ident" id="4358262">Lock</span><span class="op" id="4358266">(</span><span class="op" id="4358267">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358271">call</span>&nbsp;<span class="op" id="4358276">:=</span>&nbsp;<span class="ident" id="4358279">client</span><span class="op" id="4358285">.</span><span class="ident" id="4358286">pending</span><span class="op" id="4358293">[</span><span class="ident" id="4358294">seq</span><span class="op" id="4358297">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4358301">delete</span><span class="op" id="4358307">(</span><span class="ident" id="4358308">client</span><span class="op" id="4358314">.</span><span class="ident" id="4358315">pending</span><span class="op" id="4358322">,</span>&nbsp;<span class="ident" id="4358324">seq</span><span class="op" id="4358327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358331">client</span><span class="op" id="4358337">.</span><span class="ident" id="4358338">mutex</span><span class="op" id="4358343">.</span><span class="ident" id="4358344">Unlock</span><span class="op" id="4358350">(</span><span class="op" id="4358351">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358356">switch</span>&nbsp;<span class="op" id="4358363">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358367">case</span>&nbsp;<span class="ident" id="4358372">call</span>&nbsp;<span class="op" id="4358377">==</span>&nbsp;<span class="ident" id="4358380">nil</span><span class="op" id="4358383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358388">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358445">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358503">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358559">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358617">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358677">err</span>&nbsp;<span class="op" id="4358681">=</span>&nbsp;<span class="ident" id="4358683">client</span><span class="op" id="4358689">.</span><span class="ident" id="4358690">codec</span><span class="op" id="4358695">.</span><span class="ident" id="4358696">ReadResponseBody</span><span class="op" id="4358712">(</span><span class="ident" id="4358713">nil</span><span class="op" id="4358716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358721">if</span>&nbsp;<span class="ident" id="4358724">err</span>&nbsp;<span class="op" id="4358728">!=</span>&nbsp;<span class="ident" id="4358731">nil</span>&nbsp;<span class="op" id="4358735">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358741">err</span>&nbsp;<span class="op" id="4358745">=</span>&nbsp;<span class="ident" id="4358747">errors</span><span class="op" id="4358753">.</span><span class="ident" id="4358754">New</span><span class="op" id="4358757">(</span><span class="string" id="4358758">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4358781">+</span>&nbsp;<span class="ident" id="4358783">err</span><span class="op" id="4358786">.</span><span class="ident" id="4358787">Error</span><span class="op" id="4358792">(</span><span class="op" id="4358793">)</span><span class="op" id="4358794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4358799">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4358803">case</span>&nbsp;<span class="ident" id="4358808">response</span><span class="op" id="4358816">.</span><span class="ident" id="4358817">Error</span>&nbsp;<span class="op" id="4358823">!=</span>&nbsp;<span class="string" id="4358826">&#34;&#34;</span><span class="op" id="4358828">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358833">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358894">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4358954">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4358983">call</span><span class="op" id="4358987">.</span><span class="ident" id="4358988">Error</span>&nbsp;<span class="op" id="4358994">=</span>&nbsp;<span class="ident" id="4358996">ServerError</span><span class="op" id="4359007">(</span><span class="ident" id="4359008">response</span><span class="op" id="4359016">.</span><span class="ident" id="4359017">Error</span><span class="op" id="4359022">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359027">err</span>&nbsp;<span class="op" id="4359031">=</span>&nbsp;<span class="ident" id="4359033">client</span><span class="op" id="4359039">.</span><span class="ident" id="4359040">codec</span><span class="op" id="4359045">.</span><span class="ident" id="4359046">ReadResponseBody</span><span class="op" id="4359062">(</span><span class="ident" id="4359063">nil</span><span class="op" id="4359066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359071">if</span>&nbsp;<span class="ident" id="4359074">err</span>&nbsp;<span class="op" id="4359078">!=</span>&nbsp;<span class="ident" id="4359081">nil</span>&nbsp;<span class="op" id="4359085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359091">err</span>&nbsp;<span class="op" id="4359095">=</span>&nbsp;<span class="ident" id="4359097">errors</span><span class="op" id="4359103">.</span><span class="ident" id="4359104">New</span><span class="op" id="4359107">(</span><span class="string" id="4359108">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="4359131">+</span>&nbsp;<span class="ident" id="4359133">err</span><span class="op" id="4359136">.</span><span class="ident" id="4359137">Error</span><span class="op" id="4359142">(</span><span class="op" id="4359143">)</span><span class="op" id="4359144">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359154">call</span><span class="op" id="4359158">.</span><span class="ident" id="4359159">done</span><span class="op" id="4359163">(</span><span class="op" id="4359164">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359168">default</span><span class="op" id="4359175">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359180">err</span>&nbsp;<span class="op" id="4359184">=</span>&nbsp;<span class="ident" id="4359186">client</span><span class="op" id="4359192">.</span><span class="ident" id="4359193">codec</span><span class="op" id="4359198">.</span><span class="ident" id="4359199">ReadResponseBody</span><span class="op" id="4359215">(</span><span class="ident" id="4359216">call</span><span class="op" id="4359220">.</span><span class="ident" id="4359221">Reply</span><span class="op" id="4359226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359231">if</span>&nbsp;<span class="ident" id="4359234">err</span>&nbsp;<span class="op" id="4359238">!=</span>&nbsp;<span class="ident" id="4359241">nil</span>&nbsp;<span class="op" id="4359245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359251">call</span><span class="op" id="4359255">.</span><span class="ident" id="4359256">Error</span>&nbsp;<span class="op" id="4359262">=</span>&nbsp;<span class="ident" id="4359264">errors</span><span class="op" id="4359270">.</span><span class="ident" id="4359271">New</span><span class="op" id="4359274">(</span><span class="string" id="4359275">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="4359291">+</span>&nbsp;<span class="ident" id="4359293">err</span><span class="op" id="4359296">.</span><span class="ident" id="4359297">Error</span><span class="op" id="4359302">(</span><span class="op" id="4359303">)</span><span class="op" id="4359304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359309">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359314">call</span><span class="op" id="4359318">.</span><span class="ident" id="4359319">done</span><span class="op" id="4359323">(</span><span class="op" id="4359324">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359328">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359334">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359363">client</span><span class="op" id="4359369">.</span><span class="ident" id="4359370">reqMutex</span><span class="op" id="4359378">.</span><span class="ident" id="4359379">Lock</span><span class="op" id="4359383">(</span><span class="op" id="4359384">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359387">client</span><span class="op" id="4359393">.</span><span class="ident" id="4359394">mutex</span><span class="op" id="4359399">.</span><span class="ident" id="4359400">Lock</span><span class="op" id="4359404">(</span><span class="op" id="4359405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359408">client</span><span class="op" id="4359414">.</span><span class="ident" id="4359415">shutdown</span>&nbsp;<span class="op" id="4359424">=</span>&nbsp;<span class="builtintype" id="4359426">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359432">closing</span>&nbsp;<span class="op" id="4359440">:=</span>&nbsp;<span class="ident" id="4359443">client</span><span class="op" id="4359449">.</span><span class="ident" id="4359450">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359459">if</span>&nbsp;<span class="ident" id="4359462">err</span>&nbsp;<span class="op" id="4359466">==</span>&nbsp;<span class="ident" id="4359469">io</span><span class="op" id="4359471">.</span><span class="ident" id="4359472">EOF</span>&nbsp;<span class="op" id="4359476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359480">if</span>&nbsp;<span class="ident" id="4359483">closing</span>&nbsp;<span class="op" id="4359491">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359496">err</span>&nbsp;<span class="op" id="4359500">=</span>&nbsp;<span class="ident" id="4359502">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359516">}</span>&nbsp;<span class="keyword" id="4359518">else</span>&nbsp;<span class="op" id="4359523">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359528">err</span>&nbsp;<span class="op" id="4359532">=</span>&nbsp;<span class="ident" id="4359534">io</span><span class="op" id="4359536">.</span><span class="ident" id="4359537">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359559">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359562">for</span>&nbsp;<span class="ident" id="4359566">_</span><span class="op" id="4359567">,</span>&nbsp;<span class="ident" id="4359569">call</span>&nbsp;<span class="op" id="4359574">:=</span>&nbsp;<span class="keyword" id="4359577">range</span>&nbsp;<span class="ident" id="4359583">client</span><span class="op" id="4359589">.</span><span class="ident" id="4359590">pending</span>&nbsp;<span class="op" id="4359598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359602">call</span><span class="op" id="4359606">.</span><span class="ident" id="4359607">Error</span>&nbsp;<span class="op" id="4359613">=</span>&nbsp;<span class="ident" id="4359615">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359621">call</span><span class="op" id="4359625">.</span><span class="ident" id="4359626">done</span><span class="op" id="4359630">(</span><span class="op" id="4359631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359637">client</span><span class="op" id="4359643">.</span><span class="ident" id="4359644">mutex</span><span class="op" id="4359649">.</span><span class="ident" id="4359650">Unlock</span><span class="op" id="4359656">(</span><span class="op" id="4359657">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359660">client</span><span class="op" id="4359666">.</span><span class="ident" id="4359667">reqMutex</span><span class="op" id="4359675">.</span><span class="ident" id="4359676">Unlock</span><span class="op" id="4359682">(</span><span class="op" id="4359683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359686">if</span>&nbsp;<span class="ident" id="4359689">debugLog</span>&nbsp;<span class="op" id="4359698">&amp;&amp;</span>&nbsp;<span class="ident" id="4359701">err</span>&nbsp;<span class="op" id="4359705">!=</span>&nbsp;<span class="ident" id="4359708">io</span><span class="op" id="4359710">.</span><span class="ident" id="4359711">EOF</span>&nbsp;<span class="op" id="4359715">&amp;&amp;</span>&nbsp;<span class="op" id="4359718">!</span><span class="ident" id="4359719">closing</span>&nbsp;<span class="op" id="4359727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4359731">log</span><span class="op" id="4359734">.</span><span class="ident" id="4359735">Println</span><span class="op" id="4359742">(</span><span class="string" id="4359743">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="4359772">,</span>&nbsp;<span class="ident" id="4359774">err</span><span class="op" id="4359777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4359780">}</span><br>
<span class="lineno"></span><span class="op" id="4359782">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="4359785">func</span>&nbsp;<span class="op" id="4359790">(</span><span class="ident" id="4359791">call</span>&nbsp;<span class="op" id="4359796">*</span><span class="ident" id="4359797">Call</span><span class="op" id="4359801">)</span>&nbsp;<span class="ident" id="4359803">done</span><span class="op" id="4359807">(</span><span class="op" id="4359808">)</span>&nbsp;<span class="op" id="4359810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359813">select</span>&nbsp;<span class="op" id="4359820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359823">case</span>&nbsp;<span class="ident" id="4359828">call</span><span class="op" id="4359832">.</span><span class="ident" id="4359833">Done</span>&nbsp;<span class="op" id="4359838">&lt;-</span>&nbsp;<span class="ident" id="4359841">call</span><span class="op" id="4359845">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359849">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4359856">default</span><span class="op" id="4359863">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359867">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4359944">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360012">if</span>&nbsp;<span class="ident" id="4360015">debugLog</span>&nbsp;<span class="op" id="4360024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360029">log</span><span class="op" id="4360032">.</span><span class="ident" id="4360033">Println</span><span class="op" id="4360040">(</span><span class="string" id="4360041">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="4360108">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360112">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360115">}</span><br>
<span class="lineno"></span><span class="op" id="4360117">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360120">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="4360180">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="4360235">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="4360294">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="4360340">func</span>&nbsp;<span class="ident" id="4360345">NewClient</span><span class="op" id="4360354">(</span><span class="ident" id="4360355">conn</span>&nbsp;<span class="ident" id="4360360">io</span><span class="op" id="4360362">.</span><span class="ident" id="4360363">ReadWriteCloser</span><span class="op" id="4360378">)</span>&nbsp;<span class="op" id="4360380">*</span><span class="ident" id="4360381">Client</span>&nbsp;<span class="op" id="4360388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360391">encBuf</span>&nbsp;<span class="op" id="4360398">:=</span>&nbsp;<span class="ident" id="4360401">bufio</span><span class="op" id="4360406">.</span><span class="ident" id="4360407">NewWriter</span><span class="op" id="4360416">(</span><span class="ident" id="4360417">conn</span><span class="op" id="4360421">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360424">client</span>&nbsp;<span class="op" id="4360431">:=</span>&nbsp;<span class="op" id="4360434">&amp;</span><span class="ident" id="4360435">gobClientCodec</span><span class="op" id="4360449">{</span><span class="ident" id="4360450">conn</span><span class="op" id="4360454">,</span>&nbsp;<span class="ident" id="4360456">gob</span><span class="op" id="4360459">.</span><span class="ident" id="4360460">NewDecoder</span><span class="op" id="4360470">(</span><span class="ident" id="4360471">conn</span><span class="op" id="4360475">)</span><span class="op" id="4360476">,</span>&nbsp;<span class="ident" id="4360478">gob</span><span class="op" id="4360481">.</span><span class="ident" id="4360482">NewEncoder</span><span class="op" id="4360492">(</span><span class="ident" id="4360493">encBuf</span><span class="op" id="4360499">)</span><span class="op" id="4360500">,</span>&nbsp;<span class="ident" id="4360502">encBuf</span><span class="op" id="4360508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360511">return</span>&nbsp;<span class="ident" id="4360518">NewClientWithCodec</span><span class="op" id="4360536">(</span><span class="ident" id="4360537">client</span><span class="op" id="4360543">)</span><br>
<span class="lineno"></span><span class="op" id="4360545">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4360548">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="4360611">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="4360661">func</span>&nbsp;<span class="ident" id="4360666">NewClientWithCodec</span><span class="op" id="4360684">(</span><span class="ident" id="4360685">codec</span>&nbsp;<span class="ident" id="4360691">ClientCodec</span><span class="op" id="4360702">)</span>&nbsp;<span class="op" id="4360704">*</span><span class="ident" id="4360705">Client</span>&nbsp;<span class="op" id="4360712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360715">client</span>&nbsp;<span class="op" id="4360722">:=</span>&nbsp;<span class="op" id="4360725">&amp;</span><span class="ident" id="4360726">Client</span><span class="op" id="4360732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360736">codec</span><span class="op" id="4360741">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4360745">codec</span><span class="op" id="4360750">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360754">pending</span><span class="op" id="4360761">:</span>&nbsp;<span class="builtinfunc" id="4360763">make</span><span class="op" id="4360767">(</span><span class="keyword" id="4360768">map</span><span class="op" id="4360771">[</span><span class="ident" id="4360772">uint64</span><span class="op" id="4360778">]</span><span class="op" id="4360779">*</span><span class="ident" id="4360780">Call</span><span class="op" id="4360784">)</span><span class="op" id="4360785">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4360788">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360791">go</span>&nbsp;<span class="ident" id="4360794">client</span><span class="op" id="4360800">.</span><span class="ident" id="4360801">input</span><span class="op" id="4360806">(</span><span class="op" id="4360807">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4360810">return</span>&nbsp;<span class="ident" id="4360817">client</span><br>
<span class="lineno"></span><span class="op" id="4360824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="4360827">type</span>&nbsp;<span class="ident" id="4360832">gobClientCodec</span>&nbsp;<span class="keyword" id="4360847">struct</span>&nbsp;<span class="op" id="4360854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360857">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4360864">io</span><span class="op" id="4360866">.</span><span class="ident" id="4360867">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360884">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4360891">*</span><span class="ident" id="4360892">gob</span><span class="op" id="4360895">.</span><span class="ident" id="4360896">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360905">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4360912">*</span><span class="ident" id="4360913">gob</span><span class="op" id="4360916">.</span><span class="ident" id="4360917">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4360926">encBuf</span>&nbsp;<span class="op" id="4360933">*</span><span class="ident" id="4360934">bufio</span><span class="op" id="4360939">.</span><span class="ident" id="4360940">Writer</span><br>
<span class="lineno">210</span><span class="op" id="4360947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4360950">func</span>&nbsp;<span class="op" id="4360955">(</span><span class="ident" id="4360956">c</span>&nbsp;<span class="op" id="4360958">*</span><span class="ident" id="4360959">gobClientCodec</span><span class="op" id="4360973">)</span>&nbsp;<span class="ident" id="4360975">WriteRequest</span><span class="op" id="4360987">(</span><span class="ident" id="4360988">r</span>&nbsp;<span class="op" id="4360990">*</span><span class="ident" id="4360991">Request</span><span class="op" id="4360998">,</span>&nbsp;<span class="ident" id="4361000">body</span>&nbsp;<span class="keyword" id="4361005">interface</span><span class="op" id="4361014">{</span><span class="op" id="4361015">}</span><span class="op" id="4361016">)</span>&nbsp;<span class="op" id="4361018">(</span><span class="ident" id="4361019">err</span>&nbsp;<span class="builtintype" id="4361023">error</span><span class="op" id="4361028">)</span>&nbsp;<span class="op" id="4361030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361033">if</span>&nbsp;<span class="ident" id="4361036">err</span>&nbsp;<span class="op" id="4361040">=</span>&nbsp;<span class="ident" id="4361042">c</span><span class="op" id="4361043">.</span><span class="ident" id="4361044">enc</span><span class="op" id="4361047">.</span><span class="ident" id="4361048">Encode</span><span class="op" id="4361054">(</span><span class="ident" id="4361055">r</span><span class="op" id="4361056">)</span><span class="op" id="4361057">;</span>&nbsp;<span class="ident" id="4361059">err</span>&nbsp;<span class="op" id="4361063">!=</span>&nbsp;<span class="ident" id="4361066">nil</span>&nbsp;<span class="op" id="4361070">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361074">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361085">if</span>&nbsp;<span class="ident" id="4361088">err</span>&nbsp;<span class="op" id="4361092">=</span>&nbsp;<span class="ident" id="4361094">c</span><span class="op" id="4361095">.</span><span class="ident" id="4361096">enc</span><span class="op" id="4361099">.</span><span class="ident" id="4361100">Encode</span><span class="op" id="4361106">(</span><span class="ident" id="4361107">body</span><span class="op" id="4361111">)</span><span class="op" id="4361112">;</span>&nbsp;<span class="ident" id="4361114">err</span>&nbsp;<span class="op" id="4361118">!=</span>&nbsp;<span class="ident" id="4361121">nil</span>&nbsp;<span class="op" id="4361125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361129">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361140">return</span>&nbsp;<span class="ident" id="4361147">c</span><span class="op" id="4361148">.</span><span class="ident" id="4361149">encBuf</span><span class="op" id="4361155">.</span><span class="ident" id="4361156">Flush</span><span class="op" id="4361161">(</span><span class="op" id="4361162">)</span><br>
<span class="lineno">220</span><span class="op" id="4361164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4361167">func</span>&nbsp;<span class="op" id="4361172">(</span><span class="ident" id="4361173">c</span>&nbsp;<span class="op" id="4361175">*</span><span class="ident" id="4361176">gobClientCodec</span><span class="op" id="4361190">)</span>&nbsp;<span class="ident" id="4361192">ReadResponseHeader</span><span class="op" id="4361210">(</span><span class="ident" id="4361211">r</span>&nbsp;<span class="op" id="4361213">*</span><span class="ident" id="4361214">Response</span><span class="op" id="4361222">)</span>&nbsp;<span class="builtintype" id="4361224">error</span>&nbsp;<span class="op" id="4361230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361233">return</span>&nbsp;<span class="ident" id="4361240">c</span><span class="op" id="4361241">.</span><span class="ident" id="4361242">dec</span><span class="op" id="4361245">.</span><span class="ident" id="4361246">Decode</span><span class="op" id="4361252">(</span><span class="ident" id="4361253">r</span><span class="op" id="4361254">)</span><br>
<span class="lineno"></span><span class="op" id="4361256">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="4361259">func</span>&nbsp;<span class="op" id="4361264">(</span><span class="ident" id="4361265">c</span>&nbsp;<span class="op" id="4361267">*</span><span class="ident" id="4361268">gobClientCodec</span><span class="op" id="4361282">)</span>&nbsp;<span class="ident" id="4361284">ReadResponseBody</span><span class="op" id="4361300">(</span><span class="ident" id="4361301">body</span>&nbsp;<span class="keyword" id="4361306">interface</span><span class="op" id="4361315">{</span><span class="op" id="4361316">}</span><span class="op" id="4361317">)</span>&nbsp;<span class="builtintype" id="4361319">error</span>&nbsp;<span class="op" id="4361325">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361328">return</span>&nbsp;<span class="ident" id="4361335">c</span><span class="op" id="4361336">.</span><span class="ident" id="4361337">dec</span><span class="op" id="4361340">.</span><span class="ident" id="4361341">Decode</span><span class="op" id="4361347">(</span><span class="ident" id="4361348">body</span><span class="op" id="4361352">)</span><br>
<span class="lineno"></span><span class="op" id="4361354">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="4361357">func</span>&nbsp;<span class="op" id="4361362">(</span><span class="ident" id="4361363">c</span>&nbsp;<span class="op" id="4361365">*</span><span class="ident" id="4361366">gobClientCodec</span><span class="op" id="4361380">)</span>&nbsp;<span class="ident" id="4361382">Close</span><span class="op" id="4361387">(</span><span class="op" id="4361388">)</span>&nbsp;<span class="builtintype" id="4361390">error</span>&nbsp;<span class="op" id="4361396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361399">return</span>&nbsp;<span class="ident" id="4361406">c</span><span class="op" id="4361407">.</span><span class="ident" id="4361408">rwc</span><span class="op" id="4361411">.</span><span class="ident" id="4361412">Close</span><span class="op" id="4361417">(</span><span class="op" id="4361418">)</span><br>
<span class="lineno"></span><span class="op" id="4361420">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4361423">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="4361499">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4361542">func</span>&nbsp;<span class="ident" id="4361547">DialHTTP</span><span class="op" id="4361555">(</span><span class="ident" id="4361556">network</span><span class="op" id="4361563">,</span>&nbsp;<span class="ident" id="4361565">address</span>&nbsp;<span class="builtintype" id="4361573">string</span><span class="op" id="4361579">)</span>&nbsp;<span class="op" id="4361581">(</span><span class="op" id="4361582">*</span><span class="ident" id="4361583">Client</span><span class="op" id="4361589">,</span>&nbsp;<span class="builtintype" id="4361591">error</span><span class="op" id="4361596">)</span>&nbsp;<span class="op" id="4361598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361601">return</span>&nbsp;<span class="ident" id="4361608">DialHTTPPath</span><span class="op" id="4361620">(</span><span class="ident" id="4361621">network</span><span class="op" id="4361628">,</span>&nbsp;<span class="ident" id="4361630">address</span><span class="op" id="4361637">,</span>&nbsp;<span class="ident" id="4361639">DefaultRPCPath</span><span class="op" id="4361653">)</span><br>
<span class="lineno"></span><span class="op" id="4361655">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="4361658">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="4361705">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="4361751">func</span>&nbsp;<span class="ident" id="4361756">DialHTTPPath</span><span class="op" id="4361768">(</span><span class="ident" id="4361769">network</span><span class="op" id="4361776">,</span>&nbsp;<span class="ident" id="4361778">address</span><span class="op" id="4361785">,</span>&nbsp;<span class="ident" id="4361787">path</span>&nbsp;<span class="builtintype" id="4361792">string</span><span class="op" id="4361798">)</span>&nbsp;<span class="op" id="4361800">(</span><span class="op" id="4361801">*</span><span class="ident" id="4361802">Client</span><span class="op" id="4361808">,</span>&nbsp;<span class="builtintype" id="4361810">error</span><span class="op" id="4361815">)</span>&nbsp;<span class="op" id="4361817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361820">var</span>&nbsp;<span class="ident" id="4361824">err</span>&nbsp;<span class="builtintype" id="4361828">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361835">conn</span><span class="op" id="4361839">,</span>&nbsp;<span class="ident" id="4361841">err</span>&nbsp;<span class="op" id="4361845">:=</span>&nbsp;<span class="ident" id="4361848">net</span><span class="op" id="4361851">.</span><span class="ident" id="4361852">Dial</span><span class="op" id="4361856">(</span><span class="ident" id="4361857">network</span><span class="op" id="4361864">,</span>&nbsp;<span class="ident" id="4361866">address</span><span class="op" id="4361873">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361876">if</span>&nbsp;<span class="ident" id="4361879">err</span>&nbsp;<span class="op" id="4361883">!=</span>&nbsp;<span class="ident" id="4361886">nil</span>&nbsp;<span class="op" id="4361890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4361894">return</span>&nbsp;<span class="ident" id="4361901">nil</span><span class="op" id="4361904">,</span>&nbsp;<span class="ident" id="4361906">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4361911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4361914">io</span><span class="op" id="4361916">.</span><span class="ident" id="4361917">WriteString</span><span class="op" id="4361928">(</span><span class="ident" id="4361929">conn</span><span class="op" id="4361933">,</span>&nbsp;<span class="string" id="4361935">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="4361945">+</span><span class="ident" id="4361946">path</span><span class="op" id="4361950">+</span><span class="string" id="4361951">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="4361966">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4361970">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4362007">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362045">resp</span><span class="op" id="4362049">,</span>&nbsp;<span class="ident" id="4362051">err</span>&nbsp;<span class="op" id="4362055">:=</span>&nbsp;<span class="ident" id="4362058">http</span><span class="op" id="4362062">.</span><span class="ident" id="4362063">ReadResponse</span><span class="op" id="4362075">(</span><span class="ident" id="4362076">bufio</span><span class="op" id="4362081">.</span><span class="ident" id="4362082">NewReader</span><span class="op" id="4362091">(</span><span class="ident" id="4362092">conn</span><span class="op" id="4362096">)</span><span class="op" id="4362097">,</span>&nbsp;<span class="op" id="4362099">&amp;</span><span class="ident" id="4362100">http</span><span class="op" id="4362104">.</span><span class="ident" id="4362105">Request</span><span class="op" id="4362112">{</span><span class="ident" id="4362113">Method</span><span class="op" id="4362119">:</span>&nbsp;<span class="string" id="4362121">&#34;CONNECT&#34;</span><span class="op" id="4362130">}</span><span class="op" id="4362131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362134">if</span>&nbsp;<span class="ident" id="4362137">err</span>&nbsp;<span class="op" id="4362141">==</span>&nbsp;<span class="ident" id="4362144">nil</span>&nbsp;<span class="op" id="4362148">&amp;&amp;</span>&nbsp;<span class="ident" id="4362151">resp</span><span class="op" id="4362155">.</span><span class="ident" id="4362156">Status</span>&nbsp;<span class="op" id="4362163">==</span>&nbsp;<span class="ident" id="4362166">connected</span>&nbsp;<span class="op" id="4362176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362180">return</span>&nbsp;<span class="ident" id="4362187">NewClient</span><span class="op" id="4362196">(</span><span class="ident" id="4362197">conn</span><span class="op" id="4362201">)</span><span class="op" id="4362202">,</span>&nbsp;<span class="ident" id="4362204">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362212">if</span>&nbsp;<span class="ident" id="4362215">err</span>&nbsp;<span class="op" id="4362219">==</span>&nbsp;<span class="ident" id="4362222">nil</span>&nbsp;<span class="op" id="4362226">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362230">err</span>&nbsp;<span class="op" id="4362234">=</span>&nbsp;<span class="ident" id="4362236">errors</span><span class="op" id="4362242">.</span><span class="ident" id="4362243">New</span><span class="op" id="4362246">(</span><span class="string" id="4362247">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="4362276">+</span>&nbsp;<span class="ident" id="4362278">resp</span><span class="op" id="4362282">.</span><span class="ident" id="4362283">Status</span><span class="op" id="4362289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362295">conn</span><span class="op" id="4362299">.</span><span class="ident" id="4362300">Close</span><span class="op" id="4362305">(</span><span class="op" id="4362306">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362309">return</span>&nbsp;<span class="ident" id="4362316">nil</span><span class="op" id="4362319">,</span>&nbsp;<span class="op" id="4362321">&amp;</span><span class="ident" id="4362322">net</span><span class="op" id="4362325">.</span><span class="ident" id="4362326">OpError</span><span class="op" id="4362333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362337">Op</span><span class="op" id="4362339">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="4362343">&#34;dial-http&#34;</span><span class="op" id="4362354">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362358">Net</span><span class="op" id="4362361">:</span>&nbsp;&nbsp;<span class="ident" id="4362364">network</span>&nbsp;<span class="op" id="4362372">+</span>&nbsp;<span class="string" id="4362374">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="4362378">+</span>&nbsp;<span class="ident" id="4362380">address</span><span class="op" id="4362387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362391">Addr</span><span class="op" id="4362395">:</span>&nbsp;<span class="ident" id="4362397">nil</span><span class="op" id="4362400">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362404">Err</span><span class="op" id="4362407">:</span>&nbsp;&nbsp;<span class="ident" id="4362410">err</span><span class="op" id="4362413">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362416">}</span><br>
<span class="lineno"></span><span class="op" id="4362418">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362421">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="4362489">func</span>&nbsp;<span class="ident" id="4362494">Dial</span><span class="op" id="4362498">(</span><span class="ident" id="4362499">network</span><span class="op" id="4362506">,</span>&nbsp;<span class="ident" id="4362508">address</span>&nbsp;<span class="builtintype" id="4362516">string</span><span class="op" id="4362522">)</span>&nbsp;<span class="op" id="4362524">(</span><span class="op" id="4362525">*</span><span class="ident" id="4362526">Client</span><span class="op" id="4362532">,</span>&nbsp;<span class="builtintype" id="4362534">error</span><span class="op" id="4362539">)</span>&nbsp;<span class="op" id="4362541">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362544">conn</span><span class="op" id="4362548">,</span>&nbsp;<span class="ident" id="4362550">err</span>&nbsp;<span class="op" id="4362554">:=</span>&nbsp;<span class="ident" id="4362557">net</span><span class="op" id="4362560">.</span><span class="ident" id="4362561">Dial</span><span class="op" id="4362565">(</span><span class="ident" id="4362566">network</span><span class="op" id="4362573">,</span>&nbsp;<span class="ident" id="4362575">address</span><span class="op" id="4362582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362585">if</span>&nbsp;<span class="ident" id="4362588">err</span>&nbsp;<span class="op" id="4362592">!=</span>&nbsp;<span class="ident" id="4362595">nil</span>&nbsp;<span class="op" id="4362599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362603">return</span>&nbsp;<span class="ident" id="4362610">nil</span><span class="op" id="4362613">,</span>&nbsp;<span class="ident" id="4362615">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362620">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362623">return</span>&nbsp;<span class="ident" id="4362630">NewClient</span><span class="op" id="4362639">(</span><span class="ident" id="4362640">conn</span><span class="op" id="4362644">)</span><span class="op" id="4362645">,</span>&nbsp;<span class="ident" id="4362647">nil</span><br>
<span class="lineno">275</span><span class="op" id="4362651">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4362654">func</span>&nbsp;<span class="op" id="4362659">(</span><span class="ident" id="4362660">client</span>&nbsp;<span class="op" id="4362667">*</span><span class="ident" id="4362668">Client</span><span class="op" id="4362674">)</span>&nbsp;<span class="ident" id="4362676">Close</span><span class="op" id="4362681">(</span><span class="op" id="4362682">)</span>&nbsp;<span class="builtintype" id="4362684">error</span>&nbsp;<span class="op" id="4362690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362693">client</span><span class="op" id="4362699">.</span><span class="ident" id="4362700">mutex</span><span class="op" id="4362705">.</span><span class="ident" id="4362706">Lock</span><span class="op" id="4362710">(</span><span class="op" id="4362711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362714">if</span>&nbsp;<span class="ident" id="4362717">client</span><span class="op" id="4362723">.</span><span class="ident" id="4362724">closing</span>&nbsp;<span class="op" id="4362732">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362736">client</span><span class="op" id="4362742">.</span><span class="ident" id="4362743">mutex</span><span class="op" id="4362748">.</span><span class="ident" id="4362749">Unlock</span><span class="op" id="4362755">(</span><span class="op" id="4362756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362760">return</span>&nbsp;<span class="ident" id="4362767">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4362780">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362783">client</span><span class="op" id="4362789">.</span><span class="ident" id="4362790">closing</span>&nbsp;<span class="op" id="4362798">=</span>&nbsp;<span class="builtintype" id="4362800">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4362806">client</span><span class="op" id="4362812">.</span><span class="ident" id="4362813">mutex</span><span class="op" id="4362818">.</span><span class="ident" id="4362819">Unlock</span><span class="op" id="4362825">(</span><span class="op" id="4362826">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4362829">return</span>&nbsp;<span class="ident" id="4362836">client</span><span class="op" id="4362842">.</span><span class="ident" id="4362843">codec</span><span class="op" id="4362848">.</span><span class="ident" id="4362849">Close</span><span class="op" id="4362854">(</span><span class="op" id="4362855">)</span><br>
<span class="lineno"></span><span class="op" id="4362857">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4362860">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="4362947">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="4363035">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="4363109">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="4363177">func</span>&nbsp;<span class="op" id="4363182">(</span><span class="ident" id="4363183">client</span>&nbsp;<span class="op" id="4363190">*</span><span class="ident" id="4363191">Client</span><span class="op" id="4363197">)</span>&nbsp;<span class="ident" id="4363199">Go</span><span class="op" id="4363201">(</span><span class="ident" id="4363202">serviceMethod</span>&nbsp;<span class="builtintype" id="4363216">string</span><span class="op" id="4363222">,</span>&nbsp;<span class="ident" id="4363224">args</span>&nbsp;<span class="keyword" id="4363229">interface</span><span class="op" id="4363238">{</span><span class="op" id="4363239">}</span><span class="op" id="4363240">,</span>&nbsp;<span class="ident" id="4363242">reply</span>&nbsp;<span class="keyword" id="4363248">interface</span><span class="op" id="4363257">{</span><span class="op" id="4363258">}</span><span class="op" id="4363259">,</span>&nbsp;<span class="ident" id="4363261">done</span>&nbsp;<span class="keyword" id="4363266">chan</span>&nbsp;<span class="op" id="4363271">*</span><span class="ident" id="4363272">Call</span><span class="op" id="4363276">)</span>&nbsp;<span class="op" id="4363278">*</span><span class="ident" id="4363279">Call</span>&nbsp;<span class="op" id="4363284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363287">call</span>&nbsp;<span class="op" id="4363292">:=</span>&nbsp;<span class="builtinfunc" id="4363295">new</span><span class="op" id="4363298">(</span><span class="ident" id="4363299">Call</span><span class="op" id="4363303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363306">call</span><span class="op" id="4363310">.</span><span class="ident" id="4363311">ServiceMethod</span>&nbsp;<span class="op" id="4363325">=</span>&nbsp;<span class="ident" id="4363327">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363342">call</span><span class="op" id="4363346">.</span><span class="ident" id="4363347">Args</span>&nbsp;<span class="op" id="4363352">=</span>&nbsp;<span class="ident" id="4363354">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363360">call</span><span class="op" id="4363364">.</span><span class="ident" id="4363365">Reply</span>&nbsp;<span class="op" id="4363371">=</span>&nbsp;<span class="ident" id="4363373">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363380">if</span>&nbsp;<span class="ident" id="4363383">done</span>&nbsp;<span class="op" id="4363388">==</span>&nbsp;<span class="ident" id="4363391">nil</span>&nbsp;<span class="op" id="4363395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363399">done</span>&nbsp;<span class="op" id="4363404">=</span>&nbsp;<span class="builtinfunc" id="4363406">make</span><span class="op" id="4363410">(</span><span class="keyword" id="4363411">chan</span>&nbsp;<span class="op" id="4363416">*</span><span class="ident" id="4363417">Call</span><span class="op" id="4363421">,</span>&nbsp;<span class="num" id="4363423">10</span><span class="op" id="4363425">)</span>&nbsp;<span class="comment" id="4363427">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363441">}</span>&nbsp;<span class="keyword" id="4363443">else</span>&nbsp;<span class="op" id="4363448">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363452">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363508">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363567">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4363626">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363683">if</span>&nbsp;<span class="builtinfunc" id="4363686">cap</span><span class="op" id="4363689">(</span><span class="ident" id="4363690">done</span><span class="op" id="4363694">)</span>&nbsp;<span class="op" id="4363696">==</span>&nbsp;<span class="num" id="4363699">0</span>&nbsp;<span class="op" id="4363701">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363706">log</span><span class="op" id="4363709">.</span><span class="ident" id="4363710">Panic</span><span class="op" id="4363715">(</span><span class="string" id="4363716">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="4363749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363753">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4363756">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363759">call</span><span class="op" id="4363763">.</span><span class="ident" id="4363764">Done</span>&nbsp;<span class="op" id="4363769">=</span>&nbsp;<span class="ident" id="4363771">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363777">client</span><span class="op" id="4363783">.</span><span class="ident" id="4363784">send</span><span class="op" id="4363788">(</span><span class="ident" id="4363789">call</span><span class="op" id="4363793">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4363796">return</span>&nbsp;<span class="ident" id="4363803">call</span><br>
<span class="lineno"></span><span class="op" id="4363808">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4363811">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="4363903">func</span>&nbsp;<span class="op" id="4363908">(</span><span class="ident" id="4363909">client</span>&nbsp;<span class="op" id="4363916">*</span><span class="ident" id="4363917">Client</span><span class="op" id="4363923">)</span>&nbsp;<span class="ident" id="4363925">Call</span><span class="op" id="4363929">(</span><span class="ident" id="4363930">serviceMethod</span>&nbsp;<span class="builtintype" id="4363944">string</span><span class="op" id="4363950">,</span>&nbsp;<span class="ident" id="4363952">args</span>&nbsp;<span class="keyword" id="4363957">interface</span><span class="op" id="4363966">{</span><span class="op" id="4363967">}</span><span class="op" id="4363968">,</span>&nbsp;<span class="ident" id="4363970">reply</span>&nbsp;<span class="keyword" id="4363976">interface</span><span class="op" id="4363985">{</span><span class="op" id="4363986">}</span><span class="op" id="4363987">)</span>&nbsp;<span class="builtintype" id="4363989">error</span>&nbsp;<span class="op" id="4363995">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4363998">call</span>&nbsp;<span class="op" id="4364003">:=</span>&nbsp;<span class="op" id="4364006">&lt;-</span><span class="ident" id="4364008">client</span><span class="op" id="4364014">.</span><span class="ident" id="4364015">Go</span><span class="op" id="4364017">(</span><span class="ident" id="4364018">serviceMethod</span><span class="op" id="4364031">,</span>&nbsp;<span class="ident" id="4364033">args</span><span class="op" id="4364037">,</span>&nbsp;<span class="ident" id="4364039">reply</span><span class="op" id="4364044">,</span>&nbsp;<span class="builtinfunc" id="4364046">make</span><span class="op" id="4364050">(</span><span class="keyword" id="4364051">chan</span>&nbsp;<span class="op" id="4364056">*</span><span class="ident" id="4364057">Call</span><span class="op" id="4364061">,</span>&nbsp;<span class="num" id="4364063">1</span><span class="op" id="4364064">)</span><span class="op" id="4364065">)</span><span class="op" id="4364066">.</span><span class="ident" id="4364067">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4364073">return</span>&nbsp;<span class="ident" id="4364080">call</span><span class="op" id="4364084">.</span><span class="ident" id="4364085">Error</span><br>
<span class="lineno"></span><span class="op" id="4364091">}</span>
</div>
</body>
</html>
