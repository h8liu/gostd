<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/tls</h2>
<ul>
<li><a href="/gostd/crypto/tls/alert.go.html">alert.go</a></li>
<li><a href="/gostd/crypto/tls/cipher_suites.go.html">cipher_suites.go</a></li>
<li><a href="/gostd/crypto/tls/common.go.html" class="current">common.go</a></li>
<li><a href="/gostd/crypto/tls/conn.go.html">conn.go</a></li>
<li><a href="/gostd/crypto/tls/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/crypto/tls/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client.go.html">handshake_client.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_client_test.go.html">handshake_client_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages.go.html">handshake_messages.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_messages_test.go.html">handshake_messages_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server.go.html">handshake_server.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_server_test.go.html">handshake_server_test.go</a></li>
<li><a href="/gostd/crypto/tls/handshake_test.go.html">handshake_test.go</a></li>
<li><a href="/gostd/crypto/tls/key_agreement.go.html">key_agreement.go</a></li>
<li><a href="/gostd/crypto/tls/prf.go.html">prf.go</a></li>
<li><a href="/gostd/crypto/tls/prf_test.go.html">prf_test.go</a></li>
<li><a href="/gostd/crypto/tls/ticket.go.html">ticket.go</a></li>
<li><a href="/gostd/crypto/tls/tls.go.html">tls.go</a></li>
<li><a href="/gostd/crypto/tls/tls_test.go.html">tls_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4442136">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4442191">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4442245">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4442296">package</span>&nbsp;<span class="ident" id="4442304">tls</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442309">import</span>&nbsp;<span class="op" id="4442316">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442319">&#34;container/list&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442337">&#34;crypto&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442347">&#34;crypto/rand&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442362">&#34;crypto/x509&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442377">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442384">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442390">&#34;math/big&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442402">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442413">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4442421">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4442428">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="4442431">const</span>&nbsp;<span class="op" id="4442437">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442440">VersionSSL30</span>&nbsp;<span class="op" id="4442453">=</span>&nbsp;<span class="num" id="4442455">0x0300</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442463">VersionTLS10</span>&nbsp;<span class="op" id="4442476">=</span>&nbsp;<span class="num" id="4442478">0x0301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442486">VersionTLS11</span>&nbsp;<span class="op" id="4442499">=</span>&nbsp;<span class="num" id="4442501">0x0302</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442509">VersionTLS12</span>&nbsp;<span class="op" id="4442522">=</span>&nbsp;<span class="num" id="4442524">0x0303</span><br>
<span class="lineno">25</span><span class="op" id="4442531">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4442534">const</span>&nbsp;<span class="op" id="4442540">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442543">maxPlaintext</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442559">=</span>&nbsp;<span class="num" id="4442561">16384</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4442574">//&nbsp;maximum&nbsp;plaintext&nbsp;payload&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442611">maxCiphertext</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4442627">=</span>&nbsp;<span class="num" id="4442629">16384</span>&nbsp;<span class="op" id="4442635">+</span>&nbsp;<span class="num" id="4442637">2048</span>&nbsp;<span class="comment" id="4442642">//&nbsp;maximum&nbsp;ciphertext&nbsp;payload&nbsp;length</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442680">recordHeaderLen</span>&nbsp;<span class="op" id="4442696">=</span>&nbsp;<span class="num" id="4442698">5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4442711">//&nbsp;record&nbsp;header&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442736">maxHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4442752">=</span>&nbsp;<span class="num" id="4442754">65536</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4442767">//&nbsp;maximum&nbsp;handshake&nbsp;we&nbsp;support&nbsp;(protocol&nbsp;max&nbsp;is&nbsp;16&nbsp;MB)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442825">minVersion</span>&nbsp;<span class="op" id="4442836">=</span>&nbsp;<span class="ident" id="4442838"><a href="/gostd/crypto/tls/common.go.html#4442440">VersionSSL30</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442852">maxVersion</span>&nbsp;<span class="op" id="4442863">=</span>&nbsp;<span class="ident" id="4442865"><a href="/gostd/crypto/tls/common.go.html#4442509">VersionTLS12</a></span><br>
<span class="lineno">35</span><span class="op" id="4442878">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4442881">//&nbsp;TLS&nbsp;record&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4442902">type</span>&nbsp;<span class="ident" id="4442907">recordType</span>&nbsp;<span class="builtintype" id="4442918">uint8</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="4442925">const</span>&nbsp;<span class="op" id="4442931">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442934">recordTypeChangeCipherSpec</span>&nbsp;<span class="ident" id="4442961"><a href="/gostd/crypto/tls/common.go.html#4442907">recordType</a></span>&nbsp;<span class="op" id="4442972">=</span>&nbsp;<span class="num" id="4442974">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4442978">recordTypeAlert</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443005"><a href="/gostd/crypto/tls/common.go.html#4442907">recordType</a></span>&nbsp;<span class="op" id="4443016">=</span>&nbsp;<span class="num" id="4443018">21</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443022">recordTypeHandshake</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443049"><a href="/gostd/crypto/tls/common.go.html#4442907">recordType</a></span>&nbsp;<span class="op" id="4443060">=</span>&nbsp;<span class="num" id="4443062">22</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443066">recordTypeApplicationData</span>&nbsp;&nbsp;<span class="ident" id="4443093"><a href="/gostd/crypto/tls/common.go.html#4442907">recordType</a></span>&nbsp;<span class="op" id="4443104">=</span>&nbsp;<span class="num" id="4443106">23</span><br>
<span class="lineno">45</span><span class="op" id="4443109">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4443112">//&nbsp;TLS&nbsp;handshake&nbsp;message&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4443144">const</span>&nbsp;<span class="op" id="4443150">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443153">typeClientHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443176">uint8</span>&nbsp;<span class="op" id="4443182">=</span>&nbsp;<span class="num" id="4443184">1</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443187">typeServerHello</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443210">uint8</span>&nbsp;<span class="op" id="4443216">=</span>&nbsp;<span class="num" id="4443218">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443221">typeNewSessionTicket</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443244">uint8</span>&nbsp;<span class="op" id="4443250">=</span>&nbsp;<span class="num" id="4443252">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443255">typeCertificate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443278">uint8</span>&nbsp;<span class="op" id="4443284">=</span>&nbsp;<span class="num" id="4443286">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443290">typeServerKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4443313">uint8</span>&nbsp;<span class="op" id="4443319">=</span>&nbsp;<span class="num" id="4443321">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443325">typeCertificateRequest</span>&nbsp;<span class="builtintype" id="4443348">uint8</span>&nbsp;<span class="op" id="4443354">=</span>&nbsp;<span class="num" id="4443356">13</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443360">typeServerHelloDone</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443383">uint8</span>&nbsp;<span class="op" id="4443389">=</span>&nbsp;<span class="num" id="4443391">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443395">typeCertificateVerify</span>&nbsp;&nbsp;<span class="builtintype" id="4443418">uint8</span>&nbsp;<span class="op" id="4443424">=</span>&nbsp;<span class="num" id="4443426">15</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443430">typeClientKeyExchange</span>&nbsp;&nbsp;<span class="builtintype" id="4443453">uint8</span>&nbsp;<span class="op" id="4443459">=</span>&nbsp;<span class="num" id="4443461">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443465">typeFinished</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443488">uint8</span>&nbsp;<span class="op" id="4443494">=</span>&nbsp;<span class="num" id="4443496">20</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443500">typeCertificateStatus</span>&nbsp;&nbsp;<span class="builtintype" id="4443523">uint8</span>&nbsp;<span class="op" id="4443529">=</span>&nbsp;<span class="num" id="4443531">22</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443535">typeNextProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443558">uint8</span>&nbsp;<span class="op" id="4443564">=</span>&nbsp;<span class="num" id="4443566">67</span>&nbsp;<span class="comment" id="4443569">//&nbsp;Not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span><span class="op" id="4443590">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4443593">//&nbsp;TLS&nbsp;compression&nbsp;types.</span><br>
<span class="lineno"></span><span class="keyword" id="4443619">const</span>&nbsp;<span class="op" id="4443625">(</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443628">compressionNone</span>&nbsp;<span class="builtintype" id="4443644">uint8</span>&nbsp;<span class="op" id="4443650">=</span>&nbsp;<span class="num" id="4443652">0</span><br>
<span class="lineno"></span><span class="op" id="4443654">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4443657">//&nbsp;TLS&nbsp;extension&nbsp;numbers</span><br>
<span class="lineno"></span><span class="keyword" id="4443682">const</span>&nbsp;<span class="op" id="4443688">(</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443691">extensionServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443720">uint16</span>&nbsp;<span class="op" id="4443727">=</span>&nbsp;<span class="num" id="4443729">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443732">extensionStatusRequest</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443761">uint16</span>&nbsp;<span class="op" id="4443768">=</span>&nbsp;<span class="num" id="4443770">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443773">extensionSupportedCurves</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443802">uint16</span>&nbsp;<span class="op" id="4443809">=</span>&nbsp;<span class="num" id="4443811">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443815">extensionSupportedPoints</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443844">uint16</span>&nbsp;<span class="op" id="4443851">=</span>&nbsp;<span class="num" id="4443853">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443857">extensionSignatureAlgorithms</span>&nbsp;<span class="builtintype" id="4443886">uint16</span>&nbsp;<span class="op" id="4443893">=</span>&nbsp;<span class="num" id="4443895">13</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443899">extensionALPN</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443928">uint16</span>&nbsp;<span class="op" id="4443935">=</span>&nbsp;<span class="num" id="4443937">16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443941">extensionSessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4443970">uint16</span>&nbsp;<span class="op" id="4443977">=</span>&nbsp;<span class="num" id="4443979">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4443983">extensionNextProtoNeg</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4444012">uint16</span>&nbsp;<span class="op" id="4444019">=</span>&nbsp;<span class="num" id="4444021">13172</span>&nbsp;<span class="comment" id="4444027">//&nbsp;not&nbsp;IANA&nbsp;assigned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444049">extensionRenegotiationInfo</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4444078">uint16</span>&nbsp;<span class="op" id="4444085">=</span>&nbsp;<span class="num" id="4444087">0xff01</span><br>
<span class="lineno"></span><span class="op" id="4444094">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="comment" id="4444097">//&nbsp;TLS&nbsp;signaling&nbsp;cipher&nbsp;suite&nbsp;values</span><br>
<span class="lineno"></span><span class="keyword" id="4444134">const</span>&nbsp;<span class="op" id="4444140">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444143">scsvRenegotiation</span>&nbsp;<span class="builtintype" id="4444161">uint16</span>&nbsp;<span class="op" id="4444168">=</span>&nbsp;<span class="num" id="4444170">0x00ff</span><br>
<span class="lineno"></span><span class="op" id="4444177">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="comment" id="4444180">//&nbsp;CurveID&nbsp;is&nbsp;the&nbsp;type&nbsp;of&nbsp;a&nbsp;TLS&nbsp;identifier&nbsp;for&nbsp;an&nbsp;elliptic&nbsp;curve.&nbsp;See</span><br>
<span class="lineno"></span><span class="comment" id="4444250">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-8</span><br>
<span class="lineno"></span><span class="keyword" id="4444336">type</span>&nbsp;<span class="ident" id="4444341">CurveID</span>&nbsp;<span class="builtintype" id="4444349">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4444357">const</span>&nbsp;<span class="op" id="4444363">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444366">CurveP256</span>&nbsp;<span class="ident" id="4444376"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span>&nbsp;<span class="op" id="4444384">=</span>&nbsp;<span class="num" id="4444386">23</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444390">CurveP384</span>&nbsp;<span class="ident" id="4444400"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span>&nbsp;<span class="op" id="4444408">=</span>&nbsp;<span class="num" id="4444410">24</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444414">CurveP521</span>&nbsp;<span class="ident" id="4444424"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span>&nbsp;<span class="op" id="4444432">=</span>&nbsp;<span class="num" id="4444434">25</span><br>
<span class="lineno"></span><span class="op" id="4444437">)</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="4444440">//&nbsp;TLS&nbsp;Elliptic&nbsp;Curve&nbsp;Point&nbsp;Formats</span><br>
<span class="lineno"></span><span class="comment" id="4444476">//&nbsp;http://www.iana.org/assignments/tls-parameters/tls-parameters.xml#tls-parameters-9</span><br>
<span class="lineno"></span><span class="keyword" id="4444562">const</span>&nbsp;<span class="op" id="4444568">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444571">pointFormatUncompressed</span>&nbsp;<span class="builtintype" id="4444595">uint8</span>&nbsp;<span class="op" id="4444601">=</span>&nbsp;<span class="num" id="4444603">0</span><br>
<span class="lineno">100</span><span class="op" id="4444605">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4444608">//&nbsp;TLS&nbsp;CertificateStatusType&nbsp;(RFC&nbsp;3546)</span><br>
<span class="lineno"></span><span class="keyword" id="4444648">const</span>&nbsp;<span class="op" id="4444654">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444657">statusTypeOCSP</span>&nbsp;<span class="builtintype" id="4444672">uint8</span>&nbsp;<span class="op" id="4444678">=</span>&nbsp;<span class="num" id="4444680">1</span><br>
<span class="lineno">105</span><span class="op" id="4444682">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4444685">//&nbsp;Certificate&nbsp;types&nbsp;(for&nbsp;certificateRequestMsg)</span><br>
<span class="lineno"></span><span class="keyword" id="4444734">const</span>&nbsp;<span class="op" id="4444740">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444743">certTypeRSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4444762">=</span>&nbsp;<span class="num" id="4444764">1</span>&nbsp;<span class="comment" id="4444766">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;RSA&nbsp;key</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444806">certTypeDSSSign</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4444825">=</span>&nbsp;<span class="num" id="4444827">2</span>&nbsp;<span class="comment" id="4444829">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;DSA&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444868">certTypeRSAFixedDH</span>&nbsp;<span class="op" id="4444887">=</span>&nbsp;<span class="num" id="4444889">3</span>&nbsp;<span class="comment" id="4444891">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4444936">certTypeDSSFixedDH</span>&nbsp;<span class="op" id="4444955">=</span>&nbsp;<span class="num" id="4444957">4</span>&nbsp;<span class="comment" id="4444959">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;a&nbsp;static&nbsp;DH&nbsp;key</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4445005">//&nbsp;See&nbsp;RFC4492&nbsp;sections&nbsp;3&nbsp;and&nbsp;5.5.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445041">certTypeECDSASign</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4445064">=</span>&nbsp;<span class="num" id="4445066">64</span>&nbsp;<span class="comment" id="4445069">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDSA-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445146">certTypeRSAFixedECDH</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4445169">=</span>&nbsp;<span class="num" id="4445171">65</span>&nbsp;<span class="comment" id="4445174">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;RSA.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445248">certTypeECDSAFixedECDH</span>&nbsp;<span class="op" id="4445271">=</span>&nbsp;<span class="num" id="4445273">66</span>&nbsp;<span class="comment" id="4445276">//&nbsp;A&nbsp;certificate&nbsp;containing&nbsp;an&nbsp;ECDH-capable&nbsp;public&nbsp;key,&nbsp;signed&nbsp;with&nbsp;ECDSA.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4445353">//&nbsp;Rest&nbsp;of&nbsp;these&nbsp;are&nbsp;reserved&nbsp;by&nbsp;the&nbsp;TLS&nbsp;spec</span><br>
<span class="lineno">120</span><span class="op" id="4445399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4445402">//&nbsp;Hash&nbsp;functions&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4445462">const</span>&nbsp;<span class="op" id="4445468">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445471">hashSHA1</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4445482">uint8</span>&nbsp;<span class="op" id="4445488">=</span>&nbsp;<span class="num" id="4445490">2</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445493">hashSHA256</span>&nbsp;<span class="builtintype" id="4445504">uint8</span>&nbsp;<span class="op" id="4445510">=</span>&nbsp;<span class="num" id="4445512">4</span><br>
<span class="lineno"></span><span class="op" id="4445514">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4445517">//&nbsp;Signature&nbsp;algorithms&nbsp;for&nbsp;TLS&nbsp;1.2&nbsp;(See&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1)</span><br>
<span class="lineno"></span><span class="keyword" id="4445583">const</span>&nbsp;<span class="op" id="4445589">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445592">signatureRSA</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4445607">uint8</span>&nbsp;<span class="op" id="4445613">=</span>&nbsp;<span class="num" id="4445615">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445618">signatureECDSA</span>&nbsp;<span class="builtintype" id="4445633">uint8</span>&nbsp;<span class="op" id="4445639">=</span>&nbsp;<span class="num" id="4445641">3</span><br>
<span class="lineno"></span><span class="op" id="4445643">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4445646">//&nbsp;signatureAndHash&nbsp;mirrors&nbsp;the&nbsp;TLS&nbsp;1.2,&nbsp;SignatureAndHashAlgorithm&nbsp;struct.&nbsp;See</span><br>
<span class="lineno">135</span><span class="comment" id="4445725">//&nbsp;RFC&nbsp;5246,&nbsp;section&nbsp;A.4.1.</span><br>
<span class="lineno"></span><span class="keyword" id="4445753">type</span>&nbsp;<span class="ident" id="4445758">signatureAndHash</span>&nbsp;<span class="keyword" id="4445775">struct</span>&nbsp;<span class="op" id="4445782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4445785">hash</span><span class="op" id="4445789">,</span>&nbsp;<span class="ident" id="4445791">signature</span>&nbsp;<span class="builtintype" id="4445801">uint8</span><br>
<span class="lineno"></span><span class="op" id="4445807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span><span class="comment" id="4445810">//&nbsp;supportedSKXSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash&nbsp;algorithms</span><br>
<span class="lineno"></span><span class="comment" id="4445888">//&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2&nbsp;ClientHello.</span><br>
<span class="lineno"></span><span class="keyword" id="4445955">var</span>&nbsp;<span class="ident" id="4445959">supportedSKXSignatureAlgorithms</span>&nbsp;<span class="op" id="4445991">=</span>&nbsp;<span class="op" id="4445993">[</span><span class="op" id="4445994">]</span><span class="ident" id="4445995"><a href="/gostd/crypto/tls/common.go.html#4445758">signatureAndHash</a></span><span class="op" id="4446011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446014">{</span><span class="ident" id="4446015"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4446025">,</span>&nbsp;<span class="ident" id="4446027"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4446039">}</span><span class="op" id="4446040">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446043">{</span><span class="ident" id="4446044"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4446054">,</span>&nbsp;<span class="ident" id="4446056"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4446070">}</span><span class="op" id="4446071">,</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446074">{</span><span class="ident" id="4446075"><a href="/gostd/crypto/tls/common.go.html#4445471">hashSHA1</a></span><span class="op" id="4446083">,</span>&nbsp;<span class="ident" id="4446085"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4446097">}</span><span class="op" id="4446098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446101">{</span><span class="ident" id="4446102"><a href="/gostd/crypto/tls/common.go.html#4445471">hashSHA1</a></span><span class="op" id="4446110">,</span>&nbsp;<span class="ident" id="4446112"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4446126">}</span><span class="op" id="4446127">,</span><br>
<span class="lineno"></span><span class="op" id="4446129">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446132">//&nbsp;supportedClientCertSignatureAlgorithms&nbsp;contains&nbsp;the&nbsp;signature&nbsp;and&nbsp;hash</span><br>
<span class="lineno">150</span><span class="comment" id="4446206">//&nbsp;algorithms&nbsp;that&nbsp;the&nbsp;code&nbsp;advertises&nbsp;as&nbsp;supported&nbsp;in&nbsp;a&nbsp;TLS&nbsp;1.2</span><br>
<span class="lineno"></span><span class="comment" id="4446271">//&nbsp;CertificateRequest.</span><br>
<span class="lineno"></span><span class="keyword" id="4446294">var</span>&nbsp;<span class="ident" id="4446298">supportedClientCertSignatureAlgorithms</span>&nbsp;<span class="op" id="4446337">=</span>&nbsp;<span class="op" id="4446339">[</span><span class="op" id="4446340">]</span><span class="ident" id="4446341"><a href="/gostd/crypto/tls/common.go.html#4445758">signatureAndHash</a></span><span class="op" id="4446357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446360">{</span><span class="ident" id="4446361"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4446371">,</span>&nbsp;<span class="ident" id="4446373"><a href="/gostd/crypto/tls/common.go.html#4445592">signatureRSA</a></span><span class="op" id="4446385">}</span><span class="op" id="4446386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4446389">{</span><span class="ident" id="4446390"><a href="/gostd/crypto/tls/common.go.html#4445493">hashSHA256</a></span><span class="op" id="4446400">,</span>&nbsp;<span class="ident" id="4446402"><a href="/gostd/crypto/tls/common.go.html#4445618">signatureECDSA</a></span><span class="op" id="4446416">}</span><span class="op" id="4446417">,</span><br>
<span class="lineno">155</span><span class="op" id="4446419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4446422">//&nbsp;ConnectionState&nbsp;records&nbsp;basic&nbsp;TLS&nbsp;details&nbsp;about&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="4446489">type</span>&nbsp;<span class="ident" id="4446494">ConnectionState</span>&nbsp;<span class="keyword" id="4446510">struct</span>&nbsp;<span class="op" id="4446517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446520">Version</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4446547">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4446569">//&nbsp;TLS&nbsp;version&nbsp;used&nbsp;by&nbsp;the&nbsp;connection&nbsp;(e.g.&nbsp;VersionTLS12)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446628">HandshakeComplete</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4446655">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4446677">//&nbsp;TLS&nbsp;handshake&nbsp;is&nbsp;complete</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446707">DidResume</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4446734">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4446756">//&nbsp;connection&nbsp;resumes&nbsp;a&nbsp;previous&nbsp;TLS&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446805">CipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4446832">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4446854">//&nbsp;cipher&nbsp;suite&nbsp;in&nbsp;use&nbsp;(TLS_RSA_WITH_RC4_128_SHA,&nbsp;...)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4446910">NegotiatedProtocol</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4446937">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4446959">//&nbsp;negotiated&nbsp;next&nbsp;protocol&nbsp;(from&nbsp;Config.NextProtos)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447013">NegotiatedProtocolIsMutual</span>&nbsp;<span class="builtintype" id="4447040">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447062">//&nbsp;negotiated&nbsp;protocol&nbsp;was&nbsp;advertised&nbsp;by&nbsp;server</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447111">ServerName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4447138">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447160">//&nbsp;server&nbsp;name&nbsp;requested&nbsp;by&nbsp;client,&nbsp;if&nbsp;any&nbsp;(server&nbsp;side&nbsp;only)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447223">PeerCertificates</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4447250">[</span><span class="op" id="4447251">]</span><span class="op" id="4447252">*</span><span class="ident" id="4447253"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4447257">.</span><span class="ident" id="4447258"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span>&nbsp;&nbsp;&nbsp;<span class="comment" id="4447272">//&nbsp;certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;remote&nbsp;peer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447319">VerifiedChains</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4447346">[</span><span class="op" id="4447347">]</span><span class="op" id="4447348">[</span><span class="op" id="4447349">]</span><span class="op" id="4447350">*</span><span class="ident" id="4447351"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4447355">.</span><span class="ident" id="4447356"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span>&nbsp;<span class="comment" id="4447368">//&nbsp;verified&nbsp;chains&nbsp;built&nbsp;from&nbsp;PeerCertificates</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447417">//&nbsp;TLSUnique&nbsp;contains&nbsp;the&nbsp;&#34;tls-unique&#34;&nbsp;channel&nbsp;binding&nbsp;value&nbsp;(see&nbsp;RFC</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447488">//&nbsp;5929,&nbsp;section&nbsp;3).&nbsp;For&nbsp;resumed&nbsp;sessions&nbsp;this&nbsp;value&nbsp;will&nbsp;be&nbsp;nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447554">//&nbsp;because&nbsp;resumption&nbsp;does&nbsp;not&nbsp;include&nbsp;enough&nbsp;context&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447614">//&nbsp;https://secure-resumption.com/#channelbindings).&nbsp;This&nbsp;will&nbsp;change&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447687">//&nbsp;future&nbsp;versions&nbsp;of&nbsp;Go&nbsp;once&nbsp;the&nbsp;TLS&nbsp;master-secret&nbsp;fix&nbsp;has&nbsp;been</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4447753">//&nbsp;standardized&nbsp;and&nbsp;implemented.</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447787">TLSUnique</span>&nbsp;<span class="op" id="4447797">[</span><span class="op" id="4447798">]</span><span class="builtintype" id="4447799">byte</span><br>
<span class="lineno"></span><span class="op" id="4447804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4447807">//&nbsp;ClientAuthType&nbsp;declares&nbsp;the&nbsp;policy&nbsp;the&nbsp;server&nbsp;will&nbsp;follow&nbsp;for</span><br>
<span class="lineno"></span><span class="comment" id="4447872">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.</span><br>
<span class="lineno">180</span><span class="keyword" id="4447902">type</span>&nbsp;<span class="ident" id="4447907">ClientAuthType</span>&nbsp;<span class="builtintype" id="4447922">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4447927">const</span>&nbsp;<span class="op" id="4447933">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447936">NoClientCert</span>&nbsp;<span class="ident" id="4447949"><a href="/gostd/crypto/tls/common.go.html#4447907">ClientAuthType</a></span>&nbsp;<span class="op" id="4447964">=</span>&nbsp;<span class="ident" id="4447966">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447972">RequestClientCert</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4447991">RequireAnyClientCert</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448013">VerifyClientCertIfGiven</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448038">RequireAndVerifyClientCert</span><br>
<span class="lineno"></span><span class="op" id="4448065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4448068">//&nbsp;ClientSessionState&nbsp;contains&nbsp;the&nbsp;state&nbsp;needed&nbsp;by&nbsp;clients&nbsp;to&nbsp;resume&nbsp;TLS</span><br>
<span class="lineno"></span><span class="comment" id="4448141">//&nbsp;sessions.</span><br>
<span class="lineno"></span><span class="keyword" id="4448154">type</span>&nbsp;<span class="ident" id="4448159">ClientSessionState</span>&nbsp;<span class="keyword" id="4448178">struct</span>&nbsp;<span class="op" id="4448185">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448188">sessionTicket</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4448207">[</span><span class="op" id="4448208">]</span><span class="builtintype" id="4448209">uint8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448227">//&nbsp;Encrypted&nbsp;ticket&nbsp;used&nbsp;for&nbsp;session&nbsp;resumption&nbsp;with&nbsp;server</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448288">vers</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4448307">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448327">//&nbsp;SSL/TLS&nbsp;version&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448374">cipherSuite</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4448393">uint16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448413">//&nbsp;Ciphersuite&nbsp;negotiated&nbsp;for&nbsp;the&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448456">masterSecret</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4448475">[</span><span class="op" id="4448476">]</span><span class="builtintype" id="4448477">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448495">//&nbsp;MasterSecret&nbsp;generated&nbsp;by&nbsp;client&nbsp;on&nbsp;a&nbsp;full&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4448552">serverCertificates</span>&nbsp;<span class="op" id="4448571">[</span><span class="op" id="4448572">]</span><span class="op" id="4448573">*</span><span class="ident" id="4448574"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4448578">.</span><span class="ident" id="4448579"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span>&nbsp;<span class="comment" id="4448591">//&nbsp;Certificate&nbsp;chain&nbsp;presented&nbsp;by&nbsp;the&nbsp;server</span><br>
<span class="lineno"></span><span class="op" id="4448636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span><span class="comment" id="4448639">//&nbsp;ClientSessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;objects&nbsp;that&nbsp;can&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="4448719">//&nbsp;by&nbsp;a&nbsp;client&nbsp;to&nbsp;resume&nbsp;a&nbsp;TLS&nbsp;session&nbsp;with&nbsp;a&nbsp;given&nbsp;server.&nbsp;ClientSessionCache</span><br>
<span class="lineno"></span><span class="comment" id="4448798">//&nbsp;implementations&nbsp;should&nbsp;expect&nbsp;to&nbsp;be&nbsp;called&nbsp;concurrently&nbsp;from&nbsp;different</span><br>
<span class="lineno"></span><span class="comment" id="4448872">//&nbsp;goroutines.</span><br>
<span class="lineno"></span><span class="keyword" id="4448887">type</span>&nbsp;<span class="ident" id="4448892">ClientSessionCache</span>&nbsp;<span class="keyword" id="4448911">interface</span>&nbsp;<span class="op" id="4448921">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448924">//&nbsp;Get&nbsp;searches&nbsp;for&nbsp;a&nbsp;ClientSessionState&nbsp;associated&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4448997">//&nbsp;On&nbsp;return,&nbsp;ok&nbsp;is&nbsp;true&nbsp;if&nbsp;one&nbsp;was&nbsp;found.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4449041">Get</span><span class="op" id="4449044">(</span><span class="ident" id="4449045">sessionKey</span>&nbsp;<span class="builtintype" id="4449056">string</span><span class="op" id="4449062">)</span>&nbsp;<span class="op" id="4449064">(</span><span class="ident" id="4449065">session</span>&nbsp;<span class="op" id="4449073">*</span><span class="ident" id="4449074"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="4449092">,</span>&nbsp;<span class="ident" id="4449094">ok</span>&nbsp;<span class="builtintype" id="4449097">bool</span><span class="op" id="4449101">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449105">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;ClientSessionState&nbsp;to&nbsp;the&nbsp;cache&nbsp;with&nbsp;the&nbsp;given&nbsp;key.</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4449174">Put</span><span class="op" id="4449177">(</span><span class="ident" id="4449178">sessionKey</span>&nbsp;<span class="builtintype" id="4449189">string</span><span class="op" id="4449195">,</span>&nbsp;<span class="ident" id="4449197">cs</span>&nbsp;<span class="op" id="4449200">*</span><span class="ident" id="4449201"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="4449219">)</span><br>
<span class="lineno"></span><span class="op" id="4449221">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4449224">//&nbsp;ClientHelloInfo&nbsp;contains&nbsp;information&nbsp;from&nbsp;a&nbsp;ClientHello&nbsp;message&nbsp;in&nbsp;order&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4449303">//&nbsp;guide&nbsp;certificate&nbsp;selection&nbsp;in&nbsp;the&nbsp;GetCertificate&nbsp;callback.</span><br>
<span class="lineno">215</span><span class="keyword" id="4449366">type</span>&nbsp;<span class="ident" id="4449371">ClientHelloInfo</span>&nbsp;<span class="keyword" id="4449387">struct</span>&nbsp;<span class="op" id="4449394">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449397">//&nbsp;CipherSuites&nbsp;lists&nbsp;the&nbsp;CipherSuites&nbsp;supported&nbsp;by&nbsp;the&nbsp;client&nbsp;(e.g.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449467">//&nbsp;TLS_RSA_WITH_RC4_128_SHA).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4449498">CipherSuites</span>&nbsp;<span class="op" id="4449511">[</span><span class="op" id="4449512">]</span><span class="builtintype" id="4449513">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449522">//&nbsp;ServerName&nbsp;indicates&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;server&nbsp;requested&nbsp;by&nbsp;the&nbsp;client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449594">//&nbsp;in&nbsp;order&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.&nbsp;ServerName&nbsp;is&nbsp;only&nbsp;set&nbsp;if&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449665">//&nbsp;client&nbsp;is&nbsp;using&nbsp;SNI&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449694">//&nbsp;http://tools.ietf.org/html/rfc4366#section-3.1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4449747">ServerName</span>&nbsp;<span class="builtintype" id="4449758">string</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449767">//&nbsp;SupportedCurves&nbsp;lists&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449838">//&nbsp;SupportedCurves&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Elliptic&nbsp;Curves</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449903">//&nbsp;Extension&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4449936">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.1).</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4449991">SupportedCurves</span>&nbsp;<span class="op" id="4450007">[</span><span class="op" id="4450008">]</span><span class="ident" id="4450009"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450019">//&nbsp;SupportedPoints&nbsp;lists&nbsp;the&nbsp;point&nbsp;formats&nbsp;supported&nbsp;by&nbsp;the&nbsp;client.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450088">//&nbsp;SupportedPoints&nbsp;is&nbsp;set&nbsp;only&nbsp;if&nbsp;the&nbsp;Supported&nbsp;Point&nbsp;Formats&nbsp;Extension</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450161">//&nbsp;is&nbsp;being&nbsp;used&nbsp;(see</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450184">//&nbsp;http://tools.ietf.org/html/rfc4492#section-5.1.2).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4450239">SupportedPoints</span>&nbsp;<span class="op" id="4450255">[</span><span class="op" id="4450256">]</span><span class="builtintype" id="4450257">uint8</span><br>
<span class="lineno"></span><span class="op" id="4450263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4450266">//&nbsp;A&nbsp;Config&nbsp;structure&nbsp;is&nbsp;used&nbsp;to&nbsp;configure&nbsp;a&nbsp;TLS&nbsp;client&nbsp;or&nbsp;server.</span><br>
<span class="lineno">240</span><span class="comment" id="4450333">//&nbsp;After&nbsp;one&nbsp;has&nbsp;been&nbsp;passed&nbsp;to&nbsp;a&nbsp;TLS&nbsp;function&nbsp;it&nbsp;must&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="4450395">//&nbsp;modified.&nbsp;A&nbsp;Config&nbsp;may&nbsp;be&nbsp;reused;&nbsp;the&nbsp;tls&nbsp;package&nbsp;will&nbsp;also&nbsp;not</span><br>
<span class="lineno"></span><span class="comment" id="4450462">//&nbsp;modify&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="4450476">type</span>&nbsp;<span class="ident" id="4450481">Config</span>&nbsp;<span class="keyword" id="4450488">struct</span>&nbsp;<span class="op" id="4450495">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450498">//&nbsp;Rand&nbsp;provides&nbsp;the&nbsp;source&nbsp;of&nbsp;entropy&nbsp;for&nbsp;nonces&nbsp;and&nbsp;RSA&nbsp;blinding.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450567">//&nbsp;If&nbsp;Rand&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;cryptographic&nbsp;random&nbsp;reader&nbsp;in&nbsp;package</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450639">//&nbsp;crypto/rand.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450656">//&nbsp;The&nbsp;Reader&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4450716">Rand</span>&nbsp;<span class="ident" id="4450721"><a href="/gostd/crypto/tls/common.go.html#4442384">io</a></span><span class="op" id="4450723">.</span><span class="ident" id="4450724"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450733">//&nbsp;Time&nbsp;returns&nbsp;the&nbsp;current&nbsp;time&nbsp;as&nbsp;the&nbsp;number&nbsp;of&nbsp;seconds&nbsp;since&nbsp;the&nbsp;epoch.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450809">//&nbsp;If&nbsp;Time&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;time.Now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4450848">Time</span>&nbsp;<span class="keyword" id="4450853">func</span><span class="op" id="4450857">(</span><span class="op" id="4450858">)</span>&nbsp;<span class="ident" id="4450860"><a href="/gostd/crypto/tls/common.go.html#4442421">time</a></span><span class="op" id="4450864">.</span><span class="ident" id="4450865"><a href="/gostd/time/time.go.html#2722087">Time</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450872">//&nbsp;Certificates&nbsp;contains&nbsp;one&nbsp;or&nbsp;more&nbsp;certificate&nbsp;chains</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450929">//&nbsp;to&nbsp;present&nbsp;to&nbsp;the&nbsp;other&nbsp;side&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4450981">//&nbsp;Server&nbsp;configurations&nbsp;must&nbsp;include&nbsp;at&nbsp;least&nbsp;one&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4451046">Certificates</span>&nbsp;<span class="op" id="4451059">[</span><span class="op" id="4451060">]</span><span class="ident" id="4451061"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451075">//&nbsp;NameToCertificate&nbsp;maps&nbsp;from&nbsp;a&nbsp;certificate&nbsp;name&nbsp;to&nbsp;an&nbsp;element&nbsp;of</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451143">//&nbsp;Certificates.&nbsp;Note&nbsp;that&nbsp;a&nbsp;certificate&nbsp;name&nbsp;can&nbsp;be&nbsp;of&nbsp;the&nbsp;form</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451209">//&nbsp;&#39;*.example.com&#39;&nbsp;and&nbsp;so&nbsp;doesn&#39;t&nbsp;have&nbsp;to&nbsp;be&nbsp;a&nbsp;domain&nbsp;name&nbsp;as&nbsp;such.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451278">//&nbsp;See&nbsp;Config.BuildNameToCertificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451316">//&nbsp;The&nbsp;nil&nbsp;value&nbsp;causes&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;to&nbsp;be&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451386">//&nbsp;for&nbsp;all&nbsp;connections.</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4451411">NameToCertificate</span>&nbsp;<span class="keyword" id="4451429">map</span><span class="op" id="4451432">[</span><span class="builtintype" id="4451433">string</span><span class="op" id="4451439">]</span><span class="op" id="4451440">*</span><span class="ident" id="4451441"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451455">//&nbsp;GetCertificate&nbsp;returns&nbsp;a&nbsp;Certificate&nbsp;based&nbsp;on&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451515">//&nbsp;ClientHelloInfo.&nbsp;If&nbsp;GetCertificate&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;nil,&nbsp;then&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451586">//&nbsp;certificate&nbsp;is&nbsp;retrieved&nbsp;from&nbsp;NameToCertificate.&nbsp;If</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451642">//&nbsp;NameToCertificate&nbsp;is&nbsp;nil,&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Certificates&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451714">//&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4451724">GetCertificate</span>&nbsp;<span class="keyword" id="4451739">func</span><span class="op" id="4451743">(</span><span class="ident" id="4451744">clientHello</span>&nbsp;<span class="op" id="4451756">*</span><span class="ident" id="4451757"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="4451772">)</span>&nbsp;<span class="op" id="4451774">(</span><span class="op" id="4451775">*</span><span class="ident" id="4451776"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4451787">,</span>&nbsp;<span class="builtintype" id="4451789">error</span><span class="op" id="4451794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451798">//&nbsp;RootCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451858">//&nbsp;that&nbsp;clients&nbsp;use&nbsp;when&nbsp;verifying&nbsp;server&nbsp;certificates.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451915">//&nbsp;If&nbsp;RootCAs&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;the&nbsp;host&#39;s&nbsp;root&nbsp;CA&nbsp;set.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4451971">RootCAs</span>&nbsp;<span class="op" id="4451979">*</span><span class="ident" id="4451980"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4451984">.</span><span class="ident" id="4451985"><a href="/gostd/crypto/x509/cert_pool.go.html#4613426">CertPool</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4451996">//&nbsp;NextProtos&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported,&nbsp;application&nbsp;level&nbsp;protocols.</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4452064">NextProtos</span>&nbsp;<span class="op" id="4452075">[</span><span class="op" id="4452076">]</span><span class="builtintype" id="4452077">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452086">//&nbsp;ServerName&nbsp;is&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;hostname&nbsp;on&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452148">//&nbsp;certificates&nbsp;unless&nbsp;InsecureSkipVerify&nbsp;is&nbsp;given.&nbsp;It&nbsp;is&nbsp;also&nbsp;included</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452221">//&nbsp;in&nbsp;the&nbsp;client&#39;s&nbsp;handshake&nbsp;to&nbsp;support&nbsp;virtual&nbsp;hosting.</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4452279">ServerName</span>&nbsp;<span class="builtintype" id="4452290">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452299">//&nbsp;ClientAuth&nbsp;determines&nbsp;the&nbsp;server&#39;s&nbsp;policy&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452349">//&nbsp;TLS&nbsp;Client&nbsp;Authentication.&nbsp;The&nbsp;default&nbsp;is&nbsp;NoClientCert.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4452409">ClientAuth</span>&nbsp;<span class="ident" id="4452420"><a href="/gostd/crypto/tls/common.go.html#4447907">ClientAuthType</a></span><br>
<span class="lineno">290</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452437">//&nbsp;ClientCAs&nbsp;defines&nbsp;the&nbsp;set&nbsp;of&nbsp;root&nbsp;certificate&nbsp;authorities</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452499">//&nbsp;that&nbsp;servers&nbsp;use&nbsp;if&nbsp;required&nbsp;to&nbsp;verify&nbsp;a&nbsp;client&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452563">//&nbsp;by&nbsp;the&nbsp;policy&nbsp;in&nbsp;ClientAuth.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4452596">ClientCAs</span>&nbsp;<span class="op" id="4452606">*</span><span class="ident" id="4452607"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4452611">.</span><span class="ident" id="4452612"><a href="/gostd/crypto/x509/cert_pool.go.html#4613426">CertPool</a></span><br>
<span class="lineno">295</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452623">//&nbsp;InsecureSkipVerify&nbsp;controls&nbsp;whether&nbsp;a&nbsp;client&nbsp;verifies&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452685">//&nbsp;server&#39;s&nbsp;certificate&nbsp;chain&nbsp;and&nbsp;host&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452731">//&nbsp;If&nbsp;InsecureSkipVerify&nbsp;is&nbsp;true,&nbsp;TLS&nbsp;accepts&nbsp;any&nbsp;certificate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452794">//&nbsp;presented&nbsp;by&nbsp;the&nbsp;server&nbsp;and&nbsp;any&nbsp;host&nbsp;name&nbsp;in&nbsp;that&nbsp;certificate.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452861">//&nbsp;In&nbsp;this&nbsp;mode,&nbsp;TLS&nbsp;is&nbsp;susceptible&nbsp;to&nbsp;man-in-the-middle&nbsp;attacks.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452928">//&nbsp;This&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;for&nbsp;testing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4452970">InsecureSkipVerify</span>&nbsp;<span class="builtintype" id="4452989">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4452996">//&nbsp;CipherSuites&nbsp;is&nbsp;a&nbsp;list&nbsp;of&nbsp;supported&nbsp;cipher&nbsp;suites.&nbsp;If&nbsp;CipherSuites</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453067">//&nbsp;is&nbsp;nil,&nbsp;TLS&nbsp;uses&nbsp;a&nbsp;list&nbsp;of&nbsp;suites&nbsp;supported&nbsp;by&nbsp;the&nbsp;implementation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4453138">CipherSuites</span>&nbsp;<span class="op" id="4453151">[</span><span class="op" id="4453152">]</span><span class="builtintype" id="4453153">uint16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453162">//&nbsp;PreferServerCipherSuites&nbsp;controls&nbsp;whether&nbsp;the&nbsp;server&nbsp;selects&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453231">//&nbsp;client&#39;s&nbsp;most&nbsp;preferred&nbsp;ciphersuite,&nbsp;or&nbsp;the&nbsp;server&#39;s&nbsp;most&nbsp;preferred</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453303">//&nbsp;ciphersuite.&nbsp;If&nbsp;true&nbsp;then&nbsp;the&nbsp;server&#39;s&nbsp;preference,&nbsp;as&nbsp;expressed&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453374">//&nbsp;the&nbsp;order&nbsp;of&nbsp;elements&nbsp;in&nbsp;CipherSuites,&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4453426">PreferServerCipherSuites</span>&nbsp;<span class="builtintype" id="4453451">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453458">//&nbsp;SessionTicketsDisabled&nbsp;may&nbsp;be&nbsp;set&nbsp;to&nbsp;true&nbsp;to&nbsp;disable&nbsp;session&nbsp;ticket</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453530">//&nbsp;(resumption)&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4453556">SessionTicketsDisabled</span>&nbsp;<span class="builtintype" id="4453579">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453586">//&nbsp;SessionTicketKey&nbsp;is&nbsp;used&nbsp;by&nbsp;TLS&nbsp;servers&nbsp;to&nbsp;provide&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453649">//&nbsp;resumption.&nbsp;See&nbsp;RFC&nbsp;5077.&nbsp;If&nbsp;zero,&nbsp;it&nbsp;will&nbsp;be&nbsp;filled&nbsp;with</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453711">//&nbsp;random&nbsp;data&nbsp;before&nbsp;the&nbsp;first&nbsp;server&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453762">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453766">//&nbsp;If&nbsp;multiple&nbsp;servers&nbsp;are&nbsp;terminating&nbsp;connections&nbsp;for&nbsp;the&nbsp;same&nbsp;host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453836">//&nbsp;they&nbsp;should&nbsp;all&nbsp;have&nbsp;the&nbsp;same&nbsp;SessionTicketKey.&nbsp;If&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453895">//&nbsp;SessionTicketKey&nbsp;leaks,&nbsp;previously&nbsp;recorded&nbsp;and&nbsp;future&nbsp;TLS</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4453958">//&nbsp;connections&nbsp;using&nbsp;that&nbsp;key&nbsp;are&nbsp;compromised.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454006">SessionTicketKey</span>&nbsp;<span class="op" id="4454023">[</span><span class="num" id="4454024">32</span><span class="op" id="4454026">]</span><span class="builtintype" id="4454027">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454034">//&nbsp;SessionCache&nbsp;is&nbsp;a&nbsp;cache&nbsp;of&nbsp;ClientSessionState&nbsp;entries&nbsp;for&nbsp;TLS&nbsp;session</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454108">//&nbsp;resumption.</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454124">ClientSessionCache</span>&nbsp;<span class="ident" id="4454143"><a href="/gostd/crypto/tls/common.go.html#4448892">ClientSessionCache</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454164">//&nbsp;MinVersion&nbsp;contains&nbsp;the&nbsp;minimum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454236">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;SSLv3&nbsp;is&nbsp;taken&nbsp;as&nbsp;the&nbsp;minimum.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454285">MinVersion</span>&nbsp;<span class="builtintype" id="4454296">uint16</span><br>
<span class="lineno">335</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454305">//&nbsp;MaxVersion&nbsp;contains&nbsp;the&nbsp;maximum&nbsp;SSL/TLS&nbsp;version&nbsp;that&nbsp;is&nbsp;acceptable.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454377">//&nbsp;If&nbsp;zero,&nbsp;then&nbsp;the&nbsp;maximum&nbsp;version&nbsp;supported&nbsp;by&nbsp;this&nbsp;package&nbsp;is&nbsp;used,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454450">//&nbsp;which&nbsp;is&nbsp;currently&nbsp;TLS&nbsp;1.2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454482">MaxVersion</span>&nbsp;<span class="builtintype" id="4454493">uint16</span><br>
<span class="lineno">340</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454502">//&nbsp;CurvePreferences&nbsp;contains&nbsp;the&nbsp;elliptic&nbsp;curves&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454573">//&nbsp;an&nbsp;ECDHE&nbsp;handshake,&nbsp;in&nbsp;preference&nbsp;order.&nbsp;If&nbsp;empty,&nbsp;the&nbsp;default&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454645">//&nbsp;be&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454658">CurvePreferences</span>&nbsp;<span class="op" id="4454675">[</span><span class="op" id="4454676">]</span><span class="ident" id="4454677"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4454687">serverInitOnce</span>&nbsp;<span class="ident" id="4454702"><a href="/gostd/crypto/tls/common.go.html#4442413">sync</a></span><span class="op" id="4454706">.</span><span class="ident" id="4454707"><a href="/gostd/sync/once.go.html#1446221">Once</a></span>&nbsp;<span class="comment" id="4454712">//&nbsp;guards&nbsp;calling&nbsp;(*Config).serverInit</span><br>
<span class="lineno"></span><span class="op" id="4454751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4454754">func</span>&nbsp;<span class="op" id="4454759">(</span><span class="ident" id="4454760">c</span>&nbsp;<span class="op" id="4454762">*</span><span class="ident" id="4454763"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4454769">)</span>&nbsp;<span class="ident" id="4454771">serverInit</span><span class="op" id="4454781">(</span><span class="op" id="4454782">)</span>&nbsp;<span class="op" id="4454784">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454787">if</span>&nbsp;<span class="ident" id="4454790"><a href="/gostd/crypto/tls/common.go.html#4454760">c</a></span><span class="op" id="4454791">.</span><span class="ident" id="4454792"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span>&nbsp;<span class="op" id="4454815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454819">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4454831">//&nbsp;If&nbsp;the&nbsp;key&nbsp;has&nbsp;already&nbsp;been&nbsp;set&nbsp;then&nbsp;we&nbsp;have&nbsp;nothing&nbsp;to&nbsp;do.</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454895">for</span>&nbsp;<span class="ident" id="4454899">_</span><span class="op" id="4454900">,</span>&nbsp;<span class="ident" id="4454902">b</span>&nbsp;<span class="op" id="4454904">:=</span>&nbsp;<span class="keyword" id="4454907">range</span>&nbsp;<span class="ident" id="4454913"><a href="/gostd/crypto/tls/common.go.html#4454760">c</a></span><span class="op" id="4454914">.</span><span class="ident" id="4454915"><a href="/gostd/crypto/tls/common.go.html#4454006">SessionTicketKey</a></span>&nbsp;<span class="op" id="4454932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454936">if</span>&nbsp;<span class="ident" id="4454939"><a href="/gostd/crypto/tls/common.go.html#4454902">b</a></span>&nbsp;<span class="op" id="4454941">!=</span>&nbsp;<span class="num" id="4454944">0</span>&nbsp;<span class="op" id="4454946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454951">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4454963">}</span><br>
<span class="lineno">360</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4454967">if</span>&nbsp;<span class="ident" id="4454970">_</span><span class="op" id="4454971">,</span>&nbsp;<span class="ident" id="4454973">err</span>&nbsp;<span class="op" id="4454977">:=</span>&nbsp;<span class="ident" id="4454980"><a href="/gostd/crypto/tls/common.go.html#4442384">io</a></span><span class="op" id="4454982">.</span><span class="ident" id="4454983"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4454991">(</span><span class="ident" id="4454992"><a href="/gostd/crypto/tls/common.go.html#4454760">c</a></span><span class="op" id="4454993">.</span><span class="ident" id="4454994"><a href="/gostd/crypto/tls/common.go.html#4455096">rand</a></span><span class="op" id="4454998">(</span><span class="op" id="4454999">)</span><span class="op" id="4455000">,</span>&nbsp;<span class="ident" id="4455002"><a href="/gostd/crypto/tls/common.go.html#4454760">c</a></span><span class="op" id="4455003">.</span><span class="ident" id="4455004"><a href="/gostd/crypto/tls/common.go.html#4454006">SessionTicketKey</a></span><span class="op" id="4455020">[</span><span class="op" id="4455021">:</span><span class="op" id="4455022">]</span><span class="op" id="4455023">)</span><span class="op" id="4455024">;</span>&nbsp;<span class="ident" id="4455026"><a href="/gostd/crypto/tls/common.go.html#4454973">err</a></span>&nbsp;<span class="op" id="4455030">!=</span>&nbsp;<span class="builtintype" id="4455033">nil</span>&nbsp;<span class="op" id="4455037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455041"><a href="/gostd/crypto/tls/common.go.html#4454760">c</a></span><span class="op" id="4455042">.</span><span class="ident" id="4455043"><a href="/gostd/crypto/tls/common.go.html#4453556">SessionTicketsDisabled</a></span>&nbsp;<span class="op" id="4455066">=</span>&nbsp;<span class="builtintype" id="4455068">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455074">}</span><br>
<span class="lineno"></span><span class="op" id="4455076">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="4455079">func</span>&nbsp;<span class="op" id="4455084">(</span><span class="ident" id="4455085">c</span>&nbsp;<span class="op" id="4455087">*</span><span class="ident" id="4455088"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455094">)</span>&nbsp;<span class="ident" id="4455096">rand</span><span class="op" id="4455100">(</span><span class="op" id="4455101">)</span>&nbsp;<span class="ident" id="4455103"><a href="/gostd/crypto/tls/common.go.html#4442384">io</a></span><span class="op" id="4455105">.</span><span class="ident" id="4455106"><a href="/gostd/io/io.go.html#1421823">Reader</a></span>&nbsp;<span class="op" id="4455113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455116">r</span>&nbsp;<span class="op" id="4455118">:=</span>&nbsp;<span class="ident" id="4455121"><a href="/gostd/crypto/tls/common.go.html#4455085">c</a></span><span class="op" id="4455122">.</span><span class="ident" id="4455123"><a href="/gostd/crypto/tls/common.go.html#4450716">Rand</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455129">if</span>&nbsp;<span class="ident" id="4455132"><a href="/gostd/crypto/tls/common.go.html#4455116">r</a></span>&nbsp;<span class="op" id="4455134">==</span>&nbsp;<span class="builtintype" id="4455137">nil</span>&nbsp;<span class="op" id="4455141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455145">return</span>&nbsp;<span class="ident" id="4455152"><a href="/gostd/crypto/tls/common.go.html#4442347">rand</a></span><span class="op" id="4455156">.</span><span class="ident" id="4455157"><a href="/gostd/crypto/rand/rand.go.html#4355686">Reader</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455168">return</span>&nbsp;<span class="ident" id="4455175"><a href="/gostd/crypto/tls/common.go.html#4455116">r</a></span><br>
<span class="lineno"></span><span class="op" id="4455177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4455180">func</span>&nbsp;<span class="op" id="4455185">(</span><span class="ident" id="4455186">c</span>&nbsp;<span class="op" id="4455188">*</span><span class="ident" id="4455189"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455195">)</span>&nbsp;<span class="ident" id="4455197">time</span><span class="op" id="4455201">(</span><span class="op" id="4455202">)</span>&nbsp;<span class="ident" id="4455204"><a href="/gostd/crypto/tls/common.go.html#4442421">time</a></span><span class="op" id="4455208">.</span><span class="ident" id="4455209"><a href="/gostd/time/time.go.html#2722087">Time</a></span>&nbsp;<span class="op" id="4455214">{</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455217">t</span>&nbsp;<span class="op" id="4455219">:=</span>&nbsp;<span class="ident" id="4455222"><a href="/gostd/crypto/tls/common.go.html#4455186">c</a></span><span class="op" id="4455223">.</span><span class="ident" id="4455224"><a href="/gostd/crypto/tls/common.go.html#4450848">Time</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455230">if</span>&nbsp;<span class="ident" id="4455233"><a href="/gostd/crypto/tls/common.go.html#4455217">t</a></span>&nbsp;<span class="op" id="4455235">==</span>&nbsp;<span class="builtintype" id="4455238">nil</span>&nbsp;<span class="op" id="4455242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455246"><a href="/gostd/crypto/tls/common.go.html#4455217">t</a></span>&nbsp;<span class="op" id="4455248">=</span>&nbsp;<span class="ident" id="4455250"><a href="/gostd/crypto/tls/common.go.html#4442421">time</a></span><span class="op" id="4455254">.</span><span class="ident" id="4455255"><a href="/gostd/time/time.go.html#2743088">Now</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455260">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455263">return</span>&nbsp;<span class="ident" id="4455270"><a href="/gostd/crypto/tls/common.go.html#4455217">t</a></span><span class="op" id="4455271">(</span><span class="op" id="4455272">)</span><br>
<span class="lineno">380</span><span class="op" id="4455274">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4455277">func</span>&nbsp;<span class="op" id="4455282">(</span><span class="ident" id="4455283">c</span>&nbsp;<span class="op" id="4455285">*</span><span class="ident" id="4455286"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455292">)</span>&nbsp;<span class="ident" id="4455294">cipherSuites</span><span class="op" id="4455306">(</span><span class="op" id="4455307">)</span>&nbsp;<span class="op" id="4455309">[</span><span class="op" id="4455310">]</span><span class="builtintype" id="4455311">uint16</span>&nbsp;<span class="op" id="4455318">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455321">s</span>&nbsp;<span class="op" id="4455323">:=</span>&nbsp;<span class="ident" id="4455326"><a href="/gostd/crypto/tls/common.go.html#4455283">c</a></span><span class="op" id="4455327">.</span><span class="ident" id="4455328"><a href="/gostd/crypto/tls/common.go.html#4453138">CipherSuites</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455342">if</span>&nbsp;<span class="ident" id="4455345"><a href="/gostd/crypto/tls/common.go.html#4455321">s</a></span>&nbsp;<span class="op" id="4455347">==</span>&nbsp;<span class="builtintype" id="4455350">nil</span>&nbsp;<span class="op" id="4455354">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4455358"><a href="/gostd/crypto/tls/common.go.html#4455321">s</a></span>&nbsp;<span class="op" id="4455360">=</span>&nbsp;<span class="ident" id="4455362"><a href="/gostd/crypto/tls/common.go.html#4461029">defaultCipherSuites</a></span><span class="op" id="4455381">(</span><span class="op" id="4455382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455388">return</span>&nbsp;<span class="ident" id="4455395"><a href="/gostd/crypto/tls/common.go.html#4455321">s</a></span><br>
<span class="lineno"></span><span class="op" id="4455397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span><span class="keyword" id="4455400">func</span>&nbsp;<span class="op" id="4455405">(</span><span class="ident" id="4455406">c</span>&nbsp;<span class="op" id="4455408">*</span><span class="ident" id="4455409"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455415">)</span>&nbsp;<span class="ident" id="4455417">minVersion</span><span class="op" id="4455427">(</span><span class="op" id="4455428">)</span>&nbsp;<span class="builtintype" id="4455430">uint16</span>&nbsp;<span class="op" id="4455437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455440">if</span>&nbsp;<span class="ident" id="4455443"><a href="/gostd/crypto/tls/common.go.html#4455406">c</a></span>&nbsp;<span class="op" id="4455445">==</span>&nbsp;<span class="builtintype" id="4455448">nil</span>&nbsp;<span class="op" id="4455452">||</span>&nbsp;<span class="ident" id="4455455"><a href="/gostd/crypto/tls/common.go.html#4455406">c</a></span><span class="op" id="4455456">.</span><span class="ident" id="4455457"><a href="/gostd/crypto/tls/common.go.html#4454285">MinVersion</a></span>&nbsp;<span class="op" id="4455468">==</span>&nbsp;<span class="num" id="4455471">0</span>&nbsp;<span class="op" id="4455473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455477">return</span>&nbsp;<span class="ident" id="4455484"><a href="/gostd/crypto/tls/common.go.html#4442825">minVersion</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455499">return</span>&nbsp;<span class="ident" id="4455506"><a href="/gostd/crypto/tls/common.go.html#4455406">c</a></span><span class="op" id="4455507">.</span><span class="ident" id="4455508"><a href="/gostd/crypto/tls/common.go.html#4454285">MinVersion</a></span><br>
<span class="lineno">395</span><span class="op" id="4455519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4455522">func</span>&nbsp;<span class="op" id="4455527">(</span><span class="ident" id="4455528">c</span>&nbsp;<span class="op" id="4455530">*</span><span class="ident" id="4455531"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455537">)</span>&nbsp;<span class="ident" id="4455539">maxVersion</span><span class="op" id="4455549">(</span><span class="op" id="4455550">)</span>&nbsp;<span class="builtintype" id="4455552">uint16</span>&nbsp;<span class="op" id="4455559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455562">if</span>&nbsp;<span class="ident" id="4455565"><a href="/gostd/crypto/tls/common.go.html#4455528">c</a></span>&nbsp;<span class="op" id="4455567">==</span>&nbsp;<span class="builtintype" id="4455570">nil</span>&nbsp;<span class="op" id="4455574">||</span>&nbsp;<span class="ident" id="4455577"><a href="/gostd/crypto/tls/common.go.html#4455528">c</a></span><span class="op" id="4455578">.</span><span class="ident" id="4455579"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span>&nbsp;<span class="op" id="4455590">==</span>&nbsp;<span class="num" id="4455593">0</span>&nbsp;<span class="op" id="4455595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455599">return</span>&nbsp;<span class="ident" id="4455606"><a href="/gostd/crypto/tls/common.go.html#4442852">maxVersion</a></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455618">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455621">return</span>&nbsp;<span class="ident" id="4455628"><a href="/gostd/crypto/tls/common.go.html#4455528">c</a></span><span class="op" id="4455629">.</span><span class="ident" id="4455630"><a href="/gostd/crypto/tls/common.go.html#4454482">MaxVersion</a></span><br>
<span class="lineno"></span><span class="op" id="4455641">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4455644">var</span>&nbsp;<span class="ident" id="4455648">defaultCurvePreferences</span>&nbsp;<span class="op" id="4455672">=</span>&nbsp;<span class="op" id="4455674">[</span><span class="op" id="4455675">]</span><span class="ident" id="4455676"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span><span class="op" id="4455683">{</span><span class="ident" id="4455684"><a href="/gostd/crypto/tls/common.go.html#4444366">CurveP256</a></span><span class="op" id="4455693">,</span>&nbsp;<span class="ident" id="4455695"><a href="/gostd/crypto/tls/common.go.html#4444390">CurveP384</a></span><span class="op" id="4455704">,</span>&nbsp;<span class="ident" id="4455706"><a href="/gostd/crypto/tls/common.go.html#4444414">CurveP521</a></span><span class="op" id="4455715">}</span><br>
<span class="lineno">405</span><br>
<span class="lineno"></span><span class="keyword" id="4455718">func</span>&nbsp;<span class="op" id="4455723">(</span><span class="ident" id="4455724">c</span>&nbsp;<span class="op" id="4455726">*</span><span class="ident" id="4455727"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455733">)</span>&nbsp;<span class="ident" id="4455735">curvePreferences</span><span class="op" id="4455751">(</span><span class="op" id="4455752">)</span>&nbsp;<span class="op" id="4455754">[</span><span class="op" id="4455755">]</span><span class="ident" id="4455756"><a href="/gostd/crypto/tls/common.go.html#4444341">CurveID</a></span>&nbsp;<span class="op" id="4455764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455767">if</span>&nbsp;<span class="ident" id="4455770"><a href="/gostd/crypto/tls/common.go.html#4455724">c</a></span>&nbsp;<span class="op" id="4455772">==</span>&nbsp;<span class="builtintype" id="4455775">nil</span>&nbsp;<span class="op" id="4455779">||</span>&nbsp;<span class="builtinfunc" id="4455782">len</span><span class="op" id="4455785">(</span><span class="ident" id="4455786"><a href="/gostd/crypto/tls/common.go.html#4455724">c</a></span><span class="op" id="4455787">.</span><span class="ident" id="4455788"><a href="/gostd/crypto/tls/common.go.html#4454658">CurvePreferences</a></span><span class="op" id="4455804">)</span>&nbsp;<span class="op" id="4455806">==</span>&nbsp;<span class="num" id="4455809">0</span>&nbsp;<span class="op" id="4455811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455815">return</span>&nbsp;<span class="ident" id="4455822"><a href="/gostd/crypto/tls/common.go.html#4455648">defaultCurvePreferences</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4455847">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4455850">return</span>&nbsp;<span class="ident" id="4455857"><a href="/gostd/crypto/tls/common.go.html#4455724">c</a></span><span class="op" id="4455858">.</span><span class="ident" id="4455859"><a href="/gostd/crypto/tls/common.go.html#4454658">CurvePreferences</a></span><br>
<span class="lineno"></span><span class="op" id="4455876">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4455879">//&nbsp;mutualVersion&nbsp;returns&nbsp;the&nbsp;protocol&nbsp;version&nbsp;to&nbsp;use&nbsp;given&nbsp;the&nbsp;advertised</span><br>
<span class="lineno"></span><span class="comment" id="4455953">//&nbsp;version&nbsp;of&nbsp;the&nbsp;peer.</span><br>
<span class="lineno">415</span><span class="keyword" id="4455977">func</span>&nbsp;<span class="op" id="4455982">(</span><span class="ident" id="4455983">c</span>&nbsp;<span class="op" id="4455985">*</span><span class="ident" id="4455986"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4455992">)</span>&nbsp;<span class="ident" id="4455994">mutualVersion</span><span class="op" id="4456007">(</span><span class="ident" id="4456008">vers</span>&nbsp;<span class="builtintype" id="4456013">uint16</span><span class="op" id="4456019">)</span>&nbsp;<span class="op" id="4456021">(</span><span class="builtintype" id="4456022">uint16</span><span class="op" id="4456028">,</span>&nbsp;<span class="builtintype" id="4456030">bool</span><span class="op" id="4456034">)</span>&nbsp;<span class="op" id="4456036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456039">minVersion</span>&nbsp;<span class="op" id="4456050">:=</span>&nbsp;<span class="ident" id="4456053"><a href="/gostd/crypto/tls/common.go.html#4455983">c</a></span><span class="op" id="4456054">.</span><span class="ident" id="4456055"><a href="/gostd/crypto/tls/common.go.html#4455417">minVersion</a></span><span class="op" id="4456065">(</span><span class="op" id="4456066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456069">maxVersion</span>&nbsp;<span class="op" id="4456080">:=</span>&nbsp;<span class="ident" id="4456083"><a href="/gostd/crypto/tls/common.go.html#4455983">c</a></span><span class="op" id="4456084">.</span><span class="ident" id="4456085"><a href="/gostd/crypto/tls/common.go.html#4455539">maxVersion</a></span><span class="op" id="4456095">(</span><span class="op" id="4456096">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456100">if</span>&nbsp;<span class="ident" id="4456103"><a href="/gostd/crypto/tls/common.go.html#4456008">vers</a></span>&nbsp;<span class="op" id="4456108">&lt;</span>&nbsp;<span class="ident" id="4456110"><a href="/gostd/crypto/tls/common.go.html#4456039">minVersion</a></span>&nbsp;<span class="op" id="4456121">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456125">return</span>&nbsp;<span class="num" id="4456132">0</span><span class="op" id="4456133">,</span>&nbsp;<span class="builtintype" id="4456135">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456142">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456145">if</span>&nbsp;<span class="ident" id="4456148"><a href="/gostd/crypto/tls/common.go.html#4456008">vers</a></span>&nbsp;<span class="op" id="4456153">&gt;</span>&nbsp;<span class="ident" id="4456155"><a href="/gostd/crypto/tls/common.go.html#4456069">maxVersion</a></span>&nbsp;<span class="op" id="4456166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456170"><a href="/gostd/crypto/tls/common.go.html#4456008">vers</a></span>&nbsp;<span class="op" id="4456175">=</span>&nbsp;<span class="ident" id="4456177"><a href="/gostd/crypto/tls/common.go.html#4456069">maxVersion</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456189">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456192">return</span>&nbsp;<span class="ident" id="4456199"><a href="/gostd/crypto/tls/common.go.html#4456008">vers</a></span><span class="op" id="4456203">,</span>&nbsp;<span class="builtintype" id="4456205">true</span><br>
<span class="lineno"></span><span class="op" id="4456210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4456213">//&nbsp;getCertificate&nbsp;returns&nbsp;the&nbsp;best&nbsp;certificate&nbsp;for&nbsp;the&nbsp;given&nbsp;ClientHelloInfo,</span><br>
<span class="lineno"></span><span class="comment" id="4456291">//&nbsp;defaulting&nbsp;to&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;c.Certificates.</span><br>
<span class="lineno">430</span><span class="keyword" id="4456345">func</span>&nbsp;<span class="op" id="4456350">(</span><span class="ident" id="4456351">c</span>&nbsp;<span class="op" id="4456353">*</span><span class="ident" id="4456354"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4456360">)</span>&nbsp;<span class="ident" id="4456362">getCertificate</span><span class="op" id="4456376">(</span><span class="ident" id="4456377">clientHello</span>&nbsp;<span class="op" id="4456389">*</span><span class="ident" id="4456390"><a href="/gostd/crypto/tls/common.go.html#4449371">ClientHelloInfo</a></span><span class="op" id="4456405">)</span>&nbsp;<span class="op" id="4456407">(</span><span class="op" id="4456408">*</span><span class="ident" id="4456409"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4456420">,</span>&nbsp;<span class="builtintype" id="4456422">error</span><span class="op" id="4456427">)</span>&nbsp;<span class="op" id="4456429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456432">if</span>&nbsp;<span class="ident" id="4456435"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456436">.</span><span class="ident" id="4456437"><a href="/gostd/crypto/tls/common.go.html#4451724">GetCertificate</a></span>&nbsp;<span class="op" id="4456452">!=</span>&nbsp;<span class="builtintype" id="4456455">nil</span>&nbsp;<span class="op" id="4456459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456463">cert</span><span class="op" id="4456467">,</span>&nbsp;<span class="ident" id="4456469">err</span>&nbsp;<span class="op" id="4456473">:=</span>&nbsp;<span class="ident" id="4456476"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456477">.</span><span class="ident" id="4456478"><a href="/gostd/crypto/tls/common.go.html#4451724">GetCertificate</a></span><span class="op" id="4456492">(</span><span class="ident" id="4456493"><a href="/gostd/crypto/tls/common.go.html#4456377">clientHello</a></span><span class="op" id="4456504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456508">if</span>&nbsp;<span class="ident" id="4456511"><a href="/gostd/crypto/tls/common.go.html#4456463">cert</a></span>&nbsp;<span class="op" id="4456516">!=</span>&nbsp;<span class="builtintype" id="4456519">nil</span>&nbsp;<span class="op" id="4456523">||</span>&nbsp;<span class="ident" id="4456526"><a href="/gostd/crypto/tls/common.go.html#4456469">err</a></span>&nbsp;<span class="op" id="4456530">!=</span>&nbsp;<span class="builtintype" id="4456533">nil</span>&nbsp;<span class="op" id="4456537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456542">return</span>&nbsp;<span class="ident" id="4456549"><a href="/gostd/crypto/tls/common.go.html#4456463">cert</a></span><span class="op" id="4456553">,</span>&nbsp;<span class="ident" id="4456555"><a href="/gostd/crypto/tls/common.go.html#4456469">err</a></span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456568">if</span>&nbsp;<span class="builtinfunc" id="4456571">len</span><span class="op" id="4456574">(</span><span class="ident" id="4456575"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456576">.</span><span class="ident" id="4456577"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4456589">)</span>&nbsp;<span class="op" id="4456591">==</span>&nbsp;<span class="num" id="4456594">1</span>&nbsp;<span class="op" id="4456596">||</span>&nbsp;<span class="ident" id="4456599"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456600">.</span><span class="ident" id="4456601"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span>&nbsp;<span class="op" id="4456619">==</span>&nbsp;<span class="builtintype" id="4456622">nil</span>&nbsp;<span class="op" id="4456626">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4456630">//&nbsp;There&#39;s&nbsp;only&nbsp;one&nbsp;choice,&nbsp;so&nbsp;no&nbsp;point&nbsp;doing&nbsp;any&nbsp;work.</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456688">return</span>&nbsp;<span class="op" id="4456695">&amp;</span><span class="ident" id="4456696"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456697">.</span><span class="ident" id="4456698"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4456710">[</span><span class="num" id="4456711">0</span><span class="op" id="4456712">]</span><span class="op" id="4456713">,</span>&nbsp;<span class="builtintype" id="4456715">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456720">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456724">name</span>&nbsp;<span class="op" id="4456729">:=</span>&nbsp;<span class="ident" id="4456732"><a href="/gostd/crypto/tls/common.go.html#4442402">strings</a></span><span class="op" id="4456739">.</span><span class="ident" id="4456740"><a href="/gostd/strings/strings.go.html#2977307">ToLower</a></span><span class="op" id="4456747">(</span><span class="ident" id="4456748"><a href="/gostd/crypto/tls/common.go.html#4456377">clientHello</a></span><span class="op" id="4456759">.</span><span class="ident" id="4456760"><a href="/gostd/crypto/tls/common.go.html#4449747">ServerName</a></span><span class="op" id="4456770">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456773">for</span>&nbsp;<span class="builtinfunc" id="4456777">len</span><span class="op" id="4456780">(</span><span class="ident" id="4456781"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456785">)</span>&nbsp;<span class="op" id="4456787">&gt;</span>&nbsp;<span class="num" id="4456789">0</span>&nbsp;<span class="op" id="4456791">&amp;&amp;</span>&nbsp;<span class="ident" id="4456794"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456798">[</span><span class="builtinfunc" id="4456799">len</span><span class="op" id="4456802">(</span><span class="ident" id="4456803"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456807">)</span><span class="op" id="4456808">-</span><span class="num" id="4456809">1</span><span class="op" id="4456810">]</span>&nbsp;<span class="op" id="4456812">==</span>&nbsp;<span class="string" id="4456815">&#39;.&#39;</span>&nbsp;<span class="op" id="4456819">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4456823"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span>&nbsp;<span class="op" id="4456828">=</span>&nbsp;<span class="ident" id="4456830"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456834">[</span><span class="op" id="4456835">:</span><span class="builtinfunc" id="4456836">len</span><span class="op" id="4456839">(</span><span class="ident" id="4456840"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456844">)</span><span class="op" id="4456845">-</span><span class="num" id="4456846">1</span><span class="op" id="4456847">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456850">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456854">if</span>&nbsp;<span class="ident" id="4456857">cert</span><span class="op" id="4456861">,</span>&nbsp;<span class="ident" id="4456863">ok</span>&nbsp;<span class="op" id="4456866">:=</span>&nbsp;<span class="ident" id="4456869"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4456870">.</span><span class="ident" id="4456871"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span><span class="op" id="4456888">[</span><span class="ident" id="4456889"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4456893">]</span><span class="op" id="4456894">;</span>&nbsp;<span class="ident" id="4456896"><a href="/gostd/crypto/tls/common.go.html#4456863">ok</a></span>&nbsp;<span class="op" id="4456899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4456903">return</span>&nbsp;<span class="ident" id="4456910"><a href="/gostd/crypto/tls/common.go.html#4456857">cert</a></span><span class="op" id="4456914">,</span>&nbsp;<span class="builtintype" id="4456916">nil</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4456921">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4456925">//&nbsp;try&nbsp;replacing&nbsp;labels&nbsp;in&nbsp;the&nbsp;name&nbsp;with&nbsp;wildcards&nbsp;until&nbsp;we&nbsp;get&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4456992">//&nbsp;match.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457003">labels</span>&nbsp;<span class="op" id="4457010">:=</span>&nbsp;<span class="ident" id="4457013"><a href="/gostd/crypto/tls/common.go.html#4442402">strings</a></span><span class="op" id="4457020">.</span><span class="ident" id="4457021"><a href="/gostd/strings/strings.go.html#2973136">Split</a></span><span class="op" id="4457026">(</span><span class="ident" id="4457027"><a href="/gostd/crypto/tls/common.go.html#4456724">name</a></span><span class="op" id="4457031">,</span>&nbsp;<span class="string" id="4457033">&#34;.&#34;</span><span class="op" id="4457036">)</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457039">for</span>&nbsp;<span class="ident" id="4457043">i</span>&nbsp;<span class="op" id="4457045">:=</span>&nbsp;<span class="keyword" id="4457048">range</span>&nbsp;<span class="ident" id="4457054"><a href="/gostd/crypto/tls/common.go.html#4457003">labels</a></span>&nbsp;<span class="op" id="4457061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457065"><a href="/gostd/crypto/tls/common.go.html#4457003">labels</a></span><span class="op" id="4457071">[</span><span class="ident" id="4457072"><a href="/gostd/crypto/tls/common.go.html#4457043">i</a></span><span class="op" id="4457073">]</span>&nbsp;<span class="op" id="4457075">=</span>&nbsp;<span class="string" id="4457077">&#34;*&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457083">candidate</span>&nbsp;<span class="op" id="4457093">:=</span>&nbsp;<span class="ident" id="4457096"><a href="/gostd/crypto/tls/common.go.html#4442402">strings</a></span><span class="op" id="4457103">.</span><span class="ident" id="4457104"><a href="/gostd/strings/strings.go.html#2974969">Join</a></span><span class="op" id="4457108">(</span><span class="ident" id="4457109"><a href="/gostd/crypto/tls/common.go.html#4457003">labels</a></span><span class="op" id="4457115">,</span>&nbsp;<span class="string" id="4457117">&#34;.&#34;</span><span class="op" id="4457120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457124">if</span>&nbsp;<span class="ident" id="4457127">cert</span><span class="op" id="4457131">,</span>&nbsp;<span class="ident" id="4457133">ok</span>&nbsp;<span class="op" id="4457136">:=</span>&nbsp;<span class="ident" id="4457139"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4457140">.</span><span class="ident" id="4457141"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span><span class="op" id="4457158">[</span><span class="ident" id="4457159"><a href="/gostd/crypto/tls/common.go.html#4457083">candidate</a></span><span class="op" id="4457168">]</span><span class="op" id="4457169">;</span>&nbsp;<span class="ident" id="4457171"><a href="/gostd/crypto/tls/common.go.html#4457133">ok</a></span>&nbsp;<span class="op" id="4457174">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457179">return</span>&nbsp;<span class="ident" id="4457186"><a href="/gostd/crypto/tls/common.go.html#4457127">cert</a></span><span class="op" id="4457190">,</span>&nbsp;<span class="builtintype" id="4457192">nil</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457201">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4457205">//&nbsp;If&nbsp;nothing&nbsp;matches,&nbsp;return&nbsp;the&nbsp;first&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457259">return</span>&nbsp;<span class="op" id="4457266">&amp;</span><span class="ident" id="4457267"><a href="/gostd/crypto/tls/common.go.html#4456351">c</a></span><span class="op" id="4457268">.</span><span class="ident" id="4457269"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4457281">[</span><span class="num" id="4457282">0</span><span class="op" id="4457283">]</span><span class="op" id="4457284">,</span>&nbsp;<span class="builtintype" id="4457286">nil</span><br>
<span class="lineno">465</span><span class="op" id="4457290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4457293">//&nbsp;BuildNameToCertificate&nbsp;parses&nbsp;c.Certificates&nbsp;and&nbsp;builds&nbsp;c.NameToCertificate</span><br>
<span class="lineno"></span><span class="comment" id="4457372">//&nbsp;from&nbsp;the&nbsp;CommonName&nbsp;and&nbsp;SubjectAlternateName&nbsp;fields&nbsp;of&nbsp;each&nbsp;of&nbsp;the&nbsp;leaf</span><br>
<span class="lineno"></span><span class="comment" id="4457447">//&nbsp;certificates.</span><br>
<span class="lineno">470</span><span class="keyword" id="4457464">func</span>&nbsp;<span class="op" id="4457469">(</span><span class="ident" id="4457470">c</span>&nbsp;<span class="op" id="4457472">*</span><span class="ident" id="4457473"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><span class="op" id="4457479">)</span>&nbsp;<span class="ident" id="4457481">BuildNameToCertificate</span><span class="op" id="4457503">(</span><span class="op" id="4457504">)</span>&nbsp;<span class="op" id="4457506">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457509"><a href="/gostd/crypto/tls/common.go.html#4457470">c</a></span><span class="op" id="4457510">.</span><span class="ident" id="4457511"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span>&nbsp;<span class="op" id="4457529">=</span>&nbsp;<span class="builtinfunc" id="4457531">make</span><span class="op" id="4457535">(</span><span class="keyword" id="4457536">map</span><span class="op" id="4457539">[</span><span class="builtintype" id="4457540">string</span><span class="op" id="4457546">]</span><span class="op" id="4457547">*</span><span class="ident" id="4457548"><a href="/gostd/crypto/tls/common.go.html#4457987">Certificate</a></span><span class="op" id="4457559">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457562">for</span>&nbsp;<span class="ident" id="4457566">i</span>&nbsp;<span class="op" id="4457568">:=</span>&nbsp;<span class="keyword" id="4457571">range</span>&nbsp;<span class="ident" id="4457577"><a href="/gostd/crypto/tls/common.go.html#4457470">c</a></span><span class="op" id="4457578">.</span><span class="ident" id="4457579"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span>&nbsp;<span class="op" id="4457592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457596">cert</span>&nbsp;<span class="op" id="4457601">:=</span>&nbsp;<span class="op" id="4457604">&amp;</span><span class="ident" id="4457605"><a href="/gostd/crypto/tls/common.go.html#4457470">c</a></span><span class="op" id="4457606">.</span><span class="ident" id="4457607"><a href="/gostd/crypto/tls/common.go.html#4451046">Certificates</a></span><span class="op" id="4457619">[</span><span class="ident" id="4457620"><a href="/gostd/crypto/tls/common.go.html#4457566">i</a></span><span class="op" id="4457621">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457625">x509Cert</span><span class="op" id="4457633">,</span>&nbsp;<span class="ident" id="4457635">err</span>&nbsp;<span class="op" id="4457639">:=</span>&nbsp;<span class="ident" id="4457642"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4457646">.</span><span class="ident" id="4457647"><a href="/gostd/crypto/x509/x509.go.html#4679509">ParseCertificate</a></span><span class="op" id="4457663">(</span><span class="ident" id="4457664"><a href="/gostd/crypto/tls/common.go.html#4457596">cert</a></span><span class="op" id="4457668">.</span><span class="ident" id="4457669"><a href="/gostd/crypto/tls/common.go.html#4458009">Certificate</a></span><span class="op" id="4457680">[</span><span class="num" id="4457681">0</span><span class="op" id="4457682">]</span><span class="op" id="4457683">)</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457687">if</span>&nbsp;<span class="ident" id="4457690"><a href="/gostd/crypto/tls/common.go.html#4457635">err</a></span>&nbsp;<span class="op" id="4457694">!=</span>&nbsp;<span class="builtintype" id="4457697">nil</span>&nbsp;<span class="op" id="4457701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457706">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457721">if</span>&nbsp;<span class="builtinfunc" id="4457724">len</span><span class="op" id="4457727">(</span><span class="ident" id="4457728"><a href="/gostd/crypto/tls/common.go.html#4457625">x509Cert</a></span><span class="op" id="4457736">.</span><span class="ident" id="4457737"><a href="/gostd/crypto/x509/x509.go.html#4660382">Subject</a></span><span class="op" id="4457744">.</span><span class="ident" id="4457745"><a href="/gostd/crypto/x509/pkix/pkix.go.html#3408461">CommonName</a></span><span class="op" id="4457755">)</span>&nbsp;<span class="op" id="4457757">&gt;</span>&nbsp;<span class="num" id="4457759">0</span>&nbsp;<span class="op" id="4457761">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457766"><a href="/gostd/crypto/tls/common.go.html#4457470">c</a></span><span class="op" id="4457767">.</span><span class="ident" id="4457768"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span><span class="op" id="4457785">[</span><span class="ident" id="4457786"><a href="/gostd/crypto/tls/common.go.html#4457625">x509Cert</a></span><span class="op" id="4457794">.</span><span class="ident" id="4457795"><a href="/gostd/crypto/x509/x509.go.html#4660382">Subject</a></span><span class="op" id="4457802">.</span><span class="ident" id="4457803"><a href="/gostd/crypto/x509/pkix/pkix.go.html#3408461">CommonName</a></span><span class="op" id="4457813">]</span>&nbsp;<span class="op" id="4457815">=</span>&nbsp;<span class="ident" id="4457817"><a href="/gostd/crypto/tls/common.go.html#4457596">cert</a></span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4457828">for</span>&nbsp;<span class="ident" id="4457832">_</span><span class="op" id="4457833">,</span>&nbsp;<span class="ident" id="4457835">san</span>&nbsp;<span class="op" id="4457839">:=</span>&nbsp;<span class="keyword" id="4457842">range</span>&nbsp;<span class="ident" id="4457848"><a href="/gostd/crypto/tls/common.go.html#4457625">x509Cert</a></span><span class="op" id="4457856">.</span><span class="ident" id="4457857"><a href="/gostd/crypto/x509/x509.go.html#4661863">DNSNames</a></span>&nbsp;<span class="op" id="4457866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4457871"><a href="/gostd/crypto/tls/common.go.html#4457470">c</a></span><span class="op" id="4457872">.</span><span class="ident" id="4457873"><a href="/gostd/crypto/tls/common.go.html#4451411">NameToCertificate</a></span><span class="op" id="4457890">[</span><span class="ident" id="4457891"><a href="/gostd/crypto/tls/common.go.html#4457835">san</a></span><span class="op" id="4457894">]</span>&nbsp;<span class="op" id="4457896">=</span>&nbsp;<span class="ident" id="4457898"><a href="/gostd/crypto/tls/common.go.html#4457596">cert</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4457908">}</span><br>
<span class="lineno">485</span><span class="op" id="4457910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4457913">//&nbsp;A&nbsp;Certificate&nbsp;is&nbsp;a&nbsp;chain&nbsp;of&nbsp;one&nbsp;or&nbsp;more&nbsp;certificates,&nbsp;leaf&nbsp;first.</span><br>
<span class="lineno"></span><span class="keyword" id="4457982">type</span>&nbsp;<span class="ident" id="4457987">Certificate</span>&nbsp;<span class="keyword" id="4457999">struct</span>&nbsp;<span class="op" id="4458006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458009">Certificate</span>&nbsp;<span class="op" id="4458021">[</span><span class="op" id="4458022">]</span><span class="op" id="4458023">[</span><span class="op" id="4458024">]</span><span class="builtintype" id="4458025">byte</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458031">//&nbsp;PrivateKey&nbsp;contains&nbsp;the&nbsp;private&nbsp;key&nbsp;corresponding&nbsp;to&nbsp;the&nbsp;public&nbsp;key</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458103">//&nbsp;in&nbsp;Leaf.&nbsp;For&nbsp;a&nbsp;server,&nbsp;this&nbsp;must&nbsp;be&nbsp;a&nbsp;*rsa.PrivateKey&nbsp;or</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458164">//&nbsp;*ecdsa.PrivateKey.&nbsp;For&nbsp;a&nbsp;client&nbsp;doing&nbsp;client&nbsp;authentication,&nbsp;this</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458234">//&nbsp;can&nbsp;be&nbsp;any&nbsp;type&nbsp;that&nbsp;implements&nbsp;crypto.Signer&nbsp;(which&nbsp;includes&nbsp;RSA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458304">//&nbsp;and&nbsp;ECDSA&nbsp;private&nbsp;keys).</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458333">PrivateKey</span>&nbsp;<span class="ident" id="4458344"><a href="/gostd/crypto/tls/common.go.html#4442337">crypto</a></span><span class="op" id="4458350">.</span><span class="ident" id="4458351"><a href="/gostd/crypto/crypto.go.html#3012570">PrivateKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458363">//&nbsp;OCSPStaple&nbsp;contains&nbsp;an&nbsp;optional&nbsp;OCSP&nbsp;response&nbsp;which&nbsp;will&nbsp;be&nbsp;served</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458434">//&nbsp;to&nbsp;clients&nbsp;that&nbsp;request&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458466">OCSPStaple</span>&nbsp;<span class="op" id="4458477">[</span><span class="op" id="4458478">]</span><span class="builtintype" id="4458479">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458485">//&nbsp;Leaf&nbsp;is&nbsp;the&nbsp;parsed&nbsp;form&nbsp;of&nbsp;the&nbsp;leaf&nbsp;certificate,&nbsp;which&nbsp;may&nbsp;be</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458551">//&nbsp;initialized&nbsp;using&nbsp;x509.ParseCertificate&nbsp;to&nbsp;reduce&nbsp;per-handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458619">//&nbsp;processing&nbsp;for&nbsp;TLS&nbsp;clients&nbsp;doing&nbsp;client&nbsp;authentication.&nbsp;If&nbsp;nil,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4458691">//&nbsp;leaf&nbsp;certificate&nbsp;will&nbsp;be&nbsp;parsed&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458738">Leaf</span>&nbsp;<span class="op" id="4458743">*</span><span class="ident" id="4458744"><a href="/gostd/crypto/tls/common.go.html#4442362">x509</a></span><span class="op" id="4458748">.</span><span class="ident" id="4458749"><a href="/gostd/crypto/x509/x509.go.html#4659766">Certificate</a></span><br>
<span class="lineno"></span><span class="op" id="4458761">}</span><br>
<span class="lineno">505</span><br>
<span class="lineno"></span><span class="comment" id="4458764">//&nbsp;A&nbsp;TLS&nbsp;record.</span><br>
<span class="lineno"></span><span class="keyword" id="4458781">type</span>&nbsp;<span class="ident" id="4458786">record</span>&nbsp;<span class="keyword" id="4458793">struct</span>&nbsp;<span class="op" id="4458800">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458803">contentType</span>&nbsp;&nbsp;<span class="ident" id="4458816"><a href="/gostd/crypto/tls/common.go.html#4442907">recordType</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458828">major</span><span class="op" id="4458833">,</span>&nbsp;<span class="ident" id="4458835">minor</span>&nbsp;<span class="builtintype" id="4458841">uint8</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458848">payload</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4458861">[</span><span class="op" id="4458862">]</span><span class="builtintype" id="4458863">byte</span><br>
<span class="lineno"></span><span class="op" id="4458868">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4458871">type</span>&nbsp;<span class="ident" id="4458876">handshakeMessage</span>&nbsp;<span class="keyword" id="4458893">interface</span>&nbsp;<span class="op" id="4458903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458906">marshal</span><span class="op" id="4458913">(</span><span class="op" id="4458914">)</span>&nbsp;<span class="op" id="4458916">[</span><span class="op" id="4458917">]</span><span class="builtintype" id="4458918">byte</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4458924">unmarshal</span><span class="op" id="4458933">(</span><span class="op" id="4458934">[</span><span class="op" id="4458935">]</span><span class="builtintype" id="4458936">byte</span><span class="op" id="4458940">)</span>&nbsp;<span class="builtintype" id="4458942">bool</span><br>
<span class="lineno"></span><span class="op" id="4458947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4458950">//&nbsp;lruSessionCache&nbsp;is&nbsp;a&nbsp;ClientSessionCache&nbsp;implementation&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU</span><br>
<span class="lineno"></span><span class="comment" id="4459025">//&nbsp;caching&nbsp;strategy.</span><br>
<span class="lineno">520</span><span class="keyword" id="4459046">type</span>&nbsp;<span class="ident" id="4459051">lruSessionCache</span>&nbsp;<span class="keyword" id="4459067">struct</span>&nbsp;<span class="op" id="4459074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459077"><a href="/gostd/crypto/tls/common.go.html#4442413">sync</a></span><span class="op" id="4459081">.</span><span class="ident" id="4459082"><a href="/gostd/sync/mutex.go.html#1443974">Mutex</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459090">m</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459099">map</span><span class="op" id="4459102">[</span><span class="builtintype" id="4459103">string</span><span class="op" id="4459109">]</span><span class="op" id="4459110">*</span><span class="ident" id="4459111"><a href="/gostd/crypto/tls/common.go.html#4442319">list</a></span><span class="op" id="4459115">.</span><span class="ident" id="4459116"><a href="/gostd/container/list/list.go.html#4766617">Element</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459125">q</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459134">*</span><span class="ident" id="4459135"><a href="/gostd/crypto/tls/common.go.html#4442319">list</a></span><span class="op" id="4459139">.</span><span class="ident" id="4459140"><a href="/gostd/container/list/list.go.html#4767520">List</a></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459146">capacity</span>&nbsp;<span class="builtintype" id="4459155">int</span><br>
<span class="lineno"></span><span class="op" id="4459159">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4459162">type</span>&nbsp;<span class="ident" id="4459167">lruSessionCacheEntry</span>&nbsp;<span class="keyword" id="4459188">struct</span>&nbsp;<span class="op" id="4459195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459198">sessionKey</span>&nbsp;<span class="builtintype" id="4459209">string</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459217">state</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459228">*</span><span class="ident" id="4459229"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><br>
<span class="lineno"></span><span class="op" id="4459248">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4459251">//&nbsp;NewLRUClientSessionCache&nbsp;returns&nbsp;a&nbsp;ClientSessionCache&nbsp;with&nbsp;the&nbsp;given</span><br>
<span class="lineno"></span><span class="comment" id="4459323">//&nbsp;capacity&nbsp;that&nbsp;uses&nbsp;an&nbsp;LRU&nbsp;strategy.&nbsp;If&nbsp;capacity&nbsp;is&nbsp;&lt;&nbsp;1,&nbsp;a&nbsp;default&nbsp;capacity</span><br>
<span class="lineno">535</span><span class="comment" id="4459401">//&nbsp;is&nbsp;used&nbsp;instead.</span><br>
<span class="lineno"></span><span class="keyword" id="4459421">func</span>&nbsp;<span class="ident" id="4459426">NewLRUClientSessionCache</span><span class="op" id="4459450">(</span><span class="ident" id="4459451">capacity</span>&nbsp;<span class="builtintype" id="4459460">int</span><span class="op" id="4459463">)</span>&nbsp;<span class="ident" id="4459465"><a href="/gostd/crypto/tls/common.go.html#4448892">ClientSessionCache</a></span>&nbsp;<span class="op" id="4459484">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459487">const</span>&nbsp;<span class="ident" id="4459493">defaultSessionCacheCapacity</span>&nbsp;<span class="op" id="4459521">=</span>&nbsp;<span class="num" id="4459523">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459528">if</span>&nbsp;<span class="ident" id="4459531"><a href="/gostd/crypto/tls/common.go.html#4459451">capacity</a></span>&nbsp;<span class="op" id="4459540">&lt;</span>&nbsp;<span class="num" id="4459542">1</span>&nbsp;<span class="op" id="4459544">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459548"><a href="/gostd/crypto/tls/common.go.html#4459451">capacity</a></span>&nbsp;<span class="op" id="4459557">=</span>&nbsp;<span class="ident" id="4459559"><a href="/gostd/crypto/tls/common.go.html#4459493">defaultSessionCacheCapacity</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459588">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459591">return</span>&nbsp;<span class="op" id="4459598">&amp;</span><span class="ident" id="4459599"><a href="/gostd/crypto/tls/common.go.html#4459051">lruSessionCache</a></span><span class="op" id="4459614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459618"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4459619">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4459628">make</span><span class="op" id="4459632">(</span><span class="keyword" id="4459633">map</span><span class="op" id="4459636">[</span><span class="builtintype" id="4459637">string</span><span class="op" id="4459643">]</span><span class="op" id="4459644">*</span><span class="ident" id="4459645"><a href="/gostd/crypto/tls/common.go.html#4442319">list</a></span><span class="op" id="4459649">.</span><span class="ident" id="4459650"><a href="/gostd/container/list/list.go.html#4766617">Element</a></span><span class="op" id="4459657">)</span><span class="op" id="4459658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459662"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4459663">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459672"><a href="/gostd/crypto/tls/common.go.html#4442319">list</a></span><span class="op" id="4459676">.</span><span class="ident" id="4459677"><a href="/gostd/container/list/list.go.html#4767873">New</a></span><span class="op" id="4459680">(</span><span class="op" id="4459681">)</span><span class="op" id="4459682">,</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459686"><a href="/gostd/crypto/tls/common.go.html#4459146">capacity</a></span><span class="op" id="4459694">:</span>&nbsp;<span class="ident" id="4459696"><a href="/gostd/crypto/tls/common.go.html#4459451">capacity</a></span><span class="op" id="4459704">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4459707">}</span><br>
<span class="lineno"></span><span class="op" id="4459709">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4459712">//&nbsp;Put&nbsp;adds&nbsp;the&nbsp;provided&nbsp;(sessionKey,&nbsp;cs)&nbsp;pair&nbsp;to&nbsp;the&nbsp;cache.</span><br>
<span class="lineno">550</span><span class="keyword" id="4459773">func</span>&nbsp;<span class="op" id="4459778">(</span><span class="ident" id="4459779">c</span>&nbsp;<span class="op" id="4459781">*</span><span class="ident" id="4459782"><a href="/gostd/crypto/tls/common.go.html#4459051">lruSessionCache</a></span><span class="op" id="4459797">)</span>&nbsp;<span class="ident" id="4459799">Put</span><span class="op" id="4459802">(</span><span class="ident" id="4459803">sessionKey</span>&nbsp;<span class="builtintype" id="4459814">string</span><span class="op" id="4459820">,</span>&nbsp;<span class="ident" id="4459822">cs</span>&nbsp;<span class="op" id="4459825">*</span><span class="ident" id="4459826"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="4459844">)</span>&nbsp;<span class="op" id="4459846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459849"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4459850">.</span><span class="ident" id="4459851"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4459855">(</span><span class="op" id="4459856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459859">defer</span>&nbsp;<span class="ident" id="4459865"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4459866">.</span><span class="ident" id="4459867"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4459873">(</span><span class="op" id="4459874">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4459878">if</span>&nbsp;<span class="ident" id="4459881">elem</span><span class="op" id="4459885">,</span>&nbsp;<span class="ident" id="4459887">ok</span>&nbsp;<span class="op" id="4459890">:=</span>&nbsp;<span class="ident" id="4459893"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4459894">.</span><span class="ident" id="4459895"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4459896">[</span><span class="ident" id="4459897"><a href="/gostd/crypto/tls/common.go.html#4459803">sessionKey</a></span><span class="op" id="4459907">]</span><span class="op" id="4459908">;</span>&nbsp;<span class="ident" id="4459910"><a href="/gostd/crypto/tls/common.go.html#4459887">ok</a></span>&nbsp;<span class="op" id="4459913">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459917">entry</span>&nbsp;<span class="op" id="4459923">:=</span>&nbsp;<span class="ident" id="4459926"><a href="/gostd/crypto/tls/common.go.html#4459881">elem</a></span><span class="op" id="4459930">.</span><span class="ident" id="4459931"><a href="/gostd/container/list/list.go.html#4767061">Value</a></span><span class="op" id="4459936">.</span><span class="op" id="4459937">(</span><span class="op" id="4459938">*</span><span class="ident" id="4459939"><a href="/gostd/crypto/tls/common.go.html#4459167">lruSessionCacheEntry</a></span><span class="op" id="4459959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459963"><a href="/gostd/crypto/tls/common.go.html#4459917">entry</a></span><span class="op" id="4459968">.</span><span class="ident" id="4459969"><a href="/gostd/crypto/tls/common.go.html#4459217">state</a></span>&nbsp;<span class="op" id="4459975">=</span>&nbsp;<span class="ident" id="4459977"><a href="/gostd/crypto/tls/common.go.html#4459822">cs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4459982"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4459983">.</span><span class="ident" id="4459984"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4459985">.</span><span class="ident" id="4459986"><a href="/gostd/container/list/list.go.html#4770646">MoveToFront</a></span><span class="op" id="4459997">(</span><span class="ident" id="4459998"><a href="/gostd/crypto/tls/common.go.html#4459881">elem</a></span><span class="op" id="4460002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460006">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460014">}</span><br>
<span class="lineno">560</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460018">if</span>&nbsp;<span class="ident" id="4460021"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460022">.</span><span class="ident" id="4460023"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4460024">.</span><span class="ident" id="4460025"><a href="/gostd/container/list/list.go.html#4768005">Len</a></span><span class="op" id="4460028">(</span><span class="op" id="4460029">)</span>&nbsp;<span class="op" id="4460031">&lt;</span>&nbsp;<span class="ident" id="4460033"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460034">.</span><span class="ident" id="4460035"><a href="/gostd/crypto/tls/common.go.html#4459146">capacity</a></span>&nbsp;<span class="op" id="4460044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460048">entry</span>&nbsp;<span class="op" id="4460054">:=</span>&nbsp;<span class="op" id="4460057">&amp;</span><span class="ident" id="4460058"><a href="/gostd/crypto/tls/common.go.html#4459167">lruSessionCacheEntry</a></span><span class="op" id="4460078">{</span><span class="ident" id="4460079"><a href="/gostd/crypto/tls/common.go.html#4459803">sessionKey</a></span><span class="op" id="4460089">,</span>&nbsp;<span class="ident" id="4460091"><a href="/gostd/crypto/tls/common.go.html#4459822">cs</a></span><span class="op" id="4460093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460097"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460098">.</span><span class="ident" id="4460099"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4460100">[</span><span class="ident" id="4460101"><a href="/gostd/crypto/tls/common.go.html#4459803">sessionKey</a></span><span class="op" id="4460111">]</span>&nbsp;<span class="op" id="4460113">=</span>&nbsp;<span class="ident" id="4460115"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460116">.</span><span class="ident" id="4460117"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4460118">.</span><span class="ident" id="4460119"><a href="/gostd/container/list/list.go.html#4769538">PushFront</a></span><span class="op" id="4460128">(</span><span class="ident" id="4460129"><a href="/gostd/crypto/tls/common.go.html#4460048">entry</a></span><span class="op" id="4460134">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460138">return</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460146">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460150">elem</span>&nbsp;<span class="op" id="4460155">:=</span>&nbsp;<span class="ident" id="4460158"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460159">.</span><span class="ident" id="4460160"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4460161">.</span><span class="ident" id="4460162"><a href="/gostd/container/list/list.go.html#4768242">Back</a></span><span class="op" id="4460166">(</span><span class="op" id="4460167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460170">entry</span>&nbsp;<span class="op" id="4460176">:=</span>&nbsp;<span class="ident" id="4460179"><a href="/gostd/crypto/tls/common.go.html#4460150">elem</a></span><span class="op" id="4460183">.</span><span class="ident" id="4460184"><a href="/gostd/container/list/list.go.html#4767061">Value</a></span><span class="op" id="4460189">.</span><span class="op" id="4460190">(</span><span class="op" id="4460191">*</span><span class="ident" id="4460192"><a href="/gostd/crypto/tls/common.go.html#4459167">lruSessionCacheEntry</a></span><span class="op" id="4460212">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4460215">delete</span><span class="op" id="4460221">(</span><span class="ident" id="4460222"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460223">.</span><span class="ident" id="4460224"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4460225">,</span>&nbsp;<span class="ident" id="4460227"><a href="/gostd/crypto/tls/common.go.html#4460170">entry</a></span><span class="op" id="4460232">.</span><span class="ident" id="4460233"><a href="/gostd/crypto/tls/common.go.html#4459198">sessionKey</a></span><span class="op" id="4460243">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460246"><a href="/gostd/crypto/tls/common.go.html#4460170">entry</a></span><span class="op" id="4460251">.</span><span class="ident" id="4460252"><a href="/gostd/crypto/tls/common.go.html#4459198">sessionKey</a></span>&nbsp;<span class="op" id="4460263">=</span>&nbsp;<span class="ident" id="4460265"><a href="/gostd/crypto/tls/common.go.html#4459803">sessionKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460277"><a href="/gostd/crypto/tls/common.go.html#4460170">entry</a></span><span class="op" id="4460282">.</span><span class="ident" id="4460283"><a href="/gostd/crypto/tls/common.go.html#4459217">state</a></span>&nbsp;<span class="op" id="4460289">=</span>&nbsp;<span class="ident" id="4460291"><a href="/gostd/crypto/tls/common.go.html#4459822">cs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460295"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460296">.</span><span class="ident" id="4460297"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4460298">.</span><span class="ident" id="4460299"><a href="/gostd/container/list/list.go.html#4770646">MoveToFront</a></span><span class="op" id="4460310">(</span><span class="ident" id="4460311"><a href="/gostd/crypto/tls/common.go.html#4460150">elem</a></span><span class="op" id="4460315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460318"><a href="/gostd/crypto/tls/common.go.html#4459779">c</a></span><span class="op" id="4460319">.</span><span class="ident" id="4460320"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4460321">[</span><span class="ident" id="4460322"><a href="/gostd/crypto/tls/common.go.html#4459803">sessionKey</a></span><span class="op" id="4460332">]</span>&nbsp;<span class="op" id="4460334">=</span>&nbsp;<span class="ident" id="4460336"><a href="/gostd/crypto/tls/common.go.html#4460150">elem</a></span><br>
<span class="lineno"></span><span class="op" id="4460341">}</span><br>
<span class="lineno">575</span><br>
<span class="lineno"></span><span class="comment" id="4460344">//&nbsp;Get&nbsp;returns&nbsp;the&nbsp;ClientSessionState&nbsp;value&nbsp;associated&nbsp;with&nbsp;a&nbsp;given&nbsp;key.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="4460420">//&nbsp;returns&nbsp;(nil,&nbsp;false)&nbsp;if&nbsp;no&nbsp;value&nbsp;is&nbsp;found.</span><br>
<span class="lineno"></span><span class="keyword" id="4460466">func</span>&nbsp;<span class="op" id="4460471">(</span><span class="ident" id="4460472">c</span>&nbsp;<span class="op" id="4460474">*</span><span class="ident" id="4460475"><a href="/gostd/crypto/tls/common.go.html#4459051">lruSessionCache</a></span><span class="op" id="4460490">)</span>&nbsp;<span class="ident" id="4460492">Get</span><span class="op" id="4460495">(</span><span class="ident" id="4460496">sessionKey</span>&nbsp;<span class="builtintype" id="4460507">string</span><span class="op" id="4460513">)</span>&nbsp;<span class="op" id="4460515">(</span><span class="op" id="4460516">*</span><span class="ident" id="4460517"><a href="/gostd/crypto/tls/common.go.html#4448159">ClientSessionState</a></span><span class="op" id="4460535">,</span>&nbsp;<span class="builtintype" id="4460537">bool</span><span class="op" id="4460541">)</span>&nbsp;<span class="op" id="4460543">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460546"><a href="/gostd/crypto/tls/common.go.html#4460472">c</a></span><span class="op" id="4460547">.</span><span class="ident" id="4460548"><a href="/gostd/sync/mutex.go.html#1444351">Lock</a></span><span class="op" id="4460552">(</span><span class="op" id="4460553">)</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460556">defer</span>&nbsp;<span class="ident" id="4460562"><a href="/gostd/crypto/tls/common.go.html#4460472">c</a></span><span class="op" id="4460563">.</span><span class="ident" id="4460564"><a href="/gostd/sync/mutex.go.html#1445283">Unlock</a></span><span class="op" id="4460570">(</span><span class="op" id="4460571">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460575">if</span>&nbsp;<span class="ident" id="4460578">elem</span><span class="op" id="4460582">,</span>&nbsp;<span class="ident" id="4460584">ok</span>&nbsp;<span class="op" id="4460587">:=</span>&nbsp;<span class="ident" id="4460590"><a href="/gostd/crypto/tls/common.go.html#4460472">c</a></span><span class="op" id="4460591">.</span><span class="ident" id="4460592"><a href="/gostd/crypto/tls/common.go.html#4459090">m</a></span><span class="op" id="4460593">[</span><span class="ident" id="4460594"><a href="/gostd/crypto/tls/common.go.html#4460496">sessionKey</a></span><span class="op" id="4460604">]</span><span class="op" id="4460605">;</span>&nbsp;<span class="ident" id="4460607"><a href="/gostd/crypto/tls/common.go.html#4460584">ok</a></span>&nbsp;<span class="op" id="4460610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460614"><a href="/gostd/crypto/tls/common.go.html#4460472">c</a></span><span class="op" id="4460615">.</span><span class="ident" id="4460616"><a href="/gostd/crypto/tls/common.go.html#4459125">q</a></span><span class="op" id="4460617">.</span><span class="ident" id="4460618"><a href="/gostd/container/list/list.go.html#4770646">MoveToFront</a></span><span class="op" id="4460629">(</span><span class="ident" id="4460630"><a href="/gostd/crypto/tls/common.go.html#4460578">elem</a></span><span class="op" id="4460634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460638">return</span>&nbsp;<span class="ident" id="4460645"><a href="/gostd/crypto/tls/common.go.html#4460578">elem</a></span><span class="op" id="4460649">.</span><span class="ident" id="4460650"><a href="/gostd/container/list/list.go.html#4767061">Value</a></span><span class="op" id="4460655">.</span><span class="op" id="4460656">(</span><span class="op" id="4460657">*</span><span class="ident" id="4460658"><a href="/gostd/crypto/tls/common.go.html#4459167">lruSessionCacheEntry</a></span><span class="op" id="4460678">)</span><span class="op" id="4460679">.</span><span class="ident" id="4460680"><a href="/gostd/crypto/tls/common.go.html#4459217">state</a></span><span class="op" id="4460685">,</span>&nbsp;<span class="builtintype" id="4460687">true</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4460693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460696">return</span>&nbsp;<span class="builtintype" id="4460703">nil</span><span class="op" id="4460706">,</span>&nbsp;<span class="builtintype" id="4460708">false</span><br>
<span class="lineno"></span><span class="op" id="4460714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4460717">//&nbsp;TODO(jsing):&nbsp;Make&nbsp;these&nbsp;available&nbsp;to&nbsp;both&nbsp;crypto/x509&nbsp;and&nbsp;crypto/tls.</span><br>
<span class="lineno">590</span><span class="keyword" id="4460790">type</span>&nbsp;<span class="ident" id="4460795">dsaSignature</span>&nbsp;<span class="keyword" id="4460808">struct</span>&nbsp;<span class="op" id="4460815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460818">R</span><span class="op" id="4460819">,</span>&nbsp;<span class="ident" id="4460821">S</span>&nbsp;<span class="op" id="4460823">*</span><span class="ident" id="4460824"><a href="/gostd/crypto/tls/common.go.html#4442390">big</a></span><span class="op" id="4460827">.</span><span class="ident" id="4460828"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><br>
<span class="lineno"></span><span class="op" id="4460832">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4460835">type</span>&nbsp;<span class="ident" id="4460840">ecdsaSignature</span>&nbsp;<span class="ident" id="4460855"><a href="/gostd/crypto/tls/common.go.html#4460795">dsaSignature</a></span><br>
<span class="lineno">595</span><br>
<span class="lineno"></span><span class="keyword" id="4460869">var</span>&nbsp;<span class="ident" id="4460873">emptyConfig</span>&nbsp;<span class="ident" id="4460885"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4460893">func</span>&nbsp;<span class="ident" id="4460898">defaultConfig</span><span class="op" id="4460911">(</span><span class="op" id="4460912">)</span>&nbsp;<span class="op" id="4460914">*</span><span class="ident" id="4460915"><a href="/gostd/crypto/tls/common.go.html#4450481">Config</a></span>&nbsp;<span class="op" id="4460922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4460925">return</span>&nbsp;<span class="op" id="4460932">&amp;</span><span class="ident" id="4460933"><a href="/gostd/crypto/tls/common.go.html#4460873">emptyConfig</a></span><br>
<span class="lineno">600</span><span class="op" id="4460945">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4460948">var</span>&nbsp;<span class="op" id="4460952">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460955">once</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460978"><a href="/gostd/crypto/tls/common.go.html#4442413">sync</a></span><span class="op" id="4460982">.</span><span class="ident" id="4460983"><a href="/gostd/sync/once.go.html#1446221">Once</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4460989">varDefaultCipherSuites</span>&nbsp;<span class="op" id="4461012">[</span><span class="op" id="4461013">]</span><span class="builtintype" id="4461014">uint16</span><br>
<span class="lineno">605</span><span class="op" id="4461021">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4461024">func</span>&nbsp;<span class="ident" id="4461029">defaultCipherSuites</span><span class="op" id="4461048">(</span><span class="op" id="4461049">)</span>&nbsp;<span class="op" id="4461051">[</span><span class="op" id="4461052">]</span><span class="builtintype" id="4461053">uint16</span>&nbsp;<span class="op" id="4461060">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461063"><a href="/gostd/crypto/tls/common.go.html#4460955">once</a></span><span class="op" id="4461067">.</span><span class="ident" id="4461068"><a href="/gostd/sync/once.go.html#1447110">Do</a></span><span class="op" id="4461070">(</span><span class="ident" id="4461071"><a href="/gostd/crypto/tls/common.go.html#4461135">initDefaultCipherSuites</a></span><span class="op" id="4461094">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461097">return</span>&nbsp;<span class="ident" id="4461104"><a href="/gostd/crypto/tls/common.go.html#4460989">varDefaultCipherSuites</a></span><br>
<span class="lineno">610</span><span class="op" id="4461127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4461130">func</span>&nbsp;<span class="ident" id="4461135">initDefaultCipherSuites</span><span class="op" id="4461158">(</span><span class="op" id="4461159">)</span>&nbsp;<span class="op" id="4461161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461164"><a href="/gostd/crypto/tls/common.go.html#4460989">varDefaultCipherSuites</a></span>&nbsp;<span class="op" id="4461187">=</span>&nbsp;<span class="builtinfunc" id="4461189">make</span><span class="op" id="4461193">(</span><span class="op" id="4461194">[</span><span class="op" id="4461195">]</span><span class="builtintype" id="4461196">uint16</span><span class="op" id="4461202">,</span>&nbsp;<span class="builtinfunc" id="4461204">len</span><span class="op" id="4461207">(</span><span class="ident" id="4461208"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435091">cipherSuites</a></span><span class="op" id="4461220">)</span><span class="op" id="4461221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461224">for</span>&nbsp;<span class="ident" id="4461228">i</span><span class="op" id="4461229">,</span>&nbsp;<span class="ident" id="4461231">suite</span>&nbsp;<span class="op" id="4461237">:=</span>&nbsp;<span class="keyword" id="4461240">range</span>&nbsp;<span class="ident" id="4461246"><a href="/gostd/crypto/tls/cipher_suites.go.html#4435091">cipherSuites</a></span>&nbsp;<span class="op" id="4461259">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4461263"><a href="/gostd/crypto/tls/common.go.html#4460989">varDefaultCipherSuites</a></span><span class="op" id="4461285">[</span><span class="ident" id="4461286"><a href="/gostd/crypto/tls/common.go.html#4461228">i</a></span><span class="op" id="4461287">]</span>&nbsp;<span class="op" id="4461289">=</span>&nbsp;<span class="ident" id="4461291"><a href="/gostd/crypto/tls/common.go.html#4461231">suite</a></span><span class="op" id="4461296">.</span><span class="ident" id="4461297"><a href="/gostd/crypto/tls/cipher_suites.go.html#4434699">id</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4461301">}</span><br>
<span class="lineno"></span><span class="op" id="4461303">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4461306">func</span>&nbsp;<span class="ident" id="4461311">unexpectedMessageError</span><span class="op" id="4461333">(</span><span class="ident" id="4461334">wanted</span><span class="op" id="4461340">,</span>&nbsp;<span class="ident" id="4461342">got</span>&nbsp;<span class="keyword" id="4461346">interface</span><span class="op" id="4461355">{</span><span class="op" id="4461356">}</span><span class="op" id="4461357">)</span>&nbsp;<span class="builtintype" id="4461359">error</span>&nbsp;<span class="op" id="4461365">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4461368">return</span>&nbsp;<span class="ident" id="4461375"><a href="/gostd/crypto/tls/common.go.html#4442377">fmt</a></span><span class="op" id="4461378">.</span><span class="ident" id="4461379"><a href="/gostd/fmt/print.go.html#2143886">Errorf</a></span><span class="op" id="4461385">(</span><span class="string" id="4461386">&#34;tls:&nbsp;received&nbsp;unexpected&nbsp;handshake&nbsp;message&nbsp;of&nbsp;type&nbsp;%T&nbsp;when&nbsp;waiting&nbsp;for&nbsp;%T&#34;</span><span class="op" id="4461461">,</span>&nbsp;<span class="ident" id="4461463"><a href="/gostd/crypto/tls/common.go.html#4461342">got</a></span><span class="op" id="4461466">,</span>&nbsp;<span class="ident" id="4461468"><a href="/gostd/crypto/tls/common.go.html#4461334">wanted</a></span><span class="op" id="4461474">)</span><br>
<span class="lineno"></span><span class="op" id="4461476">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
