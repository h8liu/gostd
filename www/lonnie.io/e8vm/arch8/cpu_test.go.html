<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="8567654">package</span>&nbsp;<span class="ident" id="8567662">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8567669">import</span>&nbsp;<span class="op" id="8567676">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8567679">&#34;testing&#34;</span><br>
<span class="lineno">5</span><span class="op" id="8567689">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8567692">type</span>&nbsp;<span class="ident" id="8567697">ti1</span>&nbsp;<span class="builtintype" id="8567701">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8567706">func</span>&nbsp;<span class="op" id="8567711">(</span><span class="ident" id="8567712">i</span>&nbsp;<span class="ident" id="8567714">ti1</span><span class="op" id="8567717">)</span>&nbsp;<span class="ident" id="8567719">I</span><span class="op" id="8567720">(</span><span class="ident" id="8567721">cpu</span>&nbsp;<span class="op" id="8567725">*</span><span class="ident" id="8567726">cpu</span><span class="op" id="8567729">,</span>&nbsp;<span class="ident" id="8567731">in</span>&nbsp;<span class="builtintype" id="8567734">uint32</span><span class="op" id="8567740">)</span>&nbsp;<span class="op" id="8567742">*</span><span class="ident" id="8567743">Excep</span>&nbsp;<span class="op" id="8567749">{</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567752">switch</span>&nbsp;<span class="ident" id="8567759">in</span>&nbsp;<span class="op" id="8567762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567765">case</span>&nbsp;<span class="num" id="8567770">0</span><span class="op" id="8567771">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567775">return</span>&nbsp;<span class="ident" id="8567782">errHalt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567791">case</span>&nbsp;<span class="num" id="8567796">1</span><span class="op" id="8567797">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567801">return</span>&nbsp;<span class="ident" id="8567808">errTimeInt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567820">case</span>&nbsp;<span class="num" id="8567825">2</span><span class="op" id="8567826">:</span>&nbsp;<span class="comment" id="8567828">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567838">if</span>&nbsp;<span class="ident" id="8567841">cpu</span><span class="op" id="8567844">.</span><span class="ident" id="8567845">UserMode</span><span class="op" id="8567853">(</span><span class="op" id="8567854">)</span>&nbsp;<span class="op" id="8567856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567861">return</span>&nbsp;<span class="ident" id="8567868">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8567885">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567889">return</span>&nbsp;<span class="ident" id="8567896">cpu</span><span class="op" id="8567899">.</span><span class="ident" id="8567900">Iret</span><span class="op" id="8567904">(</span><span class="op" id="8567905">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567908">default</span><span class="op" id="8567915">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8567919">return</span>&nbsp;<span class="ident" id="8567926">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8567942">}</span><br>
<span class="lineno"></span><span class="op" id="8567944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="8567947">func</span>&nbsp;<span class="ident" id="8567952">TestCPU</span><span class="op" id="8567959">(</span><span class="ident" id="8567960">t</span>&nbsp;<span class="op" id="8567962">*</span><span class="ident" id="8567963">testing</span><span class="op" id="8567970">.</span><span class="ident" id="8567971">T</span><span class="op" id="8567972">)</span>&nbsp;<span class="op" id="8567974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8567977">as</span>&nbsp;<span class="op" id="8567980">:=</span>&nbsp;<span class="keyword" id="8567983">func</span><span class="op" id="8567987">(</span><span class="ident" id="8567988">cond</span>&nbsp;<span class="builtintype" id="8567993">bool</span><span class="op" id="8567997">,</span>&nbsp;<span class="ident" id="8567999">s</span>&nbsp;<span class="builtintype" id="8568001">string</span><span class="op" id="8568007">,</span>&nbsp;<span class="ident" id="8568009">args</span>&nbsp;<span class="op" id="8568014">...</span><span class="keyword" id="8568017">interface</span><span class="op" id="8568026">{</span><span class="op" id="8568027">}</span><span class="op" id="8568028">)</span>&nbsp;<span class="op" id="8568030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8568034">if</span>&nbsp;<span class="op" id="8568037">!</span><span class="ident" id="8568038">cond</span>&nbsp;<span class="op" id="8568043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568048">t</span><span class="op" id="8568049">.</span><span class="ident" id="8568050">Fatalf</span><span class="op" id="8568056">(</span><span class="ident" id="8568057">s</span><span class="op" id="8568058">,</span>&nbsp;<span class="ident" id="8568060">args</span><span class="op" id="8568064">...</span><span class="op" id="8568067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8568071">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8568074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568078">m</span>&nbsp;<span class="op" id="8568080">:=</span>&nbsp;<span class="ident" id="8568083">newPhyMemory</span><span class="op" id="8568095">(</span><span class="ident" id="8568096">PageSize</span>&nbsp;<span class="op" id="8568105">*</span>&nbsp;<span class="num" id="8568107">32</span><span class="op" id="8568109">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568112">cpu</span>&nbsp;<span class="op" id="8568116">:=</span>&nbsp;<span class="ident" id="8568119">newCPU</span><span class="op" id="8568125">(</span><span class="ident" id="8568126">m</span><span class="op" id="8568127">,</span>&nbsp;<span class="ident" id="8568129">ti1</span><span class="op" id="8568132">(</span><span class="num" id="8568133">0</span><span class="op" id="8568134">)</span><span class="op" id="8568135">,</span>&nbsp;<span class="num" id="8568137">0</span><span class="op" id="8568138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568141">e</span>&nbsp;<span class="op" id="8568143">:=</span>&nbsp;<span class="ident" id="8568146">cpu</span><span class="op" id="8568149">.</span><span class="ident" id="8568150">Tick</span><span class="op" id="8568154">(</span><span class="op" id="8568155">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568158">as</span><span class="op" id="8568160">(</span><span class="ident" id="8568161">e</span>&nbsp;<span class="op" id="8568163">==</span>&nbsp;<span class="ident" id="8568166">errHalt</span><span class="op" id="8568173">,</span>&nbsp;<span class="string" id="8568175">&#34;not&nbsp;halting&#34;</span><span class="op" id="8568188">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568192">cpu</span><span class="op" id="8568195">.</span><span class="ident" id="8568196">Reset</span><span class="op" id="8568201">(</span><span class="op" id="8568202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568205">m</span><span class="op" id="8568206">.</span><span class="ident" id="8568207">WriteWord</span><span class="op" id="8568216">(</span><span class="ident" id="8568217">InitPC</span><span class="op" id="8568223">,</span>&nbsp;<span class="num" id="8568225">1</span><span class="op" id="8568226">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568229">e</span>&nbsp;<span class="op" id="8568231">=</span>&nbsp;<span class="ident" id="8568233">cpu</span><span class="op" id="8568236">.</span><span class="ident" id="8568237">Tick</span><span class="op" id="8568241">(</span><span class="op" id="8568242">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568245">as</span><span class="op" id="8568247">(</span><span class="ident" id="8568248">e</span>&nbsp;<span class="op" id="8568250">==</span>&nbsp;<span class="ident" id="8568253">errTimeInt</span><span class="op" id="8568263">,</span>&nbsp;<span class="string" id="8568265">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8568285">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568289">cpu</span><span class="op" id="8568292">.</span><span class="ident" id="8568293">Reset</span><span class="op" id="8568298">(</span><span class="op" id="8568299">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568302">cpu</span><span class="op" id="8568305">.</span><span class="ident" id="8568306">interrupt</span><span class="op" id="8568315">.</span><span class="ident" id="8568316">Enable</span><span class="op" id="8568322">(</span><span class="op" id="8568323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568326">cpu</span><span class="op" id="8568329">.</span><span class="ident" id="8568330">interrupt</span><span class="op" id="8568339">.</span><span class="ident" id="8568340">EnableInt</span><span class="op" id="8568349">(</span><span class="ident" id="8568350">errTimeInt</span><span class="op" id="8568360">.</span><span class="ident" id="8568361">Code</span><span class="op" id="8568365">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568368">cpu</span><span class="op" id="8568371">.</span><span class="ident" id="8568372">interrupt</span><span class="op" id="8568381">.</span><span class="ident" id="8568382">writeWord</span><span class="op" id="8568391">(</span><span class="ident" id="8568392">intKernelSP</span><span class="op" id="8568403">,</span>&nbsp;<span class="num" id="8568405">0x10000</span><span class="op" id="8568412">)</span>&nbsp;&nbsp;<span class="comment" id="8568415">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568427">cpu</span><span class="op" id="8568430">.</span><span class="ident" id="8568431">interrupt</span><span class="op" id="8568440">.</span><span class="ident" id="8568441">writeWord</span><span class="op" id="8568450">(</span><span class="ident" id="8568451">intHandlerPC</span><span class="op" id="8568463">,</span>&nbsp;<span class="num" id="8568465">0x10000</span><span class="op" id="8568472">)</span>&nbsp;<span class="comment" id="8568474">//&nbsp;page&nbsp;16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568486">cpu</span><span class="op" id="8568489">.</span><span class="ident" id="8568490">ring</span>&nbsp;<span class="op" id="8568495">=</span>&nbsp;<span class="num" id="8568497">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568501">e</span>&nbsp;<span class="op" id="8568503">=</span>&nbsp;<span class="ident" id="8568505">cpu</span><span class="op" id="8568508">.</span><span class="ident" id="8568509">Tick</span><span class="op" id="8568513">(</span><span class="op" id="8568514">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568517">as</span><span class="op" id="8568519">(</span><span class="ident" id="8568520">e</span>&nbsp;<span class="op" id="8568522">==</span>&nbsp;<span class="ident" id="8568525">nil</span><span class="op" id="8568528">,</span>&nbsp;<span class="string" id="8568530">&#34;should&nbsp;have&nbsp;no&nbsp;error&#34;</span><span class="op" id="8568552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568555">as</span><span class="op" id="8568557">(</span><span class="ident" id="8568558">cpu</span><span class="op" id="8568561">.</span><span class="ident" id="8568562">regs</span><span class="op" id="8568566">[</span><span class="ident" id="8568567">PC</span><span class="op" id="8568569">]</span>&nbsp;<span class="op" id="8568571">==</span>&nbsp;<span class="num" id="8568574">0x10000</span><span class="op" id="8568581">,</span>&nbsp;<span class="string" id="8568583">&#34;pc&nbsp;incorrect&#34;</span><span class="op" id="8568597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568600">as</span><span class="op" id="8568602">(</span><span class="ident" id="8568603">cpu</span><span class="op" id="8568606">.</span><span class="ident" id="8568607">regs</span><span class="op" id="8568611">[</span><span class="ident" id="8568612">SP</span><span class="op" id="8568614">]</span>&nbsp;<span class="op" id="8568616">==</span>&nbsp;<span class="num" id="8568619">0x10000</span><span class="op" id="8568626">,</span>&nbsp;<span class="string" id="8568628">&#34;sp&nbsp;incorrect&#34;</span><span class="op" id="8568642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568645">as</span><span class="op" id="8568647">(</span><span class="ident" id="8568648">cpu</span><span class="op" id="8568651">.</span><span class="ident" id="8568652">regs</span><span class="op" id="8568656">[</span><span class="ident" id="8568657">RET</span><span class="op" id="8568660">]</span>&nbsp;<span class="op" id="8568662">==</span>&nbsp;<span class="num" id="8568665">0x8000</span><span class="op" id="8568671">,</span>&nbsp;<span class="string" id="8568673">&#34;ret&nbsp;incorrect&#34;</span><span class="op" id="8568688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568691">as</span><span class="op" id="8568693">(</span><span class="op" id="8568694">!</span><span class="ident" id="8568695">cpu</span><span class="op" id="8568698">.</span><span class="ident" id="8568699">UserMode</span><span class="op" id="8568707">(</span><span class="op" id="8568708">)</span><span class="op" id="8568709">,</span>&nbsp;<span class="string" id="8568711">&#34;not&nbsp;in&nbsp;kernel&#34;</span><span class="op" id="8568726">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568729">b</span><span class="op" id="8568730">,</span>&nbsp;<span class="ident" id="8568732">e</span>&nbsp;<span class="op" id="8568734">:=</span>&nbsp;<span class="ident" id="8568737">m</span><span class="op" id="8568738">.</span><span class="ident" id="8568739">ReadByte</span><span class="op" id="8568747">(</span><span class="num" id="8568748">0x10000</span>&nbsp;<span class="op" id="8568756">-</span>&nbsp;<span class="ident" id="8568758">intFrameSize</span>&nbsp;<span class="op" id="8568771">+</span>&nbsp;<span class="ident" id="8568773">intFrameCode</span><span class="op" id="8568785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568788">as</span><span class="op" id="8568790">(</span><span class="ident" id="8568791">e</span>&nbsp;<span class="op" id="8568793">==</span>&nbsp;<span class="ident" id="8568796">nil</span><span class="op" id="8568799">,</span>&nbsp;<span class="string" id="8568801">&#34;read&nbsp;byte&nbsp;error&#34;</span><span class="op" id="8568818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568821">as</span><span class="op" id="8568823">(</span><span class="ident" id="8568824">b</span>&nbsp;<span class="op" id="8568826">==</span>&nbsp;<span class="ident" id="8568829">errTimeInt</span><span class="op" id="8568839">.</span><span class="ident" id="8568840">Code</span><span class="op" id="8568844">,</span>&nbsp;<span class="string" id="8568846">&#34;not&nbsp;time&nbsp;interrupt&#34;</span><span class="op" id="8568866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568869">b</span><span class="op" id="8568870">,</span>&nbsp;<span class="ident" id="8568872">e</span>&nbsp;<span class="op" id="8568874">=</span>&nbsp;<span class="ident" id="8568876">m</span><span class="op" id="8568877">.</span><span class="ident" id="8568878">ReadByte</span><span class="op" id="8568886">(</span><span class="num" id="8568887">0x10000</span>&nbsp;<span class="op" id="8568895">-</span>&nbsp;<span class="ident" id="8568897">intFrameSize</span>&nbsp;<span class="op" id="8568910">+</span>&nbsp;<span class="ident" id="8568912">intFrameRing</span><span class="op" id="8568924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568927">as</span><span class="op" id="8568929">(</span><span class="ident" id="8568930">b</span>&nbsp;<span class="op" id="8568932">==</span>&nbsp;<span class="num" id="8568935">1</span><span class="op" id="8568936">,</span>&nbsp;<span class="string" id="8568938">&#34;was&nbsp;not&nbsp;in&nbsp;user&#34;</span><span class="op" id="8568955">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8568958">as</span><span class="op" id="8568960">(</span><span class="op" id="8568961">!</span><span class="ident" id="8568962">cpu</span><span class="op" id="8568965">.</span><span class="ident" id="8568966">interrupt</span><span class="op" id="8568975">.</span><span class="ident" id="8568976">Enabled</span><span class="op" id="8568983">(</span><span class="op" id="8568984">)</span><span class="op" id="8568985">,</span>&nbsp;<span class="string" id="8568987">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8569011">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569015">e</span>&nbsp;<span class="op" id="8569017">=</span>&nbsp;<span class="ident" id="8569019">cpu</span><span class="op" id="8569022">.</span><span class="ident" id="8569023">Tick</span><span class="op" id="8569027">(</span><span class="op" id="8569028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569031">as</span><span class="op" id="8569033">(</span><span class="ident" id="8569034">e</span>&nbsp;<span class="op" id="8569036">==</span>&nbsp;<span class="ident" id="8569039">errHalt</span><span class="op" id="8569046">,</span>&nbsp;<span class="string" id="8569048">&#34;should&nbsp;halt&nbsp;now&#34;</span><span class="op" id="8569065">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569069">cpu</span><span class="op" id="8569072">.</span><span class="ident" id="8569073">Reset</span><span class="op" id="8569078">(</span><span class="op" id="8569079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569082">cpu</span><span class="op" id="8569085">.</span><span class="ident" id="8569086">interrupt</span><span class="op" id="8569095">.</span><span class="ident" id="8569096">Enable</span><span class="op" id="8569102">(</span><span class="op" id="8569103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569106">cpu</span><span class="op" id="8569109">.</span><span class="ident" id="8569110">ring</span>&nbsp;<span class="op" id="8569115">=</span>&nbsp;<span class="num" id="8569117">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569120">m</span><span class="op" id="8569121">.</span><span class="ident" id="8569122">WriteWord</span><span class="op" id="8569131">(</span><span class="num" id="8569132">0x10000</span><span class="op" id="8569139">,</span>&nbsp;<span class="num" id="8569141">2</span><span class="op" id="8569142">)</span>&nbsp;<span class="comment" id="8569144">//&nbsp;write&nbsp;an&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569162">e</span>&nbsp;<span class="op" id="8569164">=</span>&nbsp;<span class="ident" id="8569166">cpu</span><span class="op" id="8569169">.</span><span class="ident" id="8569170">Tick</span><span class="op" id="8569174">(</span><span class="op" id="8569175">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569178">as</span><span class="op" id="8569180">(</span><span class="ident" id="8569181">e</span>&nbsp;<span class="op" id="8569183">==</span>&nbsp;<span class="ident" id="8569186">nil</span><span class="op" id="8569189">,</span>&nbsp;<span class="string" id="8569191">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8569213">,</span>&nbsp;<span class="ident" id="8569215">e</span><span class="op" id="8569216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569219">as</span><span class="op" id="8569221">(</span><span class="op" id="8569222">!</span><span class="ident" id="8569223">cpu</span><span class="op" id="8569226">.</span><span class="ident" id="8569227">interrupt</span><span class="op" id="8569236">.</span><span class="ident" id="8569237">Enabled</span><span class="op" id="8569244">(</span><span class="op" id="8569245">)</span><span class="op" id="8569246">,</span>&nbsp;<span class="string" id="8569248">&#34;interrupt&nbsp;not&nbsp;disabled&#34;</span><span class="op" id="8569272">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569275">e</span>&nbsp;<span class="op" id="8569277">=</span>&nbsp;<span class="ident" id="8569279">cpu</span><span class="op" id="8569282">.</span><span class="ident" id="8569283">Tick</span><span class="op" id="8569287">(</span><span class="op" id="8569288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569291">as</span><span class="op" id="8569293">(</span><span class="ident" id="8569294">e</span>&nbsp;<span class="op" id="8569296">==</span>&nbsp;<span class="ident" id="8569299">nil</span><span class="op" id="8569302">,</span>&nbsp;<span class="string" id="8569304">&#34;unexpected&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="8569326">,</span>&nbsp;<span class="ident" id="8569328">e</span><span class="op" id="8569329">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569332">as</span><span class="op" id="8569334">(</span><span class="ident" id="8569335">cpu</span><span class="op" id="8569338">.</span><span class="ident" id="8569339">regs</span><span class="op" id="8569343">[</span><span class="ident" id="8569344">PC</span><span class="op" id="8569346">]</span>&nbsp;<span class="op" id="8569348">==</span>&nbsp;<span class="num" id="8569351">0x8000</span><span class="op" id="8569357">,</span>&nbsp;<span class="string" id="8569359">&#34;pc&nbsp;not&nbsp;iret&#39;ed&#34;</span><span class="op" id="8569375">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569378">as</span><span class="op" id="8569380">(</span><span class="ident" id="8569381">cpu</span><span class="op" id="8569384">.</span><span class="ident" id="8569385">regs</span><span class="op" id="8569389">[</span><span class="ident" id="8569390">SP</span><span class="op" id="8569392">]</span>&nbsp;<span class="op" id="8569394">==</span>&nbsp;<span class="num" id="8569397">0</span><span class="op" id="8569398">,</span>&nbsp;<span class="string" id="8569400">&#34;sp&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8569417">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569420">as</span><span class="op" id="8569422">(</span><span class="ident" id="8569423">cpu</span><span class="op" id="8569426">.</span><span class="ident" id="8569427">ring</span>&nbsp;<span class="op" id="8569432">==</span>&nbsp;<span class="num" id="8569435">1</span><span class="op" id="8569436">,</span>&nbsp;<span class="string" id="8569438">&#34;ring&nbsp;not&nbsp;restored&#34;</span><span class="op" id="8569457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569460">as</span><span class="op" id="8569462">(</span><span class="ident" id="8569463">cpu</span><span class="op" id="8569466">.</span><span class="ident" id="8569467">interrupt</span><span class="op" id="8569476">.</span><span class="ident" id="8569477">Enabled</span><span class="op" id="8569484">(</span><span class="op" id="8569485">)</span><span class="op" id="8569486">,</span>&nbsp;<span class="string" id="8569488">&#34;interrupt&nbsp;not&nbsp;enabled&nbsp;again&#34;</span><span class="op" id="8569517">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569520">has</span><span class="op" id="8569523">,</span>&nbsp;<span class="ident" id="8569525">code</span>&nbsp;<span class="op" id="8569530">:=</span>&nbsp;<span class="ident" id="8569533">cpu</span><span class="op" id="8569536">.</span><span class="ident" id="8569537">interrupt</span><span class="op" id="8569546">.</span><span class="ident" id="8569547">Poll</span><span class="op" id="8569551">(</span><span class="op" id="8569552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8569555">as</span><span class="op" id="8569557">(</span><span class="op" id="8569558">!</span><span class="ident" id="8569559">has</span>&nbsp;<span class="op" id="8569563">&amp;&amp;</span>&nbsp;<span class="ident" id="8569566">code</span>&nbsp;<span class="op" id="8569571">==</span>&nbsp;<span class="num" id="8569574">0</span><span class="op" id="8569575">,</span>&nbsp;<span class="string" id="8569577">&#34;interrupt&nbsp;was&nbsp;not&nbsp;cleared&#34;</span><span class="op" id="8569604">)</span><br>
<span class="lineno">80</span><span class="op" id="8569606">}</span>
</div>
</body>
</html>
