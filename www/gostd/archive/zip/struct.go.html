<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4222212">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4222267">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4222321">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4222372">/*<br>
<span class="lineno"></span>Package&nbsp;zip&nbsp;provides&nbsp;support&nbsp;for&nbsp;reading&nbsp;and&nbsp;writing&nbsp;ZIP&nbsp;archives.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>See:&nbsp;http://www.pkware.com/documents/casestudies/APPNOTE.TXT<br>
<span class="lineno"></span><br>
<span class="lineno">10</span>This&nbsp;package&nbsp;does&nbsp;not&nbsp;support&nbsp;disk&nbsp;spanning.<br>
<span class="lineno"></span><br>
<span class="lineno"></span>A&nbsp;note&nbsp;about&nbsp;ZIP64:<br>
<span class="lineno"></span><br>
<span class="lineno"></span>To&nbsp;be&nbsp;backwards&nbsp;compatible&nbsp;the&nbsp;FileHeader&nbsp;has&nbsp;both&nbsp;32&nbsp;and&nbsp;64&nbsp;bit&nbsp;Size<br>
<span class="lineno">15</span>fields.&nbsp;The&nbsp;64&nbsp;bit&nbsp;fields&nbsp;will&nbsp;always&nbsp;contain&nbsp;the&nbsp;correct&nbsp;value&nbsp;and<br>
<span class="lineno"></span>for&nbsp;normal&nbsp;archives&nbsp;both&nbsp;fields&nbsp;will&nbsp;be&nbsp;the&nbsp;same.&nbsp;For&nbsp;files&nbsp;requiring<br>
<span class="lineno"></span>the&nbsp;ZIP64&nbsp;format&nbsp;the&nbsp;32&nbsp;bit&nbsp;fields&nbsp;will&nbsp;be&nbsp;0xffffffff&nbsp;and&nbsp;the&nbsp;64&nbsp;bit<br>
<span class="lineno"></span>fields&nbsp;must&nbsp;be&nbsp;used&nbsp;instead.<br>
<span class="lineno"></span>*/</span><br>
<span class="lineno">20</span><span class="keyword" id="4222881">package</span>&nbsp;<span class="ident" id="4222889">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4222894">import</span>&nbsp;<span class="op" id="4222901">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4222904">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4222910">&#34;path&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4222918">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="4222925">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4222928">//&nbsp;Compression&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="4222952">const</span>&nbsp;<span class="op" id="4222958">(</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222961">Store</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4222969">uint16</span>&nbsp;<span class="op" id="4222976">=</span>&nbsp;<span class="num" id="4222978">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4222981">Deflate</span>&nbsp;<span class="builtintype" id="4222989">uint16</span>&nbsp;<span class="op" id="4222996">=</span>&nbsp;<span class="num" id="4222998">8</span><br>
<span class="lineno"></span><span class="op" id="4223000">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4223003">const</span>&nbsp;<span class="op" id="4223009">(</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223012">fileHeaderSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223037">=</span>&nbsp;<span class="num" id="4223039">0x04034b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223051">directoryHeaderSignature</span>&nbsp;<span class="op" id="4223076">=</span>&nbsp;<span class="num" id="4223078">0x02014b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223090">directoryEndSignature</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223115">=</span>&nbsp;<span class="num" id="4223117">0x06054b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223129">directory64LocSignature</span>&nbsp;&nbsp;<span class="op" id="4223154">=</span>&nbsp;<span class="num" id="4223156">0x07064b50</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223168">directory64EndSignature</span>&nbsp;&nbsp;<span class="op" id="4223193">=</span>&nbsp;<span class="num" id="4223195">0x06064b50</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223207">dataDescriptorSignature</span>&nbsp;&nbsp;<span class="op" id="4223232">=</span>&nbsp;<span class="num" id="4223234">0x08074b50</span>&nbsp;<span class="comment" id="4223245">//&nbsp;de-facto&nbsp;standard;&nbsp;required&nbsp;by&nbsp;OS&nbsp;X&nbsp;Finder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223292">fileHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223317">=</span>&nbsp;<span class="num" id="4223319">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223330">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223353">directoryHeaderLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223378">=</span>&nbsp;<span class="num" id="4223380">46</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223391">//&nbsp;+&nbsp;filename&nbsp;+&nbsp;extra&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223424">directoryEndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223449">=</span>&nbsp;<span class="num" id="4223451">22</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223462">//&nbsp;+&nbsp;comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223476">dataDescriptorLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223501">=</span>&nbsp;<span class="num" id="4223503">16</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223514">//&nbsp;four&nbsp;uint32:&nbsp;descriptor&nbsp;signature,&nbsp;crc32,&nbsp;compressed&nbsp;size,&nbsp;size</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223582">dataDescriptor64Len</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223607">=</span>&nbsp;<span class="num" id="4223609">24</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223620">//&nbsp;descriptor&nbsp;with&nbsp;8&nbsp;byte&nbsp;sizes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223653">directory64LocLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223678">=</span>&nbsp;<span class="num" id="4223680">20</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223691">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223695">directory64EndLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223720">=</span>&nbsp;<span class="num" id="4223722">56</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4223733">//&nbsp;+&nbsp;extra</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223746">//&nbsp;Constants&nbsp;for&nbsp;the&nbsp;first&nbsp;byte&nbsp;in&nbsp;CreatorVersion</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223797">creatorFAT</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4223811">=</span>&nbsp;<span class="num" id="4223813">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223816">creatorUnix</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4223830">=</span>&nbsp;<span class="num" id="4223832">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223835">creatorNTFS</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4223849">=</span>&nbsp;<span class="num" id="4223851">11</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223855">creatorVFAT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4223869">=</span>&nbsp;<span class="num" id="4223871">14</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223875">creatorMacOSX</span>&nbsp;<span class="op" id="4223889">=</span>&nbsp;<span class="num" id="4223891">19</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4223896">//&nbsp;version&nbsp;numbers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223916">zipVersion20</span>&nbsp;<span class="op" id="4223929">=</span>&nbsp;<span class="num" id="4223931">20</span>&nbsp;<span class="comment" id="4223934">//&nbsp;2.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4223942">zipVersion45</span>&nbsp;<span class="op" id="4223955">=</span>&nbsp;<span class="num" id="4223957">45</span>&nbsp;<span class="comment" id="4223960">//&nbsp;4.5&nbsp;(reads&nbsp;and&nbsp;writes&nbsp;zip64&nbsp;archives)</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224003">//&nbsp;limits&nbsp;for&nbsp;non&nbsp;zip64&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224034">uint16max</span>&nbsp;<span class="op" id="4224044">=</span>&nbsp;<span class="op" id="4224046">(</span><span class="num" id="4224047">1</span>&nbsp;<span class="op" id="4224049">&lt;&lt;</span>&nbsp;<span class="num" id="4224052">16</span><span class="op" id="4224054">)</span>&nbsp;<span class="op" id="4224056">-</span>&nbsp;<span class="num" id="4224058">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224061">uint32max</span>&nbsp;<span class="op" id="4224071">=</span>&nbsp;<span class="op" id="4224073">(</span><span class="num" id="4224074">1</span>&nbsp;<span class="op" id="4224076">&lt;&lt;</span>&nbsp;<span class="num" id="4224079">32</span><span class="op" id="4224081">)</span>&nbsp;<span class="op" id="4224083">-</span>&nbsp;<span class="num" id="4224085">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224089">//&nbsp;extra&nbsp;header&nbsp;id&#39;s</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224111">zip64ExtraId</span>&nbsp;<span class="op" id="4224124">=</span>&nbsp;<span class="num" id="4224126">0x0001</span>&nbsp;<span class="comment" id="4224133">//&nbsp;zip64&nbsp;Extended&nbsp;Information&nbsp;Extra&nbsp;Field</span><br>
<span class="lineno"></span><span class="op" id="4224175">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4224178">//&nbsp;FileHeader&nbsp;describes&nbsp;a&nbsp;file&nbsp;within&nbsp;a&nbsp;zip&nbsp;file.</span><br>
<span class="lineno"></span><span class="comment" id="4224228">//&nbsp;See&nbsp;the&nbsp;zip&nbsp;spec&nbsp;for&nbsp;details.</span><br>
<span class="lineno">70</span><span class="keyword" id="4224261">type</span>&nbsp;<span class="ident" id="4224266">FileHeader</span>&nbsp;<span class="keyword" id="4224277">struct</span>&nbsp;<span class="op" id="4224284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224287">//&nbsp;Name&nbsp;is&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224321">//&nbsp;It&nbsp;must&nbsp;be&nbsp;a&nbsp;relative&nbsp;path:&nbsp;it&nbsp;must&nbsp;not&nbsp;start&nbsp;with&nbsp;a&nbsp;drive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224384">//&nbsp;letter&nbsp;(e.g.&nbsp;C:)&nbsp;or&nbsp;leading&nbsp;slash,&nbsp;and&nbsp;only&nbsp;forward&nbsp;slashes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4224448">//&nbsp;are&nbsp;allowed.</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224465">Name</span>&nbsp;<span class="builtintype" id="4224470">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224479">CreatorVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224498">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224506">ReaderVersion</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224525">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224533">Flags</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224552">uint16</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224560">Method</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224579">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224587">ModifiedTime</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224606">uint16</span>&nbsp;<span class="comment" id="4224613">//&nbsp;MS-DOS&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224629">ModifiedDate</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224648">uint16</span>&nbsp;<span class="comment" id="4224655">//&nbsp;MS-DOS&nbsp;date</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224671">CRC32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224690">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224698">CompressedSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224717">uint32</span>&nbsp;<span class="comment" id="4224724">//&nbsp;deprecated;&nbsp;use&nbsp;CompressedSize64</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224761">UncompressedSize</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224780">uint32</span>&nbsp;<span class="comment" id="4224787">//&nbsp;deprecated;&nbsp;use&nbsp;UncompressedSize64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224826">CompressedSize64</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4224845">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224853">UncompressedSize64</span>&nbsp;<span class="ident" id="4224872">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224880">Extra</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4224899">[</span><span class="op" id="4224900">]</span><span class="builtintype" id="4224901">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224907">ExternalAttrs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224926">uint32</span>&nbsp;<span class="comment" id="4224933">//&nbsp;Meaning&nbsp;depends&nbsp;on&nbsp;CreatorVersion</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4224971">Comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4224990">string</span><br>
<span class="lineno"></span><span class="op" id="4224997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4225000">//&nbsp;FileInfo&nbsp;returns&nbsp;an&nbsp;os.FileInfo&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="4225055">func</span>&nbsp;<span class="op" id="4225060">(</span><span class="ident" id="4225061">h</span>&nbsp;<span class="op" id="4225063">*</span><span class="ident" id="4225064">FileHeader</span><span class="op" id="4225074">)</span>&nbsp;<span class="ident" id="4225076">FileInfo</span><span class="op" id="4225084">(</span><span class="op" id="4225085">)</span>&nbsp;<span class="ident" id="4225087">os</span><span class="op" id="4225089">.</span><span class="ident" id="4225090">FileInfo</span>&nbsp;<span class="op" id="4225099">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225102">return</span>&nbsp;<span class="ident" id="4225109">headerFileInfo</span><span class="op" id="4225123">{</span><span class="ident" id="4225124">h</span><span class="op" id="4225125">}</span><br>
<span class="lineno"></span><span class="op" id="4225127">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4225130">//&nbsp;headerFileInfo&nbsp;implements&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="keyword" id="4225172">type</span>&nbsp;<span class="ident" id="4225177">headerFileInfo</span>&nbsp;<span class="keyword" id="4225192">struct</span>&nbsp;<span class="op" id="4225199">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4225202">fh</span>&nbsp;<span class="op" id="4225205">*</span><span class="ident" id="4225206">FileHeader</span><br>
<span class="lineno"></span><span class="op" id="4225217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4225220">func</span>&nbsp;<span class="op" id="4225225">(</span><span class="ident" id="4225226">fi</span>&nbsp;<span class="ident" id="4225229">headerFileInfo</span><span class="op" id="4225243">)</span>&nbsp;<span class="ident" id="4225245">Name</span><span class="op" id="4225249">(</span><span class="op" id="4225250">)</span>&nbsp;<span class="builtintype" id="4225252">string</span>&nbsp;<span class="op" id="4225259">{</span>&nbsp;<span class="keyword" id="4225261">return</span>&nbsp;<span class="ident" id="4225268">path</span><span class="op" id="4225272">.</span><span class="ident" id="4225273">Base</span><span class="op" id="4225277">(</span><span class="ident" id="4225278">fi</span><span class="op" id="4225280">.</span><span class="ident" id="4225281">fh</span><span class="op" id="4225283">.</span><span class="ident" id="4225284">Name</span><span class="op" id="4225288">)</span>&nbsp;<span class="op" id="4225290">}</span><br>
<span class="lineno"></span><span class="keyword" id="4225292">func</span>&nbsp;<span class="op" id="4225297">(</span><span class="ident" id="4225298">fi</span>&nbsp;<span class="ident" id="4225301">headerFileInfo</span><span class="op" id="4225315">)</span>&nbsp;<span class="ident" id="4225317">Size</span><span class="op" id="4225321">(</span><span class="op" id="4225322">)</span>&nbsp;<span class="ident" id="4225324">int64</span>&nbsp;<span class="op" id="4225330">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225333">if</span>&nbsp;<span class="ident" id="4225336">fi</span><span class="op" id="4225338">.</span><span class="ident" id="4225339">fh</span><span class="op" id="4225341">.</span><span class="ident" id="4225342">UncompressedSize64</span>&nbsp;<span class="op" id="4225361">&gt;</span>&nbsp;<span class="num" id="4225363">0</span>&nbsp;<span class="op" id="4225365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225369">return</span>&nbsp;<span class="ident" id="4225376">int64</span><span class="op" id="4225381">(</span><span class="ident" id="4225382">fi</span><span class="op" id="4225384">.</span><span class="ident" id="4225385">fh</span><span class="op" id="4225387">.</span><span class="ident" id="4225388">UncompressedSize64</span><span class="op" id="4225406">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4225409">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4225412">return</span>&nbsp;<span class="ident" id="4225419">int64</span><span class="op" id="4225424">(</span><span class="ident" id="4225425">fi</span><span class="op" id="4225427">.</span><span class="ident" id="4225428">fh</span><span class="op" id="4225430">.</span><span class="ident" id="4225431">UncompressedSize</span><span class="op" id="4225447">)</span><br>
<span class="lineno"></span><span class="op" id="4225449">}</span><br>
<span class="lineno">110</span><span class="keyword" id="4225451">func</span>&nbsp;<span class="op" id="4225456">(</span><span class="ident" id="4225457">fi</span>&nbsp;<span class="ident" id="4225460">headerFileInfo</span><span class="op" id="4225474">)</span>&nbsp;<span class="ident" id="4225476">IsDir</span><span class="op" id="4225481">(</span><span class="op" id="4225482">)</span>&nbsp;<span class="builtintype" id="4225484">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4225496">{</span>&nbsp;<span class="keyword" id="4225498">return</span>&nbsp;<span class="ident" id="4225505">fi</span><span class="op" id="4225507">.</span><span class="ident" id="4225508">Mode</span><span class="op" id="4225512">(</span><span class="op" id="4225513">)</span><span class="op" id="4225514">.</span><span class="ident" id="4225515">IsDir</span><span class="op" id="4225520">(</span><span class="op" id="4225521">)</span>&nbsp;<span class="op" id="4225523">}</span><br>
<span class="lineno"></span><span class="keyword" id="4225525">func</span>&nbsp;<span class="op" id="4225530">(</span><span class="ident" id="4225531">fi</span>&nbsp;<span class="ident" id="4225534">headerFileInfo</span><span class="op" id="4225548">)</span>&nbsp;<span class="ident" id="4225550">ModTime</span><span class="op" id="4225557">(</span><span class="op" id="4225558">)</span>&nbsp;<span class="ident" id="4225560">time</span><span class="op" id="4225564">.</span><span class="ident" id="4225565">Time</span>&nbsp;<span class="op" id="4225570">{</span>&nbsp;<span class="keyword" id="4225572">return</span>&nbsp;<span class="ident" id="4225579">fi</span><span class="op" id="4225581">.</span><span class="ident" id="4225582">fh</span><span class="op" id="4225584">.</span><span class="ident" id="4225585">ModTime</span><span class="op" id="4225592">(</span><span class="op" id="4225593">)</span>&nbsp;<span class="op" id="4225595">}</span><br>
<span class="lineno"></span><span class="keyword" id="4225597">func</span>&nbsp;<span class="op" id="4225602">(</span><span class="ident" id="4225603">fi</span>&nbsp;<span class="ident" id="4225606">headerFileInfo</span><span class="op" id="4225620">)</span>&nbsp;<span class="ident" id="4225622">Mode</span><span class="op" id="4225626">(</span><span class="op" id="4225627">)</span>&nbsp;<span class="ident" id="4225629">os</span><span class="op" id="4225631">.</span><span class="ident" id="4225632">FileMode</span>&nbsp;&nbsp;<span class="op" id="4225642">{</span>&nbsp;<span class="keyword" id="4225644">return</span>&nbsp;<span class="ident" id="4225651">fi</span><span class="op" id="4225653">.</span><span class="ident" id="4225654">fh</span><span class="op" id="4225656">.</span><span class="ident" id="4225657">Mode</span><span class="op" id="4225661">(</span><span class="op" id="4225662">)</span>&nbsp;<span class="op" id="4225664">}</span><br>
<span class="lineno"></span><span class="keyword" id="4225666">func</span>&nbsp;<span class="op" id="4225671">(</span><span class="ident" id="4225672">fi</span>&nbsp;<span class="ident" id="4225675">headerFileInfo</span><span class="op" id="4225689">)</span>&nbsp;<span class="ident" id="4225691">Sys</span><span class="op" id="4225694">(</span><span class="op" id="4225695">)</span>&nbsp;<span class="keyword" id="4225697">interface</span><span class="op" id="4225706">{</span><span class="op" id="4225707">}</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4225711">{</span>&nbsp;<span class="keyword" id="4225713">return</span>&nbsp;<span class="ident" id="4225720">fi</span><span class="op" id="4225722">.</span><span class="ident" id="4225723">fh</span>&nbsp;<span class="op" id="4225726">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4225729">//&nbsp;FileInfoHeader&nbsp;creates&nbsp;a&nbsp;partially-populated&nbsp;FileHeader&nbsp;from&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="4225796">//&nbsp;os.FileInfo.</span><br>
<span class="lineno"></span><span class="comment" id="4225812">//&nbsp;Because&nbsp;os.FileInfo&#39;s&nbsp;Name&nbsp;method&nbsp;returns&nbsp;only&nbsp;the&nbsp;base&nbsp;name&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="4225879">//&nbsp;the&nbsp;file&nbsp;it&nbsp;describes,&nbsp;it&nbsp;may&nbsp;be&nbsp;necessary&nbsp;to&nbsp;modify&nbsp;the&nbsp;Name&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="4225950">//&nbsp;of&nbsp;the&nbsp;returned&nbsp;header&nbsp;to&nbsp;provide&nbsp;the&nbsp;full&nbsp;path&nbsp;name&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">120</span><span class="keyword" id="4226019">func</span>&nbsp;<span class="ident" id="4226024">FileInfoHeader</span><span class="op" id="4226038">(</span><span class="ident" id="4226039">fi</span>&nbsp;<span class="ident" id="4226042">os</span><span class="op" id="4226044">.</span><span class="ident" id="4226045">FileInfo</span><span class="op" id="4226053">)</span>&nbsp;<span class="op" id="4226055">(</span><span class="op" id="4226056">*</span><span class="ident" id="4226057">FileHeader</span><span class="op" id="4226067">,</span>&nbsp;<span class="builtintype" id="4226069">error</span><span class="op" id="4226074">)</span>&nbsp;<span class="op" id="4226076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226079">size</span>&nbsp;<span class="op" id="4226084">:=</span>&nbsp;<span class="ident" id="4226087">fi</span><span class="op" id="4226089">.</span><span class="ident" id="4226090">Size</span><span class="op" id="4226094">(</span><span class="op" id="4226095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226098">fh</span>&nbsp;<span class="op" id="4226101">:=</span>&nbsp;<span class="op" id="4226104">&amp;</span><span class="ident" id="4226105">FileHeader</span><span class="op" id="4226115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226119">Name</span><span class="op" id="4226123">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4226139">fi</span><span class="op" id="4226141">.</span><span class="ident" id="4226142">Name</span><span class="op" id="4226146">(</span><span class="op" id="4226147">)</span><span class="op" id="4226148">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226152">UncompressedSize64</span><span class="op" id="4226170">:</span>&nbsp;<span class="ident" id="4226172">uint64</span><span class="op" id="4226178">(</span><span class="ident" id="4226179">size</span><span class="op" id="4226183">)</span><span class="op" id="4226184">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226190">fh</span><span class="op" id="4226192">.</span><span class="ident" id="4226193">SetModTime</span><span class="op" id="4226203">(</span><span class="ident" id="4226204">fi</span><span class="op" id="4226206">.</span><span class="ident" id="4226207">ModTime</span><span class="op" id="4226214">(</span><span class="op" id="4226215">)</span><span class="op" id="4226216">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226219">fh</span><span class="op" id="4226221">.</span><span class="ident" id="4226222">SetMode</span><span class="op" id="4226229">(</span><span class="ident" id="4226230">fi</span><span class="op" id="4226232">.</span><span class="ident" id="4226233">Mode</span><span class="op" id="4226237">(</span><span class="op" id="4226238">)</span><span class="op" id="4226239">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226242">if</span>&nbsp;<span class="ident" id="4226245">fh</span><span class="op" id="4226247">.</span><span class="ident" id="4226248">UncompressedSize64</span>&nbsp;<span class="op" id="4226267">&gt;</span>&nbsp;<span class="ident" id="4226269">uint32max</span>&nbsp;<span class="op" id="4226279">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226283">fh</span><span class="op" id="4226285">.</span><span class="ident" id="4226286">UncompressedSize</span>&nbsp;<span class="op" id="4226303">=</span>&nbsp;<span class="ident" id="4226305">uint32max</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226316">}</span>&nbsp;<span class="keyword" id="4226318">else</span>&nbsp;<span class="op" id="4226323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226327">fh</span><span class="op" id="4226329">.</span><span class="ident" id="4226330">UncompressedSize</span>&nbsp;<span class="op" id="4226347">=</span>&nbsp;<span class="builtintype" id="4226349">uint32</span><span class="op" id="4226355">(</span><span class="ident" id="4226356">fh</span><span class="op" id="4226358">.</span><span class="ident" id="4226359">UncompressedSize64</span><span class="op" id="4226377">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4226380">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226383">return</span>&nbsp;<span class="ident" id="4226390">fh</span><span class="op" id="4226392">,</span>&nbsp;<span class="ident" id="4226394">nil</span><br>
<span class="lineno"></span><span class="op" id="4226398">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="keyword" id="4226401">type</span>&nbsp;<span class="ident" id="4226406">directoryEnd</span>&nbsp;<span class="keyword" id="4226419">struct</span>&nbsp;<span class="op" id="4226426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226429">diskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4226448">uint32</span>&nbsp;<span class="comment" id="4226455">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226466">dirDiskNbr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4226485">uint32</span>&nbsp;<span class="comment" id="4226492">//&nbsp;unused</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226503">dirRecordsThisDisk</span>&nbsp;<span class="ident" id="4226522">uint64</span>&nbsp;<span class="comment" id="4226529">//&nbsp;unused</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226540">directoryRecords</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4226559">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226567">directorySize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4226586">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226594">directoryOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4226613">uint64</span>&nbsp;<span class="comment" id="4226620">//&nbsp;relative&nbsp;to&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226641">commentLen</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4226660">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4226668">comment</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4226687">string</span><br>
<span class="lineno">145</span><span class="op" id="4226694">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4226697">//&nbsp;msDosTimeToTime&nbsp;converts&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time&nbsp;into&nbsp;a&nbsp;time.Time.</span><br>
<span class="lineno"></span><span class="comment" id="4226767">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="4226792">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724247(v=VS.85).aspx</span><br>
<span class="lineno">150</span><span class="keyword" id="4226863">func</span>&nbsp;<span class="ident" id="4226868">msDosTimeToTime</span><span class="op" id="4226883">(</span><span class="ident" id="4226884">dosDate</span><span class="op" id="4226891">,</span>&nbsp;<span class="ident" id="4226893">dosTime</span>&nbsp;<span class="builtintype" id="4226901">uint16</span><span class="op" id="4226907">)</span>&nbsp;<span class="ident" id="4226909">time</span><span class="op" id="4226913">.</span><span class="ident" id="4226914">Time</span>&nbsp;<span class="op" id="4226919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4226922">return</span>&nbsp;<span class="ident" id="4226929">time</span><span class="op" id="4226933">.</span><span class="ident" id="4226934">Date</span><span class="op" id="4226938">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4226942">//&nbsp;date&nbsp;bits&nbsp;0-4:&nbsp;day&nbsp;of&nbsp;month;&nbsp;5-8:&nbsp;month;&nbsp;9-15:&nbsp;years&nbsp;since&nbsp;1980</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4227011">int</span><span class="op" id="4227014">(</span><span class="ident" id="4227015">dosDate</span><span class="op" id="4227022">&gt;&gt;</span><span class="num" id="4227024">9</span><span class="op" id="4227025">+</span><span class="num" id="4227026">1980</span><span class="op" id="4227030">)</span><span class="op" id="4227031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227035">time</span><span class="op" id="4227039">.</span><span class="ident" id="4227040">Month</span><span class="op" id="4227045">(</span><span class="ident" id="4227046">dosDate</span><span class="op" id="4227053">&gt;&gt;</span><span class="num" id="4227055">5</span><span class="op" id="4227056">&amp;</span><span class="num" id="4227057">0xf</span><span class="op" id="4227060">)</span><span class="op" id="4227061">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4227065">int</span><span class="op" id="4227068">(</span><span class="ident" id="4227069">dosDate</span><span class="op" id="4227076">&amp;</span><span class="num" id="4227077">0x1f</span><span class="op" id="4227081">)</span><span class="op" id="4227082">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4227087">//&nbsp;time&nbsp;bits&nbsp;0-4:&nbsp;second/2;&nbsp;5-10:&nbsp;minute;&nbsp;11-15:&nbsp;hour</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4227143">int</span><span class="op" id="4227146">(</span><span class="ident" id="4227147">dosTime</span><span class="op" id="4227154">&gt;&gt;</span><span class="num" id="4227156">11</span><span class="op" id="4227158">)</span><span class="op" id="4227159">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4227163">int</span><span class="op" id="4227166">(</span><span class="ident" id="4227167">dosTime</span><span class="op" id="4227174">&gt;&gt;</span><span class="num" id="4227176">5</span><span class="op" id="4227177">&amp;</span><span class="num" id="4227178">0x3f</span><span class="op" id="4227182">)</span><span class="op" id="4227183">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="4227187">int</span><span class="op" id="4227190">(</span><span class="ident" id="4227191">dosTime</span><span class="op" id="4227198">&amp;</span><span class="num" id="4227199">0x1f</span><span class="op" id="4227203">*</span><span class="num" id="4227204">2</span><span class="op" id="4227205">)</span><span class="op" id="4227206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4227210">0</span><span class="op" id="4227211">,</span>&nbsp;<span class="comment" id="4227213">//&nbsp;nanoseconds</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227231">time</span><span class="op" id="4227235">.</span><span class="ident" id="4227236">UTC</span><span class="op" id="4227239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4227242">)</span><br>
<span class="lineno">165</span><span class="op" id="4227244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4227247">//&nbsp;timeToMsDosTime&nbsp;converts&nbsp;a&nbsp;time.Time&nbsp;to&nbsp;an&nbsp;MS-DOS&nbsp;date&nbsp;and&nbsp;time.</span><br>
<span class="lineno"></span><span class="comment" id="4227315">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="comment" id="4227340">//&nbsp;See:&nbsp;http://msdn.microsoft.com/en-us/library/ms724274(v=VS.85).aspx</span><br>
<span class="lineno">170</span><span class="keyword" id="4227411">func</span>&nbsp;<span class="ident" id="4227416">timeToMsDosTime</span><span class="op" id="4227431">(</span><span class="ident" id="4227432">t</span>&nbsp;<span class="ident" id="4227434">time</span><span class="op" id="4227438">.</span><span class="ident" id="4227439">Time</span><span class="op" id="4227443">)</span>&nbsp;<span class="op" id="4227445">(</span><span class="ident" id="4227446">fDate</span>&nbsp;<span class="builtintype" id="4227452">uint16</span><span class="op" id="4227458">,</span>&nbsp;<span class="ident" id="4227460">fTime</span>&nbsp;<span class="builtintype" id="4227466">uint16</span><span class="op" id="4227472">)</span>&nbsp;<span class="op" id="4227474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227477">t</span>&nbsp;<span class="op" id="4227479">=</span>&nbsp;<span class="ident" id="4227481">t</span><span class="op" id="4227482">.</span><span class="ident" id="4227483">In</span><span class="op" id="4227485">(</span><span class="ident" id="4227486">time</span><span class="op" id="4227490">.</span><span class="ident" id="4227491">UTC</span><span class="op" id="4227494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227497">fDate</span>&nbsp;<span class="op" id="4227503">=</span>&nbsp;<span class="builtintype" id="4227505">uint16</span><span class="op" id="4227511">(</span><span class="ident" id="4227512">t</span><span class="op" id="4227513">.</span><span class="ident" id="4227514">Day</span><span class="op" id="4227517">(</span><span class="op" id="4227518">)</span>&nbsp;<span class="op" id="4227520">+</span>&nbsp;<span class="builtintype" id="4227522">int</span><span class="op" id="4227525">(</span><span class="ident" id="4227526">t</span><span class="op" id="4227527">.</span><span class="ident" id="4227528">Month</span><span class="op" id="4227533">(</span><span class="op" id="4227534">)</span><span class="op" id="4227535">)</span><span class="op" id="4227536">&lt;&lt;</span><span class="num" id="4227538">5</span>&nbsp;<span class="op" id="4227540">+</span>&nbsp;<span class="op" id="4227542">(</span><span class="ident" id="4227543">t</span><span class="op" id="4227544">.</span><span class="ident" id="4227545">Year</span><span class="op" id="4227549">(</span><span class="op" id="4227550">)</span><span class="op" id="4227551">-</span><span class="num" id="4227552">1980</span><span class="op" id="4227556">)</span><span class="op" id="4227557">&lt;&lt;</span><span class="num" id="4227559">9</span><span class="op" id="4227560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227563">fTime</span>&nbsp;<span class="op" id="4227569">=</span>&nbsp;<span class="builtintype" id="4227571">uint16</span><span class="op" id="4227577">(</span><span class="ident" id="4227578">t</span><span class="op" id="4227579">.</span><span class="ident" id="4227580">Second</span><span class="op" id="4227586">(</span><span class="op" id="4227587">)</span><span class="op" id="4227588">/</span><span class="num" id="4227589">2</span>&nbsp;<span class="op" id="4227591">+</span>&nbsp;<span class="ident" id="4227593">t</span><span class="op" id="4227594">.</span><span class="ident" id="4227595">Minute</span><span class="op" id="4227601">(</span><span class="op" id="4227602">)</span><span class="op" id="4227603">&lt;&lt;</span><span class="num" id="4227605">5</span>&nbsp;<span class="op" id="4227607">+</span>&nbsp;<span class="ident" id="4227609">t</span><span class="op" id="4227610">.</span><span class="ident" id="4227611">Hour</span><span class="op" id="4227615">(</span><span class="op" id="4227616">)</span><span class="op" id="4227617">&lt;&lt;</span><span class="num" id="4227619">11</span><span class="op" id="4227621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227624">return</span><br>
<span class="lineno">175</span><span class="op" id="4227631">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4227634">//&nbsp;ModTime&nbsp;returns&nbsp;the&nbsp;modification&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="4227683">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno"></span><span class="keyword" id="4227708">func</span>&nbsp;<span class="op" id="4227713">(</span><span class="ident" id="4227714">h</span>&nbsp;<span class="op" id="4227716">*</span><span class="ident" id="4227717">FileHeader</span><span class="op" id="4227727">)</span>&nbsp;<span class="ident" id="4227729">ModTime</span><span class="op" id="4227736">(</span><span class="op" id="4227737">)</span>&nbsp;<span class="ident" id="4227739">time</span><span class="op" id="4227743">.</span><span class="ident" id="4227744">Time</span>&nbsp;<span class="op" id="4227749">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4227752">return</span>&nbsp;<span class="ident" id="4227759">msDosTimeToTime</span><span class="op" id="4227774">(</span><span class="ident" id="4227775">h</span><span class="op" id="4227776">.</span><span class="ident" id="4227777">ModifiedDate</span><span class="op" id="4227789">,</span>&nbsp;<span class="ident" id="4227791">h</span><span class="op" id="4227792">.</span><span class="ident" id="4227793">ModifiedTime</span><span class="op" id="4227805">)</span><br>
<span class="lineno"></span><span class="op" id="4227807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4227810">//&nbsp;SetModTime&nbsp;sets&nbsp;the&nbsp;ModifiedTime&nbsp;and&nbsp;ModifiedDate&nbsp;fields&nbsp;to&nbsp;the&nbsp;given&nbsp;time&nbsp;in&nbsp;UTC.</span><br>
<span class="lineno"></span><span class="comment" id="4227896">//&nbsp;The&nbsp;resolution&nbsp;is&nbsp;2s.</span><br>
<span class="lineno">185</span><span class="keyword" id="4227921">func</span>&nbsp;<span class="op" id="4227926">(</span><span class="ident" id="4227927">h</span>&nbsp;<span class="op" id="4227929">*</span><span class="ident" id="4227930">FileHeader</span><span class="op" id="4227940">)</span>&nbsp;<span class="ident" id="4227942">SetModTime</span><span class="op" id="4227952">(</span><span class="ident" id="4227953">t</span>&nbsp;<span class="ident" id="4227955">time</span><span class="op" id="4227959">.</span><span class="ident" id="4227960">Time</span><span class="op" id="4227964">)</span>&nbsp;<span class="op" id="4227966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4227969">h</span><span class="op" id="4227970">.</span><span class="ident" id="4227971">ModifiedDate</span><span class="op" id="4227983">,</span>&nbsp;<span class="ident" id="4227985">h</span><span class="op" id="4227986">.</span><span class="ident" id="4227987">ModifiedTime</span>&nbsp;<span class="op" id="4228000">=</span>&nbsp;<span class="ident" id="4228002">timeToMsDosTime</span><span class="op" id="4228017">(</span><span class="ident" id="4228018">t</span><span class="op" id="4228019">)</span><br>
<span class="lineno"></span><span class="op" id="4228021">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4228024">const</span>&nbsp;<span class="op" id="4228030">(</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4228033">//&nbsp;Unix&nbsp;constants.&nbsp;The&nbsp;specification&nbsp;doesn&#39;t&nbsp;mention&nbsp;them,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4228093">//&nbsp;but&nbsp;these&nbsp;seem&nbsp;to&nbsp;be&nbsp;the&nbsp;values&nbsp;agreed&nbsp;on&nbsp;by&nbsp;tools.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228149">s_IFMT</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4228158">=</span>&nbsp;<span class="num" id="4228160">0xf000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228168">s_IFSOCK</span>&nbsp;<span class="op" id="4228177">=</span>&nbsp;<span class="num" id="4228179">0xc000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228187">s_IFLNK</span>&nbsp;&nbsp;<span class="op" id="4228196">=</span>&nbsp;<span class="num" id="4228198">0xa000</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228206">s_IFREG</span>&nbsp;&nbsp;<span class="op" id="4228215">=</span>&nbsp;<span class="num" id="4228217">0x8000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228225">s_IFBLK</span>&nbsp;&nbsp;<span class="op" id="4228234">=</span>&nbsp;<span class="num" id="4228236">0x6000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228244">s_IFDIR</span>&nbsp;&nbsp;<span class="op" id="4228253">=</span>&nbsp;<span class="num" id="4228255">0x4000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228263">s_IFCHR</span>&nbsp;&nbsp;<span class="op" id="4228272">=</span>&nbsp;<span class="num" id="4228274">0x2000</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228282">s_IFIFO</span>&nbsp;&nbsp;<span class="op" id="4228291">=</span>&nbsp;<span class="num" id="4228293">0x1000</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228301">s_ISUID</span>&nbsp;&nbsp;<span class="op" id="4228310">=</span>&nbsp;<span class="num" id="4228312">0x800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228319">s_ISGID</span>&nbsp;&nbsp;<span class="op" id="4228328">=</span>&nbsp;<span class="num" id="4228330">0x400</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228337">s_ISVTX</span>&nbsp;&nbsp;<span class="op" id="4228346">=</span>&nbsp;<span class="num" id="4228348">0x200</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228356">msdosDir</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4228370">=</span>&nbsp;<span class="num" id="4228372">0x10</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228378">msdosReadOnly</span>&nbsp;<span class="op" id="4228392">=</span>&nbsp;<span class="num" id="4228394">0x01</span><br>
<span class="lineno"></span><span class="op" id="4228399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4228402">//&nbsp;Mode&nbsp;returns&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="4228467">func</span>&nbsp;<span class="op" id="4228472">(</span><span class="ident" id="4228473">h</span>&nbsp;<span class="op" id="4228475">*</span><span class="ident" id="4228476">FileHeader</span><span class="op" id="4228486">)</span>&nbsp;<span class="ident" id="4228488">Mode</span><span class="op" id="4228492">(</span><span class="op" id="4228493">)</span>&nbsp;<span class="op" id="4228495">(</span><span class="ident" id="4228496">mode</span>&nbsp;<span class="ident" id="4228501">os</span><span class="op" id="4228503">.</span><span class="ident" id="4228504">FileMode</span><span class="op" id="4228512">)</span>&nbsp;<span class="op" id="4228514">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228517">switch</span>&nbsp;<span class="ident" id="4228524">h</span><span class="op" id="4228525">.</span><span class="ident" id="4228526">CreatorVersion</span>&nbsp;<span class="op" id="4228541">&gt;&gt;</span>&nbsp;<span class="num" id="4228544">8</span>&nbsp;<span class="op" id="4228546">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228549">case</span>&nbsp;<span class="ident" id="4228554">creatorUnix</span><span class="op" id="4228565">,</span>&nbsp;<span class="ident" id="4228567">creatorMacOSX</span><span class="op" id="4228580">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228584">mode</span>&nbsp;<span class="op" id="4228589">=</span>&nbsp;<span class="ident" id="4228591">unixModeToFileMode</span><span class="op" id="4228609">(</span><span class="ident" id="4228610">h</span><span class="op" id="4228611">.</span><span class="ident" id="4228612">ExternalAttrs</span>&nbsp;<span class="op" id="4228626">&gt;&gt;</span>&nbsp;<span class="num" id="4228629">16</span><span class="op" id="4228631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228634">case</span>&nbsp;<span class="ident" id="4228639">creatorNTFS</span><span class="op" id="4228650">,</span>&nbsp;<span class="ident" id="4228652">creatorVFAT</span><span class="op" id="4228663">,</span>&nbsp;<span class="ident" id="4228665">creatorFAT</span><span class="op" id="4228675">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228679">mode</span>&nbsp;<span class="op" id="4228684">=</span>&nbsp;<span class="ident" id="4228686">msdosModeToFileMode</span><span class="op" id="4228705">(</span><span class="ident" id="4228706">h</span><span class="op" id="4228707">.</span><span class="ident" id="4228708">ExternalAttrs</span><span class="op" id="4228721">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228727">if</span>&nbsp;<span class="builtinfunc" id="4228730">len</span><span class="op" id="4228733">(</span><span class="ident" id="4228734">h</span><span class="op" id="4228735">.</span><span class="ident" id="4228736">Name</span><span class="op" id="4228740">)</span>&nbsp;<span class="op" id="4228742">&gt;</span>&nbsp;<span class="num" id="4228744">0</span>&nbsp;<span class="op" id="4228746">&amp;&amp;</span>&nbsp;<span class="ident" id="4228749">h</span><span class="op" id="4228750">.</span><span class="ident" id="4228751">Name</span><span class="op" id="4228755">[</span><span class="builtinfunc" id="4228756">len</span><span class="op" id="4228759">(</span><span class="ident" id="4228760">h</span><span class="op" id="4228761">.</span><span class="ident" id="4228762">Name</span><span class="op" id="4228766">)</span><span class="op" id="4228767">-</span><span class="num" id="4228768">1</span><span class="op" id="4228769">]</span>&nbsp;<span class="op" id="4228771">==</span>&nbsp;<span class="string" id="4228774">&#39;/&#39;</span>&nbsp;<span class="op" id="4228778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228782">mode</span>&nbsp;<span class="op" id="4228787">|=</span>&nbsp;<span class="ident" id="4228790">os</span><span class="op" id="4228792">.</span><span class="ident" id="4228793">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4228802">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4228805">return</span>&nbsp;<span class="ident" id="4228812">mode</span><br>
<span class="lineno">220</span><span class="op" id="4228817">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4228820">//&nbsp;SetMode&nbsp;changes&nbsp;the&nbsp;permission&nbsp;and&nbsp;mode&nbsp;bits&nbsp;for&nbsp;the&nbsp;FileHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="4228888">func</span>&nbsp;<span class="op" id="4228893">(</span><span class="ident" id="4228894">h</span>&nbsp;<span class="op" id="4228896">*</span><span class="ident" id="4228897">FileHeader</span><span class="op" id="4228907">)</span>&nbsp;<span class="ident" id="4228909">SetMode</span><span class="op" id="4228916">(</span><span class="ident" id="4228917">mode</span>&nbsp;<span class="ident" id="4228922">os</span><span class="op" id="4228924">.</span><span class="ident" id="4228925">FileMode</span><span class="op" id="4228933">)</span>&nbsp;<span class="op" id="4228935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228938">h</span><span class="op" id="4228939">.</span><span class="ident" id="4228940">CreatorVersion</span>&nbsp;<span class="op" id="4228955">=</span>&nbsp;<span class="ident" id="4228957">h</span><span class="op" id="4228958">.</span><span class="ident" id="4228959">CreatorVersion</span><span class="op" id="4228973">&amp;</span><span class="num" id="4228974">0xff</span>&nbsp;<span class="op" id="4228979">|</span>&nbsp;<span class="ident" id="4228981">creatorUnix</span><span class="op" id="4228992">&lt;&lt;</span><span class="num" id="4228994">8</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4228997">h</span><span class="op" id="4228998">.</span><span class="ident" id="4228999">ExternalAttrs</span>&nbsp;<span class="op" id="4229013">=</span>&nbsp;<span class="ident" id="4229015">fileModeToUnixMode</span><span class="op" id="4229033">(</span><span class="ident" id="4229034">mode</span><span class="op" id="4229038">)</span>&nbsp;<span class="op" id="4229040">&lt;&lt;</span>&nbsp;<span class="num" id="4229043">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4229048">//&nbsp;set&nbsp;MSDOS&nbsp;attributes&nbsp;too,&nbsp;as&nbsp;the&nbsp;original&nbsp;zip&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229104">if</span>&nbsp;<span class="ident" id="4229107">mode</span><span class="op" id="4229111">&amp;</span><span class="ident" id="4229112">os</span><span class="op" id="4229114">.</span><span class="ident" id="4229115">ModeDir</span>&nbsp;<span class="op" id="4229123">!=</span>&nbsp;<span class="num" id="4229126">0</span>&nbsp;<span class="op" id="4229128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229132">h</span><span class="op" id="4229133">.</span><span class="ident" id="4229134">ExternalAttrs</span>&nbsp;<span class="op" id="4229148">|=</span>&nbsp;<span class="ident" id="4229151">msdosDir</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229161">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229164">if</span>&nbsp;<span class="ident" id="4229167">mode</span><span class="op" id="4229171">&amp;</span><span class="num" id="4229172">0200</span>&nbsp;<span class="op" id="4229177">==</span>&nbsp;<span class="num" id="4229180">0</span>&nbsp;<span class="op" id="4229182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229186">h</span><span class="op" id="4229187">.</span><span class="ident" id="4229188">ExternalAttrs</span>&nbsp;<span class="op" id="4229202">|=</span>&nbsp;<span class="ident" id="4229205">msdosReadOnly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229220">}</span><br>
<span class="lineno"></span><span class="op" id="4229222">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="4229225">//&nbsp;isZip64&nbsp;returns&nbsp;true&nbsp;if&nbsp;the&nbsp;file&nbsp;size&nbsp;exceeds&nbsp;the&nbsp;32&nbsp;bit&nbsp;limit</span><br>
<span class="lineno"></span><span class="keyword" id="4229291">func</span>&nbsp;<span class="op" id="4229296">(</span><span class="ident" id="4229297">fh</span>&nbsp;<span class="op" id="4229300">*</span><span class="ident" id="4229301">FileHeader</span><span class="op" id="4229311">)</span>&nbsp;<span class="ident" id="4229313">isZip64</span><span class="op" id="4229320">(</span><span class="op" id="4229321">)</span>&nbsp;<span class="builtintype" id="4229323">bool</span>&nbsp;<span class="op" id="4229328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229331">return</span>&nbsp;<span class="ident" id="4229338">fh</span><span class="op" id="4229340">.</span><span class="ident" id="4229341">CompressedSize64</span>&nbsp;<span class="op" id="4229358">&gt;</span>&nbsp;<span class="ident" id="4229360">uint32max</span>&nbsp;<span class="op" id="4229370">||</span>&nbsp;<span class="ident" id="4229373">fh</span><span class="op" id="4229375">.</span><span class="ident" id="4229376">UncompressedSize64</span>&nbsp;<span class="op" id="4229395">&gt;</span>&nbsp;<span class="ident" id="4229397">uint32max</span><br>
<span class="lineno"></span><span class="op" id="4229407">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span><span class="keyword" id="4229410">func</span>&nbsp;<span class="ident" id="4229415">msdosModeToFileMode</span><span class="op" id="4229434">(</span><span class="ident" id="4229435">m</span>&nbsp;<span class="builtintype" id="4229437">uint32</span><span class="op" id="4229443">)</span>&nbsp;<span class="op" id="4229445">(</span><span class="ident" id="4229446">mode</span>&nbsp;<span class="ident" id="4229451">os</span><span class="op" id="4229453">.</span><span class="ident" id="4229454">FileMode</span><span class="op" id="4229462">)</span>&nbsp;<span class="op" id="4229464">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229467">if</span>&nbsp;<span class="ident" id="4229470">m</span><span class="op" id="4229471">&amp;</span><span class="ident" id="4229472">msdosDir</span>&nbsp;<span class="op" id="4229481">!=</span>&nbsp;<span class="num" id="4229484">0</span>&nbsp;<span class="op" id="4229486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229490">mode</span>&nbsp;<span class="op" id="4229495">=</span>&nbsp;<span class="ident" id="4229497">os</span><span class="op" id="4229499">.</span><span class="ident" id="4229500">ModeDir</span>&nbsp;<span class="op" id="4229508">|</span>&nbsp;<span class="num" id="4229510">0777</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229516">}</span>&nbsp;<span class="keyword" id="4229518">else</span>&nbsp;<span class="op" id="4229523">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229527">mode</span>&nbsp;<span class="op" id="4229532">=</span>&nbsp;<span class="num" id="4229534">0666</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229540">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229543">if</span>&nbsp;<span class="ident" id="4229546">m</span><span class="op" id="4229547">&amp;</span><span class="ident" id="4229548">msdosReadOnly</span>&nbsp;<span class="op" id="4229562">!=</span>&nbsp;<span class="num" id="4229565">0</span>&nbsp;<span class="op" id="4229567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229571">mode</span>&nbsp;<span class="op" id="4229576">&amp;^=</span>&nbsp;<span class="num" id="4229580">0222</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229586">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229589">return</span>&nbsp;<span class="ident" id="4229596">mode</span><br>
<span class="lineno"></span><span class="op" id="4229601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4229604">func</span>&nbsp;<span class="ident" id="4229609">fileModeToUnixMode</span><span class="op" id="4229627">(</span><span class="ident" id="4229628">mode</span>&nbsp;<span class="ident" id="4229633">os</span><span class="op" id="4229635">.</span><span class="ident" id="4229636">FileMode</span><span class="op" id="4229644">)</span>&nbsp;<span class="builtintype" id="4229646">uint32</span>&nbsp;<span class="op" id="4229653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229656">var</span>&nbsp;<span class="ident" id="4229660">m</span>&nbsp;<span class="builtintype" id="4229662">uint32</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229670">switch</span>&nbsp;<span class="ident" id="4229677">mode</span>&nbsp;<span class="op" id="4229682">&amp;</span>&nbsp;<span class="ident" id="4229684">os</span><span class="op" id="4229686">.</span><span class="ident" id="4229687">ModeType</span>&nbsp;<span class="op" id="4229696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229699">default</span><span class="op" id="4229706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229710">m</span>&nbsp;<span class="op" id="4229712">=</span>&nbsp;<span class="ident" id="4229714">s_IFREG</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229723">case</span>&nbsp;<span class="ident" id="4229728">os</span><span class="op" id="4229730">.</span><span class="ident" id="4229731">ModeDir</span><span class="op" id="4229738">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229742">m</span>&nbsp;<span class="op" id="4229744">=</span>&nbsp;<span class="ident" id="4229746">s_IFDIR</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229755">case</span>&nbsp;<span class="ident" id="4229760">os</span><span class="op" id="4229762">.</span><span class="ident" id="4229763">ModeSymlink</span><span class="op" id="4229774">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229778">m</span>&nbsp;<span class="op" id="4229780">=</span>&nbsp;<span class="ident" id="4229782">s_IFLNK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229791">case</span>&nbsp;<span class="ident" id="4229796">os</span><span class="op" id="4229798">.</span><span class="ident" id="4229799">ModeNamedPipe</span><span class="op" id="4229812">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229816">m</span>&nbsp;<span class="op" id="4229818">=</span>&nbsp;<span class="ident" id="4229820">s_IFIFO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229829">case</span>&nbsp;<span class="ident" id="4229834">os</span><span class="op" id="4229836">.</span><span class="ident" id="4229837">ModeSocket</span><span class="op" id="4229847">:</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229851">m</span>&nbsp;<span class="op" id="4229853">=</span>&nbsp;<span class="ident" id="4229855">s_IFSOCK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229865">case</span>&nbsp;<span class="ident" id="4229870">os</span><span class="op" id="4229872">.</span><span class="ident" id="4229873">ModeDevice</span><span class="op" id="4229883">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229887">if</span>&nbsp;<span class="ident" id="4229890">mode</span><span class="op" id="4229894">&amp;</span><span class="ident" id="4229895">os</span><span class="op" id="4229897">.</span><span class="ident" id="4229898">ModeCharDevice</span>&nbsp;<span class="op" id="4229913">!=</span>&nbsp;<span class="num" id="4229916">0</span>&nbsp;<span class="op" id="4229918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229923">m</span>&nbsp;<span class="op" id="4229925">=</span>&nbsp;<span class="ident" id="4229927">s_IFCHR</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229937">}</span>&nbsp;<span class="keyword" id="4229939">else</span>&nbsp;<span class="op" id="4229944">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4229949">m</span>&nbsp;<span class="op" id="4229951">=</span>&nbsp;<span class="ident" id="4229953">s_IFBLK</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4229966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4229969">if</span>&nbsp;<span class="ident" id="4229972">mode</span><span class="op" id="4229976">&amp;</span><span class="ident" id="4229977">os</span><span class="op" id="4229979">.</span><span class="ident" id="4229980">ModeSetuid</span>&nbsp;<span class="op" id="4229991">!=</span>&nbsp;<span class="num" id="4229994">0</span>&nbsp;<span class="op" id="4229996">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230000">m</span>&nbsp;<span class="op" id="4230002">|=</span>&nbsp;<span class="ident" id="4230005">s_ISUID</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230017">if</span>&nbsp;<span class="ident" id="4230020">mode</span><span class="op" id="4230024">&amp;</span><span class="ident" id="4230025">os</span><span class="op" id="4230027">.</span><span class="ident" id="4230028">ModeSetgid</span>&nbsp;<span class="op" id="4230039">!=</span>&nbsp;<span class="num" id="4230042">0</span>&nbsp;<span class="op" id="4230044">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230048">m</span>&nbsp;<span class="op" id="4230050">|=</span>&nbsp;<span class="ident" id="4230053">s_ISGID</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230065">if</span>&nbsp;<span class="ident" id="4230068">mode</span><span class="op" id="4230072">&amp;</span><span class="ident" id="4230073">os</span><span class="op" id="4230075">.</span><span class="ident" id="4230076">ModeSticky</span>&nbsp;<span class="op" id="4230087">!=</span>&nbsp;<span class="num" id="4230090">0</span>&nbsp;<span class="op" id="4230092">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230096">m</span>&nbsp;<span class="op" id="4230098">|=</span>&nbsp;<span class="ident" id="4230101">s_ISVTX</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230113">return</span>&nbsp;<span class="ident" id="4230120">m</span>&nbsp;<span class="op" id="4230122">|</span>&nbsp;<span class="builtintype" id="4230124">uint32</span><span class="op" id="4230130">(</span><span class="ident" id="4230131">mode</span><span class="op" id="4230135">&amp;</span><span class="num" id="4230136">0777</span><span class="op" id="4230140">)</span><br>
<span class="lineno"></span><span class="op" id="4230142">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">285</span><span class="keyword" id="4230145">func</span>&nbsp;<span class="ident" id="4230150">unixModeToFileMode</span><span class="op" id="4230168">(</span><span class="ident" id="4230169">m</span>&nbsp;<span class="builtintype" id="4230171">uint32</span><span class="op" id="4230177">)</span>&nbsp;<span class="ident" id="4230179">os</span><span class="op" id="4230181">.</span><span class="ident" id="4230182">FileMode</span>&nbsp;<span class="op" id="4230191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230194">mode</span>&nbsp;<span class="op" id="4230199">:=</span>&nbsp;<span class="ident" id="4230202">os</span><span class="op" id="4230204">.</span><span class="ident" id="4230205">FileMode</span><span class="op" id="4230213">(</span><span class="ident" id="4230214">m</span>&nbsp;<span class="op" id="4230216">&amp;</span>&nbsp;<span class="num" id="4230218">0777</span><span class="op" id="4230222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230225">switch</span>&nbsp;<span class="ident" id="4230232">m</span>&nbsp;<span class="op" id="4230234">&amp;</span>&nbsp;<span class="ident" id="4230236">s_IFMT</span>&nbsp;<span class="op" id="4230243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230246">case</span>&nbsp;<span class="ident" id="4230251">s_IFBLK</span><span class="op" id="4230258">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230262">mode</span>&nbsp;<span class="op" id="4230267">|=</span>&nbsp;<span class="ident" id="4230270">os</span><span class="op" id="4230272">.</span><span class="ident" id="4230273">ModeDevice</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230285">case</span>&nbsp;<span class="ident" id="4230290">s_IFCHR</span><span class="op" id="4230297">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230301">mode</span>&nbsp;<span class="op" id="4230306">|=</span>&nbsp;<span class="ident" id="4230309">os</span><span class="op" id="4230311">.</span><span class="ident" id="4230312">ModeDevice</span>&nbsp;<span class="op" id="4230323">|</span>&nbsp;<span class="ident" id="4230325">os</span><span class="op" id="4230327">.</span><span class="ident" id="4230328">ModeCharDevice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230344">case</span>&nbsp;<span class="ident" id="4230349">s_IFDIR</span><span class="op" id="4230356">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230360">mode</span>&nbsp;<span class="op" id="4230365">|=</span>&nbsp;<span class="ident" id="4230368">os</span><span class="op" id="4230370">.</span><span class="ident" id="4230371">ModeDir</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230380">case</span>&nbsp;<span class="ident" id="4230385">s_IFIFO</span><span class="op" id="4230392">:</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230396">mode</span>&nbsp;<span class="op" id="4230401">|=</span>&nbsp;<span class="ident" id="4230404">os</span><span class="op" id="4230406">.</span><span class="ident" id="4230407">ModeNamedPipe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230422">case</span>&nbsp;<span class="ident" id="4230427">s_IFLNK</span><span class="op" id="4230434">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230438">mode</span>&nbsp;<span class="op" id="4230443">|=</span>&nbsp;<span class="ident" id="4230446">os</span><span class="op" id="4230448">.</span><span class="ident" id="4230449">ModeSymlink</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230462">case</span>&nbsp;<span class="ident" id="4230467">s_IFREG</span><span class="op" id="4230474">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4230478">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230496">case</span>&nbsp;<span class="ident" id="4230501">s_IFSOCK</span><span class="op" id="4230509">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230513">mode</span>&nbsp;<span class="op" id="4230518">|=</span>&nbsp;<span class="ident" id="4230521">os</span><span class="op" id="4230523">.</span><span class="ident" id="4230524">ModeSocket</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230539">if</span>&nbsp;<span class="ident" id="4230542">m</span><span class="op" id="4230543">&amp;</span><span class="ident" id="4230544">s_ISGID</span>&nbsp;<span class="op" id="4230552">!=</span>&nbsp;<span class="num" id="4230555">0</span>&nbsp;<span class="op" id="4230557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230561">mode</span>&nbsp;<span class="op" id="4230566">|=</span>&nbsp;<span class="ident" id="4230569">os</span><span class="op" id="4230571">.</span><span class="ident" id="4230572">ModeSetgid</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230584">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230587">if</span>&nbsp;<span class="ident" id="4230590">m</span><span class="op" id="4230591">&amp;</span><span class="ident" id="4230592">s_ISUID</span>&nbsp;<span class="op" id="4230600">!=</span>&nbsp;<span class="num" id="4230603">0</span>&nbsp;<span class="op" id="4230605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230609">mode</span>&nbsp;<span class="op" id="4230614">|=</span>&nbsp;<span class="ident" id="4230617">os</span><span class="op" id="4230619">.</span><span class="ident" id="4230620">ModeSetuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230635">if</span>&nbsp;<span class="ident" id="4230638">m</span><span class="op" id="4230639">&amp;</span><span class="ident" id="4230640">s_ISVTX</span>&nbsp;<span class="op" id="4230648">!=</span>&nbsp;<span class="num" id="4230651">0</span>&nbsp;<span class="op" id="4230653">{</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4230657">mode</span>&nbsp;<span class="op" id="4230662">|=</span>&nbsp;<span class="ident" id="4230665">os</span><span class="op" id="4230667">.</span><span class="ident" id="4230668">ModeSticky</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4230680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4230683">return</span>&nbsp;<span class="ident" id="4230690">mode</span><br>
<span class="lineno"></span><span class="op" id="4230695">}</span>
</div>
</body>
</html>
