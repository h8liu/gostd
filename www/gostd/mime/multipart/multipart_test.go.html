<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>mime/multipart</h2>
<ul>
<li><a href="/gostd/mime/multipart/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/mime/multipart/formdata.go.html">formdata.go</a></li>
<li><a href="/gostd/mime/multipart/formdata_test.go.html">formdata_test.go</a></li>
<li><a href="/gostd/mime/multipart/multipart.go.html">multipart.go</a></li>
<li><a href="/gostd/mime/multipart/multipart_test.go.html" class="current">multipart_test.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable.go.html">quotedprintable.go</a></li>
<li><a href="/gostd/mime/multipart/quotedprintable_test.go.html">quotedprintable_test.go</a></li>
<li><a href="/gostd/mime/multipart/writer.go.html">writer.go</a></li>
<li><a href="/gostd/mime/multipart/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6848093">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6848148">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6848202">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6848253">package</span>&nbsp;<span class="ident" id="6848261">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6848272">import</span>&nbsp;<span class="op" id="6848279">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848282">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848291">&#34;encoding/json&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848308">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848315">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848321">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848334">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848351">&#34;os&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848357">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848368">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6848379">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="6848389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6848392">func</span>&nbsp;<span class="ident" id="6848397">TestBoundaryLine</span><span class="op" id="6848413">(</span><span class="ident" id="6848414">t</span>&nbsp;<span class="op" id="6848416">*</span><span class="ident" id="6848417">testing</span><span class="op" id="6848424">.</span><span class="ident" id="6848425">T</span><span class="op" id="6848426">)</span>&nbsp;<span class="op" id="6848428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848431">mr</span>&nbsp;<span class="op" id="6848434">:=</span>&nbsp;<span class="ident" id="6848437">NewReader</span><span class="op" id="6848446">(</span><span class="ident" id="6848447">strings</span><span class="op" id="6848454">.</span><span class="ident" id="6848455">NewReader</span><span class="op" id="6848464">(</span><span class="string" id="6848465">&#34;&#34;</span><span class="op" id="6848467">)</span><span class="op" id="6848468">,</span>&nbsp;<span class="string" id="6848470">&#34;myBoundary&#34;</span><span class="op" id="6848482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6848485">if</span>&nbsp;<span class="op" id="6848488">!</span><span class="ident" id="6848489">mr</span><span class="op" id="6848491">.</span><span class="ident" id="6848492">isBoundaryDelimiterLine</span><span class="op" id="6848515">(</span><span class="op" id="6848516">[</span><span class="op" id="6848517">]</span><span class="builtintype" id="6848518">byte</span><span class="op" id="6848522">(</span><span class="string" id="6848523">&#34;--myBoundary\r\n&#34;</span><span class="op" id="6848541">)</span><span class="op" id="6848542">)</span>&nbsp;<span class="op" id="6848544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848548">t</span><span class="op" id="6848549">.</span><span class="ident" id="6848550">Error</span><span class="op" id="6848555">(</span><span class="string" id="6848556">&#34;expected&#34;</span><span class="op" id="6848566">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6848569">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6848572">if</span>&nbsp;<span class="op" id="6848575">!</span><span class="ident" id="6848576">mr</span><span class="op" id="6848578">.</span><span class="ident" id="6848579">isBoundaryDelimiterLine</span><span class="op" id="6848602">(</span><span class="op" id="6848603">[</span><span class="op" id="6848604">]</span><span class="builtintype" id="6848605">byte</span><span class="op" id="6848609">(</span><span class="string" id="6848610">&#34;--myBoundary&nbsp;\r\n&#34;</span><span class="op" id="6848629">)</span><span class="op" id="6848630">)</span>&nbsp;<span class="op" id="6848632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848636">t</span><span class="op" id="6848637">.</span><span class="ident" id="6848638">Error</span><span class="op" id="6848643">(</span><span class="string" id="6848644">&#34;expected&#34;</span><span class="op" id="6848654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6848657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6848660">if</span>&nbsp;<span class="op" id="6848663">!</span><span class="ident" id="6848664">mr</span><span class="op" id="6848666">.</span><span class="ident" id="6848667">isBoundaryDelimiterLine</span><span class="op" id="6848690">(</span><span class="op" id="6848691">[</span><span class="op" id="6848692">]</span><span class="builtintype" id="6848693">byte</span><span class="op" id="6848697">(</span><span class="string" id="6848698">&#34;--myBoundary&nbsp;\n&#34;</span><span class="op" id="6848715">)</span><span class="op" id="6848716">)</span>&nbsp;<span class="op" id="6848718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848722">t</span><span class="op" id="6848723">.</span><span class="ident" id="6848724">Error</span><span class="op" id="6848729">(</span><span class="string" id="6848730">&#34;expected&#34;</span><span class="op" id="6848740">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6848743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6848746">if</span>&nbsp;<span class="ident" id="6848749">mr</span><span class="op" id="6848751">.</span><span class="ident" id="6848752">isBoundaryDelimiterLine</span><span class="op" id="6848775">(</span><span class="op" id="6848776">[</span><span class="op" id="6848777">]</span><span class="builtintype" id="6848778">byte</span><span class="op" id="6848782">(</span><span class="string" id="6848783">&#34;--myBoundary&nbsp;bogus&nbsp;\n&#34;</span><span class="op" id="6848806">)</span><span class="op" id="6848807">)</span>&nbsp;<span class="op" id="6848809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848813">t</span><span class="op" id="6848814">.</span><span class="ident" id="6848815">Error</span><span class="op" id="6848820">(</span><span class="string" id="6848821">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6848836">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6848839">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6848842">if</span>&nbsp;<span class="ident" id="6848845">mr</span><span class="op" id="6848847">.</span><span class="ident" id="6848848">isBoundaryDelimiterLine</span><span class="op" id="6848871">(</span><span class="op" id="6848872">[</span><span class="op" id="6848873">]</span><span class="builtintype" id="6848874">byte</span><span class="op" id="6848878">(</span><span class="string" id="6848879">&#34;--myBoundary&nbsp;bogus--&#34;</span><span class="op" id="6848901">)</span><span class="op" id="6848902">)</span>&nbsp;<span class="op" id="6848904">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848908">t</span><span class="op" id="6848909">.</span><span class="ident" id="6848910">Error</span><span class="op" id="6848915">(</span><span class="string" id="6848916">&#34;expected&nbsp;fail&#34;</span><span class="op" id="6848931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6848934">}</span><br>
<span class="lineno"></span><span class="op" id="6848936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6848939">func</span>&nbsp;<span class="ident" id="6848944">escapeString</span><span class="op" id="6848956">(</span><span class="ident" id="6848957">v</span>&nbsp;<span class="builtintype" id="6848959">string</span><span class="op" id="6848965">)</span>&nbsp;<span class="builtintype" id="6848967">string</span>&nbsp;<span class="op" id="6848974">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6848977">bytes</span><span class="op" id="6848982">,</span>&nbsp;<span class="ident" id="6848984">_</span>&nbsp;<span class="op" id="6848986">:=</span>&nbsp;<span class="ident" id="6848989">json</span><span class="op" id="6848993">.</span><span class="ident" id="6848994">Marshal</span><span class="op" id="6849001">(</span><span class="ident" id="6849002">v</span><span class="op" id="6849003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849006">return</span>&nbsp;<span class="builtintype" id="6849013">string</span><span class="op" id="6849019">(</span><span class="ident" id="6849020">bytes</span><span class="op" id="6849025">)</span><br>
<span class="lineno"></span><span class="op" id="6849027">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6849030">func</span>&nbsp;<span class="ident" id="6849035">expectEq</span><span class="op" id="6849043">(</span><span class="ident" id="6849044">t</span>&nbsp;<span class="op" id="6849046">*</span><span class="ident" id="6849047">testing</span><span class="op" id="6849054">.</span><span class="ident" id="6849055">T</span><span class="op" id="6849056">,</span>&nbsp;<span class="ident" id="6849058">expected</span><span class="op" id="6849066">,</span>&nbsp;<span class="ident" id="6849068">actual</span><span class="op" id="6849074">,</span>&nbsp;<span class="ident" id="6849076">what</span>&nbsp;<span class="builtintype" id="6849081">string</span><span class="op" id="6849087">)</span>&nbsp;<span class="op" id="6849089">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849092">if</span>&nbsp;<span class="ident" id="6849095">expected</span>&nbsp;<span class="op" id="6849104">==</span>&nbsp;<span class="ident" id="6849107">actual</span>&nbsp;<span class="op" id="6849114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849118">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849126">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849129">t</span><span class="op" id="6849130">.</span><span class="ident" id="6849131">Errorf</span><span class="op" id="6849137">(</span><span class="string" id="6849138">&#34;Unexpected&nbsp;value&nbsp;for&nbsp;%s;&nbsp;got&nbsp;%s&nbsp;(len&nbsp;%d)&nbsp;but&nbsp;expected:&nbsp;%s&nbsp;(len&nbsp;%d)&#34;</span><span class="op" id="6849206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849210">what</span><span class="op" id="6849214">,</span>&nbsp;<span class="ident" id="6849216">escapeString</span><span class="op" id="6849228">(</span><span class="ident" id="6849229">actual</span><span class="op" id="6849235">)</span><span class="op" id="6849236">,</span>&nbsp;<span class="builtinfunc" id="6849238">len</span><span class="op" id="6849241">(</span><span class="ident" id="6849242">actual</span><span class="op" id="6849248">)</span><span class="op" id="6849249">,</span>&nbsp;<span class="ident" id="6849251">escapeString</span><span class="op" id="6849263">(</span><span class="ident" id="6849264">expected</span><span class="op" id="6849272">)</span><span class="op" id="6849273">,</span>&nbsp;<span class="builtinfunc" id="6849275">len</span><span class="op" id="6849278">(</span><span class="ident" id="6849279">expected</span><span class="op" id="6849287">)</span><span class="op" id="6849288">)</span><br>
<span class="lineno">50</span><span class="op" id="6849290">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6849293">func</span>&nbsp;<span class="ident" id="6849298">TestNameAccessors</span><span class="op" id="6849315">(</span><span class="ident" id="6849316">t</span>&nbsp;<span class="op" id="6849318">*</span><span class="ident" id="6849319">testing</span><span class="op" id="6849326">.</span><span class="ident" id="6849327">T</span><span class="op" id="6849328">)</span>&nbsp;<span class="op" id="6849330">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849333">tests</span>&nbsp;<span class="op" id="6849339">:=</span>&nbsp;<span class="op" id="6849342">[</span><span class="op" id="6849343">...</span><span class="op" id="6849346">]</span><span class="op" id="6849347">[</span><span class="num" id="6849348">3</span><span class="op" id="6849349">]</span><span class="builtintype" id="6849350">string</span><span class="op" id="6849356">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849360">{</span><span class="string" id="6849361">`form-data;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6849384">,</span>&nbsp;<span class="string" id="6849386">&#34;foo&#34;</span><span class="op" id="6849391">,</span>&nbsp;<span class="string" id="6849393">&#34;&#34;</span><span class="op" id="6849395">}</span><span class="op" id="6849396">,</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849400">{</span><span class="string" id="6849401">`&nbsp;form-data&nbsp;;&nbsp;name=foo`</span><span class="op" id="6849424">,</span>&nbsp;<span class="string" id="6849426">&#34;foo&#34;</span><span class="op" id="6849431">,</span>&nbsp;<span class="string" id="6849433">&#34;&#34;</span><span class="op" id="6849435">}</span><span class="op" id="6849436">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849440">{</span><span class="string" id="6849441">`FORM-DATA;name=&#34;foo&#34;`</span><span class="op" id="6849463">,</span>&nbsp;<span class="string" id="6849465">&#34;foo&#34;</span><span class="op" id="6849470">,</span>&nbsp;<span class="string" id="6849472">&#34;&#34;</span><span class="op" id="6849474">}</span><span class="op" id="6849475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849479">{</span><span class="string" id="6849480">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6849505">,</span>&nbsp;<span class="string" id="6849507">&#34;foo&#34;</span><span class="op" id="6849512">,</span>&nbsp;<span class="string" id="6849514">&#34;&#34;</span><span class="op" id="6849516">}</span><span class="op" id="6849517">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849521">{</span><span class="string" id="6849522">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=&#34;foo&#34;`</span><span class="op" id="6849547">,</span>&nbsp;<span class="string" id="6849549">&#34;foo&#34;</span><span class="op" id="6849554">,</span>&nbsp;<span class="string" id="6849556">&#34;&#34;</span><span class="op" id="6849558">}</span><span class="op" id="6849559">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849563">{</span><span class="string" id="6849564">`&nbsp;FORM-DATA&nbsp;;&nbsp;name=foo`</span><span class="op" id="6849587">,</span>&nbsp;<span class="string" id="6849589">&#34;foo&#34;</span><span class="op" id="6849594">,</span>&nbsp;<span class="string" id="6849596">&#34;&#34;</span><span class="op" id="6849598">}</span><span class="op" id="6849599">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849603">{</span><span class="string" id="6849604">`&nbsp;FORM-DATA&nbsp;;&nbsp;filename=&#34;foo.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6849657">,</span>&nbsp;<span class="string" id="6849659">&#34;foo&#34;</span><span class="op" id="6849664">,</span>&nbsp;<span class="string" id="6849666">&#34;foo.txt&#34;</span><span class="op" id="6849675">}</span><span class="op" id="6849676">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849680">{</span><span class="string" id="6849681">`&nbsp;not-form-data&nbsp;;&nbsp;filename=&#34;bar.txt&#34;;&nbsp;name=foo;&nbsp;baz=quux`</span><span class="op" id="6849738">,</span>&nbsp;<span class="string" id="6849740">&#34;&#34;</span><span class="op" id="6849742">,</span>&nbsp;<span class="string" id="6849744">&#34;bar.txt&#34;</span><span class="op" id="6849753">}</span><span class="op" id="6849754">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849757">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849760">for</span>&nbsp;<span class="ident" id="6849764">i</span><span class="op" id="6849765">,</span>&nbsp;<span class="ident" id="6849767">test</span>&nbsp;<span class="op" id="6849772">:=</span>&nbsp;<span class="keyword" id="6849775">range</span>&nbsp;<span class="ident" id="6849781">tests</span>&nbsp;<span class="op" id="6849787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849791">p</span>&nbsp;<span class="op" id="6849793">:=</span>&nbsp;<span class="op" id="6849796">&amp;</span><span class="ident" id="6849797">Part</span><span class="op" id="6849801">{</span><span class="ident" id="6849802">Header</span><span class="op" id="6849808">:</span>&nbsp;<span class="builtinfunc" id="6849810">make</span><span class="op" id="6849814">(</span><span class="keyword" id="6849815">map</span><span class="op" id="6849818">[</span><span class="builtintype" id="6849819">string</span><span class="op" id="6849825">]</span><span class="op" id="6849826">[</span><span class="op" id="6849827">]</span><span class="builtintype" id="6849828">string</span><span class="op" id="6849834">)</span><span class="op" id="6849835">}</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849839">p</span><span class="op" id="6849840">.</span><span class="ident" id="6849841">Header</span><span class="op" id="6849847">.</span><span class="ident" id="6849848">Set</span><span class="op" id="6849851">(</span><span class="string" id="6849852">&#34;Content-Disposition&#34;</span><span class="op" id="6849873">,</span>&nbsp;<span class="ident" id="6849875">test</span><span class="op" id="6849879">[</span><span class="num" id="6849880">0</span><span class="op" id="6849881">]</span><span class="op" id="6849882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849886">if</span>&nbsp;<span class="ident" id="6849889">g</span><span class="op" id="6849890">,</span>&nbsp;<span class="ident" id="6849892">e</span>&nbsp;<span class="op" id="6849894">:=</span>&nbsp;<span class="ident" id="6849897">p</span><span class="op" id="6849898">.</span><span class="ident" id="6849899">FormName</span><span class="op" id="6849907">(</span><span class="op" id="6849908">)</span><span class="op" id="6849909">,</span>&nbsp;<span class="ident" id="6849911">test</span><span class="op" id="6849915">[</span><span class="num" id="6849916">1</span><span class="op" id="6849917">]</span><span class="op" id="6849918">;</span>&nbsp;<span class="ident" id="6849920">g</span>&nbsp;<span class="op" id="6849922">!=</span>&nbsp;<span class="ident" id="6849925">e</span>&nbsp;<span class="op" id="6849927">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6849932">t</span><span class="op" id="6849933">.</span><span class="ident" id="6849934">Errorf</span><span class="op" id="6849940">(</span><span class="string" id="6849941">&#34;test&nbsp;%d:&nbsp;FormName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6849976">,</span>&nbsp;<span class="ident" id="6849978">i</span><span class="op" id="6849979">,</span>&nbsp;<span class="ident" id="6849981">g</span><span class="op" id="6849982">,</span>&nbsp;<span class="ident" id="6849984">e</span><span class="op" id="6849985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6849989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6849993">if</span>&nbsp;<span class="ident" id="6849996">g</span><span class="op" id="6849997">,</span>&nbsp;<span class="ident" id="6849999">e</span>&nbsp;<span class="op" id="6850001">:=</span>&nbsp;<span class="ident" id="6850004">p</span><span class="op" id="6850005">.</span><span class="ident" id="6850006">FileName</span><span class="op" id="6850014">(</span><span class="op" id="6850015">)</span><span class="op" id="6850016">,</span>&nbsp;<span class="ident" id="6850018">test</span><span class="op" id="6850022">[</span><span class="num" id="6850023">2</span><span class="op" id="6850024">]</span><span class="op" id="6850025">;</span>&nbsp;<span class="ident" id="6850027">g</span>&nbsp;<span class="op" id="6850029">!=</span>&nbsp;<span class="ident" id="6850032">e</span>&nbsp;<span class="op" id="6850034">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850039">t</span><span class="op" id="6850040">.</span><span class="ident" id="6850041">Errorf</span><span class="op" id="6850047">(</span><span class="string" id="6850048">&#34;test&nbsp;%d:&nbsp;FileName()&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6850083">,</span>&nbsp;<span class="ident" id="6850085">i</span><span class="op" id="6850086">,</span>&nbsp;<span class="ident" id="6850088">g</span><span class="op" id="6850089">,</span>&nbsp;<span class="ident" id="6850091">e</span><span class="op" id="6850092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6850096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6850099">}</span><br>
<span class="lineno"></span><span class="op" id="6850101">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6850104">var</span>&nbsp;<span class="ident" id="6850108">longLine</span>&nbsp;<span class="op" id="6850117">=</span>&nbsp;<span class="ident" id="6850119">strings</span><span class="op" id="6850126">.</span><span class="ident" id="6850127">Repeat</span><span class="op" id="6850133">(</span><span class="string" id="6850134">&#34;\n\n\r\r\r\n\r\000&#34;</span><span class="op" id="6850154">,</span>&nbsp;<span class="op" id="6850156">(</span><span class="num" id="6850157">1</span><span class="op" id="6850158">&lt;&lt;</span><span class="num" id="6850160">20</span><span class="op" id="6850162">)</span><span class="op" id="6850163">/</span><span class="num" id="6850164">8</span><span class="op" id="6850165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6850168">func</span>&nbsp;<span class="ident" id="6850173">testMultipartBody</span><span class="op" id="6850190">(</span><span class="ident" id="6850191">sep</span>&nbsp;<span class="builtintype" id="6850195">string</span><span class="op" id="6850201">)</span>&nbsp;<span class="builtintype" id="6850203">string</span>&nbsp;<span class="op" id="6850210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850213">testBody</span>&nbsp;<span class="op" id="6850222">:=</span>&nbsp;<span class="string" id="6850225">`<br>
<span class="lineno"></span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno">80</span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1<br>
<span class="lineno"></span>HEADER2:&nbsp;value2<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno">85</span>My&nbsp;value<br>
<span class="lineno"></span>The&nbsp;end.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>name:&nbsp;bigsection<br>
<span class="lineno"></span><br>
<span class="lineno">90</span>[longline]<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>Header1:&nbsp;value1b<br>
<span class="lineno"></span>HEADER2:&nbsp;value2b<br>
<span class="lineno"></span>foo-bar:&nbsp;bazb<br>
<span class="lineno">95</span><br>
<span class="lineno"></span>Line&nbsp;1<br>
<span class="lineno"></span>Line&nbsp;2<br>
<span class="lineno"></span>Line&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.<br>
<span class="lineno"></span><br>
<span class="lineno">100</span>--MyBoundary<br>
<span class="lineno"></span><br>
<span class="lineno"></span>never&nbsp;read&nbsp;data<br>
<span class="lineno"></span>--MyBoundary--<br>
<span class="lineno"></span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span>useless&nbsp;trailer<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850582">testBody</span>&nbsp;<span class="op" id="6850591">=</span>&nbsp;<span class="ident" id="6850593">strings</span><span class="op" id="6850600">.</span><span class="ident" id="6850601">Replace</span><span class="op" id="6850608">(</span><span class="ident" id="6850609">testBody</span><span class="op" id="6850617">,</span>&nbsp;<span class="string" id="6850619">&#34;\n&#34;</span><span class="op" id="6850623">,</span>&nbsp;<span class="ident" id="6850625">sep</span><span class="op" id="6850628">,</span>&nbsp;<span class="op" id="6850630">-</span><span class="num" id="6850631">1</span><span class="op" id="6850632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6850635">return</span>&nbsp;<span class="ident" id="6850642">strings</span><span class="op" id="6850649">.</span><span class="ident" id="6850650">Replace</span><span class="op" id="6850657">(</span><span class="ident" id="6850658">testBody</span><span class="op" id="6850666">,</span>&nbsp;<span class="string" id="6850668">&#34;[longline]&#34;</span><span class="op" id="6850680">,</span>&nbsp;<span class="ident" id="6850682">longLine</span><span class="op" id="6850690">,</span>&nbsp;<span class="num" id="6850692">1</span><span class="op" id="6850693">)</span><br>
<span class="lineno">110</span><span class="op" id="6850695">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6850698">func</span>&nbsp;<span class="ident" id="6850703">TestMultipart</span><span class="op" id="6850716">(</span><span class="ident" id="6850717">t</span>&nbsp;<span class="op" id="6850719">*</span><span class="ident" id="6850720">testing</span><span class="op" id="6850727">.</span><span class="ident" id="6850728">T</span><span class="op" id="6850729">)</span>&nbsp;<span class="op" id="6850731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850734">bodyReader</span>&nbsp;<span class="op" id="6850745">:=</span>&nbsp;<span class="ident" id="6850748">strings</span><span class="op" id="6850755">.</span><span class="ident" id="6850756">NewReader</span><span class="op" id="6850765">(</span><span class="ident" id="6850766">testMultipartBody</span><span class="op" id="6850783">(</span><span class="string" id="6850784">&#34;\r\n&#34;</span><span class="op" id="6850790">)</span><span class="op" id="6850791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850794">testMultipart</span><span class="op" id="6850807">(</span><span class="ident" id="6850808">t</span><span class="op" id="6850809">,</span>&nbsp;<span class="ident" id="6850811">bodyReader</span><span class="op" id="6850821">,</span>&nbsp;<span class="builtintype" id="6850823">false</span><span class="op" id="6850828">)</span><br>
<span class="lineno">115</span><span class="op" id="6850830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6850833">func</span>&nbsp;<span class="ident" id="6850838">TestMultipartOnlyNewlines</span><span class="op" id="6850863">(</span><span class="ident" id="6850864">t</span>&nbsp;<span class="op" id="6850866">*</span><span class="ident" id="6850867">testing</span><span class="op" id="6850874">.</span><span class="ident" id="6850875">T</span><span class="op" id="6850876">)</span>&nbsp;<span class="op" id="6850878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850881">bodyReader</span>&nbsp;<span class="op" id="6850892">:=</span>&nbsp;<span class="ident" id="6850895">strings</span><span class="op" id="6850902">.</span><span class="ident" id="6850903">NewReader</span><span class="op" id="6850912">(</span><span class="ident" id="6850913">testMultipartBody</span><span class="op" id="6850930">(</span><span class="string" id="6850931">&#34;\n&#34;</span><span class="op" id="6850935">)</span><span class="op" id="6850936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6850939">testMultipart</span><span class="op" id="6850952">(</span><span class="ident" id="6850953">t</span><span class="op" id="6850954">,</span>&nbsp;<span class="ident" id="6850956">bodyReader</span><span class="op" id="6850966">,</span>&nbsp;<span class="builtintype" id="6850968">true</span><span class="op" id="6850972">)</span><br>
<span class="lineno">120</span><span class="op" id="6850974">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6850977">func</span>&nbsp;<span class="ident" id="6850982">TestMultipartSlowInput</span><span class="op" id="6851004">(</span><span class="ident" id="6851005">t</span>&nbsp;<span class="op" id="6851007">*</span><span class="ident" id="6851008">testing</span><span class="op" id="6851015">.</span><span class="ident" id="6851016">T</span><span class="op" id="6851017">)</span>&nbsp;<span class="op" id="6851019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851022">bodyReader</span>&nbsp;<span class="op" id="6851033">:=</span>&nbsp;<span class="ident" id="6851036">strings</span><span class="op" id="6851043">.</span><span class="ident" id="6851044">NewReader</span><span class="op" id="6851053">(</span><span class="ident" id="6851054">testMultipartBody</span><span class="op" id="6851071">(</span><span class="string" id="6851072">&#34;\r\n&#34;</span><span class="op" id="6851078">)</span><span class="op" id="6851079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851082">testMultipart</span><span class="op" id="6851095">(</span><span class="ident" id="6851096">t</span><span class="op" id="6851097">,</span>&nbsp;<span class="op" id="6851099">&amp;</span><span class="ident" id="6851100">slowReader</span><span class="op" id="6851110">{</span><span class="ident" id="6851111">bodyReader</span><span class="op" id="6851121">}</span><span class="op" id="6851122">,</span>&nbsp;<span class="builtintype" id="6851124">false</span><span class="op" id="6851129">)</span><br>
<span class="lineno">125</span><span class="op" id="6851131">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6851134">func</span>&nbsp;<span class="ident" id="6851139">testMultipart</span><span class="op" id="6851152">(</span><span class="ident" id="6851153">t</span>&nbsp;<span class="op" id="6851155">*</span><span class="ident" id="6851156">testing</span><span class="op" id="6851163">.</span><span class="ident" id="6851164">T</span><span class="op" id="6851165">,</span>&nbsp;<span class="ident" id="6851167">r</span>&nbsp;<span class="ident" id="6851169">io</span><span class="op" id="6851171">.</span><span class="ident" id="6851172">Reader</span><span class="op" id="6851178">,</span>&nbsp;<span class="ident" id="6851180">onlyNewlines</span>&nbsp;<span class="builtintype" id="6851193">bool</span><span class="op" id="6851197">)</span>&nbsp;<span class="op" id="6851199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851202">reader</span>&nbsp;<span class="op" id="6851209">:=</span>&nbsp;<span class="ident" id="6851212">NewReader</span><span class="op" id="6851221">(</span><span class="ident" id="6851222">r</span><span class="op" id="6851223">,</span>&nbsp;<span class="string" id="6851225">&#34;MyBoundary&#34;</span><span class="op" id="6851237">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851240">buf</span>&nbsp;<span class="op" id="6851244">:=</span>&nbsp;<span class="builtinfunc" id="6851247">new</span><span class="op" id="6851250">(</span><span class="ident" id="6851251">bytes</span><span class="op" id="6851256">.</span><span class="ident" id="6851257">Buffer</span><span class="op" id="6851263">)</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6851267">//&nbsp;Part1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851277">part</span><span class="op" id="6851281">,</span>&nbsp;<span class="ident" id="6851283">err</span>&nbsp;<span class="op" id="6851287">:=</span>&nbsp;<span class="ident" id="6851290">reader</span><span class="op" id="6851296">.</span><span class="ident" id="6851297">NextPart</span><span class="op" id="6851305">(</span><span class="op" id="6851306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851309">if</span>&nbsp;<span class="ident" id="6851312">part</span>&nbsp;<span class="op" id="6851317">==</span>&nbsp;<span class="builtintype" id="6851320">nil</span>&nbsp;<span class="op" id="6851324">||</span>&nbsp;<span class="ident" id="6851327">err</span>&nbsp;<span class="op" id="6851331">!=</span>&nbsp;<span class="builtintype" id="6851334">nil</span>&nbsp;<span class="op" id="6851338">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851342">t</span><span class="op" id="6851343">.</span><span class="ident" id="6851344">Error</span><span class="op" id="6851349">(</span><span class="string" id="6851350">&#34;Expected&nbsp;part1&#34;</span><span class="op" id="6851366">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851370">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851378">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851381">if</span>&nbsp;<span class="ident" id="6851384">x</span>&nbsp;<span class="op" id="6851386">:=</span>&nbsp;<span class="ident" id="6851389">part</span><span class="op" id="6851393">.</span><span class="ident" id="6851394">Header</span><span class="op" id="6851400">.</span><span class="ident" id="6851401">Get</span><span class="op" id="6851404">(</span><span class="string" id="6851405">&#34;Header1&#34;</span><span class="op" id="6851414">)</span><span class="op" id="6851415">;</span>&nbsp;<span class="ident" id="6851417">x</span>&nbsp;<span class="op" id="6851419">!=</span>&nbsp;<span class="string" id="6851422">&#34;value1&#34;</span>&nbsp;<span class="op" id="6851431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851435">t</span><span class="op" id="6851436">.</span><span class="ident" id="6851437">Errorf</span><span class="op" id="6851443">(</span><span class="string" id="6851444">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6851479">,</span>&nbsp;<span class="string" id="6851481">&#34;Header1&#34;</span><span class="op" id="6851490">,</span>&nbsp;<span class="ident" id="6851492">x</span><span class="op" id="6851493">,</span>&nbsp;<span class="string" id="6851495">&#34;value1&#34;</span><span class="op" id="6851503">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851506">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851509">if</span>&nbsp;<span class="ident" id="6851512">x</span>&nbsp;<span class="op" id="6851514">:=</span>&nbsp;<span class="ident" id="6851517">part</span><span class="op" id="6851521">.</span><span class="ident" id="6851522">Header</span><span class="op" id="6851528">.</span><span class="ident" id="6851529">Get</span><span class="op" id="6851532">(</span><span class="string" id="6851533">&#34;foo-bar&#34;</span><span class="op" id="6851542">)</span><span class="op" id="6851543">;</span>&nbsp;<span class="ident" id="6851545">x</span>&nbsp;<span class="op" id="6851547">!=</span>&nbsp;<span class="string" id="6851550">&#34;baz&#34;</span>&nbsp;<span class="op" id="6851556">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851560">t</span><span class="op" id="6851561">.</span><span class="ident" id="6851562">Errorf</span><span class="op" id="6851568">(</span><span class="string" id="6851569">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6851604">,</span>&nbsp;<span class="string" id="6851606">&#34;foo-bar&#34;</span><span class="op" id="6851615">,</span>&nbsp;<span class="ident" id="6851617">x</span><span class="op" id="6851618">,</span>&nbsp;<span class="string" id="6851620">&#34;baz&#34;</span><span class="op" id="6851625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851628">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851631">if</span>&nbsp;<span class="ident" id="6851634">x</span>&nbsp;<span class="op" id="6851636">:=</span>&nbsp;<span class="ident" id="6851639">part</span><span class="op" id="6851643">.</span><span class="ident" id="6851644">Header</span><span class="op" id="6851650">.</span><span class="ident" id="6851651">Get</span><span class="op" id="6851654">(</span><span class="string" id="6851655">&#34;Foo-Bar&#34;</span><span class="op" id="6851664">)</span><span class="op" id="6851665">;</span>&nbsp;<span class="ident" id="6851667">x</span>&nbsp;<span class="op" id="6851669">!=</span>&nbsp;<span class="string" id="6851672">&#34;baz&#34;</span>&nbsp;<span class="op" id="6851678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851682">t</span><span class="op" id="6851683">.</span><span class="ident" id="6851684">Errorf</span><span class="op" id="6851690">(</span><span class="string" id="6851691">&#34;part.Header.Get(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="6851726">,</span>&nbsp;<span class="string" id="6851728">&#34;Foo-Bar&#34;</span><span class="op" id="6851737">,</span>&nbsp;<span class="ident" id="6851739">x</span><span class="op" id="6851740">,</span>&nbsp;<span class="string" id="6851742">&#34;baz&#34;</span><span class="op" id="6851747">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851750">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851753">buf</span><span class="op" id="6851756">.</span><span class="ident" id="6851757">Reset</span><span class="op" id="6851762">(</span><span class="op" id="6851763">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851766">if</span>&nbsp;<span class="ident" id="6851769">_</span><span class="op" id="6851770">,</span>&nbsp;<span class="ident" id="6851772">err</span>&nbsp;<span class="op" id="6851776">:=</span>&nbsp;<span class="ident" id="6851779">io</span><span class="op" id="6851781">.</span><span class="ident" id="6851782">Copy</span><span class="op" id="6851786">(</span><span class="ident" id="6851787">buf</span><span class="op" id="6851790">,</span>&nbsp;<span class="ident" id="6851792">part</span><span class="op" id="6851796">)</span><span class="op" id="6851797">;</span>&nbsp;<span class="ident" id="6851799">err</span>&nbsp;<span class="op" id="6851803">!=</span>&nbsp;<span class="builtintype" id="6851806">nil</span>&nbsp;<span class="op" id="6851810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851814">t</span><span class="op" id="6851815">.</span><span class="ident" id="6851816">Errorf</span><span class="op" id="6851822">(</span><span class="string" id="6851823">&#34;part&nbsp;1&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6851840">,</span>&nbsp;<span class="ident" id="6851842">err</span><span class="op" id="6851845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851848">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851852">adjustNewlines</span>&nbsp;<span class="op" id="6851867">:=</span>&nbsp;<span class="keyword" id="6851870">func</span><span class="op" id="6851874">(</span><span class="ident" id="6851875">s</span>&nbsp;<span class="builtintype" id="6851877">string</span><span class="op" id="6851883">)</span>&nbsp;<span class="builtintype" id="6851885">string</span>&nbsp;<span class="op" id="6851892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851896">if</span>&nbsp;<span class="ident" id="6851899">onlyNewlines</span>&nbsp;<span class="op" id="6851912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851917">return</span>&nbsp;<span class="ident" id="6851924">strings</span><span class="op" id="6851931">.</span><span class="ident" id="6851932">Replace</span><span class="op" id="6851939">(</span><span class="ident" id="6851940">s</span><span class="op" id="6851941">,</span>&nbsp;<span class="string" id="6851943">&#34;\r\n&#34;</span><span class="op" id="6851949">,</span>&nbsp;<span class="string" id="6851951">&#34;\n&#34;</span><span class="op" id="6851955">,</span>&nbsp;<span class="op" id="6851957">-</span><span class="num" id="6851958">1</span><span class="op" id="6851959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851963">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6851967">return</span>&nbsp;<span class="ident" id="6851974">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6851977">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6851981">expectEq</span><span class="op" id="6851989">(</span><span class="ident" id="6851990">t</span><span class="op" id="6851991">,</span>&nbsp;<span class="ident" id="6851993">adjustNewlines</span><span class="op" id="6852007">(</span><span class="string" id="6852008">&#34;My&nbsp;value\r\nThe&nbsp;end.&#34;</span><span class="op" id="6852030">)</span><span class="op" id="6852031">,</span>&nbsp;<span class="ident" id="6852033">buf</span><span class="op" id="6852036">.</span><span class="ident" id="6852037">String</span><span class="op" id="6852043">(</span><span class="op" id="6852044">)</span><span class="op" id="6852045">,</span>&nbsp;<span class="string" id="6852047">&#34;Value&nbsp;of&nbsp;first&nbsp;part&#34;</span><span class="op" id="6852068">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6852072">//&nbsp;Part2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852082">part</span><span class="op" id="6852086">,</span>&nbsp;<span class="ident" id="6852088">err</span>&nbsp;<span class="op" id="6852092">=</span>&nbsp;<span class="ident" id="6852094">reader</span><span class="op" id="6852100">.</span><span class="ident" id="6852101">NextPart</span><span class="op" id="6852109">(</span><span class="op" id="6852110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852113">if</span>&nbsp;<span class="ident" id="6852116">err</span>&nbsp;<span class="op" id="6852120">!=</span>&nbsp;<span class="builtintype" id="6852123">nil</span>&nbsp;<span class="op" id="6852127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852131">t</span><span class="op" id="6852132">.</span><span class="ident" id="6852133">Fatalf</span><span class="op" id="6852139">(</span><span class="string" id="6852140">&#34;Expected&nbsp;part2;&nbsp;got:&nbsp;%v&#34;</span><span class="op" id="6852165">,</span>&nbsp;<span class="ident" id="6852167">err</span><span class="op" id="6852170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852174">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852182">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852185">if</span>&nbsp;<span class="ident" id="6852188">e</span><span class="op" id="6852189">,</span>&nbsp;<span class="ident" id="6852191">g</span>&nbsp;<span class="op" id="6852193">:=</span>&nbsp;<span class="string" id="6852196">&#34;bigsection&#34;</span><span class="op" id="6852208">,</span>&nbsp;<span class="ident" id="6852210">part</span><span class="op" id="6852214">.</span><span class="ident" id="6852215">Header</span><span class="op" id="6852221">.</span><span class="ident" id="6852222">Get</span><span class="op" id="6852225">(</span><span class="string" id="6852226">&#34;name&#34;</span><span class="op" id="6852232">)</span><span class="op" id="6852233">;</span>&nbsp;<span class="ident" id="6852235">e</span>&nbsp;<span class="op" id="6852237">!=</span>&nbsp;<span class="ident" id="6852240">g</span>&nbsp;<span class="op" id="6852242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852246">t</span><span class="op" id="6852247">.</span><span class="ident" id="6852248">Errorf</span><span class="op" id="6852254">(</span><span class="string" id="6852255">&#34;part2&#39;s&nbsp;name&nbsp;header:&nbsp;expected&nbsp;%q,&nbsp;got&nbsp;%q&#34;</span><span class="op" id="6852297">,</span>&nbsp;<span class="ident" id="6852299">e</span><span class="op" id="6852300">,</span>&nbsp;<span class="ident" id="6852302">g</span><span class="op" id="6852303">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852306">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852309">buf</span><span class="op" id="6852312">.</span><span class="ident" id="6852313">Reset</span><span class="op" id="6852318">(</span><span class="op" id="6852319">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852322">if</span>&nbsp;<span class="ident" id="6852325">_</span><span class="op" id="6852326">,</span>&nbsp;<span class="ident" id="6852328">err</span>&nbsp;<span class="op" id="6852332">:=</span>&nbsp;<span class="ident" id="6852335">io</span><span class="op" id="6852337">.</span><span class="ident" id="6852338">Copy</span><span class="op" id="6852342">(</span><span class="ident" id="6852343">buf</span><span class="op" id="6852346">,</span>&nbsp;<span class="ident" id="6852348">part</span><span class="op" id="6852352">)</span><span class="op" id="6852353">;</span>&nbsp;<span class="ident" id="6852355">err</span>&nbsp;<span class="op" id="6852359">!=</span>&nbsp;<span class="builtintype" id="6852362">nil</span>&nbsp;<span class="op" id="6852366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852370">t</span><span class="op" id="6852371">.</span><span class="ident" id="6852372">Errorf</span><span class="op" id="6852378">(</span><span class="string" id="6852379">&#34;part&nbsp;2&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6852396">,</span>&nbsp;<span class="ident" id="6852398">err</span><span class="op" id="6852401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852404">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852407">s</span>&nbsp;<span class="op" id="6852409">:=</span>&nbsp;<span class="ident" id="6852412">buf</span><span class="op" id="6852415">.</span><span class="ident" id="6852416">String</span><span class="op" id="6852422">(</span><span class="op" id="6852423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852426">if</span>&nbsp;<span class="builtinfunc" id="6852429">len</span><span class="op" id="6852432">(</span><span class="ident" id="6852433">s</span><span class="op" id="6852434">)</span>&nbsp;<span class="op" id="6852436">!=</span>&nbsp;<span class="builtinfunc" id="6852439">len</span><span class="op" id="6852442">(</span><span class="ident" id="6852443">longLine</span><span class="op" id="6852451">)</span>&nbsp;<span class="op" id="6852453">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852457">t</span><span class="op" id="6852458">.</span><span class="ident" id="6852459">Errorf</span><span class="op" id="6852465">(</span><span class="string" id="6852466">&#34;part2&nbsp;body&nbsp;expected&nbsp;long&nbsp;line&nbsp;of&nbsp;length&nbsp;%d;&nbsp;got&nbsp;length&nbsp;%d&#34;</span><span class="op" id="6852525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6852530">len</span><span class="op" id="6852533">(</span><span class="ident" id="6852534">longLine</span><span class="op" id="6852542">)</span><span class="op" id="6852543">,</span>&nbsp;<span class="builtinfunc" id="6852545">len</span><span class="op" id="6852548">(</span><span class="ident" id="6852549">s</span><span class="op" id="6852550">)</span><span class="op" id="6852551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852554">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852557">if</span>&nbsp;<span class="ident" id="6852560">s</span>&nbsp;<span class="op" id="6852562">!=</span>&nbsp;<span class="ident" id="6852565">longLine</span>&nbsp;<span class="op" id="6852574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852578">t</span><span class="op" id="6852579">.</span><span class="ident" id="6852580">Errorf</span><span class="op" id="6852586">(</span><span class="string" id="6852587">&#34;part2&nbsp;long&nbsp;body&nbsp;didn&#39;t&nbsp;match&#34;</span><span class="op" id="6852617">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852620">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6852624">//&nbsp;Part3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852634">part</span><span class="op" id="6852638">,</span>&nbsp;<span class="ident" id="6852640">err</span>&nbsp;<span class="op" id="6852644">=</span>&nbsp;<span class="ident" id="6852646">reader</span><span class="op" id="6852652">.</span><span class="ident" id="6852653">NextPart</span><span class="op" id="6852661">(</span><span class="op" id="6852662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852665">if</span>&nbsp;<span class="ident" id="6852668">part</span>&nbsp;<span class="op" id="6852673">==</span>&nbsp;<span class="builtintype" id="6852676">nil</span>&nbsp;<span class="op" id="6852680">||</span>&nbsp;<span class="ident" id="6852683">err</span>&nbsp;<span class="op" id="6852687">!=</span>&nbsp;<span class="builtintype" id="6852690">nil</span>&nbsp;<span class="op" id="6852694">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852698">t</span><span class="op" id="6852699">.</span><span class="ident" id="6852700">Error</span><span class="op" id="6852705">(</span><span class="string" id="6852706">&#34;Expected&nbsp;part3&#34;</span><span class="op" id="6852722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852726">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852734">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852737">if</span>&nbsp;<span class="ident" id="6852740">part</span><span class="op" id="6852744">.</span><span class="ident" id="6852745">Header</span><span class="op" id="6852751">.</span><span class="ident" id="6852752">Get</span><span class="op" id="6852755">(</span><span class="string" id="6852756">&#34;foo-bar&#34;</span><span class="op" id="6852765">)</span>&nbsp;<span class="op" id="6852767">!=</span>&nbsp;<span class="string" id="6852770">&#34;bazb&#34;</span>&nbsp;<span class="op" id="6852777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852781">t</span><span class="op" id="6852782">.</span><span class="ident" id="6852783">Error</span><span class="op" id="6852788">(</span><span class="string" id="6852789">&#34;Expected&nbsp;foo-bar:&nbsp;bazb&#34;</span><span class="op" id="6852813">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852819">buf</span><span class="op" id="6852822">.</span><span class="ident" id="6852823">Reset</span><span class="op" id="6852828">(</span><span class="op" id="6852829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6852832">if</span>&nbsp;<span class="ident" id="6852835">_</span><span class="op" id="6852836">,</span>&nbsp;<span class="ident" id="6852838">err</span>&nbsp;<span class="op" id="6852842">:=</span>&nbsp;<span class="ident" id="6852845">io</span><span class="op" id="6852847">.</span><span class="ident" id="6852848">Copy</span><span class="op" id="6852852">(</span><span class="ident" id="6852853">buf</span><span class="op" id="6852856">,</span>&nbsp;<span class="ident" id="6852858">part</span><span class="op" id="6852862">)</span><span class="op" id="6852863">;</span>&nbsp;<span class="ident" id="6852865">err</span>&nbsp;<span class="op" id="6852869">!=</span>&nbsp;<span class="builtintype" id="6852872">nil</span>&nbsp;<span class="op" id="6852876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852880">t</span><span class="op" id="6852881">.</span><span class="ident" id="6852882">Errorf</span><span class="op" id="6852888">(</span><span class="string" id="6852889">&#34;part&nbsp;3&nbsp;copy:&nbsp;%v&#34;</span><span class="op" id="6852906">,</span>&nbsp;<span class="ident" id="6852908">err</span><span class="op" id="6852911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6852914">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6852917">expectEq</span><span class="op" id="6852925">(</span><span class="ident" id="6852926">t</span><span class="op" id="6852927">,</span>&nbsp;<span class="ident" id="6852929">adjustNewlines</span><span class="op" id="6852943">(</span><span class="string" id="6852944">&#34;Line&nbsp;1\r\nLine&nbsp;2\r\nLine&nbsp;3&nbsp;ends&nbsp;in&nbsp;a&nbsp;newline,&nbsp;but&nbsp;just&nbsp;one.\r\n&#34;</span><span class="op" id="6853009">)</span><span class="op" id="6853010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853014">buf</span><span class="op" id="6853017">.</span><span class="ident" id="6853018">String</span><span class="op" id="6853024">(</span><span class="op" id="6853025">)</span><span class="op" id="6853026">,</span>&nbsp;<span class="string" id="6853028">&#34;body&nbsp;of&nbsp;part&nbsp;3&#34;</span><span class="op" id="6853044">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6853048">//&nbsp;Part4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853058">part</span><span class="op" id="6853062">,</span>&nbsp;<span class="ident" id="6853064">err</span>&nbsp;<span class="op" id="6853068">=</span>&nbsp;<span class="ident" id="6853070">reader</span><span class="op" id="6853076">.</span><span class="ident" id="6853077">NextPart</span><span class="op" id="6853085">(</span><span class="op" id="6853086">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853089">if</span>&nbsp;<span class="ident" id="6853092">part</span>&nbsp;<span class="op" id="6853097">==</span>&nbsp;<span class="builtintype" id="6853100">nil</span>&nbsp;<span class="op" id="6853104">||</span>&nbsp;<span class="ident" id="6853107">err</span>&nbsp;<span class="op" id="6853111">!=</span>&nbsp;<span class="builtintype" id="6853114">nil</span>&nbsp;<span class="op" id="6853118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853122">t</span><span class="op" id="6853123">.</span><span class="ident" id="6853124">Error</span><span class="op" id="6853129">(</span><span class="string" id="6853130">&#34;Expected&nbsp;part&nbsp;4&nbsp;without&nbsp;errors&#34;</span><span class="op" id="6853162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853166">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6853174">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6853178">//&nbsp;Non-existent&nbsp;part5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853201">part</span><span class="op" id="6853205">,</span>&nbsp;<span class="ident" id="6853207">err</span>&nbsp;<span class="op" id="6853211">=</span>&nbsp;<span class="ident" id="6853213">reader</span><span class="op" id="6853219">.</span><span class="ident" id="6853220">NextPart</span><span class="op" id="6853228">(</span><span class="op" id="6853229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853232">if</span>&nbsp;<span class="ident" id="6853235">part</span>&nbsp;<span class="op" id="6853240">!=</span>&nbsp;<span class="builtintype" id="6853243">nil</span>&nbsp;<span class="op" id="6853247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853251">t</span><span class="op" id="6853252">.</span><span class="ident" id="6853253">Error</span><span class="op" id="6853258">(</span><span class="string" id="6853259">&#34;Didn&#39;t&nbsp;expect&nbsp;a&nbsp;fifth&nbsp;part.&#34;</span><span class="op" id="6853288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6853291">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853294">if</span>&nbsp;<span class="ident" id="6853297">err</span>&nbsp;<span class="op" id="6853301">!=</span>&nbsp;<span class="ident" id="6853304">io</span><span class="op" id="6853306">.</span><span class="ident" id="6853307">EOF</span>&nbsp;<span class="op" id="6853311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853315">t</span><span class="op" id="6853316">.</span><span class="ident" id="6853317">Errorf</span><span class="op" id="6853323">(</span><span class="string" id="6853324">&#34;On&nbsp;fifth&nbsp;part&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6853363">,</span>&nbsp;<span class="ident" id="6853365">err</span><span class="op" id="6853368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6853371">}</span><br>
<span class="lineno"></span><span class="op" id="6853373">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span><span class="keyword" id="6853376">func</span>&nbsp;<span class="ident" id="6853381">TestVariousTextLineEndings</span><span class="op" id="6853407">(</span><span class="ident" id="6853408">t</span>&nbsp;<span class="op" id="6853410">*</span><span class="ident" id="6853411">testing</span><span class="op" id="6853418">.</span><span class="ident" id="6853419">T</span><span class="op" id="6853420">)</span>&nbsp;<span class="op" id="6853422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853425">tests</span>&nbsp;<span class="op" id="6853431">:=</span>&nbsp;<span class="op" id="6853434">[</span><span class="op" id="6853435">...</span><span class="op" id="6853438">]</span><span class="builtintype" id="6853439">string</span><span class="op" id="6853445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853449">&#34;Foo\nBar&#34;</span><span class="op" id="6853459">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853463">&#34;Foo\nBar\n&#34;</span><span class="op" id="6853475">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853479">&#34;Foo\r\nBar&#34;</span><span class="op" id="6853491">,</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853495">&#34;Foo\r\nBar\r\n&#34;</span><span class="op" id="6853511">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853515">&#34;Foo\rBar&#34;</span><span class="op" id="6853525">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853529">&#34;Foo\rBar\r&#34;</span><span class="op" id="6853541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853545">&#34;\x00\x01\x02\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&#34;</span><span class="op" id="6853591">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6853594">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853598">for</span>&nbsp;<span class="ident" id="6853602">testNum</span><span class="op" id="6853609">,</span>&nbsp;<span class="ident" id="6853611">expectedBody</span>&nbsp;<span class="op" id="6853624">:=</span>&nbsp;<span class="keyword" id="6853627">range</span>&nbsp;<span class="ident" id="6853633">tests</span>&nbsp;<span class="op" id="6853639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853643">body</span>&nbsp;<span class="op" id="6853648">:=</span>&nbsp;<span class="string" id="6853651">&#34;--BOUNDARY\r\n&#34;</span>&nbsp;<span class="op" id="6853668">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853673">&#34;Content-Disposition:&nbsp;form-data;&nbsp;name=\&#34;value\&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6853726">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853731">&#34;\r\n&#34;</span>&nbsp;<span class="op" id="6853738">+</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853743">expectedBody</span>&nbsp;<span class="op" id="6853756">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6853761">&#34;\r\n--BOUNDARY--\r\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853786">bodyReader</span>&nbsp;<span class="op" id="6853797">:=</span>&nbsp;<span class="ident" id="6853800">strings</span><span class="op" id="6853807">.</span><span class="ident" id="6853808">NewReader</span><span class="op" id="6853817">(</span><span class="ident" id="6853818">body</span><span class="op" id="6853822">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853827">reader</span>&nbsp;<span class="op" id="6853834">:=</span>&nbsp;<span class="ident" id="6853837">NewReader</span><span class="op" id="6853846">(</span><span class="ident" id="6853847">bodyReader</span><span class="op" id="6853857">,</span>&nbsp;<span class="string" id="6853859">&#34;BOUNDARY&#34;</span><span class="op" id="6853869">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853873">buf</span>&nbsp;<span class="op" id="6853877">:=</span>&nbsp;<span class="builtinfunc" id="6853880">new</span><span class="op" id="6853883">(</span><span class="ident" id="6853884">bytes</span><span class="op" id="6853889">.</span><span class="ident" id="6853890">Buffer</span><span class="op" id="6853896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853900">part</span><span class="op" id="6853904">,</span>&nbsp;<span class="ident" id="6853906">err</span>&nbsp;<span class="op" id="6853910">:=</span>&nbsp;<span class="ident" id="6853913">reader</span><span class="op" id="6853919">.</span><span class="ident" id="6853920">NextPart</span><span class="op" id="6853928">(</span><span class="op" id="6853929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6853933">if</span>&nbsp;<span class="ident" id="6853936">part</span>&nbsp;<span class="op" id="6853941">==</span>&nbsp;<span class="builtintype" id="6853944">nil</span>&nbsp;<span class="op" id="6853948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6853953">t</span><span class="op" id="6853954">.</span><span class="ident" id="6853955">Errorf</span><span class="op" id="6853961">(</span><span class="string" id="6853962">&#34;Expected&nbsp;a&nbsp;body&nbsp;part&nbsp;on&nbsp;text&nbsp;%d&#34;</span><span class="op" id="6853995">,</span>&nbsp;<span class="ident" id="6853997">testNum</span><span class="op" id="6854004">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854009">continue</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854024">if</span>&nbsp;<span class="ident" id="6854027">err</span>&nbsp;<span class="op" id="6854031">!=</span>&nbsp;<span class="builtintype" id="6854034">nil</span>&nbsp;<span class="op" id="6854038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854043">t</span><span class="op" id="6854044">.</span><span class="ident" id="6854045">Errorf</span><span class="op" id="6854051">(</span><span class="string" id="6854052">&#34;Unexpected&nbsp;error&nbsp;on&nbsp;text&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="6854085">,</span>&nbsp;<span class="ident" id="6854087">testNum</span><span class="op" id="6854094">,</span>&nbsp;<span class="ident" id="6854096">err</span><span class="op" id="6854099">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854104">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854115">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854119">written</span><span class="op" id="6854126">,</span>&nbsp;<span class="ident" id="6854128">err</span>&nbsp;<span class="op" id="6854132">:=</span>&nbsp;<span class="ident" id="6854135">io</span><span class="op" id="6854137">.</span><span class="ident" id="6854138">Copy</span><span class="op" id="6854142">(</span><span class="ident" id="6854143">buf</span><span class="op" id="6854146">,</span>&nbsp;<span class="ident" id="6854148">part</span><span class="op" id="6854152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854156">expectEq</span><span class="op" id="6854164">(</span><span class="ident" id="6854165">t</span><span class="op" id="6854166">,</span>&nbsp;<span class="ident" id="6854168">expectedBody</span><span class="op" id="6854180">,</span>&nbsp;<span class="ident" id="6854182">buf</span><span class="op" id="6854185">.</span><span class="ident" id="6854186">String</span><span class="op" id="6854192">(</span><span class="op" id="6854193">)</span><span class="op" id="6854194">,</span>&nbsp;<span class="ident" id="6854196">fmt</span><span class="op" id="6854199">.</span><span class="ident" id="6854200">Sprintf</span><span class="op" id="6854207">(</span><span class="string" id="6854208">&#34;test&nbsp;%d&#34;</span><span class="op" id="6854217">,</span>&nbsp;<span class="ident" id="6854219">testNum</span><span class="op" id="6854226">)</span><span class="op" id="6854227">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854231">if</span>&nbsp;<span class="ident" id="6854234">err</span>&nbsp;<span class="op" id="6854238">!=</span>&nbsp;<span class="builtintype" id="6854241">nil</span>&nbsp;<span class="op" id="6854245">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854250">t</span><span class="op" id="6854251">.</span><span class="ident" id="6854252">Errorf</span><span class="op" id="6854258">(</span><span class="string" id="6854259">&#34;Error&nbsp;copying&nbsp;multipart;&nbsp;bytes=%v,&nbsp;error=%v&#34;</span><span class="op" id="6854304">,</span>&nbsp;<span class="ident" id="6854306">written</span><span class="op" id="6854313">,</span>&nbsp;<span class="ident" id="6854315">err</span><span class="op" id="6854318">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854322">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854327">part</span><span class="op" id="6854331">,</span>&nbsp;<span class="ident" id="6854333">err</span>&nbsp;<span class="op" id="6854337">=</span>&nbsp;<span class="ident" id="6854339">reader</span><span class="op" id="6854345">.</span><span class="ident" id="6854346">NextPart</span><span class="op" id="6854354">(</span><span class="op" id="6854355">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854359">if</span>&nbsp;<span class="ident" id="6854362">part</span>&nbsp;<span class="op" id="6854367">!=</span>&nbsp;<span class="builtintype" id="6854370">nil</span>&nbsp;<span class="op" id="6854374">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854379">t</span><span class="op" id="6854380">.</span><span class="ident" id="6854381">Errorf</span><span class="op" id="6854387">(</span><span class="string" id="6854388">&#34;Unexpected&nbsp;part&nbsp;in&nbsp;test&nbsp;%d&#34;</span><span class="op" id="6854416">,</span>&nbsp;<span class="ident" id="6854418">testNum</span><span class="op" id="6854425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854429">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854433">if</span>&nbsp;<span class="ident" id="6854436">err</span>&nbsp;<span class="op" id="6854440">!=</span>&nbsp;<span class="ident" id="6854443">io</span><span class="op" id="6854445">.</span><span class="ident" id="6854446">EOF</span>&nbsp;<span class="op" id="6854450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854455">t</span><span class="op" id="6854456">.</span><span class="ident" id="6854457">Errorf</span><span class="op" id="6854463">(</span><span class="string" id="6854464">&#34;On&nbsp;test&nbsp;%d&nbsp;expected&nbsp;io.EOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6854500">,</span>&nbsp;<span class="ident" id="6854502">testNum</span><span class="op" id="6854509">,</span>&nbsp;<span class="ident" id="6854511">err</span><span class="op" id="6854514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854518">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854522">}</span><br>
<span class="lineno">260</span><span class="op" id="6854524">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6854527">type</span>&nbsp;<span class="ident" id="6854532">maliciousReader</span>&nbsp;<span class="keyword" id="6854548">struct</span>&nbsp;<span class="op" id="6854555">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854558">t</span>&nbsp;<span class="op" id="6854560">*</span><span class="ident" id="6854561">testing</span><span class="op" id="6854568">.</span><span class="ident" id="6854569">T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854572">n</span>&nbsp;<span class="builtintype" id="6854574">int</span><br>
<span class="lineno">265</span><span class="op" id="6854578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6854581">const</span>&nbsp;<span class="ident" id="6854587">maxReadThreshold</span>&nbsp;<span class="op" id="6854604">=</span>&nbsp;<span class="num" id="6854606">1</span>&nbsp;<span class="op" id="6854608">&lt;&lt;</span>&nbsp;<span class="num" id="6854611">20</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6854615">func</span>&nbsp;<span class="op" id="6854620">(</span><span class="ident" id="6854621">mr</span>&nbsp;<span class="op" id="6854624">*</span><span class="ident" id="6854625">maliciousReader</span><span class="op" id="6854640">)</span>&nbsp;<span class="ident" id="6854642">Read</span><span class="op" id="6854646">(</span><span class="ident" id="6854647">b</span>&nbsp;<span class="op" id="6854649">[</span><span class="op" id="6854650">]</span><span class="builtintype" id="6854651">byte</span><span class="op" id="6854655">)</span>&nbsp;<span class="op" id="6854657">(</span><span class="ident" id="6854658">n</span>&nbsp;<span class="builtintype" id="6854660">int</span><span class="op" id="6854663">,</span>&nbsp;<span class="ident" id="6854665">err</span>&nbsp;<span class="builtintype" id="6854669">error</span><span class="op" id="6854674">)</span>&nbsp;<span class="op" id="6854676">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854679">mr</span><span class="op" id="6854681">.</span><span class="ident" id="6854682">n</span>&nbsp;<span class="op" id="6854684">+=</span>&nbsp;<span class="builtinfunc" id="6854687">len</span><span class="op" id="6854690">(</span><span class="ident" id="6854691">b</span><span class="op" id="6854692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854695">if</span>&nbsp;<span class="ident" id="6854698">mr</span><span class="op" id="6854700">.</span><span class="ident" id="6854701">n</span>&nbsp;<span class="op" id="6854703">&gt;=</span>&nbsp;<span class="ident" id="6854706">maxReadThreshold</span>&nbsp;<span class="op" id="6854723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854727">mr</span><span class="op" id="6854729">.</span><span class="ident" id="6854730">t</span><span class="op" id="6854731">.</span><span class="ident" id="6854732">Fatal</span><span class="op" id="6854737">(</span><span class="string" id="6854738">&#34;too&nbsp;much&nbsp;was&nbsp;read&#34;</span><span class="op" id="6854757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854761">return</span>&nbsp;<span class="num" id="6854768">0</span><span class="op" id="6854769">,</span>&nbsp;<span class="ident" id="6854771">io</span><span class="op" id="6854773">.</span><span class="ident" id="6854774">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854779">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854782">return</span>&nbsp;<span class="builtinfunc" id="6854789">len</span><span class="op" id="6854792">(</span><span class="ident" id="6854793">b</span><span class="op" id="6854794">)</span><span class="op" id="6854795">,</span>&nbsp;<span class="builtintype" id="6854797">nil</span><br>
<span class="lineno"></span><span class="op" id="6854801">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6854804">func</span>&nbsp;<span class="ident" id="6854809">TestLineLimit</span><span class="op" id="6854822">(</span><span class="ident" id="6854823">t</span>&nbsp;<span class="op" id="6854825">*</span><span class="ident" id="6854826">testing</span><span class="op" id="6854833">.</span><span class="ident" id="6854834">T</span><span class="op" id="6854835">)</span>&nbsp;<span class="op" id="6854837">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854840">mr</span>&nbsp;<span class="op" id="6854843">:=</span>&nbsp;<span class="op" id="6854846">&amp;</span><span class="ident" id="6854847">maliciousReader</span><span class="op" id="6854862">{</span><span class="ident" id="6854863">t</span><span class="op" id="6854864">:</span>&nbsp;<span class="ident" id="6854866">t</span><span class="op" id="6854867">}</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854870">r</span>&nbsp;<span class="op" id="6854872">:=</span>&nbsp;<span class="ident" id="6854875">NewReader</span><span class="op" id="6854884">(</span><span class="ident" id="6854885">mr</span><span class="op" id="6854887">,</span>&nbsp;<span class="string" id="6854889">&#34;fooBoundary&#34;</span><span class="op" id="6854902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854905">part</span><span class="op" id="6854909">,</span>&nbsp;<span class="ident" id="6854911">err</span>&nbsp;<span class="op" id="6854915">:=</span>&nbsp;<span class="ident" id="6854918">r</span><span class="op" id="6854919">.</span><span class="ident" id="6854920">NextPart</span><span class="op" id="6854928">(</span><span class="op" id="6854929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854932">if</span>&nbsp;<span class="ident" id="6854935">part</span>&nbsp;<span class="op" id="6854940">!=</span>&nbsp;<span class="builtintype" id="6854943">nil</span>&nbsp;<span class="op" id="6854947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6854951">t</span><span class="op" id="6854952">.</span><span class="ident" id="6854953">Errorf</span><span class="op" id="6854959">(</span><span class="string" id="6854960">&#34;unexpected&nbsp;part&nbsp;read&#34;</span><span class="op" id="6854982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6854985">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6854988">if</span>&nbsp;<span class="ident" id="6854991">err</span>&nbsp;<span class="op" id="6854995">==</span>&nbsp;<span class="builtintype" id="6854998">nil</span>&nbsp;<span class="op" id="6855002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855006">t</span><span class="op" id="6855007">.</span><span class="ident" id="6855008">Errorf</span><span class="op" id="6855014">(</span><span class="string" id="6855015">&#34;expected&nbsp;an&nbsp;error&#34;</span><span class="op" id="6855034">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6855037">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855040">if</span>&nbsp;<span class="ident" id="6855043">mr</span><span class="op" id="6855045">.</span><span class="ident" id="6855046">n</span>&nbsp;<span class="op" id="6855048">&gt;=</span>&nbsp;<span class="ident" id="6855051">maxReadThreshold</span>&nbsp;<span class="op" id="6855068">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855072">t</span><span class="op" id="6855073">.</span><span class="ident" id="6855074">Errorf</span><span class="op" id="6855080">(</span><span class="string" id="6855081">&#34;expected&nbsp;to&nbsp;read&nbsp;&lt;&nbsp;%d&nbsp;bytes;&nbsp;read&nbsp;%d&#34;</span><span class="op" id="6855119">,</span>&nbsp;<span class="ident" id="6855121">maxReadThreshold</span><span class="op" id="6855137">,</span>&nbsp;<span class="ident" id="6855139">mr</span><span class="op" id="6855141">.</span><span class="ident" id="6855142">n</span><span class="op" id="6855143">)</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6855146">}</span><br>
<span class="lineno"></span><span class="op" id="6855148">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6855151">func</span>&nbsp;<span class="ident" id="6855156">TestMultipartTruncated</span><span class="op" id="6855178">(</span><span class="ident" id="6855179">t</span>&nbsp;<span class="op" id="6855181">*</span><span class="ident" id="6855182">testing</span><span class="op" id="6855189">.</span><span class="ident" id="6855190">T</span><span class="op" id="6855191">)</span>&nbsp;<span class="op" id="6855193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855196">testBody</span>&nbsp;<span class="op" id="6855205">:=</span>&nbsp;<span class="string" id="6855208">`<br>
<span class="lineno">295</span>This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo-bar:&nbsp;baz<br>
<span class="lineno"></span><br>
<span class="lineno"></span>Oh&nbsp;no,&nbsp;premature&nbsp;EOF!<br>
<span class="lineno">300</span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855315">body</span>&nbsp;<span class="op" id="6855320">:=</span>&nbsp;<span class="ident" id="6855323">strings</span><span class="op" id="6855330">.</span><span class="ident" id="6855331">Replace</span><span class="op" id="6855338">(</span><span class="ident" id="6855339">testBody</span><span class="op" id="6855347">,</span>&nbsp;<span class="string" id="6855349">&#34;\n&#34;</span><span class="op" id="6855353">,</span>&nbsp;<span class="string" id="6855355">&#34;\r\n&#34;</span><span class="op" id="6855361">,</span>&nbsp;<span class="op" id="6855363">-</span><span class="num" id="6855364">1</span><span class="op" id="6855365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855368">bodyReader</span>&nbsp;<span class="op" id="6855379">:=</span>&nbsp;<span class="ident" id="6855382">strings</span><span class="op" id="6855389">.</span><span class="ident" id="6855390">NewReader</span><span class="op" id="6855399">(</span><span class="ident" id="6855400">body</span><span class="op" id="6855404">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855407">r</span>&nbsp;<span class="op" id="6855409">:=</span>&nbsp;<span class="ident" id="6855412">NewReader</span><span class="op" id="6855421">(</span><span class="ident" id="6855422">bodyReader</span><span class="op" id="6855432">,</span>&nbsp;<span class="string" id="6855434">&#34;MyBoundary&#34;</span><span class="op" id="6855446">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855450">part</span><span class="op" id="6855454">,</span>&nbsp;<span class="ident" id="6855456">err</span>&nbsp;<span class="op" id="6855460">:=</span>&nbsp;<span class="ident" id="6855463">r</span><span class="op" id="6855464">.</span><span class="ident" id="6855465">NextPart</span><span class="op" id="6855473">(</span><span class="op" id="6855474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855477">if</span>&nbsp;<span class="ident" id="6855480">err</span>&nbsp;<span class="op" id="6855484">!=</span>&nbsp;<span class="builtintype" id="6855487">nil</span>&nbsp;<span class="op" id="6855491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855495">t</span><span class="op" id="6855496">.</span><span class="ident" id="6855497">Fatalf</span><span class="op" id="6855503">(</span><span class="string" id="6855504">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6855523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6855526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855529">_</span><span class="op" id="6855530">,</span>&nbsp;<span class="ident" id="6855532">err</span>&nbsp;<span class="op" id="6855536">=</span>&nbsp;<span class="ident" id="6855538">io</span><span class="op" id="6855540">.</span><span class="ident" id="6855541">Copy</span><span class="op" id="6855545">(</span><span class="ident" id="6855546">ioutil</span><span class="op" id="6855552">.</span><span class="ident" id="6855553">Discard</span><span class="op" id="6855560">,</span>&nbsp;<span class="ident" id="6855562">part</span><span class="op" id="6855566">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855569">if</span>&nbsp;<span class="ident" id="6855572">err</span>&nbsp;<span class="op" id="6855576">!=</span>&nbsp;<span class="ident" id="6855579">io</span><span class="op" id="6855581">.</span><span class="ident" id="6855582">ErrUnexpectedEOF</span>&nbsp;<span class="op" id="6855599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855603">t</span><span class="op" id="6855604">.</span><span class="ident" id="6855605">Fatalf</span><span class="op" id="6855611">(</span><span class="string" id="6855612">&#34;expected&nbsp;error&nbsp;io.ErrUnexpectedEOF;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="6855656">,</span>&nbsp;<span class="ident" id="6855658">err</span><span class="op" id="6855661">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6855664">}</span><br>
<span class="lineno"></span><span class="op" id="6855666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="6855669">type</span>&nbsp;<span class="ident" id="6855674">slowReader</span>&nbsp;<span class="keyword" id="6855685">struct</span>&nbsp;<span class="op" id="6855692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6855695">r</span>&nbsp;<span class="ident" id="6855697">io</span><span class="op" id="6855699">.</span><span class="ident" id="6855700">Reader</span><br>
<span class="lineno"></span><span class="op" id="6855707">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6855710">func</span>&nbsp;<span class="op" id="6855715">(</span><span class="ident" id="6855716">s</span>&nbsp;<span class="op" id="6855718">*</span><span class="ident" id="6855719">slowReader</span><span class="op" id="6855729">)</span>&nbsp;<span class="ident" id="6855731">Read</span><span class="op" id="6855735">(</span><span class="ident" id="6855736">p</span>&nbsp;<span class="op" id="6855738">[</span><span class="op" id="6855739">]</span><span class="builtintype" id="6855740">byte</span><span class="op" id="6855744">)</span>&nbsp;<span class="op" id="6855746">(</span><span class="builtintype" id="6855747">int</span><span class="op" id="6855750">,</span>&nbsp;<span class="builtintype" id="6855752">error</span><span class="op" id="6855757">)</span>&nbsp;<span class="op" id="6855759">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855762">if</span>&nbsp;<span class="builtinfunc" id="6855765">len</span><span class="op" id="6855768">(</span><span class="ident" id="6855769">p</span><span class="op" id="6855770">)</span>&nbsp;<span class="op" id="6855772">==</span>&nbsp;<span class="num" id="6855775">0</span>&nbsp;<span class="op" id="6855777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855781">return</span>&nbsp;<span class="ident" id="6855788">s</span><span class="op" id="6855789">.</span><span class="ident" id="6855790">r</span><span class="op" id="6855791">.</span><span class="ident" id="6855792">Read</span><span class="op" id="6855796">(</span><span class="ident" id="6855797">p</span><span class="op" id="6855798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6855801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6855804">return</span>&nbsp;<span class="ident" id="6855811">s</span><span class="op" id="6855812">.</span><span class="ident" id="6855813">r</span><span class="op" id="6855814">.</span><span class="ident" id="6855815">Read</span><span class="op" id="6855819">(</span><span class="ident" id="6855820">p</span><span class="op" id="6855821">[</span><span class="op" id="6855822">:</span><span class="num" id="6855823">1</span><span class="op" id="6855824">]</span><span class="op" id="6855825">)</span><br>
<span class="lineno"></span><span class="op" id="6855827">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="6855830">func</span>&nbsp;<span class="ident" id="6855835">TestLineContinuation</span><span class="op" id="6855855">(</span><span class="ident" id="6855856">t</span>&nbsp;<span class="op" id="6855858">*</span><span class="ident" id="6855859">testing</span><span class="op" id="6855866">.</span><span class="ident" id="6855867">T</span><span class="op" id="6855868">)</span>&nbsp;<span class="op" id="6855870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6855873">//&nbsp;This&nbsp;body,&nbsp;extracted&nbsp;from&nbsp;an&nbsp;email,&nbsp;contains&nbsp;headers&nbsp;that&nbsp;span&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6855949">//&nbsp;lines.</span><br>
<span class="lineno"></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6855961">//&nbsp;TODO:&nbsp;The&nbsp;original&nbsp;mail&nbsp;ended&nbsp;with&nbsp;a&nbsp;double-newline&nbsp;before&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6856028">//&nbsp;final&nbsp;delimiter;&nbsp;this&nbsp;was&nbsp;manually&nbsp;edited&nbsp;to&nbsp;use&nbsp;a&nbsp;CRLF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856089">testBody</span>&nbsp;<span class="op" id="6856098">:=</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6856103">&#34;\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;7bit\nContent-Type:&nbsp;text/plain;\n\tcharset=US-ASCII;\n\tdelsp=yes;\n\tformat=flowed\n\nI&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;happening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).\n\n\n--Apple-Mail-2-292336769\nContent-Transfer-Encoding:&nbsp;quoted-printable\nContent-Type:&nbsp;text/html;\n\tcharset=ISO-8859-1\n\n&lt;HTML&gt;&lt;BODY&gt;I&#39;m&nbsp;finding&nbsp;the&nbsp;same&nbsp;thing&nbsp;=\nhappening&nbsp;on&nbsp;my&nbsp;system&nbsp;(10.4.1).=A0&nbsp;But&nbsp;I&nbsp;built&nbsp;it&nbsp;with&nbsp;XCode&nbsp;=\n2.0.&lt;/BODY&gt;&lt;/=\nHTML&gt;=\n\r\n--Apple-Mail-2-292336769--\n&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856599">r</span>&nbsp;<span class="op" id="6856601">:=</span>&nbsp;<span class="ident" id="6856604">NewReader</span><span class="op" id="6856613">(</span><span class="ident" id="6856614">strings</span><span class="op" id="6856621">.</span><span class="ident" id="6856622">NewReader</span><span class="op" id="6856631">(</span><span class="ident" id="6856632">testBody</span><span class="op" id="6856640">)</span><span class="op" id="6856641">,</span>&nbsp;<span class="string" id="6856643">&#34;Apple-Mail-2-292336769&#34;</span><span class="op" id="6856667">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6856671">for</span>&nbsp;<span class="ident" id="6856675">i</span>&nbsp;<span class="op" id="6856677">:=</span>&nbsp;<span class="num" id="6856680">0</span><span class="op" id="6856681">;</span>&nbsp;<span class="ident" id="6856683">i</span>&nbsp;<span class="op" id="6856685">&lt;</span>&nbsp;<span class="num" id="6856687">2</span><span class="op" id="6856688">;</span>&nbsp;<span class="ident" id="6856690">i</span><span class="op" id="6856691">++</span>&nbsp;<span class="op" id="6856694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856698">part</span><span class="op" id="6856702">,</span>&nbsp;<span class="ident" id="6856704">err</span>&nbsp;<span class="op" id="6856708">:=</span>&nbsp;<span class="ident" id="6856711">r</span><span class="op" id="6856712">.</span><span class="ident" id="6856713">NextPart</span><span class="op" id="6856721">(</span><span class="op" id="6856722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6856726">if</span>&nbsp;<span class="ident" id="6856729">err</span>&nbsp;<span class="op" id="6856733">!=</span>&nbsp;<span class="builtintype" id="6856736">nil</span>&nbsp;<span class="op" id="6856740">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856745">t</span><span class="op" id="6856746">.</span><span class="ident" id="6856747">Fatalf</span><span class="op" id="6856753">(</span><span class="string" id="6856754">&#34;didn&#39;t&nbsp;get&nbsp;a&nbsp;part&#34;</span><span class="op" id="6856773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6856777">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6856781">var</span>&nbsp;<span class="ident" id="6856785">buf</span>&nbsp;<span class="ident" id="6856789">bytes</span><span class="op" id="6856794">.</span><span class="ident" id="6856795">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856804">n</span><span class="op" id="6856805">,</span>&nbsp;<span class="ident" id="6856807">err</span>&nbsp;<span class="op" id="6856811">:=</span>&nbsp;<span class="ident" id="6856814">io</span><span class="op" id="6856816">.</span><span class="ident" id="6856817">Copy</span><span class="op" id="6856821">(</span><span class="op" id="6856822">&amp;</span><span class="ident" id="6856823">buf</span><span class="op" id="6856826">,</span>&nbsp;<span class="ident" id="6856828">part</span><span class="op" id="6856832">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6856836">if</span>&nbsp;<span class="ident" id="6856839">err</span>&nbsp;<span class="op" id="6856843">!=</span>&nbsp;<span class="builtintype" id="6856846">nil</span>&nbsp;<span class="op" id="6856850">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856855">t</span><span class="op" id="6856856">.</span><span class="ident" id="6856857">Errorf</span><span class="op" id="6856863">(</span><span class="string" id="6856864">&#34;error&nbsp;reading&nbsp;part:&nbsp;%v\nread&nbsp;so&nbsp;far:&nbsp;%q&#34;</span><span class="op" id="6856905">,</span>&nbsp;<span class="ident" id="6856907">err</span><span class="op" id="6856910">,</span>&nbsp;<span class="ident" id="6856912">buf</span><span class="op" id="6856915">.</span><span class="ident" id="6856916">String</span><span class="op" id="6856922">(</span><span class="op" id="6856923">)</span><span class="op" id="6856924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6856928">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6856932">if</span>&nbsp;<span class="ident" id="6856935">n</span>&nbsp;<span class="op" id="6856937">&lt;=</span>&nbsp;<span class="num" id="6856940">0</span>&nbsp;<span class="op" id="6856942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6856947">t</span><span class="op" id="6856948">.</span><span class="ident" id="6856949">Errorf</span><span class="op" id="6856955">(</span><span class="string" id="6856956">&#34;read&nbsp;%d&nbsp;bytes;&nbsp;expected&nbsp;&gt;0&#34;</span><span class="op" id="6856984">,</span>&nbsp;<span class="ident" id="6856986">n</span><span class="op" id="6856987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6856991">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6856994">}</span><br>
<span class="lineno"></span><span class="op" id="6856996">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6856999">func</span>&nbsp;<span class="ident" id="6857004">TestQuotedPrintableEncoding</span><span class="op" id="6857031">(</span><span class="ident" id="6857032">t</span>&nbsp;<span class="op" id="6857034">*</span><span class="ident" id="6857035">testing</span><span class="op" id="6857042">.</span><span class="ident" id="6857043">T</span><span class="op" id="6857044">)</span>&nbsp;<span class="op" id="6857046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6857049">//&nbsp;From&nbsp;http://golang.org/issue/4411</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6857087">body</span>&nbsp;<span class="op" id="6857092">:=</span>&nbsp;<span class="string" id="6857095">&#34;--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=text\r\nContent-Transfer-Encoding:&nbsp;quoted-printable\r\n\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;wor=\r\nds&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;=\r\nwords&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words\r\n--0016e68ee29c5d515f04cedf6733\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--0016e68ee29c5d515f04cedf6733--&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6857829">r</span>&nbsp;<span class="op" id="6857831">:=</span>&nbsp;<span class="ident" id="6857834">NewReader</span><span class="op" id="6857843">(</span><span class="ident" id="6857844">strings</span><span class="op" id="6857851">.</span><span class="ident" id="6857852">NewReader</span><span class="op" id="6857861">(</span><span class="ident" id="6857862">body</span><span class="op" id="6857866">)</span><span class="op" id="6857867">,</span>&nbsp;<span class="string" id="6857869">&#34;0016e68ee29c5d515f04cedf6733&#34;</span><span class="op" id="6857899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6857902">part</span><span class="op" id="6857906">,</span>&nbsp;<span class="ident" id="6857908">err</span>&nbsp;<span class="op" id="6857912">:=</span>&nbsp;<span class="ident" id="6857915">r</span><span class="op" id="6857916">.</span><span class="ident" id="6857917">NextPart</span><span class="op" id="6857925">(</span><span class="op" id="6857926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6857929">if</span>&nbsp;<span class="ident" id="6857932">err</span>&nbsp;<span class="op" id="6857936">!=</span>&nbsp;<span class="builtintype" id="6857939">nil</span>&nbsp;<span class="op" id="6857943">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6857947">t</span><span class="op" id="6857948">.</span><span class="ident" id="6857949">Fatal</span><span class="op" id="6857954">(</span><span class="ident" id="6857955">err</span><span class="op" id="6857958">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6857961">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6857964">if</span>&nbsp;<span class="ident" id="6857967">te</span><span class="op" id="6857969">,</span>&nbsp;<span class="ident" id="6857971">ok</span>&nbsp;<span class="op" id="6857974">:=</span>&nbsp;<span class="ident" id="6857977">part</span><span class="op" id="6857981">.</span><span class="ident" id="6857982">Header</span><span class="op" id="6857988">[</span><span class="string" id="6857989">&#34;Content-Transfer-Encoding&#34;</span><span class="op" id="6858016">]</span><span class="op" id="6858017">;</span>&nbsp;<span class="ident" id="6858019">ok</span>&nbsp;<span class="op" id="6858022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858026">t</span><span class="op" id="6858027">.</span><span class="ident" id="6858028">Errorf</span><span class="op" id="6858034">(</span><span class="string" id="6858035">&#34;unexpected&nbsp;Content-Transfer-Encoding&nbsp;of&nbsp;%q&#34;</span><span class="op" id="6858079">,</span>&nbsp;<span class="ident" id="6858081">te</span><span class="op" id="6858083">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6858086">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6858089">var</span>&nbsp;<span class="ident" id="6858093">buf</span>&nbsp;<span class="ident" id="6858097">bytes</span><span class="op" id="6858102">.</span><span class="ident" id="6858103">Buffer</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858111">_</span><span class="op" id="6858112">,</span>&nbsp;<span class="ident" id="6858114">err</span>&nbsp;<span class="op" id="6858118">=</span>&nbsp;<span class="ident" id="6858120">io</span><span class="op" id="6858122">.</span><span class="ident" id="6858123">Copy</span><span class="op" id="6858127">(</span><span class="op" id="6858128">&amp;</span><span class="ident" id="6858129">buf</span><span class="op" id="6858132">,</span>&nbsp;<span class="ident" id="6858134">part</span><span class="op" id="6858138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6858141">if</span>&nbsp;<span class="ident" id="6858144">err</span>&nbsp;<span class="op" id="6858148">!=</span>&nbsp;<span class="builtintype" id="6858151">nil</span>&nbsp;<span class="op" id="6858155">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858159">t</span><span class="op" id="6858160">.</span><span class="ident" id="6858161">Error</span><span class="op" id="6858166">(</span><span class="ident" id="6858167">err</span><span class="op" id="6858170">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6858173">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858176">got</span>&nbsp;<span class="op" id="6858180">:=</span>&nbsp;<span class="ident" id="6858183">buf</span><span class="op" id="6858186">.</span><span class="ident" id="6858187">String</span><span class="op" id="6858193">(</span><span class="op" id="6858194">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858197">want</span>&nbsp;<span class="op" id="6858202">:=</span>&nbsp;<span class="string" id="6858205">&#34;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&nbsp;words&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6858562">if</span>&nbsp;<span class="ident" id="6858565">got</span>&nbsp;<span class="op" id="6858569">!=</span>&nbsp;<span class="ident" id="6858572">want</span>&nbsp;<span class="op" id="6858577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858581">t</span><span class="op" id="6858582">.</span><span class="ident" id="6858583">Errorf</span><span class="op" id="6858589">(</span><span class="string" id="6858590">&#34;wrong&nbsp;part&nbsp;value:\n&nbsp;got:&nbsp;%q\nwant:&nbsp;%q&#34;</span><span class="op" id="6858629">,</span>&nbsp;<span class="ident" id="6858631">got</span><span class="op" id="6858634">,</span>&nbsp;<span class="ident" id="6858636">want</span><span class="op" id="6858640">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6858643">}</span><br>
<span class="lineno"></span><span class="op" id="6858645">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="6858648">//&nbsp;Test&nbsp;parsing&nbsp;an&nbsp;image&nbsp;attachment&nbsp;from&nbsp;gmail,&nbsp;which&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span><span class="keyword" id="6858721">func</span>&nbsp;<span class="ident" id="6858726">TestNested</span><span class="op" id="6858736">(</span><span class="ident" id="6858737">t</span>&nbsp;<span class="op" id="6858739">*</span><span class="ident" id="6858740">testing</span><span class="op" id="6858747">.</span><span class="ident" id="6858748">T</span><span class="op" id="6858749">)</span>&nbsp;<span class="op" id="6858751">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6858754">//&nbsp;nested-mime&nbsp;is&nbsp;the&nbsp;body&nbsp;part&nbsp;of&nbsp;a&nbsp;multipart/mixed&nbsp;email</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6858814">//&nbsp;with&nbsp;boundary&nbsp;e89a8ff1c1e83553e304be640612</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858861">f</span><span class="op" id="6858862">,</span>&nbsp;<span class="ident" id="6858864">err</span>&nbsp;<span class="op" id="6858868">:=</span>&nbsp;<span class="ident" id="6858871">os</span><span class="op" id="6858873">.</span><span class="ident" id="6858874">Open</span><span class="op" id="6858878">(</span><span class="string" id="6858879">&#34;testdata/nested-mime&#34;</span><span class="op" id="6858901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6858904">if</span>&nbsp;<span class="ident" id="6858907">err</span>&nbsp;<span class="op" id="6858911">!=</span>&nbsp;<span class="builtintype" id="6858914">nil</span>&nbsp;<span class="op" id="6858918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858922">t</span><span class="op" id="6858923">.</span><span class="ident" id="6858924">Fatal</span><span class="op" id="6858929">(</span><span class="ident" id="6858930">err</span><span class="op" id="6858933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6858936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6858939">defer</span>&nbsp;<span class="ident" id="6858945">f</span><span class="op" id="6858946">.</span><span class="ident" id="6858947">Close</span><span class="op" id="6858952">(</span><span class="op" id="6858953">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6858956">mr</span>&nbsp;<span class="op" id="6858959">:=</span>&nbsp;<span class="ident" id="6858962">NewReader</span><span class="op" id="6858971">(</span><span class="ident" id="6858972">f</span><span class="op" id="6858973">,</span>&nbsp;<span class="string" id="6858975">&#34;e89a8ff1c1e83553e304be640612&#34;</span><span class="op" id="6859005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859008">p</span><span class="op" id="6859009">,</span>&nbsp;<span class="ident" id="6859011">err</span>&nbsp;<span class="op" id="6859015">:=</span>&nbsp;<span class="ident" id="6859018">mr</span><span class="op" id="6859020">.</span><span class="ident" id="6859021">NextPart</span><span class="op" id="6859029">(</span><span class="op" id="6859030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859033">if</span>&nbsp;<span class="ident" id="6859036">err</span>&nbsp;<span class="op" id="6859040">!=</span>&nbsp;<span class="builtintype" id="6859043">nil</span>&nbsp;<span class="op" id="6859047">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859051">t</span><span class="op" id="6859052">.</span><span class="ident" id="6859053">Fatalf</span><span class="op" id="6859059">(</span><span class="string" id="6859060">&#34;error&nbsp;reading&nbsp;first&nbsp;section&nbsp;(alternative):&nbsp;%v&#34;</span><span class="op" id="6859107">,</span>&nbsp;<span class="ident" id="6859109">err</span><span class="op" id="6859112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859115">}</span><br>
<span class="lineno">390</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6859119">//&nbsp;Read&nbsp;the&nbsp;inner&nbsp;text/plain&nbsp;and&nbsp;text/html&nbsp;sections&nbsp;of&nbsp;the&nbsp;multipart/alternative.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859202">mr2</span>&nbsp;<span class="op" id="6859206">:=</span>&nbsp;<span class="ident" id="6859209">NewReader</span><span class="op" id="6859218">(</span><span class="ident" id="6859219">p</span><span class="op" id="6859220">,</span>&nbsp;<span class="string" id="6859222">&#34;e89a8ff1c1e83553e004be640610&#34;</span><span class="op" id="6859252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859255">p</span><span class="op" id="6859256">,</span>&nbsp;<span class="ident" id="6859258">err</span>&nbsp;<span class="op" id="6859262">=</span>&nbsp;<span class="ident" id="6859264">mr2</span><span class="op" id="6859267">.</span><span class="ident" id="6859268">NextPart</span><span class="op" id="6859276">(</span><span class="op" id="6859277">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859280">if</span>&nbsp;<span class="ident" id="6859283">err</span>&nbsp;<span class="op" id="6859287">!=</span>&nbsp;<span class="builtintype" id="6859290">nil</span>&nbsp;<span class="op" id="6859294">{</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859298">t</span><span class="op" id="6859299">.</span><span class="ident" id="6859300">Fatalf</span><span class="op" id="6859306">(</span><span class="string" id="6859307">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6859336">,</span>&nbsp;<span class="ident" id="6859338">err</span><span class="op" id="6859341">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859344">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859347">if</span>&nbsp;<span class="ident" id="6859350">b</span><span class="op" id="6859351">,</span>&nbsp;<span class="ident" id="6859353">err</span>&nbsp;<span class="op" id="6859357">:=</span>&nbsp;<span class="ident" id="6859360">ioutil</span><span class="op" id="6859366">.</span><span class="ident" id="6859367">ReadAll</span><span class="op" id="6859374">(</span><span class="ident" id="6859375">p</span><span class="op" id="6859376">)</span><span class="op" id="6859377">;</span>&nbsp;<span class="builtintype" id="6859379">string</span><span class="op" id="6859385">(</span><span class="ident" id="6859386">b</span><span class="op" id="6859387">)</span>&nbsp;<span class="op" id="6859389">!=</span>&nbsp;<span class="string" id="6859392">&#34;*body*\r\n&#34;</span>&nbsp;<span class="op" id="6859405">||</span>&nbsp;<span class="ident" id="6859408">err</span>&nbsp;<span class="op" id="6859412">!=</span>&nbsp;<span class="builtintype" id="6859415">nil</span>&nbsp;<span class="op" id="6859419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859423">t</span><span class="op" id="6859424">.</span><span class="ident" id="6859425">Fatalf</span><span class="op" id="6859431">(</span><span class="string" id="6859432">&#34;reading&nbsp;text/plain&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6859469">,</span>&nbsp;<span class="ident" id="6859471">b</span><span class="op" id="6859472">,</span>&nbsp;<span class="ident" id="6859474">err</span><span class="op" id="6859477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859480">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859483">p</span><span class="op" id="6859484">,</span>&nbsp;<span class="ident" id="6859486">err</span>&nbsp;<span class="op" id="6859490">=</span>&nbsp;<span class="ident" id="6859492">mr2</span><span class="op" id="6859495">.</span><span class="ident" id="6859496">NextPart</span><span class="op" id="6859504">(</span><span class="op" id="6859505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859508">if</span>&nbsp;<span class="ident" id="6859511">err</span>&nbsp;<span class="op" id="6859515">!=</span>&nbsp;<span class="builtintype" id="6859518">nil</span>&nbsp;<span class="op" id="6859522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859526">t</span><span class="op" id="6859527">.</span><span class="ident" id="6859528">Fatalf</span><span class="op" id="6859534">(</span><span class="string" id="6859535">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6859563">,</span>&nbsp;<span class="ident" id="6859565">err</span><span class="op" id="6859568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859571">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859574">if</span>&nbsp;<span class="ident" id="6859577">b</span><span class="op" id="6859578">,</span>&nbsp;<span class="ident" id="6859580">err</span>&nbsp;<span class="op" id="6859584">:=</span>&nbsp;<span class="ident" id="6859587">ioutil</span><span class="op" id="6859593">.</span><span class="ident" id="6859594">ReadAll</span><span class="op" id="6859601">(</span><span class="ident" id="6859602">p</span><span class="op" id="6859603">)</span><span class="op" id="6859604">;</span>&nbsp;<span class="builtintype" id="6859606">string</span><span class="op" id="6859612">(</span><span class="ident" id="6859613">b</span><span class="op" id="6859614">)</span>&nbsp;<span class="op" id="6859616">!=</span>&nbsp;<span class="string" id="6859619">&#34;&lt;b&gt;body&lt;/b&gt;\r\n&#34;</span>&nbsp;<span class="op" id="6859637">||</span>&nbsp;<span class="ident" id="6859640">err</span>&nbsp;<span class="op" id="6859644">!=</span>&nbsp;<span class="builtintype" id="6859647">nil</span>&nbsp;<span class="op" id="6859651">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859655">t</span><span class="op" id="6859656">.</span><span class="ident" id="6859657">Fatalf</span><span class="op" id="6859663">(</span><span class="string" id="6859664">&#34;reading&nbsp;text/html&nbsp;part:&nbsp;got&nbsp;%q,&nbsp;%v&#34;</span><span class="op" id="6859700">,</span>&nbsp;<span class="ident" id="6859702">b</span><span class="op" id="6859703">,</span>&nbsp;<span class="ident" id="6859705">err</span><span class="op" id="6859708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859711">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859715">p</span><span class="op" id="6859716">,</span>&nbsp;<span class="ident" id="6859718">err</span>&nbsp;<span class="op" id="6859722">=</span>&nbsp;<span class="ident" id="6859724">mr2</span><span class="op" id="6859727">.</span><span class="ident" id="6859728">NextPart</span><span class="op" id="6859736">(</span><span class="op" id="6859737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859740">if</span>&nbsp;<span class="ident" id="6859743">err</span>&nbsp;<span class="op" id="6859747">!=</span>&nbsp;<span class="ident" id="6859750">io</span><span class="op" id="6859752">.</span><span class="ident" id="6859753">EOF</span>&nbsp;<span class="op" id="6859757">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859761">t</span><span class="op" id="6859762">.</span><span class="ident" id="6859763">Fatalf</span><span class="op" id="6859769">(</span><span class="string" id="6859770">&#34;final&nbsp;inner&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6859810">,</span>&nbsp;<span class="ident" id="6859812">err</span><span class="op" id="6859815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6859818">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6859822">//&nbsp;Back&nbsp;to&nbsp;the&nbsp;outer&nbsp;multipart/mixed,&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859891">_</span><span class="op" id="6859892">,</span>&nbsp;<span class="ident" id="6859894">err</span>&nbsp;<span class="op" id="6859898">=</span>&nbsp;<span class="ident" id="6859900">mr</span><span class="op" id="6859902">.</span><span class="ident" id="6859903">NextPart</span><span class="op" id="6859911">(</span><span class="op" id="6859912">)</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6859915">if</span>&nbsp;<span class="ident" id="6859918">err</span>&nbsp;<span class="op" id="6859922">!=</span>&nbsp;<span class="builtintype" id="6859925">nil</span>&nbsp;<span class="op" id="6859929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6859933">t</span><span class="op" id="6859934">.</span><span class="ident" id="6859935">Fatalf</span><span class="op" id="6859941">(</span><span class="string" id="6859942">&#34;error&nbsp;reading&nbsp;the&nbsp;image&nbsp;attachment&nbsp;at&nbsp;the&nbsp;end:&nbsp;%v&#34;</span><span class="op" id="6859993">,</span>&nbsp;<span class="ident" id="6859995">err</span><span class="op" id="6859998">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860001">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860005">_</span><span class="op" id="6860006">,</span>&nbsp;<span class="ident" id="6860008">err</span>&nbsp;<span class="op" id="6860012">=</span>&nbsp;<span class="ident" id="6860014">mr</span><span class="op" id="6860016">.</span><span class="ident" id="6860017">NextPart</span><span class="op" id="6860025">(</span><span class="op" id="6860026">)</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6860029">if</span>&nbsp;<span class="ident" id="6860032">err</span>&nbsp;<span class="op" id="6860036">!=</span>&nbsp;<span class="ident" id="6860039">io</span><span class="op" id="6860041">.</span><span class="ident" id="6860042">EOF</span>&nbsp;<span class="op" id="6860046">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860050">t</span><span class="op" id="6860051">.</span><span class="ident" id="6860052">Fatalf</span><span class="op" id="6860058">(</span><span class="string" id="6860059">&#34;final&nbsp;outer&nbsp;NextPart&nbsp;=&nbsp;%v;&nbsp;want&nbsp;io.EOF&#34;</span><span class="op" id="6860099">,</span>&nbsp;<span class="ident" id="6860101">err</span><span class="op" id="6860104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860107">}</span><br>
<span class="lineno"></span><span class="op" id="6860109">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span><span class="keyword" id="6860112">type</span>&nbsp;<span class="ident" id="6860117">headerBody</span>&nbsp;<span class="keyword" id="6860128">struct</span>&nbsp;<span class="op" id="6860135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860138">header</span>&nbsp;<span class="ident" id="6860145">textproto</span><span class="op" id="6860154">.</span><span class="ident" id="6860155">MIMEHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860167">body</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6860174">string</span><br>
<span class="lineno"></span><span class="op" id="6860181">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="6860184">func</span>&nbsp;<span class="ident" id="6860189">formData</span><span class="op" id="6860197">(</span><span class="ident" id="6860198">key</span><span class="op" id="6860201">,</span>&nbsp;<span class="ident" id="6860203">value</span>&nbsp;<span class="builtintype" id="6860209">string</span><span class="op" id="6860215">)</span>&nbsp;<span class="ident" id="6860217">headerBody</span>&nbsp;<span class="op" id="6860228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6860231">return</span>&nbsp;<span class="ident" id="6860238">headerBody</span><span class="op" id="6860248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860252">textproto</span><span class="op" id="6860261">.</span><span class="ident" id="6860262">MIMEHeader</span><span class="op" id="6860272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6860277">&#34;Content-Type&#34;</span><span class="op" id="6860291">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860300">{</span><span class="string" id="6860301">&#34;text/plain;&nbsp;charset=ISO-8859-1&#34;</span><span class="op" id="6860333">}</span><span class="op" id="6860334">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6860339">&#34;Content-Disposition&#34;</span><span class="op" id="6860360">:</span>&nbsp;<span class="op" id="6860362">{</span><span class="string" id="6860363">&#34;form-data;&nbsp;name=&#34;</span>&nbsp;<span class="op" id="6860382">+</span>&nbsp;<span class="ident" id="6860384">key</span><span class="op" id="6860387">}</span><span class="op" id="6860388">,</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860392">}</span><span class="op" id="6860393">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860397">value</span><span class="op" id="6860402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860405">}</span><br>
<span class="lineno"></span><span class="op" id="6860407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">440</span><span class="keyword" id="6860410">type</span>&nbsp;<span class="ident" id="6860415">parseTest</span>&nbsp;<span class="keyword" id="6860425">struct</span>&nbsp;<span class="op" id="6860432">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860435">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6860443">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860451">in</span><span class="op" id="6860453">,</span>&nbsp;<span class="ident" id="6860455">sep</span>&nbsp;<span class="builtintype" id="6860459">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860467">want</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860475">[</span><span class="op" id="6860476">]</span><span class="ident" id="6860477">headerBody</span><br>
<span class="lineno"></span><span class="op" id="6860488">}</span><br>
<span class="lineno">445</span><br>
<span class="lineno"></span><span class="keyword" id="6860491">var</span>&nbsp;<span class="ident" id="6860495">parseTests</span>&nbsp;<span class="op" id="6860506">=</span>&nbsp;<span class="op" id="6860508">[</span><span class="op" id="6860509">]</span><span class="ident" id="6860510">parseTest</span><span class="op" id="6860519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860522">//&nbsp;Actual&nbsp;body&nbsp;from&nbsp;App&nbsp;Engine&nbsp;on&nbsp;a&nbsp;blob&nbsp;upload.&nbsp;The&nbsp;final&nbsp;part&nbsp;(the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860592">//&nbsp;Content-Type:&nbsp;message/external-body)&nbsp;is&nbsp;what&nbsp;App&nbsp;Engine&nbsp;replaces</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860661">//&nbsp;the&nbsp;uploaded&nbsp;file&nbsp;with.&nbsp;&nbsp;The&nbsp;other&nbsp;form&nbsp;fields&nbsp;(prefixed&nbsp;with</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860727">//&nbsp;&#34;other&#34;&nbsp;in&nbsp;their&nbsp;form-data&nbsp;name)&nbsp;are&nbsp;unchanged.&nbsp;&nbsp;A&nbsp;bug&nbsp;was</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860790">//&nbsp;reported&nbsp;with&nbsp;blob&nbsp;uploads&nbsp;failing&nbsp;when&nbsp;the&nbsp;other&nbsp;fields&nbsp;were</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6860856">//&nbsp;empty.&nbsp;This&nbsp;was&nbsp;the&nbsp;MIME&nbsp;POST&nbsp;body&nbsp;that&nbsp;previously&nbsp;failed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6860919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860923">name</span><span class="op" id="6860927">:</span>&nbsp;<span class="string" id="6860929">&#34;App&nbsp;Engine&nbsp;post&#34;</span><span class="op" id="6860946">,</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860950">sep</span><span class="op" id="6860953">:</span>&nbsp;&nbsp;<span class="string" id="6860956">&#34;00151757727e9583fd04bfbca4c6&#34;</span><span class="op" id="6860986">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6860990">in</span><span class="op" id="6860992">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6860996">&#34;--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty1\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo1\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherFoo2\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherEmpty2\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatFoo\r\n\r\nfoo\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=otherRepeatEmpty\r\n\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;text/plain;&nbsp;charset=ISO-8859-1\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=submit\r\n\r\nSubmit\r\n--00151757727e9583fd04bfbca4c6\r\nContent-Type:&nbsp;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\nContent-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n\r\n--00151757727e9583fd04bfbca4c6--&#34;</span><span class="op" id="6862904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6862908">want</span><span class="op" id="6862912">:</span>&nbsp;<span class="op" id="6862914">[</span><span class="op" id="6862915">]</span><span class="ident" id="6862916">headerBody</span><span class="op" id="6862926">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6862931">formData</span><span class="op" id="6862939">(</span><span class="string" id="6862940">&#34;otherEmpty1&#34;</span><span class="op" id="6862953">,</span>&nbsp;<span class="string" id="6862955">&#34;&#34;</span><span class="op" id="6862957">)</span><span class="op" id="6862958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6862963">formData</span><span class="op" id="6862971">(</span><span class="string" id="6862972">&#34;otherFoo1&#34;</span><span class="op" id="6862983">,</span>&nbsp;<span class="string" id="6862985">&#34;foo&#34;</span><span class="op" id="6862990">)</span><span class="op" id="6862991">,</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6862996">formData</span><span class="op" id="6863004">(</span><span class="string" id="6863005">&#34;otherFoo2&#34;</span><span class="op" id="6863016">,</span>&nbsp;<span class="string" id="6863018">&#34;foo&#34;</span><span class="op" id="6863023">)</span><span class="op" id="6863024">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863029">formData</span><span class="op" id="6863037">(</span><span class="string" id="6863038">&#34;otherEmpty2&#34;</span><span class="op" id="6863051">,</span>&nbsp;<span class="string" id="6863053">&#34;&#34;</span><span class="op" id="6863055">)</span><span class="op" id="6863056">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863061">formData</span><span class="op" id="6863069">(</span><span class="string" id="6863070">&#34;otherRepeatFoo&#34;</span><span class="op" id="6863086">,</span>&nbsp;<span class="string" id="6863088">&#34;foo&#34;</span><span class="op" id="6863093">)</span><span class="op" id="6863094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863099">formData</span><span class="op" id="6863107">(</span><span class="string" id="6863108">&#34;otherRepeatFoo&#34;</span><span class="op" id="6863124">,</span>&nbsp;<span class="string" id="6863126">&#34;foo&#34;</span><span class="op" id="6863131">)</span><span class="op" id="6863132">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863137">formData</span><span class="op" id="6863145">(</span><span class="string" id="6863146">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6863164">,</span>&nbsp;<span class="string" id="6863166">&#34;&#34;</span><span class="op" id="6863168">)</span><span class="op" id="6863169">,</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863174">formData</span><span class="op" id="6863182">(</span><span class="string" id="6863183">&#34;otherRepeatEmpty&#34;</span><span class="op" id="6863201">,</span>&nbsp;<span class="string" id="6863203">&#34;&#34;</span><span class="op" id="6863205">)</span><span class="op" id="6863206">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863211">formData</span><span class="op" id="6863219">(</span><span class="string" id="6863220">&#34;submit&#34;</span><span class="op" id="6863228">,</span>&nbsp;<span class="string" id="6863230">&#34;Submit&#34;</span><span class="op" id="6863238">)</span><span class="op" id="6863239">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863244">{</span><span class="ident" id="6863245">textproto</span><span class="op" id="6863254">.</span><span class="ident" id="6863255">MIMEHeader</span><span class="op" id="6863265">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6863271">&#34;Content-Type&#34;</span><span class="op" id="6863285">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863294">{</span><span class="string" id="6863295">&#34;message/external-body;&nbsp;charset=ISO-8859-1;&nbsp;blob-key=AHAZQqG84qllx7HUqO_oou5EvdYQNS3Mbbkb0RjjBoM_Kc1UqEN2ygDxWiyCPulIhpHRPx-VbpB6RX4MrsqhWAi_ZxJ48O9P2cTIACbvATHvg7IgbvZytyGMpL7xO1tlIvgwcM47JNfv_tGhy1XwyEUO8oldjPqg5Q&#34;</span><span class="op" id="6863511">}</span><span class="op" id="6863512">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6863518">&#34;Content-Disposition&#34;</span><span class="op" id="6863539">:</span>&nbsp;<span class="op" id="6863541">{</span><span class="string" id="6863542">&#34;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;&#34;</span><span class="op" id="6863587">}</span><span class="op" id="6863588">,</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863593">}</span><span class="op" id="6863594">,</span>&nbsp;<span class="string" id="6863596">&#34;Content-Type:&nbsp;image/png\r\nContent-Length:&nbsp;232303\r\nX-AppEngine-Upload-Creation:&nbsp;2012-05-10&nbsp;23:14:02.715173\r\nContent-MD5:&nbsp;MzRjODU1ZDZhZGU1NmRlOWEwZmMwMDdlODBmZTA0NzA=\r\nContent-Disposition:&nbsp;form-data;&nbsp;name=file;&nbsp;filename=\&#34;fall.png\&#34;\r\n\r\n&#34;</span><span class="op" id="6863843">}</span><span class="op" id="6863844">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863848">}</span><span class="op" id="6863849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863852">}</span><span class="op" id="6863853">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6863857">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6863929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863933">name</span><span class="op" id="6863937">:</span>&nbsp;<span class="string" id="6863939">&#34;single&nbsp;empty&nbsp;part,&nbsp;--boundary&#34;</span><span class="op" id="6863970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863974">sep</span><span class="op" id="6863977">:</span>&nbsp;&nbsp;<span class="string" id="6863980">&#34;abc&#34;</span><span class="op" id="6863985">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6863989">in</span><span class="op" id="6863991">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6863995">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&#34;</span><span class="op" id="6864029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864033">want</span><span class="op" id="6864037">:</span>&nbsp;<span class="op" id="6864039">[</span><span class="op" id="6864040">]</span><span class="ident" id="6864041">headerBody</span><span class="op" id="6864051">{</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864056">{</span><span class="ident" id="6864057">textproto</span><span class="op" id="6864066">.</span><span class="ident" id="6864067">MIMEHeader</span><span class="op" id="6864077">{</span><span class="string" id="6864078">&#34;Foo&#34;</span><span class="op" id="6864083">:</span>&nbsp;<span class="op" id="6864085">{</span><span class="string" id="6864086">&#34;bar&#34;</span><span class="op" id="6864091">}</span><span class="op" id="6864092">}</span><span class="op" id="6864093">,</span>&nbsp;<span class="string" id="6864095">&#34;&#34;</span><span class="op" id="6864097">}</span><span class="op" id="6864098">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864102">}</span><span class="op" id="6864103">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864106">}</span><span class="op" id="6864107">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864111">//&nbsp;Single&nbsp;empty&nbsp;part,&nbsp;ended&nbsp;with&nbsp;\r\n--boundary&nbsp;immediately&nbsp;after&nbsp;headers.</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864187">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864191">name</span><span class="op" id="6864195">:</span>&nbsp;<span class="string" id="6864197">&#34;single&nbsp;empty&nbsp;part,&nbsp;\r\n--boundary&#34;</span><span class="op" id="6864232">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864236">sep</span><span class="op" id="6864239">:</span>&nbsp;&nbsp;<span class="string" id="6864242">&#34;abc&#34;</span><span class="op" id="6864247">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864251">in</span><span class="op" id="6864253">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6864257">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n\r\n--abc--&#34;</span><span class="op" id="6864295">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864299">want</span><span class="op" id="6864303">:</span>&nbsp;<span class="op" id="6864305">[</span><span class="op" id="6864306">]</span><span class="ident" id="6864307">headerBody</span><span class="op" id="6864317">{</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864322">{</span><span class="ident" id="6864323">textproto</span><span class="op" id="6864332">.</span><span class="ident" id="6864333">MIMEHeader</span><span class="op" id="6864343">{</span><span class="string" id="6864344">&#34;Foo&#34;</span><span class="op" id="6864349">:</span>&nbsp;<span class="op" id="6864351">{</span><span class="string" id="6864352">&#34;bar&#34;</span><span class="op" id="6864357">}</span><span class="op" id="6864358">}</span><span class="op" id="6864359">,</span>&nbsp;<span class="string" id="6864361">&#34;&#34;</span><span class="op" id="6864363">}</span><span class="op" id="6864364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864368">}</span><span class="op" id="6864369">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864372">}</span><span class="op" id="6864373">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864377">//&nbsp;Final&nbsp;part&nbsp;empty.</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864403">name</span><span class="op" id="6864407">:</span>&nbsp;<span class="string" id="6864409">&#34;final&nbsp;part&nbsp;empty&#34;</span><span class="op" id="6864427">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864431">sep</span><span class="op" id="6864434">:</span>&nbsp;&nbsp;<span class="string" id="6864437">&#34;abc&#34;</span><span class="op" id="6864442">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864446">in</span><span class="op" id="6864448">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6864452">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc\r\nFoo2:&nbsp;bar2\r\n\r\n--abc--&#34;</span><span class="op" id="6864513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864517">want</span><span class="op" id="6864521">:</span>&nbsp;<span class="op" id="6864523">[</span><span class="op" id="6864524">]</span><span class="ident" id="6864525">headerBody</span><span class="op" id="6864535">{</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864540">{</span><span class="ident" id="6864541">textproto</span><span class="op" id="6864550">.</span><span class="ident" id="6864551">MIMEHeader</span><span class="op" id="6864561">{</span><span class="string" id="6864562">&#34;Foo&#34;</span><span class="op" id="6864567">:</span>&nbsp;<span class="op" id="6864569">{</span><span class="string" id="6864570">&#34;bar&#34;</span><span class="op" id="6864575">}</span><span class="op" id="6864576">}</span><span class="op" id="6864577">,</span>&nbsp;<span class="string" id="6864579">&#34;&#34;</span><span class="op" id="6864581">}</span><span class="op" id="6864582">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864587">{</span><span class="ident" id="6864588">textproto</span><span class="op" id="6864597">.</span><span class="ident" id="6864598">MIMEHeader</span><span class="op" id="6864608">{</span><span class="string" id="6864609">&#34;Foo2&#34;</span><span class="op" id="6864615">:</span>&nbsp;<span class="op" id="6864617">{</span><span class="string" id="6864618">&#34;bar2&#34;</span><span class="op" id="6864624">}</span><span class="op" id="6864625">}</span><span class="op" id="6864626">,</span>&nbsp;<span class="string" id="6864628">&#34;&#34;</span><span class="op" id="6864630">}</span><span class="op" id="6864631">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864635">}</span><span class="op" id="6864636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864639">}</span><span class="op" id="6864640">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864644">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;newlines&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864706">name</span><span class="op" id="6864710">:</span>&nbsp;<span class="string" id="6864712">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;crlf&#34;</span><span class="op" id="6864740">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864744">sep</span><span class="op" id="6864747">:</span>&nbsp;&nbsp;<span class="string" id="6864750">&#34;abc&#34;</span><span class="op" id="6864755">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864759">in</span><span class="op" id="6864761">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6864765">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--\r\n&#34;</span><span class="op" id="6864803">,</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864807">want</span><span class="op" id="6864811">:</span>&nbsp;<span class="op" id="6864813">[</span><span class="op" id="6864814">]</span><span class="ident" id="6864815">headerBody</span><span class="op" id="6864825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864830">{</span><span class="ident" id="6864831">textproto</span><span class="op" id="6864840">.</span><span class="ident" id="6864841">MIMEHeader</span><span class="op" id="6864851">{</span><span class="string" id="6864852">&#34;Foo&#34;</span><span class="op" id="6864857">:</span>&nbsp;<span class="op" id="6864859">{</span><span class="string" id="6864860">&#34;bar&#34;</span><span class="op" id="6864865">}</span><span class="op" id="6864866">}</span><span class="op" id="6864867">,</span>&nbsp;<span class="string" id="6864869">&#34;&#34;</span><span class="op" id="6864871">}</span><span class="op" id="6864872">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864876">}</span><span class="op" id="6864877">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864880">}</span><span class="op" id="6864881">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6864885">//&nbsp;Final&nbsp;part&nbsp;empty&nbsp;with&nbsp;lwsp-chars&nbsp;after&nbsp;final&nbsp;separator.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6864945">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864949">name</span><span class="op" id="6864953">:</span>&nbsp;<span class="string" id="6864955">&#34;final&nbsp;part&nbsp;empty&nbsp;then&nbsp;lwsp&#34;</span><span class="op" id="6864983">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6864987">sep</span><span class="op" id="6864990">:</span>&nbsp;&nbsp;<span class="string" id="6864993">&#34;abc&#34;</span><span class="op" id="6864998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865002">in</span><span class="op" id="6865004">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6865008">&#34;--abc\r\nFoo:&nbsp;bar\r\n\r\n--abc--&nbsp;\t&#34;</span><span class="op" id="6865045">,</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865049">want</span><span class="op" id="6865053">:</span>&nbsp;<span class="op" id="6865055">[</span><span class="op" id="6865056">]</span><span class="ident" id="6865057">headerBody</span><span class="op" id="6865067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865072">{</span><span class="ident" id="6865073">textproto</span><span class="op" id="6865082">.</span><span class="ident" id="6865083">MIMEHeader</span><span class="op" id="6865093">{</span><span class="string" id="6865094">&#34;Foo&#34;</span><span class="op" id="6865099">:</span>&nbsp;<span class="op" id="6865101">{</span><span class="string" id="6865102">&#34;bar&#34;</span><span class="op" id="6865107">}</span><span class="op" id="6865108">}</span><span class="op" id="6865109">,</span>&nbsp;<span class="string" id="6865111">&#34;&#34;</span><span class="op" id="6865113">}</span><span class="op" id="6865114">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865118">}</span><span class="op" id="6865119">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865122">}</span><span class="op" id="6865123">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865127">//&nbsp;No&nbsp;parts&nbsp;(empty&nbsp;form&nbsp;as&nbsp;submitted&nbsp;by&nbsp;Chrome)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865176">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865180">name</span><span class="op" id="6865184">:</span>&nbsp;<span class="string" id="6865186">&#34;no&nbsp;parts&#34;</span><span class="op" id="6865196">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865200">sep</span><span class="op" id="6865203">:</span>&nbsp;&nbsp;<span class="string" id="6865206">&#34;----WebKitFormBoundaryQfEAfzFOiSemeHfA&#34;</span><span class="op" id="6865246">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865250">in</span><span class="op" id="6865252">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6865256">&#34;------WebKitFormBoundaryQfEAfzFOiSemeHfA--\r\n&#34;</span><span class="op" id="6865304">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865308">want</span><span class="op" id="6865312">:</span>&nbsp;<span class="op" id="6865314">[</span><span class="op" id="6865315">]</span><span class="ident" id="6865316">headerBody</span><span class="op" id="6865326">{</span><span class="op" id="6865327">}</span><span class="op" id="6865328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865331">}</span><span class="op" id="6865332">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865336">//&nbsp;Part&nbsp;containing&nbsp;data&nbsp;starting&nbsp;with&nbsp;the&nbsp;boundary,&nbsp;but&nbsp;with&nbsp;additional&nbsp;suffix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865417">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865421">name</span><span class="op" id="6865425">:</span>&nbsp;<span class="string" id="6865427">&#34;fake&nbsp;separator&nbsp;as&nbsp;data&#34;</span><span class="op" id="6865451">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865455">sep</span><span class="op" id="6865458">:</span>&nbsp;&nbsp;<span class="string" id="6865461">&#34;sep&#34;</span><span class="op" id="6865466">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865470">in</span><span class="op" id="6865472">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6865476">&#34;--sep\r\nFoo:&nbsp;bar\r\n\r\n--sepFAKE\r\n--sep--&#34;</span><span class="op" id="6865523">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865527">want</span><span class="op" id="6865531">:</span>&nbsp;<span class="op" id="6865533">[</span><span class="op" id="6865534">]</span><span class="ident" id="6865535">headerBody</span><span class="op" id="6865545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865550">{</span><span class="ident" id="6865551">textproto</span><span class="op" id="6865560">.</span><span class="ident" id="6865561">MIMEHeader</span><span class="op" id="6865571">{</span><span class="string" id="6865572">&#34;Foo&#34;</span><span class="op" id="6865577">:</span>&nbsp;<span class="op" id="6865579">{</span><span class="string" id="6865580">&#34;bar&#34;</span><span class="op" id="6865585">}</span><span class="op" id="6865586">}</span><span class="op" id="6865587">,</span>&nbsp;<span class="string" id="6865589">&#34;--sepFAKE&#34;</span><span class="op" id="6865600">}</span><span class="op" id="6865601">,</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865605">}</span><span class="op" id="6865606">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865609">}</span><span class="op" id="6865610">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865614">//&nbsp;Part&nbsp;containing&nbsp;a&nbsp;boundary&nbsp;with&nbsp;whitespace&nbsp;following&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865675">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865679">name</span><span class="op" id="6865683">:</span>&nbsp;<span class="string" id="6865685">&#34;boundary&nbsp;with&nbsp;whitespace&#34;</span><span class="op" id="6865711">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865715">sep</span><span class="op" id="6865718">:</span>&nbsp;&nbsp;<span class="string" id="6865721">&#34;sep&#34;</span><span class="op" id="6865726">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865730">in</span><span class="op" id="6865732">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="6865736">&#34;--sep&nbsp;\r\nFoo:&nbsp;bar\r\n\r\ntext\r\n--sep--&#34;</span><span class="op" id="6865779">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865783">want</span><span class="op" id="6865787">:</span>&nbsp;<span class="op" id="6865789">[</span><span class="op" id="6865790">]</span><span class="ident" id="6865791">headerBody</span><span class="op" id="6865801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865806">{</span><span class="ident" id="6865807">textproto</span><span class="op" id="6865816">.</span><span class="ident" id="6865817">MIMEHeader</span><span class="op" id="6865827">{</span><span class="string" id="6865828">&#34;Foo&#34;</span><span class="op" id="6865833">:</span>&nbsp;<span class="op" id="6865835">{</span><span class="string" id="6865836">&#34;bar&#34;</span><span class="op" id="6865841">}</span><span class="op" id="6865842">}</span><span class="op" id="6865843">,</span>&nbsp;<span class="string" id="6865845">&#34;text&#34;</span><span class="op" id="6865851">}</span><span class="op" id="6865852">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865856">}</span><span class="op" id="6865857">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865860">}</span><span class="op" id="6865861">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6865865">//&nbsp;With&nbsp;ignored&nbsp;leading&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6865896">{</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865900">name</span><span class="op" id="6865904">:</span>&nbsp;<span class="string" id="6865906">&#34;leading&nbsp;line&#34;</span><span class="op" id="6865920">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865924">sep</span><span class="op" id="6865927">:</span>&nbsp;&nbsp;<span class="string" id="6865930">&#34;MyBoundary&#34;</span><span class="op" id="6865942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6865946">in</span><span class="op" id="6865948">:</span>&nbsp;<span class="ident" id="6865950">strings</span><span class="op" id="6865957">.</span><span class="ident" id="6865958">Replace</span><span class="op" id="6865965">(</span><span class="string" id="6865966">`This&nbsp;is&nbsp;a&nbsp;multi-part&nbsp;message.&nbsp;&nbsp;This&nbsp;line&nbsp;is&nbsp;ignored.<br>
<span class="lineno"></span>--MyBoundary<br>
<span class="lineno"></span>foo:&nbsp;bar<br>
<span class="lineno">560</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>--MyBoundary--`</span><span class="op" id="6866059">,</span>&nbsp;<span class="string" id="6866061">&#34;\n&#34;</span><span class="op" id="6866065">,</span>&nbsp;<span class="string" id="6866067">&#34;\r\n&#34;</span><span class="op" id="6866073">,</span>&nbsp;<span class="op" id="6866075">-</span><span class="num" id="6866076">1</span><span class="op" id="6866077">)</span><span class="op" id="6866078">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866082">want</span><span class="op" id="6866086">:</span>&nbsp;<span class="op" id="6866088">[</span><span class="op" id="6866089">]</span><span class="ident" id="6866090">headerBody</span><span class="op" id="6866100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866105">{</span><span class="ident" id="6866106">textproto</span><span class="op" id="6866115">.</span><span class="ident" id="6866116">MIMEHeader</span><span class="op" id="6866126">{</span><span class="string" id="6866127">&#34;Foo&#34;</span><span class="op" id="6866132">:</span>&nbsp;<span class="op" id="6866134">{</span><span class="string" id="6866135">&#34;bar&#34;</span><span class="op" id="6866140">}</span><span class="op" id="6866141">}</span><span class="op" id="6866142">,</span>&nbsp;<span class="string" id="6866144">&#34;&#34;</span><span class="op" id="6866146">}</span><span class="op" id="6866147">,</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866151">}</span><span class="op" id="6866152">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866155">}</span><span class="op" id="6866156">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866160">roundTripParseTest</span><span class="op" id="6866178">(</span><span class="op" id="6866179">)</span><span class="op" id="6866180">,</span><br>
<span class="lineno"></span><span class="op" id="6866182">}</span><br>
<span class="lineno">570</span><br>
<span class="lineno"></span><span class="keyword" id="6866185">func</span>&nbsp;<span class="ident" id="6866190">TestParse</span><span class="op" id="6866199">(</span><span class="ident" id="6866200">t</span>&nbsp;<span class="op" id="6866202">*</span><span class="ident" id="6866203">testing</span><span class="op" id="6866210">.</span><span class="ident" id="6866211">T</span><span class="op" id="6866212">)</span>&nbsp;<span class="op" id="6866214">{</span><br>
<span class="lineno"></span><span class="ident" id="6866216">Cases</span><span class="op" id="6866221">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866224">for</span>&nbsp;<span class="ident" id="6866228">_</span><span class="op" id="6866229">,</span>&nbsp;<span class="ident" id="6866231">tt</span>&nbsp;<span class="op" id="6866234">:=</span>&nbsp;<span class="keyword" id="6866237">range</span>&nbsp;<span class="ident" id="6866243">parseTests</span>&nbsp;<span class="op" id="6866254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866258">r</span>&nbsp;<span class="op" id="6866260">:=</span>&nbsp;<span class="ident" id="6866263">NewReader</span><span class="op" id="6866272">(</span><span class="ident" id="6866273">strings</span><span class="op" id="6866280">.</span><span class="ident" id="6866281">NewReader</span><span class="op" id="6866290">(</span><span class="ident" id="6866291">tt</span><span class="op" id="6866293">.</span><span class="ident" id="6866294">in</span><span class="op" id="6866296">)</span><span class="op" id="6866297">,</span>&nbsp;<span class="ident" id="6866299">tt</span><span class="op" id="6866301">.</span><span class="ident" id="6866302">sep</span><span class="op" id="6866305">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866309">got</span>&nbsp;<span class="op" id="6866313">:=</span>&nbsp;<span class="op" id="6866316">[</span><span class="op" id="6866317">]</span><span class="ident" id="6866318">headerBody</span><span class="op" id="6866328">{</span><span class="op" id="6866329">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866333">for</span>&nbsp;<span class="op" id="6866337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866342">p</span><span class="op" id="6866343">,</span>&nbsp;<span class="ident" id="6866345">err</span>&nbsp;<span class="op" id="6866349">:=</span>&nbsp;<span class="ident" id="6866352">r</span><span class="op" id="6866353">.</span><span class="ident" id="6866354">NextPart</span><span class="op" id="6866362">(</span><span class="op" id="6866363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866368">if</span>&nbsp;<span class="ident" id="6866371">err</span>&nbsp;<span class="op" id="6866375">==</span>&nbsp;<span class="ident" id="6866378">io</span><span class="op" id="6866380">.</span><span class="ident" id="6866381">EOF</span>&nbsp;<span class="op" id="6866385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866391">break</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866400">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866405">if</span>&nbsp;<span class="ident" id="6866408">err</span>&nbsp;<span class="op" id="6866412">!=</span>&nbsp;<span class="builtintype" id="6866415">nil</span>&nbsp;<span class="op" id="6866419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866425">t</span><span class="op" id="6866426">.</span><span class="ident" id="6866427">Errorf</span><span class="op" id="6866433">(</span><span class="string" id="6866434">&#34;in&nbsp;test&nbsp;%q,&nbsp;NextPart:&nbsp;%v&#34;</span><span class="op" id="6866460">,</span>&nbsp;<span class="ident" id="6866462">tt</span><span class="op" id="6866464">.</span><span class="ident" id="6866465">name</span><span class="op" id="6866469">,</span>&nbsp;<span class="ident" id="6866471">err</span><span class="op" id="6866474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866480">continue</span>&nbsp;<span class="ident" id="6866489">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866498">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866503">pbody</span><span class="op" id="6866508">,</span>&nbsp;<span class="ident" id="6866510">err</span>&nbsp;<span class="op" id="6866514">:=</span>&nbsp;<span class="ident" id="6866517">ioutil</span><span class="op" id="6866523">.</span><span class="ident" id="6866524">ReadAll</span><span class="op" id="6866531">(</span><span class="ident" id="6866532">p</span><span class="op" id="6866533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866538">if</span>&nbsp;<span class="ident" id="6866541">err</span>&nbsp;<span class="op" id="6866545">!=</span>&nbsp;<span class="builtintype" id="6866548">nil</span>&nbsp;<span class="op" id="6866552">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866558">t</span><span class="op" id="6866559">.</span><span class="ident" id="6866560">Errorf</span><span class="op" id="6866566">(</span><span class="string" id="6866567">&#34;in&nbsp;test&nbsp;%q,&nbsp;error&nbsp;reading&nbsp;part:&nbsp;%v&#34;</span><span class="op" id="6866603">,</span>&nbsp;<span class="ident" id="6866605">tt</span><span class="op" id="6866607">.</span><span class="ident" id="6866608">name</span><span class="op" id="6866612">,</span>&nbsp;<span class="ident" id="6866614">err</span><span class="op" id="6866617">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866623">continue</span>&nbsp;<span class="ident" id="6866632">Cases</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866641">}</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866646">got</span>&nbsp;<span class="op" id="6866650">=</span>&nbsp;<span class="builtinfunc" id="6866652">append</span><span class="op" id="6866658">(</span><span class="ident" id="6866659">got</span><span class="op" id="6866662">,</span>&nbsp;<span class="ident" id="6866664">headerBody</span><span class="op" id="6866674">{</span><span class="ident" id="6866675">p</span><span class="op" id="6866676">.</span><span class="ident" id="6866677">Header</span><span class="op" id="6866683">,</span>&nbsp;<span class="builtintype" id="6866685">string</span><span class="op" id="6866691">(</span><span class="ident" id="6866692">pbody</span><span class="op" id="6866697">)</span><span class="op" id="6866698">}</span><span class="op" id="6866699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866707">if</span>&nbsp;<span class="op" id="6866710">!</span><span class="ident" id="6866711">reflect</span><span class="op" id="6866718">.</span><span class="ident" id="6866719">DeepEqual</span><span class="op" id="6866728">(</span><span class="ident" id="6866729">tt</span><span class="op" id="6866731">.</span><span class="ident" id="6866732">want</span><span class="op" id="6866736">,</span>&nbsp;<span class="ident" id="6866738">got</span><span class="op" id="6866741">)</span>&nbsp;<span class="op" id="6866743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866748">t</span><span class="op" id="6866749">.</span><span class="ident" id="6866750">Errorf</span><span class="op" id="6866756">(</span><span class="string" id="6866757">&#34;test&nbsp;%q:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6866787">,</span>&nbsp;<span class="ident" id="6866789">tt</span><span class="op" id="6866791">.</span><span class="ident" id="6866792">name</span><span class="op" id="6866796">,</span>&nbsp;<span class="ident" id="6866798">got</span><span class="op" id="6866801">,</span>&nbsp;<span class="ident" id="6866803">tt</span><span class="op" id="6866805">.</span><span class="ident" id="6866806">want</span><span class="op" id="6866810">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866815">if</span>&nbsp;<span class="builtinfunc" id="6866818">len</span><span class="op" id="6866821">(</span><span class="ident" id="6866822">tt</span><span class="op" id="6866824">.</span><span class="ident" id="6866825">want</span><span class="op" id="6866829">)</span>&nbsp;<span class="op" id="6866831">!=</span>&nbsp;<span class="builtinfunc" id="6866834">len</span><span class="op" id="6866837">(</span><span class="ident" id="6866838">got</span><span class="op" id="6866841">)</span>&nbsp;<span class="op" id="6866843">{</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6866849">t</span><span class="op" id="6866850">.</span><span class="ident" id="6866851">Errorf</span><span class="op" id="6866857">(</span><span class="string" id="6866858">&#34;test&nbsp;%q:&nbsp;got&nbsp;%d&nbsp;parts,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="6866890">,</span>&nbsp;<span class="ident" id="6866892">tt</span><span class="op" id="6866894">.</span><span class="ident" id="6866895">name</span><span class="op" id="6866899">,</span>&nbsp;<span class="builtinfunc" id="6866901">len</span><span class="op" id="6866904">(</span><span class="ident" id="6866905">got</span><span class="op" id="6866908">)</span><span class="op" id="6866909">,</span>&nbsp;<span class="builtinfunc" id="6866911">len</span><span class="op" id="6866914">(</span><span class="ident" id="6866915">tt</span><span class="op" id="6866917">.</span><span class="ident" id="6866918">want</span><span class="op" id="6866922">)</span><span class="op" id="6866923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6866928">}</span>&nbsp;<span class="keyword" id="6866930">else</span>&nbsp;<span class="keyword" id="6866935">if</span>&nbsp;<span class="builtinfunc" id="6866938">len</span><span class="op" id="6866941">(</span><span class="ident" id="6866942">got</span><span class="op" id="6866945">)</span>&nbsp;<span class="op" id="6866947">&gt;</span>&nbsp;<span class="num" id="6866949">1</span>&nbsp;<span class="op" id="6866951">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866957">for</span>&nbsp;<span class="ident" id="6866961">pi</span><span class="op" id="6866963">,</span>&nbsp;<span class="ident" id="6866965">wantPart</span>&nbsp;<span class="op" id="6866974">:=</span>&nbsp;<span class="keyword" id="6866977">range</span>&nbsp;<span class="ident" id="6866983">tt</span><span class="op" id="6866985">.</span><span class="ident" id="6866986">want</span>&nbsp;<span class="op" id="6866991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6866998">if</span>&nbsp;<span class="op" id="6867001">!</span><span class="ident" id="6867002">reflect</span><span class="op" id="6867009">.</span><span class="ident" id="6867010">DeepEqual</span><span class="op" id="6867019">(</span><span class="ident" id="6867020">wantPart</span><span class="op" id="6867028">,</span>&nbsp;<span class="ident" id="6867030">got</span><span class="op" id="6867033">[</span><span class="ident" id="6867034">pi</span><span class="op" id="6867036">]</span><span class="op" id="6867037">)</span>&nbsp;<span class="op" id="6867039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867047">t</span><span class="op" id="6867048">.</span><span class="ident" id="6867049">Errorf</span><span class="op" id="6867055">(</span><span class="string" id="6867056">&#34;test&nbsp;%q,&nbsp;part&nbsp;%d:\n&nbsp;got:&nbsp;%v\nwant:&nbsp;%v&#34;</span><span class="op" id="6867095">,</span>&nbsp;<span class="ident" id="6867097">tt</span><span class="op" id="6867099">.</span><span class="ident" id="6867100">name</span><span class="op" id="6867104">,</span>&nbsp;<span class="ident" id="6867106">pi</span><span class="op" id="6867108">,</span>&nbsp;<span class="ident" id="6867110">got</span><span class="op" id="6867113">[</span><span class="ident" id="6867114">pi</span><span class="op" id="6867116">]</span><span class="op" id="6867117">,</span>&nbsp;<span class="ident" id="6867119">wantPart</span><span class="op" id="6867127">)</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867140">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867145">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867149">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867152">}</span><br>
<span class="lineno">605</span><span class="op" id="6867154">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6867157">func</span>&nbsp;<span class="ident" id="6867162">roundTripParseTest</span><span class="op" id="6867180">(</span><span class="op" id="6867181">)</span>&nbsp;<span class="ident" id="6867183">parseTest</span>&nbsp;<span class="op" id="6867193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867196">t</span>&nbsp;<span class="op" id="6867198">:=</span>&nbsp;<span class="ident" id="6867201">parseTest</span><span class="op" id="6867210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867214">name</span><span class="op" id="6867218">:</span>&nbsp;<span class="string" id="6867220">&#34;round&nbsp;trip&#34;</span><span class="op" id="6867232">,</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867236">want</span><span class="op" id="6867240">:</span>&nbsp;<span class="op" id="6867242">[</span><span class="op" id="6867243">]</span><span class="ident" id="6867244">headerBody</span><span class="op" id="6867254">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867259">formData</span><span class="op" id="6867267">(</span><span class="string" id="6867268">&#34;empty&#34;</span><span class="op" id="6867275">,</span>&nbsp;<span class="string" id="6867277">&#34;&#34;</span><span class="op" id="6867279">)</span><span class="op" id="6867280">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867285">formData</span><span class="op" id="6867293">(</span><span class="string" id="6867294">&#34;lf&#34;</span><span class="op" id="6867298">,</span>&nbsp;<span class="string" id="6867300">&#34;\n&#34;</span><span class="op" id="6867304">)</span><span class="op" id="6867305">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867310">formData</span><span class="op" id="6867318">(</span><span class="string" id="6867319">&#34;cr&#34;</span><span class="op" id="6867323">,</span>&nbsp;<span class="string" id="6867325">&#34;\r&#34;</span><span class="op" id="6867329">)</span><span class="op" id="6867330">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867335">formData</span><span class="op" id="6867343">(</span><span class="string" id="6867344">&#34;crlf&#34;</span><span class="op" id="6867350">,</span>&nbsp;<span class="string" id="6867352">&#34;\r\n&#34;</span><span class="op" id="6867358">)</span><span class="op" id="6867359">,</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867364">formData</span><span class="op" id="6867372">(</span><span class="string" id="6867373">&#34;foo&#34;</span><span class="op" id="6867378">,</span>&nbsp;<span class="string" id="6867380">&#34;bar&#34;</span><span class="op" id="6867385">)</span><span class="op" id="6867386">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867390">}</span><span class="op" id="6867391">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6867397">var</span>&nbsp;<span class="ident" id="6867401">buf</span>&nbsp;<span class="ident" id="6867405">bytes</span><span class="op" id="6867410">.</span><span class="ident" id="6867411">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867419">w</span>&nbsp;<span class="op" id="6867421">:=</span>&nbsp;<span class="ident" id="6867424">NewWriter</span><span class="op" id="6867433">(</span><span class="op" id="6867434">&amp;</span><span class="ident" id="6867435">buf</span><span class="op" id="6867438">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6867441">for</span>&nbsp;<span class="ident" id="6867445">_</span><span class="op" id="6867446">,</span>&nbsp;<span class="ident" id="6867448">p</span>&nbsp;<span class="op" id="6867450">:=</span>&nbsp;<span class="keyword" id="6867453">range</span>&nbsp;<span class="ident" id="6867459">t</span><span class="op" id="6867460">.</span><span class="ident" id="6867461">want</span>&nbsp;<span class="op" id="6867466">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867470">pw</span><span class="op" id="6867472">,</span>&nbsp;<span class="ident" id="6867474">err</span>&nbsp;<span class="op" id="6867478">:=</span>&nbsp;<span class="ident" id="6867481">w</span><span class="op" id="6867482">.</span><span class="ident" id="6867483">CreatePart</span><span class="op" id="6867493">(</span><span class="ident" id="6867494">p</span><span class="op" id="6867495">.</span><span class="ident" id="6867496">header</span><span class="op" id="6867502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6867506">if</span>&nbsp;<span class="ident" id="6867509">err</span>&nbsp;<span class="op" id="6867513">!=</span>&nbsp;<span class="builtintype" id="6867516">nil</span>&nbsp;<span class="op" id="6867520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6867525">panic</span><span class="op" id="6867530">(</span><span class="ident" id="6867531">err</span><span class="op" id="6867534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867538">}</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867542">_</span><span class="op" id="6867543">,</span>&nbsp;<span class="ident" id="6867545">err</span>&nbsp;<span class="op" id="6867549">=</span>&nbsp;<span class="ident" id="6867551">pw</span><span class="op" id="6867553">.</span><span class="ident" id="6867554">Write</span><span class="op" id="6867559">(</span><span class="op" id="6867560">[</span><span class="op" id="6867561">]</span><span class="builtintype" id="6867562">byte</span><span class="op" id="6867566">(</span><span class="ident" id="6867567">p</span><span class="op" id="6867568">.</span><span class="ident" id="6867569">body</span><span class="op" id="6867573">)</span><span class="op" id="6867574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6867578">if</span>&nbsp;<span class="ident" id="6867581">err</span>&nbsp;<span class="op" id="6867585">!=</span>&nbsp;<span class="builtintype" id="6867588">nil</span>&nbsp;<span class="op" id="6867592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="6867597">panic</span><span class="op" id="6867602">(</span><span class="ident" id="6867603">err</span><span class="op" id="6867606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867610">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6867613">}</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867616">w</span><span class="op" id="6867617">.</span><span class="ident" id="6867618">Close</span><span class="op" id="6867623">(</span><span class="op" id="6867624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867627">t</span><span class="op" id="6867628">.</span><span class="ident" id="6867629">in</span>&nbsp;<span class="op" id="6867632">=</span>&nbsp;<span class="ident" id="6867634">buf</span><span class="op" id="6867637">.</span><span class="ident" id="6867638">String</span><span class="op" id="6867644">(</span><span class="op" id="6867645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6867648">t</span><span class="op" id="6867649">.</span><span class="ident" id="6867650">sep</span>&nbsp;<span class="op" id="6867654">=</span>&nbsp;<span class="ident" id="6867656">w</span><span class="op" id="6867657">.</span><span class="ident" id="6867658">Boundary</span><span class="op" id="6867666">(</span><span class="op" id="6867667">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6867670">return</span>&nbsp;<span class="ident" id="6867677">t</span><br>
<span class="lineno"></span><span class="op" id="6867679">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
