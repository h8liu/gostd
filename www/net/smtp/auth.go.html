<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="6336687">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6336742">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6336796">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6336847">package</span>&nbsp;<span class="ident" id="6336855">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6336861">import</span>&nbsp;<span class="op" id="6336868">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6336871">&#34;crypto/hmac&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6336886">&#34;crypto/md5&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6336900">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6336910">&#34;fmt&#34;</span><br>
<span class="lineno"></span><span class="op" id="6336916">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6336919">//&nbsp;Auth&nbsp;is&nbsp;implemented&nbsp;by&nbsp;an&nbsp;SMTP&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno">15</span><span class="keyword" id="6336979">type</span>&nbsp;<span class="ident" id="6336984">Auth</span>&nbsp;<span class="keyword" id="6336989">interface</span>&nbsp;<span class="op" id="6336999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337002">//&nbsp;Start&nbsp;begins&nbsp;an&nbsp;authentication&nbsp;with&nbsp;a&nbsp;server.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337052">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;name&nbsp;of&nbsp;the&nbsp;authentication&nbsp;protocol</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337107">//&nbsp;and&nbsp;optionally&nbsp;data&nbsp;to&nbsp;include&nbsp;in&nbsp;the&nbsp;initial&nbsp;AUTH&nbsp;message</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337170">//&nbsp;sent&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;can&nbsp;return&nbsp;proto&nbsp;==&nbsp;&#34;&#34;&nbsp;to&nbsp;indicate</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337232">//&nbsp;that&nbsp;the&nbsp;authentication&nbsp;should&nbsp;be&nbsp;skipped.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337279">//&nbsp;If&nbsp;it&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337337">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337395">Start</span><span class="op" id="6337400">(</span><span class="ident" id="6337401">server</span>&nbsp;<span class="op" id="6337408">*</span><span class="ident" id="6337409">ServerInfo</span><span class="op" id="6337419">)</span>&nbsp;<span class="op" id="6337421">(</span><span class="ident" id="6337422">proto</span>&nbsp;<span class="builtintype" id="6337428">string</span><span class="op" id="6337434">,</span>&nbsp;<span class="ident" id="6337436">toServer</span>&nbsp;<span class="op" id="6337445">[</span><span class="op" id="6337446">]</span><span class="builtintype" id="6337447">byte</span><span class="op" id="6337451">,</span>&nbsp;<span class="ident" id="6337453">err</span>&nbsp;<span class="builtintype" id="6337457">error</span><span class="op" id="6337462">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337466">//&nbsp;Next&nbsp;continues&nbsp;the&nbsp;authentication.&nbsp;The&nbsp;server&nbsp;has&nbsp;just&nbsp;sent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337530">//&nbsp;the&nbsp;fromServer&nbsp;data.&nbsp;If&nbsp;more&nbsp;is&nbsp;true,&nbsp;the&nbsp;server&nbsp;expects&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337593">//&nbsp;response,&nbsp;which&nbsp;Next&nbsp;should&nbsp;return&nbsp;as&nbsp;toServer;&nbsp;otherwise</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337655">//&nbsp;Next&nbsp;should&nbsp;return&nbsp;toServer&nbsp;==&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337695">//&nbsp;If&nbsp;Next&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the&nbsp;SMTP&nbsp;client&nbsp;aborts</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6337755">//&nbsp;the&nbsp;authentication&nbsp;attempt&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337813">Next</span><span class="op" id="6337817">(</span><span class="ident" id="6337818">fromServer</span>&nbsp;<span class="op" id="6337829">[</span><span class="op" id="6337830">]</span><span class="builtintype" id="6337831">byte</span><span class="op" id="6337835">,</span>&nbsp;<span class="ident" id="6337837">more</span>&nbsp;<span class="builtintype" id="6337842">bool</span><span class="op" id="6337846">)</span>&nbsp;<span class="op" id="6337848">(</span><span class="ident" id="6337849">toServer</span>&nbsp;<span class="op" id="6337858">[</span><span class="op" id="6337859">]</span><span class="builtintype" id="6337860">byte</span><span class="op" id="6337864">,</span>&nbsp;<span class="ident" id="6337866">err</span>&nbsp;<span class="builtintype" id="6337870">error</span><span class="op" id="6337875">)</span><br>
<span class="lineno"></span><span class="op" id="6337877">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6337880">//&nbsp;ServerInfo&nbsp;records&nbsp;information&nbsp;about&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno">35</span><span class="keyword" id="6337936">type</span>&nbsp;<span class="ident" id="6337941">ServerInfo</span>&nbsp;<span class="keyword" id="6337952">struct</span>&nbsp;<span class="op" id="6337959">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337962">Name</span>&nbsp;<span class="builtintype" id="6337967">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6337976">//&nbsp;SMTP&nbsp;server&nbsp;name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6337997">TLS</span>&nbsp;&nbsp;<span class="builtintype" id="6338002">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6338011">//&nbsp;using&nbsp;TLS,&nbsp;with&nbsp;valid&nbsp;certificate&nbsp;for&nbsp;Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338058">Auth</span>&nbsp;<span class="op" id="6338063">[</span><span class="op" id="6338064">]</span><span class="builtintype" id="6338065">string</span>&nbsp;<span class="comment" id="6338072">//&nbsp;advertised&nbsp;authentication&nbsp;mechanisms</span><br>
<span class="lineno"></span><span class="op" id="6338112">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="6338115">type</span>&nbsp;<span class="ident" id="6338120">plainAuth</span>&nbsp;<span class="keyword" id="6338130">struct</span>&nbsp;<span class="op" id="6338137">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338140">identity</span><span class="op" id="6338148">,</span>&nbsp;<span class="ident" id="6338150">username</span><span class="op" id="6338158">,</span>&nbsp;<span class="ident" id="6338160">password</span>&nbsp;<span class="builtintype" id="6338169">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338177">host</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6338206">string</span><br>
<span class="lineno"></span><span class="op" id="6338213">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="6338216">//&nbsp;PlainAuth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;PLAIN&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6338286">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;4616.</span><br>
<span class="lineno"></span><span class="comment" id="6338323">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;password&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno"></span><span class="comment" id="6338397">//&nbsp;on&nbsp;TLS&nbsp;connections&nbsp;to&nbsp;host&nbsp;and&nbsp;act&nbsp;as&nbsp;identity.&nbsp;Usually&nbsp;identity&nbsp;will&nbsp;be</span><br>
<span class="lineno">50</span><span class="comment" id="6338473">//&nbsp;left&nbsp;blank&nbsp;to&nbsp;act&nbsp;as&nbsp;username.</span><br>
<span class="lineno"></span><span class="keyword" id="6338507">func</span>&nbsp;<span class="ident" id="6338512">PlainAuth</span><span class="op" id="6338521">(</span><span class="ident" id="6338522">identity</span><span class="op" id="6338530">,</span>&nbsp;<span class="ident" id="6338532">username</span><span class="op" id="6338540">,</span>&nbsp;<span class="ident" id="6338542">password</span><span class="op" id="6338550">,</span>&nbsp;<span class="ident" id="6338552">host</span>&nbsp;<span class="builtintype" id="6338557">string</span><span class="op" id="6338563">)</span>&nbsp;<span class="ident" id="6338565">Auth</span>&nbsp;<span class="op" id="6338570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338573">return</span>&nbsp;<span class="op" id="6338580">&amp;</span><span class="ident" id="6338581">plainAuth</span><span class="op" id="6338590">{</span><span class="ident" id="6338591">identity</span><span class="op" id="6338599">,</span>&nbsp;<span class="ident" id="6338601">username</span><span class="op" id="6338609">,</span>&nbsp;<span class="ident" id="6338611">password</span><span class="op" id="6338619">,</span>&nbsp;<span class="ident" id="6338621">host</span><span class="op" id="6338625">}</span><br>
<span class="lineno"></span><span class="op" id="6338627">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="6338630">func</span>&nbsp;<span class="op" id="6338635">(</span><span class="ident" id="6338636">a</span>&nbsp;<span class="op" id="6338638">*</span><span class="ident" id="6338639">plainAuth</span><span class="op" id="6338648">)</span>&nbsp;<span class="ident" id="6338650">Start</span><span class="op" id="6338655">(</span><span class="ident" id="6338656">server</span>&nbsp;<span class="op" id="6338663">*</span><span class="ident" id="6338664">ServerInfo</span><span class="op" id="6338674">)</span>&nbsp;<span class="op" id="6338676">(</span><span class="builtintype" id="6338677">string</span><span class="op" id="6338683">,</span>&nbsp;<span class="op" id="6338685">[</span><span class="op" id="6338686">]</span><span class="builtintype" id="6338687">byte</span><span class="op" id="6338691">,</span>&nbsp;<span class="builtintype" id="6338693">error</span><span class="op" id="6338698">)</span>&nbsp;<span class="op" id="6338700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338703">if</span>&nbsp;<span class="op" id="6338706">!</span><span class="ident" id="6338707">server</span><span class="op" id="6338713">.</span><span class="ident" id="6338714">TLS</span>&nbsp;<span class="op" id="6338718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338722">advertised</span>&nbsp;<span class="op" id="6338733">:=</span>&nbsp;<span class="ident" id="6338736">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338744">for</span>&nbsp;<span class="ident" id="6338748">_</span><span class="op" id="6338749">,</span>&nbsp;<span class="ident" id="6338751">mechanism</span>&nbsp;<span class="op" id="6338761">:=</span>&nbsp;<span class="keyword" id="6338764">range</span>&nbsp;<span class="ident" id="6338770">server</span><span class="op" id="6338776">.</span><span class="ident" id="6338777">Auth</span>&nbsp;<span class="op" id="6338782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338787">if</span>&nbsp;<span class="ident" id="6338790">mechanism</span>&nbsp;<span class="op" id="6338800">==</span>&nbsp;<span class="string" id="6338803">&#34;PLAIN&#34;</span>&nbsp;<span class="op" id="6338811">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6338817">advertised</span>&nbsp;<span class="op" id="6338828">=</span>&nbsp;<span class="ident" id="6338830">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338839">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338856">if</span>&nbsp;<span class="op" id="6338859">!</span><span class="ident" id="6338860">advertised</span>&nbsp;<span class="op" id="6338871">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338876">return</span>&nbsp;<span class="string" id="6338883">&#34;&#34;</span><span class="op" id="6338885">,</span>&nbsp;<span class="ident" id="6338887">nil</span><span class="op" id="6338890">,</span>&nbsp;<span class="ident" id="6338892">errors</span><span class="op" id="6338898">.</span><span class="ident" id="6338899">New</span><span class="op" id="6338902">(</span><span class="string" id="6338903">&#34;unencrypted&nbsp;connection&#34;</span><span class="op" id="6338927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6338934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338937">if</span>&nbsp;<span class="ident" id="6338940">server</span><span class="op" id="6338946">.</span><span class="ident" id="6338947">Name</span>&nbsp;<span class="op" id="6338952">!=</span>&nbsp;<span class="ident" id="6338955">a</span><span class="op" id="6338956">.</span><span class="ident" id="6338957">host</span>&nbsp;<span class="op" id="6338962">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6338966">return</span>&nbsp;<span class="string" id="6338973">&#34;&#34;</span><span class="op" id="6338975">,</span>&nbsp;<span class="ident" id="6338977">nil</span><span class="op" id="6338980">,</span>&nbsp;<span class="ident" id="6338982">errors</span><span class="op" id="6338988">.</span><span class="ident" id="6338989">New</span><span class="op" id="6338992">(</span><span class="string" id="6338993">&#34;wrong&nbsp;host&nbsp;name&#34;</span><span class="op" id="6339010">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339016">resp</span>&nbsp;<span class="op" id="6339021">:=</span>&nbsp;<span class="op" id="6339024">[</span><span class="op" id="6339025">]</span><span class="builtintype" id="6339026">byte</span><span class="op" id="6339030">(</span><span class="ident" id="6339031">a</span><span class="op" id="6339032">.</span><span class="ident" id="6339033">identity</span>&nbsp;<span class="op" id="6339042">+</span>&nbsp;<span class="string" id="6339044">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6339051">+</span>&nbsp;<span class="ident" id="6339053">a</span><span class="op" id="6339054">.</span><span class="ident" id="6339055">username</span>&nbsp;<span class="op" id="6339064">+</span>&nbsp;<span class="string" id="6339066">&#34;\x00&#34;</span>&nbsp;<span class="op" id="6339073">+</span>&nbsp;<span class="ident" id="6339075">a</span><span class="op" id="6339076">.</span><span class="ident" id="6339077">password</span><span class="op" id="6339085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339088">return</span>&nbsp;<span class="string" id="6339095">&#34;PLAIN&#34;</span><span class="op" id="6339102">,</span>&nbsp;<span class="ident" id="6339104">resp</span><span class="op" id="6339108">,</span>&nbsp;<span class="ident" id="6339110">nil</span><br>
<span class="lineno"></span><span class="op" id="6339114">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="keyword" id="6339117">func</span>&nbsp;<span class="op" id="6339122">(</span><span class="ident" id="6339123">a</span>&nbsp;<span class="op" id="6339125">*</span><span class="ident" id="6339126">plainAuth</span><span class="op" id="6339135">)</span>&nbsp;<span class="ident" id="6339137">Next</span><span class="op" id="6339141">(</span><span class="ident" id="6339142">fromServer</span>&nbsp;<span class="op" id="6339153">[</span><span class="op" id="6339154">]</span><span class="builtintype" id="6339155">byte</span><span class="op" id="6339159">,</span>&nbsp;<span class="ident" id="6339161">more</span>&nbsp;<span class="builtintype" id="6339166">bool</span><span class="op" id="6339170">)</span>&nbsp;<span class="op" id="6339172">(</span><span class="op" id="6339173">[</span><span class="op" id="6339174">]</span><span class="builtintype" id="6339175">byte</span><span class="op" id="6339179">,</span>&nbsp;<span class="builtintype" id="6339181">error</span><span class="op" id="6339186">)</span>&nbsp;<span class="op" id="6339188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339191">if</span>&nbsp;<span class="ident" id="6339194">more</span>&nbsp;<span class="op" id="6339199">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6339203">//&nbsp;We&#39;ve&nbsp;already&nbsp;sent&nbsp;everything.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339239">return</span>&nbsp;<span class="ident" id="6339246">nil</span><span class="op" id="6339249">,</span>&nbsp;<span class="ident" id="6339251">errors</span><span class="op" id="6339257">.</span><span class="ident" id="6339258">New</span><span class="op" id="6339261">(</span><span class="string" id="6339262">&#34;unexpected&nbsp;server&nbsp;challenge&#34;</span><span class="op" id="6339291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6339294">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339297">return</span>&nbsp;<span class="ident" id="6339304">nil</span><span class="op" id="6339307">,</span>&nbsp;<span class="ident" id="6339309">nil</span><br>
<span class="lineno"></span><span class="op" id="6339313">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339316">type</span>&nbsp;<span class="ident" id="6339321">cramMD5Auth</span>&nbsp;<span class="keyword" id="6339333">struct</span>&nbsp;<span class="op" id="6339340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339343">username</span><span class="op" id="6339351">,</span>&nbsp;<span class="ident" id="6339353">secret</span>&nbsp;<span class="builtintype" id="6339360">string</span><br>
<span class="lineno">85</span><span class="op" id="6339367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6339370">//&nbsp;CRAMMD5Auth&nbsp;returns&nbsp;an&nbsp;Auth&nbsp;that&nbsp;implements&nbsp;the&nbsp;CRAM-MD5&nbsp;authentication</span><br>
<span class="lineno"></span><span class="comment" id="6339445">//&nbsp;mechanism&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;2195.</span><br>
<span class="lineno"></span><span class="comment" id="6339482">//&nbsp;The&nbsp;returned&nbsp;Auth&nbsp;uses&nbsp;the&nbsp;given&nbsp;username&nbsp;and&nbsp;secret&nbsp;to&nbsp;authenticate</span><br>
<span class="lineno">90</span><span class="comment" id="6339554">//&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;challenge-response&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="keyword" id="6339611">func</span>&nbsp;<span class="ident" id="6339616">CRAMMD5Auth</span><span class="op" id="6339627">(</span><span class="ident" id="6339628">username</span><span class="op" id="6339636">,</span>&nbsp;<span class="ident" id="6339638">secret</span>&nbsp;<span class="builtintype" id="6339645">string</span><span class="op" id="6339651">)</span>&nbsp;<span class="ident" id="6339653">Auth</span>&nbsp;<span class="op" id="6339658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339661">return</span>&nbsp;<span class="op" id="6339668">&amp;</span><span class="ident" id="6339669">cramMD5Auth</span><span class="op" id="6339680">{</span><span class="ident" id="6339681">username</span><span class="op" id="6339689">,</span>&nbsp;<span class="ident" id="6339691">secret</span><span class="op" id="6339697">}</span><br>
<span class="lineno"></span><span class="op" id="6339699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="6339702">func</span>&nbsp;<span class="op" id="6339707">(</span><span class="ident" id="6339708">a</span>&nbsp;<span class="op" id="6339710">*</span><span class="ident" id="6339711">cramMD5Auth</span><span class="op" id="6339722">)</span>&nbsp;<span class="ident" id="6339724">Start</span><span class="op" id="6339729">(</span><span class="ident" id="6339730">server</span>&nbsp;<span class="op" id="6339737">*</span><span class="ident" id="6339738">ServerInfo</span><span class="op" id="6339748">)</span>&nbsp;<span class="op" id="6339750">(</span><span class="builtintype" id="6339751">string</span><span class="op" id="6339757">,</span>&nbsp;<span class="op" id="6339759">[</span><span class="op" id="6339760">]</span><span class="builtintype" id="6339761">byte</span><span class="op" id="6339765">,</span>&nbsp;<span class="builtintype" id="6339767">error</span><span class="op" id="6339772">)</span>&nbsp;<span class="op" id="6339774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339777">return</span>&nbsp;<span class="string" id="6339784">&#34;CRAM-MD5&#34;</span><span class="op" id="6339794">,</span>&nbsp;<span class="ident" id="6339796">nil</span><span class="op" id="6339799">,</span>&nbsp;<span class="ident" id="6339801">nil</span><br>
<span class="lineno"></span><span class="op" id="6339805">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6339808">func</span>&nbsp;<span class="op" id="6339813">(</span><span class="ident" id="6339814">a</span>&nbsp;<span class="op" id="6339816">*</span><span class="ident" id="6339817">cramMD5Auth</span><span class="op" id="6339828">)</span>&nbsp;<span class="ident" id="6339830">Next</span><span class="op" id="6339834">(</span><span class="ident" id="6339835">fromServer</span>&nbsp;<span class="op" id="6339846">[</span><span class="op" id="6339847">]</span><span class="builtintype" id="6339848">byte</span><span class="op" id="6339852">,</span>&nbsp;<span class="ident" id="6339854">more</span>&nbsp;<span class="builtintype" id="6339859">bool</span><span class="op" id="6339863">)</span>&nbsp;<span class="op" id="6339865">(</span><span class="op" id="6339866">[</span><span class="op" id="6339867">]</span><span class="builtintype" id="6339868">byte</span><span class="op" id="6339872">,</span>&nbsp;<span class="builtintype" id="6339874">error</span><span class="op" id="6339879">)</span>&nbsp;<span class="op" id="6339881">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339884">if</span>&nbsp;<span class="ident" id="6339887">more</span>&nbsp;<span class="op" id="6339892">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339896">d</span>&nbsp;<span class="op" id="6339898">:=</span>&nbsp;<span class="ident" id="6339901">hmac</span><span class="op" id="6339905">.</span><span class="ident" id="6339906">New</span><span class="op" id="6339909">(</span><span class="ident" id="6339910">md5</span><span class="op" id="6339913">.</span><span class="ident" id="6339914">New</span><span class="op" id="6339917">,</span>&nbsp;<span class="op" id="6339919">[</span><span class="op" id="6339920">]</span><span class="builtintype" id="6339921">byte</span><span class="op" id="6339925">(</span><span class="ident" id="6339926">a</span><span class="op" id="6339927">.</span><span class="ident" id="6339928">secret</span><span class="op" id="6339934">)</span><span class="op" id="6339935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339939">d</span><span class="op" id="6339940">.</span><span class="ident" id="6339941">Write</span><span class="op" id="6339946">(</span><span class="ident" id="6339947">fromServer</span><span class="op" id="6339957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6339961">s</span>&nbsp;<span class="op" id="6339963">:=</span>&nbsp;<span class="builtinfunc" id="6339966">make</span><span class="op" id="6339970">(</span><span class="op" id="6339971">[</span><span class="op" id="6339972">]</span><span class="builtintype" id="6339973">byte</span><span class="op" id="6339977">,</span>&nbsp;<span class="num" id="6339979">0</span><span class="op" id="6339980">,</span>&nbsp;<span class="ident" id="6339982">d</span><span class="op" id="6339983">.</span><span class="ident" id="6339984">Size</span><span class="op" id="6339988">(</span><span class="op" id="6339989">)</span><span class="op" id="6339990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6339994">return</span>&nbsp;<span class="op" id="6340001">[</span><span class="op" id="6340002">]</span><span class="builtintype" id="6340003">byte</span><span class="op" id="6340007">(</span><span class="ident" id="6340008">fmt</span><span class="op" id="6340011">.</span><span class="ident" id="6340012">Sprintf</span><span class="op" id="6340019">(</span><span class="string" id="6340020">&#34;%s&nbsp;%x&#34;</span><span class="op" id="6340027">,</span>&nbsp;<span class="ident" id="6340029">a</span><span class="op" id="6340030">.</span><span class="ident" id="6340031">username</span><span class="op" id="6340039">,</span>&nbsp;<span class="ident" id="6340041">d</span><span class="op" id="6340042">.</span><span class="ident" id="6340043">Sum</span><span class="op" id="6340046">(</span><span class="ident" id="6340047">s</span><span class="op" id="6340048">)</span><span class="op" id="6340049">)</span><span class="op" id="6340050">)</span><span class="op" id="6340051">,</span>&nbsp;<span class="ident" id="6340053">nil</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6340058">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6340061">return</span>&nbsp;<span class="ident" id="6340068">nil</span><span class="op" id="6340071">,</span>&nbsp;<span class="ident" id="6340073">nil</span><br>
<span class="lineno"></span><span class="op" id="6340077">}</span>
</div>
</body>
</html>
