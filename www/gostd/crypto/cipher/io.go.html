<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/cipher</h2>
<ul>
<li><a href="/gostd/crypto/cipher/benchmark_test.go.html">benchmark_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc.go.html">cbc.go</a></li>
<li><a href="/gostd/crypto/cipher/cbc_aes_test.go.html">cbc_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb.go.html">cfb.go</a></li>
<li><a href="/gostd/crypto/cipher/cfb_test.go.html">cfb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher.go.html">cipher.go</a></li>
<li><a href="/gostd/crypto/cipher/cipher_test.go.html">cipher_test.go</a></li>
<li><a href="/gostd/crypto/cipher/common_test.go.html">common_test.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr.go.html">ctr.go</a></li>
<li><a href="/gostd/crypto/cipher/ctr_aes_test.go.html">ctr_aes_test.go</a></li>
<li><a href="/gostd/crypto/cipher/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm.go.html">gcm.go</a></li>
<li><a href="/gostd/crypto/cipher/gcm_test.go.html">gcm_test.go</a></li>
<li><a href="/gostd/crypto/cipher/io.go.html" class="current">io.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb.go.html">ofb.go</a></li>
<li><a href="/gostd/crypto/cipher/ofb_test.go.html">ofb_test.go</a></li>
<li><a href="/gostd/crypto/cipher/xor.go.html">xor.go</a></li>
<li><a href="/gostd/crypto/cipher/xor_test.go.html">xor_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4040903">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4040958">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4041012">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4041063">package</span>&nbsp;<span class="ident" id="4041071">cipher</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4041079">import</span>&nbsp;<span class="string" id="4041086">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4041092">//&nbsp;The&nbsp;Stream*&nbsp;objects&nbsp;are&nbsp;so&nbsp;simple&nbsp;that&nbsp;all&nbsp;their&nbsp;members&nbsp;are&nbsp;public.&nbsp;Users</span><br>
<span class="lineno">10</span><span class="comment" id="4041170">//&nbsp;can&nbsp;create&nbsp;them&nbsp;themselves.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4041202">//&nbsp;StreamReader&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Reader.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="4041274">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.</span><br>
<span class="lineno"></span><span class="keyword" id="4041329">type</span>&nbsp;<span class="ident" id="4041334">StreamReader</span>&nbsp;<span class="keyword" id="4041347">struct</span>&nbsp;<span class="op" id="4041354">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041357">S</span>&nbsp;<span class="ident" id="4041359">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041367">R</span>&nbsp;<span class="ident" id="4041369">io</span><span class="op" id="4041371">.</span><span class="ident" id="4041372">Reader</span><br>
<span class="lineno"></span><span class="op" id="4041379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4041382">func</span>&nbsp;<span class="op" id="4041387">(</span><span class="ident" id="4041388">r</span>&nbsp;<span class="ident" id="4041390">StreamReader</span><span class="op" id="4041402">)</span>&nbsp;<span class="ident" id="4041404">Read</span><span class="op" id="4041408">(</span><span class="ident" id="4041409">dst</span>&nbsp;<span class="op" id="4041413">[</span><span class="op" id="4041414">]</span><span class="builtintype" id="4041415">byte</span><span class="op" id="4041419">)</span>&nbsp;<span class="op" id="4041421">(</span><span class="ident" id="4041422">n</span>&nbsp;<span class="builtintype" id="4041424">int</span><span class="op" id="4041427">,</span>&nbsp;<span class="ident" id="4041429">err</span>&nbsp;<span class="builtintype" id="4041433">error</span><span class="op" id="4041438">)</span>&nbsp;<span class="op" id="4041440">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041443">n</span><span class="op" id="4041444">,</span>&nbsp;<span class="ident" id="4041446">err</span>&nbsp;<span class="op" id="4041450">=</span>&nbsp;<span class="ident" id="4041452">r</span><span class="op" id="4041453">.</span><span class="ident" id="4041454">R</span><span class="op" id="4041455">.</span><span class="ident" id="4041456">Read</span><span class="op" id="4041460">(</span><span class="ident" id="4041461">dst</span><span class="op" id="4041464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041467">r</span><span class="op" id="4041468">.</span><span class="ident" id="4041469">S</span><span class="op" id="4041470">.</span><span class="ident" id="4041471">XORKeyStream</span><span class="op" id="4041483">(</span><span class="ident" id="4041484">dst</span><span class="op" id="4041487">[</span><span class="op" id="4041488">:</span><span class="ident" id="4041489">n</span><span class="op" id="4041490">]</span><span class="op" id="4041491">,</span>&nbsp;<span class="ident" id="4041493">dst</span><span class="op" id="4041496">[</span><span class="op" id="4041497">:</span><span class="ident" id="4041498">n</span><span class="op" id="4041499">]</span><span class="op" id="4041500">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4041503">return</span><br>
<span class="lineno"></span><span class="op" id="4041510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="4041513">//&nbsp;StreamWriter&nbsp;wraps&nbsp;a&nbsp;Stream&nbsp;into&nbsp;an&nbsp;io.Writer.&nbsp;It&nbsp;calls&nbsp;XORKeyStream</span><br>
<span class="lineno"></span><span class="comment" id="4041585">//&nbsp;to&nbsp;process&nbsp;each&nbsp;slice&nbsp;of&nbsp;data&nbsp;which&nbsp;passes&nbsp;through.&nbsp;If&nbsp;any&nbsp;Write&nbsp;call</span><br>
<span class="lineno"></span><span class="comment" id="4041658">//&nbsp;returns&nbsp;short&nbsp;then&nbsp;the&nbsp;StreamWriter&nbsp;is&nbsp;out&nbsp;of&nbsp;sync&nbsp;and&nbsp;must&nbsp;be&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="comment" id="4041735">//&nbsp;A&nbsp;StreamWriter&nbsp;has&nbsp;no&nbsp;internal&nbsp;buffering;&nbsp;Close&nbsp;does&nbsp;not&nbsp;need</span><br>
<span class="lineno"></span><span class="comment" id="4041800">//&nbsp;to&nbsp;be&nbsp;called&nbsp;to&nbsp;flush&nbsp;write&nbsp;data.</span><br>
<span class="lineno">30</span><span class="keyword" id="4041837">type</span>&nbsp;<span class="ident" id="4041842">StreamWriter</span>&nbsp;<span class="keyword" id="4041855">struct</span>&nbsp;<span class="op" id="4041862">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041865">S</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4041869">Stream</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041877">W</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="4041881">io</span><span class="op" id="4041883">.</span><span class="ident" id="4041884">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041892">Err</span>&nbsp;<span class="builtintype" id="4041896">error</span>&nbsp;<span class="comment" id="4041902">//&nbsp;unused</span><br>
<span class="lineno"></span><span class="op" id="4041912">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="4041915">func</span>&nbsp;<span class="op" id="4041920">(</span><span class="ident" id="4041921">w</span>&nbsp;<span class="ident" id="4041923">StreamWriter</span><span class="op" id="4041935">)</span>&nbsp;<span class="ident" id="4041937">Write</span><span class="op" id="4041942">(</span><span class="ident" id="4041943">src</span>&nbsp;<span class="op" id="4041947">[</span><span class="op" id="4041948">]</span><span class="builtintype" id="4041949">byte</span><span class="op" id="4041953">)</span>&nbsp;<span class="op" id="4041955">(</span><span class="ident" id="4041956">n</span>&nbsp;<span class="builtintype" id="4041958">int</span><span class="op" id="4041961">,</span>&nbsp;<span class="ident" id="4041963">err</span>&nbsp;<span class="builtintype" id="4041967">error</span><span class="op" id="4041972">)</span>&nbsp;<span class="op" id="4041974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4041977">c</span>&nbsp;<span class="op" id="4041979">:=</span>&nbsp;<span class="builtinfunc" id="4041982">make</span><span class="op" id="4041986">(</span><span class="op" id="4041987">[</span><span class="op" id="4041988">]</span><span class="builtintype" id="4041989">byte</span><span class="op" id="4041993">,</span>&nbsp;<span class="builtinfunc" id="4041995">len</span><span class="op" id="4041998">(</span><span class="ident" id="4041999">src</span><span class="op" id="4042002">)</span><span class="op" id="4042003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042006">w</span><span class="op" id="4042007">.</span><span class="ident" id="4042008">S</span><span class="op" id="4042009">.</span><span class="ident" id="4042010">XORKeyStream</span><span class="op" id="4042022">(</span><span class="ident" id="4042023">c</span><span class="op" id="4042024">,</span>&nbsp;<span class="ident" id="4042026">src</span><span class="op" id="4042029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042032">n</span><span class="op" id="4042033">,</span>&nbsp;<span class="ident" id="4042035">err</span>&nbsp;<span class="op" id="4042039">=</span>&nbsp;<span class="ident" id="4042041">w</span><span class="op" id="4042042">.</span><span class="ident" id="4042043">W</span><span class="op" id="4042044">.</span><span class="ident" id="4042045">Write</span><span class="op" id="4042050">(</span><span class="ident" id="4042051">c</span><span class="op" id="4042052">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042055">if</span>&nbsp;<span class="ident" id="4042058">n</span>&nbsp;<span class="op" id="4042060">!=</span>&nbsp;<span class="builtinfunc" id="4042063">len</span><span class="op" id="4042066">(</span><span class="ident" id="4042067">src</span><span class="op" id="4042070">)</span>&nbsp;<span class="op" id="4042072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042076">if</span>&nbsp;<span class="ident" id="4042079">err</span>&nbsp;<span class="op" id="4042083">==</span>&nbsp;<span class="builtintype" id="4042086">nil</span>&nbsp;<span class="op" id="4042090">{</span>&nbsp;<span class="comment" id="4042092">//&nbsp;should&nbsp;never&nbsp;happen</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4042118">err</span>&nbsp;<span class="op" id="4042122">=</span>&nbsp;<span class="ident" id="4042124">io</span><span class="op" id="4042126">.</span><span class="ident" id="4042127">ErrShortWrite</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4042143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4042146">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042149">return</span><br>
<span class="lineno"></span><span class="op" id="4042156">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4042159">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;underlying&nbsp;Writer&nbsp;and&nbsp;returns&nbsp;its&nbsp;Close&nbsp;return&nbsp;value,&nbsp;if&nbsp;the&nbsp;Writer</span><br>
<span class="lineno"></span><span class="comment" id="4042247">//&nbsp;is&nbsp;also&nbsp;an&nbsp;io.Closer.&nbsp;Otherwise&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">50</span><span class="keyword" id="4042298">func</span>&nbsp;<span class="op" id="4042303">(</span><span class="ident" id="4042304">w</span>&nbsp;<span class="ident" id="4042306">StreamWriter</span><span class="op" id="4042318">)</span>&nbsp;<span class="ident" id="4042320">Close</span><span class="op" id="4042325">(</span><span class="op" id="4042326">)</span>&nbsp;<span class="builtintype" id="4042328">error</span>&nbsp;<span class="op" id="4042334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042337">if</span>&nbsp;<span class="ident" id="4042340">c</span><span class="op" id="4042341">,</span>&nbsp;<span class="ident" id="4042343">ok</span>&nbsp;<span class="op" id="4042346">:=</span>&nbsp;<span class="ident" id="4042349">w</span><span class="op" id="4042350">.</span><span class="ident" id="4042351">W</span><span class="op" id="4042352">.</span><span class="op" id="4042353">(</span><span class="ident" id="4042354">io</span><span class="op" id="4042356">.</span><span class="ident" id="4042357">Closer</span><span class="op" id="4042363">)</span><span class="op" id="4042364">;</span>&nbsp;<span class="ident" id="4042366">ok</span>&nbsp;<span class="op" id="4042369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042373">return</span>&nbsp;<span class="ident" id="4042380">c</span><span class="op" id="4042381">.</span><span class="ident" id="4042382">Close</span><span class="op" id="4042387">(</span><span class="op" id="4042388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4042391">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4042394">return</span>&nbsp;<span class="builtintype" id="4042401">nil</span><br>
<span class="lineno">55</span><span class="op" id="4042405">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
