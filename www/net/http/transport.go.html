<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3914936">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3914991">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3915045">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3915096">//&nbsp;HTTP&nbsp;client&nbsp;implementation.&nbsp;See&nbsp;RFC&nbsp;2616.</span><br>
<span class="lineno"></span><span class="comment" id="3915141">//</span><br>
<span class="lineno"></span><span class="comment" id="3915144">//&nbsp;This&nbsp;is&nbsp;the&nbsp;low-level&nbsp;Transport&nbsp;implementation&nbsp;of&nbsp;RoundTripper.</span><br>
<span class="lineno"></span><span class="comment" id="3915211">//&nbsp;The&nbsp;high-level&nbsp;interface&nbsp;is&nbsp;in&nbsp;client.go.</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3915257">package</span>&nbsp;<span class="ident" id="3915265">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3915271">import</span>&nbsp;<span class="op" id="3915278">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915281">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915290">&#34;compress/gzip&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915307">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915321">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915331">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915338">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915344">&#34;log&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915351">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915358">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915369">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915375">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915386">&#34;sync&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3915394">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="3915401">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3915404">//&nbsp;DefaultTransport&nbsp;is&nbsp;the&nbsp;default&nbsp;implementation&nbsp;of&nbsp;Transport&nbsp;and&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="3915474">//&nbsp;used&nbsp;by&nbsp;DefaultClient.&nbsp;It&nbsp;establishes&nbsp;network&nbsp;connections&nbsp;as&nbsp;needed</span><br>
<span class="lineno">30</span><span class="comment" id="3915545">//&nbsp;and&nbsp;caches&nbsp;them&nbsp;for&nbsp;reuse&nbsp;by&nbsp;subsequent&nbsp;calls.&nbsp;It&nbsp;uses&nbsp;HTTP&nbsp;proxies</span><br>
<span class="lineno"></span><span class="comment" id="3915616">//&nbsp;as&nbsp;directed&nbsp;by&nbsp;the&nbsp;$HTTP_PROXY&nbsp;and&nbsp;$NO_PROXY&nbsp;(or&nbsp;$http_proxy&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3915684">//&nbsp;$no_proxy)&nbsp;environment&nbsp;variables.</span><br>
<span class="lineno"></span><span class="keyword" id="3915721">var</span>&nbsp;<span class="ident" id="3915725">DefaultTransport</span>&nbsp;<span class="ident" id="3915742"><a href="/net/http/client.go.html#3738099">RoundTripper</a></span>&nbsp;<span class="op" id="3915755">=</span>&nbsp;<span class="op" id="3915757">&amp;</span><span class="ident" id="3915758"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3915767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915770">Proxy</span><span class="op" id="3915775">:</span>&nbsp;<span class="ident" id="3915777"><a href="/net/http/transport.go.html#3919746">ProxyFromEnvironment</a></span><span class="op" id="3915797">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915800">Dial</span><span class="op" id="3915804">:</span>&nbsp;<span class="op" id="3915806">(</span><span class="op" id="3915807">&amp;</span><span class="ident" id="3915808"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3915811">.</span><span class="ident" id="3915812">Dialer</span><span class="op" id="3915818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915822">Timeout</span><span class="op" id="3915829">:</span>&nbsp;&nbsp;&nbsp;<span class="num" id="3915833">30</span>&nbsp;<span class="op" id="3915836">*</span>&nbsp;<span class="ident" id="3915838"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3915842">.</span><span class="ident" id="3915843">Second</span><span class="op" id="3915849">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915853">KeepAlive</span><span class="op" id="3915862">:</span>&nbsp;<span class="num" id="3915864">30</span>&nbsp;<span class="op" id="3915867">*</span>&nbsp;<span class="ident" id="3915869"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3915873">.</span><span class="ident" id="3915874">Second</span><span class="op" id="3915880">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3915883">}</span><span class="op" id="3915884">)</span><span class="op" id="3915885">.</span><span class="ident" id="3915886">Dial</span><span class="op" id="3915890">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3915893">TLSHandshakeTimeout</span><span class="op" id="3915912">:</span>&nbsp;<span class="num" id="3915914">10</span>&nbsp;<span class="op" id="3915917">*</span>&nbsp;<span class="ident" id="3915919"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3915923">.</span><span class="ident" id="3915924">Second</span><span class="op" id="3915930">,</span><br>
<span class="lineno">40</span><span class="op" id="3915932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3915935">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;the&nbsp;default&nbsp;value&nbsp;of&nbsp;Transport&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3916001">//&nbsp;MaxIdleConnsPerHost.</span><br>
<span class="lineno"></span><span class="keyword" id="3916025">const</span>&nbsp;<span class="ident" id="3916031">DefaultMaxIdleConnsPerHost</span>&nbsp;<span class="op" id="3916058">=</span>&nbsp;<span class="num" id="3916060">2</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="3916063">//&nbsp;Transport&nbsp;is&nbsp;an&nbsp;implementation&nbsp;of&nbsp;RoundTripper&nbsp;that&nbsp;supports&nbsp;HTTP,</span><br>
<span class="lineno"></span><span class="comment" id="3916133">//&nbsp;HTTPS,&nbsp;and&nbsp;HTTP&nbsp;proxies&nbsp;(for&nbsp;either&nbsp;HTTP&nbsp;or&nbsp;HTTPS&nbsp;with&nbsp;CONNECT).</span><br>
<span class="lineno"></span><span class="comment" id="3916201">//&nbsp;Transport&nbsp;can&nbsp;also&nbsp;cache&nbsp;connections&nbsp;for&nbsp;future&nbsp;re-use.</span><br>
<span class="lineno"></span><span class="keyword" id="3916260">type</span>&nbsp;<span class="ident" id="3916265">Transport</span>&nbsp;<span class="keyword" id="3916275">struct</span>&nbsp;<span class="op" id="3916282">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916285">idleMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3916296"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3916300">.</span><span class="ident" id="3916301">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916308">wantIdle</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3916319">bool</span>&nbsp;<span class="comment" id="3916324">//&nbsp;user&nbsp;has&nbsp;requested&nbsp;to&nbsp;close&nbsp;all&nbsp;idle&nbsp;conns</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916371">idleConn</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="3916382">map</span><span class="op" id="3916385">[</span><span class="ident" id="3916386"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3916402">]</span><span class="op" id="3916403">[</span><span class="op" id="3916404">]</span><span class="op" id="3916405">*</span><span class="ident" id="3916406"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916419">idleConnCh</span>&nbsp;<span class="keyword" id="3916430">map</span><span class="op" id="3916433">[</span><span class="ident" id="3916434"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3916450">]</span><span class="keyword" id="3916451">chan</span>&nbsp;<span class="op" id="3916456">*</span><span class="ident" id="3916457"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916471">reqMu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3916483"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3916487">.</span><span class="ident" id="3916488">Mutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916495">reqCanceler</span>&nbsp;<span class="keyword" id="3916507">map</span><span class="op" id="3916510">[</span><span class="op" id="3916511">*</span><span class="ident" id="3916512"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3916519">]</span><span class="keyword" id="3916520">func</span><span class="op" id="3916524">(</span><span class="op" id="3916525">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916529">altMu</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3916538"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3916542">.</span><span class="ident" id="3916543">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916552">altProto</span>&nbsp;<span class="keyword" id="3916561">map</span><span class="op" id="3916564">[</span><span class="builtintype" id="3916565">string</span><span class="op" id="3916571">]</span><span class="ident" id="3916572"><a href="/net/http/client.go.html#3738099">RoundTripper</a></span>&nbsp;<span class="comment" id="3916585">//&nbsp;nil&nbsp;or&nbsp;map&nbsp;of&nbsp;URI&nbsp;scheme&nbsp;=&gt;&nbsp;RoundTripper</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916631">//&nbsp;Proxy&nbsp;specifies&nbsp;a&nbsp;function&nbsp;to&nbsp;return&nbsp;a&nbsp;proxy&nbsp;for&nbsp;a&nbsp;given</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916692">//&nbsp;Request.&nbsp;If&nbsp;the&nbsp;function&nbsp;returns&nbsp;a&nbsp;non-nil&nbsp;error,&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916750">//&nbsp;request&nbsp;is&nbsp;aborted&nbsp;with&nbsp;the&nbsp;provided&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916798">//&nbsp;If&nbsp;Proxy&nbsp;is&nbsp;nil&nbsp;or&nbsp;returns&nbsp;a&nbsp;nil&nbsp;*URL,&nbsp;no&nbsp;proxy&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3916859">Proxy</span>&nbsp;<span class="keyword" id="3916865">func</span><span class="op" id="3916869">(</span><span class="op" id="3916870">*</span><span class="ident" id="3916871"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3916878">)</span>&nbsp;<span class="op" id="3916880">(</span><span class="op" id="3916881">*</span><span class="ident" id="3916882"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3916885">.</span><span class="ident" id="3916886">URL</span><span class="op" id="3916889">,</span>&nbsp;<span class="builtintype" id="3916891">error</span><span class="op" id="3916896">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916900">//&nbsp;Dial&nbsp;specifies&nbsp;the&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating&nbsp;unencrypted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916962">//&nbsp;TCP&nbsp;connections.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3916983">//&nbsp;If&nbsp;Dial&nbsp;is&nbsp;nil,&nbsp;net.Dial&nbsp;is&nbsp;used.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917021">Dial</span>&nbsp;<span class="keyword" id="3917026">func</span><span class="op" id="3917030">(</span><span class="ident" id="3917031">network</span><span class="op" id="3917038">,</span>&nbsp;<span class="ident" id="3917040">addr</span>&nbsp;<span class="builtintype" id="3917045">string</span><span class="op" id="3917051">)</span>&nbsp;<span class="op" id="3917053">(</span><span class="ident" id="3917054"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3917057">.</span><span class="ident" id="3917058">Conn</span><span class="op" id="3917062">,</span>&nbsp;<span class="builtintype" id="3917064">error</span><span class="op" id="3917069">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917073">//&nbsp;DialTLS&nbsp;specifies&nbsp;an&nbsp;optional&nbsp;dial&nbsp;function&nbsp;for&nbsp;creating</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917134">//&nbsp;TLS&nbsp;connections&nbsp;for&nbsp;non-proxied&nbsp;HTTPS&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917186">//</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917190">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;nil,&nbsp;Dial&nbsp;and&nbsp;TLSClientConfig&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917248">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917252">//&nbsp;If&nbsp;DialTLS&nbsp;is&nbsp;set,&nbsp;the&nbsp;Dial&nbsp;hook&nbsp;is&nbsp;not&nbsp;used&nbsp;for&nbsp;HTTPS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917311">//&nbsp;requests&nbsp;and&nbsp;the&nbsp;TLSClientConfig&nbsp;and&nbsp;TLSHandshakeTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917372">//&nbsp;are&nbsp;ignored.&nbsp;The&nbsp;returned&nbsp;net.Conn&nbsp;is&nbsp;assumed&nbsp;to&nbsp;already&nbsp;be</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917436">//&nbsp;past&nbsp;the&nbsp;TLS&nbsp;handshake.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917464">DialTLS</span>&nbsp;<span class="keyword" id="3917472">func</span><span class="op" id="3917476">(</span><span class="ident" id="3917477">network</span><span class="op" id="3917484">,</span>&nbsp;<span class="ident" id="3917486">addr</span>&nbsp;<span class="builtintype" id="3917491">string</span><span class="op" id="3917497">)</span>&nbsp;<span class="op" id="3917499">(</span><span class="ident" id="3917500"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3917503">.</span><span class="ident" id="3917504">Conn</span><span class="op" id="3917508">,</span>&nbsp;<span class="builtintype" id="3917510">error</span><span class="op" id="3917515">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917519">//&nbsp;TLSClientConfig&nbsp;specifies&nbsp;the&nbsp;TLS&nbsp;configuration&nbsp;to&nbsp;use&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917583">//&nbsp;tls.Client.&nbsp;If&nbsp;nil,&nbsp;the&nbsp;default&nbsp;configuration&nbsp;is&nbsp;used.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917642">TLSClientConfig</span>&nbsp;<span class="op" id="3917658">*</span><span class="ident" id="3917659"><a href="/net/http/transport.go.html#3915307">tls</a></span><span class="op" id="3917662">.</span><span class="ident" id="3917663">Config</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917672">//&nbsp;TLSHandshakeTimeout&nbsp;specifies&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;waiting&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917744">//&nbsp;wait&nbsp;for&nbsp;a&nbsp;TLS&nbsp;handshake.&nbsp;Zero&nbsp;means&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917797">TLSHandshakeTimeout</span>&nbsp;<span class="ident" id="3917817"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3917821">.</span><span class="ident" id="3917822">Duration</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917833">//&nbsp;DisableKeepAlives,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;re-use&nbsp;of&nbsp;TCP&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917900">//&nbsp;between&nbsp;different&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3917937">DisableKeepAlives</span>&nbsp;<span class="builtintype" id="3917955">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3917962">//&nbsp;DisableCompression,&nbsp;if&nbsp;true,&nbsp;prevents&nbsp;the&nbsp;Transport&nbsp;from</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918023">//&nbsp;requesting&nbsp;compression&nbsp;with&nbsp;an&nbsp;&#34;Accept-Encoding:&nbsp;gzip&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918082">//&nbsp;request&nbsp;header&nbsp;when&nbsp;the&nbsp;Request&nbsp;contains&nbsp;no&nbsp;existing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918139">//&nbsp;Accept-Encoding&nbsp;value.&nbsp;If&nbsp;the&nbsp;Transport&nbsp;requests&nbsp;gzip&nbsp;on</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918200">//&nbsp;its&nbsp;own&nbsp;and&nbsp;gets&nbsp;a&nbsp;gzipped&nbsp;response,&nbsp;it&#39;s&nbsp;transparently</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918260">//&nbsp;decoded&nbsp;in&nbsp;the&nbsp;Response.Body.&nbsp;However,&nbsp;if&nbsp;the&nbsp;user</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918315">//&nbsp;explicitly&nbsp;requested&nbsp;gzip&nbsp;it&nbsp;is&nbsp;not&nbsp;automatically</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918369">//&nbsp;uncompressed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918387">DisableCompression</span>&nbsp;<span class="builtintype" id="3918406">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918413">//&nbsp;MaxIdleConnsPerHost,&nbsp;if&nbsp;non-zero,&nbsp;controls&nbsp;the&nbsp;maximum&nbsp;idle</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918477">//&nbsp;(keep-alive)&nbsp;to&nbsp;keep&nbsp;per-host.&nbsp;&nbsp;If&nbsp;zero,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918522">//&nbsp;DefaultMaxIdleConnsPerHost&nbsp;is&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918562">MaxIdleConnsPerHost</span>&nbsp;<span class="builtintype" id="3918582">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918588">//&nbsp;ResponseHeaderTimeout,&nbsp;if&nbsp;non-zero,&nbsp;specifies&nbsp;the&nbsp;amount&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918652">//&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;a&nbsp;server&#39;s&nbsp;response&nbsp;headers&nbsp;after&nbsp;fully</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918713">//&nbsp;writing&nbsp;the&nbsp;request&nbsp;(including&nbsp;its&nbsp;body,&nbsp;if&nbsp;any).&nbsp;This</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918772">//&nbsp;time&nbsp;does&nbsp;not&nbsp;include&nbsp;the&nbsp;time&nbsp;to&nbsp;read&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3918834">ResponseHeaderTimeout</span>&nbsp;<span class="ident" id="3918856"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3918860">.</span><span class="ident" id="3918861">Duration</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918872">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;global&nbsp;max&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3918923">//&nbsp;TODO:&nbsp;tunable&nbsp;on&nbsp;timeout&nbsp;on&nbsp;cached&nbsp;connections</span><br>
<span class="lineno"></span><span class="op" id="3918973">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span><span class="comment" id="3918976">//&nbsp;ProxyFromEnvironment&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;proxy&nbsp;to&nbsp;use&nbsp;for&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3919042">//&nbsp;given&nbsp;request,&nbsp;as&nbsp;indicated&nbsp;by&nbsp;the&nbsp;environment&nbsp;variables</span><br>
<span class="lineno"></span><span class="comment" id="3919102">//&nbsp;HTTP_PROXY,&nbsp;HTTPS_PROXY&nbsp;and&nbsp;NO_PROXY&nbsp;(or&nbsp;the&nbsp;lowercase&nbsp;versions</span><br>
<span class="lineno"></span><span class="comment" id="3919169">//&nbsp;thereof).&nbsp;HTTPS_PROXY&nbsp;takes&nbsp;precedence&nbsp;over&nbsp;HTTP_PROXY&nbsp;for&nbsp;https</span><br>
<span class="lineno"></span><span class="comment" id="3919237">//&nbsp;requests.</span><br>
<span class="lineno">125</span><span class="comment" id="3919250">//</span><br>
<span class="lineno"></span><span class="comment" id="3919253">//&nbsp;The&nbsp;environment&nbsp;values&nbsp;may&nbsp;be&nbsp;either&nbsp;a&nbsp;complete&nbsp;URL&nbsp;or&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3919313">//&nbsp;&#34;host[:port]&#34;,&nbsp;in&nbsp;which&nbsp;case&nbsp;the&nbsp;&#34;http&#34;&nbsp;scheme&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3919375">//&nbsp;An&nbsp;error&nbsp;is&nbsp;returned&nbsp;if&nbsp;the&nbsp;value&nbsp;is&nbsp;a&nbsp;different&nbsp;form.</span><br>
<span class="lineno"></span><span class="comment" id="3919433">//</span><br>
<span class="lineno">130</span><span class="comment" id="3919436">//&nbsp;A&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;are&nbsp;returned&nbsp;if&nbsp;no&nbsp;proxy&nbsp;is&nbsp;defined&nbsp;in&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3919506">//&nbsp;environment,&nbsp;or&nbsp;a&nbsp;proxy&nbsp;should&nbsp;not&nbsp;be&nbsp;used&nbsp;for&nbsp;the&nbsp;given&nbsp;request,</span><br>
<span class="lineno"></span><span class="comment" id="3919575">//&nbsp;as&nbsp;defined&nbsp;by&nbsp;NO_PROXY.</span><br>
<span class="lineno"></span><span class="comment" id="3919602">//</span><br>
<span class="lineno"></span><span class="comment" id="3919605">//&nbsp;As&nbsp;a&nbsp;special&nbsp;case,&nbsp;if&nbsp;req.URL.Host&nbsp;is&nbsp;&#34;localhost&#34;&nbsp;(with&nbsp;or&nbsp;without</span><br>
<span class="lineno">135</span><span class="comment" id="3919675">//&nbsp;a&nbsp;port&nbsp;number),&nbsp;then&nbsp;a&nbsp;nil&nbsp;URL&nbsp;and&nbsp;nil&nbsp;error&nbsp;will&nbsp;be&nbsp;returned.</span><br>
<span class="lineno"></span><span class="keyword" id="3919741">func</span>&nbsp;<span class="ident" id="3919746">ProxyFromEnvironment</span><span class="op" id="3919766">(</span><span class="ident" id="3919767">req</span>&nbsp;<span class="op" id="3919771">*</span><span class="ident" id="3919772"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3919779">)</span>&nbsp;<span class="op" id="3919781">(</span><span class="op" id="3919782">*</span><span class="ident" id="3919783"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3919786">.</span><span class="ident" id="3919787">URL</span><span class="op" id="3919790">,</span>&nbsp;<span class="builtintype" id="3919792">error</span><span class="op" id="3919797">)</span>&nbsp;<span class="op" id="3919799">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919802">var</span>&nbsp;<span class="ident" id="3919806">proxy</span>&nbsp;<span class="builtintype" id="3919812">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919820">if</span>&nbsp;<span class="ident" id="3919823"><a href="/net/http/transport.go.html#3919767">req</a></span><span class="op" id="3919826">.</span><span class="ident" id="3919827">URL</span><span class="op" id="3919830">.</span><span class="ident" id="3919831">Scheme</span>&nbsp;<span class="op" id="3919838">==</span>&nbsp;<span class="string" id="3919841">&#34;https&#34;</span>&nbsp;<span class="op" id="3919849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919853"><a href="/net/http/transport.go.html#3919806">proxy</a></span>&nbsp;<span class="op" id="3919859">=</span>&nbsp;<span class="ident" id="3919861"><a href="/net/http/transport.go.html#3924035">httpsProxyEnv</a></span><span class="op" id="3919874">.</span><span class="ident" id="3919875">Get</span><span class="op" id="3919878">(</span><span class="op" id="3919879">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919885">if</span>&nbsp;<span class="ident" id="3919888"><a href="/net/http/transport.go.html#3919806">proxy</a></span>&nbsp;<span class="op" id="3919894">==</span>&nbsp;<span class="string" id="3919897">&#34;&#34;</span>&nbsp;<span class="op" id="3919900">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3919904"><a href="/net/http/transport.go.html#3919806">proxy</a></span>&nbsp;<span class="op" id="3919910">=</span>&nbsp;<span class="ident" id="3919912"><a href="/net/http/transport.go.html#3923959">httpProxyEnv</a></span><span class="op" id="3919924">.</span><span class="ident" id="3919925">Get</span><span class="op" id="3919928">(</span><span class="op" id="3919929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919935">if</span>&nbsp;<span class="ident" id="3919938"><a href="/net/http/transport.go.html#3919806">proxy</a></span>&nbsp;<span class="op" id="3919944">==</span>&nbsp;<span class="string" id="3919947">&#34;&#34;</span>&nbsp;<span class="op" id="3919950">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919954">return</span>&nbsp;<span class="ident" id="3919961">nil</span><span class="op" id="3919964">,</span>&nbsp;<span class="ident" id="3919966">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3919971">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3919974">if</span>&nbsp;<span class="op" id="3919977">!</span><span class="ident" id="3919978"><a href="/net/http/transport.go.html#3932992">useProxy</a></span><span class="op" id="3919986">(</span><span class="ident" id="3919987"><a href="/net/http/transport.go.html#3946635">canonicalAddr</a></span><span class="op" id="3920000">(</span><span class="ident" id="3920001"><a href="/net/http/transport.go.html#3919767">req</a></span><span class="op" id="3920004">.</span><span class="ident" id="3920005">URL</span><span class="op" id="3920008">)</span><span class="op" id="3920009">)</span>&nbsp;<span class="op" id="3920011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920015">return</span>&nbsp;<span class="ident" id="3920022">nil</span><span class="op" id="3920025">,</span>&nbsp;<span class="ident" id="3920027">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920032">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920035">proxyURL</span><span class="op" id="3920043">,</span>&nbsp;<span class="ident" id="3920045">err</span>&nbsp;<span class="op" id="3920049">:=</span>&nbsp;<span class="ident" id="3920052"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3920055">.</span><span class="ident" id="3920056">Parse</span><span class="op" id="3920061">(</span><span class="ident" id="3920062"><a href="/net/http/transport.go.html#3919806">proxy</a></span><span class="op" id="3920067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920070">if</span>&nbsp;<span class="ident" id="3920073"><a href="/net/http/transport.go.html#3920045">err</a></span>&nbsp;<span class="op" id="3920077">!=</span>&nbsp;<span class="ident" id="3920080">nil</span>&nbsp;<span class="op" id="3920084">||</span>&nbsp;<span class="op" id="3920087">!</span><span class="ident" id="3920088"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3920095">.</span><span class="ident" id="3920096">HasPrefix</span><span class="op" id="3920105">(</span><span class="ident" id="3920106"><a href="/net/http/transport.go.html#3920035">proxyURL</a></span><span class="op" id="3920114">.</span><span class="ident" id="3920115">Scheme</span><span class="op" id="3920121">,</span>&nbsp;<span class="string" id="3920123">&#34;http&#34;</span><span class="op" id="3920129">)</span>&nbsp;<span class="op" id="3920131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920135">//&nbsp;proxy&nbsp;was&nbsp;bogus.&nbsp;Try&nbsp;prepending&nbsp;&#34;http://&#34;&nbsp;to&nbsp;it&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920192">//&nbsp;see&nbsp;if&nbsp;that&nbsp;parses&nbsp;correctly.&nbsp;If&nbsp;not,&nbsp;we&nbsp;fall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3920243">//&nbsp;through&nbsp;and&nbsp;complain&nbsp;about&nbsp;the&nbsp;original&nbsp;one.</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920293">if</span>&nbsp;<span class="ident" id="3920296">proxyURL</span><span class="op" id="3920304">,</span>&nbsp;<span class="ident" id="3920306">err</span>&nbsp;<span class="op" id="3920310">:=</span>&nbsp;<span class="ident" id="3920313"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3920316">.</span><span class="ident" id="3920317">Parse</span><span class="op" id="3920322">(</span><span class="string" id="3920323">&#34;http://&#34;</span>&nbsp;<span class="op" id="3920333">+</span>&nbsp;<span class="ident" id="3920335"><a href="/net/http/transport.go.html#3919806">proxy</a></span><span class="op" id="3920340">)</span><span class="op" id="3920341">;</span>&nbsp;<span class="ident" id="3920343"><a href="/net/http/transport.go.html#3920306">err</a></span>&nbsp;<span class="op" id="3920347">==</span>&nbsp;<span class="ident" id="3920350">nil</span>&nbsp;<span class="op" id="3920354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920359">return</span>&nbsp;<span class="ident" id="3920366"><a href="/net/http/transport.go.html#3920296">proxyURL</a></span><span class="op" id="3920374">,</span>&nbsp;<span class="ident" id="3920376">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920382">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920385">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920388">if</span>&nbsp;<span class="ident" id="3920391"><a href="/net/http/transport.go.html#3920045">err</a></span>&nbsp;<span class="op" id="3920395">!=</span>&nbsp;<span class="ident" id="3920398">nil</span>&nbsp;<span class="op" id="3920402">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920406">return</span>&nbsp;<span class="ident" id="3920413">nil</span><span class="op" id="3920416">,</span>&nbsp;<span class="ident" id="3920418"><a href="/net/http/transport.go.html#3915331">fmt</a></span><span class="op" id="3920421">.</span><span class="ident" id="3920422">Errorf</span><span class="op" id="3920428">(</span><span class="string" id="3920429">&#34;invalid&nbsp;proxy&nbsp;address&nbsp;%q:&nbsp;%v&#34;</span><span class="op" id="3920459">,</span>&nbsp;<span class="ident" id="3920461"><a href="/net/http/transport.go.html#3919806">proxy</a></span><span class="op" id="3920466">,</span>&nbsp;<span class="ident" id="3920468"><a href="/net/http/transport.go.html#3920045">err</a></span><span class="op" id="3920471">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920474">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920477">return</span>&nbsp;<span class="ident" id="3920484"><a href="/net/http/transport.go.html#3920035">proxyURL</a></span><span class="op" id="3920492">,</span>&nbsp;<span class="ident" id="3920494">nil</span><br>
<span class="lineno"></span><span class="op" id="3920498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="3920501">//&nbsp;ProxyURL&nbsp;returns&nbsp;a&nbsp;proxy&nbsp;function&nbsp;(for&nbsp;use&nbsp;in&nbsp;a&nbsp;Transport)</span><br>
<span class="lineno"></span><span class="comment" id="3920563">//&nbsp;that&nbsp;always&nbsp;returns&nbsp;the&nbsp;same&nbsp;URL.</span><br>
<span class="lineno"></span><span class="keyword" id="3920600">func</span>&nbsp;<span class="ident" id="3920605">ProxyURL</span><span class="op" id="3920613">(</span><span class="ident" id="3920614">fixedURL</span>&nbsp;<span class="op" id="3920623">*</span><span class="ident" id="3920624"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3920627">.</span><span class="ident" id="3920628">URL</span><span class="op" id="3920631">)</span>&nbsp;<span class="keyword" id="3920633">func</span><span class="op" id="3920637">(</span><span class="op" id="3920638">*</span><span class="ident" id="3920639"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3920646">)</span>&nbsp;<span class="op" id="3920648">(</span><span class="op" id="3920649">*</span><span class="ident" id="3920650"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3920653">.</span><span class="ident" id="3920654">URL</span><span class="op" id="3920657">,</span>&nbsp;<span class="builtintype" id="3920659">error</span><span class="op" id="3920664">)</span>&nbsp;<span class="op" id="3920666">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920669">return</span>&nbsp;<span class="keyword" id="3920676">func</span><span class="op" id="3920680">(</span><span class="op" id="3920681">*</span><span class="ident" id="3920682"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3920689">)</span>&nbsp;<span class="op" id="3920691">(</span><span class="op" id="3920692">*</span><span class="ident" id="3920693"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3920696">.</span><span class="ident" id="3920697">URL</span><span class="op" id="3920700">,</span>&nbsp;<span class="builtintype" id="3920702">error</span><span class="op" id="3920707">)</span>&nbsp;<span class="op" id="3920709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3920713">return</span>&nbsp;<span class="ident" id="3920720"><a href="/net/http/transport.go.html#3920614">fixedURL</a></span><span class="op" id="3920728">,</span>&nbsp;<span class="ident" id="3920730">nil</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920735">}</span><br>
<span class="lineno"></span><span class="op" id="3920737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3920740">//&nbsp;transportRequest&nbsp;is&nbsp;a&nbsp;wrapper&nbsp;around&nbsp;a&nbsp;*Request&nbsp;that&nbsp;adds</span><br>
<span class="lineno"></span><span class="comment" id="3920801">//&nbsp;optional&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write.</span><br>
<span class="lineno">175</span><span class="keyword" id="3920837">type</span>&nbsp;<span class="ident" id="3920842">transportRequest</span>&nbsp;<span class="keyword" id="3920859">struct</span>&nbsp;<span class="op" id="3920866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3920869">*</span><span class="ident" id="3920870"><a href="/net/http/request.go.html#3791418">Request</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3920885">//&nbsp;original&nbsp;request,&nbsp;not&nbsp;to&nbsp;be&nbsp;mutated</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3920925">extra</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3920934"><a href="/net/http/header.go.html#3781581">Header</a></span>&nbsp;<span class="comment" id="3920941">//&nbsp;extra&nbsp;headers&nbsp;to&nbsp;write,&nbsp;or&nbsp;nil</span><br>
<span class="lineno"></span><span class="op" id="3920975">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="keyword" id="3920978">func</span>&nbsp;<span class="op" id="3920983">(</span><span class="ident" id="3920984">tr</span>&nbsp;<span class="op" id="3920987">*</span><span class="ident" id="3920988"><a href="/net/http/transport.go.html#3920842">transportRequest</a></span><span class="op" id="3921004">)</span>&nbsp;<span class="ident" id="3921006">extraHeaders</span><span class="op" id="3921018">(</span><span class="op" id="3921019">)</span>&nbsp;<span class="ident" id="3921021"><a href="/net/http/header.go.html#3781581">Header</a></span>&nbsp;<span class="op" id="3921028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921031">if</span>&nbsp;<span class="ident" id="3921034"><a href="/net/http/transport.go.html#3920984">tr</a></span><span class="op" id="3921036">.</span><span class="ident" id="3921037">extra</span>&nbsp;<span class="op" id="3921043">==</span>&nbsp;<span class="ident" id="3921046">nil</span>&nbsp;<span class="op" id="3921050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921054"><a href="/net/http/transport.go.html#3920984">tr</a></span><span class="op" id="3921056">.</span><span class="ident" id="3921057">extra</span>&nbsp;<span class="op" id="3921063">=</span>&nbsp;<span class="builtinfunc" id="3921065">make</span><span class="op" id="3921069">(</span><span class="ident" id="3921070"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3921076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921079">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921082">return</span>&nbsp;<span class="ident" id="3921089"><a href="/net/http/transport.go.html#3920984">tr</a></span><span class="op" id="3921091">.</span><span class="ident" id="3921092">extra</span><br>
<span class="lineno">185</span><span class="op" id="3921098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3921101">//&nbsp;RoundTrip&nbsp;implements&nbsp;the&nbsp;RoundTripper&nbsp;interface.</span><br>
<span class="lineno"></span><span class="comment" id="3921153">//</span><br>
<span class="lineno"></span><span class="comment" id="3921156">//&nbsp;For&nbsp;higher-level&nbsp;HTTP&nbsp;client&nbsp;support&nbsp;(such&nbsp;as&nbsp;handling&nbsp;of&nbsp;cookies</span><br>
<span class="lineno">190</span><span class="comment" id="3921225">//&nbsp;and&nbsp;redirects),&nbsp;see&nbsp;Get,&nbsp;Post,&nbsp;and&nbsp;the&nbsp;Client&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="3921280">func</span>&nbsp;<span class="op" id="3921285">(</span><span class="ident" id="3921286">t</span>&nbsp;<span class="op" id="3921288">*</span><span class="ident" id="3921289"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3921298">)</span>&nbsp;<span class="ident" id="3921300">RoundTrip</span><span class="op" id="3921309">(</span><span class="ident" id="3921310">req</span>&nbsp;<span class="op" id="3921314">*</span><span class="ident" id="3921315"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3921322">)</span>&nbsp;<span class="op" id="3921324">(</span><span class="ident" id="3921325">resp</span>&nbsp;<span class="op" id="3921330">*</span><span class="ident" id="3921331"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3921339">,</span>&nbsp;<span class="ident" id="3921341">err</span>&nbsp;<span class="builtintype" id="3921345">error</span><span class="op" id="3921350">)</span>&nbsp;<span class="op" id="3921352">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921355">if</span>&nbsp;<span class="ident" id="3921358"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921361">.</span><span class="ident" id="3921362">URL</span>&nbsp;<span class="op" id="3921366">==</span>&nbsp;<span class="ident" id="3921369">nil</span>&nbsp;<span class="op" id="3921373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921377"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921380">.</span><span class="ident" id="3921381">closeBody</span><span class="op" id="3921390">(</span><span class="op" id="3921391">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921395">return</span>&nbsp;<span class="ident" id="3921402">nil</span><span class="op" id="3921405">,</span>&nbsp;<span class="ident" id="3921407"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3921413">.</span><span class="ident" id="3921414">New</span><span class="op" id="3921417">(</span><span class="string" id="3921418">&#34;http:&nbsp;nil&nbsp;Request.URL&#34;</span><span class="op" id="3921441">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921444">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921447">if</span>&nbsp;<span class="ident" id="3921450"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921453">.</span><span class="ident" id="3921454">Header</span>&nbsp;<span class="op" id="3921461">==</span>&nbsp;<span class="ident" id="3921464">nil</span>&nbsp;<span class="op" id="3921468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921472"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921475">.</span><span class="ident" id="3921476">closeBody</span><span class="op" id="3921485">(</span><span class="op" id="3921486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921490">return</span>&nbsp;<span class="ident" id="3921497">nil</span><span class="op" id="3921500">,</span>&nbsp;<span class="ident" id="3921502"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3921508">.</span><span class="ident" id="3921509">New</span><span class="op" id="3921512">(</span><span class="string" id="3921513">&#34;http:&nbsp;nil&nbsp;Request.Header&#34;</span><span class="op" id="3921539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921542">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921545">if</span>&nbsp;<span class="ident" id="3921548"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921551">.</span><span class="ident" id="3921552">URL</span><span class="op" id="3921555">.</span><span class="ident" id="3921556">Scheme</span>&nbsp;<span class="op" id="3921563">!=</span>&nbsp;<span class="string" id="3921566">&#34;http&#34;</span>&nbsp;<span class="op" id="3921573">&amp;&amp;</span>&nbsp;<span class="ident" id="3921576"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921579">.</span><span class="ident" id="3921580">URL</span><span class="op" id="3921583">.</span><span class="ident" id="3921584">Scheme</span>&nbsp;<span class="op" id="3921591">!=</span>&nbsp;<span class="string" id="3921594">&#34;https&#34;</span>&nbsp;<span class="op" id="3921602">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921606"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3921607">.</span><span class="ident" id="3921608">altMu</span><span class="op" id="3921613">.</span><span class="ident" id="3921614">RLock</span><span class="op" id="3921619">(</span><span class="op" id="3921620">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921624">var</span>&nbsp;<span class="ident" id="3921628">rt</span>&nbsp;<span class="ident" id="3921631"><a href="/net/http/client.go.html#3738099">RoundTripper</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921646">if</span>&nbsp;<span class="ident" id="3921649"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3921650">.</span><span class="ident" id="3921651">altProto</span>&nbsp;<span class="op" id="3921660">!=</span>&nbsp;<span class="ident" id="3921663">nil</span>&nbsp;<span class="op" id="3921667">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921672"><a href="/net/http/transport.go.html#3921628">rt</a></span>&nbsp;<span class="op" id="3921675">=</span>&nbsp;<span class="ident" id="3921677"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3921678">.</span><span class="ident" id="3921679">altProto</span><span class="op" id="3921687">[</span><span class="ident" id="3921688"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921691">.</span><span class="ident" id="3921692">URL</span><span class="op" id="3921695">.</span><span class="ident" id="3921696">Scheme</span><span class="op" id="3921702">]</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921710"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3921711">.</span><span class="ident" id="3921712">altMu</span><span class="op" id="3921717">.</span><span class="ident" id="3921718">RUnlock</span><span class="op" id="3921725">(</span><span class="op" id="3921726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921730">if</span>&nbsp;<span class="ident" id="3921733"><a href="/net/http/transport.go.html#3921628">rt</a></span>&nbsp;<span class="op" id="3921736">==</span>&nbsp;<span class="ident" id="3921739">nil</span>&nbsp;<span class="op" id="3921743">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921748"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921751">.</span><span class="ident" id="3921752">closeBody</span><span class="op" id="3921761">(</span><span class="op" id="3921762">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921767">return</span>&nbsp;<span class="ident" id="3921774">nil</span><span class="op" id="3921777">,</span>&nbsp;<span class="op" id="3921779">&amp;</span><span class="ident" id="3921780"><a href="/net/http/request.go.html#3790712">badStringError</a></span><span class="op" id="3921794">{</span><span class="string" id="3921795">&#34;unsupported&nbsp;protocol&nbsp;scheme&#34;</span><span class="op" id="3921824">,</span>&nbsp;<span class="ident" id="3921826"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921829">.</span><span class="ident" id="3921830">URL</span><span class="op" id="3921833">.</span><span class="ident" id="3921834">Scheme</span><span class="op" id="3921840">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921844">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921848">return</span>&nbsp;<span class="ident" id="3921855"><a href="/net/http/transport.go.html#3921628">rt</a></span><span class="op" id="3921857">.</span><span class="ident" id="3921858">RoundTrip</span><span class="op" id="3921867">(</span><span class="ident" id="3921868"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921874">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921877">if</span>&nbsp;<span class="ident" id="3921880"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921883">.</span><span class="ident" id="3921884">URL</span><span class="op" id="3921887">.</span><span class="ident" id="3921888">Host</span>&nbsp;<span class="op" id="3921893">==</span>&nbsp;<span class="string" id="3921896">&#34;&#34;</span>&nbsp;<span class="op" id="3921899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921903"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3921906">.</span><span class="ident" id="3921907">closeBody</span><span class="op" id="3921916">(</span><span class="op" id="3921917">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3921921">return</span>&nbsp;<span class="ident" id="3921928">nil</span><span class="op" id="3921931">,</span>&nbsp;<span class="ident" id="3921933"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3921939">.</span><span class="ident" id="3921940">New</span><span class="op" id="3921943">(</span><span class="string" id="3921944">&#34;http:&nbsp;no&nbsp;Host&nbsp;in&nbsp;request&nbsp;URL&#34;</span><span class="op" id="3921974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3921977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3921980">treq</span>&nbsp;<span class="op" id="3921985">:=</span>&nbsp;<span class="op" id="3921988">&amp;</span><span class="ident" id="3921989"><a href="/net/http/transport.go.html#3920842">transportRequest</a></span><span class="op" id="3922005">{</span><span class="ident" id="3922006">Request</span><span class="op" id="3922013">:</span>&nbsp;<span class="ident" id="3922015"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3922018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922021">cm</span><span class="op" id="3922023">,</span>&nbsp;<span class="ident" id="3922025"><a href="/net/http/transport.go.html#3921341">err</a></span>&nbsp;<span class="op" id="3922029">:=</span>&nbsp;<span class="ident" id="3922032"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3922033">.</span><span class="ident" id="3922034">connectMethodForRequest</span><span class="op" id="3922057">(</span><span class="ident" id="3922058"><a href="/net/http/transport.go.html#3921980">treq</a></span><span class="op" id="3922062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922065">if</span>&nbsp;<span class="ident" id="3922068"><a href="/net/http/transport.go.html#3921341">err</a></span>&nbsp;<span class="op" id="3922072">!=</span>&nbsp;<span class="ident" id="3922075">nil</span>&nbsp;<span class="op" id="3922079">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922083"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3922086">.</span><span class="ident" id="3922087">closeBody</span><span class="op" id="3922096">(</span><span class="op" id="3922097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922101">return</span>&nbsp;<span class="ident" id="3922108">nil</span><span class="op" id="3922111">,</span>&nbsp;<span class="ident" id="3922113"><a href="/net/http/transport.go.html#3921341">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922118">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922122">//&nbsp;Get&nbsp;the&nbsp;cached&nbsp;or&nbsp;newly-created&nbsp;connection&nbsp;to&nbsp;either&nbsp;the</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922183">//&nbsp;host&nbsp;(for&nbsp;http&nbsp;or&nbsp;https),&nbsp;the&nbsp;http&nbsp;proxy,&nbsp;or&nbsp;the&nbsp;http&nbsp;proxy</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922247">//&nbsp;pre-CONNECTed&nbsp;to&nbsp;https&nbsp;server.&nbsp;&nbsp;In&nbsp;any&nbsp;case,&nbsp;we&#39;ll&nbsp;be&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3922311">//&nbsp;to&nbsp;send&nbsp;it&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922336">pconn</span><span class="op" id="3922341">,</span>&nbsp;<span class="ident" id="3922343"><a href="/net/http/transport.go.html#3921341">err</a></span>&nbsp;<span class="op" id="3922347">:=</span>&nbsp;<span class="ident" id="3922350"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3922351">.</span><span class="ident" id="3922352">getConn</span><span class="op" id="3922359">(</span><span class="ident" id="3922360"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3922363">,</span>&nbsp;<span class="ident" id="3922365"><a href="/net/http/transport.go.html#3922021">cm</a></span><span class="op" id="3922367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922370">if</span>&nbsp;<span class="ident" id="3922373"><a href="/net/http/transport.go.html#3921341">err</a></span>&nbsp;<span class="op" id="3922377">!=</span>&nbsp;<span class="ident" id="3922380">nil</span>&nbsp;<span class="op" id="3922384">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922388"><a href="/net/http/transport.go.html#3921286">t</a></span><span class="op" id="3922389">.</span><span class="ident" id="3922390">setReqCanceler</span><span class="op" id="3922404">(</span><span class="ident" id="3922405"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3922408">,</span>&nbsp;<span class="ident" id="3922410">nil</span><span class="op" id="3922413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922417"><a href="/net/http/transport.go.html#3921310">req</a></span><span class="op" id="3922420">.</span><span class="ident" id="3922421">closeBody</span><span class="op" id="3922430">(</span><span class="op" id="3922431">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922435">return</span>&nbsp;<span class="ident" id="3922442">nil</span><span class="op" id="3922445">,</span>&nbsp;<span class="ident" id="3922447"><a href="/net/http/transport.go.html#3921341">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922452">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922456">return</span>&nbsp;<span class="ident" id="3922463"><a href="/net/http/transport.go.html#3922336">pconn</a></span><span class="op" id="3922468">.</span><span class="ident" id="3922469">roundTrip</span><span class="op" id="3922478">(</span><span class="ident" id="3922479"><a href="/net/http/transport.go.html#3921980">treq</a></span><span class="op" id="3922483">)</span><br>
<span class="lineno"></span><span class="op" id="3922485">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3922488">//&nbsp;RegisterProtocol&nbsp;registers&nbsp;a&nbsp;new&nbsp;protocol&nbsp;with&nbsp;scheme.</span><br>
<span class="lineno"></span><span class="comment" id="3922546">//&nbsp;The&nbsp;Transport&nbsp;will&nbsp;pass&nbsp;requests&nbsp;using&nbsp;the&nbsp;given&nbsp;scheme&nbsp;to&nbsp;rt.</span><br>
<span class="lineno">240</span><span class="comment" id="3922612">//&nbsp;It&nbsp;is&nbsp;rt&#39;s&nbsp;responsibility&nbsp;to&nbsp;simulate&nbsp;HTTP&nbsp;request&nbsp;semantics.</span><br>
<span class="lineno"></span><span class="comment" id="3922677">//</span><br>
<span class="lineno"></span><span class="comment" id="3922680">//&nbsp;RegisterProtocol&nbsp;can&nbsp;be&nbsp;used&nbsp;by&nbsp;other&nbsp;packages&nbsp;to&nbsp;provide</span><br>
<span class="lineno"></span><span class="comment" id="3922741">//&nbsp;implementations&nbsp;of&nbsp;protocol&nbsp;schemes&nbsp;like&nbsp;&#34;ftp&#34;&nbsp;or&nbsp;&#34;file&#34;.</span><br>
<span class="lineno"></span><span class="keyword" id="3922802">func</span>&nbsp;<span class="op" id="3922807">(</span><span class="ident" id="3922808">t</span>&nbsp;<span class="op" id="3922810">*</span><span class="ident" id="3922811"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3922820">)</span>&nbsp;<span class="ident" id="3922822">RegisterProtocol</span><span class="op" id="3922838">(</span><span class="ident" id="3922839">scheme</span>&nbsp;<span class="builtintype" id="3922846">string</span><span class="op" id="3922852">,</span>&nbsp;<span class="ident" id="3922854">rt</span>&nbsp;<span class="ident" id="3922857"><a href="/net/http/client.go.html#3738099">RoundTripper</a></span><span class="op" id="3922869">)</span>&nbsp;<span class="op" id="3922871">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922874">if</span>&nbsp;<span class="ident" id="3922877"><a href="/net/http/transport.go.html#3922839">scheme</a></span>&nbsp;<span class="op" id="3922884">==</span>&nbsp;<span class="string" id="3922887">&#34;http&#34;</span>&nbsp;<span class="op" id="3922894">||</span>&nbsp;<span class="ident" id="3922897"><a href="/net/http/transport.go.html#3922839">scheme</a></span>&nbsp;<span class="op" id="3922904">==</span>&nbsp;<span class="string" id="3922907">&#34;https&#34;</span>&nbsp;<span class="op" id="3922915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3922919">panic</span><span class="op" id="3922924">(</span><span class="string" id="3922925">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="3922937">+</span>&nbsp;<span class="ident" id="3922939"><a href="/net/http/transport.go.html#3922839">scheme</a></span>&nbsp;<span class="op" id="3922946">+</span>&nbsp;<span class="string" id="3922948">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="3922969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3922972">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3922975"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3922976">.</span><span class="ident" id="3922977">altMu</span><span class="op" id="3922982">.</span><span class="ident" id="3922983">Lock</span><span class="op" id="3922987">(</span><span class="op" id="3922988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3922991">defer</span>&nbsp;<span class="ident" id="3922997"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3922998">.</span><span class="ident" id="3922999">altMu</span><span class="op" id="3923004">.</span><span class="ident" id="3923005">Unlock</span><span class="op" id="3923011">(</span><span class="op" id="3923012">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923015">if</span>&nbsp;<span class="ident" id="3923018"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3923019">.</span><span class="ident" id="3923020">altProto</span>&nbsp;<span class="op" id="3923029">==</span>&nbsp;<span class="ident" id="3923032">nil</span>&nbsp;<span class="op" id="3923036">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923040"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3923041">.</span><span class="ident" id="3923042">altProto</span>&nbsp;<span class="op" id="3923051">=</span>&nbsp;<span class="builtinfunc" id="3923053">make</span><span class="op" id="3923057">(</span><span class="keyword" id="3923058">map</span><span class="op" id="3923061">[</span><span class="builtintype" id="3923062">string</span><span class="op" id="3923068">]</span><span class="ident" id="3923069"><a href="/net/http/client.go.html#3738099">RoundTripper</a></span><span class="op" id="3923081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923087">if</span>&nbsp;<span class="ident" id="3923090">_</span><span class="op" id="3923091">,</span>&nbsp;<span class="ident" id="3923093">exists</span>&nbsp;<span class="op" id="3923100">:=</span>&nbsp;<span class="ident" id="3923103"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3923104">.</span><span class="ident" id="3923105">altProto</span><span class="op" id="3923113">[</span><span class="ident" id="3923114"><a href="/net/http/transport.go.html#3922839">scheme</a></span><span class="op" id="3923120">]</span><span class="op" id="3923121">;</span>&nbsp;<span class="ident" id="3923123"><a href="/net/http/transport.go.html#3923093">exists</a></span>&nbsp;<span class="op" id="3923130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3923134">panic</span><span class="op" id="3923139">(</span><span class="string" id="3923140">&#34;protocol&nbsp;&#34;</span>&nbsp;<span class="op" id="3923152">+</span>&nbsp;<span class="ident" id="3923154"><a href="/net/http/transport.go.html#3922839">scheme</a></span>&nbsp;<span class="op" id="3923161">+</span>&nbsp;<span class="string" id="3923163">&#34;&nbsp;already&nbsp;registered&#34;</span><span class="op" id="3923184">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923190"><a href="/net/http/transport.go.html#3922808">t</a></span><span class="op" id="3923191">.</span><span class="ident" id="3923192">altProto</span><span class="op" id="3923200">[</span><span class="ident" id="3923201"><a href="/net/http/transport.go.html#3922839">scheme</a></span><span class="op" id="3923207">]</span>&nbsp;<span class="op" id="3923209">=</span>&nbsp;<span class="ident" id="3923211"><a href="/net/http/transport.go.html#3922854">rt</a></span><br>
<span class="lineno"></span><span class="op" id="3923214">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3923217">//&nbsp;CloseIdleConnections&nbsp;closes&nbsp;any&nbsp;connections&nbsp;which&nbsp;were&nbsp;previously</span><br>
<span class="lineno">260</span><span class="comment" id="3923286">//&nbsp;connected&nbsp;from&nbsp;previous&nbsp;requests&nbsp;but&nbsp;are&nbsp;now&nbsp;sitting&nbsp;idle&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="3923350">//&nbsp;a&nbsp;&#34;keep-alive&#34;&nbsp;state.&nbsp;It&nbsp;does&nbsp;not&nbsp;interrupt&nbsp;any&nbsp;connections&nbsp;currently</span><br>
<span class="lineno"></span><span class="comment" id="3923423">//&nbsp;in&nbsp;use.</span><br>
<span class="lineno"></span><span class="keyword" id="3923434">func</span>&nbsp;<span class="op" id="3923439">(</span><span class="ident" id="3923440">t</span>&nbsp;<span class="op" id="3923442">*</span><span class="ident" id="3923443"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3923452">)</span>&nbsp;<span class="ident" id="3923454">CloseIdleConnections</span><span class="op" id="3923474">(</span><span class="op" id="3923475">)</span>&nbsp;<span class="op" id="3923477">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923480"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923481">.</span><span class="ident" id="3923482">idleMu</span><span class="op" id="3923488">.</span><span class="ident" id="3923489">Lock</span><span class="op" id="3923493">(</span><span class="op" id="3923494">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923497">m</span>&nbsp;<span class="op" id="3923499">:=</span>&nbsp;<span class="ident" id="3923502"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923503">.</span><span class="ident" id="3923504">idleConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923514"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923515">.</span><span class="ident" id="3923516">idleConn</span>&nbsp;<span class="op" id="3923525">=</span>&nbsp;<span class="ident" id="3923527">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923532"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923533">.</span><span class="ident" id="3923534">idleConnCh</span>&nbsp;<span class="op" id="3923545">=</span>&nbsp;<span class="ident" id="3923547">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923552"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923553">.</span><span class="ident" id="3923554">wantIdle</span>&nbsp;<span class="op" id="3923563">=</span>&nbsp;<span class="ident" id="3923565">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923571"><a href="/net/http/transport.go.html#3923440">t</a></span><span class="op" id="3923572">.</span><span class="ident" id="3923573">idleMu</span><span class="op" id="3923579">.</span><span class="ident" id="3923580">Unlock</span><span class="op" id="3923586">(</span><span class="op" id="3923587">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923590">for</span>&nbsp;<span class="ident" id="3923594">_</span><span class="op" id="3923595">,</span>&nbsp;<span class="ident" id="3923597">conns</span>&nbsp;<span class="op" id="3923603">:=</span>&nbsp;<span class="keyword" id="3923606">range</span>&nbsp;<span class="ident" id="3923612"><a href="/net/http/transport.go.html#3923497">m</a></span>&nbsp;<span class="op" id="3923614">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923618">for</span>&nbsp;<span class="ident" id="3923622">_</span><span class="op" id="3923623">,</span>&nbsp;<span class="ident" id="3923625">pconn</span>&nbsp;<span class="op" id="3923631">:=</span>&nbsp;<span class="keyword" id="3923634">range</span>&nbsp;<span class="ident" id="3923640"><a href="/net/http/transport.go.html#3923597">conns</a></span>&nbsp;<span class="op" id="3923646">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923651"><a href="/net/http/transport.go.html#3923625">pconn</a></span><span class="op" id="3923656">.</span><span class="builtinfunc" id="3923657">close</span><span class="op" id="3923662">(</span><span class="op" id="3923663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923670">}</span><br>
<span class="lineno">275</span><span class="op" id="3923672">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3923675">//&nbsp;CancelRequest&nbsp;cancels&nbsp;an&nbsp;in-flight&nbsp;request&nbsp;by&nbsp;closing&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3923736">//&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="3923751">func</span>&nbsp;<span class="op" id="3923756">(</span><span class="ident" id="3923757">t</span>&nbsp;<span class="op" id="3923759">*</span><span class="ident" id="3923760"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3923769">)</span>&nbsp;<span class="ident" id="3923771">CancelRequest</span><span class="op" id="3923784">(</span><span class="ident" id="3923785">req</span>&nbsp;<span class="op" id="3923789">*</span><span class="ident" id="3923790"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3923797">)</span>&nbsp;<span class="op" id="3923799">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923802"><a href="/net/http/transport.go.html#3923757">t</a></span><span class="op" id="3923803">.</span><span class="ident" id="3923804">reqMu</span><span class="op" id="3923809">.</span><span class="ident" id="3923810">Lock</span><span class="op" id="3923814">(</span><span class="op" id="3923815">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923818">cancel</span>&nbsp;<span class="op" id="3923825">:=</span>&nbsp;<span class="ident" id="3923828"><a href="/net/http/transport.go.html#3923757">t</a></span><span class="op" id="3923829">.</span><span class="ident" id="3923830">reqCanceler</span><span class="op" id="3923841">[</span><span class="ident" id="3923842"><a href="/net/http/transport.go.html#3923785">req</a></span><span class="op" id="3923845">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923848"><a href="/net/http/transport.go.html#3923757">t</a></span><span class="op" id="3923849">.</span><span class="ident" id="3923850">reqMu</span><span class="op" id="3923855">.</span><span class="ident" id="3923856">Unlock</span><span class="op" id="3923862">(</span><span class="op" id="3923863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3923866">if</span>&nbsp;<span class="ident" id="3923869"><a href="/net/http/transport.go.html#3923818">cancel</a></span>&nbsp;<span class="op" id="3923876">!=</span>&nbsp;<span class="ident" id="3923879">nil</span>&nbsp;<span class="op" id="3923883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923887"><a href="/net/http/transport.go.html#3923818">cancel</a></span><span class="op" id="3923893">(</span><span class="op" id="3923894">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3923897">}</span><br>
<span class="lineno"></span><span class="op" id="3923899">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3923902">//</span><br>
<span class="lineno"></span><span class="comment" id="3923905">//&nbsp;Private&nbsp;implementation&nbsp;past&nbsp;this&nbsp;point.</span><br>
<span class="lineno">290</span><span class="comment" id="3923948">//</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3923952">var</span>&nbsp;<span class="op" id="3923956">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923959">httpProxyEnv</span>&nbsp;<span class="op" id="3923972">=</span>&nbsp;<span class="op" id="3923974">&amp;</span><span class="ident" id="3923975"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3923982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3923986">names</span><span class="op" id="3923991">:</span>&nbsp;<span class="op" id="3923993">[</span><span class="op" id="3923994">]</span><span class="builtintype" id="3923995">string</span><span class="op" id="3924001">{</span><span class="string" id="3924002">&#34;HTTP_PROXY&#34;</span><span class="op" id="3924014">,</span>&nbsp;<span class="string" id="3924016">&#34;http_proxy&#34;</span><span class="op" id="3924028">}</span><span class="op" id="3924029">,</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924035">httpsProxyEnv</span>&nbsp;<span class="op" id="3924049">=</span>&nbsp;<span class="op" id="3924051">&amp;</span><span class="ident" id="3924052"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3924059">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924063">names</span><span class="op" id="3924068">:</span>&nbsp;<span class="op" id="3924070">[</span><span class="op" id="3924071">]</span><span class="builtintype" id="3924072">string</span><span class="op" id="3924078">{</span><span class="string" id="3924079">&#34;HTTPS_PROXY&#34;</span><span class="op" id="3924092">,</span>&nbsp;<span class="string" id="3924094">&#34;https_proxy&#34;</span><span class="op" id="3924107">}</span><span class="op" id="3924108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924114">noProxyEnv</span>&nbsp;<span class="op" id="3924125">=</span>&nbsp;<span class="op" id="3924127">&amp;</span><span class="ident" id="3924128"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3924135">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924139">names</span><span class="op" id="3924144">:</span>&nbsp;<span class="op" id="3924146">[</span><span class="op" id="3924147">]</span><span class="builtintype" id="3924148">string</span><span class="op" id="3924154">{</span><span class="string" id="3924155">&#34;NO_PROXY&#34;</span><span class="op" id="3924165">,</span>&nbsp;<span class="string" id="3924167">&#34;no_proxy&#34;</span><span class="op" id="3924177">}</span><span class="op" id="3924178">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924181">}</span><br>
<span class="lineno"></span><span class="op" id="3924183">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924186">//&nbsp;envOnce&nbsp;looks&nbsp;up&nbsp;an&nbsp;environment&nbsp;variable&nbsp;(optionally&nbsp;by&nbsp;multiple</span><br>
<span class="lineno">305</span><span class="comment" id="3924254">//&nbsp;names)&nbsp;once.&nbsp;It&nbsp;mitigates&nbsp;expensive&nbsp;lookups&nbsp;on&nbsp;some&nbsp;platforms</span><br>
<span class="lineno"></span><span class="comment" id="3924319">//&nbsp;(e.g.&nbsp;Windows).</span><br>
<span class="lineno"></span><span class="keyword" id="3924338">type</span>&nbsp;<span class="ident" id="3924343">envOnce</span>&nbsp;<span class="keyword" id="3924351">struct</span>&nbsp;<span class="op" id="3924358">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924361">names</span>&nbsp;<span class="op" id="3924367">[</span><span class="op" id="3924368">]</span><span class="builtintype" id="3924369">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924377">once</span>&nbsp;&nbsp;<span class="ident" id="3924383"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3924387">.</span><span class="ident" id="3924388">Once</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924394">val</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3924400">string</span><br>
<span class="lineno"></span><span class="op" id="3924407">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3924410">func</span>&nbsp;<span class="op" id="3924415">(</span><span class="ident" id="3924416">e</span>&nbsp;<span class="op" id="3924418">*</span><span class="ident" id="3924419"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3924426">)</span>&nbsp;<span class="ident" id="3924428">Get</span><span class="op" id="3924431">(</span><span class="op" id="3924432">)</span>&nbsp;<span class="builtintype" id="3924434">string</span>&nbsp;<span class="op" id="3924441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924444"><a href="/net/http/transport.go.html#3924416">e</a></span><span class="op" id="3924445">.</span><span class="ident" id="3924446">once</span><span class="op" id="3924450">.</span><span class="ident" id="3924451">Do</span><span class="op" id="3924453">(</span><span class="ident" id="3924454"><a href="/net/http/transport.go.html#3924416">e</a></span><span class="op" id="3924455">.</span><span class="ident" id="3924456">init</span><span class="op" id="3924460">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924463">return</span>&nbsp;<span class="ident" id="3924470"><a href="/net/http/transport.go.html#3924416">e</a></span><span class="op" id="3924471">.</span><span class="ident" id="3924472">val</span><br>
<span class="lineno"></span><span class="op" id="3924476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3924479">func</span>&nbsp;<span class="op" id="3924484">(</span><span class="ident" id="3924485">e</span>&nbsp;<span class="op" id="3924487">*</span><span class="ident" id="3924488"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3924495">)</span>&nbsp;<span class="ident" id="3924497">init</span><span class="op" id="3924501">(</span><span class="op" id="3924502">)</span>&nbsp;<span class="op" id="3924504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924507">for</span>&nbsp;<span class="ident" id="3924511">_</span><span class="op" id="3924512">,</span>&nbsp;<span class="ident" id="3924514">n</span>&nbsp;<span class="op" id="3924516">:=</span>&nbsp;<span class="keyword" id="3924519">range</span>&nbsp;<span class="ident" id="3924525"><a href="/net/http/transport.go.html#3924485">e</a></span><span class="op" id="3924526">.</span><span class="ident" id="3924527">names</span>&nbsp;<span class="op" id="3924533">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924537"><a href="/net/http/transport.go.html#3924485">e</a></span><span class="op" id="3924538">.</span><span class="ident" id="3924539">val</span>&nbsp;<span class="op" id="3924543">=</span>&nbsp;<span class="ident" id="3924545"><a href="/net/http/transport.go.html#3915369">os</a></span><span class="op" id="3924547">.</span><span class="ident" id="3924548">Getenv</span><span class="op" id="3924554">(</span><span class="ident" id="3924555"><a href="/net/http/transport.go.html#3924514">n</a></span><span class="op" id="3924556">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924560">if</span>&nbsp;<span class="ident" id="3924563"><a href="/net/http/transport.go.html#3924485">e</a></span><span class="op" id="3924564">.</span><span class="ident" id="3924565">val</span>&nbsp;<span class="op" id="3924569">!=</span>&nbsp;<span class="string" id="3924572">&#34;&#34;</span>&nbsp;<span class="op" id="3924575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924580">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924592">}</span><br>
<span class="lineno">325</span><span class="op" id="3924594">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924597">//&nbsp;reset&nbsp;is&nbsp;used&nbsp;by&nbsp;tests</span><br>
<span class="lineno"></span><span class="keyword" id="3924623">func</span>&nbsp;<span class="op" id="3924628">(</span><span class="ident" id="3924629">e</span>&nbsp;<span class="op" id="3924631">*</span><span class="ident" id="3924632"><a href="/net/http/transport.go.html#3924343">envOnce</a></span><span class="op" id="3924639">)</span>&nbsp;<span class="ident" id="3924641">reset</span><span class="op" id="3924646">(</span><span class="op" id="3924647">)</span>&nbsp;<span class="op" id="3924649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924652"><a href="/net/http/transport.go.html#3924629">e</a></span><span class="op" id="3924653">.</span><span class="ident" id="3924654">once</span>&nbsp;<span class="op" id="3924659">=</span>&nbsp;<span class="ident" id="3924661"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3924665">.</span><span class="ident" id="3924666">Once</span><span class="op" id="3924670">{</span><span class="op" id="3924671">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924674"><a href="/net/http/transport.go.html#3924629">e</a></span><span class="op" id="3924675">.</span><span class="ident" id="3924676">val</span>&nbsp;<span class="op" id="3924680">=</span>&nbsp;<span class="string" id="3924682">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3924685">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3924688">func</span>&nbsp;<span class="op" id="3924693">(</span><span class="ident" id="3924694">t</span>&nbsp;<span class="op" id="3924696">*</span><span class="ident" id="3924697"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3924706">)</span>&nbsp;<span class="ident" id="3924708">connectMethodForRequest</span><span class="op" id="3924731">(</span><span class="ident" id="3924732">treq</span>&nbsp;<span class="op" id="3924737">*</span><span class="ident" id="3924738"><a href="/net/http/transport.go.html#3920842">transportRequest</a></span><span class="op" id="3924754">)</span>&nbsp;<span class="op" id="3924756">(</span><span class="ident" id="3924757">cm</span>&nbsp;<span class="ident" id="3924760"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3924773">,</span>&nbsp;<span class="ident" id="3924775">err</span>&nbsp;<span class="builtintype" id="3924779">error</span><span class="op" id="3924784">)</span>&nbsp;<span class="op" id="3924786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924789"><a href="/net/http/transport.go.html#3924757">cm</a></span><span class="op" id="3924791">.</span><span class="ident" id="3924792">targetScheme</span>&nbsp;<span class="op" id="3924805">=</span>&nbsp;<span class="ident" id="3924807"><a href="/net/http/transport.go.html#3924732">treq</a></span><span class="op" id="3924811">.</span><span class="ident" id="3924812">URL</span><span class="op" id="3924815">.</span><span class="ident" id="3924816">Scheme</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924824"><a href="/net/http/transport.go.html#3924757">cm</a></span><span class="op" id="3924826">.</span><span class="ident" id="3924827">targetAddr</span>&nbsp;<span class="op" id="3924838">=</span>&nbsp;<span class="ident" id="3924840"><a href="/net/http/transport.go.html#3946635">canonicalAddr</a></span><span class="op" id="3924853">(</span><span class="ident" id="3924854"><a href="/net/http/transport.go.html#3924732">treq</a></span><span class="op" id="3924858">.</span><span class="ident" id="3924859">URL</span><span class="op" id="3924862">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924865">if</span>&nbsp;<span class="ident" id="3924868"><a href="/net/http/transport.go.html#3924694">t</a></span><span class="op" id="3924869">.</span><span class="ident" id="3924870">Proxy</span>&nbsp;<span class="op" id="3924876">!=</span>&nbsp;<span class="ident" id="3924879">nil</span>&nbsp;<span class="op" id="3924883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3924887"><a href="/net/http/transport.go.html#3924757">cm</a></span><span class="op" id="3924889">.</span><span class="ident" id="3924890">proxyURL</span><span class="op" id="3924898">,</span>&nbsp;<span class="ident" id="3924900"><a href="/net/http/transport.go.html#3924775">err</a></span>&nbsp;<span class="op" id="3924904">=</span>&nbsp;<span class="ident" id="3924906"><a href="/net/http/transport.go.html#3924694">t</a></span><span class="op" id="3924907">.</span><span class="ident" id="3924908">Proxy</span><span class="op" id="3924913">(</span><span class="ident" id="3924914"><a href="/net/http/transport.go.html#3924732">treq</a></span><span class="op" id="3924918">.</span><span class="ident" id="3924919">Request</span><span class="op" id="3924926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3924929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3924932">return</span>&nbsp;<span class="ident" id="3924939"><a href="/net/http/transport.go.html#3924757">cm</a></span><span class="op" id="3924941">,</span>&nbsp;<span class="ident" id="3924943"><a href="/net/http/transport.go.html#3924775">err</a></span><br>
<span class="lineno">340</span><span class="op" id="3924947">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3924950">//&nbsp;proxyAuth&nbsp;returns&nbsp;the&nbsp;Proxy-Authorization&nbsp;header&nbsp;to&nbsp;set</span><br>
<span class="lineno"></span><span class="comment" id="3925009">//&nbsp;on&nbsp;requests,&nbsp;if&nbsp;applicable.</span><br>
<span class="lineno"></span><span class="keyword" id="3925040">func</span>&nbsp;<span class="op" id="3925045">(</span><span class="ident" id="3925046">cm</span>&nbsp;<span class="op" id="3925049">*</span><span class="ident" id="3925050"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3925063">)</span>&nbsp;<span class="ident" id="3925065">proxyAuth</span><span class="op" id="3925074">(</span><span class="op" id="3925075">)</span>&nbsp;<span class="builtintype" id="3925077">string</span>&nbsp;<span class="op" id="3925084">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925087">if</span>&nbsp;<span class="ident" id="3925090"><a href="/net/http/transport.go.html#3925046">cm</a></span><span class="op" id="3925092">.</span><span class="ident" id="3925093">proxyURL</span>&nbsp;<span class="op" id="3925102">==</span>&nbsp;<span class="ident" id="3925105">nil</span>&nbsp;<span class="op" id="3925109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925113">return</span>&nbsp;<span class="string" id="3925120">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925127">if</span>&nbsp;<span class="ident" id="3925130">u</span>&nbsp;<span class="op" id="3925132">:=</span>&nbsp;<span class="ident" id="3925135"><a href="/net/http/transport.go.html#3925046">cm</a></span><span class="op" id="3925137">.</span><span class="ident" id="3925138">proxyURL</span><span class="op" id="3925146">.</span><span class="ident" id="3925147">User</span><span class="op" id="3925151">;</span>&nbsp;<span class="ident" id="3925153"><a href="/net/http/transport.go.html#3925130">u</a></span>&nbsp;<span class="op" id="3925155">!=</span>&nbsp;<span class="ident" id="3925158">nil</span>&nbsp;<span class="op" id="3925162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925166">username</span>&nbsp;<span class="op" id="3925175">:=</span>&nbsp;<span class="ident" id="3925178"><a href="/net/http/transport.go.html#3925130">u</a></span><span class="op" id="3925179">.</span><span class="ident" id="3925180">Username</span><span class="op" id="3925188">(</span><span class="op" id="3925189">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925193">password</span><span class="op" id="3925201">,</span>&nbsp;<span class="ident" id="3925203">_</span>&nbsp;<span class="op" id="3925205">:=</span>&nbsp;<span class="ident" id="3925208"><a href="/net/http/transport.go.html#3925130">u</a></span><span class="op" id="3925209">.</span><span class="ident" id="3925210">Password</span><span class="op" id="3925218">(</span><span class="op" id="3925219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925223">return</span>&nbsp;<span class="string" id="3925230">&#34;Basic&nbsp;&#34;</span>&nbsp;<span class="op" id="3925239">+</span>&nbsp;<span class="ident" id="3925241"><a href="/net/http/client.go.html#3743145">basicAuth</a></span><span class="op" id="3925250">(</span><span class="ident" id="3925251"><a href="/net/http/transport.go.html#3925166">username</a></span><span class="op" id="3925259">,</span>&nbsp;<span class="ident" id="3925261"><a href="/net/http/transport.go.html#3925193">password</a></span><span class="op" id="3925269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925275">return</span>&nbsp;<span class="string" id="3925282">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="3925285">}</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span><span class="comment" id="3925288">//&nbsp;putIdleConn&nbsp;adds&nbsp;pconn&nbsp;to&nbsp;the&nbsp;list&nbsp;of&nbsp;idle&nbsp;persistent&nbsp;connections&nbsp;awaiting</span><br>
<span class="lineno"></span><span class="comment" id="3925366">//&nbsp;a&nbsp;new&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3925384">//&nbsp;If&nbsp;pconn&nbsp;is&nbsp;no&nbsp;longer&nbsp;needed&nbsp;or&nbsp;not&nbsp;in&nbsp;a&nbsp;good&nbsp;state,&nbsp;putIdleConn</span><br>
<span class="lineno"></span><span class="comment" id="3925452">//&nbsp;returns&nbsp;false.</span><br>
<span class="lineno">360</span><span class="keyword" id="3925470">func</span>&nbsp;<span class="op" id="3925475">(</span><span class="ident" id="3925476">t</span>&nbsp;<span class="op" id="3925478">*</span><span class="ident" id="3925479"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3925488">)</span>&nbsp;<span class="ident" id="3925490">putIdleConn</span><span class="op" id="3925501">(</span><span class="ident" id="3925502">pconn</span>&nbsp;<span class="op" id="3925508">*</span><span class="ident" id="3925509"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3925520">)</span>&nbsp;<span class="builtintype" id="3925522">bool</span>&nbsp;<span class="op" id="3925527">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925530">if</span>&nbsp;<span class="ident" id="3925533"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3925534">.</span><span class="ident" id="3925535">DisableKeepAlives</span>&nbsp;<span class="op" id="3925553">||</span>&nbsp;<span class="ident" id="3925556"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3925557">.</span><span class="ident" id="3925558">MaxIdleConnsPerHost</span>&nbsp;<span class="op" id="3925578">&lt;</span>&nbsp;<span class="num" id="3925580">0</span>&nbsp;<span class="op" id="3925582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925586"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3925591">.</span><span class="builtinfunc" id="3925592">close</span><span class="op" id="3925597">(</span><span class="op" id="3925598">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925602">return</span>&nbsp;<span class="ident" id="3925609">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925616">}</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925619">if</span>&nbsp;<span class="ident" id="3925622"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3925627">.</span><span class="ident" id="3925628">isBroken</span><span class="op" id="3925636">(</span><span class="op" id="3925637">)</span>&nbsp;<span class="op" id="3925639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925643">return</span>&nbsp;<span class="ident" id="3925650">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925660">key</span>&nbsp;<span class="op" id="3925664">:=</span>&nbsp;<span class="ident" id="3925667"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3925672">.</span><span class="ident" id="3925673">cacheKey</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925683">max</span>&nbsp;<span class="op" id="3925687">:=</span>&nbsp;<span class="ident" id="3925690"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3925691">.</span><span class="ident" id="3925692">MaxIdleConnsPerHost</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925713">if</span>&nbsp;<span class="ident" id="3925716"><a href="/net/http/transport.go.html#3925683">max</a></span>&nbsp;<span class="op" id="3925720">==</span>&nbsp;<span class="num" id="3925723">0</span>&nbsp;<span class="op" id="3925725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925729"><a href="/net/http/transport.go.html#3925683">max</a></span>&nbsp;<span class="op" id="3925733">=</span>&nbsp;<span class="ident" id="3925735"><a href="/net/http/transport.go.html#3916031">DefaultMaxIdleConnsPerHost</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3925763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925766"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3925767">.</span><span class="ident" id="3925768">idleMu</span><span class="op" id="3925774">.</span><span class="ident" id="3925775">Lock</span><span class="op" id="3925779">(</span><span class="op" id="3925780">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3925784">waitingDialer</span>&nbsp;<span class="op" id="3925798">:=</span>&nbsp;<span class="ident" id="3925801"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3925802">.</span><span class="ident" id="3925803">idleConnCh</span><span class="op" id="3925813">[</span><span class="ident" id="3925814"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3925817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925820">select</span>&nbsp;<span class="op" id="3925827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3925830">case</span>&nbsp;<span class="ident" id="3925835"><a href="/net/http/transport.go.html#3925784">waitingDialer</a></span>&nbsp;<span class="op" id="3925849">&lt;-</span>&nbsp;<span class="ident" id="3925852"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3925857">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3925861">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;pconn&nbsp;and&nbsp;somebody&nbsp;else&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3925914">//&nbsp;currently&nbsp;waiting&nbsp;for&nbsp;a&nbsp;conn&nbsp;of&nbsp;this&nbsp;type&nbsp;(they&#39;re</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3925970">//&nbsp;actively&nbsp;dialing,&nbsp;but&nbsp;this&nbsp;conn&nbsp;is&nbsp;ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3926016">//&nbsp;first).&nbsp;Chrome&nbsp;calls&nbsp;this&nbsp;socket&nbsp;late&nbsp;binding.&nbsp;&nbsp;See</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3926073">//&nbsp;https://insouciant.org/tech/connection-management-in-chromium/</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926141"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926142">.</span><span class="ident" id="3926143">idleMu</span><span class="op" id="3926149">.</span><span class="ident" id="3926150">Unlock</span><span class="op" id="3926156">(</span><span class="op" id="3926157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926161">return</span>&nbsp;<span class="ident" id="3926168">true</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926174">default</span><span class="op" id="3926181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926185">if</span>&nbsp;<span class="ident" id="3926188"><a href="/net/http/transport.go.html#3925784">waitingDialer</a></span>&nbsp;<span class="op" id="3926202">!=</span>&nbsp;<span class="ident" id="3926205">nil</span>&nbsp;<span class="op" id="3926209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3926214">//&nbsp;They&nbsp;had&nbsp;populated&nbsp;this,&nbsp;but&nbsp;their&nbsp;dial&nbsp;won</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3926264">//&nbsp;first,&nbsp;so&nbsp;we&nbsp;can&nbsp;clean&nbsp;up&nbsp;this&nbsp;map&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3926312">delete</span><span class="op" id="3926318">(</span><span class="ident" id="3926319"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926320">.</span><span class="ident" id="3926321">idleConnCh</span><span class="op" id="3926331">,</span>&nbsp;<span class="ident" id="3926333"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3926336">)</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926340">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926343">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926346">if</span>&nbsp;<span class="ident" id="3926349"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926350">.</span><span class="ident" id="3926351">wantIdle</span>&nbsp;<span class="op" id="3926360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926364"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926365">.</span><span class="ident" id="3926366">idleMu</span><span class="op" id="3926372">.</span><span class="ident" id="3926373">Unlock</span><span class="op" id="3926379">(</span><span class="op" id="3926380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926384"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3926389">.</span><span class="builtinfunc" id="3926390">close</span><span class="op" id="3926395">(</span><span class="op" id="3926396">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926400">return</span>&nbsp;<span class="ident" id="3926407">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926414">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926417">if</span>&nbsp;<span class="ident" id="3926420"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926421">.</span><span class="ident" id="3926422">idleConn</span>&nbsp;<span class="op" id="3926431">==</span>&nbsp;<span class="ident" id="3926434">nil</span>&nbsp;<span class="op" id="3926438">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926442"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926443">.</span><span class="ident" id="3926444">idleConn</span>&nbsp;<span class="op" id="3926453">=</span>&nbsp;<span class="builtinfunc" id="3926455">make</span><span class="op" id="3926459">(</span><span class="keyword" id="3926460">map</span><span class="op" id="3926463">[</span><span class="ident" id="3926464"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3926480">]</span><span class="op" id="3926481">[</span><span class="op" id="3926482">]</span><span class="op" id="3926483">*</span><span class="ident" id="3926484"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3926495">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926498">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926501">if</span>&nbsp;<span class="builtinfunc" id="3926504">len</span><span class="op" id="3926507">(</span><span class="ident" id="3926508"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926509">.</span><span class="ident" id="3926510">idleConn</span><span class="op" id="3926518">[</span><span class="ident" id="3926519"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3926522">]</span><span class="op" id="3926523">)</span>&nbsp;<span class="op" id="3926525">&gt;=</span>&nbsp;<span class="ident" id="3926528"><a href="/net/http/transport.go.html#3925683">max</a></span>&nbsp;<span class="op" id="3926532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926536"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926537">.</span><span class="ident" id="3926538">idleMu</span><span class="op" id="3926544">.</span><span class="ident" id="3926545">Unlock</span><span class="op" id="3926551">(</span><span class="op" id="3926552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926556"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3926561">.</span><span class="builtinfunc" id="3926562">close</span><span class="op" id="3926567">(</span><span class="op" id="3926568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926572">return</span>&nbsp;<span class="ident" id="3926579">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926586">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926589">for</span>&nbsp;<span class="ident" id="3926593">_</span><span class="op" id="3926594">,</span>&nbsp;<span class="ident" id="3926596">exist</span>&nbsp;<span class="op" id="3926602">:=</span>&nbsp;<span class="keyword" id="3926605">range</span>&nbsp;<span class="ident" id="3926611"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926612">.</span><span class="ident" id="3926613">idleConn</span><span class="op" id="3926621">[</span><span class="ident" id="3926622"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3926625">]</span>&nbsp;<span class="op" id="3926627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926631">if</span>&nbsp;<span class="ident" id="3926634"><a href="/net/http/transport.go.html#3926596">exist</a></span>&nbsp;<span class="op" id="3926640">==</span>&nbsp;<span class="ident" id="3926643"><a href="/net/http/transport.go.html#3925502">pconn</a></span>&nbsp;<span class="op" id="3926649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926654"><a href="/net/http/transport.go.html#3915344">log</a></span><span class="op" id="3926657">.</span><span class="ident" id="3926658">Fatalf</span><span class="op" id="3926664">(</span><span class="string" id="3926665">&#34;dup&nbsp;idle&nbsp;pconn&nbsp;%p&nbsp;in&nbsp;freelist&#34;</span><span class="op" id="3926696">,</span>&nbsp;<span class="ident" id="3926698"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3926703">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926707">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3926710">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926713"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926714">.</span><span class="ident" id="3926715">idleConn</span><span class="op" id="3926723">[</span><span class="ident" id="3926724"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3926727">]</span>&nbsp;<span class="op" id="3926729">=</span>&nbsp;<span class="builtinfunc" id="3926731">append</span><span class="op" id="3926737">(</span><span class="ident" id="3926738"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926739">.</span><span class="ident" id="3926740">idleConn</span><span class="op" id="3926748">[</span><span class="ident" id="3926749"><a href="/net/http/transport.go.html#3925660">key</a></span><span class="op" id="3926752">]</span><span class="op" id="3926753">,</span>&nbsp;<span class="ident" id="3926755"><a href="/net/http/transport.go.html#3925502">pconn</a></span><span class="op" id="3926760">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3926763"><a href="/net/http/transport.go.html#3925476">t</a></span><span class="op" id="3926764">.</span><span class="ident" id="3926765">idleMu</span><span class="op" id="3926771">.</span><span class="ident" id="3926772">Unlock</span><span class="op" id="3926778">(</span><span class="op" id="3926779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3926782">return</span>&nbsp;<span class="ident" id="3926789">true</span><br>
<span class="lineno"></span><span class="op" id="3926794">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">415</span><span class="comment" id="3926797">//&nbsp;getIdleConnCh&nbsp;returns&nbsp;a&nbsp;channel&nbsp;to&nbsp;receive&nbsp;and&nbsp;return&nbsp;idle</span><br>
<span class="lineno"></span><span class="comment" id="3926859">//&nbsp;persistent&nbsp;connection&nbsp;for&nbsp;the&nbsp;given&nbsp;connectMethod.</span><br>
<span class="lineno"></span><span class="comment" id="3926913">//&nbsp;It&nbsp;may&nbsp;return&nbsp;nil,&nbsp;if&nbsp;persistent&nbsp;connections&nbsp;are&nbsp;not&nbsp;being&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="3926981">func</span>&nbsp;<span class="op" id="3926986">(</span><span class="ident" id="3926987">t</span>&nbsp;<span class="op" id="3926989">*</span><span class="ident" id="3926990"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3926999">)</span>&nbsp;<span class="ident" id="3927001">getIdleConnCh</span><span class="op" id="3927014">(</span><span class="ident" id="3927015">cm</span>&nbsp;<span class="ident" id="3927018"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3927031">)</span>&nbsp;<span class="keyword" id="3927033">chan</span>&nbsp;<span class="op" id="3927038">*</span><span class="ident" id="3927039"><a href="/net/http/transport.go.html#3936054">persistConn</a></span>&nbsp;<span class="op" id="3927051">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927054">if</span>&nbsp;<span class="ident" id="3927057"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927058">.</span><span class="ident" id="3927059">DisableKeepAlives</span>&nbsp;<span class="op" id="3927077">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927081">return</span>&nbsp;<span class="ident" id="3927088">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927093">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927096">key</span>&nbsp;<span class="op" id="3927100">:=</span>&nbsp;<span class="ident" id="3927103"><a href="/net/http/transport.go.html#3927015">cm</a></span><span class="op" id="3927105">.</span><span class="ident" id="3927106">key</span><span class="op" id="3927109">(</span><span class="op" id="3927110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927113"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927114">.</span><span class="ident" id="3927115">idleMu</span><span class="op" id="3927121">.</span><span class="ident" id="3927122">Lock</span><span class="op" id="3927126">(</span><span class="op" id="3927127">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927130">defer</span>&nbsp;<span class="ident" id="3927136"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927137">.</span><span class="ident" id="3927138">idleMu</span><span class="op" id="3927144">.</span><span class="ident" id="3927145">Unlock</span><span class="op" id="3927151">(</span><span class="op" id="3927152">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927155"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927156">.</span><span class="ident" id="3927157">wantIdle</span>&nbsp;<span class="op" id="3927166">=</span>&nbsp;<span class="ident" id="3927168">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927175">if</span>&nbsp;<span class="ident" id="3927178"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927179">.</span><span class="ident" id="3927180">idleConnCh</span>&nbsp;<span class="op" id="3927191">==</span>&nbsp;<span class="ident" id="3927194">nil</span>&nbsp;<span class="op" id="3927198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927202"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927203">.</span><span class="ident" id="3927204">idleConnCh</span>&nbsp;<span class="op" id="3927215">=</span>&nbsp;<span class="builtinfunc" id="3927217">make</span><span class="op" id="3927221">(</span><span class="keyword" id="3927222">map</span><span class="op" id="3927225">[</span><span class="ident" id="3927226"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3927242">]</span><span class="keyword" id="3927243">chan</span>&nbsp;<span class="op" id="3927248">*</span><span class="ident" id="3927249"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3927260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927263">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927266">ch</span><span class="op" id="3927268">,</span>&nbsp;<span class="ident" id="3927270">ok</span>&nbsp;<span class="op" id="3927273">:=</span>&nbsp;<span class="ident" id="3927276"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927277">.</span><span class="ident" id="3927278">idleConnCh</span><span class="op" id="3927288">[</span><span class="ident" id="3927289"><a href="/net/http/transport.go.html#3927096">key</a></span><span class="op" id="3927292">]</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927295">if</span>&nbsp;<span class="op" id="3927298">!</span><span class="ident" id="3927299"><a href="/net/http/transport.go.html#3927270">ok</a></span>&nbsp;<span class="op" id="3927302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927306"><a href="/net/http/transport.go.html#3927266">ch</a></span>&nbsp;<span class="op" id="3927309">=</span>&nbsp;<span class="builtinfunc" id="3927311">make</span><span class="op" id="3927315">(</span><span class="keyword" id="3927316">chan</span>&nbsp;<span class="op" id="3927321">*</span><span class="ident" id="3927322"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3927333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927337"><a href="/net/http/transport.go.html#3926987">t</a></span><span class="op" id="3927338">.</span><span class="ident" id="3927339">idleConnCh</span><span class="op" id="3927349">[</span><span class="ident" id="3927350"><a href="/net/http/transport.go.html#3927096">key</a></span><span class="op" id="3927353">]</span>&nbsp;<span class="op" id="3927355">=</span>&nbsp;<span class="ident" id="3927357"><a href="/net/http/transport.go.html#3927266">ch</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927361">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927364">return</span>&nbsp;<span class="ident" id="3927371"><a href="/net/http/transport.go.html#3927266">ch</a></span><br>
<span class="lineno">435</span><span class="op" id="3927374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3927377">func</span>&nbsp;<span class="op" id="3927382">(</span><span class="ident" id="3927383">t</span>&nbsp;<span class="op" id="3927385">*</span><span class="ident" id="3927386"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3927395">)</span>&nbsp;<span class="ident" id="3927397">getIdleConn</span><span class="op" id="3927408">(</span><span class="ident" id="3927409">cm</span>&nbsp;<span class="ident" id="3927412"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3927425">)</span>&nbsp;<span class="op" id="3927427">(</span><span class="ident" id="3927428">pconn</span>&nbsp;<span class="op" id="3927434">*</span><span class="ident" id="3927435"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3927446">)</span>&nbsp;<span class="op" id="3927448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927451">key</span>&nbsp;<span class="op" id="3927455">:=</span>&nbsp;<span class="ident" id="3927458"><a href="/net/http/transport.go.html#3927409">cm</a></span><span class="op" id="3927460">.</span><span class="ident" id="3927461">key</span><span class="op" id="3927464">(</span><span class="op" id="3927465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927468"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927469">.</span><span class="ident" id="3927470">idleMu</span><span class="op" id="3927476">.</span><span class="ident" id="3927477">Lock</span><span class="op" id="3927481">(</span><span class="op" id="3927482">)</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927485">defer</span>&nbsp;<span class="ident" id="3927491"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927492">.</span><span class="ident" id="3927493">idleMu</span><span class="op" id="3927499">.</span><span class="ident" id="3927500">Unlock</span><span class="op" id="3927506">(</span><span class="op" id="3927507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927510">if</span>&nbsp;<span class="ident" id="3927513"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927514">.</span><span class="ident" id="3927515">idleConn</span>&nbsp;<span class="op" id="3927524">==</span>&nbsp;<span class="ident" id="3927527">nil</span>&nbsp;<span class="op" id="3927531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927535">return</span>&nbsp;<span class="ident" id="3927542">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927547">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927550">for</span>&nbsp;<span class="op" id="3927554">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927558">pconns</span><span class="op" id="3927564">,</span>&nbsp;<span class="ident" id="3927566">ok</span>&nbsp;<span class="op" id="3927569">:=</span>&nbsp;<span class="ident" id="3927572"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927573">.</span><span class="ident" id="3927574">idleConn</span><span class="op" id="3927582">[</span><span class="ident" id="3927583"><a href="/net/http/transport.go.html#3927451">key</a></span><span class="op" id="3927586">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927590">if</span>&nbsp;<span class="op" id="3927593">!</span><span class="ident" id="3927594"><a href="/net/http/transport.go.html#3927566">ok</a></span>&nbsp;<span class="op" id="3927597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927602">return</span>&nbsp;<span class="ident" id="3927609">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927615">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927619">if</span>&nbsp;<span class="builtinfunc" id="3927622">len</span><span class="op" id="3927625">(</span><span class="ident" id="3927626"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927632">)</span>&nbsp;<span class="op" id="3927634">==</span>&nbsp;<span class="num" id="3927637">1</span>&nbsp;<span class="op" id="3927639">{</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927644"><a href="/net/http/transport.go.html#3927428">pconn</a></span>&nbsp;<span class="op" id="3927650">=</span>&nbsp;<span class="ident" id="3927652"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927658">[</span><span class="num" id="3927659">0</span><span class="op" id="3927660">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3927665">delete</span><span class="op" id="3927671">(</span><span class="ident" id="3927672"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927673">.</span><span class="ident" id="3927674">idleConn</span><span class="op" id="3927682">,</span>&nbsp;<span class="ident" id="3927684"><a href="/net/http/transport.go.html#3927451">key</a></span><span class="op" id="3927687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927691">}</span>&nbsp;<span class="keyword" id="3927693">else</span>&nbsp;<span class="op" id="3927698">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3927703">//&nbsp;2&nbsp;or&nbsp;more&nbsp;cached&nbsp;connections;&nbsp;pop&nbsp;last</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3927748">//&nbsp;TODO:&nbsp;queue?</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927767"><a href="/net/http/transport.go.html#3927428">pconn</a></span>&nbsp;<span class="op" id="3927773">=</span>&nbsp;<span class="ident" id="3927775"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927781">[</span><span class="builtinfunc" id="3927782">len</span><span class="op" id="3927785">(</span><span class="ident" id="3927786"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927792">)</span><span class="op" id="3927793">-</span><span class="num" id="3927794">1</span><span class="op" id="3927795">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927800"><a href="/net/http/transport.go.html#3927383">t</a></span><span class="op" id="3927801">.</span><span class="ident" id="3927802">idleConn</span><span class="op" id="3927810">[</span><span class="ident" id="3927811"><a href="/net/http/transport.go.html#3927451">key</a></span><span class="op" id="3927814">]</span>&nbsp;<span class="op" id="3927816">=</span>&nbsp;<span class="ident" id="3927818"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927824">[</span><span class="op" id="3927825">:</span><span class="builtinfunc" id="3927826">len</span><span class="op" id="3927829">(</span><span class="ident" id="3927830"><a href="/net/http/transport.go.html#3927558">pconns</a></span><span class="op" id="3927836">)</span><span class="op" id="3927837">-</span><span class="num" id="3927838">1</span><span class="op" id="3927839">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927847">if</span>&nbsp;<span class="op" id="3927850">!</span><span class="ident" id="3927851"><a href="/net/http/transport.go.html#3927428">pconn</a></span><span class="op" id="3927856">.</span><span class="ident" id="3927857">isBroken</span><span class="op" id="3927865">(</span><span class="op" id="3927866">)</span>&nbsp;<span class="op" id="3927868">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927873">return</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927882">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3927885">}</span><br>
<span class="lineno"></span><span class="op" id="3927887">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3927890">func</span>&nbsp;<span class="op" id="3927895">(</span><span class="ident" id="3927896">t</span>&nbsp;<span class="op" id="3927898">*</span><span class="ident" id="3927899"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3927908">)</span>&nbsp;<span class="ident" id="3927910">setReqCanceler</span><span class="op" id="3927924">(</span><span class="ident" id="3927925">r</span>&nbsp;<span class="op" id="3927927">*</span><span class="ident" id="3927928"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3927935">,</span>&nbsp;<span class="ident" id="3927937">fn</span>&nbsp;<span class="keyword" id="3927940">func</span><span class="op" id="3927944">(</span><span class="op" id="3927945">)</span><span class="op" id="3927946">)</span>&nbsp;<span class="op" id="3927948">{</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3927951"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3927952">.</span><span class="ident" id="3927953">reqMu</span><span class="op" id="3927958">.</span><span class="ident" id="3927959">Lock</span><span class="op" id="3927963">(</span><span class="op" id="3927964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927967">defer</span>&nbsp;<span class="ident" id="3927973"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3927974">.</span><span class="ident" id="3927975">reqMu</span><span class="op" id="3927980">.</span><span class="ident" id="3927981">Unlock</span><span class="op" id="3927987">(</span><span class="op" id="3927988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3927991">if</span>&nbsp;<span class="ident" id="3927994"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3927995">.</span><span class="ident" id="3927996">reqCanceler</span>&nbsp;<span class="op" id="3928008">==</span>&nbsp;<span class="ident" id="3928011">nil</span>&nbsp;<span class="op" id="3928015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928019"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3928020">.</span><span class="ident" id="3928021">reqCanceler</span>&nbsp;<span class="op" id="3928033">=</span>&nbsp;<span class="builtinfunc" id="3928035">make</span><span class="op" id="3928039">(</span><span class="keyword" id="3928040">map</span><span class="op" id="3928043">[</span><span class="op" id="3928044">*</span><span class="ident" id="3928045"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3928052">]</span><span class="keyword" id="3928053">func</span><span class="op" id="3928057">(</span><span class="op" id="3928058">)</span><span class="op" id="3928059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928062">}</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928065">if</span>&nbsp;<span class="ident" id="3928068"><a href="/net/http/transport.go.html#3927937">fn</a></span>&nbsp;<span class="op" id="3928071">!=</span>&nbsp;<span class="ident" id="3928074">nil</span>&nbsp;<span class="op" id="3928078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928082"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3928083">.</span><span class="ident" id="3928084">reqCanceler</span><span class="op" id="3928095">[</span><span class="ident" id="3928096"><a href="/net/http/transport.go.html#3927925">r</a></span><span class="op" id="3928097">]</span>&nbsp;<span class="op" id="3928099">=</span>&nbsp;<span class="ident" id="3928101"><a href="/net/http/transport.go.html#3927937">fn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928105">}</span>&nbsp;<span class="keyword" id="3928107">else</span>&nbsp;<span class="op" id="3928112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3928116">delete</span><span class="op" id="3928122">(</span><span class="ident" id="3928123"><a href="/net/http/transport.go.html#3927896">t</a></span><span class="op" id="3928124">.</span><span class="ident" id="3928125">reqCanceler</span><span class="op" id="3928136">,</span>&nbsp;<span class="ident" id="3928138"><a href="/net/http/transport.go.html#3927925">r</a></span><span class="op" id="3928139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928142">}</span><br>
<span class="lineno">475</span><span class="op" id="3928144">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3928147">func</span>&nbsp;<span class="op" id="3928152">(</span><span class="ident" id="3928153">t</span>&nbsp;<span class="op" id="3928155">*</span><span class="ident" id="3928156"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3928165">)</span>&nbsp;<span class="ident" id="3928167">dial</span><span class="op" id="3928171">(</span><span class="ident" id="3928172">network</span><span class="op" id="3928179">,</span>&nbsp;<span class="ident" id="3928181">addr</span>&nbsp;<span class="builtintype" id="3928186">string</span><span class="op" id="3928192">)</span>&nbsp;<span class="op" id="3928194">(</span><span class="ident" id="3928195">c</span>&nbsp;<span class="ident" id="3928197"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3928200">.</span><span class="ident" id="3928201">Conn</span><span class="op" id="3928205">,</span>&nbsp;<span class="ident" id="3928207">err</span>&nbsp;<span class="builtintype" id="3928211">error</span><span class="op" id="3928216">)</span>&nbsp;<span class="op" id="3928218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928221">if</span>&nbsp;<span class="ident" id="3928224"><a href="/net/http/transport.go.html#3928153">t</a></span><span class="op" id="3928225">.</span><span class="ident" id="3928226">Dial</span>&nbsp;<span class="op" id="3928231">!=</span>&nbsp;<span class="ident" id="3928234">nil</span>&nbsp;<span class="op" id="3928238">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928242">return</span>&nbsp;<span class="ident" id="3928249"><a href="/net/http/transport.go.html#3928153">t</a></span><span class="op" id="3928250">.</span><span class="ident" id="3928251">Dial</span><span class="op" id="3928255">(</span><span class="ident" id="3928256"><a href="/net/http/transport.go.html#3928172">network</a></span><span class="op" id="3928263">,</span>&nbsp;<span class="ident" id="3928265"><a href="/net/http/transport.go.html#3928181">addr</a></span><span class="op" id="3928269">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928275">return</span>&nbsp;<span class="ident" id="3928282"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3928285">.</span><span class="ident" id="3928286">Dial</span><span class="op" id="3928290">(</span><span class="ident" id="3928291"><a href="/net/http/transport.go.html#3928172">network</a></span><span class="op" id="3928298">,</span>&nbsp;<span class="ident" id="3928300"><a href="/net/http/transport.go.html#3928181">addr</a></span><span class="op" id="3928304">)</span><br>
<span class="lineno"></span><span class="op" id="3928306">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928309">//&nbsp;Testing&nbsp;hooks:</span><br>
<span class="lineno">485</span><span class="keyword" id="3928327">var</span>&nbsp;<span class="ident" id="3928331">prePendingDial</span><span class="op" id="3928345">,</span>&nbsp;<span class="ident" id="3928347">postPendingDial</span>&nbsp;<span class="keyword" id="3928363">func</span><span class="op" id="3928367">(</span><span class="op" id="3928368">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3928371">//&nbsp;getConn&nbsp;dials&nbsp;and&nbsp;creates&nbsp;a&nbsp;new&nbsp;persistConn&nbsp;to&nbsp;the&nbsp;target&nbsp;as</span><br>
<span class="lineno"></span><span class="comment" id="3928435">//&nbsp;specified&nbsp;in&nbsp;the&nbsp;connectMethod.&nbsp;&nbsp;This&nbsp;includes&nbsp;doing&nbsp;a&nbsp;proxy&nbsp;CONNECT</span><br>
<span class="lineno"></span><span class="comment" id="3928507">//&nbsp;and/or&nbsp;setting&nbsp;up&nbsp;TLS.&nbsp;&nbsp;If&nbsp;this&nbsp;doesn&#39;t&nbsp;return&nbsp;an&nbsp;error,&nbsp;the&nbsp;persistConn</span><br>
<span class="lineno">490</span><span class="comment" id="3928583">//&nbsp;is&nbsp;ready&nbsp;to&nbsp;write&nbsp;requests&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3928617">func</span>&nbsp;<span class="op" id="3928622">(</span><span class="ident" id="3928623">t</span>&nbsp;<span class="op" id="3928625">*</span><span class="ident" id="3928626"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3928635">)</span>&nbsp;<span class="ident" id="3928637">getConn</span><span class="op" id="3928644">(</span><span class="ident" id="3928645">req</span>&nbsp;<span class="op" id="3928649">*</span><span class="ident" id="3928650"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3928657">,</span>&nbsp;<span class="ident" id="3928659">cm</span>&nbsp;<span class="ident" id="3928662"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3928675">)</span>&nbsp;<span class="op" id="3928677">(</span><span class="op" id="3928678">*</span><span class="ident" id="3928679"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3928690">,</span>&nbsp;<span class="builtintype" id="3928692">error</span><span class="op" id="3928697">)</span>&nbsp;<span class="op" id="3928699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928702">if</span>&nbsp;<span class="ident" id="3928705">pc</span>&nbsp;<span class="op" id="3928708">:=</span>&nbsp;<span class="ident" id="3928711"><a href="/net/http/transport.go.html#3928623">t</a></span><span class="op" id="3928712">.</span><span class="ident" id="3928713">getIdleConn</span><span class="op" id="3928724">(</span><span class="ident" id="3928725"><a href="/net/http/transport.go.html#3928659">cm</a></span><span class="op" id="3928727">)</span><span class="op" id="3928728">;</span>&nbsp;<span class="ident" id="3928730"><a href="/net/http/transport.go.html#3928705">pc</a></span>&nbsp;<span class="op" id="3928733">!=</span>&nbsp;<span class="ident" id="3928736">nil</span>&nbsp;<span class="op" id="3928740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928744">return</span>&nbsp;<span class="ident" id="3928751"><a href="/net/http/transport.go.html#3928705">pc</a></span><span class="op" id="3928753">,</span>&nbsp;<span class="ident" id="3928755">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928760">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928764">type</span>&nbsp;<span class="ident" id="3928769">dialRes</span>&nbsp;<span class="keyword" id="3928777">struct</span>&nbsp;<span class="op" id="3928784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928788">pc</span>&nbsp;&nbsp;<span class="op" id="3928792">*</span><span class="ident" id="3928793"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928807">err</span>&nbsp;<span class="builtintype" id="3928811">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928818">}</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928821">dialc</span>&nbsp;<span class="op" id="3928827">:=</span>&nbsp;<span class="builtinfunc" id="3928830">make</span><span class="op" id="3928834">(</span><span class="keyword" id="3928835">chan</span>&nbsp;<span class="ident" id="3928840"><a href="/net/http/transport.go.html#3928769">dialRes</a></span><span class="op" id="3928847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928851">handlePendingDial</span>&nbsp;<span class="op" id="3928869">:=</span>&nbsp;<span class="keyword" id="3928872">func</span><span class="op" id="3928876">(</span><span class="op" id="3928877">)</span>&nbsp;<span class="op" id="3928879">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928883">if</span>&nbsp;<span class="ident" id="3928886"><a href="/net/http/transport.go.html#3928331">prePendingDial</a></span>&nbsp;<span class="op" id="3928901">!=</span>&nbsp;<span class="ident" id="3928904">nil</span>&nbsp;<span class="op" id="3928908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928913"><a href="/net/http/transport.go.html#3928331">prePendingDial</a></span><span class="op" id="3928927">(</span><span class="op" id="3928928">)</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3928932">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928936">go</span>&nbsp;<span class="keyword" id="3928939">func</span><span class="op" id="3928943">(</span><span class="op" id="3928944">)</span>&nbsp;<span class="op" id="3928946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3928951">if</span>&nbsp;<span class="ident" id="3928954">v</span>&nbsp;<span class="op" id="3928956">:=</span>&nbsp;<span class="op" id="3928959">&lt;-</span><span class="ident" id="3928961"><a href="/net/http/transport.go.html#3928821">dialc</a></span><span class="op" id="3928966">;</span>&nbsp;<span class="ident" id="3928968"><a href="/net/http/transport.go.html#3928954">v</a></span><span class="op" id="3928969">.</span><span class="ident" id="3928970">err</span>&nbsp;<span class="op" id="3928974">==</span>&nbsp;<span class="ident" id="3928977">nil</span>&nbsp;<span class="op" id="3928981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3928987"><a href="/net/http/transport.go.html#3928623">t</a></span><span class="op" id="3928988">.</span><span class="ident" id="3928989">putIdleConn</span><span class="op" id="3929000">(</span><span class="ident" id="3929001"><a href="/net/http/transport.go.html#3928954">v</a></span><span class="op" id="3929002">.</span><span class="ident" id="3929003">pc</span><span class="op" id="3929005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929010">}</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929015">if</span>&nbsp;<span class="ident" id="3929018"><a href="/net/http/transport.go.html#3928347">postPendingDial</a></span>&nbsp;<span class="op" id="3929034">!=</span>&nbsp;<span class="ident" id="3929037">nil</span>&nbsp;<span class="op" id="3929041">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929047"><a href="/net/http/transport.go.html#3928347">postPendingDial</a></span><span class="op" id="3929062">(</span><span class="op" id="3929063">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929072">}</span><span class="op" id="3929073">(</span><span class="op" id="3929074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929077">}</span><br>
<span class="lineno">515</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929081">cancelc</span>&nbsp;<span class="op" id="3929089">:=</span>&nbsp;<span class="builtinfunc" id="3929092">make</span><span class="op" id="3929096">(</span><span class="keyword" id="3929097">chan</span>&nbsp;<span class="keyword" id="3929102">struct</span><span class="op" id="3929108">{</span><span class="op" id="3929109">}</span><span class="op" id="3929110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929113"><a href="/net/http/transport.go.html#3928623">t</a></span><span class="op" id="3929114">.</span><span class="ident" id="3929115">setReqCanceler</span><span class="op" id="3929129">(</span><span class="ident" id="3929130"><a href="/net/http/transport.go.html#3928645">req</a></span><span class="op" id="3929133">,</span>&nbsp;<span class="keyword" id="3929135">func</span><span class="op" id="3929139">(</span><span class="op" id="3929140">)</span>&nbsp;<span class="op" id="3929142">{</span>&nbsp;<span class="builtinfunc" id="3929144">close</span><span class="op" id="3929149">(</span><span class="ident" id="3929150"><a href="/net/http/transport.go.html#3929081">cancelc</a></span><span class="op" id="3929157">)</span>&nbsp;<span class="op" id="3929159">}</span><span class="op" id="3929160">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929164">go</span>&nbsp;<span class="keyword" id="3929167">func</span><span class="op" id="3929171">(</span><span class="op" id="3929172">)</span>&nbsp;<span class="op" id="3929174">{</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929178">pc</span><span class="op" id="3929180">,</span>&nbsp;<span class="ident" id="3929182">err</span>&nbsp;<span class="op" id="3929186">:=</span>&nbsp;<span class="ident" id="3929189"><a href="/net/http/transport.go.html#3928623">t</a></span><span class="op" id="3929190">.</span><span class="ident" id="3929191">dialConn</span><span class="op" id="3929199">(</span><span class="ident" id="3929200"><a href="/net/http/transport.go.html#3928659">cm</a></span><span class="op" id="3929202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929206"><a href="/net/http/transport.go.html#3928821">dialc</a></span>&nbsp;<span class="op" id="3929212">&lt;-</span>&nbsp;<span class="ident" id="3929215"><a href="/net/http/transport.go.html#3928769">dialRes</a></span><span class="op" id="3929222">{</span><span class="ident" id="3929223"><a href="/net/http/transport.go.html#3929178">pc</a></span><span class="op" id="3929225">,</span>&nbsp;<span class="ident" id="3929227"><a href="/net/http/transport.go.html#3929182">err</a></span><span class="op" id="3929230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929233">}</span><span class="op" id="3929234">(</span><span class="op" id="3929235">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929239">idleConnCh</span>&nbsp;<span class="op" id="3929250">:=</span>&nbsp;<span class="ident" id="3929253"><a href="/net/http/transport.go.html#3928623">t</a></span><span class="op" id="3929254">.</span><span class="ident" id="3929255">getIdleConnCh</span><span class="op" id="3929268">(</span><span class="ident" id="3929269"><a href="/net/http/transport.go.html#3928659">cm</a></span><span class="op" id="3929271">)</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929274">select</span>&nbsp;<span class="op" id="3929281">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929284">case</span>&nbsp;<span class="ident" id="3929289">v</span>&nbsp;<span class="op" id="3929291">:=</span>&nbsp;<span class="op" id="3929294">&lt;-</span><span class="ident" id="3929296"><a href="/net/http/transport.go.html#3928821">dialc</a></span><span class="op" id="3929301">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929305">//&nbsp;Our&nbsp;dial&nbsp;finished.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929329">return</span>&nbsp;<span class="ident" id="3929336"><a href="/net/http/transport.go.html#3929289">v</a></span><span class="op" id="3929337">.</span><span class="ident" id="3929338">pc</span><span class="op" id="3929340">,</span>&nbsp;<span class="ident" id="3929342"><a href="/net/http/transport.go.html#3929289">v</a></span><span class="op" id="3929343">.</span><span class="ident" id="3929344">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929349">case</span>&nbsp;<span class="ident" id="3929354">pc</span>&nbsp;<span class="op" id="3929357">:=</span>&nbsp;<span class="op" id="3929360">&lt;-</span><span class="ident" id="3929362"><a href="/net/http/transport.go.html#3929239">idleConnCh</a></span><span class="op" id="3929372">:</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929376">//&nbsp;Another&nbsp;request&nbsp;finished&nbsp;first&nbsp;and&nbsp;its&nbsp;net.Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929429">//&nbsp;became&nbsp;available&nbsp;before&nbsp;our&nbsp;dial.&nbsp;Or&nbsp;somebody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929480">//&nbsp;else&#39;s&nbsp;dial&nbsp;that&nbsp;they&nbsp;didn&#39;t&nbsp;use.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929519">//&nbsp;But&nbsp;our&nbsp;dial&nbsp;is&nbsp;still&nbsp;going,&nbsp;so&nbsp;give&nbsp;it&nbsp;away</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3929569">//&nbsp;when&nbsp;it&nbsp;finishes:</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929592"><a href="/net/http/transport.go.html#3928851">handlePendingDial</a></span><span class="op" id="3929609">(</span><span class="op" id="3929610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929614">return</span>&nbsp;<span class="ident" id="3929621"><a href="/net/http/transport.go.html#3929354">pc</a></span><span class="op" id="3929623">,</span>&nbsp;<span class="ident" id="3929625">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929630">case</span>&nbsp;<span class="op" id="3929635">&lt;-</span><span class="ident" id="3929637"><a href="/net/http/transport.go.html#3929081">cancelc</a></span><span class="op" id="3929644">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929648"><a href="/net/http/transport.go.html#3928851">handlePendingDial</a></span><span class="op" id="3929665">(</span><span class="op" id="3929666">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3929670">return</span>&nbsp;<span class="ident" id="3929677">nil</span><span class="op" id="3929680">,</span>&nbsp;<span class="ident" id="3929682"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3929688">.</span><span class="ident" id="3929689">New</span><span class="op" id="3929692">(</span><span class="string" id="3929693">&#34;net/http:&nbsp;request&nbsp;canceled&nbsp;while&nbsp;waiting&nbsp;for&nbsp;connection&#34;</span><span class="op" id="3929750">)</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3929753">}</span><br>
<span class="lineno"></span><span class="op" id="3929755">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3929758">func</span>&nbsp;<span class="op" id="3929763">(</span><span class="ident" id="3929764">t</span>&nbsp;<span class="op" id="3929766">*</span><span class="ident" id="3929767"><a href="/net/http/transport.go.html#3916265">Transport</a></span><span class="op" id="3929776">)</span>&nbsp;<span class="ident" id="3929778">dialConn</span><span class="op" id="3929786">(</span><span class="ident" id="3929787">cm</span>&nbsp;<span class="ident" id="3929790"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3929803">)</span>&nbsp;<span class="op" id="3929805">(</span><span class="op" id="3929806">*</span><span class="ident" id="3929807"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3929818">,</span>&nbsp;<span class="builtintype" id="3929820">error</span><span class="op" id="3929825">)</span>&nbsp;<span class="op" id="3929827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929830">pconn</span>&nbsp;<span class="op" id="3929836">:=</span>&nbsp;<span class="op" id="3929839">&amp;</span><span class="ident" id="3929840"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3929851">{</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929855">t</span><span class="op" id="3929856">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3929867"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3929868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929872">cacheKey</span><span class="op" id="3929880">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3929884"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3929886">.</span><span class="ident" id="3929887">key</span><span class="op" id="3929890">(</span><span class="op" id="3929891">)</span><span class="op" id="3929892">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929896">reqch</span><span class="op" id="3929901">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3929908">make</span><span class="op" id="3929912">(</span><span class="keyword" id="3929913">chan</span>&nbsp;<span class="ident" id="3929918"><a href="/net/http/transport.go.html#3941934">requestAndChan</a></span><span class="op" id="3929932">,</span>&nbsp;<span class="num" id="3929934">1</span><span class="op" id="3929935">)</span><span class="op" id="3929936">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929940">writech</span><span class="op" id="3929947">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3929952">make</span><span class="op" id="3929956">(</span><span class="keyword" id="3929957">chan</span>&nbsp;<span class="ident" id="3929962"><a href="/net/http/transport.go.html#3942381">writeRequest</a></span><span class="op" id="3929974">,</span>&nbsp;<span class="num" id="3929976">1</span><span class="op" id="3929977">)</span><span class="op" id="3929978">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3929982">closech</span><span class="op" id="3929989">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="3929994">make</span><span class="op" id="3929998">(</span><span class="keyword" id="3929999">chan</span>&nbsp;<span class="keyword" id="3930004">struct</span><span class="op" id="3930010">{</span><span class="op" id="3930011">}</span><span class="op" id="3930012">)</span><span class="op" id="3930013">,</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930017">writeErrCh</span><span class="op" id="3930027">:</span>&nbsp;<span class="builtinfunc" id="3930029">make</span><span class="op" id="3930033">(</span><span class="keyword" id="3930034">chan</span>&nbsp;<span class="builtintype" id="3930039">error</span><span class="op" id="3930044">,</span>&nbsp;<span class="num" id="3930046">1</span><span class="op" id="3930047">)</span><span class="op" id="3930048">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930054">tlsDial</span>&nbsp;<span class="op" id="3930062">:=</span>&nbsp;<span class="ident" id="3930065"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3930066">.</span><span class="ident" id="3930067">DialTLS</span>&nbsp;<span class="op" id="3930075">!=</span>&nbsp;<span class="ident" id="3930078">nil</span>&nbsp;<span class="op" id="3930082">&amp;&amp;</span>&nbsp;<span class="ident" id="3930085"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930087">.</span><span class="ident" id="3930088">targetScheme</span>&nbsp;<span class="op" id="3930101">==</span>&nbsp;<span class="string" id="3930104">&#34;https&#34;</span>&nbsp;<span class="op" id="3930112">&amp;&amp;</span>&nbsp;<span class="ident" id="3930115"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930117">.</span><span class="ident" id="3930118">proxyURL</span>&nbsp;<span class="op" id="3930127">==</span>&nbsp;<span class="ident" id="3930130">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930135">if</span>&nbsp;<span class="ident" id="3930138"><a href="/net/http/transport.go.html#3930054">tlsDial</a></span>&nbsp;<span class="op" id="3930146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930150">var</span>&nbsp;<span class="ident" id="3930154">err</span>&nbsp;<span class="builtintype" id="3930158">error</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930166"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930171">.</span><span class="ident" id="3930172">conn</span><span class="op" id="3930176">,</span>&nbsp;<span class="ident" id="3930178"><a href="/net/http/transport.go.html#3930154">err</a></span>&nbsp;<span class="op" id="3930182">=</span>&nbsp;<span class="ident" id="3930184"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3930185">.</span><span class="ident" id="3930186">DialTLS</span><span class="op" id="3930193">(</span><span class="string" id="3930194">&#34;tcp&#34;</span><span class="op" id="3930199">,</span>&nbsp;<span class="ident" id="3930201"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930203">.</span><span class="ident" id="3930204">addr</span><span class="op" id="3930208">(</span><span class="op" id="3930209">)</span><span class="op" id="3930210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930214">if</span>&nbsp;<span class="ident" id="3930217"><a href="/net/http/transport.go.html#3930154">err</a></span>&nbsp;<span class="op" id="3930221">!=</span>&nbsp;<span class="ident" id="3930224">nil</span>&nbsp;<span class="op" id="3930228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930233">return</span>&nbsp;<span class="ident" id="3930240">nil</span><span class="op" id="3930243">,</span>&nbsp;<span class="ident" id="3930245"><a href="/net/http/transport.go.html#3930154">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930251">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930255">if</span>&nbsp;<span class="ident" id="3930258">tc</span><span class="op" id="3930260">,</span>&nbsp;<span class="ident" id="3930262">ok</span>&nbsp;<span class="op" id="3930265">:=</span>&nbsp;<span class="ident" id="3930268"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930273">.</span><span class="ident" id="3930274">conn</span><span class="op" id="3930278">.</span><span class="op" id="3930279">(</span><span class="op" id="3930280">*</span><span class="ident" id="3930281"><a href="/net/http/transport.go.html#3915307">tls</a></span><span class="op" id="3930284">.</span><span class="ident" id="3930285">Conn</span><span class="op" id="3930289">)</span><span class="op" id="3930290">;</span>&nbsp;<span class="ident" id="3930292"><a href="/net/http/transport.go.html#3930262">ok</a></span>&nbsp;<span class="op" id="3930295">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930300">cs</span>&nbsp;<span class="op" id="3930303">:=</span>&nbsp;<span class="ident" id="3930306"><a href="/net/http/transport.go.html#3930258">tc</a></span><span class="op" id="3930308">.</span><span class="ident" id="3930309">ConnectionState</span><span class="op" id="3930324">(</span><span class="op" id="3930325">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930330"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930335">.</span><span class="ident" id="3930336">tlsState</span>&nbsp;<span class="op" id="3930345">=</span>&nbsp;<span class="op" id="3930347">&amp;</span><span class="ident" id="3930348"><a href="/net/http/transport.go.html#3930300">cs</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930356">}</span>&nbsp;<span class="keyword" id="3930358">else</span>&nbsp;<span class="op" id="3930363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930367">conn</span><span class="op" id="3930371">,</span>&nbsp;<span class="ident" id="3930373">err</span>&nbsp;<span class="op" id="3930377">:=</span>&nbsp;<span class="ident" id="3930380"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3930381">.</span><span class="ident" id="3930382">dial</span><span class="op" id="3930386">(</span><span class="string" id="3930387">&#34;tcp&#34;</span><span class="op" id="3930392">,</span>&nbsp;<span class="ident" id="3930394"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930396">.</span><span class="ident" id="3930397">addr</span><span class="op" id="3930401">(</span><span class="op" id="3930402">)</span><span class="op" id="3930403">)</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930407">if</span>&nbsp;<span class="ident" id="3930410"><a href="/net/http/transport.go.html#3930373">err</a></span>&nbsp;<span class="op" id="3930414">!=</span>&nbsp;<span class="ident" id="3930417">nil</span>&nbsp;<span class="op" id="3930421">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930426">if</span>&nbsp;<span class="ident" id="3930429"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930431">.</span><span class="ident" id="3930432">proxyURL</span>&nbsp;<span class="op" id="3930441">!=</span>&nbsp;<span class="ident" id="3930444">nil</span>&nbsp;<span class="op" id="3930448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930454"><a href="/net/http/transport.go.html#3930373">err</a></span>&nbsp;<span class="op" id="3930458">=</span>&nbsp;<span class="ident" id="3930460"><a href="/net/http/transport.go.html#3915331">fmt</a></span><span class="op" id="3930463">.</span><span class="ident" id="3930464">Errorf</span><span class="op" id="3930470">(</span><span class="string" id="3930471">&#34;http:&nbsp;error&nbsp;connecting&nbsp;to&nbsp;proxy&nbsp;%s:&nbsp;%v&#34;</span><span class="op" id="3930511">,</span>&nbsp;<span class="ident" id="3930513"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930515">.</span><span class="ident" id="3930516">proxyURL</span><span class="op" id="3930524">,</span>&nbsp;<span class="ident" id="3930526"><a href="/net/http/transport.go.html#3930373">err</a></span><span class="op" id="3930529">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930534">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930539">return</span>&nbsp;<span class="ident" id="3930546">nil</span><span class="op" id="3930549">,</span>&nbsp;<span class="ident" id="3930551"><a href="/net/http/transport.go.html#3930373">err</a></span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930561"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930566">.</span><span class="ident" id="3930567">conn</span>&nbsp;<span class="op" id="3930572">=</span>&nbsp;<span class="ident" id="3930574"><a href="/net/http/transport.go.html#3930367">conn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930580">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930584">//&nbsp;Proxy&nbsp;setup.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930601">switch</span>&nbsp;<span class="op" id="3930608">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930611">case</span>&nbsp;<span class="ident" id="3930616"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930618">.</span><span class="ident" id="3930619">proxyURL</span>&nbsp;<span class="op" id="3930628">==</span>&nbsp;<span class="ident" id="3930631">nil</span><span class="op" id="3930634">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3930638">//&nbsp;Do&nbsp;nothing.&nbsp;Not&nbsp;using&nbsp;a&nbsp;proxy.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930673">case</span>&nbsp;<span class="ident" id="3930678"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930680">.</span><span class="ident" id="3930681">targetScheme</span>&nbsp;<span class="op" id="3930694">==</span>&nbsp;<span class="string" id="3930697">&#34;http&#34;</span><span class="op" id="3930703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930707"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930712">.</span><span class="ident" id="3930713">isProxy</span>&nbsp;<span class="op" id="3930721">=</span>&nbsp;<span class="ident" id="3930723">true</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930730">if</span>&nbsp;<span class="ident" id="3930733">pa</span>&nbsp;<span class="op" id="3930736">:=</span>&nbsp;<span class="ident" id="3930739"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930741">.</span><span class="ident" id="3930742">proxyAuth</span><span class="op" id="3930751">(</span><span class="op" id="3930752">)</span><span class="op" id="3930753">;</span>&nbsp;<span class="ident" id="3930755"><a href="/net/http/transport.go.html#3930733">pa</a></span>&nbsp;<span class="op" id="3930758">!=</span>&nbsp;<span class="string" id="3930761">&#34;&#34;</span>&nbsp;<span class="op" id="3930764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930769"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930774">.</span><span class="ident" id="3930775">mutateHeaderFunc</span>&nbsp;<span class="op" id="3930792">=</span>&nbsp;<span class="keyword" id="3930794">func</span><span class="op" id="3930798">(</span><span class="ident" id="3930799">h</span>&nbsp;<span class="ident" id="3930801"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3930807">)</span>&nbsp;<span class="op" id="3930809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930815"><a href="/net/http/transport.go.html#3930799">h</a></span><span class="op" id="3930816">.</span><span class="ident" id="3930817">Set</span><span class="op" id="3930820">(</span><span class="string" id="3930821">&#34;Proxy-Authorization&#34;</span><span class="op" id="3930842">,</span>&nbsp;<span class="ident" id="3930844"><a href="/net/http/transport.go.html#3930733">pa</a></span><span class="op" id="3930846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930851">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3930855">}</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3930858">case</span>&nbsp;<span class="ident" id="3930863"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930865">.</span><span class="ident" id="3930866">targetScheme</span>&nbsp;<span class="op" id="3930879">==</span>&nbsp;<span class="string" id="3930882">&#34;https&#34;</span><span class="op" id="3930889">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930893">conn</span>&nbsp;<span class="op" id="3930898">:=</span>&nbsp;<span class="ident" id="3930901"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3930906">.</span><span class="ident" id="3930907">conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930914">connectReq</span>&nbsp;<span class="op" id="3930925">:=</span>&nbsp;<span class="op" id="3930928">&amp;</span><span class="ident" id="3930929"><a href="/net/http/request.go.html#3791418">Request</a></span><span class="op" id="3930936">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930941">Method</span><span class="op" id="3930947">:</span>&nbsp;<span class="string" id="3930949">&#34;CONNECT&#34;</span><span class="op" id="3930958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3930963">URL</span><span class="op" id="3930966">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3930971">&amp;</span><span class="ident" id="3930972"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3930975">.</span><span class="ident" id="3930976">URL</span><span class="op" id="3930979">{</span><span class="ident" id="3930980">Opaque</span><span class="op" id="3930986">:</span>&nbsp;<span class="ident" id="3930988"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3930990">.</span><span class="ident" id="3930991">targetAddr</span><span class="op" id="3931001">}</span><span class="op" id="3931002">,</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931007">Host</span><span class="op" id="3931011">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3931015"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3931017">.</span><span class="ident" id="3931018">targetAddr</span><span class="op" id="3931028">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931033">Header</span><span class="op" id="3931039">:</span>&nbsp;<span class="builtinfunc" id="3931041">make</span><span class="op" id="3931045">(</span><span class="ident" id="3931046"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3931052">)</span><span class="op" id="3931053">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931061">if</span>&nbsp;<span class="ident" id="3931064">pa</span>&nbsp;<span class="op" id="3931067">:=</span>&nbsp;<span class="ident" id="3931070"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3931072">.</span><span class="ident" id="3931073">proxyAuth</span><span class="op" id="3931082">(</span><span class="op" id="3931083">)</span><span class="op" id="3931084">;</span>&nbsp;<span class="ident" id="3931086"><a href="/net/http/transport.go.html#3931064">pa</a></span>&nbsp;<span class="op" id="3931089">!=</span>&nbsp;<span class="string" id="3931092">&#34;&#34;</span>&nbsp;<span class="op" id="3931095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931100"><a href="/net/http/transport.go.html#3930914">connectReq</a></span><span class="op" id="3931110">.</span><span class="ident" id="3931111">Header</span><span class="op" id="3931117">.</span><span class="ident" id="3931118">Set</span><span class="op" id="3931121">(</span><span class="string" id="3931122">&#34;Proxy-Authorization&#34;</span><span class="op" id="3931143">,</span>&nbsp;<span class="ident" id="3931145"><a href="/net/http/transport.go.html#3931064">pa</a></span><span class="op" id="3931147">)</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931151">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931155"><a href="/net/http/transport.go.html#3930914">connectReq</a></span><span class="op" id="3931165">.</span><span class="ident" id="3931166">Write</span><span class="op" id="3931171">(</span><span class="ident" id="3931172"><a href="/net/http/transport.go.html#3930893">conn</a></span><span class="op" id="3931176">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931181">//&nbsp;Read&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931201">//&nbsp;Okay&nbsp;to&nbsp;use&nbsp;and&nbsp;discard&nbsp;buffered&nbsp;reader&nbsp;here,&nbsp;because</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931260">//&nbsp;TLS&nbsp;server&nbsp;will&nbsp;not&nbsp;speak&nbsp;until&nbsp;spoken&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931308">br</span>&nbsp;<span class="op" id="3931311">:=</span>&nbsp;<span class="ident" id="3931314"><a href="/net/http/transport.go.html#3915281">bufio</a></span><span class="op" id="3931319">.</span><span class="ident" id="3931320">NewReader</span><span class="op" id="3931329">(</span><span class="ident" id="3931330"><a href="/net/http/transport.go.html#3930893">conn</a></span><span class="op" id="3931334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931338">resp</span><span class="op" id="3931342">,</span>&nbsp;<span class="ident" id="3931344">err</span>&nbsp;<span class="op" id="3931348">:=</span>&nbsp;<span class="ident" id="3931351"><a href="/net/http/response.go.html#3820176">ReadResponse</a></span><span class="op" id="3931363">(</span><span class="ident" id="3931364"><a href="/net/http/transport.go.html#3931308">br</a></span><span class="op" id="3931366">,</span>&nbsp;<span class="ident" id="3931368"><a href="/net/http/transport.go.html#3930914">connectReq</a></span><span class="op" id="3931378">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931382">if</span>&nbsp;<span class="ident" id="3931385"><a href="/net/http/transport.go.html#3931344">err</a></span>&nbsp;<span class="op" id="3931389">!=</span>&nbsp;<span class="ident" id="3931392">nil</span>&nbsp;<span class="op" id="3931396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931401"><a href="/net/http/transport.go.html#3930893">conn</a></span><span class="op" id="3931405">.</span><span class="ident" id="3931406">Close</span><span class="op" id="3931411">(</span><span class="op" id="3931412">)</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931417">return</span>&nbsp;<span class="ident" id="3931424">nil</span><span class="op" id="3931427">,</span>&nbsp;<span class="ident" id="3931429"><a href="/net/http/transport.go.html#3931344">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931435">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931439">if</span>&nbsp;<span class="ident" id="3931442"><a href="/net/http/transport.go.html#3931338">resp</a></span><span class="op" id="3931446">.</span><span class="ident" id="3931447">StatusCode</span>&nbsp;<span class="op" id="3931458">!=</span>&nbsp;<span class="num" id="3931461">200</span>&nbsp;<span class="op" id="3931465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931470">f</span>&nbsp;<span class="op" id="3931472">:=</span>&nbsp;<span class="ident" id="3931475"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3931482">.</span><span class="ident" id="3931483">SplitN</span><span class="op" id="3931489">(</span><span class="ident" id="3931490"><a href="/net/http/transport.go.html#3931338">resp</a></span><span class="op" id="3931494">.</span><span class="ident" id="3931495">Status</span><span class="op" id="3931501">,</span>&nbsp;<span class="string" id="3931503">&#34;&nbsp;&#34;</span><span class="op" id="3931506">,</span>&nbsp;<span class="num" id="3931508">2</span><span class="op" id="3931509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931514"><a href="/net/http/transport.go.html#3930893">conn</a></span><span class="op" id="3931518">.</span><span class="ident" id="3931519">Close</span><span class="op" id="3931524">(</span><span class="op" id="3931525">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931530">return</span>&nbsp;<span class="ident" id="3931537">nil</span><span class="op" id="3931540">,</span>&nbsp;<span class="ident" id="3931542"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3931548">.</span><span class="ident" id="3931549">New</span><span class="op" id="3931552">(</span><span class="ident" id="3931553"><a href="/net/http/transport.go.html#3931470">f</a></span><span class="op" id="3931554">[</span><span class="num" id="3931555">1</span><span class="op" id="3931556">]</span><span class="op" id="3931557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931561">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931564">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931568">if</span>&nbsp;<span class="ident" id="3931571"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3931573">.</span><span class="ident" id="3931574">targetScheme</span>&nbsp;<span class="op" id="3931587">==</span>&nbsp;<span class="string" id="3931590">&#34;https&#34;</span>&nbsp;<span class="op" id="3931598">&amp;&amp;</span>&nbsp;<span class="op" id="3931601">!</span><span class="ident" id="3931602"><a href="/net/http/transport.go.html#3930054">tlsDial</a></span>&nbsp;<span class="op" id="3931610">{</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3931614">//&nbsp;Initiate&nbsp;TLS&nbsp;and&nbsp;check&nbsp;remote&nbsp;host&nbsp;name&nbsp;against&nbsp;certificate.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931680">cfg</span>&nbsp;<span class="op" id="3931684">:=</span>&nbsp;<span class="ident" id="3931687"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3931688">.</span><span class="ident" id="3931689">TLSClientConfig</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931707">if</span>&nbsp;<span class="ident" id="3931710"><a href="/net/http/transport.go.html#3931680">cfg</a></span>&nbsp;<span class="op" id="3931714">==</span>&nbsp;<span class="ident" id="3931717">nil</span>&nbsp;<span class="op" id="3931721">||</span>&nbsp;<span class="ident" id="3931724"><a href="/net/http/transport.go.html#3931680">cfg</a></span><span class="op" id="3931727">.</span><span class="ident" id="3931728">ServerName</span>&nbsp;<span class="op" id="3931739">==</span>&nbsp;<span class="string" id="3931742">&#34;&#34;</span>&nbsp;<span class="op" id="3931745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931750">host</span>&nbsp;<span class="op" id="3931755">:=</span>&nbsp;<span class="ident" id="3931758"><a href="/net/http/transport.go.html#3929787">cm</a></span><span class="op" id="3931760">.</span><span class="ident" id="3931761">tlsHost</span><span class="op" id="3931768">(</span><span class="op" id="3931769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3931774">if</span>&nbsp;<span class="ident" id="3931777"><a href="/net/http/transport.go.html#3931680">cfg</a></span>&nbsp;<span class="op" id="3931781">==</span>&nbsp;<span class="ident" id="3931784">nil</span>&nbsp;<span class="op" id="3931788">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931794"><a href="/net/http/transport.go.html#3931680">cfg</a></span>&nbsp;<span class="op" id="3931798">=</span>&nbsp;<span class="op" id="3931800">&amp;</span><span class="ident" id="3931801"><a href="/net/http/transport.go.html#3915307">tls</a></span><span class="op" id="3931804">.</span><span class="ident" id="3931805">Config</span><span class="op" id="3931811">{</span><span class="ident" id="3931812">ServerName</span><span class="op" id="3931822">:</span>&nbsp;<span class="ident" id="3931824"><a href="/net/http/transport.go.html#3931750">host</a></span><span class="op" id="3931828">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931833">}</span>&nbsp;<span class="keyword" id="3931835">else</span>&nbsp;<span class="op" id="3931840">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931846">clone</span>&nbsp;<span class="op" id="3931852">:=</span>&nbsp;<span class="op" id="3931855">*</span><span class="ident" id="3931856"><a href="/net/http/transport.go.html#3931680">cfg</a></span>&nbsp;<span class="comment" id="3931860">//&nbsp;shallow&nbsp;clone</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931881"><a href="/net/http/transport.go.html#3931846">clone</a></span><span class="op" id="3931886">.</span><span class="ident" id="3931887">ServerName</span>&nbsp;<span class="op" id="3931898">=</span>&nbsp;<span class="ident" id="3931900"><a href="/net/http/transport.go.html#3931750">host</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931909"><a href="/net/http/transport.go.html#3931680">cfg</a></span>&nbsp;<span class="op" id="3931913">=</span>&nbsp;<span class="op" id="3931915">&amp;</span><span class="ident" id="3931916"><a href="/net/http/transport.go.html#3931846">clone</a></span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3931929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931933">plainConn</span>&nbsp;<span class="op" id="3931943">:=</span>&nbsp;<span class="ident" id="3931946"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3931951">.</span><span class="ident" id="3931952">conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931959">tlsConn</span>&nbsp;<span class="op" id="3931967">:=</span>&nbsp;<span class="ident" id="3931970"><a href="/net/http/transport.go.html#3915307">tls</a></span><span class="op" id="3931973">.</span><span class="ident" id="3931974">Client</span><span class="op" id="3931980">(</span><span class="ident" id="3931981"><a href="/net/http/transport.go.html#3931933">plainConn</a></span><span class="op" id="3931990">,</span>&nbsp;<span class="ident" id="3931992"><a href="/net/http/transport.go.html#3931680">cfg</a></span><span class="op" id="3931995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3931999">errc</span>&nbsp;<span class="op" id="3932004">:=</span>&nbsp;<span class="builtinfunc" id="3932007">make</span><span class="op" id="3932011">(</span><span class="keyword" id="3932012">chan</span>&nbsp;<span class="builtintype" id="3932017">error</span><span class="op" id="3932022">,</span>&nbsp;<span class="num" id="3932024">2</span><span class="op" id="3932025">)</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932029">var</span>&nbsp;<span class="ident" id="3932033">timer</span>&nbsp;<span class="op" id="3932039">*</span><span class="ident" id="3932040"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3932044">.</span><span class="ident" id="3932045">Timer</span>&nbsp;<span class="comment" id="3932051">//&nbsp;for&nbsp;canceling&nbsp;TLS&nbsp;handshake</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932084">if</span>&nbsp;<span class="ident" id="3932087">d</span>&nbsp;<span class="op" id="3932089">:=</span>&nbsp;<span class="ident" id="3932092"><a href="/net/http/transport.go.html#3929764">t</a></span><span class="op" id="3932093">.</span><span class="ident" id="3932094">TLSHandshakeTimeout</span><span class="op" id="3932113">;</span>&nbsp;<span class="ident" id="3932115"><a href="/net/http/transport.go.html#3932087">d</a></span>&nbsp;<span class="op" id="3932117">!=</span>&nbsp;<span class="num" id="3932120">0</span>&nbsp;<span class="op" id="3932122">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932127"><a href="/net/http/transport.go.html#3932033">timer</a></span>&nbsp;<span class="op" id="3932133">=</span>&nbsp;<span class="ident" id="3932135"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3932139">.</span><span class="ident" id="3932140">AfterFunc</span><span class="op" id="3932149">(</span><span class="ident" id="3932150"><a href="/net/http/transport.go.html#3932087">d</a></span><span class="op" id="3932151">,</span>&nbsp;<span class="keyword" id="3932153">func</span><span class="op" id="3932157">(</span><span class="op" id="3932158">)</span>&nbsp;<span class="op" id="3932160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932166"><a href="/net/http/transport.go.html#3931999">errc</a></span>&nbsp;<span class="op" id="3932171">&lt;-</span>&nbsp;<span class="ident" id="3932174"><a href="/net/http/transport.go.html#3948819">tlsHandshakeTimeoutError</a></span><span class="op" id="3932198">{</span><span class="op" id="3932199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932204">}</span><span class="op" id="3932205">)</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932213">go</span>&nbsp;<span class="keyword" id="3932216">func</span><span class="op" id="3932220">(</span><span class="op" id="3932221">)</span>&nbsp;<span class="op" id="3932223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932228">err</span>&nbsp;<span class="op" id="3932232">:=</span>&nbsp;<span class="ident" id="3932235"><a href="/net/http/transport.go.html#3931959">tlsConn</a></span><span class="op" id="3932242">.</span><span class="ident" id="3932243">Handshake</span><span class="op" id="3932252">(</span><span class="op" id="3932253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932258">if</span>&nbsp;<span class="ident" id="3932261"><a href="/net/http/transport.go.html#3932033">timer</a></span>&nbsp;<span class="op" id="3932267">!=</span>&nbsp;<span class="ident" id="3932270">nil</span>&nbsp;<span class="op" id="3932274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932280"><a href="/net/http/transport.go.html#3932033">timer</a></span><span class="op" id="3932285">.</span><span class="ident" id="3932286">Stop</span><span class="op" id="3932290">(</span><span class="op" id="3932291">)</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932301"><a href="/net/http/transport.go.html#3931999">errc</a></span>&nbsp;<span class="op" id="3932306">&lt;-</span>&nbsp;<span class="ident" id="3932309"><a href="/net/http/transport.go.html#3932228">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932315">}</span><span class="op" id="3932316">(</span><span class="op" id="3932317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932321">if</span>&nbsp;<span class="ident" id="3932324">err</span>&nbsp;<span class="op" id="3932328">:=</span>&nbsp;<span class="op" id="3932331">&lt;-</span><span class="ident" id="3932333"><a href="/net/http/transport.go.html#3931999">errc</a></span><span class="op" id="3932337">;</span>&nbsp;<span class="ident" id="3932339"><a href="/net/http/transport.go.html#3932324">err</a></span>&nbsp;<span class="op" id="3932343">!=</span>&nbsp;<span class="ident" id="3932346">nil</span>&nbsp;<span class="op" id="3932350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932355"><a href="/net/http/transport.go.html#3931933">plainConn</a></span><span class="op" id="3932364">.</span><span class="ident" id="3932365">Close</span><span class="op" id="3932370">(</span><span class="op" id="3932371">)</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932376">return</span>&nbsp;<span class="ident" id="3932383">nil</span><span class="op" id="3932386">,</span>&nbsp;<span class="ident" id="3932388"><a href="/net/http/transport.go.html#3932324">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932394">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932398">if</span>&nbsp;<span class="op" id="3932401">!</span><span class="ident" id="3932402"><a href="/net/http/transport.go.html#3931680">cfg</a></span><span class="op" id="3932405">.</span><span class="ident" id="3932406">InsecureSkipVerify</span>&nbsp;<span class="op" id="3932425">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932430">if</span>&nbsp;<span class="ident" id="3932433">err</span>&nbsp;<span class="op" id="3932437">:=</span>&nbsp;<span class="ident" id="3932440"><a href="/net/http/transport.go.html#3931959">tlsConn</a></span><span class="op" id="3932447">.</span><span class="ident" id="3932448">VerifyHostname</span><span class="op" id="3932462">(</span><span class="ident" id="3932463"><a href="/net/http/transport.go.html#3931680">cfg</a></span><span class="op" id="3932466">.</span><span class="ident" id="3932467">ServerName</span><span class="op" id="3932477">)</span><span class="op" id="3932478">;</span>&nbsp;<span class="ident" id="3932480"><a href="/net/http/transport.go.html#3932433">err</a></span>&nbsp;<span class="op" id="3932484">!=</span>&nbsp;<span class="ident" id="3932487">nil</span>&nbsp;<span class="op" id="3932491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932497"><a href="/net/http/transport.go.html#3931933">plainConn</a></span><span class="op" id="3932506">.</span><span class="ident" id="3932507">Close</span><span class="op" id="3932512">(</span><span class="op" id="3932513">)</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932519">return</span>&nbsp;<span class="ident" id="3932526">nil</span><span class="op" id="3932529">,</span>&nbsp;<span class="ident" id="3932531"><a href="/net/http/transport.go.html#3932433">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932538">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932546">cs</span>&nbsp;<span class="op" id="3932549">:=</span>&nbsp;<span class="ident" id="3932552"><a href="/net/http/transport.go.html#3931959">tlsConn</a></span><span class="op" id="3932559">.</span><span class="ident" id="3932560">ConnectionState</span><span class="op" id="3932575">(</span><span class="op" id="3932576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932580"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932585">.</span><span class="ident" id="3932586">tlsState</span>&nbsp;<span class="op" id="3932595">=</span>&nbsp;<span class="op" id="3932597">&amp;</span><span class="ident" id="3932598"><a href="/net/http/transport.go.html#3932546">cs</a></span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932603"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932608">.</span><span class="ident" id="3932609">conn</span>&nbsp;<span class="op" id="3932614">=</span>&nbsp;<span class="ident" id="3932616"><a href="/net/http/transport.go.html#3931959">tlsConn</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3932625">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932629"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932634">.</span><span class="ident" id="3932635">br</span>&nbsp;<span class="op" id="3932638">=</span>&nbsp;<span class="ident" id="3932640"><a href="/net/http/transport.go.html#3915281">bufio</a></span><span class="op" id="3932645">.</span><span class="ident" id="3932646">NewReader</span><span class="op" id="3932655">(</span><span class="ident" id="3932656"><a href="/net/http/transport.go.html#3949084">noteEOFReader</a></span><span class="op" id="3932669">{</span><span class="ident" id="3932670"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932675">.</span><span class="ident" id="3932676">conn</span><span class="op" id="3932680">,</span>&nbsp;<span class="op" id="3932682">&amp;</span><span class="ident" id="3932683"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932688">.</span><span class="ident" id="3932689">sawEOF</span><span class="op" id="3932695">}</span><span class="op" id="3932696">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3932699"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932704">.</span><span class="ident" id="3932705">bw</span>&nbsp;<span class="op" id="3932708">=</span>&nbsp;<span class="ident" id="3932710"><a href="/net/http/transport.go.html#3915281">bufio</a></span><span class="op" id="3932715">.</span><span class="ident" id="3932716">NewWriter</span><span class="op" id="3932725">(</span><span class="ident" id="3932726"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932731">.</span><span class="ident" id="3932732">conn</span><span class="op" id="3932736">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932739">go</span>&nbsp;<span class="ident" id="3932742"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932747">.</span><span class="ident" id="3932748">readLoop</span><span class="op" id="3932756">(</span><span class="op" id="3932757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932760">go</span>&nbsp;<span class="ident" id="3932763"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932768">.</span><span class="ident" id="3932769">writeLoop</span><span class="op" id="3932778">(</span><span class="op" id="3932779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3932782">return</span>&nbsp;<span class="ident" id="3932789"><a href="/net/http/transport.go.html#3929830">pconn</a></span><span class="op" id="3932794">,</span>&nbsp;<span class="ident" id="3932796">nil</span><br>
<span class="lineno"></span><span class="op" id="3932800">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">665</span><span class="comment" id="3932803">//&nbsp;useProxy&nbsp;returns&nbsp;true&nbsp;if&nbsp;requests&nbsp;to&nbsp;addr&nbsp;should&nbsp;use&nbsp;a&nbsp;proxy,</span><br>
<span class="lineno"></span><span class="comment" id="3932868">//&nbsp;according&nbsp;to&nbsp;the&nbsp;NO_PROXY&nbsp;or&nbsp;no_proxy&nbsp;environment&nbsp;variable.</span><br>
<span class="lineno"></span><span class="comment" id="3932931">//&nbsp;addr&nbsp;is&nbsp;always&nbsp;a&nbsp;canonicalAddr&nbsp;with&nbsp;a&nbsp;host&nbsp;and&nbsp;port.</span><br>
<span class="lineno"></span><span class="keyword" id="3932987">func</span>&nbsp;<span class="ident" id="3932992">useProxy</span><span class="op" id="3933000">(</span><span class="ident" id="3933001">addr</span>&nbsp;<span class="builtintype" id="3933006">string</span><span class="op" id="3933012">)</span>&nbsp;<span class="builtintype" id="3933014">bool</span>&nbsp;<span class="op" id="3933019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933022">if</span>&nbsp;<span class="builtinfunc" id="3933025">len</span><span class="op" id="3933028">(</span><span class="ident" id="3933029"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933033">)</span>&nbsp;<span class="op" id="3933035">==</span>&nbsp;<span class="num" id="3933038">0</span>&nbsp;<span class="op" id="3933040">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933044">return</span>&nbsp;<span class="ident" id="3933051">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933060">host</span><span class="op" id="3933064">,</span>&nbsp;<span class="ident" id="3933066">_</span><span class="op" id="3933067">,</span>&nbsp;<span class="ident" id="3933069">err</span>&nbsp;<span class="op" id="3933073">:=</span>&nbsp;<span class="ident" id="3933076"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3933079">.</span><span class="ident" id="3933080">SplitHostPort</span><span class="op" id="3933093">(</span><span class="ident" id="3933094"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933101">if</span>&nbsp;<span class="ident" id="3933104"><a href="/net/http/transport.go.html#3933069">err</a></span>&nbsp;<span class="op" id="3933108">!=</span>&nbsp;<span class="ident" id="3933111">nil</span>&nbsp;<span class="op" id="3933115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933119">return</span>&nbsp;<span class="ident" id="3933126">false</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933133">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933136">if</span>&nbsp;<span class="ident" id="3933139"><a href="/net/http/transport.go.html#3933060">host</a></span>&nbsp;<span class="op" id="3933144">==</span>&nbsp;<span class="string" id="3933147">&#34;localhost&#34;</span>&nbsp;<span class="op" id="3933159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933163">return</span>&nbsp;<span class="ident" id="3933170">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933180">if</span>&nbsp;<span class="ident" id="3933183">ip</span>&nbsp;<span class="op" id="3933186">:=</span>&nbsp;<span class="ident" id="3933189"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3933192">.</span><span class="ident" id="3933193">ParseIP</span><span class="op" id="3933200">(</span><span class="ident" id="3933201"><a href="/net/http/transport.go.html#3933060">host</a></span><span class="op" id="3933205">)</span><span class="op" id="3933206">;</span>&nbsp;<span class="ident" id="3933208"><a href="/net/http/transport.go.html#3933183">ip</a></span>&nbsp;<span class="op" id="3933211">!=</span>&nbsp;<span class="ident" id="3933214">nil</span>&nbsp;<span class="op" id="3933218">{</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933222">if</span>&nbsp;<span class="ident" id="3933225"><a href="/net/http/transport.go.html#3933183">ip</a></span><span class="op" id="3933227">.</span><span class="ident" id="3933228">IsLoopback</span><span class="op" id="3933238">(</span><span class="op" id="3933239">)</span>&nbsp;<span class="op" id="3933241">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933246">return</span>&nbsp;<span class="ident" id="3933253">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933261">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933268">no_proxy</span>&nbsp;<span class="op" id="3933277">:=</span>&nbsp;<span class="ident" id="3933280"><a href="/net/http/transport.go.html#3924114">noProxyEnv</a></span><span class="op" id="3933290">.</span><span class="ident" id="3933291">Get</span><span class="op" id="3933294">(</span><span class="op" id="3933295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933298">if</span>&nbsp;<span class="ident" id="3933301"><a href="/net/http/transport.go.html#3933268">no_proxy</a></span>&nbsp;<span class="op" id="3933310">==</span>&nbsp;<span class="string" id="3933313">&#34;*&#34;</span>&nbsp;<span class="op" id="3933317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933321">return</span>&nbsp;<span class="ident" id="3933328">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933335">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933339"><a href="/net/http/transport.go.html#3933001">addr</a></span>&nbsp;<span class="op" id="3933344">=</span>&nbsp;<span class="ident" id="3933346"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933353">.</span><span class="ident" id="3933354">ToLower</span><span class="op" id="3933361">(</span><span class="ident" id="3933362"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933369">.</span><span class="ident" id="3933370">TrimSpace</span><span class="op" id="3933379">(</span><span class="ident" id="3933380"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933384">)</span><span class="op" id="3933385">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933388">if</span>&nbsp;<span class="ident" id="3933391"><a href="/net/http/client.go.html#3738992">hasPort</a></span><span class="op" id="3933398">(</span><span class="ident" id="3933399"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933403">)</span>&nbsp;<span class="op" id="3933405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933409"><a href="/net/http/transport.go.html#3933001">addr</a></span>&nbsp;<span class="op" id="3933414">=</span>&nbsp;<span class="ident" id="3933416"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933420">[</span><span class="op" id="3933421">:</span><span class="ident" id="3933422"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933429">.</span><span class="ident" id="3933430">LastIndex</span><span class="op" id="3933439">(</span><span class="ident" id="3933440"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933444">,</span>&nbsp;<span class="string" id="3933446">&#34;:&#34;</span><span class="op" id="3933449">)</span><span class="op" id="3933450">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933457">for</span>&nbsp;<span class="ident" id="3933461">_</span><span class="op" id="3933462">,</span>&nbsp;<span class="ident" id="3933464">p</span>&nbsp;<span class="op" id="3933466">:=</span>&nbsp;<span class="keyword" id="3933469">range</span>&nbsp;<span class="ident" id="3933475"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933482">.</span><span class="ident" id="3933483">Split</span><span class="op" id="3933488">(</span><span class="ident" id="3933489"><a href="/net/http/transport.go.html#3933268">no_proxy</a></span><span class="op" id="3933497">,</span>&nbsp;<span class="string" id="3933499">&#34;,&#34;</span><span class="op" id="3933502">)</span>&nbsp;<span class="op" id="3933504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933508"><a href="/net/http/transport.go.html#3933464">p</a></span>&nbsp;<span class="op" id="3933510">=</span>&nbsp;<span class="ident" id="3933512"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933519">.</span><span class="ident" id="3933520">ToLower</span><span class="op" id="3933527">(</span><span class="ident" id="3933528"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933535">.</span><span class="ident" id="3933536">TrimSpace</span><span class="op" id="3933545">(</span><span class="ident" id="3933546"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933547">)</span><span class="op" id="3933548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933552">if</span>&nbsp;<span class="builtinfunc" id="3933555">len</span><span class="op" id="3933558">(</span><span class="ident" id="3933559"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933560">)</span>&nbsp;<span class="op" id="3933562">==</span>&nbsp;<span class="num" id="3933565">0</span>&nbsp;<span class="op" id="3933567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933572">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933583">}</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933587">if</span>&nbsp;<span class="ident" id="3933590"><a href="/net/http/client.go.html#3738992">hasPort</a></span><span class="op" id="3933597">(</span><span class="ident" id="3933598"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933599">)</span>&nbsp;<span class="op" id="3933601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3933606"><a href="/net/http/transport.go.html#3933464">p</a></span>&nbsp;<span class="op" id="3933608">=</span>&nbsp;<span class="ident" id="3933610"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933611">[</span><span class="op" id="3933612">:</span><span class="ident" id="3933613"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933620">.</span><span class="ident" id="3933621">LastIndex</span><span class="op" id="3933630">(</span><span class="ident" id="3933631"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933632">,</span>&nbsp;<span class="string" id="3933634">&#34;:&#34;</span><span class="op" id="3933637">)</span><span class="op" id="3933638">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933642">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933646">if</span>&nbsp;<span class="ident" id="3933649"><a href="/net/http/transport.go.html#3933001">addr</a></span>&nbsp;<span class="op" id="3933654">==</span>&nbsp;<span class="ident" id="3933657"><a href="/net/http/transport.go.html#3933464">p</a></span>&nbsp;<span class="op" id="3933659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933664">return</span>&nbsp;<span class="ident" id="3933671">false</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933679">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933683">if</span>&nbsp;<span class="ident" id="3933686"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933687">[</span><span class="num" id="3933688">0</span><span class="op" id="3933689">]</span>&nbsp;<span class="op" id="3933691">==</span>&nbsp;<span class="string" id="3933694">&#39;.&#39;</span>&nbsp;<span class="op" id="3933698">&amp;&amp;</span>&nbsp;<span class="op" id="3933701">(</span><span class="ident" id="3933702"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933709">.</span><span class="ident" id="3933710">HasSuffix</span><span class="op" id="3933719">(</span><span class="ident" id="3933720"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933724">,</span>&nbsp;<span class="ident" id="3933726"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933727">)</span>&nbsp;<span class="op" id="3933729">||</span>&nbsp;<span class="ident" id="3933732"><a href="/net/http/transport.go.html#3933001">addr</a></span>&nbsp;<span class="op" id="3933737">==</span>&nbsp;<span class="ident" id="3933740"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933741">[</span><span class="num" id="3933742">1</span><span class="op" id="3933743">:</span><span class="op" id="3933744">]</span><span class="op" id="3933745">)</span>&nbsp;<span class="op" id="3933747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933752">//&nbsp;no_proxy&nbsp;&#34;.foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;&nbsp;or&nbsp;&#34;foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933813">return</span>&nbsp;<span class="ident" id="3933820">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933828">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933832">if</span>&nbsp;<span class="ident" id="3933835"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933836">[</span><span class="num" id="3933837">0</span><span class="op" id="3933838">]</span>&nbsp;<span class="op" id="3933840">!=</span>&nbsp;<span class="string" id="3933843">&#39;.&#39;</span>&nbsp;<span class="op" id="3933847">&amp;&amp;</span>&nbsp;<span class="ident" id="3933850"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3933857">.</span><span class="ident" id="3933858">HasSuffix</span><span class="op" id="3933867">(</span><span class="ident" id="3933868"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933872">,</span>&nbsp;<span class="ident" id="3933874"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933875">)</span>&nbsp;<span class="op" id="3933877">&amp;&amp;</span>&nbsp;<span class="ident" id="3933880"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933884">[</span><span class="builtinfunc" id="3933885">len</span><span class="op" id="3933888">(</span><span class="ident" id="3933889"><a href="/net/http/transport.go.html#3933001">addr</a></span><span class="op" id="3933893">)</span><span class="op" id="3933894">-</span><span class="builtinfunc" id="3933895">len</span><span class="op" id="3933898">(</span><span class="ident" id="3933899"><a href="/net/http/transport.go.html#3933464">p</a></span><span class="op" id="3933900">)</span><span class="op" id="3933901">-</span><span class="num" id="3933902">1</span><span class="op" id="3933903">]</span>&nbsp;<span class="op" id="3933905">==</span>&nbsp;<span class="string" id="3933908">&#39;.&#39;</span>&nbsp;<span class="op" id="3933912">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3933917">//&nbsp;no_proxy&nbsp;&#34;foo.com&#34;&nbsp;matches&nbsp;&#34;bar.foo.com&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933964">return</span>&nbsp;<span class="ident" id="3933971">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3933982">}</span><br>
<span class="lineno">715</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3933985">return</span>&nbsp;<span class="ident" id="3933992">true</span><br>
<span class="lineno"></span><span class="op" id="3933997">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3934000">//&nbsp;connectMethod&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;(in&nbsp;its&nbsp;String&nbsp;form)&nbsp;for&nbsp;keeping&nbsp;persistent</span><br>
<span class="lineno"></span><span class="comment" id="3934076">//&nbsp;TCP&nbsp;connections&nbsp;alive&nbsp;for&nbsp;subsequent&nbsp;HTTP&nbsp;requests.</span><br>
<span class="lineno">720</span><span class="comment" id="3934131">//</span><br>
<span class="lineno"></span><span class="comment" id="3934134">//&nbsp;A&nbsp;connect&nbsp;method&nbsp;may&nbsp;be&nbsp;of&nbsp;the&nbsp;following&nbsp;types:</span><br>
<span class="lineno"></span><span class="comment" id="3934185">//</span><br>
<span class="lineno"></span><span class="comment" id="3934188">//&nbsp;Cache&nbsp;key&nbsp;form&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description</span><br>
<span class="lineno"></span><span class="comment" id="3934233">//&nbsp;-----------------&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-------------------------</span><br>
<span class="lineno">725</span><span class="comment" id="3934292">//&nbsp;|http|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="3934359">//&nbsp;|https|foo.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https&nbsp;directly&nbsp;to&nbsp;server,&nbsp;no&nbsp;proxy</span><br>
<span class="lineno"></span><span class="comment" id="3934427">//&nbsp;http://proxy.com|https|foo.com&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;then&nbsp;CONNECT&nbsp;to&nbsp;foo.com</span><br>
<span class="lineno"></span><span class="comment" id="3934501">//&nbsp;http://proxy.com|http&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http&nbsp;to&nbsp;proxy,&nbsp;http&nbsp;to&nbsp;anywhere&nbsp;after&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="3934579">//</span><br>
<span class="lineno">730</span><span class="comment" id="3934582">//&nbsp;Note:&nbsp;no&nbsp;support&nbsp;to&nbsp;https&nbsp;to&nbsp;the&nbsp;proxy&nbsp;yet.</span><br>
<span class="lineno"></span><span class="comment" id="3934629">//</span><br>
<span class="lineno"></span><span class="keyword" id="3934632">type</span>&nbsp;<span class="ident" id="3934637">connectMethod</span>&nbsp;<span class="keyword" id="3934651">struct</span>&nbsp;<span class="op" id="3934658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934661">proxyURL</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3934674">*</span><span class="ident" id="3934675"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3934678">.</span><span class="ident" id="3934679">URL</span>&nbsp;<span class="comment" id="3934683">//&nbsp;nil&nbsp;for&nbsp;no&nbsp;proxy,&nbsp;else&nbsp;full&nbsp;proxy&nbsp;URL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934725">targetScheme</span>&nbsp;<span class="builtintype" id="3934738">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3934747">//&nbsp;&#34;http&#34;&nbsp;or&nbsp;&#34;https&#34;</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934769">targetAddr</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3934782">string</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3934791">//&nbsp;Not&nbsp;used&nbsp;if&nbsp;proxy&nbsp;+&nbsp;http&nbsp;targetScheme&nbsp;(4th&nbsp;example&nbsp;in&nbsp;table)</span><br>
<span class="lineno"></span><span class="op" id="3934855">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3934858">func</span>&nbsp;<span class="op" id="3934863">(</span><span class="ident" id="3934864">cm</span>&nbsp;<span class="op" id="3934867">*</span><span class="ident" id="3934868"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3934881">)</span>&nbsp;<span class="ident" id="3934883">key</span><span class="op" id="3934886">(</span><span class="op" id="3934887">)</span>&nbsp;<span class="ident" id="3934889"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span>&nbsp;<span class="op" id="3934906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934909">proxyStr</span>&nbsp;<span class="op" id="3934918">:=</span>&nbsp;<span class="string" id="3934921">&#34;&#34;</span><br>
<span class="lineno">740</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934925">targetAddr</span>&nbsp;<span class="op" id="3934936">:=</span>&nbsp;<span class="ident" id="3934939"><a href="/net/http/transport.go.html#3934864">cm</a></span><span class="op" id="3934941">.</span><span class="ident" id="3934942">targetAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3934954">if</span>&nbsp;<span class="ident" id="3934957"><a href="/net/http/transport.go.html#3934864">cm</a></span><span class="op" id="3934959">.</span><span class="ident" id="3934960">proxyURL</span>&nbsp;<span class="op" id="3934969">!=</span>&nbsp;<span class="ident" id="3934972">nil</span>&nbsp;<span class="op" id="3934976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3934980"><a href="/net/http/transport.go.html#3934909">proxyStr</a></span>&nbsp;<span class="op" id="3934989">=</span>&nbsp;<span class="ident" id="3934991"><a href="/net/http/transport.go.html#3934864">cm</a></span><span class="op" id="3934993">.</span><span class="ident" id="3934994">proxyURL</span><span class="op" id="3935002">.</span><span class="ident" id="3935003">String</span><span class="op" id="3935009">(</span><span class="op" id="3935010">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935014">if</span>&nbsp;<span class="ident" id="3935017"><a href="/net/http/transport.go.html#3934864">cm</a></span><span class="op" id="3935019">.</span><span class="ident" id="3935020">targetScheme</span>&nbsp;<span class="op" id="3935033">==</span>&nbsp;<span class="string" id="3935036">&#34;http&#34;</span>&nbsp;<span class="op" id="3935043">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935048"><a href="/net/http/transport.go.html#3934925">targetAddr</a></span>&nbsp;<span class="op" id="3935059">=</span>&nbsp;<span class="string" id="3935061">&#34;&#34;</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935066">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935072">return</span>&nbsp;<span class="ident" id="3935079"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3935095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935099">proxy</span><span class="op" id="3935104">:</span>&nbsp;&nbsp;<span class="ident" id="3935107"><a href="/net/http/transport.go.html#3934909">proxyStr</a></span><span class="op" id="3935115">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935119">scheme</span><span class="op" id="3935125">:</span>&nbsp;<span class="ident" id="3935127"><a href="/net/http/transport.go.html#3934864">cm</a></span><span class="op" id="3935129">.</span><span class="ident" id="3935130">targetScheme</span><span class="op" id="3935142">,</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935146">addr</span><span class="op" id="3935150">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3935154"><a href="/net/http/transport.go.html#3934925">targetAddr</a></span><span class="op" id="3935164">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935167">}</span><br>
<span class="lineno"></span><span class="op" id="3935169">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935172">//&nbsp;addr&nbsp;returns&nbsp;the&nbsp;first&nbsp;hop&nbsp;&#34;host:port&#34;&nbsp;to&nbsp;which&nbsp;we&nbsp;need&nbsp;to&nbsp;TCP&nbsp;connect.</span><br>
<span class="lineno">755</span><span class="keyword" id="3935247">func</span>&nbsp;<span class="op" id="3935252">(</span><span class="ident" id="3935253">cm</span>&nbsp;<span class="op" id="3935256">*</span><span class="ident" id="3935257"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3935270">)</span>&nbsp;<span class="ident" id="3935272">addr</span><span class="op" id="3935276">(</span><span class="op" id="3935277">)</span>&nbsp;<span class="builtintype" id="3935279">string</span>&nbsp;<span class="op" id="3935286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935289">if</span>&nbsp;<span class="ident" id="3935292"><a href="/net/http/transport.go.html#3935253">cm</a></span><span class="op" id="3935294">.</span><span class="ident" id="3935295">proxyURL</span>&nbsp;<span class="op" id="3935304">!=</span>&nbsp;<span class="ident" id="3935307">nil</span>&nbsp;<span class="op" id="3935311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935315">return</span>&nbsp;<span class="ident" id="3935322"><a href="/net/http/transport.go.html#3946635">canonicalAddr</a></span><span class="op" id="3935335">(</span><span class="ident" id="3935336"><a href="/net/http/transport.go.html#3935253">cm</a></span><span class="op" id="3935338">.</span><span class="ident" id="3935339">proxyURL</span><span class="op" id="3935347">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935350">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935353">return</span>&nbsp;<span class="ident" id="3935360"><a href="/net/http/transport.go.html#3935253">cm</a></span><span class="op" id="3935362">.</span><span class="ident" id="3935363">targetAddr</span><br>
<span class="lineno">760</span><span class="op" id="3935374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935377">//&nbsp;tlsHost&nbsp;returns&nbsp;the&nbsp;host&nbsp;name&nbsp;to&nbsp;match&nbsp;against&nbsp;the&nbsp;peer&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3935438">//&nbsp;TLS&nbsp;certificate.</span><br>
<span class="lineno"></span><span class="keyword" id="3935458">func</span>&nbsp;<span class="op" id="3935463">(</span><span class="ident" id="3935464">cm</span>&nbsp;<span class="op" id="3935467">*</span><span class="ident" id="3935468"><a href="/net/http/transport.go.html#3934637">connectMethod</a></span><span class="op" id="3935481">)</span>&nbsp;<span class="ident" id="3935483">tlsHost</span><span class="op" id="3935490">(</span><span class="op" id="3935491">)</span>&nbsp;<span class="builtintype" id="3935493">string</span>&nbsp;<span class="op" id="3935500">{</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935503">h</span>&nbsp;<span class="op" id="3935505">:=</span>&nbsp;<span class="ident" id="3935508"><a href="/net/http/transport.go.html#3935464">cm</a></span><span class="op" id="3935510">.</span><span class="ident" id="3935511">targetAddr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935523">if</span>&nbsp;<span class="ident" id="3935526"><a href="/net/http/client.go.html#3738992">hasPort</a></span><span class="op" id="3935533">(</span><span class="ident" id="3935534"><a href="/net/http/transport.go.html#3935503">h</a></span><span class="op" id="3935535">)</span>&nbsp;<span class="op" id="3935537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935541"><a href="/net/http/transport.go.html#3935503">h</a></span>&nbsp;<span class="op" id="3935543">=</span>&nbsp;<span class="ident" id="3935545"><a href="/net/http/transport.go.html#3935503">h</a></span><span class="op" id="3935546">[</span><span class="op" id="3935547">:</span><span class="ident" id="3935548"><a href="/net/http/transport.go.html#3915375">strings</a></span><span class="op" id="3935555">.</span><span class="ident" id="3935556">LastIndex</span><span class="op" id="3935565">(</span><span class="ident" id="3935566"><a href="/net/http/transport.go.html#3935503">h</a></span><span class="op" id="3935567">,</span>&nbsp;<span class="string" id="3935569">&#34;:&#34;</span><span class="op" id="3935572">)</span><span class="op" id="3935573">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3935576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935579">return</span>&nbsp;<span class="ident" id="3935586"><a href="/net/http/transport.go.html#3935503">h</a></span><br>
<span class="lineno">770</span><span class="op" id="3935588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935591">//&nbsp;connectMethodKey&nbsp;is&nbsp;the&nbsp;map&nbsp;key&nbsp;version&nbsp;of&nbsp;connectMethod,&nbsp;with&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="3935659">//&nbsp;stringified&nbsp;proxy&nbsp;URL&nbsp;(or&nbsp;the&nbsp;empty&nbsp;string)&nbsp;instead&nbsp;of&nbsp;a&nbsp;pointer&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3935730">//&nbsp;a&nbsp;URL.</span><br>
<span class="lineno">775</span><span class="keyword" id="3935740">type</span>&nbsp;<span class="ident" id="3935745">connectMethodKey</span>&nbsp;<span class="keyword" id="3935762">struct</span>&nbsp;<span class="op" id="3935769">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3935772">proxy</span><span class="op" id="3935777">,</span>&nbsp;<span class="ident" id="3935779">scheme</span><span class="op" id="3935785">,</span>&nbsp;<span class="ident" id="3935787">addr</span>&nbsp;<span class="builtintype" id="3935792">string</span><br>
<span class="lineno"></span><span class="op" id="3935799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3935802">func</span>&nbsp;<span class="op" id="3935807">(</span><span class="ident" id="3935808">k</span>&nbsp;<span class="ident" id="3935810"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><span class="op" id="3935826">)</span>&nbsp;<span class="ident" id="3935828">String</span><span class="op" id="3935834">(</span><span class="op" id="3935835">)</span>&nbsp;<span class="builtintype" id="3935837">string</span>&nbsp;<span class="op" id="3935844">{</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3935847">//&nbsp;Only&nbsp;used&nbsp;by&nbsp;tests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3935871">return</span>&nbsp;<span class="ident" id="3935878"><a href="/net/http/transport.go.html#3915331">fmt</a></span><span class="op" id="3935881">.</span><span class="ident" id="3935882">Sprintf</span><span class="op" id="3935889">(</span><span class="string" id="3935890">&#34;%s|%s|%s&#34;</span><span class="op" id="3935900">,</span>&nbsp;<span class="ident" id="3935902"><a href="/net/http/transport.go.html#3935808">k</a></span><span class="op" id="3935903">.</span><span class="ident" id="3935904">proxy</span><span class="op" id="3935909">,</span>&nbsp;<span class="ident" id="3935911"><a href="/net/http/transport.go.html#3935808">k</a></span><span class="op" id="3935912">.</span><span class="ident" id="3935913">scheme</span><span class="op" id="3935919">,</span>&nbsp;<span class="ident" id="3935921"><a href="/net/http/transport.go.html#3935808">k</a></span><span class="op" id="3935922">.</span><span class="ident" id="3935923">addr</span><span class="op" id="3935927">)</span><br>
<span class="lineno"></span><span class="op" id="3935929">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3935932">//&nbsp;persistConn&nbsp;wraps&nbsp;a&nbsp;connection,&nbsp;usually&nbsp;a&nbsp;persistent&nbsp;one</span><br>
<span class="lineno">785</span><span class="comment" id="3935992">//&nbsp;(but&nbsp;may&nbsp;be&nbsp;used&nbsp;for&nbsp;non-keep-alive&nbsp;requests&nbsp;as&nbsp;well)</span><br>
<span class="lineno"></span><span class="keyword" id="3936049">type</span>&nbsp;<span class="ident" id="3936054">persistConn</span>&nbsp;<span class="keyword" id="3936066">struct</span>&nbsp;<span class="op" id="3936073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936076">t</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3936085">*</span><span class="ident" id="3936086"><a href="/net/http/transport.go.html#3916265">Transport</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936097">cacheKey</span>&nbsp;<span class="ident" id="3936106"><a href="/net/http/transport.go.html#3935745">connectMethodKey</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936124">conn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3936133"><a href="/net/http/transport.go.html#3915351">net</a></span><span class="op" id="3936136">.</span><span class="ident" id="3936137">Conn</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936143">tlsState</span>&nbsp;<span class="op" id="3936152">*</span><span class="ident" id="3936153"><a href="/net/http/transport.go.html#3915307">tls</a></span><span class="op" id="3936156">.</span><span class="ident" id="3936157">ConnectionState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936174">br</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3936183">*</span><span class="ident" id="3936184"><a href="/net/http/transport.go.html#3915281">bufio</a></span><span class="op" id="3936189">.</span><span class="ident" id="3936190">Reader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3936203">//&nbsp;from&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936217">sawEOF</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3936226">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3936246">//&nbsp;whether&nbsp;we&#39;ve&nbsp;seen&nbsp;EOF&nbsp;from&nbsp;conn;&nbsp;owned&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936302">bw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3936311">*</span><span class="ident" id="3936312"><a href="/net/http/transport.go.html#3915281">bufio</a></span><span class="op" id="3936317">.</span><span class="ident" id="3936318">Writer</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3936331">//&nbsp;to&nbsp;conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936343">reqch</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3936352">chan</span>&nbsp;<span class="ident" id="3936357"><a href="/net/http/transport.go.html#3941934">requestAndChan</a></span>&nbsp;<span class="comment" id="3936372">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;readLoop</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936415">writech</span>&nbsp;&nbsp;<span class="keyword" id="3936424">chan</span>&nbsp;<span class="ident" id="3936429"><a href="/net/http/transport.go.html#3942381">writeRequest</a></span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3936444">//&nbsp;written&nbsp;by&nbsp;roundTrip;&nbsp;read&nbsp;by&nbsp;writeLoop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936488">closech</span>&nbsp;&nbsp;<span class="keyword" id="3936497">chan</span>&nbsp;<span class="keyword" id="3936502">struct</span><span class="op" id="3936508">{</span><span class="op" id="3936509">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3936517">//&nbsp;closed&nbsp;when&nbsp;conn&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936545">isProxy</span>&nbsp;&nbsp;<span class="builtintype" id="3936554">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936560">//&nbsp;writeErrCh&nbsp;passes&nbsp;the&nbsp;request&nbsp;write&nbsp;error&nbsp;(usually&nbsp;nil)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936620">//&nbsp;from&nbsp;the&nbsp;writeLoop&nbsp;goroutine&nbsp;to&nbsp;the&nbsp;readLoop&nbsp;which&nbsp;passes</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936682">//&nbsp;it&nbsp;off&nbsp;to&nbsp;the&nbsp;res.Body&nbsp;reader,&nbsp;which&nbsp;then&nbsp;uses&nbsp;it&nbsp;to&nbsp;decide</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3936746">//&nbsp;whether&nbsp;or&nbsp;not&nbsp;a&nbsp;connection&nbsp;can&nbsp;be&nbsp;reused.&nbsp;Issue&nbsp;7569.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936805">writeErrCh</span>&nbsp;<span class="keyword" id="3936816">chan</span>&nbsp;<span class="builtintype" id="3936821">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936829">lk</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3936850"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3936854">.</span><span class="ident" id="3936855">Mutex</span>&nbsp;<span class="comment" id="3936861">//&nbsp;guards&nbsp;following&nbsp;fields</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936889">numExpectedResponses</span>&nbsp;<span class="builtintype" id="3936910">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936915">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3936936">bool</span>&nbsp;<span class="comment" id="3936941">//&nbsp;whether&nbsp;conn&nbsp;has&nbsp;been&nbsp;closed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3936974">broken</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3936995">bool</span>&nbsp;<span class="comment" id="3937000">//&nbsp;an&nbsp;error&nbsp;has&nbsp;happened&nbsp;on&nbsp;this&nbsp;connection;&nbsp;marked&nbsp;broken&nbsp;so&nbsp;it&#39;s&nbsp;not&nbsp;reused.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937080">//&nbsp;mutateHeaderFunc&nbsp;is&nbsp;an&nbsp;optional&nbsp;func&nbsp;to&nbsp;modify&nbsp;extra</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937137">//&nbsp;headers&nbsp;on&nbsp;each&nbsp;outbound&nbsp;request&nbsp;before&nbsp;it&#39;s&nbsp;written.&nbsp;(the</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3937200">//&nbsp;original&nbsp;Request&nbsp;given&nbsp;to&nbsp;RoundTrip&nbsp;is&nbsp;not&nbsp;modified)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937257">mutateHeaderFunc</span>&nbsp;<span class="keyword" id="3937274">func</span><span class="op" id="3937278">(</span><span class="ident" id="3937279"><a href="/net/http/header.go.html#3781581">Header</a></span><span class="op" id="3937285">)</span><br>
<span class="lineno"></span><span class="op" id="3937287">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3937290">//&nbsp;isBroken&nbsp;reports&nbsp;whether&nbsp;this&nbsp;connection&nbsp;is&nbsp;in&nbsp;a&nbsp;known&nbsp;broken&nbsp;state.</span><br>
<span class="lineno">815</span><span class="keyword" id="3937362">func</span>&nbsp;<span class="op" id="3937367">(</span><span class="ident" id="3937368">pc</span>&nbsp;<span class="op" id="3937371">*</span><span class="ident" id="3937372"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3937383">)</span>&nbsp;<span class="ident" id="3937385">isBroken</span><span class="op" id="3937393">(</span><span class="op" id="3937394">)</span>&nbsp;<span class="builtintype" id="3937396">bool</span>&nbsp;<span class="op" id="3937401">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937404"><a href="/net/http/transport.go.html#3937368">pc</a></span><span class="op" id="3937406">.</span><span class="ident" id="3937407">lk</span><span class="op" id="3937409">.</span><span class="ident" id="3937410">Lock</span><span class="op" id="3937414">(</span><span class="op" id="3937415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937418">b</span>&nbsp;<span class="op" id="3937420">:=</span>&nbsp;<span class="ident" id="3937423"><a href="/net/http/transport.go.html#3937368">pc</a></span><span class="op" id="3937425">.</span><span class="ident" id="3937426">broken</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937434"><a href="/net/http/transport.go.html#3937368">pc</a></span><span class="op" id="3937436">.</span><span class="ident" id="3937437">lk</span><span class="op" id="3937439">.</span><span class="ident" id="3937440">Unlock</span><span class="op" id="3937446">(</span><span class="op" id="3937447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937450">return</span>&nbsp;<span class="ident" id="3937457"><a href="/net/http/transport.go.html#3937418">b</a></span><br>
<span class="lineno">820</span><span class="op" id="3937459">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3937462">func</span>&nbsp;<span class="op" id="3937467">(</span><span class="ident" id="3937468">pc</span>&nbsp;<span class="op" id="3937471">*</span><span class="ident" id="3937472"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3937483">)</span>&nbsp;<span class="ident" id="3937485">cancelRequest</span><span class="op" id="3937498">(</span><span class="op" id="3937499">)</span>&nbsp;<span class="op" id="3937501">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937504"><a href="/net/http/transport.go.html#3937468">pc</a></span><span class="op" id="3937506">.</span><span class="ident" id="3937507">conn</span><span class="op" id="3937511">.</span><span class="ident" id="3937512">Close</span><span class="op" id="3937517">(</span><span class="op" id="3937518">)</span><br>
<span class="lineno"></span><span class="op" id="3937520">}</span><br>
<span class="lineno">825</span><br>
<span class="lineno"></span><span class="keyword" id="3937523">var</span>&nbsp;<span class="ident" id="3937527">remoteSideClosedFunc</span>&nbsp;<span class="keyword" id="3937548">func</span><span class="op" id="3937552">(</span><span class="builtintype" id="3937553">error</span><span class="op" id="3937558">)</span>&nbsp;<span class="builtintype" id="3937560">bool</span>&nbsp;<span class="comment" id="3937565">//&nbsp;or&nbsp;nil&nbsp;to&nbsp;use&nbsp;default</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3937591">func</span>&nbsp;<span class="ident" id="3937596">remoteSideClosed</span><span class="op" id="3937612">(</span><span class="ident" id="3937613">err</span>&nbsp;<span class="builtintype" id="3937617">error</span><span class="op" id="3937622">)</span>&nbsp;<span class="builtintype" id="3937624">bool</span>&nbsp;<span class="op" id="3937629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937632">if</span>&nbsp;<span class="ident" id="3937635"><a href="/net/http/transport.go.html#3937613">err</a></span>&nbsp;<span class="op" id="3937639">==</span>&nbsp;<span class="ident" id="3937642"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3937644">.</span><span class="ident" id="3937645">EOF</span>&nbsp;<span class="op" id="3937649">{</span><br>
<span class="lineno">830</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937653">return</span>&nbsp;<span class="ident" id="3937660">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937666">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937669">if</span>&nbsp;<span class="ident" id="3937672"><a href="/net/http/transport.go.html#3937527">remoteSideClosedFunc</a></span>&nbsp;<span class="op" id="3937693">!=</span>&nbsp;<span class="ident" id="3937696">nil</span>&nbsp;<span class="op" id="3937700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937704">return</span>&nbsp;<span class="ident" id="3937711"><a href="/net/http/transport.go.html#3937527">remoteSideClosedFunc</a></span><span class="op" id="3937731">(</span><span class="ident" id="3937732"><a href="/net/http/transport.go.html#3937613">err</a></span><span class="op" id="3937735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3937738">}</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937741">return</span>&nbsp;<span class="ident" id="3937748">false</span><br>
<span class="lineno"></span><span class="op" id="3937754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3937757">func</span>&nbsp;<span class="op" id="3937762">(</span><span class="ident" id="3937763">pc</span>&nbsp;<span class="op" id="3937766">*</span><span class="ident" id="3937767"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3937778">)</span>&nbsp;<span class="ident" id="3937780">readLoop</span><span class="op" id="3937788">(</span><span class="op" id="3937789">)</span>&nbsp;<span class="op" id="3937791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937794">alive</span>&nbsp;<span class="op" id="3937800">:=</span>&nbsp;<span class="ident" id="3937803">true</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937810">for</span>&nbsp;<span class="ident" id="3937814"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3937820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937824">pb</span><span class="op" id="3937826">,</span>&nbsp;<span class="ident" id="3937828">err</span>&nbsp;<span class="op" id="3937832">:=</span>&nbsp;<span class="ident" id="3937835"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3937837">.</span><span class="ident" id="3937838">br</span><span class="op" id="3937840">.</span><span class="ident" id="3937841">Peek</span><span class="op" id="3937845">(</span><span class="num" id="3937846">1</span><span class="op" id="3937847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937852"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3937854">.</span><span class="ident" id="3937855">lk</span><span class="op" id="3937857">.</span><span class="ident" id="3937858">Lock</span><span class="op" id="3937862">(</span><span class="op" id="3937863">)</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937867">if</span>&nbsp;<span class="ident" id="3937870"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3937872">.</span><span class="ident" id="3937873">numExpectedResponses</span>&nbsp;<span class="op" id="3937894">==</span>&nbsp;<span class="num" id="3937897">0</span>&nbsp;<span class="op" id="3937899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937904">if</span>&nbsp;<span class="op" id="3937907">!</span><span class="ident" id="3937908"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3937910">.</span><span class="ident" id="3937911">closed</span>&nbsp;<span class="op" id="3937918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937924"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3937926">.</span><span class="ident" id="3937927">closeLocked</span><span class="op" id="3937938">(</span><span class="op" id="3937939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3937945">if</span>&nbsp;<span class="builtinfunc" id="3937948">len</span><span class="op" id="3937951">(</span><span class="ident" id="3937952"><a href="/net/http/transport.go.html#3937824">pb</a></span><span class="op" id="3937954">)</span>&nbsp;<span class="op" id="3937956">&gt;</span>&nbsp;<span class="num" id="3937958">0</span>&nbsp;<span class="op" id="3937960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3937967"><a href="/net/http/transport.go.html#3915344">log</a></span><span class="op" id="3937970">.</span><span class="ident" id="3937971">Printf</span><span class="op" id="3937977">(</span><span class="string" id="3937978">&#34;Unsolicited&nbsp;response&nbsp;received&nbsp;on&nbsp;idle&nbsp;HTTP&nbsp;channel&nbsp;starting&nbsp;with&nbsp;%q;&nbsp;err=%v&#34;</span><span class="op" id="3938055">,</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="3938063">string</span><span class="op" id="3938069">(</span><span class="ident" id="3938070"><a href="/net/http/transport.go.html#3937824">pb</a></span><span class="op" id="3938072">)</span><span class="op" id="3938073">,</span>&nbsp;<span class="ident" id="3938075"><a href="/net/http/transport.go.html#3937828">err</a></span><span class="op" id="3938078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938094"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938096">.</span><span class="ident" id="3938097">lk</span><span class="op" id="3938099">.</span><span class="ident" id="3938100">Unlock</span><span class="op" id="3938106">(</span><span class="op" id="3938107">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938112">return</span><br>
<span class="lineno">855</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938125"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938127">.</span><span class="ident" id="3938128">lk</span><span class="op" id="3938130">.</span><span class="ident" id="3938131">Unlock</span><span class="op" id="3938137">(</span><span class="op" id="3938138">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938143">rc</span>&nbsp;<span class="op" id="3938146">:=</span>&nbsp;<span class="op" id="3938149">&lt;-</span><span class="ident" id="3938151"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938153">.</span><span class="ident" id="3938154">reqch</span><br>
<span class="lineno"></span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938163">var</span>&nbsp;<span class="ident" id="3938167">resp</span>&nbsp;<span class="op" id="3938172">*</span><span class="ident" id="3938173"><a href="/net/http/response.go.html#3816973">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938184">if</span>&nbsp;<span class="ident" id="3938187"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3938191">==</span>&nbsp;<span class="ident" id="3938194">nil</span>&nbsp;<span class="op" id="3938198">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938203"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938207">,</span>&nbsp;<span class="ident" id="3938209"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3938213">=</span>&nbsp;<span class="ident" id="3938215"><a href="/net/http/response.go.html#3820176">ReadResponse</a></span><span class="op" id="3938227">(</span><span class="ident" id="3938228"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938230">.</span><span class="ident" id="3938231">br</span><span class="op" id="3938233">,</span>&nbsp;<span class="ident" id="3938235"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3938237">.</span><span class="ident" id="3938238">req</span><span class="op" id="3938241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938246">if</span>&nbsp;<span class="ident" id="3938249"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3938253">==</span>&nbsp;<span class="ident" id="3938256">nil</span>&nbsp;<span class="op" id="3938260">&amp;&amp;</span>&nbsp;<span class="ident" id="3938263"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938267">.</span><span class="ident" id="3938268">StatusCode</span>&nbsp;<span class="op" id="3938279">==</span>&nbsp;<span class="num" id="3938282">100</span>&nbsp;<span class="op" id="3938286">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938292">//&nbsp;Skip&nbsp;any&nbsp;100-continue&nbsp;for&nbsp;now.</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938330">//&nbsp;TODO(bradfitz):&nbsp;if&nbsp;rc.req&nbsp;had&nbsp;&#34;Expect:&nbsp;100-continue&#34;,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938391">//&nbsp;actually&nbsp;block&nbsp;the&nbsp;request&nbsp;body&nbsp;write&nbsp;and&nbsp;signal&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938451">//&nbsp;writeLoop&nbsp;now&nbsp;to&nbsp;begin&nbsp;sending&nbsp;it.&nbsp;(Issue&nbsp;2184)&nbsp;For&nbsp;now&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3938517">//&nbsp;eat&nbsp;it,&nbsp;since&nbsp;we&#39;re&nbsp;never&nbsp;expecting&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938565"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938569">,</span>&nbsp;<span class="ident" id="3938571"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3938575">=</span>&nbsp;<span class="ident" id="3938577"><a href="/net/http/response.go.html#3820176">ReadResponse</a></span><span class="op" id="3938589">(</span><span class="ident" id="3938590"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938592">.</span><span class="ident" id="3938593">br</span><span class="op" id="3938595">,</span>&nbsp;<span class="ident" id="3938597"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3938599">.</span><span class="ident" id="3938600">req</span><span class="op" id="3938603">)</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938608">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938612">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938617">if</span>&nbsp;<span class="ident" id="3938620"><a href="/net/http/transport.go.html#3938167">resp</a></span>&nbsp;<span class="op" id="3938625">!=</span>&nbsp;<span class="ident" id="3938628">nil</span>&nbsp;<span class="op" id="3938632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938637"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938641">.</span><span class="ident" id="3938642">TLS</span>&nbsp;<span class="op" id="3938646">=</span>&nbsp;<span class="ident" id="3938648"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938650">.</span><span class="ident" id="3938651">tlsState</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938662">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938667">hasBody</span>&nbsp;<span class="op" id="3938675">:=</span>&nbsp;<span class="ident" id="3938678"><a href="/net/http/transport.go.html#3938167">resp</a></span>&nbsp;<span class="op" id="3938683">!=</span>&nbsp;<span class="ident" id="3938686">nil</span>&nbsp;<span class="op" id="3938690">&amp;&amp;</span>&nbsp;<span class="ident" id="3938693"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3938695">.</span><span class="ident" id="3938696">req</span><span class="op" id="3938699">.</span><span class="ident" id="3938700">Method</span>&nbsp;<span class="op" id="3938707">!=</span>&nbsp;<span class="string" id="3938710">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3938717">&amp;&amp;</span>&nbsp;<span class="ident" id="3938720"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938724">.</span><span class="ident" id="3938725">ContentLength</span>&nbsp;<span class="op" id="3938739">!=</span>&nbsp;<span class="num" id="3938742">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938747">if</span>&nbsp;<span class="ident" id="3938750"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3938754">!=</span>&nbsp;<span class="ident" id="3938757">nil</span>&nbsp;<span class="op" id="3938761">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938766"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3938768">.</span><span class="builtinfunc" id="3938769">close</span><span class="op" id="3938774">(</span><span class="op" id="3938775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3938779">}</span>&nbsp;<span class="keyword" id="3938781">else</span>&nbsp;<span class="op" id="3938786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3938791">if</span>&nbsp;<span class="ident" id="3938794"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3938796">.</span><span class="ident" id="3938797">addedGzip</span>&nbsp;<span class="op" id="3938807">&amp;&amp;</span>&nbsp;<span class="ident" id="3938810"><a href="/net/http/transport.go.html#3938667">hasBody</a></span>&nbsp;<span class="op" id="3938818">&amp;&amp;</span>&nbsp;<span class="ident" id="3938821"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938825">.</span><span class="ident" id="3938826">Header</span><span class="op" id="3938832">.</span><span class="ident" id="3938833">Get</span><span class="op" id="3938836">(</span><span class="string" id="3938837">&#34;Content-Encoding&#34;</span><span class="op" id="3938855">)</span>&nbsp;<span class="op" id="3938857">==</span>&nbsp;<span class="string" id="3938860">&#34;gzip&#34;</span>&nbsp;<span class="op" id="3938867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938873"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938877">.</span><span class="ident" id="3938878">Header</span><span class="op" id="3938884">.</span><span class="ident" id="3938885">Del</span><span class="op" id="3938888">(</span><span class="string" id="3938889">&#34;Content-Encoding&#34;</span><span class="op" id="3938907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938913"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938917">.</span><span class="ident" id="3938918">Header</span><span class="op" id="3938924">.</span><span class="ident" id="3938925">Del</span><span class="op" id="3938928">(</span><span class="string" id="3938929">&#34;Content-Length&#34;</span><span class="op" id="3938945">)</span><br>
<span class="lineno">885</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938951"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938955">.</span><span class="ident" id="3938956">ContentLength</span>&nbsp;<span class="op" id="3938970">=</span>&nbsp;<span class="op" id="3938972">-</span><span class="num" id="3938973">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3938979"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3938983">.</span><span class="ident" id="3938984">Body</span>&nbsp;<span class="op" id="3938989">=</span>&nbsp;<span class="op" id="3938991">&amp;</span><span class="ident" id="3938992"><a href="/net/http/transport.go.html#3948386">gzipReader</a></span><span class="op" id="3939002">{</span><span class="ident" id="3939003">body</span><span class="op" id="3939007">:</span>&nbsp;<span class="ident" id="3939009"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939013">.</span><span class="ident" id="3939014">Body</span><span class="op" id="3939018">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939023">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939028"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939032">.</span><span class="ident" id="3939033">Body</span>&nbsp;<span class="op" id="3939038">=</span>&nbsp;<span class="op" id="3939040">&amp;</span><span class="ident" id="3939041"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3939054">{</span><span class="ident" id="3939055">body</span><span class="op" id="3939059">:</span>&nbsp;<span class="ident" id="3939061"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939065">.</span><span class="ident" id="3939066">Body</span><span class="op" id="3939070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939074">}</span><br>
<span class="lineno">890</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939079">if</span>&nbsp;<span class="ident" id="3939082"><a href="/net/http/transport.go.html#3937828">err</a></span>&nbsp;<span class="op" id="3939086">!=</span>&nbsp;<span class="ident" id="3939089">nil</span>&nbsp;<span class="op" id="3939093">||</span>&nbsp;<span class="ident" id="3939096"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939100">.</span><span class="ident" id="3939101">Close</span>&nbsp;<span class="op" id="3939107">||</span>&nbsp;<span class="ident" id="3939110"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3939112">.</span><span class="ident" id="3939113">req</span><span class="op" id="3939116">.</span><span class="ident" id="3939117">Close</span>&nbsp;<span class="op" id="3939123">||</span>&nbsp;<span class="ident" id="3939126"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939130">.</span><span class="ident" id="3939131">StatusCode</span>&nbsp;<span class="op" id="3939142">&lt;=</span>&nbsp;<span class="num" id="3939145">199</span>&nbsp;<span class="op" id="3939149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939154">//&nbsp;Don&#39;t&nbsp;do&nbsp;keep-alive&nbsp;on&nbsp;error&nbsp;if&nbsp;either&nbsp;party&nbsp;requested&nbsp;a&nbsp;close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939223">//&nbsp;or&nbsp;we&nbsp;get&nbsp;an&nbsp;unexpected&nbsp;informational&nbsp;(1xx)&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939283">//&nbsp;StatusCode&nbsp;100&nbsp;is&nbsp;already&nbsp;handled&nbsp;above.</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939330"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3939336">=</span>&nbsp;<span class="ident" id="3939338">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939346">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939351">var</span>&nbsp;<span class="ident" id="3939355">waitForBodyRead</span>&nbsp;<span class="keyword" id="3939371">chan</span>&nbsp;<span class="builtintype" id="3939376">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939383">if</span>&nbsp;<span class="ident" id="3939386"><a href="/net/http/transport.go.html#3938667">hasBody</a></span>&nbsp;<span class="op" id="3939394">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939399"><a href="/net/http/transport.go.html#3939355">waitForBodyRead</a></span>&nbsp;<span class="op" id="3939415">=</span>&nbsp;<span class="builtinfunc" id="3939417">make</span><span class="op" id="3939421">(</span><span class="keyword" id="3939422">chan</span>&nbsp;<span class="builtintype" id="3939427">bool</span><span class="op" id="3939431">,</span>&nbsp;<span class="num" id="3939433">2</span><span class="op" id="3939434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939439"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939443">.</span><span class="ident" id="3939444">Body</span><span class="op" id="3939448">.</span><span class="op" id="3939449">(</span><span class="op" id="3939450">*</span><span class="ident" id="3939451"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3939464">)</span><span class="op" id="3939465">.</span><span class="ident" id="3939466">earlyCloseFn</span>&nbsp;<span class="op" id="3939479">=</span>&nbsp;<span class="keyword" id="3939481">func</span><span class="op" id="3939485">(</span><span class="op" id="3939486">)</span>&nbsp;<span class="builtintype" id="3939488">error</span>&nbsp;<span class="op" id="3939494">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939500">//&nbsp;Sending&nbsp;false&nbsp;here&nbsp;sets&nbsp;alive&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939540">//&nbsp;false&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939579">//&nbsp;below.</span><br>
<span class="lineno">905</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939593"><a href="/net/http/transport.go.html#3939355">waitForBodyRead</a></span>&nbsp;<span class="op" id="3939609">&lt;-</span>&nbsp;<span class="ident" id="3939612">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939622">return</span>&nbsp;<span class="ident" id="3939629">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939641"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939645">.</span><span class="ident" id="3939646">Body</span><span class="op" id="3939650">.</span><span class="op" id="3939651">(</span><span class="op" id="3939652">*</span><span class="ident" id="3939653"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3939666">)</span><span class="op" id="3939667">.</span><span class="ident" id="3939668">fn</span>&nbsp;<span class="op" id="3939671">=</span>&nbsp;<span class="keyword" id="3939673">func</span><span class="op" id="3939677">(</span><span class="ident" id="3939678">err</span>&nbsp;<span class="builtintype" id="3939682">error</span><span class="op" id="3939687">)</span>&nbsp;<span class="op" id="3939689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939695"><a href="/net/http/transport.go.html#3939355">waitForBodyRead</a></span>&nbsp;<span class="op" id="3939711">&lt;-</span>&nbsp;<span class="ident" id="3939714"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3939720">&amp;&amp;</span><br>
<span class="lineno">910</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939728"><a href="/net/http/transport.go.html#3939678">err</a></span>&nbsp;<span class="op" id="3939732">==</span>&nbsp;<span class="ident" id="3939735">nil</span>&nbsp;<span class="op" id="3939739">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939747">!</span><span class="ident" id="3939748"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939750">.</span><span class="ident" id="3939751">sawEOF</span>&nbsp;<span class="op" id="3939758">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939766"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939768">.</span><span class="ident" id="3939769">wroteRequest</span><span class="op" id="3939781">(</span><span class="op" id="3939782">)</span>&nbsp;<span class="op" id="3939784">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939792"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939794">.</span><span class="ident" id="3939795">t</span><span class="op" id="3939796">.</span><span class="ident" id="3939797">putIdleConn</span><span class="op" id="3939808">(</span><span class="ident" id="3939809"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939816">}</span><br>
<span class="lineno">915</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939820">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3939825">if</span>&nbsp;<span class="ident" id="3939828"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3939834">&amp;&amp;</span>&nbsp;<span class="op" id="3939837">!</span><span class="ident" id="3939838"><a href="/net/http/transport.go.html#3938667">hasBody</a></span>&nbsp;<span class="op" id="3939846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939851"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3939857">=</span>&nbsp;<span class="op" id="3939859">!</span><span class="ident" id="3939860"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939862">.</span><span class="ident" id="3939863">sawEOF</span>&nbsp;<span class="op" id="3939870">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939877"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939879">.</span><span class="ident" id="3939880">wroteRequest</span><span class="op" id="3939892">(</span><span class="op" id="3939893">)</span>&nbsp;<span class="op" id="3939895">&amp;&amp;</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939902"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939904">.</span><span class="ident" id="3939905">t</span><span class="op" id="3939906">.</span><span class="ident" id="3939907">putIdleConn</span><span class="op" id="3939918">(</span><span class="ident" id="3939919"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3939921">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3939925">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3939930"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3939932">.</span><span class="ident" id="3939933">ch</span>&nbsp;<span class="op" id="3939936">&lt;-</span>&nbsp;<span class="ident" id="3939939"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><span class="op" id="3939955">{</span><span class="ident" id="3939956"><a href="/net/http/transport.go.html#3938167">resp</a></span><span class="op" id="3939960">,</span>&nbsp;<span class="ident" id="3939962"><a href="/net/http/transport.go.html#3937828">err</a></span><span class="op" id="3939965">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3939970">//&nbsp;Wait&nbsp;for&nbsp;the&nbsp;just-returned&nbsp;response&nbsp;body&nbsp;to&nbsp;be&nbsp;fully&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3940037">//&nbsp;before&nbsp;we&nbsp;race&nbsp;and&nbsp;peek&nbsp;on&nbsp;the&nbsp;underlying&nbsp;bufio&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940098">if</span>&nbsp;<span class="ident" id="3940101"><a href="/net/http/transport.go.html#3939355">waitForBodyRead</a></span>&nbsp;<span class="op" id="3940117">!=</span>&nbsp;<span class="ident" id="3940120">nil</span>&nbsp;<span class="op" id="3940124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940129">select</span>&nbsp;<span class="op" id="3940136">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940141">case</span>&nbsp;<span class="ident" id="3940146"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3940152">=</span>&nbsp;<span class="op" id="3940154">&lt;-</span><span class="ident" id="3940156"><a href="/net/http/transport.go.html#3939355">waitForBodyRead</a></span><span class="op" id="3940171">:</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940176">case</span>&nbsp;<span class="op" id="3940181">&lt;-</span><span class="ident" id="3940183"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3940185">.</span><span class="ident" id="3940186">closech</span><span class="op" id="3940193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940199"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3940205">=</span>&nbsp;<span class="ident" id="3940207">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940220">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">935</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940225"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3940227">.</span><span class="ident" id="3940228">t</span><span class="op" id="3940229">.</span><span class="ident" id="3940230">setReqCanceler</span><span class="op" id="3940244">(</span><span class="ident" id="3940245"><a href="/net/http/transport.go.html#3938143">rc</a></span><span class="op" id="3940247">.</span><span class="ident" id="3940248">req</span><span class="op" id="3940251">,</span>&nbsp;<span class="ident" id="3940253">nil</span><span class="op" id="3940256">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940261">if</span>&nbsp;<span class="op" id="3940264">!</span><span class="ident" id="3940265"><a href="/net/http/transport.go.html#3937794">alive</a></span>&nbsp;<span class="op" id="3940271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940276"><a href="/net/http/transport.go.html#3937763">pc</a></span><span class="op" id="3940278">.</span><span class="builtinfunc" id="3940279">close</span><span class="op" id="3940284">(</span><span class="op" id="3940285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940289">}</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940292">}</span><br>
<span class="lineno"></span><span class="op" id="3940294">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3940297">func</span>&nbsp;<span class="op" id="3940302">(</span><span class="ident" id="3940303">pc</span>&nbsp;<span class="op" id="3940306">*</span><span class="ident" id="3940307"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3940318">)</span>&nbsp;<span class="ident" id="3940320">writeLoop</span><span class="op" id="3940329">(</span><span class="op" id="3940330">)</span>&nbsp;<span class="op" id="3940332">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940335">for</span>&nbsp;<span class="op" id="3940339">{</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940343">select</span>&nbsp;<span class="op" id="3940350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940354">case</span>&nbsp;<span class="ident" id="3940359">wr</span>&nbsp;<span class="op" id="3940362">:=</span>&nbsp;<span class="op" id="3940365">&lt;-</span><span class="ident" id="3940367"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940369">.</span><span class="ident" id="3940370">writech</span><span class="op" id="3940377">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940382">if</span>&nbsp;<span class="ident" id="3940385"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940387">.</span><span class="ident" id="3940388">isBroken</span><span class="op" id="3940396">(</span><span class="op" id="3940397">)</span>&nbsp;<span class="op" id="3940399">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940405"><a href="/net/http/transport.go.html#3940359">wr</a></span><span class="op" id="3940407">.</span><span class="ident" id="3940408">ch</span>&nbsp;<span class="op" id="3940411">&lt;-</span>&nbsp;<span class="ident" id="3940414"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3940420">.</span><span class="ident" id="3940421">New</span><span class="op" id="3940424">(</span><span class="string" id="3940425">&#34;http:&nbsp;can&#39;t&nbsp;write&nbsp;HTTP&nbsp;request&nbsp;on&nbsp;broken&nbsp;connection&#34;</span><span class="op" id="3940478">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940484">continue</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940496">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940501">err</span>&nbsp;<span class="op" id="3940505">:=</span>&nbsp;<span class="ident" id="3940508"><a href="/net/http/transport.go.html#3940359">wr</a></span><span class="op" id="3940510">.</span><span class="ident" id="3940511">req</span><span class="op" id="3940514">.</span><span class="ident" id="3940515">Request</span><span class="op" id="3940522">.</span><span class="ident" id="3940523">write</span><span class="op" id="3940528">(</span><span class="ident" id="3940529"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940531">.</span><span class="ident" id="3940532">bw</span><span class="op" id="3940534">,</span>&nbsp;<span class="ident" id="3940536"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940538">.</span><span class="ident" id="3940539">isProxy</span><span class="op" id="3940546">,</span>&nbsp;<span class="ident" id="3940548"><a href="/net/http/transport.go.html#3940359">wr</a></span><span class="op" id="3940550">.</span><span class="ident" id="3940551">req</span><span class="op" id="3940554">.</span><span class="ident" id="3940555">extra</span><span class="op" id="3940560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940565">if</span>&nbsp;<span class="ident" id="3940568"><a href="/net/http/transport.go.html#3940501">err</a></span>&nbsp;<span class="op" id="3940572">==</span>&nbsp;<span class="ident" id="3940575">nil</span>&nbsp;<span class="op" id="3940579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940585"><a href="/net/http/transport.go.html#3940501">err</a></span>&nbsp;<span class="op" id="3940589">=</span>&nbsp;<span class="ident" id="3940591"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940593">.</span><span class="ident" id="3940594">bw</span><span class="op" id="3940596">.</span><span class="ident" id="3940597">Flush</span><span class="op" id="3940602">(</span><span class="op" id="3940603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940608">}</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940613">if</span>&nbsp;<span class="ident" id="3940616"><a href="/net/http/transport.go.html#3940501">err</a></span>&nbsp;<span class="op" id="3940620">!=</span>&nbsp;<span class="ident" id="3940623">nil</span>&nbsp;<span class="op" id="3940627">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940633"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940635">.</span><span class="ident" id="3940636">markBroken</span><span class="op" id="3940646">(</span><span class="op" id="3940647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940653"><a href="/net/http/transport.go.html#3940359">wr</a></span><span class="op" id="3940655">.</span><span class="ident" id="3940656">req</span><span class="op" id="3940659">.</span><span class="ident" id="3940660">Request</span><span class="op" id="3940667">.</span><span class="ident" id="3940668">closeBody</span><span class="op" id="3940677">(</span><span class="op" id="3940678">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940683">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940688"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940690">.</span><span class="ident" id="3940691">writeErrCh</span>&nbsp;<span class="op" id="3940702">&lt;-</span>&nbsp;<span class="ident" id="3940705"><a href="/net/http/transport.go.html#3940501">err</a></span>&nbsp;<span class="comment" id="3940709">//&nbsp;to&nbsp;the&nbsp;body&nbsp;reader,&nbsp;which&nbsp;might&nbsp;recycle&nbsp;us</span><br>
<span class="lineno">960</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3940758"><a href="/net/http/transport.go.html#3940359">wr</a></span><span class="op" id="3940760">.</span><span class="ident" id="3940761">ch</span>&nbsp;<span class="op" id="3940764">&lt;-</span>&nbsp;<span class="ident" id="3940767"><a href="/net/http/transport.go.html#3940501">err</a></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3940779">//&nbsp;to&nbsp;the&nbsp;roundTrip&nbsp;function</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940810">case</span>&nbsp;<span class="op" id="3940815">&lt;-</span><span class="ident" id="3940817"><a href="/net/http/transport.go.html#3940303">pc</a></span><span class="op" id="3940819">.</span><span class="ident" id="3940820">closech</span><span class="op" id="3940827">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3940832">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940841">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3940844">}</span><br>
<span class="lineno">965</span><span class="op" id="3940846">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3940849">//&nbsp;wroteRequest&nbsp;is&nbsp;a&nbsp;check&nbsp;before&nbsp;recycling&nbsp;a&nbsp;connection&nbsp;that&nbsp;the&nbsp;previous&nbsp;write</span><br>
<span class="lineno"></span><span class="comment" id="3940930">//&nbsp;(from&nbsp;writeLoop&nbsp;above)&nbsp;happened&nbsp;and&nbsp;was&nbsp;successful.</span><br>
<span class="lineno"></span><span class="keyword" id="3940985">func</span>&nbsp;<span class="op" id="3940990">(</span><span class="ident" id="3940991">pc</span>&nbsp;<span class="op" id="3940994">*</span><span class="ident" id="3940995"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3941006">)</span>&nbsp;<span class="ident" id="3941008">wroteRequest</span><span class="op" id="3941020">(</span><span class="op" id="3941021">)</span>&nbsp;<span class="builtintype" id="3941023">bool</span>&nbsp;<span class="op" id="3941028">{</span><br>
<span class="lineno">970</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941031">select</span>&nbsp;<span class="op" id="3941038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941041">case</span>&nbsp;<span class="ident" id="3941046">err</span>&nbsp;<span class="op" id="3941050">:=</span>&nbsp;<span class="op" id="3941053">&lt;-</span><span class="ident" id="3941055"><a href="/net/http/transport.go.html#3940991">pc</a></span><span class="op" id="3941057">.</span><span class="ident" id="3941058">writeErrCh</span><span class="op" id="3941068">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941072">//&nbsp;Common&nbsp;case:&nbsp;the&nbsp;write&nbsp;happened&nbsp;well&nbsp;before&nbsp;the&nbsp;response,&nbsp;so</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941138">//&nbsp;avoid&nbsp;creating&nbsp;a&nbsp;timer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941167">return</span>&nbsp;<span class="ident" id="3941174"><a href="/net/http/transport.go.html#3941046">err</a></span>&nbsp;<span class="op" id="3941178">==</span>&nbsp;<span class="ident" id="3941181">nil</span><br>
<span class="lineno">975</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941186">default</span><span class="op" id="3941193">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941197">//&nbsp;Rare&nbsp;case:&nbsp;the&nbsp;request&nbsp;was&nbsp;written&nbsp;in&nbsp;writeLoop&nbsp;above&nbsp;but</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941260">//&nbsp;before&nbsp;it&nbsp;could&nbsp;send&nbsp;to&nbsp;pc.writeErrCh,&nbsp;the&nbsp;reader&nbsp;read&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941323">//&nbsp;all,&nbsp;processed&nbsp;it,&nbsp;and&nbsp;called&nbsp;us&nbsp;here.&nbsp;In&nbsp;this&nbsp;case,&nbsp;give&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941390">//&nbsp;write&nbsp;goroutine&nbsp;a&nbsp;bit&nbsp;of&nbsp;time&nbsp;to&nbsp;finish&nbsp;its&nbsp;send.</span><br>
<span class="lineno">980</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941445">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941450">//&nbsp;Less&nbsp;rare&nbsp;case:&nbsp;We&nbsp;also&nbsp;get&nbsp;here&nbsp;in&nbsp;the&nbsp;legitimate&nbsp;case&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941514">//&nbsp;Issue&nbsp;7569,&nbsp;where&nbsp;the&nbsp;writer&nbsp;is&nbsp;still&nbsp;writing&nbsp;(or&nbsp;stalled),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941579">//&nbsp;but&nbsp;the&nbsp;server&nbsp;has&nbsp;already&nbsp;replied.&nbsp;In&nbsp;this&nbsp;case,&nbsp;we&nbsp;don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941643">//&nbsp;want&nbsp;to&nbsp;wait&nbsp;too&nbsp;long,&nbsp;and&nbsp;we&nbsp;want&nbsp;to&nbsp;return&nbsp;false&nbsp;so&nbsp;this</span><br>
<span class="lineno">985</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3941707">//&nbsp;connection&nbsp;isn&#39;t&nbsp;re-used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941738">select</span>&nbsp;<span class="op" id="3941745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941749">case</span>&nbsp;<span class="ident" id="3941754">err</span>&nbsp;<span class="op" id="3941758">:=</span>&nbsp;<span class="op" id="3941761">&lt;-</span><span class="ident" id="3941763"><a href="/net/http/transport.go.html#3940991">pc</a></span><span class="op" id="3941765">.</span><span class="ident" id="3941766">writeErrCh</span><span class="op" id="3941776">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941781">return</span>&nbsp;<span class="ident" id="3941788"><a href="/net/http/transport.go.html#3941754">err</a></span>&nbsp;<span class="op" id="3941792">==</span>&nbsp;<span class="ident" id="3941795">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941801">case</span>&nbsp;<span class="op" id="3941806">&lt;-</span><span class="ident" id="3941808"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3941812">.</span><span class="ident" id="3941813">After</span><span class="op" id="3941818">(</span><span class="num" id="3941819">50</span>&nbsp;<span class="op" id="3941822">*</span>&nbsp;<span class="ident" id="3941824"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3941828">.</span><span class="ident" id="3941829">Millisecond</span><span class="op" id="3941840">)</span><span class="op" id="3941841">:</span><br>
<span class="lineno">990</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3941846">return</span>&nbsp;<span class="ident" id="3941853">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941861">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3941864">}</span><br>
<span class="lineno"></span><span class="op" id="3941866">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">995</span><span class="keyword" id="3941869">type</span>&nbsp;<span class="ident" id="3941874">responseAndError</span>&nbsp;<span class="keyword" id="3941891">struct</span>&nbsp;<span class="op" id="3941898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941901">res</span>&nbsp;<span class="op" id="3941905">*</span><span class="ident" id="3941906"><a href="/net/http/response.go.html#3816973">Response</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941916">err</span>&nbsp;<span class="builtintype" id="3941920">error</span><br>
<span class="lineno"></span><span class="op" id="3941926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1000</span><span class="keyword" id="3941929">type</span>&nbsp;<span class="ident" id="3941934">requestAndChan</span>&nbsp;<span class="keyword" id="3941949">struct</span>&nbsp;<span class="op" id="3941956">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941959">req</span>&nbsp;<span class="op" id="3941963">*</span><span class="ident" id="3941964"><a href="/net/http/request.go.html#3791418">Request</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3941973">ch</span>&nbsp;&nbsp;<span class="keyword" id="3941977">chan</span>&nbsp;<span class="ident" id="3941982"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3942001">//&nbsp;did&nbsp;the&nbsp;Transport&nbsp;(as&nbsp;opposed&nbsp;to&nbsp;the&nbsp;client&nbsp;code)&nbsp;add&nbsp;an</span><br>
<span class="lineno">1005</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3942062">//&nbsp;Accept-Encoding&nbsp;gzip&nbsp;header?&nbsp;only&nbsp;if&nbsp;it&nbsp;we&nbsp;set&nbsp;it&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3942119">//&nbsp;we&nbsp;transparently&nbsp;decode&nbsp;the&nbsp;gzip.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942157">addedGzip</span>&nbsp;<span class="builtintype" id="3942167">bool</span><br>
<span class="lineno"></span><span class="op" id="3942172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1010</span><span class="comment" id="3942175">//&nbsp;A&nbsp;writeRequest&nbsp;is&nbsp;sent&nbsp;by&nbsp;the&nbsp;readLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3942236">//&nbsp;writeLoop&#39;s&nbsp;goroutine&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;while&nbsp;the&nbsp;read&nbsp;loop</span><br>
<span class="lineno"></span><span class="comment" id="3942300">//&nbsp;concurrently&nbsp;waits&nbsp;on&nbsp;both&nbsp;the&nbsp;write&nbsp;response&nbsp;and&nbsp;the&nbsp;server&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="3942366">//&nbsp;reply.</span><br>
<span class="lineno"></span><span class="keyword" id="3942376">type</span>&nbsp;<span class="ident" id="3942381">writeRequest</span>&nbsp;<span class="keyword" id="3942394">struct</span>&nbsp;<span class="op" id="3942401">{</span><br>
<span class="lineno">1015</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942404">req</span>&nbsp;<span class="op" id="3942408">*</span><span class="ident" id="3942409"><a href="/net/http/transport.go.html#3920842">transportRequest</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942427">ch</span>&nbsp;&nbsp;<span class="keyword" id="3942431">chan</span><span class="op" id="3942435">&lt;-</span>&nbsp;<span class="builtintype" id="3942438">error</span><br>
<span class="lineno"></span><span class="op" id="3942444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3942447">type</span>&nbsp;<span class="ident" id="3942452">httpError</span>&nbsp;<span class="keyword" id="3942462">struct</span>&nbsp;<span class="op" id="3942469">{</span><br>
<span class="lineno">1020</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942472">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3942480">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942488">timeout</span>&nbsp;<span class="builtintype" id="3942496">bool</span><br>
<span class="lineno"></span><span class="op" id="3942501">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3942504">func</span>&nbsp;<span class="op" id="3942509">(</span><span class="ident" id="3942510">e</span>&nbsp;<span class="op" id="3942512">*</span><span class="ident" id="3942513"><a href="/net/http/transport.go.html#3942452">httpError</a></span><span class="op" id="3942522">)</span>&nbsp;<span class="ident" id="3942524">Error</span><span class="op" id="3942529">(</span><span class="op" id="3942530">)</span>&nbsp;<span class="builtintype" id="3942532">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3942541">{</span>&nbsp;<span class="keyword" id="3942543">return</span>&nbsp;<span class="ident" id="3942550"><a href="/net/http/transport.go.html#3942510">e</a></span><span class="op" id="3942551">.</span><span class="ident" id="3942552">err</span>&nbsp;<span class="op" id="3942556">}</span><br>
<span class="lineno">1025</span><span class="keyword" id="3942558">func</span>&nbsp;<span class="op" id="3942563">(</span><span class="ident" id="3942564">e</span>&nbsp;<span class="op" id="3942566">*</span><span class="ident" id="3942567"><a href="/net/http/transport.go.html#3942452">httpError</a></span><span class="op" id="3942576">)</span>&nbsp;<span class="ident" id="3942578">Timeout</span><span class="op" id="3942585">(</span><span class="op" id="3942586">)</span>&nbsp;<span class="builtintype" id="3942588">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3942595">{</span>&nbsp;<span class="keyword" id="3942597">return</span>&nbsp;<span class="ident" id="3942604"><a href="/net/http/transport.go.html#3942564">e</a></span><span class="op" id="3942605">.</span><span class="ident" id="3942606">timeout</span>&nbsp;<span class="op" id="3942614">}</span><br>
<span class="lineno"></span><span class="keyword" id="3942616">func</span>&nbsp;<span class="op" id="3942621">(</span><span class="ident" id="3942622">e</span>&nbsp;<span class="op" id="3942624">*</span><span class="ident" id="3942625"><a href="/net/http/transport.go.html#3942452">httpError</a></span><span class="op" id="3942634">)</span>&nbsp;<span class="ident" id="3942636">Temporary</span><span class="op" id="3942645">(</span><span class="op" id="3942646">)</span>&nbsp;<span class="builtintype" id="3942648">bool</span>&nbsp;<span class="op" id="3942653">{</span>&nbsp;<span class="keyword" id="3942655">return</span>&nbsp;<span class="ident" id="3942662">true</span>&nbsp;<span class="op" id="3942667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3942670">var</span>&nbsp;<span class="ident" id="3942674">errTimeout</span>&nbsp;<span class="builtintype" id="3942685">error</span>&nbsp;<span class="op" id="3942691">=</span>&nbsp;<span class="op" id="3942693">&amp;</span><span class="ident" id="3942694"><a href="/net/http/transport.go.html#3942452">httpError</a></span><span class="op" id="3942703">{</span><span class="ident" id="3942704">err</span><span class="op" id="3942707">:</span>&nbsp;<span class="string" id="3942709">&#34;net/http:&nbsp;timeout&nbsp;awaiting&nbsp;response&nbsp;headers&#34;</span><span class="op" id="3942754">,</span>&nbsp;<span class="ident" id="3942756">timeout</span><span class="op" id="3942763">:</span>&nbsp;<span class="ident" id="3942765">true</span><span class="op" id="3942769">}</span><br>
<span class="lineno"></span><span class="keyword" id="3942771">var</span>&nbsp;<span class="ident" id="3942775">errClosed</span>&nbsp;<span class="builtintype" id="3942785">error</span>&nbsp;<span class="op" id="3942791">=</span>&nbsp;<span class="op" id="3942793">&amp;</span><span class="ident" id="3942794"><a href="/net/http/transport.go.html#3942452">httpError</a></span><span class="op" id="3942803">{</span><span class="ident" id="3942804">err</span><span class="op" id="3942807">:</span>&nbsp;<span class="string" id="3942809">&#34;net/http:&nbsp;transport&nbsp;closed&nbsp;before&nbsp;response&nbsp;was&nbsp;received&#34;</span><span class="op" id="3942866">}</span><br>
<span class="lineno">1030</span><br>
<span class="lineno"></span><span class="keyword" id="3942869">func</span>&nbsp;<span class="op" id="3942874">(</span><span class="ident" id="3942875">pc</span>&nbsp;<span class="op" id="3942878">*</span><span class="ident" id="3942879"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3942890">)</span>&nbsp;<span class="ident" id="3942892">roundTrip</span><span class="op" id="3942901">(</span><span class="ident" id="3942902">req</span>&nbsp;<span class="op" id="3942906">*</span><span class="ident" id="3942907"><a href="/net/http/transport.go.html#3920842">transportRequest</a></span><span class="op" id="3942923">)</span>&nbsp;<span class="op" id="3942925">(</span><span class="ident" id="3942926">resp</span>&nbsp;<span class="op" id="3942931">*</span><span class="ident" id="3942932"><a href="/net/http/response.go.html#3816973">Response</a></span><span class="op" id="3942940">,</span>&nbsp;<span class="ident" id="3942942">err</span>&nbsp;<span class="builtintype" id="3942946">error</span><span class="op" id="3942951">)</span>&nbsp;<span class="op" id="3942953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3942956"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3942958">.</span><span class="ident" id="3942959">t</span><span class="op" id="3942960">.</span><span class="ident" id="3942961">setReqCanceler</span><span class="op" id="3942975">(</span><span class="ident" id="3942976"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3942979">.</span><span class="ident" id="3942980">Request</span><span class="op" id="3942987">,</span>&nbsp;<span class="ident" id="3942989"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3942991">.</span><span class="ident" id="3942992">cancelRequest</span><span class="op" id="3943005">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943008"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3943010">.</span><span class="ident" id="3943011">lk</span><span class="op" id="3943013">.</span><span class="ident" id="3943014">Lock</span><span class="op" id="3943018">(</span><span class="op" id="3943019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943022"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3943024">.</span><span class="ident" id="3943025">numExpectedResponses</span><span class="op" id="3943045">++</span><br>
<span class="lineno">1035</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943049">headerFn</span>&nbsp;<span class="op" id="3943058">:=</span>&nbsp;<span class="ident" id="3943061"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3943063">.</span><span class="ident" id="3943064">mutateHeaderFunc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943082"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3943084">.</span><span class="ident" id="3943085">lk</span><span class="op" id="3943087">.</span><span class="ident" id="3943088">Unlock</span><span class="op" id="3943094">(</span><span class="op" id="3943095">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943099">if</span>&nbsp;<span class="ident" id="3943102"><a href="/net/http/transport.go.html#3943049">headerFn</a></span>&nbsp;<span class="op" id="3943111">!=</span>&nbsp;<span class="ident" id="3943114">nil</span>&nbsp;<span class="op" id="3943118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943122"><a href="/net/http/transport.go.html#3943049">headerFn</a></span><span class="op" id="3943130">(</span><span class="ident" id="3943131"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3943134">.</span><span class="ident" id="3943135">extraHeaders</span><span class="op" id="3943147">(</span><span class="op" id="3943148">)</span><span class="op" id="3943149">)</span><br>
<span class="lineno">1040</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3943152">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943156">//&nbsp;Ask&nbsp;for&nbsp;a&nbsp;compressed&nbsp;version&nbsp;if&nbsp;the&nbsp;caller&nbsp;didn&#39;t&nbsp;set&nbsp;their</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943220">//&nbsp;own&nbsp;value&nbsp;for&nbsp;Accept-Encoding.&nbsp;We&nbsp;only&nbsp;attempt&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943274">//&nbsp;uncompress&nbsp;the&nbsp;gzip&nbsp;stream&nbsp;if&nbsp;we&nbsp;were&nbsp;the&nbsp;layer&nbsp;that</span><br>
<span class="lineno">1045</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943331">//&nbsp;requested&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943349">requestedGzip</span>&nbsp;<span class="op" id="3943363">:=</span>&nbsp;<span class="ident" id="3943366">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3943373">if</span>&nbsp;<span class="op" id="3943376">!</span><span class="ident" id="3943377"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3943379">.</span><span class="ident" id="3943380">t</span><span class="op" id="3943381">.</span><span class="ident" id="3943382">DisableCompression</span>&nbsp;<span class="op" id="3943401">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943406"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3943409">.</span><span class="ident" id="3943410">Header</span><span class="op" id="3943416">.</span><span class="ident" id="3943417">Get</span><span class="op" id="3943420">(</span><span class="string" id="3943421">&#34;Accept-Encoding&#34;</span><span class="op" id="3943438">)</span>&nbsp;<span class="op" id="3943440">==</span>&nbsp;<span class="string" id="3943443">&#34;&#34;</span>&nbsp;<span class="op" id="3943446">&amp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943451"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3943454">.</span><span class="ident" id="3943455">Header</span><span class="op" id="3943461">.</span><span class="ident" id="3943462">Get</span><span class="op" id="3943465">(</span><span class="string" id="3943466">&#34;Range&#34;</span><span class="op" id="3943473">)</span>&nbsp;<span class="op" id="3943475">==</span>&nbsp;<span class="string" id="3943478">&#34;&#34;</span>&nbsp;<span class="op" id="3943481">&amp;&amp;</span><br>
<span class="lineno">1050</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3943486"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3943489">.</span><span class="ident" id="3943490">Method</span>&nbsp;<span class="op" id="3943497">!=</span>&nbsp;<span class="string" id="3943500">&#34;HEAD&#34;</span>&nbsp;<span class="op" id="3943507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943511">//&nbsp;Request&nbsp;gzip&nbsp;only,&nbsp;not&nbsp;deflate.&nbsp;Deflate&nbsp;is&nbsp;ambiguous&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943573">//&nbsp;not&nbsp;as&nbsp;universally&nbsp;supported&nbsp;anyway.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943615">//&nbsp;See:&nbsp;http://www.gzip.org/zlib/zlib_faq.html#faq38</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943670">//</span><br>
<span class="lineno">1055</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943675">//&nbsp;Note&nbsp;that&nbsp;we&nbsp;don&#39;t&nbsp;request&nbsp;this&nbsp;for&nbsp;HEAD&nbsp;requests,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943731">//&nbsp;due&nbsp;to&nbsp;a&nbsp;bug&nbsp;in&nbsp;nginx:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943759">//&nbsp;&nbsp;&nbsp;http://trac.nginx.org/nginx/ticket/358</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943805">//&nbsp;&nbsp;&nbsp;http://golang.org/issue/5522</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943841">//</span><br>
<span class="lineno">1060</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943846">//&nbsp;We&nbsp;don&#39;t&nbsp;request&nbsp;gzip&nbsp;if&nbsp;the&nbsp;request&nbsp;is&nbsp;for&nbsp;a&nbsp;range,&nbsp;since</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943910">//&nbsp;auto-decoding&nbsp;a&nbsp;portion&nbsp;of&nbsp;a&nbsp;gzipped&nbsp;document&nbsp;will&nbsp;just&nbsp;fail</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3943976">//&nbsp;anyway.&nbsp;See&nbsp;http://golang.org/issue/8923</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944022"><a href="/net/http/transport.go.html#3943349">requestedGzip</a></span>&nbsp;<span class="op" id="3944036">=</span>&nbsp;<span class="ident" id="3944038">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944045"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3944048">.</span><span class="ident" id="3944049">extraHeaders</span><span class="op" id="3944061">(</span><span class="op" id="3944062">)</span><span class="op" id="3944063">.</span><span class="ident" id="3944064">Set</span><span class="op" id="3944067">(</span><span class="string" id="3944068">&#34;Accept-Encoding&#34;</span><span class="op" id="3944085">,</span>&nbsp;<span class="string" id="3944087">&#34;gzip&#34;</span><span class="op" id="3944093">)</span><br>
<span class="lineno">1065</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944096">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944100">//&nbsp;Write&nbsp;the&nbsp;request&nbsp;concurrently&nbsp;with&nbsp;waiting&nbsp;for&nbsp;a&nbsp;response,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944164">//&nbsp;in&nbsp;case&nbsp;the&nbsp;server&nbsp;decides&nbsp;to&nbsp;reply&nbsp;before&nbsp;reading&nbsp;our&nbsp;full</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944228">//&nbsp;request&nbsp;body.</span><br>
<span class="lineno">1070</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944246">writeErrCh</span>&nbsp;<span class="op" id="3944257">:=</span>&nbsp;<span class="builtinfunc" id="3944260">make</span><span class="op" id="3944264">(</span><span class="keyword" id="3944265">chan</span>&nbsp;<span class="builtintype" id="3944270">error</span><span class="op" id="3944275">,</span>&nbsp;<span class="num" id="3944277">1</span><span class="op" id="3944278">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944281"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3944283">.</span><span class="ident" id="3944284">writech</span>&nbsp;<span class="op" id="3944292">&lt;-</span>&nbsp;<span class="ident" id="3944295"><a href="/net/http/transport.go.html#3942381">writeRequest</a></span><span class="op" id="3944307">{</span><span class="ident" id="3944308"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3944311">,</span>&nbsp;<span class="ident" id="3944313"><a href="/net/http/transport.go.html#3944246">writeErrCh</a></span><span class="op" id="3944323">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944327">resc</span>&nbsp;<span class="op" id="3944332">:=</span>&nbsp;<span class="builtinfunc" id="3944335">make</span><span class="op" id="3944339">(</span><span class="keyword" id="3944340">chan</span>&nbsp;<span class="ident" id="3944345"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><span class="op" id="3944361">,</span>&nbsp;<span class="num" id="3944363">1</span><span class="op" id="3944364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944367"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3944369">.</span><span class="ident" id="3944370">reqch</span>&nbsp;<span class="op" id="3944376">&lt;-</span>&nbsp;<span class="ident" id="3944379"><a href="/net/http/transport.go.html#3941934">requestAndChan</a></span><span class="op" id="3944393">{</span><span class="ident" id="3944394"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3944397">.</span><span class="ident" id="3944398">Request</span><span class="op" id="3944405">,</span>&nbsp;<span class="ident" id="3944407"><a href="/net/http/transport.go.html#3944327">resc</a></span><span class="op" id="3944411">,</span>&nbsp;<span class="ident" id="3944413"><a href="/net/http/transport.go.html#3943349">requestedGzip</a></span><span class="op" id="3944426">}</span><br>
<span class="lineno">1075</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944430">var</span>&nbsp;<span class="ident" id="3944434">re</span>&nbsp;<span class="ident" id="3944437"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944455">var</span>&nbsp;<span class="ident" id="3944459">pconnDeadCh</span>&nbsp;<span class="op" id="3944471">=</span>&nbsp;<span class="ident" id="3944473"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3944475">.</span><span class="ident" id="3944476">closech</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944485">var</span>&nbsp;<span class="ident" id="3944489">failTicker</span>&nbsp;<span class="op" id="3944500">&lt;-</span><span class="keyword" id="3944502">chan</span>&nbsp;<span class="ident" id="3944507"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3944511">.</span><span class="ident" id="3944512">Time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944518">var</span>&nbsp;<span class="ident" id="3944522">respHeaderTimer</span>&nbsp;<span class="op" id="3944538">&lt;-</span><span class="keyword" id="3944540">chan</span>&nbsp;<span class="ident" id="3944545"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3944549">.</span><span class="ident" id="3944550">Time</span><br>
<span class="lineno">1080</span><span class="ident" id="3944555">WaitResponse</span><span class="op" id="3944567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944570">for</span>&nbsp;<span class="op" id="3944574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944578">select</span>&nbsp;<span class="op" id="3944585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944589">case</span>&nbsp;<span class="ident" id="3944594">err</span>&nbsp;<span class="op" id="3944598">:=</span>&nbsp;<span class="op" id="3944601">&lt;-</span><span class="ident" id="3944603"><a href="/net/http/transport.go.html#3944246">writeErrCh</a></span><span class="op" id="3944613">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944618">if</span>&nbsp;<span class="ident" id="3944621"><a href="/net/http/transport.go.html#3944594">err</a></span>&nbsp;<span class="op" id="3944625">!=</span>&nbsp;<span class="ident" id="3944628">nil</span>&nbsp;<span class="op" id="3944632">{</span><br>
<span class="lineno">1085</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944638"><a href="/net/http/transport.go.html#3944434">re</a></span>&nbsp;<span class="op" id="3944641">=</span>&nbsp;<span class="ident" id="3944643"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><span class="op" id="3944659">{</span><span class="ident" id="3944660">nil</span><span class="op" id="3944663">,</span>&nbsp;<span class="ident" id="3944665"><a href="/net/http/transport.go.html#3944594">err</a></span><span class="op" id="3944668">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944674"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3944676">.</span><span class="builtinfunc" id="3944677">close</span><span class="op" id="3944682">(</span><span class="op" id="3944683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944689">break</span>&nbsp;<span class="ident" id="3944695">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944716">if</span>&nbsp;<span class="ident" id="3944719">d</span>&nbsp;<span class="op" id="3944721">:=</span>&nbsp;<span class="ident" id="3944724"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3944726">.</span><span class="ident" id="3944727">t</span><span class="op" id="3944728">.</span><span class="ident" id="3944729">ResponseHeaderTimeout</span><span class="op" id="3944750">;</span>&nbsp;<span class="ident" id="3944752"><a href="/net/http/transport.go.html#3944719">d</a></span>&nbsp;<span class="op" id="3944754">&gt;</span>&nbsp;<span class="num" id="3944756">0</span>&nbsp;<span class="op" id="3944758">{</span><br>
<span class="lineno">1090</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3944764"><a href="/net/http/transport.go.html#3944522">respHeaderTimer</a></span>&nbsp;<span class="op" id="3944780">=</span>&nbsp;<span class="ident" id="3944782"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3944786">.</span><span class="ident" id="3944787">After</span><span class="op" id="3944792">(</span><span class="ident" id="3944793"><a href="/net/http/transport.go.html#3944719">d</a></span><span class="op" id="3944794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3944799">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3944803">case</span>&nbsp;<span class="op" id="3944808">&lt;-</span><span class="ident" id="3944810"><a href="/net/http/transport.go.html#3944459">pconnDeadCh</a></span><span class="op" id="3944821">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944826">//&nbsp;The&nbsp;persist&nbsp;connection&nbsp;is&nbsp;dead.&nbsp;This&nbsp;shouldn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944879">//&nbsp;usually&nbsp;happen&nbsp;(only&nbsp;with&nbsp;Connection:&nbsp;close&nbsp;responses</span><br>
<span class="lineno">1095</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944939">//&nbsp;with&nbsp;no&nbsp;response&nbsp;bodies),&nbsp;but&nbsp;if&nbsp;it&nbsp;does&nbsp;happen&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3944996">//&nbsp;means&nbsp;either&nbsp;a)&nbsp;the&nbsp;remote&nbsp;server&nbsp;hung&nbsp;up&nbsp;on&nbsp;us</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945050">//&nbsp;prematurely,&nbsp;or&nbsp;b)&nbsp;the&nbsp;readLoop&nbsp;sent&nbsp;us&nbsp;a&nbsp;response&nbsp;&amp;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945109">//&nbsp;closed&nbsp;its&nbsp;closech&nbsp;at&nbsp;roughly&nbsp;the&nbsp;same&nbsp;time,&nbsp;and&nbsp;we</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945167">//&nbsp;selected&nbsp;this&nbsp;case&nbsp;first,&nbsp;in&nbsp;which&nbsp;case&nbsp;a&nbsp;response</span><br>
<span class="lineno">1100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945224">//&nbsp;might&nbsp;still&nbsp;be&nbsp;coming&nbsp;soon.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945258">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945264">//&nbsp;We&nbsp;can&#39;t&nbsp;avoid&nbsp;the&nbsp;select&nbsp;race&nbsp;in&nbsp;b)&nbsp;by&nbsp;using&nbsp;a&nbsp;unbuffered</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945329">//&nbsp;resc&nbsp;channel&nbsp;instead,&nbsp;because&nbsp;then&nbsp;goroutines&nbsp;can</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3945385">//&nbsp;leak&nbsp;if&nbsp;we&nbsp;exit&nbsp;due&nbsp;to&nbsp;other&nbsp;errors.</span><br>
<span class="lineno">1105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945428"><a href="/net/http/transport.go.html#3944459">pconnDeadCh</a></span>&nbsp;<span class="op" id="3945440">=</span>&nbsp;<span class="ident" id="3945442">nil</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3945476">//&nbsp;avoid&nbsp;spinning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945497"><a href="/net/http/transport.go.html#3944489">failTicker</a></span>&nbsp;<span class="op" id="3945508">=</span>&nbsp;<span class="ident" id="3945510"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3945514">.</span><span class="ident" id="3945515">After</span><span class="op" id="3945520">(</span><span class="num" id="3945521">100</span>&nbsp;<span class="op" id="3945525">*</span>&nbsp;<span class="ident" id="3945527"><a href="/net/http/transport.go.html#3915394">time</a></span><span class="op" id="3945531">.</span><span class="ident" id="3945532">Millisecond</span><span class="op" id="3945543">)</span>&nbsp;<span class="comment" id="3945545">//&nbsp;arbitrary&nbsp;time&nbsp;to&nbsp;wait&nbsp;for&nbsp;resc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945582">case</span>&nbsp;<span class="op" id="3945587">&lt;-</span><span class="ident" id="3945589"><a href="/net/http/transport.go.html#3944489">failTicker</a></span><span class="op" id="3945599">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945604"><a href="/net/http/transport.go.html#3944434">re</a></span>&nbsp;<span class="op" id="3945607">=</span>&nbsp;<span class="ident" id="3945609"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><span class="op" id="3945625">{</span><span class="ident" id="3945626">err</span><span class="op" id="3945629">:</span>&nbsp;<span class="ident" id="3945631"><a href="/net/http/transport.go.html#3942775">errClosed</a></span><span class="op" id="3945640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945645">break</span>&nbsp;<span class="ident" id="3945651">WaitResponse</span><br>
<span class="lineno">1110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945666">case</span>&nbsp;<span class="op" id="3945671">&lt;-</span><span class="ident" id="3945673"><a href="/net/http/transport.go.html#3944522">respHeaderTimer</a></span><span class="op" id="3945688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945693"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3945695">.</span><span class="builtinfunc" id="3945696">close</span><span class="op" id="3945701">(</span><span class="op" id="3945702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945707"><a href="/net/http/transport.go.html#3944434">re</a></span>&nbsp;<span class="op" id="3945710">=</span>&nbsp;<span class="ident" id="3945712"><a href="/net/http/transport.go.html#3941874">responseAndError</a></span><span class="op" id="3945728">{</span><span class="ident" id="3945729">err</span><span class="op" id="3945732">:</span>&nbsp;<span class="ident" id="3945734"><a href="/net/http/transport.go.html#3942674">errTimeout</a></span><span class="op" id="3945744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945749">break</span>&nbsp;<span class="ident" id="3945755">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945770">case</span>&nbsp;<span class="ident" id="3945775"><a href="/net/http/transport.go.html#3944434">re</a></span>&nbsp;<span class="op" id="3945778">=</span>&nbsp;<span class="op" id="3945780">&lt;-</span><span class="ident" id="3945782"><a href="/net/http/transport.go.html#3944327">resc</a></span><span class="op" id="3945786">:</span><br>
<span class="lineno">1115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945791">break</span>&nbsp;<span class="ident" id="3945797">WaitResponse</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945812">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945815">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945819"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3945821">.</span><span class="ident" id="3945822">lk</span><span class="op" id="3945824">.</span><span class="ident" id="3945825">Lock</span><span class="op" id="3945829">(</span><span class="op" id="3945830">)</span><br>
<span class="lineno">1120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945833"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3945835">.</span><span class="ident" id="3945836">numExpectedResponses</span><span class="op" id="3945856">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945860"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3945862">.</span><span class="ident" id="3945863">lk</span><span class="op" id="3945865">.</span><span class="ident" id="3945866">Unlock</span><span class="op" id="3945872">(</span><span class="op" id="3945873">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945877">if</span>&nbsp;<span class="ident" id="3945880"><a href="/net/http/transport.go.html#3944434">re</a></span><span class="op" id="3945882">.</span><span class="ident" id="3945883">err</span>&nbsp;<span class="op" id="3945887">!=</span>&nbsp;<span class="ident" id="3945890">nil</span>&nbsp;<span class="op" id="3945894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3945898"><a href="/net/http/transport.go.html#3942875">pc</a></span><span class="op" id="3945900">.</span><span class="ident" id="3945901">t</span><span class="op" id="3945902">.</span><span class="ident" id="3945903">setReqCanceler</span><span class="op" id="3945917">(</span><span class="ident" id="3945918"><a href="/net/http/transport.go.html#3942902">req</a></span><span class="op" id="3945921">.</span><span class="ident" id="3945922">Request</span><span class="op" id="3945929">,</span>&nbsp;<span class="ident" id="3945931">nil</span><span class="op" id="3945934">)</span><br>
<span class="lineno">1125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3945937">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3945940">return</span>&nbsp;<span class="ident" id="3945947"><a href="/net/http/transport.go.html#3944434">re</a></span><span class="op" id="3945949">.</span><span class="ident" id="3945950">res</span><span class="op" id="3945953">,</span>&nbsp;<span class="ident" id="3945955"><a href="/net/http/transport.go.html#3944434">re</a></span><span class="op" id="3945957">.</span><span class="ident" id="3945958">err</span><br>
<span class="lineno"></span><span class="op" id="3945962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3945965">//&nbsp;markBroken&nbsp;marks&nbsp;a&nbsp;connection&nbsp;as&nbsp;broken&nbsp;(so&nbsp;it&#39;s&nbsp;not&nbsp;reused).</span><br>
<span class="lineno">1130</span><span class="comment" id="3946030">//&nbsp;It&nbsp;differs&nbsp;from&nbsp;close&nbsp;in&nbsp;that&nbsp;it&nbsp;doesn&#39;t&nbsp;close&nbsp;the&nbsp;underlying</span><br>
<span class="lineno"></span><span class="comment" id="3946095">//&nbsp;connection&nbsp;for&nbsp;use&nbsp;when&nbsp;it&#39;s&nbsp;still&nbsp;being&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="3946145">func</span>&nbsp;<span class="op" id="3946150">(</span><span class="ident" id="3946151">pc</span>&nbsp;<span class="op" id="3946154">*</span><span class="ident" id="3946155"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3946166">)</span>&nbsp;<span class="ident" id="3946168">markBroken</span><span class="op" id="3946178">(</span><span class="op" id="3946179">)</span>&nbsp;<span class="op" id="3946181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946184"><a href="/net/http/transport.go.html#3946151">pc</a></span><span class="op" id="3946186">.</span><span class="ident" id="3946187">lk</span><span class="op" id="3946189">.</span><span class="ident" id="3946190">Lock</span><span class="op" id="3946194">(</span><span class="op" id="3946195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946198">defer</span>&nbsp;<span class="ident" id="3946204"><a href="/net/http/transport.go.html#3946151">pc</a></span><span class="op" id="3946206">.</span><span class="ident" id="3946207">lk</span><span class="op" id="3946209">.</span><span class="ident" id="3946210">Unlock</span><span class="op" id="3946216">(</span><span class="op" id="3946217">)</span><br>
<span class="lineno">1135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946220"><a href="/net/http/transport.go.html#3946151">pc</a></span><span class="op" id="3946222">.</span><span class="ident" id="3946223">broken</span>&nbsp;<span class="op" id="3946230">=</span>&nbsp;<span class="ident" id="3946232">true</span><br>
<span class="lineno"></span><span class="op" id="3946237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3946240">func</span>&nbsp;<span class="op" id="3946245">(</span><span class="ident" id="3946246">pc</span>&nbsp;<span class="op" id="3946249">*</span><span class="ident" id="3946250"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3946261">)</span>&nbsp;<span class="builtinfunc" id="3946263">close</span><span class="op" id="3946268">(</span><span class="op" id="3946269">)</span>&nbsp;<span class="op" id="3946271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946274"><a href="/net/http/transport.go.html#3946246">pc</a></span><span class="op" id="3946276">.</span><span class="ident" id="3946277">lk</span><span class="op" id="3946279">.</span><span class="ident" id="3946280">Lock</span><span class="op" id="3946284">(</span><span class="op" id="3946285">)</span><br>
<span class="lineno">1140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946288">defer</span>&nbsp;<span class="ident" id="3946294"><a href="/net/http/transport.go.html#3946246">pc</a></span><span class="op" id="3946296">.</span><span class="ident" id="3946297">lk</span><span class="op" id="3946299">.</span><span class="ident" id="3946300">Unlock</span><span class="op" id="3946306">(</span><span class="op" id="3946307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946310"><a href="/net/http/transport.go.html#3946246">pc</a></span><span class="op" id="3946312">.</span><span class="ident" id="3946313">closeLocked</span><span class="op" id="3946324">(</span><span class="op" id="3946325">)</span><br>
<span class="lineno"></span><span class="op" id="3946327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3946330">func</span>&nbsp;<span class="op" id="3946335">(</span><span class="ident" id="3946336">pc</span>&nbsp;<span class="op" id="3946339">*</span><span class="ident" id="3946340"><a href="/net/http/transport.go.html#3936054">persistConn</a></span><span class="op" id="3946351">)</span>&nbsp;<span class="ident" id="3946353">closeLocked</span><span class="op" id="3946364">(</span><span class="op" id="3946365">)</span>&nbsp;<span class="op" id="3946367">{</span><br>
<span class="lineno">1145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946370"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946372">.</span><span class="ident" id="3946373">broken</span>&nbsp;<span class="op" id="3946380">=</span>&nbsp;<span class="ident" id="3946382">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946388">if</span>&nbsp;<span class="op" id="3946391">!</span><span class="ident" id="3946392"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946394">.</span><span class="ident" id="3946395">closed</span>&nbsp;<span class="op" id="3946402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946406"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946408">.</span><span class="ident" id="3946409">conn</span><span class="op" id="3946413">.</span><span class="ident" id="3946414">Close</span><span class="op" id="3946419">(</span><span class="op" id="3946420">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946424"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946426">.</span><span class="ident" id="3946427">closed</span>&nbsp;<span class="op" id="3946434">=</span>&nbsp;<span class="ident" id="3946436">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3946443">close</span><span class="op" id="3946448">(</span><span class="ident" id="3946449"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946451">.</span><span class="ident" id="3946452">closech</span><span class="op" id="3946459">)</span><br>
<span class="lineno">1150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946465"><a href="/net/http/transport.go.html#3946336">pc</a></span><span class="op" id="3946467">.</span><span class="ident" id="3946468">mutateHeaderFunc</span>&nbsp;<span class="op" id="3946485">=</span>&nbsp;<span class="ident" id="3946487">nil</span><br>
<span class="lineno"></span><span class="op" id="3946491">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3946494">var</span>&nbsp;<span class="ident" id="3946498">portMap</span>&nbsp;<span class="op" id="3946506">=</span>&nbsp;<span class="keyword" id="3946508">map</span><span class="op" id="3946511">[</span><span class="builtintype" id="3946512">string</span><span class="op" id="3946518">]</span><span class="builtintype" id="3946519">string</span><span class="op" id="3946525">{</span><br>
<span class="lineno">1155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3946528">&#34;http&#34;</span><span class="op" id="3946534">:</span>&nbsp;&nbsp;<span class="string" id="3946537">&#34;80&#34;</span><span class="op" id="3946541">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3946544">&#34;https&#34;</span><span class="op" id="3946551">:</span>&nbsp;<span class="string" id="3946553">&#34;443&#34;</span><span class="op" id="3946558">,</span><br>
<span class="lineno"></span><span class="op" id="3946560">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3946563">//&nbsp;canonicalAddr&nbsp;returns&nbsp;url.Host&nbsp;but&nbsp;always&nbsp;with&nbsp;a&nbsp;&#34;:port&#34;&nbsp;suffix</span><br>
<span class="lineno">1160</span><span class="keyword" id="3946630">func</span>&nbsp;<span class="ident" id="3946635">canonicalAddr</span><span class="op" id="3946648">(</span><span class="ident" id="3946649">url</span>&nbsp;<span class="op" id="3946653">*</span><span class="ident" id="3946654"><a href="/net/http/transport.go.html#3915358">url</a></span><span class="op" id="3946657">.</span><span class="ident" id="3946658">URL</span><span class="op" id="3946661">)</span>&nbsp;<span class="builtintype" id="3946663">string</span>&nbsp;<span class="op" id="3946670">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3946673">addr</span>&nbsp;<span class="op" id="3946678">:=</span>&nbsp;<span class="ident" id="3946681"><a href="/net/http/transport.go.html#3946649">url</a></span><span class="op" id="3946684">.</span><span class="ident" id="3946685">Host</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946691">if</span>&nbsp;<span class="op" id="3946694">!</span><span class="ident" id="3946695"><a href="/net/http/client.go.html#3738992">hasPort</a></span><span class="op" id="3946702">(</span><span class="ident" id="3946703"><a href="/net/http/transport.go.html#3946673">addr</a></span><span class="op" id="3946707">)</span>&nbsp;<span class="op" id="3946709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946713">return</span>&nbsp;<span class="ident" id="3946720"><a href="/net/http/transport.go.html#3946673">addr</a></span>&nbsp;<span class="op" id="3946725">+</span>&nbsp;<span class="string" id="3946727">&#34;:&#34;</span>&nbsp;<span class="op" id="3946731">+</span>&nbsp;<span class="ident" id="3946733"><a href="/net/http/transport.go.html#3946498">portMap</a></span><span class="op" id="3946740">[</span><span class="ident" id="3946741"><a href="/net/http/transport.go.html#3946649">url</a></span><span class="op" id="3946744">.</span><span class="ident" id="3946745">Scheme</span><span class="op" id="3946751">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3946754">}</span><br>
<span class="lineno">1165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3946757">return</span>&nbsp;<span class="ident" id="3946764"><a href="/net/http/transport.go.html#3946673">addr</a></span><br>
<span class="lineno"></span><span class="op" id="3946769">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3946772">//&nbsp;bodyEOFSignal&nbsp;wraps&nbsp;a&nbsp;ReadCloser&nbsp;but&nbsp;runs&nbsp;fn&nbsp;(if&nbsp;non-nil)&nbsp;at&nbsp;most</span><br>
<span class="lineno"></span><span class="comment" id="3946841">//&nbsp;once,&nbsp;right&nbsp;before&nbsp;its&nbsp;final&nbsp;(error-producing)&nbsp;Read&nbsp;or&nbsp;Close&nbsp;call</span><br>
<span class="lineno">1170</span><span class="comment" id="3946910">//&nbsp;returns.&nbsp;If&nbsp;earlyCloseFn&nbsp;is&nbsp;non-nil&nbsp;and&nbsp;Close&nbsp;is&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="3946976">//&nbsp;io.EOF&nbsp;is&nbsp;seen,&nbsp;earlyCloseFn&nbsp;is&nbsp;called&nbsp;instead&nbsp;of&nbsp;fn,&nbsp;and&nbsp;its</span><br>
<span class="lineno"></span><span class="comment" id="3947041">//&nbsp;return&nbsp;value&nbsp;is&nbsp;the&nbsp;return&nbsp;value&nbsp;from&nbsp;Close.</span><br>
<span class="lineno"></span><span class="keyword" id="3947089">type</span>&nbsp;<span class="ident" id="3947094">bodyEOFSignal</span>&nbsp;<span class="keyword" id="3947108">struct</span>&nbsp;<span class="op" id="3947115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947118">body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3947131"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3947133">.</span><span class="ident" id="3947134">ReadCloser</span><br>
<span class="lineno">1175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947146">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3947159"><a href="/net/http/transport.go.html#3915386">sync</a></span><span class="op" id="3947163">.</span><span class="ident" id="3947164">Mutex</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="3947172">//&nbsp;guards&nbsp;following&nbsp;4&nbsp;fields</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947202">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3947215">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3947228">//&nbsp;whether&nbsp;Close&nbsp;has&nbsp;been&nbsp;called</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947262">rerr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3947275">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3947288">//&nbsp;sticky&nbsp;Read&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947310">fn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="3947323">func</span><span class="op" id="3947327">(</span><span class="builtintype" id="3947328">error</span><span class="op" id="3947333">)</span>&nbsp;&nbsp;<span class="comment" id="3947336">//&nbsp;error&nbsp;will&nbsp;be&nbsp;nil&nbsp;on&nbsp;Read&nbsp;io.EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947373">earlyCloseFn</span>&nbsp;<span class="keyword" id="3947386">func</span><span class="op" id="3947390">(</span><span class="op" id="3947391">)</span>&nbsp;<span class="builtintype" id="3947393">error</span>&nbsp;<span class="comment" id="3947399">//&nbsp;optional&nbsp;alt&nbsp;Close&nbsp;func&nbsp;used&nbsp;if&nbsp;io.EOF&nbsp;not&nbsp;seen</span><br>
<span class="lineno">1180</span><span class="op" id="3947450">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3947453">func</span>&nbsp;<span class="op" id="3947458">(</span><span class="ident" id="3947459">es</span>&nbsp;<span class="op" id="3947462">*</span><span class="ident" id="3947463"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3947476">)</span>&nbsp;<span class="ident" id="3947478">Read</span><span class="op" id="3947482">(</span><span class="ident" id="3947483">p</span>&nbsp;<span class="op" id="3947485">[</span><span class="op" id="3947486">]</span><span class="builtintype" id="3947487">byte</span><span class="op" id="3947491">)</span>&nbsp;<span class="op" id="3947493">(</span><span class="ident" id="3947494">n</span>&nbsp;<span class="builtintype" id="3947496">int</span><span class="op" id="3947499">,</span>&nbsp;<span class="ident" id="3947501">err</span>&nbsp;<span class="builtintype" id="3947505">error</span><span class="op" id="3947510">)</span>&nbsp;<span class="op" id="3947512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947515"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947517">.</span><span class="ident" id="3947518">mu</span><span class="op" id="3947520">.</span><span class="ident" id="3947521">Lock</span><span class="op" id="3947525">(</span><span class="op" id="3947526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947529">closed</span><span class="op" id="3947535">,</span>&nbsp;<span class="ident" id="3947537">rerr</span>&nbsp;<span class="op" id="3947542">:=</span>&nbsp;<span class="ident" id="3947545"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947547">.</span><span class="ident" id="3947548">closed</span><span class="op" id="3947554">,</span>&nbsp;<span class="ident" id="3947556"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947558">.</span><span class="ident" id="3947559">rerr</span><br>
<span class="lineno">1185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947565"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947567">.</span><span class="ident" id="3947568">mu</span><span class="op" id="3947570">.</span><span class="ident" id="3947571">Unlock</span><span class="op" id="3947577">(</span><span class="op" id="3947578">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947581">if</span>&nbsp;<span class="ident" id="3947584"><a href="/net/http/transport.go.html#3947529">closed</a></span>&nbsp;<span class="op" id="3947591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947595">return</span>&nbsp;<span class="num" id="3947602">0</span><span class="op" id="3947603">,</span>&nbsp;<span class="ident" id="3947605"><a href="/net/http/transport.go.html#3915321">errors</a></span><span class="op" id="3947611">.</span><span class="ident" id="3947612">New</span><span class="op" id="3947615">(</span><span class="string" id="3947616">&#34;http:&nbsp;read&nbsp;on&nbsp;closed&nbsp;response&nbsp;body&#34;</span><span class="op" id="3947652">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947658">if</span>&nbsp;<span class="ident" id="3947661"><a href="/net/http/transport.go.html#3947537">rerr</a></span>&nbsp;<span class="op" id="3947666">!=</span>&nbsp;<span class="ident" id="3947669">nil</span>&nbsp;<span class="op" id="3947673">{</span><br>
<span class="lineno">1190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947677">return</span>&nbsp;<span class="num" id="3947684">0</span><span class="op" id="3947685">,</span>&nbsp;<span class="ident" id="3947687"><a href="/net/http/transport.go.html#3947537">rerr</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947693">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947697"><a href="/net/http/transport.go.html#3947494">n</a></span><span class="op" id="3947698">,</span>&nbsp;<span class="ident" id="3947700"><a href="/net/http/transport.go.html#3947501">err</a></span>&nbsp;<span class="op" id="3947704">=</span>&nbsp;<span class="ident" id="3947706"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947708">.</span><span class="ident" id="3947709">body</span><span class="op" id="3947713">.</span><span class="ident" id="3947714">Read</span><span class="op" id="3947718">(</span><span class="ident" id="3947719"><a href="/net/http/transport.go.html#3947483">p</a></span><span class="op" id="3947720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947723">if</span>&nbsp;<span class="ident" id="3947726"><a href="/net/http/transport.go.html#3947501">err</a></span>&nbsp;<span class="op" id="3947730">!=</span>&nbsp;<span class="ident" id="3947733">nil</span>&nbsp;<span class="op" id="3947737">{</span><br>
<span class="lineno">1195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947741"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947743">.</span><span class="ident" id="3947744">mu</span><span class="op" id="3947746">.</span><span class="ident" id="3947747">Lock</span><span class="op" id="3947751">(</span><span class="op" id="3947752">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947756">defer</span>&nbsp;<span class="ident" id="3947762"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947764">.</span><span class="ident" id="3947765">mu</span><span class="op" id="3947767">.</span><span class="ident" id="3947768">Unlock</span><span class="op" id="3947774">(</span><span class="op" id="3947775">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947779">if</span>&nbsp;<span class="ident" id="3947782"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947784">.</span><span class="ident" id="3947785">rerr</span>&nbsp;<span class="op" id="3947790">==</span>&nbsp;<span class="ident" id="3947793">nil</span>&nbsp;<span class="op" id="3947797">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947802"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947804">.</span><span class="ident" id="3947805">rerr</span>&nbsp;<span class="op" id="3947810">=</span>&nbsp;<span class="ident" id="3947812"><a href="/net/http/transport.go.html#3947501">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947818">}</span><br>
<span class="lineno">1200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947822"><a href="/net/http/transport.go.html#3947459">es</a></span><span class="op" id="3947824">.</span><span class="ident" id="3947825">condfn</span><span class="op" id="3947831">(</span><span class="ident" id="3947832"><a href="/net/http/transport.go.html#3947501">err</a></span><span class="op" id="3947835">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947838">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947841">return</span><br>
<span class="lineno"></span><span class="op" id="3947848">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1205</span><span class="keyword" id="3947851">func</span>&nbsp;<span class="op" id="3947856">(</span><span class="ident" id="3947857">es</span>&nbsp;<span class="op" id="3947860">*</span><span class="ident" id="3947861"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3947874">)</span>&nbsp;<span class="ident" id="3947876">Close</span><span class="op" id="3947881">(</span><span class="op" id="3947882">)</span>&nbsp;<span class="builtintype" id="3947884">error</span>&nbsp;<span class="op" id="3947890">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947893"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3947895">.</span><span class="ident" id="3947896">mu</span><span class="op" id="3947898">.</span><span class="ident" id="3947899">Lock</span><span class="op" id="3947903">(</span><span class="op" id="3947904">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947907">defer</span>&nbsp;<span class="ident" id="3947913"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3947915">.</span><span class="ident" id="3947916">mu</span><span class="op" id="3947918">.</span><span class="ident" id="3947919">Unlock</span><span class="op" id="3947925">(</span><span class="op" id="3947926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947929">if</span>&nbsp;<span class="ident" id="3947932"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3947934">.</span><span class="ident" id="3947935">closed</span>&nbsp;<span class="op" id="3947942">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947946">return</span>&nbsp;<span class="ident" id="3947953">nil</span><br>
<span class="lineno">1210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3947958">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3947961"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3947963">.</span><span class="ident" id="3947964">closed</span>&nbsp;<span class="op" id="3947971">=</span>&nbsp;<span class="ident" id="3947973">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3947979">if</span>&nbsp;<span class="ident" id="3947982"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3947984">.</span><span class="ident" id="3947985">earlyCloseFn</span>&nbsp;<span class="op" id="3947998">!=</span>&nbsp;<span class="ident" id="3948001">nil</span>&nbsp;<span class="op" id="3948005">&amp;&amp;</span>&nbsp;<span class="ident" id="3948008"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3948010">.</span><span class="ident" id="3948011">rerr</span>&nbsp;<span class="op" id="3948016">!=</span>&nbsp;<span class="ident" id="3948019"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948021">.</span><span class="ident" id="3948022">EOF</span>&nbsp;<span class="op" id="3948026">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948030">return</span>&nbsp;<span class="ident" id="3948037"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3948039">.</span><span class="ident" id="3948040">earlyCloseFn</span><span class="op" id="3948052">(</span><span class="op" id="3948053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948056">}</span><br>
<span class="lineno">1215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948059">err</span>&nbsp;<span class="op" id="3948063">:=</span>&nbsp;<span class="ident" id="3948066"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3948068">.</span><span class="ident" id="3948069">body</span><span class="op" id="3948073">.</span><span class="ident" id="3948074">Close</span><span class="op" id="3948079">(</span><span class="op" id="3948080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948083"><a href="/net/http/transport.go.html#3947857">es</a></span><span class="op" id="3948085">.</span><span class="ident" id="3948086">condfn</span><span class="op" id="3948092">(</span><span class="ident" id="3948093"><a href="/net/http/transport.go.html#3948059">err</a></span><span class="op" id="3948096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948099">return</span>&nbsp;<span class="ident" id="3948106"><a href="/net/http/transport.go.html#3948059">err</a></span><br>
<span class="lineno"></span><span class="op" id="3948110">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1220</span><span class="comment" id="3948113">//&nbsp;caller&nbsp;must&nbsp;hold&nbsp;es.mu.</span><br>
<span class="lineno"></span><span class="keyword" id="3948140">func</span>&nbsp;<span class="op" id="3948145">(</span><span class="ident" id="3948146">es</span>&nbsp;<span class="op" id="3948149">*</span><span class="ident" id="3948150"><a href="/net/http/transport.go.html#3947094">bodyEOFSignal</a></span><span class="op" id="3948163">)</span>&nbsp;<span class="ident" id="3948165">condfn</span><span class="op" id="3948171">(</span><span class="ident" id="3948172">err</span>&nbsp;<span class="builtintype" id="3948176">error</span><span class="op" id="3948181">)</span>&nbsp;<span class="op" id="3948183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948186">if</span>&nbsp;<span class="ident" id="3948189"><a href="/net/http/transport.go.html#3948146">es</a></span><span class="op" id="3948191">.</span><span class="ident" id="3948192">fn</span>&nbsp;<span class="op" id="3948195">==</span>&nbsp;<span class="ident" id="3948198">nil</span>&nbsp;<span class="op" id="3948202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948206">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948214">}</span><br>
<span class="lineno">1225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948217">if</span>&nbsp;<span class="ident" id="3948220"><a href="/net/http/transport.go.html#3948172">err</a></span>&nbsp;<span class="op" id="3948224">==</span>&nbsp;<span class="ident" id="3948227"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948229">.</span><span class="ident" id="3948230">EOF</span>&nbsp;<span class="op" id="3948234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948238"><a href="/net/http/transport.go.html#3948172">err</a></span>&nbsp;<span class="op" id="3948242">=</span>&nbsp;<span class="ident" id="3948244">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948249">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948252"><a href="/net/http/transport.go.html#3948146">es</a></span><span class="op" id="3948254">.</span><span class="ident" id="3948255">fn</span><span class="op" id="3948257">(</span><span class="ident" id="3948258"><a href="/net/http/transport.go.html#3948172">err</a></span><span class="op" id="3948261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948264"><a href="/net/http/transport.go.html#3948146">es</a></span><span class="op" id="3948266">.</span><span class="ident" id="3948267">fn</span>&nbsp;<span class="op" id="3948270">=</span>&nbsp;<span class="ident" id="3948272">nil</span><br>
<span class="lineno">1230</span><span class="op" id="3948276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3948279">//&nbsp;gzipReader&nbsp;wraps&nbsp;a&nbsp;response&nbsp;body&nbsp;so&nbsp;it&nbsp;can&nbsp;lazily</span><br>
<span class="lineno"></span><span class="comment" id="3948332">//&nbsp;call&nbsp;gzip.NewReader&nbsp;on&nbsp;the&nbsp;first&nbsp;call&nbsp;to&nbsp;Read</span><br>
<span class="lineno"></span><span class="keyword" id="3948381">type</span>&nbsp;<span class="ident" id="3948386">gzipReader</span>&nbsp;<span class="keyword" id="3948397">struct</span>&nbsp;<span class="op" id="3948404">{</span><br>
<span class="lineno">1235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948407">body</span>&nbsp;<span class="ident" id="3948412"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948414">.</span><span class="ident" id="3948415">ReadCloser</span>&nbsp;<span class="comment" id="3948426">//&nbsp;underlying&nbsp;Response.Body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948455">zr</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="3948460"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948462">.</span><span class="ident" id="3948463">Reader</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3948474">//&nbsp;lazily-initialized&nbsp;gzip&nbsp;reader</span><br>
<span class="lineno"></span><span class="op" id="3948508">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3948511">func</span>&nbsp;<span class="op" id="3948516">(</span><span class="ident" id="3948517">gz</span>&nbsp;<span class="op" id="3948520">*</span><span class="ident" id="3948521"><a href="/net/http/transport.go.html#3948386">gzipReader</a></span><span class="op" id="3948531">)</span>&nbsp;<span class="ident" id="3948533">Read</span><span class="op" id="3948537">(</span><span class="ident" id="3948538">p</span>&nbsp;<span class="op" id="3948540">[</span><span class="op" id="3948541">]</span><span class="builtintype" id="3948542">byte</span><span class="op" id="3948546">)</span>&nbsp;<span class="op" id="3948548">(</span><span class="ident" id="3948549">n</span>&nbsp;<span class="builtintype" id="3948551">int</span><span class="op" id="3948554">,</span>&nbsp;<span class="ident" id="3948556">err</span>&nbsp;<span class="builtintype" id="3948560">error</span><span class="op" id="3948565">)</span>&nbsp;<span class="op" id="3948567">{</span><br>
<span class="lineno">1240</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948570">if</span>&nbsp;<span class="ident" id="3948573"><a href="/net/http/transport.go.html#3948517">gz</a></span><span class="op" id="3948575">.</span><span class="ident" id="3948576">zr</span>&nbsp;<span class="op" id="3948579">==</span>&nbsp;<span class="ident" id="3948582">nil</span>&nbsp;<span class="op" id="3948586">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948590"><a href="/net/http/transport.go.html#3948517">gz</a></span><span class="op" id="3948592">.</span><span class="ident" id="3948593">zr</span><span class="op" id="3948595">,</span>&nbsp;<span class="ident" id="3948597"><a href="/net/http/transport.go.html#3948556">err</a></span>&nbsp;<span class="op" id="3948601">=</span>&nbsp;<span class="ident" id="3948603"><a href="/net/http/transport.go.html#3915290">gzip</a></span><span class="op" id="3948607">.</span><span class="ident" id="3948608">NewReader</span><span class="op" id="3948617">(</span><span class="ident" id="3948618"><a href="/net/http/transport.go.html#3948517">gz</a></span><span class="op" id="3948620">.</span><span class="ident" id="3948621">body</span><span class="op" id="3948625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948629">if</span>&nbsp;<span class="ident" id="3948632"><a href="/net/http/transport.go.html#3948556">err</a></span>&nbsp;<span class="op" id="3948636">!=</span>&nbsp;<span class="ident" id="3948639">nil</span>&nbsp;<span class="op" id="3948643">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948648">return</span>&nbsp;<span class="num" id="3948655">0</span><span class="op" id="3948656">,</span>&nbsp;<span class="ident" id="3948658"><a href="/net/http/transport.go.html#3948556">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948664">}</span><br>
<span class="lineno">1245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3948667">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948670">return</span>&nbsp;<span class="ident" id="3948677"><a href="/net/http/transport.go.html#3948517">gz</a></span><span class="op" id="3948679">.</span><span class="ident" id="3948680">zr</span><span class="op" id="3948682">.</span><span class="ident" id="3948683">Read</span><span class="op" id="3948687">(</span><span class="ident" id="3948688"><a href="/net/http/transport.go.html#3948538">p</a></span><span class="op" id="3948689">)</span><br>
<span class="lineno"></span><span class="op" id="3948691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3948694">func</span>&nbsp;<span class="op" id="3948699">(</span><span class="ident" id="3948700">gz</span>&nbsp;<span class="op" id="3948703">*</span><span class="ident" id="3948704"><a href="/net/http/transport.go.html#3948386">gzipReader</a></span><span class="op" id="3948714">)</span>&nbsp;<span class="ident" id="3948716">Close</span><span class="op" id="3948721">(</span><span class="op" id="3948722">)</span>&nbsp;<span class="builtintype" id="3948724">error</span>&nbsp;<span class="op" id="3948730">{</span><br>
<span class="lineno">1250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3948733">return</span>&nbsp;<span class="ident" id="3948740"><a href="/net/http/transport.go.html#3948700">gz</a></span><span class="op" id="3948742">.</span><span class="ident" id="3948743">body</span><span class="op" id="3948747">.</span><span class="ident" id="3948748">Close</span><span class="op" id="3948753">(</span><span class="op" id="3948754">)</span><br>
<span class="lineno"></span><span class="op" id="3948756">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3948759">type</span>&nbsp;<span class="ident" id="3948764">readerAndCloser</span>&nbsp;<span class="keyword" id="3948780">struct</span>&nbsp;<span class="op" id="3948787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948790"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948792">.</span><span class="ident" id="3948793">Reader</span><br>
<span class="lineno">1255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3948801"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3948803">.</span><span class="ident" id="3948804">Closer</span><br>
<span class="lineno"></span><span class="op" id="3948811">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3948814">type</span>&nbsp;<span class="ident" id="3948819">tlsHandshakeTimeoutError</span>&nbsp;<span class="keyword" id="3948844">struct</span><span class="op" id="3948850">{</span><span class="op" id="3948851">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">1260</span><span class="keyword" id="3948854">func</span>&nbsp;<span class="op" id="3948859">(</span><span class="ident" id="3948860"><a href="/net/http/transport.go.html#3948819">tlsHandshakeTimeoutError</a></span><span class="op" id="3948884">)</span>&nbsp;<span class="ident" id="3948886">Timeout</span><span class="op" id="3948893">(</span><span class="op" id="3948894">)</span>&nbsp;<span class="builtintype" id="3948896">bool</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3948903">{</span>&nbsp;<span class="keyword" id="3948905">return</span>&nbsp;<span class="ident" id="3948912">true</span>&nbsp;<span class="op" id="3948917">}</span><br>
<span class="lineno"></span><span class="keyword" id="3948919">func</span>&nbsp;<span class="op" id="3948924">(</span><span class="ident" id="3948925"><a href="/net/http/transport.go.html#3948819">tlsHandshakeTimeoutError</a></span><span class="op" id="3948949">)</span>&nbsp;<span class="ident" id="3948951">Temporary</span><span class="op" id="3948960">(</span><span class="op" id="3948961">)</span>&nbsp;<span class="builtintype" id="3948963">bool</span>&nbsp;<span class="op" id="3948968">{</span>&nbsp;<span class="keyword" id="3948970">return</span>&nbsp;<span class="ident" id="3948977">true</span>&nbsp;<span class="op" id="3948982">}</span><br>
<span class="lineno"></span><span class="keyword" id="3948984">func</span>&nbsp;<span class="op" id="3948989">(</span><span class="ident" id="3948990"><a href="/net/http/transport.go.html#3948819">tlsHandshakeTimeoutError</a></span><span class="op" id="3949014">)</span>&nbsp;<span class="ident" id="3949016">Error</span><span class="op" id="3949021">(</span><span class="op" id="3949022">)</span>&nbsp;<span class="builtintype" id="3949024">string</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3949033">{</span>&nbsp;<span class="keyword" id="3949035">return</span>&nbsp;<span class="string" id="3949042">&#34;net/http:&nbsp;TLS&nbsp;handshake&nbsp;timeout&#34;</span>&nbsp;<span class="op" id="3949076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3949079">type</span>&nbsp;<span class="ident" id="3949084">noteEOFReader</span>&nbsp;<span class="keyword" id="3949098">struct</span>&nbsp;<span class="op" id="3949105">{</span><br>
<span class="lineno">1265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949108">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3949115"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3949117">.</span><span class="ident" id="3949118">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949126">sawEOF</span>&nbsp;<span class="op" id="3949133">*</span><span class="builtintype" id="3949134">bool</span><br>
<span class="lineno"></span><span class="op" id="3949139">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3949142">func</span>&nbsp;<span class="op" id="3949147">(</span><span class="ident" id="3949148">nr</span>&nbsp;<span class="ident" id="3949151"><a href="/net/http/transport.go.html#3949084">noteEOFReader</a></span><span class="op" id="3949164">)</span>&nbsp;<span class="ident" id="3949166">Read</span><span class="op" id="3949170">(</span><span class="ident" id="3949171">p</span>&nbsp;<span class="op" id="3949173">[</span><span class="op" id="3949174">]</span><span class="builtintype" id="3949175">byte</span><span class="op" id="3949179">)</span>&nbsp;<span class="op" id="3949181">(</span><span class="ident" id="3949182">n</span>&nbsp;<span class="builtintype" id="3949184">int</span><span class="op" id="3949187">,</span>&nbsp;<span class="ident" id="3949189">err</span>&nbsp;<span class="builtintype" id="3949193">error</span><span class="op" id="3949198">)</span>&nbsp;<span class="op" id="3949200">{</span><br>
<span class="lineno">1270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3949203"><a href="/net/http/transport.go.html#3949182">n</a></span><span class="op" id="3949204">,</span>&nbsp;<span class="ident" id="3949206"><a href="/net/http/transport.go.html#3949189">err</a></span>&nbsp;<span class="op" id="3949210">=</span>&nbsp;<span class="ident" id="3949212"><a href="/net/http/transport.go.html#3949148">nr</a></span><span class="op" id="3949214">.</span><span class="ident" id="3949215">r</span><span class="op" id="3949216">.</span><span class="ident" id="3949217">Read</span><span class="op" id="3949221">(</span><span class="ident" id="3949222"><a href="/net/http/transport.go.html#3949171">p</a></span><span class="op" id="3949223">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949226">if</span>&nbsp;<span class="ident" id="3949229"><a href="/net/http/transport.go.html#3949189">err</a></span>&nbsp;<span class="op" id="3949233">==</span>&nbsp;<span class="ident" id="3949236"><a href="/net/http/transport.go.html#3915338">io</a></span><span class="op" id="3949238">.</span><span class="ident" id="3949239">EOF</span>&nbsp;<span class="op" id="3949243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949247">*</span><span class="ident" id="3949248"><a href="/net/http/transport.go.html#3949148">nr</a></span><span class="op" id="3949250">.</span><span class="ident" id="3949251">sawEOF</span>&nbsp;<span class="op" id="3949258">=</span>&nbsp;<span class="ident" id="3949260">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3949266">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3949269">return</span><br>
<span class="lineno">1275</span><span class="op" id="3949276">}</span>
</div>
</body>
</html>
