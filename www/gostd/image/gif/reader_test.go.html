<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image/gif</h2>
<ul>
<li><a href="/gostd/image/gif/reader.go.html">reader.go</a></li>
<li><a href="/gostd/image/gif/reader_test.go.html" class="current">reader_test.go</a></li>
<li><a href="/gostd/image/gif/writer.go.html">writer.go</a></li>
<li><a href="/gostd/image/gif/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7462578">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7462633">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7462687">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7462738">package</span>&nbsp;<span class="ident" id="7462746">gif</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7462751">import</span>&nbsp;<span class="op" id="7462758">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462761">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462770">&#34;compress/lzw&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462786">&#34;image&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462795">&#34;image/color&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462810">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462821">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7462831">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7462834">//&nbsp;header,&nbsp;palette&nbsp;and&nbsp;trailer&nbsp;are&nbsp;parts&nbsp;of&nbsp;a&nbsp;valid&nbsp;2x1&nbsp;GIF&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="7462901">const</span>&nbsp;<span class="op" id="7462907">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7462910">headerStr</span>&nbsp;<span class="op" id="7462920">=</span>&nbsp;<span class="string" id="7462922">&#34;GIF89a&#34;</span>&nbsp;<span class="op" id="7462931">+</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462935">&#34;\x02\x00\x01\x00&#34;</span>&nbsp;<span class="op" id="7462954">+</span>&nbsp;<span class="comment" id="7462956">//&nbsp;width=2,&nbsp;height=1</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7462979">&#34;\x80\x00\x00&#34;</span>&nbsp;<span class="comment" id="7462994">//&nbsp;headerFields=(a&nbsp;color&nbsp;map&nbsp;of&nbsp;2&nbsp;pixels),&nbsp;backgroundIndex,&nbsp;aspect</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463062">paletteStr</span>&nbsp;<span class="op" id="7463073">=</span>&nbsp;<span class="string" id="7463075">&#34;\x10\x20\x30\x40\x50\x60&#34;</span>&nbsp;<span class="comment" id="7463102">//&nbsp;the&nbsp;color&nbsp;map,&nbsp;also&nbsp;known&nbsp;as&nbsp;a&nbsp;palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463145">trailerStr</span>&nbsp;<span class="op" id="7463156">=</span>&nbsp;<span class="string" id="7463158">&#34;\x3b&#34;</span><br>
<span class="lineno"></span><span class="op" id="7463165">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="comment" id="7463168">//&nbsp;lzwEncode&nbsp;returns&nbsp;an&nbsp;LZW&nbsp;encoding&nbsp;(with&nbsp;2-bit&nbsp;literals)&nbsp;of&nbsp;n&nbsp;zeroes.</span><br>
<span class="lineno"></span><span class="keyword" id="7463240">func</span>&nbsp;<span class="ident" id="7463245">lzwEncode</span><span class="op" id="7463254">(</span><span class="ident" id="7463255">n</span>&nbsp;<span class="builtintype" id="7463257">int</span><span class="op" id="7463260">)</span>&nbsp;<span class="op" id="7463262">[</span><span class="op" id="7463263">]</span><span class="builtintype" id="7463264">byte</span>&nbsp;<span class="op" id="7463269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463272">b</span>&nbsp;<span class="op" id="7463274">:=</span>&nbsp;<span class="op" id="7463277">&amp;</span><span class="ident" id="7463278">bytes</span><span class="op" id="7463283">.</span><span class="ident" id="7463284">Buffer</span><span class="op" id="7463290">{</span><span class="op" id="7463291">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463294">w</span>&nbsp;<span class="op" id="7463296">:=</span>&nbsp;<span class="ident" id="7463299">lzw</span><span class="op" id="7463302">.</span><span class="ident" id="7463303">NewWriter</span><span class="op" id="7463312">(</span><span class="ident" id="7463313">b</span><span class="op" id="7463314">,</span>&nbsp;<span class="ident" id="7463316">lzw</span><span class="op" id="7463319">.</span><span class="ident" id="7463320">LSB</span><span class="op" id="7463323">,</span>&nbsp;<span class="num" id="7463325">2</span><span class="op" id="7463326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463329">w</span><span class="op" id="7463330">.</span><span class="ident" id="7463331">Write</span><span class="op" id="7463336">(</span><span class="builtinfunc" id="7463337">make</span><span class="op" id="7463341">(</span><span class="op" id="7463342">[</span><span class="op" id="7463343">]</span><span class="builtintype" id="7463344">byte</span><span class="op" id="7463348">,</span>&nbsp;<span class="ident" id="7463350">n</span><span class="op" id="7463351">)</span><span class="op" id="7463352">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463355">w</span><span class="op" id="7463356">.</span><span class="ident" id="7463357">Close</span><span class="op" id="7463362">(</span><span class="op" id="7463363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463366">return</span>&nbsp;<span class="ident" id="7463373">b</span><span class="op" id="7463374">.</span><span class="ident" id="7463375">Bytes</span><span class="op" id="7463380">(</span><span class="op" id="7463381">)</span><br>
<span class="lineno"></span><span class="op" id="7463383">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7463386">func</span>&nbsp;<span class="ident" id="7463391">TestDecode</span><span class="op" id="7463401">(</span><span class="ident" id="7463402">t</span>&nbsp;<span class="op" id="7463404">*</span><span class="ident" id="7463405">testing</span><span class="op" id="7463412">.</span><span class="ident" id="7463413">T</span><span class="op" id="7463414">)</span>&nbsp;<span class="op" id="7463416">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463419">testCases</span>&nbsp;<span class="op" id="7463429">:=</span>&nbsp;<span class="op" id="7463432">[</span><span class="op" id="7463433">]</span><span class="keyword" id="7463434">struct</span>&nbsp;<span class="op" id="7463441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463445">nPix</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7463453">int</span>&nbsp;&nbsp;<span class="comment" id="7463458">//&nbsp;The&nbsp;number&nbsp;of&nbsp;pixels&nbsp;in&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463503">extra</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7463511">bool</span>&nbsp;<span class="comment" id="7463516">//&nbsp;Whether&nbsp;to&nbsp;write&nbsp;an&nbsp;extra&nbsp;block&nbsp;after&nbsp;the&nbsp;LZW-encoded&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463581">wantErr</span>&nbsp;<span class="builtintype" id="7463589">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463596">}</span><span class="op" id="7463597">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463601">{</span><span class="num" id="7463602">0</span><span class="op" id="7463603">,</span>&nbsp;<span class="builtintype" id="7463605">false</span><span class="op" id="7463610">,</span>&nbsp;<span class="ident" id="7463612">errNotEnough</span><span class="op" id="7463624">}</span><span class="op" id="7463625">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463629">{</span><span class="num" id="7463630">1</span><span class="op" id="7463631">,</span>&nbsp;<span class="builtintype" id="7463633">false</span><span class="op" id="7463638">,</span>&nbsp;<span class="ident" id="7463640">errNotEnough</span><span class="op" id="7463652">}</span><span class="op" id="7463653">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463657">{</span><span class="num" id="7463658">2</span><span class="op" id="7463659">,</span>&nbsp;<span class="builtintype" id="7463661">false</span><span class="op" id="7463666">,</span>&nbsp;<span class="ident" id="7463668">nil</span><span class="op" id="7463671">}</span><span class="op" id="7463672">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463676">{</span><span class="num" id="7463677">2</span><span class="op" id="7463678">,</span>&nbsp;<span class="builtintype" id="7463680">true</span><span class="op" id="7463684">,</span>&nbsp;<span class="ident" id="7463686">errTooMuch</span><span class="op" id="7463696">}</span><span class="op" id="7463697">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463701">{</span><span class="num" id="7463702">3</span><span class="op" id="7463703">,</span>&nbsp;<span class="builtintype" id="7463705">false</span><span class="op" id="7463710">,</span>&nbsp;<span class="ident" id="7463712">errTooMuch</span><span class="op" id="7463722">}</span><span class="op" id="7463723">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7463726">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7463729">for</span>&nbsp;<span class="ident" id="7463733">_</span><span class="op" id="7463734">,</span>&nbsp;<span class="ident" id="7463736">tc</span>&nbsp;<span class="op" id="7463739">:=</span>&nbsp;<span class="keyword" id="7463742">range</span>&nbsp;<span class="ident" id="7463748">testCases</span>&nbsp;<span class="op" id="7463758">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463762">b</span>&nbsp;<span class="op" id="7463764">:=</span>&nbsp;<span class="op" id="7463767">&amp;</span><span class="ident" id="7463768">bytes</span><span class="op" id="7463773">.</span><span class="ident" id="7463774">Buffer</span><span class="op" id="7463780">{</span><span class="op" id="7463781">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463785">b</span><span class="op" id="7463786">.</span><span class="ident" id="7463787">WriteString</span><span class="op" id="7463798">(</span><span class="ident" id="7463799">headerStr</span><span class="op" id="7463808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7463812">b</span><span class="op" id="7463813">.</span><span class="ident" id="7463814">WriteString</span><span class="op" id="7463825">(</span><span class="ident" id="7463826">paletteStr</span><span class="op" id="7463836">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7463840">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1&nbsp;but&nbsp;tc.nPix&nbsp;pixels.&nbsp;If&nbsp;tc.nPix&nbsp;!=&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7463912">//&nbsp;then&nbsp;this&nbsp;should&nbsp;result&nbsp;in&nbsp;an&nbsp;invalid&nbsp;GIF&nbsp;image.&nbsp;First,&nbsp;write&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7463981">//&nbsp;magic&nbsp;0x2c&nbsp;(image&nbsp;descriptor)&nbsp;byte,&nbsp;bounds=(0,0)-(2,1),&nbsp;a&nbsp;flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7464050">//&nbsp;byte,&nbsp;and&nbsp;2-bit&nbsp;LZW&nbsp;literals.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464085">b</span><span class="op" id="7464086">.</span><span class="ident" id="7464087">WriteString</span><span class="op" id="7464098">(</span><span class="string" id="7464099">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7464145">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464149">if</span>&nbsp;<span class="ident" id="7464152">tc</span><span class="op" id="7464154">.</span><span class="ident" id="7464155">nPix</span>&nbsp;<span class="op" id="7464160">&gt;</span>&nbsp;<span class="num" id="7464162">0</span>&nbsp;<span class="op" id="7464164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464169">enc</span>&nbsp;<span class="op" id="7464173">:=</span>&nbsp;<span class="ident" id="7464176">lzwEncode</span><span class="op" id="7464185">(</span><span class="ident" id="7464186">tc</span><span class="op" id="7464188">.</span><span class="ident" id="7464189">nPix</span><span class="op" id="7464193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464198">if</span>&nbsp;<span class="builtinfunc" id="7464201">len</span><span class="op" id="7464204">(</span><span class="ident" id="7464205">enc</span><span class="op" id="7464208">)</span>&nbsp;<span class="op" id="7464210">&gt;</span>&nbsp;<span class="num" id="7464212">0xff</span>&nbsp;<span class="op" id="7464217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464223">t</span><span class="op" id="7464224">.</span><span class="ident" id="7464225">Errorf</span><span class="op" id="7464231">(</span><span class="string" id="7464232">&#34;nPix=%d,&nbsp;extra=%t:&nbsp;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7464286">,</span>&nbsp;<span class="ident" id="7464288">tc</span><span class="op" id="7464290">.</span><span class="ident" id="7464291">nPix</span><span class="op" id="7464295">,</span>&nbsp;<span class="ident" id="7464297">tc</span><span class="op" id="7464299">.</span><span class="ident" id="7464300">extra</span><span class="op" id="7464305">,</span>&nbsp;<span class="builtinfunc" id="7464307">len</span><span class="op" id="7464310">(</span><span class="ident" id="7464311">enc</span><span class="op" id="7464314">)</span><span class="op" id="7464315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464321">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464333">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464338">b</span><span class="op" id="7464339">.</span><span class="ident" id="7464340">WriteByte</span><span class="op" id="7464349">(</span><span class="builtintype" id="7464350">byte</span><span class="op" id="7464354">(</span><span class="builtinfunc" id="7464355">len</span><span class="op" id="7464358">(</span><span class="ident" id="7464359">enc</span><span class="op" id="7464362">)</span><span class="op" id="7464363">)</span><span class="op" id="7464364">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464369">b</span><span class="op" id="7464370">.</span><span class="ident" id="7464371">Write</span><span class="op" id="7464376">(</span><span class="ident" id="7464377">enc</span><span class="op" id="7464380">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464384">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464388">if</span>&nbsp;<span class="ident" id="7464391">tc</span><span class="op" id="7464393">.</span><span class="ident" id="7464394">extra</span>&nbsp;<span class="op" id="7464400">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464405">b</span><span class="op" id="7464406">.</span><span class="ident" id="7464407">WriteString</span><span class="op" id="7464418">(</span><span class="string" id="7464419">&#34;\x01\x02&#34;</span><span class="op" id="7464429">)</span>&nbsp;<span class="comment" id="7464431">//&nbsp;A&nbsp;1-byte&nbsp;payload&nbsp;with&nbsp;an&nbsp;0x02&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464476">b</span><span class="op" id="7464477">.</span><span class="ident" id="7464478">WriteByte</span><span class="op" id="7464487">(</span><span class="num" id="7464488">0x00</span><span class="op" id="7464492">)</span>&nbsp;<span class="comment" id="7464494">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464551">b</span><span class="op" id="7464552">.</span><span class="ident" id="7464553">WriteString</span><span class="op" id="7464564">(</span><span class="ident" id="7464565">trailerStr</span><span class="op" id="7464575">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464580">got</span><span class="op" id="7464583">,</span>&nbsp;<span class="ident" id="7464585">err</span>&nbsp;<span class="op" id="7464589">:=</span>&nbsp;<span class="ident" id="7464592">Decode</span><span class="op" id="7464598">(</span><span class="ident" id="7464599">b</span><span class="op" id="7464600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464604">if</span>&nbsp;<span class="ident" id="7464607">err</span>&nbsp;<span class="op" id="7464611">!=</span>&nbsp;<span class="ident" id="7464614">tc</span><span class="op" id="7464616">.</span><span class="ident" id="7464617">wantErr</span>&nbsp;<span class="op" id="7464625">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464630">t</span><span class="op" id="7464631">.</span><span class="ident" id="7464632">Errorf</span><span class="op" id="7464638">(</span><span class="string" id="7464639">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7464676">,</span>&nbsp;<span class="ident" id="7464678">tc</span><span class="op" id="7464680">.</span><span class="ident" id="7464681">nPix</span><span class="op" id="7464685">,</span>&nbsp;<span class="ident" id="7464687">tc</span><span class="op" id="7464689">.</span><span class="ident" id="7464690">extra</span><span class="op" id="7464695">,</span>&nbsp;<span class="ident" id="7464697">err</span><span class="op" id="7464700">,</span>&nbsp;<span class="ident" id="7464702">tc</span><span class="op" id="7464704">.</span><span class="ident" id="7464705">wantErr</span><span class="op" id="7464712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464721">if</span>&nbsp;<span class="ident" id="7464724">tc</span><span class="op" id="7464726">.</span><span class="ident" id="7464727">wantErr</span>&nbsp;<span class="op" id="7464735">!=</span>&nbsp;<span class="ident" id="7464738">nil</span>&nbsp;<span class="op" id="7464742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464747">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464762">want</span>&nbsp;<span class="op" id="7464767">:=</span>&nbsp;<span class="op" id="7464770">&amp;</span><span class="ident" id="7464771">image</span><span class="op" id="7464776">.</span><span class="ident" id="7464777">Paletted</span><span class="op" id="7464785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464790">Pix</span><span class="op" id="7464793">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7464798">[</span><span class="op" id="7464799">]</span><span class="builtintype" id="7464800">uint8</span><span class="op" id="7464805">{</span><span class="num" id="7464806">0</span><span class="op" id="7464807">,</span>&nbsp;<span class="num" id="7464809">0</span><span class="op" id="7464810">}</span><span class="op" id="7464811">,</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464816">Stride</span><span class="op" id="7464822">:</span>&nbsp;<span class="num" id="7464824">2</span><span class="op" id="7464825">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464830">Rect</span><span class="op" id="7464834">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7464838">image</span><span class="op" id="7464843">.</span><span class="ident" id="7464844">Rect</span><span class="op" id="7464848">(</span><span class="num" id="7464849">0</span><span class="op" id="7464850">,</span>&nbsp;<span class="num" id="7464852">0</span><span class="op" id="7464853">,</span>&nbsp;<span class="num" id="7464855">2</span><span class="op" id="7464856">,</span>&nbsp;<span class="num" id="7464858">1</span><span class="op" id="7464859">)</span><span class="op" id="7464860">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464865">Palette</span><span class="op" id="7464872">:</span>&nbsp;<span class="ident" id="7464874">color</span><span class="op" id="7464879">.</span><span class="ident" id="7464880">Palette</span><span class="op" id="7464887">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464893">color</span><span class="op" id="7464898">.</span><span class="ident" id="7464899">RGBA</span><span class="op" id="7464903">{</span><span class="num" id="7464904">0x10</span><span class="op" id="7464908">,</span>&nbsp;<span class="num" id="7464910">0x20</span><span class="op" id="7464914">,</span>&nbsp;<span class="num" id="7464916">0x30</span><span class="op" id="7464920">,</span>&nbsp;<span class="num" id="7464922">0xff</span><span class="op" id="7464926">}</span><span class="op" id="7464927">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7464933">color</span><span class="op" id="7464938">.</span><span class="ident" id="7464939">RGBA</span><span class="op" id="7464943">{</span><span class="num" id="7464944">0x40</span><span class="op" id="7464948">,</span>&nbsp;<span class="num" id="7464950">0x50</span><span class="op" id="7464954">,</span>&nbsp;<span class="num" id="7464956">0x60</span><span class="op" id="7464960">,</span>&nbsp;<span class="num" id="7464962">0xff</span><span class="op" id="7464966">}</span><span class="op" id="7464967">,</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464972">}</span><span class="op" id="7464973">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7464977">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7464981">if</span>&nbsp;<span class="op" id="7464984">!</span><span class="ident" id="7464985">reflect</span><span class="op" id="7464992">.</span><span class="ident" id="7464993">DeepEqual</span><span class="op" id="7465002">(</span><span class="ident" id="7465003">got</span><span class="op" id="7465006">,</span>&nbsp;<span class="ident" id="7465008">want</span><span class="op" id="7465012">)</span>&nbsp;<span class="op" id="7465014">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465019">t</span><span class="op" id="7465020">.</span><span class="ident" id="7465021">Errorf</span><span class="op" id="7465027">(</span><span class="string" id="7465028">&#34;nPix=%d,&nbsp;extra=%t\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7465065">,</span>&nbsp;<span class="ident" id="7465067">tc</span><span class="op" id="7465069">.</span><span class="ident" id="7465070">nPix</span><span class="op" id="7465074">,</span>&nbsp;<span class="ident" id="7465076">tc</span><span class="op" id="7465078">.</span><span class="ident" id="7465079">extra</span><span class="op" id="7465084">,</span>&nbsp;<span class="ident" id="7465086">got</span><span class="op" id="7465089">,</span>&nbsp;<span class="ident" id="7465091">want</span><span class="op" id="7465095">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465099">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465102">}</span><br>
<span class="lineno"></span><span class="op" id="7465104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7465107">func</span>&nbsp;<span class="ident" id="7465112">TestTransparentIndex</span><span class="op" id="7465132">(</span><span class="ident" id="7465133">t</span>&nbsp;<span class="op" id="7465135">*</span><span class="ident" id="7465136">testing</span><span class="op" id="7465143">.</span><span class="ident" id="7465144">T</span><span class="op" id="7465145">)</span>&nbsp;<span class="op" id="7465147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465150">b</span>&nbsp;<span class="op" id="7465152">:=</span>&nbsp;<span class="op" id="7465155">&amp;</span><span class="ident" id="7465156">bytes</span><span class="op" id="7465161">.</span><span class="ident" id="7465162">Buffer</span><span class="op" id="7465168">{</span><span class="op" id="7465169">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465172">b</span><span class="op" id="7465173">.</span><span class="ident" id="7465174">WriteString</span><span class="op" id="7465185">(</span><span class="ident" id="7465186">headerStr</span><span class="op" id="7465195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465198">b</span><span class="op" id="7465199">.</span><span class="ident" id="7465200">WriteString</span><span class="op" id="7465211">(</span><span class="ident" id="7465212">paletteStr</span><span class="op" id="7465222">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465225">for</span>&nbsp;<span class="ident" id="7465229">transparentIndex</span>&nbsp;<span class="op" id="7465246">:=</span>&nbsp;<span class="num" id="7465249">0</span><span class="op" id="7465250">;</span>&nbsp;<span class="ident" id="7465252">transparentIndex</span>&nbsp;<span class="op" id="7465269">&lt;</span>&nbsp;<span class="num" id="7465271">3</span><span class="op" id="7465272">;</span>&nbsp;<span class="ident" id="7465274">transparentIndex</span><span class="op" id="7465290">++</span>&nbsp;<span class="op" id="7465293">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465297">if</span>&nbsp;<span class="ident" id="7465300">transparentIndex</span>&nbsp;<span class="op" id="7465317">&lt;</span>&nbsp;<span class="num" id="7465319">2</span>&nbsp;<span class="op" id="7465321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7465326">//&nbsp;Write&nbsp;the&nbsp;graphic&nbsp;control&nbsp;for&nbsp;the&nbsp;transparent&nbsp;index.</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465385">b</span><span class="op" id="7465386">.</span><span class="ident" id="7465387">WriteString</span><span class="op" id="7465398">(</span><span class="string" id="7465399">&#34;\x21\xf9\x00\x01\x00\x00&#34;</span><span class="op" id="7465425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465430">b</span><span class="op" id="7465431">.</span><span class="ident" id="7465432">WriteByte</span><span class="op" id="7465441">(</span><span class="builtintype" id="7465442">byte</span><span class="op" id="7465446">(</span><span class="ident" id="7465447">transparentIndex</span><span class="op" id="7465463">)</span><span class="op" id="7465464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465469">b</span><span class="op" id="7465470">.</span><span class="ident" id="7465471">WriteByte</span><span class="op" id="7465480">(</span><span class="num" id="7465481">0</span><span class="op" id="7465482">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465486">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7465490">//&nbsp;Write&nbsp;an&nbsp;image&nbsp;with&nbsp;bounds&nbsp;2x1,&nbsp;as&nbsp;per&nbsp;TestDecode.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465546">b</span><span class="op" id="7465547">.</span><span class="ident" id="7465548">WriteString</span><span class="op" id="7465559">(</span><span class="string" id="7465560">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7465606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465610">enc</span>&nbsp;<span class="op" id="7465614">:=</span>&nbsp;<span class="ident" id="7465617">lzwEncode</span><span class="op" id="7465626">(</span><span class="num" id="7465627">2</span><span class="op" id="7465628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465632">if</span>&nbsp;<span class="builtinfunc" id="7465635">len</span><span class="op" id="7465638">(</span><span class="ident" id="7465639">enc</span><span class="op" id="7465642">)</span>&nbsp;<span class="op" id="7465644">&gt;</span>&nbsp;<span class="num" id="7465646">0xff</span>&nbsp;<span class="op" id="7465651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465656">t</span><span class="op" id="7465657">.</span><span class="ident" id="7465658">Fatalf</span><span class="op" id="7465664">(</span><span class="string" id="7465665">&#34;compressed&nbsp;length&nbsp;%d&nbsp;is&nbsp;too&nbsp;large&#34;</span><span class="op" id="7465700">,</span>&nbsp;<span class="builtinfunc" id="7465702">len</span><span class="op" id="7465705">(</span><span class="ident" id="7465706">enc</span><span class="op" id="7465709">)</span><span class="op" id="7465710">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465714">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465718">b</span><span class="op" id="7465719">.</span><span class="ident" id="7465720">WriteByte</span><span class="op" id="7465729">(</span><span class="builtintype" id="7465730">byte</span><span class="op" id="7465734">(</span><span class="builtinfunc" id="7465735">len</span><span class="op" id="7465738">(</span><span class="ident" id="7465739">enc</span><span class="op" id="7465742">)</span><span class="op" id="7465743">)</span><span class="op" id="7465744">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465748">b</span><span class="op" id="7465749">.</span><span class="ident" id="7465750">Write</span><span class="op" id="7465755">(</span><span class="ident" id="7465756">enc</span><span class="op" id="7465759">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465763">b</span><span class="op" id="7465764">.</span><span class="ident" id="7465765">WriteByte</span><span class="op" id="7465774">(</span><span class="num" id="7465775">0x00</span><span class="op" id="7465779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465782">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465785">b</span><span class="op" id="7465786">.</span><span class="ident" id="7465787">WriteString</span><span class="op" id="7465798">(</span><span class="ident" id="7465799">trailerStr</span><span class="op" id="7465809">)</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465813">g</span><span class="op" id="7465814">,</span>&nbsp;<span class="ident" id="7465816">err</span>&nbsp;<span class="op" id="7465820">:=</span>&nbsp;<span class="ident" id="7465823">DecodeAll</span><span class="op" id="7465832">(</span><span class="ident" id="7465833">b</span><span class="op" id="7465834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7465837">if</span>&nbsp;<span class="ident" id="7465840">err</span>&nbsp;<span class="op" id="7465844">!=</span>&nbsp;<span class="ident" id="7465847">nil</span>&nbsp;<span class="op" id="7465851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465855">t</span><span class="op" id="7465856">.</span><span class="ident" id="7465857">Fatalf</span><span class="op" id="7465863">(</span><span class="string" id="7465864">&#34;DecodeAll:&nbsp;%v&#34;</span><span class="op" id="7465879">,</span>&nbsp;<span class="ident" id="7465881">err</span><span class="op" id="7465884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7465887">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465890">c0</span>&nbsp;<span class="op" id="7465893">:=</span>&nbsp;<span class="ident" id="7465896">color</span><span class="op" id="7465901">.</span><span class="ident" id="7465902">RGBA</span><span class="op" id="7465906">{</span><span class="ident" id="7465907">paletteStr</span><span class="op" id="7465917">[</span><span class="num" id="7465918">0</span><span class="op" id="7465919">]</span><span class="op" id="7465920">,</span>&nbsp;<span class="ident" id="7465922">paletteStr</span><span class="op" id="7465932">[</span><span class="num" id="7465933">1</span><span class="op" id="7465934">]</span><span class="op" id="7465935">,</span>&nbsp;<span class="ident" id="7465937">paletteStr</span><span class="op" id="7465947">[</span><span class="num" id="7465948">2</span><span class="op" id="7465949">]</span><span class="op" id="7465950">,</span>&nbsp;<span class="num" id="7465952">0xff</span><span class="op" id="7465956">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7465959">c1</span>&nbsp;<span class="op" id="7465962">:=</span>&nbsp;<span class="ident" id="7465965">color</span><span class="op" id="7465970">.</span><span class="ident" id="7465971">RGBA</span><span class="op" id="7465975">{</span><span class="ident" id="7465976">paletteStr</span><span class="op" id="7465986">[</span><span class="num" id="7465987">3</span><span class="op" id="7465988">]</span><span class="op" id="7465989">,</span>&nbsp;<span class="ident" id="7465991">paletteStr</span><span class="op" id="7466001">[</span><span class="num" id="7466002">4</span><span class="op" id="7466003">]</span><span class="op" id="7466004">,</span>&nbsp;<span class="ident" id="7466006">paletteStr</span><span class="op" id="7466016">[</span><span class="num" id="7466017">5</span><span class="op" id="7466018">]</span><span class="op" id="7466019">,</span>&nbsp;<span class="num" id="7466021">0xff</span><span class="op" id="7466025">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466028">cz</span>&nbsp;<span class="op" id="7466031">:=</span>&nbsp;<span class="ident" id="7466034">color</span><span class="op" id="7466039">.</span><span class="ident" id="7466040">RGBA</span><span class="op" id="7466044">{</span><span class="op" id="7466045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466048">wants</span>&nbsp;<span class="op" id="7466054">:=</span>&nbsp;<span class="op" id="7466057">[</span><span class="op" id="7466058">]</span><span class="ident" id="7466059">color</span><span class="op" id="7466064">.</span><span class="ident" id="7466065">Palette</span><span class="op" id="7466072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466076">{</span><span class="ident" id="7466077">cz</span><span class="op" id="7466079">,</span>&nbsp;<span class="ident" id="7466081">c1</span><span class="op" id="7466083">}</span><span class="op" id="7466084">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466088">{</span><span class="ident" id="7466089">c0</span><span class="op" id="7466091">,</span>&nbsp;<span class="ident" id="7466093">cz</span><span class="op" id="7466095">}</span><span class="op" id="7466096">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466100">{</span><span class="ident" id="7466101">c0</span><span class="op" id="7466103">,</span>&nbsp;<span class="ident" id="7466105">c1</span><span class="op" id="7466107">}</span><span class="op" id="7466108">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7466114">if</span>&nbsp;<span class="builtinfunc" id="7466117">len</span><span class="op" id="7466120">(</span><span class="ident" id="7466121">g</span><span class="op" id="7466122">.</span><span class="ident" id="7466123">Image</span><span class="op" id="7466128">)</span>&nbsp;<span class="op" id="7466130">!=</span>&nbsp;<span class="builtinfunc" id="7466133">len</span><span class="op" id="7466136">(</span><span class="ident" id="7466137">wants</span><span class="op" id="7466142">)</span>&nbsp;<span class="op" id="7466144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466148">t</span><span class="op" id="7466149">.</span><span class="ident" id="7466150">Fatalf</span><span class="op" id="7466156">(</span><span class="string" id="7466157">&#34;got&nbsp;%d&nbsp;images,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7466181">,</span>&nbsp;<span class="builtinfunc" id="7466183">len</span><span class="op" id="7466186">(</span><span class="ident" id="7466187">g</span><span class="op" id="7466188">.</span><span class="ident" id="7466189">Image</span><span class="op" id="7466194">)</span><span class="op" id="7466195">,</span>&nbsp;<span class="builtinfunc" id="7466197">len</span><span class="op" id="7466200">(</span><span class="ident" id="7466201">wants</span><span class="op" id="7466206">)</span><span class="op" id="7466207">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7466213">for</span>&nbsp;<span class="ident" id="7466217">i</span><span class="op" id="7466218">,</span>&nbsp;<span class="ident" id="7466220">want</span>&nbsp;<span class="op" id="7466225">:=</span>&nbsp;<span class="keyword" id="7466228">range</span>&nbsp;<span class="ident" id="7466234">wants</span>&nbsp;<span class="op" id="7466240">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466244">got</span>&nbsp;<span class="op" id="7466248">:=</span>&nbsp;<span class="ident" id="7466251">g</span><span class="op" id="7466252">.</span><span class="ident" id="7466253">Image</span><span class="op" id="7466258">[</span><span class="ident" id="7466259">i</span><span class="op" id="7466260">]</span><span class="op" id="7466261">.</span><span class="ident" id="7466262">Palette</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7466272">if</span>&nbsp;<span class="op" id="7466275">!</span><span class="ident" id="7466276">reflect</span><span class="op" id="7466283">.</span><span class="ident" id="7466284">DeepEqual</span><span class="op" id="7466293">(</span><span class="ident" id="7466294">got</span><span class="op" id="7466297">,</span>&nbsp;<span class="ident" id="7466299">want</span><span class="op" id="7466303">)</span>&nbsp;<span class="op" id="7466305">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466310">t</span><span class="op" id="7466311">.</span><span class="ident" id="7466312">Errorf</span><span class="op" id="7466318">(</span><span class="string" id="7466319">&#34;palette&nbsp;#%d:\ngot&nbsp;&nbsp;%v\nwant&nbsp;%v&#34;</span><span class="op" id="7466351">,</span>&nbsp;<span class="ident" id="7466353">i</span><span class="op" id="7466354">,</span>&nbsp;<span class="ident" id="7466356">got</span><span class="op" id="7466359">,</span>&nbsp;<span class="ident" id="7466361">want</span><span class="op" id="7466365">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466369">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7466372">}</span><br>
<span class="lineno"></span><span class="op" id="7466374">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7466377">//&nbsp;testGIF&nbsp;is&nbsp;a&nbsp;simple&nbsp;GIF&nbsp;that&nbsp;we&nbsp;can&nbsp;modify&nbsp;to&nbsp;test&nbsp;different&nbsp;scenarios.</span><br>
<span class="lineno">140</span><span class="keyword" id="7466452">var</span>&nbsp;<span class="ident" id="7466456">testGIF</span>&nbsp;<span class="op" id="7466464">=</span>&nbsp;<span class="op" id="7466466">[</span><span class="op" id="7466467">]</span><span class="builtintype" id="7466468">byte</span><span class="op" id="7466472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7466475">&#39;G&#39;</span><span class="op" id="7466478">,</span>&nbsp;<span class="string" id="7466480">&#39;I&#39;</span><span class="op" id="7466483">,</span>&nbsp;<span class="string" id="7466485">&#39;F&#39;</span><span class="op" id="7466488">,</span>&nbsp;<span class="string" id="7466490">&#39;8&#39;</span><span class="op" id="7466493">,</span>&nbsp;<span class="string" id="7466495">&#39;9&#39;</span><span class="op" id="7466498">,</span>&nbsp;<span class="string" id="7466500">&#39;a&#39;</span><span class="op" id="7466503">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466506">1</span><span class="op" id="7466507">,</span>&nbsp;<span class="num" id="7466509">0</span><span class="op" id="7466510">,</span>&nbsp;<span class="num" id="7466512">1</span><span class="op" id="7466513">,</span>&nbsp;<span class="num" id="7466515">0</span><span class="op" id="7466516">,</span>&nbsp;<span class="comment" id="7466518">//&nbsp;w=1,&nbsp;h=1&nbsp;(6)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466535">128</span><span class="op" id="7466538">,</span>&nbsp;<span class="num" id="7466540">0</span><span class="op" id="7466541">,</span>&nbsp;<span class="num" id="7466543">0</span><span class="op" id="7466544">,</span>&nbsp;<span class="comment" id="7466546">//&nbsp;headerFields,&nbsp;bg,&nbsp;aspect&nbsp;(10)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466580">0</span><span class="op" id="7466581">,</span>&nbsp;<span class="num" id="7466583">0</span><span class="op" id="7466584">,</span>&nbsp;<span class="num" id="7466586">0</span><span class="op" id="7466587">,</span>&nbsp;<span class="num" id="7466589">1</span><span class="op" id="7466590">,</span>&nbsp;<span class="num" id="7466592">1</span><span class="op" id="7466593">,</span>&nbsp;<span class="num" id="7466595">1</span><span class="op" id="7466596">,</span>&nbsp;<span class="comment" id="7466598">//&nbsp;color&nbsp;map&nbsp;and&nbsp;graphics&nbsp;control&nbsp;(13)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466638">0x21</span><span class="op" id="7466642">,</span>&nbsp;<span class="num" id="7466644">0xf9</span><span class="op" id="7466648">,</span>&nbsp;<span class="num" id="7466650">0x04</span><span class="op" id="7466654">,</span>&nbsp;<span class="num" id="7466656">0x00</span><span class="op" id="7466660">,</span>&nbsp;<span class="num" id="7466662">0x00</span><span class="op" id="7466666">,</span>&nbsp;<span class="num" id="7466668">0x00</span><span class="op" id="7466672">,</span>&nbsp;<span class="num" id="7466674">0xff</span><span class="op" id="7466678">,</span>&nbsp;<span class="num" id="7466680">0x00</span><span class="op" id="7466684">,</span>&nbsp;<span class="comment" id="7466686">//&nbsp;(19)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7466695">//&nbsp;frame&nbsp;1&nbsp;(0,0&nbsp;-&nbsp;1,1)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466719">0x2c</span><span class="op" id="7466723">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466726">0x00</span><span class="op" id="7466730">,</span>&nbsp;<span class="num" id="7466732">0x00</span><span class="op" id="7466736">,</span>&nbsp;<span class="num" id="7466738">0x00</span><span class="op" id="7466742">,</span>&nbsp;<span class="num" id="7466744">0x00</span><span class="op" id="7466748">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466751">0x01</span><span class="op" id="7466755">,</span>&nbsp;<span class="num" id="7466757">0x00</span><span class="op" id="7466761">,</span>&nbsp;<span class="num" id="7466763">0x01</span><span class="op" id="7466767">,</span>&nbsp;<span class="num" id="7466769">0x00</span><span class="op" id="7466773">,</span>&nbsp;<span class="comment" id="7466775">//&nbsp;(32)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466784">0x00</span><span class="op" id="7466788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466791">0x02</span><span class="op" id="7466795">,</span>&nbsp;<span class="num" id="7466797">0x02</span><span class="op" id="7466801">,</span>&nbsp;<span class="num" id="7466803">0x4c</span><span class="op" id="7466807">,</span>&nbsp;<span class="num" id="7466809">0x01</span><span class="op" id="7466813">,</span>&nbsp;<span class="num" id="7466815">0x00</span><span class="op" id="7466819">,</span>&nbsp;<span class="comment" id="7466821">//&nbsp;lzw&nbsp;pixels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7466836">//&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="7466848">0x3b</span><span class="op" id="7466852">,</span><br>
<span class="lineno"></span><span class="op" id="7466854">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span><span class="keyword" id="7466857">func</span>&nbsp;<span class="ident" id="7466862">try</span><span class="op" id="7466865">(</span><span class="ident" id="7466866">t</span>&nbsp;<span class="op" id="7466868">*</span><span class="ident" id="7466869">testing</span><span class="op" id="7466876">.</span><span class="ident" id="7466877">T</span><span class="op" id="7466878">,</span>&nbsp;<span class="ident" id="7466880">b</span>&nbsp;<span class="op" id="7466882">[</span><span class="op" id="7466883">]</span><span class="builtintype" id="7466884">byte</span><span class="op" id="7466888">,</span>&nbsp;<span class="ident" id="7466890">want</span>&nbsp;<span class="builtintype" id="7466895">string</span><span class="op" id="7466901">)</span>&nbsp;<span class="op" id="7466903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466906">_</span><span class="op" id="7466907">,</span>&nbsp;<span class="ident" id="7466909">err</span>&nbsp;<span class="op" id="7466913">:=</span>&nbsp;<span class="ident" id="7466916">DecodeAll</span><span class="op" id="7466925">(</span><span class="ident" id="7466926">bytes</span><span class="op" id="7466931">.</span><span class="ident" id="7466932">NewReader</span><span class="op" id="7466941">(</span><span class="ident" id="7466942">b</span><span class="op" id="7466943">)</span><span class="op" id="7466944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7466947">var</span>&nbsp;<span class="ident" id="7466951">got</span>&nbsp;<span class="builtintype" id="7466955">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7466963">if</span>&nbsp;<span class="ident" id="7466966">err</span>&nbsp;<span class="op" id="7466970">!=</span>&nbsp;<span class="ident" id="7466973">nil</span>&nbsp;<span class="op" id="7466977">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7466981">got</span>&nbsp;<span class="op" id="7466985">=</span>&nbsp;<span class="ident" id="7466987">err</span><span class="op" id="7466990">.</span><span class="ident" id="7466991">Error</span><span class="op" id="7466996">(</span><span class="op" id="7466997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7467000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7467003">if</span>&nbsp;<span class="ident" id="7467006">got</span>&nbsp;<span class="op" id="7467010">!=</span>&nbsp;<span class="ident" id="7467013">want</span>&nbsp;<span class="op" id="7467018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467022">t</span><span class="op" id="7467023">.</span><span class="ident" id="7467024">Fatalf</span><span class="op" id="7467030">(</span><span class="string" id="7467031">&#34;got&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="7467048">,</span>&nbsp;<span class="ident" id="7467050">got</span><span class="op" id="7467053">,</span>&nbsp;<span class="ident" id="7467055">want</span><span class="op" id="7467059">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7467062">}</span><br>
<span class="lineno">165</span><span class="op" id="7467064">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7467067">func</span>&nbsp;<span class="ident" id="7467072">TestBounds</span><span class="op" id="7467082">(</span><span class="ident" id="7467083">t</span>&nbsp;<span class="op" id="7467085">*</span><span class="ident" id="7467086">testing</span><span class="op" id="7467093">.</span><span class="ident" id="7467094">T</span><span class="op" id="7467095">)</span>&nbsp;<span class="op" id="7467097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467100">//&nbsp;Make&nbsp;a&nbsp;local&nbsp;copy&nbsp;of&nbsp;testGIF.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467134">gif</span>&nbsp;<span class="op" id="7467138">:=</span>&nbsp;<span class="builtinfunc" id="7467141">make</span><span class="op" id="7467145">(</span><span class="op" id="7467146">[</span><span class="op" id="7467147">]</span><span class="builtintype" id="7467148">byte</span><span class="op" id="7467152">,</span>&nbsp;<span class="builtinfunc" id="7467154">len</span><span class="op" id="7467157">(</span><span class="ident" id="7467158">testGIF</span><span class="op" id="7467165">)</span><span class="op" id="7467166">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7467169">copy</span><span class="op" id="7467173">(</span><span class="ident" id="7467174">gif</span><span class="op" id="7467177">,</span>&nbsp;<span class="ident" id="7467179">testGIF</span><span class="op" id="7467186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467189">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;big,&nbsp;just&nbsp;by&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467231">gif</span><span class="op" id="7467234">[</span><span class="num" id="7467235">32</span><span class="op" id="7467237">]</span>&nbsp;<span class="op" id="7467239">=</span>&nbsp;<span class="num" id="7467241">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467244">want</span>&nbsp;<span class="op" id="7467249">:=</span>&nbsp;<span class="string" id="7467252">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467298">try</span><span class="op" id="7467301">(</span><span class="ident" id="7467302">t</span><span class="op" id="7467303">,</span>&nbsp;<span class="ident" id="7467305">gif</span><span class="op" id="7467308">,</span>&nbsp;<span class="ident" id="7467310">want</span><span class="op" id="7467314">)</span><br>
<span class="lineno">175</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467318">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;too&nbsp;small;&nbsp;does&nbsp;not&nbsp;trigger&nbsp;bounds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467373">//&nbsp;check,&nbsp;but&nbsp;now&nbsp;there&#39;s&nbsp;too&nbsp;much&nbsp;data.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467415">gif</span><span class="op" id="7467418">[</span><span class="num" id="7467419">32</span><span class="op" id="7467421">]</span>&nbsp;<span class="op" id="7467423">=</span>&nbsp;<span class="num" id="7467425">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467428">want</span>&nbsp;<span class="op" id="7467433">=</span>&nbsp;<span class="string" id="7467435">&#34;gif:&nbsp;too&nbsp;much&nbsp;image&nbsp;data&#34;</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467463">try</span><span class="op" id="7467466">(</span><span class="ident" id="7467467">t</span><span class="op" id="7467468">,</span>&nbsp;<span class="ident" id="7467470">gif</span><span class="op" id="7467473">,</span>&nbsp;<span class="ident" id="7467475">want</span><span class="op" id="7467479">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467482">gif</span><span class="op" id="7467485">[</span><span class="num" id="7467486">32</span><span class="op" id="7467488">]</span>&nbsp;<span class="op" id="7467490">=</span>&nbsp;<span class="num" id="7467492">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467496">//&nbsp;Make&nbsp;the&nbsp;bounds&nbsp;really&nbsp;big,&nbsp;expect&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467545">want</span>&nbsp;<span class="op" id="7467550">=</span>&nbsp;<span class="string" id="7467552">&#34;gif:&nbsp;frame&nbsp;bounds&nbsp;larger&nbsp;than&nbsp;image&nbsp;bounds&#34;</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7467598">for</span>&nbsp;<span class="ident" id="7467602">i</span>&nbsp;<span class="op" id="7467604">:=</span>&nbsp;<span class="num" id="7467607">0</span><span class="op" id="7467608">;</span>&nbsp;<span class="ident" id="7467610">i</span>&nbsp;<span class="op" id="7467612">&lt;</span>&nbsp;<span class="num" id="7467614">4</span><span class="op" id="7467615">;</span>&nbsp;<span class="ident" id="7467617">i</span><span class="op" id="7467618">++</span>&nbsp;<span class="op" id="7467621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467625">gif</span><span class="op" id="7467628">[</span><span class="num" id="7467629">32</span><span class="op" id="7467631">+</span><span class="ident" id="7467632">i</span><span class="op" id="7467633">]</span>&nbsp;<span class="op" id="7467635">=</span>&nbsp;<span class="num" id="7467637">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7467643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467646">try</span><span class="op" id="7467649">(</span><span class="ident" id="7467650">t</span><span class="op" id="7467651">,</span>&nbsp;<span class="ident" id="7467653">gif</span><span class="op" id="7467656">,</span>&nbsp;<span class="ident" id="7467658">want</span><span class="op" id="7467662">)</span><br>
<span class="lineno"></span><span class="op" id="7467664">}</span><br>
<span class="lineno">190</span><br>
<span class="lineno"></span><span class="keyword" id="7467667">func</span>&nbsp;<span class="ident" id="7467672">TestNoPalette</span><span class="op" id="7467685">(</span><span class="ident" id="7467686">t</span>&nbsp;<span class="op" id="7467688">*</span><span class="ident" id="7467689">testing</span><span class="op" id="7467696">.</span><span class="ident" id="7467697">T</span><span class="op" id="7467698">)</span>&nbsp;<span class="op" id="7467700">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467703">b</span>&nbsp;<span class="op" id="7467705">:=</span>&nbsp;<span class="op" id="7467708">&amp;</span><span class="ident" id="7467709">bytes</span><span class="op" id="7467714">.</span><span class="ident" id="7467715">Buffer</span><span class="op" id="7467721">{</span><span class="op" id="7467722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467726">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;no&nbsp;palette,&nbsp;so&nbsp;any&nbsp;pixel&nbsp;at&nbsp;all</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467785">//&nbsp;will&nbsp;be&nbsp;invalid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467806">b</span><span class="op" id="7467807">.</span><span class="ident" id="7467808">WriteString</span><span class="op" id="7467819">(</span><span class="ident" id="7467820">headerStr</span><span class="op" id="7467829">[</span><span class="op" id="7467830">:</span><span class="builtinfunc" id="7467831">len</span><span class="op" id="7467834">(</span><span class="ident" id="7467835">headerStr</span><span class="op" id="7467844">)</span><span class="op" id="7467845">-</span><span class="num" id="7467846">3</span><span class="op" id="7467847">]</span><span class="op" id="7467848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467851">b</span><span class="op" id="7467852">.</span><span class="ident" id="7467853">WriteString</span><span class="op" id="7467864">(</span><span class="string" id="7467865">&#34;\x00\x00\x00&#34;</span><span class="op" id="7467879">)</span>&nbsp;<span class="comment" id="7467881">//&nbsp;No&nbsp;global&nbsp;palette.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7467905">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7467950">b</span><span class="op" id="7467951">.</span><span class="ident" id="7467952">WriteString</span><span class="op" id="7467963">(</span><span class="string" id="7467964">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7468010">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7468014">//&nbsp;Encode&nbsp;the&nbsp;pixels:&nbsp;neither&nbsp;is&nbsp;in&nbsp;range,&nbsp;because&nbsp;there&nbsp;is&nbsp;no&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468087">pix</span>&nbsp;<span class="op" id="7468091">:=</span>&nbsp;<span class="op" id="7468094">[</span><span class="op" id="7468095">]</span><span class="builtintype" id="7468096">byte</span><span class="op" id="7468100">{</span><span class="num" id="7468101">0</span><span class="op" id="7468102">,</span>&nbsp;<span class="num" id="7468104">128</span><span class="op" id="7468107">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468110">enc</span>&nbsp;<span class="op" id="7468114">:=</span>&nbsp;<span class="op" id="7468117">&amp;</span><span class="ident" id="7468118">bytes</span><span class="op" id="7468123">.</span><span class="ident" id="7468124">Buffer</span><span class="op" id="7468130">{</span><span class="op" id="7468131">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468134">w</span>&nbsp;<span class="op" id="7468136">:=</span>&nbsp;<span class="ident" id="7468139">lzw</span><span class="op" id="7468142">.</span><span class="ident" id="7468143">NewWriter</span><span class="op" id="7468152">(</span><span class="ident" id="7468153">enc</span><span class="op" id="7468156">,</span>&nbsp;<span class="ident" id="7468158">lzw</span><span class="op" id="7468161">.</span><span class="ident" id="7468162">LSB</span><span class="op" id="7468165">,</span>&nbsp;<span class="num" id="7468167">2</span><span class="op" id="7468168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468171">w</span><span class="op" id="7468172">.</span><span class="ident" id="7468173">Write</span><span class="op" id="7468178">(</span><span class="ident" id="7468179">pix</span><span class="op" id="7468182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468185">w</span><span class="op" id="7468186">.</span><span class="ident" id="7468187">Close</span><span class="op" id="7468192">(</span><span class="op" id="7468193">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468196">b</span><span class="op" id="7468197">.</span><span class="ident" id="7468198">WriteByte</span><span class="op" id="7468207">(</span><span class="builtintype" id="7468208">byte</span><span class="op" id="7468212">(</span><span class="builtinfunc" id="7468213">len</span><span class="op" id="7468216">(</span><span class="ident" id="7468217">enc</span><span class="op" id="7468220">.</span><span class="ident" id="7468221">Bytes</span><span class="op" id="7468226">(</span><span class="op" id="7468227">)</span><span class="op" id="7468228">)</span><span class="op" id="7468229">)</span><span class="op" id="7468230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468233">b</span><span class="op" id="7468234">.</span><span class="ident" id="7468235">Write</span><span class="op" id="7468240">(</span><span class="ident" id="7468241">enc</span><span class="op" id="7468244">.</span><span class="ident" id="7468245">Bytes</span><span class="op" id="7468250">(</span><span class="op" id="7468251">)</span><span class="op" id="7468252">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468255">b</span><span class="op" id="7468256">.</span><span class="ident" id="7468257">WriteByte</span><span class="op" id="7468266">(</span><span class="num" id="7468267">0x00</span><span class="op" id="7468271">)</span>&nbsp;<span class="comment" id="7468273">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468330">b</span><span class="op" id="7468331">.</span><span class="ident" id="7468332">WriteString</span><span class="op" id="7468343">(</span><span class="ident" id="7468344">trailerStr</span><span class="op" id="7468354">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468358">try</span><span class="op" id="7468361">(</span><span class="ident" id="7468362">t</span><span class="op" id="7468363">,</span>&nbsp;<span class="ident" id="7468365">b</span><span class="op" id="7468366">.</span><span class="ident" id="7468367">Bytes</span><span class="op" id="7468372">(</span><span class="op" id="7468373">)</span><span class="op" id="7468374">,</span>&nbsp;<span class="string" id="7468376">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><span class="op" id="7468402">)</span><br>
<span class="lineno">215</span><span class="op" id="7468404">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7468407">func</span>&nbsp;<span class="ident" id="7468412">TestPixelOutsidePaletteRange</span><span class="op" id="7468440">(</span><span class="ident" id="7468441">t</span>&nbsp;<span class="op" id="7468443">*</span><span class="ident" id="7468444">testing</span><span class="op" id="7468451">.</span><span class="ident" id="7468452">T</span><span class="op" id="7468453">)</span>&nbsp;<span class="op" id="7468455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7468458">for</span>&nbsp;<span class="ident" id="7468462">_</span><span class="op" id="7468463">,</span>&nbsp;<span class="ident" id="7468465">pval</span>&nbsp;<span class="op" id="7468470">:=</span>&nbsp;<span class="keyword" id="7468473">range</span>&nbsp;<span class="op" id="7468479">[</span><span class="op" id="7468480">]</span><span class="builtintype" id="7468481">byte</span><span class="op" id="7468485">{</span><span class="num" id="7468486">0</span><span class="op" id="7468487">,</span>&nbsp;<span class="num" id="7468489">1</span><span class="op" id="7468490">,</span>&nbsp;<span class="num" id="7468492">2</span><span class="op" id="7468493">,</span>&nbsp;<span class="num" id="7468495">3</span><span class="op" id="7468496">,</span>&nbsp;<span class="num" id="7468498">255</span><span class="op" id="7468501">}</span>&nbsp;<span class="op" id="7468503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468507">b</span>&nbsp;<span class="op" id="7468509">:=</span>&nbsp;<span class="op" id="7468512">&amp;</span><span class="ident" id="7468513">bytes</span><span class="op" id="7468518">.</span><span class="ident" id="7468519">Buffer</span><span class="op" id="7468525">{</span><span class="op" id="7468526">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7468531">//&nbsp;Manufacture&nbsp;a&nbsp;GIF&nbsp;with&nbsp;a&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468578">b</span><span class="op" id="7468579">.</span><span class="ident" id="7468580">WriteString</span><span class="op" id="7468591">(</span><span class="ident" id="7468592">headerStr</span><span class="op" id="7468601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468605">b</span><span class="op" id="7468606">.</span><span class="ident" id="7468607">WriteString</span><span class="op" id="7468618">(</span><span class="ident" id="7468619">paletteStr</span><span class="op" id="7468629">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7468634">//&nbsp;Image&nbsp;descriptor:&nbsp;2x1,&nbsp;no&nbsp;local&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468680">b</span><span class="op" id="7468681">.</span><span class="ident" id="7468682">WriteString</span><span class="op" id="7468693">(</span><span class="string" id="7468694">&#34;\x2c\x00\x00\x00\x00\x02\x00\x01\x00\x00\x02&#34;</span><span class="op" id="7468740">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7468745">//&nbsp;Encode&nbsp;the&nbsp;pixels;&nbsp;some&nbsp;pvals&nbsp;trigger&nbsp;the&nbsp;expected&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468808">pix</span>&nbsp;<span class="op" id="7468812">:=</span>&nbsp;<span class="op" id="7468815">[</span><span class="op" id="7468816">]</span><span class="builtintype" id="7468817">byte</span><span class="op" id="7468821">{</span><span class="ident" id="7468822">pval</span><span class="op" id="7468826">,</span>&nbsp;<span class="ident" id="7468828">pval</span><span class="op" id="7468832">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468836">enc</span>&nbsp;<span class="op" id="7468840">:=</span>&nbsp;<span class="op" id="7468843">&amp;</span><span class="ident" id="7468844">bytes</span><span class="op" id="7468849">.</span><span class="ident" id="7468850">Buffer</span><span class="op" id="7468856">{</span><span class="op" id="7468857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468861">w</span>&nbsp;<span class="op" id="7468863">:=</span>&nbsp;<span class="ident" id="7468866">lzw</span><span class="op" id="7468869">.</span><span class="ident" id="7468870">NewWriter</span><span class="op" id="7468879">(</span><span class="ident" id="7468880">enc</span><span class="op" id="7468883">,</span>&nbsp;<span class="ident" id="7468885">lzw</span><span class="op" id="7468888">.</span><span class="ident" id="7468889">LSB</span><span class="op" id="7468892">,</span>&nbsp;<span class="num" id="7468894">2</span><span class="op" id="7468895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468899">w</span><span class="op" id="7468900">.</span><span class="ident" id="7468901">Write</span><span class="op" id="7468906">(</span><span class="ident" id="7468907">pix</span><span class="op" id="7468910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468914">w</span><span class="op" id="7468915">.</span><span class="ident" id="7468916">Close</span><span class="op" id="7468921">(</span><span class="op" id="7468922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468926">b</span><span class="op" id="7468927">.</span><span class="ident" id="7468928">WriteByte</span><span class="op" id="7468937">(</span><span class="builtintype" id="7468938">byte</span><span class="op" id="7468942">(</span><span class="builtinfunc" id="7468943">len</span><span class="op" id="7468946">(</span><span class="ident" id="7468947">enc</span><span class="op" id="7468950">.</span><span class="ident" id="7468951">Bytes</span><span class="op" id="7468956">(</span><span class="op" id="7468957">)</span><span class="op" id="7468958">)</span><span class="op" id="7468959">)</span><span class="op" id="7468960">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468964">b</span><span class="op" id="7468965">.</span><span class="ident" id="7468966">Write</span><span class="op" id="7468971">(</span><span class="ident" id="7468972">enc</span><span class="op" id="7468975">.</span><span class="ident" id="7468976">Bytes</span><span class="op" id="7468981">(</span><span class="op" id="7468982">)</span><span class="op" id="7468983">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7468987">b</span><span class="op" id="7468988">.</span><span class="ident" id="7468989">WriteByte</span><span class="op" id="7468998">(</span><span class="num" id="7468999">0x00</span><span class="op" id="7469003">)</span>&nbsp;<span class="comment" id="7469005">//&nbsp;An&nbsp;empty&nbsp;block&nbsp;signifies&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;image&nbsp;data.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469063">b</span><span class="op" id="7469064">.</span><span class="ident" id="7469065">WriteString</span><span class="op" id="7469076">(</span><span class="ident" id="7469077">trailerStr</span><span class="op" id="7469087">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7469092">//&nbsp;No&nbsp;error&nbsp;expected,&nbsp;unless&nbsp;the&nbsp;pixels&nbsp;are&nbsp;beyond&nbsp;the&nbsp;2&nbsp;color&nbsp;palette.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469166">want</span>&nbsp;<span class="op" id="7469171">:=</span>&nbsp;<span class="string" id="7469174">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7469179">if</span>&nbsp;<span class="ident" id="7469182">pval</span>&nbsp;<span class="op" id="7469187">&gt;=</span>&nbsp;<span class="num" id="7469190">2</span>&nbsp;<span class="op" id="7469192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469197">want</span>&nbsp;<span class="op" id="7469202">=</span>&nbsp;<span class="string" id="7469204">&#34;gif:&nbsp;invalid&nbsp;pixel&nbsp;value&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469233">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7469237">try</span><span class="op" id="7469240">(</span><span class="ident" id="7469241">t</span><span class="op" id="7469242">,</span>&nbsp;<span class="ident" id="7469244">b</span><span class="op" id="7469245">.</span><span class="ident" id="7469246">Bytes</span><span class="op" id="7469251">(</span><span class="op" id="7469252">)</span><span class="op" id="7469253">,</span>&nbsp;<span class="ident" id="7469255">want</span><span class="op" id="7469259">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7469262">}</span><br>
<span class="lineno"></span><span class="op" id="7469264">}</span>
</div>
</body>
</html>
