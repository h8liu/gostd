<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8679159">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8679214">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8679268">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8679319">package</span>&nbsp;<span class="ident" id="8679327">mime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8679333">import</span>&nbsp;<span class="op" id="8679340">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="8679343">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="8679353">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="8679356">var</span>&nbsp;<span class="ident" id="8679360">typeTests</span>&nbsp;<span class="op" id="8679370">=</span>&nbsp;<span class="ident" id="8679372">initMimeForTests</span><span class="op" id="8679388">(</span><span class="op" id="8679389">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8679392">func</span>&nbsp;<span class="ident" id="8679397">TestTypeByExtension</span><span class="op" id="8679416">(</span><span class="ident" id="8679417">t</span>&nbsp;<span class="op" id="8679419">*</span><span class="ident" id="8679420">testing</span><span class="op" id="8679427">.</span><span class="ident" id="8679428">T</span><span class="op" id="8679429">)</span>&nbsp;<span class="op" id="8679431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679434">for</span>&nbsp;<span class="ident" id="8679438">ext</span><span class="op" id="8679441">,</span>&nbsp;<span class="ident" id="8679443">want</span>&nbsp;<span class="op" id="8679448">:=</span>&nbsp;<span class="keyword" id="8679451">range</span>&nbsp;<span class="ident" id="8679457">typeTests</span>&nbsp;<span class="op" id="8679467">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8679471">val</span>&nbsp;<span class="op" id="8679475">:=</span>&nbsp;<span class="ident" id="8679478">TypeByExtension</span><span class="op" id="8679493">(</span><span class="ident" id="8679494">ext</span><span class="op" id="8679497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679501">if</span>&nbsp;<span class="ident" id="8679504">val</span>&nbsp;<span class="op" id="8679508">!=</span>&nbsp;<span class="ident" id="8679511">want</span>&nbsp;<span class="op" id="8679516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8679521">t</span><span class="op" id="8679522">.</span><span class="ident" id="8679523">Errorf</span><span class="op" id="8679529">(</span><span class="string" id="8679530">&#34;TypeByExtension(%q)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8679565">,</span>&nbsp;<span class="ident" id="8679567">ext</span><span class="op" id="8679570">,</span>&nbsp;<span class="ident" id="8679572">val</span><span class="op" id="8679575">,</span>&nbsp;<span class="ident" id="8679577">want</span><span class="op" id="8679581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8679585">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8679588">}</span><br>
<span class="lineno">20</span><span class="op" id="8679590">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8679593">func</span>&nbsp;<span class="ident" id="8679598">TestTypeByExtensionCase</span><span class="op" id="8679621">(</span><span class="ident" id="8679622">t</span>&nbsp;<span class="op" id="8679624">*</span><span class="ident" id="8679625">testing</span><span class="op" id="8679632">.</span><span class="ident" id="8679633">T</span><span class="op" id="8679634">)</span>&nbsp;<span class="op" id="8679636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679639">const</span>&nbsp;<span class="ident" id="8679645">custom</span>&nbsp;<span class="op" id="8679652">=</span>&nbsp;<span class="string" id="8679654">&#34;test/test;&nbsp;charset=iso-8859-1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679687">const</span>&nbsp;<span class="ident" id="8679693">caps</span>&nbsp;<span class="op" id="8679698">=</span>&nbsp;<span class="string" id="8679700">&#34;test/test;&nbsp;WAS=ALLCAPS&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679726">if</span>&nbsp;<span class="ident" id="8679729">err</span>&nbsp;<span class="op" id="8679733">:=</span>&nbsp;<span class="ident" id="8679736">AddExtensionType</span><span class="op" id="8679752">(</span><span class="string" id="8679753">&#34;.TEST&#34;</span><span class="op" id="8679760">,</span>&nbsp;<span class="ident" id="8679762">caps</span><span class="op" id="8679766">)</span><span class="op" id="8679767">;</span>&nbsp;<span class="ident" id="8679769">err</span>&nbsp;<span class="op" id="8679773">!=</span>&nbsp;<span class="ident" id="8679776">nil</span>&nbsp;<span class="op" id="8679780">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8679784">t</span><span class="op" id="8679785">.</span><span class="ident" id="8679786">Fatalf</span><span class="op" id="8679792">(</span><span class="string" id="8679793">&#34;error&nbsp;%s&nbsp;for&nbsp;AddExtension(%s)&#34;</span><span class="op" id="8679824">,</span>&nbsp;<span class="ident" id="8679826">err</span><span class="op" id="8679829">,</span>&nbsp;<span class="ident" id="8679831">custom</span><span class="op" id="8679837">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8679840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679843">if</span>&nbsp;<span class="ident" id="8679846">err</span>&nbsp;<span class="op" id="8679850">:=</span>&nbsp;<span class="ident" id="8679853">AddExtensionType</span><span class="op" id="8679869">(</span><span class="string" id="8679870">&#34;.tesT&#34;</span><span class="op" id="8679877">,</span>&nbsp;<span class="ident" id="8679879">custom</span><span class="op" id="8679885">)</span><span class="op" id="8679886">;</span>&nbsp;<span class="ident" id="8679888">err</span>&nbsp;<span class="op" id="8679892">!=</span>&nbsp;<span class="ident" id="8679895">nil</span>&nbsp;<span class="op" id="8679899">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8679903">t</span><span class="op" id="8679904">.</span><span class="ident" id="8679905">Fatalf</span><span class="op" id="8679911">(</span><span class="string" id="8679912">&#34;error&nbsp;%s&nbsp;for&nbsp;AddExtension(%s)&#34;</span><span class="op" id="8679943">,</span>&nbsp;<span class="ident" id="8679945">err</span><span class="op" id="8679948">,</span>&nbsp;<span class="ident" id="8679950">custom</span><span class="op" id="8679956">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8679959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8679963">//&nbsp;case-sensitive&nbsp;lookup</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8679989">if</span>&nbsp;<span class="ident" id="8679992">got</span>&nbsp;<span class="op" id="8679996">:=</span>&nbsp;<span class="ident" id="8679999">TypeByExtension</span><span class="op" id="8680014">(</span><span class="string" id="8680015">&#34;.tesT&#34;</span><span class="op" id="8680022">)</span><span class="op" id="8680023">;</span>&nbsp;<span class="ident" id="8680025">got</span>&nbsp;<span class="op" id="8680029">!=</span>&nbsp;<span class="ident" id="8680032">custom</span>&nbsp;<span class="op" id="8680039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680043">t</span><span class="op" id="8680044">.</span><span class="ident" id="8680045">Fatalf</span><span class="op" id="8680051">(</span><span class="string" id="8680052">&#34;for&nbsp;.tesT,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8680080">,</span>&nbsp;<span class="ident" id="8680082">got</span><span class="op" id="8680085">,</span>&nbsp;<span class="ident" id="8680087">custom</span><span class="op" id="8680093">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8680096">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8680099">if</span>&nbsp;<span class="ident" id="8680102">got</span>&nbsp;<span class="op" id="8680106">:=</span>&nbsp;<span class="ident" id="8680109">TypeByExtension</span><span class="op" id="8680124">(</span><span class="string" id="8680125">&#34;.TEST&#34;</span><span class="op" id="8680132">)</span><span class="op" id="8680133">;</span>&nbsp;<span class="ident" id="8680135">got</span>&nbsp;<span class="op" id="8680139">!=</span>&nbsp;<span class="ident" id="8680142">caps</span>&nbsp;<span class="op" id="8680147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680151">t</span><span class="op" id="8680152">.</span><span class="ident" id="8680153">Fatalf</span><span class="op" id="8680159">(</span><span class="string" id="8680160">&#34;for&nbsp;.TEST,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8680188">,</span>&nbsp;<span class="ident" id="8680190">got</span><span class="op" id="8680193">,</span>&nbsp;<span class="ident" id="8680195">caps</span><span class="op" id="8680199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8680202">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8680206">//&nbsp;case-insensitive</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8680227">if</span>&nbsp;<span class="ident" id="8680230">got</span>&nbsp;<span class="op" id="8680234">:=</span>&nbsp;<span class="ident" id="8680237">TypeByExtension</span><span class="op" id="8680252">(</span><span class="string" id="8680253">&#34;.TesT&#34;</span><span class="op" id="8680260">)</span><span class="op" id="8680261">;</span>&nbsp;<span class="ident" id="8680263">got</span>&nbsp;<span class="op" id="8680267">!=</span>&nbsp;<span class="ident" id="8680270">custom</span>&nbsp;<span class="op" id="8680277">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680281">t</span><span class="op" id="8680282">.</span><span class="ident" id="8680283">Fatalf</span><span class="op" id="8680289">(</span><span class="string" id="8680290">&#34;for&nbsp;.TesT,&nbsp;got&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8680318">,</span>&nbsp;<span class="ident" id="8680320">got</span><span class="op" id="8680323">,</span>&nbsp;<span class="ident" id="8680325">custom</span><span class="op" id="8680331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8680334">}</span><br>
<span class="lineno"></span><span class="op" id="8680336">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="keyword" id="8680339">func</span>&nbsp;<span class="ident" id="8680344">TestLookupMallocs</span><span class="op" id="8680361">(</span><span class="ident" id="8680362">t</span>&nbsp;<span class="op" id="8680364">*</span><span class="ident" id="8680365">testing</span><span class="op" id="8680372">.</span><span class="ident" id="8680373">T</span><span class="op" id="8680374">)</span>&nbsp;<span class="op" id="8680376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680379">n</span>&nbsp;<span class="op" id="8680381">:=</span>&nbsp;<span class="ident" id="8680384">testing</span><span class="op" id="8680391">.</span><span class="ident" id="8680392">AllocsPerRun</span><span class="op" id="8680404">(</span><span class="num" id="8680405">10000</span><span class="op" id="8680410">,</span>&nbsp;<span class="keyword" id="8680412">func</span><span class="op" id="8680416">(</span><span class="op" id="8680417">)</span>&nbsp;<span class="op" id="8680419">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680423">TypeByExtension</span><span class="op" id="8680438">(</span><span class="string" id="8680439">&#34;.html&#34;</span><span class="op" id="8680446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680450">TypeByExtension</span><span class="op" id="8680465">(</span><span class="string" id="8680466">&#34;.HtML&#34;</span><span class="op" id="8680473">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8680476">}</span><span class="op" id="8680477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8680480">if</span>&nbsp;<span class="ident" id="8680483">n</span>&nbsp;<span class="op" id="8680485">&gt;</span>&nbsp;<span class="num" id="8680487">0</span>&nbsp;<span class="op" id="8680489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8680493">t</span><span class="op" id="8680494">.</span><span class="ident" id="8680495">Errorf</span><span class="op" id="8680501">(</span><span class="string" id="8680502">&#34;allocs&nbsp;=&nbsp;%v;&nbsp;want&nbsp;0&#34;</span><span class="op" id="8680523">,</span>&nbsp;<span class="ident" id="8680525">n</span><span class="op" id="8680526">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8680529">}</span><br>
<span class="lineno"></span><span class="op" id="8680531">}</span>
</div>
</body>
</html>
