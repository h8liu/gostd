<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3621043">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3621098">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3621152">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="3621203">package</span>&nbsp;<span class="ident" id="3621211">multipart</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3621222">import</span>&nbsp;<span class="op" id="3621229">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621232">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621241">&#34;crypto/rand&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621256">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621266">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621273">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621279">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3621296">&#34;strings&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3621306">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621309">//&nbsp;A&nbsp;Writer&nbsp;generates&nbsp;multipart&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="3621351">type</span>&nbsp;<span class="ident" id="3621356">Writer</span>&nbsp;<span class="keyword" id="3621363">struct</span>&nbsp;<span class="op" id="3621370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621373">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3621382"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3621384">.</span><span class="ident" id="3621385">Writer</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621393">boundary</span>&nbsp;<span class="builtintype" id="3621402">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621410">lastpart</span>&nbsp;<span class="op" id="3621419">*</span><span class="ident" id="3621420"><a href="/mime/multipart/writer.go.html#3625332">part</a></span><br>
<span class="lineno"></span><span class="op" id="3621425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621428">//&nbsp;NewWriter&nbsp;returns&nbsp;a&nbsp;new&nbsp;multipart&nbsp;Writer&nbsp;with&nbsp;a&nbsp;random&nbsp;boundary,</span><br>
<span class="lineno">25</span><span class="comment" id="3621496">//&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="3621513">func</span>&nbsp;<span class="ident" id="3621518">NewWriter</span><span class="op" id="3621527">(</span><span class="ident" id="3621528">w</span>&nbsp;<span class="ident" id="3621530"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3621532">.</span><span class="ident" id="3621533">Writer</span><span class="op" id="3621539">)</span>&nbsp;<span class="op" id="3621541">*</span><span class="ident" id="3621542"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span>&nbsp;<span class="op" id="3621549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621552">return</span>&nbsp;<span class="op" id="3621559">&amp;</span><span class="ident" id="3621560"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3621566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621570">w</span><span class="op" id="3621571">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="3621580"><a href="/mime/multipart/writer.go.html#3621528">w</a></span><span class="op" id="3621581">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3621585">boundary</span><span class="op" id="3621593">:</span>&nbsp;<span class="ident" id="3621595"><a href="/mime/multipart/writer.go.html#3622777">randomBoundary</a></span><span class="op" id="3621609">(</span><span class="op" id="3621610">)</span><span class="op" id="3621611">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3621614">}</span><br>
<span class="lineno"></span><span class="op" id="3621616">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621619">//&nbsp;Boundary&nbsp;returns&nbsp;the&nbsp;Writer&#39;s&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3621662">func</span>&nbsp;<span class="op" id="3621667">(</span><span class="ident" id="3621668">w</span>&nbsp;<span class="op" id="3621670">*</span><span class="ident" id="3621671"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3621677">)</span>&nbsp;<span class="ident" id="3621679">Boundary</span><span class="op" id="3621687">(</span><span class="op" id="3621688">)</span>&nbsp;<span class="builtintype" id="3621690">string</span>&nbsp;<span class="op" id="3621697">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3621700">return</span>&nbsp;<span class="ident" id="3621707"><a href="/mime/multipart/writer.go.html#3621668">w</a></span><span class="op" id="3621708">.</span><span class="ident" id="3621709">boundary</span><br>
<span class="lineno"></span><span class="op" id="3621718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3621721">//&nbsp;SetBoundary&nbsp;overrides&nbsp;the&nbsp;Writer&#39;s&nbsp;default&nbsp;randomly-generated</span><br>
<span class="lineno"></span><span class="comment" id="3621786">//&nbsp;boundary&nbsp;separator&nbsp;with&nbsp;an&nbsp;explicit&nbsp;value.</span><br>
<span class="lineno">40</span><span class="comment" id="3621832">//</span><br>
<span class="lineno"></span><span class="comment" id="3621835">//&nbsp;SetBoundary&nbsp;must&nbsp;be&nbsp;called&nbsp;before&nbsp;any&nbsp;parts&nbsp;are&nbsp;created,&nbsp;may&nbsp;only</span><br>
<span class="lineno"></span><span class="comment" id="3621904">//&nbsp;contain&nbsp;certain&nbsp;ASCII&nbsp;characters,&nbsp;and&nbsp;must&nbsp;be&nbsp;1-69&nbsp;bytes&nbsp;long.</span><br>
<span class="lineno"></span><span class="keyword" id="3621970">func</span>&nbsp;<span class="op" id="3621975">(</span><span class="ident" id="3621976">w</span>&nbsp;<span class="op" id="3621978">*</span><span class="ident" id="3621979"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3621985">)</span>&nbsp;<span class="ident" id="3621987">SetBoundary</span><span class="op" id="3621998">(</span><span class="ident" id="3621999">boundary</span>&nbsp;<span class="builtintype" id="3622008">string</span><span class="op" id="3622014">)</span>&nbsp;<span class="builtintype" id="3622016">error</span>&nbsp;<span class="op" id="3622022">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622025">if</span>&nbsp;<span class="ident" id="3622028"><a href="/mime/multipart/writer.go.html#3621976">w</a></span><span class="op" id="3622029">.</span><span class="ident" id="3622030">lastpart</span>&nbsp;<span class="op" id="3622039">!=</span>&nbsp;<span class="ident" id="3622042">nil</span>&nbsp;<span class="op" id="3622046">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622050">return</span>&nbsp;<span class="ident" id="3622057"><a href="/mime/multipart/writer.go.html#3621256">errors</a></span><span class="op" id="3622063">.</span><span class="ident" id="3622064">New</span><span class="op" id="3622067">(</span><span class="string" id="3622068">&#34;mime:&nbsp;SetBoundary&nbsp;called&nbsp;after&nbsp;write&#34;</span><span class="op" id="3622106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622109">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3622112">//&nbsp;rfc2046#section-5.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622138">if</span>&nbsp;<span class="builtinfunc" id="3622141">len</span><span class="op" id="3622144">(</span><span class="ident" id="3622145"><a href="/mime/multipart/writer.go.html#3621999">boundary</a></span><span class="op" id="3622153">)</span>&nbsp;<span class="op" id="3622155">&lt;</span>&nbsp;<span class="num" id="3622157">1</span>&nbsp;<span class="op" id="3622159">||</span>&nbsp;<span class="builtinfunc" id="3622162">len</span><span class="op" id="3622165">(</span><span class="ident" id="3622166"><a href="/mime/multipart/writer.go.html#3621999">boundary</a></span><span class="op" id="3622174">)</span>&nbsp;<span class="op" id="3622176">&gt;</span>&nbsp;<span class="num" id="3622178">69</span>&nbsp;<span class="op" id="3622181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622185">return</span>&nbsp;<span class="ident" id="3622192"><a href="/mime/multipart/writer.go.html#3621256">errors</a></span><span class="op" id="3622198">.</span><span class="ident" id="3622199">New</span><span class="op" id="3622202">(</span><span class="string" id="3622203">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;length&#34;</span><span class="op" id="3622234">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622240">for</span>&nbsp;<span class="ident" id="3622244">_</span><span class="op" id="3622245">,</span>&nbsp;<span class="ident" id="3622247">b</span>&nbsp;<span class="op" id="3622249">:=</span>&nbsp;<span class="keyword" id="3622252">range</span>&nbsp;<span class="ident" id="3622258"><a href="/mime/multipart/writer.go.html#3621999">boundary</a></span>&nbsp;<span class="op" id="3622267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622271">if</span>&nbsp;<span class="string" id="3622274">&#39;A&#39;</span>&nbsp;<span class="op" id="3622278">&lt;=</span>&nbsp;<span class="ident" id="3622281"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622283">&amp;&amp;</span>&nbsp;<span class="ident" id="3622286"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622288">&lt;=</span>&nbsp;<span class="string" id="3622291">&#39;Z&#39;</span>&nbsp;<span class="op" id="3622295">||</span>&nbsp;<span class="string" id="3622298">&#39;a&#39;</span>&nbsp;<span class="op" id="3622302">&lt;=</span>&nbsp;<span class="ident" id="3622305"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622307">&amp;&amp;</span>&nbsp;<span class="ident" id="3622310"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622312">&lt;=</span>&nbsp;<span class="string" id="3622315">&#39;z&#39;</span>&nbsp;<span class="op" id="3622319">||</span>&nbsp;<span class="string" id="3622322">&#39;0&#39;</span>&nbsp;<span class="op" id="3622326">&lt;=</span>&nbsp;<span class="ident" id="3622329"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622331">&amp;&amp;</span>&nbsp;<span class="ident" id="3622334"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622336">&lt;=</span>&nbsp;<span class="string" id="3622339">&#39;9&#39;</span>&nbsp;<span class="op" id="3622343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622348">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622359">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622363">switch</span>&nbsp;<span class="ident" id="3622370"><a href="/mime/multipart/writer.go.html#3622247">b</a></span>&nbsp;<span class="op" id="3622372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622376">case</span>&nbsp;<span class="string" id="3622381">&#39;\&#39;&#39;</span><span class="op" id="3622385">,</span>&nbsp;<span class="string" id="3622387">&#39;(&#39;</span><span class="op" id="3622390">,</span>&nbsp;<span class="string" id="3622392">&#39;)&#39;</span><span class="op" id="3622395">,</span>&nbsp;<span class="string" id="3622397">&#39;+&#39;</span><span class="op" id="3622400">,</span>&nbsp;<span class="string" id="3622402">&#39;_&#39;</span><span class="op" id="3622405">,</span>&nbsp;<span class="string" id="3622407">&#39;,&#39;</span><span class="op" id="3622410">,</span>&nbsp;<span class="string" id="3622412">&#39;-&#39;</span><span class="op" id="3622415">,</span>&nbsp;<span class="string" id="3622417">&#39;.&#39;</span><span class="op" id="3622420">,</span>&nbsp;<span class="string" id="3622422">&#39;/&#39;</span><span class="op" id="3622425">,</span>&nbsp;<span class="string" id="3622427">&#39;:&#39;</span><span class="op" id="3622430">,</span>&nbsp;<span class="string" id="3622432">&#39;=&#39;</span><span class="op" id="3622435">,</span>&nbsp;<span class="string" id="3622437">&#39;?&#39;</span><span class="op" id="3622440">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622445">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622456">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622460">return</span>&nbsp;<span class="ident" id="3622467"><a href="/mime/multipart/writer.go.html#3621256">errors</a></span><span class="op" id="3622473">.</span><span class="ident" id="3622474">New</span><span class="op" id="3622477">(</span><span class="string" id="3622478">&#34;mime:&nbsp;invalid&nbsp;boundary&nbsp;character&#34;</span><span class="op" id="3622512">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622515">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622518"><a href="/mime/multipart/writer.go.html#3621976">w</a></span><span class="op" id="3622519">.</span><span class="ident" id="3622520">boundary</span>&nbsp;<span class="op" id="3622529">=</span>&nbsp;<span class="ident" id="3622531"><a href="/mime/multipart/writer.go.html#3621999">boundary</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622541">return</span>&nbsp;<span class="ident" id="3622548">nil</span><br>
<span class="lineno"></span><span class="op" id="3622552">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span><span class="comment" id="3622555">//&nbsp;FormDataContentType&nbsp;returns&nbsp;the&nbsp;Content-Type&nbsp;for&nbsp;an&nbsp;HTTP</span><br>
<span class="lineno"></span><span class="comment" id="3622615">//&nbsp;multipart/form-data&nbsp;with&nbsp;this&nbsp;Writer&#39;s&nbsp;Boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="3622667">func</span>&nbsp;<span class="op" id="3622672">(</span><span class="ident" id="3622673">w</span>&nbsp;<span class="op" id="3622675">*</span><span class="ident" id="3622676"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3622682">)</span>&nbsp;<span class="ident" id="3622684">FormDataContentType</span><span class="op" id="3622703">(</span><span class="op" id="3622704">)</span>&nbsp;<span class="builtintype" id="3622706">string</span>&nbsp;<span class="op" id="3622713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622716">return</span>&nbsp;<span class="string" id="3622723">&#34;multipart/form-data;&nbsp;boundary=&#34;</span>&nbsp;<span class="op" id="3622756">+</span>&nbsp;<span class="ident" id="3622758"><a href="/mime/multipart/writer.go.html#3622673">w</a></span><span class="op" id="3622759">.</span><span class="ident" id="3622760">boundary</span><br>
<span class="lineno"></span><span class="op" id="3622769">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="3622772">func</span>&nbsp;<span class="ident" id="3622777">randomBoundary</span><span class="op" id="3622791">(</span><span class="op" id="3622792">)</span>&nbsp;<span class="builtintype" id="3622794">string</span>&nbsp;<span class="op" id="3622801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622804">var</span>&nbsp;<span class="ident" id="3622808">buf</span>&nbsp;<span class="op" id="3622812">[</span><span class="num" id="3622813">30</span><span class="op" id="3622815">]</span><span class="builtintype" id="3622816">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3622822">_</span><span class="op" id="3622823">,</span>&nbsp;<span class="ident" id="3622825">err</span>&nbsp;<span class="op" id="3622829">:=</span>&nbsp;<span class="ident" id="3622832"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3622834">.</span><span class="ident" id="3622835">ReadFull</span><span class="op" id="3622843">(</span><span class="ident" id="3622844"><a href="/mime/multipart/writer.go.html#3621241">rand</a></span><span class="op" id="3622848">.</span><span class="ident" id="3622849">Reader</span><span class="op" id="3622855">,</span>&nbsp;<span class="ident" id="3622857"><a href="/mime/multipart/writer.go.html#3622808">buf</a></span><span class="op" id="3622860">[</span><span class="op" id="3622861">:</span><span class="op" id="3622862">]</span><span class="op" id="3622863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622866">if</span>&nbsp;<span class="ident" id="3622869"><a href="/mime/multipart/writer.go.html#3622825">err</a></span>&nbsp;<span class="op" id="3622873">!=</span>&nbsp;<span class="ident" id="3622876">nil</span>&nbsp;<span class="op" id="3622880">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3622884">panic</span><span class="op" id="3622889">(</span><span class="ident" id="3622890"><a href="/mime/multipart/writer.go.html#3622825">err</a></span><span class="op" id="3622893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3622896">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3622899">return</span>&nbsp;<span class="ident" id="3622906"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3622909">.</span><span class="ident" id="3622910">Sprintf</span><span class="op" id="3622917">(</span><span class="string" id="3622918">&#34;%x&#34;</span><span class="op" id="3622922">,</span>&nbsp;<span class="ident" id="3622924"><a href="/mime/multipart/writer.go.html#3622808">buf</a></span><span class="op" id="3622927">[</span><span class="op" id="3622928">:</span><span class="op" id="3622929">]</span><span class="op" id="3622930">)</span><br>
<span class="lineno"></span><span class="op" id="3622932">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span><span class="comment" id="3622935">//&nbsp;CreatePart&nbsp;creates&nbsp;a&nbsp;new&nbsp;multipart&nbsp;section&nbsp;with&nbsp;the&nbsp;provided</span><br>
<span class="lineno"></span><span class="comment" id="3622999">//&nbsp;header.&nbsp;The&nbsp;body&nbsp;of&nbsp;the&nbsp;part&nbsp;should&nbsp;be&nbsp;written&nbsp;to&nbsp;the&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="3623065">//&nbsp;Writer.&nbsp;After&nbsp;calling&nbsp;CreatePart,&nbsp;any&nbsp;previous&nbsp;part&nbsp;may&nbsp;no&nbsp;longer</span><br>
<span class="lineno"></span><span class="comment" id="3623134">//&nbsp;be&nbsp;written&nbsp;to.</span><br>
<span class="lineno"></span><span class="keyword" id="3623152">func</span>&nbsp;<span class="op" id="3623157">(</span><span class="ident" id="3623158">w</span>&nbsp;<span class="op" id="3623160">*</span><span class="ident" id="3623161"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3623167">)</span>&nbsp;<span class="ident" id="3623169">CreatePart</span><span class="op" id="3623179">(</span><span class="ident" id="3623180">header</span>&nbsp;<span class="ident" id="3623187"><a href="/mime/multipart/writer.go.html#3621279">textproto</a></span><span class="op" id="3623196">.</span><span class="ident" id="3623197">MIMEHeader</span><span class="op" id="3623207">)</span>&nbsp;<span class="op" id="3623209">(</span><span class="ident" id="3623210"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3623212">.</span><span class="ident" id="3623213">Writer</span><span class="op" id="3623219">,</span>&nbsp;<span class="builtintype" id="3623221">error</span><span class="op" id="3623226">)</span>&nbsp;<span class="op" id="3623228">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623231">if</span>&nbsp;<span class="ident" id="3623234"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623235">.</span><span class="ident" id="3623236">lastpart</span>&nbsp;<span class="op" id="3623245">!=</span>&nbsp;<span class="ident" id="3623248">nil</span>&nbsp;<span class="op" id="3623252">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623256">if</span>&nbsp;<span class="ident" id="3623259">err</span>&nbsp;<span class="op" id="3623263">:=</span>&nbsp;<span class="ident" id="3623266"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623267">.</span><span class="ident" id="3623268">lastpart</span><span class="op" id="3623276">.</span><span class="builtinfunc" id="3623277">close</span><span class="op" id="3623282">(</span><span class="op" id="3623283">)</span><span class="op" id="3623284">;</span>&nbsp;<span class="ident" id="3623286"><a href="/mime/multipart/writer.go.html#3623259">err</a></span>&nbsp;<span class="op" id="3623290">!=</span>&nbsp;<span class="ident" id="3623293">nil</span>&nbsp;<span class="op" id="3623297">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623302">return</span>&nbsp;<span class="ident" id="3623309">nil</span><span class="op" id="3623312">,</span>&nbsp;<span class="ident" id="3623314"><a href="/mime/multipart/writer.go.html#3623259">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623320">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623323">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623326">var</span>&nbsp;<span class="ident" id="3623330">b</span>&nbsp;<span class="ident" id="3623332"><a href="/mime/multipart/writer.go.html#3621232">bytes</a></span><span class="op" id="3623337">.</span><span class="ident" id="3623338">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623346">if</span>&nbsp;<span class="ident" id="3623349"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623350">.</span><span class="ident" id="3623351">lastpart</span>&nbsp;<span class="op" id="3623360">!=</span>&nbsp;<span class="ident" id="3623363">nil</span>&nbsp;<span class="op" id="3623367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623371"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3623374">.</span><span class="ident" id="3623375">Fprintf</span><span class="op" id="3623382">(</span><span class="op" id="3623383">&amp;</span><span class="ident" id="3623384"><a href="/mime/multipart/writer.go.html#3623330">b</a></span><span class="op" id="3623385">,</span>&nbsp;<span class="string" id="3623387">&#34;\r\n--%s\r\n&#34;</span><span class="op" id="3623401">,</span>&nbsp;<span class="ident" id="3623403"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623404">.</span><span class="ident" id="3623405">boundary</span><span class="op" id="3623413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623416">}</span>&nbsp;<span class="keyword" id="3623418">else</span>&nbsp;<span class="op" id="3623423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623427"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3623430">.</span><span class="ident" id="3623431">Fprintf</span><span class="op" id="3623438">(</span><span class="op" id="3623439">&amp;</span><span class="ident" id="3623440"><a href="/mime/multipart/writer.go.html#3623330">b</a></span><span class="op" id="3623441">,</span>&nbsp;<span class="string" id="3623443">&#34;--%s\r\n&#34;</span><span class="op" id="3623453">,</span>&nbsp;<span class="ident" id="3623455"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623456">.</span><span class="ident" id="3623457">boundary</span><span class="op" id="3623465">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623471">//&nbsp;TODO(bradfitz):&nbsp;move&nbsp;this&nbsp;to&nbsp;textproto.MimeHeader.Write(w),&nbsp;have&nbsp;it&nbsp;sort</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3623548">//&nbsp;and&nbsp;clean,&nbsp;like&nbsp;http.Header.Write(w)&nbsp;does.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623595">for</span>&nbsp;<span class="ident" id="3623599">k</span><span class="op" id="3623600">,</span>&nbsp;<span class="ident" id="3623602">vv</span>&nbsp;<span class="op" id="3623605">:=</span>&nbsp;<span class="keyword" id="3623608">range</span>&nbsp;<span class="ident" id="3623614"><a href="/mime/multipart/writer.go.html#3623180">header</a></span>&nbsp;<span class="op" id="3623621">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623625">for</span>&nbsp;<span class="ident" id="3623629">_</span><span class="op" id="3623630">,</span>&nbsp;<span class="ident" id="3623632">v</span>&nbsp;<span class="op" id="3623634">:=</span>&nbsp;<span class="keyword" id="3623637">range</span>&nbsp;<span class="ident" id="3623643"><a href="/mime/multipart/writer.go.html#3623602">vv</a></span>&nbsp;<span class="op" id="3623646">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623651"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3623654">.</span><span class="ident" id="3623655">Fprintf</span><span class="op" id="3623662">(</span><span class="op" id="3623663">&amp;</span><span class="ident" id="3623664"><a href="/mime/multipart/writer.go.html#3623330">b</a></span><span class="op" id="3623665">,</span>&nbsp;<span class="string" id="3623667">&#34;%s:&nbsp;%s\r\n&#34;</span><span class="op" id="3623679">,</span>&nbsp;<span class="ident" id="3623681"><a href="/mime/multipart/writer.go.html#3623599">k</a></span><span class="op" id="3623682">,</span>&nbsp;<span class="ident" id="3623684"><a href="/mime/multipart/writer.go.html#3623632">v</a></span><span class="op" id="3623685">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623692">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623695"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3623698">.</span><span class="ident" id="3623699">Fprintf</span><span class="op" id="3623706">(</span><span class="op" id="3623707">&amp;</span><span class="ident" id="3623708"><a href="/mime/multipart/writer.go.html#3623330">b</a></span><span class="op" id="3623709">,</span>&nbsp;<span class="string" id="3623711">&#34;\r\n&#34;</span><span class="op" id="3623717">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623720">_</span><span class="op" id="3623721">,</span>&nbsp;<span class="ident" id="3623723">err</span>&nbsp;<span class="op" id="3623727">:=</span>&nbsp;<span class="ident" id="3623730"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3623732">.</span><span class="ident" id="3623733">Copy</span><span class="op" id="3623737">(</span><span class="ident" id="3623738"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623739">.</span><span class="ident" id="3623740">w</span><span class="op" id="3623741">,</span>&nbsp;<span class="op" id="3623743">&amp;</span><span class="ident" id="3623744"><a href="/mime/multipart/writer.go.html#3623330">b</a></span><span class="op" id="3623745">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623748">if</span>&nbsp;<span class="ident" id="3623751"><a href="/mime/multipart/writer.go.html#3623723">err</a></span>&nbsp;<span class="op" id="3623755">!=</span>&nbsp;<span class="ident" id="3623758">nil</span>&nbsp;<span class="op" id="3623762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623766">return</span>&nbsp;<span class="ident" id="3623773">nil</span><span class="op" id="3623776">,</span>&nbsp;<span class="ident" id="3623778"><a href="/mime/multipart/writer.go.html#3623723">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623786">p</span>&nbsp;<span class="op" id="3623788">:=</span>&nbsp;<span class="op" id="3623791">&amp;</span><span class="ident" id="3623792"><a href="/mime/multipart/writer.go.html#3625332">part</a></span><span class="op" id="3623796">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623800">mw</span><span class="op" id="3623802">:</span>&nbsp;<span class="ident" id="3623804"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623805">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3623808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3623811"><a href="/mime/multipart/writer.go.html#3623158">w</a></span><span class="op" id="3623812">.</span><span class="ident" id="3623813">lastpart</span>&nbsp;<span class="op" id="3623822">=</span>&nbsp;<span class="ident" id="3623824"><a href="/mime/multipart/writer.go.html#3623786">p</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623827">return</span>&nbsp;<span class="ident" id="3623834"><a href="/mime/multipart/writer.go.html#3623786">p</a></span><span class="op" id="3623835">,</span>&nbsp;<span class="ident" id="3623837">nil</span><br>
<span class="lineno"></span><span class="op" id="3623841">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="keyword" id="3623844">var</span>&nbsp;<span class="ident" id="3623848">quoteEscaper</span>&nbsp;<span class="op" id="3623861">=</span>&nbsp;<span class="ident" id="3623863"><a href="/mime/multipart/writer.go.html#3621296">strings</a></span><span class="op" id="3623870">.</span><span class="ident" id="3623871">NewReplacer</span><span class="op" id="3623882">(</span><span class="string" id="3623883">&#34;\\&#34;</span><span class="op" id="3623887">,</span>&nbsp;<span class="string" id="3623889">&#34;\\\\&#34;</span><span class="op" id="3623895">,</span>&nbsp;<span class="string" id="3623897">`&#34;`</span><span class="op" id="3623900">,</span>&nbsp;<span class="string" id="3623902">&#34;\\\&#34;&#34;</span><span class="op" id="3623908">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3623911">func</span>&nbsp;<span class="ident" id="3623916">escapeQuotes</span><span class="op" id="3623928">(</span><span class="ident" id="3623929">s</span>&nbsp;<span class="builtintype" id="3623931">string</span><span class="op" id="3623937">)</span>&nbsp;<span class="builtintype" id="3623939">string</span>&nbsp;<span class="op" id="3623946">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3623949">return</span>&nbsp;<span class="ident" id="3623956"><a href="/mime/multipart/writer.go.html#3623848">quoteEscaper</a></span><span class="op" id="3623968">.</span><span class="ident" id="3623969">Replace</span><span class="op" id="3623976">(</span><span class="ident" id="3623977"><a href="/mime/multipart/writer.go.html#3623929">s</a></span><span class="op" id="3623978">)</span><br>
<span class="lineno"></span><span class="op" id="3623980">}</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span><span class="comment" id="3623983">//&nbsp;CreateFormFile&nbsp;is&nbsp;a&nbsp;convenience&nbsp;wrapper&nbsp;around&nbsp;CreatePart.&nbsp;It&nbsp;creates</span><br>
<span class="lineno"></span><span class="comment" id="3624056">//&nbsp;a&nbsp;new&nbsp;form-data&nbsp;header&nbsp;with&nbsp;the&nbsp;provided&nbsp;field&nbsp;name&nbsp;and&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3624126">func</span>&nbsp;<span class="op" id="3624131">(</span><span class="ident" id="3624132">w</span>&nbsp;<span class="op" id="3624134">*</span><span class="ident" id="3624135"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3624141">)</span>&nbsp;<span class="ident" id="3624143">CreateFormFile</span><span class="op" id="3624157">(</span><span class="ident" id="3624158">fieldname</span><span class="op" id="3624167">,</span>&nbsp;<span class="ident" id="3624169">filename</span>&nbsp;<span class="builtintype" id="3624178">string</span><span class="op" id="3624184">)</span>&nbsp;<span class="op" id="3624186">(</span><span class="ident" id="3624187"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3624189">.</span><span class="ident" id="3624190">Writer</span><span class="op" id="3624196">,</span>&nbsp;<span class="builtintype" id="3624198">error</span><span class="op" id="3624203">)</span>&nbsp;<span class="op" id="3624205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624208">h</span>&nbsp;<span class="op" id="3624210">:=</span>&nbsp;<span class="builtinfunc" id="3624213">make</span><span class="op" id="3624217">(</span><span class="ident" id="3624218"><a href="/mime/multipart/writer.go.html#3621279">textproto</a></span><span class="op" id="3624227">.</span><span class="ident" id="3624228">MIMEHeader</span><span class="op" id="3624238">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624241"><a href="/mime/multipart/writer.go.html#3624208">h</a></span><span class="op" id="3624242">.</span><span class="ident" id="3624243">Set</span><span class="op" id="3624246">(</span><span class="string" id="3624247">&#34;Content-Disposition&#34;</span><span class="op" id="3624268">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624272"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3624275">.</span><span class="ident" id="3624276">Sprintf</span><span class="op" id="3624283">(</span><span class="string" id="3624284">`form-data;&nbsp;name=&#34;%s&#34;;&nbsp;filename=&#34;%s&#34;`</span><span class="op" id="3624321">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624326"><a href="/mime/multipart/writer.go.html#3623916">escapeQuotes</a></span><span class="op" id="3624338">(</span><span class="ident" id="3624339"><a href="/mime/multipart/writer.go.html#3624158">fieldname</a></span><span class="op" id="3624348">)</span><span class="op" id="3624349">,</span>&nbsp;<span class="ident" id="3624351"><a href="/mime/multipart/writer.go.html#3623916">escapeQuotes</a></span><span class="op" id="3624363">(</span><span class="ident" id="3624364"><a href="/mime/multipart/writer.go.html#3624169">filename</a></span><span class="op" id="3624372">)</span><span class="op" id="3624373">)</span><span class="op" id="3624374">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624377"><a href="/mime/multipart/writer.go.html#3624208">h</a></span><span class="op" id="3624378">.</span><span class="ident" id="3624379">Set</span><span class="op" id="3624382">(</span><span class="string" id="3624383">&#34;Content-Type&#34;</span><span class="op" id="3624397">,</span>&nbsp;<span class="string" id="3624399">&#34;application/octet-stream&#34;</span><span class="op" id="3624425">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624428">return</span>&nbsp;<span class="ident" id="3624435"><a href="/mime/multipart/writer.go.html#3624132">w</a></span><span class="op" id="3624436">.</span><span class="ident" id="3624437">CreatePart</span><span class="op" id="3624447">(</span><span class="ident" id="3624448"><a href="/mime/multipart/writer.go.html#3624208">h</a></span><span class="op" id="3624449">)</span><br>
<span class="lineno">130</span><span class="op" id="3624451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3624454">//&nbsp;CreateFormField&nbsp;calls&nbsp;CreatePart&nbsp;with&nbsp;a&nbsp;header&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="3624514">//&nbsp;given&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span><span class="keyword" id="3624535">func</span>&nbsp;<span class="op" id="3624540">(</span><span class="ident" id="3624541">w</span>&nbsp;<span class="op" id="3624543">*</span><span class="ident" id="3624544"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3624550">)</span>&nbsp;<span class="ident" id="3624552">CreateFormField</span><span class="op" id="3624567">(</span><span class="ident" id="3624568">fieldname</span>&nbsp;<span class="builtintype" id="3624578">string</span><span class="op" id="3624584">)</span>&nbsp;<span class="op" id="3624586">(</span><span class="ident" id="3624587"><a href="/mime/multipart/writer.go.html#3621273">io</a></span><span class="op" id="3624589">.</span><span class="ident" id="3624590">Writer</span><span class="op" id="3624596">,</span>&nbsp;<span class="builtintype" id="3624598">error</span><span class="op" id="3624603">)</span>&nbsp;<span class="op" id="3624605">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624608">h</span>&nbsp;<span class="op" id="3624610">:=</span>&nbsp;<span class="builtinfunc" id="3624613">make</span><span class="op" id="3624617">(</span><span class="ident" id="3624618"><a href="/mime/multipart/writer.go.html#3621279">textproto</a></span><span class="op" id="3624627">.</span><span class="ident" id="3624628">MIMEHeader</span><span class="op" id="3624638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624641"><a href="/mime/multipart/writer.go.html#3624608">h</a></span><span class="op" id="3624642">.</span><span class="ident" id="3624643">Set</span><span class="op" id="3624646">(</span><span class="string" id="3624647">&#34;Content-Disposition&#34;</span><span class="op" id="3624668">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624672"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3624675">.</span><span class="ident" id="3624676">Sprintf</span><span class="op" id="3624683">(</span><span class="string" id="3624684">`form-data;&nbsp;name=&#34;%s&#34;`</span><span class="op" id="3624706">,</span>&nbsp;<span class="ident" id="3624708"><a href="/mime/multipart/writer.go.html#3623916">escapeQuotes</a></span><span class="op" id="3624720">(</span><span class="ident" id="3624721"><a href="/mime/multipart/writer.go.html#3624568">fieldname</a></span><span class="op" id="3624730">)</span><span class="op" id="3624731">)</span><span class="op" id="3624732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624735">return</span>&nbsp;<span class="ident" id="3624742"><a href="/mime/multipart/writer.go.html#3624541">w</a></span><span class="op" id="3624743">.</span><span class="ident" id="3624744">CreatePart</span><span class="op" id="3624754">(</span><span class="ident" id="3624755"><a href="/mime/multipart/writer.go.html#3624608">h</a></span><span class="op" id="3624756">)</span><br>
<span class="lineno"></span><span class="op" id="3624758">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="comment" id="3624761">//&nbsp;WriteField&nbsp;calls&nbsp;CreateFormField&nbsp;and&nbsp;then&nbsp;writes&nbsp;the&nbsp;given&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="3624830">func</span>&nbsp;<span class="op" id="3624835">(</span><span class="ident" id="3624836">w</span>&nbsp;<span class="op" id="3624838">*</span><span class="ident" id="3624839"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3624845">)</span>&nbsp;<span class="ident" id="3624847">WriteField</span><span class="op" id="3624857">(</span><span class="ident" id="3624858">fieldname</span><span class="op" id="3624867">,</span>&nbsp;<span class="ident" id="3624869">value</span>&nbsp;<span class="builtintype" id="3624875">string</span><span class="op" id="3624881">)</span>&nbsp;<span class="builtintype" id="3624883">error</span>&nbsp;<span class="op" id="3624889">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624892">p</span><span class="op" id="3624893">,</span>&nbsp;<span class="ident" id="3624895">err</span>&nbsp;<span class="op" id="3624899">:=</span>&nbsp;<span class="ident" id="3624902"><a href="/mime/multipart/writer.go.html#3624836">w</a></span><span class="op" id="3624903">.</span><span class="ident" id="3624904">CreateFormField</span><span class="op" id="3624919">(</span><span class="ident" id="3624920"><a href="/mime/multipart/writer.go.html#3624858">fieldname</a></span><span class="op" id="3624929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624932">if</span>&nbsp;<span class="ident" id="3624935"><a href="/mime/multipart/writer.go.html#3624895">err</a></span>&nbsp;<span class="op" id="3624939">!=</span>&nbsp;<span class="ident" id="3624942">nil</span>&nbsp;<span class="op" id="3624946">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624950">return</span>&nbsp;<span class="ident" id="3624957"><a href="/mime/multipart/writer.go.html#3624895">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3624962">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3624965">_</span><span class="op" id="3624966">,</span>&nbsp;<span class="ident" id="3624968"><a href="/mime/multipart/writer.go.html#3624895">err</a></span>&nbsp;<span class="op" id="3624972">=</span>&nbsp;<span class="ident" id="3624974"><a href="/mime/multipart/writer.go.html#3624892">p</a></span><span class="op" id="3624975">.</span><span class="ident" id="3624976">Write</span><span class="op" id="3624981">(</span><span class="op" id="3624982">[</span><span class="op" id="3624983">]</span><span class="builtintype" id="3624984">byte</span><span class="op" id="3624988">(</span><span class="ident" id="3624989"><a href="/mime/multipart/writer.go.html#3624869">value</a></span><span class="op" id="3624994">)</span><span class="op" id="3624995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3624998">return</span>&nbsp;<span class="ident" id="3625005"><a href="/mime/multipart/writer.go.html#3624895">err</a></span><br>
<span class="lineno"></span><span class="op" id="3625009">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span><span class="comment" id="3625012">//&nbsp;Close&nbsp;finishes&nbsp;the&nbsp;multipart&nbsp;message&nbsp;and&nbsp;writes&nbsp;the&nbsp;trailing</span><br>
<span class="lineno"></span><span class="comment" id="3625076">//&nbsp;boundary&nbsp;end&nbsp;line&nbsp;to&nbsp;the&nbsp;output.</span><br>
<span class="lineno"></span><span class="keyword" id="3625112">func</span>&nbsp;<span class="op" id="3625117">(</span><span class="ident" id="3625118">w</span>&nbsp;<span class="op" id="3625120">*</span><span class="ident" id="3625121"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><span class="op" id="3625127">)</span>&nbsp;<span class="ident" id="3625129">Close</span><span class="op" id="3625134">(</span><span class="op" id="3625135">)</span>&nbsp;<span class="builtintype" id="3625137">error</span>&nbsp;<span class="op" id="3625143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625146">if</span>&nbsp;<span class="ident" id="3625149"><a href="/mime/multipart/writer.go.html#3625118">w</a></span><span class="op" id="3625150">.</span><span class="ident" id="3625151">lastpart</span>&nbsp;<span class="op" id="3625160">!=</span>&nbsp;<span class="ident" id="3625163">nil</span>&nbsp;<span class="op" id="3625167">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625171">if</span>&nbsp;<span class="ident" id="3625174">err</span>&nbsp;<span class="op" id="3625178">:=</span>&nbsp;<span class="ident" id="3625181"><a href="/mime/multipart/writer.go.html#3625118">w</a></span><span class="op" id="3625182">.</span><span class="ident" id="3625183">lastpart</span><span class="op" id="3625191">.</span><span class="builtinfunc" id="3625192">close</span><span class="op" id="3625197">(</span><span class="op" id="3625198">)</span><span class="op" id="3625199">;</span>&nbsp;<span class="ident" id="3625201"><a href="/mime/multipart/writer.go.html#3625174">err</a></span>&nbsp;<span class="op" id="3625205">!=</span>&nbsp;<span class="ident" id="3625208">nil</span>&nbsp;<span class="op" id="3625212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625217">return</span>&nbsp;<span class="ident" id="3625224"><a href="/mime/multipart/writer.go.html#3625174">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625230">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625234"><a href="/mime/multipart/writer.go.html#3625118">w</a></span><span class="op" id="3625235">.</span><span class="ident" id="3625236">lastpart</span>&nbsp;<span class="op" id="3625245">=</span>&nbsp;<span class="ident" id="3625247">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625252">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625255">_</span><span class="op" id="3625256">,</span>&nbsp;<span class="ident" id="3625258">err</span>&nbsp;<span class="op" id="3625262">:=</span>&nbsp;<span class="ident" id="3625265"><a href="/mime/multipart/writer.go.html#3621266">fmt</a></span><span class="op" id="3625268">.</span><span class="ident" id="3625269">Fprintf</span><span class="op" id="3625276">(</span><span class="ident" id="3625277"><a href="/mime/multipart/writer.go.html#3625118">w</a></span><span class="op" id="3625278">.</span><span class="ident" id="3625279">w</span><span class="op" id="3625280">,</span>&nbsp;<span class="string" id="3625282">&#34;\r\n--%s--\r\n&#34;</span><span class="op" id="3625298">,</span>&nbsp;<span class="ident" id="3625300"><a href="/mime/multipart/writer.go.html#3625118">w</a></span><span class="op" id="3625301">.</span><span class="ident" id="3625302">boundary</span><span class="op" id="3625310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625313">return</span>&nbsp;<span class="ident" id="3625320"><a href="/mime/multipart/writer.go.html#3625258">err</a></span><br>
<span class="lineno"></span><span class="op" id="3625324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3625327">type</span>&nbsp;<span class="ident" id="3625332">part</span>&nbsp;<span class="keyword" id="3625337">struct</span>&nbsp;<span class="op" id="3625344">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625347">mw</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="3625354">*</span><span class="ident" id="3625355"><a href="/mime/multipart/writer.go.html#3621356">Writer</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625363">closed</span>&nbsp;<span class="builtintype" id="3625370">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625376">we</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3625383">error</span>&nbsp;<span class="comment" id="3625389">//&nbsp;last&nbsp;error&nbsp;that&nbsp;occurred&nbsp;writing</span><br>
<span class="lineno"></span><span class="op" id="3625425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="3625428">func</span>&nbsp;<span class="op" id="3625433">(</span><span class="ident" id="3625434">p</span>&nbsp;<span class="op" id="3625436">*</span><span class="ident" id="3625437"><a href="/mime/multipart/writer.go.html#3625332">part</a></span><span class="op" id="3625441">)</span>&nbsp;<span class="builtinfunc" id="3625443">close</span><span class="op" id="3625448">(</span><span class="op" id="3625449">)</span>&nbsp;<span class="builtintype" id="3625451">error</span>&nbsp;<span class="op" id="3625457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625460"><a href="/mime/multipart/writer.go.html#3625434">p</a></span><span class="op" id="3625461">.</span><span class="ident" id="3625462">closed</span>&nbsp;<span class="op" id="3625469">=</span>&nbsp;<span class="builtintype" id="3625471">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625477">return</span>&nbsp;<span class="ident" id="3625484"><a href="/mime/multipart/writer.go.html#3625434">p</a></span><span class="op" id="3625485">.</span><span class="ident" id="3625486">we</span><br>
<span class="lineno"></span><span class="op" id="3625489">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span><span class="keyword" id="3625492">func</span>&nbsp;<span class="op" id="3625497">(</span><span class="ident" id="3625498">p</span>&nbsp;<span class="op" id="3625500">*</span><span class="ident" id="3625501"><a href="/mime/multipart/writer.go.html#3625332">part</a></span><span class="op" id="3625505">)</span>&nbsp;<span class="ident" id="3625507">Write</span><span class="op" id="3625512">(</span><span class="ident" id="3625513">d</span>&nbsp;<span class="op" id="3625515">[</span><span class="op" id="3625516">]</span><span class="builtintype" id="3625517">byte</span><span class="op" id="3625521">)</span>&nbsp;<span class="op" id="3625523">(</span><span class="ident" id="3625524">n</span>&nbsp;<span class="builtintype" id="3625526">int</span><span class="op" id="3625529">,</span>&nbsp;<span class="ident" id="3625531">err</span>&nbsp;<span class="builtintype" id="3625535">error</span><span class="op" id="3625540">)</span>&nbsp;<span class="op" id="3625542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625545">if</span>&nbsp;<span class="ident" id="3625548"><a href="/mime/multipart/writer.go.html#3625498">p</a></span><span class="op" id="3625549">.</span><span class="ident" id="3625550">closed</span>&nbsp;<span class="op" id="3625557">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625561">return</span>&nbsp;<span class="num" id="3625568">0</span><span class="op" id="3625569">,</span>&nbsp;<span class="ident" id="3625571"><a href="/mime/multipart/writer.go.html#3621256">errors</a></span><span class="op" id="3625577">.</span><span class="ident" id="3625578">New</span><span class="op" id="3625581">(</span><span class="string" id="3625582">&#34;multipart:&nbsp;can&#39;t&nbsp;write&nbsp;to&nbsp;finished&nbsp;part&#34;</span><span class="op" id="3625623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625629"><a href="/mime/multipart/writer.go.html#3625524">n</a></span><span class="op" id="3625630">,</span>&nbsp;<span class="ident" id="3625632"><a href="/mime/multipart/writer.go.html#3625531">err</a></span>&nbsp;<span class="op" id="3625636">=</span>&nbsp;<span class="ident" id="3625638"><a href="/mime/multipart/writer.go.html#3625498">p</a></span><span class="op" id="3625639">.</span><span class="ident" id="3625640">mw</span><span class="op" id="3625642">.</span><span class="ident" id="3625643">w</span><span class="op" id="3625644">.</span><span class="ident" id="3625645">Write</span><span class="op" id="3625650">(</span><span class="ident" id="3625651"><a href="/mime/multipart/writer.go.html#3625513">d</a></span><span class="op" id="3625652">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625655">if</span>&nbsp;<span class="ident" id="3625658"><a href="/mime/multipart/writer.go.html#3625531">err</a></span>&nbsp;<span class="op" id="3625662">!=</span>&nbsp;<span class="ident" id="3625665">nil</span>&nbsp;<span class="op" id="3625669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3625673"><a href="/mime/multipart/writer.go.html#3625498">p</a></span><span class="op" id="3625674">.</span><span class="ident" id="3625675">we</span>&nbsp;<span class="op" id="3625678">=</span>&nbsp;<span class="ident" id="3625680"><a href="/mime/multipart/writer.go.html#3625531">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3625685">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3625688">return</span><br>
<span class="lineno"></span><span class="op" id="3625695">}</span>
</div>
</body>
</html>
