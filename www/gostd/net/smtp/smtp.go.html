<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/smtp</h2>
<ul>
<li><a href="/gostd/net/smtp/auth.go.html">auth.go</a></li>
<li><a href="/gostd/net/smtp/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/smtp/smtp.go.html" class="current">smtp.go</a></li>
<li><a href="/gostd/net/smtp/smtp_test.go.html">smtp_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6299751">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6299806">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6299860">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="6299911">//&nbsp;Package&nbsp;smtp&nbsp;implements&nbsp;the&nbsp;Simple&nbsp;Mail&nbsp;Transfer&nbsp;Protocol&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;5321.</span><br>
<span class="lineno"></span><span class="comment" id="6299996">//&nbsp;It&nbsp;also&nbsp;implements&nbsp;the&nbsp;following&nbsp;extensions:</span><br>
<span class="lineno"></span><span class="comment" id="6300044">//&nbsp;&nbsp;&nbsp;&nbsp;8BITMIME&nbsp;&nbsp;RFC&nbsp;1652</span><br>
<span class="lineno"></span><span class="comment" id="6300066">//&nbsp;&nbsp;&nbsp;&nbsp;AUTH&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;RFC&nbsp;2554</span><br>
<span class="lineno"></span><span class="comment" id="6300088">//&nbsp;&nbsp;&nbsp;&nbsp;STARTTLS&nbsp;&nbsp;RFC&nbsp;3207</span><br>
<span class="lineno">10</span><span class="comment" id="6300110">//&nbsp;Additional&nbsp;extensions&nbsp;may&nbsp;be&nbsp;handled&nbsp;by&nbsp;clients.</span><br>
<span class="lineno"></span><span class="keyword" id="6300162">package</span>&nbsp;<span class="ident" id="6300170">smtp</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6300176">import</span>&nbsp;<span class="op" id="6300183">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300186">&#34;crypto/tls&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300200">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300219">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300229">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300235">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300242">&#34;net/textproto&#34;</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="6300259">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="6300269">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300272">//&nbsp;A&nbsp;Client&nbsp;represents&nbsp;a&nbsp;client&nbsp;connection&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6300334">type</span>&nbsp;<span class="ident" id="6300339">Client</span>&nbsp;<span class="keyword" id="6300346">struct</span>&nbsp;<span class="op" id="6300353">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300356">//&nbsp;Text&nbsp;is&nbsp;the&nbsp;textproto.Conn&nbsp;used&nbsp;by&nbsp;the&nbsp;Client.&nbsp;It&nbsp;is&nbsp;exported&nbsp;to&nbsp;allow&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300435">//&nbsp;clients&nbsp;to&nbsp;add&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300466">Text</span>&nbsp;<span class="op" id="6300471">*</span><span class="ident" id="6300472">textproto</span><span class="op" id="6300481">.</span><span class="ident" id="6300482">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300488">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;connection&nbsp;so&nbsp;it&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;create&nbsp;a&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300561">//&nbsp;connection&nbsp;later</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300582">conn</span>&nbsp;<span class="ident" id="6300587">net</span><span class="op" id="6300590">.</span><span class="ident" id="6300591">Conn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300597">//&nbsp;whether&nbsp;the&nbsp;Client&nbsp;is&nbsp;using&nbsp;TLS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300633">tls</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6300644">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300650">serverName</span>&nbsp;<span class="builtintype" id="6300661">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300669">//&nbsp;map&nbsp;of&nbsp;supported&nbsp;extensions</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300701">ext</span>&nbsp;<span class="keyword" id="6300705">map</span><span class="op" id="6300708">[</span><span class="builtintype" id="6300709">string</span><span class="op" id="6300715">]</span><span class="builtintype" id="6300716">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6300724">//&nbsp;supported&nbsp;auth&nbsp;mechanisms</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300754">auth</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6300765">[</span><span class="op" id="6300766">]</span><span class="builtintype" id="6300767">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300775">localName</span>&nbsp;&nbsp;<span class="builtintype" id="6300786">string</span>&nbsp;<span class="comment" id="6300793">//&nbsp;the&nbsp;name&nbsp;to&nbsp;use&nbsp;in&nbsp;HELO/EHLO</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300826">didHello</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6300837">bool</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="6300844">//&nbsp;whether&nbsp;we&#39;ve&nbsp;said&nbsp;HELO/EHLO</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6300877">helloError</span>&nbsp;<span class="builtintype" id="6300888">error</span>&nbsp;&nbsp;<span class="comment" id="6300895">//&nbsp;the&nbsp;error&nbsp;from&nbsp;the&nbsp;hello</span><br>
<span class="lineno"></span><span class="op" id="6300923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6300926">//&nbsp;Dial&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;connected&nbsp;to&nbsp;an&nbsp;SMTP&nbsp;server&nbsp;at&nbsp;addr.</span><br>
<span class="lineno"></span><span class="comment" id="6300992">//&nbsp;The&nbsp;addr&nbsp;must&nbsp;include&nbsp;a&nbsp;port&nbsp;number.</span><br>
<span class="lineno">45</span><span class="keyword" id="6301032">func</span>&nbsp;<span class="ident" id="6301037">Dial</span><span class="op" id="6301041">(</span><span class="ident" id="6301042">addr</span>&nbsp;<span class="builtintype" id="6301047">string</span><span class="op" id="6301053">)</span>&nbsp;<span class="op" id="6301055">(</span><span class="op" id="6301056">*</span><span class="ident" id="6301057">Client</span><span class="op" id="6301063">,</span>&nbsp;<span class="builtintype" id="6301065">error</span><span class="op" id="6301070">)</span>&nbsp;<span class="op" id="6301072">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301075">conn</span><span class="op" id="6301079">,</span>&nbsp;<span class="ident" id="6301081">err</span>&nbsp;<span class="op" id="6301085">:=</span>&nbsp;<span class="ident" id="6301088">net</span><span class="op" id="6301091">.</span><span class="ident" id="6301092">Dial</span><span class="op" id="6301096">(</span><span class="string" id="6301097">&#34;tcp&#34;</span><span class="op" id="6301102">,</span>&nbsp;<span class="ident" id="6301104">addr</span><span class="op" id="6301108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301111">if</span>&nbsp;<span class="ident" id="6301114">err</span>&nbsp;<span class="op" id="6301118">!=</span>&nbsp;<span class="builtintype" id="6301121">nil</span>&nbsp;<span class="op" id="6301125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301129">return</span>&nbsp;<span class="builtintype" id="6301136">nil</span><span class="op" id="6301139">,</span>&nbsp;<span class="ident" id="6301141">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301146">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301149">host</span><span class="op" id="6301153">,</span>&nbsp;<span class="ident" id="6301155">_</span><span class="op" id="6301156">,</span>&nbsp;<span class="ident" id="6301158">_</span>&nbsp;<span class="op" id="6301160">:=</span>&nbsp;<span class="ident" id="6301163">net</span><span class="op" id="6301166">.</span><span class="ident" id="6301167">SplitHostPort</span><span class="op" id="6301180">(</span><span class="ident" id="6301181">addr</span><span class="op" id="6301185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301188">return</span>&nbsp;<span class="ident" id="6301195">NewClient</span><span class="op" id="6301204">(</span><span class="ident" id="6301205">conn</span><span class="op" id="6301209">,</span>&nbsp;<span class="ident" id="6301211">host</span><span class="op" id="6301215">)</span><br>
<span class="lineno"></span><span class="op" id="6301217">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301220">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;using&nbsp;an&nbsp;existing&nbsp;connection&nbsp;and&nbsp;host&nbsp;as&nbsp;a</span><br>
<span class="lineno">55</span><span class="comment" id="6301297">//&nbsp;server&nbsp;name&nbsp;to&nbsp;be&nbsp;used&nbsp;when&nbsp;authenticating.</span><br>
<span class="lineno"></span><span class="keyword" id="6301344">func</span>&nbsp;<span class="ident" id="6301349">NewClient</span><span class="op" id="6301358">(</span><span class="ident" id="6301359">conn</span>&nbsp;<span class="ident" id="6301364">net</span><span class="op" id="6301367">.</span><span class="ident" id="6301368">Conn</span><span class="op" id="6301372">,</span>&nbsp;<span class="ident" id="6301374">host</span>&nbsp;<span class="builtintype" id="6301379">string</span><span class="op" id="6301385">)</span>&nbsp;<span class="op" id="6301387">(</span><span class="op" id="6301388">*</span><span class="ident" id="6301389">Client</span><span class="op" id="6301395">,</span>&nbsp;<span class="builtintype" id="6301397">error</span><span class="op" id="6301402">)</span>&nbsp;<span class="op" id="6301404">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301407">text</span>&nbsp;<span class="op" id="6301412">:=</span>&nbsp;<span class="ident" id="6301415">textproto</span><span class="op" id="6301424">.</span><span class="ident" id="6301425">NewConn</span><span class="op" id="6301432">(</span><span class="ident" id="6301433">conn</span><span class="op" id="6301437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301440">_</span><span class="op" id="6301441">,</span>&nbsp;<span class="ident" id="6301443">_</span><span class="op" id="6301444">,</span>&nbsp;<span class="ident" id="6301446">err</span>&nbsp;<span class="op" id="6301450">:=</span>&nbsp;<span class="ident" id="6301453">text</span><span class="op" id="6301457">.</span><span class="ident" id="6301458">ReadResponse</span><span class="op" id="6301470">(</span><span class="num" id="6301471">220</span><span class="op" id="6301474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301477">if</span>&nbsp;<span class="ident" id="6301480">err</span>&nbsp;<span class="op" id="6301484">!=</span>&nbsp;<span class="builtintype" id="6301487">nil</span>&nbsp;<span class="op" id="6301491">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301495">text</span><span class="op" id="6301499">.</span><span class="ident" id="6301500">Close</span><span class="op" id="6301505">(</span><span class="op" id="6301506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301510">return</span>&nbsp;<span class="builtintype" id="6301517">nil</span><span class="op" id="6301520">,</span>&nbsp;<span class="ident" id="6301522">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301527">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301530">c</span>&nbsp;<span class="op" id="6301532">:=</span>&nbsp;<span class="op" id="6301535">&amp;</span><span class="ident" id="6301536">Client</span><span class="op" id="6301542">{</span><span class="ident" id="6301543">Text</span><span class="op" id="6301547">:</span>&nbsp;<span class="ident" id="6301549">text</span><span class="op" id="6301553">,</span>&nbsp;<span class="ident" id="6301555">conn</span><span class="op" id="6301559">:</span>&nbsp;<span class="ident" id="6301561">conn</span><span class="op" id="6301565">,</span>&nbsp;<span class="ident" id="6301567">serverName</span><span class="op" id="6301577">:</span>&nbsp;<span class="ident" id="6301579">host</span><span class="op" id="6301583">,</span>&nbsp;<span class="ident" id="6301585">localName</span><span class="op" id="6301594">:</span>&nbsp;<span class="string" id="6301596">&#34;localhost&#34;</span><span class="op" id="6301607">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301610">return</span>&nbsp;<span class="ident" id="6301617">c</span><span class="op" id="6301618">,</span>&nbsp;<span class="builtintype" id="6301620">nil</span><br>
<span class="lineno">65</span><span class="op" id="6301624">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301627">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="keyword" id="6301659">func</span>&nbsp;<span class="op" id="6301664">(</span><span class="ident" id="6301665">c</span>&nbsp;<span class="op" id="6301667">*</span><span class="ident" id="6301668">Client</span><span class="op" id="6301674">)</span>&nbsp;<span class="ident" id="6301676">Close</span><span class="op" id="6301681">(</span><span class="op" id="6301682">)</span>&nbsp;<span class="builtintype" id="6301684">error</span>&nbsp;<span class="op" id="6301690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301693">return</span>&nbsp;<span class="ident" id="6301700">c</span><span class="op" id="6301701">.</span><span class="ident" id="6301702">Text</span><span class="op" id="6301706">.</span><span class="ident" id="6301707">Close</span><span class="op" id="6301712">(</span><span class="op" id="6301713">)</span><br>
<span class="lineno">70</span><span class="op" id="6301715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301718">//&nbsp;hello&nbsp;runs&nbsp;a&nbsp;hello&nbsp;exchange&nbsp;if&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="6301760">func</span>&nbsp;<span class="op" id="6301765">(</span><span class="ident" id="6301766">c</span>&nbsp;<span class="op" id="6301768">*</span><span class="ident" id="6301769">Client</span><span class="op" id="6301775">)</span>&nbsp;<span class="ident" id="6301777">hello</span><span class="op" id="6301782">(</span><span class="op" id="6301783">)</span>&nbsp;<span class="builtintype" id="6301785">error</span>&nbsp;<span class="op" id="6301791">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301794">if</span>&nbsp;<span class="op" id="6301797">!</span><span class="ident" id="6301798">c</span><span class="op" id="6301799">.</span><span class="ident" id="6301800">didHello</span>&nbsp;<span class="op" id="6301809">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301813">c</span><span class="op" id="6301814">.</span><span class="ident" id="6301815">didHello</span>&nbsp;<span class="op" id="6301824">=</span>&nbsp;<span class="builtintype" id="6301826">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301833">err</span>&nbsp;<span class="op" id="6301837">:=</span>&nbsp;<span class="ident" id="6301840">c</span><span class="op" id="6301841">.</span><span class="ident" id="6301842">ehlo</span><span class="op" id="6301846">(</span><span class="op" id="6301847">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301851">if</span>&nbsp;<span class="ident" id="6301854">err</span>&nbsp;<span class="op" id="6301858">!=</span>&nbsp;<span class="builtintype" id="6301861">nil</span>&nbsp;<span class="op" id="6301865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6301870">c</span><span class="op" id="6301871">.</span><span class="ident" id="6301872">helloError</span>&nbsp;<span class="op" id="6301883">=</span>&nbsp;<span class="ident" id="6301885">c</span><span class="op" id="6301886">.</span><span class="ident" id="6301887">helo</span><span class="op" id="6301891">(</span><span class="op" id="6301892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301896">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6301899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6301902">return</span>&nbsp;<span class="ident" id="6301909">c</span><span class="op" id="6301910">.</span><span class="ident" id="6301911">helloError</span><br>
<span class="lineno"></span><span class="op" id="6301922">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6301925">//&nbsp;Hello&nbsp;sends&nbsp;a&nbsp;HELO&nbsp;or&nbsp;EHLO&nbsp;to&nbsp;the&nbsp;server&nbsp;as&nbsp;the&nbsp;given&nbsp;host&nbsp;name.</span><br>
<span class="lineno">85</span><span class="comment" id="6301993">//&nbsp;Calling&nbsp;this&nbsp;method&nbsp;is&nbsp;only&nbsp;necessary&nbsp;if&nbsp;the&nbsp;client&nbsp;needs&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="6302062">//&nbsp;over&nbsp;the&nbsp;host&nbsp;name&nbsp;used.&nbsp;&nbsp;The&nbsp;client&nbsp;will&nbsp;introduce&nbsp;itself&nbsp;as&nbsp;&#34;localhost&#34;</span><br>
<span class="lineno"></span><span class="comment" id="6302139">//&nbsp;automatically&nbsp;otherwise.&nbsp;&nbsp;If&nbsp;Hello&nbsp;is&nbsp;called,&nbsp;it&nbsp;must&nbsp;be&nbsp;called&nbsp;before</span><br>
<span class="lineno"></span><span class="comment" id="6302213">//&nbsp;any&nbsp;of&nbsp;the&nbsp;other&nbsp;methods.</span><br>
<span class="lineno"></span><span class="keyword" id="6302242">func</span>&nbsp;<span class="op" id="6302247">(</span><span class="ident" id="6302248">c</span>&nbsp;<span class="op" id="6302250">*</span><span class="ident" id="6302251">Client</span><span class="op" id="6302257">)</span>&nbsp;<span class="ident" id="6302259">Hello</span><span class="op" id="6302264">(</span><span class="ident" id="6302265">localName</span>&nbsp;<span class="builtintype" id="6302275">string</span><span class="op" id="6302281">)</span>&nbsp;<span class="builtintype" id="6302283">error</span>&nbsp;<span class="op" id="6302289">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302292">if</span>&nbsp;<span class="ident" id="6302295">c</span><span class="op" id="6302296">.</span><span class="ident" id="6302297">didHello</span>&nbsp;<span class="op" id="6302306">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302310">return</span>&nbsp;<span class="ident" id="6302317">errors</span><span class="op" id="6302323">.</span><span class="ident" id="6302324">New</span><span class="op" id="6302327">(</span><span class="string" id="6302328">&#34;smtp:&nbsp;Hello&nbsp;called&nbsp;after&nbsp;other&nbsp;methods&#34;</span><span class="op" id="6302368">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302371">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302374">c</span><span class="op" id="6302375">.</span><span class="ident" id="6302376">localName</span>&nbsp;<span class="op" id="6302386">=</span>&nbsp;<span class="ident" id="6302388">localName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302399">return</span>&nbsp;<span class="ident" id="6302406">c</span><span class="op" id="6302407">.</span><span class="ident" id="6302408">hello</span><span class="op" id="6302413">(</span><span class="op" id="6302414">)</span><br>
<span class="lineno">95</span><span class="op" id="6302416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302419">//&nbsp;cmd&nbsp;is&nbsp;a&nbsp;convenience&nbsp;function&nbsp;that&nbsp;sends&nbsp;a&nbsp;command&nbsp;and&nbsp;returns&nbsp;the&nbsp;response</span><br>
<span class="lineno"></span><span class="keyword" id="6302498">func</span>&nbsp;<span class="op" id="6302503">(</span><span class="ident" id="6302504">c</span>&nbsp;<span class="op" id="6302506">*</span><span class="ident" id="6302507">Client</span><span class="op" id="6302513">)</span>&nbsp;<span class="ident" id="6302515">cmd</span><span class="op" id="6302518">(</span><span class="ident" id="6302519">expectCode</span>&nbsp;<span class="builtintype" id="6302530">int</span><span class="op" id="6302533">,</span>&nbsp;<span class="ident" id="6302535">format</span>&nbsp;<span class="builtintype" id="6302542">string</span><span class="op" id="6302548">,</span>&nbsp;<span class="ident" id="6302550">args</span>&nbsp;<span class="op" id="6302555">...</span><span class="keyword" id="6302558">interface</span><span class="op" id="6302567">{</span><span class="op" id="6302568">}</span><span class="op" id="6302569">)</span>&nbsp;<span class="op" id="6302571">(</span><span class="builtintype" id="6302572">int</span><span class="op" id="6302575">,</span>&nbsp;<span class="builtintype" id="6302577">string</span><span class="op" id="6302583">,</span>&nbsp;<span class="builtintype" id="6302585">error</span><span class="op" id="6302590">)</span>&nbsp;<span class="op" id="6302592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302595">id</span><span class="op" id="6302597">,</span>&nbsp;<span class="ident" id="6302599">err</span>&nbsp;<span class="op" id="6302603">:=</span>&nbsp;<span class="ident" id="6302606">c</span><span class="op" id="6302607">.</span><span class="ident" id="6302608">Text</span><span class="op" id="6302612">.</span><span class="ident" id="6302613">Cmd</span><span class="op" id="6302616">(</span><span class="ident" id="6302617">format</span><span class="op" id="6302623">,</span>&nbsp;<span class="ident" id="6302625">args</span><span class="op" id="6302629">...</span><span class="op" id="6302632">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302635">if</span>&nbsp;<span class="ident" id="6302638">err</span>&nbsp;<span class="op" id="6302642">!=</span>&nbsp;<span class="builtintype" id="6302645">nil</span>&nbsp;<span class="op" id="6302649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302653">return</span>&nbsp;<span class="num" id="6302660">0</span><span class="op" id="6302661">,</span>&nbsp;<span class="string" id="6302663">&#34;&#34;</span><span class="op" id="6302665">,</span>&nbsp;<span class="ident" id="6302667">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6302672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302675">c</span><span class="op" id="6302676">.</span><span class="ident" id="6302677">Text</span><span class="op" id="6302681">.</span><span class="ident" id="6302682">StartResponse</span><span class="op" id="6302695">(</span><span class="ident" id="6302696">id</span><span class="op" id="6302698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302701">defer</span>&nbsp;<span class="ident" id="6302707">c</span><span class="op" id="6302708">.</span><span class="ident" id="6302709">Text</span><span class="op" id="6302713">.</span><span class="ident" id="6302714">EndResponse</span><span class="op" id="6302725">(</span><span class="ident" id="6302726">id</span><span class="op" id="6302728">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302731">code</span><span class="op" id="6302735">,</span>&nbsp;<span class="ident" id="6302737">msg</span><span class="op" id="6302740">,</span>&nbsp;<span class="ident" id="6302742">err</span>&nbsp;<span class="op" id="6302746">:=</span>&nbsp;<span class="ident" id="6302749">c</span><span class="op" id="6302750">.</span><span class="ident" id="6302751">Text</span><span class="op" id="6302755">.</span><span class="ident" id="6302756">ReadResponse</span><span class="op" id="6302768">(</span><span class="ident" id="6302769">expectCode</span><span class="op" id="6302779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6302782">return</span>&nbsp;<span class="ident" id="6302789">code</span><span class="op" id="6302793">,</span>&nbsp;<span class="ident" id="6302795">msg</span><span class="op" id="6302798">,</span>&nbsp;<span class="ident" id="6302800">err</span><br>
<span class="lineno"></span><span class="op" id="6302804">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6302807">//&nbsp;helo&nbsp;sends&nbsp;the&nbsp;HELO&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It&nbsp;should&nbsp;be&nbsp;used&nbsp;only&nbsp;when&nbsp;the</span><br>
<span class="lineno">110</span><span class="comment" id="6302886">//&nbsp;server&nbsp;does&nbsp;not&nbsp;support&nbsp;ehlo.</span><br>
<span class="lineno"></span><span class="keyword" id="6302919">func</span>&nbsp;<span class="op" id="6302924">(</span><span class="ident" id="6302925">c</span>&nbsp;<span class="op" id="6302927">*</span><span class="ident" id="6302928">Client</span><span class="op" id="6302934">)</span>&nbsp;<span class="ident" id="6302936">helo</span><span class="op" id="6302940">(</span><span class="op" id="6302941">)</span>&nbsp;<span class="builtintype" id="6302943">error</span>&nbsp;<span class="op" id="6302949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302952">c</span><span class="op" id="6302953">.</span><span class="ident" id="6302954">ext</span>&nbsp;<span class="op" id="6302958">=</span>&nbsp;<span class="builtintype" id="6302960">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6302965">_</span><span class="op" id="6302966">,</span>&nbsp;<span class="ident" id="6302968">_</span><span class="op" id="6302969">,</span>&nbsp;<span class="ident" id="6302971">err</span>&nbsp;<span class="op" id="6302975">:=</span>&nbsp;<span class="ident" id="6302978">c</span><span class="op" id="6302979">.</span><span class="ident" id="6302980">cmd</span><span class="op" id="6302983">(</span><span class="num" id="6302984">250</span><span class="op" id="6302987">,</span>&nbsp;<span class="string" id="6302989">&#34;HELO&nbsp;%s&#34;</span><span class="op" id="6302998">,</span>&nbsp;<span class="ident" id="6303000">c</span><span class="op" id="6303001">.</span><span class="ident" id="6303002">localName</span><span class="op" id="6303011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303014">return</span>&nbsp;<span class="ident" id="6303021">err</span><br>
<span class="lineno">115</span><span class="op" id="6303025">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6303028">//&nbsp;ehlo&nbsp;sends&nbsp;the&nbsp;EHLO&nbsp;(extended&nbsp;hello)&nbsp;greeting&nbsp;to&nbsp;the&nbsp;server.&nbsp;It</span><br>
<span class="lineno"></span><span class="comment" id="6303095">//&nbsp;should&nbsp;be&nbsp;the&nbsp;preferred&nbsp;greeting&nbsp;for&nbsp;servers&nbsp;that&nbsp;support&nbsp;it.</span><br>
<span class="lineno"></span><span class="keyword" id="6303160">func</span>&nbsp;<span class="op" id="6303165">(</span><span class="ident" id="6303166">c</span>&nbsp;<span class="op" id="6303168">*</span><span class="ident" id="6303169">Client</span><span class="op" id="6303175">)</span>&nbsp;<span class="ident" id="6303177">ehlo</span><span class="op" id="6303181">(</span><span class="op" id="6303182">)</span>&nbsp;<span class="builtintype" id="6303184">error</span>&nbsp;<span class="op" id="6303190">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303193">_</span><span class="op" id="6303194">,</span>&nbsp;<span class="ident" id="6303196">msg</span><span class="op" id="6303199">,</span>&nbsp;<span class="ident" id="6303201">err</span>&nbsp;<span class="op" id="6303205">:=</span>&nbsp;<span class="ident" id="6303208">c</span><span class="op" id="6303209">.</span><span class="ident" id="6303210">cmd</span><span class="op" id="6303213">(</span><span class="num" id="6303214">250</span><span class="op" id="6303217">,</span>&nbsp;<span class="string" id="6303219">&#34;EHLO&nbsp;%s&#34;</span><span class="op" id="6303228">,</span>&nbsp;<span class="ident" id="6303230">c</span><span class="op" id="6303231">.</span><span class="ident" id="6303232">localName</span><span class="op" id="6303241">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303244">if</span>&nbsp;<span class="ident" id="6303247">err</span>&nbsp;<span class="op" id="6303251">!=</span>&nbsp;<span class="builtintype" id="6303254">nil</span>&nbsp;<span class="op" id="6303258">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303262">return</span>&nbsp;<span class="ident" id="6303269">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303277">ext</span>&nbsp;<span class="op" id="6303281">:=</span>&nbsp;<span class="builtinfunc" id="6303284">make</span><span class="op" id="6303288">(</span><span class="keyword" id="6303289">map</span><span class="op" id="6303292">[</span><span class="builtintype" id="6303293">string</span><span class="op" id="6303299">]</span><span class="builtintype" id="6303300">string</span><span class="op" id="6303306">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303309">extList</span>&nbsp;<span class="op" id="6303317">:=</span>&nbsp;<span class="ident" id="6303320">strings</span><span class="op" id="6303327">.</span><span class="ident" id="6303328">Split</span><span class="op" id="6303333">(</span><span class="ident" id="6303334">msg</span><span class="op" id="6303337">,</span>&nbsp;<span class="string" id="6303339">&#34;\n&#34;</span><span class="op" id="6303343">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303346">if</span>&nbsp;<span class="builtinfunc" id="6303349">len</span><span class="op" id="6303352">(</span><span class="ident" id="6303353">extList</span><span class="op" id="6303360">)</span>&nbsp;<span class="op" id="6303362">&gt;</span>&nbsp;<span class="num" id="6303364">1</span>&nbsp;<span class="op" id="6303366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303370">extList</span>&nbsp;<span class="op" id="6303378">=</span>&nbsp;<span class="ident" id="6303380">extList</span><span class="op" id="6303387">[</span><span class="num" id="6303388">1</span><span class="op" id="6303389">:</span><span class="op" id="6303390">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303394">for</span>&nbsp;<span class="ident" id="6303398">_</span><span class="op" id="6303399">,</span>&nbsp;<span class="ident" id="6303401">line</span>&nbsp;<span class="op" id="6303406">:=</span>&nbsp;<span class="keyword" id="6303409">range</span>&nbsp;<span class="ident" id="6303415">extList</span>&nbsp;<span class="op" id="6303423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303428">args</span>&nbsp;<span class="op" id="6303433">:=</span>&nbsp;<span class="ident" id="6303436">strings</span><span class="op" id="6303443">.</span><span class="ident" id="6303444">SplitN</span><span class="op" id="6303450">(</span><span class="ident" id="6303451">line</span><span class="op" id="6303455">,</span>&nbsp;<span class="string" id="6303457">&#34;&nbsp;&#34;</span><span class="op" id="6303460">,</span>&nbsp;<span class="num" id="6303462">2</span><span class="op" id="6303463">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303468">if</span>&nbsp;<span class="builtinfunc" id="6303471">len</span><span class="op" id="6303474">(</span><span class="ident" id="6303475">args</span><span class="op" id="6303479">)</span>&nbsp;<span class="op" id="6303481">&gt;</span>&nbsp;<span class="num" id="6303483">1</span>&nbsp;<span class="op" id="6303485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303491">ext</span><span class="op" id="6303494">[</span><span class="ident" id="6303495">args</span><span class="op" id="6303499">[</span><span class="num" id="6303500">0</span><span class="op" id="6303501">]</span><span class="op" id="6303502">]</span>&nbsp;<span class="op" id="6303504">=</span>&nbsp;<span class="ident" id="6303506">args</span><span class="op" id="6303510">[</span><span class="num" id="6303511">1</span><span class="op" id="6303512">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303517">}</span>&nbsp;<span class="keyword" id="6303519">else</span>&nbsp;<span class="op" id="6303524">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303530">ext</span><span class="op" id="6303533">[</span><span class="ident" id="6303534">args</span><span class="op" id="6303538">[</span><span class="num" id="6303539">0</span><span class="op" id="6303540">]</span><span class="op" id="6303541">]</span>&nbsp;<span class="op" id="6303543">=</span>&nbsp;<span class="string" id="6303545">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303551">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303555">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303558">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303561">if</span>&nbsp;<span class="ident" id="6303564">mechs</span><span class="op" id="6303569">,</span>&nbsp;<span class="ident" id="6303571">ok</span>&nbsp;<span class="op" id="6303574">:=</span>&nbsp;<span class="ident" id="6303577">ext</span><span class="op" id="6303580">[</span><span class="string" id="6303581">&#34;AUTH&#34;</span><span class="op" id="6303587">]</span><span class="op" id="6303588">;</span>&nbsp;<span class="ident" id="6303590">ok</span>&nbsp;<span class="op" id="6303593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303597">c</span><span class="op" id="6303598">.</span><span class="ident" id="6303599">auth</span>&nbsp;<span class="op" id="6303604">=</span>&nbsp;<span class="ident" id="6303606">strings</span><span class="op" id="6303613">.</span><span class="ident" id="6303614">Split</span><span class="op" id="6303619">(</span><span class="ident" id="6303620">mechs</span><span class="op" id="6303625">,</span>&nbsp;<span class="string" id="6303627">&#34;&nbsp;&#34;</span><span class="op" id="6303630">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303633">}</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303636">c</span><span class="op" id="6303637">.</span><span class="ident" id="6303638">ext</span>&nbsp;<span class="op" id="6303642">=</span>&nbsp;<span class="ident" id="6303644">ext</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303649">return</span>&nbsp;<span class="ident" id="6303656">err</span><br>
<span class="lineno"></span><span class="op" id="6303660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6303663">//&nbsp;StartTLS&nbsp;sends&nbsp;the&nbsp;STARTTLS&nbsp;command&nbsp;and&nbsp;encrypts&nbsp;all&nbsp;further&nbsp;communication.</span><br>
<span class="lineno">145</span><span class="comment" id="6303742">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;STARTTLS&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="6303819">func</span>&nbsp;<span class="op" id="6303824">(</span><span class="ident" id="6303825">c</span>&nbsp;<span class="op" id="6303827">*</span><span class="ident" id="6303828">Client</span><span class="op" id="6303834">)</span>&nbsp;<span class="ident" id="6303836">StartTLS</span><span class="op" id="6303844">(</span><span class="ident" id="6303845">config</span>&nbsp;<span class="op" id="6303852">*</span><span class="ident" id="6303853">tls</span><span class="op" id="6303856">.</span><span class="ident" id="6303857">Config</span><span class="op" id="6303863">)</span>&nbsp;<span class="builtintype" id="6303865">error</span>&nbsp;<span class="op" id="6303871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303874">if</span>&nbsp;<span class="ident" id="6303877">err</span>&nbsp;<span class="op" id="6303881">:=</span>&nbsp;<span class="ident" id="6303884">c</span><span class="op" id="6303885">.</span><span class="ident" id="6303886">hello</span><span class="op" id="6303891">(</span><span class="op" id="6303892">)</span><span class="op" id="6303893">;</span>&nbsp;<span class="ident" id="6303895">err</span>&nbsp;<span class="op" id="6303899">!=</span>&nbsp;<span class="builtintype" id="6303902">nil</span>&nbsp;<span class="op" id="6303906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303910">return</span>&nbsp;<span class="ident" id="6303917">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303922">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303925">_</span><span class="op" id="6303926">,</span>&nbsp;<span class="ident" id="6303928">_</span><span class="op" id="6303929">,</span>&nbsp;<span class="ident" id="6303931">err</span>&nbsp;<span class="op" id="6303935">:=</span>&nbsp;<span class="ident" id="6303938">c</span><span class="op" id="6303939">.</span><span class="ident" id="6303940">cmd</span><span class="op" id="6303943">(</span><span class="num" id="6303944">220</span><span class="op" id="6303947">,</span>&nbsp;<span class="string" id="6303949">&#34;STARTTLS&#34;</span><span class="op" id="6303959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303962">if</span>&nbsp;<span class="ident" id="6303965">err</span>&nbsp;<span class="op" id="6303969">!=</span>&nbsp;<span class="builtintype" id="6303972">nil</span>&nbsp;<span class="op" id="6303976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6303980">return</span>&nbsp;<span class="ident" id="6303987">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6303992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6303995">c</span><span class="op" id="6303996">.</span><span class="ident" id="6303997">conn</span>&nbsp;<span class="op" id="6304002">=</span>&nbsp;<span class="ident" id="6304004">tls</span><span class="op" id="6304007">.</span><span class="ident" id="6304008">Client</span><span class="op" id="6304014">(</span><span class="ident" id="6304015">c</span><span class="op" id="6304016">.</span><span class="ident" id="6304017">conn</span><span class="op" id="6304021">,</span>&nbsp;<span class="ident" id="6304023">config</span><span class="op" id="6304029">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304032">c</span><span class="op" id="6304033">.</span><span class="ident" id="6304034">Text</span>&nbsp;<span class="op" id="6304039">=</span>&nbsp;<span class="ident" id="6304041">textproto</span><span class="op" id="6304050">.</span><span class="ident" id="6304051">NewConn</span><span class="op" id="6304058">(</span><span class="ident" id="6304059">c</span><span class="op" id="6304060">.</span><span class="ident" id="6304061">conn</span><span class="op" id="6304065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304068">c</span><span class="op" id="6304069">.</span><span class="ident" id="6304070">tls</span>&nbsp;<span class="op" id="6304074">=</span>&nbsp;<span class="builtintype" id="6304076">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304082">return</span>&nbsp;<span class="ident" id="6304089">c</span><span class="op" id="6304090">.</span><span class="ident" id="6304091">ehlo</span><span class="op" id="6304095">(</span><span class="op" id="6304096">)</span><br>
<span class="lineno"></span><span class="op" id="6304098">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span><span class="comment" id="6304101">//&nbsp;Verify&nbsp;checks&nbsp;the&nbsp;validity&nbsp;of&nbsp;an&nbsp;email&nbsp;address&nbsp;on&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6304166">//&nbsp;If&nbsp;Verify&nbsp;returns&nbsp;nil,&nbsp;the&nbsp;address&nbsp;is&nbsp;valid.&nbsp;A&nbsp;non-nil&nbsp;return</span><br>
<span class="lineno"></span><span class="comment" id="6304231">//&nbsp;does&nbsp;not&nbsp;necessarily&nbsp;indicate&nbsp;an&nbsp;invalid&nbsp;address.&nbsp;Many&nbsp;servers</span><br>
<span class="lineno"></span><span class="comment" id="6304297">//&nbsp;will&nbsp;not&nbsp;verify&nbsp;addresses&nbsp;for&nbsp;security&nbsp;reasons.</span><br>
<span class="lineno"></span><span class="keyword" id="6304348">func</span>&nbsp;<span class="op" id="6304353">(</span><span class="ident" id="6304354">c</span>&nbsp;<span class="op" id="6304356">*</span><span class="ident" id="6304357">Client</span><span class="op" id="6304363">)</span>&nbsp;<span class="ident" id="6304365">Verify</span><span class="op" id="6304371">(</span><span class="ident" id="6304372">addr</span>&nbsp;<span class="builtintype" id="6304377">string</span><span class="op" id="6304383">)</span>&nbsp;<span class="builtintype" id="6304385">error</span>&nbsp;<span class="op" id="6304391">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304394">if</span>&nbsp;<span class="ident" id="6304397">err</span>&nbsp;<span class="op" id="6304401">:=</span>&nbsp;<span class="ident" id="6304404">c</span><span class="op" id="6304405">.</span><span class="ident" id="6304406">hello</span><span class="op" id="6304411">(</span><span class="op" id="6304412">)</span><span class="op" id="6304413">;</span>&nbsp;<span class="ident" id="6304415">err</span>&nbsp;<span class="op" id="6304419">!=</span>&nbsp;<span class="builtintype" id="6304422">nil</span>&nbsp;<span class="op" id="6304426">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304430">return</span>&nbsp;<span class="ident" id="6304437">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304442">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304445">_</span><span class="op" id="6304446">,</span>&nbsp;<span class="ident" id="6304448">_</span><span class="op" id="6304449">,</span>&nbsp;<span class="ident" id="6304451">err</span>&nbsp;<span class="op" id="6304455">:=</span>&nbsp;<span class="ident" id="6304458">c</span><span class="op" id="6304459">.</span><span class="ident" id="6304460">cmd</span><span class="op" id="6304463">(</span><span class="num" id="6304464">250</span><span class="op" id="6304467">,</span>&nbsp;<span class="string" id="6304469">&#34;VRFY&nbsp;%s&#34;</span><span class="op" id="6304478">,</span>&nbsp;<span class="ident" id="6304480">addr</span><span class="op" id="6304484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304487">return</span>&nbsp;<span class="ident" id="6304494">err</span><br>
<span class="lineno">170</span><span class="op" id="6304498">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6304501">//&nbsp;Auth&nbsp;authenticates&nbsp;a&nbsp;client&nbsp;using&nbsp;the&nbsp;provided&nbsp;authentication&nbsp;mechanism.</span><br>
<span class="lineno"></span><span class="comment" id="6304577">//&nbsp;A&nbsp;failed&nbsp;authentication&nbsp;closes&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="6304627">//&nbsp;Only&nbsp;servers&nbsp;that&nbsp;advertise&nbsp;the&nbsp;AUTH&nbsp;extension&nbsp;support&nbsp;this&nbsp;function.</span><br>
<span class="lineno">175</span><span class="keyword" id="6304700">func</span>&nbsp;<span class="op" id="6304705">(</span><span class="ident" id="6304706">c</span>&nbsp;<span class="op" id="6304708">*</span><span class="ident" id="6304709">Client</span><span class="op" id="6304715">)</span>&nbsp;<span class="ident" id="6304717">Auth</span><span class="op" id="6304721">(</span><span class="ident" id="6304722">a</span>&nbsp;<span class="ident" id="6304724">Auth</span><span class="op" id="6304728">)</span>&nbsp;<span class="builtintype" id="6304730">error</span>&nbsp;<span class="op" id="6304736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304739">if</span>&nbsp;<span class="ident" id="6304742">err</span>&nbsp;<span class="op" id="6304746">:=</span>&nbsp;<span class="ident" id="6304749">c</span><span class="op" id="6304750">.</span><span class="ident" id="6304751">hello</span><span class="op" id="6304756">(</span><span class="op" id="6304757">)</span><span class="op" id="6304758">;</span>&nbsp;<span class="ident" id="6304760">err</span>&nbsp;<span class="op" id="6304764">!=</span>&nbsp;<span class="builtintype" id="6304767">nil</span>&nbsp;<span class="op" id="6304771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304775">return</span>&nbsp;<span class="ident" id="6304782">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304787">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304790">encoding</span>&nbsp;<span class="op" id="6304799">:=</span>&nbsp;<span class="ident" id="6304802">base64</span><span class="op" id="6304808">.</span><span class="ident" id="6304809">StdEncoding</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304822">mech</span><span class="op" id="6304826">,</span>&nbsp;<span class="ident" id="6304828">resp</span><span class="op" id="6304832">,</span>&nbsp;<span class="ident" id="6304834">err</span>&nbsp;<span class="op" id="6304838">:=</span>&nbsp;<span class="ident" id="6304841">a</span><span class="op" id="6304842">.</span><span class="ident" id="6304843">Start</span><span class="op" id="6304848">(</span><span class="op" id="6304849">&amp;</span><span class="ident" id="6304850">ServerInfo</span><span class="op" id="6304860">{</span><span class="ident" id="6304861">c</span><span class="op" id="6304862">.</span><span class="ident" id="6304863">serverName</span><span class="op" id="6304873">,</span>&nbsp;<span class="ident" id="6304875">c</span><span class="op" id="6304876">.</span><span class="ident" id="6304877">tls</span><span class="op" id="6304880">,</span>&nbsp;<span class="ident" id="6304882">c</span><span class="op" id="6304883">.</span><span class="ident" id="6304884">auth</span><span class="op" id="6304888">}</span><span class="op" id="6304889">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304892">if</span>&nbsp;<span class="ident" id="6304895">err</span>&nbsp;<span class="op" id="6304899">!=</span>&nbsp;<span class="builtintype" id="6304902">nil</span>&nbsp;<span class="op" id="6304906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304910">c</span><span class="op" id="6304911">.</span><span class="ident" id="6304912">Quit</span><span class="op" id="6304916">(</span><span class="op" id="6304917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6304921">return</span>&nbsp;<span class="ident" id="6304928">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6304933">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304936">resp64</span>&nbsp;<span class="op" id="6304943">:=</span>&nbsp;<span class="builtinfunc" id="6304946">make</span><span class="op" id="6304950">(</span><span class="op" id="6304951">[</span><span class="op" id="6304952">]</span><span class="builtintype" id="6304953">byte</span><span class="op" id="6304957">,</span>&nbsp;<span class="ident" id="6304959">encoding</span><span class="op" id="6304967">.</span><span class="ident" id="6304968">EncodedLen</span><span class="op" id="6304978">(</span><span class="builtinfunc" id="6304979">len</span><span class="op" id="6304982">(</span><span class="ident" id="6304983">resp</span><span class="op" id="6304987">)</span><span class="op" id="6304988">)</span><span class="op" id="6304989">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6304992">encoding</span><span class="op" id="6305000">.</span><span class="ident" id="6305001">Encode</span><span class="op" id="6305007">(</span><span class="ident" id="6305008">resp64</span><span class="op" id="6305014">,</span>&nbsp;<span class="ident" id="6305016">resp</span><span class="op" id="6305020">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305023">code</span><span class="op" id="6305027">,</span>&nbsp;<span class="ident" id="6305029">msg64</span><span class="op" id="6305034">,</span>&nbsp;<span class="ident" id="6305036">err</span>&nbsp;<span class="op" id="6305040">:=</span>&nbsp;<span class="ident" id="6305043">c</span><span class="op" id="6305044">.</span><span class="ident" id="6305045">cmd</span><span class="op" id="6305048">(</span><span class="num" id="6305049">0</span><span class="op" id="6305050">,</span>&nbsp;<span class="string" id="6305052">&#34;AUTH&nbsp;%s&nbsp;%s&#34;</span><span class="op" id="6305064">,</span>&nbsp;<span class="ident" id="6305066">mech</span><span class="op" id="6305070">,</span>&nbsp;<span class="ident" id="6305072">resp64</span><span class="op" id="6305078">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305081">for</span>&nbsp;<span class="ident" id="6305085">err</span>&nbsp;<span class="op" id="6305089">==</span>&nbsp;<span class="builtintype" id="6305092">nil</span>&nbsp;<span class="op" id="6305096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305100">var</span>&nbsp;<span class="ident" id="6305104">msg</span>&nbsp;<span class="op" id="6305108">[</span><span class="op" id="6305109">]</span><span class="builtintype" id="6305110">byte</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305117">switch</span>&nbsp;<span class="ident" id="6305124">code</span>&nbsp;<span class="op" id="6305129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305133">case</span>&nbsp;<span class="num" id="6305138">334</span><span class="op" id="6305141">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305146">msg</span><span class="op" id="6305149">,</span>&nbsp;<span class="ident" id="6305151">err</span>&nbsp;<span class="op" id="6305155">=</span>&nbsp;<span class="ident" id="6305157">encoding</span><span class="op" id="6305165">.</span><span class="ident" id="6305166">DecodeString</span><span class="op" id="6305178">(</span><span class="ident" id="6305179">msg64</span><span class="op" id="6305184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305188">case</span>&nbsp;<span class="num" id="6305193">235</span><span class="op" id="6305196">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6305201">//&nbsp;the&nbsp;last&nbsp;message&nbsp;isn&#39;t&nbsp;base64&nbsp;because&nbsp;it&nbsp;isn&#39;t&nbsp;a&nbsp;challenge</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305266">msg</span>&nbsp;<span class="op" id="6305270">=</span>&nbsp;<span class="op" id="6305272">[</span><span class="op" id="6305273">]</span><span class="builtintype" id="6305274">byte</span><span class="op" id="6305278">(</span><span class="ident" id="6305279">msg64</span><span class="op" id="6305284">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305288">default</span><span class="op" id="6305295">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305300">err</span>&nbsp;<span class="op" id="6305304">=</span>&nbsp;<span class="op" id="6305306">&amp;</span><span class="ident" id="6305307">textproto</span><span class="op" id="6305316">.</span><span class="ident" id="6305317">Error</span><span class="op" id="6305322">{</span><span class="ident" id="6305323">Code</span><span class="op" id="6305327">:</span>&nbsp;<span class="ident" id="6305329">code</span><span class="op" id="6305333">,</span>&nbsp;<span class="ident" id="6305335">Msg</span><span class="op" id="6305338">:</span>&nbsp;<span class="ident" id="6305340">msg64</span><span class="op" id="6305345">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305353">if</span>&nbsp;<span class="ident" id="6305356">err</span>&nbsp;<span class="op" id="6305360">==</span>&nbsp;<span class="builtintype" id="6305363">nil</span>&nbsp;<span class="op" id="6305367">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305372">resp</span><span class="op" id="6305376">,</span>&nbsp;<span class="ident" id="6305378">err</span>&nbsp;<span class="op" id="6305382">=</span>&nbsp;<span class="ident" id="6305384">a</span><span class="op" id="6305385">.</span><span class="ident" id="6305386">Next</span><span class="op" id="6305390">(</span><span class="ident" id="6305391">msg</span><span class="op" id="6305394">,</span>&nbsp;<span class="ident" id="6305396">code</span>&nbsp;<span class="op" id="6305401">==</span>&nbsp;<span class="num" id="6305404">334</span><span class="op" id="6305407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305415">if</span>&nbsp;<span class="ident" id="6305418">err</span>&nbsp;<span class="op" id="6305422">!=</span>&nbsp;<span class="builtintype" id="6305425">nil</span>&nbsp;<span class="op" id="6305429">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="6305434">//&nbsp;abort&nbsp;the&nbsp;AUTH</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305455">c</span><span class="op" id="6305456">.</span><span class="ident" id="6305457">cmd</span><span class="op" id="6305460">(</span><span class="num" id="6305461">501</span><span class="op" id="6305464">,</span>&nbsp;<span class="string" id="6305466">&#34;*&#34;</span><span class="op" id="6305469">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305474">c</span><span class="op" id="6305475">.</span><span class="ident" id="6305476">Quit</span><span class="op" id="6305480">(</span><span class="op" id="6305481">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305486">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305498">if</span>&nbsp;<span class="ident" id="6305501">resp</span>&nbsp;<span class="op" id="6305506">==</span>&nbsp;<span class="builtintype" id="6305509">nil</span>&nbsp;<span class="op" id="6305513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305518">break</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305530">resp64</span>&nbsp;<span class="op" id="6305537">=</span>&nbsp;<span class="builtinfunc" id="6305539">make</span><span class="op" id="6305543">(</span><span class="op" id="6305544">[</span><span class="op" id="6305545">]</span><span class="builtintype" id="6305546">byte</span><span class="op" id="6305550">,</span>&nbsp;<span class="ident" id="6305552">encoding</span><span class="op" id="6305560">.</span><span class="ident" id="6305561">EncodedLen</span><span class="op" id="6305571">(</span><span class="builtinfunc" id="6305572">len</span><span class="op" id="6305575">(</span><span class="ident" id="6305576">resp</span><span class="op" id="6305580">)</span><span class="op" id="6305581">)</span><span class="op" id="6305582">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305586">encoding</span><span class="op" id="6305594">.</span><span class="ident" id="6305595">Encode</span><span class="op" id="6305601">(</span><span class="ident" id="6305602">resp64</span><span class="op" id="6305608">,</span>&nbsp;<span class="ident" id="6305610">resp</span><span class="op" id="6305614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6305618">code</span><span class="op" id="6305622">,</span>&nbsp;<span class="ident" id="6305624">msg64</span><span class="op" id="6305629">,</span>&nbsp;<span class="ident" id="6305631">err</span>&nbsp;<span class="op" id="6305635">=</span>&nbsp;<span class="ident" id="6305637">c</span><span class="op" id="6305638">.</span><span class="ident" id="6305639">cmd</span><span class="op" id="6305642">(</span><span class="num" id="6305643">0</span><span class="op" id="6305644">,</span>&nbsp;<span class="builtintype" id="6305646">string</span><span class="op" id="6305652">(</span><span class="ident" id="6305653">resp64</span><span class="op" id="6305659">)</span><span class="op" id="6305660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6305663">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305666">return</span>&nbsp;<span class="ident" id="6305673">err</span><br>
<span class="lineno"></span><span class="op" id="6305677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6305680">//&nbsp;Mail&nbsp;issues&nbsp;a&nbsp;MAIL&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6305758">//&nbsp;If&nbsp;the&nbsp;server&nbsp;supports&nbsp;the&nbsp;8BITMIME&nbsp;extension,&nbsp;Mail&nbsp;adds&nbsp;the&nbsp;BODY=8BITMIME</span><br>
<span class="lineno">220</span><span class="comment" id="6305836">//&nbsp;parameter.</span><br>
<span class="lineno"></span><span class="comment" id="6305850">//&nbsp;This&nbsp;initiates&nbsp;a&nbsp;mail&nbsp;transaction&nbsp;and&nbsp;is&nbsp;followed&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;Rcpt&nbsp;calls.</span><br>
<span class="lineno"></span><span class="keyword" id="6305930">func</span>&nbsp;<span class="op" id="6305935">(</span><span class="ident" id="6305936">c</span>&nbsp;<span class="op" id="6305938">*</span><span class="ident" id="6305939">Client</span><span class="op" id="6305945">)</span>&nbsp;<span class="ident" id="6305947">Mail</span><span class="op" id="6305951">(</span><span class="ident" id="6305952">from</span>&nbsp;<span class="builtintype" id="6305957">string</span><span class="op" id="6305963">)</span>&nbsp;<span class="builtintype" id="6305965">error</span>&nbsp;<span class="op" id="6305971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6305974">if</span>&nbsp;<span class="ident" id="6305977">err</span>&nbsp;<span class="op" id="6305981">:=</span>&nbsp;<span class="ident" id="6305984">c</span><span class="op" id="6305985">.</span><span class="ident" id="6305986">hello</span><span class="op" id="6305991">(</span><span class="op" id="6305992">)</span><span class="op" id="6305993">;</span>&nbsp;<span class="ident" id="6305995">err</span>&nbsp;<span class="op" id="6305999">!=</span>&nbsp;<span class="builtintype" id="6306002">nil</span>&nbsp;<span class="op" id="6306006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306010">return</span>&nbsp;<span class="ident" id="6306017">err</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306025">cmdStr</span>&nbsp;<span class="op" id="6306032">:=</span>&nbsp;<span class="string" id="6306035">&#34;MAIL&nbsp;FROM:&lt;%s&gt;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306053">if</span>&nbsp;<span class="ident" id="6306056">c</span><span class="op" id="6306057">.</span><span class="ident" id="6306058">ext</span>&nbsp;<span class="op" id="6306062">!=</span>&nbsp;<span class="builtintype" id="6306065">nil</span>&nbsp;<span class="op" id="6306069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306073">if</span>&nbsp;<span class="ident" id="6306076">_</span><span class="op" id="6306077">,</span>&nbsp;<span class="ident" id="6306079">ok</span>&nbsp;<span class="op" id="6306082">:=</span>&nbsp;<span class="ident" id="6306085">c</span><span class="op" id="6306086">.</span><span class="ident" id="6306087">ext</span><span class="op" id="6306090">[</span><span class="string" id="6306091">&#34;8BITMIME&#34;</span><span class="op" id="6306101">]</span><span class="op" id="6306102">;</span>&nbsp;<span class="ident" id="6306104">ok</span>&nbsp;<span class="op" id="6306107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306112">cmdStr</span>&nbsp;<span class="op" id="6306119">+=</span>&nbsp;<span class="string" id="6306122">&#34;&nbsp;BODY=8BITMIME&#34;</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306141">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6306144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306147">_</span><span class="op" id="6306148">,</span>&nbsp;<span class="ident" id="6306150">_</span><span class="op" id="6306151">,</span>&nbsp;<span class="ident" id="6306153">err</span>&nbsp;<span class="op" id="6306157">:=</span>&nbsp;<span class="ident" id="6306160">c</span><span class="op" id="6306161">.</span><span class="ident" id="6306162">cmd</span><span class="op" id="6306165">(</span><span class="num" id="6306166">250</span><span class="op" id="6306169">,</span>&nbsp;<span class="ident" id="6306171">cmdStr</span><span class="op" id="6306177">,</span>&nbsp;<span class="ident" id="6306179">from</span><span class="op" id="6306183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306186">return</span>&nbsp;<span class="ident" id="6306193">err</span><br>
<span class="lineno"></span><span class="op" id="6306197">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span><span class="comment" id="6306200">//&nbsp;Rcpt&nbsp;issues&nbsp;a&nbsp;RCPT&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;using&nbsp;the&nbsp;provided&nbsp;email&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="6306278">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Rcpt&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;a&nbsp;call&nbsp;to&nbsp;Mail&nbsp;and&nbsp;may&nbsp;be&nbsp;followed&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="6306354">//&nbsp;a&nbsp;Data&nbsp;call&nbsp;or&nbsp;another&nbsp;Rcpt&nbsp;call.</span><br>
<span class="lineno"></span><span class="keyword" id="6306391">func</span>&nbsp;<span class="op" id="6306396">(</span><span class="ident" id="6306397">c</span>&nbsp;<span class="op" id="6306399">*</span><span class="ident" id="6306400">Client</span><span class="op" id="6306406">)</span>&nbsp;<span class="ident" id="6306408">Rcpt</span><span class="op" id="6306412">(</span><span class="ident" id="6306413">to</span>&nbsp;<span class="builtintype" id="6306416">string</span><span class="op" id="6306422">)</span>&nbsp;<span class="builtintype" id="6306424">error</span>&nbsp;<span class="op" id="6306430">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306433">_</span><span class="op" id="6306434">,</span>&nbsp;<span class="ident" id="6306436">_</span><span class="op" id="6306437">,</span>&nbsp;<span class="ident" id="6306439">err</span>&nbsp;<span class="op" id="6306443">:=</span>&nbsp;<span class="ident" id="6306446">c</span><span class="op" id="6306447">.</span><span class="ident" id="6306448">cmd</span><span class="op" id="6306451">(</span><span class="num" id="6306452">25</span><span class="op" id="6306454">,</span>&nbsp;<span class="string" id="6306456">&#34;RCPT&nbsp;TO:&lt;%s&gt;&#34;</span><span class="op" id="6306470">,</span>&nbsp;<span class="ident" id="6306472">to</span><span class="op" id="6306474">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306477">return</span>&nbsp;<span class="ident" id="6306484">err</span><br>
<span class="lineno"></span><span class="op" id="6306488">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6306491">type</span>&nbsp;<span class="ident" id="6306496">dataCloser</span>&nbsp;<span class="keyword" id="6306507">struct</span>&nbsp;<span class="op" id="6306514">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306517">c</span>&nbsp;<span class="op" id="6306519">*</span><span class="ident" id="6306520">Client</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306528">io</span><span class="op" id="6306530">.</span><span class="ident" id="6306531">WriteCloser</span><br>
<span class="lineno"></span><span class="op" id="6306543">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6306546">func</span>&nbsp;<span class="op" id="6306551">(</span><span class="ident" id="6306552">d</span>&nbsp;<span class="op" id="6306554">*</span><span class="ident" id="6306555">dataCloser</span><span class="op" id="6306565">)</span>&nbsp;<span class="ident" id="6306567">Close</span><span class="op" id="6306572">(</span><span class="op" id="6306573">)</span>&nbsp;<span class="builtintype" id="6306575">error</span>&nbsp;<span class="op" id="6306581">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306584">d</span><span class="op" id="6306585">.</span><span class="ident" id="6306586">WriteCloser</span><span class="op" id="6306597">.</span><span class="ident" id="6306598">Close</span><span class="op" id="6306603">(</span><span class="op" id="6306604">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306607">_</span><span class="op" id="6306608">,</span>&nbsp;<span class="ident" id="6306610">_</span><span class="op" id="6306611">,</span>&nbsp;<span class="ident" id="6306613">err</span>&nbsp;<span class="op" id="6306617">:=</span>&nbsp;<span class="ident" id="6306620">d</span><span class="op" id="6306621">.</span><span class="ident" id="6306622">c</span><span class="op" id="6306623">.</span><span class="ident" id="6306624">Text</span><span class="op" id="6306628">.</span><span class="ident" id="6306629">ReadResponse</span><span class="op" id="6306641">(</span><span class="num" id="6306642">250</span><span class="op" id="6306645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306648">return</span>&nbsp;<span class="ident" id="6306655">err</span><br>
<span class="lineno"></span><span class="op" id="6306659">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span><span class="comment" id="6306662">//&nbsp;Data&nbsp;issues&nbsp;a&nbsp;DATA&nbsp;command&nbsp;to&nbsp;the&nbsp;server&nbsp;and&nbsp;returns&nbsp;a&nbsp;writer&nbsp;that</span><br>
<span class="lineno"></span><span class="comment" id="6306732">//&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;write&nbsp;the&nbsp;data.&nbsp;The&nbsp;caller&nbsp;should&nbsp;close&nbsp;the&nbsp;writer</span><br>
<span class="lineno"></span><span class="comment" id="6306801">//&nbsp;before&nbsp;calling&nbsp;any&nbsp;more&nbsp;methods&nbsp;on&nbsp;c.</span><br>
<span class="lineno"></span><span class="comment" id="6306842">//&nbsp;A&nbsp;call&nbsp;to&nbsp;Data&nbsp;must&nbsp;be&nbsp;preceded&nbsp;by&nbsp;one&nbsp;or&nbsp;more&nbsp;calls&nbsp;to&nbsp;Rcpt.</span><br>
<span class="lineno"></span><span class="keyword" id="6306907">func</span>&nbsp;<span class="op" id="6306912">(</span><span class="ident" id="6306913">c</span>&nbsp;<span class="op" id="6306915">*</span><span class="ident" id="6306916">Client</span><span class="op" id="6306922">)</span>&nbsp;<span class="ident" id="6306924">Data</span><span class="op" id="6306928">(</span><span class="op" id="6306929">)</span>&nbsp;<span class="op" id="6306931">(</span><span class="ident" id="6306932">io</span><span class="op" id="6306934">.</span><span class="ident" id="6306935">WriteCloser</span><span class="op" id="6306946">,</span>&nbsp;<span class="builtintype" id="6306948">error</span><span class="op" id="6306953">)</span>&nbsp;<span class="op" id="6306955">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6306958">_</span><span class="op" id="6306959">,</span>&nbsp;<span class="ident" id="6306961">_</span><span class="op" id="6306962">,</span>&nbsp;<span class="ident" id="6306964">err</span>&nbsp;<span class="op" id="6306968">:=</span>&nbsp;<span class="ident" id="6306971">c</span><span class="op" id="6306972">.</span><span class="ident" id="6306973">cmd</span><span class="op" id="6306976">(</span><span class="num" id="6306977">354</span><span class="op" id="6306980">,</span>&nbsp;<span class="string" id="6306982">&#34;DATA&#34;</span><span class="op" id="6306988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6306991">if</span>&nbsp;<span class="ident" id="6306994">err</span>&nbsp;<span class="op" id="6306998">!=</span>&nbsp;<span class="builtintype" id="6307001">nil</span>&nbsp;<span class="op" id="6307005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307009">return</span>&nbsp;<span class="builtintype" id="6307016">nil</span><span class="op" id="6307019">,</span>&nbsp;<span class="ident" id="6307021">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307026">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307029">return</span>&nbsp;<span class="op" id="6307036">&amp;</span><span class="ident" id="6307037">dataCloser</span><span class="op" id="6307047">{</span><span class="ident" id="6307048">c</span><span class="op" id="6307049">,</span>&nbsp;<span class="ident" id="6307051">c</span><span class="op" id="6307052">.</span><span class="ident" id="6307053">Text</span><span class="op" id="6307057">.</span><span class="ident" id="6307058">DotWriter</span><span class="op" id="6307067">(</span><span class="op" id="6307068">)</span><span class="op" id="6307069">}</span><span class="op" id="6307070">,</span>&nbsp;<span class="builtintype" id="6307072">nil</span><br>
<span class="lineno">265</span><span class="op" id="6307076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6307079">var</span>&nbsp;<span class="ident" id="6307083">testHookStartTLS</span>&nbsp;<span class="keyword" id="6307100">func</span><span class="op" id="6307104">(</span><span class="op" id="6307105">*</span><span class="ident" id="6307106">tls</span><span class="op" id="6307109">.</span><span class="ident" id="6307110">Config</span><span class="op" id="6307116">)</span>&nbsp;<span class="comment" id="6307118">//&nbsp;nil,&nbsp;except&nbsp;for&nbsp;tests</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6307144">//&nbsp;SendMail&nbsp;connects&nbsp;to&nbsp;the&nbsp;server&nbsp;at&nbsp;addr,&nbsp;switches&nbsp;to&nbsp;TLS&nbsp;if</span><br>
<span class="lineno">270</span><span class="comment" id="6307207">//&nbsp;possible,&nbsp;authenticates&nbsp;with&nbsp;the&nbsp;optional&nbsp;mechanism&nbsp;a&nbsp;if&nbsp;possible,</span><br>
<span class="lineno"></span><span class="comment" id="6307277">//&nbsp;and&nbsp;then&nbsp;sends&nbsp;an&nbsp;email&nbsp;from&nbsp;address&nbsp;from,&nbsp;to&nbsp;addresses&nbsp;to,&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="6307345">//&nbsp;message&nbsp;msg.</span><br>
<span class="lineno"></span><span class="keyword" id="6307361">func</span>&nbsp;<span class="ident" id="6307366">SendMail</span><span class="op" id="6307374">(</span><span class="ident" id="6307375">addr</span>&nbsp;<span class="builtintype" id="6307380">string</span><span class="op" id="6307386">,</span>&nbsp;<span class="ident" id="6307388">a</span>&nbsp;<span class="ident" id="6307390">Auth</span><span class="op" id="6307394">,</span>&nbsp;<span class="ident" id="6307396">from</span>&nbsp;<span class="builtintype" id="6307401">string</span><span class="op" id="6307407">,</span>&nbsp;<span class="ident" id="6307409">to</span>&nbsp;<span class="op" id="6307412">[</span><span class="op" id="6307413">]</span><span class="builtintype" id="6307414">string</span><span class="op" id="6307420">,</span>&nbsp;<span class="ident" id="6307422">msg</span>&nbsp;<span class="op" id="6307426">[</span><span class="op" id="6307427">]</span><span class="builtintype" id="6307428">byte</span><span class="op" id="6307432">)</span>&nbsp;<span class="builtintype" id="6307434">error</span>&nbsp;<span class="op" id="6307440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307443">c</span><span class="op" id="6307444">,</span>&nbsp;<span class="ident" id="6307446">err</span>&nbsp;<span class="op" id="6307450">:=</span>&nbsp;<span class="ident" id="6307453">Dial</span><span class="op" id="6307457">(</span><span class="ident" id="6307458">addr</span><span class="op" id="6307462">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307465">if</span>&nbsp;<span class="ident" id="6307468">err</span>&nbsp;<span class="op" id="6307472">!=</span>&nbsp;<span class="builtintype" id="6307475">nil</span>&nbsp;<span class="op" id="6307479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307483">return</span>&nbsp;<span class="ident" id="6307490">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307495">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307498">defer</span>&nbsp;<span class="ident" id="6307504">c</span><span class="op" id="6307505">.</span><span class="ident" id="6307506">Close</span><span class="op" id="6307511">(</span><span class="op" id="6307512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307515">if</span>&nbsp;<span class="ident" id="6307518">err</span>&nbsp;<span class="op" id="6307522">=</span>&nbsp;<span class="ident" id="6307524">c</span><span class="op" id="6307525">.</span><span class="ident" id="6307526">hello</span><span class="op" id="6307531">(</span><span class="op" id="6307532">)</span><span class="op" id="6307533">;</span>&nbsp;<span class="ident" id="6307535">err</span>&nbsp;<span class="op" id="6307539">!=</span>&nbsp;<span class="builtintype" id="6307542">nil</span>&nbsp;<span class="op" id="6307546">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307550">return</span>&nbsp;<span class="ident" id="6307557">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307562">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307565">if</span>&nbsp;<span class="ident" id="6307568">ok</span><span class="op" id="6307570">,</span>&nbsp;<span class="ident" id="6307572">_</span>&nbsp;<span class="op" id="6307574">:=</span>&nbsp;<span class="ident" id="6307577">c</span><span class="op" id="6307578">.</span><span class="ident" id="6307579">Extension</span><span class="op" id="6307588">(</span><span class="string" id="6307589">&#34;STARTTLS&#34;</span><span class="op" id="6307599">)</span><span class="op" id="6307600">;</span>&nbsp;<span class="ident" id="6307602">ok</span>&nbsp;<span class="op" id="6307605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307609">config</span>&nbsp;<span class="op" id="6307616">:=</span>&nbsp;<span class="op" id="6307619">&amp;</span><span class="ident" id="6307620">tls</span><span class="op" id="6307623">.</span><span class="ident" id="6307624">Config</span><span class="op" id="6307630">{</span><span class="ident" id="6307631">ServerName</span><span class="op" id="6307641">:</span>&nbsp;<span class="ident" id="6307643">c</span><span class="op" id="6307644">.</span><span class="ident" id="6307645">serverName</span><span class="op" id="6307655">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307659">if</span>&nbsp;<span class="ident" id="6307662">testHookStartTLS</span>&nbsp;<span class="op" id="6307679">!=</span>&nbsp;<span class="builtintype" id="6307682">nil</span>&nbsp;<span class="op" id="6307686">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6307691">testHookStartTLS</span><span class="op" id="6307707">(</span><span class="ident" id="6307708">config</span><span class="op" id="6307714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307722">if</span>&nbsp;<span class="ident" id="6307725">err</span>&nbsp;<span class="op" id="6307729">=</span>&nbsp;<span class="ident" id="6307731">c</span><span class="op" id="6307732">.</span><span class="ident" id="6307733">StartTLS</span><span class="op" id="6307741">(</span><span class="ident" id="6307742">config</span><span class="op" id="6307748">)</span><span class="op" id="6307749">;</span>&nbsp;<span class="ident" id="6307751">err</span>&nbsp;<span class="op" id="6307755">!=</span>&nbsp;<span class="builtintype" id="6307758">nil</span>&nbsp;<span class="op" id="6307762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307767">return</span>&nbsp;<span class="ident" id="6307774">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307780">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307783">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307786">if</span>&nbsp;<span class="ident" id="6307789">a</span>&nbsp;<span class="op" id="6307791">!=</span>&nbsp;<span class="builtintype" id="6307794">nil</span>&nbsp;<span class="op" id="6307798">&amp;&amp;</span>&nbsp;<span class="ident" id="6307801">c</span><span class="op" id="6307802">.</span><span class="ident" id="6307803">ext</span>&nbsp;<span class="op" id="6307807">!=</span>&nbsp;<span class="builtintype" id="6307810">nil</span>&nbsp;<span class="op" id="6307814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307818">if</span>&nbsp;<span class="ident" id="6307821">_</span><span class="op" id="6307822">,</span>&nbsp;<span class="ident" id="6307824">ok</span>&nbsp;<span class="op" id="6307827">:=</span>&nbsp;<span class="ident" id="6307830">c</span><span class="op" id="6307831">.</span><span class="ident" id="6307832">ext</span><span class="op" id="6307835">[</span><span class="string" id="6307836">&#34;AUTH&#34;</span><span class="op" id="6307842">]</span><span class="op" id="6307843">;</span>&nbsp;<span class="ident" id="6307845">ok</span>&nbsp;<span class="op" id="6307848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307853">if</span>&nbsp;<span class="ident" id="6307856">err</span>&nbsp;<span class="op" id="6307860">=</span>&nbsp;<span class="ident" id="6307862">c</span><span class="op" id="6307863">.</span><span class="ident" id="6307864">Auth</span><span class="op" id="6307868">(</span><span class="ident" id="6307869">a</span><span class="op" id="6307870">)</span><span class="op" id="6307871">;</span>&nbsp;<span class="ident" id="6307873">err</span>&nbsp;<span class="op" id="6307877">!=</span>&nbsp;<span class="builtintype" id="6307880">nil</span>&nbsp;<span class="op" id="6307884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307890">return</span>&nbsp;<span class="ident" id="6307897">err</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307904">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307908">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307911">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307914">if</span>&nbsp;<span class="ident" id="6307917">err</span>&nbsp;<span class="op" id="6307921">=</span>&nbsp;<span class="ident" id="6307923">c</span><span class="op" id="6307924">.</span><span class="ident" id="6307925">Mail</span><span class="op" id="6307929">(</span><span class="ident" id="6307930">from</span><span class="op" id="6307934">)</span><span class="op" id="6307935">;</span>&nbsp;<span class="ident" id="6307937">err</span>&nbsp;<span class="op" id="6307941">!=</span>&nbsp;<span class="builtintype" id="6307944">nil</span>&nbsp;<span class="op" id="6307948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307952">return</span>&nbsp;<span class="ident" id="6307959">err</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6307964">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307967">for</span>&nbsp;<span class="ident" id="6307971">_</span><span class="op" id="6307972">,</span>&nbsp;<span class="ident" id="6307974">addr</span>&nbsp;<span class="op" id="6307979">:=</span>&nbsp;<span class="keyword" id="6307982">range</span>&nbsp;<span class="ident" id="6307988">to</span>&nbsp;<span class="op" id="6307991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6307995">if</span>&nbsp;<span class="ident" id="6307998">err</span>&nbsp;<span class="op" id="6308002">=</span>&nbsp;<span class="ident" id="6308004">c</span><span class="op" id="6308005">.</span><span class="ident" id="6308006">Rcpt</span><span class="op" id="6308010">(</span><span class="ident" id="6308011">addr</span><span class="op" id="6308015">)</span><span class="op" id="6308016">;</span>&nbsp;<span class="ident" id="6308018">err</span>&nbsp;<span class="op" id="6308022">!=</span>&nbsp;<span class="builtintype" id="6308025">nil</span>&nbsp;<span class="op" id="6308029">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308034">return</span>&nbsp;<span class="ident" id="6308041">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308047">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308053">w</span><span class="op" id="6308054">,</span>&nbsp;<span class="ident" id="6308056">err</span>&nbsp;<span class="op" id="6308060">:=</span>&nbsp;<span class="ident" id="6308063">c</span><span class="op" id="6308064">.</span><span class="ident" id="6308065">Data</span><span class="op" id="6308069">(</span><span class="op" id="6308070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308073">if</span>&nbsp;<span class="ident" id="6308076">err</span>&nbsp;<span class="op" id="6308080">!=</span>&nbsp;<span class="builtintype" id="6308083">nil</span>&nbsp;<span class="op" id="6308087">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308091">return</span>&nbsp;<span class="ident" id="6308098">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308103">}</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308106">_</span><span class="op" id="6308107">,</span>&nbsp;<span class="ident" id="6308109">err</span>&nbsp;<span class="op" id="6308113">=</span>&nbsp;<span class="ident" id="6308115">w</span><span class="op" id="6308116">.</span><span class="ident" id="6308117">Write</span><span class="op" id="6308122">(</span><span class="ident" id="6308123">msg</span><span class="op" id="6308126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308129">if</span>&nbsp;<span class="ident" id="6308132">err</span>&nbsp;<span class="op" id="6308136">!=</span>&nbsp;<span class="builtintype" id="6308139">nil</span>&nbsp;<span class="op" id="6308143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308147">return</span>&nbsp;<span class="ident" id="6308154">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308162">err</span>&nbsp;<span class="op" id="6308166">=</span>&nbsp;<span class="ident" id="6308168">w</span><span class="op" id="6308169">.</span><span class="ident" id="6308170">Close</span><span class="op" id="6308175">(</span><span class="op" id="6308176">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308179">if</span>&nbsp;<span class="ident" id="6308182">err</span>&nbsp;<span class="op" id="6308186">!=</span>&nbsp;<span class="builtintype" id="6308189">nil</span>&nbsp;<span class="op" id="6308193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308197">return</span>&nbsp;<span class="ident" id="6308204">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308209">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308212">return</span>&nbsp;<span class="ident" id="6308219">c</span><span class="op" id="6308220">.</span><span class="ident" id="6308221">Quit</span><span class="op" id="6308225">(</span><span class="op" id="6308226">)</span><br>
<span class="lineno"></span><span class="op" id="6308228">}</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span><span class="comment" id="6308231">//&nbsp;Extension&nbsp;reports&nbsp;whether&nbsp;an&nbsp;extension&nbsp;is&nbsp;support&nbsp;by&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="comment" id="6308299">//&nbsp;The&nbsp;extension&nbsp;name&nbsp;is&nbsp;case-insensitive.&nbsp;If&nbsp;the&nbsp;extension&nbsp;is&nbsp;supported,</span><br>
<span class="lineno"></span><span class="comment" id="6308373">//&nbsp;Extension&nbsp;also&nbsp;returns&nbsp;a&nbsp;string&nbsp;that&nbsp;contains&nbsp;any&nbsp;parameters&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="6308441">//&nbsp;server&nbsp;specifies&nbsp;for&nbsp;the&nbsp;extension.</span><br>
<span class="lineno">325</span><span class="keyword" id="6308480">func</span>&nbsp;<span class="op" id="6308485">(</span><span class="ident" id="6308486">c</span>&nbsp;<span class="op" id="6308488">*</span><span class="ident" id="6308489">Client</span><span class="op" id="6308495">)</span>&nbsp;<span class="ident" id="6308497">Extension</span><span class="op" id="6308506">(</span><span class="ident" id="6308507">ext</span>&nbsp;<span class="builtintype" id="6308511">string</span><span class="op" id="6308517">)</span>&nbsp;<span class="op" id="6308519">(</span><span class="builtintype" id="6308520">bool</span><span class="op" id="6308524">,</span>&nbsp;<span class="builtintype" id="6308526">string</span><span class="op" id="6308532">)</span>&nbsp;<span class="op" id="6308534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308537">if</span>&nbsp;<span class="ident" id="6308540">err</span>&nbsp;<span class="op" id="6308544">:=</span>&nbsp;<span class="ident" id="6308547">c</span><span class="op" id="6308548">.</span><span class="ident" id="6308549">hello</span><span class="op" id="6308554">(</span><span class="op" id="6308555">)</span><span class="op" id="6308556">;</span>&nbsp;<span class="ident" id="6308558">err</span>&nbsp;<span class="op" id="6308562">!=</span>&nbsp;<span class="builtintype" id="6308565">nil</span>&nbsp;<span class="op" id="6308569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308573">return</span>&nbsp;<span class="builtintype" id="6308580">false</span><span class="op" id="6308585">,</span>&nbsp;<span class="string" id="6308587">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308591">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308594">if</span>&nbsp;<span class="ident" id="6308597">c</span><span class="op" id="6308598">.</span><span class="ident" id="6308599">ext</span>&nbsp;<span class="op" id="6308603">==</span>&nbsp;<span class="builtintype" id="6308606">nil</span>&nbsp;<span class="op" id="6308610">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308614">return</span>&nbsp;<span class="builtintype" id="6308621">false</span><span class="op" id="6308626">,</span>&nbsp;<span class="string" id="6308628">&#34;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308635">ext</span>&nbsp;<span class="op" id="6308639">=</span>&nbsp;<span class="ident" id="6308641">strings</span><span class="op" id="6308648">.</span><span class="ident" id="6308649">ToUpper</span><span class="op" id="6308656">(</span><span class="ident" id="6308657">ext</span><span class="op" id="6308660">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308663">param</span><span class="op" id="6308668">,</span>&nbsp;<span class="ident" id="6308670">ok</span>&nbsp;<span class="op" id="6308673">:=</span>&nbsp;<span class="ident" id="6308676">c</span><span class="op" id="6308677">.</span><span class="ident" id="6308678">ext</span><span class="op" id="6308681">[</span><span class="ident" id="6308682">ext</span><span class="op" id="6308685">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308688">return</span>&nbsp;<span class="ident" id="6308695">ok</span><span class="op" id="6308697">,</span>&nbsp;<span class="ident" id="6308699">param</span><br>
<span class="lineno">335</span><span class="op" id="6308705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308708">//&nbsp;Reset&nbsp;sends&nbsp;the&nbsp;RSET&nbsp;command&nbsp;to&nbsp;the&nbsp;server,&nbsp;aborting&nbsp;the&nbsp;current&nbsp;mail</span><br>
<span class="lineno"></span><span class="comment" id="6308781">//&nbsp;transaction.</span><br>
<span class="lineno"></span><span class="keyword" id="6308797">func</span>&nbsp;<span class="op" id="6308802">(</span><span class="ident" id="6308803">c</span>&nbsp;<span class="op" id="6308805">*</span><span class="ident" id="6308806">Client</span><span class="op" id="6308812">)</span>&nbsp;<span class="ident" id="6308814">Reset</span><span class="op" id="6308819">(</span><span class="op" id="6308820">)</span>&nbsp;<span class="builtintype" id="6308822">error</span>&nbsp;<span class="op" id="6308828">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308831">if</span>&nbsp;<span class="ident" id="6308834">err</span>&nbsp;<span class="op" id="6308838">:=</span>&nbsp;<span class="ident" id="6308841">c</span><span class="op" id="6308842">.</span><span class="ident" id="6308843">hello</span><span class="op" id="6308848">(</span><span class="op" id="6308849">)</span><span class="op" id="6308850">;</span>&nbsp;<span class="ident" id="6308852">err</span>&nbsp;<span class="op" id="6308856">!=</span>&nbsp;<span class="builtintype" id="6308859">nil</span>&nbsp;<span class="op" id="6308863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308867">return</span>&nbsp;<span class="ident" id="6308874">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6308879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6308882">_</span><span class="op" id="6308883">,</span>&nbsp;<span class="ident" id="6308885">_</span><span class="op" id="6308886">,</span>&nbsp;<span class="ident" id="6308888">err</span>&nbsp;<span class="op" id="6308892">:=</span>&nbsp;<span class="ident" id="6308895">c</span><span class="op" id="6308896">.</span><span class="ident" id="6308897">cmd</span><span class="op" id="6308900">(</span><span class="num" id="6308901">250</span><span class="op" id="6308904">,</span>&nbsp;<span class="string" id="6308906">&#34;RSET&#34;</span><span class="op" id="6308912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6308915">return</span>&nbsp;<span class="ident" id="6308922">err</span><br>
<span class="lineno">345</span><span class="op" id="6308926">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6308929">//&nbsp;Quit&nbsp;sends&nbsp;the&nbsp;QUIT&nbsp;command&nbsp;and&nbsp;closes&nbsp;the&nbsp;connection&nbsp;to&nbsp;the&nbsp;server.</span><br>
<span class="lineno"></span><span class="keyword" id="6309001">func</span>&nbsp;<span class="op" id="6309006">(</span><span class="ident" id="6309007">c</span>&nbsp;<span class="op" id="6309009">*</span><span class="ident" id="6309010">Client</span><span class="op" id="6309016">)</span>&nbsp;<span class="ident" id="6309018">Quit</span><span class="op" id="6309022">(</span><span class="op" id="6309023">)</span>&nbsp;<span class="builtintype" id="6309025">error</span>&nbsp;<span class="op" id="6309031">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309034">if</span>&nbsp;<span class="ident" id="6309037">err</span>&nbsp;<span class="op" id="6309041">:=</span>&nbsp;<span class="ident" id="6309044">c</span><span class="op" id="6309045">.</span><span class="ident" id="6309046">hello</span><span class="op" id="6309051">(</span><span class="op" id="6309052">)</span><span class="op" id="6309053">;</span>&nbsp;<span class="ident" id="6309055">err</span>&nbsp;<span class="op" id="6309059">!=</span>&nbsp;<span class="builtintype" id="6309062">nil</span>&nbsp;<span class="op" id="6309066">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309070">return</span>&nbsp;<span class="ident" id="6309077">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6309082">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6309085">_</span><span class="op" id="6309086">,</span>&nbsp;<span class="ident" id="6309088">_</span><span class="op" id="6309089">,</span>&nbsp;<span class="ident" id="6309091">err</span>&nbsp;<span class="op" id="6309095">:=</span>&nbsp;<span class="ident" id="6309098">c</span><span class="op" id="6309099">.</span><span class="ident" id="6309100">cmd</span><span class="op" id="6309103">(</span><span class="num" id="6309104">221</span><span class="op" id="6309107">,</span>&nbsp;<span class="string" id="6309109">&#34;QUIT&#34;</span><span class="op" id="6309115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309118">if</span>&nbsp;<span class="ident" id="6309121">err</span>&nbsp;<span class="op" id="6309125">!=</span>&nbsp;<span class="builtintype" id="6309128">nil</span>&nbsp;<span class="op" id="6309132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309136">return</span>&nbsp;<span class="ident" id="6309143">err</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6309148">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="6309151">return</span>&nbsp;<span class="ident" id="6309158">c</span><span class="op" id="6309159">.</span><span class="ident" id="6309160">Text</span><span class="op" id="6309164">.</span><span class="ident" id="6309165">Close</span><span class="op" id="6309170">(</span><span class="op" id="6309171">)</span><br>
<span class="lineno"></span><span class="op" id="6309173">}</span>
</div>
</body>
</html>
