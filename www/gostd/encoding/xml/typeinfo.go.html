<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/xml</h2>
<ul>
<li><a href="/gostd/encoding/xml/atom_test.go.html">atom_test.go</a></li>
<li><a href="/gostd/encoding/xml/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/xml/marshal.go.html">marshal.go</a></li>
<li><a href="/gostd/encoding/xml/marshal_test.go.html">marshal_test.go</a></li>
<li><a href="/gostd/encoding/xml/read.go.html">read.go</a></li>
<li><a href="/gostd/encoding/xml/read_test.go.html">read_test.go</a></li>
<li><a href="/gostd/encoding/xml/typeinfo.go.html" class="current">typeinfo.go</a></li>
<li><a href="/gostd/encoding/xml/xml.go.html">xml.go</a></li>
<li><a href="/gostd/encoding/xml/xml_test.go.html">xml_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6321255">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6321311">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6321365">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6321416">package</span>&nbsp;<span class="ident" id="6321424">xml</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6321429">import</span>&nbsp;<span class="op" id="6321436">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321439">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321446">&#34;reflect&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321457">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="6321468">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="6321475">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6321478">//&nbsp;typeInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;type.</span><br>
<span class="lineno">15</span><span class="keyword" id="6321542">type</span>&nbsp;<span class="ident" id="6321547">typeInfo</span>&nbsp;<span class="keyword" id="6321556">struct</span>&nbsp;<span class="op" id="6321563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321566">xmlname</span>&nbsp;<span class="op" id="6321574">*</span><span class="ident" id="6321575">fieldInfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321586">fields</span>&nbsp;&nbsp;<span class="op" id="6321594">[</span><span class="op" id="6321595">]</span><span class="ident" id="6321596">fieldInfo</span><br>
<span class="lineno"></span><span class="op" id="6321606">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="comment" id="6321609">//&nbsp;fieldInfo&nbsp;holds&nbsp;details&nbsp;for&nbsp;the&nbsp;xml&nbsp;representation&nbsp;of&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span><span class="keyword" id="6321682">type</span>&nbsp;<span class="ident" id="6321687">fieldInfo</span>&nbsp;<span class="keyword" id="6321697">struct</span>&nbsp;<span class="op" id="6321704">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321707">idx</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="6321715">[</span><span class="op" id="6321716">]</span><span class="builtintype" id="6321717">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321722">name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6321730">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321738">xmlns</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="6321746">string</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321754">flags</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="6321762">fieldFlags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321774">parents</span>&nbsp;<span class="op" id="6321782">[</span><span class="op" id="6321783">]</span><span class="builtintype" id="6321784">string</span><br>
<span class="lineno"></span><span class="op" id="6321791">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6321794">type</span>&nbsp;<span class="ident" id="6321799">fieldFlags</span>&nbsp;<span class="builtintype" id="6321810">int</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="keyword" id="6321815">const</span>&nbsp;<span class="op" id="6321821">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321824">fElement</span>&nbsp;<span class="ident" id="6321833">fieldFlags</span>&nbsp;<span class="op" id="6321844">=</span>&nbsp;<span class="num" id="6321846">1</span>&nbsp;<span class="op" id="6321848">&lt;&lt;</span>&nbsp;<span class="ident" id="6321851">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321857">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321864">fCharData</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321875">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321886">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321896">fAny</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321903">fOmitEmpty</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6321916">fMode</span>&nbsp;<span class="op" id="6321922">=</span>&nbsp;<span class="ident" id="6321924">fElement</span>&nbsp;<span class="op" id="6321933">|</span>&nbsp;<span class="ident" id="6321935">fAttr</span>&nbsp;<span class="op" id="6321941">|</span>&nbsp;<span class="ident" id="6321943">fCharData</span>&nbsp;<span class="op" id="6321953">|</span>&nbsp;<span class="ident" id="6321955">fInnerXml</span>&nbsp;<span class="op" id="6321965">|</span>&nbsp;<span class="ident" id="6321967">fComment</span>&nbsp;<span class="op" id="6321976">|</span>&nbsp;<span class="ident" id="6321978">fAny</span><br>
<span class="lineno"></span><span class="op" id="6321983">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6321986">var</span>&nbsp;<span class="ident" id="6321990">tinfoMap</span>&nbsp;<span class="op" id="6321999">=</span>&nbsp;<span class="builtinfunc" id="6322001">make</span><span class="op" id="6322005">(</span><span class="keyword" id="6322006">map</span><span class="op" id="6322009">[</span><span class="ident" id="6322010">reflect</span><span class="op" id="6322017">.</span><span class="ident" id="6322018">Type</span><span class="op" id="6322022">]</span><span class="op" id="6322023">*</span><span class="ident" id="6322024">typeInfo</span><span class="op" id="6322032">)</span><br>
<span class="lineno">45</span><span class="keyword" id="6322034">var</span>&nbsp;<span class="ident" id="6322038">tinfoLock</span>&nbsp;<span class="ident" id="6322048">sync</span><span class="op" id="6322052">.</span><span class="ident" id="6322053">RWMutex</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6322062">var</span>&nbsp;<span class="ident" id="6322066">nameType</span>&nbsp;<span class="op" id="6322075">=</span>&nbsp;<span class="ident" id="6322077">reflect</span><span class="op" id="6322084">.</span><span class="ident" id="6322085">TypeOf</span><span class="op" id="6322091">(</span><span class="ident" id="6322092">Name</span><span class="op" id="6322096">{</span><span class="op" id="6322097">}</span><span class="op" id="6322098">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6322101">//&nbsp;getTypeInfo&nbsp;returns&nbsp;the&nbsp;typeInfo&nbsp;structure&nbsp;with&nbsp;details&nbsp;necessary</span><br>
<span class="lineno">50</span><span class="comment" id="6322170">//&nbsp;for&nbsp;marshalling&nbsp;and&nbsp;unmarshalling&nbsp;typ.</span><br>
<span class="lineno"></span><span class="keyword" id="6322212">func</span>&nbsp;<span class="ident" id="6322217">getTypeInfo</span><span class="op" id="6322228">(</span><span class="ident" id="6322229">typ</span>&nbsp;<span class="ident" id="6322233">reflect</span><span class="op" id="6322240">.</span><span class="ident" id="6322241">Type</span><span class="op" id="6322245">)</span>&nbsp;<span class="op" id="6322247">(</span><span class="op" id="6322248">*</span><span class="ident" id="6322249">typeInfo</span><span class="op" id="6322257">,</span>&nbsp;<span class="builtintype" id="6322259">error</span><span class="op" id="6322264">)</span>&nbsp;<span class="op" id="6322266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322269">tinfoLock</span><span class="op" id="6322278">.</span><span class="ident" id="6322279">RLock</span><span class="op" id="6322284">(</span><span class="op" id="6322285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322288">tinfo</span><span class="op" id="6322293">,</span>&nbsp;<span class="ident" id="6322295">ok</span>&nbsp;<span class="op" id="6322298">:=</span>&nbsp;<span class="ident" id="6322301">tinfoMap</span><span class="op" id="6322309">[</span><span class="ident" id="6322310">typ</span><span class="op" id="6322313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322316">tinfoLock</span><span class="op" id="6322325">.</span><span class="ident" id="6322326">RUnlock</span><span class="op" id="6322333">(</span><span class="op" id="6322334">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322337">if</span>&nbsp;<span class="ident" id="6322340">ok</span>&nbsp;<span class="op" id="6322343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322347">return</span>&nbsp;<span class="ident" id="6322354">tinfo</span><span class="op" id="6322359">,</span>&nbsp;<span class="ident" id="6322361">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322366">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322369">tinfo</span>&nbsp;<span class="op" id="6322375">=</span>&nbsp;<span class="op" id="6322377">&amp;</span><span class="ident" id="6322378">typeInfo</span><span class="op" id="6322386">{</span><span class="op" id="6322387">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322390">if</span>&nbsp;<span class="ident" id="6322393">typ</span><span class="op" id="6322396">.</span><span class="ident" id="6322397">Kind</span><span class="op" id="6322401">(</span><span class="op" id="6322402">)</span>&nbsp;<span class="op" id="6322404">==</span>&nbsp;<span class="ident" id="6322407">reflect</span><span class="op" id="6322414">.</span><span class="ident" id="6322415">Struct</span>&nbsp;<span class="op" id="6322422">&amp;&amp;</span>&nbsp;<span class="ident" id="6322425">typ</span>&nbsp;<span class="op" id="6322429">!=</span>&nbsp;<span class="ident" id="6322432">nameType</span>&nbsp;<span class="op" id="6322441">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322445">n</span>&nbsp;<span class="op" id="6322447">:=</span>&nbsp;<span class="ident" id="6322450">typ</span><span class="op" id="6322453">.</span><span class="ident" id="6322454">NumField</span><span class="op" id="6322462">(</span><span class="op" id="6322463">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322467">for</span>&nbsp;<span class="ident" id="6322471">i</span>&nbsp;<span class="op" id="6322473">:=</span>&nbsp;<span class="num" id="6322476">0</span><span class="op" id="6322477">;</span>&nbsp;<span class="ident" id="6322479">i</span>&nbsp;<span class="op" id="6322481">&lt;</span>&nbsp;<span class="ident" id="6322483">n</span><span class="op" id="6322484">;</span>&nbsp;<span class="ident" id="6322486">i</span><span class="op" id="6322487">++</span>&nbsp;<span class="op" id="6322490">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322495">f</span>&nbsp;<span class="op" id="6322497">:=</span>&nbsp;<span class="ident" id="6322500">typ</span><span class="op" id="6322503">.</span><span class="ident" id="6322504">Field</span><span class="op" id="6322509">(</span><span class="ident" id="6322510">i</span><span class="op" id="6322511">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322516">if</span>&nbsp;<span class="ident" id="6322519">f</span><span class="op" id="6322520">.</span><span class="ident" id="6322521">PkgPath</span>&nbsp;<span class="op" id="6322529">!=</span>&nbsp;<span class="string" id="6322532">&#34;&#34;</span>&nbsp;<span class="op" id="6322535">||</span>&nbsp;<span class="ident" id="6322538">f</span><span class="op" id="6322539">.</span><span class="ident" id="6322540">Tag</span><span class="op" id="6322543">.</span><span class="ident" id="6322544">Get</span><span class="op" id="6322547">(</span><span class="string" id="6322548">&#34;xml&#34;</span><span class="op" id="6322553">)</span>&nbsp;<span class="op" id="6322555">==</span>&nbsp;<span class="string" id="6322558">&#34;-&#34;</span>&nbsp;<span class="op" id="6322562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322568">continue</span>&nbsp;<span class="comment" id="6322577">//&nbsp;Private&nbsp;field</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322597">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6322603">//&nbsp;For&nbsp;embedded&nbsp;structs,&nbsp;embed&nbsp;its&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322649">if</span>&nbsp;<span class="ident" id="6322652">f</span><span class="op" id="6322653">.</span><span class="ident" id="6322654">Anonymous</span>&nbsp;<span class="op" id="6322664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322670">t</span>&nbsp;<span class="op" id="6322672">:=</span>&nbsp;<span class="ident" id="6322675">f</span><span class="op" id="6322676">.</span><span class="ident" id="6322677">Type</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322686">if</span>&nbsp;<span class="ident" id="6322689">t</span><span class="op" id="6322690">.</span><span class="ident" id="6322691">Kind</span><span class="op" id="6322695">(</span><span class="op" id="6322696">)</span>&nbsp;<span class="op" id="6322698">==</span>&nbsp;<span class="ident" id="6322701">reflect</span><span class="op" id="6322708">.</span><span class="ident" id="6322709">Ptr</span>&nbsp;<span class="op" id="6322713">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322720">t</span>&nbsp;<span class="op" id="6322722">=</span>&nbsp;<span class="ident" id="6322724">t</span><span class="op" id="6322725">.</span><span class="ident" id="6322726">Elem</span><span class="op" id="6322730">(</span><span class="op" id="6322731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322737">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322743">if</span>&nbsp;<span class="ident" id="6322746">t</span><span class="op" id="6322747">.</span><span class="ident" id="6322748">Kind</span><span class="op" id="6322752">(</span><span class="op" id="6322753">)</span>&nbsp;<span class="op" id="6322755">==</span>&nbsp;<span class="ident" id="6322758">reflect</span><span class="op" id="6322765">.</span><span class="ident" id="6322766">Struct</span>&nbsp;<span class="op" id="6322773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322780">inner</span><span class="op" id="6322785">,</span>&nbsp;<span class="ident" id="6322787">err</span>&nbsp;<span class="op" id="6322791">:=</span>&nbsp;<span class="ident" id="6322794">getTypeInfo</span><span class="op" id="6322805">(</span><span class="ident" id="6322806">t</span><span class="op" id="6322807">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322814">if</span>&nbsp;<span class="ident" id="6322817">err</span>&nbsp;<span class="op" id="6322821">!=</span>&nbsp;<span class="ident" id="6322824">nil</span>&nbsp;<span class="op" id="6322828">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322836">return</span>&nbsp;<span class="ident" id="6322843">nil</span><span class="op" id="6322846">,</span>&nbsp;<span class="ident" id="6322848">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322864">if</span>&nbsp;<span class="ident" id="6322867">tinfo</span><span class="op" id="6322872">.</span><span class="ident" id="6322873">xmlname</span>&nbsp;<span class="op" id="6322881">==</span>&nbsp;<span class="ident" id="6322884">nil</span>&nbsp;<span class="op" id="6322888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322896">tinfo</span><span class="op" id="6322901">.</span><span class="ident" id="6322902">xmlname</span>&nbsp;<span class="op" id="6322910">=</span>&nbsp;<span class="ident" id="6322912">inner</span><span class="op" id="6322917">.</span><span class="ident" id="6322918">xmlname</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6322931">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6322938">for</span>&nbsp;<span class="ident" id="6322942">_</span><span class="op" id="6322943">,</span>&nbsp;<span class="ident" id="6322945">finfo</span>&nbsp;<span class="op" id="6322951">:=</span>&nbsp;<span class="keyword" id="6322954">range</span>&nbsp;<span class="ident" id="6322960">inner</span><span class="op" id="6322965">.</span><span class="ident" id="6322966">fields</span>&nbsp;<span class="op" id="6322973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6322981">finfo</span><span class="op" id="6322986">.</span><span class="ident" id="6322987">idx</span>&nbsp;<span class="op" id="6322991">=</span>&nbsp;<span class="builtinfunc" id="6322993">append</span><span class="op" id="6322999">(</span><span class="op" id="6323000">[</span><span class="op" id="6323001">]</span><span class="builtintype" id="6323002">int</span><span class="op" id="6323005">{</span><span class="ident" id="6323006">i</span><span class="op" id="6323007">}</span><span class="op" id="6323008">,</span>&nbsp;<span class="ident" id="6323010">finfo</span><span class="op" id="6323015">.</span><span class="ident" id="6323016">idx</span><span class="op" id="6323019">...</span><span class="op" id="6323022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323030">if</span>&nbsp;<span class="ident" id="6323033">err</span>&nbsp;<span class="op" id="6323037">:=</span>&nbsp;<span class="ident" id="6323040">addFieldInfo</span><span class="op" id="6323052">(</span><span class="ident" id="6323053">typ</span><span class="op" id="6323056">,</span>&nbsp;<span class="ident" id="6323058">tinfo</span><span class="op" id="6323063">,</span>&nbsp;<span class="op" id="6323065">&amp;</span><span class="ident" id="6323066">finfo</span><span class="op" id="6323071">)</span><span class="op" id="6323072">;</span>&nbsp;<span class="ident" id="6323074">err</span>&nbsp;<span class="op" id="6323078">!=</span>&nbsp;<span class="ident" id="6323081">nil</span>&nbsp;<span class="op" id="6323085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323094">return</span>&nbsp;<span class="ident" id="6323101">nil</span><span class="op" id="6323104">,</span>&nbsp;<span class="ident" id="6323106">err</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323116">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323123">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323130">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323143">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323148">}</span><br>
<span class="lineno">90</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323154">finfo</span><span class="op" id="6323159">,</span>&nbsp;<span class="ident" id="6323161">err</span>&nbsp;<span class="op" id="6323165">:=</span>&nbsp;<span class="ident" id="6323168">structFieldInfo</span><span class="op" id="6323183">(</span><span class="ident" id="6323184">typ</span><span class="op" id="6323187">,</span>&nbsp;<span class="op" id="6323189">&amp;</span><span class="ident" id="6323190">f</span><span class="op" id="6323191">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323196">if</span>&nbsp;<span class="ident" id="6323199">err</span>&nbsp;<span class="op" id="6323203">!=</span>&nbsp;<span class="ident" id="6323206">nil</span>&nbsp;<span class="op" id="6323210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323216">return</span>&nbsp;<span class="ident" id="6323223">nil</span><span class="op" id="6323226">,</span>&nbsp;<span class="ident" id="6323228">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323235">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323241">if</span>&nbsp;<span class="ident" id="6323244">f</span><span class="op" id="6323245">.</span><span class="ident" id="6323246">Name</span>&nbsp;<span class="op" id="6323251">==</span>&nbsp;<span class="string" id="6323254">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6323264">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323270">tinfo</span><span class="op" id="6323275">.</span><span class="ident" id="6323276">xmlname</span>&nbsp;<span class="op" id="6323284">=</span>&nbsp;<span class="ident" id="6323286">finfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323296">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323308">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323314">//&nbsp;Add&nbsp;the&nbsp;field&nbsp;if&nbsp;it&nbsp;doesn&#39;t&nbsp;conflict&nbsp;with&nbsp;other&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323376">if</span>&nbsp;<span class="ident" id="6323379">err</span>&nbsp;<span class="op" id="6323383">:=</span>&nbsp;<span class="ident" id="6323386">addFieldInfo</span><span class="op" id="6323398">(</span><span class="ident" id="6323399">typ</span><span class="op" id="6323402">,</span>&nbsp;<span class="ident" id="6323404">tinfo</span><span class="op" id="6323409">,</span>&nbsp;<span class="ident" id="6323411">finfo</span><span class="op" id="6323416">)</span><span class="op" id="6323417">;</span>&nbsp;<span class="ident" id="6323419">err</span>&nbsp;<span class="op" id="6323423">!=</span>&nbsp;<span class="ident" id="6323426">nil</span>&nbsp;<span class="op" id="6323430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323436">return</span>&nbsp;<span class="ident" id="6323443">nil</span><span class="op" id="6323446">,</span>&nbsp;<span class="ident" id="6323448">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323455">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323462">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323465">tinfoLock</span><span class="op" id="6323474">.</span><span class="ident" id="6323475">Lock</span><span class="op" id="6323479">(</span><span class="op" id="6323480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323483">tinfoMap</span><span class="op" id="6323491">[</span><span class="ident" id="6323492">typ</span><span class="op" id="6323495">]</span>&nbsp;<span class="op" id="6323497">=</span>&nbsp;<span class="ident" id="6323499">tinfo</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323506">tinfoLock</span><span class="op" id="6323515">.</span><span class="ident" id="6323516">Unlock</span><span class="op" id="6323522">(</span><span class="op" id="6323523">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323526">return</span>&nbsp;<span class="ident" id="6323533">tinfo</span><span class="op" id="6323538">,</span>&nbsp;<span class="ident" id="6323540">nil</span><br>
<span class="lineno"></span><span class="op" id="6323544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6323547">//&nbsp;structFieldInfo&nbsp;builds&nbsp;and&nbsp;returns&nbsp;a&nbsp;fieldInfo&nbsp;for&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="6323604">func</span>&nbsp;<span class="ident" id="6323609">structFieldInfo</span><span class="op" id="6323624">(</span><span class="ident" id="6323625">typ</span>&nbsp;<span class="ident" id="6323629">reflect</span><span class="op" id="6323636">.</span><span class="ident" id="6323637">Type</span><span class="op" id="6323641">,</span>&nbsp;<span class="ident" id="6323643">f</span>&nbsp;<span class="op" id="6323645">*</span><span class="ident" id="6323646">reflect</span><span class="op" id="6323653">.</span><span class="ident" id="6323654">StructField</span><span class="op" id="6323665">)</span>&nbsp;<span class="op" id="6323667">(</span><span class="op" id="6323668">*</span><span class="ident" id="6323669">fieldInfo</span><span class="op" id="6323678">,</span>&nbsp;<span class="builtintype" id="6323680">error</span><span class="op" id="6323685">)</span>&nbsp;<span class="op" id="6323687">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323690">finfo</span>&nbsp;<span class="op" id="6323696">:=</span>&nbsp;<span class="op" id="6323699">&amp;</span><span class="ident" id="6323700">fieldInfo</span><span class="op" id="6323709">{</span><span class="ident" id="6323710">idx</span><span class="op" id="6323713">:</span>&nbsp;<span class="ident" id="6323715">f</span><span class="op" id="6323716">.</span><span class="ident" id="6323717">Index</span><span class="op" id="6323722">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323726">//&nbsp;Split&nbsp;the&nbsp;tag&nbsp;from&nbsp;the&nbsp;xml&nbsp;namespace&nbsp;if&nbsp;necessary.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323781">tag</span>&nbsp;<span class="op" id="6323785">:=</span>&nbsp;<span class="ident" id="6323788">f</span><span class="op" id="6323789">.</span><span class="ident" id="6323790">Tag</span><span class="op" id="6323793">.</span><span class="ident" id="6323794">Get</span><span class="op" id="6323797">(</span><span class="string" id="6323798">&#34;xml&#34;</span><span class="op" id="6323803">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323806">if</span>&nbsp;<span class="ident" id="6323809">i</span>&nbsp;<span class="op" id="6323811">:=</span>&nbsp;<span class="ident" id="6323814">strings</span><span class="op" id="6323821">.</span><span class="ident" id="6323822">Index</span><span class="op" id="6323827">(</span><span class="ident" id="6323828">tag</span><span class="op" id="6323831">,</span>&nbsp;<span class="string" id="6323833">&#34;&nbsp;&#34;</span><span class="op" id="6323836">)</span><span class="op" id="6323837">;</span>&nbsp;<span class="ident" id="6323839">i</span>&nbsp;<span class="op" id="6323841">&gt;=</span>&nbsp;<span class="num" id="6323844">0</span>&nbsp;<span class="op" id="6323846">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323850">finfo</span><span class="op" id="6323855">.</span><span class="ident" id="6323856">xmlns</span><span class="op" id="6323861">,</span>&nbsp;<span class="ident" id="6323863">tag</span>&nbsp;<span class="op" id="6323867">=</span>&nbsp;<span class="ident" id="6323869">tag</span><span class="op" id="6323872">[</span><span class="op" id="6323873">:</span><span class="ident" id="6323874">i</span><span class="op" id="6323875">]</span><span class="op" id="6323876">,</span>&nbsp;<span class="ident" id="6323878">tag</span><span class="op" id="6323881">[</span><span class="ident" id="6323882">i</span><span class="op" id="6323883">+</span><span class="num" id="6323884">1</span><span class="op" id="6323885">:</span><span class="op" id="6323886">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6323893">//&nbsp;Parse&nbsp;flags.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323910">tokens</span>&nbsp;<span class="op" id="6323917">:=</span>&nbsp;<span class="ident" id="6323920">strings</span><span class="op" id="6323927">.</span><span class="ident" id="6323928">Split</span><span class="op" id="6323933">(</span><span class="ident" id="6323934">tag</span><span class="op" id="6323937">,</span>&nbsp;<span class="string" id="6323939">&#34;,&#34;</span><span class="op" id="6323942">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6323945">if</span>&nbsp;<span class="builtinfunc" id="6323948">len</span><span class="op" id="6323951">(</span><span class="ident" id="6323952">tokens</span><span class="op" id="6323958">)</span>&nbsp;<span class="op" id="6323960">==</span>&nbsp;<span class="num" id="6323963">1</span>&nbsp;<span class="op" id="6323965">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6323969">finfo</span><span class="op" id="6323974">.</span><span class="ident" id="6323975">flags</span>&nbsp;<span class="op" id="6323981">=</span>&nbsp;<span class="ident" id="6323983">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6323993">}</span>&nbsp;<span class="keyword" id="6323995">else</span>&nbsp;<span class="op" id="6324000">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324004">tag</span>&nbsp;<span class="op" id="6324008">=</span>&nbsp;<span class="ident" id="6324010">tokens</span><span class="op" id="6324016">[</span><span class="num" id="6324017">0</span><span class="op" id="6324018">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324022">for</span>&nbsp;<span class="ident" id="6324026">_</span><span class="op" id="6324027">,</span>&nbsp;<span class="ident" id="6324029">flag</span>&nbsp;<span class="op" id="6324034">:=</span>&nbsp;<span class="keyword" id="6324037">range</span>&nbsp;<span class="ident" id="6324043">tokens</span><span class="op" id="6324049">[</span><span class="num" id="6324050">1</span><span class="op" id="6324051">:</span><span class="op" id="6324052">]</span>&nbsp;<span class="op" id="6324054">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324059">switch</span>&nbsp;<span class="ident" id="6324066">flag</span>&nbsp;<span class="op" id="6324071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324076">case</span>&nbsp;<span class="string" id="6324081">&#34;attr&#34;</span><span class="op" id="6324087">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324093">finfo</span><span class="op" id="6324098">.</span><span class="ident" id="6324099">flags</span>&nbsp;<span class="op" id="6324105">|=</span>&nbsp;<span class="ident" id="6324108">fAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324117">case</span>&nbsp;<span class="string" id="6324122">&#34;chardata&#34;</span><span class="op" id="6324132">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324138">finfo</span><span class="op" id="6324143">.</span><span class="ident" id="6324144">flags</span>&nbsp;<span class="op" id="6324150">|=</span>&nbsp;<span class="ident" id="6324153">fCharData</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324166">case</span>&nbsp;<span class="string" id="6324171">&#34;innerxml&#34;</span><span class="op" id="6324181">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324187">finfo</span><span class="op" id="6324192">.</span><span class="ident" id="6324193">flags</span>&nbsp;<span class="op" id="6324199">|=</span>&nbsp;<span class="ident" id="6324202">fInnerXml</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324215">case</span>&nbsp;<span class="string" id="6324220">&#34;comment&#34;</span><span class="op" id="6324229">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324235">finfo</span><span class="op" id="6324240">.</span><span class="ident" id="6324241">flags</span>&nbsp;<span class="op" id="6324247">|=</span>&nbsp;<span class="ident" id="6324250">fComment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324262">case</span>&nbsp;<span class="string" id="6324267">&#34;any&#34;</span><span class="op" id="6324272">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324278">finfo</span><span class="op" id="6324283">.</span><span class="ident" id="6324284">flags</span>&nbsp;<span class="op" id="6324290">|=</span>&nbsp;<span class="ident" id="6324293">fAny</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324301">case</span>&nbsp;<span class="string" id="6324306">&#34;omitempty&#34;</span><span class="op" id="6324317">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324323">finfo</span><span class="op" id="6324328">.</span><span class="ident" id="6324329">flags</span>&nbsp;<span class="op" id="6324335">|=</span>&nbsp;<span class="ident" id="6324338">fOmitEmpty</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324352">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324356">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324361">//&nbsp;Validate&nbsp;the&nbsp;flags&nbsp;used.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324391">valid</span>&nbsp;<span class="op" id="6324397">:=</span>&nbsp;<span class="builtintype" id="6324400">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324407">switch</span>&nbsp;<span class="ident" id="6324414">mode</span>&nbsp;<span class="op" id="6324419">:=</span>&nbsp;<span class="ident" id="6324422">finfo</span><span class="op" id="6324427">.</span><span class="ident" id="6324428">flags</span>&nbsp;<span class="op" id="6324434">&amp;</span>&nbsp;<span class="ident" id="6324436">fMode</span><span class="op" id="6324441">;</span>&nbsp;<span class="ident" id="6324443">mode</span>&nbsp;<span class="op" id="6324448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324452">case</span>&nbsp;<span class="num" id="6324457">0</span><span class="op" id="6324458">:</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324463">finfo</span><span class="op" id="6324468">.</span><span class="ident" id="6324469">flags</span>&nbsp;<span class="op" id="6324475">|=</span>&nbsp;<span class="ident" id="6324478">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324489">case</span>&nbsp;<span class="ident" id="6324494">fAttr</span><span class="op" id="6324499">,</span>&nbsp;<span class="ident" id="6324501">fCharData</span><span class="op" id="6324510">,</span>&nbsp;<span class="ident" id="6324512">fInnerXml</span><span class="op" id="6324521">,</span>&nbsp;<span class="ident" id="6324523">fComment</span><span class="op" id="6324531">,</span>&nbsp;<span class="ident" id="6324533">fAny</span><span class="op" id="6324537">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324542">if</span>&nbsp;<span class="ident" id="6324545">f</span><span class="op" id="6324546">.</span><span class="ident" id="6324547">Name</span>&nbsp;<span class="op" id="6324552">==</span>&nbsp;<span class="string" id="6324555">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6324565">||</span>&nbsp;<span class="ident" id="6324568">tag</span>&nbsp;<span class="op" id="6324572">!=</span>&nbsp;<span class="string" id="6324575">&#34;&#34;</span>&nbsp;<span class="op" id="6324578">&amp;&amp;</span>&nbsp;<span class="ident" id="6324581">mode</span>&nbsp;<span class="op" id="6324586">!=</span>&nbsp;<span class="ident" id="6324589">fAttr</span>&nbsp;<span class="op" id="6324595">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324601">valid</span>&nbsp;<span class="op" id="6324607">=</span>&nbsp;<span class="builtintype" id="6324609">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324618">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324622">default</span><span class="op" id="6324629">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6324634">//&nbsp;This&nbsp;will&nbsp;also&nbsp;catch&nbsp;multiple&nbsp;modes&nbsp;in&nbsp;a&nbsp;single&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324695">valid</span>&nbsp;<span class="op" id="6324701">=</span>&nbsp;<span class="builtintype" id="6324703">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324711">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324715">if</span>&nbsp;<span class="ident" id="6324718">finfo</span><span class="op" id="6324723">.</span><span class="ident" id="6324724">flags</span><span class="op" id="6324729">&amp;</span><span class="ident" id="6324730">fMode</span>&nbsp;<span class="op" id="6324736">==</span>&nbsp;<span class="ident" id="6324739">fAny</span>&nbsp;<span class="op" id="6324744">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324749">finfo</span><span class="op" id="6324754">.</span><span class="ident" id="6324755">flags</span>&nbsp;<span class="op" id="6324761">|=</span>&nbsp;<span class="ident" id="6324764">fElement</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324779">if</span>&nbsp;<span class="ident" id="6324782">finfo</span><span class="op" id="6324787">.</span><span class="ident" id="6324788">flags</span><span class="op" id="6324793">&amp;</span><span class="ident" id="6324794">fOmitEmpty</span>&nbsp;<span class="op" id="6324805">!=</span>&nbsp;<span class="num" id="6324808">0</span>&nbsp;<span class="op" id="6324810">&amp;&amp;</span>&nbsp;<span class="ident" id="6324813">finfo</span><span class="op" id="6324818">.</span><span class="ident" id="6324819">flags</span><span class="op" id="6324824">&amp;</span><span class="op" id="6324825">(</span><span class="ident" id="6324826">fElement</span><span class="op" id="6324834">|</span><span class="ident" id="6324835">fAttr</span><span class="op" id="6324840">)</span>&nbsp;<span class="op" id="6324842">==</span>&nbsp;<span class="num" id="6324845">0</span>&nbsp;<span class="op" id="6324847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324852">valid</span>&nbsp;<span class="op" id="6324858">=</span>&nbsp;<span class="builtintype" id="6324860">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324868">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324872">if</span>&nbsp;<span class="op" id="6324875">!</span><span class="ident" id="6324876">valid</span>&nbsp;<span class="op" id="6324882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6324887">return</span>&nbsp;<span class="ident" id="6324894">nil</span><span class="op" id="6324897">,</span>&nbsp;<span class="ident" id="6324899">fmt</span><span class="op" id="6324902">.</span><span class="ident" id="6324903">Errorf</span><span class="op" id="6324909">(</span><span class="string" id="6324910">&#34;xml:&nbsp;invalid&nbsp;tag&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6324955">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6324961">f</span><span class="op" id="6324962">.</span><span class="ident" id="6324963">Name</span><span class="op" id="6324967">,</span>&nbsp;<span class="ident" id="6324969">typ</span><span class="op" id="6324972">,</span>&nbsp;<span class="ident" id="6324974">f</span><span class="op" id="6324975">.</span><span class="ident" id="6324976">Tag</span><span class="op" id="6324979">.</span><span class="ident" id="6324980">Get</span><span class="op" id="6324983">(</span><span class="string" id="6324984">&#34;xml&#34;</span><span class="op" id="6324989">)</span><span class="op" id="6324990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324994">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6324997">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325001">//&nbsp;Use&nbsp;of&nbsp;xmlns&nbsp;without&nbsp;a&nbsp;name&nbsp;is&nbsp;not&nbsp;allowed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325049">if</span>&nbsp;<span class="ident" id="6325052">finfo</span><span class="op" id="6325057">.</span><span class="ident" id="6325058">xmlns</span>&nbsp;<span class="op" id="6325064">!=</span>&nbsp;<span class="string" id="6325067">&#34;&#34;</span>&nbsp;<span class="op" id="6325070">&amp;&amp;</span>&nbsp;<span class="ident" id="6325073">tag</span>&nbsp;<span class="op" id="6325077">==</span>&nbsp;<span class="string" id="6325080">&#34;&#34;</span>&nbsp;<span class="op" id="6325083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325087">return</span>&nbsp;<span class="ident" id="6325094">nil</span><span class="op" id="6325097">,</span>&nbsp;<span class="ident" id="6325099">fmt</span><span class="op" id="6325102">.</span><span class="ident" id="6325103">Errorf</span><span class="op" id="6325109">(</span><span class="string" id="6325110">&#34;xml:&nbsp;namespace&nbsp;without&nbsp;name&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s:&nbsp;%q&#34;</span><span class="op" id="6325166">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325171">f</span><span class="op" id="6325172">.</span><span class="ident" id="6325173">Name</span><span class="op" id="6325177">,</span>&nbsp;<span class="ident" id="6325179">typ</span><span class="op" id="6325182">,</span>&nbsp;<span class="ident" id="6325184">f</span><span class="op" id="6325185">.</span><span class="ident" id="6325186">Tag</span><span class="op" id="6325189">.</span><span class="ident" id="6325190">Get</span><span class="op" id="6325193">(</span><span class="string" id="6325194">&#34;xml&#34;</span><span class="op" id="6325199">)</span><span class="op" id="6325200">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325207">if</span>&nbsp;<span class="ident" id="6325210">f</span><span class="op" id="6325211">.</span><span class="ident" id="6325212">Name</span>&nbsp;<span class="op" id="6325217">==</span>&nbsp;<span class="string" id="6325220">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6325230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325234">//&nbsp;The&nbsp;XMLName&nbsp;field&nbsp;records&nbsp;the&nbsp;XML&nbsp;element&nbsp;name.&nbsp;Don&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325293">//&nbsp;process&nbsp;it&nbsp;as&nbsp;usual&nbsp;because&nbsp;its&nbsp;name&nbsp;should&nbsp;default&nbsp;to</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325353">//&nbsp;empty&nbsp;rather&nbsp;than&nbsp;to&nbsp;the&nbsp;field&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325395">finfo</span><span class="op" id="6325400">.</span><span class="ident" id="6325401">name</span>&nbsp;<span class="op" id="6325406">=</span>&nbsp;<span class="ident" id="6325408">tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325414">return</span>&nbsp;<span class="ident" id="6325421">finfo</span><span class="op" id="6325426">,</span>&nbsp;<span class="ident" id="6325428">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325433">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325437">if</span>&nbsp;<span class="ident" id="6325440">tag</span>&nbsp;<span class="op" id="6325444">==</span>&nbsp;<span class="string" id="6325447">&#34;&#34;</span>&nbsp;<span class="op" id="6325450">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325454">//&nbsp;If&nbsp;the&nbsp;name&nbsp;part&nbsp;of&nbsp;the&nbsp;tag&nbsp;is&nbsp;completely&nbsp;empty,&nbsp;get</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325512">//&nbsp;default&nbsp;from&nbsp;XMLName&nbsp;of&nbsp;underlying&nbsp;struct&nbsp;if&nbsp;feasible,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325572">//&nbsp;or&nbsp;field&nbsp;name&nbsp;otherwise.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325602">if</span>&nbsp;<span class="ident" id="6325605">xmlname</span>&nbsp;<span class="op" id="6325613">:=</span>&nbsp;<span class="ident" id="6325616">lookupXMLName</span><span class="op" id="6325629">(</span><span class="ident" id="6325630">f</span><span class="op" id="6325631">.</span><span class="ident" id="6325632">Type</span><span class="op" id="6325636">)</span><span class="op" id="6325637">;</span>&nbsp;<span class="ident" id="6325639">xmlname</span>&nbsp;<span class="op" id="6325647">!=</span>&nbsp;<span class="ident" id="6325650">nil</span>&nbsp;<span class="op" id="6325654">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325659">finfo</span><span class="op" id="6325664">.</span><span class="ident" id="6325665">xmlns</span><span class="op" id="6325670">,</span>&nbsp;<span class="ident" id="6325672">finfo</span><span class="op" id="6325677">.</span><span class="ident" id="6325678">name</span>&nbsp;<span class="op" id="6325683">=</span>&nbsp;<span class="ident" id="6325685">xmlname</span><span class="op" id="6325692">.</span><span class="ident" id="6325693">xmlns</span><span class="op" id="6325698">,</span>&nbsp;<span class="ident" id="6325700">xmlname</span><span class="op" id="6325707">.</span><span class="ident" id="6325708">name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325715">}</span>&nbsp;<span class="keyword" id="6325717">else</span>&nbsp;<span class="op" id="6325722">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325727">finfo</span><span class="op" id="6325732">.</span><span class="ident" id="6325733">name</span>&nbsp;<span class="op" id="6325738">=</span>&nbsp;<span class="ident" id="6325740">f</span><span class="op" id="6325741">.</span><span class="ident" id="6325742">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325749">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325753">return</span>&nbsp;<span class="ident" id="6325760">finfo</span><span class="op" id="6325765">,</span>&nbsp;<span class="ident" id="6325767">nil</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6325776">//&nbsp;Prepare&nbsp;field&nbsp;name&nbsp;and&nbsp;parents.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325812">parents</span>&nbsp;<span class="op" id="6325820">:=</span>&nbsp;<span class="ident" id="6325823">strings</span><span class="op" id="6325830">.</span><span class="ident" id="6325831">Split</span><span class="op" id="6325836">(</span><span class="ident" id="6325837">tag</span><span class="op" id="6325840">,</span>&nbsp;<span class="string" id="6325842">&#34;&gt;&#34;</span><span class="op" id="6325845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325848">if</span>&nbsp;<span class="ident" id="6325851">parents</span><span class="op" id="6325858">[</span><span class="num" id="6325859">0</span><span class="op" id="6325860">]</span>&nbsp;<span class="op" id="6325862">==</span>&nbsp;<span class="string" id="6325865">&#34;&#34;</span>&nbsp;<span class="op" id="6325868">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6325872">parents</span><span class="op" id="6325879">[</span><span class="num" id="6325880">0</span><span class="op" id="6325881">]</span>&nbsp;<span class="op" id="6325883">=</span>&nbsp;<span class="ident" id="6325885">f</span><span class="op" id="6325886">.</span><span class="ident" id="6325887">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6325893">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325896">if</span>&nbsp;<span class="ident" id="6325899">parents</span><span class="op" id="6325906">[</span><span class="builtinfunc" id="6325907">len</span><span class="op" id="6325910">(</span><span class="ident" id="6325911">parents</span><span class="op" id="6325918">)</span><span class="op" id="6325919">-</span><span class="num" id="6325920">1</span><span class="op" id="6325921">]</span>&nbsp;<span class="op" id="6325923">==</span>&nbsp;<span class="string" id="6325926">&#34;&#34;</span>&nbsp;<span class="op" id="6325929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6325933">return</span>&nbsp;<span class="ident" id="6325940">nil</span><span class="op" id="6325943">,</span>&nbsp;<span class="ident" id="6325945">fmt</span><span class="op" id="6325948">.</span><span class="ident" id="6325949">Errorf</span><span class="op" id="6325955">(</span><span class="string" id="6325956">&#34;xml:&nbsp;trailing&nbsp;&#39;&gt;&#39;&nbsp;in&nbsp;field&nbsp;%s&nbsp;of&nbsp;type&nbsp;%s&#34;</span><span class="op" id="6325998">,</span>&nbsp;<span class="ident" id="6326000">f</span><span class="op" id="6326001">.</span><span class="ident" id="6326002">Name</span><span class="op" id="6326006">,</span>&nbsp;<span class="ident" id="6326008">typ</span><span class="op" id="6326011">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326014">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326017">finfo</span><span class="op" id="6326022">.</span><span class="ident" id="6326023">name</span>&nbsp;<span class="op" id="6326028">=</span>&nbsp;<span class="ident" id="6326030">parents</span><span class="op" id="6326037">[</span><span class="builtinfunc" id="6326038">len</span><span class="op" id="6326041">(</span><span class="ident" id="6326042">parents</span><span class="op" id="6326049">)</span><span class="op" id="6326050">-</span><span class="num" id="6326051">1</span><span class="op" id="6326052">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326055">if</span>&nbsp;<span class="builtinfunc" id="6326058">len</span><span class="op" id="6326061">(</span><span class="ident" id="6326062">parents</span><span class="op" id="6326069">)</span>&nbsp;<span class="op" id="6326071">&gt;</span>&nbsp;<span class="num" id="6326073">1</span>&nbsp;<span class="op" id="6326075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326079">if</span>&nbsp;<span class="op" id="6326082">(</span><span class="ident" id="6326083">finfo</span><span class="op" id="6326088">.</span><span class="ident" id="6326089">flags</span>&nbsp;<span class="op" id="6326095">&amp;</span>&nbsp;<span class="ident" id="6326097">fElement</span><span class="op" id="6326105">)</span>&nbsp;<span class="op" id="6326107">==</span>&nbsp;<span class="num" id="6326110">0</span>&nbsp;<span class="op" id="6326112">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326117">return</span>&nbsp;<span class="ident" id="6326124">nil</span><span class="op" id="6326127">,</span>&nbsp;<span class="ident" id="6326129">fmt</span><span class="op" id="6326132">.</span><span class="ident" id="6326133">Errorf</span><span class="op" id="6326139">(</span><span class="string" id="6326140">&#34;xml:&nbsp;%s&nbsp;chain&nbsp;not&nbsp;valid&nbsp;with&nbsp;%s&nbsp;flag&#34;</span><span class="op" id="6326178">,</span>&nbsp;<span class="ident" id="6326180">tag</span><span class="op" id="6326183">,</span>&nbsp;<span class="ident" id="6326185">strings</span><span class="op" id="6326192">.</span><span class="ident" id="6326193">Join</span><span class="op" id="6326197">(</span><span class="ident" id="6326198">tokens</span><span class="op" id="6326204">[</span><span class="num" id="6326205">1</span><span class="op" id="6326206">:</span><span class="op" id="6326207">]</span><span class="op" id="6326208">,</span>&nbsp;<span class="string" id="6326210">&#34;,&#34;</span><span class="op" id="6326213">)</span><span class="op" id="6326214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326218">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326222">finfo</span><span class="op" id="6326227">.</span><span class="ident" id="6326228">parents</span>&nbsp;<span class="op" id="6326236">=</span>&nbsp;<span class="ident" id="6326238">parents</span><span class="op" id="6326245">[</span><span class="op" id="6326246">:</span><span class="builtinfunc" id="6326247">len</span><span class="op" id="6326250">(</span><span class="ident" id="6326251">parents</span><span class="op" id="6326258">)</span><span class="op" id="6326259">-</span><span class="num" id="6326260">1</span><span class="op" id="6326261">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326264">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326268">//&nbsp;If&nbsp;the&nbsp;field&nbsp;type&nbsp;has&nbsp;an&nbsp;XMLName&nbsp;field,&nbsp;the&nbsp;names&nbsp;must&nbsp;match</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326333">//&nbsp;so&nbsp;that&nbsp;the&nbsp;behavior&nbsp;of&nbsp;both&nbsp;marshalling&nbsp;and&nbsp;unmarshalling</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6326396">//&nbsp;is&nbsp;straightforward&nbsp;and&nbsp;unambiguous.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326436">if</span>&nbsp;<span class="ident" id="6326439">finfo</span><span class="op" id="6326444">.</span><span class="ident" id="6326445">flags</span><span class="op" id="6326450">&amp;</span><span class="ident" id="6326451">fElement</span>&nbsp;<span class="op" id="6326460">!=</span>&nbsp;<span class="num" id="6326463">0</span>&nbsp;<span class="op" id="6326465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326469">ftyp</span>&nbsp;<span class="op" id="6326474">:=</span>&nbsp;<span class="ident" id="6326477">f</span><span class="op" id="6326478">.</span><span class="ident" id="6326479">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326486">xmlname</span>&nbsp;<span class="op" id="6326494">:=</span>&nbsp;<span class="ident" id="6326497">lookupXMLName</span><span class="op" id="6326510">(</span><span class="ident" id="6326511">ftyp</span><span class="op" id="6326515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326519">if</span>&nbsp;<span class="ident" id="6326522">xmlname</span>&nbsp;<span class="op" id="6326530">!=</span>&nbsp;<span class="ident" id="6326533">nil</span>&nbsp;<span class="op" id="6326537">&amp;&amp;</span>&nbsp;<span class="ident" id="6326540">xmlname</span><span class="op" id="6326547">.</span><span class="ident" id="6326548">name</span>&nbsp;<span class="op" id="6326553">!=</span>&nbsp;<span class="ident" id="6326556">finfo</span><span class="op" id="6326561">.</span><span class="ident" id="6326562">name</span>&nbsp;<span class="op" id="6326567">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326572">return</span>&nbsp;<span class="ident" id="6326579">nil</span><span class="op" id="6326582">,</span>&nbsp;<span class="ident" id="6326584">fmt</span><span class="op" id="6326587">.</span><span class="ident" id="6326588">Errorf</span><span class="op" id="6326594">(</span><span class="string" id="6326595">&#34;xml:&nbsp;name&nbsp;%q&nbsp;in&nbsp;tag&nbsp;of&nbsp;%s.%s&nbsp;conflicts&nbsp;with&nbsp;name&nbsp;%q&nbsp;in&nbsp;%s.XMLName&#34;</span><span class="op" id="6326662">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326668">finfo</span><span class="op" id="6326673">.</span><span class="ident" id="6326674">name</span><span class="op" id="6326678">,</span>&nbsp;<span class="ident" id="6326680">typ</span><span class="op" id="6326683">,</span>&nbsp;<span class="ident" id="6326685">f</span><span class="op" id="6326686">.</span><span class="ident" id="6326687">Name</span><span class="op" id="6326691">,</span>&nbsp;<span class="ident" id="6326693">xmlname</span><span class="op" id="6326700">.</span><span class="ident" id="6326701">name</span><span class="op" id="6326705">,</span>&nbsp;<span class="ident" id="6326707">ftyp</span><span class="op" id="6326711">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326721">return</span>&nbsp;<span class="ident" id="6326728">finfo</span><span class="op" id="6326733">,</span>&nbsp;<span class="ident" id="6326735">nil</span><br>
<span class="lineno">225</span><span class="op" id="6326739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6326742">//&nbsp;lookupXMLName&nbsp;returns&nbsp;the&nbsp;fieldInfo&nbsp;for&nbsp;typ&#39;s&nbsp;XMLName&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="6326805">//&nbsp;in&nbsp;case&nbsp;it&nbsp;exists&nbsp;and&nbsp;has&nbsp;a&nbsp;valid&nbsp;xml&nbsp;field&nbsp;tag,&nbsp;otherwise</span><br>
<span class="lineno"></span><span class="comment" id="6326867">//&nbsp;it&nbsp;returns&nbsp;nil.</span><br>
<span class="lineno">230</span><span class="keyword" id="6326886">func</span>&nbsp;<span class="ident" id="6326891">lookupXMLName</span><span class="op" id="6326904">(</span><span class="ident" id="6326905">typ</span>&nbsp;<span class="ident" id="6326909">reflect</span><span class="op" id="6326916">.</span><span class="ident" id="6326917">Type</span><span class="op" id="6326921">)</span>&nbsp;<span class="op" id="6326923">(</span><span class="ident" id="6326924">xmlname</span>&nbsp;<span class="op" id="6326932">*</span><span class="ident" id="6326933">fieldInfo</span><span class="op" id="6326942">)</span>&nbsp;<span class="op" id="6326944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6326947">for</span>&nbsp;<span class="ident" id="6326951">typ</span><span class="op" id="6326954">.</span><span class="ident" id="6326955">Kind</span><span class="op" id="6326959">(</span><span class="op" id="6326960">)</span>&nbsp;<span class="op" id="6326962">==</span>&nbsp;<span class="ident" id="6326965">reflect</span><span class="op" id="6326972">.</span><span class="ident" id="6326973">Ptr</span>&nbsp;<span class="op" id="6326977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6326981">typ</span>&nbsp;<span class="op" id="6326985">=</span>&nbsp;<span class="ident" id="6326987">typ</span><span class="op" id="6326990">.</span><span class="ident" id="6326991">Elem</span><span class="op" id="6326995">(</span><span class="op" id="6326996">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6326999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327002">if</span>&nbsp;<span class="ident" id="6327005">typ</span><span class="op" id="6327008">.</span><span class="ident" id="6327009">Kind</span><span class="op" id="6327013">(</span><span class="op" id="6327014">)</span>&nbsp;<span class="op" id="6327016">!=</span>&nbsp;<span class="ident" id="6327019">reflect</span><span class="op" id="6327026">.</span><span class="ident" id="6327027">Struct</span>&nbsp;<span class="op" id="6327034">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327038">return</span>&nbsp;<span class="ident" id="6327045">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327053">for</span>&nbsp;<span class="ident" id="6327057">i</span><span class="op" id="6327058">,</span>&nbsp;<span class="ident" id="6327060">n</span>&nbsp;<span class="op" id="6327062">:=</span>&nbsp;<span class="num" id="6327065">0</span><span class="op" id="6327066">,</span>&nbsp;<span class="ident" id="6327068">typ</span><span class="op" id="6327071">.</span><span class="ident" id="6327072">NumField</span><span class="op" id="6327080">(</span><span class="op" id="6327081">)</span><span class="op" id="6327082">;</span>&nbsp;<span class="ident" id="6327084">i</span>&nbsp;<span class="op" id="6327086">&lt;</span>&nbsp;<span class="ident" id="6327088">n</span><span class="op" id="6327089">;</span>&nbsp;<span class="ident" id="6327091">i</span><span class="op" id="6327092">++</span>&nbsp;<span class="op" id="6327095">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327099">f</span>&nbsp;<span class="op" id="6327101">:=</span>&nbsp;<span class="ident" id="6327104">typ</span><span class="op" id="6327107">.</span><span class="ident" id="6327108">Field</span><span class="op" id="6327113">(</span><span class="ident" id="6327114">i</span><span class="op" id="6327115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327119">if</span>&nbsp;<span class="ident" id="6327122">f</span><span class="op" id="6327123">.</span><span class="ident" id="6327124">Name</span>&nbsp;<span class="op" id="6327129">!=</span>&nbsp;<span class="string" id="6327132">&#34;XMLName&#34;</span>&nbsp;<span class="op" id="6327142">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327147">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6327162">finfo</span><span class="op" id="6327167">,</span>&nbsp;<span class="ident" id="6327169">err</span>&nbsp;<span class="op" id="6327173">:=</span>&nbsp;<span class="ident" id="6327176">structFieldInfo</span><span class="op" id="6327191">(</span><span class="ident" id="6327192">typ</span><span class="op" id="6327195">,</span>&nbsp;<span class="op" id="6327197">&amp;</span><span class="ident" id="6327198">f</span><span class="op" id="6327199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327203">if</span>&nbsp;<span class="ident" id="6327206">finfo</span><span class="op" id="6327211">.</span><span class="ident" id="6327212">name</span>&nbsp;<span class="op" id="6327217">!=</span>&nbsp;<span class="string" id="6327220">&#34;&#34;</span>&nbsp;<span class="op" id="6327223">&amp;&amp;</span>&nbsp;<span class="ident" id="6327226">err</span>&nbsp;<span class="op" id="6327230">==</span>&nbsp;<span class="ident" id="6327233">nil</span>&nbsp;<span class="op" id="6327237">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327242">return</span>&nbsp;<span class="ident" id="6327249">finfo</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327257">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327261">//&nbsp;Also&nbsp;consider&nbsp;errors&nbsp;as&nbsp;a&nbsp;non-existent&nbsp;field&nbsp;tag</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6327315">//&nbsp;and&nbsp;let&nbsp;getTypeInfo&nbsp;itself&nbsp;report&nbsp;the&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327365">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327372">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327375">return</span>&nbsp;<span class="ident" id="6327382">nil</span><br>
<span class="lineno"></span><span class="op" id="6327386">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6327389">func</span>&nbsp;<span class="ident" id="6327394">min</span><span class="op" id="6327397">(</span><span class="ident" id="6327398">a</span><span class="op" id="6327399">,</span>&nbsp;<span class="ident" id="6327401">b</span>&nbsp;<span class="builtintype" id="6327403">int</span><span class="op" id="6327406">)</span>&nbsp;<span class="builtintype" id="6327408">int</span>&nbsp;<span class="op" id="6327412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327415">if</span>&nbsp;<span class="ident" id="6327418">a</span>&nbsp;<span class="op" id="6327420">&lt;=</span>&nbsp;<span class="ident" id="6327423">b</span>&nbsp;<span class="op" id="6327425">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327429">return</span>&nbsp;<span class="ident" id="6327436">a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6327439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327442">return</span>&nbsp;<span class="ident" id="6327449">b</span><br>
<span class="lineno"></span><span class="op" id="6327451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">260</span><span class="comment" id="6327454">//&nbsp;addFieldInfo&nbsp;adds&nbsp;finfo&nbsp;to&nbsp;tinfo.fields&nbsp;if&nbsp;there&nbsp;are&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="6327513">//&nbsp;conflicts,&nbsp;or&nbsp;if&nbsp;conflicts&nbsp;arise&nbsp;from&nbsp;previous&nbsp;fields&nbsp;that&nbsp;were</span><br>
<span class="lineno"></span><span class="comment" id="6327580">//&nbsp;obtained&nbsp;from&nbsp;deeper&nbsp;embedded&nbsp;structures&nbsp;than&nbsp;finfo.&nbsp;In&nbsp;the&nbsp;latter</span><br>
<span class="lineno"></span><span class="comment" id="6327650">//&nbsp;case,&nbsp;the&nbsp;conflicting&nbsp;entries&nbsp;are&nbsp;dropped.</span><br>
<span class="lineno"></span><span class="comment" id="6327696">//&nbsp;A&nbsp;conflict&nbsp;occurs&nbsp;when&nbsp;the&nbsp;path&nbsp;(parent&nbsp;+&nbsp;name)&nbsp;to&nbsp;a&nbsp;field&nbsp;is</span><br>
<span class="lineno">265</span><span class="comment" id="6327761">//&nbsp;itself&nbsp;a&nbsp;prefix&nbsp;of&nbsp;another&nbsp;path,&nbsp;or&nbsp;when&nbsp;two&nbsp;paths&nbsp;match&nbsp;exactly.</span><br>
<span class="lineno"></span><span class="comment" id="6327830">//&nbsp;It&nbsp;is&nbsp;okay&nbsp;for&nbsp;field&nbsp;paths&nbsp;to&nbsp;share&nbsp;a&nbsp;common,&nbsp;shorter&nbsp;prefix.</span><br>
<span class="lineno"></span><span class="keyword" id="6327895">func</span>&nbsp;<span class="ident" id="6327900">addFieldInfo</span><span class="op" id="6327912">(</span><span class="ident" id="6327913">typ</span>&nbsp;<span class="ident" id="6327917">reflect</span><span class="op" id="6327924">.</span><span class="ident" id="6327925">Type</span><span class="op" id="6327929">,</span>&nbsp;<span class="ident" id="6327931">tinfo</span>&nbsp;<span class="op" id="6327937">*</span><span class="ident" id="6327938">typeInfo</span><span class="op" id="6327946">,</span>&nbsp;<span class="ident" id="6327948">newf</span>&nbsp;<span class="op" id="6327953">*</span><span class="ident" id="6327954">fieldInfo</span><span class="op" id="6327963">)</span>&nbsp;<span class="builtintype" id="6327965">error</span>&nbsp;<span class="op" id="6327971">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6327974">var</span>&nbsp;<span class="ident" id="6327978">conflicts</span>&nbsp;<span class="op" id="6327988">[</span><span class="op" id="6327989">]</span><span class="builtintype" id="6327990">int</span><br>
<span class="lineno"></span><span class="ident" id="6327994">Loop</span><span class="op" id="6327998">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328001">//&nbsp;First,&nbsp;figure&nbsp;all&nbsp;conflicts.&nbsp;Most&nbsp;working&nbsp;code&nbsp;will&nbsp;have&nbsp;none.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328068">for</span>&nbsp;<span class="ident" id="6328072">i</span>&nbsp;<span class="op" id="6328074">:=</span>&nbsp;<span class="keyword" id="6328077">range</span>&nbsp;<span class="ident" id="6328083">tinfo</span><span class="op" id="6328088">.</span><span class="ident" id="6328089">fields</span>&nbsp;<span class="op" id="6328096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328100">oldf</span>&nbsp;<span class="op" id="6328105">:=</span>&nbsp;<span class="op" id="6328108">&amp;</span><span class="ident" id="6328109">tinfo</span><span class="op" id="6328114">.</span><span class="ident" id="6328115">fields</span><span class="op" id="6328121">[</span><span class="ident" id="6328122">i</span><span class="op" id="6328123">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328127">if</span>&nbsp;<span class="ident" id="6328130">oldf</span><span class="op" id="6328134">.</span><span class="ident" id="6328135">flags</span><span class="op" id="6328140">&amp;</span><span class="ident" id="6328141">fMode</span>&nbsp;<span class="op" id="6328147">!=</span>&nbsp;<span class="ident" id="6328150">newf</span><span class="op" id="6328154">.</span><span class="ident" id="6328155">flags</span><span class="op" id="6328160">&amp;</span><span class="ident" id="6328161">fMode</span>&nbsp;<span class="op" id="6328167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328172">continue</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328183">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328187">if</span>&nbsp;<span class="ident" id="6328190">oldf</span><span class="op" id="6328194">.</span><span class="ident" id="6328195">xmlns</span>&nbsp;<span class="op" id="6328201">!=</span>&nbsp;<span class="string" id="6328204">&#34;&#34;</span>&nbsp;<span class="op" id="6328207">&amp;&amp;</span>&nbsp;<span class="ident" id="6328210">newf</span><span class="op" id="6328214">.</span><span class="ident" id="6328215">xmlns</span>&nbsp;<span class="op" id="6328221">!=</span>&nbsp;<span class="string" id="6328224">&#34;&#34;</span>&nbsp;<span class="op" id="6328227">&amp;&amp;</span>&nbsp;<span class="ident" id="6328230">oldf</span><span class="op" id="6328234">.</span><span class="ident" id="6328235">xmlns</span>&nbsp;<span class="op" id="6328241">!=</span>&nbsp;<span class="ident" id="6328244">newf</span><span class="op" id="6328248">.</span><span class="ident" id="6328249">xmlns</span>&nbsp;<span class="op" id="6328255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328260">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328275">minl</span>&nbsp;<span class="op" id="6328280">:=</span>&nbsp;<span class="ident" id="6328283">min</span><span class="op" id="6328286">(</span><span class="builtinfunc" id="6328287">len</span><span class="op" id="6328290">(</span><span class="ident" id="6328291">newf</span><span class="op" id="6328295">.</span><span class="ident" id="6328296">parents</span><span class="op" id="6328303">)</span><span class="op" id="6328304">,</span>&nbsp;<span class="builtinfunc" id="6328306">len</span><span class="op" id="6328309">(</span><span class="ident" id="6328310">oldf</span><span class="op" id="6328314">.</span><span class="ident" id="6328315">parents</span><span class="op" id="6328322">)</span><span class="op" id="6328323">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328327">for</span>&nbsp;<span class="ident" id="6328331">p</span>&nbsp;<span class="op" id="6328333">:=</span>&nbsp;<span class="num" id="6328336">0</span><span class="op" id="6328337">;</span>&nbsp;<span class="ident" id="6328339">p</span>&nbsp;<span class="op" id="6328341">&lt;</span>&nbsp;<span class="ident" id="6328343">minl</span><span class="op" id="6328347">;</span>&nbsp;<span class="ident" id="6328349">p</span><span class="op" id="6328350">++</span>&nbsp;<span class="op" id="6328353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328358">if</span>&nbsp;<span class="ident" id="6328361">oldf</span><span class="op" id="6328365">.</span><span class="ident" id="6328366">parents</span><span class="op" id="6328373">[</span><span class="ident" id="6328374">p</span><span class="op" id="6328375">]</span>&nbsp;<span class="op" id="6328377">!=</span>&nbsp;<span class="ident" id="6328380">newf</span><span class="op" id="6328384">.</span><span class="ident" id="6328385">parents</span><span class="op" id="6328392">[</span><span class="ident" id="6328393">p</span><span class="op" id="6328394">]</span>&nbsp;<span class="op" id="6328396">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328402">continue</span>&nbsp;<span class="ident" id="6328411">Loop</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328423">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328427">if</span>&nbsp;<span class="builtinfunc" id="6328430">len</span><span class="op" id="6328433">(</span><span class="ident" id="6328434">oldf</span><span class="op" id="6328438">.</span><span class="ident" id="6328439">parents</span><span class="op" id="6328446">)</span>&nbsp;<span class="op" id="6328448">&gt;</span>&nbsp;<span class="builtinfunc" id="6328450">len</span><span class="op" id="6328453">(</span><span class="ident" id="6328454">newf</span><span class="op" id="6328458">.</span><span class="ident" id="6328459">parents</span><span class="op" id="6328466">)</span>&nbsp;<span class="op" id="6328468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328473">if</span>&nbsp;<span class="ident" id="6328476">oldf</span><span class="op" id="6328480">.</span><span class="ident" id="6328481">parents</span><span class="op" id="6328488">[</span><span class="builtinfunc" id="6328489">len</span><span class="op" id="6328492">(</span><span class="ident" id="6328493">newf</span><span class="op" id="6328497">.</span><span class="ident" id="6328498">parents</span><span class="op" id="6328505">)</span><span class="op" id="6328506">]</span>&nbsp;<span class="op" id="6328508">==</span>&nbsp;<span class="ident" id="6328511">newf</span><span class="op" id="6328515">.</span><span class="ident" id="6328516">name</span>&nbsp;<span class="op" id="6328521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328527">conflicts</span>&nbsp;<span class="op" id="6328537">=</span>&nbsp;<span class="builtinfunc" id="6328539">append</span><span class="op" id="6328545">(</span><span class="ident" id="6328546">conflicts</span><span class="op" id="6328555">,</span>&nbsp;<span class="ident" id="6328557">i</span><span class="op" id="6328558">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328563">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328567">}</span>&nbsp;<span class="keyword" id="6328569">else</span>&nbsp;<span class="keyword" id="6328574">if</span>&nbsp;<span class="builtinfunc" id="6328577">len</span><span class="op" id="6328580">(</span><span class="ident" id="6328581">oldf</span><span class="op" id="6328585">.</span><span class="ident" id="6328586">parents</span><span class="op" id="6328593">)</span>&nbsp;<span class="op" id="6328595">&lt;</span>&nbsp;<span class="builtinfunc" id="6328597">len</span><span class="op" id="6328600">(</span><span class="ident" id="6328601">newf</span><span class="op" id="6328605">.</span><span class="ident" id="6328606">parents</span><span class="op" id="6328613">)</span>&nbsp;<span class="op" id="6328615">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328620">if</span>&nbsp;<span class="ident" id="6328623">newf</span><span class="op" id="6328627">.</span><span class="ident" id="6328628">parents</span><span class="op" id="6328635">[</span><span class="builtinfunc" id="6328636">len</span><span class="op" id="6328639">(</span><span class="ident" id="6328640">oldf</span><span class="op" id="6328644">.</span><span class="ident" id="6328645">parents</span><span class="op" id="6328652">)</span><span class="op" id="6328653">]</span>&nbsp;<span class="op" id="6328655">==</span>&nbsp;<span class="ident" id="6328658">oldf</span><span class="op" id="6328662">.</span><span class="ident" id="6328663">name</span>&nbsp;<span class="op" id="6328668">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328674">conflicts</span>&nbsp;<span class="op" id="6328684">=</span>&nbsp;<span class="builtinfunc" id="6328686">append</span><span class="op" id="6328692">(</span><span class="ident" id="6328693">conflicts</span><span class="op" id="6328702">,</span>&nbsp;<span class="ident" id="6328704">i</span><span class="op" id="6328705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328714">}</span>&nbsp;<span class="keyword" id="6328716">else</span>&nbsp;<span class="op" id="6328721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328726">if</span>&nbsp;<span class="ident" id="6328729">newf</span><span class="op" id="6328733">.</span><span class="ident" id="6328734">name</span>&nbsp;<span class="op" id="6328739">==</span>&nbsp;<span class="ident" id="6328742">oldf</span><span class="op" id="6328746">.</span><span class="ident" id="6328747">name</span>&nbsp;<span class="op" id="6328752">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328758">conflicts</span>&nbsp;<span class="op" id="6328768">=</span>&nbsp;<span class="builtinfunc" id="6328770">append</span><span class="op" id="6328776">(</span><span class="ident" id="6328777">conflicts</span><span class="op" id="6328786">,</span>&nbsp;<span class="ident" id="6328788">i</span><span class="op" id="6328789">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328801">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328804">//&nbsp;Without&nbsp;conflicts,&nbsp;add&nbsp;the&nbsp;new&nbsp;field&nbsp;and&nbsp;return.</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328857">if</span>&nbsp;<span class="ident" id="6328860">conflicts</span>&nbsp;<span class="op" id="6328870">==</span>&nbsp;<span class="ident" id="6328873">nil</span>&nbsp;<span class="op" id="6328877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6328881">tinfo</span><span class="op" id="6328886">.</span><span class="ident" id="6328887">fields</span>&nbsp;<span class="op" id="6328894">=</span>&nbsp;<span class="builtinfunc" id="6328896">append</span><span class="op" id="6328902">(</span><span class="ident" id="6328903">tinfo</span><span class="op" id="6328908">.</span><span class="ident" id="6328909">fields</span><span class="op" id="6328915">,</span>&nbsp;<span class="op" id="6328917">*</span><span class="ident" id="6328918">newf</span><span class="op" id="6328922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6328926">return</span>&nbsp;<span class="ident" id="6328933">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6328938">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328942">//&nbsp;If&nbsp;any&nbsp;conflict&nbsp;is&nbsp;shallower,&nbsp;ignore&nbsp;the&nbsp;new&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6328998">//&nbsp;This&nbsp;matches&nbsp;the&nbsp;Go&nbsp;field&nbsp;resolution&nbsp;on&nbsp;embedding.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329053">for</span>&nbsp;<span class="ident" id="6329057">_</span><span class="op" id="6329058">,</span>&nbsp;<span class="ident" id="6329060">i</span>&nbsp;<span class="op" id="6329062">:=</span>&nbsp;<span class="keyword" id="6329065">range</span>&nbsp;<span class="ident" id="6329071">conflicts</span>&nbsp;<span class="op" id="6329081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329085">if</span>&nbsp;<span class="builtinfunc" id="6329088">len</span><span class="op" id="6329091">(</span><span class="ident" id="6329092">tinfo</span><span class="op" id="6329097">.</span><span class="ident" id="6329098">fields</span><span class="op" id="6329104">[</span><span class="ident" id="6329105">i</span><span class="op" id="6329106">]</span><span class="op" id="6329107">.</span><span class="ident" id="6329108">idx</span><span class="op" id="6329111">)</span>&nbsp;<span class="op" id="6329113">&lt;</span>&nbsp;<span class="builtinfunc" id="6329115">len</span><span class="op" id="6329118">(</span><span class="ident" id="6329119">newf</span><span class="op" id="6329123">.</span><span class="ident" id="6329124">idx</span><span class="op" id="6329127">)</span>&nbsp;<span class="op" id="6329129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329134">return</span>&nbsp;<span class="ident" id="6329141">nil</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329147">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329154">//&nbsp;Otherwise,&nbsp;if&nbsp;any&nbsp;of&nbsp;them&nbsp;is&nbsp;at&nbsp;the&nbsp;same&nbsp;depth&nbsp;level,&nbsp;it&#39;s&nbsp;an&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329227">for</span>&nbsp;<span class="ident" id="6329231">_</span><span class="op" id="6329232">,</span>&nbsp;<span class="ident" id="6329234">i</span>&nbsp;<span class="op" id="6329236">:=</span>&nbsp;<span class="keyword" id="6329239">range</span>&nbsp;<span class="ident" id="6329245">conflicts</span>&nbsp;<span class="op" id="6329255">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329259">oldf</span>&nbsp;<span class="op" id="6329264">:=</span>&nbsp;<span class="op" id="6329267">&amp;</span><span class="ident" id="6329268">tinfo</span><span class="op" id="6329273">.</span><span class="ident" id="6329274">fields</span><span class="op" id="6329280">[</span><span class="ident" id="6329281">i</span><span class="op" id="6329282">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329286">if</span>&nbsp;<span class="builtinfunc" id="6329289">len</span><span class="op" id="6329292">(</span><span class="ident" id="6329293">oldf</span><span class="op" id="6329297">.</span><span class="ident" id="6329298">idx</span><span class="op" id="6329301">)</span>&nbsp;<span class="op" id="6329303">==</span>&nbsp;<span class="builtinfunc" id="6329306">len</span><span class="op" id="6329309">(</span><span class="ident" id="6329310">newf</span><span class="op" id="6329314">.</span><span class="ident" id="6329315">idx</span><span class="op" id="6329318">)</span>&nbsp;<span class="op" id="6329320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329325">f1</span>&nbsp;<span class="op" id="6329328">:=</span>&nbsp;<span class="ident" id="6329331">typ</span><span class="op" id="6329334">.</span><span class="ident" id="6329335">FieldByIndex</span><span class="op" id="6329347">(</span><span class="ident" id="6329348">oldf</span><span class="op" id="6329352">.</span><span class="ident" id="6329353">idx</span><span class="op" id="6329356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329361">f2</span>&nbsp;<span class="op" id="6329364">:=</span>&nbsp;<span class="ident" id="6329367">typ</span><span class="op" id="6329370">.</span><span class="ident" id="6329371">FieldByIndex</span><span class="op" id="6329383">(</span><span class="ident" id="6329384">newf</span><span class="op" id="6329388">.</span><span class="ident" id="6329389">idx</span><span class="op" id="6329392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329397">return</span>&nbsp;<span class="op" id="6329404">&amp;</span><span class="ident" id="6329405">TagPathError</span><span class="op" id="6329417">{</span><span class="ident" id="6329418">typ</span><span class="op" id="6329421">,</span>&nbsp;<span class="ident" id="6329423">f1</span><span class="op" id="6329425">.</span><span class="ident" id="6329426">Name</span><span class="op" id="6329430">,</span>&nbsp;<span class="ident" id="6329432">f1</span><span class="op" id="6329434">.</span><span class="ident" id="6329435">Tag</span><span class="op" id="6329438">.</span><span class="ident" id="6329439">Get</span><span class="op" id="6329442">(</span><span class="string" id="6329443">&#34;xml&#34;</span><span class="op" id="6329448">)</span><span class="op" id="6329449">,</span>&nbsp;<span class="ident" id="6329451">f2</span><span class="op" id="6329453">.</span><span class="ident" id="6329454">Name</span><span class="op" id="6329458">,</span>&nbsp;<span class="ident" id="6329460">f2</span><span class="op" id="6329462">.</span><span class="ident" id="6329463">Tag</span><span class="op" id="6329466">.</span><span class="ident" id="6329467">Get</span><span class="op" id="6329470">(</span><span class="string" id="6329471">&#34;xml&#34;</span><span class="op" id="6329476">)</span><span class="op" id="6329477">}</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329484">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329488">//&nbsp;Otherwise,&nbsp;the&nbsp;new&nbsp;field&nbsp;is&nbsp;shallower,&nbsp;and&nbsp;thus&nbsp;takes&nbsp;precedence,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6329558">//&nbsp;so&nbsp;drop&nbsp;the&nbsp;conflicting&nbsp;fields&nbsp;from&nbsp;tinfo&nbsp;and&nbsp;append&nbsp;the&nbsp;new&nbsp;one.</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329628">for</span>&nbsp;<span class="ident" id="6329632">c</span>&nbsp;<span class="op" id="6329634">:=</span>&nbsp;<span class="builtinfunc" id="6329637">len</span><span class="op" id="6329640">(</span><span class="ident" id="6329641">conflicts</span><span class="op" id="6329650">)</span>&nbsp;<span class="op" id="6329652">-</span>&nbsp;<span class="num" id="6329654">1</span><span class="op" id="6329655">;</span>&nbsp;<span class="ident" id="6329657">c</span>&nbsp;<span class="op" id="6329659">&gt;=</span>&nbsp;<span class="num" id="6329662">0</span><span class="op" id="6329663">;</span>&nbsp;<span class="ident" id="6329665">c</span><span class="op" id="6329666">--</span>&nbsp;<span class="op" id="6329669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329673">i</span>&nbsp;<span class="op" id="6329675">:=</span>&nbsp;<span class="ident" id="6329678">conflicts</span><span class="op" id="6329687">[</span><span class="ident" id="6329688">c</span><span class="op" id="6329689">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="6329693">copy</span><span class="op" id="6329697">(</span><span class="ident" id="6329698">tinfo</span><span class="op" id="6329703">.</span><span class="ident" id="6329704">fields</span><span class="op" id="6329710">[</span><span class="ident" id="6329711">i</span><span class="op" id="6329712">:</span><span class="op" id="6329713">]</span><span class="op" id="6329714">,</span>&nbsp;<span class="ident" id="6329716">tinfo</span><span class="op" id="6329721">.</span><span class="ident" id="6329722">fields</span><span class="op" id="6329728">[</span><span class="ident" id="6329729">i</span><span class="op" id="6329730">+</span><span class="num" id="6329731">1</span><span class="op" id="6329732">:</span><span class="op" id="6329733">]</span><span class="op" id="6329734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329738">tinfo</span><span class="op" id="6329743">.</span><span class="ident" id="6329744">fields</span>&nbsp;<span class="op" id="6329751">=</span>&nbsp;<span class="ident" id="6329753">tinfo</span><span class="op" id="6329758">.</span><span class="ident" id="6329759">fields</span><span class="op" id="6329765">[</span><span class="op" id="6329766">:</span><span class="builtinfunc" id="6329767">len</span><span class="op" id="6329770">(</span><span class="ident" id="6329771">tinfo</span><span class="op" id="6329776">.</span><span class="ident" id="6329777">fields</span><span class="op" id="6329783">)</span><span class="op" id="6329784">-</span><span class="num" id="6329785">1</span><span class="op" id="6329786">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6329789">}</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6329792">tinfo</span><span class="op" id="6329797">.</span><span class="ident" id="6329798">fields</span>&nbsp;<span class="op" id="6329805">=</span>&nbsp;<span class="builtinfunc" id="6329807">append</span><span class="op" id="6329813">(</span><span class="ident" id="6329814">tinfo</span><span class="op" id="6329819">.</span><span class="ident" id="6329820">fields</span><span class="op" id="6329826">,</span>&nbsp;<span class="op" id="6329828">*</span><span class="ident" id="6329829">newf</span><span class="op" id="6329833">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6329836">return</span>&nbsp;<span class="ident" id="6329843">nil</span><br>
<span class="lineno"></span><span class="op" id="6329847">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6329850">//&nbsp;A&nbsp;TagPathError&nbsp;represents&nbsp;an&nbsp;error&nbsp;in&nbsp;the&nbsp;unmarshalling&nbsp;process</span><br>
<span class="lineno">335</span><span class="comment" id="6329917">//&nbsp;caused&nbsp;by&nbsp;the&nbsp;use&nbsp;of&nbsp;field&nbsp;tags&nbsp;with&nbsp;conflicting&nbsp;paths.</span><br>
<span class="lineno"></span><span class="keyword" id="6329976">type</span>&nbsp;<span class="ident" id="6329981">TagPathError</span>&nbsp;<span class="keyword" id="6329994">struct</span>&nbsp;<span class="op" id="6330001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330004">Struct</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="6330017">reflect</span><span class="op" id="6330024">.</span><span class="ident" id="6330025">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330031">Field1</span><span class="op" id="6330037">,</span>&nbsp;<span class="ident" id="6330039">Tag1</span>&nbsp;<span class="builtintype" id="6330044">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330052">Field2</span><span class="op" id="6330058">,</span>&nbsp;<span class="ident" id="6330060">Tag2</span>&nbsp;<span class="builtintype" id="6330065">string</span><br>
<span class="lineno">340</span><span class="op" id="6330072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6330075">func</span>&nbsp;<span class="op" id="6330080">(</span><span class="ident" id="6330081">e</span>&nbsp;<span class="op" id="6330083">*</span><span class="ident" id="6330084">TagPathError</span><span class="op" id="6330096">)</span>&nbsp;<span class="ident" id="6330098">Error</span><span class="op" id="6330103">(</span><span class="op" id="6330104">)</span>&nbsp;<span class="builtintype" id="6330106">string</span>&nbsp;<span class="op" id="6330113">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330116">return</span>&nbsp;<span class="ident" id="6330123">fmt</span><span class="op" id="6330126">.</span><span class="ident" id="6330127">Sprintf</span><span class="op" id="6330134">(</span><span class="string" id="6330135">&#34;%s&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&nbsp;conflicts&nbsp;with&nbsp;field&nbsp;%q&nbsp;with&nbsp;tag&nbsp;%q&#34;</span><span class="op" id="6330196">,</span>&nbsp;<span class="ident" id="6330198">e</span><span class="op" id="6330199">.</span><span class="ident" id="6330200">Struct</span><span class="op" id="6330206">,</span>&nbsp;<span class="ident" id="6330208">e</span><span class="op" id="6330209">.</span><span class="ident" id="6330210">Field1</span><span class="op" id="6330216">,</span>&nbsp;<span class="ident" id="6330218">e</span><span class="op" id="6330219">.</span><span class="ident" id="6330220">Tag1</span><span class="op" id="6330224">,</span>&nbsp;<span class="ident" id="6330226">e</span><span class="op" id="6330227">.</span><span class="ident" id="6330228">Field2</span><span class="op" id="6330234">,</span>&nbsp;<span class="ident" id="6330236">e</span><span class="op" id="6330237">.</span><span class="ident" id="6330238">Tag2</span><span class="op" id="6330242">)</span><br>
<span class="lineno"></span><span class="op" id="6330244">}</span><br>
<span class="lineno">345</span><br>
<span class="lineno"></span><span class="comment" id="6330247">//&nbsp;value&nbsp;returns&nbsp;v&#39;s&nbsp;field&nbsp;value&nbsp;corresponding&nbsp;to&nbsp;finfo.</span><br>
<span class="lineno"></span><span class="comment" id="6330304">//&nbsp;It&#39;s&nbsp;equivalent&nbsp;to&nbsp;v.FieldByIndex(finfo.idx),&nbsp;but&nbsp;initializes</span><br>
<span class="lineno"></span><span class="comment" id="6330369">//&nbsp;and&nbsp;dereferences&nbsp;pointers&nbsp;as&nbsp;necessary.</span><br>
<span class="lineno"></span><span class="keyword" id="6330412">func</span>&nbsp;<span class="op" id="6330417">(</span><span class="ident" id="6330418">finfo</span>&nbsp;<span class="op" id="6330424">*</span><span class="ident" id="6330425">fieldInfo</span><span class="op" id="6330434">)</span>&nbsp;<span class="ident" id="6330436">value</span><span class="op" id="6330441">(</span><span class="ident" id="6330442">v</span>&nbsp;<span class="ident" id="6330444">reflect</span><span class="op" id="6330451">.</span><span class="ident" id="6330452">Value</span><span class="op" id="6330457">)</span>&nbsp;<span class="ident" id="6330459">reflect</span><span class="op" id="6330466">.</span><span class="ident" id="6330467">Value</span>&nbsp;<span class="op" id="6330473">{</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330476">for</span>&nbsp;<span class="ident" id="6330480">i</span><span class="op" id="6330481">,</span>&nbsp;<span class="ident" id="6330483">x</span>&nbsp;<span class="op" id="6330485">:=</span>&nbsp;<span class="keyword" id="6330488">range</span>&nbsp;<span class="ident" id="6330494">finfo</span><span class="op" id="6330499">.</span><span class="ident" id="6330500">idx</span>&nbsp;<span class="op" id="6330504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330508">if</span>&nbsp;<span class="ident" id="6330511">i</span>&nbsp;<span class="op" id="6330513">&gt;</span>&nbsp;<span class="num" id="6330515">0</span>&nbsp;<span class="op" id="6330517">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330522">t</span>&nbsp;<span class="op" id="6330524">:=</span>&nbsp;<span class="ident" id="6330527">v</span><span class="op" id="6330528">.</span><span class="ident" id="6330529">Type</span><span class="op" id="6330533">(</span><span class="op" id="6330534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330539">if</span>&nbsp;<span class="ident" id="6330542">t</span><span class="op" id="6330543">.</span><span class="ident" id="6330544">Kind</span><span class="op" id="6330548">(</span><span class="op" id="6330549">)</span>&nbsp;<span class="op" id="6330551">==</span>&nbsp;<span class="ident" id="6330554">reflect</span><span class="op" id="6330561">.</span><span class="ident" id="6330562">Ptr</span>&nbsp;<span class="op" id="6330566">&amp;&amp;</span>&nbsp;<span class="ident" id="6330569">t</span><span class="op" id="6330570">.</span><span class="ident" id="6330571">Elem</span><span class="op" id="6330575">(</span><span class="op" id="6330576">)</span><span class="op" id="6330577">.</span><span class="ident" id="6330578">Kind</span><span class="op" id="6330582">(</span><span class="op" id="6330583">)</span>&nbsp;<span class="op" id="6330585">==</span>&nbsp;<span class="ident" id="6330588">reflect</span><span class="op" id="6330595">.</span><span class="ident" id="6330596">Struct</span>&nbsp;<span class="op" id="6330603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330609">if</span>&nbsp;<span class="ident" id="6330612">v</span><span class="op" id="6330613">.</span><span class="ident" id="6330614">IsNil</span><span class="op" id="6330619">(</span><span class="op" id="6330620">)</span>&nbsp;<span class="op" id="6330622">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330629">v</span><span class="op" id="6330630">.</span><span class="ident" id="6330631">Set</span><span class="op" id="6330634">(</span><span class="ident" id="6330635">reflect</span><span class="op" id="6330642">.</span><span class="ident" id="6330643">New</span><span class="op" id="6330646">(</span><span class="ident" id="6330647">v</span><span class="op" id="6330648">.</span><span class="ident" id="6330649">Type</span><span class="op" id="6330653">(</span><span class="op" id="6330654">)</span><span class="op" id="6330655">.</span><span class="ident" id="6330656">Elem</span><span class="op" id="6330660">(</span><span class="op" id="6330661">)</span><span class="op" id="6330662">)</span><span class="op" id="6330663">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330675">v</span>&nbsp;<span class="op" id="6330677">=</span>&nbsp;<span class="ident" id="6330679">v</span><span class="op" id="6330680">.</span><span class="ident" id="6330681">Elem</span><span class="op" id="6330685">(</span><span class="op" id="6330686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330695">}</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6330699">v</span>&nbsp;<span class="op" id="6330701">=</span>&nbsp;<span class="ident" id="6330703">v</span><span class="op" id="6330704">.</span><span class="ident" id="6330705">Field</span><span class="op" id="6330710">(</span><span class="ident" id="6330711">x</span><span class="op" id="6330712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6330715">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6330718">return</span>&nbsp;<span class="ident" id="6330725">v</span><br>
<span class="lineno"></span><span class="op" id="6330727">}</span>
</div>
</body>
</html>
