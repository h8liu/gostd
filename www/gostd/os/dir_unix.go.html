<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>os</h2>
<ul>
<li><a href="/gostd/os/dir_unix.go.html" class="current">dir_unix.go</a></li>
<li><a href="/gostd/os/doc.go.html">doc.go</a></li>
<li><a href="/gostd/os/env.go.html">env.go</a></li>
<li><a href="/gostd/os/env_test.go.html">env_test.go</a></li>
<li><a href="/gostd/os/env_unix_test.go.html">env_unix_test.go</a></li>
<li><a href="/gostd/os/error.go.html">error.go</a></li>
<li><a href="/gostd/os/error_test.go.html">error_test.go</a></li>
<li><a href="/gostd/os/error_unix.go.html">error_unix.go</a></li>
<li><a href="/gostd/os/exec.go.html">exec.go</a></li>
<li><a href="/gostd/os/exec_posix.go.html">exec_posix.go</a></li>
<li><a href="/gostd/os/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/os/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/os/file.go.html">file.go</a></li>
<li><a href="/gostd/os/file_posix.go.html">file_posix.go</a></li>
<li><a href="/gostd/os/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/os/getwd.go.html">getwd.go</a></li>
<li><a href="/gostd/os/os_test.go.html">os_test.go</a></li>
<li><a href="/gostd/os/os_unix_test.go.html">os_unix_test.go</a></li>
<li><a href="/gostd/os/path.go.html">path.go</a></li>
<li><a href="/gostd/os/path_test.go.html">path_test.go</a></li>
<li><a href="/gostd/os/path_unix.go.html">path_unix.go</a></li>
<li><a href="/gostd/os/pipe_linux.go.html">pipe_linux.go</a></li>
<li><a href="/gostd/os/proc.go.html">proc.go</a></li>
<li><a href="/gostd/os/stat_linux.go.html">stat_linux.go</a></li>
<li><a href="/gostd/os/sys_linux.go.html">sys_linux.go</a></li>
<li><a href="/gostd/os/sys_unix.go.html">sys_unix.go</a></li>
<li><a href="/gostd/os/types.go.html">types.go</a></li>
<li><a href="/gostd/os/types_notwin.go.html">types_notwin.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2315102">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2315157">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2315211">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2315262">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315332">package</span>&nbsp;<span class="ident" id="2315340">os</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315344">import</span>&nbsp;<span class="op" id="2315351">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2315354">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2315360">&#34;syscall&#34;</span><br>
<span class="lineno"></span><span class="op" id="2315370">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315373">const</span>&nbsp;<span class="op" id="2315379">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315382">blockSize</span>&nbsp;<span class="op" id="2315392">=</span>&nbsp;<span class="num" id="2315394">4096</span><br>
<span class="lineno"></span><span class="op" id="2315399">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2315402">func</span>&nbsp;<span class="op" id="2315407">(</span><span class="ident" id="2315408">f</span>&nbsp;<span class="op" id="2315410">*</span><span class="ident" id="2315411">File</span><span class="op" id="2315415">)</span>&nbsp;<span class="ident" id="2315417">readdirnames</span><span class="op" id="2315429">(</span><span class="ident" id="2315430">n</span>&nbsp;<span class="builtintype" id="2315432">int</span><span class="op" id="2315435">)</span>&nbsp;<span class="op" id="2315437">(</span><span class="ident" id="2315438">names</span>&nbsp;<span class="op" id="2315444">[</span><span class="op" id="2315445">]</span><span class="builtintype" id="2315446">string</span><span class="op" id="2315452">,</span>&nbsp;<span class="ident" id="2315454">err</span>&nbsp;<span class="builtintype" id="2315458">error</span><span class="op" id="2315463">)</span>&nbsp;<span class="op" id="2315465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2315468">//&nbsp;If&nbsp;this&nbsp;file&nbsp;has&nbsp;no&nbsp;dirinfo,&nbsp;create&nbsp;one.</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315513">if</span>&nbsp;<span class="ident" id="2315516">f</span><span class="op" id="2315517">.</span><span class="ident" id="2315518">dirinfo</span>&nbsp;<span class="op" id="2315526">==</span>&nbsp;<span class="builtintype" id="2315529">nil</span>&nbsp;<span class="op" id="2315533">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315537">f</span><span class="op" id="2315538">.</span><span class="ident" id="2315539">dirinfo</span>&nbsp;<span class="op" id="2315547">=</span>&nbsp;<span class="builtinfunc" id="2315549">new</span><span class="op" id="2315552">(</span><span class="ident" id="2315553">dirInfo</span><span class="op" id="2315560">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2315564">//&nbsp;The&nbsp;buffer&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;a&nbsp;block&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315611">f</span><span class="op" id="2315612">.</span><span class="ident" id="2315613">dirinfo</span><span class="op" id="2315620">.</span><span class="ident" id="2315621">buf</span>&nbsp;<span class="op" id="2315625">=</span>&nbsp;<span class="builtinfunc" id="2315627">make</span><span class="op" id="2315631">(</span><span class="op" id="2315632">[</span><span class="op" id="2315633">]</span><span class="builtintype" id="2315634">byte</span><span class="op" id="2315638">,</span>&nbsp;<span class="ident" id="2315640">blockSize</span><span class="op" id="2315649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2315652">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315655">d</span>&nbsp;<span class="op" id="2315657">:=</span>&nbsp;<span class="ident" id="2315660">f</span><span class="op" id="2315661">.</span><span class="ident" id="2315662">dirinfo</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315672">size</span>&nbsp;<span class="op" id="2315677">:=</span>&nbsp;<span class="ident" id="2315680">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315683">if</span>&nbsp;<span class="ident" id="2315686">size</span>&nbsp;<span class="op" id="2315691">&lt;=</span>&nbsp;<span class="num" id="2315694">0</span>&nbsp;<span class="op" id="2315696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315700">size</span>&nbsp;<span class="op" id="2315705">=</span>&nbsp;<span class="num" id="2315707">100</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315713">n</span>&nbsp;<span class="op" id="2315715">=</span>&nbsp;<span class="op" id="2315717">-</span><span class="num" id="2315718">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2315721">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315725">names</span>&nbsp;<span class="op" id="2315731">=</span>&nbsp;<span class="builtinfunc" id="2315733">make</span><span class="op" id="2315737">(</span><span class="op" id="2315738">[</span><span class="op" id="2315739">]</span><span class="builtintype" id="2315740">string</span><span class="op" id="2315746">,</span>&nbsp;<span class="num" id="2315748">0</span><span class="op" id="2315749">,</span>&nbsp;<span class="ident" id="2315751">size</span><span class="op" id="2315755">)</span>&nbsp;<span class="comment" id="2315757">//&nbsp;Empty&nbsp;with&nbsp;room&nbsp;to&nbsp;grow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315786">for</span>&nbsp;<span class="ident" id="2315790">n</span>&nbsp;<span class="op" id="2315792">!=</span>&nbsp;<span class="num" id="2315795">0</span>&nbsp;<span class="op" id="2315797">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2315801">//&nbsp;Refill&nbsp;the&nbsp;buffer&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315837">if</span>&nbsp;<span class="ident" id="2315840">d</span><span class="op" id="2315841">.</span><span class="ident" id="2315842">bufp</span>&nbsp;<span class="op" id="2315847">&gt;=</span>&nbsp;<span class="ident" id="2315850">d</span><span class="op" id="2315851">.</span><span class="ident" id="2315852">nbuf</span>&nbsp;<span class="op" id="2315857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315862">d</span><span class="op" id="2315863">.</span><span class="ident" id="2315864">bufp</span>&nbsp;<span class="op" id="2315869">=</span>&nbsp;<span class="num" id="2315871">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315876">var</span>&nbsp;<span class="ident" id="2315880">errno</span>&nbsp;<span class="builtintype" id="2315886">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2315895">d</span><span class="op" id="2315896">.</span><span class="ident" id="2315897">nbuf</span><span class="op" id="2315901">,</span>&nbsp;<span class="ident" id="2315903">errno</span>&nbsp;<span class="op" id="2315909">=</span>&nbsp;<span class="ident" id="2315911">fixCount</span><span class="op" id="2315919">(</span><span class="ident" id="2315920">syscall</span><span class="op" id="2315927">.</span><span class="ident" id="2315928">ReadDirent</span><span class="op" id="2315938">(</span><span class="ident" id="2315939">f</span><span class="op" id="2315940">.</span><span class="ident" id="2315941">fd</span><span class="op" id="2315943">,</span>&nbsp;<span class="ident" id="2315945">d</span><span class="op" id="2315946">.</span><span class="ident" id="2315947">buf</span><span class="op" id="2315950">)</span><span class="op" id="2315951">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315956">if</span>&nbsp;<span class="ident" id="2315959">errno</span>&nbsp;<span class="op" id="2315965">!=</span>&nbsp;<span class="builtintype" id="2315968">nil</span>&nbsp;<span class="op" id="2315972">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2315978">return</span>&nbsp;<span class="ident" id="2315985">names</span><span class="op" id="2315990">,</span>&nbsp;<span class="ident" id="2315992">NewSyscallError</span><span class="op" id="2316007">(</span><span class="string" id="2316008">&#34;readdirent&#34;</span><span class="op" id="2316020">,</span>&nbsp;<span class="ident" id="2316022">errno</span><span class="op" id="2316027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2316032">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316037">if</span>&nbsp;<span class="ident" id="2316040">d</span><span class="op" id="2316041">.</span><span class="ident" id="2316042">nbuf</span>&nbsp;<span class="op" id="2316047">&lt;=</span>&nbsp;<span class="num" id="2316050">0</span>&nbsp;<span class="op" id="2316052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316058">break</span>&nbsp;<span class="comment" id="2316064">//&nbsp;EOF</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2316074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2316078">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2316083">//&nbsp;Drain&nbsp;the&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316105">var</span>&nbsp;<span class="ident" id="2316109">nb</span><span class="op" id="2316111">,</span>&nbsp;<span class="ident" id="2316113">nc</span>&nbsp;<span class="builtintype" id="2316116">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2316122">nb</span><span class="op" id="2316124">,</span>&nbsp;<span class="ident" id="2316126">nc</span><span class="op" id="2316128">,</span>&nbsp;<span class="ident" id="2316130">names</span>&nbsp;<span class="op" id="2316136">=</span>&nbsp;<span class="ident" id="2316138">syscall</span><span class="op" id="2316145">.</span><span class="ident" id="2316146">ParseDirent</span><span class="op" id="2316157">(</span><span class="ident" id="2316158">d</span><span class="op" id="2316159">.</span><span class="ident" id="2316160">buf</span><span class="op" id="2316163">[</span><span class="ident" id="2316164">d</span><span class="op" id="2316165">.</span><span class="ident" id="2316166">bufp</span><span class="op" id="2316170">:</span><span class="ident" id="2316171">d</span><span class="op" id="2316172">.</span><span class="ident" id="2316173">nbuf</span><span class="op" id="2316177">]</span><span class="op" id="2316178">,</span>&nbsp;<span class="ident" id="2316180">n</span><span class="op" id="2316181">,</span>&nbsp;<span class="ident" id="2316183">names</span><span class="op" id="2316188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2316192">d</span><span class="op" id="2316193">.</span><span class="ident" id="2316194">bufp</span>&nbsp;<span class="op" id="2316199">+=</span>&nbsp;<span class="ident" id="2316202">nb</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2316207">n</span>&nbsp;<span class="op" id="2316209">-=</span>&nbsp;<span class="ident" id="2316212">nc</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2316216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316219">if</span>&nbsp;<span class="ident" id="2316222">n</span>&nbsp;<span class="op" id="2316224">&gt;=</span>&nbsp;<span class="num" id="2316227">0</span>&nbsp;<span class="op" id="2316229">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="2316232">len</span><span class="op" id="2316235">(</span><span class="ident" id="2316236">names</span><span class="op" id="2316241">)</span>&nbsp;<span class="op" id="2316243">==</span>&nbsp;<span class="num" id="2316246">0</span>&nbsp;<span class="op" id="2316248">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316252">return</span>&nbsp;<span class="ident" id="2316259">names</span><span class="op" id="2316264">,</span>&nbsp;<span class="ident" id="2316266">io</span><span class="op" id="2316268">.</span><span class="ident" id="2316269">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2316274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2316277">return</span>&nbsp;<span class="ident" id="2316284">names</span><span class="op" id="2316289">,</span>&nbsp;<span class="builtintype" id="2316291">nil</span><br>
<span class="lineno"></span><span class="op" id="2316295">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
