<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/json</h2>
<ul>
<li><a href="/gostd/encoding/json/bench_test.go.html">bench_test.go</a></li>
<li><a href="/gostd/encoding/json/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/json/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/encoding/json/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/json/encode_test.go.html">encode_test.go</a></li>
<li><a href="/gostd/encoding/json/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/json/fold.go.html">fold.go</a></li>
<li><a href="/gostd/encoding/json/fold_test.go.html">fold_test.go</a></li>
<li><a href="/gostd/encoding/json/indent.go.html">indent.go</a></li>
<li><a href="/gostd/encoding/json/scanner.go.html">scanner.go</a></li>
<li><a href="/gostd/encoding/json/scanner_test.go.html">scanner_test.go</a></li>
<li><a href="/gostd/encoding/json/stream.go.html" class="current">stream.go</a></li>
<li><a href="/gostd/encoding/json/stream_test.go.html">stream_test.go</a></li>
<li><a href="/gostd/encoding/json/tagkey_test.go.html">tagkey_test.go</a></li>
<li><a href="/gostd/encoding/json/tags.go.html">tags.go</a></li>
<li><a href="/gostd/encoding/json/tags_test.go.html">tags_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5308883">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5308939">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5308993">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5309044">package</span>&nbsp;<span class="ident" id="5309052">json</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5309058">import</span>&nbsp;<span class="op" id="5309065">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5309068">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5309077">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5309087">&#34;io&#34;</span><br>
<span class="lineno"></span><span class="op" id="5309092">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5309095">//&nbsp;A&nbsp;Decoder&nbsp;reads&nbsp;and&nbsp;decodes&nbsp;JSON&nbsp;objects&nbsp;from&nbsp;an&nbsp;input&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="5309161">type</span>&nbsp;<span class="ident" id="5309166">Decoder</span>&nbsp;<span class="keyword" id="5309174">struct</span>&nbsp;<span class="op" id="5309181">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309184">r</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309189">io</span><span class="op" id="5309191">.</span><span class="ident" id="5309192">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309200">buf</span>&nbsp;&nbsp;<span class="op" id="5309205">[</span><span class="op" id="5309206">]</span><span class="builtintype" id="5309207">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309213">d</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5309218">decodeState</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309231">scan</span>&nbsp;<span class="ident" id="5309236">scanner</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309245">err</span>&nbsp;&nbsp;<span class="builtintype" id="5309250">error</span><br>
<span class="lineno">20</span><span class="op" id="5309256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5309259">//&nbsp;NewDecoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;decoder&nbsp;that&nbsp;reads&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="5309314">//</span><br>
<span class="lineno"></span><span class="comment" id="5309317">//&nbsp;The&nbsp;decoder&nbsp;introduces&nbsp;its&nbsp;own&nbsp;buffering&nbsp;and&nbsp;may</span><br>
<span class="lineno">25</span><span class="comment" id="5309369">//&nbsp;read&nbsp;data&nbsp;from&nbsp;r&nbsp;beyond&nbsp;the&nbsp;JSON&nbsp;values&nbsp;requested.</span><br>
<span class="lineno"></span><span class="keyword" id="5309423">func</span>&nbsp;<span class="ident" id="5309428">NewDecoder</span><span class="op" id="5309438">(</span><span class="ident" id="5309439">r</span>&nbsp;<span class="ident" id="5309441">io</span><span class="op" id="5309443">.</span><span class="ident" id="5309444">Reader</span><span class="op" id="5309450">)</span>&nbsp;<span class="op" id="5309452">*</span><span class="ident" id="5309453">Decoder</span>&nbsp;<span class="op" id="5309461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309464">return</span>&nbsp;<span class="op" id="5309471">&amp;</span><span class="ident" id="5309472">Decoder</span><span class="op" id="5309479">{</span><span class="ident" id="5309480">r</span><span class="op" id="5309481">:</span>&nbsp;<span class="ident" id="5309483">r</span><span class="op" id="5309484">}</span><br>
<span class="lineno"></span><span class="op" id="5309486">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5309489">//&nbsp;UseNumber&nbsp;causes&nbsp;the&nbsp;Decoder&nbsp;to&nbsp;unmarshal&nbsp;a&nbsp;number&nbsp;into&nbsp;an&nbsp;interface{}&nbsp;as&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5309568">//&nbsp;Number&nbsp;instead&nbsp;of&nbsp;as&nbsp;a&nbsp;float64.</span><br>
<span class="lineno"></span><span class="keyword" id="5309603">func</span>&nbsp;<span class="op" id="5309608">(</span><span class="ident" id="5309609">dec</span>&nbsp;<span class="op" id="5309613">*</span><span class="ident" id="5309614">Decoder</span><span class="op" id="5309621">)</span>&nbsp;<span class="ident" id="5309623">UseNumber</span><span class="op" id="5309632">(</span><span class="op" id="5309633">)</span>&nbsp;<span class="op" id="5309635">{</span>&nbsp;<span class="ident" id="5309637">dec</span><span class="op" id="5309640">.</span><span class="ident" id="5309641">d</span><span class="op" id="5309642">.</span><span class="ident" id="5309643">useNumber</span>&nbsp;<span class="op" id="5309653">=</span>&nbsp;<span class="builtintype" id="5309655">true</span>&nbsp;<span class="op" id="5309660">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5309663">//&nbsp;Decode&nbsp;reads&nbsp;the&nbsp;next&nbsp;JSON-encoded&nbsp;value&nbsp;from&nbsp;its</span><br>
<span class="lineno">35</span><span class="comment" id="5309716">//&nbsp;input&nbsp;and&nbsp;stores&nbsp;it&nbsp;in&nbsp;the&nbsp;value&nbsp;pointed&nbsp;to&nbsp;by&nbsp;v.</span><br>
<span class="lineno"></span><span class="comment" id="5309769">//</span><br>
<span class="lineno"></span><span class="comment" id="5309772">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Unmarshal&nbsp;for&nbsp;details&nbsp;about</span><br>
<span class="lineno"></span><span class="comment" id="5309829">//&nbsp;the&nbsp;conversion&nbsp;of&nbsp;JSON&nbsp;into&nbsp;a&nbsp;Go&nbsp;value.</span><br>
<span class="lineno"></span><span class="keyword" id="5309872">func</span>&nbsp;<span class="op" id="5309877">(</span><span class="ident" id="5309878">dec</span>&nbsp;<span class="op" id="5309882">*</span><span class="ident" id="5309883">Decoder</span><span class="op" id="5309890">)</span>&nbsp;<span class="ident" id="5309892">Decode</span><span class="op" id="5309898">(</span><span class="ident" id="5309899">v</span>&nbsp;<span class="keyword" id="5309901">interface</span><span class="op" id="5309910">{</span><span class="op" id="5309911">}</span><span class="op" id="5309912">)</span>&nbsp;<span class="builtintype" id="5309914">error</span>&nbsp;<span class="op" id="5309920">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309923">if</span>&nbsp;<span class="ident" id="5309926">dec</span><span class="op" id="5309929">.</span><span class="ident" id="5309930">err</span>&nbsp;<span class="op" id="5309934">!=</span>&nbsp;<span class="ident" id="5309937">nil</span>&nbsp;<span class="op" id="5309941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309945">return</span>&nbsp;<span class="ident" id="5309952">dec</span><span class="op" id="5309955">.</span><span class="ident" id="5309956">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5309961">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5309965">n</span><span class="op" id="5309966">,</span>&nbsp;<span class="ident" id="5309968">err</span>&nbsp;<span class="op" id="5309972">:=</span>&nbsp;<span class="ident" id="5309975">dec</span><span class="op" id="5309978">.</span><span class="ident" id="5309979">readValue</span><span class="op" id="5309988">(</span><span class="op" id="5309989">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5309992">if</span>&nbsp;<span class="ident" id="5309995">err</span>&nbsp;<span class="op" id="5309999">!=</span>&nbsp;<span class="ident" id="5310002">nil</span>&nbsp;<span class="op" id="5310006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310010">return</span>&nbsp;<span class="ident" id="5310017">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5310022">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310026">//&nbsp;Don&#39;t&nbsp;save&nbsp;err&nbsp;from&nbsp;unmarshal&nbsp;into&nbsp;dec.err:</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310074">//&nbsp;the&nbsp;connection&nbsp;is&nbsp;still&nbsp;usable&nbsp;since&nbsp;we&nbsp;read&nbsp;a&nbsp;complete&nbsp;JSON</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310139">//&nbsp;object&nbsp;from&nbsp;it&nbsp;before&nbsp;the&nbsp;error&nbsp;happened.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310185">dec</span><span class="op" id="5310188">.</span><span class="ident" id="5310189">d</span><span class="op" id="5310190">.</span><span class="ident" id="5310191">init</span><span class="op" id="5310195">(</span><span class="ident" id="5310196">dec</span><span class="op" id="5310199">.</span><span class="ident" id="5310200">buf</span><span class="op" id="5310203">[</span><span class="num" id="5310204">0</span><span class="op" id="5310205">:</span><span class="ident" id="5310206">n</span><span class="op" id="5310207">]</span><span class="op" id="5310208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310211">err</span>&nbsp;<span class="op" id="5310215">=</span>&nbsp;<span class="ident" id="5310217">dec</span><span class="op" id="5310220">.</span><span class="ident" id="5310221">d</span><span class="op" id="5310222">.</span><span class="ident" id="5310223">unmarshal</span><span class="op" id="5310232">(</span><span class="ident" id="5310233">v</span><span class="op" id="5310234">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310238">//&nbsp;Slide&nbsp;rest&nbsp;of&nbsp;data&nbsp;down.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310267">rest</span>&nbsp;<span class="op" id="5310272">:=</span>&nbsp;<span class="builtinfunc" id="5310275">copy</span><span class="op" id="5310279">(</span><span class="ident" id="5310280">dec</span><span class="op" id="5310283">.</span><span class="ident" id="5310284">buf</span><span class="op" id="5310287">,</span>&nbsp;<span class="ident" id="5310289">dec</span><span class="op" id="5310292">.</span><span class="ident" id="5310293">buf</span><span class="op" id="5310296">[</span><span class="ident" id="5310297">n</span><span class="op" id="5310298">:</span><span class="op" id="5310299">]</span><span class="op" id="5310300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310303">dec</span><span class="op" id="5310306">.</span><span class="ident" id="5310307">buf</span>&nbsp;<span class="op" id="5310311">=</span>&nbsp;<span class="ident" id="5310313">dec</span><span class="op" id="5310316">.</span><span class="ident" id="5310317">buf</span><span class="op" id="5310320">[</span><span class="num" id="5310321">0</span><span class="op" id="5310322">:</span><span class="ident" id="5310323">rest</span><span class="op" id="5310327">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310331">return</span>&nbsp;<span class="ident" id="5310338">err</span><br>
<span class="lineno">60</span><span class="op" id="5310342">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5310345">//&nbsp;Buffered&nbsp;returns&nbsp;a&nbsp;reader&nbsp;of&nbsp;the&nbsp;data&nbsp;remaining&nbsp;in&nbsp;the&nbsp;Decoder&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5310413">//&nbsp;buffer.&nbsp;The&nbsp;reader&nbsp;is&nbsp;valid&nbsp;until&nbsp;the&nbsp;next&nbsp;call&nbsp;to&nbsp;Decode.</span><br>
<span class="lineno"></span><span class="keyword" id="5310475">func</span>&nbsp;<span class="op" id="5310480">(</span><span class="ident" id="5310481">dec</span>&nbsp;<span class="op" id="5310485">*</span><span class="ident" id="5310486">Decoder</span><span class="op" id="5310493">)</span>&nbsp;<span class="ident" id="5310495">Buffered</span><span class="op" id="5310503">(</span><span class="op" id="5310504">)</span>&nbsp;<span class="ident" id="5310506">io</span><span class="op" id="5310508">.</span><span class="ident" id="5310509">Reader</span>&nbsp;<span class="op" id="5310516">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310519">return</span>&nbsp;<span class="ident" id="5310526">bytes</span><span class="op" id="5310531">.</span><span class="ident" id="5310532">NewReader</span><span class="op" id="5310541">(</span><span class="ident" id="5310542">dec</span><span class="op" id="5310545">.</span><span class="ident" id="5310546">buf</span><span class="op" id="5310549">)</span><br>
<span class="lineno"></span><span class="op" id="5310551">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5310554">//&nbsp;readValue&nbsp;reads&nbsp;a&nbsp;JSON&nbsp;value&nbsp;into&nbsp;dec.buf.</span><br>
<span class="lineno"></span><span class="comment" id="5310600">//&nbsp;It&nbsp;returns&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;encoding.</span><br>
<span class="lineno">70</span><span class="keyword" id="5310642">func</span>&nbsp;<span class="op" id="5310647">(</span><span class="ident" id="5310648">dec</span>&nbsp;<span class="op" id="5310652">*</span><span class="ident" id="5310653">Decoder</span><span class="op" id="5310660">)</span>&nbsp;<span class="ident" id="5310662">readValue</span><span class="op" id="5310671">(</span><span class="op" id="5310672">)</span>&nbsp;<span class="op" id="5310674">(</span><span class="builtintype" id="5310675">int</span><span class="op" id="5310678">,</span>&nbsp;<span class="builtintype" id="5310680">error</span><span class="op" id="5310685">)</span>&nbsp;<span class="op" id="5310687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310690">dec</span><span class="op" id="5310693">.</span><span class="ident" id="5310694">scan</span><span class="op" id="5310698">.</span><span class="ident" id="5310699">reset</span><span class="op" id="5310704">(</span><span class="op" id="5310705">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310709">scanp</span>&nbsp;<span class="op" id="5310715">:=</span>&nbsp;<span class="num" id="5310718">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310721">var</span>&nbsp;<span class="ident" id="5310725">err</span>&nbsp;<span class="builtintype" id="5310729">error</span><br>
<span class="lineno">75</span><span class="ident" id="5310735">Input</span><span class="op" id="5310740">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310743">for</span>&nbsp;<span class="op" id="5310747">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310751">//&nbsp;Look&nbsp;in&nbsp;the&nbsp;buffer&nbsp;for&nbsp;a&nbsp;new&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310792">for</span>&nbsp;<span class="ident" id="5310796">i</span><span class="op" id="5310797">,</span>&nbsp;<span class="ident" id="5310799">c</span>&nbsp;<span class="op" id="5310801">:=</span>&nbsp;<span class="keyword" id="5310804">range</span>&nbsp;<span class="ident" id="5310810">dec</span><span class="op" id="5310813">.</span><span class="ident" id="5310814">buf</span><span class="op" id="5310817">[</span><span class="ident" id="5310818">scanp</span><span class="op" id="5310823">:</span><span class="op" id="5310824">]</span>&nbsp;<span class="op" id="5310826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310831">dec</span><span class="op" id="5310834">.</span><span class="ident" id="5310835">scan</span><span class="op" id="5310839">.</span><span class="ident" id="5310840">bytes</span><span class="op" id="5310845">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310851">v</span>&nbsp;<span class="op" id="5310853">:=</span>&nbsp;<span class="ident" id="5310856">dec</span><span class="op" id="5310859">.</span><span class="ident" id="5310860">scan</span><span class="op" id="5310864">.</span><span class="ident" id="5310865">step</span><span class="op" id="5310869">(</span><span class="op" id="5310870">&amp;</span><span class="ident" id="5310871">dec</span><span class="op" id="5310874">.</span><span class="ident" id="5310875">scan</span><span class="op" id="5310879">,</span>&nbsp;<span class="builtintype" id="5310881">int</span><span class="op" id="5310884">(</span><span class="ident" id="5310885">c</span><span class="op" id="5310886">)</span><span class="op" id="5310887">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310892">if</span>&nbsp;<span class="ident" id="5310895">v</span>&nbsp;<span class="op" id="5310897">==</span>&nbsp;<span class="ident" id="5310900">scanEnd</span>&nbsp;<span class="op" id="5310908">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5310914">scanp</span>&nbsp;<span class="op" id="5310920">+=</span>&nbsp;<span class="ident" id="5310923">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5310929">break</span>&nbsp;<span class="ident" id="5310935">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5310944">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310949">//&nbsp;scanEnd&nbsp;is&nbsp;delayed&nbsp;one&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5310984">//&nbsp;We&nbsp;might&nbsp;block&nbsp;trying&nbsp;to&nbsp;get&nbsp;that&nbsp;byte&nbsp;from&nbsp;src,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311039">//&nbsp;so&nbsp;instead&nbsp;invent&nbsp;a&nbsp;space&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311077">if</span>&nbsp;<span class="op" id="5311080">(</span><span class="ident" id="5311081">v</span>&nbsp;<span class="op" id="5311083">==</span>&nbsp;<span class="ident" id="5311086">scanEndObject</span>&nbsp;<span class="op" id="5311100">||</span>&nbsp;<span class="ident" id="5311103">v</span>&nbsp;<span class="op" id="5311105">==</span>&nbsp;<span class="ident" id="5311108">scanEndArray</span><span class="op" id="5311120">)</span>&nbsp;<span class="op" id="5311122">&amp;&amp;</span>&nbsp;<span class="ident" id="5311125">dec</span><span class="op" id="5311128">.</span><span class="ident" id="5311129">scan</span><span class="op" id="5311133">.</span><span class="ident" id="5311134">step</span><span class="op" id="5311138">(</span><span class="op" id="5311139">&amp;</span><span class="ident" id="5311140">dec</span><span class="op" id="5311143">.</span><span class="ident" id="5311144">scan</span><span class="op" id="5311148">,</span>&nbsp;<span class="string" id="5311150">&#39;&nbsp;&#39;</span><span class="op" id="5311153">)</span>&nbsp;<span class="op" id="5311155">==</span>&nbsp;<span class="ident" id="5311158">scanEnd</span>&nbsp;<span class="op" id="5311166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311172">scanp</span>&nbsp;<span class="op" id="5311178">+=</span>&nbsp;<span class="ident" id="5311181">i</span>&nbsp;<span class="op" id="5311183">+</span>&nbsp;<span class="num" id="5311185">1</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311191">break</span>&nbsp;<span class="ident" id="5311197">Input</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311206">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311211">if</span>&nbsp;<span class="ident" id="5311214">v</span>&nbsp;<span class="op" id="5311216">==</span>&nbsp;<span class="ident" id="5311219">scanError</span>&nbsp;<span class="op" id="5311229">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311235">dec</span><span class="op" id="5311238">.</span><span class="ident" id="5311239">err</span>&nbsp;<span class="op" id="5311243">=</span>&nbsp;<span class="ident" id="5311245">dec</span><span class="op" id="5311248">.</span><span class="ident" id="5311249">scan</span><span class="op" id="5311253">.</span><span class="ident" id="5311254">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311262">return</span>&nbsp;<span class="num" id="5311269">0</span><span class="op" id="5311270">,</span>&nbsp;<span class="ident" id="5311272">dec</span><span class="op" id="5311275">.</span><span class="ident" id="5311276">scan</span><span class="op" id="5311280">.</span><span class="ident" id="5311281">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311288">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311296">scanp</span>&nbsp;<span class="op" id="5311302">=</span>&nbsp;<span class="builtinfunc" id="5311304">len</span><span class="op" id="5311307">(</span><span class="ident" id="5311308">dec</span><span class="op" id="5311311">.</span><span class="ident" id="5311312">buf</span><span class="op" id="5311315">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311320">//&nbsp;Did&nbsp;the&nbsp;last&nbsp;read&nbsp;have&nbsp;an&nbsp;error?</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311358">//&nbsp;Delayed&nbsp;until&nbsp;now&nbsp;to&nbsp;allow&nbsp;buffer&nbsp;scan.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311403">if</span>&nbsp;<span class="ident" id="5311406">err</span>&nbsp;<span class="op" id="5311410">!=</span>&nbsp;<span class="ident" id="5311413">nil</span>&nbsp;<span class="op" id="5311417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311422">if</span>&nbsp;<span class="ident" id="5311425">err</span>&nbsp;<span class="op" id="5311429">==</span>&nbsp;<span class="ident" id="5311432">io</span><span class="op" id="5311434">.</span><span class="ident" id="5311435">EOF</span>&nbsp;<span class="op" id="5311439">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311445">if</span>&nbsp;<span class="ident" id="5311448">dec</span><span class="op" id="5311451">.</span><span class="ident" id="5311452">scan</span><span class="op" id="5311456">.</span><span class="ident" id="5311457">step</span><span class="op" id="5311461">(</span><span class="op" id="5311462">&amp;</span><span class="ident" id="5311463">dec</span><span class="op" id="5311466">.</span><span class="ident" id="5311467">scan</span><span class="op" id="5311471">,</span>&nbsp;<span class="string" id="5311473">&#39;&nbsp;&#39;</span><span class="op" id="5311476">)</span>&nbsp;<span class="op" id="5311478">==</span>&nbsp;<span class="ident" id="5311481">scanEnd</span>&nbsp;<span class="op" id="5311489">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311496">break</span>&nbsp;<span class="ident" id="5311502">Input</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311512">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311518">if</span>&nbsp;<span class="ident" id="5311521">nonSpace</span><span class="op" id="5311529">(</span><span class="ident" id="5311530">dec</span><span class="op" id="5311533">.</span><span class="ident" id="5311534">buf</span><span class="op" id="5311537">)</span>&nbsp;<span class="op" id="5311539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311546">err</span>&nbsp;<span class="op" id="5311550">=</span>&nbsp;<span class="ident" id="5311552">io</span><span class="op" id="5311554">.</span><span class="ident" id="5311555">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311581">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311586">dec</span><span class="op" id="5311589">.</span><span class="ident" id="5311590">err</span>&nbsp;<span class="op" id="5311594">=</span>&nbsp;<span class="ident" id="5311596">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311603">return</span>&nbsp;<span class="num" id="5311610">0</span><span class="op" id="5311611">,</span>&nbsp;<span class="ident" id="5311613">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311624">//&nbsp;Make&nbsp;room&nbsp;to&nbsp;read&nbsp;more&nbsp;into&nbsp;the&nbsp;buffer.</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311669">const</span>&nbsp;<span class="ident" id="5311675">minRead</span>&nbsp;<span class="op" id="5311683">=</span>&nbsp;<span class="num" id="5311685">512</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311691">if</span>&nbsp;<span class="builtinfunc" id="5311694">cap</span><span class="op" id="5311697">(</span><span class="ident" id="5311698">dec</span><span class="op" id="5311701">.</span><span class="ident" id="5311702">buf</span><span class="op" id="5311705">)</span><span class="op" id="5311706">-</span><span class="builtinfunc" id="5311707">len</span><span class="op" id="5311710">(</span><span class="ident" id="5311711">dec</span><span class="op" id="5311714">.</span><span class="ident" id="5311715">buf</span><span class="op" id="5311718">)</span>&nbsp;<span class="op" id="5311720">&lt;</span>&nbsp;<span class="ident" id="5311722">minRead</span>&nbsp;<span class="op" id="5311730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311735">newBuf</span>&nbsp;<span class="op" id="5311742">:=</span>&nbsp;<span class="builtinfunc" id="5311745">make</span><span class="op" id="5311749">(</span><span class="op" id="5311750">[</span><span class="op" id="5311751">]</span><span class="builtintype" id="5311752">byte</span><span class="op" id="5311756">,</span>&nbsp;<span class="builtinfunc" id="5311758">len</span><span class="op" id="5311761">(</span><span class="ident" id="5311762">dec</span><span class="op" id="5311765">.</span><span class="ident" id="5311766">buf</span><span class="op" id="5311769">)</span><span class="op" id="5311770">,</span>&nbsp;<span class="num" id="5311772">2</span><span class="op" id="5311773">*</span><span class="builtinfunc" id="5311774">cap</span><span class="op" id="5311777">(</span><span class="ident" id="5311778">dec</span><span class="op" id="5311781">.</span><span class="ident" id="5311782">buf</span><span class="op" id="5311785">)</span><span class="op" id="5311786">+</span><span class="ident" id="5311787">minRead</span><span class="op" id="5311794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5311799">copy</span><span class="op" id="5311803">(</span><span class="ident" id="5311804">newBuf</span><span class="op" id="5311810">,</span>&nbsp;<span class="ident" id="5311812">dec</span><span class="op" id="5311815">.</span><span class="ident" id="5311816">buf</span><span class="op" id="5311819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311824">dec</span><span class="op" id="5311827">.</span><span class="ident" id="5311828">buf</span>&nbsp;<span class="op" id="5311832">=</span>&nbsp;<span class="ident" id="5311834">newBuf</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5311843">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5311848">//&nbsp;Read.&nbsp;&nbsp;Delay&nbsp;error&nbsp;for&nbsp;next&nbsp;iteration&nbsp;(after&nbsp;scan).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5311905">var</span>&nbsp;<span class="ident" id="5311909">n</span>&nbsp;<span class="builtintype" id="5311911">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311917">n</span><span class="op" id="5311918">,</span>&nbsp;<span class="ident" id="5311920">err</span>&nbsp;<span class="op" id="5311924">=</span>&nbsp;<span class="ident" id="5311926">dec</span><span class="op" id="5311929">.</span><span class="ident" id="5311930">r</span><span class="op" id="5311931">.</span><span class="ident" id="5311932">Read</span><span class="op" id="5311936">(</span><span class="ident" id="5311937">dec</span><span class="op" id="5311940">.</span><span class="ident" id="5311941">buf</span><span class="op" id="5311944">[</span><span class="builtinfunc" id="5311945">len</span><span class="op" id="5311948">(</span><span class="ident" id="5311949">dec</span><span class="op" id="5311952">.</span><span class="ident" id="5311953">buf</span><span class="op" id="5311956">)</span><span class="op" id="5311957">:</span><span class="builtinfunc" id="5311958">cap</span><span class="op" id="5311961">(</span><span class="ident" id="5311962">dec</span><span class="op" id="5311965">.</span><span class="ident" id="5311966">buf</span><span class="op" id="5311969">)</span><span class="op" id="5311970">]</span><span class="op" id="5311971">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5311975">dec</span><span class="op" id="5311978">.</span><span class="ident" id="5311979">buf</span>&nbsp;<span class="op" id="5311983">=</span>&nbsp;<span class="ident" id="5311985">dec</span><span class="op" id="5311988">.</span><span class="ident" id="5311989">buf</span><span class="op" id="5311992">[</span><span class="num" id="5311993">0</span>&nbsp;<span class="op" id="5311995">:</span>&nbsp;<span class="builtinfunc" id="5311997">len</span><span class="op" id="5312000">(</span><span class="ident" id="5312001">dec</span><span class="op" id="5312004">.</span><span class="ident" id="5312005">buf</span><span class="op" id="5312008">)</span><span class="op" id="5312009">+</span><span class="ident" id="5312010">n</span><span class="op" id="5312011">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312014">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312017">return</span>&nbsp;<span class="ident" id="5312024">scanp</span><span class="op" id="5312029">,</span>&nbsp;<span class="ident" id="5312031">nil</span><br>
<span class="lineno"></span><span class="op" id="5312035">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="5312038">func</span>&nbsp;<span class="ident" id="5312043">nonSpace</span><span class="op" id="5312051">(</span><span class="ident" id="5312052">b</span>&nbsp;<span class="op" id="5312054">[</span><span class="op" id="5312055">]</span><span class="builtintype" id="5312056">byte</span><span class="op" id="5312060">)</span>&nbsp;<span class="builtintype" id="5312062">bool</span>&nbsp;<span class="op" id="5312067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312070">for</span>&nbsp;<span class="ident" id="5312074">_</span><span class="op" id="5312075">,</span>&nbsp;<span class="ident" id="5312077">c</span>&nbsp;<span class="op" id="5312079">:=</span>&nbsp;<span class="keyword" id="5312082">range</span>&nbsp;<span class="ident" id="5312088">b</span>&nbsp;<span class="op" id="5312090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312094">if</span>&nbsp;<span class="op" id="5312097">!</span><span class="ident" id="5312098">isSpace</span><span class="op" id="5312105">(</span><span class="builtintype" id="5312106">rune</span><span class="op" id="5312110">(</span><span class="ident" id="5312111">c</span><span class="op" id="5312112">)</span><span class="op" id="5312113">)</span>&nbsp;<span class="op" id="5312115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312120">return</span>&nbsp;<span class="builtintype" id="5312127">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312134">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312137">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312140">return</span>&nbsp;<span class="builtintype" id="5312147">false</span><br>
<span class="lineno"></span><span class="op" id="5312153">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5312156">//&nbsp;An&nbsp;Encoder&nbsp;writes&nbsp;JSON&nbsp;objects&nbsp;to&nbsp;an&nbsp;output&nbsp;stream.</span><br>
<span class="lineno">140</span><span class="keyword" id="5312211">type</span>&nbsp;<span class="ident" id="5312216">Encoder</span>&nbsp;<span class="keyword" id="5312224">struct</span>&nbsp;<span class="op" id="5312231">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312234">w</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5312238">io</span><span class="op" id="5312240">.</span><span class="ident" id="5312241">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312249">err</span>&nbsp;<span class="builtintype" id="5312253">error</span><br>
<span class="lineno"></span><span class="op" id="5312259">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="5312262">//&nbsp;NewEncoder&nbsp;returns&nbsp;a&nbsp;new&nbsp;encoder&nbsp;that&nbsp;writes&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5312316">func</span>&nbsp;<span class="ident" id="5312321">NewEncoder</span><span class="op" id="5312331">(</span><span class="ident" id="5312332">w</span>&nbsp;<span class="ident" id="5312334">io</span><span class="op" id="5312336">.</span><span class="ident" id="5312337">Writer</span><span class="op" id="5312343">)</span>&nbsp;<span class="op" id="5312345">*</span><span class="ident" id="5312346">Encoder</span>&nbsp;<span class="op" id="5312354">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312357">return</span>&nbsp;<span class="op" id="5312364">&amp;</span><span class="ident" id="5312365">Encoder</span><span class="op" id="5312372">{</span><span class="ident" id="5312373">w</span><span class="op" id="5312374">:</span>&nbsp;<span class="ident" id="5312376">w</span><span class="op" id="5312377">}</span><br>
<span class="lineno"></span><span class="op" id="5312379">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span><span class="comment" id="5312382">//&nbsp;Encode&nbsp;writes&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;v&nbsp;to&nbsp;the&nbsp;stream,</span><br>
<span class="lineno"></span><span class="comment" id="5312437">//&nbsp;followed&nbsp;by&nbsp;a&nbsp;newline&nbsp;character.</span><br>
<span class="lineno"></span><span class="comment" id="5312473">//</span><br>
<span class="lineno"></span><span class="comment" id="5312476">//&nbsp;See&nbsp;the&nbsp;documentation&nbsp;for&nbsp;Marshal&nbsp;for&nbsp;details&nbsp;about&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5312535">//&nbsp;conversion&nbsp;of&nbsp;Go&nbsp;values&nbsp;to&nbsp;JSON.</span><br>
<span class="lineno">155</span><span class="keyword" id="5312571">func</span>&nbsp;<span class="op" id="5312576">(</span><span class="ident" id="5312577">enc</span>&nbsp;<span class="op" id="5312581">*</span><span class="ident" id="5312582">Encoder</span><span class="op" id="5312589">)</span>&nbsp;<span class="ident" id="5312591">Encode</span><span class="op" id="5312597">(</span><span class="ident" id="5312598">v</span>&nbsp;<span class="keyword" id="5312600">interface</span><span class="op" id="5312609">{</span><span class="op" id="5312610">}</span><span class="op" id="5312611">)</span>&nbsp;<span class="builtintype" id="5312613">error</span>&nbsp;<span class="op" id="5312619">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312622">if</span>&nbsp;<span class="ident" id="5312625">enc</span><span class="op" id="5312628">.</span><span class="ident" id="5312629">err</span>&nbsp;<span class="op" id="5312633">!=</span>&nbsp;<span class="ident" id="5312636">nil</span>&nbsp;<span class="op" id="5312640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312644">return</span>&nbsp;<span class="ident" id="5312651">enc</span><span class="op" id="5312654">.</span><span class="ident" id="5312655">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312660">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312663">e</span>&nbsp;<span class="op" id="5312665">:=</span>&nbsp;<span class="ident" id="5312668">newEncodeState</span><span class="op" id="5312682">(</span><span class="op" id="5312683">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312686">err</span>&nbsp;<span class="op" id="5312690">:=</span>&nbsp;<span class="ident" id="5312693">e</span><span class="op" id="5312694">.</span><span class="ident" id="5312695">marshal</span><span class="op" id="5312702">(</span><span class="ident" id="5312703">v</span><span class="op" id="5312704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312707">if</span>&nbsp;<span class="ident" id="5312710">err</span>&nbsp;<span class="op" id="5312714">!=</span>&nbsp;<span class="ident" id="5312717">nil</span>&nbsp;<span class="op" id="5312721">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5312725">return</span>&nbsp;<span class="ident" id="5312732">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5312737">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312741">//&nbsp;Terminate&nbsp;each&nbsp;value&nbsp;with&nbsp;a&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312782">//&nbsp;This&nbsp;makes&nbsp;the&nbsp;output&nbsp;look&nbsp;a&nbsp;little&nbsp;nicer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312828">//&nbsp;when&nbsp;debugging,&nbsp;and&nbsp;some&nbsp;kind&nbsp;of&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312871">//&nbsp;is&nbsp;required&nbsp;if&nbsp;the&nbsp;encoded&nbsp;value&nbsp;was&nbsp;a&nbsp;number,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312922">//&nbsp;so&nbsp;that&nbsp;the&nbsp;reader&nbsp;knows&nbsp;there&nbsp;aren&#39;t&nbsp;more</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5312969">//&nbsp;digits&nbsp;coming.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5312988">e</span><span class="op" id="5312989">.</span><span class="ident" id="5312990">WriteByte</span><span class="op" id="5312999">(</span><span class="string" id="5313000">&#39;\n&#39;</span><span class="op" id="5313004">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313008">if</span>&nbsp;<span class="ident" id="5313011">_</span><span class="op" id="5313012">,</span>&nbsp;<span class="ident" id="5313014">err</span>&nbsp;<span class="op" id="5313018">=</span>&nbsp;<span class="ident" id="5313020">enc</span><span class="op" id="5313023">.</span><span class="ident" id="5313024">w</span><span class="op" id="5313025">.</span><span class="ident" id="5313026">Write</span><span class="op" id="5313031">(</span><span class="ident" id="5313032">e</span><span class="op" id="5313033">.</span><span class="ident" id="5313034">Bytes</span><span class="op" id="5313039">(</span><span class="op" id="5313040">)</span><span class="op" id="5313041">)</span><span class="op" id="5313042">;</span>&nbsp;<span class="ident" id="5313044">err</span>&nbsp;<span class="op" id="5313048">!=</span>&nbsp;<span class="ident" id="5313051">nil</span>&nbsp;<span class="op" id="5313055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313059">enc</span><span class="op" id="5313062">.</span><span class="ident" id="5313063">err</span>&nbsp;<span class="op" id="5313067">=</span>&nbsp;<span class="ident" id="5313069">err</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313074">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5313077">encodeStatePool</span><span class="op" id="5313092">.</span><span class="ident" id="5313093">Put</span><span class="op" id="5313096">(</span><span class="ident" id="5313097">e</span><span class="op" id="5313098">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313101">return</span>&nbsp;<span class="ident" id="5313108">err</span><br>
<span class="lineno"></span><span class="op" id="5313112">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">180</span><span class="comment" id="5313115">//&nbsp;RawMessage&nbsp;is&nbsp;a&nbsp;raw&nbsp;encoded&nbsp;JSON&nbsp;object.</span><br>
<span class="lineno"></span><span class="comment" id="5313159">//&nbsp;It&nbsp;implements&nbsp;Marshaler&nbsp;and&nbsp;Unmarshaler&nbsp;and&nbsp;can</span><br>
<span class="lineno"></span><span class="comment" id="5313210">//&nbsp;be&nbsp;used&nbsp;to&nbsp;delay&nbsp;JSON&nbsp;decoding&nbsp;or&nbsp;precompute&nbsp;a&nbsp;JSON&nbsp;encoding.</span><br>
<span class="lineno"></span><span class="keyword" id="5313275">type</span>&nbsp;<span class="ident" id="5313280">RawMessage</span>&nbsp;<span class="op" id="5313291">[</span><span class="op" id="5313292">]</span><span class="builtintype" id="5313293">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span><span class="comment" id="5313299">//&nbsp;MarshalJSON&nbsp;returns&nbsp;*m&nbsp;as&nbsp;the&nbsp;JSON&nbsp;encoding&nbsp;of&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="5313352">func</span>&nbsp;<span class="op" id="5313357">(</span><span class="ident" id="5313358">m</span>&nbsp;<span class="op" id="5313360">*</span><span class="ident" id="5313361">RawMessage</span><span class="op" id="5313371">)</span>&nbsp;<span class="ident" id="5313373">MarshalJSON</span><span class="op" id="5313384">(</span><span class="op" id="5313385">)</span>&nbsp;<span class="op" id="5313387">(</span><span class="op" id="5313388">[</span><span class="op" id="5313389">]</span><span class="builtintype" id="5313390">byte</span><span class="op" id="5313394">,</span>&nbsp;<span class="builtintype" id="5313396">error</span><span class="op" id="5313401">)</span>&nbsp;<span class="op" id="5313403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313406">return</span>&nbsp;<span class="op" id="5313413">*</span><span class="ident" id="5313414">m</span><span class="op" id="5313415">,</span>&nbsp;<span class="ident" id="5313417">nil</span><br>
<span class="lineno"></span><span class="op" id="5313421">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="5313424">//&nbsp;UnmarshalJSON&nbsp;sets&nbsp;*m&nbsp;to&nbsp;a&nbsp;copy&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5313468">func</span>&nbsp;<span class="op" id="5313473">(</span><span class="ident" id="5313474">m</span>&nbsp;<span class="op" id="5313476">*</span><span class="ident" id="5313477">RawMessage</span><span class="op" id="5313487">)</span>&nbsp;<span class="ident" id="5313489">UnmarshalJSON</span><span class="op" id="5313502">(</span><span class="ident" id="5313503">data</span>&nbsp;<span class="op" id="5313508">[</span><span class="op" id="5313509">]</span><span class="builtintype" id="5313510">byte</span><span class="op" id="5313514">)</span>&nbsp;<span class="builtintype" id="5313516">error</span>&nbsp;<span class="op" id="5313522">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313525">if</span>&nbsp;<span class="ident" id="5313528">m</span>&nbsp;<span class="op" id="5313530">==</span>&nbsp;<span class="ident" id="5313533">nil</span>&nbsp;<span class="op" id="5313537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313541">return</span>&nbsp;<span class="ident" id="5313548">errors</span><span class="op" id="5313554">.</span><span class="ident" id="5313555">New</span><span class="op" id="5313558">(</span><span class="string" id="5313559">&#34;json.RawMessage:&nbsp;UnmarshalJSON&nbsp;on&nbsp;nil&nbsp;pointer&#34;</span><span class="op" id="5313606">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313609">}</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5313612">*</span><span class="ident" id="5313613">m</span>&nbsp;<span class="op" id="5313615">=</span>&nbsp;<span class="builtinfunc" id="5313617">append</span><span class="op" id="5313623">(</span><span class="op" id="5313624">(</span><span class="op" id="5313625">*</span><span class="ident" id="5313626">m</span><span class="op" id="5313627">)</span><span class="op" id="5313628">[</span><span class="num" id="5313629">0</span><span class="op" id="5313630">:</span><span class="num" id="5313631">0</span><span class="op" id="5313632">]</span><span class="op" id="5313633">,</span>&nbsp;<span class="ident" id="5313635">data</span><span class="op" id="5313639">...</span><span class="op" id="5313642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5313645">return</span>&nbsp;<span class="ident" id="5313652">nil</span><br>
<span class="lineno"></span><span class="op" id="5313656">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5313659">var</span>&nbsp;<span class="ident" id="5313663">_</span>&nbsp;<span class="ident" id="5313665">Marshaler</span>&nbsp;<span class="op" id="5313675">=</span>&nbsp;<span class="op" id="5313677">(</span><span class="op" id="5313678">*</span><span class="ident" id="5313679">RawMessage</span><span class="op" id="5313689">)</span><span class="op" id="5313690">(</span><span class="ident" id="5313691">nil</span><span class="op" id="5313694">)</span><br>
<span class="lineno">200</span><span class="keyword" id="5313696">var</span>&nbsp;<span class="ident" id="5313700">_</span>&nbsp;<span class="ident" id="5313702">Unmarshaler</span>&nbsp;<span class="op" id="5313714">=</span>&nbsp;<span class="op" id="5313716">(</span><span class="op" id="5313717">*</span><span class="ident" id="5313718">RawMessage</span><span class="op" id="5313728">)</span><span class="op" id="5313729">(</span><span class="ident" id="5313730">nil</span><span class="op" id="5313733">)</span>
</div>
</body>
</html>
