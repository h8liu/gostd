<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>testing/iotest</h2>
<ul>
<li><a href="/gostd/testing/iotest/logger.go.html">logger.go</a></li>
<li><a href="/gostd/testing/iotest/reader.go.html">reader.go</a></li>
<li><a href="/gostd/testing/iotest/writer.go.html" class="current">writer.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="6123168">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="6123223">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="6123277">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="6123328">package</span>&nbsp;<span class="ident" id="6123336">iotest</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="6123344">import</span>&nbsp;<span class="string" id="6123351">&#34;io&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="6123357">//&nbsp;TruncateWriter&nbsp;returns&nbsp;a&nbsp;Writer&nbsp;that&nbsp;writes&nbsp;to&nbsp;w</span><br>
<span class="lineno">10</span><span class="comment" id="6123409">//&nbsp;but&nbsp;stops&nbsp;silently&nbsp;after&nbsp;n&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="6123446">func</span>&nbsp;<span class="ident" id="6123451">TruncateWriter</span><span class="op" id="6123465">(</span><span class="ident" id="6123466">w</span>&nbsp;<span class="ident" id="6123468">io</span><span class="op" id="6123470">.</span><span class="ident" id="6123471">Writer</span><span class="op" id="6123477">,</span>&nbsp;<span class="ident" id="6123479">n</span>&nbsp;<span class="ident" id="6123481">int64</span><span class="op" id="6123486">)</span>&nbsp;<span class="ident" id="6123488">io</span><span class="op" id="6123490">.</span><span class="ident" id="6123491">Writer</span>&nbsp;<span class="op" id="6123498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123501">return</span>&nbsp;<span class="op" id="6123508">&amp;</span><span class="ident" id="6123509">truncateWriter</span><span class="op" id="6123523">{</span><span class="ident" id="6123524">w</span><span class="op" id="6123525">,</span>&nbsp;<span class="ident" id="6123527">n</span><span class="op" id="6123528">}</span><br>
<span class="lineno"></span><span class="op" id="6123530">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="6123533">type</span>&nbsp;<span class="ident" id="6123538">truncateWriter</span>&nbsp;<span class="keyword" id="6123553">struct</span>&nbsp;<span class="op" id="6123560">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123563">w</span>&nbsp;<span class="ident" id="6123565">io</span><span class="op" id="6123567">.</span><span class="ident" id="6123568">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123576">n</span>&nbsp;<span class="ident" id="6123578">int64</span><br>
<span class="lineno"></span><span class="op" id="6123584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="6123587">func</span>&nbsp;<span class="op" id="6123592">(</span><span class="ident" id="6123593">t</span>&nbsp;<span class="op" id="6123595">*</span><span class="ident" id="6123596">truncateWriter</span><span class="op" id="6123610">)</span>&nbsp;<span class="ident" id="6123612">Write</span><span class="op" id="6123617">(</span><span class="ident" id="6123618">p</span>&nbsp;<span class="op" id="6123620">[</span><span class="op" id="6123621">]</span><span class="builtintype" id="6123622">byte</span><span class="op" id="6123626">)</span>&nbsp;<span class="op" id="6123628">(</span><span class="ident" id="6123629">n</span>&nbsp;<span class="builtintype" id="6123631">int</span><span class="op" id="6123634">,</span>&nbsp;<span class="ident" id="6123636">err</span>&nbsp;<span class="builtintype" id="6123640">error</span><span class="op" id="6123645">)</span>&nbsp;<span class="op" id="6123647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123650">if</span>&nbsp;<span class="ident" id="6123653">t</span><span class="op" id="6123654">.</span><span class="ident" id="6123655">n</span>&nbsp;<span class="op" id="6123657">&lt;=</span>&nbsp;<span class="num" id="6123660">0</span>&nbsp;<span class="op" id="6123662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123666">return</span>&nbsp;<span class="builtinfunc" id="6123673">len</span><span class="op" id="6123676">(</span><span class="ident" id="6123677">p</span><span class="op" id="6123678">)</span><span class="op" id="6123679">,</span>&nbsp;<span class="ident" id="6123681">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="6123689">//&nbsp;real&nbsp;write</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123704">n</span>&nbsp;<span class="op" id="6123706">=</span>&nbsp;<span class="builtinfunc" id="6123708">len</span><span class="op" id="6123711">(</span><span class="ident" id="6123712">p</span><span class="op" id="6123713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123716">if</span>&nbsp;<span class="ident" id="6123719">int64</span><span class="op" id="6123724">(</span><span class="ident" id="6123725">n</span><span class="op" id="6123726">)</span>&nbsp;<span class="op" id="6123728">&gt;</span>&nbsp;<span class="ident" id="6123730">t</span><span class="op" id="6123731">.</span><span class="ident" id="6123732">n</span>&nbsp;<span class="op" id="6123734">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123738">n</span>&nbsp;<span class="op" id="6123740">=</span>&nbsp;<span class="builtintype" id="6123742">int</span><span class="op" id="6123745">(</span><span class="ident" id="6123746">t</span><span class="op" id="6123747">.</span><span class="ident" id="6123748">n</span><span class="op" id="6123749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123755">n</span><span class="op" id="6123756">,</span>&nbsp;<span class="ident" id="6123758">err</span>&nbsp;<span class="op" id="6123762">=</span>&nbsp;<span class="ident" id="6123764">t</span><span class="op" id="6123765">.</span><span class="ident" id="6123766">w</span><span class="op" id="6123767">.</span><span class="ident" id="6123768">Write</span><span class="op" id="6123773">(</span><span class="ident" id="6123774">p</span><span class="op" id="6123775">[</span><span class="num" id="6123776">0</span><span class="op" id="6123777">:</span><span class="ident" id="6123778">n</span><span class="op" id="6123779">]</span><span class="op" id="6123780">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123783">t</span><span class="op" id="6123784">.</span><span class="ident" id="6123785">n</span>&nbsp;<span class="op" id="6123787">-=</span>&nbsp;<span class="ident" id="6123790">int64</span><span class="op" id="6123795">(</span><span class="ident" id="6123796">n</span><span class="op" id="6123797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123800">if</span>&nbsp;<span class="ident" id="6123803">err</span>&nbsp;<span class="op" id="6123807">==</span>&nbsp;<span class="ident" id="6123810">nil</span>&nbsp;<span class="op" id="6123814">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="6123818">n</span>&nbsp;<span class="op" id="6123820">=</span>&nbsp;<span class="builtinfunc" id="6123822">len</span><span class="op" id="6123825">(</span><span class="ident" id="6123826">p</span><span class="op" id="6123827">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="6123830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="6123833">return</span><br>
<span class="lineno">35</span><span class="op" id="6123840">}</span>
</div>
</body>
</html>
