<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2536471">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2536527">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2536581">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2536632">//&nbsp;+build&nbsp;darwin&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2536697">//&nbsp;Socket&nbsp;control&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2536725">package</span>&nbsp;<span class="ident" id="2536733">syscall</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2536742">import</span>&nbsp;<span class="string" id="2536749">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2536759">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;raw&nbsp;sockaddr&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2536822">func</span>&nbsp;<span class="ident" id="2536827">cmsgAlignOf</span><span class="op" id="2536838">(</span><span class="ident" id="2536839">salen</span>&nbsp;<span class="builtintype" id="2536845">int</span><span class="op" id="2536848">)</span>&nbsp;<span class="builtintype" id="2536850">int</span>&nbsp;<span class="op" id="2536854">{</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2536857">salign</span>&nbsp;<span class="op" id="2536864">:=</span>&nbsp;<span class="ident" id="2536867">sizeofPtr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2536878">//&nbsp;NOTE:&nbsp;It&nbsp;seems&nbsp;like&nbsp;64-bit&nbsp;Darwin&nbsp;and&nbsp;DragonFly&nbsp;BSD&nbsp;kernels</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2536942">//&nbsp;still&nbsp;require&nbsp;32-bit&nbsp;aligned&nbsp;access&nbsp;to&nbsp;network&nbsp;subsystem.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537004">if</span>&nbsp;<span class="ident" id="2537007">darwin64Bit</span>&nbsp;<span class="op" id="2537019">||</span>&nbsp;<span class="ident" id="2537022">dragonfly64Bit</span>&nbsp;<span class="op" id="2537037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537041">salign</span>&nbsp;<span class="op" id="2537048">=</span>&nbsp;<span class="num" id="2537050">4</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2537053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537056">return</span>&nbsp;<span class="op" id="2537063">(</span><span class="ident" id="2537064">salen</span>&nbsp;<span class="op" id="2537070">+</span>&nbsp;<span class="ident" id="2537072">salign</span>&nbsp;<span class="op" id="2537079">-</span>&nbsp;<span class="num" id="2537081">1</span><span class="op" id="2537082">)</span>&nbsp;<span class="op" id="2537084">&amp;</span>&nbsp;<span class="op" id="2537086">^</span><span class="op" id="2537087">(</span><span class="ident" id="2537088">salign</span>&nbsp;<span class="op" id="2537095">-</span>&nbsp;<span class="num" id="2537097">1</span><span class="op" id="2537098">)</span><br>
<span class="lineno"></span><span class="op" id="2537100">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2537103">//&nbsp;CmsgLen&nbsp;returns&nbsp;the&nbsp;value&nbsp;to&nbsp;store&nbsp;in&nbsp;the&nbsp;Len&nbsp;field&nbsp;of&nbsp;the&nbsp;Cmsghdr</span><br>
<span class="lineno">25</span><span class="comment" id="2537173">//&nbsp;structure,&nbsp;taking&nbsp;into&nbsp;account&nbsp;any&nbsp;necessary&nbsp;alignment.</span><br>
<span class="lineno"></span><span class="keyword" id="2537232">func</span>&nbsp;<span class="ident" id="2537237">CmsgLen</span><span class="op" id="2537244">(</span><span class="ident" id="2537245">datalen</span>&nbsp;<span class="builtintype" id="2537253">int</span><span class="op" id="2537256">)</span>&nbsp;<span class="builtintype" id="2537258">int</span>&nbsp;<span class="op" id="2537262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537265">return</span>&nbsp;<span class="ident" id="2537272">cmsgAlignOf</span><span class="op" id="2537283">(</span><span class="ident" id="2537284">SizeofCmsghdr</span><span class="op" id="2537297">)</span>&nbsp;<span class="op" id="2537299">+</span>&nbsp;<span class="ident" id="2537301">datalen</span><br>
<span class="lineno"></span><span class="op" id="2537309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="2537312">//&nbsp;CmsgSpace&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;an&nbsp;ancillary&nbsp;element&nbsp;with</span><br>
<span class="lineno"></span><span class="comment" id="2537379">//&nbsp;payload&nbsp;of&nbsp;the&nbsp;passed&nbsp;data&nbsp;length&nbsp;occupies.</span><br>
<span class="lineno"></span><span class="keyword" id="2537426">func</span>&nbsp;<span class="ident" id="2537431">CmsgSpace</span><span class="op" id="2537440">(</span><span class="ident" id="2537441">datalen</span>&nbsp;<span class="builtintype" id="2537449">int</span><span class="op" id="2537452">)</span>&nbsp;<span class="builtintype" id="2537454">int</span>&nbsp;<span class="op" id="2537458">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537461">return</span>&nbsp;<span class="ident" id="2537468">cmsgAlignOf</span><span class="op" id="2537479">(</span><span class="ident" id="2537480">SizeofCmsghdr</span><span class="op" id="2537493">)</span>&nbsp;<span class="op" id="2537495">+</span>&nbsp;<span class="ident" id="2537497">cmsgAlignOf</span><span class="op" id="2537508">(</span><span class="ident" id="2537509">datalen</span><span class="op" id="2537516">)</span><br>
<span class="lineno"></span><span class="op" id="2537518">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="2537521">func</span>&nbsp;<span class="ident" id="2537526">cmsgData</span><span class="op" id="2537534">(</span><span class="ident" id="2537535">h</span>&nbsp;<span class="op" id="2537537">*</span><span class="ident" id="2537538">Cmsghdr</span><span class="op" id="2537545">)</span>&nbsp;<span class="ident" id="2537547">unsafe</span><span class="op" id="2537553">.</span><span class="ident" id="2537554">Pointer</span>&nbsp;<span class="op" id="2537562">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537565">return</span>&nbsp;<span class="ident" id="2537572">unsafe</span><span class="op" id="2537578">.</span><span class="ident" id="2537579">Pointer</span><span class="op" id="2537586">(</span><span class="builtintype" id="2537587">uintptr</span><span class="op" id="2537594">(</span><span class="ident" id="2537595">unsafe</span><span class="op" id="2537601">.</span><span class="ident" id="2537602">Pointer</span><span class="op" id="2537609">(</span><span class="ident" id="2537610">h</span><span class="op" id="2537611">)</span><span class="op" id="2537612">)</span>&nbsp;<span class="op" id="2537614">+</span>&nbsp;<span class="builtintype" id="2537616">uintptr</span><span class="op" id="2537623">(</span><span class="ident" id="2537624">cmsgAlignOf</span><span class="op" id="2537635">(</span><span class="ident" id="2537636">SizeofCmsghdr</span><span class="op" id="2537649">)</span><span class="op" id="2537650">)</span><span class="op" id="2537651">)</span><br>
<span class="lineno"></span><span class="op" id="2537653">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="comment" id="2537656">//&nbsp;SocketControlMessage&nbsp;represents&nbsp;a&nbsp;socket&nbsp;control&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2537717">type</span>&nbsp;<span class="ident" id="2537722">SocketControlMessage</span>&nbsp;<span class="keyword" id="2537743">struct</span>&nbsp;<span class="op" id="2537750">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537753">Header</span>&nbsp;<span class="ident" id="2537760">Cmsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537769">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2537776">[</span><span class="op" id="2537777">]</span><span class="builtintype" id="2537778">byte</span><br>
<span class="lineno"></span><span class="op" id="2537783">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="2537786">//&nbsp;ParseSocketControlMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;socket&nbsp;control</span><br>
<span class="lineno"></span><span class="comment" id="2537854">//&nbsp;messages.</span><br>
<span class="lineno"></span><span class="keyword" id="2537867">func</span>&nbsp;<span class="ident" id="2537872">ParseSocketControlMessage</span><span class="op" id="2537897">(</span><span class="ident" id="2537898">b</span>&nbsp;<span class="op" id="2537900">[</span><span class="op" id="2537901">]</span><span class="builtintype" id="2537902">byte</span><span class="op" id="2537906">)</span>&nbsp;<span class="op" id="2537908">(</span><span class="op" id="2537909">[</span><span class="op" id="2537910">]</span><span class="ident" id="2537911">SocketControlMessage</span><span class="op" id="2537931">,</span>&nbsp;<span class="builtintype" id="2537933">error</span><span class="op" id="2537938">)</span>&nbsp;<span class="op" id="2537940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537943">var</span>&nbsp;<span class="ident" id="2537947">msgs</span>&nbsp;<span class="op" id="2537952">[</span><span class="op" id="2537953">]</span><span class="ident" id="2537954">SocketControlMessage</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2537976">i</span>&nbsp;<span class="op" id="2537978">:=</span>&nbsp;<span class="num" id="2537981">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2537984">for</span>&nbsp;<span class="ident" id="2537988">i</span><span class="op" id="2537989">+</span><span class="ident" id="2537990">CmsgLen</span><span class="op" id="2537997">(</span><span class="num" id="2537998">0</span><span class="op" id="2537999">)</span>&nbsp;<span class="op" id="2538001">&lt;=</span>&nbsp;<span class="builtinfunc" id="2538004">len</span><span class="op" id="2538007">(</span><span class="ident" id="2538008">b</span><span class="op" id="2538009">)</span>&nbsp;<span class="op" id="2538011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538015">h</span><span class="op" id="2538016">,</span>&nbsp;<span class="ident" id="2538018">dbuf</span><span class="op" id="2538022">,</span>&nbsp;<span class="ident" id="2538024">err</span>&nbsp;<span class="op" id="2538028">:=</span>&nbsp;<span class="ident" id="2538031">socketControlMessageHeaderAndData</span><span class="op" id="2538064">(</span><span class="ident" id="2538065">b</span><span class="op" id="2538066">[</span><span class="ident" id="2538067">i</span><span class="op" id="2538068">:</span><span class="op" id="2538069">]</span><span class="op" id="2538070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538074">if</span>&nbsp;<span class="ident" id="2538077">err</span>&nbsp;<span class="op" id="2538081">!=</span>&nbsp;<span class="ident" id="2538084">nil</span>&nbsp;<span class="op" id="2538088">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538093">return</span>&nbsp;<span class="ident" id="2538100">nil</span><span class="op" id="2538103">,</span>&nbsp;<span class="ident" id="2538105">err</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538111">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538115">m</span>&nbsp;<span class="op" id="2538117">:=</span>&nbsp;<span class="ident" id="2538120">SocketControlMessage</span><span class="op" id="2538140">{</span><span class="ident" id="2538141">Header</span><span class="op" id="2538147">:</span>&nbsp;<span class="op" id="2538149">*</span><span class="ident" id="2538150">h</span><span class="op" id="2538151">,</span>&nbsp;<span class="ident" id="2538153">Data</span><span class="op" id="2538157">:</span>&nbsp;<span class="ident" id="2538159">dbuf</span><span class="op" id="2538163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538167">msgs</span>&nbsp;<span class="op" id="2538172">=</span>&nbsp;<span class="builtinfunc" id="2538174">append</span><span class="op" id="2538180">(</span><span class="ident" id="2538181">msgs</span><span class="op" id="2538185">,</span>&nbsp;<span class="ident" id="2538187">m</span><span class="op" id="2538188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538192">i</span>&nbsp;<span class="op" id="2538194">+=</span>&nbsp;<span class="ident" id="2538197">cmsgAlignOf</span><span class="op" id="2538208">(</span><span class="builtintype" id="2538209">int</span><span class="op" id="2538212">(</span><span class="ident" id="2538213">h</span><span class="op" id="2538214">.</span><span class="ident" id="2538215">Len</span><span class="op" id="2538218">)</span><span class="op" id="2538219">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538222">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538225">return</span>&nbsp;<span class="ident" id="2538232">msgs</span><span class="op" id="2538236">,</span>&nbsp;<span class="ident" id="2538238">nil</span><br>
<span class="lineno"></span><span class="op" id="2538242">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2538245">func</span>&nbsp;<span class="ident" id="2538250">socketControlMessageHeaderAndData</span><span class="op" id="2538283">(</span><span class="ident" id="2538284">b</span>&nbsp;<span class="op" id="2538286">[</span><span class="op" id="2538287">]</span><span class="builtintype" id="2538288">byte</span><span class="op" id="2538292">)</span>&nbsp;<span class="op" id="2538294">(</span><span class="op" id="2538295">*</span><span class="ident" id="2538296">Cmsghdr</span><span class="op" id="2538303">,</span>&nbsp;<span class="op" id="2538305">[</span><span class="op" id="2538306">]</span><span class="builtintype" id="2538307">byte</span><span class="op" id="2538311">,</span>&nbsp;<span class="builtintype" id="2538313">error</span><span class="op" id="2538318">)</span>&nbsp;<span class="op" id="2538320">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538323">h</span>&nbsp;<span class="op" id="2538325">:=</span>&nbsp;<span class="op" id="2538328">(</span><span class="op" id="2538329">*</span><span class="ident" id="2538330">Cmsghdr</span><span class="op" id="2538337">)</span><span class="op" id="2538338">(</span><span class="ident" id="2538339">unsafe</span><span class="op" id="2538345">.</span><span class="ident" id="2538346">Pointer</span><span class="op" id="2538353">(</span><span class="op" id="2538354">&amp;</span><span class="ident" id="2538355">b</span><span class="op" id="2538356">[</span><span class="num" id="2538357">0</span><span class="op" id="2538358">]</span><span class="op" id="2538359">)</span><span class="op" id="2538360">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538363">if</span>&nbsp;<span class="ident" id="2538366">h</span><span class="op" id="2538367">.</span><span class="ident" id="2538368">Len</span>&nbsp;<span class="op" id="2538372">&lt;</span>&nbsp;<span class="ident" id="2538374">SizeofCmsghdr</span>&nbsp;<span class="op" id="2538388">||</span>&nbsp;<span class="builtintype" id="2538391">int</span><span class="op" id="2538394">(</span><span class="ident" id="2538395">h</span><span class="op" id="2538396">.</span><span class="ident" id="2538397">Len</span><span class="op" id="2538400">)</span>&nbsp;<span class="op" id="2538402">&gt;</span>&nbsp;<span class="builtinfunc" id="2538404">len</span><span class="op" id="2538407">(</span><span class="ident" id="2538408">b</span><span class="op" id="2538409">)</span>&nbsp;<span class="op" id="2538411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538415">return</span>&nbsp;<span class="ident" id="2538422">nil</span><span class="op" id="2538425">,</span>&nbsp;<span class="ident" id="2538427">nil</span><span class="op" id="2538430">,</span>&nbsp;<span class="ident" id="2538432">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538443">return</span>&nbsp;<span class="ident" id="2538450">h</span><span class="op" id="2538451">,</span>&nbsp;<span class="ident" id="2538453">b</span><span class="op" id="2538454">[</span><span class="ident" id="2538455">cmsgAlignOf</span><span class="op" id="2538466">(</span><span class="ident" id="2538467">SizeofCmsghdr</span><span class="op" id="2538480">)</span><span class="op" id="2538481">:</span><span class="ident" id="2538482">h</span><span class="op" id="2538483">.</span><span class="ident" id="2538484">Len</span><span class="op" id="2538487">]</span><span class="op" id="2538488">,</span>&nbsp;<span class="ident" id="2538490">nil</span><br>
<span class="lineno"></span><span class="op" id="2538494">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="2538497">//&nbsp;UnixRights&nbsp;encodes&nbsp;a&nbsp;set&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;into&nbsp;a&nbsp;socket</span><br>
<span class="lineno"></span><span class="comment" id="2538564">//&nbsp;control&nbsp;message&nbsp;for&nbsp;sending&nbsp;to&nbsp;another&nbsp;process.</span><br>
<span class="lineno"></span><span class="keyword" id="2538615">func</span>&nbsp;<span class="ident" id="2538620">UnixRights</span><span class="op" id="2538630">(</span><span class="ident" id="2538631">fds</span>&nbsp;<span class="op" id="2538635">...</span><span class="builtintype" id="2538638">int</span><span class="op" id="2538641">)</span>&nbsp;<span class="op" id="2538643">[</span><span class="op" id="2538644">]</span><span class="builtintype" id="2538645">byte</span>&nbsp;<span class="op" id="2538650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538653">datalen</span>&nbsp;<span class="op" id="2538661">:=</span>&nbsp;<span class="builtinfunc" id="2538664">len</span><span class="op" id="2538667">(</span><span class="ident" id="2538668">fds</span><span class="op" id="2538671">)</span>&nbsp;<span class="op" id="2538673">*</span>&nbsp;<span class="num" id="2538675">4</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538678">b</span>&nbsp;<span class="op" id="2538680">:=</span>&nbsp;<span class="builtinfunc" id="2538683">make</span><span class="op" id="2538687">(</span><span class="op" id="2538688">[</span><span class="op" id="2538689">]</span><span class="builtintype" id="2538690">byte</span><span class="op" id="2538694">,</span>&nbsp;<span class="ident" id="2538696">CmsgSpace</span><span class="op" id="2538705">(</span><span class="ident" id="2538706">datalen</span><span class="op" id="2538713">)</span><span class="op" id="2538714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538717">h</span>&nbsp;<span class="op" id="2538719">:=</span>&nbsp;<span class="op" id="2538722">(</span><span class="op" id="2538723">*</span><span class="ident" id="2538724">Cmsghdr</span><span class="op" id="2538731">)</span><span class="op" id="2538732">(</span><span class="ident" id="2538733">unsafe</span><span class="op" id="2538739">.</span><span class="ident" id="2538740">Pointer</span><span class="op" id="2538747">(</span><span class="op" id="2538748">&amp;</span><span class="ident" id="2538749">b</span><span class="op" id="2538750">[</span><span class="num" id="2538751">0</span><span class="op" id="2538752">]</span><span class="op" id="2538753">)</span><span class="op" id="2538754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538757">h</span><span class="op" id="2538758">.</span><span class="ident" id="2538759">Level</span>&nbsp;<span class="op" id="2538765">=</span>&nbsp;<span class="ident" id="2538767">SOL_SOCKET</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538779">h</span><span class="op" id="2538780">.</span><span class="ident" id="2538781">Type</span>&nbsp;<span class="op" id="2538786">=</span>&nbsp;<span class="ident" id="2538788">SCM_RIGHTS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538800">h</span><span class="op" id="2538801">.</span><span class="ident" id="2538802">SetLen</span><span class="op" id="2538808">(</span><span class="ident" id="2538809">CmsgLen</span><span class="op" id="2538816">(</span><span class="ident" id="2538817">datalen</span><span class="op" id="2538824">)</span><span class="op" id="2538825">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538828">data</span>&nbsp;<span class="op" id="2538833">:=</span>&nbsp;<span class="builtintype" id="2538836">uintptr</span><span class="op" id="2538843">(</span><span class="ident" id="2538844">cmsgData</span><span class="op" id="2538852">(</span><span class="ident" id="2538853">h</span><span class="op" id="2538854">)</span><span class="op" id="2538855">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538858">for</span>&nbsp;<span class="ident" id="2538862">_</span><span class="op" id="2538863">,</span>&nbsp;<span class="ident" id="2538865">fd</span>&nbsp;<span class="op" id="2538868">:=</span>&nbsp;<span class="keyword" id="2538871">range</span>&nbsp;<span class="ident" id="2538877">fds</span>&nbsp;<span class="op" id="2538881">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538885">*</span><span class="op" id="2538886">(</span><span class="op" id="2538887">*</span><span class="builtintype" id="2538888">int32</span><span class="op" id="2538893">)</span><span class="op" id="2538894">(</span><span class="ident" id="2538895">unsafe</span><span class="op" id="2538901">.</span><span class="ident" id="2538902">Pointer</span><span class="op" id="2538909">(</span><span class="ident" id="2538910">data</span><span class="op" id="2538914">)</span><span class="op" id="2538915">)</span>&nbsp;<span class="op" id="2538917">=</span>&nbsp;<span class="builtintype" id="2538919">int32</span><span class="op" id="2538924">(</span><span class="ident" id="2538925">fd</span><span class="op" id="2538927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2538931">data</span>&nbsp;<span class="op" id="2538936">+=</span>&nbsp;<span class="num" id="2538939">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2538942">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2538945">return</span>&nbsp;<span class="ident" id="2538952">b</span><br>
<span class="lineno"></span><span class="op" id="2538954">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2538957">//&nbsp;ParseUnixRights&nbsp;decodes&nbsp;a&nbsp;socket&nbsp;control&nbsp;message&nbsp;that&nbsp;contains&nbsp;an</span><br>
<span class="lineno"></span><span class="comment" id="2539026">//&nbsp;integer&nbsp;array&nbsp;of&nbsp;open&nbsp;file&nbsp;descriptors&nbsp;from&nbsp;another&nbsp;process.</span><br>
<span class="lineno">90</span><span class="keyword" id="2539090">func</span>&nbsp;<span class="ident" id="2539095">ParseUnixRights</span><span class="op" id="2539110">(</span><span class="ident" id="2539111">m</span>&nbsp;<span class="op" id="2539113">*</span><span class="ident" id="2539114">SocketControlMessage</span><span class="op" id="2539134">)</span>&nbsp;<span class="op" id="2539136">(</span><span class="op" id="2539137">[</span><span class="op" id="2539138">]</span><span class="builtintype" id="2539139">int</span><span class="op" id="2539142">,</span>&nbsp;<span class="builtintype" id="2539144">error</span><span class="op" id="2539149">)</span>&nbsp;<span class="op" id="2539151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539154">if</span>&nbsp;<span class="ident" id="2539157">m</span><span class="op" id="2539158">.</span><span class="ident" id="2539159">Header</span><span class="op" id="2539165">.</span><span class="ident" id="2539166">Level</span>&nbsp;<span class="op" id="2539172">!=</span>&nbsp;<span class="ident" id="2539175">SOL_SOCKET</span>&nbsp;<span class="op" id="2539186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539190">return</span>&nbsp;<span class="ident" id="2539197">nil</span><span class="op" id="2539200">,</span>&nbsp;<span class="ident" id="2539202">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539210">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539213">if</span>&nbsp;<span class="ident" id="2539216">m</span><span class="op" id="2539217">.</span><span class="ident" id="2539218">Header</span><span class="op" id="2539224">.</span><span class="ident" id="2539225">Type</span>&nbsp;<span class="op" id="2539230">!=</span>&nbsp;<span class="ident" id="2539233">SCM_RIGHTS</span>&nbsp;<span class="op" id="2539244">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539248">return</span>&nbsp;<span class="ident" id="2539255">nil</span><span class="op" id="2539258">,</span>&nbsp;<span class="ident" id="2539260">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539268">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539271">fds</span>&nbsp;<span class="op" id="2539275">:=</span>&nbsp;<span class="builtinfunc" id="2539278">make</span><span class="op" id="2539282">(</span><span class="op" id="2539283">[</span><span class="op" id="2539284">]</span><span class="builtintype" id="2539285">int</span><span class="op" id="2539288">,</span>&nbsp;<span class="builtinfunc" id="2539290">len</span><span class="op" id="2539293">(</span><span class="ident" id="2539294">m</span><span class="op" id="2539295">.</span><span class="ident" id="2539296">Data</span><span class="op" id="2539300">)</span><span class="op" id="2539301">&gt;&gt;</span><span class="num" id="2539303">2</span><span class="op" id="2539304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539307">for</span>&nbsp;<span class="ident" id="2539311">i</span><span class="op" id="2539312">,</span>&nbsp;<span class="ident" id="2539314">j</span>&nbsp;<span class="op" id="2539316">:=</span>&nbsp;<span class="num" id="2539319">0</span><span class="op" id="2539320">,</span>&nbsp;<span class="num" id="2539322">0</span><span class="op" id="2539323">;</span>&nbsp;<span class="ident" id="2539325">i</span>&nbsp;<span class="op" id="2539327">&lt;</span>&nbsp;<span class="builtinfunc" id="2539329">len</span><span class="op" id="2539332">(</span><span class="ident" id="2539333">m</span><span class="op" id="2539334">.</span><span class="ident" id="2539335">Data</span><span class="op" id="2539339">)</span><span class="op" id="2539340">;</span>&nbsp;<span class="ident" id="2539342">i</span>&nbsp;<span class="op" id="2539344">+=</span>&nbsp;<span class="num" id="2539347">4</span>&nbsp;<span class="op" id="2539349">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539353">fds</span><span class="op" id="2539356">[</span><span class="ident" id="2539357">j</span><span class="op" id="2539358">]</span>&nbsp;<span class="op" id="2539360">=</span>&nbsp;<span class="builtintype" id="2539362">int</span><span class="op" id="2539365">(</span><span class="op" id="2539366">*</span><span class="op" id="2539367">(</span><span class="op" id="2539368">*</span><span class="builtintype" id="2539369">int32</span><span class="op" id="2539374">)</span><span class="op" id="2539375">(</span><span class="ident" id="2539376">unsafe</span><span class="op" id="2539382">.</span><span class="ident" id="2539383">Pointer</span><span class="op" id="2539390">(</span><span class="op" id="2539391">&amp;</span><span class="ident" id="2539392">m</span><span class="op" id="2539393">.</span><span class="ident" id="2539394">Data</span><span class="op" id="2539398">[</span><span class="ident" id="2539399">i</span><span class="op" id="2539400">]</span><span class="op" id="2539401">)</span><span class="op" id="2539402">)</span><span class="op" id="2539403">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2539407">j</span><span class="op" id="2539408">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2539412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2539415">return</span>&nbsp;<span class="ident" id="2539422">fds</span><span class="op" id="2539425">,</span>&nbsp;<span class="ident" id="2539427">nil</span><br>
<span class="lineno"></span><span class="op" id="2539431">}</span>
</div>
</body>
</html>
