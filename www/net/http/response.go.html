<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="3391524">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3391579">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3391633">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3391684">//&nbsp;HTTP&nbsp;Response&nbsp;reading&nbsp;and&nbsp;parsing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391723">package</span>&nbsp;<span class="ident" id="3391731">http</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3391737">import</span>&nbsp;<span class="op" id="3391744">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391747">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391756">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391765">&#34;crypto/tls&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391779">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391789">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391795">&#34;net/textproto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391812">&#34;net/url&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391823">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391834">&#34;strings&#34;</span><br>
<span class="lineno"></span><span class="op" id="3391844">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="3391847">var</span>&nbsp;<span class="ident" id="3391851">respExcludeHeader</span>&nbsp;<span class="op" id="3391869">=</span>&nbsp;<span class="keyword" id="3391871">map</span><span class="op" id="3391874">[</span><span class="builtintype" id="3391875">string</span><span class="op" id="3391881">]</span><span class="builtintype" id="3391882">bool</span><span class="op" id="3391886">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391889">&#34;Content-Length&#34;</span><span class="op" id="3391905">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3391910">true</span><span class="op" id="3391914">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391917">&#34;Transfer-Encoding&#34;</span><span class="op" id="3391936">:</span>&nbsp;<span class="builtintype" id="3391938">true</span><span class="op" id="3391942">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3391945">&#34;Trailer&#34;</span><span class="op" id="3391954">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3391966">true</span><span class="op" id="3391970">,</span><br>
<span class="lineno">25</span><span class="op" id="3391972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3391975">//&nbsp;Response&nbsp;represents&nbsp;the&nbsp;response&nbsp;from&nbsp;an&nbsp;HTTP&nbsp;request.</span><br>
<span class="lineno"></span><span class="comment" id="3392033">//</span><br>
<span class="lineno"></span><span class="keyword" id="3392036">type</span>&nbsp;<span class="ident" id="3392041">Response</span>&nbsp;<span class="keyword" id="3392050">struct</span>&nbsp;<span class="op" id="3392057">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392060">Status</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3392071">string</span>&nbsp;<span class="comment" id="3392078">//&nbsp;e.g.&nbsp;&#34;200&nbsp;OK&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392096">StatusCode</span>&nbsp;<span class="builtintype" id="3392107">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392114">//&nbsp;e.g.&nbsp;200</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392127">Proto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3392138">string</span>&nbsp;<span class="comment" id="3392145">//&nbsp;e.g.&nbsp;&#34;HTTP/1.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392165">ProtoMajor</span>&nbsp;<span class="builtintype" id="3392176">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392183">//&nbsp;e.g.&nbsp;1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392194">ProtoMinor</span>&nbsp;<span class="builtintype" id="3392205">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3392212">//&nbsp;e.g.&nbsp;0</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392224">//&nbsp;Header&nbsp;maps&nbsp;header&nbsp;keys&nbsp;to&nbsp;values.&nbsp;&nbsp;If&nbsp;the&nbsp;response&nbsp;had&nbsp;multiple</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392293">//&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;key,&nbsp;they&nbsp;may&nbsp;be&nbsp;concatenated,&nbsp;with&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392361">//&nbsp;delimiters.&nbsp;&nbsp;(Section&nbsp;4.2&nbsp;of&nbsp;RFC&nbsp;2616&nbsp;requires&nbsp;that&nbsp;multiple&nbsp;headers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392434">//&nbsp;be&nbsp;semantically&nbsp;equivalent&nbsp;to&nbsp;a&nbsp;comma-delimited&nbsp;sequence.)&nbsp;Values</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392504">//&nbsp;duplicated&nbsp;by&nbsp;other&nbsp;fields&nbsp;in&nbsp;this&nbsp;struct&nbsp;(e.g.,&nbsp;ContentLength)&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392576">//&nbsp;omitted&nbsp;from&nbsp;Header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392601">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392605">//&nbsp;Keys&nbsp;in&nbsp;the&nbsp;map&nbsp;are&nbsp;canonicalized&nbsp;(see&nbsp;CanonicalHeaderKey).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3392669">Header</span>&nbsp;<span class="ident" id="3392676"><a href="/net/http/header.go.html#3356649">Header</a></span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392685">//&nbsp;Body&nbsp;represents&nbsp;the&nbsp;response&nbsp;body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392724">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392728">//&nbsp;The&nbsp;http&nbsp;Client&nbsp;and&nbsp;Transport&nbsp;guarantee&nbsp;that&nbsp;Body&nbsp;is&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392792">//&nbsp;non-nil,&nbsp;even&nbsp;on&nbsp;responses&nbsp;without&nbsp;a&nbsp;body&nbsp;or&nbsp;responses&nbsp;with</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392856">//&nbsp;a&nbsp;zero-length&nbsp;body.&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392917">//&nbsp;close&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392933">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392937">//&nbsp;The&nbsp;Body&nbsp;is&nbsp;automatically&nbsp;dechunked&nbsp;if&nbsp;the&nbsp;server&nbsp;replied</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3392999">//&nbsp;with&nbsp;a&nbsp;&#34;chunked&#34;&nbsp;Transfer-Encoding.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393039">Body</span>&nbsp;<span class="ident" id="3393044"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3393046">.</span><span class="ident" id="3393047">ReadCloser</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393060">//&nbsp;ContentLength&nbsp;records&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;associated&nbsp;content.&nbsp;&nbsp;The</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393129">//&nbsp;value&nbsp;-1&nbsp;indicates&nbsp;that&nbsp;the&nbsp;length&nbsp;is&nbsp;unknown.&nbsp;&nbsp;Unless&nbsp;Request.Method</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393203">//&nbsp;is&nbsp;&#34;HEAD&#34;,&nbsp;values&nbsp;&gt;=&nbsp;0&nbsp;indicate&nbsp;that&nbsp;the&nbsp;given&nbsp;number&nbsp;of&nbsp;bytes&nbsp;may</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393274">//&nbsp;be&nbsp;read&nbsp;from&nbsp;Body.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393297">ContentLength</span>&nbsp;<span class="ident" id="3393311">int64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393319">//&nbsp;Contains&nbsp;transfer&nbsp;encodings&nbsp;from&nbsp;outer-most&nbsp;to&nbsp;inner-most.&nbsp;Value&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393391">//&nbsp;nil,&nbsp;means&nbsp;that&nbsp;&#34;identity&#34;&nbsp;encoding&nbsp;is&nbsp;used.</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393440">TransferEncoding</span>&nbsp;<span class="op" id="3393457">[</span><span class="op" id="3393458">]</span><span class="builtintype" id="3393459">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393468">//&nbsp;Close&nbsp;records&nbsp;whether&nbsp;the&nbsp;header&nbsp;directed&nbsp;that&nbsp;the&nbsp;connection&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393537">//&nbsp;closed&nbsp;after&nbsp;reading&nbsp;Body.&nbsp;&nbsp;The&nbsp;value&nbsp;is&nbsp;advice&nbsp;for&nbsp;clients:&nbsp;neither</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393610">//&nbsp;ReadResponse&nbsp;nor&nbsp;Response.Write&nbsp;ever&nbsp;closes&nbsp;a&nbsp;connection.</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393672">Close</span>&nbsp;<span class="builtintype" id="3393678">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393685">//&nbsp;Trailer&nbsp;maps&nbsp;trailer&nbsp;keys&nbsp;to&nbsp;values,&nbsp;in&nbsp;the&nbsp;same</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393738">//&nbsp;format&nbsp;as&nbsp;the&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393764">Trailer</span>&nbsp;<span class="ident" id="3393772"><a href="/net/http/header.go.html#3356649">Header</a></span><br>
<span class="lineno">75</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393781">//&nbsp;The&nbsp;Request&nbsp;that&nbsp;was&nbsp;sent&nbsp;to&nbsp;obtain&nbsp;this&nbsp;Response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393836">//&nbsp;Request&#39;s&nbsp;Body&nbsp;is&nbsp;nil&nbsp;(having&nbsp;already&nbsp;been&nbsp;consumed).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393894">//&nbsp;This&nbsp;is&nbsp;only&nbsp;populated&nbsp;for&nbsp;Client&nbsp;requests.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3393942">Request</span>&nbsp;<span class="op" id="3393950">*</span><span class="ident" id="3393951"><a href="/net/http/request.go.html#3366486">Request</a></span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3393961">//&nbsp;TLS&nbsp;contains&nbsp;information&nbsp;about&nbsp;the&nbsp;TLS&nbsp;connection&nbsp;on&nbsp;which&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3394028">//&nbsp;response&nbsp;was&nbsp;received.&nbsp;It&nbsp;is&nbsp;nil&nbsp;for&nbsp;unencrypted&nbsp;responses.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3394092">//&nbsp;The&nbsp;pointer&nbsp;is&nbsp;shared&nbsp;between&nbsp;responses&nbsp;and&nbsp;should&nbsp;not&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3394154">//&nbsp;modified.</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394168">TLS</span>&nbsp;<span class="op" id="3394172">*</span><span class="ident" id="3394173"><a href="/net/http/response.go.html#3391765">tls</a></span><span class="op" id="3394176">.</span><span class="ident" id="3394177">ConnectionState</span><br>
<span class="lineno"></span><span class="op" id="3394193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3394196">//&nbsp;Cookies&nbsp;parses&nbsp;and&nbsp;returns&nbsp;the&nbsp;cookies&nbsp;set&nbsp;in&nbsp;the&nbsp;Set-Cookie&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="3394269">func</span>&nbsp;<span class="op" id="3394274">(</span><span class="ident" id="3394275">r</span>&nbsp;<span class="op" id="3394277">*</span><span class="ident" id="3394278"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3394286">)</span>&nbsp;<span class="ident" id="3394288">Cookies</span><span class="op" id="3394295">(</span><span class="op" id="3394296">)</span>&nbsp;<span class="op" id="3394298">[</span><span class="op" id="3394299">]</span><span class="op" id="3394300">*</span><span class="ident" id="3394301"><a href="/net/http/cookie.go.html#3326529">Cookie</a></span>&nbsp;<span class="op" id="3394308">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394311">return</span>&nbsp;<span class="ident" id="3394318"><a href="/net/http/cookie.go.html#3327095">readSetCookies</a></span><span class="op" id="3394332">(</span><span class="ident" id="3394333"><a href="/net/http/response.go.html#3394275">r</a></span><span class="op" id="3394334">.</span><span class="ident" id="3394335">Header</span><span class="op" id="3394341">)</span><br>
<span class="lineno"></span><span class="op" id="3394343">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3394346">var</span>&nbsp;<span class="ident" id="3394350">ErrNoLocation</span>&nbsp;<span class="op" id="3394364">=</span>&nbsp;<span class="ident" id="3394366"><a href="/net/http/response.go.html#3391779">errors</a></span><span class="op" id="3394372">.</span><span class="ident" id="3394373">New</span><span class="op" id="3394376">(</span><span class="string" id="3394377">&#34;http:&nbsp;no&nbsp;Location&nbsp;header&nbsp;in&nbsp;response&#34;</span><span class="op" id="3394415">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="comment" id="3394418">//&nbsp;Location&nbsp;returns&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;response&#39;s&nbsp;&#34;Location&#34;&nbsp;header,</span><br>
<span class="lineno"></span><span class="comment" id="3394483">//&nbsp;if&nbsp;present.&nbsp;&nbsp;Relative&nbsp;redirects&nbsp;are&nbsp;resolved&nbsp;relative&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="3394543">//&nbsp;the&nbsp;Response&#39;s&nbsp;Request.&nbsp;&nbsp;ErrNoLocation&nbsp;is&nbsp;returned&nbsp;if&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="3394603">//&nbsp;Location&nbsp;header&nbsp;is&nbsp;present.</span><br>
<span class="lineno"></span><span class="keyword" id="3394634">func</span>&nbsp;<span class="op" id="3394639">(</span><span class="ident" id="3394640">r</span>&nbsp;<span class="op" id="3394642">*</span><span class="ident" id="3394643"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3394651">)</span>&nbsp;<span class="ident" id="3394653">Location</span><span class="op" id="3394661">(</span><span class="op" id="3394662">)</span>&nbsp;<span class="op" id="3394664">(</span><span class="op" id="3394665">*</span><span class="ident" id="3394666"><a href="/net/http/response.go.html#3391812">url</a></span><span class="op" id="3394669">.</span><span class="ident" id="3394670">URL</span><span class="op" id="3394673">,</span>&nbsp;<span class="builtintype" id="3394675">error</span><span class="op" id="3394680">)</span>&nbsp;<span class="op" id="3394682">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3394685">lv</span>&nbsp;<span class="op" id="3394688">:=</span>&nbsp;<span class="ident" id="3394691"><a href="/net/http/response.go.html#3394640">r</a></span><span class="op" id="3394692">.</span><span class="ident" id="3394693">Header</span><span class="op" id="3394699">.</span><span class="ident" id="3394700">Get</span><span class="op" id="3394703">(</span><span class="string" id="3394704">&#34;Location&#34;</span><span class="op" id="3394714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394717">if</span>&nbsp;<span class="ident" id="3394720"><a href="/net/http/response.go.html#3394685">lv</a></span>&nbsp;<span class="op" id="3394723">==</span>&nbsp;<span class="string" id="3394726">&#34;&#34;</span>&nbsp;<span class="op" id="3394729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394733">return</span>&nbsp;<span class="ident" id="3394740">nil</span><span class="op" id="3394743">,</span>&nbsp;<span class="ident" id="3394745"><a href="/net/http/response.go.html#3394350">ErrNoLocation</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394763">if</span>&nbsp;<span class="ident" id="3394766"><a href="/net/http/response.go.html#3394640">r</a></span><span class="op" id="3394767">.</span><span class="ident" id="3394768">Request</span>&nbsp;<span class="op" id="3394776">!=</span>&nbsp;<span class="ident" id="3394779">nil</span>&nbsp;<span class="op" id="3394783">&amp;&amp;</span>&nbsp;<span class="ident" id="3394786"><a href="/net/http/response.go.html#3394640">r</a></span><span class="op" id="3394787">.</span><span class="ident" id="3394788">Request</span><span class="op" id="3394795">.</span><span class="ident" id="3394796">URL</span>&nbsp;<span class="op" id="3394800">!=</span>&nbsp;<span class="ident" id="3394803">nil</span>&nbsp;<span class="op" id="3394807">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394811">return</span>&nbsp;<span class="ident" id="3394818"><a href="/net/http/response.go.html#3394640">r</a></span><span class="op" id="3394819">.</span><span class="ident" id="3394820">Request</span><span class="op" id="3394827">.</span><span class="ident" id="3394828">URL</span><span class="op" id="3394831">.</span><span class="ident" id="3394832">Parse</span><span class="op" id="3394837">(</span><span class="ident" id="3394838"><a href="/net/http/response.go.html#3394685">lv</a></span><span class="op" id="3394840">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3394843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3394846">return</span>&nbsp;<span class="ident" id="3394853"><a href="/net/http/response.go.html#3391812">url</a></span><span class="op" id="3394856">.</span><span class="ident" id="3394857">Parse</span><span class="op" id="3394862">(</span><span class="ident" id="3394863"><a href="/net/http/response.go.html#3394685">lv</a></span><span class="op" id="3394865">)</span><br>
<span class="lineno"></span><span class="op" id="3394867">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="comment" id="3394870">//&nbsp;ReadResponse&nbsp;reads&nbsp;and&nbsp;returns&nbsp;an&nbsp;HTTP&nbsp;response&nbsp;from&nbsp;r.</span><br>
<span class="lineno"></span><span class="comment" id="3394929">//&nbsp;The&nbsp;req&nbsp;parameter&nbsp;optionally&nbsp;specifies&nbsp;the&nbsp;Request&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="3395000">//&nbsp;to&nbsp;this&nbsp;Response.&nbsp;If&nbsp;nil,&nbsp;a&nbsp;GET&nbsp;request&nbsp;is&nbsp;assumed.</span><br>
<span class="lineno"></span><span class="comment" id="3395055">//&nbsp;Clients&nbsp;must&nbsp;call&nbsp;resp.Body.Close&nbsp;when&nbsp;finished&nbsp;reading&nbsp;resp.Body.</span><br>
<span class="lineno"></span><span class="comment" id="3395125">//&nbsp;After&nbsp;that&nbsp;call,&nbsp;clients&nbsp;can&nbsp;inspect&nbsp;resp.Trailer&nbsp;to&nbsp;find&nbsp;key/value</span><br>
<span class="lineno">115</span><span class="comment" id="3395196">//&nbsp;pairs&nbsp;included&nbsp;in&nbsp;the&nbsp;response&nbsp;trailer.</span><br>
<span class="lineno"></span><span class="keyword" id="3395239">func</span>&nbsp;<span class="ident" id="3395244">ReadResponse</span><span class="op" id="3395256">(</span><span class="ident" id="3395257">r</span>&nbsp;<span class="op" id="3395259">*</span><span class="ident" id="3395260"><a href="/net/http/response.go.html#3391747">bufio</a></span><span class="op" id="3395265">.</span><span class="ident" id="3395266">Reader</span><span class="op" id="3395272">,</span>&nbsp;<span class="ident" id="3395274">req</span>&nbsp;<span class="op" id="3395278">*</span><span class="ident" id="3395279"><a href="/net/http/request.go.html#3366486">Request</a></span><span class="op" id="3395286">)</span>&nbsp;<span class="op" id="3395288">(</span><span class="op" id="3395289">*</span><span class="ident" id="3395290"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3395298">,</span>&nbsp;<span class="builtintype" id="3395300">error</span><span class="op" id="3395305">)</span>&nbsp;<span class="op" id="3395307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395310">tp</span>&nbsp;<span class="op" id="3395313">:=</span>&nbsp;<span class="ident" id="3395316"><a href="/net/http/response.go.html#3391795">textproto</a></span><span class="op" id="3395325">.</span><span class="ident" id="3395326">NewReader</span><span class="op" id="3395335">(</span><span class="ident" id="3395336"><a href="/net/http/response.go.html#3395257">r</a></span><span class="op" id="3395337">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395340">resp</span>&nbsp;<span class="op" id="3395345">:=</span>&nbsp;<span class="op" id="3395348">&amp;</span><span class="ident" id="3395349"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3395357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395361">Request</span><span class="op" id="3395368">:</span>&nbsp;<span class="ident" id="3395370"><a href="/net/http/response.go.html#3395274">req</a></span><span class="op" id="3395373">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3395380">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;response.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395422">line</span><span class="op" id="3395426">,</span>&nbsp;<span class="ident" id="3395428">err</span>&nbsp;<span class="op" id="3395432">:=</span>&nbsp;<span class="ident" id="3395435"><a href="/net/http/response.go.html#3395310">tp</a></span><span class="op" id="3395437">.</span><span class="ident" id="3395438">ReadLine</span><span class="op" id="3395446">(</span><span class="op" id="3395447">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395450">if</span>&nbsp;<span class="ident" id="3395453"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3395457">!=</span>&nbsp;<span class="ident" id="3395460">nil</span>&nbsp;<span class="op" id="3395464">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395468">if</span>&nbsp;<span class="ident" id="3395471"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3395475">==</span>&nbsp;<span class="ident" id="3395478"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3395480">.</span><span class="ident" id="3395481">EOF</span>&nbsp;<span class="op" id="3395485">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395490"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3395494">=</span>&nbsp;<span class="ident" id="3395496"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3395498">.</span><span class="ident" id="3395499">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395518">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395522">return</span>&nbsp;<span class="ident" id="3395529">nil</span><span class="op" id="3395532">,</span>&nbsp;<span class="ident" id="3395534"><a href="/net/http/response.go.html#3395428">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395539">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395542">f</span>&nbsp;<span class="op" id="3395544">:=</span>&nbsp;<span class="ident" id="3395547"><a href="/net/http/response.go.html#3391834">strings</a></span><span class="op" id="3395554">.</span><span class="ident" id="3395555">SplitN</span><span class="op" id="3395561">(</span><span class="ident" id="3395562"><a href="/net/http/response.go.html#3395422">line</a></span><span class="op" id="3395566">,</span>&nbsp;<span class="string" id="3395568">&#34;&nbsp;&#34;</span><span class="op" id="3395571">,</span>&nbsp;<span class="num" id="3395573">3</span><span class="op" id="3395574">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395577">if</span>&nbsp;<span class="builtinfunc" id="3395580">len</span><span class="op" id="3395583">(</span><span class="ident" id="3395584"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395585">)</span>&nbsp;<span class="op" id="3395587">&lt;</span>&nbsp;<span class="num" id="3395589">2</span>&nbsp;<span class="op" id="3395591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395595">return</span>&nbsp;<span class="ident" id="3395602">nil</span><span class="op" id="3395605">,</span>&nbsp;<span class="op" id="3395607">&amp;</span><span class="ident" id="3395608"><a href="/net/http/request.go.html#3365780">badStringError</a></span><span class="op" id="3395622">{</span><span class="string" id="3395623">&#34;malformed&nbsp;HTTP&nbsp;response&#34;</span><span class="op" id="3395648">,</span>&nbsp;<span class="ident" id="3395650"><a href="/net/http/response.go.html#3395422">line</a></span><span class="op" id="3395654">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395657">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395660">reasonPhrase</span>&nbsp;<span class="op" id="3395673">:=</span>&nbsp;<span class="string" id="3395676">&#34;&#34;</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395680">if</span>&nbsp;<span class="builtinfunc" id="3395683">len</span><span class="op" id="3395686">(</span><span class="ident" id="3395687"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395688">)</span>&nbsp;<span class="op" id="3395690">&gt;</span>&nbsp;<span class="num" id="3395692">2</span>&nbsp;<span class="op" id="3395694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395698"><a href="/net/http/response.go.html#3395660">reasonPhrase</a></span>&nbsp;<span class="op" id="3395711">=</span>&nbsp;<span class="ident" id="3395713"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395714">[</span><span class="num" id="3395715">2</span><span class="op" id="3395716">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395719">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395722"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395726">.</span><span class="ident" id="3395727">Status</span>&nbsp;<span class="op" id="3395734">=</span>&nbsp;<span class="ident" id="3395736"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395737">[</span><span class="num" id="3395738">1</span><span class="op" id="3395739">]</span>&nbsp;<span class="op" id="3395741">+</span>&nbsp;<span class="string" id="3395743">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="3395747">+</span>&nbsp;<span class="ident" id="3395749"><a href="/net/http/response.go.html#3395660">reasonPhrase</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395763"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395767">.</span><span class="ident" id="3395768">StatusCode</span><span class="op" id="3395778">,</span>&nbsp;<span class="ident" id="3395780"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3395784">=</span>&nbsp;<span class="ident" id="3395786"><a href="/net/http/response.go.html#3391823">strconv</a></span><span class="op" id="3395793">.</span><span class="ident" id="3395794">Atoi</span><span class="op" id="3395798">(</span><span class="ident" id="3395799"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395800">[</span><span class="num" id="3395801">1</span><span class="op" id="3395802">]</span><span class="op" id="3395803">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395806">if</span>&nbsp;<span class="ident" id="3395809"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3395813">!=</span>&nbsp;<span class="ident" id="3395816">nil</span>&nbsp;<span class="op" id="3395820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395824">return</span>&nbsp;<span class="ident" id="3395831">nil</span><span class="op" id="3395834">,</span>&nbsp;<span class="op" id="3395836">&amp;</span><span class="ident" id="3395837"><a href="/net/http/request.go.html#3365780">badStringError</a></span><span class="op" id="3395851">{</span><span class="string" id="3395852">&#34;malformed&nbsp;HTTP&nbsp;status&nbsp;code&#34;</span><span class="op" id="3395880">,</span>&nbsp;<span class="ident" id="3395882"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395883">[</span><span class="num" id="3395884">1</span><span class="op" id="3395885">]</span><span class="op" id="3395886">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3395889">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3395893"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395897">.</span><span class="ident" id="3395898">Proto</span>&nbsp;<span class="op" id="3395904">=</span>&nbsp;<span class="ident" id="3395906"><a href="/net/http/response.go.html#3395542">f</a></span><span class="op" id="3395907">[</span><span class="num" id="3395908">0</span><span class="op" id="3395909">]</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395912">var</span>&nbsp;<span class="ident" id="3395916">ok</span>&nbsp;<span class="builtintype" id="3395919">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3395925">if</span>&nbsp;<span class="ident" id="3395928"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395932">.</span><span class="ident" id="3395933">ProtoMajor</span><span class="op" id="3395943">,</span>&nbsp;<span class="ident" id="3395945"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395949">.</span><span class="ident" id="3395950">ProtoMinor</span><span class="op" id="3395960">,</span>&nbsp;<span class="ident" id="3395962"><a href="/net/http/response.go.html#3395916">ok</a></span>&nbsp;<span class="op" id="3395965">=</span>&nbsp;<span class="ident" id="3395967"><a href="/net/http/request.go.html#3379209">ParseHTTPVersion</a></span><span class="op" id="3395983">(</span><span class="ident" id="3395984"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3395988">.</span><span class="ident" id="3395989">Proto</span><span class="op" id="3395994">)</span><span class="op" id="3395995">;</span>&nbsp;<span class="op" id="3395997">!</span><span class="ident" id="3395998"><a href="/net/http/response.go.html#3395916">ok</a></span>&nbsp;<span class="op" id="3396001">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396005">return</span>&nbsp;<span class="ident" id="3396012">nil</span><span class="op" id="3396015">,</span>&nbsp;<span class="op" id="3396017">&amp;</span><span class="ident" id="3396018"><a href="/net/http/request.go.html#3365780">badStringError</a></span><span class="op" id="3396032">{</span><span class="string" id="3396033">&#34;malformed&nbsp;HTTP&nbsp;version&#34;</span><span class="op" id="3396057">,</span>&nbsp;<span class="ident" id="3396059"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3396063">.</span><span class="ident" id="3396064">Proto</span><span class="op" id="3396069">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396072">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3396076">//&nbsp;Parse&nbsp;the&nbsp;response&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396108">mimeHeader</span><span class="op" id="3396118">,</span>&nbsp;<span class="ident" id="3396120"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396124">:=</span>&nbsp;<span class="ident" id="3396127"><a href="/net/http/response.go.html#3395310">tp</a></span><span class="op" id="3396129">.</span><span class="ident" id="3396130">ReadMIMEHeader</span><span class="op" id="3396144">(</span><span class="op" id="3396145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396148">if</span>&nbsp;<span class="ident" id="3396151"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396155">!=</span>&nbsp;<span class="ident" id="3396158">nil</span>&nbsp;<span class="op" id="3396162">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396166">if</span>&nbsp;<span class="ident" id="3396169"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396173">==</span>&nbsp;<span class="ident" id="3396176"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3396178">.</span><span class="ident" id="3396179">EOF</span>&nbsp;<span class="op" id="3396183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396188"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396192">=</span>&nbsp;<span class="ident" id="3396194"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3396196">.</span><span class="ident" id="3396197">ErrUnexpectedEOF</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396216">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396220">return</span>&nbsp;<span class="ident" id="3396227">nil</span><span class="op" id="3396230">,</span>&nbsp;<span class="ident" id="3396232"><a href="/net/http/response.go.html#3395428">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396237">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396240"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3396244">.</span><span class="ident" id="3396245">Header</span>&nbsp;<span class="op" id="3396252">=</span>&nbsp;<span class="ident" id="3396254"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3396260">(</span><span class="ident" id="3396261"><a href="/net/http/response.go.html#3396108">mimeHeader</a></span><span class="op" id="3396271">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396275"><a href="/net/http/response.go.html#3396485">fixPragmaCacheControl</a></span><span class="op" id="3396296">(</span><span class="ident" id="3396297"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3396301">.</span><span class="ident" id="3396302">Header</span><span class="op" id="3396308">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396312"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396316">=</span>&nbsp;<span class="ident" id="3396318"><a href="/net/http/transfer.go.html#3478328">readTransfer</a></span><span class="op" id="3396330">(</span><span class="ident" id="3396331"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3396335">,</span>&nbsp;<span class="ident" id="3396337"><a href="/net/http/response.go.html#3395257">r</a></span><span class="op" id="3396338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396341">if</span>&nbsp;<span class="ident" id="3396344"><a href="/net/http/response.go.html#3395428">err</a></span>&nbsp;<span class="op" id="3396348">!=</span>&nbsp;<span class="ident" id="3396351">nil</span>&nbsp;<span class="op" id="3396355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396359">return</span>&nbsp;<span class="ident" id="3396366">nil</span><span class="op" id="3396369">,</span>&nbsp;<span class="ident" id="3396371"><a href="/net/http/response.go.html#3395428">err</a></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396376">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396380">return</span>&nbsp;<span class="ident" id="3396387"><a href="/net/http/response.go.html#3395340">resp</a></span><span class="op" id="3396391">,</span>&nbsp;<span class="ident" id="3396393">nil</span><br>
<span class="lineno"></span><span class="op" id="3396397">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="comment" id="3396400">//&nbsp;RFC2616:&nbsp;Should&nbsp;treat</span><br>
<span class="lineno"></span><span class="comment" id="3396425">//&nbsp;&nbsp;&nbsp;&nbspPragma:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="comment" id="3396445">//&nbsp;like</span><br>
<span class="lineno"></span><span class="comment" id="3396453">//&nbsp;&nbsp;&nbsp;&nbspCache-Control:&nbsp;no-cache</span><br>
<span class="lineno"></span><span class="keyword" id="3396480">func</span>&nbsp;<span class="ident" id="3396485">fixPragmaCacheControl</span><span class="op" id="3396506">(</span><span class="ident" id="3396507">header</span>&nbsp;<span class="ident" id="3396514"><a href="/net/http/header.go.html#3356649">Header</a></span><span class="op" id="3396520">)</span>&nbsp;<span class="op" id="3396522">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396525">if</span>&nbsp;<span class="ident" id="3396528">hp</span><span class="op" id="3396530">,</span>&nbsp;<span class="ident" id="3396532">ok</span>&nbsp;<span class="op" id="3396535">:=</span>&nbsp;<span class="ident" id="3396538"><a href="/net/http/response.go.html#3396507">header</a></span><span class="op" id="3396544">[</span><span class="string" id="3396545">&#34;Pragma&#34;</span><span class="op" id="3396553">]</span><span class="op" id="3396554">;</span>&nbsp;<span class="ident" id="3396556"><a href="/net/http/response.go.html#3396532">ok</a></span>&nbsp;<span class="op" id="3396559">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="3396562">len</span><span class="op" id="3396565">(</span><span class="ident" id="3396566"><a href="/net/http/response.go.html#3396528">hp</a></span><span class="op" id="3396568">)</span>&nbsp;<span class="op" id="3396570">&gt;</span>&nbsp;<span class="num" id="3396572">0</span>&nbsp;<span class="op" id="3396574">&amp;&amp;</span>&nbsp;<span class="ident" id="3396577"><a href="/net/http/response.go.html#3396528">hp</a></span><span class="op" id="3396579">[</span><span class="num" id="3396580">0</span><span class="op" id="3396581">]</span>&nbsp;<span class="op" id="3396583">==</span>&nbsp;<span class="string" id="3396586">&#34;no-cache&#34;</span>&nbsp;<span class="op" id="3396597">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396601">if</span>&nbsp;<span class="ident" id="3396604">_</span><span class="op" id="3396605">,</span>&nbsp;<span class="ident" id="3396607">presentcc</span>&nbsp;<span class="op" id="3396617">:=</span>&nbsp;<span class="ident" id="3396620"><a href="/net/http/response.go.html#3396507">header</a></span><span class="op" id="3396626">[</span><span class="string" id="3396627">&#34;Cache-Control&#34;</span><span class="op" id="3396642">]</span><span class="op" id="3396643">;</span>&nbsp;<span class="op" id="3396645">!</span><span class="ident" id="3396646"><a href="/net/http/response.go.html#3396607">presentcc</a></span>&nbsp;<span class="op" id="3396656">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396661"><a href="/net/http/response.go.html#3396507">header</a></span><span class="op" id="3396667">[</span><span class="string" id="3396668">&#34;Cache-Control&#34;</span><span class="op" id="3396683">]</span>&nbsp;<span class="op" id="3396685">=</span>&nbsp;<span class="op" id="3396687">[</span><span class="op" id="3396688">]</span><span class="builtintype" id="3396689">string</span><span class="op" id="3396695">{</span><span class="string" id="3396696">&#34;no-cache&#34;</span><span class="op" id="3396706">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396710">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3396713">}</span><br>
<span class="lineno">180</span><span class="op" id="3396715">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396718">//&nbsp;ProtoAtLeast&nbsp;reports&nbsp;whether&nbsp;the&nbsp;HTTP&nbsp;protocol&nbsp;used</span><br>
<span class="lineno"></span><span class="comment" id="3396773">//&nbsp;in&nbsp;the&nbsp;response&nbsp;is&nbsp;at&nbsp;least&nbsp;major.minor.</span><br>
<span class="lineno"></span><span class="keyword" id="3396817">func</span>&nbsp;<span class="op" id="3396822">(</span><span class="ident" id="3396823">r</span>&nbsp;<span class="op" id="3396825">*</span><span class="ident" id="3396826"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3396834">)</span>&nbsp;<span class="ident" id="3396836">ProtoAtLeast</span><span class="op" id="3396848">(</span><span class="ident" id="3396849">major</span><span class="op" id="3396854">,</span>&nbsp;<span class="ident" id="3396856">minor</span>&nbsp;<span class="builtintype" id="3396862">int</span><span class="op" id="3396865">)</span>&nbsp;<span class="builtintype" id="3396867">bool</span>&nbsp;<span class="op" id="3396872">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3396875">return</span>&nbsp;<span class="ident" id="3396882"><a href="/net/http/response.go.html#3396823">r</a></span><span class="op" id="3396883">.</span><span class="ident" id="3396884">ProtoMajor</span>&nbsp;<span class="op" id="3396895">&gt;</span>&nbsp;<span class="ident" id="3396897"><a href="/net/http/response.go.html#3396849">major</a></span>&nbsp;<span class="op" id="3396903">||</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3396908"><a href="/net/http/response.go.html#3396823">r</a></span><span class="op" id="3396909">.</span><span class="ident" id="3396910">ProtoMajor</span>&nbsp;<span class="op" id="3396921">==</span>&nbsp;<span class="ident" id="3396924"><a href="/net/http/response.go.html#3396849">major</a></span>&nbsp;<span class="op" id="3396930">&amp;&amp;</span>&nbsp;<span class="ident" id="3396933"><a href="/net/http/response.go.html#3396823">r</a></span><span class="op" id="3396934">.</span><span class="ident" id="3396935">ProtoMinor</span>&nbsp;<span class="op" id="3396946">&gt;=</span>&nbsp;<span class="ident" id="3396949"><a href="/net/http/response.go.html#3396856">minor</a></span><br>
<span class="lineno"></span><span class="op" id="3396955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3396958">//&nbsp;Writes&nbsp;the&nbsp;response&nbsp;(header,&nbsp;body&nbsp;and&nbsp;trailer)&nbsp;in&nbsp;wire&nbsp;format.&nbsp;This&nbsp;method</span><br>
<span class="lineno">190</span><span class="comment" id="3397036">//&nbsp;consults&nbsp;the&nbsp;following&nbsp;fields&nbsp;of&nbsp;the&nbsp;response:</span><br>
<span class="lineno"></span><span class="comment" id="3397086">//</span><br>
<span class="lineno"></span><span class="comment" id="3397089">//&nbsp;&nbsp;StatusCode</span><br>
<span class="lineno"></span><span class="comment" id="3397104">//&nbsp;&nbsp;ProtoMajor</span><br>
<span class="lineno"></span><span class="comment" id="3397119">//&nbsp;&nbsp;ProtoMinor</span><br>
<span class="lineno">195</span><span class="comment" id="3397134">//&nbsp;&nbsp;Request.Method</span><br>
<span class="lineno"></span><span class="comment" id="3397153">//&nbsp;&nbsp;TransferEncoding</span><br>
<span class="lineno"></span><span class="comment" id="3397174">//&nbsp;&nbsp;Trailer</span><br>
<span class="lineno"></span><span class="comment" id="3397186">//&nbsp;&nbsp;Body</span><br>
<span class="lineno"></span><span class="comment" id="3397195">//&nbsp;&nbsp;ContentLength</span><br>
<span class="lineno">200</span><span class="comment" id="3397213">//&nbsp;&nbsp;Header,&nbsp;values&nbsp;for&nbsp;non-canonical&nbsp;keys&nbsp;will&nbsp;have&nbsp;unpredictable&nbsp;behavior</span><br>
<span class="lineno"></span><span class="comment" id="3397288">//</span><br>
<span class="lineno"></span><span class="comment" id="3397291">//&nbsp;Body&nbsp;is&nbsp;closed&nbsp;after&nbsp;it&nbsp;is&nbsp;sent.</span><br>
<span class="lineno"></span><span class="keyword" id="3397327">func</span>&nbsp;<span class="op" id="3397332">(</span><span class="ident" id="3397333">r</span>&nbsp;<span class="op" id="3397335">*</span><span class="ident" id="3397336"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3397344">)</span>&nbsp;<span class="ident" id="3397346">Write</span><span class="op" id="3397351">(</span><span class="ident" id="3397352">w</span>&nbsp;<span class="ident" id="3397354"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3397356">.</span><span class="ident" id="3397357">Writer</span><span class="op" id="3397363">)</span>&nbsp;<span class="builtintype" id="3397365">error</span>&nbsp;<span class="op" id="3397371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3397374">//&nbsp;Status&nbsp;line</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397390">text</span>&nbsp;<span class="op" id="3397395">:=</span>&nbsp;<span class="ident" id="3397398"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397399">.</span><span class="ident" id="3397400">Status</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397408">if</span>&nbsp;<span class="ident" id="3397411"><a href="/net/http/response.go.html#3397390">text</a></span>&nbsp;<span class="op" id="3397416">==</span>&nbsp;<span class="string" id="3397419">&#34;&#34;</span>&nbsp;<span class="op" id="3397422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397426">var</span>&nbsp;<span class="ident" id="3397430">ok</span>&nbsp;<span class="builtintype" id="3397433">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397440"><a href="/net/http/response.go.html#3397390">text</a></span><span class="op" id="3397444">,</span>&nbsp;<span class="ident" id="3397446"><a href="/net/http/response.go.html#3397430">ok</a></span>&nbsp;<span class="op" id="3397449">=</span>&nbsp;<span class="ident" id="3397451"><a href="/net/http/status.go.html#3468530">statusText</a></span><span class="op" id="3397461">[</span><span class="ident" id="3397462"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397463">.</span><span class="ident" id="3397464">StatusCode</span><span class="op" id="3397474">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397478">if</span>&nbsp;<span class="op" id="3397481">!</span><span class="ident" id="3397482"><a href="/net/http/response.go.html#3397430">ok</a></span>&nbsp;<span class="op" id="3397485">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397490"><a href="/net/http/response.go.html#3397390">text</a></span>&nbsp;<span class="op" id="3397495">=</span>&nbsp;<span class="string" id="3397497">&#34;status&nbsp;code&nbsp;&#34;</span>&nbsp;<span class="op" id="3397512">+</span>&nbsp;<span class="ident" id="3397514"><a href="/net/http/response.go.html#3391823">strconv</a></span><span class="op" id="3397521">.</span><span class="ident" id="3397522">Itoa</span><span class="op" id="3397526">(</span><span class="ident" id="3397527"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397528">.</span><span class="ident" id="3397529">StatusCode</span><span class="op" id="3397539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397543">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397549">protoMajor</span><span class="op" id="3397559">,</span>&nbsp;<span class="ident" id="3397561">protoMinor</span>&nbsp;<span class="op" id="3397572">:=</span>&nbsp;<span class="ident" id="3397575"><a href="/net/http/response.go.html#3391823">strconv</a></span><span class="op" id="3397582">.</span><span class="ident" id="3397583">Itoa</span><span class="op" id="3397587">(</span><span class="ident" id="3397588"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397589">.</span><span class="ident" id="3397590">ProtoMajor</span><span class="op" id="3397600">)</span><span class="op" id="3397601">,</span>&nbsp;<span class="ident" id="3397603"><a href="/net/http/response.go.html#3391823">strconv</a></span><span class="op" id="3397610">.</span><span class="ident" id="3397611">Itoa</span><span class="op" id="3397615">(</span><span class="ident" id="3397616"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397617">.</span><span class="ident" id="3397618">ProtoMinor</span><span class="op" id="3397628">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397631">statusCode</span>&nbsp;<span class="op" id="3397642">:=</span>&nbsp;<span class="ident" id="3397645"><a href="/net/http/response.go.html#3391823">strconv</a></span><span class="op" id="3397652">.</span><span class="ident" id="3397653">Itoa</span><span class="op" id="3397657">(</span><span class="ident" id="3397658"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3397659">.</span><span class="ident" id="3397660">StatusCode</span><span class="op" id="3397670">)</span>&nbsp;<span class="op" id="3397672">+</span>&nbsp;<span class="string" id="3397674">&#34;&nbsp;&#34;</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397679"><a href="/net/http/response.go.html#3397390">text</a></span>&nbsp;<span class="op" id="3397684">=</span>&nbsp;<span class="ident" id="3397686"><a href="/net/http/response.go.html#3391834">strings</a></span><span class="op" id="3397693">.</span><span class="ident" id="3397694">TrimPrefix</span><span class="op" id="3397704">(</span><span class="ident" id="3397705"><a href="/net/http/response.go.html#3397390">text</a></span><span class="op" id="3397709">,</span>&nbsp;<span class="ident" id="3397711"><a href="/net/http/response.go.html#3397631">statusCode</a></span><span class="op" id="3397721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397724">if</span>&nbsp;<span class="ident" id="3397727">_</span><span class="op" id="3397728">,</span>&nbsp;<span class="ident" id="3397730">err</span>&nbsp;<span class="op" id="3397734">:=</span>&nbsp;<span class="ident" id="3397737"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3397739">.</span><span class="ident" id="3397740">WriteString</span><span class="op" id="3397751">(</span><span class="ident" id="3397752"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3397753">,</span>&nbsp;<span class="string" id="3397755">&#34;HTTP/&#34;</span><span class="op" id="3397762">+</span><span class="ident" id="3397763"><a href="/net/http/response.go.html#3397549">protoMajor</a></span><span class="op" id="3397773">+</span><span class="string" id="3397774">&#34;.&#34;</span><span class="op" id="3397777">+</span><span class="ident" id="3397778"><a href="/net/http/response.go.html#3397561">protoMinor</a></span><span class="op" id="3397788">+</span><span class="string" id="3397789">&#34;&nbsp;&#34;</span><span class="op" id="3397792">+</span><span class="ident" id="3397793"><a href="/net/http/response.go.html#3397631">statusCode</a></span><span class="op" id="3397803">+</span><span class="ident" id="3397804"><a href="/net/http/response.go.html#3397390">text</a></span><span class="op" id="3397808">+</span><span class="string" id="3397809">&#34;\r\n&#34;</span><span class="op" id="3397815">)</span><span class="op" id="3397816">;</span>&nbsp;<span class="ident" id="3397818"><a href="/net/http/response.go.html#3397730">err</a></span>&nbsp;<span class="op" id="3397822">!=</span>&nbsp;<span class="ident" id="3397825">nil</span>&nbsp;<span class="op" id="3397829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397833">return</span>&nbsp;<span class="ident" id="3397840"><a href="/net/http/response.go.html#3397730">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397845">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3397849">//&nbsp;Clone&nbsp;it,&nbsp;so&nbsp;we&nbsp;can&nbsp;modify&nbsp;r1&nbsp;as&nbsp;needed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3397894">r1</span>&nbsp;<span class="op" id="3397897">:=</span>&nbsp;<span class="builtinfunc" id="3397900">new</span><span class="op" id="3397903">(</span><span class="ident" id="3397904"><a href="/net/http/response.go.html#3392041">Response</a></span><span class="op" id="3397912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3397915">*</span><span class="ident" id="3397916"><a href="/net/http/response.go.html#3397894">r1</a></span>&nbsp;<span class="op" id="3397919">=</span>&nbsp;<span class="op" id="3397921">*</span><span class="ident" id="3397922"><a href="/net/http/response.go.html#3397333">r</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3397925">if</span>&nbsp;<span class="ident" id="3397928"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3397930">.</span><span class="ident" id="3397931">ContentLength</span>&nbsp;<span class="op" id="3397945">==</span>&nbsp;<span class="num" id="3397948">0</span>&nbsp;<span class="op" id="3397950">&amp;&amp;</span>&nbsp;<span class="ident" id="3397953"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3397955">.</span><span class="ident" id="3397956">Body</span>&nbsp;<span class="op" id="3397961">!=</span>&nbsp;<span class="ident" id="3397964">nil</span>&nbsp;<span class="op" id="3397968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3397972">//&nbsp;Is&nbsp;it&nbsp;actually&nbsp;0&nbsp;length?&nbsp;Or&nbsp;just&nbsp;unknown?</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398019">var</span>&nbsp;<span class="ident" id="3398023">buf</span>&nbsp;<span class="op" id="3398027">[</span><span class="num" id="3398028">1</span><span class="op" id="3398029">]</span><span class="builtintype" id="3398030">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398037">n</span><span class="op" id="3398038">,</span>&nbsp;<span class="ident" id="3398040">err</span>&nbsp;<span class="op" id="3398044">:=</span>&nbsp;<span class="ident" id="3398047"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398049">.</span><span class="ident" id="3398050">Body</span><span class="op" id="3398054">.</span><span class="ident" id="3398055">Read</span><span class="op" id="3398059">(</span><span class="ident" id="3398060"><a href="/net/http/response.go.html#3398023">buf</a></span><span class="op" id="3398063">[</span><span class="op" id="3398064">:</span><span class="op" id="3398065">]</span><span class="op" id="3398066">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398070">if</span>&nbsp;<span class="ident" id="3398073"><a href="/net/http/response.go.html#3398040">err</a></span>&nbsp;<span class="op" id="3398077">!=</span>&nbsp;<span class="ident" id="3398080">nil</span>&nbsp;<span class="op" id="3398084">&amp;&amp;</span>&nbsp;<span class="ident" id="3398087"><a href="/net/http/response.go.html#3398040">err</a></span>&nbsp;<span class="op" id="3398091">!=</span>&nbsp;<span class="ident" id="3398094"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3398096">.</span><span class="ident" id="3398097">EOF</span>&nbsp;<span class="op" id="3398101">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398106">return</span>&nbsp;<span class="ident" id="3398113"><a href="/net/http/response.go.html#3398040">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398119">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398123">if</span>&nbsp;<span class="ident" id="3398126"><a href="/net/http/response.go.html#3398037">n</a></span>&nbsp;<span class="op" id="3398128">==</span>&nbsp;<span class="num" id="3398131">0</span>&nbsp;<span class="op" id="3398133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398138">//&nbsp;Reset&nbsp;it&nbsp;to&nbsp;a&nbsp;known&nbsp;zero&nbsp;reader,&nbsp;in&nbsp;case&nbsp;underlying&nbsp;one</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398200">//&nbsp;is&nbsp;unhappy&nbsp;being&nbsp;read&nbsp;repeatedly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398240"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398242">.</span><span class="ident" id="3398243">Body</span>&nbsp;<span class="op" id="3398248">=</span>&nbsp;<span class="ident" id="3398250"><a href="/net/http/server.go.html#3458959">eofReader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398262">}</span>&nbsp;<span class="keyword" id="3398264">else</span>&nbsp;<span class="op" id="3398269">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398274"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398276">.</span><span class="ident" id="3398277">ContentLength</span>&nbsp;<span class="op" id="3398291">=</span>&nbsp;<span class="op" id="3398293">-</span><span class="num" id="3398294">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398299"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398301">.</span><span class="ident" id="3398302">Body</span>&nbsp;<span class="op" id="3398307">=</span>&nbsp;<span class="keyword" id="3398309">struct</span>&nbsp;<span class="op" id="3398316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398322"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3398324">.</span><span class="ident" id="3398325">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398336"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3398338">.</span><span class="ident" id="3398339">Closer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398349">}</span><span class="op" id="3398350">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398356"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3398358">.</span><span class="ident" id="3398359">MultiReader</span><span class="op" id="3398370">(</span><span class="ident" id="3398371"><a href="/net/http/response.go.html#3391756">bytes</a></span><span class="op" id="3398376">.</span><span class="ident" id="3398377">NewReader</span><span class="op" id="3398386">(</span><span class="ident" id="3398387"><a href="/net/http/response.go.html#3398023">buf</a></span><span class="op" id="3398390">[</span><span class="op" id="3398391">:</span><span class="num" id="3398392">1</span><span class="op" id="3398393">]</span><span class="op" id="3398394">)</span><span class="op" id="3398395">,</span>&nbsp;<span class="ident" id="3398397"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3398398">.</span><span class="ident" id="3398399">Body</span><span class="op" id="3398403">)</span><span class="op" id="3398404">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398410"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3398411">.</span><span class="ident" id="3398412">Body</span><span class="op" id="3398416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398421">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398428">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398431">//&nbsp;If&nbsp;we&#39;re&nbsp;sending&nbsp;a&nbsp;non-chunked&nbsp;HTTP/1.1&nbsp;response&nbsp;without&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398494">//&nbsp;content-length,&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;do&nbsp;that&nbsp;is&nbsp;the&nbsp;old&nbsp;HTTP/1.0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398558">//&nbsp;way,&nbsp;by&nbsp;noting&nbsp;the&nbsp;EOF&nbsp;with&nbsp;a&nbsp;connection&nbsp;close,&nbsp;so&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398621">//&nbsp;to&nbsp;set&nbsp;Close.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398639">if</span>&nbsp;<span class="ident" id="3398642"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398644">.</span><span class="ident" id="3398645">ContentLength</span>&nbsp;<span class="op" id="3398659">==</span>&nbsp;<span class="op" id="3398662">-</span><span class="num" id="3398663">1</span>&nbsp;<span class="op" id="3398665">&amp;&amp;</span>&nbsp;<span class="op" id="3398668">!</span><span class="ident" id="3398669"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398671">.</span><span class="ident" id="3398672">Close</span>&nbsp;<span class="op" id="3398678">&amp;&amp;</span>&nbsp;<span class="ident" id="3398681"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398683">.</span><span class="ident" id="3398684">ProtoAtLeast</span><span class="op" id="3398696">(</span><span class="num" id="3398697">1</span><span class="op" id="3398698">,</span>&nbsp;<span class="num" id="3398700">1</span><span class="op" id="3398701">)</span>&nbsp;<span class="op" id="3398703">&amp;&amp;</span>&nbsp;<span class="op" id="3398706">!</span><span class="ident" id="3398707"><a href="/net/http/transfer.go.html#3481357">chunked</a></span><span class="op" id="3398714">(</span><span class="ident" id="3398715"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398717">.</span><span class="ident" id="3398718">TransferEncoding</span><span class="op" id="3398734">)</span>&nbsp;<span class="op" id="3398736">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398740"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398742">.</span><span class="ident" id="3398743">Close</span>&nbsp;<span class="op" id="3398749">=</span>&nbsp;<span class="builtintype" id="3398751">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398757">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398761">//&nbsp;Process&nbsp;Body,ContentLength,Close,Trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398806">tw</span><span class="op" id="3398808">,</span>&nbsp;<span class="ident" id="3398810">err</span>&nbsp;<span class="op" id="3398814">:=</span>&nbsp;<span class="ident" id="3398817"><a href="/net/http/transfer.go.html#3472205">newTransferWriter</a></span><span class="op" id="3398834">(</span><span class="ident" id="3398835"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3398837">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398840">if</span>&nbsp;<span class="ident" id="3398843"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3398847">!=</span>&nbsp;<span class="ident" id="3398850">nil</span>&nbsp;<span class="op" id="3398854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398858">return</span>&nbsp;<span class="ident" id="3398865"><a href="/net/http/response.go.html#3398810">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398873"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3398877">=</span>&nbsp;<span class="ident" id="3398879"><a href="/net/http/response.go.html#3398806">tw</a></span><span class="op" id="3398881">.</span><span class="ident" id="3398882">WriteHeader</span><span class="op" id="3398893">(</span><span class="ident" id="3398894"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3398895">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398898">if</span>&nbsp;<span class="ident" id="3398901"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3398905">!=</span>&nbsp;<span class="ident" id="3398908">nil</span>&nbsp;<span class="op" id="3398912">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3398916">return</span>&nbsp;<span class="ident" id="3398923"><a href="/net/http/response.go.html#3398810">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3398928">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3398932">//&nbsp;Rest&nbsp;of&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3398951"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3398955">=</span>&nbsp;<span class="ident" id="3398957"><a href="/net/http/response.go.html#3397333">r</a></span><span class="op" id="3398958">.</span><span class="ident" id="3398959">Header</span><span class="op" id="3398965">.</span><span class="ident" id="3398966">WriteSubset</span><span class="op" id="3398977">(</span><span class="ident" id="3398978"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3398979">,</span>&nbsp;<span class="ident" id="3398981"><a href="/net/http/response.go.html#3391851">respExcludeHeader</a></span><span class="op" id="3398998">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399001">if</span>&nbsp;<span class="ident" id="3399004"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3399008">!=</span>&nbsp;<span class="ident" id="3399011">nil</span>&nbsp;<span class="op" id="3399015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399019">return</span>&nbsp;<span class="ident" id="3399026"><a href="/net/http/response.go.html#3398810">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399031">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399035">//&nbsp;contentLengthAlreadySent&nbsp;may&nbsp;have&nbsp;been&nbsp;already&nbsp;sent&nbsp;for</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399095">//&nbsp;POST/PUT&nbsp;requests,&nbsp;even&nbsp;if&nbsp;zero&nbsp;length.&nbsp;See&nbsp;Issue&nbsp;8180.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399155">contentLengthAlreadySent</span>&nbsp;<span class="op" id="3399180">:=</span>&nbsp;<span class="ident" id="3399183"><a href="/net/http/response.go.html#3398806">tw</a></span><span class="op" id="3399185">.</span><span class="ident" id="3399186">shouldSendContentLength</span><span class="op" id="3399209">(</span><span class="op" id="3399210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399213">if</span>&nbsp;<span class="ident" id="3399216"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3399218">.</span><span class="ident" id="3399219">ContentLength</span>&nbsp;<span class="op" id="3399233">==</span>&nbsp;<span class="num" id="3399236">0</span>&nbsp;<span class="op" id="3399238">&amp;&amp;</span>&nbsp;<span class="op" id="3399241">!</span><span class="ident" id="3399242"><a href="/net/http/transfer.go.html#3481357">chunked</a></span><span class="op" id="3399249">(</span><span class="ident" id="3399250"><a href="/net/http/response.go.html#3397894">r1</a></span><span class="op" id="3399252">.</span><span class="ident" id="3399253">TransferEncoding</span><span class="op" id="3399269">)</span>&nbsp;<span class="op" id="3399271">&amp;&amp;</span>&nbsp;<span class="op" id="3399274">!</span><span class="ident" id="3399275"><a href="/net/http/response.go.html#3399155">contentLengthAlreadySent</a></span>&nbsp;<span class="op" id="3399300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399304">if</span>&nbsp;<span class="ident" id="3399307">_</span><span class="op" id="3399308">,</span>&nbsp;<span class="ident" id="3399310">err</span>&nbsp;<span class="op" id="3399314">:=</span>&nbsp;<span class="ident" id="3399317"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3399319">.</span><span class="ident" id="3399320">WriteString</span><span class="op" id="3399331">(</span><span class="ident" id="3399332"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3399333">,</span>&nbsp;<span class="string" id="3399335">&#34;Content-Length:&nbsp;0\r\n&#34;</span><span class="op" id="3399358">)</span><span class="op" id="3399359">;</span>&nbsp;<span class="ident" id="3399361"><a href="/net/http/response.go.html#3399310">err</a></span>&nbsp;<span class="op" id="3399365">!=</span>&nbsp;<span class="ident" id="3399368">nil</span>&nbsp;<span class="op" id="3399372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399377">return</span>&nbsp;<span class="ident" id="3399384"><a href="/net/http/response.go.html#3399310">err</a></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399390">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399393">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399397">//&nbsp;End-of-header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399415">if</span>&nbsp;<span class="ident" id="3399418">_</span><span class="op" id="3399419">,</span>&nbsp;<span class="ident" id="3399421">err</span>&nbsp;<span class="op" id="3399425">:=</span>&nbsp;<span class="ident" id="3399428"><a href="/net/http/response.go.html#3391789">io</a></span><span class="op" id="3399430">.</span><span class="ident" id="3399431">WriteString</span><span class="op" id="3399442">(</span><span class="ident" id="3399443"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3399444">,</span>&nbsp;<span class="string" id="3399446">&#34;\r\n&#34;</span><span class="op" id="3399452">)</span><span class="op" id="3399453">;</span>&nbsp;<span class="ident" id="3399455"><a href="/net/http/response.go.html#3399421">err</a></span>&nbsp;<span class="op" id="3399459">!=</span>&nbsp;<span class="ident" id="3399462">nil</span>&nbsp;<span class="op" id="3399466">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399470">return</span>&nbsp;<span class="ident" id="3399477"><a href="/net/http/response.go.html#3399421">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399482">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399486">//&nbsp;Write&nbsp;body&nbsp;and&nbsp;trailer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3399513"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3399517">=</span>&nbsp;<span class="ident" id="3399519"><a href="/net/http/response.go.html#3398806">tw</a></span><span class="op" id="3399521">.</span><span class="ident" id="3399522">WriteBody</span><span class="op" id="3399531">(</span><span class="ident" id="3399532"><a href="/net/http/response.go.html#3397352">w</a></span><span class="op" id="3399533">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399536">if</span>&nbsp;<span class="ident" id="3399539"><a href="/net/http/response.go.html#3398810">err</a></span>&nbsp;<span class="op" id="3399543">!=</span>&nbsp;<span class="ident" id="3399546">nil</span>&nbsp;<span class="op" id="3399550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399554">return</span>&nbsp;<span class="ident" id="3399561"><a href="/net/http/response.go.html#3398810">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3399566">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3399570">//&nbsp;Success</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3399582">return</span>&nbsp;<span class="ident" id="3399589">nil</span><br>
<span class="lineno"></span><span class="op" id="3399593">}</span>
</div>
</body>
</html>
