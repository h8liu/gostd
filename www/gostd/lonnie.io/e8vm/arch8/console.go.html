<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>lonnie.io/e8vm/arch8</h2>
<ul>
<li><a href="/gostd/lonnie.io/e8vm/arch8/console.go.html">console.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu.go.html">cpu.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/cpu_test.go.html">cpu_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/device.go.html">device.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/exception.go.html">exception.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_all.go.html">inst_all.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br.go.html">inst_br.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_br_test.go.html">inst_br_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm.go.html">inst_imm.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_imm_test.go.html">inst_imm_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_jmp.go.html">inst_jmp.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg.go.html">inst_reg.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_reg_test.go.html">inst_reg_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/inst_sys.go.html">inst_sys.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/int_bus.go.html">int_bus.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt.go.html">interrupt.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/interrupt_test.go.html">interrupt_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/machine.go.html">machine.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/multi_core.go.html">multi_core.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page.go.html">page.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table.go.html">page_table.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_table_test.go.html">page_table_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/page_test.go.html">page_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory.go.html">phy_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/phy_memory_test.go.html">phy_memory_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs.go.html">regs.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/regs_test.go.html">regs_test.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/run_image.go.html">run_image.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/serial.go.html">serial.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/ticker.go.html">ticker.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory.go.html">virt_memory.go</a></li>
<li><a href="/gostd/lonnie.io/e8vm/arch8/virt_memory_test.go.html">virt_memory_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="keyword" id="4776751">package</span>&nbsp;<span class="ident" id="4776759">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4776766">import</span>&nbsp;<span class="op" id="4776773">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4776776">&#34;io&#34;</span><br>
<span class="lineno">5</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4776782">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4776789">&#34;os&#34;</span><br>
<span class="lineno"></span><span class="op" id="4776794">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4776797">//&nbsp;Console&nbsp;is&nbsp;a&nbsp;simple&nbsp;console&nbsp;that&nbsp;can&nbsp;output/input&nbsp;a&nbsp;single</span><br>
<span class="lineno">10</span><span class="comment" id="4776859">//&nbsp;byte&nbsp;at&nbsp;a&nbsp;time</span><br>
<span class="lineno"></span><span class="keyword" id="4776877">type</span>&nbsp;<span class="ident" id="4776882">console</span>&nbsp;<span class="keyword" id="4776890">struct</span>&nbsp;<span class="op" id="4776897">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776900">intBus</span>&nbsp;<span class="ident" id="4776907">intBus</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776915">p</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4776922">*</span><span class="ident" id="4776923">page</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776930">Core</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="4776937">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776943">IntIn</span>&nbsp;&nbsp;<span class="builtintype" id="4776950">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776956">IntOut</span>&nbsp;<span class="builtintype" id="4776963">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4776970">Output</span>&nbsp;<span class="ident" id="4776977">io</span><span class="op" id="4776979">.</span><span class="ident" id="4776980">Writer</span><br>
<span class="lineno">20</span><span class="op" id="4776987">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4776990">//&nbsp;NewConsole&nbsp;creates&nbsp;a&nbsp;new&nbsp;simple&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="4777034">func</span>&nbsp;<span class="ident" id="4777039">newConsole</span><span class="op" id="4777049">(</span><span class="ident" id="4777050">p</span>&nbsp;<span class="op" id="4777052">*</span><span class="ident" id="4777053">page</span><span class="op" id="4777057">,</span>&nbsp;<span class="ident" id="4777059">i</span>&nbsp;<span class="ident" id="4777061">intBus</span><span class="op" id="4777067">)</span>&nbsp;<span class="op" id="4777069">*</span><span class="ident" id="4777070">console</span>&nbsp;<span class="op" id="4777078">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777081">ret</span>&nbsp;<span class="op" id="4777085">:=</span>&nbsp;<span class="builtinfunc" id="4777088">new</span><span class="op" id="4777091">(</span><span class="ident" id="4777092">console</span><span class="op" id="4777099">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777102">ret</span><span class="op" id="4777105">.</span><span class="ident" id="4777106">intBus</span>&nbsp;<span class="op" id="4777113">=</span>&nbsp;<span class="ident" id="4777115">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777118">ret</span><span class="op" id="4777121">.</span><span class="ident" id="4777122">p</span>&nbsp;<span class="op" id="4777124">=</span>&nbsp;<span class="ident" id="4777126">p</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777130">ret</span><span class="op" id="4777133">.</span><span class="ident" id="4777134">Core</span>&nbsp;<span class="op" id="4777139">=</span>&nbsp;<span class="num" id="4777141">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777144">ret</span><span class="op" id="4777147">.</span><span class="ident" id="4777148">IntIn</span>&nbsp;<span class="op" id="4777154">=</span>&nbsp;<span class="num" id="4777156">8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777159">ret</span><span class="op" id="4777162">.</span><span class="ident" id="4777163">IntOut</span>&nbsp;<span class="op" id="4777170">=</span>&nbsp;<span class="num" id="4777172">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777176">ret</span><span class="op" id="4777179">.</span><span class="ident" id="4777180">Output</span>&nbsp;<span class="op" id="4777187">=</span>&nbsp;<span class="ident" id="4777189">os</span><span class="op" id="4777191">.</span><span class="ident" id="4777192">Stdout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777200">return</span>&nbsp;<span class="ident" id="4777207">ret</span><br>
<span class="lineno"></span><span class="op" id="4777211">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span><span class="keyword" id="4777214">var</span>&nbsp;<span class="ident" id="4777218">_</span>&nbsp;<span class="ident" id="4777220">device</span>&nbsp;<span class="op" id="4777227">=</span>&nbsp;<span class="builtinfunc" id="4777229">new</span><span class="op" id="4777232">(</span><span class="ident" id="4777233">console</span><span class="op" id="4777240">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4777243">const</span>&nbsp;<span class="op" id="4777249">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777252">consoleBase</span>&nbsp;<span class="op" id="4777264">=</span>&nbsp;<span class="num" id="4777266">0</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777270">consoleOut</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4777286">=</span>&nbsp;<span class="ident" id="4777288">consoleBase</span>&nbsp;<span class="op" id="4777300">+</span>&nbsp;<span class="num" id="4777302">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777305">consoleOutValid</span>&nbsp;<span class="op" id="4777321">=</span>&nbsp;<span class="ident" id="4777323">consoleBase</span>&nbsp;<span class="op" id="4777335">+</span>&nbsp;<span class="num" id="4777337">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777340">consoleIn</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4777356">=</span>&nbsp;<span class="ident" id="4777358">consoleBase</span>&nbsp;<span class="op" id="4777370">+</span>&nbsp;<span class="num" id="4777372">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777375">consoleInValid</span>&nbsp;&nbsp;<span class="op" id="4777391">=</span>&nbsp;<span class="ident" id="4777393">consoleBase</span>&nbsp;<span class="op" id="4777405">+</span>&nbsp;<span class="num" id="4777407">3</span><br>
<span class="lineno">45</span><span class="op" id="4777409">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4777412">func</span>&nbsp;<span class="op" id="4777417">(</span><span class="ident" id="4777418">c</span>&nbsp;<span class="op" id="4777420">*</span><span class="ident" id="4777421">console</span><span class="op" id="4777428">)</span>&nbsp;<span class="ident" id="4777430">interrupt</span><span class="op" id="4777439">(</span><span class="ident" id="4777440">code</span>&nbsp;<span class="builtintype" id="4777445">byte</span><span class="op" id="4777449">)</span>&nbsp;<span class="op" id="4777451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777454">c</span><span class="op" id="4777455">.</span><span class="ident" id="4777456">intBus</span><span class="op" id="4777462">.</span><span class="ident" id="4777463">Interrupt</span><span class="op" id="4777472">(</span><span class="ident" id="4777473">code</span><span class="op" id="4777477">,</span>&nbsp;<span class="ident" id="4777479">c</span><span class="op" id="4777480">.</span><span class="ident" id="4777481">Core</span><span class="op" id="4777485">)</span><br>
<span class="lineno"></span><span class="op" id="4777487">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="4777490">//&nbsp;Tick&nbsp;flushes&nbsp;the&nbsp;buffered&nbsp;byte&nbsp;to&nbsp;the&nbsp;console.</span><br>
<span class="lineno"></span><span class="keyword" id="4777540">func</span>&nbsp;<span class="op" id="4777545">(</span><span class="ident" id="4777546">c</span>&nbsp;<span class="op" id="4777548">*</span><span class="ident" id="4777549">console</span><span class="op" id="4777556">)</span>&nbsp;<span class="ident" id="4777558">Tick</span><span class="op" id="4777562">(</span><span class="op" id="4777563">)</span>&nbsp;<span class="op" id="4777565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777568">outValid</span>&nbsp;<span class="op" id="4777577">:=</span>&nbsp;<span class="ident" id="4777580">c</span><span class="op" id="4777581">.</span><span class="ident" id="4777582">p</span><span class="op" id="4777583">.</span><span class="ident" id="4777584">ReadByte</span><span class="op" id="4777592">(</span><span class="ident" id="4777593">consoleOutValid</span><span class="op" id="4777608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777611">if</span>&nbsp;<span class="ident" id="4777614">outValid</span>&nbsp;<span class="op" id="4777623">!=</span>&nbsp;<span class="num" id="4777626">0</span>&nbsp;<span class="op" id="4777628">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777632">out</span>&nbsp;<span class="op" id="4777636">:=</span>&nbsp;<span class="ident" id="4777639">c</span><span class="op" id="4777640">.</span><span class="ident" id="4777641">p</span><span class="op" id="4777642">.</span><span class="ident" id="4777643">ReadByte</span><span class="op" id="4777651">(</span><span class="ident" id="4777652">consoleOut</span><span class="op" id="4777662">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777666">_</span><span class="op" id="4777667">,</span>&nbsp;<span class="ident" id="4777669">e</span>&nbsp;<span class="op" id="4777671">:=</span>&nbsp;<span class="ident" id="4777674">c</span><span class="op" id="4777675">.</span><span class="ident" id="4777676">Output</span><span class="op" id="4777682">.</span><span class="ident" id="4777683">Write</span><span class="op" id="4777688">(</span><span class="op" id="4777689">[</span><span class="op" id="4777690">]</span><span class="builtintype" id="4777691">byte</span><span class="op" id="4777695">{</span><span class="ident" id="4777696">out</span><span class="op" id="4777699">}</span><span class="op" id="4777700">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4777704">if</span>&nbsp;<span class="ident" id="4777707">e</span>&nbsp;<span class="op" id="4777709">!=</span>&nbsp;<span class="ident" id="4777712">nil</span>&nbsp;<span class="op" id="4777716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777721">log</span><span class="op" id="4777724">.</span><span class="ident" id="4777725">Print</span><span class="op" id="4777730">(</span><span class="ident" id="4777731">e</span><span class="op" id="4777732">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777736">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777740">c</span><span class="op" id="4777741">.</span><span class="ident" id="4777742">p</span><span class="op" id="4777743">.</span><span class="ident" id="4777744">WriteByte</span><span class="op" id="4777753">(</span><span class="ident" id="4777754">consoleOutValid</span><span class="op" id="4777769">,</span>&nbsp;<span class="num" id="4777771">0</span><span class="op" id="4777772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4777776">c</span><span class="op" id="4777777">.</span><span class="ident" id="4777778">interrupt</span><span class="op" id="4777787">(</span><span class="ident" id="4777788">c</span><span class="op" id="4777789">.</span><span class="ident" id="4777790">IntOut</span><span class="op" id="4777796">)</span>&nbsp;<span class="comment" id="4777798">//&nbsp;out&nbsp;available</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4777816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4777820">//&nbsp;TODO:&nbsp;input&nbsp;part</span><br>
<span class="lineno">65</span><span class="op" id="4777840">}</span>
</div>
</body>
</html>
