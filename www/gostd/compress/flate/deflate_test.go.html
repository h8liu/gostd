<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>compress/flate</h2>
<ul>
<li><a href="/gostd/compress/flate/copy.go.html">copy.go</a></li>
<li><a href="/gostd/compress/flate/copy_test.go.html">copy_test.go</a></li>
<li><a href="/gostd/compress/flate/deflate.go.html">deflate.go</a></li>
<li><a href="/gostd/compress/flate/deflate_test.go.html" class="current">deflate_test.go</a></li>
<li><a href="/gostd/compress/flate/fixedhuff.go.html">fixedhuff.go</a></li>
<li><a href="/gostd/compress/flate/flate_test.go.html">flate_test.go</a></li>
<li><a href="/gostd/compress/flate/huffman_bit_writer.go.html">huffman_bit_writer.go</a></li>
<li><a href="/gostd/compress/flate/huffman_code.go.html">huffman_code.go</a></li>
<li><a href="/gostd/compress/flate/inflate.go.html">inflate.go</a></li>
<li><a href="/gostd/compress/flate/inflate_test.go.html">inflate_test.go</a></li>
<li><a href="/gostd/compress/flate/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/compress/flate/reverse_bits.go.html">reverse_bits.go</a></li>
<li><a href="/gostd/compress/flate/token.go.html">token.go</a></li>
<li><a href="/gostd/compress/flate/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8105092">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8105147">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8105201">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8105252">package</span>&nbsp;<span class="ident" id="8105260">flate</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105267">import</span>&nbsp;<span class="op" id="8105274">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105277">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105286">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105293">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105299">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105312">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105323">&#34;sync&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8105331">&#34;testing&#34;</span><br>
<span class="lineno">15</span><span class="op" id="8105341">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105344">type</span>&nbsp;<span class="ident" id="8105349">deflateTest</span>&nbsp;<span class="keyword" id="8105361">struct</span>&nbsp;<span class="op" id="8105368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105371">in</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105377">[</span><span class="op" id="8105378">]</span><span class="builtintype" id="8105379">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105385">level</span>&nbsp;<span class="builtintype" id="8105391">int</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105396">out</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8105402">[</span><span class="op" id="8105403">]</span><span class="builtintype" id="8105404">byte</span><br>
<span class="lineno"></span><span class="op" id="8105409">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105412">type</span>&nbsp;<span class="ident" id="8105417">deflateInflateTest</span>&nbsp;<span class="keyword" id="8105436">struct</span>&nbsp;<span class="op" id="8105443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105446">in</span>&nbsp;<span class="op" id="8105449">[</span><span class="op" id="8105450">]</span><span class="builtintype" id="8105451">byte</span><br>
<span class="lineno">25</span><span class="op" id="8105456">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105459">type</span>&nbsp;<span class="ident" id="8105464">reverseBitsTest</span>&nbsp;<span class="keyword" id="8105480">struct</span>&nbsp;<span class="op" id="8105487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105490">in</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8105499">uint16</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105507">bitCount</span>&nbsp;<span class="builtintype" id="8105516">uint8</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8105523">out</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8105532">uint16</span><br>
<span class="lineno"></span><span class="op" id="8105539">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8105542">var</span>&nbsp;<span class="ident" id="8105546">deflateTests</span>&nbsp;<span class="op" id="8105559">=</span>&nbsp;<span class="op" id="8105561">[</span><span class="op" id="8105562">]</span><span class="op" id="8105563">*</span><span class="ident" id="8105564">deflateTest</span><span class="op" id="8105575">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105578">{</span><span class="op" id="8105579">[</span><span class="op" id="8105580">]</span><span class="builtintype" id="8105581">byte</span><span class="op" id="8105585">{</span><span class="op" id="8105586">}</span><span class="op" id="8105587">,</span>&nbsp;<span class="num" id="8105589">0</span><span class="op" id="8105590">,</span>&nbsp;<span class="op" id="8105592">[</span><span class="op" id="8105593">]</span><span class="builtintype" id="8105594">byte</span><span class="op" id="8105598">{</span><span class="num" id="8105599">1</span><span class="op" id="8105600">,</span>&nbsp;<span class="num" id="8105602">0</span><span class="op" id="8105603">,</span>&nbsp;<span class="num" id="8105605">0</span><span class="op" id="8105606">,</span>&nbsp;<span class="num" id="8105608">255</span><span class="op" id="8105611">,</span>&nbsp;<span class="num" id="8105613">255</span><span class="op" id="8105616">}</span><span class="op" id="8105617">}</span><span class="op" id="8105618">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105621">{</span><span class="op" id="8105622">[</span><span class="op" id="8105623">]</span><span class="builtintype" id="8105624">byte</span><span class="op" id="8105628">{</span><span class="num" id="8105629">0x11</span><span class="op" id="8105633">}</span><span class="op" id="8105634">,</span>&nbsp;<span class="op" id="8105636">-</span><span class="num" id="8105637">1</span><span class="op" id="8105638">,</span>&nbsp;<span class="op" id="8105640">[</span><span class="op" id="8105641">]</span><span class="builtintype" id="8105642">byte</span><span class="op" id="8105646">{</span><span class="num" id="8105647">18</span><span class="op" id="8105649">,</span>&nbsp;<span class="num" id="8105651">4</span><span class="op" id="8105652">,</span>&nbsp;<span class="num" id="8105654">4</span><span class="op" id="8105655">,</span>&nbsp;<span class="num" id="8105657">0</span><span class="op" id="8105658">,</span>&nbsp;<span class="num" id="8105660">0</span><span class="op" id="8105661">,</span>&nbsp;<span class="num" id="8105663">255</span><span class="op" id="8105666">,</span>&nbsp;<span class="num" id="8105668">255</span><span class="op" id="8105671">}</span><span class="op" id="8105672">}</span><span class="op" id="8105673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105676">{</span><span class="op" id="8105677">[</span><span class="op" id="8105678">]</span><span class="builtintype" id="8105679">byte</span><span class="op" id="8105683">{</span><span class="num" id="8105684">0x11</span><span class="op" id="8105688">}</span><span class="op" id="8105689">,</span>&nbsp;<span class="ident" id="8105691">DefaultCompression</span><span class="op" id="8105709">,</span>&nbsp;<span class="op" id="8105711">[</span><span class="op" id="8105712">]</span><span class="builtintype" id="8105713">byte</span><span class="op" id="8105717">{</span><span class="num" id="8105718">18</span><span class="op" id="8105720">,</span>&nbsp;<span class="num" id="8105722">4</span><span class="op" id="8105723">,</span>&nbsp;<span class="num" id="8105725">4</span><span class="op" id="8105726">,</span>&nbsp;<span class="num" id="8105728">0</span><span class="op" id="8105729">,</span>&nbsp;<span class="num" id="8105731">0</span><span class="op" id="8105732">,</span>&nbsp;<span class="num" id="8105734">255</span><span class="op" id="8105737">,</span>&nbsp;<span class="num" id="8105739">255</span><span class="op" id="8105742">}</span><span class="op" id="8105743">}</span><span class="op" id="8105744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105747">{</span><span class="op" id="8105748">[</span><span class="op" id="8105749">]</span><span class="builtintype" id="8105750">byte</span><span class="op" id="8105754">{</span><span class="num" id="8105755">0x11</span><span class="op" id="8105759">}</span><span class="op" id="8105760">,</span>&nbsp;<span class="num" id="8105762">4</span><span class="op" id="8105763">,</span>&nbsp;<span class="op" id="8105765">[</span><span class="op" id="8105766">]</span><span class="builtintype" id="8105767">byte</span><span class="op" id="8105771">{</span><span class="num" id="8105772">18</span><span class="op" id="8105774">,</span>&nbsp;<span class="num" id="8105776">4</span><span class="op" id="8105777">,</span>&nbsp;<span class="num" id="8105779">4</span><span class="op" id="8105780">,</span>&nbsp;<span class="num" id="8105782">0</span><span class="op" id="8105783">,</span>&nbsp;<span class="num" id="8105785">0</span><span class="op" id="8105786">,</span>&nbsp;<span class="num" id="8105788">255</span><span class="op" id="8105791">,</span>&nbsp;<span class="num" id="8105793">255</span><span class="op" id="8105796">}</span><span class="op" id="8105797">}</span><span class="op" id="8105798">,</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105802">{</span><span class="op" id="8105803">[</span><span class="op" id="8105804">]</span><span class="builtintype" id="8105805">byte</span><span class="op" id="8105809">{</span><span class="num" id="8105810">0x11</span><span class="op" id="8105814">}</span><span class="op" id="8105815">,</span>&nbsp;<span class="num" id="8105817">0</span><span class="op" id="8105818">,</span>&nbsp;<span class="op" id="8105820">[</span><span class="op" id="8105821">]</span><span class="builtintype" id="8105822">byte</span><span class="op" id="8105826">{</span><span class="num" id="8105827">0</span><span class="op" id="8105828">,</span>&nbsp;<span class="num" id="8105830">1</span><span class="op" id="8105831">,</span>&nbsp;<span class="num" id="8105833">0</span><span class="op" id="8105834">,</span>&nbsp;<span class="num" id="8105836">254</span><span class="op" id="8105839">,</span>&nbsp;<span class="num" id="8105841">255</span><span class="op" id="8105844">,</span>&nbsp;<span class="num" id="8105846">17</span><span class="op" id="8105848">,</span>&nbsp;<span class="num" id="8105850">1</span><span class="op" id="8105851">,</span>&nbsp;<span class="num" id="8105853">0</span><span class="op" id="8105854">,</span>&nbsp;<span class="num" id="8105856">0</span><span class="op" id="8105857">,</span>&nbsp;<span class="num" id="8105859">255</span><span class="op" id="8105862">,</span>&nbsp;<span class="num" id="8105864">255</span><span class="op" id="8105867">}</span><span class="op" id="8105868">}</span><span class="op" id="8105869">,</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105872">{</span><span class="op" id="8105873">[</span><span class="op" id="8105874">]</span><span class="builtintype" id="8105875">byte</span><span class="op" id="8105879">{</span><span class="num" id="8105880">0x11</span><span class="op" id="8105884">,</span>&nbsp;<span class="num" id="8105886">0x12</span><span class="op" id="8105890">}</span><span class="op" id="8105891">,</span>&nbsp;<span class="num" id="8105893">0</span><span class="op" id="8105894">,</span>&nbsp;<span class="op" id="8105896">[</span><span class="op" id="8105897">]</span><span class="builtintype" id="8105898">byte</span><span class="op" id="8105902">{</span><span class="num" id="8105903">0</span><span class="op" id="8105904">,</span>&nbsp;<span class="num" id="8105906">2</span><span class="op" id="8105907">,</span>&nbsp;<span class="num" id="8105909">0</span><span class="op" id="8105910">,</span>&nbsp;<span class="num" id="8105912">253</span><span class="op" id="8105915">,</span>&nbsp;<span class="num" id="8105917">255</span><span class="op" id="8105920">,</span>&nbsp;<span class="num" id="8105922">17</span><span class="op" id="8105924">,</span>&nbsp;<span class="num" id="8105926">18</span><span class="op" id="8105928">,</span>&nbsp;<span class="num" id="8105930">1</span><span class="op" id="8105931">,</span>&nbsp;<span class="num" id="8105933">0</span><span class="op" id="8105934">,</span>&nbsp;<span class="num" id="8105936">0</span><span class="op" id="8105937">,</span>&nbsp;<span class="num" id="8105939">255</span><span class="op" id="8105942">,</span>&nbsp;<span class="num" id="8105944">255</span><span class="op" id="8105947">}</span><span class="op" id="8105948">}</span><span class="op" id="8105949">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8105952">{</span><span class="op" id="8105953">[</span><span class="op" id="8105954">]</span><span class="builtintype" id="8105955">byte</span><span class="op" id="8105959">{</span><span class="num" id="8105960">0x11</span><span class="op" id="8105964">,</span>&nbsp;<span class="num" id="8105966">0x11</span><span class="op" id="8105970">,</span>&nbsp;<span class="num" id="8105972">0x11</span><span class="op" id="8105976">,</span>&nbsp;<span class="num" id="8105978">0x11</span><span class="op" id="8105982">,</span>&nbsp;<span class="num" id="8105984">0x11</span><span class="op" id="8105988">,</span>&nbsp;<span class="num" id="8105990">0x11</span><span class="op" id="8105994">,</span>&nbsp;<span class="num" id="8105996">0x11</span><span class="op" id="8106000">,</span>&nbsp;<span class="num" id="8106002">0x11</span><span class="op" id="8106006">}</span><span class="op" id="8106007">,</span>&nbsp;<span class="num" id="8106009">0</span><span class="op" id="8106010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106014">[</span><span class="op" id="8106015">]</span><span class="builtintype" id="8106016">byte</span><span class="op" id="8106020">{</span><span class="num" id="8106021">0</span><span class="op" id="8106022">,</span>&nbsp;<span class="num" id="8106024">8</span><span class="op" id="8106025">,</span>&nbsp;<span class="num" id="8106027">0</span><span class="op" id="8106028">,</span>&nbsp;<span class="num" id="8106030">247</span><span class="op" id="8106033">,</span>&nbsp;<span class="num" id="8106035">255</span><span class="op" id="8106038">,</span>&nbsp;<span class="num" id="8106040">17</span><span class="op" id="8106042">,</span>&nbsp;<span class="num" id="8106044">17</span><span class="op" id="8106046">,</span>&nbsp;<span class="num" id="8106048">17</span><span class="op" id="8106050">,</span>&nbsp;<span class="num" id="8106052">17</span><span class="op" id="8106054">,</span>&nbsp;<span class="num" id="8106056">17</span><span class="op" id="8106058">,</span>&nbsp;<span class="num" id="8106060">17</span><span class="op" id="8106062">,</span>&nbsp;<span class="num" id="8106064">17</span><span class="op" id="8106066">,</span>&nbsp;<span class="num" id="8106068">17</span><span class="op" id="8106070">,</span>&nbsp;<span class="num" id="8106072">1</span><span class="op" id="8106073">,</span>&nbsp;<span class="num" id="8106075">0</span><span class="op" id="8106076">,</span>&nbsp;<span class="num" id="8106078">0</span><span class="op" id="8106079">,</span>&nbsp;<span class="num" id="8106081">255</span><span class="op" id="8106084">,</span>&nbsp;<span class="num" id="8106086">255</span><span class="op" id="8106089">}</span><span class="op" id="8106090">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106093">}</span><span class="op" id="8106094">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106097">{</span><span class="op" id="8106098">[</span><span class="op" id="8106099">]</span><span class="builtintype" id="8106100">byte</span><span class="op" id="8106104">{</span><span class="op" id="8106105">}</span><span class="op" id="8106106">,</span>&nbsp;<span class="num" id="8106108">1</span><span class="op" id="8106109">,</span>&nbsp;<span class="op" id="8106111">[</span><span class="op" id="8106112">]</span><span class="builtintype" id="8106113">byte</span><span class="op" id="8106117">{</span><span class="num" id="8106118">1</span><span class="op" id="8106119">,</span>&nbsp;<span class="num" id="8106121">0</span><span class="op" id="8106122">,</span>&nbsp;<span class="num" id="8106124">0</span><span class="op" id="8106125">,</span>&nbsp;<span class="num" id="8106127">255</span><span class="op" id="8106130">,</span>&nbsp;<span class="num" id="8106132">255</span><span class="op" id="8106135">}</span><span class="op" id="8106136">}</span><span class="op" id="8106137">,</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106140">{</span><span class="op" id="8106141">[</span><span class="op" id="8106142">]</span><span class="builtintype" id="8106143">byte</span><span class="op" id="8106147">{</span><span class="num" id="8106148">0x11</span><span class="op" id="8106152">}</span><span class="op" id="8106153">,</span>&nbsp;<span class="num" id="8106155">1</span><span class="op" id="8106156">,</span>&nbsp;<span class="op" id="8106158">[</span><span class="op" id="8106159">]</span><span class="builtintype" id="8106160">byte</span><span class="op" id="8106164">{</span><span class="num" id="8106165">18</span><span class="op" id="8106167">,</span>&nbsp;<span class="num" id="8106169">4</span><span class="op" id="8106170">,</span>&nbsp;<span class="num" id="8106172">4</span><span class="op" id="8106173">,</span>&nbsp;<span class="num" id="8106175">0</span><span class="op" id="8106176">,</span>&nbsp;<span class="num" id="8106178">0</span><span class="op" id="8106179">,</span>&nbsp;<span class="num" id="8106181">255</span><span class="op" id="8106184">,</span>&nbsp;<span class="num" id="8106186">255</span><span class="op" id="8106189">}</span><span class="op" id="8106190">}</span><span class="op" id="8106191">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106194">{</span><span class="op" id="8106195">[</span><span class="op" id="8106196">]</span><span class="builtintype" id="8106197">byte</span><span class="op" id="8106201">{</span><span class="num" id="8106202">0x11</span><span class="op" id="8106206">,</span>&nbsp;<span class="num" id="8106208">0x12</span><span class="op" id="8106212">}</span><span class="op" id="8106213">,</span>&nbsp;<span class="num" id="8106215">1</span><span class="op" id="8106216">,</span>&nbsp;<span class="op" id="8106218">[</span><span class="op" id="8106219">]</span><span class="builtintype" id="8106220">byte</span><span class="op" id="8106224">{</span><span class="num" id="8106225">18</span><span class="op" id="8106227">,</span>&nbsp;<span class="num" id="8106229">20</span><span class="op" id="8106231">,</span>&nbsp;<span class="num" id="8106233">2</span><span class="op" id="8106234">,</span>&nbsp;<span class="num" id="8106236">4</span><span class="op" id="8106237">,</span>&nbsp;<span class="num" id="8106239">0</span><span class="op" id="8106240">,</span>&nbsp;<span class="num" id="8106242">0</span><span class="op" id="8106243">,</span>&nbsp;<span class="num" id="8106245">255</span><span class="op" id="8106248">,</span>&nbsp;<span class="num" id="8106250">255</span><span class="op" id="8106253">}</span><span class="op" id="8106254">}</span><span class="op" id="8106255">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106258">{</span><span class="op" id="8106259">[</span><span class="op" id="8106260">]</span><span class="builtintype" id="8106261">byte</span><span class="op" id="8106265">{</span><span class="num" id="8106266">0x11</span><span class="op" id="8106270">,</span>&nbsp;<span class="num" id="8106272">0x11</span><span class="op" id="8106276">,</span>&nbsp;<span class="num" id="8106278">0x11</span><span class="op" id="8106282">,</span>&nbsp;<span class="num" id="8106284">0x11</span><span class="op" id="8106288">,</span>&nbsp;<span class="num" id="8106290">0x11</span><span class="op" id="8106294">,</span>&nbsp;<span class="num" id="8106296">0x11</span><span class="op" id="8106300">,</span>&nbsp;<span class="num" id="8106302">0x11</span><span class="op" id="8106306">,</span>&nbsp;<span class="num" id="8106308">0x11</span><span class="op" id="8106312">}</span><span class="op" id="8106313">,</span>&nbsp;<span class="num" id="8106315">1</span><span class="op" id="8106316">,</span>&nbsp;<span class="op" id="8106318">[</span><span class="op" id="8106319">]</span><span class="builtintype" id="8106320">byte</span><span class="op" id="8106324">{</span><span class="num" id="8106325">18</span><span class="op" id="8106327">,</span>&nbsp;<span class="num" id="8106329">132</span><span class="op" id="8106332">,</span>&nbsp;<span class="num" id="8106334">2</span><span class="op" id="8106335">,</span>&nbsp;<span class="num" id="8106337">64</span><span class="op" id="8106339">,</span>&nbsp;<span class="num" id="8106341">0</span><span class="op" id="8106342">,</span>&nbsp;<span class="num" id="8106344">0</span><span class="op" id="8106345">,</span>&nbsp;<span class="num" id="8106347">0</span><span class="op" id="8106348">,</span>&nbsp;<span class="num" id="8106350">255</span><span class="op" id="8106353">,</span>&nbsp;<span class="num" id="8106355">255</span><span class="op" id="8106358">}</span><span class="op" id="8106359">}</span><span class="op" id="8106360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106363">{</span><span class="op" id="8106364">[</span><span class="op" id="8106365">]</span><span class="builtintype" id="8106366">byte</span><span class="op" id="8106370">{</span><span class="op" id="8106371">}</span><span class="op" id="8106372">,</span>&nbsp;<span class="num" id="8106374">9</span><span class="op" id="8106375">,</span>&nbsp;<span class="op" id="8106377">[</span><span class="op" id="8106378">]</span><span class="builtintype" id="8106379">byte</span><span class="op" id="8106383">{</span><span class="num" id="8106384">1</span><span class="op" id="8106385">,</span>&nbsp;<span class="num" id="8106387">0</span><span class="op" id="8106388">,</span>&nbsp;<span class="num" id="8106390">0</span><span class="op" id="8106391">,</span>&nbsp;<span class="num" id="8106393">255</span><span class="op" id="8106396">,</span>&nbsp;<span class="num" id="8106398">255</span><span class="op" id="8106401">}</span><span class="op" id="8106402">}</span><span class="op" id="8106403">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106406">{</span><span class="op" id="8106407">[</span><span class="op" id="8106408">]</span><span class="builtintype" id="8106409">byte</span><span class="op" id="8106413">{</span><span class="num" id="8106414">0x11</span><span class="op" id="8106418">}</span><span class="op" id="8106419">,</span>&nbsp;<span class="num" id="8106421">9</span><span class="op" id="8106422">,</span>&nbsp;<span class="op" id="8106424">[</span><span class="op" id="8106425">]</span><span class="builtintype" id="8106426">byte</span><span class="op" id="8106430">{</span><span class="num" id="8106431">18</span><span class="op" id="8106433">,</span>&nbsp;<span class="num" id="8106435">4</span><span class="op" id="8106436">,</span>&nbsp;<span class="num" id="8106438">4</span><span class="op" id="8106439">,</span>&nbsp;<span class="num" id="8106441">0</span><span class="op" id="8106442">,</span>&nbsp;<span class="num" id="8106444">0</span><span class="op" id="8106445">,</span>&nbsp;<span class="num" id="8106447">255</span><span class="op" id="8106450">,</span>&nbsp;<span class="num" id="8106452">255</span><span class="op" id="8106455">}</span><span class="op" id="8106456">}</span><span class="op" id="8106457">,</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106460">{</span><span class="op" id="8106461">[</span><span class="op" id="8106462">]</span><span class="builtintype" id="8106463">byte</span><span class="op" id="8106467">{</span><span class="num" id="8106468">0x11</span><span class="op" id="8106472">,</span>&nbsp;<span class="num" id="8106474">0x12</span><span class="op" id="8106478">}</span><span class="op" id="8106479">,</span>&nbsp;<span class="num" id="8106481">9</span><span class="op" id="8106482">,</span>&nbsp;<span class="op" id="8106484">[</span><span class="op" id="8106485">]</span><span class="builtintype" id="8106486">byte</span><span class="op" id="8106490">{</span><span class="num" id="8106491">18</span><span class="op" id="8106493">,</span>&nbsp;<span class="num" id="8106495">20</span><span class="op" id="8106497">,</span>&nbsp;<span class="num" id="8106499">2</span><span class="op" id="8106500">,</span>&nbsp;<span class="num" id="8106502">4</span><span class="op" id="8106503">,</span>&nbsp;<span class="num" id="8106505">0</span><span class="op" id="8106506">,</span>&nbsp;<span class="num" id="8106508">0</span><span class="op" id="8106509">,</span>&nbsp;<span class="num" id="8106511">255</span><span class="op" id="8106514">,</span>&nbsp;<span class="num" id="8106516">255</span><span class="op" id="8106519">}</span><span class="op" id="8106520">}</span><span class="op" id="8106521">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106524">{</span><span class="op" id="8106525">[</span><span class="op" id="8106526">]</span><span class="builtintype" id="8106527">byte</span><span class="op" id="8106531">{</span><span class="num" id="8106532">0x11</span><span class="op" id="8106536">,</span>&nbsp;<span class="num" id="8106538">0x11</span><span class="op" id="8106542">,</span>&nbsp;<span class="num" id="8106544">0x11</span><span class="op" id="8106548">,</span>&nbsp;<span class="num" id="8106550">0x11</span><span class="op" id="8106554">,</span>&nbsp;<span class="num" id="8106556">0x11</span><span class="op" id="8106560">,</span>&nbsp;<span class="num" id="8106562">0x11</span><span class="op" id="8106566">,</span>&nbsp;<span class="num" id="8106568">0x11</span><span class="op" id="8106572">,</span>&nbsp;<span class="num" id="8106574">0x11</span><span class="op" id="8106578">}</span><span class="op" id="8106579">,</span>&nbsp;<span class="num" id="8106581">9</span><span class="op" id="8106582">,</span>&nbsp;<span class="op" id="8106584">[</span><span class="op" id="8106585">]</span><span class="builtintype" id="8106586">byte</span><span class="op" id="8106590">{</span><span class="num" id="8106591">18</span><span class="op" id="8106593">,</span>&nbsp;<span class="num" id="8106595">132</span><span class="op" id="8106598">,</span>&nbsp;<span class="num" id="8106600">2</span><span class="op" id="8106601">,</span>&nbsp;<span class="num" id="8106603">64</span><span class="op" id="8106605">,</span>&nbsp;<span class="num" id="8106607">0</span><span class="op" id="8106608">,</span>&nbsp;<span class="num" id="8106610">0</span><span class="op" id="8106611">,</span>&nbsp;<span class="num" id="8106613">0</span><span class="op" id="8106614">,</span>&nbsp;<span class="num" id="8106616">255</span><span class="op" id="8106619">,</span>&nbsp;<span class="num" id="8106621">255</span><span class="op" id="8106624">}</span><span class="op" id="8106625">}</span><span class="op" id="8106626">,</span><br>
<span class="lineno"></span><span class="op" id="8106628">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106631">var</span>&nbsp;<span class="ident" id="8106635">deflateInflateTests</span>&nbsp;<span class="op" id="8106655">=</span>&nbsp;<span class="op" id="8106657">[</span><span class="op" id="8106658">]</span><span class="op" id="8106659">*</span><span class="ident" id="8106660">deflateInflateTest</span><span class="op" id="8106678">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106681">{</span><span class="op" id="8106682">[</span><span class="op" id="8106683">]</span><span class="builtintype" id="8106684">byte</span><span class="op" id="8106688">{</span><span class="op" id="8106689">}</span><span class="op" id="8106690">}</span><span class="op" id="8106691">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106694">{</span><span class="op" id="8106695">[</span><span class="op" id="8106696">]</span><span class="builtintype" id="8106697">byte</span><span class="op" id="8106701">{</span><span class="num" id="8106702">0x11</span><span class="op" id="8106706">}</span><span class="op" id="8106707">}</span><span class="op" id="8106708">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106711">{</span><span class="op" id="8106712">[</span><span class="op" id="8106713">]</span><span class="builtintype" id="8106714">byte</span><span class="op" id="8106718">{</span><span class="num" id="8106719">0x11</span><span class="op" id="8106723">,</span>&nbsp;<span class="num" id="8106725">0x12</span><span class="op" id="8106729">}</span><span class="op" id="8106730">}</span><span class="op" id="8106731">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106734">{</span><span class="op" id="8106735">[</span><span class="op" id="8106736">]</span><span class="builtintype" id="8106737">byte</span><span class="op" id="8106741">{</span><span class="num" id="8106742">0x11</span><span class="op" id="8106746">,</span>&nbsp;<span class="num" id="8106748">0x11</span><span class="op" id="8106752">,</span>&nbsp;<span class="num" id="8106754">0x11</span><span class="op" id="8106758">,</span>&nbsp;<span class="num" id="8106760">0x11</span><span class="op" id="8106764">,</span>&nbsp;<span class="num" id="8106766">0x11</span><span class="op" id="8106770">,</span>&nbsp;<span class="num" id="8106772">0x11</span><span class="op" id="8106776">,</span>&nbsp;<span class="num" id="8106778">0x11</span><span class="op" id="8106782">,</span>&nbsp;<span class="num" id="8106784">0x11</span><span class="op" id="8106788">}</span><span class="op" id="8106789">}</span><span class="op" id="8106790">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106793">{</span><span class="op" id="8106794">[</span><span class="op" id="8106795">]</span><span class="builtintype" id="8106796">byte</span><span class="op" id="8106800">{</span><span class="num" id="8106801">0x11</span><span class="op" id="8106805">,</span>&nbsp;<span class="num" id="8106807">0x10</span><span class="op" id="8106811">,</span>&nbsp;<span class="num" id="8106813">0x13</span><span class="op" id="8106817">,</span>&nbsp;<span class="num" id="8106819">0x41</span><span class="op" id="8106823">,</span>&nbsp;<span class="num" id="8106825">0x21</span><span class="op" id="8106829">,</span>&nbsp;<span class="num" id="8106831">0x21</span><span class="op" id="8106835">,</span>&nbsp;<span class="num" id="8106837">0x41</span><span class="op" id="8106841">,</span>&nbsp;<span class="num" id="8106843">0x13</span><span class="op" id="8106847">,</span>&nbsp;<span class="num" id="8106849">0x87</span><span class="op" id="8106853">,</span>&nbsp;<span class="num" id="8106855">0x78</span><span class="op" id="8106859">,</span>&nbsp;<span class="num" id="8106861">0x13</span><span class="op" id="8106865">}</span><span class="op" id="8106866">}</span><span class="op" id="8106867">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106870">{</span><span class="ident" id="8106871">largeDataChunk</span><span class="op" id="8106885">(</span><span class="op" id="8106886">)</span><span class="op" id="8106887">}</span><span class="op" id="8106888">,</span><br>
<span class="lineno"></span><span class="op" id="8106890">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8106893">var</span>&nbsp;<span class="ident" id="8106897">reverseBitsTests</span>&nbsp;<span class="op" id="8106914">=</span>&nbsp;<span class="op" id="8106916">[</span><span class="op" id="8106917">]</span><span class="op" id="8106918">*</span><span class="ident" id="8106919">reverseBitsTest</span><span class="op" id="8106934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106937">{</span><span class="num" id="8106938">1</span><span class="op" id="8106939">,</span>&nbsp;<span class="num" id="8106941">1</span><span class="op" id="8106942">,</span>&nbsp;<span class="num" id="8106944">1</span><span class="op" id="8106945">}</span><span class="op" id="8106946">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106949">{</span><span class="num" id="8106950">1</span><span class="op" id="8106951">,</span>&nbsp;<span class="num" id="8106953">2</span><span class="op" id="8106954">,</span>&nbsp;<span class="num" id="8106956">2</span><span class="op" id="8106957">}</span><span class="op" id="8106958">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106961">{</span><span class="num" id="8106962">1</span><span class="op" id="8106963">,</span>&nbsp;<span class="num" id="8106965">3</span><span class="op" id="8106966">,</span>&nbsp;<span class="num" id="8106968">4</span><span class="op" id="8106969">}</span><span class="op" id="8106970">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106973">{</span><span class="num" id="8106974">1</span><span class="op" id="8106975">,</span>&nbsp;<span class="num" id="8106977">4</span><span class="op" id="8106978">,</span>&nbsp;<span class="num" id="8106980">8</span><span class="op" id="8106981">}</span><span class="op" id="8106982">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106985">{</span><span class="num" id="8106986">1</span><span class="op" id="8106987">,</span>&nbsp;<span class="num" id="8106989">5</span><span class="op" id="8106990">,</span>&nbsp;<span class="num" id="8106992">16</span><span class="op" id="8106994">}</span><span class="op" id="8106995">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8106998">{</span><span class="num" id="8106999">17</span><span class="op" id="8107001">,</span>&nbsp;<span class="num" id="8107003">5</span><span class="op" id="8107004">,</span>&nbsp;<span class="num" id="8107006">17</span><span class="op" id="8107008">}</span><span class="op" id="8107009">,</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107012">{</span><span class="num" id="8107013">257</span><span class="op" id="8107016">,</span>&nbsp;<span class="num" id="8107018">9</span><span class="op" id="8107019">,</span>&nbsp;<span class="num" id="8107021">257</span><span class="op" id="8107024">}</span><span class="op" id="8107025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107028">{</span><span class="num" id="8107029">29</span><span class="op" id="8107031">,</span>&nbsp;<span class="num" id="8107033">5</span><span class="op" id="8107034">,</span>&nbsp;<span class="num" id="8107036">23</span><span class="op" id="8107038">}</span><span class="op" id="8107039">,</span><br>
<span class="lineno"></span><span class="op" id="8107041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107044">func</span>&nbsp;<span class="ident" id="8107049">largeDataChunk</span><span class="op" id="8107063">(</span><span class="op" id="8107064">)</span>&nbsp;<span class="op" id="8107066">[</span><span class="op" id="8107067">]</span><span class="builtintype" id="8107068">byte</span>&nbsp;<span class="op" id="8107073">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107076">result</span>&nbsp;<span class="op" id="8107083">:=</span>&nbsp;<span class="builtinfunc" id="8107086">make</span><span class="op" id="8107090">(</span><span class="op" id="8107091">[</span><span class="op" id="8107092">]</span><span class="builtintype" id="8107093">byte</span><span class="op" id="8107097">,</span>&nbsp;<span class="num" id="8107099">100000</span><span class="op" id="8107105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107108">for</span>&nbsp;<span class="ident" id="8107112">i</span>&nbsp;<span class="op" id="8107114">:=</span>&nbsp;<span class="keyword" id="8107117">range</span>&nbsp;<span class="ident" id="8107123">result</span>&nbsp;<span class="op" id="8107130">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107134">result</span><span class="op" id="8107140">[</span><span class="ident" id="8107141">i</span><span class="op" id="8107142">]</span>&nbsp;<span class="op" id="8107144">=</span>&nbsp;<span class="builtintype" id="8107146">byte</span><span class="op" id="8107150">(</span><span class="ident" id="8107151">i</span>&nbsp;<span class="op" id="8107153">*</span>&nbsp;<span class="ident" id="8107155">i</span>&nbsp;<span class="op" id="8107157">&amp;</span>&nbsp;<span class="num" id="8107159">0xFF</span><span class="op" id="8107163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107166">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107169">return</span>&nbsp;<span class="ident" id="8107176">result</span><br>
<span class="lineno">80</span><span class="op" id="8107183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8107186">func</span>&nbsp;<span class="ident" id="8107191">TestDeflate</span><span class="op" id="8107202">(</span><span class="ident" id="8107203">t</span>&nbsp;<span class="op" id="8107205">*</span><span class="ident" id="8107206">testing</span><span class="op" id="8107213">.</span><span class="ident" id="8107214">T</span><span class="op" id="8107215">)</span>&nbsp;<span class="op" id="8107217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107220">for</span>&nbsp;<span class="ident" id="8107224">_</span><span class="op" id="8107225">,</span>&nbsp;<span class="ident" id="8107227">h</span>&nbsp;<span class="op" id="8107229">:=</span>&nbsp;<span class="keyword" id="8107232">range</span>&nbsp;<span class="ident" id="8107238">deflateTests</span>&nbsp;<span class="op" id="8107251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107255">var</span>&nbsp;<span class="ident" id="8107259">buf</span>&nbsp;<span class="ident" id="8107263">bytes</span><span class="op" id="8107268">.</span><span class="ident" id="8107269">Buffer</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107278">w</span><span class="op" id="8107279">,</span>&nbsp;<span class="ident" id="8107281">err</span>&nbsp;<span class="op" id="8107285">:=</span>&nbsp;<span class="ident" id="8107288">NewWriter</span><span class="op" id="8107297">(</span><span class="op" id="8107298">&amp;</span><span class="ident" id="8107299">buf</span><span class="op" id="8107302">,</span>&nbsp;<span class="ident" id="8107304">h</span><span class="op" id="8107305">.</span><span class="ident" id="8107306">level</span><span class="op" id="8107311">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107315">if</span>&nbsp;<span class="ident" id="8107318">err</span>&nbsp;<span class="op" id="8107322">!=</span>&nbsp;<span class="builtintype" id="8107325">nil</span>&nbsp;<span class="op" id="8107329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107334">t</span><span class="op" id="8107335">.</span><span class="ident" id="8107336">Errorf</span><span class="op" id="8107342">(</span><span class="string" id="8107343">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8107358">,</span>&nbsp;<span class="ident" id="8107360">err</span><span class="op" id="8107363">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107368">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107379">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107383">w</span><span class="op" id="8107384">.</span><span class="ident" id="8107385">Write</span><span class="op" id="8107390">(</span><span class="ident" id="8107391">h</span><span class="op" id="8107392">.</span><span class="ident" id="8107393">in</span><span class="op" id="8107395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107399">w</span><span class="op" id="8107400">.</span><span class="ident" id="8107401">Close</span><span class="op" id="8107406">(</span><span class="op" id="8107407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107411">if</span>&nbsp;<span class="op" id="8107414">!</span><span class="ident" id="8107415">bytes</span><span class="op" id="8107420">.</span><span class="ident" id="8107421">Equal</span><span class="op" id="8107426">(</span><span class="ident" id="8107427">buf</span><span class="op" id="8107430">.</span><span class="ident" id="8107431">Bytes</span><span class="op" id="8107436">(</span><span class="op" id="8107437">)</span><span class="op" id="8107438">,</span>&nbsp;<span class="ident" id="8107440">h</span><span class="op" id="8107441">.</span><span class="ident" id="8107442">out</span><span class="op" id="8107445">)</span>&nbsp;<span class="op" id="8107447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107452">t</span><span class="op" id="8107453">.</span><span class="ident" id="8107454">Errorf</span><span class="op" id="8107460">(</span><span class="string" id="8107461">&#34;Deflate(%d,&nbsp;%x)&nbsp;=&nbsp;%x,&nbsp;want&nbsp;%x&#34;</span><span class="op" id="8107492">,</span>&nbsp;<span class="ident" id="8107494">h</span><span class="op" id="8107495">.</span><span class="ident" id="8107496">level</span><span class="op" id="8107501">,</span>&nbsp;<span class="ident" id="8107503">h</span><span class="op" id="8107504">.</span><span class="ident" id="8107505">in</span><span class="op" id="8107507">,</span>&nbsp;<span class="ident" id="8107509">buf</span><span class="op" id="8107512">.</span><span class="ident" id="8107513">Bytes</span><span class="op" id="8107518">(</span><span class="op" id="8107519">)</span><span class="op" id="8107520">,</span>&nbsp;<span class="ident" id="8107522">h</span><span class="op" id="8107523">.</span><span class="ident" id="8107524">out</span><span class="op" id="8107527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107531">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107534">}</span><br>
<span class="lineno"></span><span class="op" id="8107536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8107539">//&nbsp;A&nbsp;sparseReader&nbsp;returns&nbsp;a&nbsp;stream&nbsp;consisting&nbsp;of&nbsp;0s&nbsp;followed&nbsp;by&nbsp;1&lt;&lt;16&nbsp;1s.</span><br>
<span class="lineno"></span><span class="comment" id="8107613">//&nbsp;This&nbsp;tests&nbsp;missing&nbsp;hash&nbsp;references&nbsp;in&nbsp;a&nbsp;very&nbsp;large&nbsp;input.</span><br>
<span class="lineno">100</span><span class="keyword" id="8107674">type</span>&nbsp;<span class="ident" id="8107679">sparseReader</span>&nbsp;<span class="keyword" id="8107692">struct</span>&nbsp;<span class="op" id="8107699">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107702">l</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8107706">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107713">cur</span>&nbsp;<span class="builtintype" id="8107717">int64</span><br>
<span class="lineno"></span><span class="op" id="8107723">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="keyword" id="8107726">func</span>&nbsp;<span class="op" id="8107731">(</span><span class="ident" id="8107732">r</span>&nbsp;<span class="op" id="8107734">*</span><span class="ident" id="8107735">sparseReader</span><span class="op" id="8107747">)</span>&nbsp;<span class="ident" id="8107749">Read</span><span class="op" id="8107753">(</span><span class="ident" id="8107754">b</span>&nbsp;<span class="op" id="8107756">[</span><span class="op" id="8107757">]</span><span class="builtintype" id="8107758">byte</span><span class="op" id="8107762">)</span>&nbsp;<span class="op" id="8107764">(</span><span class="ident" id="8107765">n</span>&nbsp;<span class="builtintype" id="8107767">int</span><span class="op" id="8107770">,</span>&nbsp;<span class="ident" id="8107772">err</span>&nbsp;<span class="builtintype" id="8107776">error</span><span class="op" id="8107781">)</span>&nbsp;<span class="op" id="8107783">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107786">if</span>&nbsp;<span class="ident" id="8107789">r</span><span class="op" id="8107790">.</span><span class="ident" id="8107791">cur</span>&nbsp;<span class="op" id="8107795">&gt;=</span>&nbsp;<span class="ident" id="8107798">r</span><span class="op" id="8107799">.</span><span class="ident" id="8107800">l</span>&nbsp;<span class="op" id="8107802">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107806">return</span>&nbsp;<span class="num" id="8107813">0</span><span class="op" id="8107814">,</span>&nbsp;<span class="ident" id="8107816">io</span><span class="op" id="8107818">.</span><span class="ident" id="8107819">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107827">n</span>&nbsp;<span class="op" id="8107829">=</span>&nbsp;<span class="builtinfunc" id="8107831">len</span><span class="op" id="8107834">(</span><span class="ident" id="8107835">b</span><span class="op" id="8107836">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107839">cur</span>&nbsp;<span class="op" id="8107843">:=</span>&nbsp;<span class="ident" id="8107846">r</span><span class="op" id="8107847">.</span><span class="ident" id="8107848">cur</span>&nbsp;<span class="op" id="8107852">+</span>&nbsp;<span class="builtintype" id="8107854">int64</span><span class="op" id="8107859">(</span><span class="ident" id="8107860">n</span><span class="op" id="8107861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107864">if</span>&nbsp;<span class="ident" id="8107867">cur</span>&nbsp;<span class="op" id="8107871">&gt;</span>&nbsp;<span class="ident" id="8107873">r</span><span class="op" id="8107874">.</span><span class="ident" id="8107875">l</span>&nbsp;<span class="op" id="8107877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107881">n</span>&nbsp;<span class="op" id="8107883">-=</span>&nbsp;<span class="builtintype" id="8107886">int</span><span class="op" id="8107889">(</span><span class="ident" id="8107890">cur</span>&nbsp;<span class="op" id="8107894">-</span>&nbsp;<span class="ident" id="8107896">r</span><span class="op" id="8107897">.</span><span class="ident" id="8107898">l</span><span class="op" id="8107899">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107903">cur</span>&nbsp;<span class="op" id="8107907">=</span>&nbsp;<span class="ident" id="8107909">r</span><span class="op" id="8107910">.</span><span class="ident" id="8107911">l</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107914">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107917">for</span>&nbsp;<span class="ident" id="8107921">i</span>&nbsp;<span class="op" id="8107923">:=</span>&nbsp;<span class="keyword" id="8107926">range</span>&nbsp;<span class="ident" id="8107932">b</span><span class="op" id="8107933">[</span><span class="num" id="8107934">0</span><span class="op" id="8107935">:</span><span class="ident" id="8107936">n</span><span class="op" id="8107937">]</span>&nbsp;<span class="op" id="8107939">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8107943">if</span>&nbsp;<span class="ident" id="8107946">r</span><span class="op" id="8107947">.</span><span class="ident" id="8107948">cur</span><span class="op" id="8107951">+</span><span class="builtintype" id="8107952">int64</span><span class="op" id="8107957">(</span><span class="ident" id="8107958">i</span><span class="op" id="8107959">)</span>&nbsp;<span class="op" id="8107961">&gt;=</span>&nbsp;<span class="ident" id="8107964">r</span><span class="op" id="8107965">.</span><span class="ident" id="8107966">l</span><span class="op" id="8107967">-</span><span class="num" id="8107968">1</span><span class="op" id="8107969">&lt;&lt;</span><span class="num" id="8107971">16</span>&nbsp;<span class="op" id="8107974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8107979">b</span><span class="op" id="8107980">[</span><span class="ident" id="8107981">i</span><span class="op" id="8107982">]</span>&nbsp;<span class="op" id="8107984">=</span>&nbsp;<span class="num" id="8107986">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8107990">}</span>&nbsp;<span class="keyword" id="8107992">else</span>&nbsp;<span class="op" id="8107997">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108002">b</span><span class="op" id="8108003">[</span><span class="ident" id="8108004">i</span><span class="op" id="8108005">]</span>&nbsp;<span class="op" id="8108007">=</span>&nbsp;<span class="num" id="8108009">0</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108013">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108019">r</span><span class="op" id="8108020">.</span><span class="ident" id="8108021">cur</span>&nbsp;<span class="op" id="8108025">=</span>&nbsp;<span class="ident" id="8108027">cur</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108032">return</span><br>
<span class="lineno"></span><span class="op" id="8108039">}</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span><span class="keyword" id="8108042">func</span>&nbsp;<span class="ident" id="8108047">TestVeryLongSparseChunk</span><span class="op" id="8108070">(</span><span class="ident" id="8108071">t</span>&nbsp;<span class="op" id="8108073">*</span><span class="ident" id="8108074">testing</span><span class="op" id="8108081">.</span><span class="ident" id="8108082">T</span><span class="op" id="8108083">)</span>&nbsp;<span class="op" id="8108085">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108088">if</span>&nbsp;<span class="ident" id="8108091">testing</span><span class="op" id="8108098">.</span><span class="ident" id="8108099">Short</span><span class="op" id="8108104">(</span><span class="op" id="8108105">)</span>&nbsp;<span class="op" id="8108107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108111">t</span><span class="op" id="8108112">.</span><span class="ident" id="8108113">Skip</span><span class="op" id="8108117">(</span><span class="string" id="8108118">&#34;skipping&nbsp;sparse&nbsp;chunk&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="8108159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108162">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108165">w</span><span class="op" id="8108166">,</span>&nbsp;<span class="ident" id="8108168">err</span>&nbsp;<span class="op" id="8108172">:=</span>&nbsp;<span class="ident" id="8108175">NewWriter</span><span class="op" id="8108184">(</span><span class="ident" id="8108185">ioutil</span><span class="op" id="8108191">.</span><span class="ident" id="8108192">Discard</span><span class="op" id="8108199">,</span>&nbsp;<span class="num" id="8108201">1</span><span class="op" id="8108202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108205">if</span>&nbsp;<span class="ident" id="8108208">err</span>&nbsp;<span class="op" id="8108212">!=</span>&nbsp;<span class="builtintype" id="8108215">nil</span>&nbsp;<span class="op" id="8108219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108223">t</span><span class="op" id="8108224">.</span><span class="ident" id="8108225">Errorf</span><span class="op" id="8108231">(</span><span class="string" id="8108232">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8108247">,</span>&nbsp;<span class="ident" id="8108249">err</span><span class="op" id="8108252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108256">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108264">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108267">if</span>&nbsp;<span class="ident" id="8108270">_</span><span class="op" id="8108271">,</span>&nbsp;<span class="ident" id="8108273">err</span>&nbsp;<span class="op" id="8108277">=</span>&nbsp;<span class="ident" id="8108279">io</span><span class="op" id="8108281">.</span><span class="ident" id="8108282">Copy</span><span class="op" id="8108286">(</span><span class="ident" id="8108287">w</span><span class="op" id="8108288">,</span>&nbsp;<span class="op" id="8108290">&amp;</span><span class="ident" id="8108291">sparseReader</span><span class="op" id="8108303">{</span><span class="ident" id="8108304">l</span><span class="op" id="8108305">:</span>&nbsp;<span class="num" id="8108307">23E8</span><span class="op" id="8108311">}</span><span class="op" id="8108312">)</span><span class="op" id="8108313">;</span>&nbsp;<span class="ident" id="8108315">err</span>&nbsp;<span class="op" id="8108319">!=</span>&nbsp;<span class="builtintype" id="8108322">nil</span>&nbsp;<span class="op" id="8108326">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108330">t</span><span class="op" id="8108331">.</span><span class="ident" id="8108332">Errorf</span><span class="op" id="8108338">(</span><span class="string" id="8108339">&#34;Compress&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8108360">,</span>&nbsp;<span class="ident" id="8108362">err</span><span class="op" id="8108365">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108369">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108377">}</span><br>
<span class="lineno"></span><span class="op" id="8108379">}</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span><span class="keyword" id="8108382">type</span>&nbsp;<span class="ident" id="8108387">syncBuffer</span>&nbsp;<span class="keyword" id="8108398">struct</span>&nbsp;<span class="op" id="8108405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108408">buf</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108415">bytes</span><span class="op" id="8108420">.</span><span class="ident" id="8108421">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108429">mu</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108436">sync</span><span class="op" id="8108440">.</span><span class="ident" id="8108441">RWMutex</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108450">closed</span>&nbsp;<span class="builtintype" id="8108457">bool</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108463">ready</span>&nbsp;&nbsp;<span class="keyword" id="8108470">chan</span>&nbsp;<span class="builtintype" id="8108475">bool</span><br>
<span class="lineno"></span><span class="op" id="8108480">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108483">func</span>&nbsp;<span class="ident" id="8108488">newSyncBuffer</span><span class="op" id="8108501">(</span><span class="op" id="8108502">)</span>&nbsp;<span class="op" id="8108504">*</span><span class="ident" id="8108505">syncBuffer</span>&nbsp;<span class="op" id="8108516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108519">return</span>&nbsp;<span class="op" id="8108526">&amp;</span><span class="ident" id="8108527">syncBuffer</span><span class="op" id="8108537">{</span><span class="ident" id="8108538">ready</span><span class="op" id="8108543">:</span>&nbsp;<span class="builtinfunc" id="8108545">make</span><span class="op" id="8108549">(</span><span class="keyword" id="8108550">chan</span>&nbsp;<span class="builtintype" id="8108555">bool</span><span class="op" id="8108559">,</span>&nbsp;<span class="num" id="8108561">1</span><span class="op" id="8108562">)</span><span class="op" id="8108563">}</span><br>
<span class="lineno">150</span><span class="op" id="8108565">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108568">func</span>&nbsp;<span class="op" id="8108573">(</span><span class="ident" id="8108574">b</span>&nbsp;<span class="op" id="8108576">*</span><span class="ident" id="8108577">syncBuffer</span><span class="op" id="8108587">)</span>&nbsp;<span class="ident" id="8108589">Read</span><span class="op" id="8108593">(</span><span class="ident" id="8108594">p</span>&nbsp;<span class="op" id="8108596">[</span><span class="op" id="8108597">]</span><span class="builtintype" id="8108598">byte</span><span class="op" id="8108602">)</span>&nbsp;<span class="op" id="8108604">(</span><span class="ident" id="8108605">n</span>&nbsp;<span class="builtintype" id="8108607">int</span><span class="op" id="8108610">,</span>&nbsp;<span class="ident" id="8108612">err</span>&nbsp;<span class="builtintype" id="8108616">error</span><span class="op" id="8108621">)</span>&nbsp;<span class="op" id="8108623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108626">for</span>&nbsp;<span class="op" id="8108630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108634">b</span><span class="op" id="8108635">.</span><span class="ident" id="8108636">mu</span><span class="op" id="8108638">.</span><span class="ident" id="8108639">RLock</span><span class="op" id="8108644">(</span><span class="op" id="8108645">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108649">n</span><span class="op" id="8108650">,</span>&nbsp;<span class="ident" id="8108652">err</span>&nbsp;<span class="op" id="8108656">=</span>&nbsp;<span class="ident" id="8108658">b</span><span class="op" id="8108659">.</span><span class="ident" id="8108660">buf</span><span class="op" id="8108663">.</span><span class="ident" id="8108664">Read</span><span class="op" id="8108668">(</span><span class="ident" id="8108669">p</span><span class="op" id="8108670">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108674">b</span><span class="op" id="8108675">.</span><span class="ident" id="8108676">mu</span><span class="op" id="8108678">.</span><span class="ident" id="8108679">RUnlock</span><span class="op" id="8108686">(</span><span class="op" id="8108687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108691">if</span>&nbsp;<span class="ident" id="8108694">n</span>&nbsp;<span class="op" id="8108696">&gt;</span>&nbsp;<span class="num" id="8108698">0</span>&nbsp;<span class="op" id="8108700">||</span>&nbsp;<span class="ident" id="8108703">b</span><span class="op" id="8108704">.</span><span class="ident" id="8108705">closed</span>&nbsp;<span class="op" id="8108712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108717">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108726">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108730">&lt;-</span><span class="ident" id="8108732">b</span><span class="op" id="8108733">.</span><span class="ident" id="8108734">ready</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108741">}</span><br>
<span class="lineno"></span><span class="op" id="8108743">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108746">func</span>&nbsp;<span class="op" id="8108751">(</span><span class="ident" id="8108752">b</span>&nbsp;<span class="op" id="8108754">*</span><span class="ident" id="8108755">syncBuffer</span><span class="op" id="8108765">)</span>&nbsp;<span class="ident" id="8108767">signal</span><span class="op" id="8108773">(</span><span class="op" id="8108774">)</span>&nbsp;<span class="op" id="8108776">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108779">select</span>&nbsp;<span class="op" id="8108786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108789">case</span>&nbsp;<span class="ident" id="8108794">b</span><span class="op" id="8108795">.</span><span class="ident" id="8108796">ready</span>&nbsp;<span class="op" id="8108802">&lt;-</span>&nbsp;<span class="builtintype" id="8108805">true</span><span class="op" id="8108809">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108812">default</span><span class="op" id="8108819">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8108822">}</span><br>
<span class="lineno"></span><span class="op" id="8108824">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="8108827">func</span>&nbsp;<span class="op" id="8108832">(</span><span class="ident" id="8108833">b</span>&nbsp;<span class="op" id="8108835">*</span><span class="ident" id="8108836">syncBuffer</span><span class="op" id="8108846">)</span>&nbsp;<span class="ident" id="8108848">Write</span><span class="op" id="8108853">(</span><span class="ident" id="8108854">p</span>&nbsp;<span class="op" id="8108856">[</span><span class="op" id="8108857">]</span><span class="builtintype" id="8108858">byte</span><span class="op" id="8108862">)</span>&nbsp;<span class="op" id="8108864">(</span><span class="ident" id="8108865">n</span>&nbsp;<span class="builtintype" id="8108867">int</span><span class="op" id="8108870">,</span>&nbsp;<span class="ident" id="8108872">err</span>&nbsp;<span class="builtintype" id="8108876">error</span><span class="op" id="8108881">)</span>&nbsp;<span class="op" id="8108883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108886">n</span><span class="op" id="8108887">,</span>&nbsp;<span class="ident" id="8108889">err</span>&nbsp;<span class="op" id="8108893">=</span>&nbsp;<span class="ident" id="8108895">b</span><span class="op" id="8108896">.</span><span class="ident" id="8108897">buf</span><span class="op" id="8108900">.</span><span class="ident" id="8108901">Write</span><span class="op" id="8108906">(</span><span class="ident" id="8108907">p</span><span class="op" id="8108908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108911">b</span><span class="op" id="8108912">.</span><span class="ident" id="8108913">signal</span><span class="op" id="8108919">(</span><span class="op" id="8108920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8108923">return</span><br>
<span class="lineno">175</span><span class="op" id="8108930">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8108933">func</span>&nbsp;<span class="op" id="8108938">(</span><span class="ident" id="8108939">b</span>&nbsp;<span class="op" id="8108941">*</span><span class="ident" id="8108942">syncBuffer</span><span class="op" id="8108952">)</span>&nbsp;<span class="ident" id="8108954">WriteMode</span><span class="op" id="8108963">(</span><span class="op" id="8108964">)</span>&nbsp;<span class="op" id="8108966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8108969">b</span><span class="op" id="8108970">.</span><span class="ident" id="8108971">mu</span><span class="op" id="8108973">.</span><span class="ident" id="8108974">Lock</span><span class="op" id="8108978">(</span><span class="op" id="8108979">)</span><br>
<span class="lineno"></span><span class="op" id="8108981">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="8108984">func</span>&nbsp;<span class="op" id="8108989">(</span><span class="ident" id="8108990">b</span>&nbsp;<span class="op" id="8108992">*</span><span class="ident" id="8108993">syncBuffer</span><span class="op" id="8109003">)</span>&nbsp;<span class="ident" id="8109005">ReadMode</span><span class="op" id="8109013">(</span><span class="op" id="8109014">)</span>&nbsp;<span class="op" id="8109016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109019">b</span><span class="op" id="8109020">.</span><span class="ident" id="8109021">mu</span><span class="op" id="8109023">.</span><span class="ident" id="8109024">Unlock</span><span class="op" id="8109030">(</span><span class="op" id="8109031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109034">b</span><span class="op" id="8109035">.</span><span class="ident" id="8109036">signal</span><span class="op" id="8109042">(</span><span class="op" id="8109043">)</span><br>
<span class="lineno"></span><span class="op" id="8109045">}</span><br>
<span class="lineno">185</span><br>
<span class="lineno"></span><span class="keyword" id="8109048">func</span>&nbsp;<span class="op" id="8109053">(</span><span class="ident" id="8109054">b</span>&nbsp;<span class="op" id="8109056">*</span><span class="ident" id="8109057">syncBuffer</span><span class="op" id="8109067">)</span>&nbsp;<span class="ident" id="8109069">Close</span><span class="op" id="8109074">(</span><span class="op" id="8109075">)</span>&nbsp;<span class="builtintype" id="8109077">error</span>&nbsp;<span class="op" id="8109083">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109086">b</span><span class="op" id="8109087">.</span><span class="ident" id="8109088">closed</span>&nbsp;<span class="op" id="8109095">=</span>&nbsp;<span class="builtintype" id="8109097">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109103">b</span><span class="op" id="8109104">.</span><span class="ident" id="8109105">signal</span><span class="op" id="8109111">(</span><span class="op" id="8109112">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109115">return</span>&nbsp;<span class="builtintype" id="8109122">nil</span><br>
<span class="lineno">190</span><span class="op" id="8109126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8109129">func</span>&nbsp;<span class="ident" id="8109134">testSync</span><span class="op" id="8109142">(</span><span class="ident" id="8109143">t</span>&nbsp;<span class="op" id="8109145">*</span><span class="ident" id="8109146">testing</span><span class="op" id="8109153">.</span><span class="ident" id="8109154">T</span><span class="op" id="8109155">,</span>&nbsp;<span class="ident" id="8109157">level</span>&nbsp;<span class="builtintype" id="8109163">int</span><span class="op" id="8109166">,</span>&nbsp;<span class="ident" id="8109168">input</span>&nbsp;<span class="op" id="8109174">[</span><span class="op" id="8109175">]</span><span class="builtintype" id="8109176">byte</span><span class="op" id="8109180">,</span>&nbsp;<span class="ident" id="8109182">name</span>&nbsp;<span class="builtintype" id="8109187">string</span><span class="op" id="8109193">)</span>&nbsp;<span class="op" id="8109195">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109198">if</span>&nbsp;<span class="builtinfunc" id="8109201">len</span><span class="op" id="8109204">(</span><span class="ident" id="8109205">input</span><span class="op" id="8109210">)</span>&nbsp;<span class="op" id="8109212">==</span>&nbsp;<span class="num" id="8109215">0</span>&nbsp;<span class="op" id="8109217">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109221">return</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109229">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109233">t</span><span class="op" id="8109234">.</span><span class="ident" id="8109235">Logf</span><span class="op" id="8109239">(</span><span class="string" id="8109240">&#34;--testSync&nbsp;%d,&nbsp;%d,&nbsp;%s&#34;</span><span class="op" id="8109263">,</span>&nbsp;<span class="ident" id="8109265">level</span><span class="op" id="8109270">,</span>&nbsp;<span class="builtinfunc" id="8109272">len</span><span class="op" id="8109275">(</span><span class="ident" id="8109276">input</span><span class="op" id="8109281">)</span><span class="op" id="8109282">,</span>&nbsp;<span class="ident" id="8109284">name</span><span class="op" id="8109288">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109291">buf</span>&nbsp;<span class="op" id="8109295">:=</span>&nbsp;<span class="ident" id="8109298">newSyncBuffer</span><span class="op" id="8109311">(</span><span class="op" id="8109312">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109315">buf1</span>&nbsp;<span class="op" id="8109320">:=</span>&nbsp;<span class="builtinfunc" id="8109323">new</span><span class="op" id="8109326">(</span><span class="ident" id="8109327">bytes</span><span class="op" id="8109332">.</span><span class="ident" id="8109333">Buffer</span><span class="op" id="8109339">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109342">buf</span><span class="op" id="8109345">.</span><span class="ident" id="8109346">WriteMode</span><span class="op" id="8109355">(</span><span class="op" id="8109356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109359">w</span><span class="op" id="8109360">,</span>&nbsp;<span class="ident" id="8109362">err</span>&nbsp;<span class="op" id="8109366">:=</span>&nbsp;<span class="ident" id="8109369">NewWriter</span><span class="op" id="8109378">(</span><span class="ident" id="8109379">io</span><span class="op" id="8109381">.</span><span class="ident" id="8109382">MultiWriter</span><span class="op" id="8109393">(</span><span class="ident" id="8109394">buf</span><span class="op" id="8109397">,</span>&nbsp;<span class="ident" id="8109399">buf1</span><span class="op" id="8109403">)</span><span class="op" id="8109404">,</span>&nbsp;<span class="ident" id="8109406">level</span><span class="op" id="8109411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109414">if</span>&nbsp;<span class="ident" id="8109417">err</span>&nbsp;<span class="op" id="8109421">!=</span>&nbsp;<span class="builtintype" id="8109424">nil</span>&nbsp;<span class="op" id="8109428">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109432">t</span><span class="op" id="8109433">.</span><span class="ident" id="8109434">Errorf</span><span class="op" id="8109440">(</span><span class="string" id="8109441">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8109456">,</span>&nbsp;<span class="ident" id="8109458">err</span><span class="op" id="8109461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109465">return</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109473">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109476">r</span>&nbsp;<span class="op" id="8109478">:=</span>&nbsp;<span class="ident" id="8109481">NewReader</span><span class="op" id="8109490">(</span><span class="ident" id="8109491">buf</span><span class="op" id="8109494">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8109498">//&nbsp;Write&nbsp;half&nbsp;the&nbsp;input&nbsp;and&nbsp;read&nbsp;back.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109538">for</span>&nbsp;<span class="ident" id="8109542">i</span>&nbsp;<span class="op" id="8109544">:=</span>&nbsp;<span class="num" id="8109547">0</span><span class="op" id="8109548">;</span>&nbsp;<span class="ident" id="8109550">i</span>&nbsp;<span class="op" id="8109552">&lt;</span>&nbsp;<span class="num" id="8109554">2</span><span class="op" id="8109555">;</span>&nbsp;<span class="ident" id="8109557">i</span><span class="op" id="8109558">++</span>&nbsp;<span class="op" id="8109561">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109565">var</span>&nbsp;<span class="ident" id="8109569">lo</span><span class="op" id="8109571">,</span>&nbsp;<span class="ident" id="8109573">hi</span>&nbsp;<span class="builtintype" id="8109576">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109582">if</span>&nbsp;<span class="ident" id="8109585">i</span>&nbsp;<span class="op" id="8109587">==</span>&nbsp;<span class="num" id="8109590">0</span>&nbsp;<span class="op" id="8109592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109597">lo</span><span class="op" id="8109599">,</span>&nbsp;<span class="ident" id="8109601">hi</span>&nbsp;<span class="op" id="8109604">=</span>&nbsp;<span class="num" id="8109606">0</span><span class="op" id="8109607">,</span>&nbsp;<span class="op" id="8109609">(</span><span class="builtinfunc" id="8109610">len</span><span class="op" id="8109613">(</span><span class="ident" id="8109614">input</span><span class="op" id="8109619">)</span><span class="op" id="8109620">+</span><span class="num" id="8109621">1</span><span class="op" id="8109622">)</span><span class="op" id="8109623">/</span><span class="num" id="8109624">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109628">}</span>&nbsp;<span class="keyword" id="8109630">else</span>&nbsp;<span class="op" id="8109635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109640">lo</span><span class="op" id="8109642">,</span>&nbsp;<span class="ident" id="8109644">hi</span>&nbsp;<span class="op" id="8109647">=</span>&nbsp;<span class="op" id="8109649">(</span><span class="builtinfunc" id="8109650">len</span><span class="op" id="8109653">(</span><span class="ident" id="8109654">input</span><span class="op" id="8109659">)</span><span class="op" id="8109660">+</span><span class="num" id="8109661">1</span><span class="op" id="8109662">)</span><span class="op" id="8109663">/</span><span class="num" id="8109664">2</span><span class="op" id="8109665">,</span>&nbsp;<span class="builtinfunc" id="8109667">len</span><span class="op" id="8109670">(</span><span class="ident" id="8109671">input</span><span class="op" id="8109676">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109684">t</span><span class="op" id="8109685">.</span><span class="ident" id="8109686">Logf</span><span class="op" id="8109690">(</span><span class="string" id="8109691">&#34;#%d:&nbsp;write&nbsp;%d-%d&#34;</span><span class="op" id="8109709">,</span>&nbsp;<span class="ident" id="8109711">i</span><span class="op" id="8109712">,</span>&nbsp;<span class="ident" id="8109714">lo</span><span class="op" id="8109716">,</span>&nbsp;<span class="ident" id="8109718">hi</span><span class="op" id="8109720">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109724">if</span>&nbsp;<span class="ident" id="8109727">_</span><span class="op" id="8109728">,</span>&nbsp;<span class="ident" id="8109730">err</span>&nbsp;<span class="op" id="8109734">:=</span>&nbsp;<span class="ident" id="8109737">w</span><span class="op" id="8109738">.</span><span class="ident" id="8109739">Write</span><span class="op" id="8109744">(</span><span class="ident" id="8109745">input</span><span class="op" id="8109750">[</span><span class="ident" id="8109751">lo</span><span class="op" id="8109753">:</span><span class="ident" id="8109754">hi</span><span class="op" id="8109756">]</span><span class="op" id="8109757">)</span><span class="op" id="8109758">;</span>&nbsp;<span class="ident" id="8109760">err</span>&nbsp;<span class="op" id="8109764">!=</span>&nbsp;<span class="builtintype" id="8109767">nil</span>&nbsp;<span class="op" id="8109771">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109776">t</span><span class="op" id="8109777">.</span><span class="ident" id="8109778">Errorf</span><span class="op" id="8109784">(</span><span class="string" id="8109785">&#34;testSync:&nbsp;write:&nbsp;%v&#34;</span><span class="op" id="8109806">,</span>&nbsp;<span class="ident" id="8109808">err</span><span class="op" id="8109811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109816">return</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109825">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109829">if</span>&nbsp;<span class="ident" id="8109832">i</span>&nbsp;<span class="op" id="8109834">==</span>&nbsp;<span class="num" id="8109837">0</span>&nbsp;<span class="op" id="8109839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109844">if</span>&nbsp;<span class="ident" id="8109847">err</span>&nbsp;<span class="op" id="8109851">:=</span>&nbsp;<span class="ident" id="8109854">w</span><span class="op" id="8109855">.</span><span class="ident" id="8109856">Flush</span><span class="op" id="8109861">(</span><span class="op" id="8109862">)</span><span class="op" id="8109863">;</span>&nbsp;<span class="ident" id="8109865">err</span>&nbsp;<span class="op" id="8109869">!=</span>&nbsp;<span class="builtintype" id="8109872">nil</span>&nbsp;<span class="op" id="8109876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109882">t</span><span class="op" id="8109883">.</span><span class="ident" id="8109884">Errorf</span><span class="op" id="8109890">(</span><span class="string" id="8109891">&#34;testSync:&nbsp;flush:&nbsp;%v&#34;</span><span class="op" id="8109912">,</span>&nbsp;<span class="ident" id="8109914">err</span><span class="op" id="8109917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109923">return</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8109937">}</span>&nbsp;<span class="keyword" id="8109939">else</span>&nbsp;<span class="op" id="8109944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8109949">if</span>&nbsp;<span class="ident" id="8109952">err</span>&nbsp;<span class="op" id="8109956">:=</span>&nbsp;<span class="ident" id="8109959">w</span><span class="op" id="8109960">.</span><span class="ident" id="8109961">Close</span><span class="op" id="8109966">(</span><span class="op" id="8109967">)</span><span class="op" id="8109968">;</span>&nbsp;<span class="ident" id="8109970">err</span>&nbsp;<span class="op" id="8109974">!=</span>&nbsp;<span class="builtintype" id="8109977">nil</span>&nbsp;<span class="op" id="8109981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8109987">t</span><span class="op" id="8109988">.</span><span class="ident" id="8109989">Errorf</span><span class="op" id="8109995">(</span><span class="string" id="8109996">&#34;testSync:&nbsp;close:&nbsp;%v&#34;</span><span class="op" id="8110017">,</span>&nbsp;<span class="ident" id="8110019">err</span><span class="op" id="8110022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8110027">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8110031">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110035">buf</span><span class="op" id="8110038">.</span><span class="ident" id="8110039">ReadMode</span><span class="op" id="8110047">(</span><span class="op" id="8110048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110052">out</span>&nbsp;<span class="op" id="8110056">:=</span>&nbsp;<span class="builtinfunc" id="8110059">make</span><span class="op" id="8110063">(</span><span class="op" id="8110064">[</span><span class="op" id="8110065">]</span><span class="builtintype" id="8110066">byte</span><span class="op" id="8110070">,</span>&nbsp;<span class="ident" id="8110072">hi</span><span class="op" id="8110074">-</span><span class="ident" id="8110075">lo</span><span class="op" id="8110077">+</span><span class="num" id="8110078">1</span><span class="op" id="8110079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110083">m</span><span class="op" id="8110084">,</span>&nbsp;<span class="ident" id="8110086">err</span>&nbsp;<span class="op" id="8110090">:=</span>&nbsp;<span class="ident" id="8110093">io</span><span class="op" id="8110095">.</span><span class="ident" id="8110096">ReadAtLeast</span><span class="op" id="8110107">(</span><span class="ident" id="8110108">r</span><span class="op" id="8110109">,</span>&nbsp;<span class="ident" id="8110111">out</span><span class="op" id="8110114">,</span>&nbsp;<span class="ident" id="8110116">hi</span><span class="op" id="8110118">-</span><span class="ident" id="8110119">lo</span><span class="op" id="8110121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110125">t</span><span class="op" id="8110126">.</span><span class="ident" id="8110127">Logf</span><span class="op" id="8110131">(</span><span class="string" id="8110132">&#34;#%d:&nbsp;read&nbsp;%d&#34;</span><span class="op" id="8110146">,</span>&nbsp;<span class="ident" id="8110148">i</span><span class="op" id="8110149">,</span>&nbsp;<span class="ident" id="8110151">m</span><span class="op" id="8110152">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8110156">if</span>&nbsp;<span class="ident" id="8110159">m</span>&nbsp;<span class="op" id="8110161">!=</span>&nbsp;<span class="ident" id="8110164">hi</span><span class="op" id="8110166">-</span><span class="ident" id="8110167">lo</span>&nbsp;<span class="op" id="8110170">||</span>&nbsp;<span class="ident" id="8110173">err</span>&nbsp;<span class="op" id="8110177">!=</span>&nbsp;<span class="builtintype" id="8110180">nil</span>&nbsp;<span class="op" id="8110184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110189">t</span><span class="op" id="8110190">.</span><span class="ident" id="8110191">Errorf</span><span class="op" id="8110197">(</span><span class="string" id="8110198">&#34;testSync/%d&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;read&nbsp;%d:&nbsp;%d,&nbsp;%v&nbsp;(%d&nbsp;left)&#34;</span><span class="op" id="8110251">,</span>&nbsp;<span class="ident" id="8110253">i</span><span class="op" id="8110254">,</span>&nbsp;<span class="ident" id="8110256">level</span><span class="op" id="8110261">,</span>&nbsp;<span class="builtinfunc" id="8110263">len</span><span class="op" id="8110266">(</span><span class="ident" id="8110267">input</span><span class="op" id="8110272">)</span><span class="op" id="8110273">,</span>&nbsp;<span class="ident" id="8110275">name</span><span class="op" id="8110279">,</span>&nbsp;<span class="ident" id="8110281">hi</span><span class="op" id="8110283">-</span><span class="ident" id="8110284">lo</span><span class="op" id="8110286">,</span>&nbsp;<span class="ident" id="8110288">m</span><span class="op" id="8110289">,</span>&nbsp;<span class="ident" id="8110291">err</span><span class="op" id="8110294">,</span>&nbsp;<span class="ident" id="8110296">buf</span><span class="op" id="8110299">.</span><span class="ident" id="8110300">buf</span><span class="op" id="8110303">.</span><span class="ident" id="8110304">Len</span><span class="op" id="8110307">(</span><span class="op" id="8110308">)</span><span class="op" id="8110309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8110314">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8110323">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8110327">if</span>&nbsp;<span class="op" id="8110330">!</span><span class="ident" id="8110331">bytes</span><span class="op" id="8110336">.</span><span class="ident" id="8110337">Equal</span><span class="op" id="8110342">(</span><span class="ident" id="8110343">input</span><span class="op" id="8110348">[</span><span class="ident" id="8110349">lo</span><span class="op" id="8110351">:</span><span class="ident" id="8110352">hi</span><span class="op" id="8110354">]</span><span class="op" id="8110355">,</span>&nbsp;<span class="ident" id="8110357">out</span><span class="op" id="8110360">[</span><span class="op" id="8110361">:</span><span class="ident" id="8110362">hi</span><span class="op" id="8110364">-</span><span class="ident" id="8110365">lo</span><span class="op" id="8110367">]</span><span class="op" id="8110368">)</span>&nbsp;<span class="op" id="8110370">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110375">t</span><span class="op" id="8110376">.</span><span class="ident" id="8110377">Errorf</span><span class="op" id="8110383">(</span><span class="string" id="8110384">&#34;testSync/%d:&nbsp;read&nbsp;wrong&nbsp;bytes:&nbsp;%x&nbsp;vs&nbsp;%x&#34;</span><span class="op" id="8110425">,</span>&nbsp;<span class="ident" id="8110427">i</span><span class="op" id="8110428">,</span>&nbsp;<span class="ident" id="8110430">input</span><span class="op" id="8110435">[</span><span class="ident" id="8110436">lo</span><span class="op" id="8110438">:</span><span class="ident" id="8110439">hi</span><span class="op" id="8110441">]</span><span class="op" id="8110442">,</span>&nbsp;<span class="ident" id="8110444">out</span><span class="op" id="8110447">[</span><span class="op" id="8110448">:</span><span class="ident" id="8110449">hi</span><span class="op" id="8110451">-</span><span class="ident" id="8110452">lo</span><span class="op" id="8110454">]</span><span class="op" id="8110455">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8110460">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8110469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110473">//&nbsp;This&nbsp;test&nbsp;originally&nbsp;checked&nbsp;that&nbsp;after&nbsp;reading</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110526">//&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;input,&nbsp;there&nbsp;was&nbsp;nothing&nbsp;left</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110583">//&nbsp;in&nbsp;the&nbsp;read&nbsp;buffer&nbsp;(buf.buf.Len()&nbsp;!=&nbsp;0)&nbsp;but&nbsp;that&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110640">//&nbsp;not&nbsp;necessarily&nbsp;the&nbsp;case:&nbsp;the&nbsp;write&nbsp;Flush&nbsp;may&nbsp;emit</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110696">//&nbsp;some&nbsp;extra&nbsp;framing&nbsp;bits&nbsp;that&nbsp;are&nbsp;not&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110748">//&nbsp;to&nbsp;process&nbsp;to&nbsp;obtain&nbsp;the&nbsp;first&nbsp;half&nbsp;of&nbsp;the&nbsp;uncompressed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110809">//&nbsp;data.&nbsp;&nbsp;The&nbsp;test&nbsp;ran&nbsp;correctly&nbsp;most&nbsp;of&nbsp;the&nbsp;time,&nbsp;because</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110870">//&nbsp;the&nbsp;background&nbsp;goroutine&nbsp;had&nbsp;usually&nbsp;read&nbsp;even</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110922">//&nbsp;those&nbsp;extra&nbsp;bits&nbsp;by&nbsp;now,&nbsp;but&nbsp;it&#39;s&nbsp;not&nbsp;a&nbsp;useful&nbsp;thing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8110983">//&nbsp;check.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8110995">buf</span><span class="op" id="8110998">.</span><span class="ident" id="8110999">WriteMode</span><span class="op" id="8111008">(</span><span class="op" id="8111009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111012">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111015">buf</span><span class="op" id="8111018">.</span><span class="ident" id="8111019">ReadMode</span><span class="op" id="8111027">(</span><span class="op" id="8111028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111031">out</span>&nbsp;<span class="op" id="8111035">:=</span>&nbsp;<span class="builtinfunc" id="8111038">make</span><span class="op" id="8111042">(</span><span class="op" id="8111043">[</span><span class="op" id="8111044">]</span><span class="builtintype" id="8111045">byte</span><span class="op" id="8111049">,</span>&nbsp;<span class="num" id="8111051">10</span><span class="op" id="8111053">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111056">if</span>&nbsp;<span class="ident" id="8111059">n</span><span class="op" id="8111060">,</span>&nbsp;<span class="ident" id="8111062">err</span>&nbsp;<span class="op" id="8111066">:=</span>&nbsp;<span class="ident" id="8111069">r</span><span class="op" id="8111070">.</span><span class="ident" id="8111071">Read</span><span class="op" id="8111075">(</span><span class="ident" id="8111076">out</span><span class="op" id="8111079">)</span><span class="op" id="8111080">;</span>&nbsp;<span class="ident" id="8111082">n</span>&nbsp;<span class="op" id="8111084">&gt;</span>&nbsp;<span class="num" id="8111086">0</span>&nbsp;<span class="op" id="8111088">||</span>&nbsp;<span class="ident" id="8111091">err</span>&nbsp;<span class="op" id="8111095">!=</span>&nbsp;<span class="ident" id="8111098">io</span><span class="op" id="8111100">.</span><span class="ident" id="8111101">EOF</span>&nbsp;<span class="op" id="8111105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111109">t</span><span class="op" id="8111110">.</span><span class="ident" id="8111111">Errorf</span><span class="op" id="8111117">(</span><span class="string" id="8111118">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;final&nbsp;Read:&nbsp;%d,&nbsp;%v&nbsp;(hex:&nbsp;%x)&#34;</span><span class="op" id="8111171">,</span>&nbsp;<span class="ident" id="8111173">level</span><span class="op" id="8111178">,</span>&nbsp;<span class="builtinfunc" id="8111180">len</span><span class="op" id="8111183">(</span><span class="ident" id="8111184">input</span><span class="op" id="8111189">)</span><span class="op" id="8111190">,</span>&nbsp;<span class="ident" id="8111192">name</span><span class="op" id="8111196">,</span>&nbsp;<span class="ident" id="8111198">n</span><span class="op" id="8111199">,</span>&nbsp;<span class="ident" id="8111201">err</span><span class="op" id="8111204">,</span>&nbsp;<span class="ident" id="8111206">out</span><span class="op" id="8111209">[</span><span class="num" id="8111210">0</span><span class="op" id="8111211">:</span><span class="ident" id="8111212">n</span><span class="op" id="8111213">]</span><span class="op" id="8111214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111217">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111220">if</span>&nbsp;<span class="ident" id="8111223">buf</span><span class="op" id="8111226">.</span><span class="ident" id="8111227">buf</span><span class="op" id="8111230">.</span><span class="ident" id="8111231">Len</span><span class="op" id="8111234">(</span><span class="op" id="8111235">)</span>&nbsp;<span class="op" id="8111237">!=</span>&nbsp;<span class="num" id="8111240">0</span>&nbsp;<span class="op" id="8111242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111246">t</span><span class="op" id="8111247">.</span><span class="ident" id="8111248">Errorf</span><span class="op" id="8111254">(</span><span class="string" id="8111255">&#34;testSync&nbsp;(%d,&nbsp;%d,&nbsp;%s):&nbsp;extra&nbsp;data&nbsp;at&nbsp;end&#34;</span><span class="op" id="8111297">,</span>&nbsp;<span class="ident" id="8111299">level</span><span class="op" id="8111304">,</span>&nbsp;<span class="builtinfunc" id="8111306">len</span><span class="op" id="8111309">(</span><span class="ident" id="8111310">input</span><span class="op" id="8111315">)</span><span class="op" id="8111316">,</span>&nbsp;<span class="ident" id="8111318">name</span><span class="op" id="8111322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111325">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111328">r</span><span class="op" id="8111329">.</span><span class="ident" id="8111330">Close</span><span class="op" id="8111335">(</span><span class="op" id="8111336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8111340">//&nbsp;stream&nbsp;should&nbsp;work&nbsp;for&nbsp;ordinary&nbsp;reader&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111387">r</span>&nbsp;<span class="op" id="8111389">=</span>&nbsp;<span class="ident" id="8111391">NewReader</span><span class="op" id="8111400">(</span><span class="ident" id="8111401">buf1</span><span class="op" id="8111405">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111408">out</span><span class="op" id="8111411">,</span>&nbsp;<span class="ident" id="8111413">err</span>&nbsp;<span class="op" id="8111417">=</span>&nbsp;<span class="ident" id="8111419">ioutil</span><span class="op" id="8111425">.</span><span class="ident" id="8111426">ReadAll</span><span class="op" id="8111433">(</span><span class="ident" id="8111434">r</span><span class="op" id="8111435">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111438">if</span>&nbsp;<span class="ident" id="8111441">err</span>&nbsp;<span class="op" id="8111445">!=</span>&nbsp;<span class="builtintype" id="8111448">nil</span>&nbsp;<span class="op" id="8111452">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111456">t</span><span class="op" id="8111457">.</span><span class="ident" id="8111458">Errorf</span><span class="op" id="8111464">(</span><span class="string" id="8111465">&#34;testSync:&nbsp;read:&nbsp;%s&#34;</span><span class="op" id="8111485">,</span>&nbsp;<span class="ident" id="8111487">err</span><span class="op" id="8111490">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111494">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111505">r</span><span class="op" id="8111506">.</span><span class="ident" id="8111507">Close</span><span class="op" id="8111512">(</span><span class="op" id="8111513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111516">if</span>&nbsp;<span class="op" id="8111519">!</span><span class="ident" id="8111520">bytes</span><span class="op" id="8111525">.</span><span class="ident" id="8111526">Equal</span><span class="op" id="8111531">(</span><span class="ident" id="8111532">input</span><span class="op" id="8111537">,</span>&nbsp;<span class="ident" id="8111539">out</span><span class="op" id="8111542">)</span>&nbsp;<span class="op" id="8111544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111548">t</span><span class="op" id="8111549">.</span><span class="ident" id="8111550">Errorf</span><span class="op" id="8111556">(</span><span class="string" id="8111557">&#34;testSync:&nbsp;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="8111622">,</span>&nbsp;<span class="ident" id="8111624">level</span><span class="op" id="8111629">,</span>&nbsp;<span class="ident" id="8111631">name</span><span class="op" id="8111635">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111638">}</span><br>
<span class="lineno"></span><span class="op" id="8111640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8111643">func</span>&nbsp;<span class="ident" id="8111648">testToFromWithLevelAndLimit</span><span class="op" id="8111675">(</span><span class="ident" id="8111676">t</span>&nbsp;<span class="op" id="8111678">*</span><span class="ident" id="8111679">testing</span><span class="op" id="8111686">.</span><span class="ident" id="8111687">T</span><span class="op" id="8111688">,</span>&nbsp;<span class="ident" id="8111690">level</span>&nbsp;<span class="builtintype" id="8111696">int</span><span class="op" id="8111699">,</span>&nbsp;<span class="ident" id="8111701">input</span>&nbsp;<span class="op" id="8111707">[</span><span class="op" id="8111708">]</span><span class="builtintype" id="8111709">byte</span><span class="op" id="8111713">,</span>&nbsp;<span class="ident" id="8111715">name</span>&nbsp;<span class="builtintype" id="8111720">string</span><span class="op" id="8111726">,</span>&nbsp;<span class="ident" id="8111728">limit</span>&nbsp;<span class="builtintype" id="8111734">int</span><span class="op" id="8111737">)</span>&nbsp;<span class="op" id="8111739">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111742">var</span>&nbsp;<span class="ident" id="8111746">buffer</span>&nbsp;<span class="ident" id="8111753">bytes</span><span class="op" id="8111758">.</span><span class="ident" id="8111759">Buffer</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111767">w</span><span class="op" id="8111768">,</span>&nbsp;<span class="ident" id="8111770">err</span>&nbsp;<span class="op" id="8111774">:=</span>&nbsp;<span class="ident" id="8111777">NewWriter</span><span class="op" id="8111786">(</span><span class="op" id="8111787">&amp;</span><span class="ident" id="8111788">buffer</span><span class="op" id="8111794">,</span>&nbsp;<span class="ident" id="8111796">level</span><span class="op" id="8111801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111804">if</span>&nbsp;<span class="ident" id="8111807">err</span>&nbsp;<span class="op" id="8111811">!=</span>&nbsp;<span class="builtintype" id="8111814">nil</span>&nbsp;<span class="op" id="8111818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111822">t</span><span class="op" id="8111823">.</span><span class="ident" id="8111824">Errorf</span><span class="op" id="8111830">(</span><span class="string" id="8111831">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8111846">,</span>&nbsp;<span class="ident" id="8111848">err</span><span class="op" id="8111851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111855">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8111863">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111866">w</span><span class="op" id="8111867">.</span><span class="ident" id="8111868">Write</span><span class="op" id="8111873">(</span><span class="ident" id="8111874">input</span><span class="op" id="8111879">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111882">w</span><span class="op" id="8111883">.</span><span class="ident" id="8111884">Close</span><span class="op" id="8111889">(</span><span class="op" id="8111890">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8111893">if</span>&nbsp;<span class="ident" id="8111896">limit</span>&nbsp;<span class="op" id="8111902">&gt;</span>&nbsp;<span class="num" id="8111904">0</span>&nbsp;<span class="op" id="8111906">&amp;&amp;</span>&nbsp;<span class="ident" id="8111909">buffer</span><span class="op" id="8111915">.</span><span class="ident" id="8111916">Len</span><span class="op" id="8111919">(</span><span class="op" id="8111920">)</span>&nbsp;<span class="op" id="8111922">&gt;</span>&nbsp;<span class="ident" id="8111924">limit</span>&nbsp;<span class="op" id="8111930">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8111934">t</span><span class="op" id="8111935">.</span><span class="ident" id="8111936">Errorf</span><span class="op" id="8111942">(</span><span class="string" id="8111943">&#34;level:&nbsp;%d,&nbsp;len(compress(data))&nbsp;=&nbsp;%d&nbsp;&gt;&nbsp;limit&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8111993">,</span>&nbsp;<span class="ident" id="8111995">level</span><span class="op" id="8112000">,</span>&nbsp;<span class="ident" id="8112002">buffer</span><span class="op" id="8112008">.</span><span class="ident" id="8112009">Len</span><span class="op" id="8112012">(</span><span class="op" id="8112013">)</span><span class="op" id="8112014">,</span>&nbsp;<span class="ident" id="8112016">limit</span><span class="op" id="8112021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112025">return</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112036">r</span>&nbsp;<span class="op" id="8112038">:=</span>&nbsp;<span class="ident" id="8112041">NewReader</span><span class="op" id="8112050">(</span><span class="op" id="8112051">&amp;</span><span class="ident" id="8112052">buffer</span><span class="op" id="8112058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112061">out</span><span class="op" id="8112064">,</span>&nbsp;<span class="ident" id="8112066">err</span>&nbsp;<span class="op" id="8112070">:=</span>&nbsp;<span class="ident" id="8112073">ioutil</span><span class="op" id="8112079">.</span><span class="ident" id="8112080">ReadAll</span><span class="op" id="8112087">(</span><span class="ident" id="8112088">r</span><span class="op" id="8112089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112092">if</span>&nbsp;<span class="ident" id="8112095">err</span>&nbsp;<span class="op" id="8112099">!=</span>&nbsp;<span class="builtintype" id="8112102">nil</span>&nbsp;<span class="op" id="8112106">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112110">t</span><span class="op" id="8112111">.</span><span class="ident" id="8112112">Errorf</span><span class="op" id="8112118">(</span><span class="string" id="8112119">&#34;read:&nbsp;%s&#34;</span><span class="op" id="8112129">,</span>&nbsp;<span class="ident" id="8112131">err</span><span class="op" id="8112134">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112138">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112149">r</span><span class="op" id="8112150">.</span><span class="ident" id="8112151">Close</span><span class="op" id="8112156">(</span><span class="op" id="8112157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112160">if</span>&nbsp;<span class="op" id="8112163">!</span><span class="ident" id="8112164">bytes</span><span class="op" id="8112169">.</span><span class="ident" id="8112170">Equal</span><span class="op" id="8112175">(</span><span class="ident" id="8112176">input</span><span class="op" id="8112181">,</span>&nbsp;<span class="ident" id="8112183">out</span><span class="op" id="8112186">)</span>&nbsp;<span class="op" id="8112188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112192">t</span><span class="op" id="8112193">.</span><span class="ident" id="8112194">Errorf</span><span class="op" id="8112200">(</span><span class="string" id="8112201">&#34;decompress(compress(data))&nbsp;!=&nbsp;data:&nbsp;level=%d&nbsp;input=%s&#34;</span><span class="op" id="8112256">,</span>&nbsp;<span class="ident" id="8112258">level</span><span class="op" id="8112263">,</span>&nbsp;<span class="ident" id="8112265">name</span><span class="op" id="8112269">)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112273">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112281">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112284">testSync</span><span class="op" id="8112292">(</span><span class="ident" id="8112293">t</span><span class="op" id="8112294">,</span>&nbsp;<span class="ident" id="8112296">level</span><span class="op" id="8112301">,</span>&nbsp;<span class="ident" id="8112303">input</span><span class="op" id="8112308">,</span>&nbsp;<span class="ident" id="8112310">name</span><span class="op" id="8112314">)</span><br>
<span class="lineno"></span><span class="op" id="8112316">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">305</span><span class="keyword" id="8112319">func</span>&nbsp;<span class="ident" id="8112324">testToFromWithLimit</span><span class="op" id="8112343">(</span><span class="ident" id="8112344">t</span>&nbsp;<span class="op" id="8112346">*</span><span class="ident" id="8112347">testing</span><span class="op" id="8112354">.</span><span class="ident" id="8112355">T</span><span class="op" id="8112356">,</span>&nbsp;<span class="ident" id="8112358">input</span>&nbsp;<span class="op" id="8112364">[</span><span class="op" id="8112365">]</span><span class="builtintype" id="8112366">byte</span><span class="op" id="8112370">,</span>&nbsp;<span class="ident" id="8112372">name</span>&nbsp;<span class="builtintype" id="8112377">string</span><span class="op" id="8112383">,</span>&nbsp;<span class="ident" id="8112385">limit</span>&nbsp;<span class="op" id="8112391">[</span><span class="num" id="8112392">10</span><span class="op" id="8112394">]</span><span class="builtintype" id="8112395">int</span><span class="op" id="8112398">)</span>&nbsp;<span class="op" id="8112400">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112403">for</span>&nbsp;<span class="ident" id="8112407">i</span>&nbsp;<span class="op" id="8112409">:=</span>&nbsp;<span class="num" id="8112412">0</span><span class="op" id="8112413">;</span>&nbsp;<span class="ident" id="8112415">i</span>&nbsp;<span class="op" id="8112417">&lt;</span>&nbsp;<span class="num" id="8112419">10</span><span class="op" id="8112421">;</span>&nbsp;<span class="ident" id="8112423">i</span><span class="op" id="8112424">++</span>&nbsp;<span class="op" id="8112427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112431">testToFromWithLevelAndLimit</span><span class="op" id="8112458">(</span><span class="ident" id="8112459">t</span><span class="op" id="8112460">,</span>&nbsp;<span class="ident" id="8112462">i</span><span class="op" id="8112463">,</span>&nbsp;<span class="ident" id="8112465">input</span><span class="op" id="8112470">,</span>&nbsp;<span class="ident" id="8112472">name</span><span class="op" id="8112476">,</span>&nbsp;<span class="ident" id="8112478">limit</span><span class="op" id="8112483">[</span><span class="ident" id="8112484">i</span><span class="op" id="8112485">]</span><span class="op" id="8112486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112489">}</span><br>
<span class="lineno"></span><span class="op" id="8112491">}</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span><span class="keyword" id="8112494">func</span>&nbsp;<span class="ident" id="8112499">TestDeflateInflate</span><span class="op" id="8112517">(</span><span class="ident" id="8112518">t</span>&nbsp;<span class="op" id="8112520">*</span><span class="ident" id="8112521">testing</span><span class="op" id="8112528">.</span><span class="ident" id="8112529">T</span><span class="op" id="8112530">)</span>&nbsp;<span class="op" id="8112532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112535">for</span>&nbsp;<span class="ident" id="8112539">i</span><span class="op" id="8112540">,</span>&nbsp;<span class="ident" id="8112542">h</span>&nbsp;<span class="op" id="8112544">:=</span>&nbsp;<span class="keyword" id="8112547">range</span>&nbsp;<span class="ident" id="8112553">deflateInflateTests</span>&nbsp;<span class="op" id="8112573">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112577">testToFromWithLimit</span><span class="op" id="8112596">(</span><span class="ident" id="8112597">t</span><span class="op" id="8112598">,</span>&nbsp;<span class="ident" id="8112600">h</span><span class="op" id="8112601">.</span><span class="ident" id="8112602">in</span><span class="op" id="8112604">,</span>&nbsp;<span class="ident" id="8112606">fmt</span><span class="op" id="8112609">.</span><span class="ident" id="8112610">Sprintf</span><span class="op" id="8112617">(</span><span class="string" id="8112618">&#34;#%d&#34;</span><span class="op" id="8112623">,</span>&nbsp;<span class="ident" id="8112625">i</span><span class="op" id="8112626">)</span><span class="op" id="8112627">,</span>&nbsp;<span class="op" id="8112629">[</span><span class="num" id="8112630">10</span><span class="op" id="8112632">]</span><span class="builtintype" id="8112633">int</span><span class="op" id="8112636">{</span><span class="op" id="8112637">}</span><span class="op" id="8112638">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112641">}</span><br>
<span class="lineno">315</span><span class="op" id="8112643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8112646">func</span>&nbsp;<span class="ident" id="8112651">TestReverseBits</span><span class="op" id="8112666">(</span><span class="ident" id="8112667">t</span>&nbsp;<span class="op" id="8112669">*</span><span class="ident" id="8112670">testing</span><span class="op" id="8112677">.</span><span class="ident" id="8112678">T</span><span class="op" id="8112679">)</span>&nbsp;<span class="op" id="8112681">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112684">for</span>&nbsp;<span class="ident" id="8112688">_</span><span class="op" id="8112689">,</span>&nbsp;<span class="ident" id="8112691">h</span>&nbsp;<span class="op" id="8112693">:=</span>&nbsp;<span class="keyword" id="8112696">range</span>&nbsp;<span class="ident" id="8112702">reverseBitsTests</span>&nbsp;<span class="op" id="8112719">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8112723">if</span>&nbsp;<span class="ident" id="8112726">v</span>&nbsp;<span class="op" id="8112728">:=</span>&nbsp;<span class="ident" id="8112731">reverseBits</span><span class="op" id="8112742">(</span><span class="ident" id="8112743">h</span><span class="op" id="8112744">.</span><span class="ident" id="8112745">in</span><span class="op" id="8112747">,</span>&nbsp;<span class="ident" id="8112749">h</span><span class="op" id="8112750">.</span><span class="ident" id="8112751">bitCount</span><span class="op" id="8112759">)</span><span class="op" id="8112760">;</span>&nbsp;<span class="ident" id="8112762">v</span>&nbsp;<span class="op" id="8112764">!=</span>&nbsp;<span class="ident" id="8112767">h</span><span class="op" id="8112768">.</span><span class="ident" id="8112769">out</span>&nbsp;<span class="op" id="8112773">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112778">t</span><span class="op" id="8112779">.</span><span class="ident" id="8112780">Errorf</span><span class="op" id="8112786">(</span><span class="string" id="8112787">&#34;reverseBits(%v,%v)&nbsp;=&nbsp;%v,&nbsp;want&nbsp;%v&#34;</span><span class="op" id="8112821">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112827">h</span><span class="op" id="8112828">.</span><span class="ident" id="8112829">in</span><span class="op" id="8112831">,</span>&nbsp;<span class="ident" id="8112833">h</span><span class="op" id="8112834">.</span><span class="ident" id="8112835">bitCount</span><span class="op" id="8112843">,</span>&nbsp;<span class="ident" id="8112845">v</span><span class="op" id="8112846">,</span>&nbsp;<span class="ident" id="8112848">h</span><span class="op" id="8112849">.</span><span class="ident" id="8112850">out</span><span class="op" id="8112853">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112860">}</span><br>
<span class="lineno"></span><span class="op" id="8112862">}</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span><span class="keyword" id="8112865">type</span>&nbsp;<span class="ident" id="8112870">deflateInflateStringTest</span>&nbsp;<span class="keyword" id="8112895">struct</span>&nbsp;<span class="op" id="8112902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112905">filename</span>&nbsp;<span class="builtintype" id="8112914">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112922">label</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8112931">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8112939">limit</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8112948">[</span><span class="num" id="8112949">10</span><span class="op" id="8112951">]</span><span class="builtintype" id="8112952">int</span><br>
<span class="lineno">330</span><span class="op" id="8112956">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8112959">var</span>&nbsp;<span class="ident" id="8112963">deflateInflateStringTests</span>&nbsp;<span class="op" id="8112989">=</span>&nbsp;<span class="op" id="8112991">[</span><span class="op" id="8112992">]</span><span class="ident" id="8112993">deflateInflateStringTest</span><span class="op" id="8113017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8113024">&#34;../testdata/e.txt&#34;</span><span class="op" id="8113043">,</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8113047">&#34;2.718281828...&#34;</span><span class="op" id="8113063">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113067">[</span><span class="op" id="8113068">...</span><span class="op" id="8113071">]</span><span class="builtintype" id="8113072">int</span><span class="op" id="8113075">{</span><span class="num" id="8113076">100018</span><span class="op" id="8113082">,</span>&nbsp;<span class="num" id="8113084">50650</span><span class="op" id="8113089">,</span>&nbsp;<span class="num" id="8113091">50960</span><span class="op" id="8113096">,</span>&nbsp;<span class="num" id="8113098">51150</span><span class="op" id="8113103">,</span>&nbsp;<span class="num" id="8113105">50930</span><span class="op" id="8113110">,</span>&nbsp;<span class="num" id="8113112">50790</span><span class="op" id="8113117">,</span>&nbsp;<span class="num" id="8113119">50790</span><span class="op" id="8113124">,</span>&nbsp;<span class="num" id="8113126">50790</span><span class="op" id="8113131">,</span>&nbsp;<span class="num" id="8113133">50790</span><span class="op" id="8113138">,</span>&nbsp;<span class="num" id="8113140">50790</span><span class="op" id="8113145">}</span><span class="op" id="8113146">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113149">}</span><span class="op" id="8113150">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113153">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8113157">&#34;../testdata/Mark.Twain-Tom.Sawyer.txt&#34;</span><span class="op" id="8113196">,</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8113200">&#34;Mark.Twain-Tom.Sawyer&#34;</span><span class="op" id="8113223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113227">[</span><span class="op" id="8113228">...</span><span class="op" id="8113231">]</span><span class="builtintype" id="8113232">int</span><span class="op" id="8113235">{</span><span class="num" id="8113236">407330</span><span class="op" id="8113242">,</span>&nbsp;<span class="num" id="8113244">187598</span><span class="op" id="8113250">,</span>&nbsp;<span class="num" id="8113252">180361</span><span class="op" id="8113258">,</span>&nbsp;<span class="num" id="8113260">172974</span><span class="op" id="8113266">,</span>&nbsp;<span class="num" id="8113268">169160</span><span class="op" id="8113274">,</span>&nbsp;<span class="num" id="8113276">163476</span><span class="op" id="8113282">,</span>&nbsp;<span class="num" id="8113284">160936</span><span class="op" id="8113290">,</span>&nbsp;<span class="num" id="8113292">160506</span><span class="op" id="8113298">,</span>&nbsp;<span class="num" id="8113300">160295</span><span class="op" id="8113306">,</span>&nbsp;<span class="num" id="8113308">160295</span><span class="op" id="8113314">}</span><span class="op" id="8113315">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113318">}</span><span class="op" id="8113319">,</span><br>
<span class="lineno"></span><span class="op" id="8113321">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">345</span><span class="keyword" id="8113324">func</span>&nbsp;<span class="ident" id="8113329">TestDeflateInflateString</span><span class="op" id="8113353">(</span><span class="ident" id="8113354">t</span>&nbsp;<span class="op" id="8113356">*</span><span class="ident" id="8113357">testing</span><span class="op" id="8113364">.</span><span class="ident" id="8113365">T</span><span class="op" id="8113366">)</span>&nbsp;<span class="op" id="8113368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113371">for</span>&nbsp;<span class="ident" id="8113375">_</span><span class="op" id="8113376">,</span>&nbsp;<span class="ident" id="8113378">test</span>&nbsp;<span class="op" id="8113383">:=</span>&nbsp;<span class="keyword" id="8113386">range</span>&nbsp;<span class="ident" id="8113392">deflateInflateStringTests</span>&nbsp;<span class="op" id="8113418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113422">gold</span><span class="op" id="8113426">,</span>&nbsp;<span class="ident" id="8113428">err</span>&nbsp;<span class="op" id="8113432">:=</span>&nbsp;<span class="ident" id="8113435">ioutil</span><span class="op" id="8113441">.</span><span class="ident" id="8113442">ReadFile</span><span class="op" id="8113450">(</span><span class="ident" id="8113451">test</span><span class="op" id="8113455">.</span><span class="ident" id="8113456">filename</span><span class="op" id="8113464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113468">if</span>&nbsp;<span class="ident" id="8113471">err</span>&nbsp;<span class="op" id="8113475">!=</span>&nbsp;<span class="builtintype" id="8113478">nil</span>&nbsp;<span class="op" id="8113482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113487">t</span><span class="op" id="8113488">.</span><span class="ident" id="8113489">Error</span><span class="op" id="8113494">(</span><span class="ident" id="8113495">err</span><span class="op" id="8113498">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113502">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113506">testToFromWithLimit</span><span class="op" id="8113525">(</span><span class="ident" id="8113526">t</span><span class="op" id="8113527">,</span>&nbsp;<span class="ident" id="8113529">gold</span><span class="op" id="8113533">,</span>&nbsp;<span class="ident" id="8113535">test</span><span class="op" id="8113539">.</span><span class="ident" id="8113540">label</span><span class="op" id="8113545">,</span>&nbsp;<span class="ident" id="8113547">test</span><span class="op" id="8113551">.</span><span class="ident" id="8113552">limit</span><span class="op" id="8113557">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113561">if</span>&nbsp;<span class="ident" id="8113564">testing</span><span class="op" id="8113571">.</span><span class="ident" id="8113572">Short</span><span class="op" id="8113577">(</span><span class="op" id="8113578">)</span>&nbsp;<span class="op" id="8113580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113585">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113593">}</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113596">}</span><br>
<span class="lineno"></span><span class="op" id="8113598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8113601">func</span>&nbsp;<span class="ident" id="8113606">TestReaderDict</span><span class="op" id="8113620">(</span><span class="ident" id="8113621">t</span>&nbsp;<span class="op" id="8113623">*</span><span class="ident" id="8113624">testing</span><span class="op" id="8113631">.</span><span class="ident" id="8113632">T</span><span class="op" id="8113633">)</span>&nbsp;<span class="op" id="8113635">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113638">const</span>&nbsp;<span class="op" id="8113644">(</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113648">dict</span>&nbsp;<span class="op" id="8113653">=</span>&nbsp;<span class="string" id="8113655">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113671">text</span>&nbsp;<span class="op" id="8113676">=</span>&nbsp;<span class="string" id="8113678">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113702">var</span>&nbsp;<span class="ident" id="8113706">b</span>&nbsp;<span class="ident" id="8113708">bytes</span><span class="op" id="8113713">.</span><span class="ident" id="8113714">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113722">w</span><span class="op" id="8113723">,</span>&nbsp;<span class="ident" id="8113725">err</span>&nbsp;<span class="op" id="8113729">:=</span>&nbsp;<span class="ident" id="8113732">NewWriter</span><span class="op" id="8113741">(</span><span class="op" id="8113742">&amp;</span><span class="ident" id="8113743">b</span><span class="op" id="8113744">,</span>&nbsp;<span class="num" id="8113746">5</span><span class="op" id="8113747">)</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113750">if</span>&nbsp;<span class="ident" id="8113753">err</span>&nbsp;<span class="op" id="8113757">!=</span>&nbsp;<span class="builtintype" id="8113760">nil</span>&nbsp;<span class="op" id="8113764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113768">t</span><span class="op" id="8113769">.</span><span class="ident" id="8113770">Fatalf</span><span class="op" id="8113776">(</span><span class="string" id="8113777">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8113792">,</span>&nbsp;<span class="ident" id="8113794">err</span><span class="op" id="8113797">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113803">w</span><span class="op" id="8113804">.</span><span class="ident" id="8113805">Write</span><span class="op" id="8113810">(</span><span class="op" id="8113811">[</span><span class="op" id="8113812">]</span><span class="builtintype" id="8113813">byte</span><span class="op" id="8113817">(</span><span class="ident" id="8113818">dict</span><span class="op" id="8113822">)</span><span class="op" id="8113823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113826">w</span><span class="op" id="8113827">.</span><span class="ident" id="8113828">Flush</span><span class="op" id="8113833">(</span><span class="op" id="8113834">)</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113837">b</span><span class="op" id="8113838">.</span><span class="ident" id="8113839">Reset</span><span class="op" id="8113844">(</span><span class="op" id="8113845">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113848">w</span><span class="op" id="8113849">.</span><span class="ident" id="8113850">Write</span><span class="op" id="8113855">(</span><span class="op" id="8113856">[</span><span class="op" id="8113857">]</span><span class="builtintype" id="8113858">byte</span><span class="op" id="8113862">(</span><span class="ident" id="8113863">text</span><span class="op" id="8113867">)</span><span class="op" id="8113868">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113871">w</span><span class="op" id="8113872">.</span><span class="ident" id="8113873">Close</span><span class="op" id="8113878">(</span><span class="op" id="8113879">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113883">r</span>&nbsp;<span class="op" id="8113885">:=</span>&nbsp;<span class="ident" id="8113888">NewReaderDict</span><span class="op" id="8113901">(</span><span class="op" id="8113902">&amp;</span><span class="ident" id="8113903">b</span><span class="op" id="8113904">,</span>&nbsp;<span class="op" id="8113906">[</span><span class="op" id="8113907">]</span><span class="builtintype" id="8113908">byte</span><span class="op" id="8113912">(</span><span class="ident" id="8113913">dict</span><span class="op" id="8113917">)</span><span class="op" id="8113918">)</span><br>
<span class="lineno">375</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113921">data</span><span class="op" id="8113925">,</span>&nbsp;<span class="ident" id="8113927">err</span>&nbsp;<span class="op" id="8113931">:=</span>&nbsp;<span class="ident" id="8113934">ioutil</span><span class="op" id="8113940">.</span><span class="ident" id="8113941">ReadAll</span><span class="op" id="8113948">(</span><span class="ident" id="8113949">r</span><span class="op" id="8113950">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113953">if</span>&nbsp;<span class="ident" id="8113956">err</span>&nbsp;<span class="op" id="8113960">!=</span>&nbsp;<span class="builtintype" id="8113963">nil</span>&nbsp;<span class="op" id="8113967">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8113971">t</span><span class="op" id="8113972">.</span><span class="ident" id="8113973">Fatal</span><span class="op" id="8113978">(</span><span class="ident" id="8113979">err</span><span class="op" id="8113982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8113985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8113988">if</span>&nbsp;<span class="builtintype" id="8113991">string</span><span class="op" id="8113997">(</span><span class="ident" id="8113998">data</span><span class="op" id="8114002">)</span>&nbsp;<span class="op" id="8114004">!=</span>&nbsp;<span class="string" id="8114007">&#34;hello&nbsp;again&nbsp;world&#34;</span>&nbsp;<span class="op" id="8114027">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114031">t</span><span class="op" id="8114032">.</span><span class="ident" id="8114033">Fatalf</span><span class="op" id="8114039">(</span><span class="string" id="8114040">&#34;read&nbsp;returned&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8114066">,</span>&nbsp;<span class="builtintype" id="8114068">string</span><span class="op" id="8114074">(</span><span class="ident" id="8114075">data</span><span class="op" id="8114079">)</span><span class="op" id="8114080">,</span>&nbsp;<span class="ident" id="8114082">text</span><span class="op" id="8114086">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114089">}</span><br>
<span class="lineno"></span><span class="op" id="8114091">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8114094">func</span>&nbsp;<span class="ident" id="8114099">TestWriterDict</span><span class="op" id="8114113">(</span><span class="ident" id="8114114">t</span>&nbsp;<span class="op" id="8114116">*</span><span class="ident" id="8114117">testing</span><span class="op" id="8114124">.</span><span class="ident" id="8114125">T</span><span class="op" id="8114126">)</span>&nbsp;<span class="op" id="8114128">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114131">const</span>&nbsp;<span class="op" id="8114137">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114141">dict</span>&nbsp;<span class="op" id="8114146">=</span>&nbsp;<span class="string" id="8114148">&#34;hello&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114164">text</span>&nbsp;<span class="op" id="8114169">=</span>&nbsp;<span class="string" id="8114171">&#34;hello&nbsp;again&nbsp;world&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114192">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114195">var</span>&nbsp;<span class="ident" id="8114199">b</span>&nbsp;<span class="ident" id="8114201">bytes</span><span class="op" id="8114206">.</span><span class="ident" id="8114207">Buffer</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114215">w</span><span class="op" id="8114216">,</span>&nbsp;<span class="ident" id="8114218">err</span>&nbsp;<span class="op" id="8114222">:=</span>&nbsp;<span class="ident" id="8114225">NewWriter</span><span class="op" id="8114234">(</span><span class="op" id="8114235">&amp;</span><span class="ident" id="8114236">b</span><span class="op" id="8114237">,</span>&nbsp;<span class="num" id="8114239">5</span><span class="op" id="8114240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114243">if</span>&nbsp;<span class="ident" id="8114246">err</span>&nbsp;<span class="op" id="8114250">!=</span>&nbsp;<span class="builtintype" id="8114253">nil</span>&nbsp;<span class="op" id="8114257">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114261">t</span><span class="op" id="8114262">.</span><span class="ident" id="8114263">Fatalf</span><span class="op" id="8114269">(</span><span class="string" id="8114270">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8114285">,</span>&nbsp;<span class="ident" id="8114287">err</span><span class="op" id="8114290">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114293">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114296">w</span><span class="op" id="8114297">.</span><span class="ident" id="8114298">Write</span><span class="op" id="8114303">(</span><span class="op" id="8114304">[</span><span class="op" id="8114305">]</span><span class="builtintype" id="8114306">byte</span><span class="op" id="8114310">(</span><span class="ident" id="8114311">dict</span><span class="op" id="8114315">)</span><span class="op" id="8114316">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114319">w</span><span class="op" id="8114320">.</span><span class="ident" id="8114321">Flush</span><span class="op" id="8114326">(</span><span class="op" id="8114327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114330">b</span><span class="op" id="8114331">.</span><span class="ident" id="8114332">Reset</span><span class="op" id="8114337">(</span><span class="op" id="8114338">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114341">w</span><span class="op" id="8114342">.</span><span class="ident" id="8114343">Write</span><span class="op" id="8114348">(</span><span class="op" id="8114349">[</span><span class="op" id="8114350">]</span><span class="builtintype" id="8114351">byte</span><span class="op" id="8114355">(</span><span class="ident" id="8114356">text</span><span class="op" id="8114360">)</span><span class="op" id="8114361">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114364">w</span><span class="op" id="8114365">.</span><span class="ident" id="8114366">Close</span><span class="op" id="8114371">(</span><span class="op" id="8114372">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114376">var</span>&nbsp;<span class="ident" id="8114380">b1</span>&nbsp;<span class="ident" id="8114383">bytes</span><span class="op" id="8114388">.</span><span class="ident" id="8114389">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114397">w</span><span class="op" id="8114398">,</span>&nbsp;<span class="ident" id="8114400">_</span>&nbsp;<span class="op" id="8114402">=</span>&nbsp;<span class="ident" id="8114404">NewWriterDict</span><span class="op" id="8114417">(</span><span class="op" id="8114418">&amp;</span><span class="ident" id="8114419">b1</span><span class="op" id="8114421">,</span>&nbsp;<span class="num" id="8114423">5</span><span class="op" id="8114424">,</span>&nbsp;<span class="op" id="8114426">[</span><span class="op" id="8114427">]</span><span class="builtintype" id="8114428">byte</span><span class="op" id="8114432">(</span><span class="ident" id="8114433">dict</span><span class="op" id="8114437">)</span><span class="op" id="8114438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114441">w</span><span class="op" id="8114442">.</span><span class="ident" id="8114443">Write</span><span class="op" id="8114448">(</span><span class="op" id="8114449">[</span><span class="op" id="8114450">]</span><span class="builtintype" id="8114451">byte</span><span class="op" id="8114455">(</span><span class="ident" id="8114456">text</span><span class="op" id="8114460">)</span><span class="op" id="8114461">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114464">w</span><span class="op" id="8114465">.</span><span class="ident" id="8114466">Close</span><span class="op" id="8114471">(</span><span class="op" id="8114472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114476">if</span>&nbsp;<span class="op" id="8114479">!</span><span class="ident" id="8114480">bytes</span><span class="op" id="8114485">.</span><span class="ident" id="8114486">Equal</span><span class="op" id="8114491">(</span><span class="ident" id="8114492">b1</span><span class="op" id="8114494">.</span><span class="ident" id="8114495">Bytes</span><span class="op" id="8114500">(</span><span class="op" id="8114501">)</span><span class="op" id="8114502">,</span>&nbsp;<span class="ident" id="8114504">b</span><span class="op" id="8114505">.</span><span class="ident" id="8114506">Bytes</span><span class="op" id="8114511">(</span><span class="op" id="8114512">)</span><span class="op" id="8114513">)</span>&nbsp;<span class="op" id="8114515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114519">t</span><span class="op" id="8114520">.</span><span class="ident" id="8114521">Fatalf</span><span class="op" id="8114527">(</span><span class="string" id="8114528">&#34;writer&nbsp;wrote&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="8114553">,</span>&nbsp;<span class="ident" id="8114555">b1</span><span class="op" id="8114557">.</span><span class="ident" id="8114558">Bytes</span><span class="op" id="8114563">(</span><span class="op" id="8114564">)</span><span class="op" id="8114565">,</span>&nbsp;<span class="ident" id="8114567">b</span><span class="op" id="8114568">.</span><span class="ident" id="8114569">Bytes</span><span class="op" id="8114574">(</span><span class="op" id="8114575">)</span><span class="op" id="8114576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114579">}</span><br>
<span class="lineno"></span><span class="op" id="8114581">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">410</span><span class="comment" id="8114584">//&nbsp;See&nbsp;http://code.google.com/p/go/issues/detail?id=2508</span><br>
<span class="lineno"></span><span class="keyword" id="8114641">func</span>&nbsp;<span class="ident" id="8114646">TestRegression2508</span><span class="op" id="8114664">(</span><span class="ident" id="8114665">t</span>&nbsp;<span class="op" id="8114667">*</span><span class="ident" id="8114668">testing</span><span class="op" id="8114675">.</span><span class="ident" id="8114676">T</span><span class="op" id="8114677">)</span>&nbsp;<span class="op" id="8114679">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114682">if</span>&nbsp;<span class="ident" id="8114685">testing</span><span class="op" id="8114692">.</span><span class="ident" id="8114693">Short</span><span class="op" id="8114698">(</span><span class="op" id="8114699">)</span>&nbsp;<span class="op" id="8114701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114705">t</span><span class="op" id="8114706">.</span><span class="ident" id="8114707">Logf</span><span class="op" id="8114711">(</span><span class="string" id="8114712">&#34;test&nbsp;disabled&nbsp;with&nbsp;-short&#34;</span><span class="op" id="8114739">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114743">return</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114751">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114754">w</span><span class="op" id="8114755">,</span>&nbsp;<span class="ident" id="8114757">err</span>&nbsp;<span class="op" id="8114761">:=</span>&nbsp;<span class="ident" id="8114764">NewWriter</span><span class="op" id="8114773">(</span><span class="ident" id="8114774">ioutil</span><span class="op" id="8114780">.</span><span class="ident" id="8114781">Discard</span><span class="op" id="8114788">,</span>&nbsp;<span class="num" id="8114790">1</span><span class="op" id="8114791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114794">if</span>&nbsp;<span class="ident" id="8114797">err</span>&nbsp;<span class="op" id="8114801">!=</span>&nbsp;<span class="builtintype" id="8114804">nil</span>&nbsp;<span class="op" id="8114808">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114812">t</span><span class="op" id="8114813">.</span><span class="ident" id="8114814">Fatalf</span><span class="op" id="8114820">(</span><span class="string" id="8114821">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8114836">,</span>&nbsp;<span class="ident" id="8114838">err</span><span class="op" id="8114841">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114844">}</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114847">buf</span>&nbsp;<span class="op" id="8114851">:=</span>&nbsp;<span class="builtinfunc" id="8114854">make</span><span class="op" id="8114858">(</span><span class="op" id="8114859">[</span><span class="op" id="8114860">]</span><span class="builtintype" id="8114861">byte</span><span class="op" id="8114865">,</span>&nbsp;<span class="num" id="8114867">1024</span><span class="op" id="8114871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114874">for</span>&nbsp;<span class="ident" id="8114878">i</span>&nbsp;<span class="op" id="8114880">:=</span>&nbsp;<span class="num" id="8114883">0</span><span class="op" id="8114884">;</span>&nbsp;<span class="ident" id="8114886">i</span>&nbsp;<span class="op" id="8114888">&lt;</span>&nbsp;<span class="num" id="8114890">131072</span><span class="op" id="8114896">;</span>&nbsp;<span class="ident" id="8114898">i</span><span class="op" id="8114899">++</span>&nbsp;<span class="op" id="8114902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8114906">if</span>&nbsp;<span class="ident" id="8114909">_</span><span class="op" id="8114910">,</span>&nbsp;<span class="ident" id="8114912">err</span>&nbsp;<span class="op" id="8114916">:=</span>&nbsp;<span class="ident" id="8114919">w</span><span class="op" id="8114920">.</span><span class="ident" id="8114921">Write</span><span class="op" id="8114926">(</span><span class="ident" id="8114927">buf</span><span class="op" id="8114930">)</span><span class="op" id="8114931">;</span>&nbsp;<span class="ident" id="8114933">err</span>&nbsp;<span class="op" id="8114937">!=</span>&nbsp;<span class="builtintype" id="8114940">nil</span>&nbsp;<span class="op" id="8114944">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114949">t</span><span class="op" id="8114950">.</span><span class="ident" id="8114951">Fatalf</span><span class="op" id="8114957">(</span><span class="string" id="8114958">&#34;writer&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="8114977">,</span>&nbsp;<span class="ident" id="8114979">err</span><span class="op" id="8114982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114986">}</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8114989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8114992">w</span><span class="op" id="8114993">.</span><span class="ident" id="8114994">Close</span><span class="op" id="8114999">(</span><span class="op" id="8115000">)</span><br>
<span class="lineno"></span><span class="op" id="8115002">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8115005">func</span>&nbsp;<span class="ident" id="8115010">TestWriterReset</span><span class="op" id="8115025">(</span><span class="ident" id="8115026">t</span>&nbsp;<span class="op" id="8115028">*</span><span class="ident" id="8115029">testing</span><span class="op" id="8115036">.</span><span class="ident" id="8115037">T</span><span class="op" id="8115038">)</span>&nbsp;<span class="op" id="8115040">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115043">for</span>&nbsp;<span class="ident" id="8115047">level</span>&nbsp;<span class="op" id="8115053">:=</span>&nbsp;<span class="num" id="8115056">0</span><span class="op" id="8115057">;</span>&nbsp;<span class="ident" id="8115059">level</span>&nbsp;<span class="op" id="8115065">&lt;=</span>&nbsp;<span class="num" id="8115068">9</span><span class="op" id="8115069">;</span>&nbsp;<span class="ident" id="8115071">level</span><span class="op" id="8115076">++</span>&nbsp;<span class="op" id="8115079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115083">if</span>&nbsp;<span class="ident" id="8115086">testing</span><span class="op" id="8115093">.</span><span class="ident" id="8115094">Short</span><span class="op" id="8115099">(</span><span class="op" id="8115100">)</span>&nbsp;<span class="op" id="8115102">&amp;&amp;</span>&nbsp;<span class="ident" id="8115105">level</span>&nbsp;<span class="op" id="8115111">&gt;</span>&nbsp;<span class="num" id="8115113">1</span>&nbsp;<span class="op" id="8115115">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115120">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115128">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115132">w</span><span class="op" id="8115133">,</span>&nbsp;<span class="ident" id="8115135">err</span>&nbsp;<span class="op" id="8115139">:=</span>&nbsp;<span class="ident" id="8115142">NewWriter</span><span class="op" id="8115151">(</span><span class="ident" id="8115152">ioutil</span><span class="op" id="8115158">.</span><span class="ident" id="8115159">Discard</span><span class="op" id="8115166">,</span>&nbsp;<span class="ident" id="8115168">level</span><span class="op" id="8115173">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115177">if</span>&nbsp;<span class="ident" id="8115180">err</span>&nbsp;<span class="op" id="8115184">!=</span>&nbsp;<span class="builtintype" id="8115187">nil</span>&nbsp;<span class="op" id="8115191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115196">t</span><span class="op" id="8115197">.</span><span class="ident" id="8115198">Fatalf</span><span class="op" id="8115204">(</span><span class="string" id="8115205">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8115220">,</span>&nbsp;<span class="ident" id="8115222">err</span><span class="op" id="8115225">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115233">buf</span>&nbsp;<span class="op" id="8115237">:=</span>&nbsp;<span class="op" id="8115240">[</span><span class="op" id="8115241">]</span><span class="builtintype" id="8115242">byte</span><span class="op" id="8115246">(</span><span class="string" id="8115247">&#34;hello&nbsp;world&#34;</span><span class="op" id="8115260">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115264">for</span>&nbsp;<span class="ident" id="8115268">i</span>&nbsp;<span class="op" id="8115270">:=</span>&nbsp;<span class="num" id="8115273">0</span><span class="op" id="8115274">;</span>&nbsp;<span class="ident" id="8115276">i</span>&nbsp;<span class="op" id="8115278">&lt;</span>&nbsp;<span class="num" id="8115280">1024</span><span class="op" id="8115284">;</span>&nbsp;<span class="ident" id="8115286">i</span><span class="op" id="8115287">++</span>&nbsp;<span class="op" id="8115290">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115295">w</span><span class="op" id="8115296">.</span><span class="ident" id="8115297">Write</span><span class="op" id="8115302">(</span><span class="ident" id="8115303">buf</span><span class="op" id="8115306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115310">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115314">w</span><span class="op" id="8115315">.</span><span class="ident" id="8115316">Reset</span><span class="op" id="8115321">(</span><span class="ident" id="8115322">ioutil</span><span class="op" id="8115328">.</span><span class="ident" id="8115329">Discard</span><span class="op" id="8115336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115341">wref</span><span class="op" id="8115345">,</span>&nbsp;<span class="ident" id="8115347">err</span>&nbsp;<span class="op" id="8115351">:=</span>&nbsp;<span class="ident" id="8115354">NewWriter</span><span class="op" id="8115363">(</span><span class="ident" id="8115364">ioutil</span><span class="op" id="8115370">.</span><span class="ident" id="8115371">Discard</span><span class="op" id="8115378">,</span>&nbsp;<span class="ident" id="8115380">level</span><span class="op" id="8115385">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115389">if</span>&nbsp;<span class="ident" id="8115392">err</span>&nbsp;<span class="op" id="8115396">!=</span>&nbsp;<span class="builtintype" id="8115399">nil</span>&nbsp;<span class="op" id="8115403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115408">t</span><span class="op" id="8115409">.</span><span class="ident" id="8115410">Fatalf</span><span class="op" id="8115416">(</span><span class="string" id="8115417">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8115432">,</span>&nbsp;<span class="ident" id="8115434">err</span><span class="op" id="8115437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115441">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8115446">//&nbsp;DeepEqual&nbsp;doesn&#39;t&nbsp;compare&nbsp;functions.</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115488">w</span><span class="op" id="8115489">.</span><span class="ident" id="8115490">d</span><span class="op" id="8115491">.</span><span class="ident" id="8115492">fill</span><span class="op" id="8115496">,</span>&nbsp;<span class="ident" id="8115498">wref</span><span class="op" id="8115502">.</span><span class="ident" id="8115503">d</span><span class="op" id="8115504">.</span><span class="ident" id="8115505">fill</span>&nbsp;<span class="op" id="8115510">=</span>&nbsp;<span class="builtintype" id="8115512">nil</span><span class="op" id="8115515">,</span>&nbsp;<span class="builtintype" id="8115517">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115523">w</span><span class="op" id="8115524">.</span><span class="ident" id="8115525">d</span><span class="op" id="8115526">.</span><span class="ident" id="8115527">step</span><span class="op" id="8115531">,</span>&nbsp;<span class="ident" id="8115533">wref</span><span class="op" id="8115537">.</span><span class="ident" id="8115538">d</span><span class="op" id="8115539">.</span><span class="ident" id="8115540">step</span>&nbsp;<span class="op" id="8115545">=</span>&nbsp;<span class="builtintype" id="8115547">nil</span><span class="op" id="8115550">,</span>&nbsp;<span class="builtintype" id="8115552">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8115558">if</span>&nbsp;<span class="op" id="8115561">!</span><span class="ident" id="8115562">reflect</span><span class="op" id="8115569">.</span><span class="ident" id="8115570">DeepEqual</span><span class="op" id="8115579">(</span><span class="ident" id="8115580">w</span><span class="op" id="8115581">,</span>&nbsp;<span class="ident" id="8115583">wref</span><span class="op" id="8115587">)</span>&nbsp;<span class="op" id="8115589">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115594">t</span><span class="op" id="8115595">.</span><span class="ident" id="8115596">Errorf</span><span class="op" id="8115602">(</span><span class="string" id="8115603">&#34;level&nbsp;%d&nbsp;Writer&nbsp;not&nbsp;reset&nbsp;after&nbsp;Reset&#34;</span><span class="op" id="8115642">,</span>&nbsp;<span class="ident" id="8115644">level</span><span class="op" id="8115649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115653">}</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8115656">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115659">testResetOutput</span><span class="op" id="8115674">(</span><span class="ident" id="8115675">t</span><span class="op" id="8115676">,</span>&nbsp;<span class="keyword" id="8115678">func</span><span class="op" id="8115682">(</span><span class="ident" id="8115683">w</span>&nbsp;<span class="ident" id="8115685">io</span><span class="op" id="8115687">.</span><span class="ident" id="8115688">Writer</span><span class="op" id="8115694">)</span>&nbsp;<span class="op" id="8115696">(</span><span class="op" id="8115697">*</span><span class="ident" id="8115698">Writer</span><span class="op" id="8115704">,</span>&nbsp;<span class="builtintype" id="8115706">error</span><span class="op" id="8115711">)</span>&nbsp;<span class="op" id="8115713">{</span>&nbsp;<span class="keyword" id="8115715">return</span>&nbsp;<span class="ident" id="8115722">NewWriter</span><span class="op" id="8115731">(</span><span class="ident" id="8115732">w</span><span class="op" id="8115733">,</span>&nbsp;<span class="ident" id="8115735">NoCompression</span><span class="op" id="8115748">)</span>&nbsp;<span class="op" id="8115750">}</span><span class="op" id="8115751">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115754">testResetOutput</span><span class="op" id="8115769">(</span><span class="ident" id="8115770">t</span><span class="op" id="8115771">,</span>&nbsp;<span class="keyword" id="8115773">func</span><span class="op" id="8115777">(</span><span class="ident" id="8115778">w</span>&nbsp;<span class="ident" id="8115780">io</span><span class="op" id="8115782">.</span><span class="ident" id="8115783">Writer</span><span class="op" id="8115789">)</span>&nbsp;<span class="op" id="8115791">(</span><span class="op" id="8115792">*</span><span class="ident" id="8115793">Writer</span><span class="op" id="8115799">,</span>&nbsp;<span class="builtintype" id="8115801">error</span><span class="op" id="8115806">)</span>&nbsp;<span class="op" id="8115808">{</span>&nbsp;<span class="keyword" id="8115810">return</span>&nbsp;<span class="ident" id="8115817">NewWriter</span><span class="op" id="8115826">(</span><span class="ident" id="8115827">w</span><span class="op" id="8115828">,</span>&nbsp;<span class="ident" id="8115830">DefaultCompression</span><span class="op" id="8115848">)</span>&nbsp;<span class="op" id="8115850">}</span><span class="op" id="8115851">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115854">testResetOutput</span><span class="op" id="8115869">(</span><span class="ident" id="8115870">t</span><span class="op" id="8115871">,</span>&nbsp;<span class="keyword" id="8115873">func</span><span class="op" id="8115877">(</span><span class="ident" id="8115878">w</span>&nbsp;<span class="ident" id="8115880">io</span><span class="op" id="8115882">.</span><span class="ident" id="8115883">Writer</span><span class="op" id="8115889">)</span>&nbsp;<span class="op" id="8115891">(</span><span class="op" id="8115892">*</span><span class="ident" id="8115893">Writer</span><span class="op" id="8115899">,</span>&nbsp;<span class="builtintype" id="8115901">error</span><span class="op" id="8115906">)</span>&nbsp;<span class="op" id="8115908">{</span>&nbsp;<span class="keyword" id="8115910">return</span>&nbsp;<span class="ident" id="8115917">NewWriter</span><span class="op" id="8115926">(</span><span class="ident" id="8115927">w</span><span class="op" id="8115928">,</span>&nbsp;<span class="ident" id="8115930">BestCompression</span><span class="op" id="8115945">)</span>&nbsp;<span class="op" id="8115947">}</span><span class="op" id="8115948">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115951">dict</span>&nbsp;<span class="op" id="8115956">:=</span>&nbsp;<span class="op" id="8115959">[</span><span class="op" id="8115960">]</span><span class="builtintype" id="8115961">byte</span><span class="op" id="8115965">(</span><span class="string" id="8115966">&#34;we&nbsp;are&nbsp;the&nbsp;world&#34;</span><span class="op" id="8115984">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8115987">testResetOutput</span><span class="op" id="8116002">(</span><span class="ident" id="8116003">t</span><span class="op" id="8116004">,</span>&nbsp;<span class="keyword" id="8116006">func</span><span class="op" id="8116010">(</span><span class="ident" id="8116011">w</span>&nbsp;<span class="ident" id="8116013">io</span><span class="op" id="8116015">.</span><span class="ident" id="8116016">Writer</span><span class="op" id="8116022">)</span>&nbsp;<span class="op" id="8116024">(</span><span class="op" id="8116025">*</span><span class="ident" id="8116026">Writer</span><span class="op" id="8116032">,</span>&nbsp;<span class="builtintype" id="8116034">error</span><span class="op" id="8116039">)</span>&nbsp;<span class="op" id="8116041">{</span>&nbsp;<span class="keyword" id="8116043">return</span>&nbsp;<span class="ident" id="8116050">NewWriterDict</span><span class="op" id="8116063">(</span><span class="ident" id="8116064">w</span><span class="op" id="8116065">,</span>&nbsp;<span class="ident" id="8116067">NoCompression</span><span class="op" id="8116080">,</span>&nbsp;<span class="ident" id="8116082">dict</span><span class="op" id="8116086">)</span>&nbsp;<span class="op" id="8116088">}</span><span class="op" id="8116089">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116092">testResetOutput</span><span class="op" id="8116107">(</span><span class="ident" id="8116108">t</span><span class="op" id="8116109">,</span>&nbsp;<span class="keyword" id="8116111">func</span><span class="op" id="8116115">(</span><span class="ident" id="8116116">w</span>&nbsp;<span class="ident" id="8116118">io</span><span class="op" id="8116120">.</span><span class="ident" id="8116121">Writer</span><span class="op" id="8116127">)</span>&nbsp;<span class="op" id="8116129">(</span><span class="op" id="8116130">*</span><span class="ident" id="8116131">Writer</span><span class="op" id="8116137">,</span>&nbsp;<span class="builtintype" id="8116139">error</span><span class="op" id="8116144">)</span>&nbsp;<span class="op" id="8116146">{</span>&nbsp;<span class="keyword" id="8116148">return</span>&nbsp;<span class="ident" id="8116155">NewWriterDict</span><span class="op" id="8116168">(</span><span class="ident" id="8116169">w</span><span class="op" id="8116170">,</span>&nbsp;<span class="ident" id="8116172">DefaultCompression</span><span class="op" id="8116190">,</span>&nbsp;<span class="ident" id="8116192">dict</span><span class="op" id="8116196">)</span>&nbsp;<span class="op" id="8116198">}</span><span class="op" id="8116199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116202">testResetOutput</span><span class="op" id="8116217">(</span><span class="ident" id="8116218">t</span><span class="op" id="8116219">,</span>&nbsp;<span class="keyword" id="8116221">func</span><span class="op" id="8116225">(</span><span class="ident" id="8116226">w</span>&nbsp;<span class="ident" id="8116228">io</span><span class="op" id="8116230">.</span><span class="ident" id="8116231">Writer</span><span class="op" id="8116237">)</span>&nbsp;<span class="op" id="8116239">(</span><span class="op" id="8116240">*</span><span class="ident" id="8116241">Writer</span><span class="op" id="8116247">,</span>&nbsp;<span class="builtintype" id="8116249">error</span><span class="op" id="8116254">)</span>&nbsp;<span class="op" id="8116256">{</span>&nbsp;<span class="keyword" id="8116258">return</span>&nbsp;<span class="ident" id="8116265">NewWriterDict</span><span class="op" id="8116278">(</span><span class="ident" id="8116279">w</span><span class="op" id="8116280">,</span>&nbsp;<span class="ident" id="8116282">BestCompression</span><span class="op" id="8116297">,</span>&nbsp;<span class="ident" id="8116299">dict</span><span class="op" id="8116303">)</span>&nbsp;<span class="op" id="8116305">}</span><span class="op" id="8116306">)</span><br>
<span class="lineno"></span><span class="op" id="8116308">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">465</span><span class="keyword" id="8116311">func</span>&nbsp;<span class="ident" id="8116316">testResetOutput</span><span class="op" id="8116331">(</span><span class="ident" id="8116332">t</span>&nbsp;<span class="op" id="8116334">*</span><span class="ident" id="8116335">testing</span><span class="op" id="8116342">.</span><span class="ident" id="8116343">T</span><span class="op" id="8116344">,</span>&nbsp;<span class="ident" id="8116346">newWriter</span>&nbsp;<span class="keyword" id="8116356">func</span><span class="op" id="8116360">(</span><span class="ident" id="8116361">w</span>&nbsp;<span class="ident" id="8116363">io</span><span class="op" id="8116365">.</span><span class="ident" id="8116366">Writer</span><span class="op" id="8116372">)</span>&nbsp;<span class="op" id="8116374">(</span><span class="op" id="8116375">*</span><span class="ident" id="8116376">Writer</span><span class="op" id="8116382">,</span>&nbsp;<span class="builtintype" id="8116384">error</span><span class="op" id="8116389">)</span><span class="op" id="8116390">)</span>&nbsp;<span class="op" id="8116392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116395">buf</span>&nbsp;<span class="op" id="8116399">:=</span>&nbsp;<span class="builtinfunc" id="8116402">new</span><span class="op" id="8116405">(</span><span class="ident" id="8116406">bytes</span><span class="op" id="8116411">.</span><span class="ident" id="8116412">Buffer</span><span class="op" id="8116418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116421">w</span><span class="op" id="8116422">,</span>&nbsp;<span class="ident" id="8116424">err</span>&nbsp;<span class="op" id="8116428">:=</span>&nbsp;<span class="ident" id="8116431">newWriter</span><span class="op" id="8116440">(</span><span class="ident" id="8116441">buf</span><span class="op" id="8116444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116447">if</span>&nbsp;<span class="ident" id="8116450">err</span>&nbsp;<span class="op" id="8116454">!=</span>&nbsp;<span class="builtintype" id="8116457">nil</span>&nbsp;<span class="op" id="8116461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116465">t</span><span class="op" id="8116466">.</span><span class="ident" id="8116467">Fatalf</span><span class="op" id="8116473">(</span><span class="string" id="8116474">&#34;NewWriter:&nbsp;%v&#34;</span><span class="op" id="8116489">,</span>&nbsp;<span class="ident" id="8116491">err</span><span class="op" id="8116494">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116500">b</span>&nbsp;<span class="op" id="8116502">:=</span>&nbsp;<span class="op" id="8116505">[</span><span class="op" id="8116506">]</span><span class="builtintype" id="8116507">byte</span><span class="op" id="8116511">(</span><span class="string" id="8116512">&#34;hello&nbsp;world&#34;</span><span class="op" id="8116525">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116528">for</span>&nbsp;<span class="ident" id="8116532">i</span>&nbsp;<span class="op" id="8116534">:=</span>&nbsp;<span class="num" id="8116537">0</span><span class="op" id="8116538">;</span>&nbsp;<span class="ident" id="8116540">i</span>&nbsp;<span class="op" id="8116542">&lt;</span>&nbsp;<span class="num" id="8116544">1024</span><span class="op" id="8116548">;</span>&nbsp;<span class="ident" id="8116550">i</span><span class="op" id="8116551">++</span>&nbsp;<span class="op" id="8116554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116558">w</span><span class="op" id="8116559">.</span><span class="ident" id="8116560">Write</span><span class="op" id="8116565">(</span><span class="ident" id="8116566">b</span><span class="op" id="8116567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116570">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116573">w</span><span class="op" id="8116574">.</span><span class="ident" id="8116575">Close</span><span class="op" id="8116580">(</span><span class="op" id="8116581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116584">out1</span>&nbsp;<span class="op" id="8116589">:=</span>&nbsp;<span class="ident" id="8116592">buf</span><span class="op" id="8116595">.</span><span class="ident" id="8116596">String</span><span class="op" id="8116602">(</span><span class="op" id="8116603">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116607">buf2</span>&nbsp;<span class="op" id="8116612">:=</span>&nbsp;<span class="builtinfunc" id="8116615">new</span><span class="op" id="8116618">(</span><span class="ident" id="8116619">bytes</span><span class="op" id="8116624">.</span><span class="ident" id="8116625">Buffer</span><span class="op" id="8116631">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116634">w</span><span class="op" id="8116635">.</span><span class="ident" id="8116636">Reset</span><span class="op" id="8116641">(</span><span class="ident" id="8116642">buf2</span><span class="op" id="8116646">)</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116649">for</span>&nbsp;<span class="ident" id="8116653">i</span>&nbsp;<span class="op" id="8116655">:=</span>&nbsp;<span class="num" id="8116658">0</span><span class="op" id="8116659">;</span>&nbsp;<span class="ident" id="8116661">i</span>&nbsp;<span class="op" id="8116663">&lt;</span>&nbsp;<span class="num" id="8116665">1024</span><span class="op" id="8116669">;</span>&nbsp;<span class="ident" id="8116671">i</span><span class="op" id="8116672">++</span>&nbsp;<span class="op" id="8116675">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116679">w</span><span class="op" id="8116680">.</span><span class="ident" id="8116681">Write</span><span class="op" id="8116686">(</span><span class="ident" id="8116687">b</span><span class="op" id="8116688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116691">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116694">w</span><span class="op" id="8116695">.</span><span class="ident" id="8116696">Close</span><span class="op" id="8116701">(</span><span class="op" id="8116702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116705">out2</span>&nbsp;<span class="op" id="8116710">:=</span>&nbsp;<span class="ident" id="8116713">buf2</span><span class="op" id="8116717">.</span><span class="ident" id="8116718">String</span><span class="op" id="8116724">(</span><span class="op" id="8116725">)</span><br>
<span class="lineno">485</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8116729">if</span>&nbsp;<span class="ident" id="8116732">out1</span>&nbsp;<span class="op" id="8116737">!=</span>&nbsp;<span class="ident" id="8116740">out2</span>&nbsp;<span class="op" id="8116745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116749">t</span><span class="op" id="8116750">.</span><span class="ident" id="8116751">Errorf</span><span class="op" id="8116757">(</span><span class="string" id="8116758">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8116779">,</span>&nbsp;<span class="ident" id="8116781">out2</span><span class="op" id="8116785">,</span>&nbsp;<span class="ident" id="8116787">out1</span><span class="op" id="8116791">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8116794">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8116797">t</span><span class="op" id="8116798">.</span><span class="ident" id="8116799">Logf</span><span class="op" id="8116803">(</span><span class="string" id="8116804">&#34;got&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="8116818">,</span>&nbsp;<span class="builtinfunc" id="8116820">len</span><span class="op" id="8116823">(</span><span class="ident" id="8116824">out1</span><span class="op" id="8116828">)</span><span class="op" id="8116829">)</span><br>
<span class="lineno">490</span><span class="op" id="8116831">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
