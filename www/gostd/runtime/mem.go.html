<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>runtime</h2>
<ul>
<li><a href="/gostd/runtime/alg.go.html">alg.go</a></li>
<li><a href="/gostd/runtime/append_test.go.html">append_test.go</a></li>
<li><a href="/gostd/runtime/arch_amd64.go.html">arch_amd64.go</a></li>
<li><a href="/gostd/runtime/atomic.go.html">atomic.go</a></li>
<li><a href="/gostd/runtime/cgocall.go.html">cgocall.go</a></li>
<li><a href="/gostd/runtime/cgocallback.go.html">cgocallback.go</a></li>
<li><a href="/gostd/runtime/chan.go.html">chan.go</a></li>
<li><a href="/gostd/runtime/chan_test.go.html">chan_test.go</a></li>
<li><a href="/gostd/runtime/closure_test.go.html">closure_test.go</a></li>
<li><a href="/gostd/runtime/compiler.go.html">compiler.go</a></li>
<li><a href="/gostd/runtime/complex.go.html">complex.go</a></li>
<li><a href="/gostd/runtime/complex_test.go.html">complex_test.go</a></li>
<li><a href="/gostd/runtime/cpuprof.go.html">cpuprof.go</a></li>
<li><a href="/gostd/runtime/crash_test.go.html">crash_test.go</a></li>
<li><a href="/gostd/runtime/debug.go.html">debug.go</a></li>
<li><a href="/gostd/runtime/env_posix.go.html">env_posix.go</a></li>
<li><a href="/gostd/runtime/error.go.html">error.go</a></li>
<li><a href="/gostd/runtime/export_futex_test.go.html">export_futex_test.go</a></li>
<li><a href="/gostd/runtime/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/runtime/extern.go.html">extern.go</a></li>
<li><a href="/gostd/runtime/futex_test.go.html">futex_test.go</a></li>
<li><a href="/gostd/runtime/gc_test.go.html">gc_test.go</a></li>
<li><a href="/gostd/runtime/gcinfo_test.go.html">gcinfo_test.go</a></li>
<li><a href="/gostd/runtime/hash_test.go.html">hash_test.go</a></li>
<li><a href="/gostd/runtime/hashmap.go.html">hashmap.go</a></li>
<li><a href="/gostd/runtime/hashmap_fast.go.html">hashmap_fast.go</a></li>
<li><a href="/gostd/runtime/iface.go.html">iface.go</a></li>
<li><a href="/gostd/runtime/iface_test.go.html">iface_test.go</a></li>
<li><a href="/gostd/runtime/lfstack_test.go.html">lfstack_test.go</a></li>
<li><a href="/gostd/runtime/lock_futex.go.html">lock_futex.go</a></li>
<li><a href="/gostd/runtime/malloc.go.html">malloc.go</a></li>
<li><a href="/gostd/runtime/malloc_test.go.html">malloc_test.go</a></li>
<li><a href="/gostd/runtime/map_test.go.html">map_test.go</a></li>
<li><a href="/gostd/runtime/mapspeed_test.go.html">mapspeed_test.go</a></li>
<li><a href="/gostd/runtime/mem.go.html" class="current">mem.go</a></li>
<li><a href="/gostd/runtime/memmove_linux_amd64_test.go.html">memmove_linux_amd64_test.go</a></li>
<li><a href="/gostd/runtime/memmove_test.go.html">memmove_test.go</a></li>
<li><a href="/gostd/runtime/mfinal_test.go.html">mfinal_test.go</a></li>
<li><a href="/gostd/runtime/mgc0.go.html">mgc0.go</a></li>
<li><a href="/gostd/runtime/mprof.go.html">mprof.go</a></li>
<li><a href="/gostd/runtime/netpoll.go.html">netpoll.go</a></li>
<li><a href="/gostd/runtime/netpoll_epoll.go.html">netpoll_epoll.go</a></li>
<li><a href="/gostd/runtime/norace_test.go.html">norace_test.go</a></li>
<li><a href="/gostd/runtime/os_linux.go.html">os_linux.go</a></li>
<li><a href="/gostd/runtime/panic.go.html">panic.go</a></li>
<li><a href="/gostd/runtime/parfor_test.go.html">parfor_test.go</a></li>
<li><a href="/gostd/runtime/print1.go.html">print1.go</a></li>
<li><a href="/gostd/runtime/proc.go.html">proc.go</a></li>
<li><a href="/gostd/runtime/proc_test.go.html">proc_test.go</a></li>
<li><a href="/gostd/runtime/race0.go.html">race0.go</a></li>
<li><a href="/gostd/runtime/rdebug.go.html">rdebug.go</a></li>
<li><a href="/gostd/runtime/rune.go.html">rune.go</a></li>
<li><a href="/gostd/runtime/runtime.go.html">runtime.go</a></li>
<li><a href="/gostd/runtime/runtime_linux_test.go.html">runtime_linux_test.go</a></li>
<li><a href="/gostd/runtime/runtime_test.go.html">runtime_test.go</a></li>
<li><a href="/gostd/runtime/runtime_unix_test.go.html">runtime_unix_test.go</a></li>
<li><a href="/gostd/runtime/select.go.html">select.go</a></li>
<li><a href="/gostd/runtime/sema.go.html">sema.go</a></li>
<li><a href="/gostd/runtime/signal_unix.go.html">signal_unix.go</a></li>
<li><a href="/gostd/runtime/sigpanic_unix.go.html">sigpanic_unix.go</a></li>
<li><a href="/gostd/runtime/sigqueue.go.html">sigqueue.go</a></li>
<li><a href="/gostd/runtime/slice.go.html">slice.go</a></li>
<li><a href="/gostd/runtime/softfloat64.go.html">softfloat64.go</a></li>
<li><a href="/gostd/runtime/softfloat64_test.go.html">softfloat64_test.go</a></li>
<li><a href="/gostd/runtime/sqrt.go.html">sqrt.go</a></li>
<li><a href="/gostd/runtime/stack.go.html">stack.go</a></li>
<li><a href="/gostd/runtime/stack_test.go.html">stack_test.go</a></li>
<li><a href="/gostd/runtime/string.go.html">string.go</a></li>
<li><a href="/gostd/runtime/string_test.go.html">string_test.go</a></li>
<li><a href="/gostd/runtime/stubs.go.html">stubs.go</a></li>
<li><a href="/gostd/runtime/symtab.go.html">symtab.go</a></li>
<li><a href="/gostd/runtime/symtab_test.go.html">symtab_test.go</a></li>
<li><a href="/gostd/runtime/time.go.html">time.go</a></li>
<li><a href="/gostd/runtime/traceback.go.html">traceback.go</a></li>
<li><a href="/gostd/runtime/typekind.go.html">typekind.go</a></li>
<li><a href="/gostd/runtime/zgoarch_amd64.go.html">zgoarch_amd64.go</a></li>
<li><a href="/gostd/runtime/zgoos_linux.go.html">zgoos_linux.go</a></li>
<li><a href="/gostd/runtime/zruntime_defs_linux_amd64.go.html">zruntime_defs_linux_amd64.go</a></li>
<li><a href="/gostd/runtime/zversion.go.html">zversion.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="1559772">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="1559827">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="1559881">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="1559932">package</span>&nbsp;<span class="ident" id="1559940">runtime</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1559949">import</span>&nbsp;<span class="string" id="1559956">&#34;unsafe&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1559966">//&nbsp;Note:&nbsp;the&nbsp;MemStats&nbsp;struct&nbsp;should&nbsp;be&nbsp;kept&nbsp;in&nbsp;sync&nbsp;with</span><br>
<span class="lineno">10</span><span class="comment" id="1560023">//&nbsp;struct&nbsp;MStats&nbsp;in&nbsp;malloc.h</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1560053">//&nbsp;A&nbsp;MemStats&nbsp;records&nbsp;statistics&nbsp;about&nbsp;the&nbsp;memory&nbsp;allocator.</span><br>
<span class="lineno"></span><span class="keyword" id="1560114">type</span>&nbsp;<span class="ident" id="1560119">MemStats</span>&nbsp;<span class="keyword" id="1560128">struct</span>&nbsp;<span class="op" id="1560135">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1560138">//&nbsp;General&nbsp;statistics.</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560162">Alloc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560173">uint64</span>&nbsp;<span class="comment" id="1560180">//&nbsp;bytes&nbsp;allocated&nbsp;and&nbsp;still&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560217">TotalAlloc</span>&nbsp;<span class="ident" id="1560228">uint64</span>&nbsp;<span class="comment" id="1560235">//&nbsp;bytes&nbsp;allocated&nbsp;(even&nbsp;if&nbsp;freed)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560271">Sys</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560282">uint64</span>&nbsp;<span class="comment" id="1560289">//&nbsp;bytes&nbsp;obtained&nbsp;from&nbsp;system&nbsp;(sum&nbsp;of&nbsp;XxxSys&nbsp;below)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560342">Lookups</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560353">uint64</span>&nbsp;<span class="comment" id="1560360">//&nbsp;number&nbsp;of&nbsp;pointer&nbsp;lookups</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560390">Mallocs</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560401">uint64</span>&nbsp;<span class="comment" id="1560408">//&nbsp;number&nbsp;of&nbsp;mallocs</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560430">Frees</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560441">uint64</span>&nbsp;<span class="comment" id="1560448">//&nbsp;number&nbsp;of&nbsp;frees</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1560469">//&nbsp;Main&nbsp;allocation&nbsp;heap&nbsp;statistics.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560506">HeapAlloc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560519">uint64</span>&nbsp;<span class="comment" id="1560526">//&nbsp;bytes&nbsp;allocated&nbsp;and&nbsp;still&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560563">HeapSys</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560576">uint64</span>&nbsp;<span class="comment" id="1560583">//&nbsp;bytes&nbsp;obtained&nbsp;from&nbsp;system</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560614">HeapIdle</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560627">uint64</span>&nbsp;<span class="comment" id="1560634">//&nbsp;bytes&nbsp;in&nbsp;idle&nbsp;spans</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560658">HeapInuse</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560671">uint64</span>&nbsp;<span class="comment" id="1560678">//&nbsp;bytes&nbsp;in&nbsp;non-idle&nbsp;span</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560705">HeapReleased</span>&nbsp;<span class="ident" id="1560718">uint64</span>&nbsp;<span class="comment" id="1560725">//&nbsp;bytes&nbsp;released&nbsp;to&nbsp;the&nbsp;OS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560754">HeapObjects</span>&nbsp;&nbsp;<span class="ident" id="1560767">uint64</span>&nbsp;<span class="comment" id="1560774">//&nbsp;total&nbsp;number&nbsp;of&nbsp;allocated&nbsp;objects</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1560813">//&nbsp;Low-level&nbsp;fixed-size&nbsp;structure&nbsp;allocator&nbsp;statistics.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1560870">//&nbsp;&nbsp;&nbsp;&nbsp;Inuse&nbsp;is&nbsp;bytes&nbsp;used&nbsp;now.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1560899">//&nbsp;&nbsp;&nbsp;&nbsp;Sys&nbsp;is&nbsp;bytes&nbsp;obtained&nbsp;from&nbsp;system.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560938">StackInuse</span>&nbsp;&nbsp;<span class="ident" id="1560950">uint64</span>&nbsp;<span class="comment" id="1560957">//&nbsp;bytes&nbsp;used&nbsp;by&nbsp;stack&nbsp;allocator</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1560991">StackSys</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561003">uint64</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561011">MSpanInuse</span>&nbsp;&nbsp;<span class="ident" id="1561023">uint64</span>&nbsp;<span class="comment" id="1561030">//&nbsp;mspan&nbsp;structures</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561051">MSpanSys</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561063">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561071">MCacheInuse</span>&nbsp;<span class="ident" id="1561083">uint64</span>&nbsp;<span class="comment" id="1561090">//&nbsp;mcache&nbsp;structures</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561112">MCacheSys</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1561124">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561132">BuckHashSys</span>&nbsp;<span class="ident" id="1561144">uint64</span>&nbsp;<span class="comment" id="1561151">//&nbsp;profiling&nbsp;bucket&nbsp;hash&nbsp;table</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561183">GCSys</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561195">uint64</span>&nbsp;<span class="comment" id="1561202">//&nbsp;GC&nbsp;metadata</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561218">OtherSys</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561230">uint64</span>&nbsp;<span class="comment" id="1561237">//&nbsp;other&nbsp;system&nbsp;allocations</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1561267">//&nbsp;Garbage&nbsp;collector&nbsp;statistics.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561301">NextGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561314">uint64</span>&nbsp;<span class="comment" id="1561321">//&nbsp;next&nbsp;collection&nbsp;will&nbsp;happen&nbsp;when&nbsp;HeapAlloc&nbsp;â‰¥&nbsp;this&nbsp;amount</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561384">LastGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561397">uint64</span>&nbsp;<span class="comment" id="1561404">//&nbsp;end&nbsp;time&nbsp;of&nbsp;last&nbsp;collection&nbsp;(nanoseconds&nbsp;since&nbsp;1970)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561461">PauseTotalNs</span>&nbsp;<span class="ident" id="1561474">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561482">PauseNs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1561495">[</span><span class="num" id="1561496">256</span><span class="op" id="1561499">]</span><span class="ident" id="1561500">uint64</span>&nbsp;<span class="comment" id="1561507">//&nbsp;circular&nbsp;buffer&nbsp;of&nbsp;recent&nbsp;GC&nbsp;pause&nbsp;durations,&nbsp;most&nbsp;recent&nbsp;at&nbsp;[(NumGC+255)%256]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561590">PauseEnd</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1561603">[</span><span class="num" id="1561604">256</span><span class="op" id="1561607">]</span><span class="ident" id="1561608">uint64</span>&nbsp;<span class="comment" id="1561615">//&nbsp;circular&nbsp;buffer&nbsp;of&nbsp;recent&nbsp;GC&nbsp;pause&nbsp;end&nbsp;times</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561664">NumGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1561677">uint32</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561685">EnableGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1561698">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561704">DebugGC</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1561717">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1561724">//&nbsp;Per-size&nbsp;allocation&nbsp;statistics.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1561760">//&nbsp;61&nbsp;is&nbsp;NumSizeClasses&nbsp;in&nbsp;the&nbsp;C&nbsp;code.</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561800">BySize</span>&nbsp;<span class="op" id="1561807">[</span><span class="num" id="1561808">61</span><span class="op" id="1561810">]</span><span class="keyword" id="1561811">struct</span>&nbsp;<span class="op" id="1561818">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561822">Size</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="1561830">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561839">Mallocs</span>&nbsp;<span class="ident" id="1561847">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1561856">Frees</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="1561864">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1561872">}</span><br>
<span class="lineno">60</span><span class="op" id="1561874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1561877">var</span>&nbsp;<span class="ident" id="1561881">sizeof_C_MStats</span>&nbsp;<span class="builtintype" id="1561897">uintptr</span>&nbsp;<span class="comment" id="1561905">//&nbsp;filled&nbsp;in&nbsp;by&nbsp;malloc.goc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="1561933">func</span>&nbsp;<span class="ident" id="1561938">init</span><span class="op" id="1561942">(</span><span class="op" id="1561943">)</span>&nbsp;<span class="op" id="1561945">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561948">var</span>&nbsp;<span class="ident" id="1561952">memStats</span>&nbsp;<span class="ident" id="1561961">MemStats</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="1561971">if</span>&nbsp;<span class="ident" id="1561974">sizeof_C_MStats</span>&nbsp;<span class="op" id="1561990">!=</span>&nbsp;<span class="ident" id="1561993">unsafe</span><span class="op" id="1561999">.</span><span class="ident" id="1562000">Sizeof</span><span class="op" id="1562006">(</span><span class="ident" id="1562007">memStats</span><span class="op" id="1562015">)</span>&nbsp;<span class="op" id="1562017">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="1562021">println</span><span class="op" id="1562028">(</span><span class="ident" id="1562029">sizeof_C_MStats</span><span class="op" id="1562044">,</span>&nbsp;<span class="ident" id="1562046">unsafe</span><span class="op" id="1562052">.</span><span class="ident" id="1562053">Sizeof</span><span class="op" id="1562059">(</span><span class="ident" id="1562060">memStats</span><span class="op" id="1562068">)</span><span class="op" id="1562069">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562073">gothrow</span><span class="op" id="1562080">(</span><span class="string" id="1562081">&#34;MStats&nbsp;vs&nbsp;MemStatsType&nbsp;size&nbsp;mismatch&#34;</span><span class="op" id="1562119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="1562122">}</span><br>
<span class="lineno">70</span><span class="op" id="1562124">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1562127">//&nbsp;ReadMemStats&nbsp;populates&nbsp;m&nbsp;with&nbsp;memory&nbsp;allocator&nbsp;statistics.</span><br>
<span class="lineno"></span><span class="keyword" id="1562189">func</span>&nbsp;<span class="ident" id="1562194">ReadMemStats</span><span class="op" id="1562206">(</span><span class="ident" id="1562207">m</span>&nbsp;<span class="op" id="1562209">*</span><span class="ident" id="1562210">MemStats</span><span class="op" id="1562218">)</span>&nbsp;<span class="op" id="1562220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1562223">//&nbsp;Have&nbsp;to&nbsp;acquire&nbsp;worldsema&nbsp;to&nbsp;stop&nbsp;the&nbsp;world,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1562272">//&nbsp;because&nbsp;stoptheworld&nbsp;can&nbsp;only&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1562317">//&nbsp;one&nbsp;goroutine&nbsp;at&nbsp;a&nbsp;time,&nbsp;and&nbsp;there&nbsp;might&nbsp;be</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="1562365">//&nbsp;a&nbsp;pending&nbsp;garbage&nbsp;collection&nbsp;already&nbsp;calling&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562418">semacquire</span><span class="op" id="1562428">(</span><span class="op" id="1562429">&amp;</span><span class="ident" id="1562430">worldsema</span><span class="op" id="1562439">,</span>&nbsp;<span class="builtintype" id="1562441">false</span><span class="op" id="1562446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562449">gp</span>&nbsp;<span class="op" id="1562452">:=</span>&nbsp;<span class="ident" id="1562455">getg</span><span class="op" id="1562459">(</span><span class="op" id="1562460">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562463">gp</span><span class="op" id="1562465">.</span><span class="ident" id="1562466">m</span><span class="op" id="1562467">.</span><span class="ident" id="1562468">gcing</span>&nbsp;<span class="op" id="1562474">=</span>&nbsp;<span class="num" id="1562476">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562479">onM</span><span class="op" id="1562482">(</span><span class="ident" id="1562483">stoptheworld</span><span class="op" id="1562495">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562499">gp</span><span class="op" id="1562501">.</span><span class="ident" id="1562502">m</span><span class="op" id="1562503">.</span><span class="ident" id="1562504">ptrarg</span><span class="op" id="1562510">[</span><span class="num" id="1562511">0</span><span class="op" id="1562512">]</span>&nbsp;<span class="op" id="1562514">=</span>&nbsp;<span class="ident" id="1562516">noescape</span><span class="op" id="1562524">(</span><span class="ident" id="1562525">unsafe</span><span class="op" id="1562531">.</span><span class="ident" id="1562532">Pointer</span><span class="op" id="1562539">(</span><span class="ident" id="1562540">m</span><span class="op" id="1562541">)</span><span class="op" id="1562542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562545">onM</span><span class="op" id="1562548">(</span><span class="ident" id="1562549">readmemstats_m</span><span class="op" id="1562563">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562567">gp</span><span class="op" id="1562569">.</span><span class="ident" id="1562570">m</span><span class="op" id="1562571">.</span><span class="ident" id="1562572">gcing</span>&nbsp;<span class="op" id="1562578">=</span>&nbsp;<span class="num" id="1562580">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562583">gp</span><span class="op" id="1562585">.</span><span class="ident" id="1562586">m</span><span class="op" id="1562587">.</span><span class="ident" id="1562588">locks</span><span class="op" id="1562593">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562597">semrelease</span><span class="op" id="1562607">(</span><span class="op" id="1562608">&amp;</span><span class="ident" id="1562609">worldsema</span><span class="op" id="1562618">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562621">onM</span><span class="op" id="1562624">(</span><span class="ident" id="1562625">starttheworld</span><span class="op" id="1562638">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562641">gp</span><span class="op" id="1562643">.</span><span class="ident" id="1562644">m</span><span class="op" id="1562645">.</span><span class="ident" id="1562646">locks</span><span class="op" id="1562651">--</span><br>
<span class="lineno"></span><span class="op" id="1562654">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="1562657">//&nbsp;Implementation&nbsp;of&nbsp;runtime/debug.WriteHeapDump</span><br>
<span class="lineno"></span><span class="keyword" id="1562706">func</span>&nbsp;<span class="ident" id="1562711">writeHeapDump</span><span class="op" id="1562724">(</span><span class="ident" id="1562725">fd</span>&nbsp;<span class="builtintype" id="1562728">uintptr</span><span class="op" id="1562735">)</span>&nbsp;<span class="op" id="1562737">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562740">semacquire</span><span class="op" id="1562750">(</span><span class="op" id="1562751">&amp;</span><span class="ident" id="1562752">worldsema</span><span class="op" id="1562761">,</span>&nbsp;<span class="builtintype" id="1562763">false</span><span class="op" id="1562768">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562771">gp</span>&nbsp;<span class="op" id="1562774">:=</span>&nbsp;<span class="ident" id="1562777">getg</span><span class="op" id="1562781">(</span><span class="op" id="1562782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562785">gp</span><span class="op" id="1562787">.</span><span class="ident" id="1562788">m</span><span class="op" id="1562789">.</span><span class="ident" id="1562790">gcing</span>&nbsp;<span class="op" id="1562796">=</span>&nbsp;<span class="num" id="1562798">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562801">onM</span><span class="op" id="1562804">(</span><span class="ident" id="1562805">stoptheworld</span><span class="op" id="1562817">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562821">gp</span><span class="op" id="1562823">.</span><span class="ident" id="1562824">m</span><span class="op" id="1562825">.</span><span class="ident" id="1562826">scalararg</span><span class="op" id="1562835">[</span><span class="num" id="1562836">0</span><span class="op" id="1562837">]</span>&nbsp;<span class="op" id="1562839">=</span>&nbsp;<span class="ident" id="1562841">fd</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562845">onM</span><span class="op" id="1562848">(</span><span class="ident" id="1562849">writeheapdump_m</span><span class="op" id="1562864">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562868">gp</span><span class="op" id="1562870">.</span><span class="ident" id="1562871">m</span><span class="op" id="1562872">.</span><span class="ident" id="1562873">gcing</span>&nbsp;<span class="op" id="1562879">=</span>&nbsp;<span class="num" id="1562881">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562884">gp</span><span class="op" id="1562886">.</span><span class="ident" id="1562887">m</span><span class="op" id="1562888">.</span><span class="ident" id="1562889">locks</span><span class="op" id="1562894">++</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562898">semrelease</span><span class="op" id="1562908">(</span><span class="op" id="1562909">&amp;</span><span class="ident" id="1562910">worldsema</span><span class="op" id="1562919">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562922">onM</span><span class="op" id="1562925">(</span><span class="ident" id="1562926">starttheworld</span><span class="op" id="1562939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="1562942">gp</span><span class="op" id="1562944">.</span><span class="ident" id="1562945">m</span><span class="op" id="1562946">.</span><span class="ident" id="1562947">locks</span><span class="op" id="1562952">--</span><br>
<span class="lineno"></span><span class="op" id="1562955">}</span>
</div>
</body>
</html>
