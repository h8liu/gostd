<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/pem</h2>
<ul>
<li><a href="/gostd/encoding/pem/pem.go.html">pem.go</a></li>
<li><a href="/gostd/encoding/pem/pem_test.go.html">pem_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3887646">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3887701">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3887755">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3887806">//&nbsp;Package&nbsp;pem&nbsp;implements&nbsp;the&nbsp;PEM&nbsp;data&nbsp;encoding,&nbsp;which&nbsp;originated&nbsp;in&nbsp;Privacy</span><br>
<span class="lineno"></span><span class="comment" id="3887883">//&nbsp;Enhanced&nbsp;Mail.&nbsp;The&nbsp;most&nbsp;common&nbsp;use&nbsp;of&nbsp;PEM&nbsp;encoding&nbsp;today&nbsp;is&nbsp;in&nbsp;TLS&nbsp;keys&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3887962">//&nbsp;certificates.&nbsp;See&nbsp;RFC&nbsp;1421.</span><br>
<span class="lineno"></span><span class="keyword" id="3887993">package</span>&nbsp;<span class="ident" id="3888001">pem</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="3888006">import</span>&nbsp;<span class="op" id="3888013">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3888016">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3888025">&#34;encoding/base64&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3888044">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3888050">&#34;sort&#34;</span><br>
<span class="lineno">15</span><span class="op" id="3888057">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3888060">//&nbsp;A&nbsp;Block&nbsp;represents&nbsp;a&nbsp;PEM&nbsp;encoded&nbsp;structure.</span><br>
<span class="lineno"></span><span class="comment" id="3888107">//</span><br>
<span class="lineno"></span><span class="comment" id="3888110">//&nbsp;The&nbsp;encoded&nbsp;form&nbsp;is:</span><br>
<span class="lineno">20</span><span class="comment" id="3888134">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="3888161">//&nbsp;&nbsp;&nbsp;&nbsp;Headers</span><br>
<span class="lineno"></span><span class="comment" id="3888175">//&nbsp;&nbsp;&nbsp;&nbsp;base64-encoded&nbsp;Bytes</span><br>
<span class="lineno"></span><span class="comment" id="3888202">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;Type-----</span><br>
<span class="lineno"></span><span class="comment" id="3888227">//&nbsp;where&nbsp;Headers&nbsp;is&nbsp;a&nbsp;possibly&nbsp;empty&nbsp;sequence&nbsp;of&nbsp;Key:&nbsp;Value&nbsp;lines.</span><br>
<span class="lineno">25</span><span class="keyword" id="3888294">type</span>&nbsp;<span class="ident" id="3888299">Block</span>&nbsp;<span class="keyword" id="3888305">struct</span>&nbsp;<span class="op" id="3888312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888315">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3888323">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3888341">//&nbsp;The&nbsp;type,&nbsp;taken&nbsp;from&nbsp;the&nbsp;preamble&nbsp;(i.e.&nbsp;&#34;RSA&nbsp;PRIVATE&nbsp;KEY&#34;).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888405">Headers</span>&nbsp;<span class="keyword" id="3888413">map</span><span class="op" id="3888416">[</span><span class="builtintype" id="3888417">string</span><span class="op" id="3888423">]</span><span class="builtintype" id="3888424">string</span>&nbsp;<span class="comment" id="3888431">//&nbsp;Optional&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888453">Bytes</span>&nbsp;&nbsp;&nbsp;<span class="op" id="3888461">[</span><span class="op" id="3888462">]</span><span class="builtintype" id="3888463">byte</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="3888479">//&nbsp;The&nbsp;decoded&nbsp;bytes&nbsp;of&nbsp;the&nbsp;contents.&nbsp;Typically&nbsp;a&nbsp;DER&nbsp;encoded&nbsp;ASN.1&nbsp;structure.</span><br>
<span class="lineno"></span><span class="op" id="3888558">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span><span class="comment" id="3888561">//&nbsp;getLine&nbsp;results&nbsp;the&nbsp;first&nbsp;\r\n&nbsp;or&nbsp;\n&nbsp;delineated&nbsp;line&nbsp;from&nbsp;the&nbsp;given&nbsp;byte</span><br>
<span class="lineno"></span><span class="comment" id="3888637">//&nbsp;array.&nbsp;The&nbsp;line&nbsp;does&nbsp;not&nbsp;include&nbsp;trailing&nbsp;whitespace&nbsp;or&nbsp;the&nbsp;trailing&nbsp;new</span><br>
<span class="lineno"></span><span class="comment" id="3888713">//&nbsp;line&nbsp;bytes.&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;byte&nbsp;array&nbsp;(also&nbsp;not&nbsp;including&nbsp;the&nbsp;new&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="3888793">//&nbsp;bytes)&nbsp;is&nbsp;also&nbsp;returned&nbsp;and&nbsp;this&nbsp;will&nbsp;always&nbsp;be&nbsp;smaller&nbsp;than&nbsp;the&nbsp;original</span><br>
<span class="lineno">35</span><span class="comment" id="3888870">//&nbsp;argument.</span><br>
<span class="lineno"></span><span class="keyword" id="3888883">func</span>&nbsp;<span class="ident" id="3888888">getLine</span><span class="op" id="3888895">(</span><span class="ident" id="3888896">data</span>&nbsp;<span class="op" id="3888901">[</span><span class="op" id="3888902">]</span><span class="builtintype" id="3888903">byte</span><span class="op" id="3888907">)</span>&nbsp;<span class="op" id="3888909">(</span><span class="ident" id="3888910">line</span><span class="op" id="3888914">,</span>&nbsp;<span class="ident" id="3888916">rest</span>&nbsp;<span class="op" id="3888921">[</span><span class="op" id="3888922">]</span><span class="builtintype" id="3888923">byte</span><span class="op" id="3888927">)</span>&nbsp;<span class="op" id="3888929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888932">i</span>&nbsp;<span class="op" id="3888934">:=</span>&nbsp;<span class="ident" id="3888937">bytes</span><span class="op" id="3888942">.</span><span class="ident" id="3888943">Index</span><span class="op" id="3888948">(</span><span class="ident" id="3888949">data</span><span class="op" id="3888953">,</span>&nbsp;<span class="op" id="3888955">[</span><span class="op" id="3888956">]</span><span class="builtintype" id="3888957">byte</span><span class="op" id="3888961">{</span><span class="string" id="3888962">&#39;\n&#39;</span><span class="op" id="3888966">}</span><span class="op" id="3888967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888970">var</span>&nbsp;<span class="ident" id="3888974">j</span>&nbsp;<span class="builtintype" id="3888976">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3888981">if</span>&nbsp;<span class="ident" id="3888984">i</span>&nbsp;<span class="op" id="3888986">&lt;</span>&nbsp;<span class="num" id="3888988">0</span>&nbsp;<span class="op" id="3888990">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3888994">i</span>&nbsp;<span class="op" id="3888996">=</span>&nbsp;<span class="builtinfunc" id="3888998">len</span><span class="op" id="3889001">(</span><span class="ident" id="3889002">data</span><span class="op" id="3889006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889010">j</span>&nbsp;<span class="op" id="3889012">=</span>&nbsp;<span class="ident" id="3889014">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3889017">}</span>&nbsp;<span class="keyword" id="3889019">else</span>&nbsp;<span class="op" id="3889024">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889028">j</span>&nbsp;<span class="op" id="3889030">=</span>&nbsp;<span class="ident" id="3889032">i</span>&nbsp;<span class="op" id="3889034">+</span>&nbsp;<span class="num" id="3889036">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889040">if</span>&nbsp;<span class="ident" id="3889043">i</span>&nbsp;<span class="op" id="3889045">&gt;</span>&nbsp;<span class="num" id="3889047">0</span>&nbsp;<span class="op" id="3889049">&amp;&amp;</span>&nbsp;<span class="ident" id="3889052">data</span><span class="op" id="3889056">[</span><span class="ident" id="3889057">i</span><span class="op" id="3889058">-</span><span class="num" id="3889059">1</span><span class="op" id="3889060">]</span>&nbsp;<span class="op" id="3889062">==</span>&nbsp;<span class="string" id="3889065">&#39;\r&#39;</span>&nbsp;<span class="op" id="3889070">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889075">i</span><span class="op" id="3889076">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3889081">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3889084">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889087">return</span>&nbsp;<span class="ident" id="3889094">bytes</span><span class="op" id="3889099">.</span><span class="ident" id="3889100">TrimRight</span><span class="op" id="3889109">(</span><span class="ident" id="3889110">data</span><span class="op" id="3889114">[</span><span class="num" id="3889115">0</span><span class="op" id="3889116">:</span><span class="ident" id="3889117">i</span><span class="op" id="3889118">]</span><span class="op" id="3889119">,</span>&nbsp;<span class="string" id="3889121">&#34;&nbsp;\t&#34;</span><span class="op" id="3889126">)</span><span class="op" id="3889127">,</span>&nbsp;<span class="ident" id="3889129">data</span><span class="op" id="3889133">[</span><span class="ident" id="3889134">j</span><span class="op" id="3889135">:</span><span class="op" id="3889136">]</span><br>
<span class="lineno"></span><span class="op" id="3889138">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="comment" id="3889141">//&nbsp;removeWhitespace&nbsp;returns&nbsp;a&nbsp;copy&nbsp;of&nbsp;its&nbsp;input&nbsp;with&nbsp;all&nbsp;spaces,&nbsp;tab&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="3889214">//&nbsp;newline&nbsp;characters&nbsp;removed.</span><br>
<span class="lineno"></span><span class="keyword" id="3889245">func</span>&nbsp;<span class="ident" id="3889250">removeWhitespace</span><span class="op" id="3889266">(</span><span class="ident" id="3889267">data</span>&nbsp;<span class="op" id="3889272">[</span><span class="op" id="3889273">]</span><span class="builtintype" id="3889274">byte</span><span class="op" id="3889278">)</span>&nbsp;<span class="op" id="3889280">[</span><span class="op" id="3889281">]</span><span class="builtintype" id="3889282">byte</span>&nbsp;<span class="op" id="3889287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889290">result</span>&nbsp;<span class="op" id="3889297">:=</span>&nbsp;<span class="builtinfunc" id="3889300">make</span><span class="op" id="3889304">(</span><span class="op" id="3889305">[</span><span class="op" id="3889306">]</span><span class="builtintype" id="3889307">byte</span><span class="op" id="3889311">,</span>&nbsp;<span class="builtinfunc" id="3889313">len</span><span class="op" id="3889316">(</span><span class="ident" id="3889317">data</span><span class="op" id="3889321">)</span><span class="op" id="3889322">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889325">n</span>&nbsp;<span class="op" id="3889327">:=</span>&nbsp;<span class="num" id="3889330">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889334">for</span>&nbsp;<span class="ident" id="3889338">_</span><span class="op" id="3889339">,</span>&nbsp;<span class="ident" id="3889341">b</span>&nbsp;<span class="op" id="3889343">:=</span>&nbsp;<span class="keyword" id="3889346">range</span>&nbsp;<span class="ident" id="3889352">data</span>&nbsp;<span class="op" id="3889357">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889361">if</span>&nbsp;<span class="ident" id="3889364">b</span>&nbsp;<span class="op" id="3889366">==</span>&nbsp;<span class="string" id="3889369">&#39;&nbsp;&#39;</span>&nbsp;<span class="op" id="3889373">||</span>&nbsp;<span class="ident" id="3889376">b</span>&nbsp;<span class="op" id="3889378">==</span>&nbsp;<span class="string" id="3889381">&#39;\t&#39;</span>&nbsp;<span class="op" id="3889386">||</span>&nbsp;<span class="ident" id="3889389">b</span>&nbsp;<span class="op" id="3889391">==</span>&nbsp;<span class="string" id="3889394">&#39;\r&#39;</span>&nbsp;<span class="op" id="3889399">||</span>&nbsp;<span class="ident" id="3889402">b</span>&nbsp;<span class="op" id="3889404">==</span>&nbsp;<span class="string" id="3889407">&#39;\n&#39;</span>&nbsp;<span class="op" id="3889412">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889417">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3889428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889432">result</span><span class="op" id="3889438">[</span><span class="ident" id="3889439">n</span><span class="op" id="3889440">]</span>&nbsp;<span class="op" id="3889442">=</span>&nbsp;<span class="ident" id="3889444">b</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3889448">n</span><span class="op" id="3889449">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3889453">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3889457">return</span>&nbsp;<span class="ident" id="3889464">result</span><span class="op" id="3889470">[</span><span class="num" id="3889471">0</span><span class="op" id="3889472">:</span><span class="ident" id="3889473">n</span><span class="op" id="3889474">]</span><br>
<span class="lineno"></span><span class="op" id="3889476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3889479">var</span>&nbsp;<span class="ident" id="3889483">pemStart</span>&nbsp;<span class="op" id="3889492">=</span>&nbsp;<span class="op" id="3889494">[</span><span class="op" id="3889495">]</span><span class="builtintype" id="3889496">byte</span><span class="op" id="3889500">(</span><span class="string" id="3889501">&#34;\n-----BEGIN&nbsp;&#34;</span><span class="op" id="3889516">)</span><br>
<span class="lineno"></span><span class="keyword" id="3889518">var</span>&nbsp;<span class="ident" id="3889522">pemEnd</span>&nbsp;<span class="op" id="3889529">=</span>&nbsp;<span class="op" id="3889531">[</span><span class="op" id="3889532">]</span><span class="builtintype" id="3889533">byte</span><span class="op" id="3889537">(</span><span class="string" id="3889538">&#34;\n-----END&nbsp;&#34;</span><span class="op" id="3889551">)</span><br>
<span class="lineno">70</span><span class="keyword" id="3889553">var</span>&nbsp;<span class="ident" id="3889557">pemEndOfLine</span>&nbsp;<span class="op" id="3889570">=</span>&nbsp;<span class="op" id="3889572">[</span><span class="op" id="3889573">]</span><span class="builtintype" id="3889574">byte</span><span class="op" id="3889578">(</span><span class="string" id="3889579">&#34;-----&#34;</span><span class="op" id="3889586">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3889589">//&nbsp;Decode&nbsp;will&nbsp;find&nbsp;the&nbsp;next&nbsp;PEM&nbsp;formatted&nbsp;block&nbsp;(certificate,&nbsp;private&nbsp;key</span><br>
<span class="lineno"></span><span class="comment" id="3889664">//&nbsp;etc)&nbsp;in&nbsp;the&nbsp;input.&nbsp;It&nbsp;returns&nbsp;that&nbsp;block&nbsp;and&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;input.&nbsp;If</span><br>
<span class="lineno"></span><span class="comment" id="3889743">//&nbsp;no&nbsp;PEM&nbsp;data&nbsp;is&nbsp;found,&nbsp;p&nbsp;is&nbsp;nil&nbsp;and&nbsp;the&nbsp;whole&nbsp;of&nbsp;the&nbsp;input&nbsp;is&nbsp;returned&nbsp;in</span><br>
<span class="lineno">75</span><span class="comment" id="3889819">//&nbsp;rest.</span><br>
<span class="lineno"></span><span class="keyword" id="3889828">func</span>&nbsp;<span class="ident" id="3889833">Decode</span><span class="op" id="3889839">(</span><span class="ident" id="3889840">data</span>&nbsp;<span class="op" id="3889845">[</span><span class="op" id="3889846">]</span><span class="builtintype" id="3889847">byte</span><span class="op" id="3889851">)</span>&nbsp;<span class="op" id="3889853">(</span><span class="ident" id="3889854">p</span>&nbsp;<span class="op" id="3889856">*</span><span class="ident" id="3889857">Block</span><span class="op" id="3889862">,</span>&nbsp;<span class="ident" id="3889864">rest</span>&nbsp;<span class="op" id="3889869">[</span><span class="op" id="3889870">]</span><span class="builtintype" id="3889871">byte</span><span class="op" id="3889875">)</span>&nbsp;<span class="op" id="3889877">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3889880">//&nbsp;pemStart&nbsp;begins&nbsp;with&nbsp;a&nbsp;newline.&nbsp;However,&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3889950">//&nbsp;the&nbsp;byte&nbsp;array,&nbsp;we&#39;ll&nbsp;accept&nbsp;the&nbsp;start&nbsp;string&nbsp;without&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890012">rest</span>&nbsp;<span class="op" id="3890017">=</span>&nbsp;<span class="ident" id="3890019">data</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890025">if</span>&nbsp;<span class="ident" id="3890028">bytes</span><span class="op" id="3890033">.</span><span class="ident" id="3890034">HasPrefix</span><span class="op" id="3890043">(</span><span class="ident" id="3890044">data</span><span class="op" id="3890048">,</span>&nbsp;<span class="ident" id="3890050">pemStart</span><span class="op" id="3890058">[</span><span class="num" id="3890059">1</span><span class="op" id="3890060">:</span><span class="op" id="3890061">]</span><span class="op" id="3890062">)</span>&nbsp;<span class="op" id="3890064">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890068">rest</span>&nbsp;<span class="op" id="3890073">=</span>&nbsp;<span class="ident" id="3890075">rest</span><span class="op" id="3890079">[</span><span class="builtinfunc" id="3890080">len</span><span class="op" id="3890083">(</span><span class="ident" id="3890084">pemStart</span><span class="op" id="3890092">)</span><span class="op" id="3890093">-</span><span class="num" id="3890094">1</span>&nbsp;<span class="op" id="3890096">:</span>&nbsp;<span class="builtinfunc" id="3890098">len</span><span class="op" id="3890101">(</span><span class="ident" id="3890102">data</span><span class="op" id="3890106">)</span><span class="op" id="3890107">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890110">}</span>&nbsp;<span class="keyword" id="3890112">else</span>&nbsp;<span class="keyword" id="3890117">if</span>&nbsp;<span class="ident" id="3890120">i</span>&nbsp;<span class="op" id="3890122">:=</span>&nbsp;<span class="ident" id="3890125">bytes</span><span class="op" id="3890130">.</span><span class="ident" id="3890131">Index</span><span class="op" id="3890136">(</span><span class="ident" id="3890137">data</span><span class="op" id="3890141">,</span>&nbsp;<span class="ident" id="3890143">pemStart</span><span class="op" id="3890151">)</span><span class="op" id="3890152">;</span>&nbsp;<span class="ident" id="3890154">i</span>&nbsp;<span class="op" id="3890156">&gt;=</span>&nbsp;<span class="num" id="3890159">0</span>&nbsp;<span class="op" id="3890161">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890165">rest</span>&nbsp;<span class="op" id="3890170">=</span>&nbsp;<span class="ident" id="3890172">rest</span><span class="op" id="3890176">[</span><span class="ident" id="3890177">i</span><span class="op" id="3890178">+</span><span class="builtinfunc" id="3890179">len</span><span class="op" id="3890182">(</span><span class="ident" id="3890183">pemStart</span><span class="op" id="3890191">)</span>&nbsp;<span class="op" id="3890193">:</span>&nbsp;<span class="builtinfunc" id="3890195">len</span><span class="op" id="3890198">(</span><span class="ident" id="3890199">data</span><span class="op" id="3890203">)</span><span class="op" id="3890204">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890207">}</span>&nbsp;<span class="keyword" id="3890209">else</span>&nbsp;<span class="op" id="3890214">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890218">return</span>&nbsp;<span class="ident" id="3890225">nil</span><span class="op" id="3890228">,</span>&nbsp;<span class="ident" id="3890230">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890240">typeLine</span><span class="op" id="3890248">,</span>&nbsp;<span class="ident" id="3890250">rest</span>&nbsp;<span class="op" id="3890255">:=</span>&nbsp;<span class="ident" id="3890258">getLine</span><span class="op" id="3890265">(</span><span class="ident" id="3890266">rest</span><span class="op" id="3890270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890273">if</span>&nbsp;<span class="op" id="3890276">!</span><span class="ident" id="3890277">bytes</span><span class="op" id="3890282">.</span><span class="ident" id="3890283">HasSuffix</span><span class="op" id="3890292">(</span><span class="ident" id="3890293">typeLine</span><span class="op" id="3890301">,</span>&nbsp;<span class="ident" id="3890303">pemEndOfLine</span><span class="op" id="3890315">)</span>&nbsp;<span class="op" id="3890317">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890321">return</span>&nbsp;<span class="ident" id="3890328">decodeError</span><span class="op" id="3890339">(</span><span class="ident" id="3890340">data</span><span class="op" id="3890344">,</span>&nbsp;<span class="ident" id="3890346">rest</span><span class="op" id="3890350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890356">typeLine</span>&nbsp;<span class="op" id="3890365">=</span>&nbsp;<span class="ident" id="3890367">typeLine</span><span class="op" id="3890375">[</span><span class="num" id="3890376">0</span>&nbsp;<span class="op" id="3890378">:</span>&nbsp;<span class="builtinfunc" id="3890380">len</span><span class="op" id="3890383">(</span><span class="ident" id="3890384">typeLine</span><span class="op" id="3890392">)</span><span class="op" id="3890393">-</span><span class="builtinfunc" id="3890394">len</span><span class="op" id="3890397">(</span><span class="ident" id="3890398">pemEndOfLine</span><span class="op" id="3890410">)</span><span class="op" id="3890411">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890415">p</span>&nbsp;<span class="op" id="3890417">=</span>&nbsp;<span class="op" id="3890419">&amp;</span><span class="ident" id="3890420">Block</span><span class="op" id="3890425">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890429">Headers</span><span class="op" id="3890436">:</span>&nbsp;<span class="builtinfunc" id="3890438">make</span><span class="op" id="3890442">(</span><span class="keyword" id="3890443">map</span><span class="op" id="3890446">[</span><span class="builtintype" id="3890447">string</span><span class="op" id="3890453">]</span><span class="builtintype" id="3890454">string</span><span class="op" id="3890460">)</span><span class="op" id="3890461">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890465">Type</span><span class="op" id="3890469">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="3890474">string</span><span class="op" id="3890480">(</span><span class="ident" id="3890481">typeLine</span><span class="op" id="3890489">)</span><span class="op" id="3890490">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890497">for</span>&nbsp;<span class="op" id="3890501">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890505">//&nbsp;This&nbsp;loop&nbsp;terminates&nbsp;because&nbsp;getLine&#39;s&nbsp;second&nbsp;result&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890566">//&nbsp;always&nbsp;smaller&nbsp;than&nbsp;its&nbsp;argument.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890605">if</span>&nbsp;<span class="builtinfunc" id="3890608">len</span><span class="op" id="3890611">(</span><span class="ident" id="3890612">rest</span><span class="op" id="3890616">)</span>&nbsp;<span class="op" id="3890618">==</span>&nbsp;<span class="num" id="3890621">0</span>&nbsp;<span class="op" id="3890623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890628">return</span>&nbsp;<span class="ident" id="3890635">nil</span><span class="op" id="3890638">,</span>&nbsp;<span class="ident" id="3890640">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890647">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890651">line</span><span class="op" id="3890655">,</span>&nbsp;<span class="ident" id="3890657">next</span>&nbsp;<span class="op" id="3890662">:=</span>&nbsp;<span class="ident" id="3890665">getLine</span><span class="op" id="3890672">(</span><span class="ident" id="3890673">rest</span><span class="op" id="3890677">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890682">i</span>&nbsp;<span class="op" id="3890684">:=</span>&nbsp;<span class="ident" id="3890687">bytes</span><span class="op" id="3890692">.</span><span class="ident" id="3890693">Index</span><span class="op" id="3890698">(</span><span class="ident" id="3890699">line</span><span class="op" id="3890703">,</span>&nbsp;<span class="op" id="3890705">[</span><span class="op" id="3890706">]</span><span class="builtintype" id="3890707">byte</span><span class="op" id="3890711">{</span><span class="string" id="3890712">&#39;:&#39;</span><span class="op" id="3890715">}</span><span class="op" id="3890716">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890720">if</span>&nbsp;<span class="ident" id="3890723">i</span>&nbsp;<span class="op" id="3890725">==</span>&nbsp;<span class="op" id="3890728">-</span><span class="num" id="3890729">1</span>&nbsp;<span class="op" id="3890731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890736">break</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890744">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3890749">//&nbsp;TODO(agl):&nbsp;need&nbsp;to&nbsp;cope&nbsp;with&nbsp;values&nbsp;that&nbsp;spread&nbsp;across&nbsp;lines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890816">key</span><span class="op" id="3890819">,</span>&nbsp;<span class="ident" id="3890821">val</span>&nbsp;<span class="op" id="3890825">:=</span>&nbsp;<span class="ident" id="3890828">line</span><span class="op" id="3890832">[</span><span class="num" id="3890833">0</span><span class="op" id="3890834">:</span><span class="ident" id="3890835">i</span><span class="op" id="3890836">]</span><span class="op" id="3890837">,</span>&nbsp;<span class="ident" id="3890839">line</span><span class="op" id="3890843">[</span><span class="ident" id="3890844">i</span><span class="op" id="3890845">+</span><span class="num" id="3890846">1</span><span class="op" id="3890847">:</span><span class="op" id="3890848">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890852">key</span>&nbsp;<span class="op" id="3890856">=</span>&nbsp;<span class="ident" id="3890858">bytes</span><span class="op" id="3890863">.</span><span class="ident" id="3890864">TrimSpace</span><span class="op" id="3890873">(</span><span class="ident" id="3890874">key</span><span class="op" id="3890877">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890881">val</span>&nbsp;<span class="op" id="3890885">=</span>&nbsp;<span class="ident" id="3890887">bytes</span><span class="op" id="3890892">.</span><span class="ident" id="3890893">TrimSpace</span><span class="op" id="3890902">(</span><span class="ident" id="3890903">val</span><span class="op" id="3890906">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890910">p</span><span class="op" id="3890911">.</span><span class="ident" id="3890912">Headers</span><span class="op" id="3890919">[</span><span class="builtintype" id="3890920">string</span><span class="op" id="3890926">(</span><span class="ident" id="3890927">key</span><span class="op" id="3890930">)</span><span class="op" id="3890931">]</span>&nbsp;<span class="op" id="3890933">=</span>&nbsp;<span class="builtintype" id="3890935">string</span><span class="op" id="3890941">(</span><span class="ident" id="3890942">val</span><span class="op" id="3890945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890949">rest</span>&nbsp;<span class="op" id="3890954">=</span>&nbsp;<span class="ident" id="3890956">next</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3890962">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3890966">i</span>&nbsp;<span class="op" id="3890968">:=</span>&nbsp;<span class="ident" id="3890971">bytes</span><span class="op" id="3890976">.</span><span class="ident" id="3890977">Index</span><span class="op" id="3890982">(</span><span class="ident" id="3890983">rest</span><span class="op" id="3890987">,</span>&nbsp;<span class="ident" id="3890989">pemEnd</span><span class="op" id="3890995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3890998">if</span>&nbsp;<span class="ident" id="3891001">i</span>&nbsp;<span class="op" id="3891003">&lt;</span>&nbsp;<span class="num" id="3891005">0</span>&nbsp;<span class="op" id="3891007">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891011">return</span>&nbsp;<span class="ident" id="3891018">decodeError</span><span class="op" id="3891029">(</span><span class="ident" id="3891030">data</span><span class="op" id="3891034">,</span>&nbsp;<span class="ident" id="3891036">rest</span><span class="op" id="3891040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3891043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891046">base64Data</span>&nbsp;<span class="op" id="3891057">:=</span>&nbsp;<span class="ident" id="3891060">removeWhitespace</span><span class="op" id="3891076">(</span><span class="ident" id="3891077">rest</span><span class="op" id="3891081">[</span><span class="num" id="3891082">0</span><span class="op" id="3891083">:</span><span class="ident" id="3891084">i</span><span class="op" id="3891085">]</span><span class="op" id="3891086">)</span><br>
<span class="lineno">125</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891090">p</span><span class="op" id="3891091">.</span><span class="ident" id="3891092">Bytes</span>&nbsp;<span class="op" id="3891098">=</span>&nbsp;<span class="builtinfunc" id="3891100">make</span><span class="op" id="3891104">(</span><span class="op" id="3891105">[</span><span class="op" id="3891106">]</span><span class="builtintype" id="3891107">byte</span><span class="op" id="3891111">,</span>&nbsp;<span class="ident" id="3891113">base64</span><span class="op" id="3891119">.</span><span class="ident" id="3891120">StdEncoding</span><span class="op" id="3891131">.</span><span class="ident" id="3891132">DecodedLen</span><span class="op" id="3891142">(</span><span class="builtinfunc" id="3891143">len</span><span class="op" id="3891146">(</span><span class="ident" id="3891147">base64Data</span><span class="op" id="3891157">)</span><span class="op" id="3891158">)</span><span class="op" id="3891159">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891162">n</span><span class="op" id="3891163">,</span>&nbsp;<span class="ident" id="3891165">err</span>&nbsp;<span class="op" id="3891169">:=</span>&nbsp;<span class="ident" id="3891172">base64</span><span class="op" id="3891178">.</span><span class="ident" id="3891179">StdEncoding</span><span class="op" id="3891190">.</span><span class="ident" id="3891191">Decode</span><span class="op" id="3891197">(</span><span class="ident" id="3891198">p</span><span class="op" id="3891199">.</span><span class="ident" id="3891200">Bytes</span><span class="op" id="3891205">,</span>&nbsp;<span class="ident" id="3891207">base64Data</span><span class="op" id="3891217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891220">if</span>&nbsp;<span class="ident" id="3891223">err</span>&nbsp;<span class="op" id="3891227">!=</span>&nbsp;<span class="ident" id="3891230">nil</span>&nbsp;<span class="op" id="3891234">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891238">return</span>&nbsp;<span class="ident" id="3891245">decodeError</span><span class="op" id="3891256">(</span><span class="ident" id="3891257">data</span><span class="op" id="3891261">,</span>&nbsp;<span class="ident" id="3891263">rest</span><span class="op" id="3891267">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3891270">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891273">p</span><span class="op" id="3891274">.</span><span class="ident" id="3891275">Bytes</span>&nbsp;<span class="op" id="3891281">=</span>&nbsp;<span class="ident" id="3891283">p</span><span class="op" id="3891284">.</span><span class="ident" id="3891285">Bytes</span><span class="op" id="3891290">[</span><span class="num" id="3891291">0</span><span class="op" id="3891292">:</span><span class="ident" id="3891293">n</span><span class="op" id="3891294">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3891298">_</span><span class="op" id="3891299">,</span>&nbsp;<span class="ident" id="3891301">rest</span>&nbsp;<span class="op" id="3891306">=</span>&nbsp;<span class="ident" id="3891308">getLine</span><span class="op" id="3891315">(</span><span class="ident" id="3891316">rest</span><span class="op" id="3891320">[</span><span class="ident" id="3891321">i</span><span class="op" id="3891322">+</span><span class="builtinfunc" id="3891323">len</span><span class="op" id="3891326">(</span><span class="ident" id="3891327">pemEnd</span><span class="op" id="3891333">)</span><span class="op" id="3891334">:</span><span class="op" id="3891335">]</span><span class="op" id="3891336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3891340">return</span><br>
<span class="lineno"></span><span class="op" id="3891347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3891350">func</span>&nbsp;<span class="ident" id="3891355">decodeError</span><span class="op" id="3891366">(</span><span class="ident" id="3891367">data</span><span class="op" id="3891371">,</span>&nbsp;<span class="ident" id="3891373">rest</span>&nbsp;<span class="op" id="3891378">[</span><span class="op" id="3891379">]</span><span class="builtintype" id="3891380">byte</span><span class="op" id="3891384">)</span>&nbsp;<span class="op" id="3891386">(</span><span class="op" id="3891387">*</span><span class="ident" id="3891388">Block</span><span class="op" id="3891393">,</span>&nbsp;<span class="op" id="3891395">[</span><span class="op" id="3891396">]</span><span class="builtintype" id="3891397">byte</span><span class="op" id="3891401">)</span>&nbsp;<span class="op" id="3891403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891406">//&nbsp;If&nbsp;we&nbsp;get&nbsp;here&nbsp;then&nbsp;we&nbsp;have&nbsp;rejected&nbsp;a&nbsp;likely&nbsp;looking,&nbsp;but</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891469">//&nbsp;ultimately&nbsp;invalid&nbsp;PEM&nbsp;block.&nbsp;We&nbsp;need&nbsp;to&nbsp;start&nbsp;over&nbsp;from&nbsp;a&nbsp;new</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891536">//&nbsp;position.&nbsp;&nbsp;We&nbsp;have&nbsp;consumed&nbsp;the&nbsp;preamble&nbsp;line&nbsp;and&nbsp;will&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891609">//&nbsp;any&nbsp;lines&nbsp;which&nbsp;could&nbsp;be&nbsp;header&nbsp;lines.&nbsp;However,&nbsp;a&nbsp;valid&nbsp;preamble</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891678">//&nbsp;line&nbsp;is&nbsp;not&nbsp;a&nbsp;valid&nbsp;header&nbsp;line,&nbsp;therefore&nbsp;we&nbsp;cannot&nbsp;have&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891749">//&nbsp;the&nbsp;preamble&nbsp;line&nbsp;for&nbsp;the&nbsp;any&nbsp;subsequent&nbsp;block.&nbsp;Thus,&nbsp;we&nbsp;will&nbsp;always</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891822">//&nbsp;find&nbsp;any&nbsp;valid&nbsp;block,&nbsp;no&nbsp;matter&nbsp;what&nbsp;bytes&nbsp;precede&nbsp;it.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891881">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891885">//&nbsp;For&nbsp;example,&nbsp;if&nbsp;the&nbsp;input&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891918">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891922">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;MALFORMED&nbsp;BLOCK-----</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3891961">//&nbsp;&nbsp;&nbsp;&nbsp;junk&nbsp;that&nbsp;may&nbsp;look&nbsp;like&nbsp;header&nbsp;lines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892005">//&nbsp;&nbsp;&nbsp;or&nbsp;data&nbsp;lines,&nbsp;but&nbsp;no&nbsp;END&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892042">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892046">//&nbsp;&nbsp;&nbsp;&nbsp;-----BEGIN&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892082">//&nbsp;&nbsp;&nbsp;&nbsp;realdata</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892098">//&nbsp;&nbsp;&nbsp;&nbsp;-----END&nbsp;ACTUAL&nbsp;BLOCK-----</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892132">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892136">//&nbsp;we&#39;ve&nbsp;failed&nbsp;to&nbsp;parse&nbsp;using&nbsp;the&nbsp;first&nbsp;BEGIN&nbsp;line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3892189">//&nbsp;and&nbsp;now&nbsp;will&nbsp;try&nbsp;again,&nbsp;using&nbsp;the&nbsp;second&nbsp;BEGIN&nbsp;line.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892246">p</span><span class="op" id="3892247">,</span>&nbsp;<span class="ident" id="3892249">rest</span>&nbsp;<span class="op" id="3892254">:=</span>&nbsp;<span class="ident" id="3892257">Decode</span><span class="op" id="3892263">(</span><span class="ident" id="3892264">rest</span><span class="op" id="3892268">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892271">if</span>&nbsp;<span class="ident" id="3892274">p</span>&nbsp;<span class="op" id="3892276">==</span>&nbsp;<span class="ident" id="3892279">nil</span>&nbsp;<span class="op" id="3892283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892287">rest</span>&nbsp;<span class="op" id="3892292">=</span>&nbsp;<span class="ident" id="3892294">data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892300">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892303">return</span>&nbsp;<span class="ident" id="3892310">p</span><span class="op" id="3892311">,</span>&nbsp;<span class="ident" id="3892313">rest</span><br>
<span class="lineno"></span><span class="op" id="3892318">}</span><br>
<span class="lineno">165</span><br>
<span class="lineno"></span><span class="keyword" id="3892321">const</span>&nbsp;<span class="ident" id="3892327">pemLineLength</span>&nbsp;<span class="op" id="3892341">=</span>&nbsp;<span class="num" id="3892343">64</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3892347">type</span>&nbsp;<span class="ident" id="3892352">lineBreaker</span>&nbsp;<span class="keyword" id="3892364">struct</span>&nbsp;<span class="op" id="3892371">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892374">line</span>&nbsp;<span class="op" id="3892379">[</span><span class="ident" id="3892380">pemLineLength</span><span class="op" id="3892393">]</span><span class="builtintype" id="3892394">byte</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892400">used</span>&nbsp;<span class="builtintype" id="3892405">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892410">out</span>&nbsp;&nbsp;<span class="ident" id="3892415">io</span><span class="op" id="3892417">.</span><span class="ident" id="3892418">Writer</span><br>
<span class="lineno"></span><span class="op" id="3892425">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3892428">func</span>&nbsp;<span class="op" id="3892433">(</span><span class="ident" id="3892434">l</span>&nbsp;<span class="op" id="3892436">*</span><span class="ident" id="3892437">lineBreaker</span><span class="op" id="3892448">)</span>&nbsp;<span class="ident" id="3892450">Write</span><span class="op" id="3892455">(</span><span class="ident" id="3892456">b</span>&nbsp;<span class="op" id="3892458">[</span><span class="op" id="3892459">]</span><span class="builtintype" id="3892460">byte</span><span class="op" id="3892464">)</span>&nbsp;<span class="op" id="3892466">(</span><span class="ident" id="3892467">n</span>&nbsp;<span class="builtintype" id="3892469">int</span><span class="op" id="3892472">,</span>&nbsp;<span class="ident" id="3892474">err</span>&nbsp;<span class="builtintype" id="3892478">error</span><span class="op" id="3892483">)</span>&nbsp;<span class="op" id="3892485">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892488">if</span>&nbsp;<span class="ident" id="3892491">l</span><span class="op" id="3892492">.</span><span class="ident" id="3892493">used</span><span class="op" id="3892497">+</span><span class="builtinfunc" id="3892498">len</span><span class="op" id="3892501">(</span><span class="ident" id="3892502">b</span><span class="op" id="3892503">)</span>&nbsp;<span class="op" id="3892505">&lt;</span>&nbsp;<span class="ident" id="3892507">pemLineLength</span>&nbsp;<span class="op" id="3892521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="3892525">copy</span><span class="op" id="3892529">(</span><span class="ident" id="3892530">l</span><span class="op" id="3892531">.</span><span class="ident" id="3892532">line</span><span class="op" id="3892536">[</span><span class="ident" id="3892537">l</span><span class="op" id="3892538">.</span><span class="ident" id="3892539">used</span><span class="op" id="3892543">:</span><span class="op" id="3892544">]</span><span class="op" id="3892545">,</span>&nbsp;<span class="ident" id="3892547">b</span><span class="op" id="3892548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892552">l</span><span class="op" id="3892553">.</span><span class="ident" id="3892554">used</span>&nbsp;<span class="op" id="3892559">+=</span>&nbsp;<span class="builtinfunc" id="3892562">len</span><span class="op" id="3892565">(</span><span class="ident" id="3892566">b</span><span class="op" id="3892567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892571">return</span>&nbsp;<span class="builtinfunc" id="3892578">len</span><span class="op" id="3892581">(</span><span class="ident" id="3892582">b</span><span class="op" id="3892583">)</span><span class="op" id="3892584">,</span>&nbsp;<span class="ident" id="3892586">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892591">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892595">n</span><span class="op" id="3892596">,</span>&nbsp;<span class="ident" id="3892598">err</span>&nbsp;<span class="op" id="3892602">=</span>&nbsp;<span class="ident" id="3892604">l</span><span class="op" id="3892605">.</span><span class="ident" id="3892606">out</span><span class="op" id="3892609">.</span><span class="ident" id="3892610">Write</span><span class="op" id="3892615">(</span><span class="ident" id="3892616">l</span><span class="op" id="3892617">.</span><span class="ident" id="3892618">line</span><span class="op" id="3892622">[</span><span class="num" id="3892623">0</span><span class="op" id="3892624">:</span><span class="ident" id="3892625">l</span><span class="op" id="3892626">.</span><span class="ident" id="3892627">used</span><span class="op" id="3892631">]</span><span class="op" id="3892632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892635">if</span>&nbsp;<span class="ident" id="3892638">err</span>&nbsp;<span class="op" id="3892642">!=</span>&nbsp;<span class="ident" id="3892645">nil</span>&nbsp;<span class="op" id="3892649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892653">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892661">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892664">excess</span>&nbsp;<span class="op" id="3892671">:=</span>&nbsp;<span class="ident" id="3892674">pemLineLength</span>&nbsp;<span class="op" id="3892688">-</span>&nbsp;<span class="ident" id="3892690">l</span><span class="op" id="3892691">.</span><span class="ident" id="3892692">used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892698">l</span><span class="op" id="3892699">.</span><span class="ident" id="3892700">used</span>&nbsp;<span class="op" id="3892705">=</span>&nbsp;<span class="num" id="3892707">0</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892711">n</span><span class="op" id="3892712">,</span>&nbsp;<span class="ident" id="3892714">err</span>&nbsp;<span class="op" id="3892718">=</span>&nbsp;<span class="ident" id="3892720">l</span><span class="op" id="3892721">.</span><span class="ident" id="3892722">out</span><span class="op" id="3892725">.</span><span class="ident" id="3892726">Write</span><span class="op" id="3892731">(</span><span class="ident" id="3892732">b</span><span class="op" id="3892733">[</span><span class="num" id="3892734">0</span><span class="op" id="3892735">:</span><span class="ident" id="3892736">excess</span><span class="op" id="3892742">]</span><span class="op" id="3892743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892746">if</span>&nbsp;<span class="ident" id="3892749">err</span>&nbsp;<span class="op" id="3892753">!=</span>&nbsp;<span class="ident" id="3892756">nil</span>&nbsp;<span class="op" id="3892760">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892764">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892772">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892776">n</span><span class="op" id="3892777">,</span>&nbsp;<span class="ident" id="3892779">err</span>&nbsp;<span class="op" id="3892783">=</span>&nbsp;<span class="ident" id="3892785">l</span><span class="op" id="3892786">.</span><span class="ident" id="3892787">out</span><span class="op" id="3892790">.</span><span class="ident" id="3892791">Write</span><span class="op" id="3892796">(</span><span class="op" id="3892797">[</span><span class="op" id="3892798">]</span><span class="builtintype" id="3892799">byte</span><span class="op" id="3892803">{</span><span class="string" id="3892804">&#39;\n&#39;</span><span class="op" id="3892808">}</span><span class="op" id="3892809">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892812">if</span>&nbsp;<span class="ident" id="3892815">err</span>&nbsp;<span class="op" id="3892819">!=</span>&nbsp;<span class="ident" id="3892822">nil</span>&nbsp;<span class="op" id="3892826">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892830">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3892838">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892842">return</span>&nbsp;<span class="ident" id="3892849">l</span><span class="op" id="3892850">.</span><span class="ident" id="3892851">Write</span><span class="op" id="3892856">(</span><span class="ident" id="3892857">b</span><span class="op" id="3892858">[</span><span class="ident" id="3892859">excess</span><span class="op" id="3892865">:</span><span class="op" id="3892866">]</span><span class="op" id="3892867">)</span><br>
<span class="lineno"></span><span class="op" id="3892869">}</span><br>
<span class="lineno">200</span><br>
<span class="lineno"></span><span class="keyword" id="3892872">func</span>&nbsp;<span class="op" id="3892877">(</span><span class="ident" id="3892878">l</span>&nbsp;<span class="op" id="3892880">*</span><span class="ident" id="3892881">lineBreaker</span><span class="op" id="3892892">)</span>&nbsp;<span class="ident" id="3892894">Close</span><span class="op" id="3892899">(</span><span class="op" id="3892900">)</span>&nbsp;<span class="op" id="3892902">(</span><span class="ident" id="3892903">err</span>&nbsp;<span class="builtintype" id="3892907">error</span><span class="op" id="3892912">)</span>&nbsp;<span class="op" id="3892914">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892917">if</span>&nbsp;<span class="ident" id="3892920">l</span><span class="op" id="3892921">.</span><span class="ident" id="3892922">used</span>&nbsp;<span class="op" id="3892927">&gt;</span>&nbsp;<span class="num" id="3892929">0</span>&nbsp;<span class="op" id="3892931">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3892935">_</span><span class="op" id="3892936">,</span>&nbsp;<span class="ident" id="3892938">err</span>&nbsp;<span class="op" id="3892942">=</span>&nbsp;<span class="ident" id="3892944">l</span><span class="op" id="3892945">.</span><span class="ident" id="3892946">out</span><span class="op" id="3892949">.</span><span class="ident" id="3892950">Write</span><span class="op" id="3892955">(</span><span class="ident" id="3892956">l</span><span class="op" id="3892957">.</span><span class="ident" id="3892958">line</span><span class="op" id="3892962">[</span><span class="num" id="3892963">0</span><span class="op" id="3892964">:</span><span class="ident" id="3892965">l</span><span class="op" id="3892966">.</span><span class="ident" id="3892967">used</span><span class="op" id="3892971">]</span><span class="op" id="3892972">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892976">if</span>&nbsp;<span class="ident" id="3892979">err</span>&nbsp;<span class="op" id="3892983">!=</span>&nbsp;<span class="ident" id="3892986">nil</span>&nbsp;<span class="op" id="3892990">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3892995">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893004">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893008">_</span><span class="op" id="3893009">,</span>&nbsp;<span class="ident" id="3893011">err</span>&nbsp;<span class="op" id="3893015">=</span>&nbsp;<span class="ident" id="3893017">l</span><span class="op" id="3893018">.</span><span class="ident" id="3893019">out</span><span class="op" id="3893022">.</span><span class="ident" id="3893023">Write</span><span class="op" id="3893028">(</span><span class="op" id="3893029">[</span><span class="op" id="3893030">]</span><span class="builtintype" id="3893031">byte</span><span class="op" id="3893035">{</span><span class="string" id="3893036">&#39;\n&#39;</span><span class="op" id="3893040">}</span><span class="op" id="3893041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893044">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893048">return</span><br>
<span class="lineno"></span><span class="op" id="3893055">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893058">func</span>&nbsp;<span class="ident" id="3893063">writeHeader</span><span class="op" id="3893074">(</span><span class="ident" id="3893075">out</span>&nbsp;<span class="ident" id="3893079">io</span><span class="op" id="3893081">.</span><span class="ident" id="3893082">Writer</span><span class="op" id="3893088">,</span>&nbsp;<span class="ident" id="3893090">k</span><span class="op" id="3893091">,</span>&nbsp;<span class="ident" id="3893093">v</span>&nbsp;<span class="builtintype" id="3893095">string</span><span class="op" id="3893101">)</span>&nbsp;<span class="builtintype" id="3893103">error</span>&nbsp;<span class="op" id="3893109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893112">_</span><span class="op" id="3893113">,</span>&nbsp;<span class="ident" id="3893115">err</span>&nbsp;<span class="op" id="3893119">:=</span>&nbsp;<span class="ident" id="3893122">out</span><span class="op" id="3893125">.</span><span class="ident" id="3893126">Write</span><span class="op" id="3893131">(</span><span class="op" id="3893132">[</span><span class="op" id="3893133">]</span><span class="builtintype" id="3893134">byte</span><span class="op" id="3893138">(</span><span class="ident" id="3893139">k</span>&nbsp;<span class="op" id="3893141">+</span>&nbsp;<span class="string" id="3893143">&#34;:&nbsp;&#34;</span>&nbsp;<span class="op" id="3893148">+</span>&nbsp;<span class="ident" id="3893150">v</span>&nbsp;<span class="op" id="3893152">+</span>&nbsp;<span class="string" id="3893154">&#34;\n&#34;</span><span class="op" id="3893158">)</span><span class="op" id="3893159">)</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893162">return</span>&nbsp;<span class="ident" id="3893169">err</span><br>
<span class="lineno"></span><span class="op" id="3893173">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3893176">func</span>&nbsp;<span class="ident" id="3893181">Encode</span><span class="op" id="3893187">(</span><span class="ident" id="3893188">out</span>&nbsp;<span class="ident" id="3893192">io</span><span class="op" id="3893194">.</span><span class="ident" id="3893195">Writer</span><span class="op" id="3893201">,</span>&nbsp;<span class="ident" id="3893203">b</span>&nbsp;<span class="op" id="3893205">*</span><span class="ident" id="3893206">Block</span><span class="op" id="3893211">)</span>&nbsp;<span class="builtintype" id="3893213">error</span>&nbsp;<span class="op" id="3893219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893222">if</span>&nbsp;<span class="ident" id="3893225">_</span><span class="op" id="3893226">,</span>&nbsp;<span class="ident" id="3893228">err</span>&nbsp;<span class="op" id="3893232">:=</span>&nbsp;<span class="ident" id="3893235">out</span><span class="op" id="3893238">.</span><span class="ident" id="3893239">Write</span><span class="op" id="3893244">(</span><span class="ident" id="3893245">pemStart</span><span class="op" id="3893253">[</span><span class="num" id="3893254">1</span><span class="op" id="3893255">:</span><span class="op" id="3893256">]</span><span class="op" id="3893257">)</span><span class="op" id="3893258">;</span>&nbsp;<span class="ident" id="3893260">err</span>&nbsp;<span class="op" id="3893264">!=</span>&nbsp;<span class="ident" id="3893267">nil</span>&nbsp;<span class="op" id="3893271">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893275">return</span>&nbsp;<span class="ident" id="3893282">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893287">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893290">if</span>&nbsp;<span class="ident" id="3893293">_</span><span class="op" id="3893294">,</span>&nbsp;<span class="ident" id="3893296">err</span>&nbsp;<span class="op" id="3893300">:=</span>&nbsp;<span class="ident" id="3893303">out</span><span class="op" id="3893306">.</span><span class="ident" id="3893307">Write</span><span class="op" id="3893312">(</span><span class="op" id="3893313">[</span><span class="op" id="3893314">]</span><span class="builtintype" id="3893315">byte</span><span class="op" id="3893319">(</span><span class="ident" id="3893320">b</span><span class="op" id="3893321">.</span><span class="ident" id="3893322">Type</span>&nbsp;<span class="op" id="3893327">+</span>&nbsp;<span class="string" id="3893329">&#34;-----\n&#34;</span><span class="op" id="3893338">)</span><span class="op" id="3893339">)</span><span class="op" id="3893340">;</span>&nbsp;<span class="ident" id="3893342">err</span>&nbsp;<span class="op" id="3893346">!=</span>&nbsp;<span class="ident" id="3893349">nil</span>&nbsp;<span class="op" id="3893353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893357">return</span>&nbsp;<span class="ident" id="3893364">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893369">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893373">if</span>&nbsp;<span class="builtinfunc" id="3893376">len</span><span class="op" id="3893379">(</span><span class="ident" id="3893380">b</span><span class="op" id="3893381">.</span><span class="ident" id="3893382">Headers</span><span class="op" id="3893389">)</span>&nbsp;<span class="op" id="3893391">&gt;</span>&nbsp;<span class="num" id="3893393">0</span>&nbsp;<span class="op" id="3893395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893399">const</span>&nbsp;<span class="ident" id="3893405">procType</span>&nbsp;<span class="op" id="3893414">=</span>&nbsp;<span class="string" id="3893416">&#34;Proc-Type&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893430">h</span>&nbsp;<span class="op" id="3893432">:=</span>&nbsp;<span class="builtinfunc" id="3893435">make</span><span class="op" id="3893439">(</span><span class="op" id="3893440">[</span><span class="op" id="3893441">]</span><span class="builtintype" id="3893442">string</span><span class="op" id="3893448">,</span>&nbsp;<span class="num" id="3893450">0</span><span class="op" id="3893451">,</span>&nbsp;<span class="builtinfunc" id="3893453">len</span><span class="op" id="3893456">(</span><span class="ident" id="3893457">b</span><span class="op" id="3893458">.</span><span class="ident" id="3893459">Headers</span><span class="op" id="3893466">)</span><span class="op" id="3893467">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893471">hasProcType</span>&nbsp;<span class="op" id="3893483">:=</span>&nbsp;<span class="builtintype" id="3893486">false</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893494">for</span>&nbsp;<span class="ident" id="3893498">k</span>&nbsp;<span class="op" id="3893500">:=</span>&nbsp;<span class="keyword" id="3893503">range</span>&nbsp;<span class="ident" id="3893509">b</span><span class="op" id="3893510">.</span><span class="ident" id="3893511">Headers</span>&nbsp;<span class="op" id="3893519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893524">if</span>&nbsp;<span class="ident" id="3893527">k</span>&nbsp;<span class="op" id="3893529">==</span>&nbsp;<span class="ident" id="3893532">procType</span>&nbsp;<span class="op" id="3893541">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893547">hasProcType</span>&nbsp;<span class="op" id="3893559">=</span>&nbsp;<span class="builtintype" id="3893561">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893570">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893582">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893587">h</span>&nbsp;<span class="op" id="3893589">=</span>&nbsp;<span class="builtinfunc" id="3893591">append</span><span class="op" id="3893597">(</span><span class="ident" id="3893598">h</span><span class="op" id="3893599">,</span>&nbsp;<span class="ident" id="3893601">k</span><span class="op" id="3893602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893606">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893610">//&nbsp;The&nbsp;Proc-Type&nbsp;header&nbsp;must&nbsp;be&nbsp;written&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893659">//&nbsp;See&nbsp;RFC&nbsp;1421,&nbsp;section&nbsp;4.6.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893694">if</span>&nbsp;<span class="ident" id="3893697">hasProcType</span>&nbsp;<span class="op" id="3893709">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893714">if</span>&nbsp;<span class="ident" id="3893717">err</span>&nbsp;<span class="op" id="3893721">:=</span>&nbsp;<span class="ident" id="3893724">writeHeader</span><span class="op" id="3893735">(</span><span class="ident" id="3893736">out</span><span class="op" id="3893739">,</span>&nbsp;<span class="ident" id="3893741">procType</span><span class="op" id="3893749">,</span>&nbsp;<span class="ident" id="3893751">b</span><span class="op" id="3893752">.</span><span class="ident" id="3893753">Headers</span><span class="op" id="3893760">[</span><span class="ident" id="3893761">procType</span><span class="op" id="3893769">]</span><span class="op" id="3893770">)</span><span class="op" id="3893771">;</span>&nbsp;<span class="ident" id="3893773">err</span>&nbsp;<span class="op" id="3893777">!=</span>&nbsp;<span class="ident" id="3893780">nil</span>&nbsp;<span class="op" id="3893784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893790">return</span>&nbsp;<span class="ident" id="3893797">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893804">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893808">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3893812">//&nbsp;For&nbsp;consistency&nbsp;of&nbsp;output,&nbsp;write&nbsp;other&nbsp;headers&nbsp;sorted&nbsp;by&nbsp;key.</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3893879">sort</span><span class="op" id="3893883">.</span><span class="ident" id="3893884">Strings</span><span class="op" id="3893891">(</span><span class="ident" id="3893892">h</span><span class="op" id="3893893">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893897">for</span>&nbsp;<span class="ident" id="3893901">_</span><span class="op" id="3893902">,</span>&nbsp;<span class="ident" id="3893904">k</span>&nbsp;<span class="op" id="3893906">:=</span>&nbsp;<span class="keyword" id="3893909">range</span>&nbsp;<span class="ident" id="3893915">h</span>&nbsp;<span class="op" id="3893917">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893922">if</span>&nbsp;<span class="ident" id="3893925">err</span>&nbsp;<span class="op" id="3893929">:=</span>&nbsp;<span class="ident" id="3893932">writeHeader</span><span class="op" id="3893943">(</span><span class="ident" id="3893944">out</span><span class="op" id="3893947">,</span>&nbsp;<span class="ident" id="3893949">k</span><span class="op" id="3893950">,</span>&nbsp;<span class="ident" id="3893952">b</span><span class="op" id="3893953">.</span><span class="ident" id="3893954">Headers</span><span class="op" id="3893961">[</span><span class="ident" id="3893962">k</span><span class="op" id="3893963">]</span><span class="op" id="3893964">)</span><span class="op" id="3893965">;</span>&nbsp;<span class="ident" id="3893967">err</span>&nbsp;<span class="op" id="3893971">!=</span>&nbsp;<span class="ident" id="3893974">nil</span>&nbsp;<span class="op" id="3893978">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3893984">return</span>&nbsp;<span class="ident" id="3893991">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3893998">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894006">if</span>&nbsp;<span class="ident" id="3894009">_</span><span class="op" id="3894010">,</span>&nbsp;<span class="ident" id="3894012">err</span>&nbsp;<span class="op" id="3894016">:=</span>&nbsp;<span class="ident" id="3894019">out</span><span class="op" id="3894022">.</span><span class="ident" id="3894023">Write</span><span class="op" id="3894028">(</span><span class="op" id="3894029">[</span><span class="op" id="3894030">]</span><span class="builtintype" id="3894031">byte</span><span class="op" id="3894035">{</span><span class="string" id="3894036">&#39;\n&#39;</span><span class="op" id="3894040">}</span><span class="op" id="3894041">)</span><span class="op" id="3894042">;</span>&nbsp;<span class="ident" id="3894044">err</span>&nbsp;<span class="op" id="3894048">!=</span>&nbsp;<span class="ident" id="3894051">nil</span>&nbsp;<span class="op" id="3894055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894060">return</span>&nbsp;<span class="ident" id="3894067">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894073">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894076">}</span><br>
<span class="lineno">255</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894080">var</span>&nbsp;<span class="ident" id="3894084">breaker</span>&nbsp;<span class="ident" id="3894092">lineBreaker</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894105">breaker</span><span class="op" id="3894112">.</span><span class="ident" id="3894113">out</span>&nbsp;<span class="op" id="3894117">=</span>&nbsp;<span class="ident" id="3894119">out</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894125">b64</span>&nbsp;<span class="op" id="3894129">:=</span>&nbsp;<span class="ident" id="3894132">base64</span><span class="op" id="3894138">.</span><span class="ident" id="3894139">NewEncoder</span><span class="op" id="3894149">(</span><span class="ident" id="3894150">base64</span><span class="op" id="3894156">.</span><span class="ident" id="3894157">StdEncoding</span><span class="op" id="3894168">,</span>&nbsp;<span class="op" id="3894170">&amp;</span><span class="ident" id="3894171">breaker</span><span class="op" id="3894178">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894181">if</span>&nbsp;<span class="ident" id="3894184">_</span><span class="op" id="3894185">,</span>&nbsp;<span class="ident" id="3894187">err</span>&nbsp;<span class="op" id="3894191">:=</span>&nbsp;<span class="ident" id="3894194">b64</span><span class="op" id="3894197">.</span><span class="ident" id="3894198">Write</span><span class="op" id="3894203">(</span><span class="ident" id="3894204">b</span><span class="op" id="3894205">.</span><span class="ident" id="3894206">Bytes</span><span class="op" id="3894211">)</span><span class="op" id="3894212">;</span>&nbsp;<span class="ident" id="3894214">err</span>&nbsp;<span class="op" id="3894218">!=</span>&nbsp;<span class="ident" id="3894221">nil</span>&nbsp;<span class="op" id="3894225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894229">return</span>&nbsp;<span class="ident" id="3894236">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894244">b64</span><span class="op" id="3894247">.</span><span class="ident" id="3894248">Close</span><span class="op" id="3894253">(</span><span class="op" id="3894254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894257">breaker</span><span class="op" id="3894264">.</span><span class="ident" id="3894265">Close</span><span class="op" id="3894270">(</span><span class="op" id="3894271">)</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894275">if</span>&nbsp;<span class="ident" id="3894278">_</span><span class="op" id="3894279">,</span>&nbsp;<span class="ident" id="3894281">err</span>&nbsp;<span class="op" id="3894285">:=</span>&nbsp;<span class="ident" id="3894288">out</span><span class="op" id="3894291">.</span><span class="ident" id="3894292">Write</span><span class="op" id="3894297">(</span><span class="ident" id="3894298">pemEnd</span><span class="op" id="3894304">[</span><span class="num" id="3894305">1</span><span class="op" id="3894306">:</span><span class="op" id="3894307">]</span><span class="op" id="3894308">)</span><span class="op" id="3894309">;</span>&nbsp;<span class="ident" id="3894311">err</span>&nbsp;<span class="op" id="3894315">!=</span>&nbsp;<span class="ident" id="3894318">nil</span>&nbsp;<span class="op" id="3894322">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894326">return</span>&nbsp;<span class="ident" id="3894333">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3894338">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894341">_</span><span class="op" id="3894342">,</span>&nbsp;<span class="ident" id="3894344">err</span>&nbsp;<span class="op" id="3894348">:=</span>&nbsp;<span class="ident" id="3894351">out</span><span class="op" id="3894354">.</span><span class="ident" id="3894355">Write</span><span class="op" id="3894360">(</span><span class="op" id="3894361">[</span><span class="op" id="3894362">]</span><span class="builtintype" id="3894363">byte</span><span class="op" id="3894367">(</span><span class="ident" id="3894368">b</span><span class="op" id="3894369">.</span><span class="ident" id="3894370">Type</span>&nbsp;<span class="op" id="3894375">+</span>&nbsp;<span class="string" id="3894377">&#34;-----\n&#34;</span><span class="op" id="3894386">)</span><span class="op" id="3894387">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894390">return</span>&nbsp;<span class="ident" id="3894397">err</span><br>
<span class="lineno"></span><span class="op" id="3894401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3894404">func</span>&nbsp;<span class="ident" id="3894409">EncodeToMemory</span><span class="op" id="3894423">(</span><span class="ident" id="3894424">b</span>&nbsp;<span class="op" id="3894426">*</span><span class="ident" id="3894427">Block</span><span class="op" id="3894432">)</span>&nbsp;<span class="op" id="3894434">[</span><span class="op" id="3894435">]</span><span class="builtintype" id="3894436">byte</span>&nbsp;<span class="op" id="3894441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894444">var</span>&nbsp;<span class="ident" id="3894448">buf</span>&nbsp;<span class="ident" id="3894452">bytes</span><span class="op" id="3894457">.</span><span class="ident" id="3894458">Buffer</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3894466">Encode</span><span class="op" id="3894472">(</span><span class="op" id="3894473">&amp;</span><span class="ident" id="3894474">buf</span><span class="op" id="3894477">,</span>&nbsp;<span class="ident" id="3894479">b</span><span class="op" id="3894480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3894483">return</span>&nbsp;<span class="ident" id="3894490">buf</span><span class="op" id="3894493">.</span><span class="ident" id="3894494">Bytes</span><span class="op" id="3894499">(</span><span class="op" id="3894500">)</span><br>
<span class="lineno"></span><span class="op" id="3894502">}</span>
</div>
</body>
</html>
