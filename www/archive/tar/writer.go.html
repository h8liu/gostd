<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5226605">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5226660">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5226714">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5226765">package</span>&nbsp;<span class="ident" id="5226773">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5226778">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5226797">//&nbsp;-&nbsp;catch&nbsp;more&nbsp;errors&nbsp;(no&nbsp;first&nbsp;header,&nbsp;etc.)</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5226845">import</span>&nbsp;<span class="op" id="5226852">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226855">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226864">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226874">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226881">&#34;io&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226887">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226893">&#34;path&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226901">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226912">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5226923">&#34;time&#34;</span><br>
<span class="lineno">20</span><span class="op" id="5226930">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5226933">var</span>&nbsp;<span class="op" id="5226937">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5226940">ErrWriteTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5226959">=</span>&nbsp;<span class="ident" id="5226961"><a href="/archive/tar/writer.go.html#5226864">errors</a></span><span class="op" id="5226967">.</span><span class="ident" id="5226968">New</span><span class="op" id="5226971">(</span><span class="string" id="5226972">&#34;archive/tar:&nbsp;write&nbsp;too&nbsp;long&#34;</span><span class="op" id="5227001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227004">ErrFieldTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227023">=</span>&nbsp;<span class="ident" id="5227025"><a href="/archive/tar/writer.go.html#5226864">errors</a></span><span class="op" id="5227031">.</span><span class="ident" id="5227032">New</span><span class="op" id="5227035">(</span><span class="string" id="5227036">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&#34;</span><span class="op" id="5227072">)</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227075">ErrWriteAfterClose</span>&nbsp;<span class="op" id="5227094">=</span>&nbsp;<span class="ident" id="5227096"><a href="/archive/tar/writer.go.html#5226864">errors</a></span><span class="op" id="5227102">.</span><span class="ident" id="5227103">New</span><span class="op" id="5227106">(</span><span class="string" id="5227107">&#34;archive/tar:&nbsp;write&nbsp;after&nbsp;close&#34;</span><span class="op" id="5227139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227142">errNameTooLong</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227161">=</span>&nbsp;<span class="ident" id="5227163"><a href="/archive/tar/writer.go.html#5226864">errors</a></span><span class="op" id="5227169">.</span><span class="ident" id="5227170">New</span><span class="op" id="5227173">(</span><span class="string" id="5227174">&#34;archive/tar:&nbsp;name&nbsp;too&nbsp;long&#34;</span><span class="op" id="5227202">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227205">errInvalidHeader</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5227224">=</span>&nbsp;<span class="ident" id="5227226"><a href="/archive/tar/writer.go.html#5226864">errors</a></span><span class="op" id="5227232">.</span><span class="ident" id="5227233">New</span><span class="op" id="5227236">(</span><span class="string" id="5227237">&#34;archive/tar:&nbsp;header&nbsp;field&nbsp;too&nbsp;long&nbsp;or&nbsp;contains&nbsp;invalid&nbsp;values&#34;</span><span class="op" id="5227300">)</span><br>
<span class="lineno"></span><span class="op" id="5227302">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="5227305">//&nbsp;A&nbsp;Writer&nbsp;provides&nbsp;sequential&nbsp;writing&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive&nbsp;in&nbsp;POSIX.1&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5227381">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5227431">//&nbsp;Call&nbsp;WriteHeader&nbsp;to&nbsp;begin&nbsp;a&nbsp;new&nbsp;file,&nbsp;and&nbsp;then&nbsp;call&nbsp;Write&nbsp;to&nbsp;supply&nbsp;that&nbsp;file&#39;s&nbsp;data,</span><br>
<span class="lineno"></span><span class="comment" id="5227520">//&nbsp;writing&nbsp;at&nbsp;most&nbsp;hdr.Size&nbsp;bytes&nbsp;in&nbsp;total.</span><br>
<span class="lineno"></span><span class="keyword" id="5227564">type</span>&nbsp;<span class="ident" id="5227569">Writer</span>&nbsp;<span class="keyword" id="5227576">struct</span>&nbsp;<span class="op" id="5227583">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227586">w</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227597"><a href="/archive/tar/writer.go.html#5226881">io</a></span><span class="op" id="5227599">.</span><span class="ident" id="5227600">Writer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227608">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227619">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227626">nb</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227637">int64</span>&nbsp;<span class="comment" id="5227643">//&nbsp;number&nbsp;of&nbsp;unwritten&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227696">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5227707">int64</span>&nbsp;<span class="comment" id="5227713">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;to&nbsp;write&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227769">closed</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5227780">bool</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227786">usedBinary</span>&nbsp;<span class="builtintype" id="5227797">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227813">//&nbsp;whether&nbsp;the&nbsp;binary&nbsp;numeric&nbsp;field&nbsp;extension&nbsp;was&nbsp;used</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227869">preferPax</span>&nbsp;&nbsp;<span class="builtintype" id="5227880">bool</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5227896">//&nbsp;use&nbsp;pax&nbsp;header&nbsp;instead&nbsp;of&nbsp;binary&nbsp;numeric&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5227948">hdrBuff</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5227959">[</span><span class="ident" id="5227960"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span><span class="op" id="5227969">]</span><span class="builtintype" id="5227970">byte</span>&nbsp;<span class="comment" id="5227975">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;regular&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228038">paxHdrBuff</span>&nbsp;<span class="op" id="5228049">[</span><span class="ident" id="5228050"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span><span class="op" id="5228059">]</span><span class="builtintype" id="5228060">byte</span>&nbsp;<span class="comment" id="5228065">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;writeHeader&nbsp;when&nbsp;writing&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span><span class="op" id="5228123">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5228126">//&nbsp;NewWriter&nbsp;creates&nbsp;a&nbsp;new&nbsp;Writer&nbsp;writing&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5228174">func</span>&nbsp;<span class="ident" id="5228179">NewWriter</span><span class="op" id="5228188">(</span><span class="ident" id="5228189">w</span>&nbsp;<span class="ident" id="5228191"><a href="/archive/tar/writer.go.html#5226881">io</a></span><span class="op" id="5228193">.</span><span class="ident" id="5228194">Writer</span><span class="op" id="5228200">)</span>&nbsp;<span class="op" id="5228202">*</span><span class="ident" id="5228203"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span>&nbsp;<span class="op" id="5228210">{</span>&nbsp;<span class="keyword" id="5228212">return</span>&nbsp;<span class="op" id="5228219">&amp;</span><span class="ident" id="5228220"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5228226">{</span><span class="ident" id="5228227">w</span><span class="op" id="5228228">:</span>&nbsp;<span class="ident" id="5228230"><a href="/archive/tar/writer.go.html#5228189">w</a></span><span class="op" id="5228231">}</span>&nbsp;<span class="op" id="5228233">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5228236">//&nbsp;Flush&nbsp;finishes&nbsp;writing&nbsp;the&nbsp;current&nbsp;file&nbsp;(optional).</span><br>
<span class="lineno">50</span><span class="keyword" id="5228291">func</span>&nbsp;<span class="op" id="5228296">(</span><span class="ident" id="5228297">tw</span>&nbsp;<span class="op" id="5228300">*</span><span class="ident" id="5228301"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5228307">)</span>&nbsp;<span class="ident" id="5228309">Flush</span><span class="op" id="5228314">(</span><span class="op" id="5228315">)</span>&nbsp;<span class="builtintype" id="5228317">error</span>&nbsp;<span class="op" id="5228323">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228326">if</span>&nbsp;<span class="ident" id="5228329"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228331">.</span><span class="ident" id="5228332">nb</span>&nbsp;<span class="op" id="5228335">&gt;</span>&nbsp;<span class="num" id="5228337">0</span>&nbsp;<span class="op" id="5228339">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228343"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228345">.</span><span class="ident" id="5228346">err</span>&nbsp;<span class="op" id="5228350">=</span>&nbsp;<span class="ident" id="5228352"><a href="/archive/tar/writer.go.html#5226874">fmt</a></span><span class="op" id="5228355">.</span><span class="ident" id="5228356">Errorf</span><span class="op" id="5228362">(</span><span class="string" id="5228363">&#34;archive/tar:&nbsp;missed&nbsp;writing&nbsp;%d&nbsp;bytes&#34;</span><span class="op" id="5228401">,</span>&nbsp;<span class="ident" id="5228403"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228405">.</span><span class="ident" id="5228406">nb</span><span class="op" id="5228408">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228412">return</span>&nbsp;<span class="ident" id="5228419"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228421">.</span><span class="ident" id="5228422">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228427">}</span><br>
<span class="lineno">55</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228431">n</span>&nbsp;<span class="op" id="5228433">:=</span>&nbsp;<span class="ident" id="5228436"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228438">.</span><span class="ident" id="5228439">nb</span>&nbsp;<span class="op" id="5228442">+</span>&nbsp;<span class="ident" id="5228444"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228446">.</span><span class="ident" id="5228447">pad</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228452">for</span>&nbsp;<span class="ident" id="5228456"><a href="/archive/tar/writer.go.html#5228431">n</a></span>&nbsp;<span class="op" id="5228458">&gt;</span>&nbsp;<span class="num" id="5228460">0</span>&nbsp;<span class="op" id="5228462">&amp;&amp;</span>&nbsp;<span class="ident" id="5228465"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228467">.</span><span class="ident" id="5228468">err</span>&nbsp;<span class="op" id="5228472">==</span>&nbsp;<span class="ident" id="5228475">nil</span>&nbsp;<span class="op" id="5228479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228483">nr</span>&nbsp;<span class="op" id="5228486">:=</span>&nbsp;<span class="ident" id="5228489"><a href="/archive/tar/writer.go.html#5228431">n</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228493">if</span>&nbsp;<span class="ident" id="5228496"><a href="/archive/tar/writer.go.html#5228483">nr</a></span>&nbsp;<span class="op" id="5228499">&gt;</span>&nbsp;<span class="ident" id="5228501"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span>&nbsp;<span class="op" id="5228511">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228516"><a href="/archive/tar/writer.go.html#5228483">nr</a></span>&nbsp;<span class="op" id="5228519">=</span>&nbsp;<span class="ident" id="5228521"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228533">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228537">var</span>&nbsp;<span class="ident" id="5228541">nw</span>&nbsp;<span class="builtintype" id="5228544">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228550"><a href="/archive/tar/writer.go.html#5228541">nw</a></span><span class="op" id="5228552">,</span>&nbsp;<span class="ident" id="5228554"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228556">.</span><span class="ident" id="5228557">err</span>&nbsp;<span class="op" id="5228561">=</span>&nbsp;<span class="ident" id="5228563"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228565">.</span><span class="ident" id="5228566">w</span><span class="op" id="5228567">.</span><span class="ident" id="5228568">Write</span><span class="op" id="5228573">(</span><span class="ident" id="5228574"><a href="/archive/tar/common.go.html#5202212">zeroBlock</a></span><span class="op" id="5228583">[</span><span class="num" id="5228584">0</span><span class="op" id="5228585">:</span><span class="ident" id="5228586"><a href="/archive/tar/writer.go.html#5228483">nr</a></span><span class="op" id="5228588">]</span><span class="op" id="5228589">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228593"><a href="/archive/tar/writer.go.html#5228431">n</a></span>&nbsp;<span class="op" id="5228595">-=</span>&nbsp;<span class="ident" id="5228598">int64</span><span class="op" id="5228603">(</span><span class="ident" id="5228604"><a href="/archive/tar/writer.go.html#5228541">nw</a></span><span class="op" id="5228606">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5228609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228612"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228614">.</span><span class="ident" id="5228615">nb</span>&nbsp;<span class="op" id="5228618">=</span>&nbsp;<span class="num" id="5228620">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228623"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228625">.</span><span class="ident" id="5228626">pad</span>&nbsp;<span class="op" id="5228630">=</span>&nbsp;<span class="num" id="5228632">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228635">return</span>&nbsp;<span class="ident" id="5228642"><a href="/archive/tar/writer.go.html#5228297">tw</a></span><span class="op" id="5228644">.</span><span class="ident" id="5228645">err</span><br>
<span class="lineno"></span><span class="op" id="5228649">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="comment" id="5228652">//&nbsp;Write&nbsp;s&nbsp;into&nbsp;b,&nbsp;terminating&nbsp;it&nbsp;with&nbsp;a&nbsp;NUL&nbsp;if&nbsp;there&nbsp;is&nbsp;room.</span><br>
<span class="lineno"></span><span class="comment" id="5228715">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;allowPax&nbsp;is&nbsp;true&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5228809">func</span>&nbsp;<span class="op" id="5228814">(</span><span class="ident" id="5228815">tw</span>&nbsp;<span class="op" id="5228818">*</span><span class="ident" id="5228819"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5228825">)</span>&nbsp;<span class="ident" id="5228827">cString</span><span class="op" id="5228834">(</span><span class="ident" id="5228835">b</span>&nbsp;<span class="op" id="5228837">[</span><span class="op" id="5228838">]</span><span class="builtintype" id="5228839">byte</span><span class="op" id="5228843">,</span>&nbsp;<span class="ident" id="5228845">s</span>&nbsp;<span class="builtintype" id="5228847">string</span><span class="op" id="5228853">,</span>&nbsp;<span class="ident" id="5228855">allowPax</span>&nbsp;<span class="builtintype" id="5228864">bool</span><span class="op" id="5228868">,</span>&nbsp;<span class="ident" id="5228870">paxKeyword</span>&nbsp;<span class="builtintype" id="5228881">string</span><span class="op" id="5228887">,</span>&nbsp;<span class="ident" id="5228889">paxHeaders</span>&nbsp;<span class="keyword" id="5228900">map</span><span class="op" id="5228903">[</span><span class="builtintype" id="5228904">string</span><span class="op" id="5228910">]</span><span class="builtintype" id="5228911">string</span><span class="op" id="5228917">)</span>&nbsp;<span class="op" id="5228919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5228922">needsPaxHeader</span>&nbsp;<span class="op" id="5228937">:=</span>&nbsp;<span class="ident" id="5228940"><a href="/archive/tar/writer.go.html#5228855">allowPax</a></span>&nbsp;<span class="op" id="5228949">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5228952">len</span><span class="op" id="5228955">(</span><span class="ident" id="5228956"><a href="/archive/tar/writer.go.html#5228845">s</a></span><span class="op" id="5228957">)</span>&nbsp;<span class="op" id="5228959">&gt;</span>&nbsp;<span class="builtinfunc" id="5228961">len</span><span class="op" id="5228964">(</span><span class="ident" id="5228965"><a href="/archive/tar/writer.go.html#5228835">b</a></span><span class="op" id="5228966">)</span>&nbsp;<span class="op" id="5228968">||</span>&nbsp;<span class="op" id="5228971">!</span><span class="ident" id="5228972"><a href="/archive/tar/common.go.html#5202842">isASCII</a></span><span class="op" id="5228979">(</span><span class="ident" id="5228980"><a href="/archive/tar/writer.go.html#5228845">s</a></span><span class="op" id="5228981">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5228984">if</span>&nbsp;<span class="ident" id="5228987"><a href="/archive/tar/writer.go.html#5228922">needsPaxHeader</a></span>&nbsp;<span class="op" id="5229002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229006"><a href="/archive/tar/writer.go.html#5228889">paxHeaders</a></span><span class="op" id="5229016">[</span><span class="ident" id="5229017"><a href="/archive/tar/writer.go.html#5228870">paxKeyword</a></span><span class="op" id="5229027">]</span>&nbsp;<span class="op" id="5229029">=</span>&nbsp;<span class="ident" id="5229031"><a href="/archive/tar/writer.go.html#5228845">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229035">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229043">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229046">if</span>&nbsp;<span class="builtinfunc" id="5229049">len</span><span class="op" id="5229052">(</span><span class="ident" id="5229053"><a href="/archive/tar/writer.go.html#5228845">s</a></span><span class="op" id="5229054">)</span>&nbsp;<span class="op" id="5229056">&gt;</span>&nbsp;<span class="builtinfunc" id="5229058">len</span><span class="op" id="5229061">(</span><span class="ident" id="5229062"><a href="/archive/tar/writer.go.html#5228835">b</a></span><span class="op" id="5229063">)</span>&nbsp;<span class="op" id="5229065">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229069">if</span>&nbsp;<span class="ident" id="5229072"><a href="/archive/tar/writer.go.html#5228815">tw</a></span><span class="op" id="5229074">.</span><span class="ident" id="5229075">err</span>&nbsp;<span class="op" id="5229079">==</span>&nbsp;<span class="ident" id="5229082">nil</span>&nbsp;<span class="op" id="5229086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229091"><a href="/archive/tar/writer.go.html#5228815">tw</a></span><span class="op" id="5229093">.</span><span class="ident" id="5229094">err</span>&nbsp;<span class="op" id="5229098">=</span>&nbsp;<span class="ident" id="5229100"><a href="/archive/tar/writer.go.html#5227004">ErrFieldTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229118">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229122">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229130">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229133">ascii</span>&nbsp;<span class="op" id="5229139">:=</span>&nbsp;<span class="ident" id="5229142"><a href="/archive/tar/common.go.html#5202951">toASCII</a></span><span class="op" id="5229149">(</span><span class="ident" id="5229150"><a href="/archive/tar/writer.go.html#5228845">s</a></span><span class="op" id="5229151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5229154">copy</span><span class="op" id="5229158">(</span><span class="ident" id="5229159"><a href="/archive/tar/writer.go.html#5228835">b</a></span><span class="op" id="5229160">,</span>&nbsp;<span class="ident" id="5229162"><a href="/archive/tar/writer.go.html#5229133">ascii</a></span><span class="op" id="5229167">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229170">if</span>&nbsp;<span class="builtinfunc" id="5229173">len</span><span class="op" id="5229176">(</span><span class="ident" id="5229177"><a href="/archive/tar/writer.go.html#5229133">ascii</a></span><span class="op" id="5229182">)</span>&nbsp;<span class="op" id="5229184">&lt;</span>&nbsp;<span class="builtinfunc" id="5229186">len</span><span class="op" id="5229189">(</span><span class="ident" id="5229190"><a href="/archive/tar/writer.go.html#5228835">b</a></span><span class="op" id="5229191">)</span>&nbsp;<span class="op" id="5229193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229197"><a href="/archive/tar/writer.go.html#5228835">b</a></span><span class="op" id="5229198">[</span><span class="builtinfunc" id="5229199">len</span><span class="op" id="5229202">(</span><span class="ident" id="5229203"><a href="/archive/tar/writer.go.html#5229133">ascii</a></span><span class="op" id="5229208">)</span><span class="op" id="5229209">]</span>&nbsp;<span class="op" id="5229211">=</span>&nbsp;<span class="num" id="5229213">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229216">}</span><br>
<span class="lineno">90</span><span class="op" id="5229218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5229221">//&nbsp;Encode&nbsp;x&nbsp;as&nbsp;an&nbsp;octal&nbsp;ASCII&nbsp;string&nbsp;and&nbsp;write&nbsp;it&nbsp;into&nbsp;b&nbsp;with&nbsp;leading&nbsp;zeros.</span><br>
<span class="lineno"></span><span class="keyword" id="5229298">func</span>&nbsp;<span class="op" id="5229303">(</span><span class="ident" id="5229304">tw</span>&nbsp;<span class="op" id="5229307">*</span><span class="ident" id="5229308"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5229314">)</span>&nbsp;<span class="ident" id="5229316">octal</span><span class="op" id="5229321">(</span><span class="ident" id="5229322">b</span>&nbsp;<span class="op" id="5229324">[</span><span class="op" id="5229325">]</span><span class="builtintype" id="5229326">byte</span><span class="op" id="5229330">,</span>&nbsp;<span class="ident" id="5229332">x</span>&nbsp;<span class="ident" id="5229334">int64</span><span class="op" id="5229339">)</span>&nbsp;<span class="op" id="5229341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229344">s</span>&nbsp;<span class="op" id="5229346">:=</span>&nbsp;<span class="ident" id="5229349"><a href="/archive/tar/writer.go.html#5226901">strconv</a></span><span class="op" id="5229356">.</span><span class="ident" id="5229357">FormatInt</span><span class="op" id="5229366">(</span><span class="ident" id="5229367"><a href="/archive/tar/writer.go.html#5229332">x</a></span><span class="op" id="5229368">,</span>&nbsp;<span class="num" id="5229370">8</span><span class="op" id="5229371">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229374">//&nbsp;leading&nbsp;zeros,&nbsp;but&nbsp;leave&nbsp;room&nbsp;for&nbsp;a&nbsp;NUL.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229419">for</span>&nbsp;<span class="builtinfunc" id="5229423">len</span><span class="op" id="5229426">(</span><span class="ident" id="5229427"><a href="/archive/tar/writer.go.html#5229344">s</a></span><span class="op" id="5229428">)</span><span class="op" id="5229429">+</span><span class="num" id="5229430">1</span>&nbsp;<span class="op" id="5229432">&lt;</span>&nbsp;<span class="builtinfunc" id="5229434">len</span><span class="op" id="5229437">(</span><span class="ident" id="5229438"><a href="/archive/tar/writer.go.html#5229322">b</a></span><span class="op" id="5229439">)</span>&nbsp;<span class="op" id="5229441">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229445"><a href="/archive/tar/writer.go.html#5229344">s</a></span>&nbsp;<span class="op" id="5229447">=</span>&nbsp;<span class="string" id="5229449">&#34;0&#34;</span>&nbsp;<span class="op" id="5229453">+</span>&nbsp;<span class="ident" id="5229455"><a href="/archive/tar/writer.go.html#5229344">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229461"><a href="/archive/tar/writer.go.html#5229304">tw</a></span><span class="op" id="5229463">.</span><span class="ident" id="5229464">cString</span><span class="op" id="5229471">(</span><span class="ident" id="5229472"><a href="/archive/tar/writer.go.html#5229322">b</a></span><span class="op" id="5229473">,</span>&nbsp;<span class="ident" id="5229475"><a href="/archive/tar/writer.go.html#5229344">s</a></span><span class="op" id="5229476">,</span>&nbsp;<span class="ident" id="5229478">false</span><span class="op" id="5229483">,</span>&nbsp;<span class="ident" id="5229485"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5229492">,</span>&nbsp;<span class="ident" id="5229494">nil</span><span class="op" id="5229497">)</span><br>
<span class="lineno">100</span><span class="op" id="5229499">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5229502">//&nbsp;Write&nbsp;x&nbsp;into&nbsp;b,&nbsp;either&nbsp;as&nbsp;octal&nbsp;or&nbsp;as&nbsp;binary&nbsp;(GNUtar/star&nbsp;extension).</span><br>
<span class="lineno"></span><span class="comment" id="5229575">//&nbsp;If&nbsp;the&nbsp;value&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;writingPax&nbsp;is&nbsp;enabled&nbsp;both&nbsp;for&nbsp;the&nbsp;field&nbsp;and&nbsp;the&nbsp;add&nbsp;a&nbsp;paxheader&nbsp;record&nbsp;instead</span><br>
<span class="lineno"></span><span class="keyword" id="5229701">func</span>&nbsp;<span class="op" id="5229706">(</span><span class="ident" id="5229707">tw</span>&nbsp;<span class="op" id="5229710">*</span><span class="ident" id="5229711"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5229717">)</span>&nbsp;<span class="ident" id="5229719">numeric</span><span class="op" id="5229726">(</span><span class="ident" id="5229727">b</span>&nbsp;<span class="op" id="5229729">[</span><span class="op" id="5229730">]</span><span class="builtintype" id="5229731">byte</span><span class="op" id="5229735">,</span>&nbsp;<span class="ident" id="5229737">x</span>&nbsp;<span class="ident" id="5229739">int64</span><span class="op" id="5229744">,</span>&nbsp;<span class="ident" id="5229746">allowPax</span>&nbsp;<span class="builtintype" id="5229755">bool</span><span class="op" id="5229759">,</span>&nbsp;<span class="ident" id="5229761">paxKeyword</span>&nbsp;<span class="builtintype" id="5229772">string</span><span class="op" id="5229778">,</span>&nbsp;<span class="ident" id="5229780">paxHeaders</span>&nbsp;<span class="keyword" id="5229791">map</span><span class="op" id="5229794">[</span><span class="builtintype" id="5229795">string</span><span class="op" id="5229801">]</span><span class="builtintype" id="5229802">string</span><span class="op" id="5229808">)</span>&nbsp;<span class="op" id="5229810">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229813">//&nbsp;Try&nbsp;octal&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229834">s</span>&nbsp;<span class="op" id="5229836">:=</span>&nbsp;<span class="ident" id="5229839"><a href="/archive/tar/writer.go.html#5226901">strconv</a></span><span class="op" id="5229846">.</span><span class="ident" id="5229847">FormatInt</span><span class="op" id="5229856">(</span><span class="ident" id="5229857"><a href="/archive/tar/writer.go.html#5229737">x</a></span><span class="op" id="5229858">,</span>&nbsp;<span class="num" id="5229860">8</span><span class="op" id="5229861">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229864">if</span>&nbsp;<span class="builtinfunc" id="5229867">len</span><span class="op" id="5229870">(</span><span class="ident" id="5229871"><a href="/archive/tar/writer.go.html#5229834">s</a></span><span class="op" id="5229872">)</span>&nbsp;<span class="op" id="5229874">&lt;</span>&nbsp;<span class="builtinfunc" id="5229876">len</span><span class="op" id="5229879">(</span><span class="ident" id="5229880"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5229881">)</span>&nbsp;<span class="op" id="5229883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5229887"><a href="/archive/tar/writer.go.html#5229707">tw</a></span><span class="op" id="5229889">.</span><span class="ident" id="5229890">octal</span><span class="op" id="5229895">(</span><span class="ident" id="5229896"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5229897">,</span>&nbsp;<span class="ident" id="5229899"><a href="/archive/tar/writer.go.html#5229737">x</a></span><span class="op" id="5229900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229904">return</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5229912">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5229916">//&nbsp;If&nbsp;it&nbsp;is&nbsp;too&nbsp;long&nbsp;for&nbsp;octal,&nbsp;and&nbsp;pax&nbsp;is&nbsp;preferred,&nbsp;use&nbsp;a&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5229988">if</span>&nbsp;<span class="ident" id="5229991"><a href="/archive/tar/writer.go.html#5229746">allowPax</a></span>&nbsp;<span class="op" id="5230000">&amp;&amp;</span>&nbsp;<span class="ident" id="5230003"><a href="/archive/tar/writer.go.html#5229707">tw</a></span><span class="op" id="5230005">.</span><span class="ident" id="5230006">preferPax</span>&nbsp;<span class="op" id="5230016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230020"><a href="/archive/tar/writer.go.html#5229707">tw</a></span><span class="op" id="5230022">.</span><span class="ident" id="5230023">octal</span><span class="op" id="5230028">(</span><span class="ident" id="5230029"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5230030">,</span>&nbsp;<span class="num" id="5230032">0</span><span class="op" id="5230033">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230037">s</span>&nbsp;<span class="op" id="5230039">:=</span>&nbsp;<span class="ident" id="5230042"><a href="/archive/tar/writer.go.html#5226901">strconv</a></span><span class="op" id="5230049">.</span><span class="ident" id="5230050">FormatInt</span><span class="op" id="5230059">(</span><span class="ident" id="5230060"><a href="/archive/tar/writer.go.html#5229737">x</a></span><span class="op" id="5230061">,</span>&nbsp;<span class="num" id="5230063">10</span><span class="op" id="5230065">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230069"><a href="/archive/tar/writer.go.html#5229780">paxHeaders</a></span><span class="op" id="5230079">[</span><span class="ident" id="5230080"><a href="/archive/tar/writer.go.html#5229761">paxKeyword</a></span><span class="op" id="5230090">]</span>&nbsp;<span class="op" id="5230092">=</span>&nbsp;<span class="ident" id="5230094"><a href="/archive/tar/writer.go.html#5230037">s</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230098">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230106">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230110">//&nbsp;Too&nbsp;big:&nbsp;use&nbsp;binary&nbsp;(big-endian).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230148"><a href="/archive/tar/writer.go.html#5229707">tw</a></span><span class="op" id="5230150">.</span><span class="ident" id="5230151">usedBinary</span>&nbsp;<span class="op" id="5230162">=</span>&nbsp;<span class="ident" id="5230164">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230170">for</span>&nbsp;<span class="ident" id="5230174">i</span>&nbsp;<span class="op" id="5230176">:=</span>&nbsp;<span class="builtinfunc" id="5230179">len</span><span class="op" id="5230182">(</span><span class="ident" id="5230183"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5230184">)</span>&nbsp;<span class="op" id="5230186">-</span>&nbsp;<span class="num" id="5230188">1</span><span class="op" id="5230189">;</span>&nbsp;<span class="ident" id="5230191"><a href="/archive/tar/writer.go.html#5229737">x</a></span>&nbsp;<span class="op" id="5230193">&gt;</span>&nbsp;<span class="num" id="5230195">0</span>&nbsp;<span class="op" id="5230197">&amp;&amp;</span>&nbsp;<span class="ident" id="5230200"><a href="/archive/tar/writer.go.html#5230174">i</a></span>&nbsp;<span class="op" id="5230202">&gt;=</span>&nbsp;<span class="num" id="5230205">0</span><span class="op" id="5230206">;</span>&nbsp;<span class="ident" id="5230208"><a href="/archive/tar/writer.go.html#5230174">i</a></span><span class="op" id="5230209">--</span>&nbsp;<span class="op" id="5230212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230216"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5230217">[</span><span class="ident" id="5230218"><a href="/archive/tar/writer.go.html#5230174">i</a></span><span class="op" id="5230219">]</span>&nbsp;<span class="op" id="5230221">=</span>&nbsp;<span class="builtintype" id="5230223">byte</span><span class="op" id="5230227">(</span><span class="ident" id="5230228"><a href="/archive/tar/writer.go.html#5229737">x</a></span><span class="op" id="5230229">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230233"><a href="/archive/tar/writer.go.html#5229737">x</a></span>&nbsp;<span class="op" id="5230235">&gt;&gt;=</span>&nbsp;<span class="num" id="5230239">8</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5230242">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230245"><a href="/archive/tar/writer.go.html#5229727">b</a></span><span class="op" id="5230246">[</span><span class="num" id="5230247">0</span><span class="op" id="5230248">]</span>&nbsp;<span class="op" id="5230250">|=</span>&nbsp;<span class="num" id="5230253">0x80</span>&nbsp;<span class="comment" id="5230258">//&nbsp;highest&nbsp;bit&nbsp;indicates&nbsp;binary&nbsp;format</span><br>
<span class="lineno"></span><span class="op" id="5230297">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5230300">var</span>&nbsp;<span class="op" id="5230304">(</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230307">minTime</span>&nbsp;<span class="op" id="5230315">=</span>&nbsp;<span class="ident" id="5230317"><a href="/archive/tar/writer.go.html#5226923">time</a></span><span class="op" id="5230321">.</span><span class="ident" id="5230322">Unix</span><span class="op" id="5230326">(</span><span class="num" id="5230327">0</span><span class="op" id="5230328">,</span>&nbsp;<span class="num" id="5230330">0</span><span class="op" id="5230331">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5230334">//&nbsp;There&nbsp;is&nbsp;room&nbsp;for&nbsp;11&nbsp;octal&nbsp;digits&nbsp;(33&nbsp;bits)&nbsp;of&nbsp;mtime.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5230392">maxTime</span>&nbsp;<span class="op" id="5230400">=</span>&nbsp;<span class="ident" id="5230402"><a href="/archive/tar/writer.go.html#5230307">minTime</a></span><span class="op" id="5230409">.</span><span class="ident" id="5230410">Add</span><span class="op" id="5230413">(</span><span class="op" id="5230414">(</span><span class="num" id="5230415">1</span><span class="op" id="5230416">&lt;&lt;</span><span class="num" id="5230418">33</span>&nbsp;<span class="op" id="5230421">-</span>&nbsp;<span class="num" id="5230423">1</span><span class="op" id="5230424">)</span>&nbsp;<span class="op" id="5230426">*</span>&nbsp;<span class="ident" id="5230428"><a href="/archive/tar/writer.go.html#5226923">time</a></span><span class="op" id="5230432">.</span><span class="ident" id="5230433">Second</span><span class="op" id="5230439">)</span><br>
<span class="lineno"></span><span class="op" id="5230441">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">135</span><span class="comment" id="5230444">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5230514">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5230572">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno"></span><span class="keyword" id="5230629">func</span>&nbsp;<span class="op" id="5230634">(</span><span class="ident" id="5230635">tw</span>&nbsp;<span class="op" id="5230638">*</span><span class="ident" id="5230639"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5230645">)</span>&nbsp;<span class="ident" id="5230647">WriteHeader</span><span class="op" id="5230658">(</span><span class="ident" id="5230659">hdr</span>&nbsp;<span class="op" id="5230663">*</span><span class="ident" id="5230664"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="5230670">)</span>&nbsp;<span class="builtintype" id="5230672">error</span>&nbsp;<span class="op" id="5230678">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5230681">return</span>&nbsp;<span class="ident" id="5230688"><a href="/archive/tar/writer.go.html#5230635">tw</a></span><span class="op" id="5230690">.</span><span class="ident" id="5230691">writeHeader</span><span class="op" id="5230702">(</span><span class="ident" id="5230703"><a href="/archive/tar/writer.go.html#5230659">hdr</a></span><span class="op" id="5230706">,</span>&nbsp;<span class="ident" id="5230708">true</span><span class="op" id="5230712">)</span><br>
<span class="lineno">140</span><span class="op" id="5230714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5230717">//&nbsp;WriteHeader&nbsp;writes&nbsp;hdr&nbsp;and&nbsp;prepares&nbsp;to&nbsp;accept&nbsp;the&nbsp;file&#39;s&nbsp;contents.</span><br>
<span class="lineno"></span><span class="comment" id="5230787">//&nbsp;WriteHeader&nbsp;calls&nbsp;Flush&nbsp;if&nbsp;it&nbsp;is&nbsp;not&nbsp;the&nbsp;first&nbsp;header.</span><br>
<span class="lineno"></span><span class="comment" id="5230845">//&nbsp;Calling&nbsp;after&nbsp;a&nbsp;Close&nbsp;will&nbsp;return&nbsp;ErrWriteAfterClose.</span><br>
<span class="lineno">145</span><span class="comment" id="5230902">//&nbsp;As&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;internally&nbsp;by&nbsp;writePax&nbsp;header&nbsp;to&nbsp;allow&nbsp;it&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="5230975">//&nbsp;suppress&nbsp;writing&nbsp;the&nbsp;pax&nbsp;header.</span><br>
<span class="lineno"></span><span class="keyword" id="5231011">func</span>&nbsp;<span class="op" id="5231016">(</span><span class="ident" id="5231017">tw</span>&nbsp;<span class="op" id="5231020">*</span><span class="ident" id="5231021"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5231027">)</span>&nbsp;<span class="ident" id="5231029">writeHeader</span><span class="op" id="5231040">(</span><span class="ident" id="5231041">hdr</span>&nbsp;<span class="op" id="5231045">*</span><span class="ident" id="5231046"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="5231052">,</span>&nbsp;<span class="ident" id="5231054">allowPax</span>&nbsp;<span class="builtintype" id="5231063">bool</span><span class="op" id="5231067">)</span>&nbsp;<span class="builtintype" id="5231069">error</span>&nbsp;<span class="op" id="5231075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231078">if</span>&nbsp;<span class="ident" id="5231081"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231083">.</span><span class="ident" id="5231084">closed</span>&nbsp;<span class="op" id="5231091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231095">return</span>&nbsp;<span class="ident" id="5231102"><a href="/archive/tar/writer.go.html#5227075">ErrWriteAfterClose</a></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231125">if</span>&nbsp;<span class="ident" id="5231128"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231130">.</span><span class="ident" id="5231131">err</span>&nbsp;<span class="op" id="5231135">==</span>&nbsp;<span class="ident" id="5231138">nil</span>&nbsp;<span class="op" id="5231142">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231146"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231148">.</span><span class="ident" id="5231149">Flush</span><span class="op" id="5231154">(</span><span class="op" id="5231155">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231158">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231161">if</span>&nbsp;<span class="ident" id="5231164"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231166">.</span><span class="ident" id="5231167">err</span>&nbsp;<span class="op" id="5231171">!=</span>&nbsp;<span class="ident" id="5231174">nil</span>&nbsp;<span class="op" id="5231178">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231182">return</span>&nbsp;<span class="ident" id="5231189"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231191">.</span><span class="ident" id="5231192">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231197">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231201">//&nbsp;a&nbsp;map&nbsp;to&nbsp;hold&nbsp;pax&nbsp;header&nbsp;records,&nbsp;if&nbsp;any&nbsp;are&nbsp;needed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231257">paxHeaders</span>&nbsp;<span class="op" id="5231268">:=</span>&nbsp;<span class="builtinfunc" id="5231271">make</span><span class="op" id="5231275">(</span><span class="keyword" id="5231276">map</span><span class="op" id="5231279">[</span><span class="builtintype" id="5231280">string</span><span class="op" id="5231286">]</span><span class="builtintype" id="5231287">string</span><span class="op" id="5231293">)</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231297">//&nbsp;TODO(shanemhansen):&nbsp;we&nbsp;might&nbsp;want&nbsp;to&nbsp;use&nbsp;PAX&nbsp;headers&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231358">//&nbsp;subsecond&nbsp;time&nbsp;resolution,&nbsp;but&nbsp;for&nbsp;now&nbsp;let&#39;s&nbsp;just&nbsp;capture</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231420">//&nbsp;too&nbsp;long&nbsp;fields&nbsp;or&nbsp;non&nbsp;ascii&nbsp;characters</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231465">var</span>&nbsp;<span class="ident" id="5231469">header</span>&nbsp;<span class="op" id="5231476">[</span><span class="op" id="5231477">]</span><span class="builtintype" id="5231478">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231485">//&nbsp;We&nbsp;need&nbsp;to&nbsp;select&nbsp;which&nbsp;scratch&nbsp;buffer&nbsp;to&nbsp;use&nbsp;carefully,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231546">//&nbsp;since&nbsp;this&nbsp;method&nbsp;is&nbsp;called&nbsp;recursively&nbsp;to&nbsp;write&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231612">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;true,&nbsp;this&nbsp;is&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;and&nbsp;we&nbsp;will&nbsp;use&nbsp;hdrBuff.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231694">//&nbsp;If&nbsp;allowPax&nbsp;is&nbsp;false,&nbsp;we&nbsp;are&nbsp;being&nbsp;called&nbsp;by&nbsp;writePAXHeader,&nbsp;and&nbsp;hdrBuff&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231774">//&nbsp;already&nbsp;being&nbsp;used&nbsp;by&nbsp;the&nbsp;non-recursive&nbsp;call,&nbsp;so&nbsp;we&nbsp;must&nbsp;use&nbsp;paxHdrBuff.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231851"><a href="/archive/tar/writer.go.html#5231469">header</a></span>&nbsp;<span class="op" id="5231858">=</span>&nbsp;<span class="ident" id="5231860"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231862">.</span><span class="ident" id="5231863">hdrBuff</span><span class="op" id="5231870">[</span><span class="op" id="5231871">:</span><span class="op" id="5231872">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5231875">if</span>&nbsp;<span class="op" id="5231878">!</span><span class="ident" id="5231879"><a href="/archive/tar/writer.go.html#5231054">allowPax</a></span>&nbsp;<span class="op" id="5231888">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231892"><a href="/archive/tar/writer.go.html#5231469">header</a></span>&nbsp;<span class="op" id="5231899">=</span>&nbsp;<span class="ident" id="5231901"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5231903">.</span><span class="ident" id="5231904">paxHdrBuff</span><span class="op" id="5231914">[</span><span class="op" id="5231915">:</span><span class="op" id="5231916">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5231919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5231922">copy</span><span class="op" id="5231926">(</span><span class="ident" id="5231927"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5231933">,</span>&nbsp;<span class="ident" id="5231935"><a href="/archive/tar/common.go.html#5202212">zeroBlock</a></span><span class="op" id="5231944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5231947">s</span>&nbsp;<span class="op" id="5231949">:=</span>&nbsp;<span class="ident" id="5231952"><a href="/archive/tar/common.go.html#5202734">slicer</a></span><span class="op" id="5231958">(</span><span class="ident" id="5231959"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5231965">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5231969">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;filename&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232097">pathHeaderBytes</span>&nbsp;<span class="op" id="5232113">:=</span>&nbsp;<span class="ident" id="5232116"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232117">.</span><span class="ident" id="5232118">next</span><span class="op" id="5232122">(</span><span class="ident" id="5232123"><a href="/archive/tar/common.go.html#5197503">fileNameSize</a></span><span class="op" id="5232135">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232139"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232141">.</span><span class="ident" id="5232142">cString</span><span class="op" id="5232149">(</span><span class="ident" id="5232150"><a href="/archive/tar/writer.go.html#5232097">pathHeaderBytes</a></span><span class="op" id="5232165">,</span>&nbsp;<span class="ident" id="5232167"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232170">.</span><span class="ident" id="5232171">Name</span><span class="op" id="5232175">,</span>&nbsp;<span class="ident" id="5232177">true</span><span class="op" id="5232181">,</span>&nbsp;<span class="ident" id="5232183"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span><span class="op" id="5232190">,</span>&nbsp;<span class="ident" id="5232192"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5232202">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5232206">//&nbsp;Handle&nbsp;out&nbsp;of&nbsp;range&nbsp;ModTime&nbsp;carefully.</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232249">var</span>&nbsp;<span class="ident" id="5232253">modTime</span>&nbsp;<span class="ident" id="5232261">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5232268">if</span>&nbsp;<span class="op" id="5232271">!</span><span class="ident" id="5232272"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232275">.</span><span class="ident" id="5232276">ModTime</span><span class="op" id="5232283">.</span><span class="ident" id="5232284">Before</span><span class="op" id="5232290">(</span><span class="ident" id="5232291"><a href="/archive/tar/writer.go.html#5230307">minTime</a></span><span class="op" id="5232298">)</span>&nbsp;<span class="op" id="5232300">&amp;&amp;</span>&nbsp;<span class="op" id="5232303">!</span><span class="ident" id="5232304"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232307">.</span><span class="ident" id="5232308">ModTime</span><span class="op" id="5232315">.</span><span class="ident" id="5232316">After</span><span class="op" id="5232321">(</span><span class="ident" id="5232322"><a href="/archive/tar/writer.go.html#5230392">maxTime</a></span><span class="op" id="5232329">)</span>&nbsp;<span class="op" id="5232331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232335"><a href="/archive/tar/writer.go.html#5232253">modTime</a></span>&nbsp;<span class="op" id="5232343">=</span>&nbsp;<span class="ident" id="5232345"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232348">.</span><span class="ident" id="5232349">ModTime</span><span class="op" id="5232356">.</span><span class="ident" id="5232357">Unix</span><span class="op" id="5232361">(</span><span class="op" id="5232362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5232365">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232369"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232371">.</span><span class="ident" id="5232372">octal</span><span class="op" id="5232377">(</span><span class="ident" id="5232378"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232379">.</span><span class="ident" id="5232380">next</span><span class="op" id="5232384">(</span><span class="num" id="5232385">8</span><span class="op" id="5232386">)</span><span class="op" id="5232387">,</span>&nbsp;<span class="ident" id="5232389"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232392">.</span><span class="ident" id="5232393">Mode</span><span class="op" id="5232397">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232433">//&nbsp;100:108</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232445"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232447">.</span><span class="ident" id="5232448">numeric</span><span class="op" id="5232455">(</span><span class="ident" id="5232456"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232457">.</span><span class="ident" id="5232458">next</span><span class="op" id="5232462">(</span><span class="num" id="5232463">8</span><span class="op" id="5232464">)</span><span class="op" id="5232465">,</span>&nbsp;<span class="ident" id="5232467">int64</span><span class="op" id="5232472">(</span><span class="ident" id="5232473"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232476">.</span><span class="ident" id="5232477">Uid</span><span class="op" id="5232480">)</span><span class="op" id="5232481">,</span>&nbsp;<span class="ident" id="5232483">true</span><span class="op" id="5232487">,</span>&nbsp;<span class="ident" id="5232489"><a href="/archive/tar/common.go.html#5200549">paxUid</a></span><span class="op" id="5232495">,</span>&nbsp;<span class="ident" id="5232497"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5232507">)</span>&nbsp;<span class="comment" id="5232509">//&nbsp;108:116</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232521"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232523">.</span><span class="ident" id="5232524">numeric</span><span class="op" id="5232531">(</span><span class="ident" id="5232532"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232533">.</span><span class="ident" id="5232534">next</span><span class="op" id="5232538">(</span><span class="num" id="5232539">8</span><span class="op" id="5232540">)</span><span class="op" id="5232541">,</span>&nbsp;<span class="ident" id="5232543">int64</span><span class="op" id="5232548">(</span><span class="ident" id="5232549"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232552">.</span><span class="ident" id="5232553">Gid</span><span class="op" id="5232556">)</span><span class="op" id="5232557">,</span>&nbsp;<span class="ident" id="5232559">true</span><span class="op" id="5232563">,</span>&nbsp;<span class="ident" id="5232565"><a href="/archive/tar/common.go.html#5200412">paxGid</a></span><span class="op" id="5232571">,</span>&nbsp;<span class="ident" id="5232573"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5232583">)</span>&nbsp;<span class="comment" id="5232585">//&nbsp;116:124</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232597"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232599">.</span><span class="ident" id="5232600">numeric</span><span class="op" id="5232607">(</span><span class="ident" id="5232608"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232609">.</span><span class="ident" id="5232610">next</span><span class="op" id="5232614">(</span><span class="num" id="5232615">12</span><span class="op" id="5232617">)</span><span class="op" id="5232618">,</span>&nbsp;<span class="ident" id="5232620"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232623">.</span><span class="ident" id="5232624">Size</span><span class="op" id="5232628">,</span>&nbsp;<span class="ident" id="5232630">true</span><span class="op" id="5232634">,</span>&nbsp;<span class="ident" id="5232636"><a href="/archive/tar/common.go.html#5200527">paxSize</a></span><span class="op" id="5232643">,</span>&nbsp;<span class="ident" id="5232645"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5232655">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232661">//&nbsp;124:136</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232673"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232675">.</span><span class="ident" id="5232676">numeric</span><span class="op" id="5232683">(</span><span class="ident" id="5232684"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232685">.</span><span class="ident" id="5232686">next</span><span class="op" id="5232690">(</span><span class="num" id="5232691">12</span><span class="op" id="5232693">)</span><span class="op" id="5232694">,</span>&nbsp;<span class="ident" id="5232696"><a href="/archive/tar/writer.go.html#5232253">modTime</a></span><span class="op" id="5232703">,</span>&nbsp;<span class="ident" id="5232705">false</span><span class="op" id="5232710">,</span>&nbsp;<span class="ident" id="5232712"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5232719">,</span>&nbsp;<span class="ident" id="5232721">nil</span><span class="op" id="5232724">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232737">//&nbsp;136:148&nbsp;---&nbsp;consider&nbsp;using&nbsp;pax&nbsp;for&nbsp;finer&nbsp;granularity</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232794"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232795">.</span><span class="ident" id="5232796">next</span><span class="op" id="5232800">(</span><span class="num" id="5232801">8</span><span class="op" id="5232802">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232858">//&nbsp;chksum&nbsp;(148:156)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232879"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232880">.</span><span class="ident" id="5232881">next</span><span class="op" id="5232885">(</span><span class="num" id="5232886">1</span><span class="op" id="5232887">)</span><span class="op" id="5232888">[</span><span class="num" id="5232889">0</span><span class="op" id="5232890">]</span>&nbsp;<span class="op" id="5232892">=</span>&nbsp;<span class="ident" id="5232894"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232897">.</span><span class="ident" id="5232898">Typeflag</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5232943">//&nbsp;156:157</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5232956"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5232958">.</span><span class="ident" id="5232959">cString</span><span class="op" id="5232966">(</span><span class="ident" id="5232967"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5232968">.</span><span class="ident" id="5232969">next</span><span class="op" id="5232973">(</span><span class="num" id="5232974">100</span><span class="op" id="5232977">)</span><span class="op" id="5232978">,</span>&nbsp;<span class="ident" id="5232980"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5232983">.</span><span class="ident" id="5232984">Linkname</span><span class="op" id="5232992">,</span>&nbsp;<span class="ident" id="5232994">true</span><span class="op" id="5232998">,</span>&nbsp;<span class="ident" id="5233000"><a href="/archive/tar/common.go.html#5200456">paxLinkpath</a></span><span class="op" id="5233011">,</span>&nbsp;<span class="ident" id="5233013"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5233023">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5233027">copy</span><span class="op" id="5233031">(</span><span class="ident" id="5233032"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233033">.</span><span class="ident" id="5233034">next</span><span class="op" id="5233038">(</span><span class="num" id="5233039">8</span><span class="op" id="5233040">)</span><span class="op" id="5233041">,</span>&nbsp;<span class="op" id="5233043">[</span><span class="op" id="5233044">]</span><span class="builtintype" id="5233045">byte</span><span class="op" id="5233049">(</span><span class="string" id="5233050">&#34;ustar\x0000&#34;</span><span class="op" id="5233063">)</span><span class="op" id="5233064">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233089">//&nbsp;257:265</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233101"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233103">.</span><span class="ident" id="5233104">cString</span><span class="op" id="5233111">(</span><span class="ident" id="5233112"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233113">.</span><span class="ident" id="5233114">next</span><span class="op" id="5233118">(</span><span class="num" id="5233119">32</span><span class="op" id="5233121">)</span><span class="op" id="5233122">,</span>&nbsp;<span class="ident" id="5233124"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233127">.</span><span class="ident" id="5233128">Uname</span><span class="op" id="5233133">,</span>&nbsp;<span class="ident" id="5233135">true</span><span class="op" id="5233139">,</span>&nbsp;<span class="ident" id="5233141"><a href="/archive/tar/common.go.html#5200570">paxUname</a></span><span class="op" id="5233149">,</span>&nbsp;<span class="ident" id="5233151"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5233161">)</span>&nbsp;<span class="comment" id="5233163">//&nbsp;265:297</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233175"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233177">.</span><span class="ident" id="5233178">cString</span><span class="op" id="5233185">(</span><span class="ident" id="5233186"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233187">.</span><span class="ident" id="5233188">next</span><span class="op" id="5233192">(</span><span class="num" id="5233193">32</span><span class="op" id="5233195">)</span><span class="op" id="5233196">,</span>&nbsp;<span class="ident" id="5233198"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233201">.</span><span class="ident" id="5233202">Gname</span><span class="op" id="5233207">,</span>&nbsp;<span class="ident" id="5233209">true</span><span class="op" id="5233213">,</span>&nbsp;<span class="ident" id="5233215"><a href="/archive/tar/common.go.html#5200433">paxGname</a></span><span class="op" id="5233223">,</span>&nbsp;<span class="ident" id="5233225"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5233235">)</span>&nbsp;<span class="comment" id="5233237">//&nbsp;297:329</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233249"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233251">.</span><span class="ident" id="5233252">numeric</span><span class="op" id="5233259">(</span><span class="ident" id="5233260"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233261">.</span><span class="ident" id="5233262">next</span><span class="op" id="5233266">(</span><span class="num" id="5233267">8</span><span class="op" id="5233268">)</span><span class="op" id="5233269">,</span>&nbsp;<span class="ident" id="5233271"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233274">.</span><span class="ident" id="5233275">Devmajor</span><span class="op" id="5233283">,</span>&nbsp;<span class="ident" id="5233285">false</span><span class="op" id="5233290">,</span>&nbsp;<span class="ident" id="5233292"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5233299">,</span>&nbsp;<span class="ident" id="5233301">nil</span><span class="op" id="5233304">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233311">//&nbsp;329:337</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233323"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233325">.</span><span class="ident" id="5233326">numeric</span><span class="op" id="5233333">(</span><span class="ident" id="5233334"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233335">.</span><span class="ident" id="5233336">next</span><span class="op" id="5233340">(</span><span class="num" id="5233341">8</span><span class="op" id="5233342">)</span><span class="op" id="5233343">,</span>&nbsp;<span class="ident" id="5233345"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233348">.</span><span class="ident" id="5233349">Devminor</span><span class="op" id="5233357">,</span>&nbsp;<span class="ident" id="5233359">false</span><span class="op" id="5233364">,</span>&nbsp;<span class="ident" id="5233366"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5233373">,</span>&nbsp;<span class="ident" id="5233375">nil</span><span class="op" id="5233378">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5233385">//&nbsp;337:345</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233398">//&nbsp;keep&nbsp;a&nbsp;reference&nbsp;to&nbsp;the&nbsp;prefix&nbsp;to&nbsp;allow&nbsp;to&nbsp;overwrite&nbsp;it&nbsp;later&nbsp;if&nbsp;we&nbsp;detect&nbsp;that&nbsp;we&nbsp;can&nbsp;use&nbsp;ustar&nbsp;longnames&nbsp;instead&nbsp;of&nbsp;pax</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233524">prefixHeaderBytes</span>&nbsp;<span class="op" id="5233542">:=</span>&nbsp;<span class="ident" id="5233545"><a href="/archive/tar/writer.go.html#5231947">s</a></span><span class="op" id="5233546">.</span><span class="ident" id="5233547">next</span><span class="op" id="5233551">(</span><span class="num" id="5233552">155</span><span class="op" id="5233555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233558"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233560">.</span><span class="ident" id="5233561">cString</span><span class="op" id="5233568">(</span><span class="ident" id="5233569"><a href="/archive/tar/writer.go.html#5233524">prefixHeaderBytes</a></span><span class="op" id="5233586">,</span>&nbsp;<span class="string" id="5233588">&#34;&#34;</span><span class="op" id="5233590">,</span>&nbsp;<span class="ident" id="5233592">false</span><span class="op" id="5233597">,</span>&nbsp;<span class="ident" id="5233599"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5233606">,</span>&nbsp;<span class="ident" id="5233608">nil</span><span class="op" id="5233611">)</span>&nbsp;<span class="comment" id="5233613">//&nbsp;345:500&nbsp;&nbsp;prefix</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233634">//&nbsp;Use&nbsp;the&nbsp;GNU&nbsp;magic&nbsp;instead&nbsp;of&nbsp;POSIX&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;any&nbsp;GNU&nbsp;extensions.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233710">if</span>&nbsp;<span class="ident" id="5233713"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233715">.</span><span class="ident" id="5233716">usedBinary</span>&nbsp;<span class="op" id="5233727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5233731">copy</span><span class="op" id="5233735">(</span><span class="ident" id="5233736"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5233742">[</span><span class="num" id="5233743">257</span><span class="op" id="5233746">:</span><span class="num" id="5233747">265</span><span class="op" id="5233750">]</span><span class="op" id="5233751">,</span>&nbsp;<span class="op" id="5233753">[</span><span class="op" id="5233754">]</span><span class="builtintype" id="5233755">byte</span><span class="op" id="5233759">(</span><span class="string" id="5233760">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5233773">)</span><span class="op" id="5233774">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5233777">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233781">_</span><span class="op" id="5233782">,</span>&nbsp;<span class="ident" id="5233784">paxPathUsed</span>&nbsp;<span class="op" id="5233796">:=</span>&nbsp;<span class="ident" id="5233799"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5233809">[</span><span class="ident" id="5233810"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span><span class="op" id="5233817">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5233820">//&nbsp;try&nbsp;to&nbsp;use&nbsp;a&nbsp;ustar&nbsp;header&nbsp;when&nbsp;only&nbsp;the&nbsp;name&nbsp;is&nbsp;too&nbsp;long</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233881">if</span>&nbsp;<span class="op" id="5233884">!</span><span class="ident" id="5233885"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5233887">.</span><span class="ident" id="5233888">preferPax</span>&nbsp;<span class="op" id="5233898">&amp;&amp;</span>&nbsp;<span class="builtinfunc" id="5233901">len</span><span class="op" id="5233904">(</span><span class="ident" id="5233905"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5233915">)</span>&nbsp;<span class="op" id="5233917">==</span>&nbsp;<span class="num" id="5233920">1</span>&nbsp;<span class="op" id="5233922">&amp;&amp;</span>&nbsp;<span class="ident" id="5233925"><a href="/archive/tar/writer.go.html#5233784">paxPathUsed</a></span>&nbsp;<span class="op" id="5233937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233941">suffix</span>&nbsp;<span class="op" id="5233948">:=</span>&nbsp;<span class="ident" id="5233951"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233954">.</span><span class="ident" id="5233955">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5233962">prefix</span>&nbsp;<span class="op" id="5233969">:=</span>&nbsp;<span class="string" id="5233972">&#34;&#34;</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5233977">if</span>&nbsp;<span class="builtinfunc" id="5233980">len</span><span class="op" id="5233983">(</span><span class="ident" id="5233984"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5233987">.</span><span class="ident" id="5233988">Name</span><span class="op" id="5233992">)</span>&nbsp;<span class="op" id="5233994">&gt;</span>&nbsp;<span class="ident" id="5233996"><a href="/archive/tar/common.go.html#5197503">fileNameSize</a></span>&nbsp;<span class="op" id="5234009">&amp;&amp;</span>&nbsp;<span class="ident" id="5234012"><a href="/archive/tar/common.go.html#5202842">isASCII</a></span><span class="op" id="5234019">(</span><span class="ident" id="5234020"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5234023">.</span><span class="ident" id="5234024">Name</span><span class="op" id="5234028">)</span>&nbsp;<span class="op" id="5234030">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234035">var</span>&nbsp;<span class="ident" id="5234039">err</span>&nbsp;<span class="builtintype" id="5234043">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234052"><a href="/archive/tar/writer.go.html#5233962">prefix</a></span><span class="op" id="5234058">,</span>&nbsp;<span class="ident" id="5234060"><a href="/archive/tar/writer.go.html#5233941">suffix</a></span><span class="op" id="5234066">,</span>&nbsp;<span class="ident" id="5234068"><a href="/archive/tar/writer.go.html#5234039">err</a></span>&nbsp;<span class="op" id="5234072">=</span>&nbsp;<span class="ident" id="5234074"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234076">.</span><span class="ident" id="5234077">splitUSTARLongName</span><span class="op" id="5234095">(</span><span class="ident" id="5234096"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5234099">.</span><span class="ident" id="5234100">Name</span><span class="op" id="5234104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234109">if</span>&nbsp;<span class="ident" id="5234112"><a href="/archive/tar/writer.go.html#5234039">err</a></span>&nbsp;<span class="op" id="5234116">==</span>&nbsp;<span class="ident" id="5234119">nil</span>&nbsp;<span class="op" id="5234123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234129">//&nbsp;ok&nbsp;we&nbsp;can&nbsp;use&nbsp;a&nbsp;ustar&nbsp;long&nbsp;name&nbsp;instead&nbsp;of&nbsp;pax,&nbsp;now&nbsp;correct&nbsp;the&nbsp;fields</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234208">//&nbsp;remove&nbsp;the&nbsp;path&nbsp;field&nbsp;from&nbsp;the&nbsp;pax&nbsp;header.&nbsp;this&nbsp;will&nbsp;suppress&nbsp;the&nbsp;pax&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5234292">delete</span><span class="op" id="5234298">(</span><span class="ident" id="5234299"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5234309">,</span>&nbsp;<span class="ident" id="5234311"><a href="/archive/tar/common.go.html#5200505">paxPath</a></span><span class="op" id="5234318">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234325">//&nbsp;update&nbsp;the&nbsp;path&nbsp;fields</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234355"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234357">.</span><span class="ident" id="5234358">cString</span><span class="op" id="5234365">(</span><span class="ident" id="5234366"><a href="/archive/tar/writer.go.html#5232097">pathHeaderBytes</a></span><span class="op" id="5234381">,</span>&nbsp;<span class="ident" id="5234383"><a href="/archive/tar/writer.go.html#5233941">suffix</a></span><span class="op" id="5234389">,</span>&nbsp;<span class="ident" id="5234391">false</span><span class="op" id="5234396">,</span>&nbsp;<span class="ident" id="5234398"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5234405">,</span>&nbsp;<span class="ident" id="5234407">nil</span><span class="op" id="5234410">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234416"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234418">.</span><span class="ident" id="5234419">cString</span><span class="op" id="5234426">(</span><span class="ident" id="5234427"><a href="/archive/tar/writer.go.html#5233524">prefixHeaderBytes</a></span><span class="op" id="5234444">,</span>&nbsp;<span class="ident" id="5234446"><a href="/archive/tar/writer.go.html#5233962">prefix</a></span><span class="op" id="5234452">,</span>&nbsp;<span class="ident" id="5234454">false</span><span class="op" id="5234459">,</span>&nbsp;<span class="ident" id="5234461"><a href="/archive/tar/common.go.html#5200624">paxNone</a></span><span class="op" id="5234468">,</span>&nbsp;<span class="ident" id="5234470">nil</span><span class="op" id="5234473">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234480">//&nbsp;Use&nbsp;the&nbsp;ustar&nbsp;magic&nbsp;if&nbsp;we&nbsp;used&nbsp;ustar&nbsp;long&nbsp;names.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234536">if</span>&nbsp;<span class="builtinfunc" id="5234539">len</span><span class="op" id="5234542">(</span><span class="ident" id="5234543"><a href="/archive/tar/writer.go.html#5233962">prefix</a></span><span class="op" id="5234549">)</span>&nbsp;<span class="op" id="5234551">&gt;</span>&nbsp;<span class="num" id="5234553">0</span>&nbsp;<span class="op" id="5234555">&amp;&amp;</span>&nbsp;<span class="op" id="5234558">!</span><span class="ident" id="5234559"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234561">.</span><span class="ident" id="5234562">usedBinary</span>&nbsp;<span class="op" id="5234573">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5234580">copy</span><span class="op" id="5234584">(</span><span class="ident" id="5234585"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5234591">[</span><span class="num" id="5234592">257</span><span class="op" id="5234595">:</span><span class="num" id="5234596">265</span><span class="op" id="5234599">]</span><span class="op" id="5234600">,</span>&nbsp;<span class="op" id="5234602">[</span><span class="op" id="5234603">]</span><span class="builtintype" id="5234604">byte</span><span class="op" id="5234608">(</span><span class="string" id="5234609">&#34;ustar\x00&#34;</span><span class="op" id="5234620">)</span><span class="op" id="5234621">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234627">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234632">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234636">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234639">}</span><br>
<span class="lineno">240</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234643">//&nbsp;The&nbsp;chksum&nbsp;field&nbsp;is&nbsp;terminated&nbsp;by&nbsp;a&nbsp;NUL&nbsp;and&nbsp;a&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234700">//&nbsp;This&nbsp;is&nbsp;different&nbsp;from&nbsp;the&nbsp;other&nbsp;octal&nbsp;fields.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234751">chksum</span><span class="op" id="5234757">,</span>&nbsp;<span class="ident" id="5234759">_</span>&nbsp;<span class="op" id="5234761">:=</span>&nbsp;<span class="ident" id="5234764"><a href="/archive/tar/common.go.html#5202380">checksum</a></span><span class="op" id="5234772">(</span><span class="ident" id="5234773"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5234779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234782"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234784">.</span><span class="ident" id="5234785">octal</span><span class="op" id="5234790">(</span><span class="ident" id="5234791"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5234797">[</span><span class="num" id="5234798">148</span><span class="op" id="5234801">:</span><span class="num" id="5234802">155</span><span class="op" id="5234805">]</span><span class="op" id="5234806">,</span>&nbsp;<span class="ident" id="5234808"><a href="/archive/tar/writer.go.html#5234751">chksum</a></span><span class="op" id="5234814">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234817"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5234823">[</span><span class="num" id="5234824">155</span><span class="op" id="5234827">]</span>&nbsp;<span class="op" id="5234829">=</span>&nbsp;<span class="string" id="5234831">&#39;&nbsp;&#39;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234837">if</span>&nbsp;<span class="ident" id="5234840"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234842">.</span><span class="ident" id="5234843">err</span>&nbsp;<span class="op" id="5234847">!=</span>&nbsp;<span class="ident" id="5234850">nil</span>&nbsp;<span class="op" id="5234854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5234858">//&nbsp;problem&nbsp;with&nbsp;header;&nbsp;probably&nbsp;integer&nbsp;too&nbsp;big&nbsp;for&nbsp;a&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234922">return</span>&nbsp;<span class="ident" id="5234929"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5234931">.</span><span class="ident" id="5234932">err</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5234937">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234941">if</span>&nbsp;<span class="ident" id="5234944"><a href="/archive/tar/writer.go.html#5231054">allowPax</a></span>&nbsp;<span class="op" id="5234953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5234957">for</span>&nbsp;<span class="ident" id="5234961">k</span><span class="op" id="5234962">,</span>&nbsp;<span class="ident" id="5234964">v</span>&nbsp;<span class="op" id="5234966">:=</span>&nbsp;<span class="keyword" id="5234969">range</span>&nbsp;<span class="ident" id="5234975"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5234978">.</span><span class="ident" id="5234979">Xattrs</span>&nbsp;<span class="op" id="5234986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5234991"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5235001">[</span><span class="ident" id="5235002"><a href="/archive/tar/common.go.html#5200593">paxXattr</a></span><span class="op" id="5235010">+</span><span class="ident" id="5235011"><a href="/archive/tar/writer.go.html#5234961">k</a></span><span class="op" id="5235012">]</span>&nbsp;<span class="op" id="5235014">=</span>&nbsp;<span class="ident" id="5235016"><a href="/archive/tar/writer.go.html#5234964">v</a></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235023">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235027">if</span>&nbsp;<span class="builtinfunc" id="5235030">len</span><span class="op" id="5235033">(</span><span class="ident" id="5235034"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5235044">)</span>&nbsp;<span class="op" id="5235046">&gt;</span>&nbsp;<span class="num" id="5235048">0</span>&nbsp;<span class="op" id="5235050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235054">if</span>&nbsp;<span class="op" id="5235057">!</span><span class="ident" id="5235058"><a href="/archive/tar/writer.go.html#5231054">allowPax</a></span>&nbsp;<span class="op" id="5235067">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235072">return</span>&nbsp;<span class="ident" id="5235079"><a href="/archive/tar/writer.go.html#5227205">errInvalidHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235098">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235102">if</span>&nbsp;<span class="ident" id="5235105">err</span>&nbsp;<span class="op" id="5235109">:=</span>&nbsp;<span class="ident" id="5235112"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235114">.</span><span class="ident" id="5235115">writePAXHeader</span><span class="op" id="5235129">(</span><span class="ident" id="5235130"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5235133">,</span>&nbsp;<span class="ident" id="5235135"><a href="/archive/tar/writer.go.html#5231257">paxHeaders</a></span><span class="op" id="5235145">)</span><span class="op" id="5235146">;</span>&nbsp;<span class="ident" id="5235148"><a href="/archive/tar/writer.go.html#5235105">err</a></span>&nbsp;<span class="op" id="5235152">!=</span>&nbsp;<span class="ident" id="5235155">nil</span>&nbsp;<span class="op" id="5235159">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235164">return</span>&nbsp;<span class="ident" id="5235171"><a href="/archive/tar/writer.go.html#5235105">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235177">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235180">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235183"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235185">.</span><span class="ident" id="5235186">nb</span>&nbsp;<span class="op" id="5235189">=</span>&nbsp;<span class="ident" id="5235191">int64</span><span class="op" id="5235196">(</span><span class="ident" id="5235197"><a href="/archive/tar/writer.go.html#5231041">hdr</a></span><span class="op" id="5235200">.</span><span class="ident" id="5235201">Size</span><span class="op" id="5235205">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235208"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235210">.</span><span class="ident" id="5235211">pad</span>&nbsp;<span class="op" id="5235215">=</span>&nbsp;<span class="op" id="5235217">(</span><span class="ident" id="5235218"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span>&nbsp;<span class="op" id="5235228">-</span>&nbsp;<span class="op" id="5235230">(</span><span class="ident" id="5235231"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235233">.</span><span class="ident" id="5235234">nb</span>&nbsp;<span class="op" id="5235237">%</span>&nbsp;<span class="ident" id="5235239"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span><span class="op" id="5235248">)</span><span class="op" id="5235249">)</span>&nbsp;<span class="op" id="5235251">%</span>&nbsp;<span class="ident" id="5235253"><a href="/archive/tar/common.go.html#5195939">blockSize</a></span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235265">_</span><span class="op" id="5235266">,</span>&nbsp;<span class="ident" id="5235268"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235270">.</span><span class="ident" id="5235271">err</span>&nbsp;<span class="op" id="5235275">=</span>&nbsp;<span class="ident" id="5235277"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235279">.</span><span class="ident" id="5235280">w</span><span class="op" id="5235281">.</span><span class="ident" id="5235282">Write</span><span class="op" id="5235287">(</span><span class="ident" id="5235288"><a href="/archive/tar/writer.go.html#5231469">header</a></span><span class="op" id="5235294">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235297">return</span>&nbsp;<span class="ident" id="5235304"><a href="/archive/tar/writer.go.html#5231017">tw</a></span><span class="op" id="5235306">.</span><span class="ident" id="5235307">err</span><br>
<span class="lineno"></span><span class="op" id="5235311">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5235314">//&nbsp;writeUSTARLongName&nbsp;splits&nbsp;a&nbsp;USTAR&nbsp;long&nbsp;name&nbsp;hdr.Name.</span><br>
<span class="lineno"></span><span class="comment" id="5235371">//&nbsp;name&nbsp;must&nbsp;be&nbsp;&lt;&nbsp;256&nbsp;characters.&nbsp;errNameTooLong&nbsp;is&nbsp;returned</span><br>
<span class="lineno">275</span><span class="comment" id="5235432">//&nbsp;if&nbsp;hdr.Name&nbsp;can&#39;t&nbsp;be&nbsp;split.&nbsp;The&nbsp;splitting&nbsp;heuristic</span><br>
<span class="lineno"></span><span class="comment" id="5235487">//&nbsp;is&nbsp;compatible&nbsp;with&nbsp;gnu&nbsp;tar.</span><br>
<span class="lineno"></span><span class="keyword" id="5235518">func</span>&nbsp;<span class="op" id="5235523">(</span><span class="ident" id="5235524">tw</span>&nbsp;<span class="op" id="5235527">*</span><span class="ident" id="5235528"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5235534">)</span>&nbsp;<span class="ident" id="5235536">splitUSTARLongName</span><span class="op" id="5235554">(</span><span class="ident" id="5235555">name</span>&nbsp;<span class="builtintype" id="5235560">string</span><span class="op" id="5235566">)</span>&nbsp;<span class="op" id="5235568">(</span><span class="ident" id="5235569">prefix</span><span class="op" id="5235575">,</span>&nbsp;<span class="ident" id="5235577">suffix</span>&nbsp;<span class="builtintype" id="5235584">string</span><span class="op" id="5235590">,</span>&nbsp;<span class="ident" id="5235592">err</span>&nbsp;<span class="builtintype" id="5235596">error</span><span class="op" id="5235601">)</span>&nbsp;<span class="op" id="5235603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235606">length</span>&nbsp;<span class="op" id="5235613">:=</span>&nbsp;<span class="builtinfunc" id="5235616">len</span><span class="op" id="5235619">(</span><span class="ident" id="5235620"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5235624">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235627">if</span>&nbsp;<span class="ident" id="5235630"><a href="/archive/tar/writer.go.html#5235606">length</a></span>&nbsp;<span class="op" id="5235637">&gt;</span>&nbsp;<span class="ident" id="5235639"><a href="/archive/tar/common.go.html#5197580">fileNamePrefixSize</a></span><span class="op" id="5235657">+</span><span class="num" id="5235658">1</span>&nbsp;<span class="op" id="5235660">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235664"><a href="/archive/tar/writer.go.html#5235606">length</a></span>&nbsp;<span class="op" id="5235671">=</span>&nbsp;<span class="ident" id="5235673"><a href="/archive/tar/common.go.html#5197580">fileNamePrefixSize</a></span>&nbsp;<span class="op" id="5235692">+</span>&nbsp;<span class="num" id="5235694">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235697">}</span>&nbsp;<span class="keyword" id="5235699">else</span>&nbsp;<span class="keyword" id="5235704">if</span>&nbsp;<span class="ident" id="5235707"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5235711">[</span><span class="ident" id="5235712"><a href="/archive/tar/writer.go.html#5235606">length</a></span><span class="op" id="5235718">-</span><span class="num" id="5235719">1</span><span class="op" id="5235720">]</span>&nbsp;<span class="op" id="5235722">==</span>&nbsp;<span class="string" id="5235725">&#39;/&#39;</span>&nbsp;<span class="op" id="5235729">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235733"><a href="/archive/tar/writer.go.html#5235606">length</a></span><span class="op" id="5235739">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5235743">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235746">i</span>&nbsp;<span class="op" id="5235748">:=</span>&nbsp;<span class="ident" id="5235751"><a href="/archive/tar/writer.go.html#5226912">strings</a></span><span class="op" id="5235758">.</span><span class="ident" id="5235759">LastIndex</span><span class="op" id="5235768">(</span><span class="ident" id="5235769"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5235773">[</span><span class="op" id="5235774">:</span><span class="ident" id="5235775"><a href="/archive/tar/writer.go.html#5235606">length</a></span><span class="op" id="5235781">]</span><span class="op" id="5235782">,</span>&nbsp;<span class="string" id="5235784">&#34;/&#34;</span><span class="op" id="5235787">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5235790">//&nbsp;nlen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;name&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5235848">//&nbsp;plen&nbsp;contains&nbsp;the&nbsp;resulting&nbsp;length&nbsp;in&nbsp;the&nbsp;prefix&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235908">nlen</span>&nbsp;<span class="op" id="5235913">:=</span>&nbsp;<span class="builtinfunc" id="5235916">len</span><span class="op" id="5235919">(</span><span class="ident" id="5235920"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5235924">)</span>&nbsp;<span class="op" id="5235926">-</span>&nbsp;<span class="ident" id="5235928"><a href="/archive/tar/writer.go.html#5235746">i</a></span>&nbsp;<span class="op" id="5235930">-</span>&nbsp;<span class="num" id="5235932">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5235935">plen</span>&nbsp;<span class="op" id="5235940">:=</span>&nbsp;<span class="ident" id="5235943"><a href="/archive/tar/writer.go.html#5235746">i</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5235946">if</span>&nbsp;<span class="ident" id="5235949"><a href="/archive/tar/writer.go.html#5235746">i</a></span>&nbsp;<span class="op" id="5235951">&lt;=</span>&nbsp;<span class="num" id="5235954">0</span>&nbsp;<span class="op" id="5235956">||</span>&nbsp;<span class="ident" id="5235959"><a href="/archive/tar/writer.go.html#5235908">nlen</a></span>&nbsp;<span class="op" id="5235964">&gt;</span>&nbsp;<span class="ident" id="5235966"><a href="/archive/tar/common.go.html#5197503">fileNameSize</a></span>&nbsp;<span class="op" id="5235979">||</span>&nbsp;<span class="ident" id="5235982"><a href="/archive/tar/writer.go.html#5235908">nlen</a></span>&nbsp;<span class="op" id="5235987">==</span>&nbsp;<span class="num" id="5235990">0</span>&nbsp;<span class="op" id="5235992">||</span>&nbsp;<span class="ident" id="5235995"><a href="/archive/tar/writer.go.html#5235935">plen</a></span>&nbsp;<span class="op" id="5236000">&gt;</span>&nbsp;<span class="ident" id="5236002"><a href="/archive/tar/common.go.html#5197580">fileNamePrefixSize</a></span>&nbsp;<span class="op" id="5236021">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236025"><a href="/archive/tar/writer.go.html#5235592">err</a></span>&nbsp;<span class="op" id="5236029">=</span>&nbsp;<span class="ident" id="5236031"><a href="/archive/tar/writer.go.html#5227142">errNameTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236048">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5236056">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236059"><a href="/archive/tar/writer.go.html#5235569">prefix</a></span><span class="op" id="5236065">,</span>&nbsp;<span class="ident" id="5236067"><a href="/archive/tar/writer.go.html#5235577">suffix</a></span>&nbsp;<span class="op" id="5236074">=</span>&nbsp;<span class="ident" id="5236076"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5236080">[</span><span class="op" id="5236081">:</span><span class="ident" id="5236082"><a href="/archive/tar/writer.go.html#5235746">i</a></span><span class="op" id="5236083">]</span><span class="op" id="5236084">,</span>&nbsp;<span class="ident" id="5236086"><a href="/archive/tar/writer.go.html#5235555">name</a></span><span class="op" id="5236090">[</span><span class="ident" id="5236091"><a href="/archive/tar/writer.go.html#5235746">i</a></span><span class="op" id="5236092">+</span><span class="num" id="5236093">1</span><span class="op" id="5236094">:</span><span class="op" id="5236095">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236098">return</span><br>
<span class="lineno">295</span><span class="op" id="5236105">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5236108">//&nbsp;writePaxHeader&nbsp;writes&nbsp;an&nbsp;extended&nbsp;pax&nbsp;header&nbsp;to&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5236163">//&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5236175">func</span>&nbsp;<span class="op" id="5236180">(</span><span class="ident" id="5236181">tw</span>&nbsp;<span class="op" id="5236184">*</span><span class="ident" id="5236185"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5236191">)</span>&nbsp;<span class="ident" id="5236193">writePAXHeader</span><span class="op" id="5236207">(</span><span class="ident" id="5236208">hdr</span>&nbsp;<span class="op" id="5236212">*</span><span class="ident" id="5236213"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="5236219">,</span>&nbsp;<span class="ident" id="5236221">paxHeaders</span>&nbsp;<span class="keyword" id="5236232">map</span><span class="op" id="5236235">[</span><span class="builtintype" id="5236236">string</span><span class="op" id="5236242">]</span><span class="builtintype" id="5236243">string</span><span class="op" id="5236249">)</span>&nbsp;<span class="builtintype" id="5236251">error</span>&nbsp;<span class="op" id="5236257">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236260">//&nbsp;Prepare&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236288">ext</span>&nbsp;<span class="op" id="5236292">:=</span>&nbsp;<span class="builtinfunc" id="5236295">new</span><span class="op" id="5236298">(</span><span class="ident" id="5236299"><a href="/archive/tar/common.go.html#5196742">Header</a></span><span class="op" id="5236305">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236308"><a href="/archive/tar/writer.go.html#5236288">ext</a></span><span class="op" id="5236311">.</span><span class="ident" id="5236312">Typeflag</span>&nbsp;<span class="op" id="5236321">=</span>&nbsp;<span class="ident" id="5236323"><a href="/archive/tar/common.go.html#5196365">TypeXHeader</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236336">//&nbsp;Setting&nbsp;ModTime&nbsp;is&nbsp;required&nbsp;for&nbsp;reader&nbsp;parsing&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236390">//&nbsp;succeed,&nbsp;and&nbsp;seems&nbsp;harmless&nbsp;enough.</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236430"><a href="/archive/tar/writer.go.html#5236288">ext</a></span><span class="op" id="5236433">.</span><span class="ident" id="5236434">ModTime</span>&nbsp;<span class="op" id="5236442">=</span>&nbsp;<span class="ident" id="5236444"><a href="/archive/tar/writer.go.html#5236208">hdr</a></span><span class="op" id="5236447">.</span><span class="ident" id="5236448">ModTime</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236457">//&nbsp;The&nbsp;spec&nbsp;asks&nbsp;that&nbsp;we&nbsp;namespace&nbsp;our&nbsp;pseudo&nbsp;files</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236510">//&nbsp;with&nbsp;the&nbsp;current&nbsp;pid.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236536">pid</span>&nbsp;<span class="op" id="5236540">:=</span>&nbsp;<span class="ident" id="5236543"><a href="/archive/tar/writer.go.html#5226887">os</a></span><span class="op" id="5236545">.</span><span class="ident" id="5236546">Getpid</span><span class="op" id="5236552">(</span><span class="op" id="5236553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236556">dir</span><span class="op" id="5236559">,</span>&nbsp;<span class="ident" id="5236561">file</span>&nbsp;<span class="op" id="5236566">:=</span>&nbsp;<span class="ident" id="5236569"><a href="/archive/tar/writer.go.html#5226893">path</a></span><span class="op" id="5236573">.</span><span class="ident" id="5236574">Split</span><span class="op" id="5236579">(</span><span class="ident" id="5236580"><a href="/archive/tar/writer.go.html#5236208">hdr</a></span><span class="op" id="5236583">.</span><span class="ident" id="5236584">Name</span><span class="op" id="5236588">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236591">fullName</span>&nbsp;<span class="op" id="5236600">:=</span>&nbsp;<span class="ident" id="5236603"><a href="/archive/tar/writer.go.html#5226893">path</a></span><span class="op" id="5236607">.</span><span class="ident" id="5236608">Join</span><span class="op" id="5236612">(</span><span class="ident" id="5236613"><a href="/archive/tar/writer.go.html#5236556">dir</a></span><span class="op" id="5236616">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236620"><a href="/archive/tar/writer.go.html#5226874">fmt</a></span><span class="op" id="5236623">.</span><span class="ident" id="5236624">Sprintf</span><span class="op" id="5236631">(</span><span class="string" id="5236632">&#34;PaxHeaders.%d&#34;</span><span class="op" id="5236647">,</span>&nbsp;<span class="ident" id="5236649"><a href="/archive/tar/writer.go.html#5236536">pid</a></span><span class="op" id="5236652">)</span><span class="op" id="5236653">,</span>&nbsp;<span class="ident" id="5236655"><a href="/archive/tar/writer.go.html#5236561">file</a></span><span class="op" id="5236659">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236663">ascii</span>&nbsp;<span class="op" id="5236669">:=</span>&nbsp;<span class="ident" id="5236672"><a href="/archive/tar/common.go.html#5202951">toASCII</a></span><span class="op" id="5236679">(</span><span class="ident" id="5236680"><a href="/archive/tar/writer.go.html#5236591">fullName</a></span><span class="op" id="5236688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236691">if</span>&nbsp;<span class="builtinfunc" id="5236694">len</span><span class="op" id="5236697">(</span><span class="ident" id="5236698"><a href="/archive/tar/writer.go.html#5236663">ascii</a></span><span class="op" id="5236703">)</span>&nbsp;<span class="op" id="5236705">&gt;</span>&nbsp;<span class="num" id="5236707">100</span>&nbsp;<span class="op" id="5236711">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236715"><a href="/archive/tar/writer.go.html#5236663">ascii</a></span>&nbsp;<span class="op" id="5236721">=</span>&nbsp;<span class="ident" id="5236723"><a href="/archive/tar/writer.go.html#5236663">ascii</a></span><span class="op" id="5236728">[</span><span class="op" id="5236729">:</span><span class="num" id="5236730">100</span><span class="op" id="5236733">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5236736">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236739"><a href="/archive/tar/writer.go.html#5236288">ext</a></span><span class="op" id="5236742">.</span><span class="ident" id="5236743">Name</span>&nbsp;<span class="op" id="5236748">=</span>&nbsp;<span class="ident" id="5236750"><a href="/archive/tar/writer.go.html#5236663">ascii</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5236757">//&nbsp;Construct&nbsp;the&nbsp;body</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236780">var</span>&nbsp;<span class="ident" id="5236784">buf</span>&nbsp;<span class="ident" id="5236788"><a href="/archive/tar/writer.go.html#5226855">bytes</a></span><span class="op" id="5236793">.</span><span class="ident" id="5236794">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236803">for</span>&nbsp;<span class="ident" id="5236807">k</span><span class="op" id="5236808">,</span>&nbsp;<span class="ident" id="5236810">v</span>&nbsp;<span class="op" id="5236812">:=</span>&nbsp;<span class="keyword" id="5236815">range</span>&nbsp;<span class="ident" id="5236821"><a href="/archive/tar/writer.go.html#5236221">paxHeaders</a></span>&nbsp;<span class="op" id="5236832">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236836"><a href="/archive/tar/writer.go.html#5226874">fmt</a></span><span class="op" id="5236839">.</span><span class="ident" id="5236840">Fprint</span><span class="op" id="5236846">(</span><span class="op" id="5236847">&amp;</span><span class="ident" id="5236848"><a href="/archive/tar/writer.go.html#5236784">buf</a></span><span class="op" id="5236851">,</span>&nbsp;<span class="ident" id="5236853"><a href="/archive/tar/writer.go.html#5237202">paxHeader</a></span><span class="op" id="5236862">(</span><span class="ident" id="5236863"><a href="/archive/tar/writer.go.html#5236807">k</a></span><span class="op" id="5236864">+</span><span class="string" id="5236865">&#34;=&#34;</span><span class="op" id="5236868">+</span><span class="ident" id="5236869"><a href="/archive/tar/writer.go.html#5236810">v</a></span><span class="op" id="5236870">)</span><span class="op" id="5236871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5236874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5236878"><a href="/archive/tar/writer.go.html#5236288">ext</a></span><span class="op" id="5236881">.</span><span class="ident" id="5236882">Size</span>&nbsp;<span class="op" id="5236887">=</span>&nbsp;<span class="ident" id="5236889">int64</span><span class="op" id="5236894">(</span><span class="builtinfunc" id="5236895">len</span><span class="op" id="5236898">(</span><span class="ident" id="5236899"><a href="/archive/tar/writer.go.html#5236784">buf</a></span><span class="op" id="5236902">.</span><span class="ident" id="5236903">Bytes</span><span class="op" id="5236908">(</span><span class="op" id="5236909">)</span><span class="op" id="5236910">)</span><span class="op" id="5236911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236914">if</span>&nbsp;<span class="ident" id="5236917">err</span>&nbsp;<span class="op" id="5236921">:=</span>&nbsp;<span class="ident" id="5236924"><a href="/archive/tar/writer.go.html#5236181">tw</a></span><span class="op" id="5236926">.</span><span class="ident" id="5236927">writeHeader</span><span class="op" id="5236938">(</span><span class="ident" id="5236939"><a href="/archive/tar/writer.go.html#5236288">ext</a></span><span class="op" id="5236942">,</span>&nbsp;<span class="ident" id="5236944">false</span><span class="op" id="5236949">)</span><span class="op" id="5236950">;</span>&nbsp;<span class="ident" id="5236952"><a href="/archive/tar/writer.go.html#5236917">err</a></span>&nbsp;<span class="op" id="5236956">!=</span>&nbsp;<span class="ident" id="5236959">nil</span>&nbsp;<span class="op" id="5236963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236967">return</span>&nbsp;<span class="ident" id="5236974"><a href="/archive/tar/writer.go.html#5236917">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5236979">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5236982">if</span>&nbsp;<span class="ident" id="5236985">_</span><span class="op" id="5236986">,</span>&nbsp;<span class="ident" id="5236988">err</span>&nbsp;<span class="op" id="5236992">:=</span>&nbsp;<span class="ident" id="5236995"><a href="/archive/tar/writer.go.html#5236181">tw</a></span><span class="op" id="5236997">.</span><span class="ident" id="5236998">Write</span><span class="op" id="5237003">(</span><span class="ident" id="5237004"><a href="/archive/tar/writer.go.html#5236784">buf</a></span><span class="op" id="5237007">.</span><span class="ident" id="5237008">Bytes</span><span class="op" id="5237013">(</span><span class="op" id="5237014">)</span><span class="op" id="5237015">)</span><span class="op" id="5237016">;</span>&nbsp;<span class="ident" id="5237018"><a href="/archive/tar/writer.go.html#5236988">err</a></span>&nbsp;<span class="op" id="5237022">!=</span>&nbsp;<span class="ident" id="5237025">nil</span>&nbsp;<span class="op" id="5237029">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237033">return</span>&nbsp;<span class="ident" id="5237040"><a href="/archive/tar/writer.go.html#5236988">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237045">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237048">if</span>&nbsp;<span class="ident" id="5237051">err</span>&nbsp;<span class="op" id="5237055">:=</span>&nbsp;<span class="ident" id="5237058"><a href="/archive/tar/writer.go.html#5236181">tw</a></span><span class="op" id="5237060">.</span><span class="ident" id="5237061">Flush</span><span class="op" id="5237066">(</span><span class="op" id="5237067">)</span><span class="op" id="5237068">;</span>&nbsp;<span class="ident" id="5237070"><a href="/archive/tar/writer.go.html#5237051">err</a></span>&nbsp;<span class="op" id="5237074">!=</span>&nbsp;<span class="ident" id="5237077">nil</span>&nbsp;<span class="op" id="5237081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237085">return</span>&nbsp;<span class="ident" id="5237092"><a href="/archive/tar/writer.go.html#5237051">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237097">}</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237100">return</span>&nbsp;<span class="ident" id="5237107">nil</span><br>
<span class="lineno"></span><span class="op" id="5237111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5237114">//&nbsp;paxHeader&nbsp;formats&nbsp;a&nbsp;single&nbsp;pax&nbsp;record,&nbsp;prefixing&nbsp;it&nbsp;with&nbsp;the&nbsp;appropriate&nbsp;length</span><br>
<span class="lineno"></span><span class="keyword" id="5237197">func</span>&nbsp;<span class="ident" id="5237202">paxHeader</span><span class="op" id="5237211">(</span><span class="ident" id="5237212">msg</span>&nbsp;<span class="builtintype" id="5237216">string</span><span class="op" id="5237222">)</span>&nbsp;<span class="builtintype" id="5237224">string</span>&nbsp;<span class="op" id="5237231">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237234">const</span>&nbsp;<span class="ident" id="5237240">padding</span>&nbsp;<span class="op" id="5237248">=</span>&nbsp;<span class="num" id="5237250">2</span>&nbsp;<span class="comment" id="5237252">//&nbsp;Extra&nbsp;padding&nbsp;for&nbsp;space&nbsp;and&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237292">size</span>&nbsp;<span class="op" id="5237297">:=</span>&nbsp;<span class="builtinfunc" id="5237300">len</span><span class="op" id="5237303">(</span><span class="ident" id="5237304"><a href="/archive/tar/writer.go.html#5237212">msg</a></span><span class="op" id="5237307">)</span>&nbsp;<span class="op" id="5237309">+</span>&nbsp;<span class="ident" id="5237311"><a href="/archive/tar/writer.go.html#5237240">padding</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237320"><a href="/archive/tar/writer.go.html#5237292">size</a></span>&nbsp;<span class="op" id="5237325">+=</span>&nbsp;<span class="builtinfunc" id="5237328">len</span><span class="op" id="5237331">(</span><span class="ident" id="5237332"><a href="/archive/tar/writer.go.html#5226901">strconv</a></span><span class="op" id="5237339">.</span><span class="ident" id="5237340">Itoa</span><span class="op" id="5237344">(</span><span class="ident" id="5237345"><a href="/archive/tar/writer.go.html#5237292">size</a></span><span class="op" id="5237349">)</span><span class="op" id="5237350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237353">record</span>&nbsp;<span class="op" id="5237360">:=</span>&nbsp;<span class="ident" id="5237363"><a href="/archive/tar/writer.go.html#5226874">fmt</a></span><span class="op" id="5237366">.</span><span class="ident" id="5237367">Sprintf</span><span class="op" id="5237374">(</span><span class="string" id="5237375">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5237384">,</span>&nbsp;<span class="ident" id="5237386"><a href="/archive/tar/writer.go.html#5237292">size</a></span><span class="op" id="5237390">,</span>&nbsp;<span class="ident" id="5237392"><a href="/archive/tar/writer.go.html#5237212">msg</a></span><span class="op" id="5237395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237398">if</span>&nbsp;<span class="builtinfunc" id="5237401">len</span><span class="op" id="5237404">(</span><span class="ident" id="5237405"><a href="/archive/tar/writer.go.html#5237353">record</a></span><span class="op" id="5237411">)</span>&nbsp;<span class="op" id="5237413">!=</span>&nbsp;<span class="ident" id="5237416"><a href="/archive/tar/writer.go.html#5237292">size</a></span>&nbsp;<span class="op" id="5237421">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5237425">//&nbsp;Final&nbsp;adjustment&nbsp;if&nbsp;adding&nbsp;size&nbsp;increased</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5237472">//&nbsp;the&nbsp;number&nbsp;of&nbsp;digits&nbsp;in&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237506"><a href="/archive/tar/writer.go.html#5237292">size</a></span>&nbsp;<span class="op" id="5237511">=</span>&nbsp;<span class="builtinfunc" id="5237513">len</span><span class="op" id="5237516">(</span><span class="ident" id="5237517"><a href="/archive/tar/writer.go.html#5237353">record</a></span><span class="op" id="5237523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237527"><a href="/archive/tar/writer.go.html#5237353">record</a></span>&nbsp;<span class="op" id="5237534">=</span>&nbsp;<span class="ident" id="5237536"><a href="/archive/tar/writer.go.html#5226874">fmt</a></span><span class="op" id="5237539">.</span><span class="ident" id="5237540">Sprintf</span><span class="op" id="5237547">(</span><span class="string" id="5237548">&#34;%d&nbsp;%s\n&#34;</span><span class="op" id="5237557">,</span>&nbsp;<span class="ident" id="5237559"><a href="/archive/tar/writer.go.html#5237292">size</a></span><span class="op" id="5237563">,</span>&nbsp;<span class="ident" id="5237565"><a href="/archive/tar/writer.go.html#5237212">msg</a></span><span class="op" id="5237568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237571">}</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237574">return</span>&nbsp;<span class="ident" id="5237581"><a href="/archive/tar/writer.go.html#5237353">record</a></span><br>
<span class="lineno"></span><span class="op" id="5237588">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5237591">//&nbsp;Write&nbsp;writes&nbsp;to&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5237648">//&nbsp;Write&nbsp;returns&nbsp;the&nbsp;error&nbsp;ErrWriteTooLong&nbsp;if&nbsp;more&nbsp;than</span><br>
<span class="lineno">355</span><span class="comment" id="5237704">//&nbsp;hdr.Size&nbsp;bytes&nbsp;are&nbsp;written&nbsp;after&nbsp;WriteHeader.</span><br>
<span class="lineno"></span><span class="keyword" id="5237753">func</span>&nbsp;<span class="op" id="5237758">(</span><span class="ident" id="5237759">tw</span>&nbsp;<span class="op" id="5237762">*</span><span class="ident" id="5237763"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5237769">)</span>&nbsp;<span class="ident" id="5237771">Write</span><span class="op" id="5237776">(</span><span class="ident" id="5237777">b</span>&nbsp;<span class="op" id="5237779">[</span><span class="op" id="5237780">]</span><span class="builtintype" id="5237781">byte</span><span class="op" id="5237785">)</span>&nbsp;<span class="op" id="5237787">(</span><span class="ident" id="5237788">n</span>&nbsp;<span class="builtintype" id="5237790">int</span><span class="op" id="5237793">,</span>&nbsp;<span class="ident" id="5237795">err</span>&nbsp;<span class="builtintype" id="5237799">error</span><span class="op" id="5237804">)</span>&nbsp;<span class="op" id="5237806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237809">if</span>&nbsp;<span class="ident" id="5237812"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5237814">.</span><span class="ident" id="5237815">closed</span>&nbsp;<span class="op" id="5237822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237826"><a href="/archive/tar/writer.go.html#5237795">err</a></span>&nbsp;<span class="op" id="5237830">=</span>&nbsp;<span class="ident" id="5237832"><a href="/archive/tar/writer.go.html#5226940">ErrWriteTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237850">return</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237858">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237861">overwrite</span>&nbsp;<span class="op" id="5237871">:=</span>&nbsp;<span class="ident" id="5237874">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237881">if</span>&nbsp;<span class="ident" id="5237884">int64</span><span class="op" id="5237889">(</span><span class="builtinfunc" id="5237890">len</span><span class="op" id="5237893">(</span><span class="ident" id="5237894"><a href="/archive/tar/writer.go.html#5237777">b</a></span><span class="op" id="5237895">)</span><span class="op" id="5237896">)</span>&nbsp;<span class="op" id="5237898">&gt;</span>&nbsp;<span class="ident" id="5237900"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5237902">.</span><span class="ident" id="5237903">nb</span>&nbsp;<span class="op" id="5237906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237910"><a href="/archive/tar/writer.go.html#5237777">b</a></span>&nbsp;<span class="op" id="5237912">=</span>&nbsp;<span class="ident" id="5237914"><a href="/archive/tar/writer.go.html#5237777">b</a></span><span class="op" id="5237915">[</span><span class="num" id="5237916">0</span><span class="op" id="5237917">:</span><span class="ident" id="5237918"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5237920">.</span><span class="ident" id="5237921">nb</span><span class="op" id="5237923">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237927"><a href="/archive/tar/writer.go.html#5237861">overwrite</a></span>&nbsp;<span class="op" id="5237937">=</span>&nbsp;<span class="ident" id="5237939">true</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5237945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237948"><a href="/archive/tar/writer.go.html#5237788">n</a></span><span class="op" id="5237949">,</span>&nbsp;<span class="ident" id="5237951"><a href="/archive/tar/writer.go.html#5237795">err</a></span>&nbsp;<span class="op" id="5237955">=</span>&nbsp;<span class="ident" id="5237957"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5237959">.</span><span class="ident" id="5237960">w</span><span class="op" id="5237961">.</span><span class="ident" id="5237962">Write</span><span class="op" id="5237967">(</span><span class="ident" id="5237968"><a href="/archive/tar/writer.go.html#5237777">b</a></span><span class="op" id="5237969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5237972"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5237974">.</span><span class="ident" id="5237975">nb</span>&nbsp;<span class="op" id="5237978">-=</span>&nbsp;<span class="ident" id="5237981">int64</span><span class="op" id="5237986">(</span><span class="ident" id="5237987"><a href="/archive/tar/writer.go.html#5237788">n</a></span><span class="op" id="5237988">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5237991">if</span>&nbsp;<span class="ident" id="5237994"><a href="/archive/tar/writer.go.html#5237795">err</a></span>&nbsp;<span class="op" id="5237998">==</span>&nbsp;<span class="ident" id="5238001">nil</span>&nbsp;<span class="op" id="5238005">&amp;&amp;</span>&nbsp;<span class="ident" id="5238008"><a href="/archive/tar/writer.go.html#5237861">overwrite</a></span>&nbsp;<span class="op" id="5238018">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238022"><a href="/archive/tar/writer.go.html#5237795">err</a></span>&nbsp;<span class="op" id="5238026">=</span>&nbsp;<span class="ident" id="5238028"><a href="/archive/tar/writer.go.html#5226940">ErrWriteTooLong</a></span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238046">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238054">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238057"><a href="/archive/tar/writer.go.html#5237759">tw</a></span><span class="op" id="5238059">.</span><span class="ident" id="5238060">err</span>&nbsp;<span class="op" id="5238064">=</span>&nbsp;<span class="ident" id="5238066"><a href="/archive/tar/writer.go.html#5237795">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238071">return</span><br>
<span class="lineno"></span><span class="op" id="5238078">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="comment" id="5238081">//&nbsp;Close&nbsp;closes&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;flushing&nbsp;any&nbsp;unwritten</span><br>
<span class="lineno"></span><span class="comment" id="5238137">//&nbsp;data&nbsp;to&nbsp;the&nbsp;underlying&nbsp;writer.</span><br>
<span class="lineno"></span><span class="keyword" id="5238171">func</span>&nbsp;<span class="op" id="5238176">(</span><span class="ident" id="5238177">tw</span>&nbsp;<span class="op" id="5238180">*</span><span class="ident" id="5238181"><a href="/archive/tar/writer.go.html#5227569">Writer</a></span><span class="op" id="5238187">)</span>&nbsp;<span class="ident" id="5238189">Close</span><span class="op" id="5238194">(</span><span class="op" id="5238195">)</span>&nbsp;<span class="builtintype" id="5238197">error</span>&nbsp;<span class="op" id="5238203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238206">if</span>&nbsp;<span class="ident" id="5238209"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238211">.</span><span class="ident" id="5238212">err</span>&nbsp;<span class="op" id="5238216">!=</span>&nbsp;<span class="ident" id="5238219">nil</span>&nbsp;<span class="op" id="5238223">||</span>&nbsp;<span class="ident" id="5238226"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238228">.</span><span class="ident" id="5238229">closed</span>&nbsp;<span class="op" id="5238236">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238240">return</span>&nbsp;<span class="ident" id="5238247"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238249">.</span><span class="ident" id="5238250">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238258"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238260">.</span><span class="ident" id="5238261">Flush</span><span class="op" id="5238266">(</span><span class="op" id="5238267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238270"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238272">.</span><span class="ident" id="5238273">closed</span>&nbsp;<span class="op" id="5238280">=</span>&nbsp;<span class="ident" id="5238282">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238288">if</span>&nbsp;<span class="ident" id="5238291"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238293">.</span><span class="ident" id="5238294">err</span>&nbsp;<span class="op" id="5238298">!=</span>&nbsp;<span class="ident" id="5238301">nil</span>&nbsp;<span class="op" id="5238305">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238309">return</span>&nbsp;<span class="ident" id="5238316"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238318">.</span><span class="ident" id="5238319">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238324">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5238328">//&nbsp;trailer:&nbsp;two&nbsp;zero&nbsp;blocks</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238357">for</span>&nbsp;<span class="ident" id="5238361">i</span>&nbsp;<span class="op" id="5238363">:=</span>&nbsp;<span class="num" id="5238366">0</span><span class="op" id="5238367">;</span>&nbsp;<span class="ident" id="5238369"><a href="/archive/tar/writer.go.html#5238361">i</a></span>&nbsp;<span class="op" id="5238371">&lt;</span>&nbsp;<span class="num" id="5238373">2</span><span class="op" id="5238374">;</span>&nbsp;<span class="ident" id="5238376"><a href="/archive/tar/writer.go.html#5238361">i</a></span><span class="op" id="5238377">++</span>&nbsp;<span class="op" id="5238380">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5238384">_</span><span class="op" id="5238385">,</span>&nbsp;<span class="ident" id="5238387"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238389">.</span><span class="ident" id="5238390">err</span>&nbsp;<span class="op" id="5238394">=</span>&nbsp;<span class="ident" id="5238396"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238398">.</span><span class="ident" id="5238399">w</span><span class="op" id="5238400">.</span><span class="ident" id="5238401">Write</span><span class="op" id="5238406">(</span><span class="ident" id="5238407"><a href="/archive/tar/common.go.html#5202212">zeroBlock</a></span><span class="op" id="5238416">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238420">if</span>&nbsp;<span class="ident" id="5238423"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238425">.</span><span class="ident" id="5238426">err</span>&nbsp;<span class="op" id="5238430">!=</span>&nbsp;<span class="ident" id="5238433">nil</span>&nbsp;<span class="op" id="5238437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238442">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238450">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5238453">}</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5238456">return</span>&nbsp;<span class="ident" id="5238463"><a href="/archive/tar/writer.go.html#5238177">tw</a></span><span class="op" id="5238465">.</span><span class="ident" id="5238466">err</span><br>
<span class="lineno"></span><span class="op" id="5238470">}</span>
</div>
</body>
</html>
