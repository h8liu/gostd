<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="8263084">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8263140">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8263194">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8263245">package</span>&nbsp;<span class="ident" id="8263253">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263258">import</span>&nbsp;<span class="string" id="8263265">&#34;errors&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8263275">const</span>&nbsp;<span class="op" id="8263281">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263284">icmpv4EchoRequest</span>&nbsp;<span class="op" id="8263302">=</span>&nbsp;<span class="num" id="8263304">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263307">icmpv4EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8263325">=</span>&nbsp;<span class="num" id="8263327">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263330">icmpv6EchoRequest</span>&nbsp;<span class="op" id="8263348">=</span>&nbsp;<span class="num" id="8263350">128</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263355">icmpv6EchoReply</span>&nbsp;&nbsp;&nbsp;<span class="op" id="8263373">=</span>&nbsp;<span class="num" id="8263375">129</span><br>
<span class="lineno"></span><span class="op" id="8263379">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="8263382">//&nbsp;icmpMessage&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8263425">type</span>&nbsp;<span class="ident" id="8263430">icmpMessage</span>&nbsp;<span class="keyword" id="8263442">struct</span>&nbsp;<span class="op" id="8263449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263452">Type</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8263461">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8263477">//&nbsp;type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263486">Code</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8263495">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8263511">//&nbsp;code</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263520">Checksum</span>&nbsp;<span class="builtintype" id="8263529">int</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8263545">//&nbsp;checksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263558">Body</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8263567">icmpMessageBody</span>&nbsp;<span class="comment" id="8263583">//&nbsp;body</span><br>
<span class="lineno"></span><span class="op" id="8263591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8263594">//&nbsp;icmpMessageBody&nbsp;represents&nbsp;an&nbsp;ICMP&nbsp;message&nbsp;body.</span><br>
<span class="lineno">25</span><span class="keyword" id="8263646">type</span>&nbsp;<span class="ident" id="8263651">icmpMessageBody</span>&nbsp;<span class="keyword" id="8263667">interface</span>&nbsp;<span class="op" id="8263677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263680">Len</span><span class="op" id="8263683">(</span><span class="op" id="8263684">)</span>&nbsp;<span class="builtintype" id="8263686">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263691">Marshal</span><span class="op" id="8263698">(</span><span class="op" id="8263699">)</span>&nbsp;<span class="op" id="8263701">(</span><span class="op" id="8263702">[</span><span class="op" id="8263703">]</span><span class="builtintype" id="8263704">byte</span><span class="op" id="8263708">,</span>&nbsp;<span class="builtintype" id="8263710">error</span><span class="op" id="8263715">)</span><br>
<span class="lineno"></span><span class="op" id="8263717">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="comment" id="8263720">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="8263788">//&nbsp;reply&nbsp;message&nbsp;m.</span><br>
<span class="lineno"></span><span class="keyword" id="8263808">func</span>&nbsp;<span class="op" id="8263813">(</span><span class="ident" id="8263814">m</span>&nbsp;<span class="op" id="8263816">*</span><span class="ident" id="8263817">icmpMessage</span><span class="op" id="8263828">)</span>&nbsp;<span class="ident" id="8263830">Marshal</span><span class="op" id="8263837">(</span><span class="op" id="8263838">)</span>&nbsp;<span class="op" id="8263840">(</span><span class="op" id="8263841">[</span><span class="op" id="8263842">]</span><span class="builtintype" id="8263843">byte</span><span class="op" id="8263847">,</span>&nbsp;<span class="builtintype" id="8263849">error</span><span class="op" id="8263854">)</span>&nbsp;<span class="op" id="8263856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263859">b</span>&nbsp;<span class="op" id="8263861">:=</span>&nbsp;<span class="op" id="8263864">[</span><span class="op" id="8263865">]</span><span class="builtintype" id="8263866">byte</span><span class="op" id="8263870">{</span><span class="builtintype" id="8263871">byte</span><span class="op" id="8263875">(</span><span class="ident" id="8263876">m</span><span class="op" id="8263877">.</span><span class="ident" id="8263878">Type</span><span class="op" id="8263882">)</span><span class="op" id="8263883">,</span>&nbsp;<span class="builtintype" id="8263885">byte</span><span class="op" id="8263889">(</span><span class="ident" id="8263890">m</span><span class="op" id="8263891">.</span><span class="ident" id="8263892">Code</span><span class="op" id="8263896">)</span><span class="op" id="8263897">,</span>&nbsp;<span class="num" id="8263899">0</span><span class="op" id="8263900">,</span>&nbsp;<span class="num" id="8263902">0</span><span class="op" id="8263903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263906">if</span>&nbsp;<span class="ident" id="8263909">m</span><span class="op" id="8263910">.</span><span class="ident" id="8263911">Body</span>&nbsp;<span class="op" id="8263916">!=</span>&nbsp;<span class="ident" id="8263919">nil</span>&nbsp;<span class="op" id="8263923">&amp;&amp;</span>&nbsp;<span class="ident" id="8263926">m</span><span class="op" id="8263927">.</span><span class="ident" id="8263928">Body</span><span class="op" id="8263932">.</span><span class="ident" id="8263933">Len</span><span class="op" id="8263936">(</span><span class="op" id="8263937">)</span>&nbsp;<span class="op" id="8263939">!=</span>&nbsp;<span class="num" id="8263942">0</span>&nbsp;<span class="op" id="8263944">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8263948">mb</span><span class="op" id="8263950">,</span>&nbsp;<span class="ident" id="8263952">err</span>&nbsp;<span class="op" id="8263956">:=</span>&nbsp;<span class="ident" id="8263959">m</span><span class="op" id="8263960">.</span><span class="ident" id="8263961">Body</span><span class="op" id="8263965">.</span><span class="ident" id="8263966">Marshal</span><span class="op" id="8263973">(</span><span class="op" id="8263974">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263978">if</span>&nbsp;<span class="ident" id="8263981">err</span>&nbsp;<span class="op" id="8263985">!=</span>&nbsp;<span class="ident" id="8263988">nil</span>&nbsp;<span class="op" id="8263992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8263997">return</span>&nbsp;<span class="ident" id="8264004">nil</span><span class="op" id="8264007">,</span>&nbsp;<span class="ident" id="8264009">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264015">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264019">b</span>&nbsp;<span class="op" id="8264021">=</span>&nbsp;<span class="builtinfunc" id="8264023">append</span><span class="op" id="8264029">(</span><span class="ident" id="8264030">b</span><span class="op" id="8264031">,</span>&nbsp;<span class="ident" id="8264033">mb</span><span class="op" id="8264035">...</span><span class="op" id="8264038">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264041">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264044">switch</span>&nbsp;<span class="ident" id="8264051">m</span><span class="op" id="8264052">.</span><span class="ident" id="8264053">Type</span>&nbsp;<span class="op" id="8264058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264061">case</span>&nbsp;<span class="ident" id="8264066">icmpv6EchoRequest</span><span class="op" id="8264083">,</span>&nbsp;<span class="ident" id="8264085">icmpv6EchoReply</span><span class="op" id="8264100">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264104">return</span>&nbsp;<span class="ident" id="8264111">b</span><span class="op" id="8264112">,</span>&nbsp;<span class="ident" id="8264114">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264119">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264122">csumcv</span>&nbsp;<span class="op" id="8264129">:=</span>&nbsp;<span class="builtinfunc" id="8264132">len</span><span class="op" id="8264135">(</span><span class="ident" id="8264136">b</span><span class="op" id="8264137">)</span>&nbsp;<span class="op" id="8264139">-</span>&nbsp;<span class="num" id="8264141">1</span>&nbsp;<span class="comment" id="8264143">//&nbsp;checksum&nbsp;coverage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264165">s</span>&nbsp;<span class="op" id="8264167">:=</span>&nbsp;<span class="builtintype" id="8264170">uint32</span><span class="op" id="8264176">(</span><span class="num" id="8264177">0</span><span class="op" id="8264178">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264181">for</span>&nbsp;<span class="ident" id="8264185">i</span>&nbsp;<span class="op" id="8264187">:=</span>&nbsp;<span class="num" id="8264190">0</span><span class="op" id="8264191">;</span>&nbsp;<span class="ident" id="8264193">i</span>&nbsp;<span class="op" id="8264195">&lt;</span>&nbsp;<span class="ident" id="8264197">csumcv</span><span class="op" id="8264203">;</span>&nbsp;<span class="ident" id="8264205">i</span>&nbsp;<span class="op" id="8264207">+=</span>&nbsp;<span class="num" id="8264210">2</span>&nbsp;<span class="op" id="8264212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264216">s</span>&nbsp;<span class="op" id="8264218">+=</span>&nbsp;<span class="builtintype" id="8264221">uint32</span><span class="op" id="8264227">(</span><span class="ident" id="8264228">b</span><span class="op" id="8264229">[</span><span class="ident" id="8264230">i</span><span class="op" id="8264231">+</span><span class="num" id="8264232">1</span><span class="op" id="8264233">]</span><span class="op" id="8264234">)</span><span class="op" id="8264235">&lt;&lt;</span><span class="num" id="8264237">8</span>&nbsp;<span class="op" id="8264239">|</span>&nbsp;<span class="builtintype" id="8264241">uint32</span><span class="op" id="8264247">(</span><span class="ident" id="8264248">b</span><span class="op" id="8264249">[</span><span class="ident" id="8264250">i</span><span class="op" id="8264251">]</span><span class="op" id="8264252">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264255">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264258">if</span>&nbsp;<span class="ident" id="8264261">csumcv</span><span class="op" id="8264267">&amp;</span><span class="num" id="8264268">1</span>&nbsp;<span class="op" id="8264270">==</span>&nbsp;<span class="num" id="8264273">0</span>&nbsp;<span class="op" id="8264275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264279">s</span>&nbsp;<span class="op" id="8264281">+=</span>&nbsp;<span class="builtintype" id="8264284">uint32</span><span class="op" id="8264290">(</span><span class="ident" id="8264291">b</span><span class="op" id="8264292">[</span><span class="ident" id="8264293">csumcv</span><span class="op" id="8264299">]</span><span class="op" id="8264300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264306">s</span>&nbsp;<span class="op" id="8264308">=</span>&nbsp;<span class="ident" id="8264310">s</span><span class="op" id="8264311">&gt;&gt;</span><span class="num" id="8264313">16</span>&nbsp;<span class="op" id="8264316">+</span>&nbsp;<span class="ident" id="8264318">s</span><span class="op" id="8264319">&amp;</span><span class="num" id="8264320">0xffff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264328">s</span>&nbsp;<span class="op" id="8264330">=</span>&nbsp;<span class="ident" id="8264332">s</span>&nbsp;<span class="op" id="8264334">+</span>&nbsp;<span class="ident" id="8264336">s</span><span class="op" id="8264337">&gt;&gt;</span><span class="num" id="8264339">16</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8264343">//&nbsp;Place&nbsp;checksum&nbsp;back&nbsp;in&nbsp;header;&nbsp;using&nbsp;^=&nbsp;avoids&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="8264398">//&nbsp;assumption&nbsp;the&nbsp;checksum&nbsp;bytes&nbsp;are&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264442">b</span><span class="op" id="8264443">[</span><span class="num" id="8264444">2</span><span class="op" id="8264445">]</span>&nbsp;<span class="op" id="8264447">^=</span>&nbsp;<span class="builtintype" id="8264450">byte</span><span class="op" id="8264454">(</span><span class="op" id="8264455">^</span><span class="ident" id="8264456">s</span><span class="op" id="8264457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264460">b</span><span class="op" id="8264461">[</span><span class="num" id="8264462">3</span><span class="op" id="8264463">]</span>&nbsp;<span class="op" id="8264465">^=</span>&nbsp;<span class="builtintype" id="8264468">byte</span><span class="op" id="8264472">(</span><span class="op" id="8264473">^</span><span class="ident" id="8264474">s</span>&nbsp;<span class="op" id="8264476">&gt;&gt;</span>&nbsp;<span class="num" id="8264479">8</span><span class="op" id="8264480">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264483">return</span>&nbsp;<span class="ident" id="8264490">b</span><span class="op" id="8264491">,</span>&nbsp;<span class="ident" id="8264493">nil</span><br>
<span class="lineno">60</span><span class="op" id="8264497">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8264500">//&nbsp;parseICMPMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="8264549">func</span>&nbsp;<span class="ident" id="8264554">parseICMPMessage</span><span class="op" id="8264570">(</span><span class="ident" id="8264571">b</span>&nbsp;<span class="op" id="8264573">[</span><span class="op" id="8264574">]</span><span class="builtintype" id="8264575">byte</span><span class="op" id="8264579">)</span>&nbsp;<span class="op" id="8264581">(</span><span class="op" id="8264582">*</span><span class="ident" id="8264583">icmpMessage</span><span class="op" id="8264594">,</span>&nbsp;<span class="builtintype" id="8264596">error</span><span class="op" id="8264601">)</span>&nbsp;<span class="op" id="8264603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264606">msglen</span>&nbsp;<span class="op" id="8264613">:=</span>&nbsp;<span class="builtinfunc" id="8264616">len</span><span class="op" id="8264619">(</span><span class="ident" id="8264620">b</span><span class="op" id="8264621">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264624">if</span>&nbsp;<span class="ident" id="8264627">msglen</span>&nbsp;<span class="op" id="8264634">&lt;</span>&nbsp;<span class="num" id="8264636">4</span>&nbsp;<span class="op" id="8264638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264642">return</span>&nbsp;<span class="ident" id="8264649">nil</span><span class="op" id="8264652">,</span>&nbsp;<span class="ident" id="8264654">errors</span><span class="op" id="8264660">.</span><span class="ident" id="8264661">New</span><span class="op" id="8264664">(</span><span class="string" id="8264665">&#34;message&nbsp;too&nbsp;short&#34;</span><span class="op" id="8264684">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264687">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264690">m</span>&nbsp;<span class="op" id="8264692">:=</span>&nbsp;<span class="op" id="8264695">&amp;</span><span class="ident" id="8264696">icmpMessage</span><span class="op" id="8264707">{</span><span class="ident" id="8264708">Type</span><span class="op" id="8264712">:</span>&nbsp;<span class="builtintype" id="8264714">int</span><span class="op" id="8264717">(</span><span class="ident" id="8264718">b</span><span class="op" id="8264719">[</span><span class="num" id="8264720">0</span><span class="op" id="8264721">]</span><span class="op" id="8264722">)</span><span class="op" id="8264723">,</span>&nbsp;<span class="ident" id="8264725">Code</span><span class="op" id="8264729">:</span>&nbsp;<span class="builtintype" id="8264731">int</span><span class="op" id="8264734">(</span><span class="ident" id="8264735">b</span><span class="op" id="8264736">[</span><span class="num" id="8264737">1</span><span class="op" id="8264738">]</span><span class="op" id="8264739">)</span><span class="op" id="8264740">,</span>&nbsp;<span class="ident" id="8264742">Checksum</span><span class="op" id="8264750">:</span>&nbsp;<span class="builtintype" id="8264752">int</span><span class="op" id="8264755">(</span><span class="ident" id="8264756">b</span><span class="op" id="8264757">[</span><span class="num" id="8264758">2</span><span class="op" id="8264759">]</span><span class="op" id="8264760">)</span><span class="op" id="8264761">&lt;&lt;</span><span class="num" id="8264763">8</span>&nbsp;<span class="op" id="8264765">|</span>&nbsp;<span class="builtintype" id="8264767">int</span><span class="op" id="8264770">(</span><span class="ident" id="8264771">b</span><span class="op" id="8264772">[</span><span class="num" id="8264773">3</span><span class="op" id="8264774">]</span><span class="op" id="8264775">)</span><span class="op" id="8264776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264779">if</span>&nbsp;<span class="ident" id="8264782">msglen</span>&nbsp;<span class="op" id="8264789">&gt;</span>&nbsp;<span class="num" id="8264791">4</span>&nbsp;<span class="op" id="8264793">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264797">var</span>&nbsp;<span class="ident" id="8264801">err</span>&nbsp;<span class="builtintype" id="8264805">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264813">switch</span>&nbsp;<span class="ident" id="8264820">m</span><span class="op" id="8264821">.</span><span class="ident" id="8264822">Type</span>&nbsp;<span class="op" id="8264827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264831">case</span>&nbsp;<span class="ident" id="8264836">icmpv4EchoRequest</span><span class="op" id="8264853">,</span>&nbsp;<span class="ident" id="8264855">icmpv4EchoReply</span><span class="op" id="8264870">,</span>&nbsp;<span class="ident" id="8264872">icmpv6EchoRequest</span><span class="op" id="8264889">,</span>&nbsp;<span class="ident" id="8264891">icmpv6EchoReply</span><span class="op" id="8264906">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8264911">m</span><span class="op" id="8264912">.</span><span class="ident" id="8264913">Body</span><span class="op" id="8264917">,</span>&nbsp;<span class="ident" id="8264919">err</span>&nbsp;<span class="op" id="8264923">=</span>&nbsp;<span class="ident" id="8264925">parseICMPEcho</span><span class="op" id="8264938">(</span><span class="ident" id="8264939">b</span><span class="op" id="8264940">[</span><span class="num" id="8264941">4</span><span class="op" id="8264942">:</span><span class="op" id="8264943">]</span><span class="op" id="8264944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264949">if</span>&nbsp;<span class="ident" id="8264952">err</span>&nbsp;<span class="op" id="8264956">!=</span>&nbsp;<span class="ident" id="8264959">nil</span>&nbsp;<span class="op" id="8264963">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264969">return</span>&nbsp;<span class="ident" id="8264976">nil</span><span class="op" id="8264979">,</span>&nbsp;<span class="ident" id="8264981">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264988">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264992">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8264995">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8264998">return</span>&nbsp;<span class="ident" id="8265005">m</span><span class="op" id="8265006">,</span>&nbsp;<span class="ident" id="8265008">nil</span><br>
<span class="lineno">80</span><span class="op" id="8265012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8265015">//&nbsp;imcpEcho&nbsp;represenets&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="8265083">type</span>&nbsp;<span class="ident" id="8265088">icmpEcho</span>&nbsp;<span class="keyword" id="8265097">struct</span>&nbsp;<span class="op" id="8265104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265107">ID</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="8265112">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8265119">//&nbsp;identifier</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265134">Seq</span>&nbsp;&nbsp;<span class="builtintype" id="8265139">int</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8265146">//&nbsp;sequence&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265166">Data</span>&nbsp;<span class="op" id="8265171">[</span><span class="op" id="8265172">]</span><span class="builtintype" id="8265173">byte</span>&nbsp;<span class="comment" id="8265178">//&nbsp;data</span><br>
<span class="lineno"></span><span class="op" id="8265186">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8265189">func</span>&nbsp;<span class="op" id="8265194">(</span><span class="ident" id="8265195">p</span>&nbsp;<span class="op" id="8265197">*</span><span class="ident" id="8265198">icmpEcho</span><span class="op" id="8265206">)</span>&nbsp;<span class="ident" id="8265208">Len</span><span class="op" id="8265211">(</span><span class="op" id="8265212">)</span>&nbsp;<span class="builtintype" id="8265214">int</span>&nbsp;<span class="op" id="8265218">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265221">if</span>&nbsp;<span class="ident" id="8265224">p</span>&nbsp;<span class="op" id="8265226">==</span>&nbsp;<span class="ident" id="8265229">nil</span>&nbsp;<span class="op" id="8265233">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265237">return</span>&nbsp;<span class="num" id="8265244">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265250">return</span>&nbsp;<span class="num" id="8265257">4</span>&nbsp;<span class="op" id="8265259">+</span>&nbsp;<span class="builtinfunc" id="8265261">len</span><span class="op" id="8265264">(</span><span class="ident" id="8265265">p</span><span class="op" id="8265266">.</span><span class="ident" id="8265267">Data</span><span class="op" id="8265271">)</span><br>
<span class="lineno"></span><span class="op" id="8265273">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="comment" id="8265276">//&nbsp;Marshal&nbsp;returns&nbsp;the&nbsp;binary&nbsp;enconding&nbsp;of&nbsp;the&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="8265344">//&nbsp;reply&nbsp;message&nbsp;body&nbsp;p.</span><br>
<span class="lineno"></span><span class="keyword" id="8265369">func</span>&nbsp;<span class="op" id="8265374">(</span><span class="ident" id="8265375">p</span>&nbsp;<span class="op" id="8265377">*</span><span class="ident" id="8265378">icmpEcho</span><span class="op" id="8265386">)</span>&nbsp;<span class="ident" id="8265388">Marshal</span><span class="op" id="8265395">(</span><span class="op" id="8265396">)</span>&nbsp;<span class="op" id="8265398">(</span><span class="op" id="8265399">[</span><span class="op" id="8265400">]</span><span class="builtintype" id="8265401">byte</span><span class="op" id="8265405">,</span>&nbsp;<span class="builtintype" id="8265407">error</span><span class="op" id="8265412">)</span>&nbsp;<span class="op" id="8265414">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265417">b</span>&nbsp;<span class="op" id="8265419">:=</span>&nbsp;<span class="builtinfunc" id="8265422">make</span><span class="op" id="8265426">(</span><span class="op" id="8265427">[</span><span class="op" id="8265428">]</span><span class="builtintype" id="8265429">byte</span><span class="op" id="8265433">,</span>&nbsp;<span class="num" id="8265435">4</span><span class="op" id="8265436">+</span><span class="builtinfunc" id="8265437">len</span><span class="op" id="8265440">(</span><span class="ident" id="8265441">p</span><span class="op" id="8265442">.</span><span class="ident" id="8265443">Data</span><span class="op" id="8265447">)</span><span class="op" id="8265448">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265451">b</span><span class="op" id="8265452">[</span><span class="num" id="8265453">0</span><span class="op" id="8265454">]</span><span class="op" id="8265455">,</span>&nbsp;<span class="ident" id="8265457">b</span><span class="op" id="8265458">[</span><span class="num" id="8265459">1</span><span class="op" id="8265460">]</span>&nbsp;<span class="op" id="8265462">=</span>&nbsp;<span class="builtintype" id="8265464">byte</span><span class="op" id="8265468">(</span><span class="ident" id="8265469">p</span><span class="op" id="8265470">.</span><span class="ident" id="8265471">ID</span><span class="op" id="8265473">&gt;&gt;</span><span class="num" id="8265475">8</span><span class="op" id="8265476">)</span><span class="op" id="8265477">,</span>&nbsp;<span class="builtintype" id="8265479">byte</span><span class="op" id="8265483">(</span><span class="ident" id="8265484">p</span><span class="op" id="8265485">.</span><span class="ident" id="8265486">ID</span><span class="op" id="8265488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265491">b</span><span class="op" id="8265492">[</span><span class="num" id="8265493">2</span><span class="op" id="8265494">]</span><span class="op" id="8265495">,</span>&nbsp;<span class="ident" id="8265497">b</span><span class="op" id="8265498">[</span><span class="num" id="8265499">3</span><span class="op" id="8265500">]</span>&nbsp;<span class="op" id="8265502">=</span>&nbsp;<span class="builtintype" id="8265504">byte</span><span class="op" id="8265508">(</span><span class="ident" id="8265509">p</span><span class="op" id="8265510">.</span><span class="ident" id="8265511">Seq</span><span class="op" id="8265514">&gt;&gt;</span><span class="num" id="8265516">8</span><span class="op" id="8265517">)</span><span class="op" id="8265518">,</span>&nbsp;<span class="builtintype" id="8265520">byte</span><span class="op" id="8265524">(</span><span class="ident" id="8265525">p</span><span class="op" id="8265526">.</span><span class="ident" id="8265527">Seq</span><span class="op" id="8265530">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8265533">copy</span><span class="op" id="8265537">(</span><span class="ident" id="8265538">b</span><span class="op" id="8265539">[</span><span class="num" id="8265540">4</span><span class="op" id="8265541">:</span><span class="op" id="8265542">]</span><span class="op" id="8265543">,</span>&nbsp;<span class="ident" id="8265545">p</span><span class="op" id="8265546">.</span><span class="ident" id="8265547">Data</span><span class="op" id="8265551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265554">return</span>&nbsp;<span class="ident" id="8265561">b</span><span class="op" id="8265562">,</span>&nbsp;<span class="ident" id="8265564">nil</span><br>
<span class="lineno"></span><span class="op" id="8265568">}</span><br>
<span class="lineno">105</span><br>
<span class="lineno"></span><span class="comment" id="8265571">//&nbsp;parseICMPEcho&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;ICMP&nbsp;echo&nbsp;request&nbsp;or&nbsp;reply&nbsp;message</span><br>
<span class="lineno"></span><span class="comment" id="8265638">//&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="8265647">func</span>&nbsp;<span class="ident" id="8265652">parseICMPEcho</span><span class="op" id="8265665">(</span><span class="ident" id="8265666">b</span>&nbsp;<span class="op" id="8265668">[</span><span class="op" id="8265669">]</span><span class="builtintype" id="8265670">byte</span><span class="op" id="8265674">)</span>&nbsp;<span class="op" id="8265676">(</span><span class="op" id="8265677">*</span><span class="ident" id="8265678">icmpEcho</span><span class="op" id="8265686">,</span>&nbsp;<span class="builtintype" id="8265688">error</span><span class="op" id="8265693">)</span>&nbsp;<span class="op" id="8265695">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265698">bodylen</span>&nbsp;<span class="op" id="8265706">:=</span>&nbsp;<span class="builtinfunc" id="8265709">len</span><span class="op" id="8265712">(</span><span class="ident" id="8265713">b</span><span class="op" id="8265714">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265717">p</span>&nbsp;<span class="op" id="8265719">:=</span>&nbsp;<span class="op" id="8265722">&amp;</span><span class="ident" id="8265723">icmpEcho</span><span class="op" id="8265731">{</span><span class="ident" id="8265732">ID</span><span class="op" id="8265734">:</span>&nbsp;<span class="builtintype" id="8265736">int</span><span class="op" id="8265739">(</span><span class="ident" id="8265740">b</span><span class="op" id="8265741">[</span><span class="num" id="8265742">0</span><span class="op" id="8265743">]</span><span class="op" id="8265744">)</span><span class="op" id="8265745">&lt;&lt;</span><span class="num" id="8265747">8</span>&nbsp;<span class="op" id="8265749">|</span>&nbsp;<span class="builtintype" id="8265751">int</span><span class="op" id="8265754">(</span><span class="ident" id="8265755">b</span><span class="op" id="8265756">[</span><span class="num" id="8265757">1</span><span class="op" id="8265758">]</span><span class="op" id="8265759">)</span><span class="op" id="8265760">,</span>&nbsp;<span class="ident" id="8265762">Seq</span><span class="op" id="8265765">:</span>&nbsp;<span class="builtintype" id="8265767">int</span><span class="op" id="8265770">(</span><span class="ident" id="8265771">b</span><span class="op" id="8265772">[</span><span class="num" id="8265773">2</span><span class="op" id="8265774">]</span><span class="op" id="8265775">)</span><span class="op" id="8265776">&lt;&lt;</span><span class="num" id="8265778">8</span>&nbsp;<span class="op" id="8265780">|</span>&nbsp;<span class="builtintype" id="8265782">int</span><span class="op" id="8265785">(</span><span class="ident" id="8265786">b</span><span class="op" id="8265787">[</span><span class="num" id="8265788">3</span><span class="op" id="8265789">]</span><span class="op" id="8265790">)</span><span class="op" id="8265791">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265794">if</span>&nbsp;<span class="ident" id="8265797">bodylen</span>&nbsp;<span class="op" id="8265805">&gt;</span>&nbsp;<span class="num" id="8265807">4</span>&nbsp;<span class="op" id="8265809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="8265813">p</span><span class="op" id="8265814">.</span><span class="ident" id="8265815">Data</span>&nbsp;<span class="op" id="8265820">=</span>&nbsp;<span class="builtinfunc" id="8265822">make</span><span class="op" id="8265826">(</span><span class="op" id="8265827">[</span><span class="op" id="8265828">]</span><span class="builtintype" id="8265829">byte</span><span class="op" id="8265833">,</span>&nbsp;<span class="ident" id="8265835">bodylen</span><span class="op" id="8265842">-</span><span class="num" id="8265843">4</span><span class="op" id="8265844">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="8265848">copy</span><span class="op" id="8265852">(</span><span class="ident" id="8265853">p</span><span class="op" id="8265854">.</span><span class="ident" id="8265855">Data</span><span class="op" id="8265859">,</span>&nbsp;<span class="ident" id="8265861">b</span><span class="op" id="8265862">[</span><span class="num" id="8265863">4</span><span class="op" id="8265864">:</span><span class="op" id="8265865">]</span><span class="op" id="8265866">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="8265869">}</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="8265872">return</span>&nbsp;<span class="ident" id="8265879">p</span><span class="op" id="8265880">,</span>&nbsp;<span class="ident" id="8265882">nil</span><br>
<span class="lineno"></span><span class="op" id="8265886">}</span>
</div>
</body>
</html>
