<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="945273">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="945328">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="945382">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="945433">package</span>&nbsp;<span class="ident" id="945441">runtime_test</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="945455">import</span>&nbsp;<span class="op" id="945462">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945465">&#34;math&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945473">&#34;runtime&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945484">&#34;sync/atomic&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945499">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945510">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="945521">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="945528">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="keyword" id="945531">var</span>&nbsp;<span class="ident" id="945535">stop</span>&nbsp;<span class="op" id="945540">=</span>&nbsp;<span class="builtinfunc" id="945542">make</span><span class="op" id="945546">(</span><span class="keyword" id="945547">chan</span>&nbsp;<span class="builtintype" id="945552">bool</span><span class="op" id="945556">,</span>&nbsp;<span class="num" id="945558">1</span><span class="op" id="945559">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="945562">func</span>&nbsp;<span class="ident" id="945567">perpetuumMobile</span><span class="op" id="945582">(</span><span class="op" id="945583">)</span>&nbsp;<span class="op" id="945585">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945588">select</span>&nbsp;<span class="op" id="945595">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945598">case</span>&nbsp;<span class="op" id="945603">&lt;-</span><span class="ident" id="945605"><a href="/runtime/proc_test.go.html#945535">stop</a></span><span class="op" id="945609">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945612">default</span><span class="op" id="945619">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945623">go</span>&nbsp;<span class="ident" id="945626"><a href="/runtime/proc_test.go.html#945567">perpetuumMobile</a></span><span class="op" id="945641">(</span><span class="op" id="945642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="945645">}</span><br>
<span class="lineno"></span><span class="op" id="945647">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="945650">func</span>&nbsp;<span class="ident" id="945655">TestStopTheWorldDeadlock</span><span class="op" id="945679">(</span><span class="ident" id="945680">t</span>&nbsp;<span class="op" id="945682">*</span><span class="ident" id="945683"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="945690">.</span><span class="ident" id="945691">T</span><span class="op" id="945692">)</span>&nbsp;<span class="op" id="945694">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945697">if</span>&nbsp;<span class="ident" id="945700"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="945707">.</span><span class="ident" id="945708">Short</span><span class="op" id="945713">(</span><span class="op" id="945714">)</span>&nbsp;<span class="op" id="945716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945720"><a href="/runtime/proc_test.go.html#945680">t</a></span><span class="op" id="945721">.</span><span class="ident" id="945722">Skip</span><span class="op" id="945726">(</span><span class="string" id="945727">&#34;skipping&nbsp;during&nbsp;short&nbsp;test&#34;</span><span class="op" id="945755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="945758">}</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945761">maxprocs</span>&nbsp;<span class="op" id="945770">:=</span>&nbsp;<span class="ident" id="945773"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="945780">.</span><span class="ident" id="945781">GOMAXPROCS</span><span class="op" id="945791">(</span><span class="num" id="945792">3</span><span class="op" id="945793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945796">compl</span>&nbsp;<span class="op" id="945802">:=</span>&nbsp;<span class="builtinfunc" id="945805">make</span><span class="op" id="945809">(</span><span class="keyword" id="945810">chan</span>&nbsp;<span class="builtintype" id="945815">bool</span><span class="op" id="945819">,</span>&nbsp;<span class="num" id="945821">2</span><span class="op" id="945822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945825">go</span>&nbsp;<span class="keyword" id="945828">func</span><span class="op" id="945832">(</span><span class="op" id="945833">)</span>&nbsp;<span class="op" id="945835">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945839">for</span>&nbsp;<span class="ident" id="945843">i</span>&nbsp;<span class="op" id="945845">:=</span>&nbsp;<span class="num" id="945848">0</span><span class="op" id="945849">;</span>&nbsp;<span class="ident" id="945851"><a href="/runtime/proc_test.go.html#945843">i</a></span>&nbsp;<span class="op" id="945853">!=</span>&nbsp;<span class="num" id="945856">1000</span><span class="op" id="945860">;</span>&nbsp;<span class="ident" id="945862"><a href="/runtime/proc_test.go.html#945843">i</a></span>&nbsp;<span class="op" id="945864">+=</span>&nbsp;<span class="num" id="945867">1</span>&nbsp;<span class="op" id="945869">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945874"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="945881">.</span><span class="ident" id="945882">GC</span><span class="op" id="945884">(</span><span class="op" id="945885">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="945889">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945893"><a href="/runtime/proc_test.go.html#945796">compl</a></span>&nbsp;<span class="op" id="945899">&lt;-</span>&nbsp;<span class="ident" id="945902">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="945908">}</span><span class="op" id="945909">(</span><span class="op" id="945910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945913">go</span>&nbsp;<span class="keyword" id="945916">func</span><span class="op" id="945920">(</span><span class="op" id="945921">)</span>&nbsp;<span class="op" id="945923">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="945927">for</span>&nbsp;<span class="ident" id="945931">i</span>&nbsp;<span class="op" id="945933">:=</span>&nbsp;<span class="num" id="945936">0</span><span class="op" id="945937">;</span>&nbsp;<span class="ident" id="945939"><a href="/runtime/proc_test.go.html#945931">i</a></span>&nbsp;<span class="op" id="945941">!=</span>&nbsp;<span class="num" id="945944">1000</span><span class="op" id="945948">;</span>&nbsp;<span class="ident" id="945950"><a href="/runtime/proc_test.go.html#945931">i</a></span>&nbsp;<span class="op" id="945952">+=</span>&nbsp;<span class="num" id="945955">1</span>&nbsp;<span class="op" id="945957">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945962"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="945969">.</span><span class="ident" id="945970">GOMAXPROCS</span><span class="op" id="945980">(</span><span class="num" id="945981">3</span><span class="op" id="945982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="945986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="945990"><a href="/runtime/proc_test.go.html#945796">compl</a></span>&nbsp;<span class="op" id="945996">&lt;-</span>&nbsp;<span class="ident" id="945999">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946005">}</span><span class="op" id="946006">(</span><span class="op" id="946007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946010">go</span>&nbsp;<span class="ident" id="946013"><a href="/runtime/proc_test.go.html#945567">perpetuumMobile</a></span><span class="op" id="946028">(</span><span class="op" id="946029">)</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946032">&lt;-</span><span class="ident" id="946034"><a href="/runtime/proc_test.go.html#945796">compl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946041">&lt;-</span><span class="ident" id="946043"><a href="/runtime/proc_test.go.html#945796">compl</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946050"><a href="/runtime/proc_test.go.html#945535">stop</a></span>&nbsp;<span class="op" id="946055">&lt;-</span>&nbsp;<span class="ident" id="946058">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946064"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946071">.</span><span class="ident" id="946072">GOMAXPROCS</span><span class="op" id="946082">(</span><span class="ident" id="946083"><a href="/runtime/proc_test.go.html#945761">maxprocs</a></span><span class="op" id="946091">)</span><br>
<span class="lineno"></span><span class="op" id="946093">}</span><br>
<span class="lineno">50</span><br>
<span class="lineno"></span><span class="keyword" id="946096">func</span>&nbsp;<span class="ident" id="946101">TestYieldProgress</span><span class="op" id="946118">(</span><span class="ident" id="946119">t</span>&nbsp;<span class="op" id="946121">*</span><span class="ident" id="946122"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946129">.</span><span class="ident" id="946130">T</span><span class="op" id="946131">)</span>&nbsp;<span class="op" id="946133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946136"><a href="/runtime/proc_test.go.html#946248">testYieldProgress</a></span><span class="op" id="946153">(</span><span class="ident" id="946154"><a href="/runtime/proc_test.go.html#946119">t</a></span><span class="op" id="946155">,</span>&nbsp;<span class="ident" id="946157">false</span><span class="op" id="946162">)</span><br>
<span class="lineno"></span><span class="op" id="946164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="keyword" id="946167">func</span>&nbsp;<span class="ident" id="946172">TestYieldLockedProgress</span><span class="op" id="946195">(</span><span class="ident" id="946196">t</span>&nbsp;<span class="op" id="946198">*</span><span class="ident" id="946199"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946206">.</span><span class="ident" id="946207">T</span><span class="op" id="946208">)</span>&nbsp;<span class="op" id="946210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946213"><a href="/runtime/proc_test.go.html#946248">testYieldProgress</a></span><span class="op" id="946230">(</span><span class="ident" id="946231"><a href="/runtime/proc_test.go.html#946196">t</a></span><span class="op" id="946232">,</span>&nbsp;<span class="ident" id="946234">true</span><span class="op" id="946238">)</span><br>
<span class="lineno"></span><span class="op" id="946240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="946243">func</span>&nbsp;<span class="ident" id="946248">testYieldProgress</span><span class="op" id="946265">(</span><span class="ident" id="946266">t</span>&nbsp;<span class="op" id="946268">*</span><span class="ident" id="946269"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946276">.</span><span class="ident" id="946277">T</span><span class="op" id="946278">,</span>&nbsp;<span class="ident" id="946280">locked</span>&nbsp;<span class="builtintype" id="946287">bool</span><span class="op" id="946291">)</span>&nbsp;<span class="op" id="946293">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946296">c</span>&nbsp;<span class="op" id="946298">:=</span>&nbsp;<span class="builtinfunc" id="946301">make</span><span class="op" id="946305">(</span><span class="keyword" id="946306">chan</span>&nbsp;<span class="builtintype" id="946311">bool</span><span class="op" id="946315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946318">cack</span>&nbsp;<span class="op" id="946323">:=</span>&nbsp;<span class="builtinfunc" id="946326">make</span><span class="op" id="946330">(</span><span class="keyword" id="946331">chan</span>&nbsp;<span class="builtintype" id="946336">bool</span><span class="op" id="946340">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946343">go</span>&nbsp;<span class="keyword" id="946346">func</span><span class="op" id="946350">(</span><span class="op" id="946351">)</span>&nbsp;<span class="op" id="946353">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946357">if</span>&nbsp;<span class="ident" id="946360"><a href="/runtime/proc_test.go.html#946280">locked</a></span>&nbsp;<span class="op" id="946367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946372"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946379">.</span><span class="ident" id="946380">LockOSThread</span><span class="op" id="946392">(</span><span class="op" id="946393">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946401">for</span>&nbsp;<span class="op" id="946405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946410">select</span>&nbsp;<span class="op" id="946417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946422">case</span>&nbsp;<span class="op" id="946427">&lt;-</span><span class="ident" id="946429"><a href="/runtime/proc_test.go.html#946296">c</a></span><span class="op" id="946430">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946436"><a href="/runtime/proc_test.go.html#946318">cack</a></span>&nbsp;<span class="op" id="946441">&lt;-</span>&nbsp;<span class="ident" id="946444">true</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946453">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946463">default</span><span class="op" id="946470">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946476"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946483">.</span><span class="ident" id="946484">Gosched</span><span class="op" id="946491">(</span><span class="op" id="946492">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946497">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946501">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946504">}</span><span class="op" id="946505">(</span><span class="op" id="946506">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946509"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="946513">.</span><span class="ident" id="946514">Sleep</span><span class="op" id="946519">(</span><span class="num" id="946520">10</span>&nbsp;<span class="op" id="946523">*</span>&nbsp;<span class="ident" id="946525"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="946529">.</span><span class="ident" id="946530">Millisecond</span><span class="op" id="946541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946544"><a href="/runtime/proc_test.go.html#946296">c</a></span>&nbsp;<span class="op" id="946546">&lt;-</span>&nbsp;<span class="ident" id="946549">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946555">&lt;-</span><span class="ident" id="946557"><a href="/runtime/proc_test.go.html#946318">cack</a></span><br>
<span class="lineno"></span><span class="op" id="946562">}</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span><span class="keyword" id="946565">func</span>&nbsp;<span class="ident" id="946570">TestYieldLocked</span><span class="op" id="946585">(</span><span class="ident" id="946586">t</span>&nbsp;<span class="op" id="946588">*</span><span class="ident" id="946589"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946596">.</span><span class="ident" id="946597">T</span><span class="op" id="946598">)</span>&nbsp;<span class="op" id="946600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946603">const</span>&nbsp;<span class="ident" id="946609">N</span>&nbsp;<span class="op" id="946611">=</span>&nbsp;<span class="num" id="946613">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946617">c</span>&nbsp;<span class="op" id="946619">:=</span>&nbsp;<span class="builtinfunc" id="946622">make</span><span class="op" id="946626">(</span><span class="keyword" id="946627">chan</span>&nbsp;<span class="builtintype" id="946632">bool</span><span class="op" id="946636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946639">go</span>&nbsp;<span class="keyword" id="946642">func</span><span class="op" id="946646">(</span><span class="op" id="946647">)</span>&nbsp;<span class="op" id="946649">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946653"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946660">.</span><span class="ident" id="946661">LockOSThread</span><span class="op" id="946673">(</span><span class="op" id="946674">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946678">for</span>&nbsp;<span class="ident" id="946682">i</span>&nbsp;<span class="op" id="946684">:=</span>&nbsp;<span class="num" id="946687">0</span><span class="op" id="946688">;</span>&nbsp;<span class="ident" id="946690"><a href="/runtime/proc_test.go.html#946682">i</a></span>&nbsp;<span class="op" id="946692">&lt;</span>&nbsp;<span class="ident" id="946694"><a href="/runtime/proc_test.go.html#946609">N</a></span><span class="op" id="946695">;</span>&nbsp;<span class="ident" id="946697"><a href="/runtime/proc_test.go.html#946682">i</a></span><span class="op" id="946698">++</span>&nbsp;<span class="op" id="946701">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946706"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946713">.</span><span class="ident" id="946714">Gosched</span><span class="op" id="946721">(</span><span class="op" id="946722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946727"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="946731">.</span><span class="ident" id="946732">Sleep</span><span class="op" id="946737">(</span><span class="ident" id="946738"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="946742">.</span><span class="ident" id="946743">Millisecond</span><span class="op" id="946754">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946758">}</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946762"><a href="/runtime/proc_test.go.html#946617">c</a></span>&nbsp;<span class="op" id="946764">&lt;-</span>&nbsp;<span class="ident" id="946767">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="946774">//&nbsp;runtime.UnlockOSThread()&nbsp;is&nbsp;deliberately&nbsp;omitted</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946827">}</span><span class="op" id="946828">(</span><span class="op" id="946829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946832">&lt;-</span><span class="ident" id="946834"><a href="/runtime/proc_test.go.html#946617">c</a></span><br>
<span class="lineno"></span><span class="op" id="946836">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span><span class="keyword" id="946839">func</span>&nbsp;<span class="ident" id="946844">TestGoroutineParallelism</span><span class="op" id="946868">(</span><span class="ident" id="946869">t</span>&nbsp;<span class="op" id="946871">*</span><span class="ident" id="946872"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946879">.</span><span class="ident" id="946880">T</span><span class="op" id="946881">)</span>&nbsp;<span class="op" id="946883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946886">P</span>&nbsp;<span class="op" id="946888">:=</span>&nbsp;<span class="num" id="946891">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946894">N</span>&nbsp;<span class="op" id="946896">:=</span>&nbsp;<span class="num" id="946899">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946903">if</span>&nbsp;<span class="ident" id="946906"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="946913">.</span><span class="ident" id="946914">Short</span><span class="op" id="946919">(</span><span class="op" id="946920">)</span>&nbsp;<span class="op" id="946922">{</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946926"><a href="/runtime/proc_test.go.html#946886">P</a></span>&nbsp;<span class="op" id="946928">=</span>&nbsp;<span class="num" id="946930">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="946934"><a href="/runtime/proc_test.go.html#946894">N</a></span>&nbsp;<span class="op" id="946936">=</span>&nbsp;<span class="num" id="946938">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="946941">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="946944">defer</span>&nbsp;<span class="ident" id="946950"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946957">.</span><span class="ident" id="946958">GOMAXPROCS</span><span class="op" id="946968">(</span><span class="ident" id="946969"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="946976">.</span><span class="ident" id="946977">GOMAXPROCS</span><span class="op" id="946987">(</span><span class="ident" id="946988"><a href="/runtime/proc_test.go.html#946886">P</a></span><span class="op" id="946989">)</span><span class="op" id="946990">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="946993">//&nbsp;If&nbsp;runtime&nbsp;triggers&nbsp;a&nbsp;forced&nbsp;GC&nbsp;during&nbsp;this&nbsp;test&nbsp;then&nbsp;it&nbsp;will&nbsp;deadlock,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="947069">//&nbsp;since&nbsp;the&nbsp;goroutines&nbsp;can&#39;t&nbsp;be&nbsp;stopped/preempted.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="947122">//&nbsp;So&nbsp;give&nbsp;this&nbsp;test&nbsp;as&nbsp;much&nbsp;time&nbsp;as&nbsp;possible.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947170"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="947177">.</span><span class="ident" id="947178">GC</span><span class="op" id="947180">(</span><span class="op" id="947181">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947184">for</span>&nbsp;<span class="ident" id="947188">try</span>&nbsp;<span class="op" id="947192">:=</span>&nbsp;<span class="num" id="947195">0</span><span class="op" id="947196">;</span>&nbsp;<span class="ident" id="947198"><a href="/runtime/proc_test.go.html#947188">try</a></span>&nbsp;<span class="op" id="947202">&lt;</span>&nbsp;<span class="ident" id="947204"><a href="/runtime/proc_test.go.html#946894">N</a></span><span class="op" id="947205">;</span>&nbsp;<span class="ident" id="947207"><a href="/runtime/proc_test.go.html#947188">try</a></span><span class="op" id="947210">++</span>&nbsp;<span class="op" id="947213">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947217">done</span>&nbsp;<span class="op" id="947222">:=</span>&nbsp;<span class="builtinfunc" id="947225">make</span><span class="op" id="947229">(</span><span class="keyword" id="947230">chan</span>&nbsp;<span class="builtintype" id="947235">bool</span><span class="op" id="947239">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947243">x</span>&nbsp;<span class="op" id="947245">:=</span>&nbsp;<span class="builtintype" id="947248">uint32</span><span class="op" id="947254">(</span><span class="num" id="947255">0</span><span class="op" id="947256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947260">for</span>&nbsp;<span class="ident" id="947264">p</span>&nbsp;<span class="op" id="947266">:=</span>&nbsp;<span class="num" id="947269">0</span><span class="op" id="947270">;</span>&nbsp;<span class="ident" id="947272"><a href="/runtime/proc_test.go.html#947264">p</a></span>&nbsp;<span class="op" id="947274">&lt;</span>&nbsp;<span class="ident" id="947276"><a href="/runtime/proc_test.go.html#946886">P</a></span><span class="op" id="947277">;</span>&nbsp;<span class="ident" id="947279"><a href="/runtime/proc_test.go.html#947264">p</a></span><span class="op" id="947280">++</span>&nbsp;<span class="op" id="947283">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="947288">//&nbsp;Test&nbsp;that&nbsp;all&nbsp;P&nbsp;goroutines&nbsp;are&nbsp;scheduled&nbsp;at&nbsp;the&nbsp;same&nbsp;time</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947352">go</span>&nbsp;<span class="keyword" id="947355">func</span><span class="op" id="947359">(</span><span class="ident" id="947360">p</span>&nbsp;<span class="builtintype" id="947362">int</span><span class="op" id="947365">)</span>&nbsp;<span class="op" id="947367">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947373">for</span>&nbsp;<span class="ident" id="947377">i</span>&nbsp;<span class="op" id="947379">:=</span>&nbsp;<span class="num" id="947382">0</span><span class="op" id="947383">;</span>&nbsp;<span class="ident" id="947385"><a href="/runtime/proc_test.go.html#947377">i</a></span>&nbsp;<span class="op" id="947387">&lt;</span>&nbsp;<span class="num" id="947389">3</span><span class="op" id="947390">;</span>&nbsp;<span class="ident" id="947392"><a href="/runtime/proc_test.go.html#947377">i</a></span><span class="op" id="947393">++</span>&nbsp;<span class="op" id="947396">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947403">expected</span>&nbsp;<span class="op" id="947412">:=</span>&nbsp;<span class="builtintype" id="947415">uint32</span><span class="op" id="947421">(</span><span class="ident" id="947422"><a href="/runtime/proc_test.go.html#946886">P</a></span><span class="op" id="947423">*</span><span class="ident" id="947424"><a href="/runtime/proc_test.go.html#947377">i</a></span>&nbsp;<span class="op" id="947426">+</span>&nbsp;<span class="ident" id="947428"><a href="/runtime/proc_test.go.html#947360">p</a></span><span class="op" id="947429">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947436">for</span>&nbsp;<span class="ident" id="947440"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="947446">.</span><span class="ident" id="947447">LoadUint32</span><span class="op" id="947457">(</span><span class="op" id="947458">&amp;</span><span class="ident" id="947459"><a href="/runtime/proc_test.go.html#947243">x</a></span><span class="op" id="947460">)</span>&nbsp;<span class="op" id="947462">!=</span>&nbsp;<span class="ident" id="947465"><a href="/runtime/proc_test.go.html#947403">expected</a></span>&nbsp;<span class="op" id="947474">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947488"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="947494">.</span><span class="ident" id="947495">StoreUint32</span><span class="op" id="947506">(</span><span class="op" id="947507">&amp;</span><span class="ident" id="947508"><a href="/runtime/proc_test.go.html#947243">x</a></span><span class="op" id="947509">,</span>&nbsp;<span class="ident" id="947511"><a href="/runtime/proc_test.go.html#947403">expected</a></span><span class="op" id="947519">+</span><span class="num" id="947520">1</span><span class="op" id="947521">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947527">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947533"><a href="/runtime/proc_test.go.html#947217">done</a></span>&nbsp;<span class="op" id="947538">&lt;-</span>&nbsp;<span class="ident" id="947541">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947549">}</span><span class="op" id="947550">(</span><span class="ident" id="947551"><a href="/runtime/proc_test.go.html#947264">p</a></span><span class="op" id="947552">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947560">for</span>&nbsp;<span class="ident" id="947564">p</span>&nbsp;<span class="op" id="947566">:=</span>&nbsp;<span class="num" id="947569">0</span><span class="op" id="947570">;</span>&nbsp;<span class="ident" id="947572"><a href="/runtime/proc_test.go.html#947564">p</a></span>&nbsp;<span class="op" id="947574">&lt;</span>&nbsp;<span class="ident" id="947576"><a href="/runtime/proc_test.go.html#946886">P</a></span><span class="op" id="947577">;</span>&nbsp;<span class="ident" id="947579"><a href="/runtime/proc_test.go.html#947564">p</a></span><span class="op" id="947580">++</span>&nbsp;<span class="op" id="947583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947588">&lt;-</span><span class="ident" id="947590"><a href="/runtime/proc_test.go.html#947217">done</a></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947597">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947600">}</span><br>
<span class="lineno"></span><span class="op" id="947602">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="947605">func</span>&nbsp;<span class="ident" id="947610">TestBlockLocked</span><span class="op" id="947625">(</span><span class="ident" id="947626">t</span>&nbsp;<span class="op" id="947628">*</span><span class="ident" id="947629"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="947636">.</span><span class="ident" id="947637">T</span><span class="op" id="947638">)</span>&nbsp;<span class="op" id="947640">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947643">const</span>&nbsp;<span class="ident" id="947649">N</span>&nbsp;<span class="op" id="947651">=</span>&nbsp;<span class="num" id="947653">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947657">c</span>&nbsp;<span class="op" id="947659">:=</span>&nbsp;<span class="builtinfunc" id="947662">make</span><span class="op" id="947666">(</span><span class="keyword" id="947667">chan</span>&nbsp;<span class="builtintype" id="947672">bool</span><span class="op" id="947676">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947679">go</span>&nbsp;<span class="keyword" id="947682">func</span><span class="op" id="947686">(</span><span class="op" id="947687">)</span>&nbsp;<span class="op" id="947689">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947693"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="947700">.</span><span class="ident" id="947701">LockOSThread</span><span class="op" id="947713">(</span><span class="op" id="947714">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947718">for</span>&nbsp;<span class="ident" id="947722">i</span>&nbsp;<span class="op" id="947724">:=</span>&nbsp;<span class="num" id="947727">0</span><span class="op" id="947728">;</span>&nbsp;<span class="ident" id="947730"><a href="/runtime/proc_test.go.html#947722">i</a></span>&nbsp;<span class="op" id="947732">&lt;</span>&nbsp;<span class="ident" id="947734"><a href="/runtime/proc_test.go.html#947649">N</a></span><span class="op" id="947735">;</span>&nbsp;<span class="ident" id="947737"><a href="/runtime/proc_test.go.html#947722">i</a></span><span class="op" id="947738">++</span>&nbsp;<span class="op" id="947741">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947746"><a href="/runtime/proc_test.go.html#947657">c</a></span>&nbsp;<span class="op" id="947748">&lt;-</span>&nbsp;<span class="ident" id="947751">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947758">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947762"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="947769">.</span><span class="ident" id="947770">UnlockOSThread</span><span class="op" id="947784">(</span><span class="op" id="947785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947788">}</span><span class="op" id="947789">(</span><span class="op" id="947790">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947793">for</span>&nbsp;<span class="ident" id="947797">i</span>&nbsp;<span class="op" id="947799">:=</span>&nbsp;<span class="num" id="947802">0</span><span class="op" id="947803">;</span>&nbsp;<span class="ident" id="947805"><a href="/runtime/proc_test.go.html#947797">i</a></span>&nbsp;<span class="op" id="947807">&lt;</span>&nbsp;<span class="ident" id="947809"><a href="/runtime/proc_test.go.html#947649">N</a></span><span class="op" id="947810">;</span>&nbsp;<span class="ident" id="947812"><a href="/runtime/proc_test.go.html#947797">i</a></span><span class="op" id="947813">++</span>&nbsp;<span class="op" id="947816">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947820">&lt;-</span><span class="ident" id="947822"><a href="/runtime/proc_test.go.html#947657">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="947825">}</span><br>
<span class="lineno"></span><span class="op" id="947827">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="947830">func</span>&nbsp;<span class="ident" id="947835">TestTimerFairness</span><span class="op" id="947852">(</span><span class="ident" id="947853">t</span>&nbsp;<span class="op" id="947855">*</span><span class="ident" id="947856"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="947863">.</span><span class="ident" id="947864">T</span><span class="op" id="947865">)</span>&nbsp;<span class="op" id="947867">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947870">done</span>&nbsp;<span class="op" id="947875">:=</span>&nbsp;<span class="builtinfunc" id="947878">make</span><span class="op" id="947882">(</span><span class="keyword" id="947883">chan</span>&nbsp;<span class="builtintype" id="947888">bool</span><span class="op" id="947892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="947895">c</span>&nbsp;<span class="op" id="947897">:=</span>&nbsp;<span class="builtinfunc" id="947900">make</span><span class="op" id="947904">(</span><span class="keyword" id="947905">chan</span>&nbsp;<span class="builtintype" id="947910">bool</span><span class="op" id="947914">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947917">for</span>&nbsp;<span class="ident" id="947921">i</span>&nbsp;<span class="op" id="947923">:=</span>&nbsp;<span class="num" id="947926">0</span><span class="op" id="947927">;</span>&nbsp;<span class="ident" id="947929"><a href="/runtime/proc_test.go.html#947921">i</a></span>&nbsp;<span class="op" id="947931">&lt;</span>&nbsp;<span class="num" id="947933">2</span><span class="op" id="947934">;</span>&nbsp;<span class="ident" id="947936"><a href="/runtime/proc_test.go.html#947921">i</a></span><span class="op" id="947937">++</span>&nbsp;<span class="op" id="947940">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947944">go</span>&nbsp;<span class="keyword" id="947947">func</span><span class="op" id="947951">(</span><span class="op" id="947952">)</span>&nbsp;<span class="op" id="947954">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947959">for</span>&nbsp;<span class="op" id="947963">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947969">select</span>&nbsp;<span class="op" id="947976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="947982">case</span>&nbsp;<span class="ident" id="947987"><a href="/runtime/proc_test.go.html#947895">c</a></span>&nbsp;<span class="op" id="947989">&lt;-</span>&nbsp;<span class="ident" id="947992">true</span><span class="op" id="947996">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948002">case</span>&nbsp;<span class="op" id="948007">&lt;-</span><span class="ident" id="948009"><a href="/runtime/proc_test.go.html#947870">done</a></span><span class="op" id="948013">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948020">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948031">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948036">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948040">}</span><span class="op" id="948041">(</span><span class="op" id="948042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948045">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948049">timer</span>&nbsp;<span class="op" id="948055">:=</span>&nbsp;<span class="ident" id="948058"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="948062">.</span><span class="ident" id="948063">After</span><span class="op" id="948068">(</span><span class="num" id="948069">20</span>&nbsp;<span class="op" id="948072">*</span>&nbsp;<span class="ident" id="948074"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="948078">.</span><span class="ident" id="948079">Millisecond</span><span class="op" id="948090">)</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948093">for</span>&nbsp;<span class="op" id="948097">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948101">select</span>&nbsp;<span class="op" id="948108">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948112">case</span>&nbsp;<span class="op" id="948117">&lt;-</span><span class="ident" id="948119"><a href="/runtime/proc_test.go.html#947895">c</a></span><span class="op" id="948120">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948124">case</span>&nbsp;<span class="op" id="948129">&lt;-</span><span class="ident" id="948131"><a href="/runtime/proc_test.go.html#948049">timer</a></span><span class="op" id="948136">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="948141">close</span><span class="op" id="948146">(</span><span class="ident" id="948147"><a href="/runtime/proc_test.go.html#947870">done</a></span><span class="op" id="948151">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948156">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948165">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948168">}</span><br>
<span class="lineno"></span><span class="op" id="948170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span><span class="keyword" id="948173">func</span>&nbsp;<span class="ident" id="948178">TestTimerFairness2</span><span class="op" id="948196">(</span><span class="ident" id="948197">t</span>&nbsp;<span class="op" id="948199">*</span><span class="ident" id="948200"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="948207">.</span><span class="ident" id="948208">T</span><span class="op" id="948209">)</span>&nbsp;<span class="op" id="948211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948214">done</span>&nbsp;<span class="op" id="948219">:=</span>&nbsp;<span class="builtinfunc" id="948222">make</span><span class="op" id="948226">(</span><span class="keyword" id="948227">chan</span>&nbsp;<span class="builtintype" id="948232">bool</span><span class="op" id="948236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948239">c</span>&nbsp;<span class="op" id="948241">:=</span>&nbsp;<span class="builtinfunc" id="948244">make</span><span class="op" id="948248">(</span><span class="keyword" id="948249">chan</span>&nbsp;<span class="builtintype" id="948254">bool</span><span class="op" id="948258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948261">for</span>&nbsp;<span class="ident" id="948265">i</span>&nbsp;<span class="op" id="948267">:=</span>&nbsp;<span class="num" id="948270">0</span><span class="op" id="948271">;</span>&nbsp;<span class="ident" id="948273"><a href="/runtime/proc_test.go.html#948265">i</a></span>&nbsp;<span class="op" id="948275">&lt;</span>&nbsp;<span class="num" id="948277">2</span><span class="op" id="948278">;</span>&nbsp;<span class="ident" id="948280"><a href="/runtime/proc_test.go.html#948265">i</a></span><span class="op" id="948281">++</span>&nbsp;<span class="op" id="948284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948288">go</span>&nbsp;<span class="keyword" id="948291">func</span><span class="op" id="948295">(</span><span class="op" id="948296">)</span>&nbsp;<span class="op" id="948298">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948303">timer</span>&nbsp;<span class="op" id="948309">:=</span>&nbsp;<span class="ident" id="948312"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="948316">.</span><span class="ident" id="948317">After</span><span class="op" id="948322">(</span><span class="num" id="948323">20</span>&nbsp;<span class="op" id="948326">*</span>&nbsp;<span class="ident" id="948328"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="948332">.</span><span class="ident" id="948333">Millisecond</span><span class="op" id="948344">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948349">var</span>&nbsp;<span class="ident" id="948353">buf</span>&nbsp;<span class="op" id="948357">[</span><span class="num" id="948358">1</span><span class="op" id="948359">]</span><span class="builtintype" id="948360">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948368">for</span>&nbsp;<span class="op" id="948372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948378"><a href="/runtime/proc_test.go.html#945499">syscall</a></span><span class="op" id="948385">.</span><span class="ident" id="948386">Read</span><span class="op" id="948390">(</span><span class="num" id="948391">0</span><span class="op" id="948392">,</span>&nbsp;<span class="ident" id="948394"><a href="/runtime/proc_test.go.html#948353">buf</a></span><span class="op" id="948397">[</span><span class="num" id="948398">0</span><span class="op" id="948399">:</span><span class="num" id="948400">0</span><span class="op" id="948401">]</span><span class="op" id="948402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948408">select</span>&nbsp;<span class="op" id="948415">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948421">case</span>&nbsp;<span class="ident" id="948426"><a href="/runtime/proc_test.go.html#948239">c</a></span>&nbsp;<span class="op" id="948428">&lt;-</span>&nbsp;<span class="ident" id="948431">true</span><span class="op" id="948435">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948441">case</span>&nbsp;<span class="op" id="948446">&lt;-</span><span class="ident" id="948448"><a href="/runtime/proc_test.go.html#948239">c</a></span><span class="op" id="948449">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948455">case</span>&nbsp;<span class="op" id="948460">&lt;-</span><span class="ident" id="948462"><a href="/runtime/proc_test.go.html#948303">timer</a></span><span class="op" id="948467">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948474"><a href="/runtime/proc_test.go.html#948214">done</a></span>&nbsp;<span class="op" id="948479">&lt;-</span>&nbsp;<span class="ident" id="948482">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948492">return</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948503">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948508">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948512">}</span><span class="op" id="948513">(</span><span class="op" id="948514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948520">&lt;-</span><span class="ident" id="948522"><a href="/runtime/proc_test.go.html#948214">done</a></span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948528">&lt;-</span><span class="ident" id="948530"><a href="/runtime/proc_test.go.html#948214">done</a></span><br>
<span class="lineno"></span><span class="op" id="948535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="948538">//&nbsp;The&nbsp;function&nbsp;is&nbsp;used&nbsp;to&nbsp;test&nbsp;preemption&nbsp;at&nbsp;split&nbsp;stack&nbsp;checks.</span><br>
<span class="lineno"></span><span class="comment" id="948604">//&nbsp;Declaring&nbsp;a&nbsp;var&nbsp;avoids&nbsp;inlining&nbsp;at&nbsp;the&nbsp;call&nbsp;site.</span><br>
<span class="lineno">195</span><span class="keyword" id="948657">var</span>&nbsp;<span class="ident" id="948661">preempt</span>&nbsp;<span class="op" id="948669">=</span>&nbsp;<span class="keyword" id="948671">func</span><span class="op" id="948675">(</span><span class="op" id="948676">)</span>&nbsp;<span class="builtintype" id="948678">int</span>&nbsp;<span class="op" id="948682">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948685">var</span>&nbsp;<span class="ident" id="948689">a</span>&nbsp;<span class="op" id="948691">[</span><span class="num" id="948692">128</span><span class="op" id="948695">]</span><span class="builtintype" id="948696">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948701">sum</span>&nbsp;<span class="op" id="948705">:=</span>&nbsp;<span class="num" id="948708">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948711">for</span>&nbsp;<span class="ident" id="948715">_</span><span class="op" id="948716">,</span>&nbsp;<span class="ident" id="948718">v</span>&nbsp;<span class="op" id="948720">:=</span>&nbsp;<span class="keyword" id="948723">range</span>&nbsp;<span class="ident" id="948729"><a href="/runtime/proc_test.go.html#948689">a</a></span>&nbsp;<span class="op" id="948731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948735"><a href="/runtime/proc_test.go.html#948701">sum</a></span>&nbsp;<span class="op" id="948739">+=</span>&nbsp;<span class="ident" id="948742"><a href="/runtime/proc_test.go.html#948718">v</a></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948748">return</span>&nbsp;<span class="ident" id="948755"><a href="/runtime/proc_test.go.html#948701">sum</a></span><br>
<span class="lineno"></span><span class="op" id="948759">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="948762">func</span>&nbsp;<span class="ident" id="948767">TestPreemption</span><span class="op" id="948781">(</span><span class="ident" id="948782">t</span>&nbsp;<span class="op" id="948784">*</span><span class="ident" id="948785"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="948792">.</span><span class="ident" id="948793">T</span><span class="op" id="948794">)</span>&nbsp;<span class="op" id="948796">{</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="948799">//&nbsp;Test&nbsp;that&nbsp;goroutines&nbsp;are&nbsp;preempted&nbsp;at&nbsp;function&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948857">N</span>&nbsp;<span class="op" id="948859">:=</span>&nbsp;<span class="num" id="948862">5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948865">if</span>&nbsp;<span class="ident" id="948868"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="948875">.</span><span class="ident" id="948876">Short</span><span class="op" id="948881">(</span><span class="op" id="948882">)</span>&nbsp;<span class="op" id="948884">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948888"><a href="/runtime/proc_test.go.html#948857">N</a></span>&nbsp;<span class="op" id="948890">=</span>&nbsp;<span class="num" id="948892">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="948895">}</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="948898">c</span>&nbsp;<span class="op" id="948900">:=</span>&nbsp;<span class="builtinfunc" id="948903">make</span><span class="op" id="948907">(</span><span class="keyword" id="948908">chan</span>&nbsp;<span class="builtintype" id="948913">bool</span><span class="op" id="948917">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948920">var</span>&nbsp;<span class="ident" id="948924">x</span>&nbsp;<span class="builtintype" id="948926">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948934">for</span>&nbsp;<span class="ident" id="948938">g</span>&nbsp;<span class="op" id="948940">:=</span>&nbsp;<span class="num" id="948943">0</span><span class="op" id="948944">;</span>&nbsp;<span class="ident" id="948946"><a href="/runtime/proc_test.go.html#948938">g</a></span>&nbsp;<span class="op" id="948948">&lt;</span>&nbsp;<span class="num" id="948950">2</span><span class="op" id="948951">;</span>&nbsp;<span class="ident" id="948953"><a href="/runtime/proc_test.go.html#948938">g</a></span><span class="op" id="948954">++</span>&nbsp;<span class="op" id="948957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948961">go</span>&nbsp;<span class="keyword" id="948964">func</span><span class="op" id="948968">(</span><span class="ident" id="948969">g</span>&nbsp;<span class="builtintype" id="948971">int</span><span class="op" id="948974">)</span>&nbsp;<span class="op" id="948976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="948981">for</span>&nbsp;<span class="ident" id="948985">i</span>&nbsp;<span class="op" id="948987">:=</span>&nbsp;<span class="num" id="948990">0</span><span class="op" id="948991">;</span>&nbsp;<span class="ident" id="948993"><a href="/runtime/proc_test.go.html#948985">i</a></span>&nbsp;<span class="op" id="948995">&lt;</span>&nbsp;<span class="ident" id="948997"><a href="/runtime/proc_test.go.html#948857">N</a></span><span class="op" id="948998">;</span>&nbsp;<span class="ident" id="949000"><a href="/runtime/proc_test.go.html#948985">i</a></span><span class="op" id="949001">++</span>&nbsp;<span class="op" id="949004">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949010">for</span>&nbsp;<span class="ident" id="949014"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="949020">.</span><span class="ident" id="949021">LoadUint32</span><span class="op" id="949031">(</span><span class="op" id="949032">&amp;</span><span class="ident" id="949033"><a href="/runtime/proc_test.go.html#948924">x</a></span><span class="op" id="949034">)</span>&nbsp;<span class="op" id="949036">!=</span>&nbsp;<span class="builtintype" id="949039">uint32</span><span class="op" id="949045">(</span><span class="ident" id="949046"><a href="/runtime/proc_test.go.html#948969">g</a></span><span class="op" id="949047">)</span>&nbsp;<span class="op" id="949049">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949056"><a href="/runtime/proc_test.go.html#948661">preempt</a></span><span class="op" id="949063">(</span><span class="op" id="949064">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949070">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949076"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="949082">.</span><span class="ident" id="949083">StoreUint32</span><span class="op" id="949094">(</span><span class="op" id="949095">&amp;</span><span class="ident" id="949096"><a href="/runtime/proc_test.go.html#948924">x</a></span><span class="op" id="949097">,</span>&nbsp;<span class="builtintype" id="949099">uint32</span><span class="op" id="949105">(</span><span class="num" id="949106">1</span><span class="op" id="949107">-</span><span class="ident" id="949108"><a href="/runtime/proc_test.go.html#948969">g</a></span><span class="op" id="949109">)</span><span class="op" id="949110">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949115">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949120"><a href="/runtime/proc_test.go.html#948898">c</a></span>&nbsp;<span class="op" id="949122">&lt;-</span>&nbsp;<span class="ident" id="949125">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949132">}</span><span class="op" id="949133">(</span><span class="ident" id="949134"><a href="/runtime/proc_test.go.html#948938">g</a></span><span class="op" id="949135">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949138">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949141">&lt;-</span><span class="ident" id="949143"><a href="/runtime/proc_test.go.html#948898">c</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949146">&lt;-</span><span class="ident" id="949148"><a href="/runtime/proc_test.go.html#948898">c</a></span><br>
<span class="lineno">225</span><span class="op" id="949150">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="949153">func</span>&nbsp;<span class="ident" id="949158">TestPreemptionGC</span><span class="op" id="949174">(</span><span class="ident" id="949175">t</span>&nbsp;<span class="op" id="949177">*</span><span class="ident" id="949178"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="949185">.</span><span class="ident" id="949186">T</span><span class="op" id="949187">)</span>&nbsp;<span class="op" id="949189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="949192">//&nbsp;Test&nbsp;that&nbsp;pending&nbsp;GC&nbsp;preempts&nbsp;running&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949246">P</span>&nbsp;<span class="op" id="949248">:=</span>&nbsp;<span class="num" id="949251">5</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949254">N</span>&nbsp;<span class="op" id="949256">:=</span>&nbsp;<span class="num" id="949259">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949263">if</span>&nbsp;<span class="ident" id="949266"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="949273">.</span><span class="ident" id="949274">Short</span><span class="op" id="949279">(</span><span class="op" id="949280">)</span>&nbsp;<span class="op" id="949282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949286"><a href="/runtime/proc_test.go.html#949246">P</a></span>&nbsp;<span class="op" id="949288">=</span>&nbsp;<span class="num" id="949290">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949294"><a href="/runtime/proc_test.go.html#949254">N</a></span>&nbsp;<span class="op" id="949296">=</span>&nbsp;<span class="num" id="949298">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949301">}</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949304">defer</span>&nbsp;<span class="ident" id="949310"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="949317">.</span><span class="ident" id="949318">GOMAXPROCS</span><span class="op" id="949328">(</span><span class="ident" id="949329"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="949336">.</span><span class="ident" id="949337">GOMAXPROCS</span><span class="op" id="949347">(</span><span class="ident" id="949348"><a href="/runtime/proc_test.go.html#949246">P</a></span>&nbsp;<span class="op" id="949350">+</span>&nbsp;<span class="num" id="949352">1</span><span class="op" id="949353">)</span><span class="op" id="949354">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949357">var</span>&nbsp;<span class="ident" id="949361">stop</span>&nbsp;<span class="builtintype" id="949366">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949374">for</span>&nbsp;<span class="ident" id="949378">i</span>&nbsp;<span class="op" id="949380">:=</span>&nbsp;<span class="num" id="949383">0</span><span class="op" id="949384">;</span>&nbsp;<span class="ident" id="949386"><a href="/runtime/proc_test.go.html#949378">i</a></span>&nbsp;<span class="op" id="949388">&lt;</span>&nbsp;<span class="ident" id="949390"><a href="/runtime/proc_test.go.html#949246">P</a></span><span class="op" id="949391">;</span>&nbsp;<span class="ident" id="949393"><a href="/runtime/proc_test.go.html#949378">i</a></span><span class="op" id="949394">++</span>&nbsp;<span class="op" id="949397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949401">go</span>&nbsp;<span class="keyword" id="949404">func</span><span class="op" id="949408">(</span><span class="op" id="949409">)</span>&nbsp;<span class="op" id="949411">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949416">for</span>&nbsp;<span class="ident" id="949420"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="949426">.</span><span class="ident" id="949427">LoadUint32</span><span class="op" id="949437">(</span><span class="op" id="949438">&amp;</span><span class="ident" id="949439"><a href="/runtime/proc_test.go.html#949361">stop</a></span><span class="op" id="949443">)</span>&nbsp;<span class="op" id="949445">==</span>&nbsp;<span class="num" id="949448">0</span>&nbsp;<span class="op" id="949450">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949456"><a href="/runtime/proc_test.go.html#948661">preempt</a></span><span class="op" id="949463">(</span><span class="op" id="949464">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949469">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949473">}</span><span class="op" id="949474">(</span><span class="op" id="949475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949478">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949481">for</span>&nbsp;<span class="ident" id="949485">i</span>&nbsp;<span class="op" id="949487">:=</span>&nbsp;<span class="num" id="949490">0</span><span class="op" id="949491">;</span>&nbsp;<span class="ident" id="949493"><a href="/runtime/proc_test.go.html#949485">i</a></span>&nbsp;<span class="op" id="949495">&lt;</span>&nbsp;<span class="ident" id="949497"><a href="/runtime/proc_test.go.html#949254">N</a></span><span class="op" id="949498">;</span>&nbsp;<span class="ident" id="949500"><a href="/runtime/proc_test.go.html#949485">i</a></span><span class="op" id="949501">++</span>&nbsp;<span class="op" id="949504">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949508"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="949515">.</span><span class="ident" id="949516">Gosched</span><span class="op" id="949523">(</span><span class="op" id="949524">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949528"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="949535">.</span><span class="ident" id="949536">GC</span><span class="op" id="949538">(</span><span class="op" id="949539">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949545"><a href="/runtime/proc_test.go.html#945484">atomic</a></span><span class="op" id="949551">.</span><span class="ident" id="949552">StoreUint32</span><span class="op" id="949563">(</span><span class="op" id="949564">&amp;</span><span class="ident" id="949565"><a href="/runtime/proc_test.go.html#949361">stop</a></span><span class="op" id="949569">,</span>&nbsp;<span class="num" id="949571">1</span><span class="op" id="949572">)</span><br>
<span class="lineno"></span><span class="op" id="949574">}</span><br>
<span class="lineno">250</span><br>
<span class="lineno"></span><span class="keyword" id="949577">func</span>&nbsp;<span class="ident" id="949582">TestGCFairness</span><span class="op" id="949596">(</span><span class="ident" id="949597">t</span>&nbsp;<span class="op" id="949599">*</span><span class="ident" id="949600"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="949607">.</span><span class="ident" id="949608">T</span><span class="op" id="949609">)</span>&nbsp;<span class="op" id="949611">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949614">output</span>&nbsp;<span class="op" id="949621">:=</span>&nbsp;<span class="ident" id="949624"><a href="/runtime/crash_test.go.html#865510">executeTest</a></span><span class="op" id="949635">(</span><span class="ident" id="949636"><a href="/runtime/proc_test.go.html#949597">t</a></span><span class="op" id="949637">,</span>&nbsp;<span class="ident" id="949639"><a href="/runtime/proc_test.go.html#949761">testGCFairnessSource</a></span><span class="op" id="949659">,</span>&nbsp;<span class="ident" id="949661">nil</span><span class="op" id="949664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949667">want</span>&nbsp;<span class="op" id="949672">:=</span>&nbsp;<span class="string" id="949675">&#34;OK\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="949683">if</span>&nbsp;<span class="ident" id="949686"><a href="/runtime/proc_test.go.html#949614">output</a></span>&nbsp;<span class="op" id="949693">!=</span>&nbsp;<span class="ident" id="949696"><a href="/runtime/proc_test.go.html#949667">want</a></span>&nbsp;<span class="op" id="949701">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="949705"><a href="/runtime/proc_test.go.html#949597">t</a></span><span class="op" id="949706">.</span><span class="ident" id="949707">Fatalf</span><span class="op" id="949713">(</span><span class="string" id="949714">&#34;want&nbsp;%s,&nbsp;got&nbsp;%s\n&#34;</span><span class="op" id="949733">,</span>&nbsp;<span class="ident" id="949735"><a href="/runtime/proc_test.go.html#949667">want</a></span><span class="op" id="949739">,</span>&nbsp;<span class="ident" id="949741"><a href="/runtime/proc_test.go.html#949614">output</a></span><span class="op" id="949747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="949750">}</span><br>
<span class="lineno"></span><span class="op" id="949752">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="949755">const</span>&nbsp;<span class="ident" id="949761">testGCFairnessSource</span>&nbsp;<span class="op" id="949782">=</span>&nbsp;<span class="string" id="949784">`<br>
<span class="lineno">260</span>package&nbsp;main<br>
<span class="lineno"></span><br>
<span class="lineno"></span>import&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;fmt&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;os&#34;<br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&#34;runtime&#34;<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&#34;time&#34;<br>
<span class="lineno"></span>)<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;main()&nbsp;{<br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbspruntime.GOMAXPROCS(1)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspf,&nbsp;err&nbsp;:=&nbsp;os.Open(&#34;/dev/null&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;os.IsNotExist(err)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;This&nbsp;test&nbsp;tests&nbsp;what&nbsp;it&nbsp;is&nbsp;intended&nbsp;to&nbsp;test&nbsp;only&nbsp;if&nbsp;writes&nbsp;are&nbsp;fast.<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;If&nbsp;there&nbsp;is&nbsp;no&nbsp;/dev/null,&nbsp;we&nbsp;just&nbsp;don&#39;t&nbsp;execute&nbsp;the&nbsp;test.<br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Println(&#34;OK&#34;)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspreturn<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspif&nbsp;err&nbsp;!=&nbsp;nil&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfmt.Println(err)<br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspos.Exit(1)<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;i&nbsp;:=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;2;&nbsp;i++&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspgo&nbsp;func()&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspfor&nbsp;{<br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbspf.Write([]byte(&#34;.&#34;))<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp}()<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsptime.Sleep(10&nbsp;*&nbsp;time.Millisecond)<br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbspfmt.Println(&#34;OK&#34;)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="950306">func</span>&nbsp;<span class="ident" id="950311">stackGrowthRecursive</span><span class="op" id="950331">(</span><span class="ident" id="950332">i</span>&nbsp;<span class="builtintype" id="950334">int</span><span class="op" id="950337">)</span>&nbsp;<span class="op" id="950339">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950342">var</span>&nbsp;<span class="ident" id="950346">pad</span>&nbsp;<span class="op" id="950350">[</span><span class="num" id="950351">128</span><span class="op" id="950354">]</span><span class="ident" id="950355">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950363">if</span>&nbsp;<span class="ident" id="950366"><a href="/runtime/proc_test.go.html#950332">i</a></span>&nbsp;<span class="op" id="950368">!=</span>&nbsp;<span class="num" id="950371">0</span>&nbsp;<span class="op" id="950373">&amp;&amp;</span>&nbsp;<span class="ident" id="950376"><a href="/runtime/proc_test.go.html#950346">pad</a></span><span class="op" id="950379">[</span><span class="num" id="950380">0</span><span class="op" id="950381">]</span>&nbsp;<span class="op" id="950383">==</span>&nbsp;<span class="num" id="950386">0</span>&nbsp;<span class="op" id="950388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950392"><a href="/runtime/proc_test.go.html#950311">stackGrowthRecursive</a></span><span class="op" id="950412">(</span><span class="ident" id="950413"><a href="/runtime/proc_test.go.html#950332">i</a></span>&nbsp;<span class="op" id="950415">-</span>&nbsp;<span class="num" id="950417">1</span><span class="op" id="950418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="950421">}</span><br>
<span class="lineno"></span><span class="op" id="950423">}</span><br>
<span class="lineno">300</span><br>
<span class="lineno"></span><span class="keyword" id="950426">func</span>&nbsp;<span class="ident" id="950431">TestPreemptSplitBig</span><span class="op" id="950450">(</span><span class="ident" id="950451">t</span>&nbsp;<span class="op" id="950453">*</span><span class="ident" id="950454"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="950461">.</span><span class="ident" id="950462">T</span><span class="op" id="950463">)</span>&nbsp;<span class="op" id="950465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950468">if</span>&nbsp;<span class="ident" id="950471"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="950478">.</span><span class="ident" id="950479">Short</span><span class="op" id="950484">(</span><span class="op" id="950485">)</span>&nbsp;<span class="op" id="950487">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950491"><a href="/runtime/proc_test.go.html#950451">t</a></span><span class="op" id="950492">.</span><span class="ident" id="950493">Skip</span><span class="op" id="950497">(</span><span class="string" id="950498">&#34;skipping&nbsp;in&nbsp;-short&nbsp;mode&#34;</span><span class="op" id="950523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="950526">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950529">defer</span>&nbsp;<span class="ident" id="950535"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="950542">.</span><span class="ident" id="950543">GOMAXPROCS</span><span class="op" id="950553">(</span><span class="ident" id="950554"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="950561">.</span><span class="ident" id="950562">GOMAXPROCS</span><span class="op" id="950572">(</span><span class="num" id="950573">2</span><span class="op" id="950574">)</span><span class="op" id="950575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950578">stop</span>&nbsp;<span class="op" id="950583">:=</span>&nbsp;<span class="builtinfunc" id="950586">make</span><span class="op" id="950590">(</span><span class="keyword" id="950591">chan</span>&nbsp;<span class="builtintype" id="950596">int</span><span class="op" id="950599">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950602">go</span>&nbsp;<span class="ident" id="950605"><a href="/runtime/proc_test.go.html#950741">big</a></span><span class="op" id="950608">(</span><span class="ident" id="950609"><a href="/runtime/proc_test.go.html#950578">stop</a></span><span class="op" id="950613">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950616">for</span>&nbsp;<span class="ident" id="950620">i</span>&nbsp;<span class="op" id="950622">:=</span>&nbsp;<span class="num" id="950625">0</span><span class="op" id="950626">;</span>&nbsp;<span class="ident" id="950628"><a href="/runtime/proc_test.go.html#950620">i</a></span>&nbsp;<span class="op" id="950630">&lt;</span>&nbsp;<span class="num" id="950632">3</span><span class="op" id="950633">;</span>&nbsp;<span class="ident" id="950635"><a href="/runtime/proc_test.go.html#950620">i</a></span><span class="op" id="950636">++</span>&nbsp;<span class="op" id="950639">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950643"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="950647">.</span><span class="ident" id="950648">Sleep</span><span class="op" id="950653">(</span><span class="num" id="950654">10</span>&nbsp;<span class="op" id="950657">*</span>&nbsp;<span class="ident" id="950659"><a href="/runtime/proc_test.go.html#945521">time</a></span><span class="op" id="950663">.</span><span class="ident" id="950664">Microsecond</span><span class="op" id="950675">)</span>&nbsp;<span class="comment" id="950677">//&nbsp;let&nbsp;big&nbsp;start&nbsp;running</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950704"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="950711">.</span><span class="ident" id="950712">GC</span><span class="op" id="950714">(</span><span class="op" id="950715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="950718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="950721">close</span><span class="op" id="950726">(</span><span class="ident" id="950727"><a href="/runtime/proc_test.go.html#950578">stop</a></span><span class="op" id="950731">)</span><br>
<span class="lineno"></span><span class="op" id="950733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">315</span><span class="keyword" id="950736">func</span>&nbsp;<span class="ident" id="950741">big</span><span class="op" id="950744">(</span><span class="ident" id="950745">stop</span>&nbsp;<span class="keyword" id="950750">chan</span>&nbsp;<span class="builtintype" id="950755">int</span><span class="op" id="950758">)</span>&nbsp;<span class="builtintype" id="950760">int</span>&nbsp;<span class="op" id="950764">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950767">n</span>&nbsp;<span class="op" id="950769">:=</span>&nbsp;<span class="num" id="950772">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950775">for</span>&nbsp;<span class="op" id="950779">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="950783">//&nbsp;delay&nbsp;so&nbsp;that&nbsp;gc&nbsp;is&nbsp;sure&nbsp;to&nbsp;have&nbsp;asked&nbsp;for&nbsp;a&nbsp;preemption</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="950844">for</span>&nbsp;<span class="ident" id="950848">i</span>&nbsp;<span class="op" id="950850">:=</span>&nbsp;<span class="num" id="950853">0</span><span class="op" id="950854">;</span>&nbsp;<span class="ident" id="950856"><a href="/runtime/proc_test.go.html#950848">i</a></span>&nbsp;<span class="op" id="950858">&lt;</span>&nbsp;<span class="num" id="950860">1e9</span><span class="op" id="950863">;</span>&nbsp;<span class="ident" id="950865"><a href="/runtime/proc_test.go.html#950848">i</a></span><span class="op" id="950866">++</span>&nbsp;<span class="op" id="950869">{</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950874"><a href="/runtime/proc_test.go.html#950767">n</a></span><span class="op" id="950875">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="950880">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="950885">//&nbsp;call&nbsp;bigframe,&nbsp;which&nbsp;used&nbsp;to&nbsp;miss&nbsp;the&nbsp;preemption&nbsp;in&nbsp;its&nbsp;prologue.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="950956"><a href="/runtime/proc_test.go.html#951065">bigframe</a></span><span class="op" id="950964">(</span><span class="ident" id="950965"><a href="/runtime/proc_test.go.html#950745">stop</a></span><span class="op" id="950969">)</span><br>
<span class="lineno">325</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="950974">//&nbsp;check&nbsp;if&nbsp;we&#39;ve&nbsp;been&nbsp;asked&nbsp;to&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951014">select</span>&nbsp;<span class="op" id="951021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951025">case</span>&nbsp;<span class="op" id="951030">&lt;-</span><span class="ident" id="951032"><a href="/runtime/proc_test.go.html#950745">stop</a></span><span class="op" id="951036">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951041">return</span>&nbsp;<span class="ident" id="951048"><a href="/runtime/proc_test.go.html#950767">n</a></span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951052">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951055">}</span><br>
<span class="lineno"></span><span class="op" id="951057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951060">func</span>&nbsp;<span class="ident" id="951065">bigframe</span><span class="op" id="951073">(</span><span class="ident" id="951074">stop</span>&nbsp;<span class="keyword" id="951079">chan</span>&nbsp;<span class="builtintype" id="951084">int</span><span class="op" id="951087">)</span>&nbsp;<span class="builtintype" id="951089">int</span>&nbsp;<span class="op" id="951093">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951096">//&nbsp;not&nbsp;splitting&nbsp;the&nbsp;stack&nbsp;will&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951139">//&nbsp;small&nbsp;will&nbsp;notice&nbsp;that&nbsp;it&nbsp;needs&nbsp;a&nbsp;stack&nbsp;split&nbsp;and&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951198">//&nbsp;catch&nbsp;the&nbsp;overflow.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951222">var</span>&nbsp;<span class="ident" id="951226">x</span>&nbsp;<span class="op" id="951228">[</span><span class="num" id="951229">8192</span><span class="op" id="951233">]</span><span class="builtintype" id="951234">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951240">return</span>&nbsp;<span class="ident" id="951247"><a href="/runtime/proc_test.go.html#951271">small</a></span><span class="op" id="951252">(</span><span class="ident" id="951253"><a href="/runtime/proc_test.go.html#951074">stop</a></span><span class="op" id="951257">,</span>&nbsp;<span class="op" id="951259">&amp;</span><span class="ident" id="951260"><a href="/runtime/proc_test.go.html#951226">x</a></span><span class="op" id="951261">)</span><br>
<span class="lineno">340</span><span class="op" id="951263">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951266">func</span>&nbsp;<span class="ident" id="951271">small</span><span class="op" id="951276">(</span><span class="ident" id="951277">stop</span>&nbsp;<span class="keyword" id="951282">chan</span>&nbsp;<span class="builtintype" id="951287">int</span><span class="op" id="951290">,</span>&nbsp;<span class="ident" id="951292">x</span>&nbsp;<span class="op" id="951294">*</span><span class="op" id="951295">[</span><span class="num" id="951296">8192</span><span class="op" id="951300">]</span><span class="builtintype" id="951301">byte</span><span class="op" id="951305">)</span>&nbsp;<span class="builtintype" id="951307">int</span>&nbsp;<span class="op" id="951311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951314">for</span>&nbsp;<span class="ident" id="951318">i</span>&nbsp;<span class="op" id="951320">:=</span>&nbsp;<span class="keyword" id="951323">range</span>&nbsp;<span class="ident" id="951329"><a href="/runtime/proc_test.go.html#951292">x</a></span>&nbsp;<span class="op" id="951331">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951335"><a href="/runtime/proc_test.go.html#951292">x</a></span><span class="op" id="951336">[</span><span class="ident" id="951337"><a href="/runtime/proc_test.go.html#951318">i</a></span><span class="op" id="951338">]</span>&nbsp;<span class="op" id="951340">=</span>&nbsp;<span class="builtintype" id="951342">byte</span><span class="op" id="951346">(</span><span class="ident" id="951347"><a href="/runtime/proc_test.go.html#951318">i</a></span><span class="op" id="951348">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951351">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951354">sum</span>&nbsp;<span class="op" id="951358">:=</span>&nbsp;<span class="num" id="951361">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951364">for</span>&nbsp;<span class="ident" id="951368">i</span>&nbsp;<span class="op" id="951370">:=</span>&nbsp;<span class="keyword" id="951373">range</span>&nbsp;<span class="ident" id="951379"><a href="/runtime/proc_test.go.html#951292">x</a></span>&nbsp;<span class="op" id="951381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951385"><a href="/runtime/proc_test.go.html#951354">sum</a></span>&nbsp;<span class="op" id="951389">+=</span>&nbsp;<span class="builtintype" id="951392">int</span><span class="op" id="951395">(</span><span class="ident" id="951396"><a href="/runtime/proc_test.go.html#951292">x</a></span><span class="op" id="951397">[</span><span class="ident" id="951398"><a href="/runtime/proc_test.go.html#951368">i</a></span><span class="op" id="951399">]</span><span class="op" id="951400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951403">}</span><br>
<span class="lineno">350</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951407">//&nbsp;keep&nbsp;small&nbsp;from&nbsp;being&nbsp;a&nbsp;leaf&nbsp;function,&nbsp;which&nbsp;might</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951462">//&nbsp;make&nbsp;it&nbsp;not&nbsp;do&nbsp;any&nbsp;stack&nbsp;check&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951505"><a href="/runtime/proc_test.go.html#951540">nonleaf</a></span><span class="op" id="951512">(</span><span class="ident" id="951513"><a href="/runtime/proc_test.go.html#951277">stop</a></span><span class="op" id="951517">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951521">return</span>&nbsp;<span class="ident" id="951528"><a href="/runtime/proc_test.go.html#951354">sum</a></span><br>
<span class="lineno"></span><span class="op" id="951532">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951535">func</span>&nbsp;<span class="ident" id="951540">nonleaf</span><span class="op" id="951547">(</span><span class="ident" id="951548">stop</span>&nbsp;<span class="keyword" id="951553">chan</span>&nbsp;<span class="builtintype" id="951558">int</span><span class="op" id="951561">)</span>&nbsp;<span class="builtintype" id="951563">bool</span>&nbsp;<span class="op" id="951568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="951571">//&nbsp;do&nbsp;something&nbsp;that&nbsp;won&#39;t&nbsp;be&nbsp;inlined:</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951611">select</span>&nbsp;<span class="op" id="951618">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951621">case</span>&nbsp;<span class="op" id="951626">&lt;-</span><span class="ident" id="951628"><a href="/runtime/proc_test.go.html#951548">stop</a></span><span class="op" id="951632">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951636">return</span>&nbsp;<span class="ident" id="951643">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951649">default</span><span class="op" id="951656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951660">return</span>&nbsp;<span class="ident" id="951667">false</span><br>
<span class="lineno">365</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951674">}</span><br>
<span class="lineno"></span><span class="op" id="951676">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951679">func</span>&nbsp;<span class="ident" id="951684">TestSchedLocalQueue</span><span class="op" id="951703">(</span><span class="ident" id="951704">t</span>&nbsp;<span class="op" id="951706">*</span><span class="ident" id="951707"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="951714">.</span><span class="ident" id="951715">T</span><span class="op" id="951716">)</span>&nbsp;<span class="op" id="951718">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951721"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="951728">.</span><span class="ident" id="951729">RunSchedLocalQueueTest</span><span class="op" id="951751">(</span><span class="op" id="951752">)</span><br>
<span class="lineno">370</span><span class="op" id="951754">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951757">func</span>&nbsp;<span class="ident" id="951762">TestSchedLocalQueueSteal</span><span class="op" id="951786">(</span><span class="ident" id="951787">t</span>&nbsp;<span class="op" id="951789">*</span><span class="ident" id="951790"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="951797">.</span><span class="ident" id="951798">T</span><span class="op" id="951799">)</span>&nbsp;<span class="op" id="951801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951804"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="951811">.</span><span class="ident" id="951812">RunSchedLocalQueueStealTest</span><span class="op" id="951839">(</span><span class="op" id="951840">)</span><br>
<span class="lineno"></span><span class="op" id="951842">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="951845">func</span>&nbsp;<span class="ident" id="951850">benchmarkStackGrowth</span><span class="op" id="951870">(</span><span class="ident" id="951871">b</span>&nbsp;<span class="op" id="951873">*</span><span class="ident" id="951874"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="951881">.</span><span class="ident" id="951882">B</span><span class="op" id="951883">,</span>&nbsp;<span class="ident" id="951885">rec</span>&nbsp;<span class="builtintype" id="951889">int</span><span class="op" id="951892">)</span>&nbsp;<span class="op" id="951894">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951897"><a href="/runtime/proc_test.go.html#951871">b</a></span><span class="op" id="951898">.</span><span class="ident" id="951899">RunParallel</span><span class="op" id="951910">(</span><span class="keyword" id="951911">func</span><span class="op" id="951915">(</span><span class="ident" id="951916">pb</span>&nbsp;<span class="op" id="951919">*</span><span class="ident" id="951920"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="951927">.</span><span class="ident" id="951928">PB</span><span class="op" id="951930">)</span>&nbsp;<span class="op" id="951932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="951936">for</span>&nbsp;<span class="ident" id="951940"><a href="/runtime/proc_test.go.html#951916">pb</a></span><span class="op" id="951942">.</span><span class="ident" id="951943">Next</span><span class="op" id="951947">(</span><span class="op" id="951948">)</span>&nbsp;<span class="op" id="951950">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="951955"><a href="/runtime/proc_test.go.html#950311">stackGrowthRecursive</a></span><span class="op" id="951975">(</span><span class="ident" id="951976"><a href="/runtime/proc_test.go.html#951885">rec</a></span><span class="op" id="951979">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951983">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="951986">}</span><span class="op" id="951987">)</span><br>
<span class="lineno"></span><span class="op" id="951989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="951992">func</span>&nbsp;<span class="ident" id="951997">BenchmarkStackGrowth</span><span class="op" id="952017">(</span><span class="ident" id="952018">b</span>&nbsp;<span class="op" id="952020">*</span><span class="ident" id="952021"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952028">.</span><span class="ident" id="952029">B</span><span class="op" id="952030">)</span>&nbsp;<span class="op" id="952032">{</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952035"><a href="/runtime/proc_test.go.html#951850">benchmarkStackGrowth</a></span><span class="op" id="952055">(</span><span class="ident" id="952056"><a href="/runtime/proc_test.go.html#952018">b</a></span><span class="op" id="952057">,</span>&nbsp;<span class="num" id="952059">10</span><span class="op" id="952061">)</span><br>
<span class="lineno"></span><span class="op" id="952063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="952066">func</span>&nbsp;<span class="ident" id="952071">BenchmarkStackGrowthDeep</span><span class="op" id="952095">(</span><span class="ident" id="952096">b</span>&nbsp;<span class="op" id="952098">*</span><span class="ident" id="952099"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952106">.</span><span class="ident" id="952107">B</span><span class="op" id="952108">)</span>&nbsp;<span class="op" id="952110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952113"><a href="/runtime/proc_test.go.html#951850">benchmarkStackGrowth</a></span><span class="op" id="952133">(</span><span class="ident" id="952134"><a href="/runtime/proc_test.go.html#952096">b</a></span><span class="op" id="952135">,</span>&nbsp;<span class="num" id="952137">1024</span><span class="op" id="952141">)</span><br>
<span class="lineno">390</span><span class="op" id="952143">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="952146">func</span>&nbsp;<span class="ident" id="952151">BenchmarkCreateGoroutines</span><span class="op" id="952176">(</span><span class="ident" id="952177">b</span>&nbsp;<span class="op" id="952179">*</span><span class="ident" id="952180"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952187">.</span><span class="ident" id="952188">B</span><span class="op" id="952189">)</span>&nbsp;<span class="op" id="952191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952194"><a href="/runtime/proc_test.go.html#952346">benchmarkCreateGoroutines</a></span><span class="op" id="952219">(</span><span class="ident" id="952220"><a href="/runtime/proc_test.go.html#952177">b</a></span><span class="op" id="952221">,</span>&nbsp;<span class="num" id="952223">1</span><span class="op" id="952224">)</span><br>
<span class="lineno"></span><span class="op" id="952226">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span><span class="keyword" id="952229">func</span>&nbsp;<span class="ident" id="952234">BenchmarkCreateGoroutinesParallel</span><span class="op" id="952267">(</span><span class="ident" id="952268">b</span>&nbsp;<span class="op" id="952270">*</span><span class="ident" id="952271"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952278">.</span><span class="ident" id="952279">B</span><span class="op" id="952280">)</span>&nbsp;<span class="op" id="952282">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952285"><a href="/runtime/proc_test.go.html#952346">benchmarkCreateGoroutines</a></span><span class="op" id="952310">(</span><span class="ident" id="952311"><a href="/runtime/proc_test.go.html#952268">b</a></span><span class="op" id="952312">,</span>&nbsp;<span class="ident" id="952314"><a href="/runtime/proc_test.go.html#945473">runtime</a></span><span class="op" id="952321">.</span><span class="ident" id="952322">GOMAXPROCS</span><span class="op" id="952332">(</span><span class="op" id="952333">-</span><span class="num" id="952334">1</span><span class="op" id="952335">)</span><span class="op" id="952336">)</span><br>
<span class="lineno"></span><span class="op" id="952338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">400</span><span class="keyword" id="952341">func</span>&nbsp;<span class="ident" id="952346">benchmarkCreateGoroutines</span><span class="op" id="952371">(</span><span class="ident" id="952372">b</span>&nbsp;<span class="op" id="952374">*</span><span class="ident" id="952375"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952382">.</span><span class="ident" id="952383">B</span><span class="op" id="952384">,</span>&nbsp;<span class="ident" id="952386">procs</span>&nbsp;<span class="builtintype" id="952392">int</span><span class="op" id="952395">)</span>&nbsp;<span class="op" id="952397">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952400">c</span>&nbsp;<span class="op" id="952402">:=</span>&nbsp;<span class="builtinfunc" id="952405">make</span><span class="op" id="952409">(</span><span class="keyword" id="952410">chan</span>&nbsp;<span class="builtintype" id="952415">bool</span><span class="op" id="952419">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952422">var</span>&nbsp;<span class="ident" id="952426">f</span>&nbsp;<span class="keyword" id="952428">func</span><span class="op" id="952432">(</span><span class="ident" id="952433">n</span>&nbsp;<span class="builtintype" id="952435">int</span><span class="op" id="952438">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952441"><a href="/runtime/proc_test.go.html#952426">f</a></span>&nbsp;<span class="op" id="952443">=</span>&nbsp;<span class="keyword" id="952445">func</span><span class="op" id="952449">(</span><span class="ident" id="952450">n</span>&nbsp;<span class="builtintype" id="952452">int</span><span class="op" id="952455">)</span>&nbsp;<span class="op" id="952457">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952461">if</span>&nbsp;<span class="ident" id="952464"><a href="/runtime/proc_test.go.html#952450">n</a></span>&nbsp;<span class="op" id="952466">==</span>&nbsp;<span class="num" id="952469">0</span>&nbsp;<span class="op" id="952471">{</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952476"><a href="/runtime/proc_test.go.html#952400">c</a></span>&nbsp;<span class="op" id="952478">&lt;-</span>&nbsp;<span class="ident" id="952481">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952489">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="952498">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952502">go</span>&nbsp;<span class="ident" id="952505"><a href="/runtime/proc_test.go.html#952426">f</a></span><span class="op" id="952506">(</span><span class="ident" id="952507"><a href="/runtime/proc_test.go.html#952450">n</a></span>&nbsp;<span class="op" id="952509">-</span>&nbsp;<span class="num" id="952511">1</span><span class="op" id="952512">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="952515">}</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952518">for</span>&nbsp;<span class="ident" id="952522">i</span>&nbsp;<span class="op" id="952524">:=</span>&nbsp;<span class="num" id="952527">0</span><span class="op" id="952528">;</span>&nbsp;<span class="ident" id="952530"><a href="/runtime/proc_test.go.html#952522">i</a></span>&nbsp;<span class="op" id="952532">&lt;</span>&nbsp;<span class="ident" id="952534"><a href="/runtime/proc_test.go.html#952386">procs</a></span><span class="op" id="952539">;</span>&nbsp;<span class="ident" id="952541"><a href="/runtime/proc_test.go.html#952522">i</a></span><span class="op" id="952542">++</span>&nbsp;<span class="op" id="952545">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952549">go</span>&nbsp;<span class="ident" id="952552"><a href="/runtime/proc_test.go.html#952426">f</a></span><span class="op" id="952553">(</span><span class="ident" id="952554"><a href="/runtime/proc_test.go.html#952372">b</a></span><span class="op" id="952555">.</span><span class="ident" id="952556">N</span>&nbsp;<span class="op" id="952558">/</span>&nbsp;<span class="ident" id="952560"><a href="/runtime/proc_test.go.html#952386">procs</a></span><span class="op" id="952565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="952568">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952571">for</span>&nbsp;<span class="ident" id="952575">i</span>&nbsp;<span class="op" id="952577">:=</span>&nbsp;<span class="num" id="952580">0</span><span class="op" id="952581">;</span>&nbsp;<span class="ident" id="952583"><a href="/runtime/proc_test.go.html#952575">i</a></span>&nbsp;<span class="op" id="952585">&lt;</span>&nbsp;<span class="ident" id="952587"><a href="/runtime/proc_test.go.html#952386">procs</a></span><span class="op" id="952592">;</span>&nbsp;<span class="ident" id="952594"><a href="/runtime/proc_test.go.html#952575">i</a></span><span class="op" id="952595">++</span>&nbsp;<span class="op" id="952598">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="952602">&lt;-</span><span class="ident" id="952604"><a href="/runtime/proc_test.go.html#952400">c</a></span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="952607">}</span><br>
<span class="lineno"></span><span class="op" id="952609">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="952612">type</span>&nbsp;<span class="ident" id="952617">Matrix</span>&nbsp;<span class="op" id="952624">[</span><span class="op" id="952625">]</span><span class="op" id="952626">[</span><span class="op" id="952627">]</span><span class="builtintype" id="952628">float64</span><br>
<span class="lineno"></span><br>
<span class="lineno">420</span><span class="keyword" id="952637">func</span>&nbsp;<span class="ident" id="952642">BenchmarkMatmult</span><span class="op" id="952658">(</span><span class="ident" id="952659">b</span>&nbsp;<span class="op" id="952661">*</span><span class="ident" id="952662"><a href="/runtime/proc_test.go.html#945510">testing</a></span><span class="op" id="952669">.</span><span class="ident" id="952670">B</span><span class="op" id="952671">)</span>&nbsp;<span class="op" id="952673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952676"><a href="/runtime/proc_test.go.html#952659">b</a></span><span class="op" id="952677">.</span><span class="ident" id="952678">StopTimer</span><span class="op" id="952687">(</span><span class="op" id="952688">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="952691">//&nbsp;matmult&nbsp;is&nbsp;O(N**3)&nbsp;but&nbsp;testing&nbsp;expects&nbsp;O(b.N),</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="952742">//&nbsp;so&nbsp;we&nbsp;need&nbsp;to&nbsp;take&nbsp;cube&nbsp;root&nbsp;of&nbsp;b.N</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952782">n</span>&nbsp;<span class="op" id="952784">:=</span>&nbsp;<span class="builtintype" id="952787">int</span><span class="op" id="952790">(</span><span class="ident" id="952791"><a href="/runtime/proc_test.go.html#945465">math</a></span><span class="op" id="952795">.</span><span class="ident" id="952796">Cbrt</span><span class="op" id="952800">(</span><span class="builtintype" id="952801">float64</span><span class="op" id="952808">(</span><span class="ident" id="952809"><a href="/runtime/proc_test.go.html#952659">b</a></span><span class="op" id="952810">.</span><span class="ident" id="952811">N</span><span class="op" id="952812">)</span><span class="op" id="952813">)</span><span class="op" id="952814">)</span>&nbsp;<span class="op" id="952816">+</span>&nbsp;<span class="num" id="952818">1</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952821">A</span>&nbsp;<span class="op" id="952823">:=</span>&nbsp;<span class="ident" id="952826"><a href="/runtime/proc_test.go.html#952948">makeMatrix</a></span><span class="op" id="952836">(</span><span class="ident" id="952837"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952838">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952841">B</span>&nbsp;<span class="op" id="952843">:=</span>&nbsp;<span class="ident" id="952846"><a href="/runtime/proc_test.go.html#952948">makeMatrix</a></span><span class="op" id="952856">(</span><span class="ident" id="952857"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952861">C</span>&nbsp;<span class="op" id="952863">:=</span>&nbsp;<span class="ident" id="952866"><a href="/runtime/proc_test.go.html#952948">makeMatrix</a></span><span class="op" id="952876">(</span><span class="ident" id="952877"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952878">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952881"><a href="/runtime/proc_test.go.html#952659">b</a></span><span class="op" id="952882">.</span><span class="ident" id="952883">StartTimer</span><span class="op" id="952893">(</span><span class="op" id="952894">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952897"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="952904">(</span><span class="ident" id="952905">nil</span><span class="op" id="952908">,</span>&nbsp;<span class="ident" id="952910"><a href="/runtime/proc_test.go.html#952821">A</a></span><span class="op" id="952911">,</span>&nbsp;<span class="ident" id="952913"><a href="/runtime/proc_test.go.html#952841">B</a></span><span class="op" id="952914">,</span>&nbsp;<span class="ident" id="952916"><a href="/runtime/proc_test.go.html#952861">C</a></span><span class="op" id="952917">,</span>&nbsp;<span class="num" id="952919">0</span><span class="op" id="952920">,</span>&nbsp;<span class="ident" id="952922"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952923">,</span>&nbsp;<span class="num" id="952925">0</span><span class="op" id="952926">,</span>&nbsp;<span class="ident" id="952928"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952929">,</span>&nbsp;<span class="num" id="952931">0</span><span class="op" id="952932">,</span>&nbsp;<span class="ident" id="952934"><a href="/runtime/proc_test.go.html#952782">n</a></span><span class="op" id="952935">,</span>&nbsp;<span class="num" id="952937">8</span><span class="op" id="952938">)</span><br>
<span class="lineno">430</span><span class="op" id="952940">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="952943">func</span>&nbsp;<span class="ident" id="952948">makeMatrix</span><span class="op" id="952958">(</span><span class="ident" id="952959">n</span>&nbsp;<span class="builtintype" id="952961">int</span><span class="op" id="952964">)</span>&nbsp;<span class="ident" id="952966"><a href="/runtime/proc_test.go.html#952617">Matrix</a></span>&nbsp;<span class="op" id="952973">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="952976">m</span>&nbsp;<span class="op" id="952978">:=</span>&nbsp;<span class="builtinfunc" id="952981">make</span><span class="op" id="952985">(</span><span class="ident" id="952986"><a href="/runtime/proc_test.go.html#952617">Matrix</a></span><span class="op" id="952992">,</span>&nbsp;<span class="ident" id="952994"><a href="/runtime/proc_test.go.html#952959">n</a></span><span class="op" id="952995">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="952998">for</span>&nbsp;<span class="ident" id="953002">i</span>&nbsp;<span class="op" id="953004">:=</span>&nbsp;<span class="num" id="953007">0</span><span class="op" id="953008">;</span>&nbsp;<span class="ident" id="953010"><a href="/runtime/proc_test.go.html#953002">i</a></span>&nbsp;<span class="op" id="953012">&lt;</span>&nbsp;<span class="ident" id="953014"><a href="/runtime/proc_test.go.html#952959">n</a></span><span class="op" id="953015">;</span>&nbsp;<span class="ident" id="953017"><a href="/runtime/proc_test.go.html#953002">i</a></span><span class="op" id="953018">++</span>&nbsp;<span class="op" id="953021">{</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953025"><a href="/runtime/proc_test.go.html#952976">m</a></span><span class="op" id="953026">[</span><span class="ident" id="953027"><a href="/runtime/proc_test.go.html#953002">i</a></span><span class="op" id="953028">]</span>&nbsp;<span class="op" id="953030">=</span>&nbsp;<span class="builtinfunc" id="953032">make</span><span class="op" id="953036">(</span><span class="op" id="953037">[</span><span class="op" id="953038">]</span><span class="builtintype" id="953039">float64</span><span class="op" id="953046">,</span>&nbsp;<span class="ident" id="953048"><a href="/runtime/proc_test.go.html#952959">n</a></span><span class="op" id="953049">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="953053">for</span>&nbsp;<span class="ident" id="953057">j</span>&nbsp;<span class="op" id="953059">:=</span>&nbsp;<span class="num" id="953062">0</span><span class="op" id="953063">;</span>&nbsp;<span class="ident" id="953065"><a href="/runtime/proc_test.go.html#953057">j</a></span>&nbsp;<span class="op" id="953067">&lt;</span>&nbsp;<span class="ident" id="953069"><a href="/runtime/proc_test.go.html#952959">n</a></span><span class="op" id="953070">;</span>&nbsp;<span class="ident" id="953072"><a href="/runtime/proc_test.go.html#953057">j</a></span><span class="op" id="953073">++</span>&nbsp;<span class="op" id="953076">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953081"><a href="/runtime/proc_test.go.html#952976">m</a></span><span class="op" id="953082">[</span><span class="ident" id="953083"><a href="/runtime/proc_test.go.html#953002">i</a></span><span class="op" id="953084">]</span><span class="op" id="953085">[</span><span class="ident" id="953086"><a href="/runtime/proc_test.go.html#953057">j</a></span><span class="op" id="953087">]</span>&nbsp;<span class="op" id="953089">=</span>&nbsp;<span class="builtintype" id="953091">float64</span><span class="op" id="953098">(</span><span class="ident" id="953099"><a href="/runtime/proc_test.go.html#953002">i</a></span><span class="op" id="953100">*</span><span class="ident" id="953101"><a href="/runtime/proc_test.go.html#952959">n</a></span>&nbsp;<span class="op" id="953103">+</span>&nbsp;<span class="ident" id="953105"><a href="/runtime/proc_test.go.html#953057">j</a></span><span class="op" id="953106">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953110">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953113">}</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="953116">return</span>&nbsp;<span class="ident" id="953123"><a href="/runtime/proc_test.go.html#952976">m</a></span><br>
<span class="lineno"></span><span class="op" id="953125">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="953128">func</span>&nbsp;<span class="ident" id="953133">matmult</span><span class="op" id="953140">(</span><span class="ident" id="953141">done</span>&nbsp;<span class="keyword" id="953146">chan</span><span class="op" id="953150">&lt;-</span>&nbsp;<span class="keyword" id="953153">struct</span><span class="op" id="953159">{</span><span class="op" id="953160">}</span><span class="op" id="953161">,</span>&nbsp;<span class="ident" id="953163">A</span><span class="op" id="953164">,</span>&nbsp;<span class="ident" id="953166">B</span><span class="op" id="953167">,</span>&nbsp;<span class="ident" id="953169">C</span>&nbsp;<span class="ident" id="953171"><a href="/runtime/proc_test.go.html#952617">Matrix</a></span><span class="op" id="953177">,</span>&nbsp;<span class="ident" id="953179">i0</span><span class="op" id="953181">,</span>&nbsp;<span class="ident" id="953183">i1</span><span class="op" id="953185">,</span>&nbsp;<span class="ident" id="953187">j0</span><span class="op" id="953189">,</span>&nbsp;<span class="ident" id="953191">j1</span><span class="op" id="953193">,</span>&nbsp;<span class="ident" id="953195">k0</span><span class="op" id="953197">,</span>&nbsp;<span class="ident" id="953199">k1</span><span class="op" id="953201">,</span>&nbsp;<span class="ident" id="953203">threshold</span>&nbsp;<span class="builtintype" id="953213">int</span><span class="op" id="953216">)</span>&nbsp;<span class="op" id="953218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953221">di</span>&nbsp;<span class="op" id="953224">:=</span>&nbsp;<span class="ident" id="953227"><a href="/runtime/proc_test.go.html#953183">i1</a></span>&nbsp;<span class="op" id="953230">-</span>&nbsp;<span class="ident" id="953232"><a href="/runtime/proc_test.go.html#953179">i0</a></span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953236">dj</span>&nbsp;<span class="op" id="953239">:=</span>&nbsp;<span class="ident" id="953242"><a href="/runtime/proc_test.go.html#953191">j1</a></span>&nbsp;<span class="op" id="953245">-</span>&nbsp;<span class="ident" id="953247"><a href="/runtime/proc_test.go.html#953187">j0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953251">dk</span>&nbsp;<span class="op" id="953254">:=</span>&nbsp;<span class="ident" id="953257"><a href="/runtime/proc_test.go.html#953199">k1</a></span>&nbsp;<span class="op" id="953260">-</span>&nbsp;<span class="ident" id="953262"><a href="/runtime/proc_test.go.html#953195">k0</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="953266">if</span>&nbsp;<span class="ident" id="953269"><a href="/runtime/proc_test.go.html#953221">di</a></span>&nbsp;<span class="op" id="953272">&gt;=</span>&nbsp;<span class="ident" id="953275"><a href="/runtime/proc_test.go.html#953236">dj</a></span>&nbsp;<span class="op" id="953278">&amp;&amp;</span>&nbsp;<span class="ident" id="953281"><a href="/runtime/proc_test.go.html#953221">di</a></span>&nbsp;<span class="op" id="953284">&gt;=</span>&nbsp;<span class="ident" id="953287"><a href="/runtime/proc_test.go.html#953251">dk</a></span>&nbsp;<span class="op" id="953290">&amp;&amp;</span>&nbsp;<span class="ident" id="953293"><a href="/runtime/proc_test.go.html#953221">di</a></span>&nbsp;<span class="op" id="953296">&gt;=</span>&nbsp;<span class="ident" id="953299"><a href="/runtime/proc_test.go.html#953203">threshold</a></span>&nbsp;<span class="op" id="953309">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="953313">//&nbsp;divide&nbsp;in&nbsp;two&nbsp;by&nbsp;y&nbsp;axis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953342">mi</span>&nbsp;<span class="op" id="953345">:=</span>&nbsp;<span class="ident" id="953348"><a href="/runtime/proc_test.go.html#953179">i0</a></span>&nbsp;<span class="op" id="953351">+</span>&nbsp;<span class="ident" id="953353"><a href="/runtime/proc_test.go.html#953221">di</a></span><span class="op" id="953355">/</span><span class="num" id="953356">2</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953360">done1</span>&nbsp;<span class="op" id="953366">:=</span>&nbsp;<span class="builtinfunc" id="953369">make</span><span class="op" id="953373">(</span><span class="keyword" id="953374">chan</span>&nbsp;<span class="keyword" id="953379">struct</span><span class="op" id="953385">{</span><span class="op" id="953386">}</span><span class="op" id="953387">,</span>&nbsp;<span class="num" id="953389">1</span><span class="op" id="953390">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="953394">go</span>&nbsp;<span class="ident" id="953397"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953404">(</span><span class="ident" id="953405"><a href="/runtime/proc_test.go.html#953360">done1</a></span><span class="op" id="953410">,</span>&nbsp;<span class="ident" id="953412"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953413">,</span>&nbsp;<span class="ident" id="953415"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953416">,</span>&nbsp;<span class="ident" id="953418"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953419">,</span>&nbsp;<span class="ident" id="953421"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="953423">,</span>&nbsp;<span class="ident" id="953425"><a href="/runtime/proc_test.go.html#953342">mi</a></span><span class="op" id="953427">,</span>&nbsp;<span class="ident" id="953429"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="953431">,</span>&nbsp;<span class="ident" id="953433"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="953435">,</span>&nbsp;<span class="ident" id="953437"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="953439">,</span>&nbsp;<span class="ident" id="953441"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="953443">,</span>&nbsp;<span class="ident" id="953445"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="953454">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953458"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953465">(</span><span class="ident" id="953466">nil</span><span class="op" id="953469">,</span>&nbsp;<span class="ident" id="953471"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953472">,</span>&nbsp;<span class="ident" id="953474"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953475">,</span>&nbsp;<span class="ident" id="953477"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953478">,</span>&nbsp;<span class="ident" id="953480"><a href="/runtime/proc_test.go.html#953342">mi</a></span><span class="op" id="953482">,</span>&nbsp;<span class="ident" id="953484"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="953486">,</span>&nbsp;<span class="ident" id="953488"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="953490">,</span>&nbsp;<span class="ident" id="953492"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="953494">,</span>&nbsp;<span class="ident" id="953496"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="953498">,</span>&nbsp;<span class="ident" id="953500"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="953502">,</span>&nbsp;<span class="ident" id="953504"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="953513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953517">&lt;-</span><span class="ident" id="953519"><a href="/runtime/proc_test.go.html#953360">done1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953526">}</span>&nbsp;<span class="keyword" id="953528">else</span>&nbsp;<span class="keyword" id="953533">if</span>&nbsp;<span class="ident" id="953536"><a href="/runtime/proc_test.go.html#953236">dj</a></span>&nbsp;<span class="op" id="953539">&gt;=</span>&nbsp;<span class="ident" id="953542"><a href="/runtime/proc_test.go.html#953251">dk</a></span>&nbsp;<span class="op" id="953545">&amp;&amp;</span>&nbsp;<span class="ident" id="953548"><a href="/runtime/proc_test.go.html#953236">dj</a></span>&nbsp;<span class="op" id="953551">&gt;=</span>&nbsp;<span class="ident" id="953554"><a href="/runtime/proc_test.go.html#953203">threshold</a></span>&nbsp;<span class="op" id="953564">{</span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="953568">//&nbsp;divide&nbsp;in&nbsp;two&nbsp;by&nbsp;x&nbsp;axis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953597">mj</span>&nbsp;<span class="op" id="953600">:=</span>&nbsp;<span class="ident" id="953603"><a href="/runtime/proc_test.go.html#953187">j0</a></span>&nbsp;<span class="op" id="953606">+</span>&nbsp;<span class="ident" id="953608"><a href="/runtime/proc_test.go.html#953236">dj</a></span><span class="op" id="953610">/</span><span class="num" id="953611">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953615">done1</span>&nbsp;<span class="op" id="953621">:=</span>&nbsp;<span class="builtinfunc" id="953624">make</span><span class="op" id="953628">(</span><span class="keyword" id="953629">chan</span>&nbsp;<span class="keyword" id="953634">struct</span><span class="op" id="953640">{</span><span class="op" id="953641">}</span><span class="op" id="953642">,</span>&nbsp;<span class="num" id="953644">1</span><span class="op" id="953645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="953649">go</span>&nbsp;<span class="ident" id="953652"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953659">(</span><span class="ident" id="953660"><a href="/runtime/proc_test.go.html#953615">done1</a></span><span class="op" id="953665">,</span>&nbsp;<span class="ident" id="953667"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953668">,</span>&nbsp;<span class="ident" id="953670"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953671">,</span>&nbsp;<span class="ident" id="953673"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953674">,</span>&nbsp;<span class="ident" id="953676"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="953678">,</span>&nbsp;<span class="ident" id="953680"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="953682">,</span>&nbsp;<span class="ident" id="953684"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="953686">,</span>&nbsp;<span class="ident" id="953688"><a href="/runtime/proc_test.go.html#953597">mj</a></span><span class="op" id="953690">,</span>&nbsp;<span class="ident" id="953692"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="953694">,</span>&nbsp;<span class="ident" id="953696"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="953698">,</span>&nbsp;<span class="ident" id="953700"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="953709">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953713"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953720">(</span><span class="ident" id="953721">nil</span><span class="op" id="953724">,</span>&nbsp;<span class="ident" id="953726"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953727">,</span>&nbsp;<span class="ident" id="953729"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953730">,</span>&nbsp;<span class="ident" id="953732"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953733">,</span>&nbsp;<span class="ident" id="953735"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="953737">,</span>&nbsp;<span class="ident" id="953739"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="953741">,</span>&nbsp;<span class="ident" id="953743"><a href="/runtime/proc_test.go.html#953597">mj</a></span><span class="op" id="953745">,</span>&nbsp;<span class="ident" id="953747"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="953749">,</span>&nbsp;<span class="ident" id="953751"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="953753">,</span>&nbsp;<span class="ident" id="953755"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="953757">,</span>&nbsp;<span class="ident" id="953759"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="953768">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953772">&lt;-</span><span class="ident" id="953774"><a href="/runtime/proc_test.go.html#953615">done1</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="953781">}</span>&nbsp;<span class="keyword" id="953783">else</span>&nbsp;<span class="keyword" id="953788">if</span>&nbsp;<span class="ident" id="953791"><a href="/runtime/proc_test.go.html#953251">dk</a></span>&nbsp;<span class="op" id="953794">&gt;=</span>&nbsp;<span class="ident" id="953797"><a href="/runtime/proc_test.go.html#953203">threshold</a></span>&nbsp;<span class="op" id="953807">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="953811">//&nbsp;divide&nbsp;in&nbsp;two&nbsp;by&nbsp;&#34;k&#34;&nbsp;axis</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="953842">//&nbsp;deliberately&nbsp;not&nbsp;parallel&nbsp;because&nbsp;of&nbsp;data&nbsp;races</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953895">mk</span>&nbsp;<span class="op" id="953898">:=</span>&nbsp;<span class="ident" id="953901"><a href="/runtime/proc_test.go.html#953195">k0</a></span>&nbsp;<span class="op" id="953904">+</span>&nbsp;<span class="ident" id="953906"><a href="/runtime/proc_test.go.html#953251">dk</a></span><span class="op" id="953908">/</span><span class="num" id="953909">2</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953913"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953920">(</span><span class="ident" id="953921">nil</span><span class="op" id="953924">,</span>&nbsp;<span class="ident" id="953926"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953927">,</span>&nbsp;<span class="ident" id="953929"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953930">,</span>&nbsp;<span class="ident" id="953932"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953933">,</span>&nbsp;<span class="ident" id="953935"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="953937">,</span>&nbsp;<span class="ident" id="953939"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="953941">,</span>&nbsp;<span class="ident" id="953943"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="953945">,</span>&nbsp;<span class="ident" id="953947"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="953949">,</span>&nbsp;<span class="ident" id="953951"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="953953">,</span>&nbsp;<span class="ident" id="953955"><a href="/runtime/proc_test.go.html#953895">mk</a></span><span class="op" id="953957">,</span>&nbsp;<span class="ident" id="953959"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="953968">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="953972"><a href="/runtime/proc_test.go.html#953133">matmult</a></span><span class="op" id="953979">(</span><span class="ident" id="953980">nil</span><span class="op" id="953983">,</span>&nbsp;<span class="ident" id="953985"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="953986">,</span>&nbsp;<span class="ident" id="953988"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="953989">,</span>&nbsp;<span class="ident" id="953991"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="953992">,</span>&nbsp;<span class="ident" id="953994"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="953996">,</span>&nbsp;<span class="ident" id="953998"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="954000">,</span>&nbsp;<span class="ident" id="954002"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="954004">,</span>&nbsp;<span class="ident" id="954006"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="954008">,</span>&nbsp;<span class="ident" id="954010"><a href="/runtime/proc_test.go.html#953895">mk</a></span><span class="op" id="954012">,</span>&nbsp;<span class="ident" id="954014"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="954016">,</span>&nbsp;<span class="ident" id="954018"><a href="/runtime/proc_test.go.html#953203">threshold</a></span><span class="op" id="954027">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954030">}</span>&nbsp;<span class="keyword" id="954032">else</span>&nbsp;<span class="op" id="954037">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="954041">//&nbsp;the&nbsp;matrices&nbsp;are&nbsp;small&nbsp;enough,&nbsp;compute&nbsp;directly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="954094">for</span>&nbsp;<span class="ident" id="954098">i</span>&nbsp;<span class="op" id="954100">:=</span>&nbsp;<span class="ident" id="954103"><a href="/runtime/proc_test.go.html#953179">i0</a></span><span class="op" id="954105">;</span>&nbsp;<span class="ident" id="954107"><a href="/runtime/proc_test.go.html#954098">i</a></span>&nbsp;<span class="op" id="954109">&lt;</span>&nbsp;<span class="ident" id="954111"><a href="/runtime/proc_test.go.html#953183">i1</a></span><span class="op" id="954113">;</span>&nbsp;<span class="ident" id="954115"><a href="/runtime/proc_test.go.html#954098">i</a></span><span class="op" id="954116">++</span>&nbsp;<span class="op" id="954119">{</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="954124">for</span>&nbsp;<span class="ident" id="954128">j</span>&nbsp;<span class="op" id="954130">:=</span>&nbsp;<span class="ident" id="954133"><a href="/runtime/proc_test.go.html#953187">j0</a></span><span class="op" id="954135">;</span>&nbsp;<span class="ident" id="954137"><a href="/runtime/proc_test.go.html#954128">j</a></span>&nbsp;<span class="op" id="954139">&lt;</span>&nbsp;<span class="ident" id="954141"><a href="/runtime/proc_test.go.html#953191">j1</a></span><span class="op" id="954143">;</span>&nbsp;<span class="ident" id="954145"><a href="/runtime/proc_test.go.html#954128">j</a></span><span class="op" id="954146">++</span>&nbsp;<span class="op" id="954149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="954155">for</span>&nbsp;<span class="ident" id="954159">k</span>&nbsp;<span class="op" id="954161">:=</span>&nbsp;<span class="ident" id="954164"><a href="/runtime/proc_test.go.html#953195">k0</a></span><span class="op" id="954166">;</span>&nbsp;<span class="ident" id="954168"><a href="/runtime/proc_test.go.html#954159">k</a></span>&nbsp;<span class="op" id="954170">&lt;</span>&nbsp;<span class="ident" id="954172"><a href="/runtime/proc_test.go.html#953199">k1</a></span><span class="op" id="954174">;</span>&nbsp;<span class="ident" id="954176"><a href="/runtime/proc_test.go.html#954159">k</a></span><span class="op" id="954177">++</span>&nbsp;<span class="op" id="954180">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="954187"><a href="/runtime/proc_test.go.html#953169">C</a></span><span class="op" id="954188">[</span><span class="ident" id="954189"><a href="/runtime/proc_test.go.html#954098">i</a></span><span class="op" id="954190">]</span><span class="op" id="954191">[</span><span class="ident" id="954192"><a href="/runtime/proc_test.go.html#954128">j</a></span><span class="op" id="954193">]</span>&nbsp;<span class="op" id="954195">+=</span>&nbsp;<span class="ident" id="954198"><a href="/runtime/proc_test.go.html#953163">A</a></span><span class="op" id="954199">[</span><span class="ident" id="954200"><a href="/runtime/proc_test.go.html#954098">i</a></span><span class="op" id="954201">]</span><span class="op" id="954202">[</span><span class="ident" id="954203"><a href="/runtime/proc_test.go.html#954159">k</a></span><span class="op" id="954204">]</span>&nbsp;<span class="op" id="954206">*</span>&nbsp;<span class="ident" id="954208"><a href="/runtime/proc_test.go.html#953166">B</a></span><span class="op" id="954209">[</span><span class="ident" id="954210"><a href="/runtime/proc_test.go.html#954159">k</a></span><span class="op" id="954211">]</span><span class="op" id="954212">[</span><span class="ident" id="954213"><a href="/runtime/proc_test.go.html#954128">j</a></span><span class="op" id="954214">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954220">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954225">}</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954232">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="954235">if</span>&nbsp;<span class="ident" id="954238"><a href="/runtime/proc_test.go.html#953141">done</a></span>&nbsp;<span class="op" id="954243">!=</span>&nbsp;<span class="ident" id="954246">nil</span>&nbsp;<span class="op" id="954250">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="954254"><a href="/runtime/proc_test.go.html#953141">done</a></span>&nbsp;<span class="op" id="954259">&lt;-</span>&nbsp;<span class="keyword" id="954262">struct</span><span class="op" id="954268">{</span><span class="op" id="954269">}</span><span class="op" id="954270">{</span><span class="op" id="954271">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="954274">}</span><br>
<span class="lineno">480</span><span class="op" id="954276">}</span>
</div>
</body>
</html>
