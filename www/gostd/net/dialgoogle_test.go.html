<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html" class="current">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7495485">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7495540">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7495594">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7495645">package</span>&nbsp;<span class="ident" id="7495653">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7495658">import</span>&nbsp;<span class="op" id="7495665">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495668">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495676">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495683">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495689">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495700">&#34;syscall&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7495711">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7495721">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7495724">//&nbsp;If&nbsp;an&nbsp;IPv6&nbsp;tunnel&nbsp;is&nbsp;running,&nbsp;we&nbsp;can&nbsp;try&nbsp;dialing&nbsp;a&nbsp;real&nbsp;IPv6&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="7495797">var</span>&nbsp;<span class="ident" id="7495801">testIPv6</span>&nbsp;<span class="op" id="7495810">=</span>&nbsp;<span class="ident" id="7495812">flag</span><span class="op" id="7495816">.</span><span class="ident" id="7495817">Bool</span><span class="op" id="7495821">(</span><span class="string" id="7495822">&#34;ipv6&#34;</span><span class="op" id="7495828">,</span>&nbsp;<span class="builtintype" id="7495830">false</span><span class="op" id="7495835">,</span>&nbsp;<span class="string" id="7495837">&#34;assume&nbsp;ipv6&nbsp;tunnel&nbsp;is&nbsp;present&#34;</span><span class="op" id="7495868">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7495871">func</span>&nbsp;<span class="ident" id="7495876">TestResolveGoogle</span><span class="op" id="7495893">(</span><span class="ident" id="7495894">t</span>&nbsp;<span class="op" id="7495896">*</span><span class="ident" id="7495897">testing</span><span class="op" id="7495904">.</span><span class="ident" id="7495905">T</span><span class="op" id="7495906">)</span>&nbsp;<span class="op" id="7495908">{</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7495911">if</span>&nbsp;<span class="ident" id="7495914">testing</span><span class="op" id="7495921">.</span><span class="ident" id="7495922">Short</span><span class="op" id="7495927">(</span><span class="op" id="7495928">)</span>&nbsp;<span class="op" id="7495930">||</span>&nbsp;<span class="op" id="7495933">!</span><span class="op" id="7495934">*</span><span class="ident" id="7495935">testExternal</span>&nbsp;<span class="op" id="7495948">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7495952">t</span><span class="op" id="7495953">.</span><span class="ident" id="7495954">Skip</span><span class="op" id="7495958">(</span><span class="string" id="7495959">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7496000">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496003">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496007">for</span>&nbsp;<span class="ident" id="7496011">_</span><span class="op" id="7496012">,</span>&nbsp;<span class="ident" id="7496014">network</span>&nbsp;<span class="op" id="7496022">:=</span>&nbsp;<span class="keyword" id="7496025">range</span>&nbsp;<span class="op" id="7496031">[</span><span class="op" id="7496032">]</span><span class="builtintype" id="7496033">string</span><span class="op" id="7496039">{</span><span class="string" id="7496040">&#34;tcp&#34;</span><span class="op" id="7496045">,</span>&nbsp;<span class="string" id="7496047">&#34;tcp4&#34;</span><span class="op" id="7496053">,</span>&nbsp;<span class="string" id="7496055">&#34;tcp6&#34;</span><span class="op" id="7496061">}</span>&nbsp;<span class="op" id="7496063">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496067">addr</span><span class="op" id="7496071">,</span>&nbsp;<span class="ident" id="7496073">err</span>&nbsp;<span class="op" id="7496077">:=</span>&nbsp;<span class="ident" id="7496080">ResolveTCPAddr</span><span class="op" id="7496094">(</span><span class="ident" id="7496095">network</span><span class="op" id="7496102">,</span>&nbsp;<span class="string" id="7496104">&#34;www.google.com:http&#34;</span><span class="op" id="7496125">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496129">if</span>&nbsp;<span class="ident" id="7496132">err</span>&nbsp;<span class="op" id="7496136">!=</span>&nbsp;<span class="ident" id="7496139">nil</span>&nbsp;<span class="op" id="7496143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496148">if</span>&nbsp;<span class="op" id="7496151">(</span><span class="ident" id="7496152">network</span>&nbsp;<span class="op" id="7496160">==</span>&nbsp;<span class="string" id="7496163">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7496169">||</span>&nbsp;<span class="ident" id="7496172">network</span>&nbsp;<span class="op" id="7496180">==</span>&nbsp;<span class="string" id="7496183">&#34;tcp4&#34;</span><span class="op" id="7496189">)</span>&nbsp;<span class="op" id="7496191">&amp;&amp;</span>&nbsp;<span class="op" id="7496194">!</span><span class="ident" id="7496195">supportsIPv4</span>&nbsp;<span class="op" id="7496208">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496214">t</span><span class="op" id="7496215">.</span><span class="ident" id="7496216">Logf</span><span class="op" id="7496220">(</span><span class="string" id="7496221">&#34;ipv4&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7496248">,</span>&nbsp;<span class="ident" id="7496250">err</span><span class="op" id="7496253">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496258">}</span>&nbsp;<span class="keyword" id="7496260">else</span>&nbsp;<span class="keyword" id="7496265">if</span>&nbsp;<span class="ident" id="7496268">network</span>&nbsp;<span class="op" id="7496276">==</span>&nbsp;<span class="string" id="7496279">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7496286">&amp;&amp;</span>&nbsp;<span class="op" id="7496289">!</span><span class="ident" id="7496290">supportsIPv6</span>&nbsp;<span class="op" id="7496303">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496309">t</span><span class="op" id="7496310">.</span><span class="ident" id="7496311">Logf</span><span class="op" id="7496315">(</span><span class="string" id="7496316">&#34;ipv6&nbsp;is&nbsp;not&nbsp;supported:&nbsp;%v&#34;</span><span class="op" id="7496343">,</span>&nbsp;<span class="ident" id="7496345">err</span><span class="op" id="7496348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496353">}</span>&nbsp;<span class="keyword" id="7496355">else</span>&nbsp;<span class="op" id="7496360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496366">t</span><span class="op" id="7496367">.</span><span class="ident" id="7496368">Errorf</span><span class="op" id="7496374">(</span><span class="string" id="7496375">&#34;ResolveTCPAddr&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7496402">,</span>&nbsp;<span class="ident" id="7496404">err</span><span class="op" id="7496407">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496412">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496417">continue</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496428">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496432">if</span>&nbsp;<span class="op" id="7496435">(</span><span class="ident" id="7496436">network</span>&nbsp;<span class="op" id="7496444">==</span>&nbsp;<span class="string" id="7496447">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7496453">||</span>&nbsp;<span class="ident" id="7496456">network</span>&nbsp;<span class="op" id="7496464">==</span>&nbsp;<span class="string" id="7496467">&#34;tcp4&#34;</span><span class="op" id="7496473">)</span>&nbsp;<span class="op" id="7496475">&amp;&amp;</span>&nbsp;<span class="ident" id="7496478">addr</span><span class="op" id="7496482">.</span><span class="ident" id="7496483">IP</span><span class="op" id="7496485">.</span><span class="ident" id="7496486">To4</span><span class="op" id="7496489">(</span><span class="op" id="7496490">)</span>&nbsp;<span class="op" id="7496492">==</span>&nbsp;<span class="ident" id="7496495">nil</span>&nbsp;<span class="op" id="7496499">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496504">t</span><span class="op" id="7496505">.</span><span class="ident" id="7496506">Errorf</span><span class="op" id="7496512">(</span><span class="string" id="7496513">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv4&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7496553">,</span>&nbsp;<span class="ident" id="7496555">addr</span><span class="op" id="7496559">,</span>&nbsp;<span class="ident" id="7496561">network</span><span class="op" id="7496568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496572">}</span>&nbsp;<span class="keyword" id="7496574">else</span>&nbsp;<span class="keyword" id="7496579">if</span>&nbsp;<span class="ident" id="7496582">network</span>&nbsp;<span class="op" id="7496590">==</span>&nbsp;<span class="string" id="7496593">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7496600">&amp;&amp;</span>&nbsp;<span class="op" id="7496603">(</span><span class="ident" id="7496604">addr</span><span class="op" id="7496608">.</span><span class="ident" id="7496609">IP</span><span class="op" id="7496611">.</span><span class="ident" id="7496612">To16</span><span class="op" id="7496616">(</span><span class="op" id="7496617">)</span>&nbsp;<span class="op" id="7496619">==</span>&nbsp;<span class="ident" id="7496622">nil</span>&nbsp;<span class="op" id="7496626">||</span>&nbsp;<span class="ident" id="7496629">addr</span><span class="op" id="7496633">.</span><span class="ident" id="7496634">IP</span><span class="op" id="7496636">.</span><span class="ident" id="7496637">To4</span><span class="op" id="7496640">(</span><span class="op" id="7496641">)</span>&nbsp;<span class="op" id="7496643">!=</span>&nbsp;<span class="ident" id="7496646">nil</span><span class="op" id="7496649">)</span>&nbsp;<span class="op" id="7496651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496656">t</span><span class="op" id="7496657">.</span><span class="ident" id="7496658">Errorf</span><span class="op" id="7496664">(</span><span class="string" id="7496665">&#34;got&nbsp;%v;&nbsp;expected&nbsp;an&nbsp;IPv6&nbsp;address&nbsp;on&nbsp;%v&#34;</span><span class="op" id="7496705">,</span>&nbsp;<span class="ident" id="7496707">addr</span><span class="op" id="7496711">,</span>&nbsp;<span class="ident" id="7496713">network</span><span class="op" id="7496720">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496724">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496727">}</span><br>
<span class="lineno"></span><span class="op" id="7496729">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7496732">func</span>&nbsp;<span class="ident" id="7496737">TestDialGoogle</span><span class="op" id="7496751">(</span><span class="ident" id="7496752">t</span>&nbsp;<span class="op" id="7496754">*</span><span class="ident" id="7496755">testing</span><span class="op" id="7496762">.</span><span class="ident" id="7496763">T</span><span class="op" id="7496764">)</span>&nbsp;<span class="op" id="7496766">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496769">if</span>&nbsp;<span class="ident" id="7496772">testing</span><span class="op" id="7496779">.</span><span class="ident" id="7496780">Short</span><span class="op" id="7496785">(</span><span class="op" id="7496786">)</span>&nbsp;<span class="op" id="7496788">||</span>&nbsp;<span class="op" id="7496791">!</span><span class="op" id="7496792">*</span><span class="ident" id="7496793">testExternal</span>&nbsp;<span class="op" id="7496806">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496810">t</span><span class="op" id="7496811">.</span><span class="ident" id="7496812">Skip</span><span class="op" id="7496816">(</span><span class="string" id="7496817">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7496858">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7496861">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7496865">d</span>&nbsp;<span class="op" id="7496867">:=</span>&nbsp;<span class="op" id="7496870">&amp;</span><span class="ident" id="7496871">Dialer</span><span class="op" id="7496877">{</span><span class="ident" id="7496878">DualStack</span><span class="op" id="7496887">:</span>&nbsp;<span class="builtintype" id="7496889">true</span><span class="op" id="7496893">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496896">for</span>&nbsp;<span class="ident" id="7496900">_</span><span class="op" id="7496901">,</span>&nbsp;<span class="ident" id="7496903">network</span>&nbsp;<span class="op" id="7496911">:=</span>&nbsp;<span class="keyword" id="7496914">range</span>&nbsp;<span class="op" id="7496920">[</span><span class="op" id="7496921">]</span><span class="builtintype" id="7496922">string</span><span class="op" id="7496928">{</span><span class="string" id="7496929">&#34;tcp&#34;</span><span class="op" id="7496934">,</span>&nbsp;<span class="string" id="7496936">&#34;tcp4&#34;</span><span class="op" id="7496942">,</span>&nbsp;<span class="string" id="7496944">&#34;tcp6&#34;</span><span class="op" id="7496950">}</span>&nbsp;<span class="op" id="7496952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7496956">if</span>&nbsp;<span class="ident" id="7496959">network</span>&nbsp;<span class="op" id="7496967">==</span>&nbsp;<span class="string" id="7496970">&#34;tcp&#34;</span>&nbsp;<span class="op" id="7496976">&amp;&amp;</span>&nbsp;<span class="op" id="7496979">!</span><span class="ident" id="7496980">supportsIPv4</span>&nbsp;<span class="op" id="7496993">&amp;&amp;</span>&nbsp;<span class="op" id="7496996">!</span><span class="ident" id="7496997">supportsIPv6</span>&nbsp;<span class="op" id="7497010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497015">t</span><span class="op" id="7497016">.</span><span class="ident" id="7497017">Logf</span><span class="op" id="7497021">(</span><span class="string" id="7497022">&#34;skipping&nbsp;test;&nbsp;both&nbsp;ipv4&nbsp;and&nbsp;ipv6&nbsp;are&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7497075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497080">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497091">}</span>&nbsp;<span class="keyword" id="7497093">else</span>&nbsp;<span class="keyword" id="7497098">if</span>&nbsp;<span class="ident" id="7497101">network</span>&nbsp;<span class="op" id="7497109">==</span>&nbsp;<span class="string" id="7497112">&#34;tcp4&#34;</span>&nbsp;<span class="op" id="7497119">&amp;&amp;</span>&nbsp;<span class="op" id="7497122">!</span><span class="ident" id="7497123">supportsIPv4</span>&nbsp;<span class="op" id="7497136">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497141">t</span><span class="op" id="7497142">.</span><span class="ident" id="7497143">Logf</span><span class="op" id="7497147">(</span><span class="string" id="7497148">&#34;skipping&nbsp;test;&nbsp;ipv4&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7497186">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497191">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497202">}</span>&nbsp;<span class="keyword" id="7497204">else</span>&nbsp;<span class="keyword" id="7497209">if</span>&nbsp;<span class="ident" id="7497212">network</span>&nbsp;<span class="op" id="7497220">==</span>&nbsp;<span class="string" id="7497223">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7497230">&amp;&amp;</span>&nbsp;<span class="op" id="7497233">!</span><span class="ident" id="7497234">supportsIPv6</span>&nbsp;<span class="op" id="7497247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497252">t</span><span class="op" id="7497253">.</span><span class="ident" id="7497254">Logf</span><span class="op" id="7497258">(</span><span class="string" id="7497259">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7497297">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497302">continue</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497313">}</span>&nbsp;<span class="keyword" id="7497315">else</span>&nbsp;<span class="keyword" id="7497320">if</span>&nbsp;<span class="ident" id="7497323">network</span>&nbsp;<span class="op" id="7497331">==</span>&nbsp;<span class="string" id="7497334">&#34;tcp6&#34;</span>&nbsp;<span class="op" id="7497341">&amp;&amp;</span>&nbsp;<span class="op" id="7497344">!</span><span class="op" id="7497345">*</span><span class="ident" id="7497346">testIPv6</span>&nbsp;<span class="op" id="7497355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497360">t</span><span class="op" id="7497361">.</span><span class="ident" id="7497362">Logf</span><span class="op" id="7497366">(</span><span class="string" id="7497367">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7497403">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497408">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497419">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497423">if</span>&nbsp;<span class="ident" id="7497426">c</span><span class="op" id="7497427">,</span>&nbsp;<span class="ident" id="7497429">err</span>&nbsp;<span class="op" id="7497433">:=</span>&nbsp;<span class="ident" id="7497436">d</span><span class="op" id="7497437">.</span><span class="ident" id="7497438">Dial</span><span class="op" id="7497442">(</span><span class="ident" id="7497443">network</span><span class="op" id="7497450">,</span>&nbsp;<span class="string" id="7497452">&#34;www.google.com:http&#34;</span><span class="op" id="7497473">)</span><span class="op" id="7497474">;</span>&nbsp;<span class="ident" id="7497476">err</span>&nbsp;<span class="op" id="7497480">!=</span>&nbsp;<span class="ident" id="7497483">nil</span>&nbsp;<span class="op" id="7497487">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497492">t</span><span class="op" id="7497493">.</span><span class="ident" id="7497494">Errorf</span><span class="op" id="7497500">(</span><span class="string" id="7497501">&#34;Dial&nbsp;failed:&nbsp;%v&#34;</span><span class="op" id="7497518">,</span>&nbsp;<span class="ident" id="7497520">err</span><span class="op" id="7497523">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497527">}</span>&nbsp;<span class="keyword" id="7497529">else</span>&nbsp;<span class="op" id="7497534">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497539">c</span><span class="op" id="7497540">.</span><span class="ident" id="7497541">Close</span><span class="op" id="7497546">(</span><span class="op" id="7497547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497551">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497554">}</span><br>
<span class="lineno">70</span><span class="op" id="7497556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7497559">//&nbsp;fd&nbsp;is&nbsp;already&nbsp;connected&nbsp;to&nbsp;the&nbsp;destination,&nbsp;port&nbsp;80.</span><br>
<span class="lineno"></span><span class="comment" id="7497615">//&nbsp;Run&nbsp;an&nbsp;HTTP&nbsp;request&nbsp;to&nbsp;fetch&nbsp;the&nbsp;appropriate&nbsp;page.</span><br>
<span class="lineno"></span><span class="keyword" id="7497669">func</span>&nbsp;<span class="ident" id="7497674">fetchGoogle</span><span class="op" id="7497685">(</span><span class="ident" id="7497686">t</span>&nbsp;<span class="op" id="7497688">*</span><span class="ident" id="7497689">testing</span><span class="op" id="7497696">.</span><span class="ident" id="7497697">T</span><span class="op" id="7497698">,</span>&nbsp;<span class="ident" id="7497700">fd</span>&nbsp;<span class="ident" id="7497703">Conn</span><span class="op" id="7497707">,</span>&nbsp;<span class="ident" id="7497709">network</span><span class="op" id="7497716">,</span>&nbsp;<span class="ident" id="7497718">addr</span>&nbsp;<span class="builtintype" id="7497723">string</span><span class="op" id="7497729">)</span>&nbsp;<span class="op" id="7497731">{</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497734">req</span>&nbsp;<span class="op" id="7497738">:=</span>&nbsp;<span class="op" id="7497741">[</span><span class="op" id="7497742">]</span><span class="builtintype" id="7497743">byte</span><span class="op" id="7497747">(</span><span class="string" id="7497748">&#34;GET&nbsp;/robots.txt&nbsp;HTTP/1.0\r\nHost:&nbsp;www.google.com\r\n\r\n&#34;</span><span class="op" id="7497806">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497809">n</span><span class="op" id="7497810">,</span>&nbsp;<span class="ident" id="7497812">err</span>&nbsp;<span class="op" id="7497816">:=</span>&nbsp;<span class="ident" id="7497819">fd</span><span class="op" id="7497821">.</span><span class="ident" id="7497822">Write</span><span class="op" id="7497827">(</span><span class="ident" id="7497828">req</span><span class="op" id="7497831">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497835">buf</span>&nbsp;<span class="op" id="7497839">:=</span>&nbsp;<span class="builtinfunc" id="7497842">make</span><span class="op" id="7497846">(</span><span class="op" id="7497847">[</span><span class="op" id="7497848">]</span><span class="builtintype" id="7497849">byte</span><span class="op" id="7497853">,</span>&nbsp;<span class="num" id="7497855">1000</span><span class="op" id="7497859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497862">n</span><span class="op" id="7497863">,</span>&nbsp;<span class="ident" id="7497865">err</span>&nbsp;<span class="op" id="7497869">=</span>&nbsp;<span class="ident" id="7497871">io</span><span class="op" id="7497873">.</span><span class="ident" id="7497874">ReadFull</span><span class="op" id="7497882">(</span><span class="ident" id="7497883">fd</span><span class="op" id="7497885">,</span>&nbsp;<span class="ident" id="7497887">buf</span><span class="op" id="7497890">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497894">if</span>&nbsp;<span class="ident" id="7497897">n</span>&nbsp;<span class="op" id="7497899">&lt;</span>&nbsp;<span class="num" id="7497901">1000</span>&nbsp;<span class="op" id="7497906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7497910">t</span><span class="op" id="7497911">.</span><span class="ident" id="7497912">Errorf</span><span class="op" id="7497918">(</span><span class="string" id="7497919">&#34;fetchGoogle:&nbsp;short&nbsp;HTTP&nbsp;read&nbsp;from&nbsp;%s&nbsp;%s&nbsp;-&nbsp;%v&#34;</span><span class="op" id="7497965">,</span>&nbsp;<span class="ident" id="7497967">network</span><span class="op" id="7497974">,</span>&nbsp;<span class="ident" id="7497976">addr</span><span class="op" id="7497980">,</span>&nbsp;<span class="ident" id="7497982">err</span><span class="op" id="7497985">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7497989">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7497997">}</span><br>
<span class="lineno">85</span><span class="op" id="7497999">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7498002">func</span>&nbsp;<span class="ident" id="7498007">doDial</span><span class="op" id="7498013">(</span><span class="ident" id="7498014">t</span>&nbsp;<span class="op" id="7498016">*</span><span class="ident" id="7498017">testing</span><span class="op" id="7498024">.</span><span class="ident" id="7498025">T</span><span class="op" id="7498026">,</span>&nbsp;<span class="ident" id="7498028">network</span><span class="op" id="7498035">,</span>&nbsp;<span class="ident" id="7498037">addr</span>&nbsp;<span class="builtintype" id="7498042">string</span><span class="op" id="7498048">)</span>&nbsp;<span class="op" id="7498050">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498053">fd</span><span class="op" id="7498055">,</span>&nbsp;<span class="ident" id="7498057">err</span>&nbsp;<span class="op" id="7498061">:=</span>&nbsp;<span class="ident" id="7498064">Dial</span><span class="op" id="7498068">(</span><span class="ident" id="7498069">network</span><span class="op" id="7498076">,</span>&nbsp;<span class="ident" id="7498078">addr</span><span class="op" id="7498082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498085">if</span>&nbsp;<span class="ident" id="7498088">err</span>&nbsp;<span class="op" id="7498092">!=</span>&nbsp;<span class="ident" id="7498095">nil</span>&nbsp;<span class="op" id="7498099">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498103">t</span><span class="op" id="7498104">.</span><span class="ident" id="7498105">Errorf</span><span class="op" id="7498111">(</span><span class="string" id="7498112">&#34;Dial(%q,&nbsp;%q,&nbsp;%q)&nbsp;=&nbsp;_,&nbsp;%v&#34;</span><span class="op" id="7498138">,</span>&nbsp;<span class="ident" id="7498140">network</span><span class="op" id="7498147">,</span>&nbsp;<span class="string" id="7498149">&#34;&#34;</span><span class="op" id="7498151">,</span>&nbsp;<span class="ident" id="7498153">addr</span><span class="op" id="7498157">,</span>&nbsp;<span class="ident" id="7498159">err</span><span class="op" id="7498162">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498166">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498177">fetchGoogle</span><span class="op" id="7498188">(</span><span class="ident" id="7498189">t</span><span class="op" id="7498190">,</span>&nbsp;<span class="ident" id="7498192">fd</span><span class="op" id="7498194">,</span>&nbsp;<span class="ident" id="7498196">network</span><span class="op" id="7498203">,</span>&nbsp;<span class="ident" id="7498205">addr</span><span class="op" id="7498209">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498212">fd</span><span class="op" id="7498214">.</span><span class="ident" id="7498215">Close</span><span class="op" id="7498220">(</span><span class="op" id="7498221">)</span><br>
<span class="lineno">95</span><span class="op" id="7498223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7498226">var</span>&nbsp;<span class="ident" id="7498230">googleaddrsipv4</span>&nbsp;<span class="op" id="7498246">=</span>&nbsp;<span class="op" id="7498248">[</span><span class="op" id="7498249">]</span><span class="builtintype" id="7498250">string</span><span class="op" id="7498256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498259">&#34;%d.%d.%d.%d:80&#34;</span><span class="op" id="7498275">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498278">&#34;www.google.com:80&#34;</span><span class="op" id="7498297">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498300">&#34;%d.%d.%d.%d:http&#34;</span><span class="op" id="7498318">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498321">&#34;www.google.com:http&#34;</span><span class="op" id="7498342">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498345">&#34;%03d.%03d.%03d.%03d:0080&#34;</span><span class="op" id="7498371">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498374">&#34;[::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7498399">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498402">&#34;[::ffff:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7498433">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498436">&#34;[0:0:0:0:0000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7498472">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498475">&#34;[0:0:0:0:000000:ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7498513">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7498516">&#34;[0:0:0:0::ffff:%d.%d.%d.%d]:80&#34;</span><span class="op" id="7498548">,</span><br>
<span class="lineno"></span><span class="op" id="7498550">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7498553">func</span>&nbsp;<span class="ident" id="7498558">TestDialGoogleIPv4</span><span class="op" id="7498576">(</span><span class="ident" id="7498577">t</span>&nbsp;<span class="op" id="7498579">*</span><span class="ident" id="7498580">testing</span><span class="op" id="7498587">.</span><span class="ident" id="7498588">T</span><span class="op" id="7498589">)</span>&nbsp;<span class="op" id="7498591">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498594">if</span>&nbsp;<span class="ident" id="7498597">testing</span><span class="op" id="7498604">.</span><span class="ident" id="7498605">Short</span><span class="op" id="7498610">(</span><span class="op" id="7498611">)</span>&nbsp;<span class="op" id="7498613">||</span>&nbsp;<span class="op" id="7498616">!</span><span class="op" id="7498617">*</span><span class="ident" id="7498618">testExternal</span>&nbsp;<span class="op" id="7498631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498635">t</span><span class="op" id="7498636">.</span><span class="ident" id="7498637">Skip</span><span class="op" id="7498641">(</span><span class="string" id="7498642">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7498683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7498690">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv4&nbsp;address&nbsp;for&nbsp;google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7498739">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498759">addrs</span><span class="op" id="7498764">,</span>&nbsp;<span class="ident" id="7498766">err</span>&nbsp;<span class="op" id="7498770">:=</span>&nbsp;<span class="ident" id="7498773">LookupIP</span><span class="op" id="7498781">(</span><span class="string" id="7498782">&#34;www.google.com&#34;</span><span class="op" id="7498798">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498801">if</span>&nbsp;<span class="ident" id="7498804">err</span>&nbsp;<span class="op" id="7498808">!=</span>&nbsp;<span class="ident" id="7498811">nil</span>&nbsp;<span class="op" id="7498815">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498819">t</span><span class="op" id="7498820">.</span><span class="ident" id="7498821">Fatalf</span><span class="op" id="7498827">(</span><span class="string" id="7498828">&#34;lookup&nbsp;www.google.com:&nbsp;%v&#34;</span><span class="op" id="7498855">,</span>&nbsp;<span class="ident" id="7498857">err</span><span class="op" id="7498860">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498866">var</span>&nbsp;<span class="ident" id="7498870">ip</span>&nbsp;<span class="ident" id="7498873">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498877">for</span>&nbsp;<span class="ident" id="7498881">_</span><span class="op" id="7498882">,</span>&nbsp;<span class="ident" id="7498884">addr</span>&nbsp;<span class="op" id="7498889">:=</span>&nbsp;<span class="keyword" id="7498892">range</span>&nbsp;<span class="ident" id="7498898">addrs</span>&nbsp;<span class="op" id="7498904">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498908">if</span>&nbsp;<span class="ident" id="7498911">x</span>&nbsp;<span class="op" id="7498913">:=</span>&nbsp;<span class="ident" id="7498916">addr</span><span class="op" id="7498920">.</span><span class="ident" id="7498921">To4</span><span class="op" id="7498924">(</span><span class="op" id="7498925">)</span><span class="op" id="7498926">;</span>&nbsp;<span class="ident" id="7498928">x</span>&nbsp;<span class="op" id="7498930">!=</span>&nbsp;<span class="ident" id="7498933">nil</span>&nbsp;<span class="op" id="7498937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498942">ip</span>&nbsp;<span class="op" id="7498945">=</span>&nbsp;<span class="ident" id="7498947">x</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498952">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498960">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7498963">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7498966">if</span>&nbsp;<span class="ident" id="7498969">ip</span>&nbsp;<span class="op" id="7498972">==</span>&nbsp;<span class="ident" id="7498975">nil</span>&nbsp;<span class="op" id="7498979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7498983">t</span><span class="op" id="7498984">.</span><span class="ident" id="7498985">Fatalf</span><span class="op" id="7498991">(</span><span class="string" id="7498992">&#34;no&nbsp;IPv4&nbsp;addresses&nbsp;for&nbsp;www.google.com&#34;</span><span class="op" id="7499030">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499033">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499037">for</span>&nbsp;<span class="ident" id="7499041">i</span><span class="op" id="7499042">,</span>&nbsp;<span class="ident" id="7499044">s</span>&nbsp;<span class="op" id="7499046">:=</span>&nbsp;<span class="keyword" id="7499049">range</span>&nbsp;<span class="ident" id="7499055">googleaddrsipv4</span>&nbsp;<span class="op" id="7499071">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499075">if</span>&nbsp;<span class="ident" id="7499078">strings</span><span class="op" id="7499085">.</span><span class="ident" id="7499086">Contains</span><span class="op" id="7499094">(</span><span class="ident" id="7499095">s</span><span class="op" id="7499096">,</span>&nbsp;<span class="string" id="7499098">&#34;%&#34;</span><span class="op" id="7499101">)</span>&nbsp;<span class="op" id="7499103">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499108">googleaddrsipv4</span><span class="op" id="7499123">[</span><span class="ident" id="7499124">i</span><span class="op" id="7499125">]</span>&nbsp;<span class="op" id="7499127">=</span>&nbsp;<span class="ident" id="7499129">fmt</span><span class="op" id="7499132">.</span><span class="ident" id="7499133">Sprintf</span><span class="op" id="7499140">(</span><span class="ident" id="7499141">s</span><span class="op" id="7499142">,</span>&nbsp;<span class="ident" id="7499144">ip</span><span class="op" id="7499146">[</span><span class="num" id="7499147">0</span><span class="op" id="7499148">]</span><span class="op" id="7499149">,</span>&nbsp;<span class="ident" id="7499151">ip</span><span class="op" id="7499153">[</span><span class="num" id="7499154">1</span><span class="op" id="7499155">]</span><span class="op" id="7499156">,</span>&nbsp;<span class="ident" id="7499158">ip</span><span class="op" id="7499160">[</span><span class="num" id="7499161">2</span><span class="op" id="7499162">]</span><span class="op" id="7499163">,</span>&nbsp;<span class="ident" id="7499165">ip</span><span class="op" id="7499167">[</span><span class="num" id="7499168">3</span><span class="op" id="7499169">]</span><span class="op" id="7499170">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499174">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499177">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499181">for</span>&nbsp;<span class="ident" id="7499185">i</span>&nbsp;<span class="op" id="7499187">:=</span>&nbsp;<span class="num" id="7499190">0</span><span class="op" id="7499191">;</span>&nbsp;<span class="ident" id="7499193">i</span>&nbsp;<span class="op" id="7499195">&lt;</span>&nbsp;<span class="builtinfunc" id="7499197">len</span><span class="op" id="7499200">(</span><span class="ident" id="7499201">googleaddrsipv4</span><span class="op" id="7499216">)</span><span class="op" id="7499217">;</span>&nbsp;<span class="ident" id="7499219">i</span><span class="op" id="7499220">++</span>&nbsp;<span class="op" id="7499223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499227">addr</span>&nbsp;<span class="op" id="7499232">:=</span>&nbsp;<span class="ident" id="7499235">googleaddrsipv4</span><span class="op" id="7499250">[</span><span class="ident" id="7499251">i</span><span class="op" id="7499252">]</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499256">if</span>&nbsp;<span class="ident" id="7499259">addr</span>&nbsp;<span class="op" id="7499264">==</span>&nbsp;<span class="string" id="7499267">&#34;&#34;</span>&nbsp;<span class="op" id="7499270">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499275">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499290">t</span><span class="op" id="7499291">.</span><span class="ident" id="7499292">Logf</span><span class="op" id="7499296">(</span><span class="string" id="7499297">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7499307">,</span>&nbsp;<span class="ident" id="7499309">addr</span><span class="op" id="7499313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499317">doDial</span><span class="op" id="7499323">(</span><span class="ident" id="7499324">t</span><span class="op" id="7499325">,</span>&nbsp;<span class="string" id="7499327">&#34;tcp&#34;</span><span class="op" id="7499332">,</span>&nbsp;<span class="ident" id="7499334">addr</span><span class="op" id="7499338">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499342">if</span>&nbsp;<span class="ident" id="7499345">addr</span><span class="op" id="7499349">[</span><span class="num" id="7499350">0</span><span class="op" id="7499351">]</span>&nbsp;<span class="op" id="7499353">!=</span>&nbsp;<span class="string" id="7499356">&#39;[&#39;</span>&nbsp;<span class="op" id="7499360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499365">doDial</span><span class="op" id="7499371">(</span><span class="ident" id="7499372">t</span><span class="op" id="7499373">,</span>&nbsp;<span class="string" id="7499375">&#34;tcp4&#34;</span><span class="op" id="7499381">,</span>&nbsp;<span class="ident" id="7499383">addr</span><span class="op" id="7499387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499392">if</span>&nbsp;<span class="ident" id="7499395">supportsIPv6</span>&nbsp;<span class="op" id="7499408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7499414">//&nbsp;make&nbsp;sure&nbsp;syscall.SocketDisableIPv6&nbsp;flag&nbsp;works.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499469">syscall</span><span class="op" id="7499476">.</span><span class="ident" id="7499477">SocketDisableIPv6</span>&nbsp;<span class="op" id="7499495">=</span>&nbsp;<span class="builtintype" id="7499497">true</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499506">doDial</span><span class="op" id="7499512">(</span><span class="ident" id="7499513">t</span><span class="op" id="7499514">,</span>&nbsp;<span class="string" id="7499516">&#34;tcp&#34;</span><span class="op" id="7499521">,</span>&nbsp;<span class="ident" id="7499523">addr</span><span class="op" id="7499527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499533">doDial</span><span class="op" id="7499539">(</span><span class="ident" id="7499540">t</span><span class="op" id="7499541">,</span>&nbsp;<span class="string" id="7499543">&#34;tcp4&#34;</span><span class="op" id="7499549">,</span>&nbsp;<span class="ident" id="7499551">addr</span><span class="op" id="7499555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499561">syscall</span><span class="op" id="7499568">.</span><span class="ident" id="7499569">SocketDisableIPv6</span>&nbsp;<span class="op" id="7499587">=</span>&nbsp;<span class="builtintype" id="7499589">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499598">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499602">}</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499605">}</span><br>
<span class="lineno"></span><span class="op" id="7499607">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7499610">var</span>&nbsp;<span class="ident" id="7499614">googleaddrsipv6</span>&nbsp;<span class="op" id="7499630">=</span>&nbsp;<span class="op" id="7499632">[</span><span class="op" id="7499633">]</span><span class="builtintype" id="7499634">string</span><span class="op" id="7499640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7499643">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:80&#34;</span><span class="op" id="7499721">,</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7499724">&#34;ipv6.google.com:80&#34;</span><span class="op" id="7499744">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7499747">&#34;[%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x:%02x%02x]:http&#34;</span><span class="op" id="7499827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7499830">&#34;ipv6.google.com:http&#34;</span><span class="op" id="7499852">,</span><br>
<span class="lineno"></span><span class="op" id="7499854">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="keyword" id="7499857">func</span>&nbsp;<span class="ident" id="7499862">TestDialGoogleIPv6</span><span class="op" id="7499880">(</span><span class="ident" id="7499881">t</span>&nbsp;<span class="op" id="7499883">*</span><span class="ident" id="7499884">testing</span><span class="op" id="7499891">.</span><span class="ident" id="7499892">T</span><span class="op" id="7499893">)</span>&nbsp;<span class="op" id="7499895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7499898">if</span>&nbsp;<span class="ident" id="7499901">testing</span><span class="op" id="7499908">.</span><span class="ident" id="7499909">Short</span><span class="op" id="7499914">(</span><span class="op" id="7499915">)</span>&nbsp;<span class="op" id="7499917">||</span>&nbsp;<span class="op" id="7499920">!</span><span class="op" id="7499921">*</span><span class="ident" id="7499922">testExternal</span>&nbsp;<span class="op" id="7499935">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7499939">t</span><span class="op" id="7499940">.</span><span class="ident" id="7499941">Skip</span><span class="op" id="7499945">(</span><span class="string" id="7499946">&#34;skipping&nbsp;test&nbsp;to&nbsp;avoid&nbsp;external&nbsp;network&#34;</span><span class="op" id="7499987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7499990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7499993">//&nbsp;Only&nbsp;run&nbsp;tcp6&nbsp;if&nbsp;the&nbsp;kernel&nbsp;will&nbsp;take&nbsp;it.</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500039">if</span>&nbsp;<span class="op" id="7500042">!</span><span class="ident" id="7500043">supportsIPv6</span>&nbsp;<span class="op" id="7500056">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500060">t</span><span class="op" id="7500061">.</span><span class="ident" id="7500062">Skip</span><span class="op" id="7500066">(</span><span class="string" id="7500067">&#34;skipping&nbsp;test;&nbsp;ipv6&nbsp;is&nbsp;not&nbsp;supported&#34;</span><span class="op" id="7500105">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500108">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500111">if</span>&nbsp;<span class="op" id="7500114">!</span><span class="op" id="7500115">*</span><span class="ident" id="7500116">testIPv6</span>&nbsp;<span class="op" id="7500125">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500129">t</span><span class="op" id="7500130">.</span><span class="ident" id="7500131">Skip</span><span class="op" id="7500135">(</span><span class="string" id="7500136">&#34;test&nbsp;disabled;&nbsp;use&nbsp;-ipv6&nbsp;to&nbsp;enable&#34;</span><span class="op" id="7500172">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7500179">//&nbsp;Insert&nbsp;an&nbsp;actual&nbsp;IPv6&nbsp;address&nbsp;for&nbsp;ipv6.google.com</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7500233">//&nbsp;into&nbsp;the&nbsp;table.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500253">addrs</span><span class="op" id="7500258">,</span>&nbsp;<span class="ident" id="7500260">err</span>&nbsp;<span class="op" id="7500264">:=</span>&nbsp;<span class="ident" id="7500267">LookupIP</span><span class="op" id="7500275">(</span><span class="string" id="7500276">&#34;ipv6.google.com&#34;</span><span class="op" id="7500293">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500296">if</span>&nbsp;<span class="ident" id="7500299">err</span>&nbsp;<span class="op" id="7500303">!=</span>&nbsp;<span class="ident" id="7500306">nil</span>&nbsp;<span class="op" id="7500310">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500314">t</span><span class="op" id="7500315">.</span><span class="ident" id="7500316">Fatalf</span><span class="op" id="7500322">(</span><span class="string" id="7500323">&#34;lookup&nbsp;ipv6.google.com:&nbsp;%v&#34;</span><span class="op" id="7500351">,</span>&nbsp;<span class="ident" id="7500353">err</span><span class="op" id="7500356">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500359">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500362">var</span>&nbsp;<span class="ident" id="7500366">ip</span>&nbsp;<span class="ident" id="7500369">IP</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500373">for</span>&nbsp;<span class="ident" id="7500377">_</span><span class="op" id="7500378">,</span>&nbsp;<span class="ident" id="7500380">addr</span>&nbsp;<span class="op" id="7500385">:=</span>&nbsp;<span class="keyword" id="7500388">range</span>&nbsp;<span class="ident" id="7500394">addrs</span>&nbsp;<span class="op" id="7500400">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500404">if</span>&nbsp;<span class="ident" id="7500407">x</span>&nbsp;<span class="op" id="7500409">:=</span>&nbsp;<span class="ident" id="7500412">addr</span><span class="op" id="7500416">.</span><span class="ident" id="7500417">To16</span><span class="op" id="7500421">(</span><span class="op" id="7500422">)</span><span class="op" id="7500423">;</span>&nbsp;<span class="ident" id="7500425">x</span>&nbsp;<span class="op" id="7500427">!=</span>&nbsp;<span class="ident" id="7500430">nil</span>&nbsp;<span class="op" id="7500434">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500439">ip</span>&nbsp;<span class="op" id="7500442">=</span>&nbsp;<span class="ident" id="7500444">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500449">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500457">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500460">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500463">if</span>&nbsp;<span class="ident" id="7500466">ip</span>&nbsp;<span class="op" id="7500469">==</span>&nbsp;<span class="ident" id="7500472">nil</span>&nbsp;<span class="op" id="7500476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500480">t</span><span class="op" id="7500481">.</span><span class="ident" id="7500482">Fatalf</span><span class="op" id="7500488">(</span><span class="string" id="7500489">&#34;no&nbsp;IPv6&nbsp;addresses&nbsp;for&nbsp;ipv6.google.com&#34;</span><span class="op" id="7500528">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500531">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500535">for</span>&nbsp;<span class="ident" id="7500539">i</span><span class="op" id="7500540">,</span>&nbsp;<span class="ident" id="7500542">s</span>&nbsp;<span class="op" id="7500544">:=</span>&nbsp;<span class="keyword" id="7500547">range</span>&nbsp;<span class="ident" id="7500553">googleaddrsipv6</span>&nbsp;<span class="op" id="7500569">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500573">if</span>&nbsp;<span class="ident" id="7500576">strings</span><span class="op" id="7500583">.</span><span class="ident" id="7500584">Contains</span><span class="op" id="7500592">(</span><span class="ident" id="7500593">s</span><span class="op" id="7500594">,</span>&nbsp;<span class="string" id="7500596">&#34;%&#34;</span><span class="op" id="7500599">)</span>&nbsp;<span class="op" id="7500601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500606">googleaddrsipv6</span><span class="op" id="7500621">[</span><span class="ident" id="7500622">i</span><span class="op" id="7500623">]</span>&nbsp;<span class="op" id="7500625">=</span>&nbsp;<span class="ident" id="7500627">fmt</span><span class="op" id="7500630">.</span><span class="ident" id="7500631">Sprintf</span><span class="op" id="7500638">(</span><span class="ident" id="7500639">s</span><span class="op" id="7500640">,</span>&nbsp;<span class="ident" id="7500642">ip</span><span class="op" id="7500644">[</span><span class="num" id="7500645">0</span><span class="op" id="7500646">]</span><span class="op" id="7500647">,</span>&nbsp;<span class="ident" id="7500649">ip</span><span class="op" id="7500651">[</span><span class="num" id="7500652">1</span><span class="op" id="7500653">]</span><span class="op" id="7500654">,</span>&nbsp;<span class="ident" id="7500656">ip</span><span class="op" id="7500658">[</span><span class="num" id="7500659">2</span><span class="op" id="7500660">]</span><span class="op" id="7500661">,</span>&nbsp;<span class="ident" id="7500663">ip</span><span class="op" id="7500665">[</span><span class="num" id="7500666">3</span><span class="op" id="7500667">]</span><span class="op" id="7500668">,</span>&nbsp;<span class="ident" id="7500670">ip</span><span class="op" id="7500672">[</span><span class="num" id="7500673">4</span><span class="op" id="7500674">]</span><span class="op" id="7500675">,</span>&nbsp;<span class="ident" id="7500677">ip</span><span class="op" id="7500679">[</span><span class="num" id="7500680">5</span><span class="op" id="7500681">]</span><span class="op" id="7500682">,</span>&nbsp;<span class="ident" id="7500684">ip</span><span class="op" id="7500686">[</span><span class="num" id="7500687">6</span><span class="op" id="7500688">]</span><span class="op" id="7500689">,</span>&nbsp;<span class="ident" id="7500691">ip</span><span class="op" id="7500693">[</span><span class="num" id="7500694">7</span><span class="op" id="7500695">]</span><span class="op" id="7500696">,</span>&nbsp;<span class="ident" id="7500698">ip</span><span class="op" id="7500700">[</span><span class="num" id="7500701">8</span><span class="op" id="7500702">]</span><span class="op" id="7500703">,</span>&nbsp;<span class="ident" id="7500705">ip</span><span class="op" id="7500707">[</span><span class="num" id="7500708">9</span><span class="op" id="7500709">]</span><span class="op" id="7500710">,</span>&nbsp;<span class="ident" id="7500712">ip</span><span class="op" id="7500714">[</span><span class="num" id="7500715">10</span><span class="op" id="7500717">]</span><span class="op" id="7500718">,</span>&nbsp;<span class="ident" id="7500720">ip</span><span class="op" id="7500722">[</span><span class="num" id="7500723">11</span><span class="op" id="7500725">]</span><span class="op" id="7500726">,</span>&nbsp;<span class="ident" id="7500728">ip</span><span class="op" id="7500730">[</span><span class="num" id="7500731">12</span><span class="op" id="7500733">]</span><span class="op" id="7500734">,</span>&nbsp;<span class="ident" id="7500736">ip</span><span class="op" id="7500738">[</span><span class="num" id="7500739">13</span><span class="op" id="7500741">]</span><span class="op" id="7500742">,</span>&nbsp;<span class="ident" id="7500744">ip</span><span class="op" id="7500746">[</span><span class="num" id="7500747">14</span><span class="op" id="7500749">]</span><span class="op" id="7500750">,</span>&nbsp;<span class="ident" id="7500752">ip</span><span class="op" id="7500754">[</span><span class="num" id="7500755">15</span><span class="op" id="7500757">]</span><span class="op" id="7500758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500765">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500769">for</span>&nbsp;<span class="ident" id="7500773">i</span>&nbsp;<span class="op" id="7500775">:=</span>&nbsp;<span class="num" id="7500778">0</span><span class="op" id="7500779">;</span>&nbsp;<span class="ident" id="7500781">i</span>&nbsp;<span class="op" id="7500783">&lt;</span>&nbsp;<span class="builtinfunc" id="7500785">len</span><span class="op" id="7500788">(</span><span class="ident" id="7500789">googleaddrsipv6</span><span class="op" id="7500804">)</span><span class="op" id="7500805">;</span>&nbsp;<span class="ident" id="7500807">i</span><span class="op" id="7500808">++</span>&nbsp;<span class="op" id="7500811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500815">addr</span>&nbsp;<span class="op" id="7500820">:=</span>&nbsp;<span class="ident" id="7500823">googleaddrsipv6</span><span class="op" id="7500838">[</span><span class="ident" id="7500839">i</span><span class="op" id="7500840">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500844">if</span>&nbsp;<span class="ident" id="7500847">addr</span>&nbsp;<span class="op" id="7500852">==</span>&nbsp;<span class="string" id="7500855">&#34;&#34;</span>&nbsp;<span class="op" id="7500858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7500863">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500874">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500878">t</span><span class="op" id="7500879">.</span><span class="ident" id="7500880">Logf</span><span class="op" id="7500884">(</span><span class="string" id="7500885">&#34;--&nbsp;%s&nbsp;--&#34;</span><span class="op" id="7500895">,</span>&nbsp;<span class="ident" id="7500897">addr</span><span class="op" id="7500901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500905">doDial</span><span class="op" id="7500911">(</span><span class="ident" id="7500912">t</span><span class="op" id="7500913">,</span>&nbsp;<span class="string" id="7500915">&#34;tcp&#34;</span><span class="op" id="7500920">,</span>&nbsp;<span class="ident" id="7500922">addr</span><span class="op" id="7500926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7500930">doDial</span><span class="op" id="7500936">(</span><span class="ident" id="7500937">t</span><span class="op" id="7500938">,</span>&nbsp;<span class="string" id="7500940">&#34;tcp6&#34;</span><span class="op" id="7500946">,</span>&nbsp;<span class="ident" id="7500948">addr</span><span class="op" id="7500952">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7500955">}</span><br>
<span class="lineno"></span><span class="op" id="7500957">}</span>
</div>
</body>
</html>
