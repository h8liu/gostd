<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/doc</h2>
<ul>
<li><a href="/gostd/go/doc/comment.go.html">comment.go</a></li>
<li><a href="/gostd/go/doc/comment_test.go.html">comment_test.go</a></li>
<li><a href="/gostd/go/doc/doc.go.html">doc.go</a></li>
<li><a href="/gostd/go/doc/doc_test.go.html">doc_test.go</a></li>
<li><a href="/gostd/go/doc/example.go.html">example.go</a></li>
<li><a href="/gostd/go/doc/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/doc/exports.go.html" class="current">exports.go</a></li>
<li><a href="/gostd/go/doc/filter.go.html">filter.go</a></li>
<li><a href="/gostd/go/doc/reader.go.html">reader.go</a></li>
<li><a href="/gostd/go/doc/synopsis.go.html">synopsis.go</a></li>
<li><a href="/gostd/go/doc/synopsis_test.go.html">synopsis_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="3020399">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="3020454">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="3020508">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="3020559">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;export&nbsp;filtering&nbsp;of&nbsp;an&nbsp;AST.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3020612">package</span>&nbsp;<span class="ident" id="3020620">doc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3020625">import</span>&nbsp;<span class="op" id="3020632">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020635">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="3020645">&#34;go/token&#34;</span><br>
<span class="lineno"></span><span class="op" id="3020656">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3020659">//&nbsp;filterIdentList&nbsp;removes&nbsp;unexported&nbsp;names&nbsp;from&nbsp;list&nbsp;in&nbsp;place</span><br>
<span class="lineno">15</span><span class="comment" id="3020722">//&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;list.&nbsp;If&nbsp;blankOk&nbsp;is&nbsp;set,&nbsp;blank</span><br>
<span class="lineno"></span><span class="comment" id="3020782">//&nbsp;identifiers&nbsp;are&nbsp;considered&nbsp;exported&nbsp;names.</span><br>
<span class="lineno"></span><span class="comment" id="3020828">//</span><br>
<span class="lineno"></span><span class="keyword" id="3020831">func</span>&nbsp;<span class="ident" id="3020836">filterIdentList</span><span class="op" id="3020851">(</span><span class="ident" id="3020852">list</span>&nbsp;<span class="op" id="3020857">[</span><span class="op" id="3020858">]</span><span class="op" id="3020859">*</span><span class="ident" id="3020860">ast</span><span class="op" id="3020863">.</span><span class="ident" id="3020864">Ident</span><span class="op" id="3020869">,</span>&nbsp;<span class="ident" id="3020871">blankOk</span>&nbsp;<span class="builtintype" id="3020879">bool</span><span class="op" id="3020883">)</span>&nbsp;<span class="op" id="3020885">[</span><span class="op" id="3020886">]</span><span class="op" id="3020887">*</span><span class="ident" id="3020888">ast</span><span class="op" id="3020891">.</span><span class="ident" id="3020892">Ident</span>&nbsp;<span class="op" id="3020898">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020901">j</span>&nbsp;<span class="op" id="3020903">:=</span>&nbsp;<span class="num" id="3020906">0</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3020909">for</span>&nbsp;<span class="ident" id="3020913">_</span><span class="op" id="3020914">,</span>&nbsp;<span class="ident" id="3020916">x</span>&nbsp;<span class="op" id="3020918">:=</span>&nbsp;<span class="keyword" id="3020921">range</span>&nbsp;<span class="ident" id="3020927">list</span>&nbsp;<span class="op" id="3020932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3020936">if</span>&nbsp;<span class="ident" id="3020939">ast</span><span class="op" id="3020942">.</span><span class="ident" id="3020943">IsExported</span><span class="op" id="3020953">(</span><span class="ident" id="3020954">x</span><span class="op" id="3020955">.</span><span class="ident" id="3020956">Name</span><span class="op" id="3020960">)</span>&nbsp;<span class="op" id="3020962">||</span>&nbsp;<span class="op" id="3020965">(</span><span class="ident" id="3020966">blankOk</span>&nbsp;<span class="op" id="3020974">&amp;&amp;</span>&nbsp;<span class="ident" id="3020977">x</span><span class="op" id="3020978">.</span><span class="ident" id="3020979">Name</span>&nbsp;<span class="op" id="3020984">==</span>&nbsp;<span class="string" id="3020987">&#34;_&#34;</span><span class="op" id="3020990">)</span>&nbsp;<span class="op" id="3020992">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3020997">list</span><span class="op" id="3021001">[</span><span class="ident" id="3021002">j</span><span class="op" id="3021003">]</span>&nbsp;<span class="op" id="3021005">=</span>&nbsp;<span class="ident" id="3021007">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021012">j</span><span class="op" id="3021013">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021018">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021021">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021024">return</span>&nbsp;<span class="ident" id="3021031">list</span><span class="op" id="3021035">[</span><span class="num" id="3021036">0</span><span class="op" id="3021037">:</span><span class="ident" id="3021038">j</span><span class="op" id="3021039">]</span><br>
<span class="lineno"></span><span class="op" id="3021041">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3021044">//&nbsp;removeErrorField&nbsp;removes&nbsp;anonymous&nbsp;fields&nbsp;named&nbsp;&#34;error&#34;&nbsp;from&nbsp;an&nbsp;interface.</span><br>
<span class="lineno">30</span><span class="comment" id="3021122">//&nbsp;This&nbsp;is&nbsp;called&nbsp;when&nbsp;&#34;error&#34;&nbsp;has&nbsp;been&nbsp;determined&nbsp;to&nbsp;be&nbsp;a&nbsp;local&nbsp;name,</span><br>
<span class="lineno"></span><span class="comment" id="3021193">//&nbsp;not&nbsp;the&nbsp;predeclared&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="3021222">//</span><br>
<span class="lineno"></span><span class="keyword" id="3021225">func</span>&nbsp;<span class="ident" id="3021230">removeErrorField</span><span class="op" id="3021246">(</span><span class="ident" id="3021247">ityp</span>&nbsp;<span class="op" id="3021252">*</span><span class="ident" id="3021253">ast</span><span class="op" id="3021256">.</span><span class="ident" id="3021257">InterfaceType</span><span class="op" id="3021270">)</span>&nbsp;<span class="op" id="3021272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021275">list</span>&nbsp;<span class="op" id="3021280">:=</span>&nbsp;<span class="ident" id="3021283">ityp</span><span class="op" id="3021287">.</span><span class="ident" id="3021288">Methods</span><span class="op" id="3021295">.</span><span class="ident" id="3021296">List</span>&nbsp;<span class="comment" id="3021301">//&nbsp;we&nbsp;know&nbsp;that&nbsp;ityp.Methods&nbsp;!=&nbsp;nil</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021338">j</span>&nbsp;<span class="op" id="3021340">:=</span>&nbsp;<span class="num" id="3021343">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021346">for</span>&nbsp;<span class="ident" id="3021350">_</span><span class="op" id="3021351">,</span>&nbsp;<span class="ident" id="3021353">field</span>&nbsp;<span class="op" id="3021359">:=</span>&nbsp;<span class="keyword" id="3021362">range</span>&nbsp;<span class="ident" id="3021368">list</span>&nbsp;<span class="op" id="3021373">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021377">keepField</span>&nbsp;<span class="op" id="3021387">:=</span>&nbsp;<span class="builtintype" id="3021390">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021397">if</span>&nbsp;<span class="ident" id="3021400">n</span>&nbsp;<span class="op" id="3021402">:=</span>&nbsp;<span class="builtinfunc" id="3021405">len</span><span class="op" id="3021408">(</span><span class="ident" id="3021409">field</span><span class="op" id="3021414">.</span><span class="ident" id="3021415">Names</span><span class="op" id="3021420">)</span><span class="op" id="3021421">;</span>&nbsp;<span class="ident" id="3021423">n</span>&nbsp;<span class="op" id="3021425">==</span>&nbsp;<span class="num" id="3021428">0</span>&nbsp;<span class="op" id="3021430">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3021435">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021457">if</span>&nbsp;<span class="ident" id="3021460">fname</span><span class="op" id="3021465">,</span>&nbsp;<span class="ident" id="3021467">_</span>&nbsp;<span class="op" id="3021469">:=</span>&nbsp;<span class="ident" id="3021472">baseTypeName</span><span class="op" id="3021484">(</span><span class="ident" id="3021485">field</span><span class="op" id="3021490">.</span><span class="ident" id="3021491">Type</span><span class="op" id="3021495">)</span><span class="op" id="3021496">;</span>&nbsp;<span class="ident" id="3021498">fname</span>&nbsp;<span class="op" id="3021504">==</span>&nbsp;<span class="string" id="3021507">&#34;error&#34;</span>&nbsp;<span class="op" id="3021515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021521">keepField</span>&nbsp;<span class="op" id="3021531">=</span>&nbsp;<span class="builtintype" id="3021533">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021542">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021550">if</span>&nbsp;<span class="ident" id="3021553">keepField</span>&nbsp;<span class="op" id="3021563">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021568">list</span><span class="op" id="3021572">[</span><span class="ident" id="3021573">j</span><span class="op" id="3021574">]</span>&nbsp;<span class="op" id="3021576">=</span>&nbsp;<span class="ident" id="3021578">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021587">j</span><span class="op" id="3021588">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021593">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3021599">if</span>&nbsp;<span class="ident" id="3021602">j</span>&nbsp;<span class="op" id="3021604">&lt;</span>&nbsp;<span class="builtinfunc" id="3021606">len</span><span class="op" id="3021609">(</span><span class="ident" id="3021610">list</span><span class="op" id="3021614">)</span>&nbsp;<span class="op" id="3021616">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021620">ityp</span><span class="op" id="3021624">.</span><span class="ident" id="3021625">Incomplete</span>&nbsp;<span class="op" id="3021636">=</span>&nbsp;<span class="builtintype" id="3021638">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3021644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3021647">ityp</span><span class="op" id="3021651">.</span><span class="ident" id="3021652">Methods</span><span class="op" id="3021659">.</span><span class="ident" id="3021660">List</span>&nbsp;<span class="op" id="3021665">=</span>&nbsp;<span class="ident" id="3021667">list</span><span class="op" id="3021671">[</span><span class="num" id="3021672">0</span><span class="op" id="3021673">:</span><span class="ident" id="3021674">j</span><span class="op" id="3021675">]</span><br>
<span class="lineno"></span><span class="op" id="3021677">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="3021680">//&nbsp;filterFieldList&nbsp;removes&nbsp;unexported&nbsp;fields&nbsp;(field&nbsp;names)&nbsp;from&nbsp;the&nbsp;field&nbsp;list</span><br>
<span class="lineno"></span><span class="comment" id="3021759">//&nbsp;in&nbsp;place&nbsp;and&nbsp;returns&nbsp;true&nbsp;if&nbsp;fields&nbsp;were&nbsp;removed.&nbsp;Anonymous&nbsp;fields&nbsp;are</span><br>
<span class="lineno"></span><span class="comment" id="3021833">//&nbsp;recorded&nbsp;with&nbsp;the&nbsp;parent&nbsp;type.&nbsp;filterType&nbsp;is&nbsp;called&nbsp;with&nbsp;the&nbsp;types&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="3021906">//&nbsp;all&nbsp;remaining&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3021931">//</span><br>
<span class="lineno">60</span><span class="keyword" id="3021934">func</span>&nbsp;<span class="op" id="3021939">(</span><span class="ident" id="3021940">r</span>&nbsp;<span class="op" id="3021942">*</span><span class="ident" id="3021943">reader</span><span class="op" id="3021949">)</span>&nbsp;<span class="ident" id="3021951">filterFieldList</span><span class="op" id="3021966">(</span><span class="ident" id="3021967">parent</span>&nbsp;<span class="op" id="3021974">*</span><span class="ident" id="3021975">namedType</span><span class="op" id="3021984">,</span>&nbsp;<span class="ident" id="3021986">fields</span>&nbsp;<span class="op" id="3021993">*</span><span class="ident" id="3021994">ast</span><span class="op" id="3021997">.</span><span class="ident" id="3021998">FieldList</span><span class="op" id="3022007">,</span>&nbsp;<span class="ident" id="3022009">ityp</span>&nbsp;<span class="op" id="3022014">*</span><span class="ident" id="3022015">ast</span><span class="op" id="3022018">.</span><span class="ident" id="3022019">InterfaceType</span><span class="op" id="3022032">)</span>&nbsp;<span class="op" id="3022034">(</span><span class="ident" id="3022035">removedFields</span>&nbsp;<span class="builtintype" id="3022049">bool</span><span class="op" id="3022053">)</span>&nbsp;<span class="op" id="3022055">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022058">if</span>&nbsp;<span class="ident" id="3022061">fields</span>&nbsp;<span class="op" id="3022068">==</span>&nbsp;<span class="ident" id="3022071">nil</span>&nbsp;<span class="op" id="3022075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022079">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022090">list</span>&nbsp;<span class="op" id="3022095">:=</span>&nbsp;<span class="ident" id="3022098">fields</span><span class="op" id="3022104">.</span><span class="ident" id="3022105">List</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022111">j</span>&nbsp;<span class="op" id="3022113">:=</span>&nbsp;<span class="num" id="3022116">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022119">for</span>&nbsp;<span class="ident" id="3022123">_</span><span class="op" id="3022124">,</span>&nbsp;<span class="ident" id="3022126">field</span>&nbsp;<span class="op" id="3022132">:=</span>&nbsp;<span class="keyword" id="3022135">range</span>&nbsp;<span class="ident" id="3022141">list</span>&nbsp;<span class="op" id="3022146">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022150">keepField</span>&nbsp;<span class="op" id="3022160">:=</span>&nbsp;<span class="builtintype" id="3022163">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022171">if</span>&nbsp;<span class="ident" id="3022174">n</span>&nbsp;<span class="op" id="3022176">:=</span>&nbsp;<span class="builtinfunc" id="3022179">len</span><span class="op" id="3022182">(</span><span class="ident" id="3022183">field</span><span class="op" id="3022188">.</span><span class="ident" id="3022189">Names</span><span class="op" id="3022194">)</span><span class="op" id="3022195">;</span>&nbsp;<span class="ident" id="3022197">n</span>&nbsp;<span class="op" id="3022199">==</span>&nbsp;<span class="num" id="3022202">0</span>&nbsp;<span class="op" id="3022204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022209">//&nbsp;anonymous&nbsp;field</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022231">fname</span>&nbsp;<span class="op" id="3022237">:=</span>&nbsp;<span class="ident" id="3022240">r</span><span class="op" id="3022241">.</span><span class="ident" id="3022242">recordAnonymousField</span><span class="op" id="3022262">(</span><span class="ident" id="3022263">parent</span><span class="op" id="3022269">,</span>&nbsp;<span class="ident" id="3022271">field</span><span class="op" id="3022276">.</span><span class="ident" id="3022277">Type</span><span class="op" id="3022281">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022286">if</span>&nbsp;<span class="ident" id="3022289">ast</span><span class="op" id="3022292">.</span><span class="ident" id="3022293">IsExported</span><span class="op" id="3022303">(</span><span class="ident" id="3022304">fname</span><span class="op" id="3022309">)</span>&nbsp;<span class="op" id="3022311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022317">keepField</span>&nbsp;<span class="op" id="3022327">=</span>&nbsp;<span class="builtintype" id="3022329">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022337">}</span>&nbsp;<span class="keyword" id="3022339">else</span>&nbsp;<span class="keyword" id="3022344">if</span>&nbsp;<span class="ident" id="3022347">ityp</span>&nbsp;<span class="op" id="3022352">!=</span>&nbsp;<span class="ident" id="3022355">nil</span>&nbsp;<span class="op" id="3022359">&amp;&amp;</span>&nbsp;<span class="ident" id="3022362">fname</span>&nbsp;<span class="op" id="3022368">==</span>&nbsp;<span class="string" id="3022371">&#34;error&#34;</span>&nbsp;<span class="op" id="3022379">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022385">//&nbsp;possibly&nbsp;the&nbsp;predeclared&nbsp;error&nbsp;interface;&nbsp;keep</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022439">//&nbsp;it&nbsp;for&nbsp;now&nbsp;but&nbsp;remember&nbsp;this&nbsp;interface&nbsp;so&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3022493">//&nbsp;it&nbsp;can&nbsp;be&nbsp;fixed&nbsp;if&nbsp;error&nbsp;is&nbsp;also&nbsp;defined&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022549">keepField</span>&nbsp;<span class="op" id="3022559">=</span>&nbsp;<span class="builtintype" id="3022561">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022570">r</span><span class="op" id="3022571">.</span><span class="ident" id="3022572">remember</span><span class="op" id="3022580">(</span><span class="ident" id="3022581">ityp</span><span class="op" id="3022585">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022590">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022594">}</span>&nbsp;<span class="keyword" id="3022596">else</span>&nbsp;<span class="op" id="3022601">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022606">field</span><span class="op" id="3022611">.</span><span class="ident" id="3022612">Names</span>&nbsp;<span class="op" id="3022618">=</span>&nbsp;<span class="ident" id="3022620">filterIdentList</span><span class="op" id="3022635">(</span><span class="ident" id="3022636">field</span><span class="op" id="3022641">.</span><span class="ident" id="3022642">Names</span><span class="op" id="3022647">,</span>&nbsp;<span class="builtintype" id="3022649">false</span><span class="op" id="3022654">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022659">if</span>&nbsp;<span class="builtinfunc" id="3022662">len</span><span class="op" id="3022665">(</span><span class="ident" id="3022666">field</span><span class="op" id="3022671">.</span><span class="ident" id="3022672">Names</span><span class="op" id="3022677">)</span>&nbsp;<span class="op" id="3022679">&lt;</span>&nbsp;<span class="ident" id="3022681">n</span>&nbsp;<span class="op" id="3022683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022689">removedFields</span>&nbsp;<span class="op" id="3022703">=</span>&nbsp;<span class="builtintype" id="3022705">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022713">}</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022718">if</span>&nbsp;<span class="builtinfunc" id="3022721">len</span><span class="op" id="3022724">(</span><span class="ident" id="3022725">field</span><span class="op" id="3022730">.</span><span class="ident" id="3022731">Names</span><span class="op" id="3022736">)</span>&nbsp;<span class="op" id="3022738">&gt;</span>&nbsp;<span class="num" id="3022740">0</span>&nbsp;<span class="op" id="3022742">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022748">keepField</span>&nbsp;<span class="op" id="3022758">=</span>&nbsp;<span class="builtintype" id="3022760">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022768">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022772">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022776">if</span>&nbsp;<span class="ident" id="3022779">keepField</span>&nbsp;<span class="op" id="3022789">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022794">r</span><span class="op" id="3022795">.</span><span class="ident" id="3022796">filterType</span><span class="op" id="3022806">(</span><span class="ident" id="3022807">nil</span><span class="op" id="3022810">,</span>&nbsp;<span class="ident" id="3022812">field</span><span class="op" id="3022817">.</span><span class="ident" id="3022818">Type</span><span class="op" id="3022822">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022827">list</span><span class="op" id="3022831">[</span><span class="ident" id="3022832">j</span><span class="op" id="3022833">]</span>&nbsp;<span class="op" id="3022835">=</span>&nbsp;<span class="ident" id="3022837">field</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022846">j</span><span class="op" id="3022847">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022855">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022858">if</span>&nbsp;<span class="ident" id="3022861">j</span>&nbsp;<span class="op" id="3022863">&lt;</span>&nbsp;<span class="builtinfunc" id="3022865">len</span><span class="op" id="3022868">(</span><span class="ident" id="3022869">list</span><span class="op" id="3022873">)</span>&nbsp;<span class="op" id="3022875">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022879">removedFields</span>&nbsp;<span class="op" id="3022893">=</span>&nbsp;<span class="builtintype" id="3022895">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3022901">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3022904">fields</span><span class="op" id="3022910">.</span><span class="ident" id="3022911">List</span>&nbsp;<span class="op" id="3022916">=</span>&nbsp;<span class="ident" id="3022918">list</span><span class="op" id="3022922">[</span><span class="num" id="3022923">0</span><span class="op" id="3022924">:</span><span class="ident" id="3022925">j</span><span class="op" id="3022926">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3022929">return</span><br>
<span class="lineno">100</span><span class="op" id="3022936">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3022939">//&nbsp;filterParamList&nbsp;applies&nbsp;filterType&nbsp;to&nbsp;each&nbsp;parameter&nbsp;type&nbsp;in&nbsp;fields.</span><br>
<span class="lineno"></span><span class="comment" id="3023011">//</span><br>
<span class="lineno"></span><span class="keyword" id="3023014">func</span>&nbsp;<span class="op" id="3023019">(</span><span class="ident" id="3023020">r</span>&nbsp;<span class="op" id="3023022">*</span><span class="ident" id="3023023">reader</span><span class="op" id="3023029">)</span>&nbsp;<span class="ident" id="3023031">filterParamList</span><span class="op" id="3023046">(</span><span class="ident" id="3023047">fields</span>&nbsp;<span class="op" id="3023054">*</span><span class="ident" id="3023055">ast</span><span class="op" id="3023058">.</span><span class="ident" id="3023059">FieldList</span><span class="op" id="3023068">)</span>&nbsp;<span class="op" id="3023070">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023073">if</span>&nbsp;<span class="ident" id="3023076">fields</span>&nbsp;<span class="op" id="3023083">!=</span>&nbsp;<span class="ident" id="3023086">nil</span>&nbsp;<span class="op" id="3023090">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023094">for</span>&nbsp;<span class="ident" id="3023098">_</span><span class="op" id="3023099">,</span>&nbsp;<span class="ident" id="3023101">f</span>&nbsp;<span class="op" id="3023103">:=</span>&nbsp;<span class="keyword" id="3023106">range</span>&nbsp;<span class="ident" id="3023112">fields</span><span class="op" id="3023118">.</span><span class="ident" id="3023119">List</span>&nbsp;<span class="op" id="3023124">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023129">r</span><span class="op" id="3023130">.</span><span class="ident" id="3023131">filterType</span><span class="op" id="3023141">(</span><span class="ident" id="3023142">nil</span><span class="op" id="3023145">,</span>&nbsp;<span class="ident" id="3023147">f</span><span class="op" id="3023148">.</span><span class="ident" id="3023149">Type</span><span class="op" id="3023153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023157">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023160">}</span><br>
<span class="lineno">110</span><span class="op" id="3023162">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3023165">//&nbsp;filterType&nbsp;strips&nbsp;any&nbsp;unexported&nbsp;struct&nbsp;fields&nbsp;or&nbsp;method&nbsp;types&nbsp;from&nbsp;typ</span><br>
<span class="lineno"></span><span class="comment" id="3023240">//&nbsp;in&nbsp;place.&nbsp;If&nbsp;fields&nbsp;(or&nbsp;methods)&nbsp;have&nbsp;been&nbsp;removed,&nbsp;the&nbsp;corresponding</span><br>
<span class="lineno"></span><span class="comment" id="3023313">//&nbsp;struct&nbsp;or&nbsp;interface&nbsp;type&nbsp;has&nbsp;the&nbsp;Incomplete&nbsp;field&nbsp;set&nbsp;to&nbsp;true.</span><br>
<span class="lineno">115</span><span class="comment" id="3023379">//</span><br>
<span class="lineno"></span><span class="keyword" id="3023382">func</span>&nbsp;<span class="op" id="3023387">(</span><span class="ident" id="3023388">r</span>&nbsp;<span class="op" id="3023390">*</span><span class="ident" id="3023391">reader</span><span class="op" id="3023397">)</span>&nbsp;<span class="ident" id="3023399">filterType</span><span class="op" id="3023409">(</span><span class="ident" id="3023410">parent</span>&nbsp;<span class="op" id="3023417">*</span><span class="ident" id="3023418">namedType</span><span class="op" id="3023427">,</span>&nbsp;<span class="ident" id="3023429">typ</span>&nbsp;<span class="ident" id="3023433">ast</span><span class="op" id="3023436">.</span><span class="ident" id="3023437">Expr</span><span class="op" id="3023441">)</span>&nbsp;<span class="op" id="3023443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023446">switch</span>&nbsp;<span class="ident" id="3023453">t</span>&nbsp;<span class="op" id="3023455">:=</span>&nbsp;<span class="ident" id="3023458">typ</span><span class="op" id="3023461">.</span><span class="op" id="3023462">(</span><span class="keyword" id="3023463">type</span><span class="op" id="3023467">)</span>&nbsp;<span class="op" id="3023469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023472">case</span>&nbsp;<span class="op" id="3023477">*</span><span class="ident" id="3023478">ast</span><span class="op" id="3023481">.</span><span class="ident" id="3023482">Ident</span><span class="op" id="3023487">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3023491">//&nbsp;nothing&nbsp;to&nbsp;do</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023509">case</span>&nbsp;<span class="op" id="3023514">*</span><span class="ident" id="3023515">ast</span><span class="op" id="3023518">.</span><span class="ident" id="3023519">ParenExpr</span><span class="op" id="3023528">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023532">r</span><span class="op" id="3023533">.</span><span class="ident" id="3023534">filterType</span><span class="op" id="3023544">(</span><span class="ident" id="3023545">nil</span><span class="op" id="3023548">,</span>&nbsp;<span class="ident" id="3023550">t</span><span class="op" id="3023551">.</span><span class="ident" id="3023552">X</span><span class="op" id="3023553">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023556">case</span>&nbsp;<span class="op" id="3023561">*</span><span class="ident" id="3023562">ast</span><span class="op" id="3023565">.</span><span class="ident" id="3023566">ArrayType</span><span class="op" id="3023575">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023579">r</span><span class="op" id="3023580">.</span><span class="ident" id="3023581">filterType</span><span class="op" id="3023591">(</span><span class="ident" id="3023592">nil</span><span class="op" id="3023595">,</span>&nbsp;<span class="ident" id="3023597">t</span><span class="op" id="3023598">.</span><span class="ident" id="3023599">Elt</span><span class="op" id="3023602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023605">case</span>&nbsp;<span class="op" id="3023610">*</span><span class="ident" id="3023611">ast</span><span class="op" id="3023614">.</span><span class="ident" id="3023615">StructType</span><span class="op" id="3023625">:</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023629">if</span>&nbsp;<span class="ident" id="3023632">r</span><span class="op" id="3023633">.</span><span class="ident" id="3023634">filterFieldList</span><span class="op" id="3023649">(</span><span class="ident" id="3023650">parent</span><span class="op" id="3023656">,</span>&nbsp;<span class="ident" id="3023658">t</span><span class="op" id="3023659">.</span><span class="ident" id="3023660">Fields</span><span class="op" id="3023666">,</span>&nbsp;<span class="ident" id="3023668">nil</span><span class="op" id="3023671">)</span>&nbsp;<span class="op" id="3023673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023678">t</span><span class="op" id="3023679">.</span><span class="ident" id="3023680">Incomplete</span>&nbsp;<span class="op" id="3023691">=</span>&nbsp;<span class="builtintype" id="3023693">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023700">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023703">case</span>&nbsp;<span class="op" id="3023708">*</span><span class="ident" id="3023709">ast</span><span class="op" id="3023712">.</span><span class="ident" id="3023713">FuncType</span><span class="op" id="3023721">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023725">r</span><span class="op" id="3023726">.</span><span class="ident" id="3023727">filterParamList</span><span class="op" id="3023742">(</span><span class="ident" id="3023743">t</span><span class="op" id="3023744">.</span><span class="ident" id="3023745">Params</span><span class="op" id="3023751">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023755">r</span><span class="op" id="3023756">.</span><span class="ident" id="3023757">filterParamList</span><span class="op" id="3023772">(</span><span class="ident" id="3023773">t</span><span class="op" id="3023774">.</span><span class="ident" id="3023775">Results</span><span class="op" id="3023782">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023785">case</span>&nbsp;<span class="op" id="3023790">*</span><span class="ident" id="3023791">ast</span><span class="op" id="3023794">.</span><span class="ident" id="3023795">InterfaceType</span><span class="op" id="3023808">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023812">if</span>&nbsp;<span class="ident" id="3023815">r</span><span class="op" id="3023816">.</span><span class="ident" id="3023817">filterFieldList</span><span class="op" id="3023832">(</span><span class="ident" id="3023833">parent</span><span class="op" id="3023839">,</span>&nbsp;<span class="ident" id="3023841">t</span><span class="op" id="3023842">.</span><span class="ident" id="3023843">Methods</span><span class="op" id="3023850">,</span>&nbsp;<span class="ident" id="3023852">t</span><span class="op" id="3023853">)</span>&nbsp;<span class="op" id="3023855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023860">t</span><span class="op" id="3023861">.</span><span class="ident" id="3023862">Incomplete</span>&nbsp;<span class="op" id="3023873">=</span>&nbsp;<span class="builtintype" id="3023875">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3023882">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023885">case</span>&nbsp;<span class="op" id="3023890">*</span><span class="ident" id="3023891">ast</span><span class="op" id="3023894">.</span><span class="ident" id="3023895">MapType</span><span class="op" id="3023902">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023906">r</span><span class="op" id="3023907">.</span><span class="ident" id="3023908">filterType</span><span class="op" id="3023918">(</span><span class="ident" id="3023919">nil</span><span class="op" id="3023922">,</span>&nbsp;<span class="ident" id="3023924">t</span><span class="op" id="3023925">.</span><span class="ident" id="3023926">Key</span><span class="op" id="3023929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023933">r</span><span class="op" id="3023934">.</span><span class="ident" id="3023935">filterType</span><span class="op" id="3023945">(</span><span class="ident" id="3023946">nil</span><span class="op" id="3023949">,</span>&nbsp;<span class="ident" id="3023951">t</span><span class="op" id="3023952">.</span><span class="ident" id="3023953">Value</span><span class="op" id="3023958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3023961">case</span>&nbsp;<span class="op" id="3023966">*</span><span class="ident" id="3023967">ast</span><span class="op" id="3023970">.</span><span class="ident" id="3023971">ChanType</span><span class="op" id="3023979">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3023983">r</span><span class="op" id="3023984">.</span><span class="ident" id="3023985">filterType</span><span class="op" id="3023995">(</span><span class="ident" id="3023996">nil</span><span class="op" id="3023999">,</span>&nbsp;<span class="ident" id="3024001">t</span><span class="op" id="3024002">.</span><span class="ident" id="3024003">Value</span><span class="op" id="3024008">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024011">}</span><br>
<span class="lineno"></span><span class="op" id="3024013">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3024016">func</span>&nbsp;<span class="op" id="3024021">(</span><span class="ident" id="3024022">r</span>&nbsp;<span class="op" id="3024024">*</span><span class="ident" id="3024025">reader</span><span class="op" id="3024031">)</span>&nbsp;<span class="ident" id="3024033">filterSpec</span><span class="op" id="3024043">(</span><span class="ident" id="3024044">spec</span>&nbsp;<span class="ident" id="3024049">ast</span><span class="op" id="3024052">.</span><span class="ident" id="3024053">Spec</span><span class="op" id="3024057">,</span>&nbsp;<span class="ident" id="3024059">tok</span>&nbsp;<span class="ident" id="3024063">token</span><span class="op" id="3024068">.</span><span class="ident" id="3024069">Token</span><span class="op" id="3024074">)</span>&nbsp;<span class="builtintype" id="3024076">bool</span>&nbsp;<span class="op" id="3024081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024084">switch</span>&nbsp;<span class="ident" id="3024091">s</span>&nbsp;<span class="op" id="3024093">:=</span>&nbsp;<span class="ident" id="3024096">spec</span><span class="op" id="3024100">.</span><span class="op" id="3024101">(</span><span class="keyword" id="3024102">type</span><span class="op" id="3024106">)</span>&nbsp;<span class="op" id="3024108">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024111">case</span>&nbsp;<span class="op" id="3024116">*</span><span class="ident" id="3024117">ast</span><span class="op" id="3024120">.</span><span class="ident" id="3024121">ImportSpec</span><span class="op" id="3024131">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024135">//&nbsp;always&nbsp;keep&nbsp;imports&nbsp;so&nbsp;we&nbsp;can&nbsp;collect&nbsp;them</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024183">return</span>&nbsp;<span class="builtintype" id="3024190">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024196">case</span>&nbsp;<span class="op" id="3024201">*</span><span class="ident" id="3024202">ast</span><span class="op" id="3024205">.</span><span class="ident" id="3024206">ValueSpec</span><span class="op" id="3024215">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024219">//&nbsp;special&nbsp;case:&nbsp;consider&nbsp;blank&nbsp;constants&nbsp;as&nbsp;exported</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024275">//&nbsp;(work-around&nbsp;for&nbsp;issue&nbsp;5397)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024309">s</span><span class="op" id="3024310">.</span><span class="ident" id="3024311">Names</span>&nbsp;<span class="op" id="3024317">=</span>&nbsp;<span class="ident" id="3024319">filterIdentList</span><span class="op" id="3024334">(</span><span class="ident" id="3024335">s</span><span class="op" id="3024336">.</span><span class="ident" id="3024337">Names</span><span class="op" id="3024342">,</span>&nbsp;<span class="ident" id="3024344">tok</span>&nbsp;<span class="op" id="3024348">==</span>&nbsp;<span class="ident" id="3024351">token</span><span class="op" id="3024356">.</span><span class="ident" id="3024357">CONST</span><span class="op" id="3024362">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024366">if</span>&nbsp;<span class="builtinfunc" id="3024369">len</span><span class="op" id="3024372">(</span><span class="ident" id="3024373">s</span><span class="op" id="3024374">.</span><span class="ident" id="3024375">Names</span><span class="op" id="3024380">)</span>&nbsp;<span class="op" id="3024382">&gt;</span>&nbsp;<span class="num" id="3024384">0</span>&nbsp;<span class="op" id="3024386">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024391">r</span><span class="op" id="3024392">.</span><span class="ident" id="3024393">filterType</span><span class="op" id="3024403">(</span><span class="ident" id="3024404">nil</span><span class="op" id="3024407">,</span>&nbsp;<span class="ident" id="3024409">s</span><span class="op" id="3024410">.</span><span class="ident" id="3024411">Type</span><span class="op" id="3024415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024420">return</span>&nbsp;<span class="builtintype" id="3024427">true</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024437">case</span>&nbsp;<span class="op" id="3024442">*</span><span class="ident" id="3024443">ast</span><span class="op" id="3024446">.</span><span class="ident" id="3024447">TypeSpec</span><span class="op" id="3024455">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024459">if</span>&nbsp;<span class="ident" id="3024462">name</span>&nbsp;<span class="op" id="3024467">:=</span>&nbsp;<span class="ident" id="3024470">s</span><span class="op" id="3024471">.</span><span class="ident" id="3024472">Name</span><span class="op" id="3024476">.</span><span class="ident" id="3024477">Name</span><span class="op" id="3024481">;</span>&nbsp;<span class="ident" id="3024483">ast</span><span class="op" id="3024486">.</span><span class="ident" id="3024487">IsExported</span><span class="op" id="3024497">(</span><span class="ident" id="3024498">name</span><span class="op" id="3024502">)</span>&nbsp;<span class="op" id="3024504">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024509">r</span><span class="op" id="3024510">.</span><span class="ident" id="3024511">filterType</span><span class="op" id="3024521">(</span><span class="ident" id="3024522">r</span><span class="op" id="3024523">.</span><span class="ident" id="3024524">lookupType</span><span class="op" id="3024534">(</span><span class="ident" id="3024535">s</span><span class="op" id="3024536">.</span><span class="ident" id="3024537">Name</span><span class="op" id="3024541">.</span><span class="ident" id="3024542">Name</span><span class="op" id="3024546">)</span><span class="op" id="3024547">,</span>&nbsp;<span class="ident" id="3024549">s</span><span class="op" id="3024550">.</span><span class="ident" id="3024551">Type</span><span class="op" id="3024555">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024560">return</span>&nbsp;<span class="builtintype" id="3024567">true</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024574">}</span>&nbsp;<span class="keyword" id="3024576">else</span>&nbsp;<span class="keyword" id="3024581">if</span>&nbsp;<span class="ident" id="3024584">name</span>&nbsp;<span class="op" id="3024589">==</span>&nbsp;<span class="string" id="3024592">&#34;error&#34;</span>&nbsp;<span class="op" id="3024600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3024605">//&nbsp;special&nbsp;case:&nbsp;remember&nbsp;that&nbsp;error&nbsp;is&nbsp;declared&nbsp;locally</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024665">r</span><span class="op" id="3024666">.</span><span class="ident" id="3024667">errorDecl</span>&nbsp;<span class="op" id="3024677">=</span>&nbsp;<span class="builtintype" id="3024679">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024689">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024692">return</span>&nbsp;<span class="builtintype" id="3024699">false</span><br>
<span class="lineno"></span><span class="op" id="3024705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3024708">func</span>&nbsp;<span class="op" id="3024713">(</span><span class="ident" id="3024714">r</span>&nbsp;<span class="op" id="3024716">*</span><span class="ident" id="3024717">reader</span><span class="op" id="3024723">)</span>&nbsp;<span class="ident" id="3024725">filterSpecList</span><span class="op" id="3024739">(</span><span class="ident" id="3024740">list</span>&nbsp;<span class="op" id="3024745">[</span><span class="op" id="3024746">]</span><span class="ident" id="3024747">ast</span><span class="op" id="3024750">.</span><span class="ident" id="3024751">Spec</span><span class="op" id="3024755">,</span>&nbsp;<span class="ident" id="3024757">tok</span>&nbsp;<span class="ident" id="3024761">token</span><span class="op" id="3024766">.</span><span class="ident" id="3024767">Token</span><span class="op" id="3024772">)</span>&nbsp;<span class="op" id="3024774">[</span><span class="op" id="3024775">]</span><span class="ident" id="3024776">ast</span><span class="op" id="3024779">.</span><span class="ident" id="3024780">Spec</span>&nbsp;<span class="op" id="3024785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024788">j</span>&nbsp;<span class="op" id="3024790">:=</span>&nbsp;<span class="num" id="3024793">0</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024796">for</span>&nbsp;<span class="ident" id="3024800">_</span><span class="op" id="3024801">,</span>&nbsp;<span class="ident" id="3024803">s</span>&nbsp;<span class="op" id="3024805">:=</span>&nbsp;<span class="keyword" id="3024808">range</span>&nbsp;<span class="ident" id="3024814">list</span>&nbsp;<span class="op" id="3024819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024823">if</span>&nbsp;<span class="ident" id="3024826">r</span><span class="op" id="3024827">.</span><span class="ident" id="3024828">filterSpec</span><span class="op" id="3024838">(</span><span class="ident" id="3024839">s</span><span class="op" id="3024840">,</span>&nbsp;<span class="ident" id="3024842">tok</span><span class="op" id="3024845">)</span>&nbsp;<span class="op" id="3024847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024852">list</span><span class="op" id="3024856">[</span><span class="ident" id="3024857">j</span><span class="op" id="3024858">]</span>&nbsp;<span class="op" id="3024860">=</span>&nbsp;<span class="ident" id="3024862">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024867">j</span><span class="op" id="3024868">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024873">}</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3024876">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024879">return</span>&nbsp;<span class="ident" id="3024886">list</span><span class="op" id="3024890">[</span><span class="num" id="3024891">0</span><span class="op" id="3024892">:</span><span class="ident" id="3024893">j</span><span class="op" id="3024894">]</span><br>
<span class="lineno"></span><span class="op" id="3024896">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="3024899">func</span>&nbsp;<span class="op" id="3024904">(</span><span class="ident" id="3024905">r</span>&nbsp;<span class="op" id="3024907">*</span><span class="ident" id="3024908">reader</span><span class="op" id="3024914">)</span>&nbsp;<span class="ident" id="3024916">filterDecl</span><span class="op" id="3024926">(</span><span class="ident" id="3024927">decl</span>&nbsp;<span class="ident" id="3024932">ast</span><span class="op" id="3024935">.</span><span class="ident" id="3024936">Decl</span><span class="op" id="3024940">)</span>&nbsp;<span class="builtintype" id="3024942">bool</span>&nbsp;<span class="op" id="3024947">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024950">switch</span>&nbsp;<span class="ident" id="3024957">d</span>&nbsp;<span class="op" id="3024959">:=</span>&nbsp;<span class="ident" id="3024962">decl</span><span class="op" id="3024966">.</span><span class="op" id="3024967">(</span><span class="keyword" id="3024968">type</span><span class="op" id="3024972">)</span>&nbsp;<span class="op" id="3024974">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3024977">case</span>&nbsp;<span class="op" id="3024982">*</span><span class="ident" id="3024983">ast</span><span class="op" id="3024986">.</span><span class="ident" id="3024987">GenDecl</span><span class="op" id="3024994">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3024998">d</span><span class="op" id="3024999">.</span><span class="ident" id="3025000">Specs</span>&nbsp;<span class="op" id="3025006">=</span>&nbsp;<span class="ident" id="3025008">r</span><span class="op" id="3025009">.</span><span class="ident" id="3025010">filterSpecList</span><span class="op" id="3025024">(</span><span class="ident" id="3025025">d</span><span class="op" id="3025026">.</span><span class="ident" id="3025027">Specs</span><span class="op" id="3025032">,</span>&nbsp;<span class="ident" id="3025034">d</span><span class="op" id="3025035">.</span><span class="ident" id="3025036">Tok</span><span class="op" id="3025039">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025043">return</span>&nbsp;<span class="builtinfunc" id="3025050">len</span><span class="op" id="3025053">(</span><span class="ident" id="3025054">d</span><span class="op" id="3025055">.</span><span class="ident" id="3025056">Specs</span><span class="op" id="3025061">)</span>&nbsp;<span class="op" id="3025063">&gt;</span>&nbsp;<span class="num" id="3025065">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025068">case</span>&nbsp;<span class="op" id="3025073">*</span><span class="ident" id="3025074">ast</span><span class="op" id="3025077">.</span><span class="ident" id="3025078">FuncDecl</span><span class="op" id="3025086">:</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025090">//&nbsp;ok&nbsp;to&nbsp;filter&nbsp;these&nbsp;methods&nbsp;early&nbsp;because&nbsp;any</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025140">//&nbsp;conflicting&nbsp;method&nbsp;will&nbsp;be&nbsp;filtered&nbsp;here,&nbsp;too&nbsp;-</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025193">//&nbsp;thus,&nbsp;removing&nbsp;these&nbsp;methods&nbsp;early&nbsp;will&nbsp;not&nbsp;lead</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="3025247">//&nbsp;to&nbsp;the&nbsp;false&nbsp;removal&nbsp;of&nbsp;possible&nbsp;conflicts</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025295">return</span>&nbsp;<span class="ident" id="3025302">ast</span><span class="op" id="3025305">.</span><span class="ident" id="3025306">IsExported</span><span class="op" id="3025316">(</span><span class="ident" id="3025317">d</span><span class="op" id="3025318">.</span><span class="ident" id="3025319">Name</span><span class="op" id="3025323">.</span><span class="ident" id="3025324">Name</span><span class="op" id="3025328">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025334">return</span>&nbsp;<span class="builtintype" id="3025341">false</span><br>
<span class="lineno"></span><span class="op" id="3025347">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="3025350">//&nbsp;fileExports&nbsp;removes&nbsp;unexported&nbsp;declarations&nbsp;from&nbsp;src&nbsp;in&nbsp;place.</span><br>
<span class="lineno">195</span><span class="comment" id="3025416">//</span><br>
<span class="lineno"></span><span class="keyword" id="3025419">func</span>&nbsp;<span class="op" id="3025424">(</span><span class="ident" id="3025425">r</span>&nbsp;<span class="op" id="3025427">*</span><span class="ident" id="3025428">reader</span><span class="op" id="3025434">)</span>&nbsp;<span class="ident" id="3025436">fileExports</span><span class="op" id="3025447">(</span><span class="ident" id="3025448">src</span>&nbsp;<span class="op" id="3025452">*</span><span class="ident" id="3025453">ast</span><span class="op" id="3025456">.</span><span class="ident" id="3025457">File</span><span class="op" id="3025461">)</span>&nbsp;<span class="op" id="3025463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025466">j</span>&nbsp;<span class="op" id="3025468">:=</span>&nbsp;<span class="num" id="3025471">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025474">for</span>&nbsp;<span class="ident" id="3025478">_</span><span class="op" id="3025479">,</span>&nbsp;<span class="ident" id="3025481">d</span>&nbsp;<span class="op" id="3025483">:=</span>&nbsp;<span class="keyword" id="3025486">range</span>&nbsp;<span class="ident" id="3025492">src</span><span class="op" id="3025495">.</span><span class="ident" id="3025496">Decls</span>&nbsp;<span class="op" id="3025502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="3025506">if</span>&nbsp;<span class="ident" id="3025509">r</span><span class="op" id="3025510">.</span><span class="ident" id="3025511">filterDecl</span><span class="op" id="3025521">(</span><span class="ident" id="3025522">d</span><span class="op" id="3025523">)</span>&nbsp;<span class="op" id="3025525">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025530">src</span><span class="op" id="3025533">.</span><span class="ident" id="3025534">Decls</span><span class="op" id="3025539">[</span><span class="ident" id="3025540">j</span><span class="op" id="3025541">]</span>&nbsp;<span class="op" id="3025543">=</span>&nbsp;<span class="ident" id="3025545">d</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025550">j</span><span class="op" id="3025551">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025556">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="3025559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="3025562">src</span><span class="op" id="3025565">.</span><span class="ident" id="3025566">Decls</span>&nbsp;<span class="op" id="3025572">=</span>&nbsp;<span class="ident" id="3025574">src</span><span class="op" id="3025577">.</span><span class="ident" id="3025578">Decls</span><span class="op" id="3025583">[</span><span class="num" id="3025584">0</span><span class="op" id="3025585">:</span><span class="ident" id="3025586">j</span><span class="op" id="3025587">]</span><br>
<span class="lineno">205</span><span class="op" id="3025589">}</span>
</div>
</body>
</html>
