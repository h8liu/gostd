<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>syscall</h2>
<ul>
<li><a href="/gostd/syscall/creds_test.go.html">creds_test.go</a></li>
<li><a href="/gostd/syscall/env_unix.go.html">env_unix.go</a></li>
<li><a href="/gostd/syscall/exec_linux.go.html">exec_linux.go</a></li>
<li><a href="/gostd/syscall/exec_unix.go.html">exec_unix.go</a></li>
<li><a href="/gostd/syscall/export_test.go.html">export_test.go</a></li>
<li><a href="/gostd/syscall/flock.go.html">flock.go</a></li>
<li><a href="/gostd/syscall/lsf_linux.go.html">lsf_linux.go</a></li>
<li><a href="/gostd/syscall/mmap_unix_test.go.html">mmap_unix_test.go</a></li>
<li><a href="/gostd/syscall/netlink_linux.go.html">netlink_linux.go</a></li>
<li><a href="/gostd/syscall/race0.go.html">race0.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_linux.go.html">sockcmsg_linux.go</a></li>
<li><a href="/gostd/syscall/sockcmsg_unix.go.html">sockcmsg_unix.go</a></li>
<li><a href="/gostd/syscall/str.go.html">str.go</a></li>
<li><a href="/gostd/syscall/syscall.go.html">syscall.go</a></li>
<li><a href="/gostd/syscall/syscall_linux.go.html">syscall_linux.go</a></li>
<li><a href="/gostd/syscall/syscall_linux_amd64.go.html">syscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/syscall_test.go.html">syscall_test.go</a></li>
<li><a href="/gostd/syscall/syscall_unix.go.html">syscall_unix.go</a></li>
<li><a href="/gostd/syscall/syscall_unix_test.go.html">syscall_unix_test.go</a></li>
<li><a href="/gostd/syscall/zerrors_linux_amd64.go.html">zerrors_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsyscall_linux_amd64.go.html">zsyscall_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/zsysnum_linux_amd64.go.html">zsysnum_linux_amd64.go</a></li>
<li><a href="/gostd/syscall/ztypes_linux_amd64.go.html">ztypes_linux_amd64.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2520677">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2520733">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2520787">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="2520838">//&nbsp;Netlink&nbsp;sockets&nbsp;and&nbsp;messages</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2520871">package</span>&nbsp;<span class="ident" id="2520879">syscall</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2520888">import</span>&nbsp;<span class="string" id="2520895">&#34;unsafe&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="2520905">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;message&nbsp;up&nbsp;to&nbsp;align&nbsp;it&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2520971">func</span>&nbsp;<span class="ident" id="2520976">nlmAlignOf</span><span class="op" id="2520986">(</span><span class="ident" id="2520987">msglen</span>&nbsp;<span class="builtintype" id="2520994">int</span><span class="op" id="2520997">)</span>&nbsp;<span class="builtintype" id="2520999">int</span>&nbsp;<span class="op" id="2521003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521006">return</span>&nbsp;<span class="op" id="2521013">(</span><span class="ident" id="2521014">msglen</span>&nbsp;<span class="op" id="2521021">+</span>&nbsp;<span class="ident" id="2521023">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2521037">-</span>&nbsp;<span class="num" id="2521039">1</span><span class="op" id="2521040">)</span>&nbsp;<span class="op" id="2521042">&amp;</span>&nbsp;<span class="op" id="2521044">^</span><span class="op" id="2521045">(</span><span class="ident" id="2521046">NLMSG_ALIGNTO</span>&nbsp;<span class="op" id="2521060">-</span>&nbsp;<span class="num" id="2521062">1</span><span class="op" id="2521063">)</span><br>
<span class="lineno"></span><span class="op" id="2521065">}</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="2521068">//&nbsp;Round&nbsp;the&nbsp;length&nbsp;of&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute&nbsp;up&nbsp;to&nbsp;align&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="2521132">//&nbsp;properly.</span><br>
<span class="lineno"></span><span class="keyword" id="2521145">func</span>&nbsp;<span class="ident" id="2521150">rtaAlignOf</span><span class="op" id="2521160">(</span><span class="ident" id="2521161">attrlen</span>&nbsp;<span class="builtintype" id="2521169">int</span><span class="op" id="2521172">)</span>&nbsp;<span class="builtintype" id="2521174">int</span>&nbsp;<span class="op" id="2521178">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521181">return</span>&nbsp;<span class="op" id="2521188">(</span><span class="ident" id="2521189">attrlen</span>&nbsp;<span class="op" id="2521197">+</span>&nbsp;<span class="ident" id="2521199">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2521211">-</span>&nbsp;<span class="num" id="2521213">1</span><span class="op" id="2521214">)</span>&nbsp;<span class="op" id="2521216">&amp;</span>&nbsp;<span class="op" id="2521218">^</span><span class="op" id="2521219">(</span><span class="ident" id="2521220">RTA_ALIGNTO</span>&nbsp;<span class="op" id="2521232">-</span>&nbsp;<span class="num" id="2521234">1</span><span class="op" id="2521235">)</span><br>
<span class="lineno">20</span><span class="op" id="2521237">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2521240">//&nbsp;NetlinkRouteRequest&nbsp;represents&nbsp;a&nbsp;request&nbsp;message&nbsp;to&nbsp;receive&nbsp;routing</span><br>
<span class="lineno"></span><span class="comment" id="2521311">//&nbsp;and&nbsp;link&nbsp;states&nbsp;from&nbsp;the&nbsp;kernel.</span><br>
<span class="lineno"></span><span class="keyword" id="2521347">type</span>&nbsp;<span class="ident" id="2521352">NetlinkRouteRequest</span>&nbsp;<span class="keyword" id="2521372">struct</span>&nbsp;<span class="op" id="2521379">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521382">Header</span>&nbsp;<span class="ident" id="2521389">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521399">Data</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="2521406">RtGenmsg</span><br>
<span class="lineno"></span><span class="op" id="2521415">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2521418">func</span>&nbsp;<span class="op" id="2521423">(</span><span class="ident" id="2521424">rr</span>&nbsp;<span class="op" id="2521427">*</span><span class="ident" id="2521428">NetlinkRouteRequest</span><span class="op" id="2521447">)</span>&nbsp;<span class="ident" id="2521449">toWireFormat</span><span class="op" id="2521461">(</span><span class="op" id="2521462">)</span>&nbsp;<span class="op" id="2521464">[</span><span class="op" id="2521465">]</span><span class="builtintype" id="2521466">byte</span>&nbsp;<span class="op" id="2521471">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521474">b</span>&nbsp;<span class="op" id="2521476">:=</span>&nbsp;<span class="builtinfunc" id="2521479">make</span><span class="op" id="2521483">(</span><span class="op" id="2521484">[</span><span class="op" id="2521485">]</span><span class="builtintype" id="2521486">byte</span><span class="op" id="2521490">,</span>&nbsp;<span class="ident" id="2521492">rr</span><span class="op" id="2521494">.</span><span class="ident" id="2521495">Header</span><span class="op" id="2521501">.</span><span class="ident" id="2521502">Len</span><span class="op" id="2521505">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2521508">*</span><span class="op" id="2521509">(</span><span class="op" id="2521510">*</span><span class="builtintype" id="2521511">uint32</span><span class="op" id="2521517">)</span><span class="op" id="2521518">(</span><span class="ident" id="2521519">unsafe</span><span class="op" id="2521525">.</span><span class="ident" id="2521526">Pointer</span><span class="op" id="2521533">(</span><span class="op" id="2521534">&amp;</span><span class="ident" id="2521535">b</span><span class="op" id="2521536">[</span><span class="num" id="2521537">0</span><span class="op" id="2521538">:</span><span class="num" id="2521539">4</span><span class="op" id="2521540">]</span><span class="op" id="2521541">[</span><span class="num" id="2521542">0</span><span class="op" id="2521543">]</span><span class="op" id="2521544">)</span><span class="op" id="2521545">)</span>&nbsp;<span class="op" id="2521547">=</span>&nbsp;<span class="ident" id="2521549">rr</span><span class="op" id="2521551">.</span><span class="ident" id="2521552">Header</span><span class="op" id="2521558">.</span><span class="ident" id="2521559">Len</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2521564">*</span><span class="op" id="2521565">(</span><span class="op" id="2521566">*</span><span class="builtintype" id="2521567">uint16</span><span class="op" id="2521573">)</span><span class="op" id="2521574">(</span><span class="ident" id="2521575">unsafe</span><span class="op" id="2521581">.</span><span class="ident" id="2521582">Pointer</span><span class="op" id="2521589">(</span><span class="op" id="2521590">&amp;</span><span class="ident" id="2521591">b</span><span class="op" id="2521592">[</span><span class="num" id="2521593">4</span><span class="op" id="2521594">:</span><span class="num" id="2521595">6</span><span class="op" id="2521596">]</span><span class="op" id="2521597">[</span><span class="num" id="2521598">0</span><span class="op" id="2521599">]</span><span class="op" id="2521600">)</span><span class="op" id="2521601">)</span>&nbsp;<span class="op" id="2521603">=</span>&nbsp;<span class="ident" id="2521605">rr</span><span class="op" id="2521607">.</span><span class="ident" id="2521608">Header</span><span class="op" id="2521614">.</span><span class="ident" id="2521615">Type</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2521621">*</span><span class="op" id="2521622">(</span><span class="op" id="2521623">*</span><span class="builtintype" id="2521624">uint16</span><span class="op" id="2521630">)</span><span class="op" id="2521631">(</span><span class="ident" id="2521632">unsafe</span><span class="op" id="2521638">.</span><span class="ident" id="2521639">Pointer</span><span class="op" id="2521646">(</span><span class="op" id="2521647">&amp;</span><span class="ident" id="2521648">b</span><span class="op" id="2521649">[</span><span class="num" id="2521650">6</span><span class="op" id="2521651">:</span><span class="num" id="2521652">8</span><span class="op" id="2521653">]</span><span class="op" id="2521654">[</span><span class="num" id="2521655">0</span><span class="op" id="2521656">]</span><span class="op" id="2521657">)</span><span class="op" id="2521658">)</span>&nbsp;<span class="op" id="2521660">=</span>&nbsp;<span class="ident" id="2521662">rr</span><span class="op" id="2521664">.</span><span class="ident" id="2521665">Header</span><span class="op" id="2521671">.</span><span class="ident" id="2521672">Flags</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2521679">*</span><span class="op" id="2521680">(</span><span class="op" id="2521681">*</span><span class="builtintype" id="2521682">uint32</span><span class="op" id="2521688">)</span><span class="op" id="2521689">(</span><span class="ident" id="2521690">unsafe</span><span class="op" id="2521696">.</span><span class="ident" id="2521697">Pointer</span><span class="op" id="2521704">(</span><span class="op" id="2521705">&amp;</span><span class="ident" id="2521706">b</span><span class="op" id="2521707">[</span><span class="num" id="2521708">8</span><span class="op" id="2521709">:</span><span class="num" id="2521710">12</span><span class="op" id="2521712">]</span><span class="op" id="2521713">[</span><span class="num" id="2521714">0</span><span class="op" id="2521715">]</span><span class="op" id="2521716">)</span><span class="op" id="2521717">)</span>&nbsp;<span class="op" id="2521719">=</span>&nbsp;<span class="ident" id="2521721">rr</span><span class="op" id="2521723">.</span><span class="ident" id="2521724">Header</span><span class="op" id="2521730">.</span><span class="ident" id="2521731">Seq</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2521736">*</span><span class="op" id="2521737">(</span><span class="op" id="2521738">*</span><span class="builtintype" id="2521739">uint32</span><span class="op" id="2521745">)</span><span class="op" id="2521746">(</span><span class="ident" id="2521747">unsafe</span><span class="op" id="2521753">.</span><span class="ident" id="2521754">Pointer</span><span class="op" id="2521761">(</span><span class="op" id="2521762">&amp;</span><span class="ident" id="2521763">b</span><span class="op" id="2521764">[</span><span class="num" id="2521765">12</span><span class="op" id="2521767">:</span><span class="num" id="2521768">16</span><span class="op" id="2521770">]</span><span class="op" id="2521771">[</span><span class="num" id="2521772">0</span><span class="op" id="2521773">]</span><span class="op" id="2521774">)</span><span class="op" id="2521775">)</span>&nbsp;<span class="op" id="2521777">=</span>&nbsp;<span class="ident" id="2521779">rr</span><span class="op" id="2521781">.</span><span class="ident" id="2521782">Header</span><span class="op" id="2521788">.</span><span class="ident" id="2521789">Pid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521794">b</span><span class="op" id="2521795">[</span><span class="num" id="2521796">16</span><span class="op" id="2521798">]</span>&nbsp;<span class="op" id="2521800">=</span>&nbsp;<span class="builtintype" id="2521802">byte</span><span class="op" id="2521806">(</span><span class="ident" id="2521807">rr</span><span class="op" id="2521809">.</span><span class="ident" id="2521810">Data</span><span class="op" id="2521814">.</span><span class="ident" id="2521815">Family</span><span class="op" id="2521821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2521824">return</span>&nbsp;<span class="ident" id="2521831">b</span><br>
<span class="lineno"></span><span class="op" id="2521833">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">40</span><span class="keyword" id="2521836">func</span>&nbsp;<span class="ident" id="2521841">newNetlinkRouteRequest</span><span class="op" id="2521863">(</span><span class="ident" id="2521864">proto</span><span class="op" id="2521869">,</span>&nbsp;<span class="ident" id="2521871">seq</span><span class="op" id="2521874">,</span>&nbsp;<span class="ident" id="2521876">family</span>&nbsp;<span class="builtintype" id="2521883">int</span><span class="op" id="2521886">)</span>&nbsp;<span class="op" id="2521888">[</span><span class="op" id="2521889">]</span><span class="builtintype" id="2521890">byte</span>&nbsp;<span class="op" id="2521895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521898">rr</span>&nbsp;<span class="op" id="2521901">:=</span>&nbsp;<span class="op" id="2521904">&amp;</span><span class="ident" id="2521905">NetlinkRouteRequest</span><span class="op" id="2521924">{</span><span class="op" id="2521925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521928">rr</span><span class="op" id="2521930">.</span><span class="ident" id="2521931">Header</span><span class="op" id="2521937">.</span><span class="ident" id="2521938">Len</span>&nbsp;<span class="op" id="2521942">=</span>&nbsp;<span class="builtintype" id="2521944">uint32</span><span class="op" id="2521950">(</span><span class="ident" id="2521951">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2521964">+</span>&nbsp;<span class="ident" id="2521966">SizeofRtGenmsg</span><span class="op" id="2521980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2521983">rr</span><span class="op" id="2521985">.</span><span class="ident" id="2521986">Header</span><span class="op" id="2521992">.</span><span class="ident" id="2521993">Type</span>&nbsp;<span class="op" id="2521998">=</span>&nbsp;<span class="builtintype" id="2522000">uint16</span><span class="op" id="2522006">(</span><span class="ident" id="2522007">proto</span><span class="op" id="2522012">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522015">rr</span><span class="op" id="2522017">.</span><span class="ident" id="2522018">Header</span><span class="op" id="2522024">.</span><span class="ident" id="2522025">Flags</span>&nbsp;<span class="op" id="2522031">=</span>&nbsp;<span class="ident" id="2522033">NLM_F_DUMP</span>&nbsp;<span class="op" id="2522044">|</span>&nbsp;<span class="ident" id="2522046">NLM_F_REQUEST</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522061">rr</span><span class="op" id="2522063">.</span><span class="ident" id="2522064">Header</span><span class="op" id="2522070">.</span><span class="ident" id="2522071">Seq</span>&nbsp;<span class="op" id="2522075">=</span>&nbsp;<span class="builtintype" id="2522077">uint32</span><span class="op" id="2522083">(</span><span class="ident" id="2522084">seq</span><span class="op" id="2522087">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522090">rr</span><span class="op" id="2522092">.</span><span class="ident" id="2522093">Data</span><span class="op" id="2522097">.</span><span class="ident" id="2522098">Family</span>&nbsp;<span class="op" id="2522105">=</span>&nbsp;<span class="builtintype" id="2522107">uint8</span><span class="op" id="2522112">(</span><span class="ident" id="2522113">family</span><span class="op" id="2522119">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522122">return</span>&nbsp;<span class="ident" id="2522129">rr</span><span class="op" id="2522131">.</span><span class="ident" id="2522132">toWireFormat</span><span class="op" id="2522144">(</span><span class="op" id="2522145">)</span><br>
<span class="lineno"></span><span class="op" id="2522147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="2522150">//&nbsp;NetlinkRIB&nbsp;returns&nbsp;routing&nbsp;information&nbsp;base,&nbsp;as&nbsp;known&nbsp;as&nbsp;RIB,&nbsp;which</span><br>
<span class="lineno"></span><span class="comment" id="2522221">//&nbsp;consists&nbsp;of&nbsp;network&nbsp;facility&nbsp;information,&nbsp;states&nbsp;and&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2522289">func</span>&nbsp;<span class="ident" id="2522294">NetlinkRIB</span><span class="op" id="2522304">(</span><span class="ident" id="2522305">proto</span><span class="op" id="2522310">,</span>&nbsp;<span class="ident" id="2522312">family</span>&nbsp;<span class="builtintype" id="2522319">int</span><span class="op" id="2522322">)</span>&nbsp;<span class="op" id="2522324">(</span><span class="op" id="2522325">[</span><span class="op" id="2522326">]</span><span class="builtintype" id="2522327">byte</span><span class="op" id="2522331">,</span>&nbsp;<span class="builtintype" id="2522333">error</span><span class="op" id="2522338">)</span>&nbsp;<span class="op" id="2522340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522343">s</span><span class="op" id="2522344">,</span>&nbsp;<span class="ident" id="2522346">err</span>&nbsp;<span class="op" id="2522350">:=</span>&nbsp;<span class="ident" id="2522353">Socket</span><span class="op" id="2522359">(</span><span class="ident" id="2522360">AF_NETLINK</span><span class="op" id="2522370">,</span>&nbsp;<span class="ident" id="2522372">SOCK_RAW</span><span class="op" id="2522380">,</span>&nbsp;<span class="ident" id="2522382">NETLINK_ROUTE</span><span class="op" id="2522395">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522398">if</span>&nbsp;<span class="ident" id="2522401">err</span>&nbsp;<span class="op" id="2522405">!=</span>&nbsp;<span class="ident" id="2522408">nil</span>&nbsp;<span class="op" id="2522412">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522416">return</span>&nbsp;<span class="ident" id="2522423">nil</span><span class="op" id="2522426">,</span>&nbsp;<span class="ident" id="2522428">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522436">defer</span>&nbsp;<span class="ident" id="2522442">Close</span><span class="op" id="2522447">(</span><span class="ident" id="2522448">s</span><span class="op" id="2522449">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522452">lsa</span>&nbsp;<span class="op" id="2522456">:=</span>&nbsp;<span class="op" id="2522459">&amp;</span><span class="ident" id="2522460">SockaddrNetlink</span><span class="op" id="2522475">{</span><span class="ident" id="2522476">Family</span><span class="op" id="2522482">:</span>&nbsp;<span class="ident" id="2522484">AF_NETLINK</span><span class="op" id="2522494">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522497">if</span>&nbsp;<span class="ident" id="2522500">err</span>&nbsp;<span class="op" id="2522504">:=</span>&nbsp;<span class="ident" id="2522507">Bind</span><span class="op" id="2522511">(</span><span class="ident" id="2522512">s</span><span class="op" id="2522513">,</span>&nbsp;<span class="ident" id="2522515">lsa</span><span class="op" id="2522518">)</span><span class="op" id="2522519">;</span>&nbsp;<span class="ident" id="2522521">err</span>&nbsp;<span class="op" id="2522525">!=</span>&nbsp;<span class="ident" id="2522528">nil</span>&nbsp;<span class="op" id="2522532">{</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522536">return</span>&nbsp;<span class="ident" id="2522543">nil</span><span class="op" id="2522546">,</span>&nbsp;<span class="ident" id="2522548">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522553">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522556">wb</span>&nbsp;<span class="op" id="2522559">:=</span>&nbsp;<span class="ident" id="2522562">newNetlinkRouteRequest</span><span class="op" id="2522584">(</span><span class="ident" id="2522585">proto</span><span class="op" id="2522590">,</span>&nbsp;<span class="num" id="2522592">1</span><span class="op" id="2522593">,</span>&nbsp;<span class="ident" id="2522595">family</span><span class="op" id="2522601">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522604">if</span>&nbsp;<span class="ident" id="2522607">err</span>&nbsp;<span class="op" id="2522611">:=</span>&nbsp;<span class="ident" id="2522614">Sendto</span><span class="op" id="2522620">(</span><span class="ident" id="2522621">s</span><span class="op" id="2522622">,</span>&nbsp;<span class="ident" id="2522624">wb</span><span class="op" id="2522626">,</span>&nbsp;<span class="num" id="2522628">0</span><span class="op" id="2522629">,</span>&nbsp;<span class="ident" id="2522631">lsa</span><span class="op" id="2522634">)</span><span class="op" id="2522635">;</span>&nbsp;<span class="ident" id="2522637">err</span>&nbsp;<span class="op" id="2522641">!=</span>&nbsp;<span class="ident" id="2522644">nil</span>&nbsp;<span class="op" id="2522648">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522652">return</span>&nbsp;<span class="ident" id="2522659">nil</span><span class="op" id="2522662">,</span>&nbsp;<span class="ident" id="2522664">err</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522669">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522672">var</span>&nbsp;<span class="ident" id="2522676">tab</span>&nbsp;<span class="op" id="2522680">[</span><span class="op" id="2522681">]</span><span class="builtintype" id="2522682">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522688">rbNew</span>&nbsp;<span class="op" id="2522694">:=</span>&nbsp;<span class="builtinfunc" id="2522697">make</span><span class="op" id="2522701">(</span><span class="op" id="2522702">[</span><span class="op" id="2522703">]</span><span class="builtintype" id="2522704">byte</span><span class="op" id="2522708">,</span>&nbsp;<span class="ident" id="2522710">Getpagesize</span><span class="op" id="2522721">(</span><span class="op" id="2522722">)</span><span class="op" id="2522723">)</span><br>
<span class="lineno"></span><span class="ident" id="2522725">done</span><span class="op" id="2522729">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522732">for</span>&nbsp;<span class="op" id="2522736">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522740">rb</span>&nbsp;<span class="op" id="2522743">:=</span>&nbsp;<span class="ident" id="2522746">rbNew</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522754">nr</span><span class="op" id="2522756">,</span>&nbsp;<span class="ident" id="2522758">_</span><span class="op" id="2522759">,</span>&nbsp;<span class="ident" id="2522761">err</span>&nbsp;<span class="op" id="2522765">:=</span>&nbsp;<span class="ident" id="2522768">Recvfrom</span><span class="op" id="2522776">(</span><span class="ident" id="2522777">s</span><span class="op" id="2522778">,</span>&nbsp;<span class="ident" id="2522780">rb</span><span class="op" id="2522782">,</span>&nbsp;<span class="num" id="2522784">0</span><span class="op" id="2522785">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522789">if</span>&nbsp;<span class="ident" id="2522792">err</span>&nbsp;<span class="op" id="2522796">!=</span>&nbsp;<span class="ident" id="2522799">nil</span>&nbsp;<span class="op" id="2522803">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522808">return</span>&nbsp;<span class="ident" id="2522815">nil</span><span class="op" id="2522818">,</span>&nbsp;<span class="ident" id="2522820">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522826">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522830">if</span>&nbsp;<span class="ident" id="2522833">nr</span>&nbsp;<span class="op" id="2522836">&lt;</span>&nbsp;<span class="ident" id="2522838">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2522851">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522856">return</span>&nbsp;<span class="ident" id="2522863">nil</span><span class="op" id="2522866">,</span>&nbsp;<span class="ident" id="2522868">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522881">rb</span>&nbsp;<span class="op" id="2522884">=</span>&nbsp;<span class="ident" id="2522886">rb</span><span class="op" id="2522888">[</span><span class="op" id="2522889">:</span><span class="ident" id="2522890">nr</span><span class="op" id="2522892">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522896">tab</span>&nbsp;<span class="op" id="2522900">=</span>&nbsp;<span class="builtinfunc" id="2522902">append</span><span class="op" id="2522908">(</span><span class="ident" id="2522909">tab</span><span class="op" id="2522912">,</span>&nbsp;<span class="ident" id="2522914">rb</span><span class="op" id="2522916">...</span><span class="op" id="2522919">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2522923">msgs</span><span class="op" id="2522927">,</span>&nbsp;<span class="ident" id="2522929">err</span>&nbsp;<span class="op" id="2522933">:=</span>&nbsp;<span class="ident" id="2522936">ParseNetlinkMessage</span><span class="op" id="2522955">(</span><span class="ident" id="2522956">rb</span><span class="op" id="2522958">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522962">if</span>&nbsp;<span class="ident" id="2522965">err</span>&nbsp;<span class="op" id="2522969">!=</span>&nbsp;<span class="ident" id="2522972">nil</span>&nbsp;<span class="op" id="2522976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2522981">return</span>&nbsp;<span class="ident" id="2522988">nil</span><span class="op" id="2522991">,</span>&nbsp;<span class="ident" id="2522993">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2522999">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523003">for</span>&nbsp;<span class="ident" id="2523007">_</span><span class="op" id="2523008">,</span>&nbsp;<span class="ident" id="2523010">m</span>&nbsp;<span class="op" id="2523012">:=</span>&nbsp;<span class="keyword" id="2523015">range</span>&nbsp;<span class="ident" id="2523021">msgs</span>&nbsp;<span class="op" id="2523026">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523031">lsa</span><span class="op" id="2523034">,</span>&nbsp;<span class="ident" id="2523036">err</span>&nbsp;<span class="op" id="2523040">:=</span>&nbsp;<span class="ident" id="2523043">Getsockname</span><span class="op" id="2523054">(</span><span class="ident" id="2523055">s</span><span class="op" id="2523056">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523061">if</span>&nbsp;<span class="ident" id="2523064">err</span>&nbsp;<span class="op" id="2523068">!=</span>&nbsp;<span class="ident" id="2523071">nil</span>&nbsp;<span class="op" id="2523075">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523081">return</span>&nbsp;<span class="ident" id="2523088">nil</span><span class="op" id="2523091">,</span>&nbsp;<span class="ident" id="2523093">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523105">switch</span>&nbsp;<span class="ident" id="2523112">v</span>&nbsp;<span class="op" id="2523114">:=</span>&nbsp;<span class="ident" id="2523117">lsa</span><span class="op" id="2523120">.</span><span class="op" id="2523121">(</span><span class="keyword" id="2523122">type</span><span class="op" id="2523126">)</span>&nbsp;<span class="op" id="2523128">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523133">case</span>&nbsp;<span class="op" id="2523138">*</span><span class="ident" id="2523139">SockaddrNetlink</span><span class="op" id="2523154">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523160">if</span>&nbsp;<span class="ident" id="2523163">m</span><span class="op" id="2523164">.</span><span class="ident" id="2523165">Header</span><span class="op" id="2523171">.</span><span class="ident" id="2523172">Seq</span>&nbsp;<span class="op" id="2523176">!=</span>&nbsp;<span class="num" id="2523179">1</span>&nbsp;<span class="op" id="2523181">||</span>&nbsp;<span class="ident" id="2523184">m</span><span class="op" id="2523185">.</span><span class="ident" id="2523186">Header</span><span class="op" id="2523192">.</span><span class="ident" id="2523193">Pid</span>&nbsp;<span class="op" id="2523197">!=</span>&nbsp;<span class="ident" id="2523200">v</span><span class="op" id="2523201">.</span><span class="ident" id="2523202">Pid</span>&nbsp;<span class="op" id="2523206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523213">return</span>&nbsp;<span class="ident" id="2523220">nil</span><span class="op" id="2523223">,</span>&nbsp;<span class="ident" id="2523225">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523236">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523241">default</span><span class="op" id="2523248">:</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523254">return</span>&nbsp;<span class="ident" id="2523261">nil</span><span class="op" id="2523264">,</span>&nbsp;<span class="ident" id="2523266">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523276">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523281">if</span>&nbsp;<span class="ident" id="2523284">m</span><span class="op" id="2523285">.</span><span class="ident" id="2523286">Header</span><span class="op" id="2523292">.</span><span class="ident" id="2523293">Type</span>&nbsp;<span class="op" id="2523298">==</span>&nbsp;<span class="ident" id="2523301">NLMSG_DONE</span>&nbsp;<span class="op" id="2523312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523318">break</span>&nbsp;<span class="ident" id="2523324">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523332">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523337">if</span>&nbsp;<span class="ident" id="2523340">m</span><span class="op" id="2523341">.</span><span class="ident" id="2523342">Header</span><span class="op" id="2523348">.</span><span class="ident" id="2523349">Type</span>&nbsp;<span class="op" id="2523354">==</span>&nbsp;<span class="ident" id="2523357">NLMSG_ERROR</span>&nbsp;<span class="op" id="2523369">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523375">return</span>&nbsp;<span class="ident" id="2523382">nil</span><span class="op" id="2523385">,</span>&nbsp;<span class="ident" id="2523387">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523397">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523401">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523404">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523407">return</span>&nbsp;<span class="ident" id="2523414">tab</span><span class="op" id="2523417">,</span>&nbsp;<span class="ident" id="2523419">nil</span><br>
<span class="lineno"></span><span class="op" id="2523423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2523426">//&nbsp;NetlinkMessage&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="2523474">type</span>&nbsp;<span class="ident" id="2523479">NetlinkMessage</span>&nbsp;<span class="keyword" id="2523494">struct</span>&nbsp;<span class="op" id="2523501">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523504">Header</span>&nbsp;<span class="ident" id="2523511">NlMsghdr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523521">Data</span>&nbsp;&nbsp;&nbsp;<span class="op" id="2523528">[</span><span class="op" id="2523529">]</span><span class="builtintype" id="2523530">byte</span><br>
<span class="lineno"></span><span class="op" id="2523535">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2523538">//&nbsp;ParseNetlinkMessage&nbsp;parses&nbsp;b&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink&nbsp;messages&nbsp;and</span><br>
<span class="lineno">115</span><span class="comment" id="2523606">//&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the&nbsp;NetlinkMessage&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2523669">func</span>&nbsp;<span class="ident" id="2523674">ParseNetlinkMessage</span><span class="op" id="2523693">(</span><span class="ident" id="2523694">b</span>&nbsp;<span class="op" id="2523696">[</span><span class="op" id="2523697">]</span><span class="builtintype" id="2523698">byte</span><span class="op" id="2523702">)</span>&nbsp;<span class="op" id="2523704">(</span><span class="op" id="2523705">[</span><span class="op" id="2523706">]</span><span class="ident" id="2523707">NetlinkMessage</span><span class="op" id="2523721">,</span>&nbsp;<span class="builtintype" id="2523723">error</span><span class="op" id="2523728">)</span>&nbsp;<span class="op" id="2523730">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523733">var</span>&nbsp;<span class="ident" id="2523737">msgs</span>&nbsp;<span class="op" id="2523742">[</span><span class="op" id="2523743">]</span><span class="ident" id="2523744">NetlinkMessage</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523760">for</span>&nbsp;<span class="builtinfunc" id="2523764">len</span><span class="op" id="2523767">(</span><span class="ident" id="2523768">b</span><span class="op" id="2523769">)</span>&nbsp;<span class="op" id="2523771">&gt;=</span>&nbsp;<span class="ident" id="2523774">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2523787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523791">h</span><span class="op" id="2523792">,</span>&nbsp;<span class="ident" id="2523794">dbuf</span><span class="op" id="2523798">,</span>&nbsp;<span class="ident" id="2523800">dlen</span><span class="op" id="2523804">,</span>&nbsp;<span class="ident" id="2523806">err</span>&nbsp;<span class="op" id="2523810">:=</span>&nbsp;<span class="ident" id="2523813">netlinkMessageHeaderAndData</span><span class="op" id="2523840">(</span><span class="ident" id="2523841">b</span><span class="op" id="2523842">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523846">if</span>&nbsp;<span class="ident" id="2523849">err</span>&nbsp;<span class="op" id="2523853">!=</span>&nbsp;<span class="ident" id="2523856">nil</span>&nbsp;<span class="op" id="2523860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2523865">return</span>&nbsp;<span class="ident" id="2523872">nil</span><span class="op" id="2523875">,</span>&nbsp;<span class="ident" id="2523877">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523883">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523887">m</span>&nbsp;<span class="op" id="2523889">:=</span>&nbsp;<span class="ident" id="2523892">NetlinkMessage</span><span class="op" id="2523906">{</span><span class="ident" id="2523907">Header</span><span class="op" id="2523913">:</span>&nbsp;<span class="op" id="2523915">*</span><span class="ident" id="2523916">h</span><span class="op" id="2523917">,</span>&nbsp;<span class="ident" id="2523919">Data</span><span class="op" id="2523923">:</span>&nbsp;<span class="ident" id="2523925">dbuf</span><span class="op" id="2523929">[</span><span class="op" id="2523930">:</span><span class="builtintype" id="2523931">int</span><span class="op" id="2523934">(</span><span class="ident" id="2523935">h</span><span class="op" id="2523936">.</span><span class="ident" id="2523937">Len</span><span class="op" id="2523940">)</span><span class="op" id="2523941">-</span><span class="ident" id="2523942">NLMSG_HDRLEN</span><span class="op" id="2523954">]</span><span class="op" id="2523955">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523959">msgs</span>&nbsp;<span class="op" id="2523964">=</span>&nbsp;<span class="builtinfunc" id="2523966">append</span><span class="op" id="2523972">(</span><span class="ident" id="2523973">msgs</span><span class="op" id="2523977">,</span>&nbsp;<span class="ident" id="2523979">m</span><span class="op" id="2523980">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2523984">b</span>&nbsp;<span class="op" id="2523986">=</span>&nbsp;<span class="ident" id="2523988">b</span><span class="op" id="2523989">[</span><span class="ident" id="2523990">dlen</span><span class="op" id="2523994">:</span><span class="op" id="2523995">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2523998">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524001">return</span>&nbsp;<span class="ident" id="2524008">msgs</span><span class="op" id="2524012">,</span>&nbsp;<span class="ident" id="2524014">nil</span><br>
<span class="lineno"></span><span class="op" id="2524018">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="keyword" id="2524021">func</span>&nbsp;<span class="ident" id="2524026">netlinkMessageHeaderAndData</span><span class="op" id="2524053">(</span><span class="ident" id="2524054">b</span>&nbsp;<span class="op" id="2524056">[</span><span class="op" id="2524057">]</span><span class="builtintype" id="2524058">byte</span><span class="op" id="2524062">)</span>&nbsp;<span class="op" id="2524064">(</span><span class="op" id="2524065">*</span><span class="ident" id="2524066">NlMsghdr</span><span class="op" id="2524074">,</span>&nbsp;<span class="op" id="2524076">[</span><span class="op" id="2524077">]</span><span class="builtintype" id="2524078">byte</span><span class="op" id="2524082">,</span>&nbsp;<span class="builtintype" id="2524084">int</span><span class="op" id="2524087">,</span>&nbsp;<span class="builtintype" id="2524089">error</span><span class="op" id="2524094">)</span>&nbsp;<span class="op" id="2524096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524099">h</span>&nbsp;<span class="op" id="2524101">:=</span>&nbsp;<span class="op" id="2524104">(</span><span class="op" id="2524105">*</span><span class="ident" id="2524106">NlMsghdr</span><span class="op" id="2524114">)</span><span class="op" id="2524115">(</span><span class="ident" id="2524116">unsafe</span><span class="op" id="2524122">.</span><span class="ident" id="2524123">Pointer</span><span class="op" id="2524130">(</span><span class="op" id="2524131">&amp;</span><span class="ident" id="2524132">b</span><span class="op" id="2524133">[</span><span class="num" id="2524134">0</span><span class="op" id="2524135">]</span><span class="op" id="2524136">)</span><span class="op" id="2524137">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524140">if</span>&nbsp;<span class="builtintype" id="2524143">int</span><span class="op" id="2524146">(</span><span class="ident" id="2524147">h</span><span class="op" id="2524148">.</span><span class="ident" id="2524149">Len</span><span class="op" id="2524152">)</span>&nbsp;<span class="op" id="2524154">&lt;</span>&nbsp;<span class="ident" id="2524156">NLMSG_HDRLEN</span>&nbsp;<span class="op" id="2524169">||</span>&nbsp;<span class="builtintype" id="2524172">int</span><span class="op" id="2524175">(</span><span class="ident" id="2524176">h</span><span class="op" id="2524177">.</span><span class="ident" id="2524178">Len</span><span class="op" id="2524181">)</span>&nbsp;<span class="op" id="2524183">&gt;</span>&nbsp;<span class="builtinfunc" id="2524185">len</span><span class="op" id="2524188">(</span><span class="ident" id="2524189">b</span><span class="op" id="2524190">)</span>&nbsp;<span class="op" id="2524192">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524196">return</span>&nbsp;<span class="ident" id="2524203">nil</span><span class="op" id="2524206">,</span>&nbsp;<span class="ident" id="2524208">nil</span><span class="op" id="2524211">,</span>&nbsp;<span class="num" id="2524213">0</span><span class="op" id="2524214">,</span>&nbsp;<span class="ident" id="2524216">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2524224">}</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524227">return</span>&nbsp;<span class="ident" id="2524234">h</span><span class="op" id="2524235">,</span>&nbsp;<span class="ident" id="2524237">b</span><span class="op" id="2524238">[</span><span class="ident" id="2524239">NLMSG_HDRLEN</span><span class="op" id="2524251">:</span><span class="op" id="2524252">]</span><span class="op" id="2524253">,</span>&nbsp;<span class="ident" id="2524255">nlmAlignOf</span><span class="op" id="2524265">(</span><span class="builtintype" id="2524266">int</span><span class="op" id="2524269">(</span><span class="ident" id="2524270">h</span><span class="op" id="2524271">.</span><span class="ident" id="2524272">Len</span><span class="op" id="2524275">)</span><span class="op" id="2524276">)</span><span class="op" id="2524277">,</span>&nbsp;<span class="ident" id="2524279">nil</span><br>
<span class="lineno"></span><span class="op" id="2524283">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2524286">//&nbsp;NetlinkRouteAttr&nbsp;represents&nbsp;a&nbsp;netlink&nbsp;route&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="2524344">type</span>&nbsp;<span class="ident" id="2524349">NetlinkRouteAttr</span>&nbsp;<span class="keyword" id="2524366">struct</span>&nbsp;<span class="op" id="2524373">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524376">Attr</span>&nbsp;&nbsp;<span class="ident" id="2524382">RtAttr</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524390">Value</span>&nbsp;<span class="op" id="2524396">[</span><span class="op" id="2524397">]</span><span class="builtintype" id="2524398">byte</span><br>
<span class="lineno"></span><span class="op" id="2524403">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2524406">//&nbsp;ParseNetlinkRouteAttr&nbsp;parses&nbsp;m&#39;s&nbsp;payload&nbsp;as&nbsp;an&nbsp;array&nbsp;of&nbsp;netlink</span><br>
<span class="lineno">145</span><span class="comment" id="2524473">//&nbsp;route&nbsp;attributes&nbsp;and&nbsp;returns&nbsp;the&nbsp;slice&nbsp;containing&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2524530">//&nbsp;NetlinkRouteAttr&nbsp;structures.</span><br>
<span class="lineno"></span><span class="keyword" id="2524562">func</span>&nbsp;<span class="ident" id="2524567">ParseNetlinkRouteAttr</span><span class="op" id="2524588">(</span><span class="ident" id="2524589">m</span>&nbsp;<span class="op" id="2524591">*</span><span class="ident" id="2524592">NetlinkMessage</span><span class="op" id="2524606">)</span>&nbsp;<span class="op" id="2524608">(</span><span class="op" id="2524609">[</span><span class="op" id="2524610">]</span><span class="ident" id="2524611">NetlinkRouteAttr</span><span class="op" id="2524627">,</span>&nbsp;<span class="builtintype" id="2524629">error</span><span class="op" id="2524634">)</span>&nbsp;<span class="op" id="2524636">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524639">var</span>&nbsp;<span class="ident" id="2524643">b</span>&nbsp;<span class="op" id="2524645">[</span><span class="op" id="2524646">]</span><span class="builtintype" id="2524647">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524653">switch</span>&nbsp;<span class="ident" id="2524660">m</span><span class="op" id="2524661">.</span><span class="ident" id="2524662">Header</span><span class="op" id="2524668">.</span><span class="ident" id="2524669">Type</span>&nbsp;<span class="op" id="2524674">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524677">case</span>&nbsp;<span class="ident" id="2524682">RTM_NEWLINK</span><span class="op" id="2524693">,</span>&nbsp;<span class="ident" id="2524695">RTM_DELLINK</span><span class="op" id="2524706">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524710">b</span>&nbsp;<span class="op" id="2524712">=</span>&nbsp;<span class="ident" id="2524714">m</span><span class="op" id="2524715">.</span><span class="ident" id="2524716">Data</span><span class="op" id="2524720">[</span><span class="ident" id="2524721">SizeofIfInfomsg</span><span class="op" id="2524736">:</span><span class="op" id="2524737">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524740">case</span>&nbsp;<span class="ident" id="2524745">RTM_NEWADDR</span><span class="op" id="2524756">,</span>&nbsp;<span class="ident" id="2524758">RTM_DELADDR</span><span class="op" id="2524769">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524773">b</span>&nbsp;<span class="op" id="2524775">=</span>&nbsp;<span class="ident" id="2524777">m</span><span class="op" id="2524778">.</span><span class="ident" id="2524779">Data</span><span class="op" id="2524783">[</span><span class="ident" id="2524784">SizeofIfAddrmsg</span><span class="op" id="2524799">:</span><span class="op" id="2524800">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524803">case</span>&nbsp;<span class="ident" id="2524808">RTM_NEWROUTE</span><span class="op" id="2524820">,</span>&nbsp;<span class="ident" id="2524822">RTM_DELROUTE</span><span class="op" id="2524834">:</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524838">b</span>&nbsp;<span class="op" id="2524840">=</span>&nbsp;<span class="ident" id="2524842">m</span><span class="op" id="2524843">.</span><span class="ident" id="2524844">Data</span><span class="op" id="2524848">[</span><span class="ident" id="2524849">SizeofRtMsg</span><span class="op" id="2524860">:</span><span class="op" id="2524861">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524864">default</span><span class="op" id="2524871">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524875">return</span>&nbsp;<span class="ident" id="2524882">nil</span><span class="op" id="2524885">,</span>&nbsp;<span class="ident" id="2524887">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2524895">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524898">var</span>&nbsp;<span class="ident" id="2524902">attrs</span>&nbsp;<span class="op" id="2524908">[</span><span class="op" id="2524909">]</span><span class="ident" id="2524910">NetlinkRouteAttr</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2524928">for</span>&nbsp;<span class="builtinfunc" id="2524932">len</span><span class="op" id="2524935">(</span><span class="ident" id="2524936">b</span><span class="op" id="2524937">)</span>&nbsp;<span class="op" id="2524939">&gt;=</span>&nbsp;<span class="ident" id="2524942">SizeofRtAttr</span>&nbsp;<span class="op" id="2524955">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2524959">a</span><span class="op" id="2524960">,</span>&nbsp;<span class="ident" id="2524962">vbuf</span><span class="op" id="2524966">,</span>&nbsp;<span class="ident" id="2524968">alen</span><span class="op" id="2524972">,</span>&nbsp;<span class="ident" id="2524974">err</span>&nbsp;<span class="op" id="2524978">:=</span>&nbsp;<span class="ident" id="2524981">netlinkRouteAttrAndValue</span><span class="op" id="2525005">(</span><span class="ident" id="2525006">b</span><span class="op" id="2525007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525011">if</span>&nbsp;<span class="ident" id="2525014">err</span>&nbsp;<span class="op" id="2525018">!=</span>&nbsp;<span class="ident" id="2525021">nil</span>&nbsp;<span class="op" id="2525025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525030">return</span>&nbsp;<span class="ident" id="2525037">nil</span><span class="op" id="2525040">,</span>&nbsp;<span class="ident" id="2525042">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525048">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525052">ra</span>&nbsp;<span class="op" id="2525055">:=</span>&nbsp;<span class="ident" id="2525058">NetlinkRouteAttr</span><span class="op" id="2525074">{</span><span class="ident" id="2525075">Attr</span><span class="op" id="2525079">:</span>&nbsp;<span class="op" id="2525081">*</span><span class="ident" id="2525082">a</span><span class="op" id="2525083">,</span>&nbsp;<span class="ident" id="2525085">Value</span><span class="op" id="2525090">:</span>&nbsp;<span class="ident" id="2525092">vbuf</span><span class="op" id="2525096">[</span><span class="op" id="2525097">:</span><span class="builtintype" id="2525098">int</span><span class="op" id="2525101">(</span><span class="ident" id="2525102">a</span><span class="op" id="2525103">.</span><span class="ident" id="2525104">Len</span><span class="op" id="2525107">)</span><span class="op" id="2525108">-</span><span class="ident" id="2525109">SizeofRtAttr</span><span class="op" id="2525121">]</span><span class="op" id="2525122">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525126">attrs</span>&nbsp;<span class="op" id="2525132">=</span>&nbsp;<span class="builtinfunc" id="2525134">append</span><span class="op" id="2525140">(</span><span class="ident" id="2525141">attrs</span><span class="op" id="2525146">,</span>&nbsp;<span class="ident" id="2525148">ra</span><span class="op" id="2525150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525154">b</span>&nbsp;<span class="op" id="2525156">=</span>&nbsp;<span class="ident" id="2525158">b</span><span class="op" id="2525159">[</span><span class="ident" id="2525160">alen</span><span class="op" id="2525164">:</span><span class="op" id="2525165">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525168">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525171">return</span>&nbsp;<span class="ident" id="2525178">attrs</span><span class="op" id="2525183">,</span>&nbsp;<span class="ident" id="2525185">nil</span><br>
<span class="lineno">170</span><span class="op" id="2525189">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2525192">func</span>&nbsp;<span class="ident" id="2525197">netlinkRouteAttrAndValue</span><span class="op" id="2525221">(</span><span class="ident" id="2525222">b</span>&nbsp;<span class="op" id="2525224">[</span><span class="op" id="2525225">]</span><span class="builtintype" id="2525226">byte</span><span class="op" id="2525230">)</span>&nbsp;<span class="op" id="2525232">(</span><span class="op" id="2525233">*</span><span class="ident" id="2525234">RtAttr</span><span class="op" id="2525240">,</span>&nbsp;<span class="op" id="2525242">[</span><span class="op" id="2525243">]</span><span class="builtintype" id="2525244">byte</span><span class="op" id="2525248">,</span>&nbsp;<span class="builtintype" id="2525250">int</span><span class="op" id="2525253">,</span>&nbsp;<span class="builtintype" id="2525255">error</span><span class="op" id="2525260">)</span>&nbsp;<span class="op" id="2525262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2525265">a</span>&nbsp;<span class="op" id="2525267">:=</span>&nbsp;<span class="op" id="2525270">(</span><span class="op" id="2525271">*</span><span class="ident" id="2525272">RtAttr</span><span class="op" id="2525278">)</span><span class="op" id="2525279">(</span><span class="ident" id="2525280">unsafe</span><span class="op" id="2525286">.</span><span class="ident" id="2525287">Pointer</span><span class="op" id="2525294">(</span><span class="op" id="2525295">&amp;</span><span class="ident" id="2525296">b</span><span class="op" id="2525297">[</span><span class="num" id="2525298">0</span><span class="op" id="2525299">]</span><span class="op" id="2525300">)</span><span class="op" id="2525301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525304">if</span>&nbsp;<span class="builtintype" id="2525307">int</span><span class="op" id="2525310">(</span><span class="ident" id="2525311">a</span><span class="op" id="2525312">.</span><span class="ident" id="2525313">Len</span><span class="op" id="2525316">)</span>&nbsp;<span class="op" id="2525318">&lt;</span>&nbsp;<span class="ident" id="2525320">SizeofRtAttr</span>&nbsp;<span class="op" id="2525333">||</span>&nbsp;<span class="builtintype" id="2525336">int</span><span class="op" id="2525339">(</span><span class="ident" id="2525340">a</span><span class="op" id="2525341">.</span><span class="ident" id="2525342">Len</span><span class="op" id="2525345">)</span>&nbsp;<span class="op" id="2525347">&gt;</span>&nbsp;<span class="builtinfunc" id="2525349">len</span><span class="op" id="2525352">(</span><span class="ident" id="2525353">b</span><span class="op" id="2525354">)</span>&nbsp;<span class="op" id="2525356">{</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525360">return</span>&nbsp;<span class="ident" id="2525367">nil</span><span class="op" id="2525370">,</span>&nbsp;<span class="ident" id="2525372">nil</span><span class="op" id="2525375">,</span>&nbsp;<span class="num" id="2525377">0</span><span class="op" id="2525378">,</span>&nbsp;<span class="ident" id="2525380">EINVAL</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2525388">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2525391">return</span>&nbsp;<span class="ident" id="2525398">a</span><span class="op" id="2525399">,</span>&nbsp;<span class="ident" id="2525401">b</span><span class="op" id="2525402">[</span><span class="ident" id="2525403">SizeofRtAttr</span><span class="op" id="2525415">:</span><span class="op" id="2525416">]</span><span class="op" id="2525417">,</span>&nbsp;<span class="ident" id="2525419">rtaAlignOf</span><span class="op" id="2525429">(</span><span class="builtintype" id="2525430">int</span><span class="op" id="2525433">(</span><span class="ident" id="2525434">a</span><span class="op" id="2525435">.</span><span class="ident" id="2525436">Len</span><span class="op" id="2525439">)</span><span class="op" id="2525440">)</span><span class="op" id="2525441">,</span>&nbsp;<span class="ident" id="2525443">nil</span><br>
<span class="lineno"></span><span class="op" id="2525447">}</span>
</div>
</body>
</html>
