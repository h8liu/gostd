<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html" class="current">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2932820">//&nbsp;Copyright&nbsp;2013&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2932875">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2932929">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2932980">package</span>&nbsp;<span class="ident" id="2932988">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2932993">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;the&nbsp;PSS&nbsp;signature&nbsp;scheme&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="2933047">//</span><br>
<span class="lineno"></span><span class="comment" id="2933050">//&nbsp;[1]&nbsp;http://www.rsa.com/rsalabs/pkcs/files/h11300-wp-pkcs-1v2-2-rsa-cryptography-standard.pdf</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="keyword" id="2933147">import</span>&nbsp;<span class="op" id="2933154">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933157">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933166">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933176">&#34;errors&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933186">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933194">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="2933200">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="2933211">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">20</span><span class="keyword" id="2933214">func</span>&nbsp;<span class="ident" id="2933219">emsaPSSEncode</span><span class="op" id="2933232">(</span><span class="ident" id="2933233">mHash</span>&nbsp;<span class="op" id="2933239">[</span><span class="op" id="2933240">]</span><span class="builtintype" id="2933241">byte</span><span class="op" id="2933245">,</span>&nbsp;<span class="ident" id="2933247">emBits</span>&nbsp;<span class="builtintype" id="2933254">int</span><span class="op" id="2933257">,</span>&nbsp;<span class="ident" id="2933259">salt</span>&nbsp;<span class="op" id="2933264">[</span><span class="op" id="2933265">]</span><span class="builtintype" id="2933266">byte</span><span class="op" id="2933270">,</span>&nbsp;<span class="ident" id="2933272">hash</span>&nbsp;<span class="ident" id="2933277">hash</span><span class="op" id="2933281">.</span><span class="ident" id="2933282">Hash</span><span class="op" id="2933286">)</span>&nbsp;<span class="op" id="2933288">(</span><span class="op" id="2933289">[</span><span class="op" id="2933290">]</span><span class="builtintype" id="2933291">byte</span><span class="op" id="2933295">,</span>&nbsp;<span class="builtintype" id="2933297">error</span><span class="op" id="2933302">)</span>&nbsp;<span class="op" id="2933304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933307">//&nbsp;See&nbsp;[1],&nbsp;section&nbsp;9.1.1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933334">hLen</span>&nbsp;<span class="op" id="2933339">:=</span>&nbsp;<span class="ident" id="2933342">hash</span><span class="op" id="2933346">.</span><span class="ident" id="2933347">Size</span><span class="op" id="2933351">(</span><span class="op" id="2933352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933355">sLen</span>&nbsp;<span class="op" id="2933360">:=</span>&nbsp;<span class="builtinfunc" id="2933363">len</span><span class="op" id="2933366">(</span><span class="ident" id="2933367">salt</span><span class="op" id="2933371">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933374">emLen</span>&nbsp;<span class="op" id="2933380">:=</span>&nbsp;<span class="op" id="2933383">(</span><span class="ident" id="2933384">emBits</span>&nbsp;<span class="op" id="2933391">+</span>&nbsp;<span class="num" id="2933393">7</span><span class="op" id="2933394">)</span>&nbsp;<span class="op" id="2933396">/</span>&nbsp;<span class="num" id="2933398">8</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933402">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933474">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;message&nbsp;too</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933545">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933569">//</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933573">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933635">if</span>&nbsp;<span class="builtinfunc" id="2933638">len</span><span class="op" id="2933641">(</span><span class="ident" id="2933642">mHash</span><span class="op" id="2933647">)</span>&nbsp;<span class="op" id="2933649">!=</span>&nbsp;<span class="ident" id="2933652">hLen</span>&nbsp;<span class="op" id="2933657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933661">return</span>&nbsp;<span class="builtintype" id="2933668">nil</span><span class="op" id="2933671">,</span>&nbsp;<span class="ident" id="2933673">errors</span><span class="op" id="2933679">.</span><span class="ident" id="2933680">New</span><span class="op" id="2933683">(</span><span class="string" id="2933684">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="2933726">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2933729">}</span><br>
<span class="lineno">35</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933733">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;encoding&nbsp;error&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933804">if</span>&nbsp;<span class="ident" id="2933807">emLen</span>&nbsp;<span class="op" id="2933813">&lt;</span>&nbsp;<span class="ident" id="2933815">hLen</span><span class="op" id="2933819">+</span><span class="ident" id="2933820">sLen</span><span class="op" id="2933824">+</span><span class="num" id="2933825">2</span>&nbsp;<span class="op" id="2933827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2933831">return</span>&nbsp;<span class="builtintype" id="2933838">nil</span><span class="op" id="2933841">,</span>&nbsp;<span class="ident" id="2933843">errors</span><span class="op" id="2933849">.</span><span class="ident" id="2933850">New</span><span class="op" id="2933853">(</span><span class="string" id="2933854">&#34;crypto/rsa:&nbsp;encoding&nbsp;error&#34;</span><span class="op" id="2933882">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2933885">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933889">em</span>&nbsp;<span class="op" id="2933892">:=</span>&nbsp;<span class="builtinfunc" id="2933895">make</span><span class="op" id="2933899">(</span><span class="op" id="2933900">[</span><span class="op" id="2933901">]</span><span class="builtintype" id="2933902">byte</span><span class="op" id="2933906">,</span>&nbsp;<span class="ident" id="2933908">emLen</span><span class="op" id="2933913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933916">db</span>&nbsp;<span class="op" id="2933919">:=</span>&nbsp;<span class="ident" id="2933922">em</span><span class="op" id="2933924">[</span><span class="op" id="2933925">:</span><span class="ident" id="2933926">emLen</span><span class="op" id="2933931">-</span><span class="ident" id="2933932">sLen</span><span class="op" id="2933936">-</span><span class="ident" id="2933937">hLen</span><span class="op" id="2933941">-</span><span class="num" id="2933942">2</span><span class="op" id="2933943">+</span><span class="num" id="2933944">1</span><span class="op" id="2933945">+</span><span class="ident" id="2933946">sLen</span><span class="op" id="2933950">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2933953">h</span>&nbsp;<span class="op" id="2933955">:=</span>&nbsp;<span class="ident" id="2933958">em</span><span class="op" id="2933960">[</span><span class="ident" id="2933961">emLen</span><span class="op" id="2933966">-</span><span class="ident" id="2933967">sLen</span><span class="op" id="2933971">-</span><span class="ident" id="2933972">hLen</span><span class="op" id="2933976">-</span><span class="num" id="2933977">2</span><span class="op" id="2933978">+</span><span class="num" id="2933979">1</span><span class="op" id="2933980">+</span><span class="ident" id="2933981">sLen</span>&nbsp;<span class="op" id="2933986">:</span>&nbsp;<span class="ident" id="2933988">emLen</span><span class="op" id="2933993">-</span><span class="num" id="2933994">1</span><span class="op" id="2933995">]</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2933999">//&nbsp;4.&nbsp;&nbsp;Generate&nbsp;a&nbsp;random&nbsp;octet&nbsp;string&nbsp;salt&nbsp;of&nbsp;length&nbsp;sLen;&nbsp;if&nbsp;sLen&nbsp;=&nbsp;0,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934072">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;then&nbsp;salt&nbsp;is&nbsp;the&nbsp;empty&nbsp;string.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934111">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934115">//&nbsp;5.&nbsp;&nbsp;Let</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934127">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934188">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934192">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934259">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934288">//</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934292">//&nbsp;6.&nbsp;&nbsp;Let&nbsp;H&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2934351">var</span>&nbsp;<span class="ident" id="2934355">prefix</span>&nbsp;<span class="op" id="2934362">[</span><span class="num" id="2934363">8</span><span class="op" id="2934364">]</span><span class="builtintype" id="2934365">byte</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934372">hash</span><span class="op" id="2934376">.</span><span class="ident" id="2934377">Write</span><span class="op" id="2934382">(</span><span class="ident" id="2934383">prefix</span><span class="op" id="2934389">[</span><span class="op" id="2934390">:</span><span class="op" id="2934391">]</span><span class="op" id="2934392">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934395">hash</span><span class="op" id="2934399">.</span><span class="ident" id="2934400">Write</span><span class="op" id="2934405">(</span><span class="ident" id="2934406">mHash</span><span class="op" id="2934411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934414">hash</span><span class="op" id="2934418">.</span><span class="ident" id="2934419">Write</span><span class="op" id="2934424">(</span><span class="ident" id="2934425">salt</span><span class="op" id="2934429">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934433">h</span>&nbsp;<span class="op" id="2934435">=</span>&nbsp;<span class="ident" id="2934437">hash</span><span class="op" id="2934441">.</span><span class="ident" id="2934442">Sum</span><span class="op" id="2934445">(</span><span class="ident" id="2934446">h</span><span class="op" id="2934447">[</span><span class="op" id="2934448">:</span><span class="num" id="2934449">0</span><span class="op" id="2934450">]</span><span class="op" id="2934451">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934454">hash</span><span class="op" id="2934458">.</span><span class="ident" id="2934459">Reset</span><span class="op" id="2934464">(</span><span class="op" id="2934465">)</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934469">//&nbsp;7.&nbsp;&nbsp;Generate&nbsp;an&nbsp;octet&nbsp;string&nbsp;PS&nbsp;consisting&nbsp;of&nbsp;emLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934543">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;zero&nbsp;octets.&nbsp;&nbsp;The&nbsp;length&nbsp;of&nbsp;PS&nbsp;may&nbsp;be&nbsp;0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934592">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934596">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;PS&nbsp;||&nbsp;0x01&nbsp;||&nbsp;salt;&nbsp;DB&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934665">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934692">db</span><span class="op" id="2934694">[</span><span class="ident" id="2934695">emLen</span><span class="op" id="2934700">-</span><span class="ident" id="2934701">sLen</span><span class="op" id="2934705">-</span><span class="ident" id="2934706">hLen</span><span class="op" id="2934710">-</span><span class="num" id="2934711">2</span><span class="op" id="2934712">]</span>&nbsp;<span class="op" id="2934714">=</span>&nbsp;<span class="num" id="2934716">0x01</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="2934722">copy</span><span class="op" id="2934726">(</span><span class="ident" id="2934727">db</span><span class="op" id="2934729">[</span><span class="ident" id="2934730">emLen</span><span class="op" id="2934735">-</span><span class="ident" id="2934736">sLen</span><span class="op" id="2934740">-</span><span class="ident" id="2934741">hLen</span><span class="op" id="2934745">-</span><span class="num" id="2934746">1</span><span class="op" id="2934747">:</span><span class="op" id="2934748">]</span><span class="op" id="2934749">,</span>&nbsp;<span class="ident" id="2934751">salt</span><span class="op" id="2934755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934759">//&nbsp;9.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934806">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934810">//&nbsp;10.&nbsp;Let&nbsp;maskedDB&nbsp;=&nbsp;DB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934850">mgf1XOR</span><span class="op" id="2934857">(</span><span class="ident" id="2934858">db</span><span class="op" id="2934860">,</span>&nbsp;<span class="ident" id="2934862">hash</span><span class="op" id="2934866">,</span>&nbsp;<span class="ident" id="2934868">h</span><span class="op" id="2934869">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934873">//&nbsp;11.&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2934947">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;to&nbsp;zero.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2934974">db</span><span class="op" id="2934976">[</span><span class="num" id="2934977">0</span><span class="op" id="2934978">]</span>&nbsp;<span class="op" id="2934980">&amp;=</span>&nbsp;<span class="op" id="2934983">(</span><span class="num" id="2934984">0xFF</span>&nbsp;<span class="op" id="2934989">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2934992">uint</span><span class="op" id="2934996">(</span><span class="num" id="2934997">8</span><span class="op" id="2934998">*</span><span class="ident" id="2934999">emLen</span><span class="op" id="2935004">-</span><span class="ident" id="2935005">emBits</span><span class="op" id="2935011">)</span><span class="op" id="2935012">)</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935016">//&nbsp;12.&nbsp;Let&nbsp;EM&nbsp;=&nbsp;maskedDB&nbsp;||&nbsp;H&nbsp;||&nbsp;0xbc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935056">em</span><span class="op" id="2935058">[</span><span class="ident" id="2935059">emLen</span><span class="op" id="2935064">-</span><span class="num" id="2935065">1</span><span class="op" id="2935066">]</span>&nbsp;<span class="op" id="2935068">=</span>&nbsp;<span class="num" id="2935070">0xBC</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935077">//&nbsp;13.&nbsp;Output&nbsp;EM.</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935096">return</span>&nbsp;<span class="ident" id="2935103">em</span><span class="op" id="2935105">,</span>&nbsp;<span class="builtintype" id="2935107">nil</span><br>
<span class="lineno"></span><span class="op" id="2935111">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2935114">func</span>&nbsp;<span class="ident" id="2935119">emsaPSSVerify</span><span class="op" id="2935132">(</span><span class="ident" id="2935133">mHash</span><span class="op" id="2935138">,</span>&nbsp;<span class="ident" id="2935140">em</span>&nbsp;<span class="op" id="2935143">[</span><span class="op" id="2935144">]</span><span class="builtintype" id="2935145">byte</span><span class="op" id="2935149">,</span>&nbsp;<span class="ident" id="2935151">emBits</span><span class="op" id="2935157">,</span>&nbsp;<span class="ident" id="2935159">sLen</span>&nbsp;<span class="builtintype" id="2935164">int</span><span class="op" id="2935167">,</span>&nbsp;<span class="ident" id="2935169">hash</span>&nbsp;<span class="ident" id="2935174">hash</span><span class="op" id="2935178">.</span><span class="ident" id="2935179">Hash</span><span class="op" id="2935183">)</span>&nbsp;<span class="builtintype" id="2935185">error</span>&nbsp;<span class="op" id="2935191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935194">//&nbsp;1.&nbsp;&nbsp;If&nbsp;the&nbsp;length&nbsp;of&nbsp;M&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;input&nbsp;limitation&nbsp;for&nbsp;the</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935266">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;hash&nbsp;function&nbsp;(2^61&nbsp;-&nbsp;1&nbsp;octets&nbsp;for&nbsp;SHA-1),&nbsp;output&nbsp;&#34;inconsistent&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935339">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935357">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935361">//&nbsp;2.&nbsp;&nbsp;Let&nbsp;mHash&nbsp;=&nbsp;Hash(M),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935422">hLen</span>&nbsp;<span class="op" id="2935427">:=</span>&nbsp;<span class="ident" id="2935430">hash</span><span class="op" id="2935434">.</span><span class="ident" id="2935435">Size</span><span class="op" id="2935439">(</span><span class="op" id="2935440">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935443">if</span>&nbsp;<span class="ident" id="2935446">hLen</span>&nbsp;<span class="op" id="2935451">!=</span>&nbsp;<span class="builtinfunc" id="2935454">len</span><span class="op" id="2935457">(</span><span class="ident" id="2935458">mHash</span><span class="op" id="2935463">)</span>&nbsp;<span class="op" id="2935465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935469">return</span>&nbsp;<span class="ident" id="2935476">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935493">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935497">//&nbsp;3.&nbsp;&nbsp;If&nbsp;emLen&nbsp;&lt;&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;+&nbsp;2,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935565">emLen</span>&nbsp;<span class="op" id="2935571">:=</span>&nbsp;<span class="op" id="2935574">(</span><span class="ident" id="2935575">emBits</span>&nbsp;<span class="op" id="2935582">+</span>&nbsp;<span class="num" id="2935584">7</span><span class="op" id="2935585">)</span>&nbsp;<span class="op" id="2935587">/</span>&nbsp;<span class="num" id="2935589">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935592">if</span>&nbsp;<span class="ident" id="2935595">emLen</span>&nbsp;<span class="op" id="2935601">&lt;</span>&nbsp;<span class="ident" id="2935603">hLen</span><span class="op" id="2935607">+</span><span class="ident" id="2935608">sLen</span><span class="op" id="2935612">+</span><span class="num" id="2935613">2</span>&nbsp;<span class="op" id="2935615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935619">return</span>&nbsp;<span class="ident" id="2935626">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935643">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935647">//&nbsp;4.&nbsp;&nbsp;If&nbsp;the&nbsp;rightmost&nbsp;octet&nbsp;of&nbsp;EM&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935716">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbc,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935762">if</span>&nbsp;<span class="ident" id="2935765">em</span><span class="op" id="2935767">[</span><span class="builtinfunc" id="2935768">len</span><span class="op" id="2935771">(</span><span class="ident" id="2935772">em</span><span class="op" id="2935774">)</span><span class="op" id="2935775">-</span><span class="num" id="2935776">1</span><span class="op" id="2935777">]</span>&nbsp;<span class="op" id="2935779">!=</span>&nbsp;<span class="num" id="2935782">0xBC</span>&nbsp;<span class="op" id="2935787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2935791">return</span>&nbsp;<span class="ident" id="2935798">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2935815">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935819">//&nbsp;5.&nbsp;&nbsp;Let&nbsp;maskedDB&nbsp;be&nbsp;the&nbsp;leftmost&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1&nbsp;octets&nbsp;of&nbsp;EM,&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935891">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;let&nbsp;H&nbsp;be&nbsp;the&nbsp;next&nbsp;hLen&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935930">db</span>&nbsp;<span class="op" id="2935933">:=</span>&nbsp;<span class="ident" id="2935936">em</span><span class="op" id="2935938">[</span><span class="op" id="2935939">:</span><span class="ident" id="2935940">emLen</span><span class="op" id="2935945">-</span><span class="ident" id="2935946">hLen</span><span class="op" id="2935950">-</span><span class="num" id="2935951">1</span><span class="op" id="2935952">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2935955">h</span>&nbsp;<span class="op" id="2935957">:=</span>&nbsp;<span class="ident" id="2935960">em</span><span class="op" id="2935962">[</span><span class="ident" id="2935963">emLen</span><span class="op" id="2935968">-</span><span class="ident" id="2935969">hLen</span><span class="op" id="2935973">-</span><span class="num" id="2935974">1</span>&nbsp;<span class="op" id="2935976">:</span>&nbsp;<span class="builtinfunc" id="2935978">len</span><span class="op" id="2935981">(</span><span class="ident" id="2935982">em</span><span class="op" id="2935984">)</span><span class="op" id="2935985">-</span><span class="num" id="2935986">1</span><span class="op" id="2935987">]</span><br>
<span class="lineno">120</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2935991">//&nbsp;6.&nbsp;&nbsp;If&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936064">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;maskedDB&nbsp;are&nbsp;not&nbsp;all&nbsp;equal&nbsp;to&nbsp;zero,&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936134">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936148">if</span>&nbsp;<span class="ident" id="2936151">em</span><span class="op" id="2936153">[</span><span class="num" id="2936154">0</span><span class="op" id="2936155">]</span><span class="op" id="2936156">&amp;</span><span class="op" id="2936157">(</span><span class="num" id="2936158">0xFF</span><span class="op" id="2936162">&lt;&lt;</span><span class="builtintype" id="2936164">uint</span><span class="op" id="2936168">(</span><span class="num" id="2936169">8</span><span class="op" id="2936170">-</span><span class="op" id="2936171">(</span><span class="num" id="2936172">8</span><span class="op" id="2936173">*</span><span class="ident" id="2936174">emLen</span><span class="op" id="2936179">-</span><span class="ident" id="2936180">emBits</span><span class="op" id="2936186">)</span><span class="op" id="2936187">)</span><span class="op" id="2936188">)</span>&nbsp;<span class="op" id="2936190">!=</span>&nbsp;<span class="num" id="2936193">0</span>&nbsp;<span class="op" id="2936195">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936199">return</span>&nbsp;<span class="ident" id="2936206">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936223">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936227">//&nbsp;7.&nbsp;&nbsp;Let&nbsp;dbMask&nbsp;=&nbsp;MGF(H,&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;1).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936274">//</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936278">//&nbsp;8.&nbsp;&nbsp;Let&nbsp;DB&nbsp;=&nbsp;maskedDB&nbsp;\xor&nbsp;dbMask.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936317">mgf1XOR</span><span class="op" id="2936324">(</span><span class="ident" id="2936325">db</span><span class="op" id="2936327">,</span>&nbsp;<span class="ident" id="2936329">hash</span><span class="op" id="2936333">,</span>&nbsp;<span class="ident" id="2936335">h</span><span class="op" id="2936336">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936340">//&nbsp;9.&nbsp;&nbsp;Set&nbsp;the&nbsp;leftmost&nbsp;8&nbsp;*&nbsp;emLen&nbsp;-&nbsp;emBits&nbsp;bits&nbsp;of&nbsp;the&nbsp;leftmost&nbsp;octet&nbsp;in&nbsp;DB</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936417">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to&nbsp;zero.</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936434">db</span><span class="op" id="2936436">[</span><span class="num" id="2936437">0</span><span class="op" id="2936438">]</span>&nbsp;<span class="op" id="2936440">&amp;=</span>&nbsp;<span class="op" id="2936443">(</span><span class="num" id="2936444">0xFF</span>&nbsp;<span class="op" id="2936449">&gt;&gt;</span>&nbsp;<span class="builtintype" id="2936452">uint</span><span class="op" id="2936456">(</span><span class="num" id="2936457">8</span><span class="op" id="2936458">*</span><span class="ident" id="2936459">emLen</span><span class="op" id="2936464">-</span><span class="ident" id="2936465">emBits</span><span class="op" id="2936471">)</span><span class="op" id="2936472">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936476">if</span>&nbsp;<span class="ident" id="2936479">sLen</span>&nbsp;<span class="op" id="2936484">==</span>&nbsp;<span class="ident" id="2936487">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="2936505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2936508">FindSaltLength</span><span class="op" id="2936522">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936526">for</span>&nbsp;<span class="ident" id="2936530">sLen</span>&nbsp;<span class="op" id="2936535">=</span>&nbsp;<span class="ident" id="2936537">emLen</span>&nbsp;<span class="op" id="2936543">-</span>&nbsp;<span class="op" id="2936545">(</span><span class="ident" id="2936546">hLen</span>&nbsp;<span class="op" id="2936551">+</span>&nbsp;<span class="num" id="2936553">2</span><span class="op" id="2936554">)</span><span class="op" id="2936555">;</span>&nbsp;<span class="ident" id="2936557">sLen</span>&nbsp;<span class="op" id="2936562">&gt;=</span>&nbsp;<span class="num" id="2936565">0</span><span class="op" id="2936566">;</span>&nbsp;<span class="ident" id="2936568">sLen</span><span class="op" id="2936572">--</span>&nbsp;<span class="op" id="2936575">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936580">switch</span>&nbsp;<span class="ident" id="2936587">db</span><span class="op" id="2936589">[</span><span class="ident" id="2936590">emLen</span><span class="op" id="2936595">-</span><span class="ident" id="2936596">hLen</span><span class="op" id="2936600">-</span><span class="ident" id="2936601">sLen</span><span class="op" id="2936605">-</span><span class="num" id="2936606">2</span><span class="op" id="2936607">]</span>&nbsp;<span class="op" id="2936609">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936614">case</span>&nbsp;<span class="num" id="2936619">1</span><span class="op" id="2936620">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936626">break</span>&nbsp;<span class="ident" id="2936632">FindSaltLength</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936650">case</span>&nbsp;<span class="num" id="2936655">0</span><span class="op" id="2936656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936662">continue</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936674">default</span><span class="op" id="2936681">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936687">return</span>&nbsp;<span class="ident" id="2936694">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936717">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936721">if</span>&nbsp;<span class="ident" id="2936724">sLen</span>&nbsp;<span class="op" id="2936729">&lt;</span>&nbsp;<span class="num" id="2936731">0</span>&nbsp;<span class="op" id="2936733">{</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2936738">return</span>&nbsp;<span class="ident" id="2936745">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936763">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2936766">}</span>&nbsp;<span class="keyword" id="2936768">else</span>&nbsp;<span class="op" id="2936773">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936777">//&nbsp;10.&nbsp;If&nbsp;the&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;2&nbsp;leftmost&nbsp;octets&nbsp;of&nbsp;DB&nbsp;are&nbsp;not&nbsp;zero</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936852">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;if&nbsp;the&nbsp;octet&nbsp;at&nbsp;position&nbsp;emLen&nbsp;-&nbsp;hLen&nbsp;-&nbsp;sLen&nbsp;-&nbsp;1&nbsp;(the&nbsp;leftmost</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2936927">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;is&nbsp;&#34;position&nbsp;1&#34;)&nbsp;does&nbsp;not&nbsp;have&nbsp;hexadecimal&nbsp;value&nbsp;0x01,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937000">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;output&nbsp;&#34;inconsistent&#34;&nbsp;and&nbsp;stop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937041">for</span>&nbsp;<span class="ident" id="2937045">_</span><span class="op" id="2937046">,</span>&nbsp;<span class="ident" id="2937048">e</span>&nbsp;<span class="op" id="2937050">:=</span>&nbsp;<span class="keyword" id="2937053">range</span>&nbsp;<span class="ident" id="2937059">db</span><span class="op" id="2937061">[</span><span class="op" id="2937062">:</span><span class="ident" id="2937063">emLen</span><span class="op" id="2937068">-</span><span class="ident" id="2937069">hLen</span><span class="op" id="2937073">-</span><span class="ident" id="2937074">sLen</span><span class="op" id="2937078">-</span><span class="num" id="2937079">2</span><span class="op" id="2937080">]</span>&nbsp;<span class="op" id="2937082">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937087">if</span>&nbsp;<span class="ident" id="2937090">e</span>&nbsp;<span class="op" id="2937092">!=</span>&nbsp;<span class="num" id="2937095">0x00</span>&nbsp;<span class="op" id="2937100">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937106">return</span>&nbsp;<span class="ident" id="2937113">ErrVerification</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937132">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937136">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937140">if</span>&nbsp;<span class="ident" id="2937143">db</span><span class="op" id="2937145">[</span><span class="ident" id="2937146">emLen</span><span class="op" id="2937151">-</span><span class="ident" id="2937152">hLen</span><span class="op" id="2937156">-</span><span class="ident" id="2937157">sLen</span><span class="op" id="2937161">-</span><span class="num" id="2937162">2</span><span class="op" id="2937163">]</span>&nbsp;<span class="op" id="2937165">!=</span>&nbsp;<span class="num" id="2937168">0x01</span>&nbsp;<span class="op" id="2937173">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937178">return</span>&nbsp;<span class="ident" id="2937185">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937203">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937206">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937210">//&nbsp;11.&nbsp;&nbsp;Let&nbsp;salt&nbsp;be&nbsp;the&nbsp;last&nbsp;sLen&nbsp;octets&nbsp;of&nbsp;DB.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937259">salt</span>&nbsp;<span class="op" id="2937264">:=</span>&nbsp;<span class="ident" id="2937267">db</span><span class="op" id="2937269">[</span><span class="builtinfunc" id="2937270">len</span><span class="op" id="2937273">(</span><span class="ident" id="2937274">db</span><span class="op" id="2937276">)</span><span class="op" id="2937277">-</span><span class="ident" id="2937278">sLen</span><span class="op" id="2937282">:</span><span class="op" id="2937283">]</span><br>
<span class="lineno"></span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937287">//&nbsp;12.&nbsp;&nbsp;Let</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937300">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;=&nbsp;(0x)00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;00&nbsp;||&nbsp;mHash&nbsp;||&nbsp;salt&nbsp;;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937365">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;M&#39;&nbsp;is&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;8&nbsp;+&nbsp;hLen&nbsp;+&nbsp;sLen&nbsp;with&nbsp;eight</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937432">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;initial&nbsp;zero&nbsp;octets.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937461">//</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937465">//&nbsp;13.&nbsp;Let&nbsp;H&#39;&nbsp;=&nbsp;Hash(M&#39;),&nbsp;an&nbsp;octet&nbsp;string&nbsp;of&nbsp;length&nbsp;hLen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937524">var</span>&nbsp;<span class="ident" id="2937528">prefix</span>&nbsp;<span class="op" id="2937535">[</span><span class="num" id="2937536">8</span><span class="op" id="2937537">]</span><span class="builtintype" id="2937538">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937544">hash</span><span class="op" id="2937548">.</span><span class="ident" id="2937549">Write</span><span class="op" id="2937554">(</span><span class="ident" id="2937555">prefix</span><span class="op" id="2937561">[</span><span class="op" id="2937562">:</span><span class="op" id="2937563">]</span><span class="op" id="2937564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937567">hash</span><span class="op" id="2937571">.</span><span class="ident" id="2937572">Write</span><span class="op" id="2937577">(</span><span class="ident" id="2937578">mHash</span><span class="op" id="2937583">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937586">hash</span><span class="op" id="2937590">.</span><span class="ident" id="2937591">Write</span><span class="op" id="2937596">(</span><span class="ident" id="2937597">salt</span><span class="op" id="2937601">)</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2937605">h0</span>&nbsp;<span class="op" id="2937608">:=</span>&nbsp;<span class="ident" id="2937611">hash</span><span class="op" id="2937615">.</span><span class="ident" id="2937616">Sum</span><span class="op" id="2937619">(</span><span class="builtintype" id="2937620">nil</span><span class="op" id="2937623">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2937627">//&nbsp;14.&nbsp;If&nbsp;H&nbsp;=&nbsp;H&#39;,&nbsp;output&nbsp;&#34;consistent.&#34;&nbsp;Otherwise,&nbsp;output&nbsp;&#34;inconsistent.&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937701">if</span>&nbsp;<span class="op" id="2937704">!</span><span class="ident" id="2937705">bytes</span><span class="op" id="2937710">.</span><span class="ident" id="2937711">Equal</span><span class="op" id="2937716">(</span><span class="ident" id="2937717">h0</span><span class="op" id="2937719">,</span>&nbsp;<span class="ident" id="2937721">h</span><span class="op" id="2937722">)</span>&nbsp;<span class="op" id="2937724">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937728">return</span>&nbsp;<span class="ident" id="2937735">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2937752">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2937755">return</span>&nbsp;<span class="builtintype" id="2937762">nil</span><br>
<span class="lineno"></span><span class="op" id="2937766">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="2937769">//&nbsp;signPSSWithSalt&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;PSS&nbsp;[1]&nbsp;with&nbsp;specified&nbsp;salt.</span><br>
<span class="lineno"></span><span class="comment" id="2937858">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2937936">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;salt&nbsp;is&nbsp;a&nbsp;random&nbsp;sequence&nbsp;of&nbsp;bytes&nbsp;whose&nbsp;length&nbsp;will&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="2938016">//&nbsp;later&nbsp;used&nbsp;to&nbsp;verify&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span><span class="keyword" id="2938055">func</span>&nbsp;<span class="ident" id="2938060">signPSSWithSalt</span><span class="op" id="2938075">(</span><span class="ident" id="2938076">rand</span>&nbsp;<span class="ident" id="2938081">io</span><span class="op" id="2938083">.</span><span class="ident" id="2938084">Reader</span><span class="op" id="2938090">,</span>&nbsp;<span class="ident" id="2938092">priv</span>&nbsp;<span class="op" id="2938097">*</span><span class="ident" id="2938098">PrivateKey</span><span class="op" id="2938108">,</span>&nbsp;<span class="ident" id="2938110">hash</span>&nbsp;<span class="ident" id="2938115">crypto</span><span class="op" id="2938121">.</span><span class="ident" id="2938122">Hash</span><span class="op" id="2938126">,</span>&nbsp;<span class="ident" id="2938128">hashed</span><span class="op" id="2938134">,</span>&nbsp;<span class="ident" id="2938136">salt</span>&nbsp;<span class="op" id="2938141">[</span><span class="op" id="2938142">]</span><span class="builtintype" id="2938143">byte</span><span class="op" id="2938147">)</span>&nbsp;<span class="op" id="2938149">(</span><span class="ident" id="2938150">s</span>&nbsp;<span class="op" id="2938152">[</span><span class="op" id="2938153">]</span><span class="builtintype" id="2938154">byte</span><span class="op" id="2938158">,</span>&nbsp;<span class="ident" id="2938160">err</span>&nbsp;<span class="builtintype" id="2938164">error</span><span class="op" id="2938169">)</span>&nbsp;<span class="op" id="2938171">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938174">nBits</span>&nbsp;<span class="op" id="2938180">:=</span>&nbsp;<span class="ident" id="2938183">priv</span><span class="op" id="2938187">.</span><span class="ident" id="2938188">N</span><span class="op" id="2938189">.</span><span class="ident" id="2938190">BitLen</span><span class="op" id="2938196">(</span><span class="op" id="2938197">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938200">em</span><span class="op" id="2938202">,</span>&nbsp;<span class="ident" id="2938204">err</span>&nbsp;<span class="op" id="2938208">:=</span>&nbsp;<span class="ident" id="2938211">emsaPSSEncode</span><span class="op" id="2938224">(</span><span class="ident" id="2938225">hashed</span><span class="op" id="2938231">,</span>&nbsp;<span class="ident" id="2938233">nBits</span><span class="op" id="2938238">-</span><span class="num" id="2938239">1</span><span class="op" id="2938240">,</span>&nbsp;<span class="ident" id="2938242">salt</span><span class="op" id="2938246">,</span>&nbsp;<span class="ident" id="2938248">hash</span><span class="op" id="2938252">.</span><span class="ident" id="2938253">New</span><span class="op" id="2938256">(</span><span class="op" id="2938257">)</span><span class="op" id="2938258">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938261">if</span>&nbsp;<span class="ident" id="2938264">err</span>&nbsp;<span class="op" id="2938268">!=</span>&nbsp;<span class="builtintype" id="2938271">nil</span>&nbsp;<span class="op" id="2938275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938279">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2938287">}</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938290">m</span>&nbsp;<span class="op" id="2938292">:=</span>&nbsp;<span class="builtinfunc" id="2938295">new</span><span class="op" id="2938298">(</span><span class="ident" id="2938299">big</span><span class="op" id="2938302">.</span><span class="ident" id="2938303">Int</span><span class="op" id="2938306">)</span><span class="op" id="2938307">.</span><span class="ident" id="2938308">SetBytes</span><span class="op" id="2938316">(</span><span class="ident" id="2938317">em</span><span class="op" id="2938319">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938322">c</span><span class="op" id="2938323">,</span>&nbsp;<span class="ident" id="2938325">err</span>&nbsp;<span class="op" id="2938329">:=</span>&nbsp;<span class="ident" id="2938332">decrypt</span><span class="op" id="2938339">(</span><span class="ident" id="2938340">rand</span><span class="op" id="2938344">,</span>&nbsp;<span class="ident" id="2938346">priv</span><span class="op" id="2938350">,</span>&nbsp;<span class="ident" id="2938352">m</span><span class="op" id="2938353">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938356">if</span>&nbsp;<span class="ident" id="2938359">err</span>&nbsp;<span class="op" id="2938363">!=</span>&nbsp;<span class="builtintype" id="2938366">nil</span>&nbsp;<span class="op" id="2938370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938374">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2938382">}</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938385">s</span>&nbsp;<span class="op" id="2938387">=</span>&nbsp;<span class="builtinfunc" id="2938389">make</span><span class="op" id="2938393">(</span><span class="op" id="2938394">[</span><span class="op" id="2938395">]</span><span class="builtintype" id="2938396">byte</span><span class="op" id="2938400">,</span>&nbsp;<span class="op" id="2938402">(</span><span class="ident" id="2938403">nBits</span><span class="op" id="2938408">+</span><span class="num" id="2938409">7</span><span class="op" id="2938410">)</span><span class="op" id="2938411">/</span><span class="num" id="2938412">8</span><span class="op" id="2938413">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938416">copyWithLeftPad</span><span class="op" id="2938431">(</span><span class="ident" id="2938432">s</span><span class="op" id="2938433">,</span>&nbsp;<span class="ident" id="2938435">c</span><span class="op" id="2938436">.</span><span class="ident" id="2938437">Bytes</span><span class="op" id="2938442">(</span><span class="op" id="2938443">)</span><span class="op" id="2938444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2938447">return</span><br>
<span class="lineno"></span><span class="op" id="2938454">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">210</span><span class="keyword" id="2938457">const</span>&nbsp;<span class="op" id="2938463">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938466">//&nbsp;PSSSaltLengthAuto&nbsp;causes&nbsp;the&nbsp;salt&nbsp;in&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;to&nbsp;be&nbsp;as&nbsp;large</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938538">//&nbsp;as&nbsp;possible&nbsp;when&nbsp;signing,&nbsp;and&nbsp;to&nbsp;be&nbsp;auto-detected&nbsp;when&nbsp;verifying.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938608">PSSSaltLengthAuto</span>&nbsp;<span class="op" id="2938626">=</span>&nbsp;<span class="num" id="2938628">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938631">//&nbsp;PSSSaltLengthEqualsHash&nbsp;causes&nbsp;the&nbsp;salt&nbsp;length&nbsp;to&nbsp;equal&nbsp;the&nbsp;length</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938702">//&nbsp;of&nbsp;the&nbsp;hash&nbsp;used&nbsp;in&nbsp;the&nbsp;signature.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2938741">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="2938765">=</span>&nbsp;<span class="op" id="2938767">-</span><span class="num" id="2938768">1</span><br>
<span class="lineno"></span><span class="op" id="2938770">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2938773">//&nbsp;PSSOptions&nbsp;contains&nbsp;options&nbsp;for&nbsp;creating&nbsp;and&nbsp;verifying&nbsp;PSS&nbsp;signatures.</span><br>
<span class="lineno">220</span><span class="keyword" id="2938847">type</span>&nbsp;<span class="ident" id="2938852">PSSOptions</span>&nbsp;<span class="keyword" id="2938863">struct</span>&nbsp;<span class="op" id="2938870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938873">//&nbsp;SaltLength&nbsp;controls&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;salt&nbsp;used&nbsp;in&nbsp;the&nbsp;PSS</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2938936">//&nbsp;signature.&nbsp;It&nbsp;can&nbsp;either&nbsp;be&nbsp;a&nbsp;number&nbsp;of&nbsp;bytes,&nbsp;or&nbsp;one&nbsp;of&nbsp;the&nbsp;special</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2939009">//&nbsp;PSSSaltLength&nbsp;constants.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939038">SaltLength</span>&nbsp;<span class="builtintype" id="2939049">int</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2939055">//&nbsp;Hash,&nbsp;if&nbsp;not&nbsp;zero,&nbsp;overrides&nbsp;the&nbsp;hash&nbsp;function&nbsp;passed&nbsp;to&nbsp;SignPSS.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2939125">//&nbsp;This&nbsp;is&nbsp;the&nbsp;only&nbsp;way&nbsp;to&nbsp;specify&nbsp;the&nbsp;hash&nbsp;function&nbsp;when&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="2939194">//&nbsp;crypto.Signer&nbsp;interface.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939223">Hash</span>&nbsp;<span class="ident" id="2939228">crypto</span><span class="op" id="2939234">.</span><span class="ident" id="2939235">Hash</span><br>
<span class="lineno">230</span><span class="op" id="2939240">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2939243">//&nbsp;HashFunc&nbsp;returns&nbsp;pssOpts.Hash&nbsp;so&nbsp;that&nbsp;PSSOptions&nbsp;implements</span><br>
<span class="lineno"></span><span class="comment" id="2939306">//&nbsp;crypto.SignerOpts.</span><br>
<span class="lineno"></span><span class="keyword" id="2939328">func</span>&nbsp;<span class="op" id="2939333">(</span><span class="ident" id="2939334">pssOpts</span>&nbsp;<span class="op" id="2939342">*</span><span class="ident" id="2939343">PSSOptions</span><span class="op" id="2939353">)</span>&nbsp;<span class="ident" id="2939355">HashFunc</span><span class="op" id="2939363">(</span><span class="op" id="2939364">)</span>&nbsp;<span class="ident" id="2939366">crypto</span><span class="op" id="2939372">.</span><span class="ident" id="2939373">Hash</span>&nbsp;<span class="op" id="2939378">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939381">return</span>&nbsp;<span class="ident" id="2939388">pssOpts</span><span class="op" id="2939395">.</span><span class="ident" id="2939396">Hash</span><br>
<span class="lineno"></span><span class="op" id="2939401">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2939404">func</span>&nbsp;<span class="op" id="2939409">(</span><span class="ident" id="2939410">opts</span>&nbsp;<span class="op" id="2939415">*</span><span class="ident" id="2939416">PSSOptions</span><span class="op" id="2939426">)</span>&nbsp;<span class="ident" id="2939428">saltLength</span><span class="op" id="2939438">(</span><span class="op" id="2939439">)</span>&nbsp;<span class="builtintype" id="2939441">int</span>&nbsp;<span class="op" id="2939445">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939448">if</span>&nbsp;<span class="ident" id="2939451">opts</span>&nbsp;<span class="op" id="2939456">==</span>&nbsp;<span class="builtintype" id="2939459">nil</span>&nbsp;<span class="op" id="2939463">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939467">return</span>&nbsp;<span class="ident" id="2939474">PSSSaltLengthAuto</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2939493">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939496">return</span>&nbsp;<span class="ident" id="2939503">opts</span><span class="op" id="2939507">.</span><span class="ident" id="2939508">SaltLength</span><br>
<span class="lineno"></span><span class="op" id="2939519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">245</span><span class="comment" id="2939522">//&nbsp;SignPSS&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PSS&nbsp;[1].</span><br>
<span class="lineno"></span><span class="comment" id="2939590">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="2939668">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="2939745">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2939767">func</span>&nbsp;<span class="ident" id="2939772">SignPSS</span><span class="op" id="2939779">(</span><span class="ident" id="2939780">rand</span>&nbsp;<span class="ident" id="2939785">io</span><span class="op" id="2939787">.</span><span class="ident" id="2939788">Reader</span><span class="op" id="2939794">,</span>&nbsp;<span class="ident" id="2939796">priv</span>&nbsp;<span class="op" id="2939801">*</span><span class="ident" id="2939802">PrivateKey</span><span class="op" id="2939812">,</span>&nbsp;<span class="ident" id="2939814">hash</span>&nbsp;<span class="ident" id="2939819">crypto</span><span class="op" id="2939825">.</span><span class="ident" id="2939826">Hash</span><span class="op" id="2939830">,</span>&nbsp;<span class="ident" id="2939832">hashed</span>&nbsp;<span class="op" id="2939839">[</span><span class="op" id="2939840">]</span><span class="builtintype" id="2939841">byte</span><span class="op" id="2939845">,</span>&nbsp;<span class="ident" id="2939847">opts</span>&nbsp;<span class="op" id="2939852">*</span><span class="ident" id="2939853">PSSOptions</span><span class="op" id="2939863">)</span>&nbsp;<span class="op" id="2939865">(</span><span class="ident" id="2939866">s</span>&nbsp;<span class="op" id="2939868">[</span><span class="op" id="2939869">]</span><span class="builtintype" id="2939870">byte</span><span class="op" id="2939874">,</span>&nbsp;<span class="ident" id="2939876">err</span>&nbsp;<span class="builtintype" id="2939880">error</span><span class="op" id="2939885">)</span>&nbsp;<span class="op" id="2939887">{</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939890">saltLength</span>&nbsp;<span class="op" id="2939901">:=</span>&nbsp;<span class="ident" id="2939904">opts</span><span class="op" id="2939908">.</span><span class="ident" id="2939909">saltLength</span><span class="op" id="2939919">(</span><span class="op" id="2939920">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939923">switch</span>&nbsp;<span class="ident" id="2939930">saltLength</span>&nbsp;<span class="op" id="2939941">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2939944">case</span>&nbsp;<span class="ident" id="2939949">PSSSaltLengthAuto</span><span class="op" id="2939966">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2939970">saltLength</span>&nbsp;<span class="op" id="2939981">=</span>&nbsp;<span class="op" id="2939983">(</span><span class="ident" id="2939984">priv</span><span class="op" id="2939988">.</span><span class="ident" id="2939989">N</span><span class="op" id="2939990">.</span><span class="ident" id="2939991">BitLen</span><span class="op" id="2939997">(</span><span class="op" id="2939998">)</span><span class="op" id="2939999">+</span><span class="num" id="2940000">7</span><span class="op" id="2940001">)</span><span class="op" id="2940002">/</span><span class="num" id="2940003">8</span>&nbsp;<span class="op" id="2940005">-</span>&nbsp;<span class="num" id="2940007">2</span>&nbsp;<span class="op" id="2940009">-</span>&nbsp;<span class="ident" id="2940011">hash</span><span class="op" id="2940015">.</span><span class="ident" id="2940016">Size</span><span class="op" id="2940020">(</span><span class="op" id="2940021">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940024">case</span>&nbsp;<span class="ident" id="2940029">PSSSaltLengthEqualsHash</span><span class="op" id="2940052">:</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2940056">saltLength</span>&nbsp;<span class="op" id="2940067">=</span>&nbsp;<span class="ident" id="2940069">hash</span><span class="op" id="2940073">.</span><span class="ident" id="2940074">Size</span><span class="op" id="2940078">(</span><span class="op" id="2940079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2940082">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940086">if</span>&nbsp;<span class="ident" id="2940089">opts</span><span class="op" id="2940093">.</span><span class="ident" id="2940094">Hash</span>&nbsp;<span class="op" id="2940099">!=</span>&nbsp;<span class="num" id="2940102">0</span>&nbsp;<span class="op" id="2940104">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2940108">hash</span>&nbsp;<span class="op" id="2940113">=</span>&nbsp;<span class="ident" id="2940115">opts</span><span class="op" id="2940119">.</span><span class="ident" id="2940120">Hash</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2940126">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2940130">salt</span>&nbsp;<span class="op" id="2940135">:=</span>&nbsp;<span class="builtinfunc" id="2940138">make</span><span class="op" id="2940142">(</span><span class="op" id="2940143">[</span><span class="op" id="2940144">]</span><span class="builtintype" id="2940145">byte</span><span class="op" id="2940149">,</span>&nbsp;<span class="ident" id="2940151">saltLength</span><span class="op" id="2940161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940164">if</span>&nbsp;<span class="ident" id="2940167">_</span><span class="op" id="2940168">,</span>&nbsp;<span class="ident" id="2940170">err</span>&nbsp;<span class="op" id="2940174">=</span>&nbsp;<span class="ident" id="2940176">io</span><span class="op" id="2940178">.</span><span class="ident" id="2940179">ReadFull</span><span class="op" id="2940187">(</span><span class="ident" id="2940188">rand</span><span class="op" id="2940192">,</span>&nbsp;<span class="ident" id="2940194">salt</span><span class="op" id="2940198">)</span><span class="op" id="2940199">;</span>&nbsp;<span class="ident" id="2940201">err</span>&nbsp;<span class="op" id="2940205">!=</span>&nbsp;<span class="builtintype" id="2940208">nil</span>&nbsp;<span class="op" id="2940212">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940216">return</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2940224">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940227">return</span>&nbsp;<span class="ident" id="2940234">signPSSWithSalt</span><span class="op" id="2940249">(</span><span class="ident" id="2940250">rand</span><span class="op" id="2940254">,</span>&nbsp;<span class="ident" id="2940256">priv</span><span class="op" id="2940260">,</span>&nbsp;<span class="ident" id="2940262">hash</span><span class="op" id="2940266">,</span>&nbsp;<span class="ident" id="2940268">hashed</span><span class="op" id="2940274">,</span>&nbsp;<span class="ident" id="2940276">salt</span><span class="op" id="2940280">)</span><br>
<span class="lineno"></span><span class="op" id="2940282">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2940285">//&nbsp;VerifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature.</span><br>
<span class="lineno">270</span><span class="comment" id="2940324">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="2940398">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="2940470">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;The&nbsp;opts&nbsp;argument&nbsp;may&nbsp;be&nbsp;nil,&nbsp;in&nbsp;which&nbsp;case&nbsp;sensible</span><br>
<span class="lineno"></span><span class="comment" id="2940549">//&nbsp;defaults&nbsp;are&nbsp;used.</span><br>
<span class="lineno"></span><span class="keyword" id="2940571">func</span>&nbsp;<span class="ident" id="2940576">VerifyPSS</span><span class="op" id="2940585">(</span><span class="ident" id="2940586">pub</span>&nbsp;<span class="op" id="2940590">*</span><span class="ident" id="2940591">PublicKey</span><span class="op" id="2940600">,</span>&nbsp;<span class="ident" id="2940602">hash</span>&nbsp;<span class="ident" id="2940607">crypto</span><span class="op" id="2940613">.</span><span class="ident" id="2940614">Hash</span><span class="op" id="2940618">,</span>&nbsp;<span class="ident" id="2940620">hashed</span>&nbsp;<span class="op" id="2940627">[</span><span class="op" id="2940628">]</span><span class="builtintype" id="2940629">byte</span><span class="op" id="2940633">,</span>&nbsp;<span class="ident" id="2940635">sig</span>&nbsp;<span class="op" id="2940639">[</span><span class="op" id="2940640">]</span><span class="builtintype" id="2940641">byte</span><span class="op" id="2940645">,</span>&nbsp;<span class="ident" id="2940647">opts</span>&nbsp;<span class="op" id="2940652">*</span><span class="ident" id="2940653">PSSOptions</span><span class="op" id="2940663">)</span>&nbsp;<span class="builtintype" id="2940665">error</span>&nbsp;<span class="op" id="2940671">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940674">return</span>&nbsp;<span class="ident" id="2940681">verifyPSS</span><span class="op" id="2940690">(</span><span class="ident" id="2940691">pub</span><span class="op" id="2940694">,</span>&nbsp;<span class="ident" id="2940696">hash</span><span class="op" id="2940700">,</span>&nbsp;<span class="ident" id="2940702">hashed</span><span class="op" id="2940708">,</span>&nbsp;<span class="ident" id="2940710">sig</span><span class="op" id="2940713">,</span>&nbsp;<span class="ident" id="2940715">opts</span><span class="op" id="2940719">.</span><span class="ident" id="2940720">saltLength</span><span class="op" id="2940730">(</span><span class="op" id="2940731">)</span><span class="op" id="2940732">)</span><br>
<span class="lineno"></span><span class="op" id="2940734">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2940737">//&nbsp;verifyPSS&nbsp;verifies&nbsp;a&nbsp;PSS&nbsp;signature&nbsp;with&nbsp;the&nbsp;given&nbsp;salt&nbsp;length.</span><br>
<span class="lineno"></span><span class="keyword" id="2940803">func</span>&nbsp;<span class="ident" id="2940808">verifyPSS</span><span class="op" id="2940817">(</span><span class="ident" id="2940818">pub</span>&nbsp;<span class="op" id="2940822">*</span><span class="ident" id="2940823">PublicKey</span><span class="op" id="2940832">,</span>&nbsp;<span class="ident" id="2940834">hash</span>&nbsp;<span class="ident" id="2940839">crypto</span><span class="op" id="2940845">.</span><span class="ident" id="2940846">Hash</span><span class="op" id="2940850">,</span>&nbsp;<span class="ident" id="2940852">hashed</span>&nbsp;<span class="op" id="2940859">[</span><span class="op" id="2940860">]</span><span class="builtintype" id="2940861">byte</span><span class="op" id="2940865">,</span>&nbsp;<span class="ident" id="2940867">sig</span>&nbsp;<span class="op" id="2940871">[</span><span class="op" id="2940872">]</span><span class="builtintype" id="2940873">byte</span><span class="op" id="2940877">,</span>&nbsp;<span class="ident" id="2940879">saltLen</span>&nbsp;<span class="builtintype" id="2940887">int</span><span class="op" id="2940890">)</span>&nbsp;<span class="builtintype" id="2940892">error</span>&nbsp;<span class="op" id="2940898">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2940901">nBits</span>&nbsp;<span class="op" id="2940907">:=</span>&nbsp;<span class="ident" id="2940910">pub</span><span class="op" id="2940913">.</span><span class="ident" id="2940914">N</span><span class="op" id="2940915">.</span><span class="ident" id="2940916">BitLen</span><span class="op" id="2940922">(</span><span class="op" id="2940923">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940926">if</span>&nbsp;<span class="builtinfunc" id="2940929">len</span><span class="op" id="2940932">(</span><span class="ident" id="2940933">sig</span><span class="op" id="2940936">)</span>&nbsp;<span class="op" id="2940938">!=</span>&nbsp;<span class="op" id="2940941">(</span><span class="ident" id="2940942">nBits</span><span class="op" id="2940947">+</span><span class="num" id="2940948">7</span><span class="op" id="2940949">)</span><span class="op" id="2940950">/</span><span class="num" id="2940951">8</span>&nbsp;<span class="op" id="2940953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2940957">return</span>&nbsp;<span class="ident" id="2940964">ErrVerification</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2940981">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2940984">s</span>&nbsp;<span class="op" id="2940986">:=</span>&nbsp;<span class="builtinfunc" id="2940989">new</span><span class="op" id="2940992">(</span><span class="ident" id="2940993">big</span><span class="op" id="2940996">.</span><span class="ident" id="2940997">Int</span><span class="op" id="2941000">)</span><span class="op" id="2941001">.</span><span class="ident" id="2941002">SetBytes</span><span class="op" id="2941010">(</span><span class="ident" id="2941011">sig</span><span class="op" id="2941014">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941017">m</span>&nbsp;<span class="op" id="2941019">:=</span>&nbsp;<span class="ident" id="2941022">encrypt</span><span class="op" id="2941029">(</span><span class="builtinfunc" id="2941030">new</span><span class="op" id="2941033">(</span><span class="ident" id="2941034">big</span><span class="op" id="2941037">.</span><span class="ident" id="2941038">Int</span><span class="op" id="2941041">)</span><span class="op" id="2941042">,</span>&nbsp;<span class="ident" id="2941044">pub</span><span class="op" id="2941047">,</span>&nbsp;<span class="ident" id="2941049">s</span><span class="op" id="2941050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941053">emBits</span>&nbsp;<span class="op" id="2941060">:=</span>&nbsp;<span class="ident" id="2941063">nBits</span>&nbsp;<span class="op" id="2941069">-</span>&nbsp;<span class="num" id="2941071">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941074">emLen</span>&nbsp;<span class="op" id="2941080">:=</span>&nbsp;<span class="op" id="2941083">(</span><span class="ident" id="2941084">emBits</span>&nbsp;<span class="op" id="2941091">+</span>&nbsp;<span class="num" id="2941093">7</span><span class="op" id="2941094">)</span>&nbsp;<span class="op" id="2941096">/</span>&nbsp;<span class="num" id="2941098">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2941101">if</span>&nbsp;<span class="ident" id="2941104">emLen</span>&nbsp;<span class="op" id="2941110">&lt;</span>&nbsp;<span class="builtinfunc" id="2941112">len</span><span class="op" id="2941115">(</span><span class="ident" id="2941116">m</span><span class="op" id="2941117">.</span><span class="ident" id="2941118">Bytes</span><span class="op" id="2941123">(</span><span class="op" id="2941124">)</span><span class="op" id="2941125">)</span>&nbsp;<span class="op" id="2941127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2941131">return</span>&nbsp;<span class="ident" id="2941138">ErrVerification</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2941155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941158">em</span>&nbsp;<span class="op" id="2941161">:=</span>&nbsp;<span class="builtinfunc" id="2941164">make</span><span class="op" id="2941168">(</span><span class="op" id="2941169">[</span><span class="op" id="2941170">]</span><span class="builtintype" id="2941171">byte</span><span class="op" id="2941175">,</span>&nbsp;<span class="ident" id="2941177">emLen</span><span class="op" id="2941182">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941185">copyWithLeftPad</span><span class="op" id="2941200">(</span><span class="ident" id="2941201">em</span><span class="op" id="2941203">,</span>&nbsp;<span class="ident" id="2941205">m</span><span class="op" id="2941206">.</span><span class="ident" id="2941207">Bytes</span><span class="op" id="2941212">(</span><span class="op" id="2941213">)</span><span class="op" id="2941214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2941217">if</span>&nbsp;<span class="ident" id="2941220">saltLen</span>&nbsp;<span class="op" id="2941228">==</span>&nbsp;<span class="ident" id="2941231">PSSSaltLengthEqualsHash</span>&nbsp;<span class="op" id="2941255">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="2941259">saltLen</span>&nbsp;<span class="op" id="2941267">=</span>&nbsp;<span class="ident" id="2941269">hash</span><span class="op" id="2941273">.</span><span class="ident" id="2941274">Size</span><span class="op" id="2941278">(</span><span class="op" id="2941279">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="2941282">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="2941285">return</span>&nbsp;<span class="ident" id="2941292">emsaPSSVerify</span><span class="op" id="2941305">(</span><span class="ident" id="2941306">hashed</span><span class="op" id="2941312">,</span>&nbsp;<span class="ident" id="2941314">em</span><span class="op" id="2941316">,</span>&nbsp;<span class="ident" id="2941318">emBits</span><span class="op" id="2941324">,</span>&nbsp;<span class="ident" id="2941326">saltLen</span><span class="op" id="2941333">,</span>&nbsp;<span class="ident" id="2941335">hash</span><span class="op" id="2941339">.</span><span class="ident" id="2941340">New</span><span class="op" id="2941343">(</span><span class="op" id="2941344">)</span><span class="op" id="2941345">)</span><br>
<span class="lineno"></span><span class="op" id="2941347">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
