<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4073179">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4073234">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4073288">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4073339">//&nbsp;+build&nbsp;dragonfly&nbsp;freebsd&nbsp;linux&nbsp;nacl&nbsp;netbsd&nbsp;openbsd&nbsp;solaris</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4073402">package</span>&nbsp;<span class="ident" id="4073410">x509</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4073416">import</span>&nbsp;<span class="string" id="4073423">&#34;io/ioutil&#34;</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="4073436">//&nbsp;Possible&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;finding&nbsp;one.</span><br>
<span class="lineno"></span><span class="keyword" id="4073491">var</span>&nbsp;<span class="ident" id="4073495">certFiles</span>&nbsp;<span class="op" id="4073505">=</span>&nbsp;<span class="op" id="4073507">[</span><span class="op" id="4073508">]</span><span class="builtintype" id="4073509">string</span><span class="op" id="4073515">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073518">&#34;/etc/ssl/certs/ca-certificates.crt&#34;</span><span class="op" id="4073554">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073560">//&nbsp;Debian/Ubuntu/Gentoo&nbsp;etc.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073590">&#34;/etc/pki/tls/certs/ca-bundle.crt&#34;</span><span class="op" id="4073624">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073632">//&nbsp;Fedora/RHEL</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073648">&#34;/etc/ssl/ca-bundle.pem&#34;</span><span class="op" id="4073672">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073690">//&nbsp;OpenSUSE</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073703">&#34;/etc/ssl/cert.pem&#34;</span><span class="op" id="4073722">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073745">//&nbsp;OpenBSD</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073757">&#34;/usr/local/share/certs/ca-root-nss.crt&#34;</span><span class="op" id="4073797">,</span>&nbsp;<span class="comment" id="4073799">//&nbsp;FreeBSD/DragonFly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073821">&#34;/etc/pki/tls/cacert.pem&#34;</span><span class="op" id="4073846">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073863">//&nbsp;OpenELEC</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4073876">&#34;/etc/certs/ca-certificates.crt&#34;</span><span class="op" id="4073908">,</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4073918">//&nbsp;Solaris&nbsp;11.2+</span><br>
<span class="lineno">20</span><span class="op" id="4073935">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4073938">//&nbsp;Possible&nbsp;directories&nbsp;with&nbsp;certificate&nbsp;files;&nbsp;stop&nbsp;after&nbsp;successfully</span><br>
<span class="lineno"></span><span class="comment" id="4074010">//&nbsp;reading&nbsp;at&nbsp;least&nbsp;one&nbsp;file&nbsp;from&nbsp;a&nbsp;directory.</span><br>
<span class="lineno"></span><span class="keyword" id="4074057">var</span>&nbsp;<span class="ident" id="4074061">certDirectories</span>&nbsp;<span class="op" id="4074077">=</span>&nbsp;<span class="op" id="4074079">[</span><span class="op" id="4074080">]</span><span class="builtintype" id="4074081">string</span><span class="op" id="4074087">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4074090">&#34;/system/etc/security/cacerts&#34;</span><span class="op" id="4074120">,</span>&nbsp;<span class="comment" id="4074122">//&nbsp;Android</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="op" id="4074134">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074137">func</span>&nbsp;<span class="op" id="4074142">(</span><span class="ident" id="4074143">c</span>&nbsp;<span class="op" id="4074145">*</span><span class="ident" id="4074146">Certificate</span><span class="op" id="4074157">)</span>&nbsp;<span class="ident" id="4074159">systemVerify</span><span class="op" id="4074171">(</span><span class="ident" id="4074172">opts</span>&nbsp;<span class="op" id="4074177">*</span><span class="ident" id="4074178">VerifyOptions</span><span class="op" id="4074191">)</span>&nbsp;<span class="op" id="4074193">(</span><span class="ident" id="4074194">chains</span>&nbsp;<span class="op" id="4074201">[</span><span class="op" id="4074202">]</span><span class="op" id="4074203">[</span><span class="op" id="4074204">]</span><span class="op" id="4074205">*</span><span class="ident" id="4074206">Certificate</span><span class="op" id="4074217">,</span>&nbsp;<span class="ident" id="4074219">err</span>&nbsp;<span class="builtintype" id="4074223">error</span><span class="op" id="4074228">)</span>&nbsp;<span class="op" id="4074230">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074233">return</span>&nbsp;<span class="ident" id="4074240">nil</span><span class="op" id="4074243">,</span>&nbsp;<span class="ident" id="4074245">nil</span><br>
<span class="lineno"></span><span class="op" id="4074249">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4074252">func</span>&nbsp;<span class="ident" id="4074257">initSystemRoots</span><span class="op" id="4074272">(</span><span class="op" id="4074273">)</span>&nbsp;<span class="op" id="4074275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074278">roots</span>&nbsp;<span class="op" id="4074284">:=</span>&nbsp;<span class="ident" id="4074287">NewCertPool</span><span class="op" id="4074298">(</span><span class="op" id="4074299">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074302">for</span>&nbsp;<span class="ident" id="4074306">_</span><span class="op" id="4074307">,</span>&nbsp;<span class="ident" id="4074309">file</span>&nbsp;<span class="op" id="4074314">:=</span>&nbsp;<span class="keyword" id="4074317">range</span>&nbsp;<span class="ident" id="4074323">certFiles</span>&nbsp;<span class="op" id="4074333">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074337">data</span><span class="op" id="4074341">,</span>&nbsp;<span class="ident" id="4074343">err</span>&nbsp;<span class="op" id="4074347">:=</span>&nbsp;<span class="ident" id="4074350">ioutil</span><span class="op" id="4074356">.</span><span class="ident" id="4074357">ReadFile</span><span class="op" id="4074365">(</span><span class="ident" id="4074366">file</span><span class="op" id="4074370">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074374">if</span>&nbsp;<span class="ident" id="4074377">err</span>&nbsp;<span class="op" id="4074381">==</span>&nbsp;<span class="ident" id="4074384">nil</span>&nbsp;<span class="op" id="4074388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074393">roots</span><span class="op" id="4074398">.</span><span class="ident" id="4074399">AppendCertsFromPEM</span><span class="op" id="4074417">(</span><span class="ident" id="4074418">data</span><span class="op" id="4074422">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074427">systemRoots</span>&nbsp;<span class="op" id="4074439">=</span>&nbsp;<span class="ident" id="4074441">roots</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074450">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074459">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074462">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074466">for</span>&nbsp;<span class="ident" id="4074470">_</span><span class="op" id="4074471">,</span>&nbsp;<span class="ident" id="4074473">directory</span>&nbsp;<span class="op" id="4074483">:=</span>&nbsp;<span class="keyword" id="4074486">range</span>&nbsp;<span class="ident" id="4074492">certDirectories</span>&nbsp;<span class="op" id="4074508">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074512">fis</span><span class="op" id="4074515">,</span>&nbsp;<span class="ident" id="4074517">err</span>&nbsp;<span class="op" id="4074521">:=</span>&nbsp;<span class="ident" id="4074524">ioutil</span><span class="op" id="4074530">.</span><span class="ident" id="4074531">ReadDir</span><span class="op" id="4074538">(</span><span class="ident" id="4074539">directory</span><span class="op" id="4074548">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074552">if</span>&nbsp;<span class="ident" id="4074555">err</span>&nbsp;<span class="op" id="4074559">!=</span>&nbsp;<span class="ident" id="4074562">nil</span>&nbsp;<span class="op" id="4074566">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074571">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074582">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074586">rootsAdded</span>&nbsp;<span class="op" id="4074597">:=</span>&nbsp;<span class="ident" id="4074600">false</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074608">for</span>&nbsp;<span class="ident" id="4074612">_</span><span class="op" id="4074613">,</span>&nbsp;<span class="ident" id="4074615">fi</span>&nbsp;<span class="op" id="4074618">:=</span>&nbsp;<span class="keyword" id="4074621">range</span>&nbsp;<span class="ident" id="4074627">fis</span>&nbsp;<span class="op" id="4074631">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074636">data</span><span class="op" id="4074640">,</span>&nbsp;<span class="ident" id="4074642">err</span>&nbsp;<span class="op" id="4074646">:=</span>&nbsp;<span class="ident" id="4074649">ioutil</span><span class="op" id="4074655">.</span><span class="ident" id="4074656">ReadFile</span><span class="op" id="4074664">(</span><span class="ident" id="4074665">directory</span>&nbsp;<span class="op" id="4074675">+</span>&nbsp;<span class="string" id="4074677">&#34;/&#34;</span>&nbsp;<span class="op" id="4074681">+</span>&nbsp;<span class="ident" id="4074683">fi</span><span class="op" id="4074685">.</span><span class="ident" id="4074686">Name</span><span class="op" id="4074690">(</span><span class="op" id="4074691">)</span><span class="op" id="4074692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074697">if</span>&nbsp;<span class="ident" id="4074700">err</span>&nbsp;<span class="op" id="4074704">==</span>&nbsp;<span class="ident" id="4074707">nil</span>&nbsp;<span class="op" id="4074711">&amp;&amp;</span>&nbsp;<span class="ident" id="4074714">roots</span><span class="op" id="4074719">.</span><span class="ident" id="4074720">AppendCertsFromPEM</span><span class="op" id="4074738">(</span><span class="ident" id="4074739">data</span><span class="op" id="4074743">)</span>&nbsp;<span class="op" id="4074745">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074751">rootsAdded</span>&nbsp;<span class="op" id="4074762">=</span>&nbsp;<span class="ident" id="4074764">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074772">}</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074776">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074780">if</span>&nbsp;<span class="ident" id="4074783">rootsAdded</span>&nbsp;<span class="op" id="4074794">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4074799">systemRoots</span>&nbsp;<span class="op" id="4074811">=</span>&nbsp;<span class="ident" id="4074813">roots</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4074822">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074831">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4074834">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074838">//&nbsp;All&nbsp;of&nbsp;the&nbsp;files&nbsp;failed&nbsp;to&nbsp;load.&nbsp;systemRoots&nbsp;will&nbsp;be&nbsp;nil&nbsp;which&nbsp;will</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4074910">//&nbsp;trigger&nbsp;a&nbsp;specific&nbsp;error&nbsp;at&nbsp;verification&nbsp;time.</span><br>
<span class="lineno"></span><span class="op" id="4074960">}</span>
</div>
</body>
</html>
