<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net</h2>
<ul>
<li><a href="/gostd/net/cgo_stub.go.html">cgo_stub.go</a></li>
<li><a href="/gostd/net/conn_test.go.html">conn_test.go</a></li>
<li><a href="/gostd/net/dial.go.html">dial.go</a></li>
<li><a href="/gostd/net/dial_test.go.html">dial_test.go</a></li>
<li><a href="/gostd/net/dialgoogle_test.go.html">dialgoogle_test.go</a></li>
<li><a href="/gostd/net/dnsclient.go.html">dnsclient.go</a></li>
<li><a href="/gostd/net/dnsclient_test.go.html">dnsclient_test.go</a></li>
<li><a href="/gostd/net/dnsclient_unix.go.html">dnsclient_unix.go</a></li>
<li><a href="/gostd/net/dnsclient_unix_test.go.html">dnsclient_unix_test.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix.go.html">dnsconfig_unix.go</a></li>
<li><a href="/gostd/net/dnsconfig_unix_test.go.html">dnsconfig_unix_test.go</a></li>
<li><a href="/gostd/net/dnsmsg.go.html">dnsmsg.go</a></li>
<li><a href="/gostd/net/dnsmsg_test.go.html">dnsmsg_test.go</a></li>
<li><a href="/gostd/net/dnsname_test.go.html">dnsname_test.go</a></li>
<li><a href="/gostd/net/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/net/fd_mutex.go.html">fd_mutex.go</a></li>
<li><a href="/gostd/net/fd_mutex_test.go.html">fd_mutex_test.go</a></li>
<li><a href="/gostd/net/fd_poll_runtime.go.html">fd_poll_runtime.go</a></li>
<li><a href="/gostd/net/fd_unix.go.html">fd_unix.go</a></li>
<li><a href="/gostd/net/fd_unix_test.go.html">fd_unix_test.go</a></li>
<li><a href="/gostd/net/file_test.go.html">file_test.go</a></li>
<li><a href="/gostd/net/file_unix.go.html">file_unix.go</a></li>
<li><a href="/gostd/net/hosts.go.html">hosts.go</a></li>
<li><a href="/gostd/net/hosts_test.go.html">hosts_test.go</a></li>
<li><a href="/gostd/net/interface.go.html">interface.go</a></li>
<li><a href="/gostd/net/interface_linux.go.html">interface_linux.go</a></li>
<li><a href="/gostd/net/interface_linux_test.go.html">interface_linux_test.go</a></li>
<li><a href="/gostd/net/interface_test.go.html">interface_test.go</a></li>
<li><a href="/gostd/net/interface_unix_test.go.html">interface_unix_test.go</a></li>
<li><a href="/gostd/net/ip.go.html">ip.go</a></li>
<li><a href="/gostd/net/ip_test.go.html">ip_test.go</a></li>
<li><a href="/gostd/net/ipraw_test.go.html">ipraw_test.go</a></li>
<li><a href="/gostd/net/iprawsock.go.html">iprawsock.go</a></li>
<li><a href="/gostd/net/iprawsock_posix.go.html">iprawsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock.go.html">ipsock.go</a></li>
<li><a href="/gostd/net/ipsock_posix.go.html">ipsock_posix.go</a></li>
<li><a href="/gostd/net/ipsock_test.go.html">ipsock_test.go</a></li>
<li><a href="/gostd/net/lookup.go.html">lookup.go</a></li>
<li><a href="/gostd/net/lookup_test.go.html">lookup_test.go</a></li>
<li><a href="/gostd/net/lookup_unix.go.html">lookup_unix.go</a></li>
<li><a href="/gostd/net/mac.go.html">mac.go</a></li>
<li><a href="/gostd/net/mac_test.go.html">mac_test.go</a></li>
<li><a href="/gostd/net/mockicmp_test.go.html">mockicmp_test.go</a></li>
<li><a href="/gostd/net/mockserver_test.go.html">mockserver_test.go</a></li>
<li><a href="/gostd/net/multicast_test.go.html">multicast_test.go</a></li>
<li><a href="/gostd/net/net.go.html">net.go</a></li>
<li><a href="/gostd/net/net_test.go.html">net_test.go</a></li>
<li><a href="/gostd/net/netgo_unix_test.go.html">netgo_unix_test.go</a></li>
<li><a href="/gostd/net/packetconn_test.go.html">packetconn_test.go</a></li>
<li><a href="/gostd/net/parse.go.html">parse.go</a></li>
<li><a href="/gostd/net/parse_test.go.html">parse_test.go</a></li>
<li><a href="/gostd/net/pipe.go.html">pipe.go</a></li>
<li><a href="/gostd/net/pipe_test.go.html">pipe_test.go</a></li>
<li><a href="/gostd/net/port.go.html">port.go</a></li>
<li><a href="/gostd/net/port_test.go.html">port_test.go</a></li>
<li><a href="/gostd/net/port_unix.go.html">port_unix.go</a></li>
<li><a href="/gostd/net/protoconn_test.go.html">protoconn_test.go</a></li>
<li><a href="/gostd/net/sendfile_linux.go.html">sendfile_linux.go</a></li>
<li><a href="/gostd/net/server_test.go.html">server_test.go</a></li>
<li><a href="/gostd/net/singleflight.go.html">singleflight.go</a></li>
<li><a href="/gostd/net/sock_cloexec.go.html">sock_cloexec.go</a></li>
<li><a href="/gostd/net/sock_linux.go.html">sock_linux.go</a></li>
<li><a href="/gostd/net/sock_posix.go.html">sock_posix.go</a></li>
<li><a href="/gostd/net/sockopt_linux.go.html">sockopt_linux.go</a></li>
<li><a href="/gostd/net/sockopt_posix.go.html">sockopt_posix.go</a></li>
<li><a href="/gostd/net/sockoptip_linux.go.html">sockoptip_linux.go</a></li>
<li><a href="/gostd/net/sockoptip_posix.go.html">sockoptip_posix.go</a></li>
<li><a href="/gostd/net/tcp_test.go.html">tcp_test.go</a></li>
<li><a href="/gostd/net/tcpsock.go.html">tcpsock.go</a></li>
<li><a href="/gostd/net/tcpsock_posix.go.html">tcpsock_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_posix.go.html">tcpsockopt_posix.go</a></li>
<li><a href="/gostd/net/tcpsockopt_unix.go.html">tcpsockopt_unix.go</a></li>
<li><a href="/gostd/net/timeout_test.go.html">timeout_test.go</a></li>
<li><a href="/gostd/net/udp_test.go.html">udp_test.go</a></li>
<li><a href="/gostd/net/udpsock.go.html">udpsock.go</a></li>
<li><a href="/gostd/net/udpsock_posix.go.html">udpsock_posix.go</a></li>
<li><a href="/gostd/net/unicast_posix_test.go.html">unicast_posix_test.go</a></li>
<li><a href="/gostd/net/unix_test.go.html">unix_test.go</a></li>
<li><a href="/gostd/net/unixsock.go.html">unixsock.go</a></li>
<li><a href="/gostd/net/unixsock_posix.go.html">unixsock_posix.go</a></li>
<li><a href="/gostd/net/z_last_test.go.html">z_last_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="2943585">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="2943641">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="2943695">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="2943746">package</span>&nbsp;<span class="ident" id="2943754">net</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2943759">import</span>&nbsp;<span class="op" id="2943766">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2943769">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="2943779">&#34;time&#34;</span><br>
<span class="lineno">10</span><span class="op" id="2943786">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2943789">//&nbsp;A&nbsp;Dialer&nbsp;contains&nbsp;options&nbsp;for&nbsp;connecting&nbsp;to&nbsp;an&nbsp;address.</span><br>
<span class="lineno"></span><span class="comment" id="2943848">//</span><br>
<span class="lineno"></span><span class="comment" id="2943851">//&nbsp;The&nbsp;zero&nbsp;value&nbsp;for&nbsp;each&nbsp;field&nbsp;is&nbsp;equivalent&nbsp;to&nbsp;dialing</span><br>
<span class="lineno">15</span><span class="comment" id="2943909">//&nbsp;without&nbsp;that&nbsp;option.&nbsp;Dialing&nbsp;with&nbsp;the&nbsp;zero&nbsp;value&nbsp;of&nbsp;Dialer</span><br>
<span class="lineno"></span><span class="comment" id="2943971">//&nbsp;is&nbsp;therefore&nbsp;equivalent&nbsp;to&nbsp;just&nbsp;calling&nbsp;the&nbsp;Dial&nbsp;function.</span><br>
<span class="lineno"></span><span class="keyword" id="2944033">type</span>&nbsp;<span class="ident" id="2944038">Dialer</span>&nbsp;<span class="keyword" id="2944045">struct</span>&nbsp;<span class="op" id="2944052">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944055">//&nbsp;Timeout&nbsp;is&nbsp;the&nbsp;maximum&nbsp;amount&nbsp;of&nbsp;time&nbsp;a&nbsp;dial&nbsp;will&nbsp;wait&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944118">//&nbsp;a&nbsp;connect&nbsp;to&nbsp;complete.&nbsp;If&nbsp;Deadline&nbsp;is&nbsp;also&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944182">//&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944195">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944199">//&nbsp;The&nbsp;default&nbsp;is&nbsp;no&nbsp;timeout.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944230">//</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944234">//&nbsp;With&nbsp;or&nbsp;without&nbsp;a&nbsp;timeout,&nbsp;the&nbsp;operating&nbsp;system&nbsp;may&nbsp;impose</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944297">//&nbsp;its&nbsp;own&nbsp;earlier&nbsp;timeout.&nbsp;For&nbsp;instance,&nbsp;TCP&nbsp;timeouts&nbsp;are</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944357">//&nbsp;often&nbsp;around&nbsp;3&nbsp;minutes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944385">Timeout</span>&nbsp;<span class="ident" id="2944393">time</span><span class="op" id="2944397">.</span><span class="ident" id="2944398">Duration</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944409">//&nbsp;Deadline&nbsp;is&nbsp;the&nbsp;absolute&nbsp;point&nbsp;in&nbsp;time&nbsp;after&nbsp;which&nbsp;dials</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944470">//&nbsp;will&nbsp;fail.&nbsp;If&nbsp;Timeout&nbsp;is&nbsp;set,&nbsp;it&nbsp;may&nbsp;fail&nbsp;earlier.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944525">//&nbsp;Zero&nbsp;means&nbsp;no&nbsp;deadline,&nbsp;or&nbsp;dependent&nbsp;on&nbsp;the&nbsp;operating&nbsp;system</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944590">//&nbsp;as&nbsp;with&nbsp;the&nbsp;Timeout&nbsp;option.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944622">Deadline</span>&nbsp;<span class="ident" id="2944631">time</span><span class="op" id="2944635">.</span><span class="ident" id="2944636">Time</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944643">//&nbsp;LocalAddr&nbsp;is&nbsp;the&nbsp;local&nbsp;address&nbsp;to&nbsp;use&nbsp;when&nbsp;dialing&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944701">//&nbsp;address.&nbsp;The&nbsp;address&nbsp;must&nbsp;be&nbsp;of&nbsp;a&nbsp;compatible&nbsp;type&nbsp;for&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944763">//&nbsp;network&nbsp;being&nbsp;dialed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944789">//&nbsp;If&nbsp;nil,&nbsp;a&nbsp;local&nbsp;address&nbsp;is&nbsp;automatically&nbsp;chosen.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2944842">LocalAddr</span>&nbsp;<span class="ident" id="2944852">Addr</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944859">//&nbsp;DualStack&nbsp;allows&nbsp;a&nbsp;single&nbsp;dial&nbsp;to&nbsp;attempt&nbsp;to&nbsp;establish</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944918">//&nbsp;multiple&nbsp;IPv4&nbsp;and&nbsp;IPv6&nbsp;connections&nbsp;and&nbsp;to&nbsp;return&nbsp;the&nbsp;first</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2944981">//&nbsp;established&nbsp;connection&nbsp;when&nbsp;the&nbsp;network&nbsp;is&nbsp;&#34;tcp&#34;&nbsp;and&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945042">//&nbsp;destination&nbsp;is&nbsp;a&nbsp;host&nbsp;name&nbsp;that&nbsp;has&nbsp;multiple&nbsp;address&nbsp;family</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945106">//&nbsp;DNS&nbsp;records.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945123">DualStack</span>&nbsp;<span class="builtintype" id="2945133">bool</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945140">//&nbsp;KeepAlive&nbsp;specifies&nbsp;the&nbsp;keep-alive&nbsp;period&nbsp;for&nbsp;an&nbsp;active</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945200">//&nbsp;network&nbsp;connection.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945224">//&nbsp;If&nbsp;zero,&nbsp;keep-alives&nbsp;are&nbsp;not&nbsp;enabled.&nbsp;Network&nbsp;protocols</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2945284">//&nbsp;that&nbsp;do&nbsp;not&nbsp;support&nbsp;keep-alives&nbsp;ignore&nbsp;this&nbsp;field.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945339">KeepAlive</span>&nbsp;<span class="ident" id="2945349">time</span><span class="op" id="2945353">.</span><span class="ident" id="2945354">Duration</span><br>
<span class="lineno"></span><span class="op" id="2945363">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">55</span><span class="comment" id="2945366">//&nbsp;Return&nbsp;either&nbsp;now+Timeout&nbsp;or&nbsp;Deadline,&nbsp;whichever&nbsp;comes&nbsp;first.</span><br>
<span class="lineno"></span><span class="comment" id="2945431">//&nbsp;Or&nbsp;zero,&nbsp;if&nbsp;neither&nbsp;is&nbsp;set.</span><br>
<span class="lineno"></span><span class="keyword" id="2945462">func</span>&nbsp;<span class="op" id="2945467">(</span><span class="ident" id="2945468">d</span>&nbsp;<span class="op" id="2945470">*</span><span class="ident" id="2945471">Dialer</span><span class="op" id="2945477">)</span>&nbsp;<span class="ident" id="2945479">deadline</span><span class="op" id="2945487">(</span><span class="op" id="2945488">)</span>&nbsp;<span class="ident" id="2945490">time</span><span class="op" id="2945494">.</span><span class="ident" id="2945495">Time</span>&nbsp;<span class="op" id="2945500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945503">if</span>&nbsp;<span class="ident" id="2945506">d</span><span class="op" id="2945507">.</span><span class="ident" id="2945508">Timeout</span>&nbsp;<span class="op" id="2945516">==</span>&nbsp;<span class="num" id="2945519">0</span>&nbsp;<span class="op" id="2945521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945525">return</span>&nbsp;<span class="ident" id="2945532">d</span><span class="op" id="2945533">.</span><span class="ident" id="2945534">Deadline</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945544">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945547">timeoutDeadline</span>&nbsp;<span class="op" id="2945563">:=</span>&nbsp;<span class="ident" id="2945566">time</span><span class="op" id="2945570">.</span><span class="ident" id="2945571">Now</span><span class="op" id="2945574">(</span><span class="op" id="2945575">)</span><span class="op" id="2945576">.</span><span class="ident" id="2945577">Add</span><span class="op" id="2945580">(</span><span class="ident" id="2945581">d</span><span class="op" id="2945582">.</span><span class="ident" id="2945583">Timeout</span><span class="op" id="2945590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945593">if</span>&nbsp;<span class="ident" id="2945596">d</span><span class="op" id="2945597">.</span><span class="ident" id="2945598">Deadline</span><span class="op" id="2945606">.</span><span class="ident" id="2945607">IsZero</span><span class="op" id="2945613">(</span><span class="op" id="2945614">)</span>&nbsp;<span class="op" id="2945616">||</span>&nbsp;<span class="ident" id="2945619">timeoutDeadline</span><span class="op" id="2945634">.</span><span class="ident" id="2945635">Before</span><span class="op" id="2945641">(</span><span class="ident" id="2945642">d</span><span class="op" id="2945643">.</span><span class="ident" id="2945644">Deadline</span><span class="op" id="2945652">)</span>&nbsp;<span class="op" id="2945654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945658">return</span>&nbsp;<span class="ident" id="2945665">timeoutDeadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945682">}</span>&nbsp;<span class="keyword" id="2945684">else</span>&nbsp;<span class="op" id="2945689">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945693">return</span>&nbsp;<span class="ident" id="2945700">d</span><span class="op" id="2945701">.</span><span class="ident" id="2945702">Deadline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2945712">}</span><br>
<span class="lineno"></span><span class="op" id="2945714">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2945717">func</span>&nbsp;<span class="ident" id="2945722">parseNetwork</span><span class="op" id="2945734">(</span><span class="ident" id="2945735">net</span>&nbsp;<span class="builtintype" id="2945739">string</span><span class="op" id="2945745">)</span>&nbsp;<span class="op" id="2945747">(</span><span class="ident" id="2945748">afnet</span>&nbsp;<span class="builtintype" id="2945754">string</span><span class="op" id="2945760">,</span>&nbsp;<span class="ident" id="2945762">proto</span>&nbsp;<span class="builtintype" id="2945768">int</span><span class="op" id="2945771">,</span>&nbsp;<span class="ident" id="2945773">err</span>&nbsp;<span class="builtintype" id="2945777">error</span><span class="op" id="2945782">)</span>&nbsp;<span class="op" id="2945784">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2945787">i</span>&nbsp;<span class="op" id="2945789">:=</span>&nbsp;<span class="ident" id="2945792">last</span><span class="op" id="2945796">(</span><span class="ident" id="2945797">net</span><span class="op" id="2945800">,</span>&nbsp;<span class="string" id="2945802">&#39;:&#39;</span><span class="op" id="2945805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945808">if</span>&nbsp;<span class="ident" id="2945811">i</span>&nbsp;<span class="op" id="2945813">&lt;</span>&nbsp;<span class="num" id="2945815">0</span>&nbsp;<span class="op" id="2945817">{</span>&nbsp;<span class="comment" id="2945819">//&nbsp;no&nbsp;colon</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945833">switch</span>&nbsp;<span class="ident" id="2945840">net</span>&nbsp;<span class="op" id="2945844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945848">case</span>&nbsp;<span class="string" id="2945853">&#34;tcp&#34;</span><span class="op" id="2945858">,</span>&nbsp;<span class="string" id="2945860">&#34;tcp4&#34;</span><span class="op" id="2945866">,</span>&nbsp;<span class="string" id="2945868">&#34;tcp6&#34;</span><span class="op" id="2945874">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945878">case</span>&nbsp;<span class="string" id="2945883">&#34;udp&#34;</span><span class="op" id="2945888">,</span>&nbsp;<span class="string" id="2945890">&#34;udp4&#34;</span><span class="op" id="2945896">,</span>&nbsp;<span class="string" id="2945898">&#34;udp6&#34;</span><span class="op" id="2945904">:</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945908">case</span>&nbsp;<span class="string" id="2945913">&#34;ip&#34;</span><span class="op" id="2945917">,</span>&nbsp;<span class="string" id="2945919">&#34;ip4&#34;</span><span class="op" id="2945924">,</span>&nbsp;<span class="string" id="2945926">&#34;ip6&#34;</span><span class="op" id="2945931">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945935">case</span>&nbsp;<span class="string" id="2945940">&#34;unix&#34;</span><span class="op" id="2945946">,</span>&nbsp;<span class="string" id="2945948">&#34;unixgram&#34;</span><span class="op" id="2945958">,</span>&nbsp;<span class="string" id="2945960">&#34;unixpacket&#34;</span><span class="op" id="2945972">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945976">default</span><span class="op" id="2945983">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2945988">return</span>&nbsp;<span class="string" id="2945995">&#34;&#34;</span><span class="op" id="2945997">,</span>&nbsp;<span class="num" id="2945999">0</span><span class="op" id="2946000">,</span>&nbsp;<span class="ident" id="2946002">UnknownNetworkError</span><span class="op" id="2946021">(</span><span class="ident" id="2946022">net</span><span class="op" id="2946025">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946029">}</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946033">return</span>&nbsp;<span class="ident" id="2946040">net</span><span class="op" id="2946043">,</span>&nbsp;<span class="num" id="2946045">0</span><span class="op" id="2946046">,</span>&nbsp;<span class="ident" id="2946048">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946053">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946056">afnet</span>&nbsp;<span class="op" id="2946062">=</span>&nbsp;<span class="ident" id="2946064">net</span><span class="op" id="2946067">[</span><span class="op" id="2946068">:</span><span class="ident" id="2946069">i</span><span class="op" id="2946070">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946073">switch</span>&nbsp;<span class="ident" id="2946080">afnet</span>&nbsp;<span class="op" id="2946086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946089">case</span>&nbsp;<span class="string" id="2946094">&#34;ip&#34;</span><span class="op" id="2946098">,</span>&nbsp;<span class="string" id="2946100">&#34;ip4&#34;</span><span class="op" id="2946105">,</span>&nbsp;<span class="string" id="2946107">&#34;ip6&#34;</span><span class="op" id="2946112">:</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946116">protostr</span>&nbsp;<span class="op" id="2946125">:=</span>&nbsp;<span class="ident" id="2946128">net</span><span class="op" id="2946131">[</span><span class="ident" id="2946132">i</span><span class="op" id="2946133">+</span><span class="num" id="2946134">1</span><span class="op" id="2946135">:</span><span class="op" id="2946136">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946140">proto</span><span class="op" id="2946145">,</span>&nbsp;<span class="ident" id="2946147">i</span><span class="op" id="2946148">,</span>&nbsp;<span class="ident" id="2946150">ok</span>&nbsp;<span class="op" id="2946153">:=</span>&nbsp;<span class="ident" id="2946156">dtoi</span><span class="op" id="2946160">(</span><span class="ident" id="2946161">protostr</span><span class="op" id="2946169">,</span>&nbsp;<span class="num" id="2946171">0</span><span class="op" id="2946172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946176">if</span>&nbsp;<span class="op" id="2946179">!</span><span class="ident" id="2946180">ok</span>&nbsp;<span class="op" id="2946183">||</span>&nbsp;<span class="ident" id="2946186">i</span>&nbsp;<span class="op" id="2946188">!=</span>&nbsp;<span class="builtinfunc" id="2946191">len</span><span class="op" id="2946194">(</span><span class="ident" id="2946195">protostr</span><span class="op" id="2946203">)</span>&nbsp;<span class="op" id="2946205">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946210">proto</span><span class="op" id="2946215">,</span>&nbsp;<span class="ident" id="2946217">err</span>&nbsp;<span class="op" id="2946221">=</span>&nbsp;<span class="ident" id="2946223">lookupProtocol</span><span class="op" id="2946237">(</span><span class="ident" id="2946238">protostr</span><span class="op" id="2946246">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946251">if</span>&nbsp;<span class="ident" id="2946254">err</span>&nbsp;<span class="op" id="2946258">!=</span>&nbsp;<span class="ident" id="2946261">nil</span>&nbsp;<span class="op" id="2946265">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946271">return</span>&nbsp;<span class="string" id="2946278">&#34;&#34;</span><span class="op" id="2946280">,</span>&nbsp;<span class="num" id="2946282">0</span><span class="op" id="2946283">,</span>&nbsp;<span class="ident" id="2946285">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946296">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946300">return</span>&nbsp;<span class="ident" id="2946307">afnet</span><span class="op" id="2946312">,</span>&nbsp;<span class="ident" id="2946314">proto</span><span class="op" id="2946319">,</span>&nbsp;<span class="ident" id="2946321">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946326">}</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946329">return</span>&nbsp;<span class="string" id="2946336">&#34;&#34;</span><span class="op" id="2946338">,</span>&nbsp;<span class="num" id="2946340">0</span><span class="op" id="2946341">,</span>&nbsp;<span class="ident" id="2946343">UnknownNetworkError</span><span class="op" id="2946362">(</span><span class="ident" id="2946363">net</span><span class="op" id="2946366">)</span><br>
<span class="lineno"></span><span class="op" id="2946368">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="2946371">func</span>&nbsp;<span class="ident" id="2946376">resolveAddr</span><span class="op" id="2946387">(</span><span class="ident" id="2946388">op</span><span class="op" id="2946390">,</span>&nbsp;<span class="ident" id="2946392">net</span><span class="op" id="2946395">,</span>&nbsp;<span class="ident" id="2946397">addr</span>&nbsp;<span class="builtintype" id="2946402">string</span><span class="op" id="2946408">,</span>&nbsp;<span class="ident" id="2946410">deadline</span>&nbsp;<span class="ident" id="2946419">time</span><span class="op" id="2946423">.</span><span class="ident" id="2946424">Time</span><span class="op" id="2946428">)</span>&nbsp;<span class="op" id="2946430">(</span><span class="ident" id="2946431">netaddr</span><span class="op" id="2946438">,</span>&nbsp;<span class="builtintype" id="2946440">error</span><span class="op" id="2946445">)</span>&nbsp;<span class="op" id="2946447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2946450">afnet</span><span class="op" id="2946455">,</span>&nbsp;<span class="ident" id="2946457">_</span><span class="op" id="2946458">,</span>&nbsp;<span class="ident" id="2946460">err</span>&nbsp;<span class="op" id="2946464">:=</span>&nbsp;<span class="ident" id="2946467">parseNetwork</span><span class="op" id="2946479">(</span><span class="ident" id="2946480">net</span><span class="op" id="2946483">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946486">if</span>&nbsp;<span class="ident" id="2946489">err</span>&nbsp;<span class="op" id="2946493">!=</span>&nbsp;<span class="ident" id="2946496">nil</span>&nbsp;<span class="op" id="2946500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946504">return</span>&nbsp;<span class="ident" id="2946511">nil</span><span class="op" id="2946514">,</span>&nbsp;<span class="ident" id="2946516">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946521">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946524">if</span>&nbsp;<span class="ident" id="2946527">op</span>&nbsp;<span class="op" id="2946530">==</span>&nbsp;<span class="string" id="2946533">&#34;dial&#34;</span>&nbsp;<span class="op" id="2946540">&amp;&amp;</span>&nbsp;<span class="ident" id="2946543">addr</span>&nbsp;<span class="op" id="2946548">==</span>&nbsp;<span class="string" id="2946551">&#34;&#34;</span>&nbsp;<span class="op" id="2946554">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946558">return</span>&nbsp;<span class="ident" id="2946565">nil</span><span class="op" id="2946568">,</span>&nbsp;<span class="ident" id="2946570">errMissingAddress</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946592">switch</span>&nbsp;<span class="ident" id="2946599">afnet</span>&nbsp;<span class="op" id="2946605">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946608">case</span>&nbsp;<span class="string" id="2946613">&#34;unix&#34;</span><span class="op" id="2946619">,</span>&nbsp;<span class="string" id="2946621">&#34;unixgram&#34;</span><span class="op" id="2946631">,</span>&nbsp;<span class="string" id="2946633">&#34;unixpacket&#34;</span><span class="op" id="2946645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946649">return</span>&nbsp;<span class="ident" id="2946656">ResolveUnixAddr</span><span class="op" id="2946671">(</span><span class="ident" id="2946672">afnet</span><span class="op" id="2946677">,</span>&nbsp;<span class="ident" id="2946679">addr</span><span class="op" id="2946683">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2946686">}</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2946689">return</span>&nbsp;<span class="ident" id="2946696">resolveInternetAddr</span><span class="op" id="2946715">(</span><span class="ident" id="2946716">afnet</span><span class="op" id="2946721">,</span>&nbsp;<span class="ident" id="2946723">addr</span><span class="op" id="2946727">,</span>&nbsp;<span class="ident" id="2946729">deadline</span><span class="op" id="2946737">)</span><br>
<span class="lineno"></span><span class="op" id="2946739">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2946742">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="2946796">//</span><br>
<span class="lineno">115</span><span class="comment" id="2946799">//&nbsp;Known&nbsp;networks&nbsp;are&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;tcp6&#34;&nbsp;(IPv6-only),</span><br>
<span class="lineno"></span><span class="comment" id="2946868">//&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;&nbsp;(IPv4-only),&nbsp;&#34;udp6&#34;&nbsp;(IPv6-only),&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;</span><br>
<span class="lineno"></span><span class="comment" id="2946930">//&nbsp;(IPv4-only),&nbsp;&#34;ip6&#34;&nbsp;(IPv6-only),&nbsp;&#34;unix&#34;,&nbsp;&#34;unixgram&#34;&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="2946988">//&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2947005">//</span><br>
<span class="lineno">120</span><span class="comment" id="2947008">//&nbsp;For&nbsp;TCP&nbsp;and&nbsp;UDP&nbsp;networks,&nbsp;addresses&nbsp;have&nbsp;the&nbsp;form&nbsp;host:port.</span><br>
<span class="lineno"></span><span class="comment" id="2947072">//&nbsp;If&nbsp;host&nbsp;is&nbsp;a&nbsp;literal&nbsp;IPv6&nbsp;address&nbsp;it&nbsp;must&nbsp;be&nbsp;enclosed</span><br>
<span class="lineno"></span><span class="comment" id="2947129">//&nbsp;in&nbsp;square&nbsp;brackets&nbsp;as&nbsp;in&nbsp;&#34;[::1]:80&#34;&nbsp;or&nbsp;&#34;[ipv6-host%zone]:80&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2947194">//&nbsp;The&nbsp;functions&nbsp;JoinHostPort&nbsp;and&nbsp;SplitHostPort&nbsp;manipulate&nbsp;addresses</span><br>
<span class="lineno"></span><span class="comment" id="2947263">//&nbsp;in&nbsp;this&nbsp;form.</span><br>
<span class="lineno">125</span><span class="comment" id="2947280">//</span><br>
<span class="lineno"></span><span class="comment" id="2947283">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="2947296">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;12.34.56.78:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2947329">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;google.com:http&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2947363">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[2001:db8::1]:http&#34;)</span><br>
<span class="lineno">130</span><span class="comment" id="2947400">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;tcp&#34;,&nbsp;&#34;[fe80::1%lo0]:80&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2947435">//</span><br>
<span class="lineno"></span><span class="comment" id="2947438">//&nbsp;For&nbsp;IP&nbsp;networks,&nbsp;the&nbsp;network&nbsp;must&nbsp;be&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;&nbsp;or&nbsp;&#34;ip6&#34;&nbsp;followed</span><br>
<span class="lineno"></span><span class="comment" id="2947508">//&nbsp;by&nbsp;a&nbsp;colon&nbsp;and&nbsp;a&nbsp;protocol&nbsp;number&nbsp;or&nbsp;name&nbsp;and&nbsp;the&nbsp;addr&nbsp;must&nbsp;be&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="2947575">//&nbsp;literal&nbsp;IP&nbsp;address.</span><br>
<span class="lineno">135</span><span class="comment" id="2947598">//</span><br>
<span class="lineno"></span><span class="comment" id="2947601">//&nbsp;Examples:</span><br>
<span class="lineno"></span><span class="comment" id="2947614">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip4:1&#34;,&nbsp;&#34;127.0.0.1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2947644">//&nbsp;&nbsp;&nbsp;&nbspDial(&#34;ip6:ospf&#34;,&nbsp;&#34;::1&#34;)</span><br>
<span class="lineno"></span><span class="comment" id="2947671">//</span><br>
<span class="lineno">140</span><span class="comment" id="2947674">//&nbsp;For&nbsp;Unix&nbsp;networks,&nbsp;the&nbsp;address&nbsp;must&nbsp;be&nbsp;a&nbsp;file&nbsp;system&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="2947736">func</span>&nbsp;<span class="ident" id="2947741">Dial</span><span class="op" id="2947745">(</span><span class="ident" id="2947746">network</span><span class="op" id="2947753">,</span>&nbsp;<span class="ident" id="2947755">address</span>&nbsp;<span class="builtintype" id="2947763">string</span><span class="op" id="2947769">)</span>&nbsp;<span class="op" id="2947771">(</span><span class="ident" id="2947772">Conn</span><span class="op" id="2947776">,</span>&nbsp;<span class="builtintype" id="2947778">error</span><span class="op" id="2947783">)</span>&nbsp;<span class="op" id="2947785">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947788">var</span>&nbsp;<span class="ident" id="2947792">d</span>&nbsp;<span class="ident" id="2947794">Dialer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2947802">return</span>&nbsp;<span class="ident" id="2947809">d</span><span class="op" id="2947810">.</span><span class="ident" id="2947811">Dial</span><span class="op" id="2947815">(</span><span class="ident" id="2947816">network</span><span class="op" id="2947823">,</span>&nbsp;<span class="ident" id="2947825">address</span><span class="op" id="2947832">)</span><br>
<span class="lineno"></span><span class="op" id="2947834">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span><span class="comment" id="2947837">//&nbsp;DialTimeout&nbsp;acts&nbsp;like&nbsp;Dial&nbsp;but&nbsp;takes&nbsp;a&nbsp;timeout.</span><br>
<span class="lineno"></span><span class="comment" id="2947888">//&nbsp;The&nbsp;timeout&nbsp;includes&nbsp;name&nbsp;resolution,&nbsp;if&nbsp;required.</span><br>
<span class="lineno"></span><span class="keyword" id="2947942">func</span>&nbsp;<span class="ident" id="2947947">DialTimeout</span><span class="op" id="2947958">(</span><span class="ident" id="2947959">network</span><span class="op" id="2947966">,</span>&nbsp;<span class="ident" id="2947968">address</span>&nbsp;<span class="builtintype" id="2947976">string</span><span class="op" id="2947982">,</span>&nbsp;<span class="ident" id="2947984">timeout</span>&nbsp;<span class="ident" id="2947992">time</span><span class="op" id="2947996">.</span><span class="ident" id="2947997">Duration</span><span class="op" id="2948005">)</span>&nbsp;<span class="op" id="2948007">(</span><span class="ident" id="2948008">Conn</span><span class="op" id="2948012">,</span>&nbsp;<span class="builtintype" id="2948014">error</span><span class="op" id="2948019">)</span>&nbsp;<span class="op" id="2948021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948024">d</span>&nbsp;<span class="op" id="2948026">:=</span>&nbsp;<span class="ident" id="2948029">Dialer</span><span class="op" id="2948035">{</span><span class="ident" id="2948036">Timeout</span><span class="op" id="2948043">:</span>&nbsp;<span class="ident" id="2948045">timeout</span><span class="op" id="2948052">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948055">return</span>&nbsp;<span class="ident" id="2948062">d</span><span class="op" id="2948063">.</span><span class="ident" id="2948064">Dial</span><span class="op" id="2948068">(</span><span class="ident" id="2948069">network</span><span class="op" id="2948076">,</span>&nbsp;<span class="ident" id="2948078">address</span><span class="op" id="2948085">)</span><br>
<span class="lineno"></span><span class="op" id="2948087">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2948090">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;the&nbsp;address&nbsp;on&nbsp;the&nbsp;named&nbsp;network.</span><br>
<span class="lineno"></span><span class="comment" id="2948144">//</span><br>
<span class="lineno">155</span><span class="comment" id="2948147">//&nbsp;See&nbsp;func&nbsp;Dial&nbsp;for&nbsp;a&nbsp;description&nbsp;of&nbsp;the&nbsp;network&nbsp;and&nbsp;address</span><br>
<span class="lineno"></span><span class="comment" id="2948209">//&nbsp;parameters.</span><br>
<span class="lineno"></span><span class="keyword" id="2948224">func</span>&nbsp;<span class="op" id="2948229">(</span><span class="ident" id="2948230">d</span>&nbsp;<span class="op" id="2948232">*</span><span class="ident" id="2948233">Dialer</span><span class="op" id="2948239">)</span>&nbsp;<span class="ident" id="2948241">Dial</span><span class="op" id="2948245">(</span><span class="ident" id="2948246">network</span><span class="op" id="2948253">,</span>&nbsp;<span class="ident" id="2948255">address</span>&nbsp;<span class="builtintype" id="2948263">string</span><span class="op" id="2948269">)</span>&nbsp;<span class="op" id="2948271">(</span><span class="ident" id="2948272">Conn</span><span class="op" id="2948276">,</span>&nbsp;<span class="builtintype" id="2948278">error</span><span class="op" id="2948283">)</span>&nbsp;<span class="op" id="2948285">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948288">ra</span><span class="op" id="2948290">,</span>&nbsp;<span class="ident" id="2948292">err</span>&nbsp;<span class="op" id="2948296">:=</span>&nbsp;<span class="ident" id="2948299">resolveAddr</span><span class="op" id="2948310">(</span><span class="string" id="2948311">&#34;dial&#34;</span><span class="op" id="2948317">,</span>&nbsp;<span class="ident" id="2948319">network</span><span class="op" id="2948326">,</span>&nbsp;<span class="ident" id="2948328">address</span><span class="op" id="2948335">,</span>&nbsp;<span class="ident" id="2948337">d</span><span class="op" id="2948338">.</span><span class="ident" id="2948339">deadline</span><span class="op" id="2948347">(</span><span class="op" id="2948348">)</span><span class="op" id="2948349">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948352">if</span>&nbsp;<span class="ident" id="2948355">err</span>&nbsp;<span class="op" id="2948359">!=</span>&nbsp;<span class="ident" id="2948362">nil</span>&nbsp;<span class="op" id="2948366">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948370">return</span>&nbsp;<span class="ident" id="2948377">nil</span><span class="op" id="2948380">,</span>&nbsp;<span class="op" id="2948382">&amp;</span><span class="ident" id="2948383">OpError</span><span class="op" id="2948390">{</span><span class="ident" id="2948391">Op</span><span class="op" id="2948393">:</span>&nbsp;<span class="string" id="2948395">&#34;dial&#34;</span><span class="op" id="2948401">,</span>&nbsp;<span class="ident" id="2948403">Net</span><span class="op" id="2948406">:</span>&nbsp;<span class="ident" id="2948408">network</span><span class="op" id="2948415">,</span>&nbsp;<span class="ident" id="2948417">Addr</span><span class="op" id="2948421">:</span>&nbsp;<span class="ident" id="2948423">nil</span><span class="op" id="2948426">,</span>&nbsp;<span class="ident" id="2948428">Err</span><span class="op" id="2948431">:</span>&nbsp;<span class="ident" id="2948433">err</span><span class="op" id="2948436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948442">dialer</span>&nbsp;<span class="op" id="2948449">:=</span>&nbsp;<span class="keyword" id="2948452">func</span><span class="op" id="2948456">(</span><span class="ident" id="2948457">deadline</span>&nbsp;<span class="ident" id="2948466">time</span><span class="op" id="2948470">.</span><span class="ident" id="2948471">Time</span><span class="op" id="2948475">)</span>&nbsp;<span class="op" id="2948477">(</span><span class="ident" id="2948478">Conn</span><span class="op" id="2948482">,</span>&nbsp;<span class="builtintype" id="2948484">error</span><span class="op" id="2948489">)</span>&nbsp;<span class="op" id="2948491">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948495">return</span>&nbsp;<span class="ident" id="2948502">dialSingle</span><span class="op" id="2948512">(</span><span class="ident" id="2948513">network</span><span class="op" id="2948520">,</span>&nbsp;<span class="ident" id="2948522">address</span><span class="op" id="2948529">,</span>&nbsp;<span class="ident" id="2948531">d</span><span class="op" id="2948532">.</span><span class="ident" id="2948533">LocalAddr</span><span class="op" id="2948542">,</span>&nbsp;<span class="ident" id="2948544">ra</span><span class="op" id="2948546">.</span><span class="ident" id="2948547">toAddr</span><span class="op" id="2948553">(</span><span class="op" id="2948554">)</span><span class="op" id="2948555">,</span>&nbsp;<span class="ident" id="2948557">deadline</span><span class="op" id="2948565">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948568">}</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948571">if</span>&nbsp;<span class="ident" id="2948574">ras</span><span class="op" id="2948577">,</span>&nbsp;<span class="ident" id="2948579">ok</span>&nbsp;<span class="op" id="2948582">:=</span>&nbsp;<span class="ident" id="2948585">ra</span><span class="op" id="2948587">.</span><span class="op" id="2948588">(</span><span class="ident" id="2948589">addrList</span><span class="op" id="2948597">)</span><span class="op" id="2948598">;</span>&nbsp;<span class="ident" id="2948600">ok</span>&nbsp;<span class="op" id="2948603">&amp;&amp;</span>&nbsp;<span class="ident" id="2948606">d</span><span class="op" id="2948607">.</span><span class="ident" id="2948608">DualStack</span>&nbsp;<span class="op" id="2948618">&amp;&amp;</span>&nbsp;<span class="ident" id="2948621">network</span>&nbsp;<span class="op" id="2948629">==</span>&nbsp;<span class="string" id="2948632">&#34;tcp&#34;</span>&nbsp;<span class="op" id="2948638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948642">dialer</span>&nbsp;<span class="op" id="2948649">=</span>&nbsp;<span class="keyword" id="2948651">func</span><span class="op" id="2948655">(</span><span class="ident" id="2948656">deadline</span>&nbsp;<span class="ident" id="2948665">time</span><span class="op" id="2948669">.</span><span class="ident" id="2948670">Time</span><span class="op" id="2948674">)</span>&nbsp;<span class="op" id="2948676">(</span><span class="ident" id="2948677">Conn</span><span class="op" id="2948681">,</span>&nbsp;<span class="builtintype" id="2948683">error</span><span class="op" id="2948688">)</span>&nbsp;<span class="op" id="2948690">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948695">return</span>&nbsp;<span class="ident" id="2948702">dialMulti</span><span class="op" id="2948711">(</span><span class="ident" id="2948712">network</span><span class="op" id="2948719">,</span>&nbsp;<span class="ident" id="2948721">address</span><span class="op" id="2948728">,</span>&nbsp;<span class="ident" id="2948730">d</span><span class="op" id="2948731">.</span><span class="ident" id="2948732">LocalAddr</span><span class="op" id="2948741">,</span>&nbsp;<span class="ident" id="2948743">ras</span><span class="op" id="2948746">,</span>&nbsp;<span class="ident" id="2948748">deadline</span><span class="op" id="2948756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948763">}</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948766">c</span><span class="op" id="2948767">,</span>&nbsp;<span class="ident" id="2948769">err</span>&nbsp;<span class="op" id="2948773">:=</span>&nbsp;<span class="ident" id="2948776">dial</span><span class="op" id="2948780">(</span><span class="ident" id="2948781">network</span><span class="op" id="2948788">,</span>&nbsp;<span class="ident" id="2948790">ra</span><span class="op" id="2948792">.</span><span class="ident" id="2948793">toAddr</span><span class="op" id="2948799">(</span><span class="op" id="2948800">)</span><span class="op" id="2948801">,</span>&nbsp;<span class="ident" id="2948803">dialer</span><span class="op" id="2948809">,</span>&nbsp;<span class="ident" id="2948811">d</span><span class="op" id="2948812">.</span><span class="ident" id="2948813">deadline</span><span class="op" id="2948821">(</span><span class="op" id="2948822">)</span><span class="op" id="2948823">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948826">if</span>&nbsp;<span class="ident" id="2948829">d</span><span class="op" id="2948830">.</span><span class="ident" id="2948831">KeepAlive</span>&nbsp;<span class="op" id="2948841">&gt;</span>&nbsp;<span class="num" id="2948843">0</span>&nbsp;<span class="op" id="2948845">&amp;&amp;</span>&nbsp;<span class="ident" id="2948848">err</span>&nbsp;<span class="op" id="2948852">==</span>&nbsp;<span class="ident" id="2948855">nil</span>&nbsp;<span class="op" id="2948859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948863">if</span>&nbsp;<span class="ident" id="2948866">tc</span><span class="op" id="2948868">,</span>&nbsp;<span class="ident" id="2948870">ok</span>&nbsp;<span class="op" id="2948873">:=</span>&nbsp;<span class="ident" id="2948876">c</span><span class="op" id="2948877">.</span><span class="op" id="2948878">(</span><span class="op" id="2948879">*</span><span class="ident" id="2948880">TCPConn</span><span class="op" id="2948887">)</span><span class="op" id="2948888">;</span>&nbsp;<span class="ident" id="2948890">ok</span>&nbsp;<span class="op" id="2948893">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948898">tc</span><span class="op" id="2948900">.</span><span class="ident" id="2948901">SetKeepAlive</span><span class="op" id="2948913">(</span><span class="builtintype" id="2948914">true</span><span class="op" id="2948918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948923">tc</span><span class="op" id="2948925">.</span><span class="ident" id="2948926">SetKeepAlivePeriod</span><span class="op" id="2948944">(</span><span class="ident" id="2948945">d</span><span class="op" id="2948946">.</span><span class="ident" id="2948947">KeepAlive</span><span class="op" id="2948956">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2948961">testHookSetKeepAlive</span><span class="op" id="2948981">(</span><span class="op" id="2948982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2948989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2948992">return</span>&nbsp;<span class="ident" id="2948999">c</span><span class="op" id="2949000">,</span>&nbsp;<span class="ident" id="2949002">err</span><br>
<span class="lineno"></span><span class="op" id="2949006">}</span><br>
<span class="lineno">180</span><br>
<span class="lineno"></span><span class="keyword" id="2949009">var</span>&nbsp;<span class="ident" id="2949013">testHookSetKeepAlive</span>&nbsp;<span class="op" id="2949034">=</span>&nbsp;<span class="keyword" id="2949036">func</span><span class="op" id="2949040">(</span><span class="op" id="2949041">)</span>&nbsp;<span class="op" id="2949043">{</span><span class="op" id="2949044">}</span>&nbsp;<span class="comment" id="2949046">//&nbsp;changed&nbsp;by&nbsp;dial_test.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2949074">//&nbsp;dialMulti&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;connections&nbsp;to&nbsp;each&nbsp;destination&nbsp;of</span><br>
<span class="lineno"></span><span class="comment" id="2949144">//&nbsp;the&nbsp;list&nbsp;of&nbsp;addresses.&nbsp;It&nbsp;will&nbsp;return&nbsp;the&nbsp;first&nbsp;established</span><br>
<span class="lineno">185</span><span class="comment" id="2949207">//&nbsp;connection&nbsp;and&nbsp;close&nbsp;the&nbsp;other&nbsp;connections.&nbsp;Otherwise&nbsp;it&nbsp;returns</span><br>
<span class="lineno"></span><span class="comment" id="2949275">//&nbsp;error&nbsp;on&nbsp;the&nbsp;last&nbsp;attempt.</span><br>
<span class="lineno"></span><span class="keyword" id="2949305">func</span>&nbsp;<span class="ident" id="2949310">dialMulti</span><span class="op" id="2949319">(</span><span class="ident" id="2949320">net</span><span class="op" id="2949323">,</span>&nbsp;<span class="ident" id="2949325">addr</span>&nbsp;<span class="builtintype" id="2949330">string</span><span class="op" id="2949336">,</span>&nbsp;<span class="ident" id="2949338">la</span>&nbsp;<span class="ident" id="2949341">Addr</span><span class="op" id="2949345">,</span>&nbsp;<span class="ident" id="2949347">ras</span>&nbsp;<span class="ident" id="2949351">addrList</span><span class="op" id="2949359">,</span>&nbsp;<span class="ident" id="2949361">deadline</span>&nbsp;<span class="ident" id="2949370">time</span><span class="op" id="2949374">.</span><span class="ident" id="2949375">Time</span><span class="op" id="2949379">)</span>&nbsp;<span class="op" id="2949381">(</span><span class="ident" id="2949382">Conn</span><span class="op" id="2949386">,</span>&nbsp;<span class="builtintype" id="2949388">error</span><span class="op" id="2949393">)</span>&nbsp;<span class="op" id="2949395">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949398">type</span>&nbsp;<span class="ident" id="2949403">racer</span>&nbsp;<span class="keyword" id="2949409">struct</span>&nbsp;<span class="op" id="2949416">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949420">Conn</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="2949427">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949434">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949437">//&nbsp;Sig&nbsp;controls&nbsp;the&nbsp;flow&nbsp;of&nbsp;dial&nbsp;results&nbsp;on&nbsp;lane.&nbsp;It&nbsp;passes&nbsp;a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949500">//&nbsp;token&nbsp;to&nbsp;the&nbsp;next&nbsp;racer&nbsp;and&nbsp;also&nbsp;indicates&nbsp;the&nbsp;end&nbsp;of&nbsp;flow</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949563">//&nbsp;by&nbsp;using&nbsp;closed&nbsp;channel.</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949592">sig</span>&nbsp;<span class="op" id="2949596">:=</span>&nbsp;<span class="builtinfunc" id="2949599">make</span><span class="op" id="2949603">(</span><span class="keyword" id="2949604">chan</span>&nbsp;<span class="builtintype" id="2949609">bool</span><span class="op" id="2949613">,</span>&nbsp;<span class="num" id="2949615">1</span><span class="op" id="2949616">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949619">lane</span>&nbsp;<span class="op" id="2949624">:=</span>&nbsp;<span class="builtinfunc" id="2949627">make</span><span class="op" id="2949631">(</span><span class="keyword" id="2949632">chan</span>&nbsp;<span class="ident" id="2949637">racer</span><span class="op" id="2949642">,</span>&nbsp;<span class="num" id="2949644">1</span><span class="op" id="2949645">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949648">for</span>&nbsp;<span class="ident" id="2949652">_</span><span class="op" id="2949653">,</span>&nbsp;<span class="ident" id="2949655">ra</span>&nbsp;<span class="op" id="2949658">:=</span>&nbsp;<span class="keyword" id="2949661">range</span>&nbsp;<span class="ident" id="2949667">ras</span>&nbsp;<span class="op" id="2949671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949675">go</span>&nbsp;<span class="keyword" id="2949678">func</span><span class="op" id="2949682">(</span><span class="ident" id="2949683">ra</span>&nbsp;<span class="ident" id="2949686">Addr</span><span class="op" id="2949690">)</span>&nbsp;<span class="op" id="2949692">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949697">c</span><span class="op" id="2949698">,</span>&nbsp;<span class="ident" id="2949700">err</span>&nbsp;<span class="op" id="2949704">:=</span>&nbsp;<span class="ident" id="2949707">dialSingle</span><span class="op" id="2949717">(</span><span class="ident" id="2949718">net</span><span class="op" id="2949721">,</span>&nbsp;<span class="ident" id="2949723">addr</span><span class="op" id="2949727">,</span>&nbsp;<span class="ident" id="2949729">la</span><span class="op" id="2949731">,</span>&nbsp;<span class="ident" id="2949733">ra</span><span class="op" id="2949735">,</span>&nbsp;<span class="ident" id="2949737">deadline</span><span class="op" id="2949745">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2949750">if</span>&nbsp;<span class="ident" id="2949753">_</span><span class="op" id="2949754">,</span>&nbsp;<span class="ident" id="2949756">ok</span>&nbsp;<span class="op" id="2949759">:=</span>&nbsp;<span class="op" id="2949762">&lt;-</span><span class="ident" id="2949764">sig</span><span class="op" id="2949767">;</span>&nbsp;<span class="ident" id="2949769">ok</span>&nbsp;<span class="op" id="2949772">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949778">lane</span>&nbsp;<span class="op" id="2949783">&lt;-</span>&nbsp;<span class="ident" id="2949786">racer</span><span class="op" id="2949791">{</span><span class="ident" id="2949792">c</span><span class="op" id="2949793">,</span>&nbsp;<span class="ident" id="2949795">err</span><span class="op" id="2949798">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949803">}</span>&nbsp;<span class="keyword" id="2949805">else</span>&nbsp;<span class="keyword" id="2949810">if</span>&nbsp;<span class="ident" id="2949813">err</span>&nbsp;<span class="op" id="2949817">==</span>&nbsp;<span class="ident" id="2949820">nil</span>&nbsp;<span class="op" id="2949824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949830">//&nbsp;We&nbsp;have&nbsp;to&nbsp;return&nbsp;the&nbsp;resources</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949869">//&nbsp;that&nbsp;belong&nbsp;to&nbsp;the&nbsp;other</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949901">//&nbsp;connections&nbsp;here&nbsp;for&nbsp;avoiding</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="2949938">//&nbsp;unnecessary&nbsp;resource&nbsp;starvation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2949978">c</span><span class="op" id="2949979">.</span><span class="ident" id="2949980">Close</span><span class="op" id="2949985">(</span><span class="op" id="2949986">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949991">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2949995">}</span><span class="op" id="2949996">(</span><span class="ident" id="2949997">ra</span><span class="op" id="2949999">.</span><span class="ident" id="2950000">toAddr</span><span class="op" id="2950006">(</span><span class="op" id="2950007">)</span><span class="op" id="2950008">)</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950014">defer</span>&nbsp;<span class="builtinfunc" id="2950020">close</span><span class="op" id="2950025">(</span><span class="ident" id="2950026">sig</span><span class="op" id="2950029">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950032">lastErr</span>&nbsp;<span class="op" id="2950040">:=</span>&nbsp;<span class="ident" id="2950043">errTimeout</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950055">nracers</span>&nbsp;<span class="op" id="2950063">:=</span>&nbsp;<span class="builtinfunc" id="2950066">len</span><span class="op" id="2950069">(</span><span class="ident" id="2950070">ras</span><span class="op" id="2950073">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950076">for</span>&nbsp;<span class="ident" id="2950080">nracers</span>&nbsp;<span class="op" id="2950088">&gt;</span>&nbsp;<span class="num" id="2950090">0</span>&nbsp;<span class="op" id="2950092">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950096">sig</span>&nbsp;<span class="op" id="2950100">&lt;-</span>&nbsp;<span class="builtintype" id="2950103">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950110">racer</span>&nbsp;<span class="op" id="2950116">:=</span>&nbsp;<span class="op" id="2950119">&lt;-</span><span class="ident" id="2950121">lane</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950128">if</span>&nbsp;<span class="ident" id="2950131">racer</span><span class="op" id="2950136">.</span><span class="builtintype" id="2950137">error</span>&nbsp;<span class="op" id="2950143">==</span>&nbsp;<span class="ident" id="2950146">nil</span>&nbsp;<span class="op" id="2950150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950155">return</span>&nbsp;<span class="ident" id="2950162">racer</span><span class="op" id="2950167">.</span><span class="ident" id="2950168">Conn</span><span class="op" id="2950172">,</span>&nbsp;<span class="ident" id="2950174">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950180">}</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950184">lastErr</span>&nbsp;<span class="op" id="2950192">=</span>&nbsp;<span class="ident" id="2950194">racer</span><span class="op" id="2950199">.</span><span class="builtintype" id="2950200">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950208">nracers</span><span class="op" id="2950215">--</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950219">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950222">return</span>&nbsp;<span class="ident" id="2950229">nil</span><span class="op" id="2950232">,</span>&nbsp;<span class="ident" id="2950234">lastErr</span><br>
<span class="lineno"></span><span class="op" id="2950242">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="2950245">//&nbsp;dialSingle&nbsp;attempts&nbsp;to&nbsp;establish&nbsp;and&nbsp;returns&nbsp;a&nbsp;single&nbsp;connection&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="2950316">//&nbsp;the&nbsp;destination&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="2950344">func</span>&nbsp;<span class="ident" id="2950349">dialSingle</span><span class="op" id="2950359">(</span><span class="ident" id="2950360">net</span><span class="op" id="2950363">,</span>&nbsp;<span class="ident" id="2950365">addr</span>&nbsp;<span class="builtintype" id="2950370">string</span><span class="op" id="2950376">,</span>&nbsp;<span class="ident" id="2950378">la</span><span class="op" id="2950380">,</span>&nbsp;<span class="ident" id="2950382">ra</span>&nbsp;<span class="ident" id="2950385">Addr</span><span class="op" id="2950389">,</span>&nbsp;<span class="ident" id="2950391">deadline</span>&nbsp;<span class="ident" id="2950400">time</span><span class="op" id="2950404">.</span><span class="ident" id="2950405">Time</span><span class="op" id="2950409">)</span>&nbsp;<span class="op" id="2950411">(</span><span class="ident" id="2950412">c</span>&nbsp;<span class="ident" id="2950414">Conn</span><span class="op" id="2950418">,</span>&nbsp;<span class="ident" id="2950420">err</span>&nbsp;<span class="builtintype" id="2950424">error</span><span class="op" id="2950429">)</span>&nbsp;<span class="op" id="2950431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950434">if</span>&nbsp;<span class="ident" id="2950437">la</span>&nbsp;<span class="op" id="2950440">!=</span>&nbsp;<span class="ident" id="2950443">nil</span>&nbsp;<span class="op" id="2950447">&amp;&amp;</span>&nbsp;<span class="ident" id="2950450">la</span><span class="op" id="2950452">.</span><span class="ident" id="2950453">Network</span><span class="op" id="2950460">(</span><span class="op" id="2950461">)</span>&nbsp;<span class="op" id="2950463">!=</span>&nbsp;<span class="ident" id="2950466">ra</span><span class="op" id="2950468">.</span><span class="ident" id="2950469">Network</span><span class="op" id="2950476">(</span><span class="op" id="2950477">)</span>&nbsp;<span class="op" id="2950479">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950483">return</span>&nbsp;<span class="ident" id="2950490">nil</span><span class="op" id="2950493">,</span>&nbsp;<span class="op" id="2950495">&amp;</span><span class="ident" id="2950496">OpError</span><span class="op" id="2950503">{</span><span class="ident" id="2950504">Op</span><span class="op" id="2950506">:</span>&nbsp;<span class="string" id="2950508">&#34;dial&#34;</span><span class="op" id="2950514">,</span>&nbsp;<span class="ident" id="2950516">Net</span><span class="op" id="2950519">:</span>&nbsp;<span class="ident" id="2950521">net</span><span class="op" id="2950524">,</span>&nbsp;<span class="ident" id="2950526">Addr</span><span class="op" id="2950530">:</span>&nbsp;<span class="ident" id="2950532">ra</span><span class="op" id="2950534">,</span>&nbsp;<span class="ident" id="2950536">Err</span><span class="op" id="2950539">:</span>&nbsp;<span class="ident" id="2950541">errors</span><span class="op" id="2950547">.</span><span class="ident" id="2950548">New</span><span class="op" id="2950551">(</span><span class="string" id="2950552">&#34;mismatched&nbsp;local&nbsp;address&nbsp;type&nbsp;&#34;</span>&nbsp;<span class="op" id="2950585">+</span>&nbsp;<span class="ident" id="2950587">la</span><span class="op" id="2950589">.</span><span class="ident" id="2950590">Network</span><span class="op" id="2950597">(</span><span class="op" id="2950598">)</span><span class="op" id="2950599">)</span><span class="op" id="2950600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2950603">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950606">switch</span>&nbsp;<span class="ident" id="2950613">ra</span>&nbsp;<span class="op" id="2950616">:=</span>&nbsp;<span class="ident" id="2950619">ra</span><span class="op" id="2950621">.</span><span class="op" id="2950622">(</span><span class="keyword" id="2950623">type</span><span class="op" id="2950627">)</span>&nbsp;<span class="op" id="2950629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950632">case</span>&nbsp;<span class="op" id="2950637">*</span><span class="ident" id="2950638">TCPAddr</span><span class="op" id="2950645">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950649">la</span><span class="op" id="2950651">,</span>&nbsp;<span class="ident" id="2950653">_</span>&nbsp;<span class="op" id="2950655">:=</span>&nbsp;<span class="ident" id="2950658">la</span><span class="op" id="2950660">.</span><span class="op" id="2950661">(</span><span class="op" id="2950662">*</span><span class="ident" id="2950663">TCPAddr</span><span class="op" id="2950670">)</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950674">c</span><span class="op" id="2950675">,</span>&nbsp;<span class="ident" id="2950677">err</span>&nbsp;<span class="op" id="2950681">=</span>&nbsp;<span class="ident" id="2950683">dialTCP</span><span class="op" id="2950690">(</span><span class="ident" id="2950691">net</span><span class="op" id="2950694">,</span>&nbsp;<span class="ident" id="2950696">la</span><span class="op" id="2950698">,</span>&nbsp;<span class="ident" id="2950700">ra</span><span class="op" id="2950702">,</span>&nbsp;<span class="ident" id="2950704">deadline</span><span class="op" id="2950712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950715">case</span>&nbsp;<span class="op" id="2950720">*</span><span class="ident" id="2950721">UDPAddr</span><span class="op" id="2950728">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950732">la</span><span class="op" id="2950734">,</span>&nbsp;<span class="ident" id="2950736">_</span>&nbsp;<span class="op" id="2950738">:=</span>&nbsp;<span class="ident" id="2950741">la</span><span class="op" id="2950743">.</span><span class="op" id="2950744">(</span><span class="op" id="2950745">*</span><span class="ident" id="2950746">UDPAddr</span><span class="op" id="2950753">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950757">c</span><span class="op" id="2950758">,</span>&nbsp;<span class="ident" id="2950760">err</span>&nbsp;<span class="op" id="2950764">=</span>&nbsp;<span class="ident" id="2950766">dialUDP</span><span class="op" id="2950773">(</span><span class="ident" id="2950774">net</span><span class="op" id="2950777">,</span>&nbsp;<span class="ident" id="2950779">la</span><span class="op" id="2950781">,</span>&nbsp;<span class="ident" id="2950783">ra</span><span class="op" id="2950785">,</span>&nbsp;<span class="ident" id="2950787">deadline</span><span class="op" id="2950795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950798">case</span>&nbsp;<span class="op" id="2950803">*</span><span class="ident" id="2950804">IPAddr</span><span class="op" id="2950810">:</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950814">la</span><span class="op" id="2950816">,</span>&nbsp;<span class="ident" id="2950818">_</span>&nbsp;<span class="op" id="2950820">:=</span>&nbsp;<span class="ident" id="2950823">la</span><span class="op" id="2950825">.</span><span class="op" id="2950826">(</span><span class="op" id="2950827">*</span><span class="ident" id="2950828">IPAddr</span><span class="op" id="2950834">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950838">c</span><span class="op" id="2950839">,</span>&nbsp;<span class="ident" id="2950841">err</span>&nbsp;<span class="op" id="2950845">=</span>&nbsp;<span class="ident" id="2950847">dialIP</span><span class="op" id="2950853">(</span><span class="ident" id="2950854">net</span><span class="op" id="2950857">,</span>&nbsp;<span class="ident" id="2950859">la</span><span class="op" id="2950861">,</span>&nbsp;<span class="ident" id="2950863">ra</span><span class="op" id="2950865">,</span>&nbsp;<span class="ident" id="2950867">deadline</span><span class="op" id="2950875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950878">case</span>&nbsp;<span class="op" id="2950883">*</span><span class="ident" id="2950884">UnixAddr</span><span class="op" id="2950892">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950896">la</span><span class="op" id="2950898">,</span>&nbsp;<span class="ident" id="2950900">_</span>&nbsp;<span class="op" id="2950902">:=</span>&nbsp;<span class="ident" id="2950905">la</span><span class="op" id="2950907">.</span><span class="op" id="2950908">(</span><span class="op" id="2950909">*</span><span class="ident" id="2950910">UnixAddr</span><span class="op" id="2950918">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2950922">c</span><span class="op" id="2950923">,</span>&nbsp;<span class="ident" id="2950925">err</span>&nbsp;<span class="op" id="2950929">=</span>&nbsp;<span class="ident" id="2950931">dialUnix</span><span class="op" id="2950939">(</span><span class="ident" id="2950940">net</span><span class="op" id="2950943">,</span>&nbsp;<span class="ident" id="2950945">la</span><span class="op" id="2950947">,</span>&nbsp;<span class="ident" id="2950949">ra</span><span class="op" id="2950951">,</span>&nbsp;<span class="ident" id="2950953">deadline</span><span class="op" id="2950961">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950964">default</span><span class="op" id="2950971">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2950975">return</span>&nbsp;<span class="ident" id="2950982">nil</span><span class="op" id="2950985">,</span>&nbsp;<span class="op" id="2950987">&amp;</span><span class="ident" id="2950988">OpError</span><span class="op" id="2950995">{</span><span class="ident" id="2950996">Op</span><span class="op" id="2950998">:</span>&nbsp;<span class="string" id="2951000">&#34;dial&#34;</span><span class="op" id="2951006">,</span>&nbsp;<span class="ident" id="2951008">Net</span><span class="op" id="2951011">:</span>&nbsp;<span class="ident" id="2951013">net</span><span class="op" id="2951016">,</span>&nbsp;<span class="ident" id="2951018">Addr</span><span class="op" id="2951022">:</span>&nbsp;<span class="ident" id="2951024">ra</span><span class="op" id="2951026">,</span>&nbsp;<span class="ident" id="2951028">Err</span><span class="op" id="2951031">:</span>&nbsp;<span class="op" id="2951033">&amp;</span><span class="ident" id="2951034">AddrError</span><span class="op" id="2951043">{</span><span class="ident" id="2951044">Err</span><span class="op" id="2951047">:</span>&nbsp;<span class="string" id="2951049">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2951074">,</span>&nbsp;<span class="ident" id="2951076">Addr</span><span class="op" id="2951080">:</span>&nbsp;<span class="ident" id="2951082">addr</span><span class="op" id="2951086">}</span><span class="op" id="2951087">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951090">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951093">if</span>&nbsp;<span class="ident" id="2951096">err</span>&nbsp;<span class="op" id="2951100">!=</span>&nbsp;<span class="ident" id="2951103">nil</span>&nbsp;<span class="op" id="2951107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951111">return</span>&nbsp;<span class="ident" id="2951118">nil</span><span class="op" id="2951121">,</span>&nbsp;<span class="ident" id="2951123">err</span>&nbsp;<span class="comment" id="2951127">//&nbsp;c&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951177">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951180">return</span>&nbsp;<span class="ident" id="2951187">c</span><span class="op" id="2951188">,</span>&nbsp;<span class="ident" id="2951190">nil</span><br>
<span class="lineno"></span><span class="op" id="2951194">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2951197">//&nbsp;Listen&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno">255</span><span class="comment" id="2951253">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;stream-oriented&nbsp;network:&nbsp;&#34;tcp&#34;,&nbsp;&#34;tcp4&#34;,</span><br>
<span class="lineno"></span><span class="comment" id="2951322">//&nbsp;&#34;tcp6&#34;,&nbsp;&#34;unix&#34;&nbsp;or&nbsp;&#34;unixpacket&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2951357">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="2951394">func</span>&nbsp;<span class="ident" id="2951399">Listen</span><span class="op" id="2951405">(</span><span class="ident" id="2951406">net</span><span class="op" id="2951409">,</span>&nbsp;<span class="ident" id="2951411">laddr</span>&nbsp;<span class="builtintype" id="2951417">string</span><span class="op" id="2951423">)</span>&nbsp;<span class="op" id="2951425">(</span><span class="ident" id="2951426">Listener</span><span class="op" id="2951434">,</span>&nbsp;<span class="builtintype" id="2951436">error</span><span class="op" id="2951441">)</span>&nbsp;<span class="op" id="2951443">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951446">la</span><span class="op" id="2951448">,</span>&nbsp;<span class="ident" id="2951450">err</span>&nbsp;<span class="op" id="2951454">:=</span>&nbsp;<span class="ident" id="2951457">resolveAddr</span><span class="op" id="2951468">(</span><span class="string" id="2951469">&#34;listen&#34;</span><span class="op" id="2951477">,</span>&nbsp;<span class="ident" id="2951479">net</span><span class="op" id="2951482">,</span>&nbsp;<span class="ident" id="2951484">laddr</span><span class="op" id="2951489">,</span>&nbsp;<span class="ident" id="2951491">noDeadline</span><span class="op" id="2951501">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951504">if</span>&nbsp;<span class="ident" id="2951507">err</span>&nbsp;<span class="op" id="2951511">!=</span>&nbsp;<span class="ident" id="2951514">nil</span>&nbsp;<span class="op" id="2951518">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951522">return</span>&nbsp;<span class="ident" id="2951529">nil</span><span class="op" id="2951532">,</span>&nbsp;<span class="op" id="2951534">&amp;</span><span class="ident" id="2951535">OpError</span><span class="op" id="2951542">{</span><span class="ident" id="2951543">Op</span><span class="op" id="2951545">:</span>&nbsp;<span class="string" id="2951547">&#34;listen&#34;</span><span class="op" id="2951555">,</span>&nbsp;<span class="ident" id="2951557">Net</span><span class="op" id="2951560">:</span>&nbsp;<span class="ident" id="2951562">net</span><span class="op" id="2951565">,</span>&nbsp;<span class="ident" id="2951567">Addr</span><span class="op" id="2951571">:</span>&nbsp;<span class="ident" id="2951573">nil</span><span class="op" id="2951576">,</span>&nbsp;<span class="ident" id="2951578">Err</span><span class="op" id="2951581">:</span>&nbsp;<span class="ident" id="2951583">err</span><span class="op" id="2951586">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951589">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951592">var</span>&nbsp;<span class="ident" id="2951596">l</span>&nbsp;<span class="ident" id="2951598">Listener</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951608">switch</span>&nbsp;<span class="ident" id="2951615">la</span>&nbsp;<span class="op" id="2951618">:=</span>&nbsp;<span class="ident" id="2951621">la</span><span class="op" id="2951623">.</span><span class="ident" id="2951624">toAddr</span><span class="op" id="2951630">(</span><span class="op" id="2951631">)</span><span class="op" id="2951632">.</span><span class="op" id="2951633">(</span><span class="keyword" id="2951634">type</span><span class="op" id="2951638">)</span>&nbsp;<span class="op" id="2951640">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951643">case</span>&nbsp;<span class="op" id="2951648">*</span><span class="ident" id="2951649">TCPAddr</span><span class="op" id="2951656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951660">l</span><span class="op" id="2951661">,</span>&nbsp;<span class="ident" id="2951663">err</span>&nbsp;<span class="op" id="2951667">=</span>&nbsp;<span class="ident" id="2951669">ListenTCP</span><span class="op" id="2951678">(</span><span class="ident" id="2951679">net</span><span class="op" id="2951682">,</span>&nbsp;<span class="ident" id="2951684">la</span><span class="op" id="2951686">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951689">case</span>&nbsp;<span class="op" id="2951694">*</span><span class="ident" id="2951695">UnixAddr</span><span class="op" id="2951703">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2951707">l</span><span class="op" id="2951708">,</span>&nbsp;<span class="ident" id="2951710">err</span>&nbsp;<span class="op" id="2951714">=</span>&nbsp;<span class="ident" id="2951716">ListenUnix</span><span class="op" id="2951726">(</span><span class="ident" id="2951727">net</span><span class="op" id="2951730">,</span>&nbsp;<span class="ident" id="2951732">la</span><span class="op" id="2951734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951737">default</span><span class="op" id="2951744">:</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951748">return</span>&nbsp;<span class="ident" id="2951755">nil</span><span class="op" id="2951758">,</span>&nbsp;<span class="op" id="2951760">&amp;</span><span class="ident" id="2951761">OpError</span><span class="op" id="2951768">{</span><span class="ident" id="2951769">Op</span><span class="op" id="2951771">:</span>&nbsp;<span class="string" id="2951773">&#34;listen&#34;</span><span class="op" id="2951781">,</span>&nbsp;<span class="ident" id="2951783">Net</span><span class="op" id="2951786">:</span>&nbsp;<span class="ident" id="2951788">net</span><span class="op" id="2951791">,</span>&nbsp;<span class="ident" id="2951793">Addr</span><span class="op" id="2951797">:</span>&nbsp;<span class="ident" id="2951799">la</span><span class="op" id="2951801">,</span>&nbsp;<span class="ident" id="2951803">Err</span><span class="op" id="2951806">:</span>&nbsp;<span class="op" id="2951808">&amp;</span><span class="ident" id="2951809">AddrError</span><span class="op" id="2951818">{</span><span class="ident" id="2951819">Err</span><span class="op" id="2951822">:</span>&nbsp;<span class="string" id="2951824">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2951849">,</span>&nbsp;<span class="ident" id="2951851">Addr</span><span class="op" id="2951855">:</span>&nbsp;<span class="ident" id="2951857">laddr</span><span class="op" id="2951862">}</span><span class="op" id="2951863">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951866">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951869">if</span>&nbsp;<span class="ident" id="2951872">err</span>&nbsp;<span class="op" id="2951876">!=</span>&nbsp;<span class="ident" id="2951879">nil</span>&nbsp;<span class="op" id="2951883">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951887">return</span>&nbsp;<span class="ident" id="2951894">nil</span><span class="op" id="2951897">,</span>&nbsp;<span class="ident" id="2951899">err</span>&nbsp;<span class="comment" id="2951903">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2951953">}</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2951956">return</span>&nbsp;<span class="ident" id="2951963">l</span><span class="op" id="2951964">,</span>&nbsp;<span class="ident" id="2951966">nil</span><br>
<span class="lineno"></span><span class="op" id="2951970">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="2951973">//&nbsp;ListenPacket&nbsp;announces&nbsp;on&nbsp;the&nbsp;local&nbsp;network&nbsp;address&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="comment" id="2952035">//&nbsp;The&nbsp;network&nbsp;net&nbsp;must&nbsp;be&nbsp;a&nbsp;packet-oriented&nbsp;network:&nbsp;&#34;udp&#34;,&nbsp;&#34;udp4&#34;,</span><br>
<span class="lineno">280</span><span class="comment" id="2952104">//&nbsp;&#34;udp6&#34;,&nbsp;&#34;ip&#34;,&nbsp;&#34;ip4&#34;,&nbsp;&#34;ip6&#34;&nbsp;or&nbsp;&#34;unixgram&#34;.</span><br>
<span class="lineno"></span><span class="comment" id="2952149">//&nbsp;See&nbsp;Dial&nbsp;for&nbsp;the&nbsp;syntax&nbsp;of&nbsp;laddr.</span><br>
<span class="lineno"></span><span class="keyword" id="2952186">func</span>&nbsp;<span class="ident" id="2952191">ListenPacket</span><span class="op" id="2952203">(</span><span class="ident" id="2952204">net</span><span class="op" id="2952207">,</span>&nbsp;<span class="ident" id="2952209">laddr</span>&nbsp;<span class="builtintype" id="2952215">string</span><span class="op" id="2952221">)</span>&nbsp;<span class="op" id="2952223">(</span><span class="ident" id="2952224">PacketConn</span><span class="op" id="2952234">,</span>&nbsp;<span class="builtintype" id="2952236">error</span><span class="op" id="2952241">)</span>&nbsp;<span class="op" id="2952243">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2952246">la</span><span class="op" id="2952248">,</span>&nbsp;<span class="ident" id="2952250">err</span>&nbsp;<span class="op" id="2952254">:=</span>&nbsp;<span class="ident" id="2952257">resolveAddr</span><span class="op" id="2952268">(</span><span class="string" id="2952269">&#34;listen&#34;</span><span class="op" id="2952277">,</span>&nbsp;<span class="ident" id="2952279">net</span><span class="op" id="2952282">,</span>&nbsp;<span class="ident" id="2952284">laddr</span><span class="op" id="2952289">,</span>&nbsp;<span class="ident" id="2952291">noDeadline</span><span class="op" id="2952301">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952304">if</span>&nbsp;<span class="ident" id="2952307">err</span>&nbsp;<span class="op" id="2952311">!=</span>&nbsp;<span class="ident" id="2952314">nil</span>&nbsp;<span class="op" id="2952318">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952322">return</span>&nbsp;<span class="ident" id="2952329">nil</span><span class="op" id="2952332">,</span>&nbsp;<span class="op" id="2952334">&amp;</span><span class="ident" id="2952335">OpError</span><span class="op" id="2952342">{</span><span class="ident" id="2952343">Op</span><span class="op" id="2952345">:</span>&nbsp;<span class="string" id="2952347">&#34;listen&#34;</span><span class="op" id="2952355">,</span>&nbsp;<span class="ident" id="2952357">Net</span><span class="op" id="2952360">:</span>&nbsp;<span class="ident" id="2952362">net</span><span class="op" id="2952365">,</span>&nbsp;<span class="ident" id="2952367">Addr</span><span class="op" id="2952371">:</span>&nbsp;<span class="ident" id="2952373">nil</span><span class="op" id="2952376">,</span>&nbsp;<span class="ident" id="2952378">Err</span><span class="op" id="2952381">:</span>&nbsp;<span class="ident" id="2952383">err</span><span class="op" id="2952386">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2952389">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952392">var</span>&nbsp;<span class="ident" id="2952396">l</span>&nbsp;<span class="ident" id="2952398">PacketConn</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952410">switch</span>&nbsp;<span class="ident" id="2952417">la</span>&nbsp;<span class="op" id="2952420">:=</span>&nbsp;<span class="ident" id="2952423">la</span><span class="op" id="2952425">.</span><span class="ident" id="2952426">toAddr</span><span class="op" id="2952432">(</span><span class="op" id="2952433">)</span><span class="op" id="2952434">.</span><span class="op" id="2952435">(</span><span class="keyword" id="2952436">type</span><span class="op" id="2952440">)</span>&nbsp;<span class="op" id="2952442">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952445">case</span>&nbsp;<span class="op" id="2952450">*</span><span class="ident" id="2952451">UDPAddr</span><span class="op" id="2952458">:</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2952462">l</span><span class="op" id="2952463">,</span>&nbsp;<span class="ident" id="2952465">err</span>&nbsp;<span class="op" id="2952469">=</span>&nbsp;<span class="ident" id="2952471">ListenUDP</span><span class="op" id="2952480">(</span><span class="ident" id="2952481">net</span><span class="op" id="2952484">,</span>&nbsp;<span class="ident" id="2952486">la</span><span class="op" id="2952488">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952491">case</span>&nbsp;<span class="op" id="2952496">*</span><span class="ident" id="2952497">IPAddr</span><span class="op" id="2952503">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2952507">l</span><span class="op" id="2952508">,</span>&nbsp;<span class="ident" id="2952510">err</span>&nbsp;<span class="op" id="2952514">=</span>&nbsp;<span class="ident" id="2952516">ListenIP</span><span class="op" id="2952524">(</span><span class="ident" id="2952525">net</span><span class="op" id="2952528">,</span>&nbsp;<span class="ident" id="2952530">la</span><span class="op" id="2952532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952535">case</span>&nbsp;<span class="op" id="2952540">*</span><span class="ident" id="2952541">UnixAddr</span><span class="op" id="2952549">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="2952553">l</span><span class="op" id="2952554">,</span>&nbsp;<span class="ident" id="2952556">err</span>&nbsp;<span class="op" id="2952560">=</span>&nbsp;<span class="ident" id="2952562">ListenUnixgram</span><span class="op" id="2952576">(</span><span class="ident" id="2952577">net</span><span class="op" id="2952580">,</span>&nbsp;<span class="ident" id="2952582">la</span><span class="op" id="2952584">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952587">default</span><span class="op" id="2952594">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952598">return</span>&nbsp;<span class="ident" id="2952605">nil</span><span class="op" id="2952608">,</span>&nbsp;<span class="op" id="2952610">&amp;</span><span class="ident" id="2952611">OpError</span><span class="op" id="2952618">{</span><span class="ident" id="2952619">Op</span><span class="op" id="2952621">:</span>&nbsp;<span class="string" id="2952623">&#34;listen&#34;</span><span class="op" id="2952631">,</span>&nbsp;<span class="ident" id="2952633">Net</span><span class="op" id="2952636">:</span>&nbsp;<span class="ident" id="2952638">net</span><span class="op" id="2952641">,</span>&nbsp;<span class="ident" id="2952643">Addr</span><span class="op" id="2952647">:</span>&nbsp;<span class="ident" id="2952649">la</span><span class="op" id="2952651">,</span>&nbsp;<span class="ident" id="2952653">Err</span><span class="op" id="2952656">:</span>&nbsp;<span class="op" id="2952658">&amp;</span><span class="ident" id="2952659">AddrError</span><span class="op" id="2952668">{</span><span class="ident" id="2952669">Err</span><span class="op" id="2952672">:</span>&nbsp;<span class="string" id="2952674">&#34;unexpected&nbsp;address&nbsp;type&#34;</span><span class="op" id="2952699">,</span>&nbsp;<span class="ident" id="2952701">Addr</span><span class="op" id="2952705">:</span>&nbsp;<span class="ident" id="2952707">laddr</span><span class="op" id="2952712">}</span><span class="op" id="2952713">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2952716">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952719">if</span>&nbsp;<span class="ident" id="2952722">err</span>&nbsp;<span class="op" id="2952726">!=</span>&nbsp;<span class="ident" id="2952729">nil</span>&nbsp;<span class="op" id="2952733">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952737">return</span>&nbsp;<span class="ident" id="2952744">nil</span><span class="op" id="2952747">,</span>&nbsp;<span class="ident" id="2952749">err</span>&nbsp;<span class="comment" id="2952753">//&nbsp;l&nbsp;is&nbsp;non-nil&nbsp;interface&nbsp;containing&nbsp;nil&nbsp;pointer</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="2952803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="2952806">return</span>&nbsp;<span class="ident" id="2952813">l</span><span class="op" id="2952814">,</span>&nbsp;<span class="ident" id="2952816">nil</span><br>
<span class="lineno"></span><span class="op" id="2952820">}</span>
</div>
</body>
</html>
