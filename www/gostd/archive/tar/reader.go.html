<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/tar</h2>
<ul>
<li><a href="/gostd/archive/tar/common.go.html">common.go</a></li>
<li><a href="/gostd/archive/tar/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/tar/reader.go.html" class="current">reader.go</a></li>
<li><a href="/gostd/archive/tar/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/tar/stat_atim.go.html">stat_atim.go</a></li>
<li><a href="/gostd/archive/tar/stat_unix.go.html">stat_unix.go</a></li>
<li><a href="/gostd/archive/tar/tar_test.go.html">tar_test.go</a></li>
<li><a href="/gostd/archive/tar/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/tar/writer_test.go.html">writer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5250501">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5250556">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5250610">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5250661">package</span>&nbsp;<span class="ident" id="5250669">tar</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250674">//&nbsp;TODO(dsymonds):</span><br>
<span class="lineno"></span><span class="comment" id="5250693">//&nbsp;&nbsp;&nbsp;-&nbsp;pax&nbsp;extensions</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="5250716">import</span>&nbsp;<span class="op" id="5250723">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250726">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250735">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250745">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250751">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250764">&#34;os&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250770">&#34;strconv&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250781">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5250792">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="5250799">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5250802">var</span>&nbsp;<span class="op" id="5250806">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5250809">ErrHeader</span>&nbsp;<span class="op" id="5250819">=</span>&nbsp;<span class="ident" id="5250821">errors</span><span class="op" id="5250827">.</span><span class="ident" id="5250828">New</span><span class="op" id="5250831">(</span><span class="string" id="5250832">&#34;archive/tar:&nbsp;invalid&nbsp;tar&nbsp;header&#34;</span><span class="op" id="5250865">)</span><br>
<span class="lineno"></span><span class="op" id="5250867">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="5250870">const</span>&nbsp;<span class="ident" id="5250876">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5250897">=</span>&nbsp;<span class="num" id="5250899">9</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5250902">//&nbsp;A&nbsp;Reader&nbsp;provides&nbsp;sequential&nbsp;access&nbsp;to&nbsp;the&nbsp;contents&nbsp;of&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5250975">//&nbsp;A&nbsp;tar&nbsp;archive&nbsp;consists&nbsp;of&nbsp;a&nbsp;sequence&nbsp;of&nbsp;files.</span><br>
<span class="lineno"></span><span class="comment" id="5251025">//&nbsp;The&nbsp;Next&nbsp;method&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;file&nbsp;in&nbsp;the&nbsp;archive&nbsp;(including&nbsp;the&nbsp;first),</span><br>
<span class="lineno">30</span><span class="comment" id="5251108">//&nbsp;and&nbsp;then&nbsp;it&nbsp;can&nbsp;be&nbsp;treated&nbsp;as&nbsp;an&nbsp;io.Reader&nbsp;to&nbsp;access&nbsp;the&nbsp;file&#39;s&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5251181">type</span>&nbsp;<span class="ident" id="5251186">Reader</span>&nbsp;<span class="keyword" id="5251193">struct</span>&nbsp;<span class="op" id="5251200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251203">r</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251211">io</span><span class="op" id="5251213">.</span><span class="ident" id="5251214">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251222">err</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5251230">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251237">pad</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251245">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251261">//&nbsp;amount&nbsp;of&nbsp;padding&nbsp;(ignored)&nbsp;after&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251318">curr</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5251326">numBytesReader</span>&nbsp;&nbsp;<span class="comment" id="5251342">//&nbsp;reader&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251376">hdrBuff</span>&nbsp;<span class="op" id="5251384">[</span><span class="ident" id="5251385">blockSize</span><span class="op" id="5251394">]</span><span class="builtintype" id="5251395">byte</span>&nbsp;<span class="comment" id="5251400">//&nbsp;buffer&nbsp;to&nbsp;use&nbsp;in&nbsp;readHeader</span><br>
<span class="lineno"></span><span class="op" id="5251431">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5251434">//&nbsp;A&nbsp;numBytesReader&nbsp;is&nbsp;an&nbsp;io.Reader&nbsp;with&nbsp;a&nbsp;numBytes&nbsp;method,&nbsp;returning&nbsp;the&nbsp;number</span><br>
<span class="lineno">40</span><span class="comment" id="5251515">//&nbsp;of&nbsp;bytes&nbsp;remaining&nbsp;in&nbsp;the&nbsp;underlying&nbsp;encoded&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5251569">type</span>&nbsp;<span class="ident" id="5251574">numBytesReader</span>&nbsp;<span class="keyword" id="5251589">interface</span>&nbsp;<span class="op" id="5251599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251602">io</span><span class="op" id="5251604">.</span><span class="ident" id="5251605">Reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251613">numBytes</span><span class="op" id="5251621">(</span><span class="op" id="5251622">)</span>&nbsp;<span class="ident" id="5251624">int64</span><br>
<span class="lineno"></span><span class="op" id="5251630">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5251633">//&nbsp;A&nbsp;regFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5251714">type</span>&nbsp;<span class="ident" id="5251719">regFileReader</span>&nbsp;<span class="keyword" id="5251733">struct</span>&nbsp;<span class="op" id="5251740">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251743">r</span>&nbsp;&nbsp;<span class="ident" id="5251746">io</span><span class="op" id="5251748">.</span><span class="ident" id="5251749">Reader</span>&nbsp;<span class="comment" id="5251756">//&nbsp;underlying&nbsp;reader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251778">nb</span>&nbsp;<span class="ident" id="5251781">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5251791">//&nbsp;number&nbsp;of&nbsp;unread&nbsp;bytes&nbsp;for&nbsp;current&nbsp;file&nbsp;entry</span><br>
<span class="lineno">50</span><span class="op" id="5251840">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5251843">//&nbsp;A&nbsp;sparseFileReader&nbsp;is&nbsp;a&nbsp;numBytesReader&nbsp;for&nbsp;reading&nbsp;sparse&nbsp;file&nbsp;data&nbsp;from&nbsp;a&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5251934">type</span>&nbsp;<span class="ident" id="5251939">sparseFileReader</span>&nbsp;<span class="keyword" id="5251956">struct</span>&nbsp;<span class="op" id="5251963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5251966">rfr</span>&nbsp;<span class="op" id="5251970">*</span><span class="ident" id="5251971">regFileReader</span>&nbsp;<span class="comment" id="5251985">//&nbsp;reads&nbsp;the&nbsp;sparse-encoded&nbsp;file&nbsp;data</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252024">sp</span>&nbsp;&nbsp;<span class="op" id="5252028">[</span><span class="op" id="5252029">]</span><span class="ident" id="5252030">sparseEntry</span>&nbsp;&nbsp;<span class="comment" id="5252043">//&nbsp;the&nbsp;sparse&nbsp;map&nbsp;for&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252075">pos</span>&nbsp;<span class="ident" id="5252079">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252094">//&nbsp;keeps&nbsp;track&nbsp;of&nbsp;file&nbsp;position</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252127">tot</span>&nbsp;<span class="ident" id="5252131">int64</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5252146">//&nbsp;total&nbsp;size&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span><span class="op" id="5252172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span><span class="comment" id="5252175">//&nbsp;Keywords&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;files&nbsp;in&nbsp;a&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span><span class="keyword" id="5252233">const</span>&nbsp;<span class="op" id="5252239">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252242">paxGNUSparseNumBlocks</span>&nbsp;<span class="op" id="5252264">=</span>&nbsp;<span class="string" id="5252266">&#34;GNU.sparse.numblocks&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252290">paxGNUSparseOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252312">=</span>&nbsp;<span class="string" id="5252314">&#34;GNU.sparse.offset&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252335">paxGNUSparseNumBytes</span>&nbsp;&nbsp;<span class="op" id="5252357">=</span>&nbsp;<span class="string" id="5252359">&#34;GNU.sparse.numbytes&#34;</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252382">paxGNUSparseMap</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252404">=</span>&nbsp;<span class="string" id="5252406">&#34;GNU.sparse.map&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252424">paxGNUSparseName</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252446">=</span>&nbsp;<span class="string" id="5252448">&#34;GNU.sparse.name&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252467">paxGNUSparseMajor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252489">=</span>&nbsp;<span class="string" id="5252491">&#34;GNU.sparse.major&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252511">paxGNUSparseMinor</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252533">=</span>&nbsp;<span class="string" id="5252535">&#34;GNU.sparse.minor&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252555">paxGNUSparseSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252577">=</span>&nbsp;<span class="string" id="5252579">&#34;GNU.sparse.size&#34;</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252598">paxGNUSparseRealSize</span>&nbsp;&nbsp;<span class="op" id="5252620">=</span>&nbsp;<span class="string" id="5252622">&#34;GNU.sparse.realsize&#34;</span><br>
<span class="lineno"></span><span class="op" id="5252644">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5252647">//&nbsp;Keywords&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;headers</span><br>
<span class="lineno"></span><span class="keyword" id="5252686">const</span>&nbsp;<span class="op" id="5252692">(</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252695">oldGNUSparseMainHeaderOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252738">=</span>&nbsp;<span class="num" id="5252740">386</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252745">oldGNUSparseMainHeaderIsExtendedOffset</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252788">=</span>&nbsp;<span class="num" id="5252790">482</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252795">oldGNUSparseMainHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252838">=</span>&nbsp;<span class="num" id="5252840">4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252843">oldGNUSparseExtendedHeaderIsExtendedOffset</span>&nbsp;<span class="op" id="5252886">=</span>&nbsp;<span class="num" id="5252888">504</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252893">oldGNUSparseExtendedHeaderNumEntries</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252936">=</span>&nbsp;<span class="num" id="5252938">21</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252942">oldGNUSparseOffsetSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5252985">=</span>&nbsp;<span class="num" id="5252987">12</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5252991">oldGNUSparseNumBytesSize</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5253034">=</span>&nbsp;<span class="num" id="5253036">12</span><br>
<span class="lineno"></span><span class="op" id="5253039">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5253042">//&nbsp;NewReader&nbsp;creates&nbsp;a&nbsp;new&nbsp;Reader&nbsp;reading&nbsp;from&nbsp;r.</span><br>
<span class="lineno">85</span><span class="keyword" id="5253092">func</span>&nbsp;<span class="ident" id="5253097">NewReader</span><span class="op" id="5253106">(</span><span class="ident" id="5253107">r</span>&nbsp;<span class="ident" id="5253109">io</span><span class="op" id="5253111">.</span><span class="ident" id="5253112">Reader</span><span class="op" id="5253118">)</span>&nbsp;<span class="op" id="5253120">*</span><span class="ident" id="5253121">Reader</span>&nbsp;<span class="op" id="5253128">{</span>&nbsp;<span class="keyword" id="5253130">return</span>&nbsp;<span class="op" id="5253137">&amp;</span><span class="ident" id="5253138">Reader</span><span class="op" id="5253144">{</span><span class="ident" id="5253145">r</span><span class="op" id="5253146">:</span>&nbsp;<span class="ident" id="5253148">r</span><span class="op" id="5253149">}</span>&nbsp;<span class="op" id="5253151">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5253154">//&nbsp;Next&nbsp;advances&nbsp;to&nbsp;the&nbsp;next&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5253209">func</span>&nbsp;<span class="op" id="5253214">(</span><span class="ident" id="5253215">tr</span>&nbsp;<span class="op" id="5253218">*</span><span class="ident" id="5253219">Reader</span><span class="op" id="5253225">)</span>&nbsp;<span class="ident" id="5253227">Next</span><span class="op" id="5253231">(</span><span class="op" id="5253232">)</span>&nbsp;<span class="op" id="5253234">(</span><span class="op" id="5253235">*</span><span class="ident" id="5253236">Header</span><span class="op" id="5253242">,</span>&nbsp;<span class="builtintype" id="5253244">error</span><span class="op" id="5253249">)</span>&nbsp;<span class="op" id="5253251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253254">var</span>&nbsp;<span class="ident" id="5253258">hdr</span>&nbsp;<span class="op" id="5253262">*</span><span class="ident" id="5253263">Header</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253271">if</span>&nbsp;<span class="ident" id="5253274">tr</span><span class="op" id="5253276">.</span><span class="ident" id="5253277">err</span>&nbsp;<span class="op" id="5253281">==</span>&nbsp;<span class="ident" id="5253284">nil</span>&nbsp;<span class="op" id="5253288">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253292">tr</span><span class="op" id="5253294">.</span><span class="ident" id="5253295">skipUnread</span><span class="op" id="5253305">(</span><span class="op" id="5253306">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253309">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253312">if</span>&nbsp;<span class="ident" id="5253315">tr</span><span class="op" id="5253317">.</span><span class="ident" id="5253318">err</span>&nbsp;<span class="op" id="5253322">!=</span>&nbsp;<span class="ident" id="5253325">nil</span>&nbsp;<span class="op" id="5253329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253333">return</span>&nbsp;<span class="ident" id="5253340">hdr</span><span class="op" id="5253343">,</span>&nbsp;<span class="ident" id="5253345">tr</span><span class="op" id="5253347">.</span><span class="ident" id="5253348">err</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253356">hdr</span>&nbsp;<span class="op" id="5253360">=</span>&nbsp;<span class="ident" id="5253362">tr</span><span class="op" id="5253364">.</span><span class="ident" id="5253365">readHeader</span><span class="op" id="5253375">(</span><span class="op" id="5253376">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253379">if</span>&nbsp;<span class="ident" id="5253382">hdr</span>&nbsp;<span class="op" id="5253386">==</span>&nbsp;<span class="ident" id="5253389">nil</span>&nbsp;<span class="op" id="5253393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253397">return</span>&nbsp;<span class="ident" id="5253404">hdr</span><span class="op" id="5253407">,</span>&nbsp;<span class="ident" id="5253409">tr</span><span class="op" id="5253411">.</span><span class="ident" id="5253412">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253417">}</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253420">//&nbsp;Check&nbsp;for&nbsp;PAX/GNU&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253450">switch</span>&nbsp;<span class="ident" id="5253457">hdr</span><span class="op" id="5253460">.</span><span class="ident" id="5253461">Typeflag</span>&nbsp;<span class="op" id="5253470">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253473">case</span>&nbsp;<span class="ident" id="5253478">TypeXHeader</span><span class="op" id="5253489">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253493">//&nbsp;&nbsp;PAX&nbsp;extended&nbsp;header</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253519">headers</span><span class="op" id="5253526">,</span>&nbsp;<span class="ident" id="5253528">err</span>&nbsp;<span class="op" id="5253532">:=</span>&nbsp;<span class="ident" id="5253535">parsePAX</span><span class="op" id="5253543">(</span><span class="ident" id="5253544">tr</span><span class="op" id="5253546">)</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253550">if</span>&nbsp;<span class="ident" id="5253553">err</span>&nbsp;<span class="op" id="5253557">!=</span>&nbsp;<span class="ident" id="5253560">nil</span>&nbsp;<span class="op" id="5253564">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253569">return</span>&nbsp;<span class="ident" id="5253576">nil</span><span class="op" id="5253579">,</span>&nbsp;<span class="ident" id="5253581">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253587">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253591">//&nbsp;We&nbsp;actually&nbsp;read&nbsp;the&nbsp;whole&nbsp;file,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253629">//&nbsp;but&nbsp;this&nbsp;skips&nbsp;alignment&nbsp;padding</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253667">tr</span><span class="op" id="5253669">.</span><span class="ident" id="5253670">skipUnread</span><span class="op" id="5253680">(</span><span class="op" id="5253681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253685">hdr</span>&nbsp;<span class="op" id="5253689">=</span>&nbsp;<span class="ident" id="5253691">tr</span><span class="op" id="5253693">.</span><span class="ident" id="5253694">readHeader</span><span class="op" id="5253704">(</span><span class="op" id="5253705">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253709">mergePAX</span><span class="op" id="5253717">(</span><span class="ident" id="5253718">hdr</span><span class="op" id="5253721">,</span>&nbsp;<span class="ident" id="5253723">headers</span><span class="op" id="5253730">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253735">//&nbsp;Check&nbsp;for&nbsp;a&nbsp;PAX&nbsp;format&nbsp;sparse&nbsp;file</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253775">sp</span><span class="op" id="5253777">,</span>&nbsp;<span class="ident" id="5253779">err</span>&nbsp;<span class="op" id="5253783">:=</span>&nbsp;<span class="ident" id="5253786">tr</span><span class="op" id="5253788">.</span><span class="ident" id="5253789">checkForGNUSparsePAXHeaders</span><span class="op" id="5253816">(</span><span class="ident" id="5253817">hdr</span><span class="op" id="5253820">,</span>&nbsp;<span class="ident" id="5253822">headers</span><span class="op" id="5253829">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253833">if</span>&nbsp;<span class="ident" id="5253836">err</span>&nbsp;<span class="op" id="5253840">!=</span>&nbsp;<span class="ident" id="5253843">nil</span>&nbsp;<span class="op" id="5253847">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5253852">tr</span><span class="op" id="5253854">.</span><span class="ident" id="5253855">err</span>&nbsp;<span class="op" id="5253859">=</span>&nbsp;<span class="ident" id="5253861">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253868">return</span>&nbsp;<span class="ident" id="5253875">nil</span><span class="op" id="5253878">,</span>&nbsp;<span class="ident" id="5253880">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5253886">}</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5253890">if</span>&nbsp;<span class="ident" id="5253893">sp</span>&nbsp;<span class="op" id="5253896">!=</span>&nbsp;<span class="ident" id="5253899">nil</span>&nbsp;<span class="op" id="5253903">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253908">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5253960">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader&nbsp;to&nbsp;a&nbsp;sparse&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254019">tr</span><span class="op" id="5254021">.</span><span class="ident" id="5254022">curr</span>&nbsp;<span class="op" id="5254027">=</span>&nbsp;<span class="op" id="5254029">&amp;</span><span class="ident" id="5254030">sparseFileReader</span><span class="op" id="5254046">{</span><span class="ident" id="5254047">rfr</span><span class="op" id="5254050">:</span>&nbsp;<span class="ident" id="5254052">tr</span><span class="op" id="5254054">.</span><span class="ident" id="5254055">curr</span><span class="op" id="5254059">.</span><span class="op" id="5254060">(</span><span class="op" id="5254061">*</span><span class="ident" id="5254062">regFileReader</span><span class="op" id="5254075">)</span><span class="op" id="5254076">,</span>&nbsp;<span class="ident" id="5254078">sp</span><span class="op" id="5254080">:</span>&nbsp;<span class="ident" id="5254082">sp</span><span class="op" id="5254084">,</span>&nbsp;<span class="ident" id="5254086">tot</span><span class="op" id="5254089">:</span>&nbsp;<span class="ident" id="5254091">hdr</span><span class="op" id="5254094">.</span><span class="ident" id="5254095">Size</span><span class="op" id="5254099">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254103">}</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254107">return</span>&nbsp;<span class="ident" id="5254114">hdr</span><span class="op" id="5254117">,</span>&nbsp;<span class="ident" id="5254119">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254124">case</span>&nbsp;<span class="ident" id="5254129">TypeGNULongName</span><span class="op" id="5254144">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5254148">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;name&nbsp;header.&nbsp;Its&nbsp;contents&nbsp;are&nbsp;the&nbsp;real&nbsp;file&nbsp;name.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254222">realname</span><span class="op" id="5254230">,</span>&nbsp;<span class="ident" id="5254232">err</span>&nbsp;<span class="op" id="5254236">:=</span>&nbsp;<span class="ident" id="5254239">ioutil</span><span class="op" id="5254245">.</span><span class="ident" id="5254246">ReadAll</span><span class="op" id="5254253">(</span><span class="ident" id="5254254">tr</span><span class="op" id="5254256">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254260">if</span>&nbsp;<span class="ident" id="5254263">err</span>&nbsp;<span class="op" id="5254267">!=</span>&nbsp;<span class="ident" id="5254270">nil</span>&nbsp;<span class="op" id="5254274">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254279">return</span>&nbsp;<span class="ident" id="5254286">nil</span><span class="op" id="5254289">,</span>&nbsp;<span class="ident" id="5254291">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254297">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254301">hdr</span><span class="op" id="5254304">,</span>&nbsp;<span class="ident" id="5254306">err</span>&nbsp;<span class="op" id="5254310">:=</span>&nbsp;<span class="ident" id="5254313">tr</span><span class="op" id="5254315">.</span><span class="ident" id="5254316">Next</span><span class="op" id="5254320">(</span><span class="op" id="5254321">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254325">hdr</span><span class="op" id="5254328">.</span><span class="ident" id="5254329">Name</span>&nbsp;<span class="op" id="5254334">=</span>&nbsp;<span class="ident" id="5254336">cString</span><span class="op" id="5254343">(</span><span class="ident" id="5254344">realname</span><span class="op" id="5254352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254356">return</span>&nbsp;<span class="ident" id="5254363">hdr</span><span class="op" id="5254366">,</span>&nbsp;<span class="ident" id="5254368">err</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254373">case</span>&nbsp;<span class="ident" id="5254378">TypeGNULongLink</span><span class="op" id="5254393">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5254397">//&nbsp;We&nbsp;have&nbsp;a&nbsp;GNU&nbsp;long&nbsp;link&nbsp;header.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254434">realname</span><span class="op" id="5254442">,</span>&nbsp;<span class="ident" id="5254444">err</span>&nbsp;<span class="op" id="5254448">:=</span>&nbsp;<span class="ident" id="5254451">ioutil</span><span class="op" id="5254457">.</span><span class="ident" id="5254458">ReadAll</span><span class="op" id="5254465">(</span><span class="ident" id="5254466">tr</span><span class="op" id="5254468">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254472">if</span>&nbsp;<span class="ident" id="5254475">err</span>&nbsp;<span class="op" id="5254479">!=</span>&nbsp;<span class="ident" id="5254482">nil</span>&nbsp;<span class="op" id="5254486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254491">return</span>&nbsp;<span class="ident" id="5254498">nil</span><span class="op" id="5254501">,</span>&nbsp;<span class="ident" id="5254503">err</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254513">hdr</span><span class="op" id="5254516">,</span>&nbsp;<span class="ident" id="5254518">err</span>&nbsp;<span class="op" id="5254522">:=</span>&nbsp;<span class="ident" id="5254525">tr</span><span class="op" id="5254527">.</span><span class="ident" id="5254528">Next</span><span class="op" id="5254532">(</span><span class="op" id="5254533">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5254537">hdr</span><span class="op" id="5254540">.</span><span class="ident" id="5254541">Linkname</span>&nbsp;<span class="op" id="5254550">=</span>&nbsp;<span class="ident" id="5254552">cString</span><span class="op" id="5254559">(</span><span class="ident" id="5254560">realname</span><span class="op" id="5254568">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254572">return</span>&nbsp;<span class="ident" id="5254579">hdr</span><span class="op" id="5254582">,</span>&nbsp;<span class="ident" id="5254584">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5254589">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254592">return</span>&nbsp;<span class="ident" id="5254599">hdr</span><span class="op" id="5254602">,</span>&nbsp;<span class="ident" id="5254604">tr</span><span class="op" id="5254606">.</span><span class="ident" id="5254607">err</span><br>
<span class="lineno"></span><span class="op" id="5254611">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5254614">//&nbsp;checkForGNUSparsePAXHeaders&nbsp;checks&nbsp;the&nbsp;PAX&nbsp;headers&nbsp;for&nbsp;GNU&nbsp;sparse&nbsp;headers.&nbsp;If&nbsp;they&nbsp;are&nbsp;found,&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5254716">//&nbsp;this&nbsp;function&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;and&nbsp;returns&nbsp;it.&nbsp;Unknown&nbsp;sparse&nbsp;formats&nbsp;are&nbsp;ignored,&nbsp;causing&nbsp;the&nbsp;file&nbsp;to</span><br>
<span class="lineno">150</span><span class="comment" id="5254826">//&nbsp;be&nbsp;treated&nbsp;as&nbsp;a&nbsp;regular&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5254859">func</span>&nbsp;<span class="op" id="5254864">(</span><span class="ident" id="5254865">tr</span>&nbsp;<span class="op" id="5254868">*</span><span class="ident" id="5254869">Reader</span><span class="op" id="5254875">)</span>&nbsp;<span class="ident" id="5254877">checkForGNUSparsePAXHeaders</span><span class="op" id="5254904">(</span><span class="ident" id="5254905">hdr</span>&nbsp;<span class="op" id="5254909">*</span><span class="ident" id="5254910">Header</span><span class="op" id="5254916">,</span>&nbsp;<span class="ident" id="5254918">headers</span>&nbsp;<span class="keyword" id="5254926">map</span><span class="op" id="5254929">[</span><span class="builtintype" id="5254930">string</span><span class="op" id="5254936">]</span><span class="builtintype" id="5254937">string</span><span class="op" id="5254943">)</span>&nbsp;<span class="op" id="5254945">(</span><span class="op" id="5254946">[</span><span class="op" id="5254947">]</span><span class="ident" id="5254948">sparseEntry</span><span class="op" id="5254959">,</span>&nbsp;<span class="builtintype" id="5254961">error</span><span class="op" id="5254966">)</span>&nbsp;<span class="op" id="5254968">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5254971">var</span>&nbsp;<span class="ident" id="5254975">sparseFormat</span>&nbsp;<span class="builtintype" id="5254988">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5254997">//&nbsp;Check&nbsp;for&nbsp;sparse&nbsp;format&nbsp;indicators</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255036">major</span><span class="op" id="5255041">,</span>&nbsp;<span class="ident" id="5255043">majorOk</span>&nbsp;<span class="op" id="5255051">:=</span>&nbsp;<span class="ident" id="5255054">headers</span><span class="op" id="5255061">[</span><span class="ident" id="5255062">paxGNUSparseMajor</span><span class="op" id="5255079">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255082">minor</span><span class="op" id="5255087">,</span>&nbsp;<span class="ident" id="5255089">minorOk</span>&nbsp;<span class="op" id="5255097">:=</span>&nbsp;<span class="ident" id="5255100">headers</span><span class="op" id="5255107">[</span><span class="ident" id="5255108">paxGNUSparseMinor</span><span class="op" id="5255125">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255128">sparseName</span><span class="op" id="5255138">,</span>&nbsp;<span class="ident" id="5255140">sparseNameOk</span>&nbsp;<span class="op" id="5255153">:=</span>&nbsp;<span class="ident" id="5255156">headers</span><span class="op" id="5255163">[</span><span class="ident" id="5255164">paxGNUSparseName</span><span class="op" id="5255180">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255183">_</span><span class="op" id="5255184">,</span>&nbsp;<span class="ident" id="5255186">sparseMapOk</span>&nbsp;<span class="op" id="5255198">:=</span>&nbsp;<span class="ident" id="5255201">headers</span><span class="op" id="5255208">[</span><span class="ident" id="5255209">paxGNUSparseMap</span><span class="op" id="5255224">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255227">sparseSize</span><span class="op" id="5255237">,</span>&nbsp;<span class="ident" id="5255239">sparseSizeOk</span>&nbsp;<span class="op" id="5255252">:=</span>&nbsp;<span class="ident" id="5255255">headers</span><span class="op" id="5255262">[</span><span class="ident" id="5255263">paxGNUSparseSize</span><span class="op" id="5255279">]</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255282">sparseRealSize</span><span class="op" id="5255296">,</span>&nbsp;<span class="ident" id="5255298">sparseRealSizeOk</span>&nbsp;<span class="op" id="5255315">:=</span>&nbsp;<span class="ident" id="5255318">headers</span><span class="op" id="5255325">[</span><span class="ident" id="5255326">paxGNUSparseRealSize</span><span class="op" id="5255346">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5255350">//&nbsp;Identify&nbsp;which,&nbsp;if&nbsp;any,&nbsp;sparse&nbsp;format&nbsp;applies&nbsp;from&nbsp;which&nbsp;PAX&nbsp;headers&nbsp;are&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255431">if</span>&nbsp;<span class="ident" id="5255434">majorOk</span>&nbsp;<span class="op" id="5255442">&amp;&amp;</span>&nbsp;<span class="ident" id="5255445">minorOk</span>&nbsp;<span class="op" id="5255453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255457">sparseFormat</span>&nbsp;<span class="op" id="5255470">=</span>&nbsp;<span class="ident" id="5255472">major</span>&nbsp;<span class="op" id="5255478">+</span>&nbsp;<span class="string" id="5255480">&#34;.&#34;</span>&nbsp;<span class="op" id="5255484">+</span>&nbsp;<span class="ident" id="5255486">minor</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255493">}</span>&nbsp;<span class="keyword" id="5255495">else</span>&nbsp;<span class="keyword" id="5255500">if</span>&nbsp;<span class="ident" id="5255503">sparseNameOk</span>&nbsp;<span class="op" id="5255516">&amp;&amp;</span>&nbsp;<span class="ident" id="5255519">sparseMapOk</span>&nbsp;<span class="op" id="5255531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255535">sparseFormat</span>&nbsp;<span class="op" id="5255548">=</span>&nbsp;<span class="string" id="5255550">&#34;0.1&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255557">}</span>&nbsp;<span class="keyword" id="5255559">else</span>&nbsp;<span class="keyword" id="5255564">if</span>&nbsp;<span class="ident" id="5255567">sparseSizeOk</span>&nbsp;<span class="op" id="5255580">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255584">sparseFormat</span>&nbsp;<span class="op" id="5255597">=</span>&nbsp;<span class="string" id="5255599">&#34;0.0&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255606">}</span>&nbsp;<span class="keyword" id="5255608">else</span>&nbsp;<span class="op" id="5255613">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5255617">//&nbsp;Not&nbsp;a&nbsp;PAX&nbsp;format&nbsp;GNU&nbsp;sparse&nbsp;file.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255656">return</span>&nbsp;<span class="ident" id="5255663">nil</span><span class="op" id="5255666">,</span>&nbsp;<span class="ident" id="5255668">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255673">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5255677">//&nbsp;Check&nbsp;for&nbsp;unknown&nbsp;sparse&nbsp;format</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255713">if</span>&nbsp;<span class="ident" id="5255716">sparseFormat</span>&nbsp;<span class="op" id="5255729">!=</span>&nbsp;<span class="string" id="5255732">&#34;0.0&#34;</span>&nbsp;<span class="op" id="5255738">&amp;&amp;</span>&nbsp;<span class="ident" id="5255741">sparseFormat</span>&nbsp;<span class="op" id="5255754">!=</span>&nbsp;<span class="string" id="5255757">&#34;0.1&#34;</span>&nbsp;<span class="op" id="5255763">&amp;&amp;</span>&nbsp;<span class="ident" id="5255766">sparseFormat</span>&nbsp;<span class="op" id="5255779">!=</span>&nbsp;<span class="string" id="5255782">&#34;1.0&#34;</span>&nbsp;<span class="op" id="5255788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255792">return</span>&nbsp;<span class="ident" id="5255799">nil</span><span class="op" id="5255802">,</span>&nbsp;<span class="ident" id="5255804">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255809">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5255813">//&nbsp;Update&nbsp;hdr&nbsp;from&nbsp;GNU&nbsp;sparse&nbsp;PAX&nbsp;headers</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255856">if</span>&nbsp;<span class="ident" id="5255859">sparseNameOk</span>&nbsp;<span class="op" id="5255872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255876">hdr</span><span class="op" id="5255879">.</span><span class="ident" id="5255880">Name</span>&nbsp;<span class="op" id="5255885">=</span>&nbsp;<span class="ident" id="5255887">sparseName</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5255899">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255902">if</span>&nbsp;<span class="ident" id="5255905">sparseSizeOk</span>&nbsp;<span class="op" id="5255918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5255922">realSize</span><span class="op" id="5255930">,</span>&nbsp;<span class="ident" id="5255932">err</span>&nbsp;<span class="op" id="5255936">:=</span>&nbsp;<span class="ident" id="5255939">strconv</span><span class="op" id="5255946">.</span><span class="ident" id="5255947">ParseInt</span><span class="op" id="5255955">(</span><span class="ident" id="5255956">sparseSize</span><span class="op" id="5255966">,</span>&nbsp;<span class="num" id="5255968">10</span><span class="op" id="5255970">,</span>&nbsp;<span class="num" id="5255972">0</span><span class="op" id="5255973">)</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255977">if</span>&nbsp;<span class="ident" id="5255980">err</span>&nbsp;<span class="op" id="5255984">!=</span>&nbsp;<span class="ident" id="5255987">nil</span>&nbsp;<span class="op" id="5255991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5255996">return</span>&nbsp;<span class="ident" id="5256003">nil</span><span class="op" id="5256006">,</span>&nbsp;<span class="ident" id="5256008">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256024">hdr</span><span class="op" id="5256027">.</span><span class="ident" id="5256028">Size</span>&nbsp;<span class="op" id="5256033">=</span>&nbsp;<span class="ident" id="5256035">realSize</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256045">}</span>&nbsp;<span class="keyword" id="5256047">else</span>&nbsp;<span class="keyword" id="5256052">if</span>&nbsp;<span class="ident" id="5256055">sparseRealSizeOk</span>&nbsp;<span class="op" id="5256072">{</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256076">realSize</span><span class="op" id="5256084">,</span>&nbsp;<span class="ident" id="5256086">err</span>&nbsp;<span class="op" id="5256090">:=</span>&nbsp;<span class="ident" id="5256093">strconv</span><span class="op" id="5256100">.</span><span class="ident" id="5256101">ParseInt</span><span class="op" id="5256109">(</span><span class="ident" id="5256110">sparseRealSize</span><span class="op" id="5256124">,</span>&nbsp;<span class="num" id="5256126">10</span><span class="op" id="5256128">,</span>&nbsp;<span class="num" id="5256130">0</span><span class="op" id="5256131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256135">if</span>&nbsp;<span class="ident" id="5256138">err</span>&nbsp;<span class="op" id="5256142">!=</span>&nbsp;<span class="ident" id="5256145">nil</span>&nbsp;<span class="op" id="5256149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256154">return</span>&nbsp;<span class="ident" id="5256161">nil</span><span class="op" id="5256164">,</span>&nbsp;<span class="ident" id="5256166">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256182">hdr</span><span class="op" id="5256185">.</span><span class="ident" id="5256186">Size</span>&nbsp;<span class="op" id="5256191">=</span>&nbsp;<span class="ident" id="5256193">realSize</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256203">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5256207">//&nbsp;Set&nbsp;up&nbsp;the&nbsp;sparse&nbsp;map,&nbsp;according&nbsp;to&nbsp;the&nbsp;particular&nbsp;sparse&nbsp;format&nbsp;in&nbsp;use</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256283">var</span>&nbsp;<span class="ident" id="5256287">sp</span>&nbsp;<span class="op" id="5256290">[</span><span class="op" id="5256291">]</span><span class="ident" id="5256292">sparseEntry</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256305">var</span>&nbsp;<span class="ident" id="5256309">err</span>&nbsp;<span class="builtintype" id="5256313">error</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256320">switch</span>&nbsp;<span class="ident" id="5256327">sparseFormat</span>&nbsp;<span class="op" id="5256340">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256343">case</span>&nbsp;<span class="string" id="5256348">&#34;0.0&#34;</span><span class="op" id="5256353">,</span>&nbsp;<span class="string" id="5256355">&#34;0.1&#34;</span><span class="op" id="5256360">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256364">sp</span><span class="op" id="5256366">,</span>&nbsp;<span class="ident" id="5256368">err</span>&nbsp;<span class="op" id="5256372">=</span>&nbsp;<span class="ident" id="5256374">readGNUSparseMap0x1</span><span class="op" id="5256393">(</span><span class="ident" id="5256394">headers</span><span class="op" id="5256401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256404">case</span>&nbsp;<span class="string" id="5256409">&#34;1.0&#34;</span><span class="op" id="5256414">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256418">sp</span><span class="op" id="5256420">,</span>&nbsp;<span class="ident" id="5256422">err</span>&nbsp;<span class="op" id="5256426">=</span>&nbsp;<span class="ident" id="5256428">readGNUSparseMap1x0</span><span class="op" id="5256447">(</span><span class="ident" id="5256448">tr</span><span class="op" id="5256450">.</span><span class="ident" id="5256451">curr</span><span class="op" id="5256455">)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5256458">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256461">return</span>&nbsp;<span class="ident" id="5256468">sp</span><span class="op" id="5256470">,</span>&nbsp;<span class="ident" id="5256472">err</span><br>
<span class="lineno"></span><span class="op" id="5256476">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5256479">//&nbsp;mergePAX&nbsp;merges&nbsp;well&nbsp;known&nbsp;headers&nbsp;according&nbsp;to&nbsp;PAX&nbsp;standard.</span><br>
<span class="lineno">210</span><span class="comment" id="5256544">//&nbsp;In&nbsp;general&nbsp;headers&nbsp;with&nbsp;the&nbsp;same&nbsp;name&nbsp;as&nbsp;those&nbsp;found</span><br>
<span class="lineno"></span><span class="comment" id="5256600">//&nbsp;in&nbsp;the&nbsp;header&nbsp;struct&nbsp;overwrite&nbsp;those&nbsp;found&nbsp;in&nbsp;the&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="5256660">//&nbsp;struct&nbsp;with&nbsp;higher&nbsp;precision&nbsp;or&nbsp;longer&nbsp;values.&nbsp;Esp.&nbsp;useful</span><br>
<span class="lineno"></span><span class="comment" id="5256722">//&nbsp;for&nbsp;name&nbsp;and&nbsp;linkname&nbsp;fields.</span><br>
<span class="lineno"></span><span class="keyword" id="5256755">func</span>&nbsp;<span class="ident" id="5256760">mergePAX</span><span class="op" id="5256768">(</span><span class="ident" id="5256769">hdr</span>&nbsp;<span class="op" id="5256773">*</span><span class="ident" id="5256774">Header</span><span class="op" id="5256780">,</span>&nbsp;<span class="ident" id="5256782">headers</span>&nbsp;<span class="keyword" id="5256790">map</span><span class="op" id="5256793">[</span><span class="builtintype" id="5256794">string</span><span class="op" id="5256800">]</span><span class="builtintype" id="5256801">string</span><span class="op" id="5256807">)</span>&nbsp;<span class="builtintype" id="5256809">error</span>&nbsp;<span class="op" id="5256815">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256818">for</span>&nbsp;<span class="ident" id="5256822">k</span><span class="op" id="5256823">,</span>&nbsp;<span class="ident" id="5256825">v</span>&nbsp;<span class="op" id="5256827">:=</span>&nbsp;<span class="keyword" id="5256830">range</span>&nbsp;<span class="ident" id="5256836">headers</span>&nbsp;<span class="op" id="5256844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256848">switch</span>&nbsp;<span class="ident" id="5256855">k</span>&nbsp;<span class="op" id="5256857">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256861">case</span>&nbsp;<span class="ident" id="5256866">paxPath</span><span class="op" id="5256873">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256878">hdr</span><span class="op" id="5256881">.</span><span class="ident" id="5256882">Name</span>&nbsp;<span class="op" id="5256887">=</span>&nbsp;<span class="ident" id="5256889">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256893">case</span>&nbsp;<span class="ident" id="5256898">paxLinkpath</span><span class="op" id="5256909">:</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256914">hdr</span><span class="op" id="5256917">.</span><span class="ident" id="5256918">Linkname</span>&nbsp;<span class="op" id="5256927">=</span>&nbsp;<span class="ident" id="5256929">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256933">case</span>&nbsp;<span class="ident" id="5256938">paxGname</span><span class="op" id="5256946">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256951">hdr</span><span class="op" id="5256954">.</span><span class="ident" id="5256955">Gname</span>&nbsp;<span class="op" id="5256961">=</span>&nbsp;<span class="ident" id="5256963">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5256967">case</span>&nbsp;<span class="ident" id="5256972">paxUname</span><span class="op" id="5256980">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5256985">hdr</span><span class="op" id="5256988">.</span><span class="ident" id="5256989">Uname</span>&nbsp;<span class="op" id="5256995">=</span>&nbsp;<span class="ident" id="5256997">v</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257001">case</span>&nbsp;<span class="ident" id="5257006">paxUid</span><span class="op" id="5257012">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257017">uid</span><span class="op" id="5257020">,</span>&nbsp;<span class="ident" id="5257022">err</span>&nbsp;<span class="op" id="5257026">:=</span>&nbsp;<span class="ident" id="5257029">strconv</span><span class="op" id="5257036">.</span><span class="ident" id="5257037">ParseInt</span><span class="op" id="5257045">(</span><span class="ident" id="5257046">v</span><span class="op" id="5257047">,</span>&nbsp;<span class="num" id="5257049">10</span><span class="op" id="5257051">,</span>&nbsp;<span class="num" id="5257053">0</span><span class="op" id="5257054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257059">if</span>&nbsp;<span class="ident" id="5257062">err</span>&nbsp;<span class="op" id="5257066">!=</span>&nbsp;<span class="ident" id="5257069">nil</span>&nbsp;<span class="op" id="5257073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257079">return</span>&nbsp;<span class="ident" id="5257086">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257093">}</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257098">hdr</span><span class="op" id="5257101">.</span><span class="ident" id="5257102">Uid</span>&nbsp;<span class="op" id="5257106">=</span>&nbsp;<span class="builtintype" id="5257108">int</span><span class="op" id="5257111">(</span><span class="ident" id="5257112">uid</span><span class="op" id="5257115">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257119">case</span>&nbsp;<span class="ident" id="5257124">paxGid</span><span class="op" id="5257130">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257135">gid</span><span class="op" id="5257138">,</span>&nbsp;<span class="ident" id="5257140">err</span>&nbsp;<span class="op" id="5257144">:=</span>&nbsp;<span class="ident" id="5257147">strconv</span><span class="op" id="5257154">.</span><span class="ident" id="5257155">ParseInt</span><span class="op" id="5257163">(</span><span class="ident" id="5257164">v</span><span class="op" id="5257165">,</span>&nbsp;<span class="num" id="5257167">10</span><span class="op" id="5257169">,</span>&nbsp;<span class="num" id="5257171">0</span><span class="op" id="5257172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257177">if</span>&nbsp;<span class="ident" id="5257180">err</span>&nbsp;<span class="op" id="5257184">!=</span>&nbsp;<span class="ident" id="5257187">nil</span>&nbsp;<span class="op" id="5257191">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257197">return</span>&nbsp;<span class="ident" id="5257204">err</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257216">hdr</span><span class="op" id="5257219">.</span><span class="ident" id="5257220">Gid</span>&nbsp;<span class="op" id="5257224">=</span>&nbsp;<span class="builtintype" id="5257226">int</span><span class="op" id="5257229">(</span><span class="ident" id="5257230">gid</span><span class="op" id="5257233">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257237">case</span>&nbsp;<span class="ident" id="5257242">paxAtime</span><span class="op" id="5257250">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257255">t</span><span class="op" id="5257256">,</span>&nbsp;<span class="ident" id="5257258">err</span>&nbsp;<span class="op" id="5257262">:=</span>&nbsp;<span class="ident" id="5257265">parsePAXTime</span><span class="op" id="5257277">(</span><span class="ident" id="5257278">v</span><span class="op" id="5257279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257284">if</span>&nbsp;<span class="ident" id="5257287">err</span>&nbsp;<span class="op" id="5257291">!=</span>&nbsp;<span class="ident" id="5257294">nil</span>&nbsp;<span class="op" id="5257298">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257304">return</span>&nbsp;<span class="ident" id="5257311">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257323">hdr</span><span class="op" id="5257326">.</span><span class="ident" id="5257327">AccessTime</span>&nbsp;<span class="op" id="5257338">=</span>&nbsp;<span class="ident" id="5257340">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257344">case</span>&nbsp;<span class="ident" id="5257349">paxMtime</span><span class="op" id="5257357">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257362">t</span><span class="op" id="5257363">,</span>&nbsp;<span class="ident" id="5257365">err</span>&nbsp;<span class="op" id="5257369">:=</span>&nbsp;<span class="ident" id="5257372">parsePAXTime</span><span class="op" id="5257384">(</span><span class="ident" id="5257385">v</span><span class="op" id="5257386">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257391">if</span>&nbsp;<span class="ident" id="5257394">err</span>&nbsp;<span class="op" id="5257398">!=</span>&nbsp;<span class="ident" id="5257401">nil</span>&nbsp;<span class="op" id="5257405">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257411">return</span>&nbsp;<span class="ident" id="5257418">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257425">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257430">hdr</span><span class="op" id="5257433">.</span><span class="ident" id="5257434">ModTime</span>&nbsp;<span class="op" id="5257442">=</span>&nbsp;<span class="ident" id="5257444">t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257448">case</span>&nbsp;<span class="ident" id="5257453">paxCtime</span><span class="op" id="5257461">:</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257466">t</span><span class="op" id="5257467">,</span>&nbsp;<span class="ident" id="5257469">err</span>&nbsp;<span class="op" id="5257473">:=</span>&nbsp;<span class="ident" id="5257476">parsePAXTime</span><span class="op" id="5257488">(</span><span class="ident" id="5257489">v</span><span class="op" id="5257490">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257495">if</span>&nbsp;<span class="ident" id="5257498">err</span>&nbsp;<span class="op" id="5257502">!=</span>&nbsp;<span class="ident" id="5257505">nil</span>&nbsp;<span class="op" id="5257509">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257515">return</span>&nbsp;<span class="ident" id="5257522">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257529">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257534">hdr</span><span class="op" id="5257537">.</span><span class="ident" id="5257538">ChangeTime</span>&nbsp;<span class="op" id="5257549">=</span>&nbsp;<span class="ident" id="5257551">t</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257555">case</span>&nbsp;<span class="ident" id="5257560">paxSize</span><span class="op" id="5257567">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257572">size</span><span class="op" id="5257576">,</span>&nbsp;<span class="ident" id="5257578">err</span>&nbsp;<span class="op" id="5257582">:=</span>&nbsp;<span class="ident" id="5257585">strconv</span><span class="op" id="5257592">.</span><span class="ident" id="5257593">ParseInt</span><span class="op" id="5257601">(</span><span class="ident" id="5257602">v</span><span class="op" id="5257603">,</span>&nbsp;<span class="num" id="5257605">10</span><span class="op" id="5257607">,</span>&nbsp;<span class="num" id="5257609">0</span><span class="op" id="5257610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257615">if</span>&nbsp;<span class="ident" id="5257618">err</span>&nbsp;<span class="op" id="5257622">!=</span>&nbsp;<span class="ident" id="5257625">nil</span>&nbsp;<span class="op" id="5257629">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257635">return</span>&nbsp;<span class="ident" id="5257642">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257649">}</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257654">hdr</span><span class="op" id="5257657">.</span><span class="ident" id="5257658">Size</span>&nbsp;<span class="op" id="5257663">=</span>&nbsp;<span class="ident" id="5257665">int64</span><span class="op" id="5257670">(</span><span class="ident" id="5257671">size</span><span class="op" id="5257675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257679">default</span><span class="op" id="5257686">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257691">if</span>&nbsp;<span class="ident" id="5257694">strings</span><span class="op" id="5257701">.</span><span class="ident" id="5257702">HasPrefix</span><span class="op" id="5257711">(</span><span class="ident" id="5257712">k</span><span class="op" id="5257713">,</span>&nbsp;<span class="ident" id="5257715">paxXattr</span><span class="op" id="5257723">)</span>&nbsp;<span class="op" id="5257725">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257731">if</span>&nbsp;<span class="ident" id="5257734">hdr</span><span class="op" id="5257737">.</span><span class="ident" id="5257738">Xattrs</span>&nbsp;<span class="op" id="5257745">==</span>&nbsp;<span class="ident" id="5257748">nil</span>&nbsp;<span class="op" id="5257752">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257759">hdr</span><span class="op" id="5257762">.</span><span class="ident" id="5257763">Xattrs</span>&nbsp;<span class="op" id="5257770">=</span>&nbsp;<span class="builtinfunc" id="5257772">make</span><span class="op" id="5257776">(</span><span class="keyword" id="5257777">map</span><span class="op" id="5257780">[</span><span class="builtintype" id="5257781">string</span><span class="op" id="5257787">]</span><span class="builtintype" id="5257788">string</span><span class="op" id="5257794">)</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5257806">hdr</span><span class="op" id="5257809">.</span><span class="ident" id="5257810">Xattrs</span><span class="op" id="5257816">[</span><span class="ident" id="5257817">k</span><span class="op" id="5257818">[</span><span class="builtinfunc" id="5257819">len</span><span class="op" id="5257822">(</span><span class="ident" id="5257823">paxXattr</span><span class="op" id="5257831">)</span><span class="op" id="5257832">:</span><span class="op" id="5257833">]</span><span class="op" id="5257834">]</span>&nbsp;<span class="op" id="5257836">=</span>&nbsp;<span class="ident" id="5257838">v</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257843">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257847">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5257850">}</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5257853">return</span>&nbsp;<span class="ident" id="5257860">nil</span><br>
<span class="lineno"></span><span class="op" id="5257864">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5257867">//&nbsp;parsePAXTime&nbsp;takes&nbsp;a&nbsp;string&nbsp;of&nbsp;the&nbsp;form&nbsp;%d.%d&nbsp;as&nbsp;described&nbsp;in</span><br>
<span class="lineno"></span><span class="comment" id="5257932">//&nbsp;the&nbsp;PAX&nbsp;specification.</span><br>
<span class="lineno">275</span><span class="keyword" id="5257958">func</span>&nbsp;<span class="ident" id="5257963">parsePAXTime</span><span class="op" id="5257975">(</span><span class="ident" id="5257976">t</span>&nbsp;<span class="builtintype" id="5257978">string</span><span class="op" id="5257984">)</span>&nbsp;<span class="op" id="5257986">(</span><span class="ident" id="5257987">time</span><span class="op" id="5257991">.</span><span class="ident" id="5257992">Time</span><span class="op" id="5257996">,</span>&nbsp;<span class="builtintype" id="5257998">error</span><span class="op" id="5258003">)</span>&nbsp;<span class="op" id="5258005">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258008">buf</span>&nbsp;<span class="op" id="5258012">:=</span>&nbsp;<span class="op" id="5258015">[</span><span class="op" id="5258016">]</span><span class="builtintype" id="5258017">byte</span><span class="op" id="5258021">(</span><span class="ident" id="5258022">t</span><span class="op" id="5258023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258026">pos</span>&nbsp;<span class="op" id="5258030">:=</span>&nbsp;<span class="ident" id="5258033">bytes</span><span class="op" id="5258038">.</span><span class="ident" id="5258039">IndexByte</span><span class="op" id="5258048">(</span><span class="ident" id="5258049">buf</span><span class="op" id="5258052">,</span>&nbsp;<span class="string" id="5258054">&#39;.&#39;</span><span class="op" id="5258057">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258060">var</span>&nbsp;<span class="ident" id="5258064">seconds</span><span class="op" id="5258071">,</span>&nbsp;<span class="ident" id="5258073">nanoseconds</span>&nbsp;<span class="ident" id="5258085">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258092">var</span>&nbsp;<span class="ident" id="5258096">err</span>&nbsp;<span class="builtintype" id="5258100">error</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258107">if</span>&nbsp;<span class="ident" id="5258110">pos</span>&nbsp;<span class="op" id="5258114">==</span>&nbsp;<span class="op" id="5258117">-</span><span class="num" id="5258118">1</span>&nbsp;<span class="op" id="5258120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258124">seconds</span><span class="op" id="5258131">,</span>&nbsp;<span class="ident" id="5258133">err</span>&nbsp;<span class="op" id="5258137">=</span>&nbsp;<span class="ident" id="5258139">strconv</span><span class="op" id="5258146">.</span><span class="ident" id="5258147">ParseInt</span><span class="op" id="5258155">(</span><span class="ident" id="5258156">t</span><span class="op" id="5258157">,</span>&nbsp;<span class="num" id="5258159">10</span><span class="op" id="5258161">,</span>&nbsp;<span class="num" id="5258163">0</span><span class="op" id="5258164">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258168">if</span>&nbsp;<span class="ident" id="5258171">err</span>&nbsp;<span class="op" id="5258175">!=</span>&nbsp;<span class="ident" id="5258178">nil</span>&nbsp;<span class="op" id="5258182">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258187">return</span>&nbsp;<span class="ident" id="5258194">time</span><span class="op" id="5258198">.</span><span class="ident" id="5258199">Time</span><span class="op" id="5258203">{</span><span class="op" id="5258204">}</span><span class="op" id="5258205">,</span>&nbsp;<span class="ident" id="5258207">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258213">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258216">}</span>&nbsp;<span class="keyword" id="5258218">else</span>&nbsp;<span class="op" id="5258223">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258227">seconds</span><span class="op" id="5258234">,</span>&nbsp;<span class="ident" id="5258236">err</span>&nbsp;<span class="op" id="5258240">=</span>&nbsp;<span class="ident" id="5258242">strconv</span><span class="op" id="5258249">.</span><span class="ident" id="5258250">ParseInt</span><span class="op" id="5258258">(</span><span class="builtintype" id="5258259">string</span><span class="op" id="5258265">(</span><span class="ident" id="5258266">buf</span><span class="op" id="5258269">[</span><span class="op" id="5258270">:</span><span class="ident" id="5258271">pos</span><span class="op" id="5258274">]</span><span class="op" id="5258275">)</span><span class="op" id="5258276">,</span>&nbsp;<span class="num" id="5258278">10</span><span class="op" id="5258280">,</span>&nbsp;<span class="num" id="5258282">0</span><span class="op" id="5258283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258287">if</span>&nbsp;<span class="ident" id="5258290">err</span>&nbsp;<span class="op" id="5258294">!=</span>&nbsp;<span class="ident" id="5258297">nil</span>&nbsp;<span class="op" id="5258301">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258306">return</span>&nbsp;<span class="ident" id="5258313">time</span><span class="op" id="5258317">.</span><span class="ident" id="5258318">Time</span><span class="op" id="5258322">{</span><span class="op" id="5258323">}</span><span class="op" id="5258324">,</span>&nbsp;<span class="ident" id="5258326">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258332">}</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258336">nano_buf</span>&nbsp;<span class="op" id="5258345">:=</span>&nbsp;<span class="builtintype" id="5258348">string</span><span class="op" id="5258354">(</span><span class="ident" id="5258355">buf</span><span class="op" id="5258358">[</span><span class="ident" id="5258359">pos</span><span class="op" id="5258362">+</span><span class="num" id="5258363">1</span><span class="op" id="5258364">:</span><span class="op" id="5258365">]</span><span class="op" id="5258366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258370">//&nbsp;Pad&nbsp;as&nbsp;needed&nbsp;before&nbsp;converting&nbsp;to&nbsp;a&nbsp;decimal.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258421">//&nbsp;For&nbsp;example&nbsp;.030&nbsp;-&gt;&nbsp;.030000000&nbsp;-&gt;&nbsp;30000000&nbsp;nanoseconds</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258481">if</span>&nbsp;<span class="builtinfunc" id="5258484">len</span><span class="op" id="5258487">(</span><span class="ident" id="5258488">nano_buf</span><span class="op" id="5258496">)</span>&nbsp;<span class="op" id="5258498">&lt;</span>&nbsp;<span class="ident" id="5258500">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5258521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258526">//&nbsp;Right&nbsp;pad</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258542">nano_buf</span>&nbsp;<span class="op" id="5258551">+=</span>&nbsp;<span class="ident" id="5258554">strings</span><span class="op" id="5258561">.</span><span class="ident" id="5258562">Repeat</span><span class="op" id="5258568">(</span><span class="string" id="5258569">&#34;0&#34;</span><span class="op" id="5258572">,</span>&nbsp;<span class="ident" id="5258574">maxNanoSecondIntSize</span><span class="op" id="5258594">-</span><span class="builtinfunc" id="5258595">len</span><span class="op" id="5258598">(</span><span class="ident" id="5258599">nano_buf</span><span class="op" id="5258607">)</span><span class="op" id="5258608">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258612">}</span>&nbsp;<span class="keyword" id="5258614">else</span>&nbsp;<span class="keyword" id="5258619">if</span>&nbsp;<span class="builtinfunc" id="5258622">len</span><span class="op" id="5258625">(</span><span class="ident" id="5258626">nano_buf</span><span class="op" id="5258634">)</span>&nbsp;<span class="op" id="5258636">&gt;</span>&nbsp;<span class="ident" id="5258638">maxNanoSecondIntSize</span>&nbsp;<span class="op" id="5258659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5258664">//&nbsp;Right&nbsp;truncate</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258685">nano_buf</span>&nbsp;<span class="op" id="5258694">=</span>&nbsp;<span class="ident" id="5258696">nano_buf</span><span class="op" id="5258704">[</span><span class="op" id="5258705">:</span><span class="ident" id="5258706">maxNanoSecondIntSize</span><span class="op" id="5258726">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258730">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258734">nanoseconds</span><span class="op" id="5258745">,</span>&nbsp;<span class="ident" id="5258747">err</span>&nbsp;<span class="op" id="5258751">=</span>&nbsp;<span class="ident" id="5258753">strconv</span><span class="op" id="5258760">.</span><span class="ident" id="5258761">ParseInt</span><span class="op" id="5258769">(</span><span class="builtintype" id="5258770">string</span><span class="op" id="5258776">(</span><span class="ident" id="5258777">nano_buf</span><span class="op" id="5258785">)</span><span class="op" id="5258786">,</span>&nbsp;<span class="num" id="5258788">10</span><span class="op" id="5258790">,</span>&nbsp;<span class="num" id="5258792">0</span><span class="op" id="5258793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258797">if</span>&nbsp;<span class="ident" id="5258800">err</span>&nbsp;<span class="op" id="5258804">!=</span>&nbsp;<span class="ident" id="5258807">nil</span>&nbsp;<span class="op" id="5258811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258816">return</span>&nbsp;<span class="ident" id="5258823">time</span><span class="op" id="5258827">.</span><span class="ident" id="5258828">Time</span><span class="op" id="5258832">{</span><span class="op" id="5258833">}</span><span class="op" id="5258834">,</span>&nbsp;<span class="ident" id="5258836">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5258845">}</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5258848">ts</span>&nbsp;<span class="op" id="5258851">:=</span>&nbsp;<span class="ident" id="5258854">time</span><span class="op" id="5258858">.</span><span class="ident" id="5258859">Unix</span><span class="op" id="5258863">(</span><span class="ident" id="5258864">seconds</span><span class="op" id="5258871">,</span>&nbsp;<span class="ident" id="5258873">nanoseconds</span><span class="op" id="5258884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5258887">return</span>&nbsp;<span class="ident" id="5258894">ts</span><span class="op" id="5258896">,</span>&nbsp;<span class="ident" id="5258898">nil</span><br>
<span class="lineno"></span><span class="op" id="5258902">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5258905">//&nbsp;parsePAX&nbsp;parses&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno">310</span><span class="comment" id="5258937">//&nbsp;If&nbsp;an&nbsp;extended&nbsp;header&nbsp;(type&nbsp;&#39;x&#39;)&nbsp;is&nbsp;invalid,&nbsp;ErrHeader&nbsp;is&nbsp;returned</span><br>
<span class="lineno"></span><span class="keyword" id="5259007">func</span>&nbsp;<span class="ident" id="5259012">parsePAX</span><span class="op" id="5259020">(</span><span class="ident" id="5259021">r</span>&nbsp;<span class="ident" id="5259023">io</span><span class="op" id="5259025">.</span><span class="ident" id="5259026">Reader</span><span class="op" id="5259032">)</span>&nbsp;<span class="op" id="5259034">(</span><span class="keyword" id="5259035">map</span><span class="op" id="5259038">[</span><span class="builtintype" id="5259039">string</span><span class="op" id="5259045">]</span><span class="builtintype" id="5259046">string</span><span class="op" id="5259052">,</span>&nbsp;<span class="builtintype" id="5259054">error</span><span class="op" id="5259059">)</span>&nbsp;<span class="op" id="5259061">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259064">buf</span><span class="op" id="5259067">,</span>&nbsp;<span class="ident" id="5259069">err</span>&nbsp;<span class="op" id="5259073">:=</span>&nbsp;<span class="ident" id="5259076">ioutil</span><span class="op" id="5259082">.</span><span class="ident" id="5259083">ReadAll</span><span class="op" id="5259090">(</span><span class="ident" id="5259091">r</span><span class="op" id="5259092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259095">if</span>&nbsp;<span class="ident" id="5259098">err</span>&nbsp;<span class="op" id="5259102">!=</span>&nbsp;<span class="ident" id="5259105">nil</span>&nbsp;<span class="op" id="5259109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259113">return</span>&nbsp;<span class="ident" id="5259120">nil</span><span class="op" id="5259123">,</span>&nbsp;<span class="ident" id="5259125">err</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259130">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259134">//&nbsp;For&nbsp;GNU&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;support.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259177">//&nbsp;This&nbsp;function&nbsp;transforms&nbsp;the&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;headers&nbsp;into&nbsp;sparse&nbsp;format&nbsp;0.1&nbsp;headers.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259268">var</span>&nbsp;<span class="ident" id="5259272">sparseMap</span>&nbsp;<span class="ident" id="5259282">bytes</span><span class="op" id="5259287">.</span><span class="ident" id="5259288">Buffer</span><br>
<span class="lineno">320</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259297">headers</span>&nbsp;<span class="op" id="5259305">:=</span>&nbsp;<span class="builtinfunc" id="5259308">make</span><span class="op" id="5259312">(</span><span class="keyword" id="5259313">map</span><span class="op" id="5259316">[</span><span class="builtintype" id="5259317">string</span><span class="op" id="5259323">]</span><span class="builtintype" id="5259324">string</span><span class="op" id="5259330">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259333">//&nbsp;Each&nbsp;record&nbsp;is&nbsp;constructed&nbsp;as</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259367">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#34;%d&nbsp;%s=%s\n&#34;,&nbsp;length,&nbsp;keyword,&nbsp;value</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259412">for</span>&nbsp;<span class="builtinfunc" id="5259416">len</span><span class="op" id="5259419">(</span><span class="ident" id="5259420">buf</span><span class="op" id="5259423">)</span>&nbsp;<span class="op" id="5259425">&gt;</span>&nbsp;<span class="num" id="5259427">0</span>&nbsp;<span class="op" id="5259429">{</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259433">//&nbsp;or&nbsp;the&nbsp;header&nbsp;was&nbsp;empty&nbsp;to&nbsp;start&nbsp;with.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259477">var</span>&nbsp;<span class="ident" id="5259481">sp</span>&nbsp;<span class="builtintype" id="5259484">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259490">//&nbsp;The&nbsp;size&nbsp;field&nbsp;ends&nbsp;at&nbsp;the&nbsp;first&nbsp;space.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259535">sp</span>&nbsp;<span class="op" id="5259538">=</span>&nbsp;<span class="ident" id="5259540">bytes</span><span class="op" id="5259545">.</span><span class="ident" id="5259546">IndexByte</span><span class="op" id="5259555">(</span><span class="ident" id="5259556">buf</span><span class="op" id="5259559">,</span>&nbsp;<span class="string" id="5259561">&#39;&nbsp;&#39;</span><span class="op" id="5259564">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259568">if</span>&nbsp;<span class="ident" id="5259571">sp</span>&nbsp;<span class="op" id="5259574">==</span>&nbsp;<span class="op" id="5259577">-</span><span class="num" id="5259578">1</span>&nbsp;<span class="op" id="5259580">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259585">return</span>&nbsp;<span class="ident" id="5259592">nil</span><span class="op" id="5259595">,</span>&nbsp;<span class="ident" id="5259597">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259609">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259613">//&nbsp;Parse&nbsp;the&nbsp;first&nbsp;token&nbsp;as&nbsp;a&nbsp;decimal&nbsp;integer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259662">n</span><span class="op" id="5259663">,</span>&nbsp;<span class="ident" id="5259665">err</span>&nbsp;<span class="op" id="5259669">:=</span>&nbsp;<span class="ident" id="5259672">strconv</span><span class="op" id="5259679">.</span><span class="ident" id="5259680">ParseInt</span><span class="op" id="5259688">(</span><span class="builtintype" id="5259689">string</span><span class="op" id="5259695">(</span><span class="ident" id="5259696">buf</span><span class="op" id="5259699">[</span><span class="op" id="5259700">:</span><span class="ident" id="5259701">sp</span><span class="op" id="5259703">]</span><span class="op" id="5259704">)</span><span class="op" id="5259705">,</span>&nbsp;<span class="num" id="5259707">10</span><span class="op" id="5259709">,</span>&nbsp;<span class="num" id="5259711">0</span><span class="op" id="5259712">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259716">if</span>&nbsp;<span class="ident" id="5259719">err</span>&nbsp;<span class="op" id="5259723">!=</span>&nbsp;<span class="ident" id="5259726">nil</span>&nbsp;<span class="op" id="5259730">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259735">return</span>&nbsp;<span class="ident" id="5259742">nil</span><span class="op" id="5259745">,</span>&nbsp;<span class="ident" id="5259747">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5259759">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259763">//&nbsp;Extract&nbsp;everything&nbsp;between&nbsp;the&nbsp;decimal&nbsp;and&nbsp;the&nbsp;n&nbsp;-1&nbsp;on&nbsp;the</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259827">//&nbsp;beginning&nbsp;to&nbsp;eat&nbsp;the&nbsp;&#39;&nbsp;&#39;,&nbsp;-1&nbsp;on&nbsp;the&nbsp;end&nbsp;to&nbsp;skip&nbsp;the&nbsp;newline.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5259893">var</span>&nbsp;<span class="ident" id="5259897">record</span>&nbsp;<span class="op" id="5259904">[</span><span class="op" id="5259905">]</span><span class="builtintype" id="5259906">byte</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5259913">record</span><span class="op" id="5259919">,</span>&nbsp;<span class="ident" id="5259921">buf</span>&nbsp;<span class="op" id="5259925">=</span>&nbsp;<span class="ident" id="5259927">buf</span><span class="op" id="5259930">[</span><span class="ident" id="5259931">sp</span><span class="op" id="5259933">+</span><span class="num" id="5259934">1</span><span class="op" id="5259935">:</span><span class="ident" id="5259936">n</span><span class="op" id="5259937">-</span><span class="num" id="5259938">1</span><span class="op" id="5259939">]</span><span class="op" id="5259940">,</span>&nbsp;<span class="ident" id="5259942">buf</span><span class="op" id="5259945">[</span><span class="ident" id="5259946">n</span><span class="op" id="5259947">:</span><span class="op" id="5259948">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5259952">//&nbsp;The&nbsp;first&nbsp;equals&nbsp;is&nbsp;guaranteed&nbsp;to&nbsp;mark&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;key.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260016">//&nbsp;Everything&nbsp;else&nbsp;is&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260047">eq</span>&nbsp;<span class="op" id="5260050">:=</span>&nbsp;<span class="ident" id="5260053">bytes</span><span class="op" id="5260058">.</span><span class="ident" id="5260059">IndexByte</span><span class="op" id="5260068">(</span><span class="ident" id="5260069">record</span><span class="op" id="5260075">,</span>&nbsp;<span class="string" id="5260077">&#39;=&#39;</span><span class="op" id="5260080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260084">if</span>&nbsp;<span class="ident" id="5260087">eq</span>&nbsp;<span class="op" id="5260090">==</span>&nbsp;<span class="op" id="5260093">-</span><span class="num" id="5260094">1</span>&nbsp;<span class="op" id="5260096">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260101">return</span>&nbsp;<span class="ident" id="5260108">nil</span><span class="op" id="5260111">,</span>&nbsp;<span class="ident" id="5260113">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260125">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260129">key</span><span class="op" id="5260132">,</span>&nbsp;<span class="ident" id="5260134">value</span>&nbsp;<span class="op" id="5260140">:=</span>&nbsp;<span class="ident" id="5260143">record</span><span class="op" id="5260149">[</span><span class="op" id="5260150">:</span><span class="ident" id="5260151">eq</span><span class="op" id="5260153">]</span><span class="op" id="5260154">,</span>&nbsp;<span class="ident" id="5260156">record</span><span class="op" id="5260162">[</span><span class="ident" id="5260163">eq</span><span class="op" id="5260165">+</span><span class="num" id="5260166">1</span><span class="op" id="5260167">:</span><span class="op" id="5260168">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260173">keyStr</span>&nbsp;<span class="op" id="5260180">:=</span>&nbsp;<span class="builtintype" id="5260183">string</span><span class="op" id="5260189">(</span><span class="ident" id="5260190">key</span><span class="op" id="5260193">)</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260197">if</span>&nbsp;<span class="ident" id="5260200">keyStr</span>&nbsp;<span class="op" id="5260207">==</span>&nbsp;<span class="ident" id="5260210">paxGNUSparseOffset</span>&nbsp;<span class="op" id="5260229">||</span>&nbsp;<span class="ident" id="5260232">keyStr</span>&nbsp;<span class="op" id="5260239">==</span>&nbsp;<span class="ident" id="5260242">paxGNUSparseNumBytes</span>&nbsp;<span class="op" id="5260263">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260268">//&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;0.0&nbsp;special&nbsp;key.&nbsp;Write&nbsp;to&nbsp;sparseMap&nbsp;instead&nbsp;of&nbsp;using&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260362">sparseMap</span><span class="op" id="5260371">.</span><span class="ident" id="5260372">Write</span><span class="op" id="5260377">(</span><span class="ident" id="5260378">value</span><span class="op" id="5260383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260388">sparseMap</span><span class="op" id="5260397">.</span><span class="ident" id="5260398">Write</span><span class="op" id="5260403">(</span><span class="op" id="5260404">[</span><span class="op" id="5260405">]</span><span class="builtintype" id="5260406">byte</span><span class="op" id="5260410">{</span><span class="string" id="5260411">&#39;,&#39;</span><span class="op" id="5260414">}</span><span class="op" id="5260415">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260419">}</span>&nbsp;<span class="keyword" id="5260421">else</span>&nbsp;<span class="op" id="5260426">{</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260431">//&nbsp;Normal&nbsp;key.&nbsp;Set&nbsp;the&nbsp;value&nbsp;in&nbsp;the&nbsp;headers&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260483">headers</span><span class="op" id="5260490">[</span><span class="ident" id="5260491">keyStr</span><span class="op" id="5260497">]</span>&nbsp;<span class="op" id="5260499">=</span>&nbsp;<span class="builtintype" id="5260501">string</span><span class="op" id="5260507">(</span><span class="ident" id="5260508">value</span><span class="op" id="5260513">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260517">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260523">if</span>&nbsp;<span class="ident" id="5260526">sparseMap</span><span class="op" id="5260535">.</span><span class="ident" id="5260536">Len</span><span class="op" id="5260539">(</span><span class="op" id="5260540">)</span>&nbsp;<span class="op" id="5260542">!=</span>&nbsp;<span class="num" id="5260545">0</span>&nbsp;<span class="op" id="5260547">{</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5260551">//&nbsp;Add&nbsp;sparse&nbsp;info&nbsp;to&nbsp;headers,&nbsp;chopping&nbsp;off&nbsp;the&nbsp;extra&nbsp;comma</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260613">sparseMap</span><span class="op" id="5260622">.</span><span class="ident" id="5260623">Truncate</span><span class="op" id="5260631">(</span><span class="ident" id="5260632">sparseMap</span><span class="op" id="5260641">.</span><span class="ident" id="5260642">Len</span><span class="op" id="5260645">(</span><span class="op" id="5260646">)</span>&nbsp;<span class="op" id="5260648">-</span>&nbsp;<span class="num" id="5260650">1</span><span class="op" id="5260651">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260655">headers</span><span class="op" id="5260662">[</span><span class="ident" id="5260663">paxGNUSparseMap</span><span class="op" id="5260678">]</span>&nbsp;<span class="op" id="5260680">=</span>&nbsp;<span class="ident" id="5260682">sparseMap</span><span class="op" id="5260691">.</span><span class="ident" id="5260692">String</span><span class="op" id="5260698">(</span><span class="op" id="5260699">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260702">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260705">return</span>&nbsp;<span class="ident" id="5260712">headers</span><span class="op" id="5260719">,</span>&nbsp;<span class="ident" id="5260721">nil</span><br>
<span class="lineno">365</span><span class="op" id="5260725">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5260728">//&nbsp;cString&nbsp;parses&nbsp;bytes&nbsp;as&nbsp;a&nbsp;NUL-terminated&nbsp;C-style&nbsp;string.</span><br>
<span class="lineno"></span><span class="comment" id="5260788">//&nbsp;If&nbsp;a&nbsp;NUL&nbsp;byte&nbsp;is&nbsp;not&nbsp;found&nbsp;then&nbsp;the&nbsp;whole&nbsp;slice&nbsp;is&nbsp;returned&nbsp;as&nbsp;a&nbsp;string.</span><br>
<span class="lineno"></span><span class="keyword" id="5260864">func</span>&nbsp;<span class="ident" id="5260869">cString</span><span class="op" id="5260876">(</span><span class="ident" id="5260877">b</span>&nbsp;<span class="op" id="5260879">[</span><span class="op" id="5260880">]</span><span class="builtintype" id="5260881">byte</span><span class="op" id="5260885">)</span>&nbsp;<span class="builtintype" id="5260887">string</span>&nbsp;<span class="op" id="5260894">{</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260897">n</span>&nbsp;<span class="op" id="5260899">:=</span>&nbsp;<span class="num" id="5260902">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260905">for</span>&nbsp;<span class="ident" id="5260909">n</span>&nbsp;<span class="op" id="5260911">&lt;</span>&nbsp;<span class="builtinfunc" id="5260913">len</span><span class="op" id="5260916">(</span><span class="ident" id="5260917">b</span><span class="op" id="5260918">)</span>&nbsp;<span class="op" id="5260920">&amp;&amp;</span>&nbsp;<span class="ident" id="5260923">b</span><span class="op" id="5260924">[</span><span class="ident" id="5260925">n</span><span class="op" id="5260926">]</span>&nbsp;<span class="op" id="5260928">!=</span>&nbsp;<span class="num" id="5260931">0</span>&nbsp;<span class="op" id="5260933">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5260937">n</span><span class="op" id="5260938">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5260942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5260945">return</span>&nbsp;<span class="builtintype" id="5260952">string</span><span class="op" id="5260958">(</span><span class="ident" id="5260959">b</span><span class="op" id="5260960">[</span><span class="num" id="5260961">0</span><span class="op" id="5260962">:</span><span class="ident" id="5260963">n</span><span class="op" id="5260964">]</span><span class="op" id="5260965">)</span><br>
<span class="lineno">375</span><span class="op" id="5260967">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5260970">func</span>&nbsp;<span class="op" id="5260975">(</span><span class="ident" id="5260976">tr</span>&nbsp;<span class="op" id="5260979">*</span><span class="ident" id="5260980">Reader</span><span class="op" id="5260986">)</span>&nbsp;<span class="ident" id="5260988">octal</span><span class="op" id="5260993">(</span><span class="ident" id="5260994">b</span>&nbsp;<span class="op" id="5260996">[</span><span class="op" id="5260997">]</span><span class="builtintype" id="5260998">byte</span><span class="op" id="5261002">)</span>&nbsp;<span class="ident" id="5261004">int64</span>&nbsp;<span class="op" id="5261010">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261013">//&nbsp;Check&nbsp;for&nbsp;binary&nbsp;format&nbsp;first.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261048">if</span>&nbsp;<span class="builtinfunc" id="5261051">len</span><span class="op" id="5261054">(</span><span class="ident" id="5261055">b</span><span class="op" id="5261056">)</span>&nbsp;<span class="op" id="5261058">&gt;</span>&nbsp;<span class="num" id="5261060">0</span>&nbsp;<span class="op" id="5261062">&amp;&amp;</span>&nbsp;<span class="ident" id="5261065">b</span><span class="op" id="5261066">[</span><span class="num" id="5261067">0</span><span class="op" id="5261068">]</span><span class="op" id="5261069">&amp;</span><span class="num" id="5261070">0x80</span>&nbsp;<span class="op" id="5261075">!=</span>&nbsp;<span class="num" id="5261078">0</span>&nbsp;<span class="op" id="5261080">{</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261084">var</span>&nbsp;<span class="ident" id="5261088">x</span>&nbsp;<span class="ident" id="5261090">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261098">for</span>&nbsp;<span class="ident" id="5261102">i</span><span class="op" id="5261103">,</span>&nbsp;<span class="ident" id="5261105">c</span>&nbsp;<span class="op" id="5261107">:=</span>&nbsp;<span class="keyword" id="5261110">range</span>&nbsp;<span class="ident" id="5261116">b</span>&nbsp;<span class="op" id="5261118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261123">if</span>&nbsp;<span class="ident" id="5261126">i</span>&nbsp;<span class="op" id="5261128">==</span>&nbsp;<span class="num" id="5261131">0</span>&nbsp;<span class="op" id="5261133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261139">c</span>&nbsp;<span class="op" id="5261141">&amp;=</span>&nbsp;<span class="num" id="5261144">0x7f</span>&nbsp;<span class="comment" id="5261149">//&nbsp;ignore&nbsp;signal&nbsp;bit&nbsp;in&nbsp;first&nbsp;byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261187">}</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261192">x</span>&nbsp;<span class="op" id="5261194">=</span>&nbsp;<span class="ident" id="5261196">x</span><span class="op" id="5261197">&lt;&lt;</span><span class="num" id="5261199">8</span>&nbsp;<span class="op" id="5261201">|</span>&nbsp;<span class="ident" id="5261203">int64</span><span class="op" id="5261208">(</span><span class="ident" id="5261209">c</span><span class="op" id="5261210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261214">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261218">return</span>&nbsp;<span class="ident" id="5261225">x</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261228">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261232">//&nbsp;Because&nbsp;unused&nbsp;fields&nbsp;are&nbsp;filled&nbsp;with&nbsp;NULs,&nbsp;we&nbsp;need</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261288">//&nbsp;to&nbsp;skip&nbsp;leading&nbsp;NULs.&nbsp;Fields&nbsp;may&nbsp;also&nbsp;be&nbsp;padded&nbsp;with</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261345">//&nbsp;spaces&nbsp;or&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261365">//&nbsp;So&nbsp;we&nbsp;remove&nbsp;leading&nbsp;and&nbsp;trailing&nbsp;NULs&nbsp;and&nbsp;spaces&nbsp;to</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5261422">//&nbsp;be&nbsp;sure.</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261435">b</span>&nbsp;<span class="op" id="5261437">=</span>&nbsp;<span class="ident" id="5261439">bytes</span><span class="op" id="5261444">.</span><span class="ident" id="5261445">Trim</span><span class="op" id="5261449">(</span><span class="ident" id="5261450">b</span><span class="op" id="5261451">,</span>&nbsp;<span class="string" id="5261453">&#34;&nbsp;\x00&#34;</span><span class="op" id="5261460">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261464">if</span>&nbsp;<span class="builtinfunc" id="5261467">len</span><span class="op" id="5261470">(</span><span class="ident" id="5261471">b</span><span class="op" id="5261472">)</span>&nbsp;<span class="op" id="5261474">==</span>&nbsp;<span class="num" id="5261477">0</span>&nbsp;<span class="op" id="5261479">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261483">return</span>&nbsp;<span class="num" id="5261490">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261493">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261496">x</span><span class="op" id="5261497">,</span>&nbsp;<span class="ident" id="5261499">err</span>&nbsp;<span class="op" id="5261503">:=</span>&nbsp;<span class="ident" id="5261506">strconv</span><span class="op" id="5261513">.</span><span class="ident" id="5261514">ParseUint</span><span class="op" id="5261523">(</span><span class="ident" id="5261524">cString</span><span class="op" id="5261531">(</span><span class="ident" id="5261532">b</span><span class="op" id="5261533">)</span><span class="op" id="5261534">,</span>&nbsp;<span class="num" id="5261536">8</span><span class="op" id="5261537">,</span>&nbsp;<span class="num" id="5261539">64</span><span class="op" id="5261541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261544">if</span>&nbsp;<span class="ident" id="5261547">err</span>&nbsp;<span class="op" id="5261551">!=</span>&nbsp;<span class="ident" id="5261554">nil</span>&nbsp;<span class="op" id="5261558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261562">tr</span><span class="op" id="5261564">.</span><span class="ident" id="5261565">err</span>&nbsp;<span class="op" id="5261569">=</span>&nbsp;<span class="ident" id="5261571">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261579">return</span>&nbsp;<span class="ident" id="5261586">int64</span><span class="op" id="5261591">(</span><span class="ident" id="5261592">x</span><span class="op" id="5261593">)</span><br>
<span class="lineno">405</span><span class="op" id="5261595">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5261598">//&nbsp;skipUnread&nbsp;skips&nbsp;any&nbsp;unread&nbsp;bytes&nbsp;in&nbsp;the&nbsp;existing&nbsp;file&nbsp;entry,&nbsp;as&nbsp;well&nbsp;as&nbsp;any&nbsp;alignment&nbsp;padding.</span><br>
<span class="lineno"></span><span class="keyword" id="5261697">func</span>&nbsp;<span class="op" id="5261702">(</span><span class="ident" id="5261703">tr</span>&nbsp;<span class="op" id="5261706">*</span><span class="ident" id="5261707">Reader</span><span class="op" id="5261713">)</span>&nbsp;<span class="ident" id="5261715">skipUnread</span><span class="op" id="5261725">(</span><span class="op" id="5261726">)</span>&nbsp;<span class="op" id="5261728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261731">nr</span>&nbsp;<span class="op" id="5261734">:=</span>&nbsp;<span class="ident" id="5261737">tr</span><span class="op" id="5261739">.</span><span class="ident" id="5261740">numBytes</span><span class="op" id="5261748">(</span><span class="op" id="5261749">)</span>&nbsp;<span class="op" id="5261751">+</span>&nbsp;<span class="ident" id="5261753">tr</span><span class="op" id="5261755">.</span><span class="ident" id="5261756">pad</span>&nbsp;<span class="comment" id="5261760">//&nbsp;number&nbsp;of&nbsp;bytes&nbsp;to&nbsp;skip</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261788">tr</span><span class="op" id="5261790">.</span><span class="ident" id="5261791">curr</span><span class="op" id="5261795">,</span>&nbsp;<span class="ident" id="5261797">tr</span><span class="op" id="5261799">.</span><span class="ident" id="5261800">pad</span>&nbsp;<span class="op" id="5261804">=</span>&nbsp;<span class="ident" id="5261806">nil</span><span class="op" id="5261809">,</span>&nbsp;<span class="num" id="5261811">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261814">if</span>&nbsp;<span class="ident" id="5261817">sr</span><span class="op" id="5261819">,</span>&nbsp;<span class="ident" id="5261821">ok</span>&nbsp;<span class="op" id="5261824">:=</span>&nbsp;<span class="ident" id="5261827">tr</span><span class="op" id="5261829">.</span><span class="ident" id="5261830">r</span><span class="op" id="5261831">.</span><span class="op" id="5261832">(</span><span class="ident" id="5261833">io</span><span class="op" id="5261835">.</span><span class="ident" id="5261836">Seeker</span><span class="op" id="5261842">)</span><span class="op" id="5261843">;</span>&nbsp;<span class="ident" id="5261845">ok</span>&nbsp;<span class="op" id="5261848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261852">if</span>&nbsp;<span class="ident" id="5261855">_</span><span class="op" id="5261856">,</span>&nbsp;<span class="ident" id="5261858">err</span>&nbsp;<span class="op" id="5261862">:=</span>&nbsp;<span class="ident" id="5261865">sr</span><span class="op" id="5261867">.</span><span class="ident" id="5261868">Seek</span><span class="op" id="5261872">(</span><span class="ident" id="5261873">nr</span><span class="op" id="5261875">,</span>&nbsp;<span class="ident" id="5261877">os</span><span class="op" id="5261879">.</span><span class="ident" id="5261880">SEEK_CUR</span><span class="op" id="5261888">)</span><span class="op" id="5261889">;</span>&nbsp;<span class="ident" id="5261891">err</span>&nbsp;<span class="op" id="5261895">==</span>&nbsp;<span class="ident" id="5261898">nil</span>&nbsp;<span class="op" id="5261902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5261907">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261916">}</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5261919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5261922">_</span><span class="op" id="5261923">,</span>&nbsp;<span class="ident" id="5261925">tr</span><span class="op" id="5261927">.</span><span class="ident" id="5261928">err</span>&nbsp;<span class="op" id="5261932">=</span>&nbsp;<span class="ident" id="5261934">io</span><span class="op" id="5261936">.</span><span class="ident" id="5261937">CopyN</span><span class="op" id="5261942">(</span><span class="ident" id="5261943">ioutil</span><span class="op" id="5261949">.</span><span class="ident" id="5261950">Discard</span><span class="op" id="5261957">,</span>&nbsp;<span class="ident" id="5261959">tr</span><span class="op" id="5261961">.</span><span class="ident" id="5261962">r</span><span class="op" id="5261963">,</span>&nbsp;<span class="ident" id="5261965">nr</span><span class="op" id="5261967">)</span><br>
<span class="lineno"></span><span class="op" id="5261969">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5261972">func</span>&nbsp;<span class="op" id="5261977">(</span><span class="ident" id="5261978">tr</span>&nbsp;<span class="op" id="5261981">*</span><span class="ident" id="5261982">Reader</span><span class="op" id="5261988">)</span>&nbsp;<span class="ident" id="5261990">verifyChecksum</span><span class="op" id="5262004">(</span><span class="ident" id="5262005">header</span>&nbsp;<span class="op" id="5262012">[</span><span class="op" id="5262013">]</span><span class="builtintype" id="5262014">byte</span><span class="op" id="5262018">)</span>&nbsp;<span class="builtintype" id="5262020">bool</span>&nbsp;<span class="op" id="5262025">{</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262028">if</span>&nbsp;<span class="ident" id="5262031">tr</span><span class="op" id="5262033">.</span><span class="ident" id="5262034">err</span>&nbsp;<span class="op" id="5262038">!=</span>&nbsp;<span class="ident" id="5262041">nil</span>&nbsp;<span class="op" id="5262045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262049">return</span>&nbsp;<span class="builtintype" id="5262056">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262063">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262067">given</span>&nbsp;<span class="op" id="5262073">:=</span>&nbsp;<span class="ident" id="5262076">tr</span><span class="op" id="5262078">.</span><span class="ident" id="5262079">octal</span><span class="op" id="5262084">(</span><span class="ident" id="5262085">header</span><span class="op" id="5262091">[</span><span class="num" id="5262092">148</span><span class="op" id="5262095">:</span><span class="num" id="5262096">156</span><span class="op" id="5262099">]</span><span class="op" id="5262100">)</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262103">unsigned</span><span class="op" id="5262111">,</span>&nbsp;<span class="ident" id="5262113">signed</span>&nbsp;<span class="op" id="5262120">:=</span>&nbsp;<span class="ident" id="5262123">checksum</span><span class="op" id="5262131">(</span><span class="ident" id="5262132">header</span><span class="op" id="5262138">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262141">return</span>&nbsp;<span class="ident" id="5262148">given</span>&nbsp;<span class="op" id="5262154">==</span>&nbsp;<span class="ident" id="5262157">unsigned</span>&nbsp;<span class="op" id="5262166">||</span>&nbsp;<span class="ident" id="5262169">given</span>&nbsp;<span class="op" id="5262175">==</span>&nbsp;<span class="ident" id="5262178">signed</span><br>
<span class="lineno"></span><span class="op" id="5262185">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5262188">func</span>&nbsp;<span class="op" id="5262193">(</span><span class="ident" id="5262194">tr</span>&nbsp;<span class="op" id="5262197">*</span><span class="ident" id="5262198">Reader</span><span class="op" id="5262204">)</span>&nbsp;<span class="ident" id="5262206">readHeader</span><span class="op" id="5262216">(</span><span class="op" id="5262217">)</span>&nbsp;<span class="op" id="5262219">*</span><span class="ident" id="5262220">Header</span>&nbsp;<span class="op" id="5262227">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262230">header</span>&nbsp;<span class="op" id="5262237">:=</span>&nbsp;<span class="ident" id="5262240">tr</span><span class="op" id="5262242">.</span><span class="ident" id="5262243">hdrBuff</span><span class="op" id="5262250">[</span><span class="op" id="5262251">:</span><span class="op" id="5262252">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5262255">copy</span><span class="op" id="5262259">(</span><span class="ident" id="5262260">header</span><span class="op" id="5262266">,</span>&nbsp;<span class="ident" id="5262268">zeroBlock</span><span class="op" id="5262277">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262281">if</span>&nbsp;<span class="ident" id="5262284">_</span><span class="op" id="5262285">,</span>&nbsp;<span class="ident" id="5262287">tr</span><span class="op" id="5262289">.</span><span class="ident" id="5262290">err</span>&nbsp;<span class="op" id="5262294">=</span>&nbsp;<span class="ident" id="5262296">io</span><span class="op" id="5262298">.</span><span class="ident" id="5262299">ReadFull</span><span class="op" id="5262307">(</span><span class="ident" id="5262308">tr</span><span class="op" id="5262310">.</span><span class="ident" id="5262311">r</span><span class="op" id="5262312">,</span>&nbsp;<span class="ident" id="5262314">header</span><span class="op" id="5262320">)</span><span class="op" id="5262321">;</span>&nbsp;<span class="ident" id="5262323">tr</span><span class="op" id="5262325">.</span><span class="ident" id="5262326">err</span>&nbsp;<span class="op" id="5262330">!=</span>&nbsp;<span class="ident" id="5262333">nil</span>&nbsp;<span class="op" id="5262337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262341">return</span>&nbsp;<span class="ident" id="5262348">nil</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262353">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262357">//&nbsp;Two&nbsp;blocks&nbsp;of&nbsp;zero&nbsp;bytes&nbsp;marks&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;archive.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262416">if</span>&nbsp;<span class="ident" id="5262419">bytes</span><span class="op" id="5262424">.</span><span class="ident" id="5262425">Equal</span><span class="op" id="5262430">(</span><span class="ident" id="5262431">header</span><span class="op" id="5262437">,</span>&nbsp;<span class="ident" id="5262439">zeroBlock</span><span class="op" id="5262448">[</span><span class="num" id="5262449">0</span><span class="op" id="5262450">:</span><span class="ident" id="5262451">blockSize</span><span class="op" id="5262460">]</span><span class="op" id="5262461">)</span>&nbsp;<span class="op" id="5262463">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262467">if</span>&nbsp;<span class="ident" id="5262470">_</span><span class="op" id="5262471">,</span>&nbsp;<span class="ident" id="5262473">tr</span><span class="op" id="5262475">.</span><span class="ident" id="5262476">err</span>&nbsp;<span class="op" id="5262480">=</span>&nbsp;<span class="ident" id="5262482">io</span><span class="op" id="5262484">.</span><span class="ident" id="5262485">ReadFull</span><span class="op" id="5262493">(</span><span class="ident" id="5262494">tr</span><span class="op" id="5262496">.</span><span class="ident" id="5262497">r</span><span class="op" id="5262498">,</span>&nbsp;<span class="ident" id="5262500">header</span><span class="op" id="5262506">)</span><span class="op" id="5262507">;</span>&nbsp;<span class="ident" id="5262509">tr</span><span class="op" id="5262511">.</span><span class="ident" id="5262512">err</span>&nbsp;<span class="op" id="5262516">!=</span>&nbsp;<span class="ident" id="5262519">nil</span>&nbsp;<span class="op" id="5262523">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262528">return</span>&nbsp;<span class="ident" id="5262535">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262541">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262545">if</span>&nbsp;<span class="ident" id="5262548">bytes</span><span class="op" id="5262553">.</span><span class="ident" id="5262554">Equal</span><span class="op" id="5262559">(</span><span class="ident" id="5262560">header</span><span class="op" id="5262566">,</span>&nbsp;<span class="ident" id="5262568">zeroBlock</span><span class="op" id="5262577">[</span><span class="num" id="5262578">0</span><span class="op" id="5262579">:</span><span class="ident" id="5262580">blockSize</span><span class="op" id="5262589">]</span><span class="op" id="5262590">)</span>&nbsp;<span class="op" id="5262592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262597">tr</span><span class="op" id="5262599">.</span><span class="ident" id="5262600">err</span>&nbsp;<span class="op" id="5262604">=</span>&nbsp;<span class="ident" id="5262606">io</span><span class="op" id="5262608">.</span><span class="ident" id="5262609">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262615">}</span>&nbsp;<span class="keyword" id="5262617">else</span>&nbsp;<span class="op" id="5262622">{</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262627">tr</span><span class="op" id="5262629">.</span><span class="ident" id="5262630">err</span>&nbsp;<span class="op" id="5262634">=</span>&nbsp;<span class="ident" id="5262636">ErrHeader</span>&nbsp;<span class="comment" id="5262646">//&nbsp;zero&nbsp;block&nbsp;and&nbsp;then&nbsp;non-zero&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262686">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262690">return</span>&nbsp;<span class="ident" id="5262697">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262702">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262706">if</span>&nbsp;<span class="op" id="5262709">!</span><span class="ident" id="5262710">tr</span><span class="op" id="5262712">.</span><span class="ident" id="5262713">verifyChecksum</span><span class="op" id="5262727">(</span><span class="ident" id="5262728">header</span><span class="op" id="5262734">)</span>&nbsp;<span class="op" id="5262736">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262740">tr</span><span class="op" id="5262742">.</span><span class="ident" id="5262743">err</span>&nbsp;<span class="op" id="5262747">=</span>&nbsp;<span class="ident" id="5262749">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5262761">return</span>&nbsp;<span class="ident" id="5262768">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5262773">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">455</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5262777">//&nbsp;Unpack</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262788">hdr</span>&nbsp;<span class="op" id="5262792">:=</span>&nbsp;<span class="builtinfunc" id="5262795">new</span><span class="op" id="5262798">(</span><span class="ident" id="5262799">Header</span><span class="op" id="5262805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262808">s</span>&nbsp;<span class="op" id="5262810">:=</span>&nbsp;<span class="ident" id="5262813">slicer</span><span class="op" id="5262819">(</span><span class="ident" id="5262820">header</span><span class="op" id="5262826">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262830">hdr</span><span class="op" id="5262833">.</span><span class="ident" id="5262834">Name</span>&nbsp;<span class="op" id="5262839">=</span>&nbsp;<span class="ident" id="5262841">cString</span><span class="op" id="5262848">(</span><span class="ident" id="5262849">s</span><span class="op" id="5262850">.</span><span class="ident" id="5262851">next</span><span class="op" id="5262855">(</span><span class="num" id="5262856">100</span><span class="op" id="5262859">)</span><span class="op" id="5262860">)</span><br>
<span class="lineno">460</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262863">hdr</span><span class="op" id="5262866">.</span><span class="ident" id="5262867">Mode</span>&nbsp;<span class="op" id="5262872">=</span>&nbsp;<span class="ident" id="5262874">tr</span><span class="op" id="5262876">.</span><span class="ident" id="5262877">octal</span><span class="op" id="5262882">(</span><span class="ident" id="5262883">s</span><span class="op" id="5262884">.</span><span class="ident" id="5262885">next</span><span class="op" id="5262889">(</span><span class="num" id="5262890">8</span><span class="op" id="5262891">)</span><span class="op" id="5262892">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262895">hdr</span><span class="op" id="5262898">.</span><span class="ident" id="5262899">Uid</span>&nbsp;<span class="op" id="5262903">=</span>&nbsp;<span class="builtintype" id="5262905">int</span><span class="op" id="5262908">(</span><span class="ident" id="5262909">tr</span><span class="op" id="5262911">.</span><span class="ident" id="5262912">octal</span><span class="op" id="5262917">(</span><span class="ident" id="5262918">s</span><span class="op" id="5262919">.</span><span class="ident" id="5262920">next</span><span class="op" id="5262924">(</span><span class="num" id="5262925">8</span><span class="op" id="5262926">)</span><span class="op" id="5262927">)</span><span class="op" id="5262928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262931">hdr</span><span class="op" id="5262934">.</span><span class="ident" id="5262935">Gid</span>&nbsp;<span class="op" id="5262939">=</span>&nbsp;<span class="builtintype" id="5262941">int</span><span class="op" id="5262944">(</span><span class="ident" id="5262945">tr</span><span class="op" id="5262947">.</span><span class="ident" id="5262948">octal</span><span class="op" id="5262953">(</span><span class="ident" id="5262954">s</span><span class="op" id="5262955">.</span><span class="ident" id="5262956">next</span><span class="op" id="5262960">(</span><span class="num" id="5262961">8</span><span class="op" id="5262962">)</span><span class="op" id="5262963">)</span><span class="op" id="5262964">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5262967">hdr</span><span class="op" id="5262970">.</span><span class="ident" id="5262971">Size</span>&nbsp;<span class="op" id="5262976">=</span>&nbsp;<span class="ident" id="5262978">tr</span><span class="op" id="5262980">.</span><span class="ident" id="5262981">octal</span><span class="op" id="5262986">(</span><span class="ident" id="5262987">s</span><span class="op" id="5262988">.</span><span class="ident" id="5262989">next</span><span class="op" id="5262993">(</span><span class="num" id="5262994">12</span><span class="op" id="5262996">)</span><span class="op" id="5262997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263000">hdr</span><span class="op" id="5263003">.</span><span class="ident" id="5263004">ModTime</span>&nbsp;<span class="op" id="5263012">=</span>&nbsp;<span class="ident" id="5263014">time</span><span class="op" id="5263018">.</span><span class="ident" id="5263019">Unix</span><span class="op" id="5263023">(</span><span class="ident" id="5263024">tr</span><span class="op" id="5263026">.</span><span class="ident" id="5263027">octal</span><span class="op" id="5263032">(</span><span class="ident" id="5263033">s</span><span class="op" id="5263034">.</span><span class="ident" id="5263035">next</span><span class="op" id="5263039">(</span><span class="num" id="5263040">12</span><span class="op" id="5263042">)</span><span class="op" id="5263043">)</span><span class="op" id="5263044">,</span>&nbsp;<span class="num" id="5263046">0</span><span class="op" id="5263047">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263050">s</span><span class="op" id="5263051">.</span><span class="ident" id="5263052">next</span><span class="op" id="5263056">(</span><span class="num" id="5263057">8</span><span class="op" id="5263058">)</span>&nbsp;<span class="comment" id="5263060">//&nbsp;chksum</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263071">hdr</span><span class="op" id="5263074">.</span><span class="ident" id="5263075">Typeflag</span>&nbsp;<span class="op" id="5263084">=</span>&nbsp;<span class="ident" id="5263086">s</span><span class="op" id="5263087">.</span><span class="ident" id="5263088">next</span><span class="op" id="5263092">(</span><span class="num" id="5263093">1</span><span class="op" id="5263094">)</span><span class="op" id="5263095">[</span><span class="num" id="5263096">0</span><span class="op" id="5263097">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263100">hdr</span><span class="op" id="5263103">.</span><span class="ident" id="5263104">Linkname</span>&nbsp;<span class="op" id="5263113">=</span>&nbsp;<span class="ident" id="5263115">cString</span><span class="op" id="5263122">(</span><span class="ident" id="5263123">s</span><span class="op" id="5263124">.</span><span class="ident" id="5263125">next</span><span class="op" id="5263129">(</span><span class="num" id="5263130">100</span><span class="op" id="5263133">)</span><span class="op" id="5263134">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263138">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;header&nbsp;depends&nbsp;on&nbsp;the&nbsp;value&nbsp;of&nbsp;magic.</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263201">//&nbsp;The&nbsp;original&nbsp;(v7)&nbsp;version&nbsp;of&nbsp;tar&nbsp;had&nbsp;no&nbsp;explicit&nbsp;magic&nbsp;field,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5263267">//&nbsp;so&nbsp;its&nbsp;magic&nbsp;bytes,&nbsp;like&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;block,&nbsp;are&nbsp;NULs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263329">magic</span>&nbsp;<span class="op" id="5263335">:=</span>&nbsp;<span class="builtintype" id="5263338">string</span><span class="op" id="5263344">(</span><span class="ident" id="5263345">s</span><span class="op" id="5263346">.</span><span class="ident" id="5263347">next</span><span class="op" id="5263351">(</span><span class="num" id="5263352">8</span><span class="op" id="5263353">)</span><span class="op" id="5263354">)</span>&nbsp;<span class="comment" id="5263356">//&nbsp;contains&nbsp;version&nbsp;field&nbsp;as&nbsp;well.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263392">var</span>&nbsp;<span class="ident" id="5263396">format</span>&nbsp;<span class="builtintype" id="5263403">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263411">switch</span>&nbsp;<span class="op" id="5263418">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263421">case</span>&nbsp;<span class="ident" id="5263426">magic</span><span class="op" id="5263431">[</span><span class="op" id="5263432">:</span><span class="num" id="5263433">6</span><span class="op" id="5263434">]</span>&nbsp;<span class="op" id="5263436">==</span>&nbsp;<span class="string" id="5263439">&#34;ustar\x00&#34;</span><span class="op" id="5263450">:</span>&nbsp;<span class="comment" id="5263452">//&nbsp;POSIX&nbsp;tar&nbsp;(1003.1-1988)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263481">if</span>&nbsp;<span class="builtintype" id="5263484">string</span><span class="op" id="5263490">(</span><span class="ident" id="5263491">header</span><span class="op" id="5263497">[</span><span class="num" id="5263498">508</span><span class="op" id="5263501">:</span><span class="num" id="5263502">512</span><span class="op" id="5263505">]</span><span class="op" id="5263506">)</span>&nbsp;<span class="op" id="5263508">==</span>&nbsp;<span class="string" id="5263511">&#34;tar\x00&#34;</span>&nbsp;<span class="op" id="5263521">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263526">format</span>&nbsp;<span class="op" id="5263533">=</span>&nbsp;<span class="string" id="5263535">&#34;star&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263544">}</span>&nbsp;<span class="keyword" id="5263546">else</span>&nbsp;<span class="op" id="5263551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263556">format</span>&nbsp;<span class="op" id="5263563">=</span>&nbsp;<span class="string" id="5263565">&#34;posix&#34;</span><br>
<span class="lineno">480</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263575">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263578">case</span>&nbsp;<span class="ident" id="5263583">magic</span>&nbsp;<span class="op" id="5263589">==</span>&nbsp;<span class="string" id="5263592">&#34;ustar&nbsp;&nbsp;\x00&#34;</span><span class="op" id="5263605">:</span>&nbsp;<span class="comment" id="5263607">//&nbsp;old&nbsp;GNU&nbsp;tar</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263624">format</span>&nbsp;<span class="op" id="5263631">=</span>&nbsp;<span class="string" id="5263633">&#34;gnu&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263640">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263644">switch</span>&nbsp;<span class="ident" id="5263651">format</span>&nbsp;<span class="op" id="5263658">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263661">case</span>&nbsp;<span class="string" id="5263666">&#34;posix&#34;</span><span class="op" id="5263673">,</span>&nbsp;<span class="string" id="5263675">&#34;gnu&#34;</span><span class="op" id="5263680">,</span>&nbsp;<span class="string" id="5263682">&#34;star&#34;</span><span class="op" id="5263688">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263692">hdr</span><span class="op" id="5263695">.</span><span class="ident" id="5263696">Uname</span>&nbsp;<span class="op" id="5263702">=</span>&nbsp;<span class="ident" id="5263704">cString</span><span class="op" id="5263711">(</span><span class="ident" id="5263712">s</span><span class="op" id="5263713">.</span><span class="ident" id="5263714">next</span><span class="op" id="5263718">(</span><span class="num" id="5263719">32</span><span class="op" id="5263721">)</span><span class="op" id="5263722">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263726">hdr</span><span class="op" id="5263729">.</span><span class="ident" id="5263730">Gname</span>&nbsp;<span class="op" id="5263736">=</span>&nbsp;<span class="ident" id="5263738">cString</span><span class="op" id="5263745">(</span><span class="ident" id="5263746">s</span><span class="op" id="5263747">.</span><span class="ident" id="5263748">next</span><span class="op" id="5263752">(</span><span class="num" id="5263753">32</span><span class="op" id="5263755">)</span><span class="op" id="5263756">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263760">devmajor</span>&nbsp;<span class="op" id="5263769">:=</span>&nbsp;<span class="ident" id="5263772">s</span><span class="op" id="5263773">.</span><span class="ident" id="5263774">next</span><span class="op" id="5263778">(</span><span class="num" id="5263779">8</span><span class="op" id="5263780">)</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263784">devminor</span>&nbsp;<span class="op" id="5263793">:=</span>&nbsp;<span class="ident" id="5263796">s</span><span class="op" id="5263797">.</span><span class="ident" id="5263798">next</span><span class="op" id="5263802">(</span><span class="num" id="5263803">8</span><span class="op" id="5263804">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263808">if</span>&nbsp;<span class="ident" id="5263811">hdr</span><span class="op" id="5263814">.</span><span class="ident" id="5263815">Typeflag</span>&nbsp;<span class="op" id="5263824">==</span>&nbsp;<span class="ident" id="5263827">TypeChar</span>&nbsp;<span class="op" id="5263836">||</span>&nbsp;<span class="ident" id="5263839">hdr</span><span class="op" id="5263842">.</span><span class="ident" id="5263843">Typeflag</span>&nbsp;<span class="op" id="5263852">==</span>&nbsp;<span class="ident" id="5263855">TypeBlock</span>&nbsp;<span class="op" id="5263865">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263870">hdr</span><span class="op" id="5263873">.</span><span class="ident" id="5263874">Devmajor</span>&nbsp;<span class="op" id="5263883">=</span>&nbsp;<span class="ident" id="5263885">tr</span><span class="op" id="5263887">.</span><span class="ident" id="5263888">octal</span><span class="op" id="5263893">(</span><span class="ident" id="5263894">devmajor</span><span class="op" id="5263902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5263907">hdr</span><span class="op" id="5263910">.</span><span class="ident" id="5263911">Devminor</span>&nbsp;<span class="op" id="5263920">=</span>&nbsp;<span class="ident" id="5263922">tr</span><span class="op" id="5263924">.</span><span class="ident" id="5263925">octal</span><span class="op" id="5263930">(</span><span class="ident" id="5263931">devminor</span><span class="op" id="5263939">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5263943">}</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263947">var</span>&nbsp;<span class="ident" id="5263951">prefix</span>&nbsp;<span class="builtintype" id="5263958">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263967">switch</span>&nbsp;<span class="ident" id="5263974">format</span>&nbsp;<span class="op" id="5263981">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5263985">case</span>&nbsp;<span class="string" id="5263990">&#34;posix&#34;</span><span class="op" id="5263997">,</span>&nbsp;<span class="string" id="5263999">&#34;gnu&#34;</span><span class="op" id="5264004">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264009">prefix</span>&nbsp;<span class="op" id="5264016">=</span>&nbsp;<span class="ident" id="5264018">cString</span><span class="op" id="5264025">(</span><span class="ident" id="5264026">s</span><span class="op" id="5264027">.</span><span class="ident" id="5264028">next</span><span class="op" id="5264032">(</span><span class="num" id="5264033">155</span><span class="op" id="5264036">)</span><span class="op" id="5264037">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264041">case</span>&nbsp;<span class="string" id="5264046">&#34;star&#34;</span><span class="op" id="5264052">:</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264057">prefix</span>&nbsp;<span class="op" id="5264064">=</span>&nbsp;<span class="ident" id="5264066">cString</span><span class="op" id="5264073">(</span><span class="ident" id="5264074">s</span><span class="op" id="5264075">.</span><span class="ident" id="5264076">next</span><span class="op" id="5264080">(</span><span class="num" id="5264081">131</span><span class="op" id="5264084">)</span><span class="op" id="5264085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264090">hdr</span><span class="op" id="5264093">.</span><span class="ident" id="5264094">AccessTime</span>&nbsp;<span class="op" id="5264105">=</span>&nbsp;<span class="ident" id="5264107">time</span><span class="op" id="5264111">.</span><span class="ident" id="5264112">Unix</span><span class="op" id="5264116">(</span><span class="ident" id="5264117">tr</span><span class="op" id="5264119">.</span><span class="ident" id="5264120">octal</span><span class="op" id="5264125">(</span><span class="ident" id="5264126">s</span><span class="op" id="5264127">.</span><span class="ident" id="5264128">next</span><span class="op" id="5264132">(</span><span class="num" id="5264133">12</span><span class="op" id="5264135">)</span><span class="op" id="5264136">)</span><span class="op" id="5264137">,</span>&nbsp;<span class="num" id="5264139">0</span><span class="op" id="5264140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264145">hdr</span><span class="op" id="5264148">.</span><span class="ident" id="5264149">ChangeTime</span>&nbsp;<span class="op" id="5264160">=</span>&nbsp;<span class="ident" id="5264162">time</span><span class="op" id="5264166">.</span><span class="ident" id="5264167">Unix</span><span class="op" id="5264171">(</span><span class="ident" id="5264172">tr</span><span class="op" id="5264174">.</span><span class="ident" id="5264175">octal</span><span class="op" id="5264180">(</span><span class="ident" id="5264181">s</span><span class="op" id="5264182">.</span><span class="ident" id="5264183">next</span><span class="op" id="5264187">(</span><span class="num" id="5264188">12</span><span class="op" id="5264190">)</span><span class="op" id="5264191">)</span><span class="op" id="5264192">,</span>&nbsp;<span class="num" id="5264194">0</span><span class="op" id="5264195">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264199">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264203">if</span>&nbsp;<span class="builtinfunc" id="5264206">len</span><span class="op" id="5264209">(</span><span class="ident" id="5264210">prefix</span><span class="op" id="5264216">)</span>&nbsp;<span class="op" id="5264218">&gt;</span>&nbsp;<span class="num" id="5264220">0</span>&nbsp;<span class="op" id="5264222">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264227">hdr</span><span class="op" id="5264230">.</span><span class="ident" id="5264231">Name</span>&nbsp;<span class="op" id="5264236">=</span>&nbsp;<span class="ident" id="5264238">prefix</span>&nbsp;<span class="op" id="5264245">+</span>&nbsp;<span class="string" id="5264247">&#34;/&#34;</span>&nbsp;<span class="op" id="5264251">+</span>&nbsp;<span class="ident" id="5264253">hdr</span><span class="op" id="5264256">.</span><span class="ident" id="5264257">Name</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264264">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264267">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264271">if</span>&nbsp;<span class="ident" id="5264274">tr</span><span class="op" id="5264276">.</span><span class="ident" id="5264277">err</span>&nbsp;<span class="op" id="5264281">!=</span>&nbsp;<span class="ident" id="5264284">nil</span>&nbsp;<span class="op" id="5264288">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264292">tr</span><span class="op" id="5264294">.</span><span class="ident" id="5264295">err</span>&nbsp;<span class="op" id="5264299">=</span>&nbsp;<span class="ident" id="5264301">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264313">return</span>&nbsp;<span class="ident" id="5264320">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264329">//&nbsp;Maximum&nbsp;value&nbsp;of&nbsp;hdr.Size&nbsp;is&nbsp;64&nbsp;GB&nbsp;(12&nbsp;octal&nbsp;digits),</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264387">//&nbsp;so&nbsp;there&#39;s&nbsp;no&nbsp;risk&nbsp;of&nbsp;int64&nbsp;overflowing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264432">nb</span>&nbsp;<span class="op" id="5264435">:=</span>&nbsp;<span class="ident" id="5264438">int64</span><span class="op" id="5264443">(</span><span class="ident" id="5264444">hdr</span><span class="op" id="5264447">.</span><span class="ident" id="5264448">Size</span><span class="op" id="5264452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264455">tr</span><span class="op" id="5264457">.</span><span class="ident" id="5264458">pad</span>&nbsp;<span class="op" id="5264462">=</span>&nbsp;<span class="op" id="5264464">-</span><span class="ident" id="5264465">nb</span>&nbsp;<span class="op" id="5264468">&amp;</span>&nbsp;<span class="op" id="5264470">(</span><span class="ident" id="5264471">blockSize</span>&nbsp;<span class="op" id="5264481">-</span>&nbsp;<span class="num" id="5264483">1</span><span class="op" id="5264484">)</span>&nbsp;<span class="comment" id="5264486">//&nbsp;blockSize&nbsp;is&nbsp;a&nbsp;power&nbsp;of&nbsp;two</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264519">//&nbsp;Set&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264552">tr</span><span class="op" id="5264554">.</span><span class="ident" id="5264555">curr</span>&nbsp;<span class="op" id="5264560">=</span>&nbsp;<span class="op" id="5264562">&amp;</span><span class="ident" id="5264563">regFileReader</span><span class="op" id="5264576">{</span><span class="ident" id="5264577">r</span><span class="op" id="5264578">:</span>&nbsp;<span class="ident" id="5264580">tr</span><span class="op" id="5264582">.</span><span class="ident" id="5264583">r</span><span class="op" id="5264584">,</span>&nbsp;<span class="ident" id="5264586">nb</span><span class="op" id="5264588">:</span>&nbsp;<span class="ident" id="5264590">nb</span><span class="op" id="5264592">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264596">//&nbsp;Check&nbsp;for&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format&nbsp;entry.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264639">if</span>&nbsp;<span class="ident" id="5264642">hdr</span><span class="op" id="5264645">.</span><span class="ident" id="5264646">Typeflag</span>&nbsp;<span class="op" id="5264655">==</span>&nbsp;<span class="ident" id="5264658">TypeGNUSparse</span>&nbsp;<span class="op" id="5264672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264676">//&nbsp;Get&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;the&nbsp;file.</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264712">hdr</span><span class="op" id="5264715">.</span><span class="ident" id="5264716">Size</span>&nbsp;<span class="op" id="5264721">=</span>&nbsp;<span class="ident" id="5264723">tr</span><span class="op" id="5264725">.</span><span class="ident" id="5264726">octal</span><span class="op" id="5264731">(</span><span class="ident" id="5264732">header</span><span class="op" id="5264738">[</span><span class="num" id="5264739">483</span><span class="op" id="5264742">:</span><span class="num" id="5264743">495</span><span class="op" id="5264746">]</span><span class="op" id="5264747">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264752">//&nbsp;Read&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264778">sp</span>&nbsp;<span class="op" id="5264781">:=</span>&nbsp;<span class="ident" id="5264784">tr</span><span class="op" id="5264786">.</span><span class="ident" id="5264787">readOldGNUSparseMap</span><span class="op" id="5264806">(</span><span class="ident" id="5264807">header</span><span class="op" id="5264813">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264817">if</span>&nbsp;<span class="ident" id="5264820">tr</span><span class="op" id="5264822">.</span><span class="ident" id="5264823">err</span>&nbsp;<span class="op" id="5264827">!=</span>&nbsp;<span class="ident" id="5264830">nil</span>&nbsp;<span class="op" id="5264834">{</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5264839">return</span>&nbsp;<span class="ident" id="5264846">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5264852">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5264856">//&nbsp;Current&nbsp;file&nbsp;is&nbsp;a&nbsp;GNU&nbsp;sparse&nbsp;file.&nbsp;Update&nbsp;the&nbsp;current&nbsp;file&nbsp;reader.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5264928">tr</span><span class="op" id="5264930">.</span><span class="ident" id="5264931">curr</span>&nbsp;<span class="op" id="5264936">=</span>&nbsp;<span class="op" id="5264938">&amp;</span><span class="ident" id="5264939">sparseFileReader</span><span class="op" id="5264955">{</span><span class="ident" id="5264956">rfr</span><span class="op" id="5264959">:</span>&nbsp;<span class="ident" id="5264961">tr</span><span class="op" id="5264963">.</span><span class="ident" id="5264964">curr</span><span class="op" id="5264968">.</span><span class="op" id="5264969">(</span><span class="op" id="5264970">*</span><span class="ident" id="5264971">regFileReader</span><span class="op" id="5264984">)</span><span class="op" id="5264985">,</span>&nbsp;<span class="ident" id="5264987">sp</span><span class="op" id="5264989">:</span>&nbsp;<span class="ident" id="5264991">sp</span><span class="op" id="5264993">,</span>&nbsp;<span class="ident" id="5264995">tot</span><span class="op" id="5264998">:</span>&nbsp;<span class="ident" id="5265000">hdr</span><span class="op" id="5265003">.</span><span class="ident" id="5265004">Size</span><span class="op" id="5265008">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265011">}</span><br>
<span class="lineno">535</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265015">return</span>&nbsp;<span class="ident" id="5265022">hdr</span><br>
<span class="lineno"></span><span class="op" id="5265026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5265029">//&nbsp;A&nbsp;sparseEntry&nbsp;holds&nbsp;a&nbsp;single&nbsp;entry&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&#39;s&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">540</span><span class="comment" id="5265098">//&nbsp;A&nbsp;sparse&nbsp;entry&nbsp;indicates&nbsp;the&nbsp;offset&nbsp;and&nbsp;size&nbsp;in&nbsp;a&nbsp;sparse&nbsp;file&nbsp;of&nbsp;a</span><br>
<span class="lineno"></span><span class="comment" id="5265168">//&nbsp;block&nbsp;of&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="5265186">type</span>&nbsp;<span class="ident" id="5265191">sparseEntry</span>&nbsp;<span class="keyword" id="5265203">struct</span>&nbsp;<span class="op" id="5265210">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265213">offset</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5265222">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265229">numBytes</span>&nbsp;<span class="ident" id="5265238">int64</span><br>
<span class="lineno">545</span><span class="op" id="5265244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5265247">//&nbsp;readOldGNUSparseMap&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;the&nbsp;old&nbsp;GNU&nbsp;sparse&nbsp;format.</span><br>
<span class="lineno"></span><span class="comment" id="5265331">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;tar&nbsp;header&nbsp;if&nbsp;it&#39;s&nbsp;small&nbsp;enough.&nbsp;If&nbsp;it&#39;s&nbsp;larger&nbsp;than&nbsp;four&nbsp;entries,</span><br>
<span class="lineno"></span><span class="comment" id="5265433">//&nbsp;then&nbsp;one&nbsp;or&nbsp;more&nbsp;extension&nbsp;headers&nbsp;are&nbsp;used&nbsp;to&nbsp;store&nbsp;the&nbsp;rest&nbsp;of&nbsp;the&nbsp;sparse&nbsp;map.</span><br>
<span class="lineno">550</span><span class="keyword" id="5265517">func</span>&nbsp;<span class="op" id="5265522">(</span><span class="ident" id="5265523">tr</span>&nbsp;<span class="op" id="5265526">*</span><span class="ident" id="5265527">Reader</span><span class="op" id="5265533">)</span>&nbsp;<span class="ident" id="5265535">readOldGNUSparseMap</span><span class="op" id="5265554">(</span><span class="ident" id="5265555">header</span>&nbsp;<span class="op" id="5265562">[</span><span class="op" id="5265563">]</span><span class="builtintype" id="5265564">byte</span><span class="op" id="5265568">)</span>&nbsp;<span class="op" id="5265570">[</span><span class="op" id="5265571">]</span><span class="ident" id="5265572">sparseEntry</span>&nbsp;<span class="op" id="5265584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265587">isExtended</span>&nbsp;<span class="op" id="5265598">:=</span>&nbsp;<span class="ident" id="5265601">header</span><span class="op" id="5265607">[</span><span class="ident" id="5265608">oldGNUSparseMainHeaderIsExtendedOffset</span><span class="op" id="5265646">]</span>&nbsp;<span class="op" id="5265648">!=</span>&nbsp;<span class="num" id="5265651">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265654">spCap</span>&nbsp;<span class="op" id="5265660">:=</span>&nbsp;<span class="ident" id="5265663">oldGNUSparseMainHeaderNumEntries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265697">if</span>&nbsp;<span class="ident" id="5265700">isExtended</span>&nbsp;<span class="op" id="5265711">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265715">spCap</span>&nbsp;<span class="op" id="5265721">+=</span>&nbsp;<span class="ident" id="5265724">oldGNUSparseExtendedHeaderNumEntries</span><br>
<span class="lineno">555</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5265762">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265765">sp</span>&nbsp;<span class="op" id="5265768">:=</span>&nbsp;<span class="builtinfunc" id="5265771">make</span><span class="op" id="5265775">(</span><span class="op" id="5265776">[</span><span class="op" id="5265777">]</span><span class="ident" id="5265778">sparseEntry</span><span class="op" id="5265789">,</span>&nbsp;<span class="num" id="5265791">0</span><span class="op" id="5265792">,</span>&nbsp;<span class="ident" id="5265794">spCap</span><span class="op" id="5265799">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265802">s</span>&nbsp;<span class="op" id="5265804">:=</span>&nbsp;<span class="ident" id="5265807">slicer</span><span class="op" id="5265813">(</span><span class="ident" id="5265814">header</span><span class="op" id="5265820">[</span><span class="ident" id="5265821">oldGNUSparseMainHeaderOffset</span><span class="op" id="5265849">:</span><span class="op" id="5265850">]</span><span class="op" id="5265851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5265855">//&nbsp;Read&nbsp;the&nbsp;four&nbsp;entries&nbsp;from&nbsp;the&nbsp;main&nbsp;tar&nbsp;header</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5265906">for</span>&nbsp;<span class="ident" id="5265910">i</span>&nbsp;<span class="op" id="5265912">:=</span>&nbsp;<span class="num" id="5265915">0</span><span class="op" id="5265916">;</span>&nbsp;<span class="ident" id="5265918">i</span>&nbsp;<span class="op" id="5265920">&lt;</span>&nbsp;<span class="ident" id="5265922">oldGNUSparseMainHeaderNumEntries</span><span class="op" id="5265954">;</span>&nbsp;<span class="ident" id="5265956">i</span><span class="op" id="5265957">++</span>&nbsp;<span class="op" id="5265960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5265964">offset</span>&nbsp;<span class="op" id="5265971">:=</span>&nbsp;<span class="ident" id="5265974">tr</span><span class="op" id="5265976">.</span><span class="ident" id="5265977">octal</span><span class="op" id="5265982">(</span><span class="ident" id="5265983">s</span><span class="op" id="5265984">.</span><span class="ident" id="5265985">next</span><span class="op" id="5265989">(</span><span class="ident" id="5265990">oldGNUSparseOffsetSize</span><span class="op" id="5266012">)</span><span class="op" id="5266013">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266017">numBytes</span>&nbsp;<span class="op" id="5266026">:=</span>&nbsp;<span class="ident" id="5266029">tr</span><span class="op" id="5266031">.</span><span class="ident" id="5266032">octal</span><span class="op" id="5266037">(</span><span class="ident" id="5266038">s</span><span class="op" id="5266039">.</span><span class="ident" id="5266040">next</span><span class="op" id="5266044">(</span><span class="ident" id="5266045">oldGNUSparseNumBytesSize</span><span class="op" id="5266069">)</span><span class="op" id="5266070">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266074">if</span>&nbsp;<span class="ident" id="5266077">tr</span><span class="op" id="5266079">.</span><span class="ident" id="5266080">err</span>&nbsp;<span class="op" id="5266084">!=</span>&nbsp;<span class="ident" id="5266087">nil</span>&nbsp;<span class="op" id="5266091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266096">tr</span><span class="op" id="5266098">.</span><span class="ident" id="5266099">err</span>&nbsp;<span class="op" id="5266103">=</span>&nbsp;<span class="ident" id="5266105">ErrHeader</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266118">return</span>&nbsp;<span class="ident" id="5266125">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266131">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266135">if</span>&nbsp;<span class="ident" id="5266138">offset</span>&nbsp;<span class="op" id="5266145">==</span>&nbsp;<span class="num" id="5266148">0</span>&nbsp;<span class="op" id="5266150">&amp;&amp;</span>&nbsp;<span class="ident" id="5266153">numBytes</span>&nbsp;<span class="op" id="5266162">==</span>&nbsp;<span class="num" id="5266165">0</span>&nbsp;<span class="op" id="5266167">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266172">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266180">}</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266184">sp</span>&nbsp;<span class="op" id="5266187">=</span>&nbsp;<span class="builtinfunc" id="5266189">append</span><span class="op" id="5266195">(</span><span class="ident" id="5266196">sp</span><span class="op" id="5266198">,</span>&nbsp;<span class="ident" id="5266200">sparseEntry</span><span class="op" id="5266211">{</span><span class="ident" id="5266212">offset</span><span class="op" id="5266218">:</span>&nbsp;<span class="ident" id="5266220">offset</span><span class="op" id="5266226">,</span>&nbsp;<span class="ident" id="5266228">numBytes</span><span class="op" id="5266236">:</span>&nbsp;<span class="ident" id="5266238">numBytes</span><span class="op" id="5266246">}</span><span class="op" id="5266247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266254">for</span>&nbsp;<span class="ident" id="5266258">isExtended</span>&nbsp;<span class="op" id="5266269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5266273">//&nbsp;There&nbsp;are&nbsp;more&nbsp;entries.&nbsp;Read&nbsp;an&nbsp;extension&nbsp;header&nbsp;and&nbsp;parse&nbsp;its&nbsp;entries.</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266350">sparseHeader</span>&nbsp;<span class="op" id="5266363">:=</span>&nbsp;<span class="builtinfunc" id="5266366">make</span><span class="op" id="5266370">(</span><span class="op" id="5266371">[</span><span class="op" id="5266372">]</span><span class="builtintype" id="5266373">byte</span><span class="op" id="5266377">,</span>&nbsp;<span class="ident" id="5266379">blockSize</span><span class="op" id="5266388">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266392">if</span>&nbsp;<span class="ident" id="5266395">_</span><span class="op" id="5266396">,</span>&nbsp;<span class="ident" id="5266398">tr</span><span class="op" id="5266400">.</span><span class="ident" id="5266401">err</span>&nbsp;<span class="op" id="5266405">=</span>&nbsp;<span class="ident" id="5266407">io</span><span class="op" id="5266409">.</span><span class="ident" id="5266410">ReadFull</span><span class="op" id="5266418">(</span><span class="ident" id="5266419">tr</span><span class="op" id="5266421">.</span><span class="ident" id="5266422">r</span><span class="op" id="5266423">,</span>&nbsp;<span class="ident" id="5266425">sparseHeader</span><span class="op" id="5266437">)</span><span class="op" id="5266438">;</span>&nbsp;<span class="ident" id="5266440">tr</span><span class="op" id="5266442">.</span><span class="ident" id="5266443">err</span>&nbsp;<span class="op" id="5266447">!=</span>&nbsp;<span class="ident" id="5266450">nil</span>&nbsp;<span class="op" id="5266454">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266459">return</span>&nbsp;<span class="ident" id="5266466">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266476">isExtended</span>&nbsp;<span class="op" id="5266487">=</span>&nbsp;<span class="ident" id="5266489">sparseHeader</span><span class="op" id="5266501">[</span><span class="ident" id="5266502">oldGNUSparseExtendedHeaderIsExtendedOffset</span><span class="op" id="5266544">]</span>&nbsp;<span class="op" id="5266546">!=</span>&nbsp;<span class="num" id="5266549">0</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266553">s</span>&nbsp;<span class="op" id="5266555">=</span>&nbsp;<span class="ident" id="5266557">slicer</span><span class="op" id="5266563">(</span><span class="ident" id="5266564">sparseHeader</span><span class="op" id="5266576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266580">for</span>&nbsp;<span class="ident" id="5266584">i</span>&nbsp;<span class="op" id="5266586">:=</span>&nbsp;<span class="num" id="5266589">0</span><span class="op" id="5266590">;</span>&nbsp;<span class="ident" id="5266592">i</span>&nbsp;<span class="op" id="5266594">&lt;</span>&nbsp;<span class="ident" id="5266596">oldGNUSparseExtendedHeaderNumEntries</span><span class="op" id="5266632">;</span>&nbsp;<span class="ident" id="5266634">i</span><span class="op" id="5266635">++</span>&nbsp;<span class="op" id="5266638">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266643">offset</span>&nbsp;<span class="op" id="5266650">:=</span>&nbsp;<span class="ident" id="5266653">tr</span><span class="op" id="5266655">.</span><span class="ident" id="5266656">octal</span><span class="op" id="5266661">(</span><span class="ident" id="5266662">s</span><span class="op" id="5266663">.</span><span class="ident" id="5266664">next</span><span class="op" id="5266668">(</span><span class="ident" id="5266669">oldGNUSparseOffsetSize</span><span class="op" id="5266691">)</span><span class="op" id="5266692">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266697">numBytes</span>&nbsp;<span class="op" id="5266706">:=</span>&nbsp;<span class="ident" id="5266709">tr</span><span class="op" id="5266711">.</span><span class="ident" id="5266712">octal</span><span class="op" id="5266717">(</span><span class="ident" id="5266718">s</span><span class="op" id="5266719">.</span><span class="ident" id="5266720">next</span><span class="op" id="5266724">(</span><span class="ident" id="5266725">oldGNUSparseNumBytesSize</span><span class="op" id="5266749">)</span><span class="op" id="5266750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266755">if</span>&nbsp;<span class="ident" id="5266758">tr</span><span class="op" id="5266760">.</span><span class="ident" id="5266761">err</span>&nbsp;<span class="op" id="5266765">!=</span>&nbsp;<span class="ident" id="5266768">nil</span>&nbsp;<span class="op" id="5266772">{</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266778">tr</span><span class="op" id="5266780">.</span><span class="ident" id="5266781">err</span>&nbsp;<span class="op" id="5266785">=</span>&nbsp;<span class="ident" id="5266787">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266801">return</span>&nbsp;<span class="ident" id="5266808">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266815">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266820">if</span>&nbsp;<span class="ident" id="5266823">offset</span>&nbsp;<span class="op" id="5266830">==</span>&nbsp;<span class="num" id="5266833">0</span>&nbsp;<span class="op" id="5266835">&amp;&amp;</span>&nbsp;<span class="ident" id="5266838">numBytes</span>&nbsp;<span class="op" id="5266847">==</span>&nbsp;<span class="num" id="5266850">0</span>&nbsp;<span class="op" id="5266852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266858">break</span><br>
<span class="lineno">590</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266867">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5266872">sp</span>&nbsp;<span class="op" id="5266875">=</span>&nbsp;<span class="builtinfunc" id="5266877">append</span><span class="op" id="5266883">(</span><span class="ident" id="5266884">sp</span><span class="op" id="5266886">,</span>&nbsp;<span class="ident" id="5266888">sparseEntry</span><span class="op" id="5266899">{</span><span class="ident" id="5266900">offset</span><span class="op" id="5266906">:</span>&nbsp;<span class="ident" id="5266908">offset</span><span class="op" id="5266914">,</span>&nbsp;<span class="ident" id="5266916">numBytes</span><span class="op" id="5266924">:</span>&nbsp;<span class="ident" id="5266926">numBytes</span><span class="op" id="5266934">}</span><span class="op" id="5266935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5266942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5266945">return</span>&nbsp;<span class="ident" id="5266952">sp</span><br>
<span class="lineno">595</span><span class="op" id="5266955">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5266958">//&nbsp;readGNUSparseMap1x0&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;1.0.</span><br>
<span class="lineno"></span><span class="comment" id="5267052">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;just&nbsp;before&nbsp;the&nbsp;file&nbsp;data&nbsp;and&nbsp;padded&nbsp;out&nbsp;to&nbsp;the&nbsp;nearest&nbsp;block&nbsp;boundary.</span><br>
<span class="lineno"></span><span class="keyword" id="5267152">func</span>&nbsp;<span class="ident" id="5267157">readGNUSparseMap1x0</span><span class="op" id="5267176">(</span><span class="ident" id="5267177">r</span>&nbsp;<span class="ident" id="5267179">io</span><span class="op" id="5267181">.</span><span class="ident" id="5267182">Reader</span><span class="op" id="5267188">)</span>&nbsp;<span class="op" id="5267190">(</span><span class="op" id="5267191">[</span><span class="op" id="5267192">]</span><span class="ident" id="5267193">sparseEntry</span><span class="op" id="5267204">,</span>&nbsp;<span class="builtintype" id="5267206">error</span><span class="op" id="5267211">)</span>&nbsp;<span class="op" id="5267213">{</span><br>
<span class="lineno">600</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267216">buf</span>&nbsp;<span class="op" id="5267220">:=</span>&nbsp;<span class="builtinfunc" id="5267223">make</span><span class="op" id="5267227">(</span><span class="op" id="5267228">[</span><span class="op" id="5267229">]</span><span class="builtintype" id="5267230">byte</span><span class="op" id="5267234">,</span>&nbsp;<span class="num" id="5267236">2</span><span class="op" id="5267237">*</span><span class="ident" id="5267238">blockSize</span><span class="op" id="5267247">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267250">sparseHeader</span>&nbsp;<span class="op" id="5267263">:=</span>&nbsp;<span class="ident" id="5267266">buf</span><span class="op" id="5267269">[</span><span class="op" id="5267270">:</span><span class="ident" id="5267271">blockSize</span><span class="op" id="5267280">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267284">//&nbsp;readDecimal&nbsp;is&nbsp;a&nbsp;helper&nbsp;function&nbsp;to&nbsp;read&nbsp;a&nbsp;decimal&nbsp;integer&nbsp;from&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267367">//&nbsp;while&nbsp;making&nbsp;sure&nbsp;to&nbsp;read&nbsp;from&nbsp;the&nbsp;file&nbsp;in&nbsp;blocks&nbsp;of&nbsp;size&nbsp;blockSize</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267439">readDecimal</span>&nbsp;<span class="op" id="5267451">:=</span>&nbsp;<span class="keyword" id="5267454">func</span><span class="op" id="5267458">(</span><span class="op" id="5267459">)</span>&nbsp;<span class="op" id="5267461">(</span><span class="ident" id="5267462">int64</span><span class="op" id="5267467">,</span>&nbsp;<span class="builtintype" id="5267469">error</span><span class="op" id="5267474">)</span>&nbsp;<span class="op" id="5267476">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267480">//&nbsp;Look&nbsp;for&nbsp;newline</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267502">nl</span>&nbsp;<span class="op" id="5267505">:=</span>&nbsp;<span class="ident" id="5267508">bytes</span><span class="op" id="5267513">.</span><span class="ident" id="5267514">IndexByte</span><span class="op" id="5267523">(</span><span class="ident" id="5267524">sparseHeader</span><span class="op" id="5267536">,</span>&nbsp;<span class="string" id="5267538">&#39;\n&#39;</span><span class="op" id="5267542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267546">if</span>&nbsp;<span class="ident" id="5267549">nl</span>&nbsp;<span class="op" id="5267552">==</span>&nbsp;<span class="op" id="5267555">-</span><span class="num" id="5267556">1</span>&nbsp;<span class="op" id="5267558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267563">if</span>&nbsp;<span class="builtinfunc" id="5267566">len</span><span class="op" id="5267569">(</span><span class="ident" id="5267570">sparseHeader</span><span class="op" id="5267582">)</span>&nbsp;<span class="op" id="5267584">&gt;=</span>&nbsp;<span class="ident" id="5267587">blockSize</span>&nbsp;<span class="op" id="5267597">{</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267603">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267627">return</span>&nbsp;<span class="num" id="5267634">0</span><span class="op" id="5267635">,</span>&nbsp;<span class="ident" id="5267637">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267650">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267655">oldLen</span>&nbsp;<span class="op" id="5267662">:=</span>&nbsp;<span class="builtinfunc" id="5267665">len</span><span class="op" id="5267668">(</span><span class="ident" id="5267669">sparseHeader</span><span class="op" id="5267681">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267686">newLen</span>&nbsp;<span class="op" id="5267693">:=</span>&nbsp;<span class="ident" id="5267696">oldLen</span>&nbsp;<span class="op" id="5267703">+</span>&nbsp;<span class="ident" id="5267705">blockSize</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5267718">if</span>&nbsp;<span class="builtinfunc" id="5267721">cap</span><span class="op" id="5267724">(</span><span class="ident" id="5267725">sparseHeader</span><span class="op" id="5267737">)</span>&nbsp;<span class="op" id="5267739">&lt;</span>&nbsp;<span class="ident" id="5267741">newLen</span>&nbsp;<span class="op" id="5267748">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267754">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;but&nbsp;we&nbsp;need&nbsp;to&nbsp;make&nbsp;room&nbsp;for&nbsp;the&nbsp;next&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5267826">copy</span><span class="op" id="5267830">(</span><span class="ident" id="5267831">buf</span><span class="op" id="5267834">,</span>&nbsp;<span class="ident" id="5267836">sparseHeader</span><span class="op" id="5267848">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267854">sparseHeader</span>&nbsp;<span class="op" id="5267867">=</span>&nbsp;<span class="ident" id="5267869">buf</span><span class="op" id="5267872">[</span><span class="op" id="5267873">:</span><span class="ident" id="5267874">newLen</span><span class="op" id="5267880">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267885">}</span>&nbsp;<span class="keyword" id="5267887">else</span>&nbsp;<span class="op" id="5267892">{</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267898">//&nbsp;There&#39;s&nbsp;more&nbsp;header,&nbsp;and&nbsp;we&nbsp;can&nbsp;just&nbsp;reslice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5267950">sparseHeader</span>&nbsp;<span class="op" id="5267963">=</span>&nbsp;<span class="ident" id="5267965">sparseHeader</span><span class="op" id="5267977">[</span><span class="op" id="5267978">:</span><span class="ident" id="5267979">newLen</span><span class="op" id="5267985">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5267990">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5267996">//&nbsp;Now&nbsp;that&nbsp;sparseHeader&nbsp;is&nbsp;large&nbsp;enough,&nbsp;read&nbsp;next&nbsp;block</span><br>
<span class="lineno">625</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268057">if</span>&nbsp;<span class="ident" id="5268060">_</span><span class="op" id="5268061">,</span>&nbsp;<span class="ident" id="5268063">err</span>&nbsp;<span class="op" id="5268067">:=</span>&nbsp;<span class="ident" id="5268070">io</span><span class="op" id="5268072">.</span><span class="ident" id="5268073">ReadFull</span><span class="op" id="5268081">(</span><span class="ident" id="5268082">r</span><span class="op" id="5268083">,</span>&nbsp;<span class="ident" id="5268085">sparseHeader</span><span class="op" id="5268097">[</span><span class="ident" id="5268098">oldLen</span><span class="op" id="5268104">:</span><span class="ident" id="5268105">newLen</span><span class="op" id="5268111">]</span><span class="op" id="5268112">)</span><span class="op" id="5268113">;</span>&nbsp;<span class="ident" id="5268115">err</span>&nbsp;<span class="op" id="5268119">!=</span>&nbsp;<span class="ident" id="5268122">nil</span>&nbsp;<span class="op" id="5268126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268132">return</span>&nbsp;<span class="num" id="5268139">0</span><span class="op" id="5268140">,</span>&nbsp;<span class="ident" id="5268142">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268155">//&nbsp;Look&nbsp;for&nbsp;a&nbsp;newline&nbsp;in&nbsp;the&nbsp;new&nbsp;data</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268196">nl</span>&nbsp;<span class="op" id="5268199">=</span>&nbsp;<span class="ident" id="5268201">bytes</span><span class="op" id="5268206">.</span><span class="ident" id="5268207">IndexByte</span><span class="op" id="5268216">(</span><span class="ident" id="5268217">sparseHeader</span><span class="op" id="5268229">[</span><span class="ident" id="5268230">oldLen</span><span class="op" id="5268236">:</span><span class="ident" id="5268237">newLen</span><span class="op" id="5268243">]</span><span class="op" id="5268244">,</span>&nbsp;<span class="string" id="5268246">&#39;\n&#39;</span><span class="op" id="5268250">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268255">if</span>&nbsp;<span class="ident" id="5268258">nl</span>&nbsp;<span class="op" id="5268261">==</span>&nbsp;<span class="op" id="5268264">-</span><span class="num" id="5268265">1</span>&nbsp;<span class="op" id="5268267">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268273">//&nbsp;This&nbsp;is&nbsp;an&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268297">return</span>&nbsp;<span class="num" id="5268304">0</span><span class="op" id="5268305">,</span>&nbsp;<span class="ident" id="5268307">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268320">}</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268325">nl</span>&nbsp;<span class="op" id="5268328">+=</span>&nbsp;<span class="ident" id="5268331">oldLen</span>&nbsp;<span class="comment" id="5268338">//&nbsp;We&nbsp;want&nbsp;the&nbsp;position&nbsp;from&nbsp;the&nbsp;beginning</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268383">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268387">//&nbsp;Now&nbsp;that&nbsp;we&#39;ve&nbsp;found&nbsp;a&nbsp;newline,&nbsp;read&nbsp;a&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268438">n</span><span class="op" id="5268439">,</span>&nbsp;<span class="ident" id="5268441">err</span>&nbsp;<span class="op" id="5268445">:=</span>&nbsp;<span class="ident" id="5268448">strconv</span><span class="op" id="5268455">.</span><span class="ident" id="5268456">ParseInt</span><span class="op" id="5268464">(</span><span class="builtintype" id="5268465">string</span><span class="op" id="5268471">(</span><span class="ident" id="5268472">sparseHeader</span><span class="op" id="5268484">[</span><span class="op" id="5268485">:</span><span class="ident" id="5268486">nl</span><span class="op" id="5268488">]</span><span class="op" id="5268489">)</span><span class="op" id="5268490">,</span>&nbsp;<span class="num" id="5268492">10</span><span class="op" id="5268494">,</span>&nbsp;<span class="num" id="5268496">0</span><span class="op" id="5268497">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268501">if</span>&nbsp;<span class="ident" id="5268504">err</span>&nbsp;<span class="op" id="5268508">!=</span>&nbsp;<span class="ident" id="5268511">nil</span>&nbsp;<span class="op" id="5268515">{</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268520">return</span>&nbsp;<span class="num" id="5268527">0</span><span class="op" id="5268528">,</span>&nbsp;<span class="ident" id="5268530">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268542">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268547">//&nbsp;Update&nbsp;sparseHeader&nbsp;to&nbsp;consume&nbsp;this&nbsp;number</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268595">sparseHeader</span>&nbsp;<span class="op" id="5268608">=</span>&nbsp;<span class="ident" id="5268610">sparseHeader</span><span class="op" id="5268622">[</span><span class="ident" id="5268623">nl</span><span class="op" id="5268625">+</span><span class="num" id="5268626">1</span><span class="op" id="5268627">:</span><span class="op" id="5268628">]</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268632">return</span>&nbsp;<span class="ident" id="5268639">n</span><span class="op" id="5268640">,</span>&nbsp;<span class="ident" id="5268642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268647">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268651">//&nbsp;Read&nbsp;the&nbsp;first&nbsp;block</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268676">if</span>&nbsp;<span class="ident" id="5268679">_</span><span class="op" id="5268680">,</span>&nbsp;<span class="ident" id="5268682">err</span>&nbsp;<span class="op" id="5268686">:=</span>&nbsp;<span class="ident" id="5268689">io</span><span class="op" id="5268691">.</span><span class="ident" id="5268692">ReadFull</span><span class="op" id="5268700">(</span><span class="ident" id="5268701">r</span><span class="op" id="5268702">,</span>&nbsp;<span class="ident" id="5268704">sparseHeader</span><span class="op" id="5268716">)</span><span class="op" id="5268717">;</span>&nbsp;<span class="ident" id="5268719">err</span>&nbsp;<span class="op" id="5268723">!=</span>&nbsp;<span class="ident" id="5268726">nil</span>&nbsp;<span class="op" id="5268730">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268734">return</span>&nbsp;<span class="ident" id="5268741">nil</span><span class="op" id="5268744">,</span>&nbsp;<span class="ident" id="5268746">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268751">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268755">//&nbsp;The&nbsp;first&nbsp;line&nbsp;contains&nbsp;the&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268805">numEntries</span><span class="op" id="5268815">,</span>&nbsp;<span class="ident" id="5268817">err</span>&nbsp;<span class="op" id="5268821">:=</span>&nbsp;<span class="ident" id="5268824">readDecimal</span><span class="op" id="5268835">(</span><span class="op" id="5268836">)</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268839">if</span>&nbsp;<span class="ident" id="5268842">err</span>&nbsp;<span class="op" id="5268846">!=</span>&nbsp;<span class="ident" id="5268849">nil</span>&nbsp;<span class="op" id="5268853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268857">return</span>&nbsp;<span class="ident" id="5268864">nil</span><span class="op" id="5268867">,</span>&nbsp;<span class="ident" id="5268869">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5268874">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268878">//&nbsp;Read&nbsp;all&nbsp;the&nbsp;entries</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5268903">sp</span>&nbsp;<span class="op" id="5268906">:=</span>&nbsp;<span class="builtinfunc" id="5268909">make</span><span class="op" id="5268913">(</span><span class="op" id="5268914">[</span><span class="op" id="5268915">]</span><span class="ident" id="5268916">sparseEntry</span><span class="op" id="5268927">,</span>&nbsp;<span class="num" id="5268929">0</span><span class="op" id="5268930">,</span>&nbsp;<span class="ident" id="5268932">numEntries</span><span class="op" id="5268942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5268945">for</span>&nbsp;<span class="ident" id="5268949">i</span>&nbsp;<span class="op" id="5268951">:=</span>&nbsp;<span class="ident" id="5268954">int64</span><span class="op" id="5268959">(</span><span class="num" id="5268960">0</span><span class="op" id="5268961">)</span><span class="op" id="5268962">;</span>&nbsp;<span class="ident" id="5268964">i</span>&nbsp;<span class="op" id="5268966">&lt;</span>&nbsp;<span class="ident" id="5268968">numEntries</span><span class="op" id="5268978">;</span>&nbsp;<span class="ident" id="5268980">i</span><span class="op" id="5268981">++</span>&nbsp;<span class="op" id="5268984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5268988">//&nbsp;Read&nbsp;the&nbsp;offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269009">offset</span><span class="op" id="5269015">,</span>&nbsp;<span class="ident" id="5269017">err</span>&nbsp;<span class="op" id="5269021">:=</span>&nbsp;<span class="ident" id="5269024">readDecimal</span><span class="op" id="5269035">(</span><span class="op" id="5269036">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269040">if</span>&nbsp;<span class="ident" id="5269043">err</span>&nbsp;<span class="op" id="5269047">!=</span>&nbsp;<span class="ident" id="5269050">nil</span>&nbsp;<span class="op" id="5269054">{</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269059">return</span>&nbsp;<span class="ident" id="5269066">nil</span><span class="op" id="5269069">,</span>&nbsp;<span class="ident" id="5269071">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269081">//&nbsp;Read&nbsp;numBytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269100">numBytes</span><span class="op" id="5269108">,</span>&nbsp;<span class="ident" id="5269110">err</span>&nbsp;<span class="op" id="5269114">:=</span>&nbsp;<span class="ident" id="5269117">readDecimal</span><span class="op" id="5269128">(</span><span class="op" id="5269129">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269133">if</span>&nbsp;<span class="ident" id="5269136">err</span>&nbsp;<span class="op" id="5269140">!=</span>&nbsp;<span class="ident" id="5269143">nil</span>&nbsp;<span class="op" id="5269147">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269152">return</span>&nbsp;<span class="ident" id="5269159">nil</span><span class="op" id="5269162">,</span>&nbsp;<span class="ident" id="5269164">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269170">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269175">sp</span>&nbsp;<span class="op" id="5269178">=</span>&nbsp;<span class="builtinfunc" id="5269180">append</span><span class="op" id="5269186">(</span><span class="ident" id="5269187">sp</span><span class="op" id="5269189">,</span>&nbsp;<span class="ident" id="5269191">sparseEntry</span><span class="op" id="5269202">{</span><span class="ident" id="5269203">offset</span><span class="op" id="5269209">:</span>&nbsp;<span class="ident" id="5269211">offset</span><span class="op" id="5269217">,</span>&nbsp;<span class="ident" id="5269219">numBytes</span><span class="op" id="5269227">:</span>&nbsp;<span class="ident" id="5269229">numBytes</span><span class="op" id="5269237">}</span><span class="op" id="5269238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269241">}</span><br>
<span class="lineno">675</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269245">return</span>&nbsp;<span class="ident" id="5269252">sp</span><span class="op" id="5269254">,</span>&nbsp;<span class="ident" id="5269256">nil</span><br>
<span class="lineno"></span><span class="op" id="5269260">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5269263">//&nbsp;readGNUSparseMap0x1&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;map&nbsp;as&nbsp;stored&nbsp;in&nbsp;GNU&#39;s&nbsp;PAX&nbsp;sparse&nbsp;format&nbsp;version&nbsp;0.1.</span><br>
<span class="lineno">680</span><span class="comment" id="5269357">//&nbsp;The&nbsp;sparse&nbsp;map&nbsp;is&nbsp;stored&nbsp;in&nbsp;the&nbsp;PAX&nbsp;headers.</span><br>
<span class="lineno"></span><span class="keyword" id="5269405">func</span>&nbsp;<span class="ident" id="5269410">readGNUSparseMap0x1</span><span class="op" id="5269429">(</span><span class="ident" id="5269430">headers</span>&nbsp;<span class="keyword" id="5269438">map</span><span class="op" id="5269441">[</span><span class="builtintype" id="5269442">string</span><span class="op" id="5269448">]</span><span class="builtintype" id="5269449">string</span><span class="op" id="5269455">)</span>&nbsp;<span class="op" id="5269457">(</span><span class="op" id="5269458">[</span><span class="op" id="5269459">]</span><span class="ident" id="5269460">sparseEntry</span><span class="op" id="5269471">,</span>&nbsp;<span class="builtintype" id="5269473">error</span><span class="op" id="5269478">)</span>&nbsp;<span class="op" id="5269480">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269483">//&nbsp;Get&nbsp;number&nbsp;of&nbsp;entries</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269509">numEntriesStr</span><span class="op" id="5269522">,</span>&nbsp;<span class="ident" id="5269524">ok</span>&nbsp;<span class="op" id="5269527">:=</span>&nbsp;<span class="ident" id="5269530">headers</span><span class="op" id="5269537">[</span><span class="ident" id="5269538">paxGNUSparseNumBlocks</span><span class="op" id="5269559">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269562">if</span>&nbsp;<span class="op" id="5269565">!</span><span class="ident" id="5269566">ok</span>&nbsp;<span class="op" id="5269569">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269573">return</span>&nbsp;<span class="ident" id="5269580">nil</span><span class="op" id="5269583">,</span>&nbsp;<span class="ident" id="5269585">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269596">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269599">numEntries</span><span class="op" id="5269609">,</span>&nbsp;<span class="ident" id="5269611">err</span>&nbsp;<span class="op" id="5269615">:=</span>&nbsp;<span class="ident" id="5269618">strconv</span><span class="op" id="5269625">.</span><span class="ident" id="5269626">ParseInt</span><span class="op" id="5269634">(</span><span class="ident" id="5269635">numEntriesStr</span><span class="op" id="5269648">,</span>&nbsp;<span class="num" id="5269650">10</span><span class="op" id="5269652">,</span>&nbsp;<span class="num" id="5269654">0</span><span class="op" id="5269655">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269658">if</span>&nbsp;<span class="ident" id="5269661">err</span>&nbsp;<span class="op" id="5269665">!=</span>&nbsp;<span class="ident" id="5269668">nil</span>&nbsp;<span class="op" id="5269672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269676">return</span>&nbsp;<span class="ident" id="5269683">nil</span><span class="op" id="5269686">,</span>&nbsp;<span class="ident" id="5269688">ErrHeader</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269703">sparseMap</span>&nbsp;<span class="op" id="5269713">:=</span>&nbsp;<span class="ident" id="5269716">strings</span><span class="op" id="5269723">.</span><span class="ident" id="5269724">Split</span><span class="op" id="5269729">(</span><span class="ident" id="5269730">headers</span><span class="op" id="5269737">[</span><span class="ident" id="5269738">paxGNUSparseMap</span><span class="op" id="5269753">]</span><span class="op" id="5269754">,</span>&nbsp;<span class="string" id="5269756">&#34;,&#34;</span><span class="op" id="5269759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269763">//&nbsp;There&nbsp;should&nbsp;be&nbsp;two&nbsp;numbers&nbsp;in&nbsp;sparseMap&nbsp;for&nbsp;each&nbsp;entry</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269823">if</span>&nbsp;<span class="ident" id="5269826">int64</span><span class="op" id="5269831">(</span><span class="builtinfunc" id="5269832">len</span><span class="op" id="5269835">(</span><span class="ident" id="5269836">sparseMap</span><span class="op" id="5269845">)</span><span class="op" id="5269846">)</span>&nbsp;<span class="op" id="5269848">!=</span>&nbsp;<span class="num" id="5269851">2</span><span class="op" id="5269852">*</span><span class="ident" id="5269853">numEntries</span>&nbsp;<span class="op" id="5269864">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269868">return</span>&nbsp;<span class="ident" id="5269875">nil</span><span class="op" id="5269878">,</span>&nbsp;<span class="ident" id="5269880">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5269891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5269895">//&nbsp;Loop&nbsp;through&nbsp;the&nbsp;entries&nbsp;in&nbsp;the&nbsp;sparse&nbsp;map</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5269942">sp</span>&nbsp;<span class="op" id="5269945">:=</span>&nbsp;<span class="builtinfunc" id="5269948">make</span><span class="op" id="5269952">(</span><span class="op" id="5269953">[</span><span class="op" id="5269954">]</span><span class="ident" id="5269955">sparseEntry</span><span class="op" id="5269966">,</span>&nbsp;<span class="num" id="5269968">0</span><span class="op" id="5269969">,</span>&nbsp;<span class="ident" id="5269971">numEntries</span><span class="op" id="5269981">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5269984">for</span>&nbsp;<span class="ident" id="5269988">i</span>&nbsp;<span class="op" id="5269990">:=</span>&nbsp;<span class="ident" id="5269993">int64</span><span class="op" id="5269998">(</span><span class="num" id="5269999">0</span><span class="op" id="5270000">)</span><span class="op" id="5270001">;</span>&nbsp;<span class="ident" id="5270003">i</span>&nbsp;<span class="op" id="5270005">&lt;</span>&nbsp;<span class="ident" id="5270007">numEntries</span><span class="op" id="5270017">;</span>&nbsp;<span class="ident" id="5270019">i</span><span class="op" id="5270020">++</span>&nbsp;<span class="op" id="5270023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270027">offset</span><span class="op" id="5270033">,</span>&nbsp;<span class="ident" id="5270035">err</span>&nbsp;<span class="op" id="5270039">:=</span>&nbsp;<span class="ident" id="5270042">strconv</span><span class="op" id="5270049">.</span><span class="ident" id="5270050">ParseInt</span><span class="op" id="5270058">(</span><span class="ident" id="5270059">sparseMap</span><span class="op" id="5270068">[</span><span class="num" id="5270069">2</span><span class="op" id="5270070">*</span><span class="ident" id="5270071">i</span><span class="op" id="5270072">]</span><span class="op" id="5270073">,</span>&nbsp;<span class="num" id="5270075">10</span><span class="op" id="5270077">,</span>&nbsp;<span class="num" id="5270079">0</span><span class="op" id="5270080">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270084">if</span>&nbsp;<span class="ident" id="5270087">err</span>&nbsp;<span class="op" id="5270091">!=</span>&nbsp;<span class="ident" id="5270094">nil</span>&nbsp;<span class="op" id="5270098">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270103">return</span>&nbsp;<span class="ident" id="5270110">nil</span><span class="op" id="5270113">,</span>&nbsp;<span class="ident" id="5270115">ErrHeader</span><br>
<span class="lineno">705</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270127">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270131">numBytes</span><span class="op" id="5270139">,</span>&nbsp;<span class="ident" id="5270141">err</span>&nbsp;<span class="op" id="5270145">:=</span>&nbsp;<span class="ident" id="5270148">strconv</span><span class="op" id="5270155">.</span><span class="ident" id="5270156">ParseInt</span><span class="op" id="5270164">(</span><span class="ident" id="5270165">sparseMap</span><span class="op" id="5270174">[</span><span class="num" id="5270175">2</span><span class="op" id="5270176">*</span><span class="ident" id="5270177">i</span><span class="op" id="5270178">+</span><span class="num" id="5270179">1</span><span class="op" id="5270180">]</span><span class="op" id="5270181">,</span>&nbsp;<span class="num" id="5270183">10</span><span class="op" id="5270185">,</span>&nbsp;<span class="num" id="5270187">0</span><span class="op" id="5270188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270192">if</span>&nbsp;<span class="ident" id="5270195">err</span>&nbsp;<span class="op" id="5270199">!=</span>&nbsp;<span class="ident" id="5270202">nil</span>&nbsp;<span class="op" id="5270206">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270211">return</span>&nbsp;<span class="ident" id="5270218">nil</span><span class="op" id="5270221">,</span>&nbsp;<span class="ident" id="5270223">ErrHeader</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270235">}</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270239">sp</span>&nbsp;<span class="op" id="5270242">=</span>&nbsp;<span class="builtinfunc" id="5270244">append</span><span class="op" id="5270250">(</span><span class="ident" id="5270251">sp</span><span class="op" id="5270253">,</span>&nbsp;<span class="ident" id="5270255">sparseEntry</span><span class="op" id="5270266">{</span><span class="ident" id="5270267">offset</span><span class="op" id="5270273">:</span>&nbsp;<span class="ident" id="5270275">offset</span><span class="op" id="5270281">,</span>&nbsp;<span class="ident" id="5270283">numBytes</span><span class="op" id="5270291">:</span>&nbsp;<span class="ident" id="5270293">numBytes</span><span class="op" id="5270301">}</span><span class="op" id="5270302">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270305">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270309">return</span>&nbsp;<span class="ident" id="5270316">sp</span><span class="op" id="5270318">,</span>&nbsp;<span class="ident" id="5270320">nil</span><br>
<span class="lineno"></span><span class="op" id="5270324">}</span><br>
<span class="lineno">715</span><br>
<span class="lineno"></span><span class="comment" id="5270327">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;current&nbsp;file&#39;s&nbsp;entry</span><br>
<span class="lineno"></span><span class="comment" id="5270408">//&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive,&nbsp;or&nbsp;0&nbsp;if&nbsp;there&nbsp;is&nbsp;no&nbsp;current&nbsp;file.</span><br>
<span class="lineno"></span><span class="keyword" id="5270465">func</span>&nbsp;<span class="op" id="5270470">(</span><span class="ident" id="5270471">tr</span>&nbsp;<span class="op" id="5270474">*</span><span class="ident" id="5270475">Reader</span><span class="op" id="5270481">)</span>&nbsp;<span class="ident" id="5270483">numBytes</span><span class="op" id="5270491">(</span><span class="op" id="5270492">)</span>&nbsp;<span class="ident" id="5270494">int64</span>&nbsp;<span class="op" id="5270500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270503">if</span>&nbsp;<span class="ident" id="5270506">tr</span><span class="op" id="5270508">.</span><span class="ident" id="5270509">curr</span>&nbsp;<span class="op" id="5270514">==</span>&nbsp;<span class="ident" id="5270517">nil</span>&nbsp;<span class="op" id="5270521">{</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5270525">//&nbsp;No&nbsp;current&nbsp;file,&nbsp;so&nbsp;no&nbsp;bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270559">return</span>&nbsp;<span class="num" id="5270566">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270569">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270572">return</span>&nbsp;<span class="ident" id="5270579">tr</span><span class="op" id="5270581">.</span><span class="ident" id="5270582">curr</span><span class="op" id="5270586">.</span><span class="ident" id="5270587">numBytes</span><span class="op" id="5270595">(</span><span class="op" id="5270596">)</span><br>
<span class="lineno"></span><span class="op" id="5270598">}</span><br>
<span class="lineno">725</span><br>
<span class="lineno"></span><span class="comment" id="5270601">//&nbsp;Read&nbsp;reads&nbsp;from&nbsp;the&nbsp;current&nbsp;entry&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="comment" id="5270658">//&nbsp;It&nbsp;returns&nbsp;0,&nbsp;io.EOF&nbsp;when&nbsp;it&nbsp;reaches&nbsp;the&nbsp;end&nbsp;of&nbsp;that&nbsp;entry,</span><br>
<span class="lineno"></span><span class="comment" id="5270721">//&nbsp;until&nbsp;Next&nbsp;is&nbsp;called&nbsp;to&nbsp;advance&nbsp;to&nbsp;the&nbsp;next&nbsp;entry.</span><br>
<span class="lineno"></span><span class="keyword" id="5270775">func</span>&nbsp;<span class="op" id="5270780">(</span><span class="ident" id="5270781">tr</span>&nbsp;<span class="op" id="5270784">*</span><span class="ident" id="5270785">Reader</span><span class="op" id="5270791">)</span>&nbsp;<span class="ident" id="5270793">Read</span><span class="op" id="5270797">(</span><span class="ident" id="5270798">b</span>&nbsp;<span class="op" id="5270800">[</span><span class="op" id="5270801">]</span><span class="builtintype" id="5270802">byte</span><span class="op" id="5270806">)</span>&nbsp;<span class="op" id="5270808">(</span><span class="ident" id="5270809">n</span>&nbsp;<span class="builtintype" id="5270811">int</span><span class="op" id="5270814">,</span>&nbsp;<span class="ident" id="5270816">err</span>&nbsp;<span class="builtintype" id="5270820">error</span><span class="op" id="5270825">)</span>&nbsp;<span class="op" id="5270827">{</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270830">if</span>&nbsp;<span class="ident" id="5270833">tr</span><span class="op" id="5270835">.</span><span class="ident" id="5270836">curr</span>&nbsp;<span class="op" id="5270841">==</span>&nbsp;<span class="ident" id="5270844">nil</span>&nbsp;<span class="op" id="5270848">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270852">return</span>&nbsp;<span class="num" id="5270859">0</span><span class="op" id="5270860">,</span>&nbsp;<span class="ident" id="5270862">io</span><span class="op" id="5270864">.</span><span class="ident" id="5270865">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270870">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270873">n</span><span class="op" id="5270874">,</span>&nbsp;<span class="ident" id="5270876">err</span>&nbsp;<span class="op" id="5270880">=</span>&nbsp;<span class="ident" id="5270882">tr</span><span class="op" id="5270884">.</span><span class="ident" id="5270885">curr</span><span class="op" id="5270889">.</span><span class="ident" id="5270890">Read</span><span class="op" id="5270894">(</span><span class="ident" id="5270895">b</span><span class="op" id="5270896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270899">if</span>&nbsp;<span class="ident" id="5270902">err</span>&nbsp;<span class="op" id="5270906">!=</span>&nbsp;<span class="ident" id="5270909">nil</span>&nbsp;<span class="op" id="5270913">&amp;&amp;</span>&nbsp;<span class="ident" id="5270916">err</span>&nbsp;<span class="op" id="5270920">!=</span>&nbsp;<span class="ident" id="5270923">io</span><span class="op" id="5270925">.</span><span class="ident" id="5270926">EOF</span>&nbsp;<span class="op" id="5270930">{</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5270934">tr</span><span class="op" id="5270936">.</span><span class="ident" id="5270937">err</span>&nbsp;<span class="op" id="5270941">=</span>&nbsp;<span class="ident" id="5270943">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5270948">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5270951">return</span><br>
<span class="lineno"></span><span class="op" id="5270958">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">740</span><span class="keyword" id="5270961">func</span>&nbsp;<span class="op" id="5270966">(</span><span class="ident" id="5270967">rfr</span>&nbsp;<span class="op" id="5270971">*</span><span class="ident" id="5270972">regFileReader</span><span class="op" id="5270985">)</span>&nbsp;<span class="ident" id="5270987">Read</span><span class="op" id="5270991">(</span><span class="ident" id="5270992">b</span>&nbsp;<span class="op" id="5270994">[</span><span class="op" id="5270995">]</span><span class="builtintype" id="5270996">byte</span><span class="op" id="5271000">)</span>&nbsp;<span class="op" id="5271002">(</span><span class="ident" id="5271003">n</span>&nbsp;<span class="builtintype" id="5271005">int</span><span class="op" id="5271008">,</span>&nbsp;<span class="ident" id="5271010">err</span>&nbsp;<span class="builtintype" id="5271014">error</span><span class="op" id="5271019">)</span>&nbsp;<span class="op" id="5271021">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271024">if</span>&nbsp;<span class="ident" id="5271027">rfr</span><span class="op" id="5271030">.</span><span class="ident" id="5271031">nb</span>&nbsp;<span class="op" id="5271034">==</span>&nbsp;<span class="num" id="5271037">0</span>&nbsp;<span class="op" id="5271039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271043">//&nbsp;file&nbsp;consumed</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271062">return</span>&nbsp;<span class="num" id="5271069">0</span><span class="op" id="5271070">,</span>&nbsp;<span class="ident" id="5271072">io</span><span class="op" id="5271074">.</span><span class="ident" id="5271075">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271080">}</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271083">if</span>&nbsp;<span class="ident" id="5271086">int64</span><span class="op" id="5271091">(</span><span class="builtinfunc" id="5271092">len</span><span class="op" id="5271095">(</span><span class="ident" id="5271096">b</span><span class="op" id="5271097">)</span><span class="op" id="5271098">)</span>&nbsp;<span class="op" id="5271100">&gt;</span>&nbsp;<span class="ident" id="5271102">rfr</span><span class="op" id="5271105">.</span><span class="ident" id="5271106">nb</span>&nbsp;<span class="op" id="5271109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271113">b</span>&nbsp;<span class="op" id="5271115">=</span>&nbsp;<span class="ident" id="5271117">b</span><span class="op" id="5271118">[</span><span class="num" id="5271119">0</span><span class="op" id="5271120">:</span><span class="ident" id="5271121">rfr</span><span class="op" id="5271124">.</span><span class="ident" id="5271125">nb</span><span class="op" id="5271127">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271130">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271133">n</span><span class="op" id="5271134">,</span>&nbsp;<span class="ident" id="5271136">err</span>&nbsp;<span class="op" id="5271140">=</span>&nbsp;<span class="ident" id="5271142">rfr</span><span class="op" id="5271145">.</span><span class="ident" id="5271146">r</span><span class="op" id="5271147">.</span><span class="ident" id="5271148">Read</span><span class="op" id="5271152">(</span><span class="ident" id="5271153">b</span><span class="op" id="5271154">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271157">rfr</span><span class="op" id="5271160">.</span><span class="ident" id="5271161">nb</span>&nbsp;<span class="op" id="5271164">-=</span>&nbsp;<span class="ident" id="5271167">int64</span><span class="op" id="5271172">(</span><span class="ident" id="5271173">n</span><span class="op" id="5271174">)</span><br>
<span class="lineno">750</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271178">if</span>&nbsp;<span class="ident" id="5271181">err</span>&nbsp;<span class="op" id="5271185">==</span>&nbsp;<span class="ident" id="5271188">io</span><span class="op" id="5271190">.</span><span class="ident" id="5271191">EOF</span>&nbsp;<span class="op" id="5271195">&amp;&amp;</span>&nbsp;<span class="ident" id="5271198">rfr</span><span class="op" id="5271201">.</span><span class="ident" id="5271202">nb</span>&nbsp;<span class="op" id="5271205">&gt;</span>&nbsp;<span class="num" id="5271207">0</span>&nbsp;<span class="op" id="5271209">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271213">err</span>&nbsp;<span class="op" id="5271217">=</span>&nbsp;<span class="ident" id="5271219">io</span><span class="op" id="5271221">.</span><span class="ident" id="5271222">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271240">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271243">return</span><br>
<span class="lineno">755</span><span class="op" id="5271250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5271253">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;file&#39;s&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5271345">func</span>&nbsp;<span class="op" id="5271350">(</span><span class="ident" id="5271351">rfr</span>&nbsp;<span class="op" id="5271355">*</span><span class="ident" id="5271356">regFileReader</span><span class="op" id="5271369">)</span>&nbsp;<span class="ident" id="5271371">numBytes</span><span class="op" id="5271379">(</span><span class="op" id="5271380">)</span>&nbsp;<span class="ident" id="5271382">int64</span>&nbsp;<span class="op" id="5271388">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271391">return</span>&nbsp;<span class="ident" id="5271398">rfr</span><span class="op" id="5271401">.</span><span class="ident" id="5271402">nb</span><br>
<span class="lineno">760</span><span class="op" id="5271405">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5271408">//&nbsp;readHole&nbsp;reads&nbsp;a&nbsp;sparse&nbsp;file&nbsp;hole&nbsp;ending&nbsp;at&nbsp;offset&nbsp;toOffset</span><br>
<span class="lineno"></span><span class="keyword" id="5271471">func</span>&nbsp;<span class="op" id="5271476">(</span><span class="ident" id="5271477">sfr</span>&nbsp;<span class="op" id="5271481">*</span><span class="ident" id="5271482">sparseFileReader</span><span class="op" id="5271498">)</span>&nbsp;<span class="ident" id="5271500">readHole</span><span class="op" id="5271508">(</span><span class="ident" id="5271509">b</span>&nbsp;<span class="op" id="5271511">[</span><span class="op" id="5271512">]</span><span class="builtintype" id="5271513">byte</span><span class="op" id="5271517">,</span>&nbsp;<span class="ident" id="5271519">toOffset</span>&nbsp;<span class="ident" id="5271528">int64</span><span class="op" id="5271533">)</span>&nbsp;<span class="builtintype" id="5271535">int</span>&nbsp;<span class="op" id="5271539">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271542">n64</span>&nbsp;<span class="op" id="5271546">:=</span>&nbsp;<span class="ident" id="5271549">toOffset</span>&nbsp;<span class="op" id="5271558">-</span>&nbsp;<span class="ident" id="5271560">sfr</span><span class="op" id="5271563">.</span><span class="ident" id="5271564">pos</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271569">if</span>&nbsp;<span class="ident" id="5271572">n64</span>&nbsp;<span class="op" id="5271576">&gt;</span>&nbsp;<span class="ident" id="5271578">int64</span><span class="op" id="5271583">(</span><span class="builtinfunc" id="5271584">len</span><span class="op" id="5271587">(</span><span class="ident" id="5271588">b</span><span class="op" id="5271589">)</span><span class="op" id="5271590">)</span>&nbsp;<span class="op" id="5271592">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271596">n64</span>&nbsp;<span class="op" id="5271600">=</span>&nbsp;<span class="ident" id="5271602">int64</span><span class="op" id="5271607">(</span><span class="builtinfunc" id="5271608">len</span><span class="op" id="5271611">(</span><span class="ident" id="5271612">b</span><span class="op" id="5271613">)</span><span class="op" id="5271614">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271617">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271620">n</span>&nbsp;<span class="op" id="5271622">:=</span>&nbsp;<span class="builtintype" id="5271625">int</span><span class="op" id="5271628">(</span><span class="ident" id="5271629">n64</span><span class="op" id="5271632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271635">for</span>&nbsp;<span class="ident" id="5271639">i</span>&nbsp;<span class="op" id="5271641">:=</span>&nbsp;<span class="num" id="5271644">0</span><span class="op" id="5271645">;</span>&nbsp;<span class="ident" id="5271647">i</span>&nbsp;<span class="op" id="5271649">&lt;</span>&nbsp;<span class="ident" id="5271651">n</span><span class="op" id="5271652">;</span>&nbsp;<span class="ident" id="5271654">i</span><span class="op" id="5271655">++</span>&nbsp;<span class="op" id="5271658">{</span><br>
<span class="lineno">770</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271662">b</span><span class="op" id="5271663">[</span><span class="ident" id="5271664">i</span><span class="op" id="5271665">]</span>&nbsp;<span class="op" id="5271667">=</span>&nbsp;<span class="num" id="5271669">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271675">sfr</span><span class="op" id="5271678">.</span><span class="ident" id="5271679">pos</span>&nbsp;<span class="op" id="5271683">+=</span>&nbsp;<span class="ident" id="5271686">n64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271691">return</span>&nbsp;<span class="ident" id="5271698">n</span><br>
<span class="lineno"></span><span class="op" id="5271700">}</span><br>
<span class="lineno">775</span><br>
<span class="lineno"></span><span class="comment" id="5271703">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;sparse&nbsp;file&nbsp;data&nbsp;in&nbsp;expanded&nbsp;form.</span><br>
<span class="lineno"></span><span class="keyword" id="5271756">func</span>&nbsp;<span class="op" id="5271761">(</span><span class="ident" id="5271762">sfr</span>&nbsp;<span class="op" id="5271766">*</span><span class="ident" id="5271767">sparseFileReader</span><span class="op" id="5271783">)</span>&nbsp;<span class="ident" id="5271785">Read</span><span class="op" id="5271789">(</span><span class="ident" id="5271790">b</span>&nbsp;<span class="op" id="5271792">[</span><span class="op" id="5271793">]</span><span class="builtintype" id="5271794">byte</span><span class="op" id="5271798">)</span>&nbsp;<span class="op" id="5271800">(</span><span class="ident" id="5271801">n</span>&nbsp;<span class="builtintype" id="5271803">int</span><span class="op" id="5271806">,</span>&nbsp;<span class="ident" id="5271808">err</span>&nbsp;<span class="builtintype" id="5271812">error</span><span class="op" id="5271817">)</span>&nbsp;<span class="op" id="5271819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271822">if</span>&nbsp;<span class="builtinfunc" id="5271825">len</span><span class="op" id="5271828">(</span><span class="ident" id="5271829">sfr</span><span class="op" id="5271832">.</span><span class="ident" id="5271833">sp</span><span class="op" id="5271835">)</span>&nbsp;<span class="op" id="5271837">==</span>&nbsp;<span class="num" id="5271840">0</span>&nbsp;<span class="op" id="5271842">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271846">//&nbsp;No&nbsp;more&nbsp;data&nbsp;fragments&nbsp;to&nbsp;read&nbsp;from.</span><br>
<span class="lineno">780</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271888">if</span>&nbsp;<span class="ident" id="5271891">sfr</span><span class="op" id="5271894">.</span><span class="ident" id="5271895">pos</span>&nbsp;<span class="op" id="5271899">&lt;</span>&nbsp;<span class="ident" id="5271901">sfr</span><span class="op" id="5271904">.</span><span class="ident" id="5271905">tot</span>&nbsp;<span class="op" id="5271909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271914">//&nbsp;We&#39;re&nbsp;in&nbsp;the&nbsp;last&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5271943">n</span>&nbsp;<span class="op" id="5271945">=</span>&nbsp;<span class="ident" id="5271947">sfr</span><span class="op" id="5271950">.</span><span class="ident" id="5271951">readHole</span><span class="op" id="5271959">(</span><span class="ident" id="5271960">b</span><span class="op" id="5271961">,</span>&nbsp;<span class="ident" id="5271963">sfr</span><span class="op" id="5271966">.</span><span class="ident" id="5271967">tot</span><span class="op" id="5271970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5271975">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5271984">}</span><br>
<span class="lineno">785</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5271988">//&nbsp;Otherwise,&nbsp;we&#39;re&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272033">return</span>&nbsp;<span class="num" id="5272040">0</span><span class="op" id="5272041">,</span>&nbsp;<span class="ident" id="5272043">io</span><span class="op" id="5272045">.</span><span class="ident" id="5272046">EOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272051">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272054">if</span>&nbsp;<span class="ident" id="5272057">sfr</span><span class="op" id="5272060">.</span><span class="ident" id="5272061">pos</span>&nbsp;<span class="op" id="5272065">&lt;</span>&nbsp;<span class="ident" id="5272067">sfr</span><span class="op" id="5272070">.</span><span class="ident" id="5272071">sp</span><span class="op" id="5272073">[</span><span class="num" id="5272074">0</span><span class="op" id="5272075">]</span><span class="op" id="5272076">.</span><span class="ident" id="5272077">offset</span>&nbsp;<span class="op" id="5272084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5272088">//&nbsp;We&#39;re&nbsp;in&nbsp;a&nbsp;hole</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272109">n</span>&nbsp;<span class="op" id="5272111">=</span>&nbsp;<span class="ident" id="5272113">sfr</span><span class="op" id="5272116">.</span><span class="ident" id="5272117">readHole</span><span class="op" id="5272125">(</span><span class="ident" id="5272126">b</span><span class="op" id="5272127">,</span>&nbsp;<span class="ident" id="5272129">sfr</span><span class="op" id="5272132">.</span><span class="ident" id="5272133">sp</span><span class="op" id="5272135">[</span><span class="num" id="5272136">0</span><span class="op" id="5272137">]</span><span class="op" id="5272138">.</span><span class="ident" id="5272139">offset</span><span class="op" id="5272145">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272149">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272157">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5272161">//&nbsp;We&#39;re&nbsp;not&nbsp;in&nbsp;a&nbsp;hole,&nbsp;so&nbsp;we&#39;ll&nbsp;read&nbsp;from&nbsp;the&nbsp;next&nbsp;data&nbsp;fragment</span><br>
<span class="lineno">795</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272228">posInFragment</span>&nbsp;<span class="op" id="5272242">:=</span>&nbsp;<span class="ident" id="5272245">sfr</span><span class="op" id="5272248">.</span><span class="ident" id="5272249">pos</span>&nbsp;<span class="op" id="5272253">-</span>&nbsp;<span class="ident" id="5272255">sfr</span><span class="op" id="5272258">.</span><span class="ident" id="5272259">sp</span><span class="op" id="5272261">[</span><span class="num" id="5272262">0</span><span class="op" id="5272263">]</span><span class="op" id="5272264">.</span><span class="ident" id="5272265">offset</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272273">bytesLeft</span>&nbsp;<span class="op" id="5272283">:=</span>&nbsp;<span class="ident" id="5272286">sfr</span><span class="op" id="5272289">.</span><span class="ident" id="5272290">sp</span><span class="op" id="5272292">[</span><span class="num" id="5272293">0</span><span class="op" id="5272294">]</span><span class="op" id="5272295">.</span><span class="ident" id="5272296">numBytes</span>&nbsp;<span class="op" id="5272305">-</span>&nbsp;<span class="ident" id="5272307">posInFragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272322">if</span>&nbsp;<span class="ident" id="5272325">int64</span><span class="op" id="5272330">(</span><span class="builtinfunc" id="5272331">len</span><span class="op" id="5272334">(</span><span class="ident" id="5272335">b</span><span class="op" id="5272336">)</span><span class="op" id="5272337">)</span>&nbsp;<span class="op" id="5272339">&gt;</span>&nbsp;<span class="ident" id="5272341">bytesLeft</span>&nbsp;<span class="op" id="5272351">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272355">b</span>&nbsp;<span class="op" id="5272357">=</span>&nbsp;<span class="ident" id="5272359">b</span><span class="op" id="5272360">[</span><span class="num" id="5272361">0</span><span class="op" id="5272362">:</span><span class="ident" id="5272363">bytesLeft</span><span class="op" id="5272372">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272375">}</span><br>
<span class="lineno">800</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272379">n</span><span class="op" id="5272380">,</span>&nbsp;<span class="ident" id="5272382">err</span>&nbsp;<span class="op" id="5272386">=</span>&nbsp;<span class="ident" id="5272388">sfr</span><span class="op" id="5272391">.</span><span class="ident" id="5272392">rfr</span><span class="op" id="5272395">.</span><span class="ident" id="5272396">Read</span><span class="op" id="5272400">(</span><span class="ident" id="5272401">b</span><span class="op" id="5272402">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272405">sfr</span><span class="op" id="5272408">.</span><span class="ident" id="5272409">pos</span>&nbsp;<span class="op" id="5272413">+=</span>&nbsp;<span class="ident" id="5272416">int64</span><span class="op" id="5272421">(</span><span class="ident" id="5272422">n</span><span class="op" id="5272423">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272427">if</span>&nbsp;<span class="ident" id="5272430">int64</span><span class="op" id="5272435">(</span><span class="ident" id="5272436">n</span><span class="op" id="5272437">)</span>&nbsp;<span class="op" id="5272439">==</span>&nbsp;<span class="ident" id="5272442">bytesLeft</span>&nbsp;<span class="op" id="5272452">{</span><br>
<span class="lineno">805</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5272456">//&nbsp;We&#39;re&nbsp;done&nbsp;with&nbsp;this&nbsp;fragment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272491">sfr</span><span class="op" id="5272494">.</span><span class="ident" id="5272495">sp</span>&nbsp;<span class="op" id="5272498">=</span>&nbsp;<span class="ident" id="5272500">sfr</span><span class="op" id="5272503">.</span><span class="ident" id="5272504">sp</span><span class="op" id="5272506">[</span><span class="num" id="5272507">1</span><span class="op" id="5272508">:</span><span class="op" id="5272509">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272512">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272516">if</span>&nbsp;<span class="ident" id="5272519">err</span>&nbsp;<span class="op" id="5272523">==</span>&nbsp;<span class="ident" id="5272526">io</span><span class="op" id="5272528">.</span><span class="ident" id="5272529">EOF</span>&nbsp;<span class="op" id="5272533">&amp;&amp;</span>&nbsp;<span class="ident" id="5272536">sfr</span><span class="op" id="5272539">.</span><span class="ident" id="5272540">pos</span>&nbsp;<span class="op" id="5272544">&lt;</span>&nbsp;<span class="ident" id="5272546">sfr</span><span class="op" id="5272549">.</span><span class="ident" id="5272550">tot</span>&nbsp;<span class="op" id="5272554">{</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5272558">//&nbsp;We&nbsp;reached&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;last&nbsp;fragment&#39;s&nbsp;data,&nbsp;but&nbsp;there&#39;s&nbsp;a&nbsp;final&nbsp;hole</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5272636">err</span>&nbsp;<span class="op" id="5272640">=</span>&nbsp;<span class="ident" id="5272642">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5272647">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272650">return</span><br>
<span class="lineno"></span><span class="op" id="5272657">}</span><br>
<span class="lineno">815</span><br>
<span class="lineno"></span><span class="comment" id="5272660">//&nbsp;numBytes&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;bytes&nbsp;left&nbsp;to&nbsp;read&nbsp;in&nbsp;the&nbsp;sparse&nbsp;file&#39;s</span><br>
<span class="lineno"></span><span class="comment" id="5272734">//&nbsp;sparse-encoded&nbsp;data&nbsp;in&nbsp;the&nbsp;tar&nbsp;archive.</span><br>
<span class="lineno"></span><span class="keyword" id="5272777">func</span>&nbsp;<span class="op" id="5272782">(</span><span class="ident" id="5272783">sfr</span>&nbsp;<span class="op" id="5272787">*</span><span class="ident" id="5272788">sparseFileReader</span><span class="op" id="5272804">)</span>&nbsp;<span class="ident" id="5272806">numBytes</span><span class="op" id="5272814">(</span><span class="op" id="5272815">)</span>&nbsp;<span class="ident" id="5272817">int64</span>&nbsp;<span class="op" id="5272823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5272826">return</span>&nbsp;<span class="ident" id="5272833">sfr</span><span class="op" id="5272836">.</span><span class="ident" id="5272837">rfr</span><span class="op" id="5272840">.</span><span class="ident" id="5272841">nb</span><br>
<span class="lineno">820</span><span class="op" id="5272844">}</span>
</div>
</body>
</html>
