<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>archive/zip</h2>
<ul>
<li><a href="/gostd/archive/zip/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/archive/zip/reader.go.html">reader.go</a></li>
<li><a href="/gostd/archive/zip/reader_test.go.html">reader_test.go</a></li>
<li><a href="/gostd/archive/zip/register.go.html">register.go</a></li>
<li><a href="/gostd/archive/zip/struct.go.html">struct.go</a></li>
<li><a href="/gostd/archive/zip/writer.go.html">writer.go</a></li>
<li><a href="/gostd/archive/zip/writer_test.go.html">writer_test.go</a></li>
<li><a href="/gostd/archive/zip/zip_test.go.html" class="current">zip_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7420915">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7420970">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7421024">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="7421075">//&nbsp;Tests&nbsp;that&nbsp;involve&nbsp;both&nbsp;reading&nbsp;and&nbsp;writing.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7421124">package</span>&nbsp;<span class="ident" id="7421132">zip</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7421137">import</span>&nbsp;<span class="op" id="7421144">(</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421147">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421156">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421163">&#34;hash&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421171">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421177">&#34;io/ioutil&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421190">&#34;sort&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421198">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421209">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7421220">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="7421227">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="7421230">func</span>&nbsp;<span class="ident" id="7421235">TestOver65kFiles</span><span class="op" id="7421251">(</span><span class="ident" id="7421252">t</span>&nbsp;<span class="op" id="7421254">*</span><span class="ident" id="7421255">testing</span><span class="op" id="7421262">.</span><span class="ident" id="7421263">T</span><span class="op" id="7421264">)</span>&nbsp;<span class="op" id="7421266">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421269">buf</span>&nbsp;<span class="op" id="7421273">:=</span>&nbsp;<span class="builtinfunc" id="7421276">new</span><span class="op" id="7421279">(</span><span class="ident" id="7421280">bytes</span><span class="op" id="7421285">.</span><span class="ident" id="7421286">Buffer</span><span class="op" id="7421292">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421295">w</span>&nbsp;<span class="op" id="7421297">:=</span>&nbsp;<span class="ident" id="7421300">NewWriter</span><span class="op" id="7421309">(</span><span class="ident" id="7421310">buf</span><span class="op" id="7421313">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421316">const</span>&nbsp;<span class="ident" id="7421322">nFiles</span>&nbsp;<span class="op" id="7421329">=</span>&nbsp;<span class="op" id="7421331">(</span><span class="num" id="7421332">1</span>&nbsp;<span class="op" id="7421334">&lt;&lt;</span>&nbsp;<span class="num" id="7421337">16</span><span class="op" id="7421339">)</span>&nbsp;<span class="op" id="7421341">+</span>&nbsp;<span class="num" id="7421343">42</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421347">for</span>&nbsp;<span class="ident" id="7421351">i</span>&nbsp;<span class="op" id="7421353">:=</span>&nbsp;<span class="num" id="7421356">0</span><span class="op" id="7421357">;</span>&nbsp;<span class="ident" id="7421359">i</span>&nbsp;<span class="op" id="7421361">&lt;</span>&nbsp;<span class="ident" id="7421363">nFiles</span><span class="op" id="7421369">;</span>&nbsp;<span class="ident" id="7421371">i</span><span class="op" id="7421372">++</span>&nbsp;<span class="op" id="7421375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421379">_</span><span class="op" id="7421380">,</span>&nbsp;<span class="ident" id="7421382">err</span>&nbsp;<span class="op" id="7421386">:=</span>&nbsp;<span class="ident" id="7421389">w</span><span class="op" id="7421390">.</span><span class="ident" id="7421391">CreateHeader</span><span class="op" id="7421403">(</span><span class="op" id="7421404">&amp;</span><span class="ident" id="7421405">FileHeader</span><span class="op" id="7421415">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421420">Name</span><span class="op" id="7421424">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7421428">fmt</span><span class="op" id="7421431">.</span><span class="ident" id="7421432">Sprintf</span><span class="op" id="7421439">(</span><span class="string" id="7421440">&#34;%d.dat&#34;</span><span class="op" id="7421448">,</span>&nbsp;<span class="ident" id="7421450">i</span><span class="op" id="7421451">)</span><span class="op" id="7421452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421457">Method</span><span class="op" id="7421463">:</span>&nbsp;<span class="ident" id="7421465">Store</span><span class="op" id="7421470">,</span>&nbsp;<span class="comment" id="7421472">//&nbsp;avoid&nbsp;Issue&nbsp;6136&nbsp;and&nbsp;Issue&nbsp;6138</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421509">}</span><span class="op" id="7421510">)</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421514">if</span>&nbsp;<span class="ident" id="7421517">err</span>&nbsp;<span class="op" id="7421521">!=</span>&nbsp;<span class="builtintype" id="7421524">nil</span>&nbsp;<span class="op" id="7421528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421533">t</span><span class="op" id="7421534">.</span><span class="ident" id="7421535">Fatalf</span><span class="op" id="7421541">(</span><span class="string" id="7421542">&#34;creating&nbsp;file&nbsp;%d:&nbsp;%v&#34;</span><span class="op" id="7421564">,</span>&nbsp;<span class="ident" id="7421566">i</span><span class="op" id="7421567">,</span>&nbsp;<span class="ident" id="7421569">err</span><span class="op" id="7421572">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421576">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421582">if</span>&nbsp;<span class="ident" id="7421585">err</span>&nbsp;<span class="op" id="7421589">:=</span>&nbsp;<span class="ident" id="7421592">w</span><span class="op" id="7421593">.</span><span class="ident" id="7421594">Close</span><span class="op" id="7421599">(</span><span class="op" id="7421600">)</span><span class="op" id="7421601">;</span>&nbsp;<span class="ident" id="7421603">err</span>&nbsp;<span class="op" id="7421607">!=</span>&nbsp;<span class="builtintype" id="7421610">nil</span>&nbsp;<span class="op" id="7421614">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421618">t</span><span class="op" id="7421619">.</span><span class="ident" id="7421620">Fatalf</span><span class="op" id="7421626">(</span><span class="string" id="7421627">&#34;Writer.Close:&nbsp;%v&#34;</span><span class="op" id="7421645">,</span>&nbsp;<span class="ident" id="7421647">err</span><span class="op" id="7421650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421653">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421656">s</span>&nbsp;<span class="op" id="7421658">:=</span>&nbsp;<span class="ident" id="7421661">buf</span><span class="op" id="7421664">.</span><span class="ident" id="7421665">String</span><span class="op" id="7421671">(</span><span class="op" id="7421672">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421675">zr</span><span class="op" id="7421677">,</span>&nbsp;<span class="ident" id="7421679">err</span>&nbsp;<span class="op" id="7421683">:=</span>&nbsp;<span class="ident" id="7421686">NewReader</span><span class="op" id="7421695">(</span><span class="ident" id="7421696">strings</span><span class="op" id="7421703">.</span><span class="ident" id="7421704">NewReader</span><span class="op" id="7421713">(</span><span class="ident" id="7421714">s</span><span class="op" id="7421715">)</span><span class="op" id="7421716">,</span>&nbsp;<span class="ident" id="7421718">int64</span><span class="op" id="7421723">(</span><span class="builtinfunc" id="7421724">len</span><span class="op" id="7421727">(</span><span class="ident" id="7421728">s</span><span class="op" id="7421729">)</span><span class="op" id="7421730">)</span><span class="op" id="7421731">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421734">if</span>&nbsp;<span class="ident" id="7421737">err</span>&nbsp;<span class="op" id="7421741">!=</span>&nbsp;<span class="builtintype" id="7421744">nil</span>&nbsp;<span class="op" id="7421748">{</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421752">t</span><span class="op" id="7421753">.</span><span class="ident" id="7421754">Fatalf</span><span class="op" id="7421760">(</span><span class="string" id="7421761">&#34;NewReader:&nbsp;%v&#34;</span><span class="op" id="7421776">,</span>&nbsp;<span class="ident" id="7421778">err</span><span class="op" id="7421781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421784">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421787">if</span>&nbsp;<span class="ident" id="7421790">got</span>&nbsp;<span class="op" id="7421794">:=</span>&nbsp;<span class="builtinfunc" id="7421797">len</span><span class="op" id="7421800">(</span><span class="ident" id="7421801">zr</span><span class="op" id="7421803">.</span><span class="ident" id="7421804">File</span><span class="op" id="7421808">)</span><span class="op" id="7421809">;</span>&nbsp;<span class="ident" id="7421811">got</span>&nbsp;<span class="op" id="7421815">!=</span>&nbsp;<span class="ident" id="7421818">nFiles</span>&nbsp;<span class="op" id="7421825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421829">t</span><span class="op" id="7421830">.</span><span class="ident" id="7421831">Fatalf</span><span class="op" id="7421837">(</span><span class="string" id="7421838">&#34;File&nbsp;contains&nbsp;%d&nbsp;files,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7421871">,</span>&nbsp;<span class="ident" id="7421873">got</span><span class="op" id="7421876">,</span>&nbsp;<span class="ident" id="7421878">nFiles</span><span class="op" id="7421884">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7421887">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421890">for</span>&nbsp;<span class="ident" id="7421894">i</span>&nbsp;<span class="op" id="7421896">:=</span>&nbsp;<span class="num" id="7421899">0</span><span class="op" id="7421900">;</span>&nbsp;<span class="ident" id="7421902">i</span>&nbsp;<span class="op" id="7421904">&lt;</span>&nbsp;<span class="ident" id="7421906">nFiles</span><span class="op" id="7421912">;</span>&nbsp;<span class="ident" id="7421914">i</span><span class="op" id="7421915">++</span>&nbsp;<span class="op" id="7421918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421922">want</span>&nbsp;<span class="op" id="7421927">:=</span>&nbsp;<span class="ident" id="7421930">fmt</span><span class="op" id="7421933">.</span><span class="ident" id="7421934">Sprintf</span><span class="op" id="7421941">(</span><span class="string" id="7421942">&#34;%d.dat&#34;</span><span class="op" id="7421950">,</span>&nbsp;<span class="ident" id="7421952">i</span><span class="op" id="7421953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7421957">if</span>&nbsp;<span class="ident" id="7421960">zr</span><span class="op" id="7421962">.</span><span class="ident" id="7421963">File</span><span class="op" id="7421967">[</span><span class="ident" id="7421968">i</span><span class="op" id="7421969">]</span><span class="op" id="7421970">.</span><span class="ident" id="7421971">Name</span>&nbsp;<span class="op" id="7421976">!=</span>&nbsp;<span class="ident" id="7421979">want</span>&nbsp;<span class="op" id="7421984">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7421989">t</span><span class="op" id="7421990">.</span><span class="ident" id="7421991">Fatalf</span><span class="op" id="7421997">(</span><span class="string" id="7421998">&#34;File(%d)&nbsp;=&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7422022">,</span>&nbsp;<span class="ident" id="7422024">i</span><span class="op" id="7422025">,</span>&nbsp;<span class="ident" id="7422027">zr</span><span class="op" id="7422029">.</span><span class="ident" id="7422030">File</span><span class="op" id="7422034">[</span><span class="ident" id="7422035">i</span><span class="op" id="7422036">]</span><span class="op" id="7422037">.</span><span class="ident" id="7422038">Name</span><span class="op" id="7422042">,</span>&nbsp;<span class="ident" id="7422044">want</span><span class="op" id="7422048">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422052">}</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422055">}</span><br>
<span class="lineno"></span><span class="op" id="7422057">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7422060">func</span>&nbsp;<span class="ident" id="7422065">TestModTime</span><span class="op" id="7422076">(</span><span class="ident" id="7422077">t</span>&nbsp;<span class="op" id="7422079">*</span><span class="ident" id="7422080">testing</span><span class="op" id="7422087">.</span><span class="ident" id="7422088">T</span><span class="op" id="7422089">)</span>&nbsp;<span class="op" id="7422091">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422094">var</span>&nbsp;<span class="ident" id="7422098">testTime</span>&nbsp;<span class="op" id="7422107">=</span>&nbsp;<span class="ident" id="7422109">time</span><span class="op" id="7422113">.</span><span class="ident" id="7422114">Date</span><span class="op" id="7422118">(</span><span class="num" id="7422119">2009</span><span class="op" id="7422123">,</span>&nbsp;<span class="ident" id="7422125">time</span><span class="op" id="7422129">.</span><span class="ident" id="7422130">November</span><span class="op" id="7422138">,</span>&nbsp;<span class="num" id="7422140">10</span><span class="op" id="7422142">,</span>&nbsp;<span class="num" id="7422144">23</span><span class="op" id="7422146">,</span>&nbsp;<span class="num" id="7422148">45</span><span class="op" id="7422150">,</span>&nbsp;<span class="num" id="7422152">58</span><span class="op" id="7422154">,</span>&nbsp;<span class="num" id="7422156">0</span><span class="op" id="7422157">,</span>&nbsp;<span class="ident" id="7422159">time</span><span class="op" id="7422163">.</span><span class="ident" id="7422164">UTC</span><span class="op" id="7422167">)</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422170">fh</span>&nbsp;<span class="op" id="7422173">:=</span>&nbsp;<span class="builtinfunc" id="7422176">new</span><span class="op" id="7422179">(</span><span class="ident" id="7422180">FileHeader</span><span class="op" id="7422190">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422193">fh</span><span class="op" id="7422195">.</span><span class="ident" id="7422196">SetModTime</span><span class="op" id="7422206">(</span><span class="ident" id="7422207">testTime</span><span class="op" id="7422215">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422218">outTime</span>&nbsp;<span class="op" id="7422226">:=</span>&nbsp;<span class="ident" id="7422229">fh</span><span class="op" id="7422231">.</span><span class="ident" id="7422232">ModTime</span><span class="op" id="7422239">(</span><span class="op" id="7422240">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422243">if</span>&nbsp;<span class="op" id="7422246">!</span><span class="ident" id="7422247">outTime</span><span class="op" id="7422254">.</span><span class="ident" id="7422255">Equal</span><span class="op" id="7422260">(</span><span class="ident" id="7422261">testTime</span><span class="op" id="7422269">)</span>&nbsp;<span class="op" id="7422271">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422275">t</span><span class="op" id="7422276">.</span><span class="ident" id="7422277">Errorf</span><span class="op" id="7422283">(</span><span class="string" id="7422284">&#34;times&nbsp;don&#39;t&nbsp;match:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s&#34;</span><span class="op" id="7422320">,</span>&nbsp;<span class="ident" id="7422322">outTime</span><span class="op" id="7422329">,</span>&nbsp;<span class="ident" id="7422331">testTime</span><span class="op" id="7422339">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422342">}</span><br>
<span class="lineno"></span><span class="op" id="7422344">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7422347">func</span>&nbsp;<span class="ident" id="7422352">testHeaderRoundTrip</span><span class="op" id="7422371">(</span><span class="ident" id="7422372">fh</span>&nbsp;<span class="op" id="7422375">*</span><span class="ident" id="7422376">FileHeader</span><span class="op" id="7422386">,</span>&nbsp;<span class="ident" id="7422388">wantUncompressedSize</span>&nbsp;<span class="builtintype" id="7422409">uint32</span><span class="op" id="7422415">,</span>&nbsp;<span class="ident" id="7422417">wantUncompressedSize64</span>&nbsp;<span class="ident" id="7422440">uint64</span><span class="op" id="7422446">,</span>&nbsp;<span class="ident" id="7422448">t</span>&nbsp;<span class="op" id="7422450">*</span><span class="ident" id="7422451">testing</span><span class="op" id="7422458">.</span><span class="ident" id="7422459">T</span><span class="op" id="7422460">)</span>&nbsp;<span class="op" id="7422462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422465">fi</span>&nbsp;<span class="op" id="7422468">:=</span>&nbsp;<span class="ident" id="7422471">fh</span><span class="op" id="7422473">.</span><span class="ident" id="7422474">FileInfo</span><span class="op" id="7422482">(</span><span class="op" id="7422483">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422486">fh2</span><span class="op" id="7422489">,</span>&nbsp;<span class="ident" id="7422491">err</span>&nbsp;<span class="op" id="7422495">:=</span>&nbsp;<span class="ident" id="7422498">FileInfoHeader</span><span class="op" id="7422512">(</span><span class="ident" id="7422513">fi</span><span class="op" id="7422515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422518">if</span>&nbsp;<span class="ident" id="7422521">err</span>&nbsp;<span class="op" id="7422525">!=</span>&nbsp;<span class="builtintype" id="7422528">nil</span>&nbsp;<span class="op" id="7422532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422536">t</span><span class="op" id="7422537">.</span><span class="ident" id="7422538">Fatal</span><span class="op" id="7422543">(</span><span class="ident" id="7422544">err</span><span class="op" id="7422547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422553">if</span>&nbsp;<span class="ident" id="7422556">got</span><span class="op" id="7422559">,</span>&nbsp;<span class="ident" id="7422561">want</span>&nbsp;<span class="op" id="7422566">:=</span>&nbsp;<span class="ident" id="7422569">fh2</span><span class="op" id="7422572">.</span><span class="ident" id="7422573">Name</span><span class="op" id="7422577">,</span>&nbsp;<span class="ident" id="7422579">fh</span><span class="op" id="7422581">.</span><span class="ident" id="7422582">Name</span><span class="op" id="7422586">;</span>&nbsp;<span class="ident" id="7422588">got</span>&nbsp;<span class="op" id="7422592">!=</span>&nbsp;<span class="ident" id="7422595">want</span>&nbsp;<span class="op" id="7422600">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422604">t</span><span class="op" id="7422605">.</span><span class="ident" id="7422606">Errorf</span><span class="op" id="7422612">(</span><span class="string" id="7422613">&#34;Name:&nbsp;got&nbsp;%s,&nbsp;want&nbsp;%s\n&#34;</span><span class="op" id="7422638">,</span>&nbsp;<span class="ident" id="7422640">got</span><span class="op" id="7422643">,</span>&nbsp;<span class="ident" id="7422645">want</span><span class="op" id="7422649">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422652">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422655">if</span>&nbsp;<span class="ident" id="7422658">got</span><span class="op" id="7422661">,</span>&nbsp;<span class="ident" id="7422663">want</span>&nbsp;<span class="op" id="7422668">:=</span>&nbsp;<span class="ident" id="7422671">fh2</span><span class="op" id="7422674">.</span><span class="ident" id="7422675">UncompressedSize</span><span class="op" id="7422691">,</span>&nbsp;<span class="ident" id="7422693">wantUncompressedSize</span><span class="op" id="7422713">;</span>&nbsp;<span class="ident" id="7422715">got</span>&nbsp;<span class="op" id="7422719">!=</span>&nbsp;<span class="ident" id="7422722">want</span>&nbsp;<span class="op" id="7422727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422731">t</span><span class="op" id="7422732">.</span><span class="ident" id="7422733">Errorf</span><span class="op" id="7422739">(</span><span class="string" id="7422740">&#34;UncompressedSize:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7422777">,</span>&nbsp;<span class="ident" id="7422779">got</span><span class="op" id="7422782">,</span>&nbsp;<span class="ident" id="7422784">want</span><span class="op" id="7422788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422791">}</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422794">if</span>&nbsp;<span class="ident" id="7422797">got</span><span class="op" id="7422800">,</span>&nbsp;<span class="ident" id="7422802">want</span>&nbsp;<span class="op" id="7422807">:=</span>&nbsp;<span class="ident" id="7422810">fh2</span><span class="op" id="7422813">.</span><span class="ident" id="7422814">UncompressedSize64</span><span class="op" id="7422832">,</span>&nbsp;<span class="ident" id="7422834">wantUncompressedSize64</span><span class="op" id="7422856">;</span>&nbsp;<span class="ident" id="7422858">got</span>&nbsp;<span class="op" id="7422862">!=</span>&nbsp;<span class="ident" id="7422865">want</span>&nbsp;<span class="op" id="7422870">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7422874">t</span><span class="op" id="7422875">.</span><span class="ident" id="7422876">Errorf</span><span class="op" id="7422882">(</span><span class="string" id="7422883">&#34;UncompressedSize64:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7422922">,</span>&nbsp;<span class="ident" id="7422924">got</span><span class="op" id="7422927">,</span>&nbsp;<span class="ident" id="7422929">want</span><span class="op" id="7422933">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7422936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7422939">if</span>&nbsp;<span class="ident" id="7422942">got</span><span class="op" id="7422945">,</span>&nbsp;<span class="ident" id="7422947">want</span>&nbsp;<span class="op" id="7422952">:=</span>&nbsp;<span class="ident" id="7422955">fh2</span><span class="op" id="7422958">.</span><span class="ident" id="7422959">ModifiedTime</span><span class="op" id="7422971">,</span>&nbsp;<span class="ident" id="7422973">fh</span><span class="op" id="7422975">.</span><span class="ident" id="7422976">ModifiedTime</span><span class="op" id="7422988">;</span>&nbsp;<span class="ident" id="7422990">got</span>&nbsp;<span class="op" id="7422994">!=</span>&nbsp;<span class="ident" id="7422997">want</span>&nbsp;<span class="op" id="7423002">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423006">t</span><span class="op" id="7423007">.</span><span class="ident" id="7423008">Errorf</span><span class="op" id="7423014">(</span><span class="string" id="7423015">&#34;ModifiedTime:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7423048">,</span>&nbsp;<span class="ident" id="7423050">got</span><span class="op" id="7423053">,</span>&nbsp;<span class="ident" id="7423055">want</span><span class="op" id="7423059">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7423062">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7423065">if</span>&nbsp;<span class="ident" id="7423068">got</span><span class="op" id="7423071">,</span>&nbsp;<span class="ident" id="7423073">want</span>&nbsp;<span class="op" id="7423078">:=</span>&nbsp;<span class="ident" id="7423081">fh2</span><span class="op" id="7423084">.</span><span class="ident" id="7423085">ModifiedDate</span><span class="op" id="7423097">,</span>&nbsp;<span class="ident" id="7423099">fh</span><span class="op" id="7423101">.</span><span class="ident" id="7423102">ModifiedDate</span><span class="op" id="7423114">;</span>&nbsp;<span class="ident" id="7423116">got</span>&nbsp;<span class="op" id="7423120">!=</span>&nbsp;<span class="ident" id="7423123">want</span>&nbsp;<span class="op" id="7423128">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423132">t</span><span class="op" id="7423133">.</span><span class="ident" id="7423134">Errorf</span><span class="op" id="7423140">(</span><span class="string" id="7423141">&#34;ModifiedDate:&nbsp;got&nbsp;%d,&nbsp;want&nbsp;%d\n&#34;</span><span class="op" id="7423174">,</span>&nbsp;<span class="ident" id="7423176">got</span><span class="op" id="7423179">,</span>&nbsp;<span class="ident" id="7423181">want</span><span class="op" id="7423185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7423188">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7423192">if</span>&nbsp;<span class="ident" id="7423195">sysfh</span><span class="op" id="7423200">,</span>&nbsp;<span class="ident" id="7423202">ok</span>&nbsp;<span class="op" id="7423205">:=</span>&nbsp;<span class="ident" id="7423208">fi</span><span class="op" id="7423210">.</span><span class="ident" id="7423211">Sys</span><span class="op" id="7423214">(</span><span class="op" id="7423215">)</span><span class="op" id="7423216">.</span><span class="op" id="7423217">(</span><span class="op" id="7423218">*</span><span class="ident" id="7423219">FileHeader</span><span class="op" id="7423229">)</span><span class="op" id="7423230">;</span>&nbsp;<span class="op" id="7423232">!</span><span class="ident" id="7423233">ok</span>&nbsp;<span class="op" id="7423236">&amp;&amp;</span>&nbsp;<span class="ident" id="7423239">sysfh</span>&nbsp;<span class="op" id="7423245">!=</span>&nbsp;<span class="ident" id="7423248">fh</span>&nbsp;<span class="op" id="7423251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423255">t</span><span class="op" id="7423256">.</span><span class="ident" id="7423257">Errorf</span><span class="op" id="7423263">(</span><span class="string" id="7423264">&#34;Sys&nbsp;didn&#39;t&nbsp;return&nbsp;original&nbsp;*FileHeader&#34;</span><span class="op" id="7423304">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7423307">}</span><br>
<span class="lineno"></span><span class="op" id="7423309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="7423312">func</span>&nbsp;<span class="ident" id="7423317">TestFileHeaderRoundTrip</span><span class="op" id="7423340">(</span><span class="ident" id="7423341">t</span>&nbsp;<span class="op" id="7423343">*</span><span class="ident" id="7423344">testing</span><span class="op" id="7423351">.</span><span class="ident" id="7423352">T</span><span class="op" id="7423353">)</span>&nbsp;<span class="op" id="7423355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423358">fh</span>&nbsp;<span class="op" id="7423361">:=</span>&nbsp;<span class="op" id="7423364">&amp;</span><span class="ident" id="7423365">FileHeader</span><span class="op" id="7423375">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423379">Name</span><span class="op" id="7423383">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7423397">&#34;foo.txt&#34;</span><span class="op" id="7423406">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423410">UncompressedSize</span><span class="op" id="7423426">:</span>&nbsp;<span class="num" id="7423428">987654321</span><span class="op" id="7423437">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423441">ModifiedTime</span><span class="op" id="7423453">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7423459">1234</span><span class="op" id="7423463">,</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423467">ModifiedDate</span><span class="op" id="7423479">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7423485">5678</span><span class="op" id="7423489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7423492">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423495">testHeaderRoundTrip</span><span class="op" id="7423514">(</span><span class="ident" id="7423515">fh</span><span class="op" id="7423517">,</span>&nbsp;<span class="ident" id="7423519">fh</span><span class="op" id="7423521">.</span><span class="ident" id="7423522">UncompressedSize</span><span class="op" id="7423538">,</span>&nbsp;<span class="ident" id="7423540">uint64</span><span class="op" id="7423546">(</span><span class="ident" id="7423547">fh</span><span class="op" id="7423549">.</span><span class="ident" id="7423550">UncompressedSize</span><span class="op" id="7423566">)</span><span class="op" id="7423567">,</span>&nbsp;<span class="ident" id="7423569">t</span><span class="op" id="7423570">)</span><br>
<span class="lineno"></span><span class="op" id="7423572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="keyword" id="7423575">func</span>&nbsp;<span class="ident" id="7423580">TestFileHeaderRoundTrip64</span><span class="op" id="7423605">(</span><span class="ident" id="7423606">t</span>&nbsp;<span class="op" id="7423608">*</span><span class="ident" id="7423609">testing</span><span class="op" id="7423616">.</span><span class="ident" id="7423617">T</span><span class="op" id="7423618">)</span>&nbsp;<span class="op" id="7423620">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423623">fh</span>&nbsp;<span class="op" id="7423626">:=</span>&nbsp;<span class="op" id="7423629">&amp;</span><span class="ident" id="7423630">FileHeader</span><span class="op" id="7423640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423644">Name</span><span class="op" id="7423648">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="7423664">&#34;foo.txt&#34;</span><span class="op" id="7423673">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423677">UncompressedSize64</span><span class="op" id="7423695">:</span>&nbsp;<span class="num" id="7423697">9876543210</span><span class="op" id="7423707">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423711">ModifiedTime</span><span class="op" id="7423723">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7423731">1234</span><span class="op" id="7423735">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423739">ModifiedDate</span><span class="op" id="7423751">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7423759">5678</span><span class="op" id="7423763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7423766">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423769">testHeaderRoundTrip</span><span class="op" id="7423788">(</span><span class="ident" id="7423789">fh</span><span class="op" id="7423791">,</span>&nbsp;<span class="ident" id="7423793">uint32max</span><span class="op" id="7423802">,</span>&nbsp;<span class="ident" id="7423804">fh</span><span class="op" id="7423806">.</span><span class="ident" id="7423807">UncompressedSize64</span><span class="op" id="7423825">,</span>&nbsp;<span class="ident" id="7423827">t</span><span class="op" id="7423828">)</span><br>
<span class="lineno"></span><span class="op" id="7423830">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span><span class="keyword" id="7423833">type</span>&nbsp;<span class="ident" id="7423838">repeatedByte</span>&nbsp;<span class="keyword" id="7423851">struct</span>&nbsp;<span class="op" id="7423858">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423861">off</span>&nbsp;<span class="ident" id="7423865">int64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423872">b</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7423876">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7423882">n</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7423886">int64</span><br>
<span class="lineno"></span><span class="op" id="7423892">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="comment" id="7423895">//&nbsp;rleBuffer&nbsp;is&nbsp;a&nbsp;run-length-encoded&nbsp;byte&nbsp;buffer.</span><br>
<span class="lineno"></span><span class="comment" id="7423945">//&nbsp;It&#39;s&nbsp;an&nbsp;io.Writer&nbsp;(like&nbsp;a&nbsp;bytes.Buffer)&nbsp;and&nbsp;also&nbsp;an&nbsp;io.ReaderAt,</span><br>
<span class="lineno"></span><span class="comment" id="7424013">//&nbsp;allowing&nbsp;random-access&nbsp;reads.</span><br>
<span class="lineno"></span><span class="keyword" id="7424046">type</span>&nbsp;<span class="ident" id="7424051">rleBuffer</span>&nbsp;<span class="keyword" id="7424061">struct</span>&nbsp;<span class="op" id="7424068">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424071">buf</span>&nbsp;<span class="op" id="7424075">[</span><span class="op" id="7424076">]</span><span class="ident" id="7424077">repeatedByte</span><br>
<span class="lineno"></span><span class="op" id="7424090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7424093">func</span>&nbsp;<span class="op" id="7424098">(</span><span class="ident" id="7424099">r</span>&nbsp;<span class="op" id="7424101">*</span><span class="ident" id="7424102">rleBuffer</span><span class="op" id="7424111">)</span>&nbsp;<span class="ident" id="7424113">Size</span><span class="op" id="7424117">(</span><span class="op" id="7424118">)</span>&nbsp;<span class="ident" id="7424120">int64</span>&nbsp;<span class="op" id="7424126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424129">if</span>&nbsp;<span class="builtinfunc" id="7424132">len</span><span class="op" id="7424135">(</span><span class="ident" id="7424136">r</span><span class="op" id="7424137">.</span><span class="ident" id="7424138">buf</span><span class="op" id="7424141">)</span>&nbsp;<span class="op" id="7424143">==</span>&nbsp;<span class="num" id="7424146">0</span>&nbsp;<span class="op" id="7424148">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424152">return</span>&nbsp;<span class="num" id="7424159">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424162">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424165">last</span>&nbsp;<span class="op" id="7424170">:=</span>&nbsp;<span class="op" id="7424173">&amp;</span><span class="ident" id="7424174">r</span><span class="op" id="7424175">.</span><span class="ident" id="7424176">buf</span><span class="op" id="7424179">[</span><span class="builtinfunc" id="7424180">len</span><span class="op" id="7424183">(</span><span class="ident" id="7424184">r</span><span class="op" id="7424185">.</span><span class="ident" id="7424186">buf</span><span class="op" id="7424189">)</span><span class="op" id="7424190">-</span><span class="num" id="7424191">1</span><span class="op" id="7424192">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424195">return</span>&nbsp;<span class="ident" id="7424202">last</span><span class="op" id="7424206">.</span><span class="ident" id="7424207">off</span>&nbsp;<span class="op" id="7424211">+</span>&nbsp;<span class="ident" id="7424213">last</span><span class="op" id="7424217">.</span><span class="ident" id="7424218">n</span><br>
<span class="lineno"></span><span class="op" id="7424220">}</span><br>
<span class="lineno">130</span><br>
<span class="lineno"></span><span class="keyword" id="7424223">func</span>&nbsp;<span class="op" id="7424228">(</span><span class="ident" id="7424229">r</span>&nbsp;<span class="op" id="7424231">*</span><span class="ident" id="7424232">rleBuffer</span><span class="op" id="7424241">)</span>&nbsp;<span class="ident" id="7424243">Write</span><span class="op" id="7424248">(</span><span class="ident" id="7424249">p</span>&nbsp;<span class="op" id="7424251">[</span><span class="op" id="7424252">]</span><span class="builtintype" id="7424253">byte</span><span class="op" id="7424257">)</span>&nbsp;<span class="op" id="7424259">(</span><span class="ident" id="7424260">n</span>&nbsp;<span class="builtintype" id="7424262">int</span><span class="op" id="7424265">,</span>&nbsp;<span class="ident" id="7424267">err</span>&nbsp;<span class="builtintype" id="7424271">error</span><span class="op" id="7424276">)</span>&nbsp;<span class="op" id="7424278">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424281">var</span>&nbsp;<span class="ident" id="7424285">rp</span>&nbsp;<span class="op" id="7424288">*</span><span class="ident" id="7424289">repeatedByte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424303">if</span>&nbsp;<span class="builtinfunc" id="7424306">len</span><span class="op" id="7424309">(</span><span class="ident" id="7424310">r</span><span class="op" id="7424311">.</span><span class="ident" id="7424312">buf</span><span class="op" id="7424315">)</span>&nbsp;<span class="op" id="7424317">&gt;</span>&nbsp;<span class="num" id="7424319">0</span>&nbsp;<span class="op" id="7424321">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424325">rp</span>&nbsp;<span class="op" id="7424328">=</span>&nbsp;<span class="op" id="7424330">&amp;</span><span class="ident" id="7424331">r</span><span class="op" id="7424332">.</span><span class="ident" id="7424333">buf</span><span class="op" id="7424336">[</span><span class="builtinfunc" id="7424337">len</span><span class="op" id="7424340">(</span><span class="ident" id="7424341">r</span><span class="op" id="7424342">.</span><span class="ident" id="7424343">buf</span><span class="op" id="7424346">)</span><span class="op" id="7424347">-</span><span class="num" id="7424348">1</span><span class="op" id="7424349">]</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7424353">//&nbsp;Fast&nbsp;path,&nbsp;if&nbsp;p&nbsp;is&nbsp;entirely&nbsp;the&nbsp;same&nbsp;byte&nbsp;repeated.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424410">if</span>&nbsp;<span class="ident" id="7424413">lastByte</span>&nbsp;<span class="op" id="7424422">:=</span>&nbsp;<span class="ident" id="7424425">rp</span><span class="op" id="7424427">.</span><span class="ident" id="7424428">b</span><span class="op" id="7424429">;</span>&nbsp;<span class="builtinfunc" id="7424431">len</span><span class="op" id="7424434">(</span><span class="ident" id="7424435">p</span><span class="op" id="7424436">)</span>&nbsp;<span class="op" id="7424438">&gt;</span>&nbsp;<span class="num" id="7424440">0</span>&nbsp;<span class="op" id="7424442">&amp;&amp;</span>&nbsp;<span class="ident" id="7424445">p</span><span class="op" id="7424446">[</span><span class="num" id="7424447">0</span><span class="op" id="7424448">]</span>&nbsp;<span class="op" id="7424450">==</span>&nbsp;<span class="ident" id="7424453">lastByte</span>&nbsp;<span class="op" id="7424462">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424467">all</span>&nbsp;<span class="op" id="7424471">:=</span>&nbsp;<span class="builtintype" id="7424474">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424482">for</span>&nbsp;<span class="ident" id="7424486">_</span><span class="op" id="7424487">,</span>&nbsp;<span class="ident" id="7424489">b</span>&nbsp;<span class="op" id="7424491">:=</span>&nbsp;<span class="keyword" id="7424494">range</span>&nbsp;<span class="ident" id="7424500">p</span>&nbsp;<span class="op" id="7424502">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424508">if</span>&nbsp;<span class="ident" id="7424511">b</span>&nbsp;<span class="op" id="7424513">!=</span>&nbsp;<span class="ident" id="7424516">lastByte</span>&nbsp;<span class="op" id="7424525">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424532">all</span>&nbsp;<span class="op" id="7424536">=</span>&nbsp;<span class="builtintype" id="7424538">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424549">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424559">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424569">if</span>&nbsp;<span class="ident" id="7424572">all</span>&nbsp;<span class="op" id="7424576">{</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424582">rp</span><span class="op" id="7424584">.</span><span class="ident" id="7424585">n</span>&nbsp;<span class="op" id="7424587">+=</span>&nbsp;<span class="ident" id="7424590">int64</span><span class="op" id="7424595">(</span><span class="builtinfunc" id="7424596">len</span><span class="op" id="7424599">(</span><span class="ident" id="7424600">p</span><span class="op" id="7424601">)</span><span class="op" id="7424602">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424608">return</span>&nbsp;<span class="builtinfunc" id="7424615">len</span><span class="op" id="7424618">(</span><span class="ident" id="7424619">p</span><span class="op" id="7424620">)</span><span class="op" id="7424621">,</span>&nbsp;<span class="builtintype" id="7424623">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424630">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424634">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424637">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424641">for</span>&nbsp;<span class="ident" id="7424645">_</span><span class="op" id="7424646">,</span>&nbsp;<span class="ident" id="7424648">b</span>&nbsp;<span class="op" id="7424650">:=</span>&nbsp;<span class="keyword" id="7424653">range</span>&nbsp;<span class="ident" id="7424659">p</span>&nbsp;<span class="op" id="7424661">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424665">if</span>&nbsp;<span class="ident" id="7424668">rp</span>&nbsp;<span class="op" id="7424671">==</span>&nbsp;<span class="builtintype" id="7424674">nil</span>&nbsp;<span class="op" id="7424678">||</span>&nbsp;<span class="ident" id="7424681">rp</span><span class="op" id="7424683">.</span><span class="ident" id="7424684">b</span>&nbsp;<span class="op" id="7424686">!=</span>&nbsp;<span class="ident" id="7424689">b</span>&nbsp;<span class="op" id="7424691">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424696">r</span><span class="op" id="7424697">.</span><span class="ident" id="7424698">buf</span>&nbsp;<span class="op" id="7424702">=</span>&nbsp;<span class="builtinfunc" id="7424704">append</span><span class="op" id="7424710">(</span><span class="ident" id="7424711">r</span><span class="op" id="7424712">.</span><span class="ident" id="7424713">buf</span><span class="op" id="7424716">,</span>&nbsp;<span class="ident" id="7424718">repeatedByte</span><span class="op" id="7424730">{</span><span class="ident" id="7424731">r</span><span class="op" id="7424732">.</span><span class="ident" id="7424733">Size</span><span class="op" id="7424737">(</span><span class="op" id="7424738">)</span><span class="op" id="7424739">,</span>&nbsp;<span class="ident" id="7424741">b</span><span class="op" id="7424742">,</span>&nbsp;<span class="num" id="7424744">1</span><span class="op" id="7424745">}</span><span class="op" id="7424746">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424751">rp</span>&nbsp;<span class="op" id="7424754">=</span>&nbsp;<span class="op" id="7424756">&amp;</span><span class="ident" id="7424757">r</span><span class="op" id="7424758">.</span><span class="ident" id="7424759">buf</span><span class="op" id="7424762">[</span><span class="builtinfunc" id="7424763">len</span><span class="op" id="7424766">(</span><span class="ident" id="7424767">r</span><span class="op" id="7424768">.</span><span class="ident" id="7424769">buf</span><span class="op" id="7424772">)</span><span class="op" id="7424773">-</span><span class="num" id="7424774">1</span><span class="op" id="7424775">]</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424779">}</span>&nbsp;<span class="keyword" id="7424781">else</span>&nbsp;<span class="op" id="7424786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424791">rp</span><span class="op" id="7424793">.</span><span class="ident" id="7424794">n</span><span class="op" id="7424795">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424800">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424803">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424806">return</span>&nbsp;<span class="builtinfunc" id="7424813">len</span><span class="op" id="7424816">(</span><span class="ident" id="7424817">p</span><span class="op" id="7424818">)</span><span class="op" id="7424819">,</span>&nbsp;<span class="builtintype" id="7424821">nil</span><br>
<span class="lineno">160</span><span class="op" id="7424825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7424828">func</span>&nbsp;<span class="op" id="7424833">(</span><span class="ident" id="7424834">r</span>&nbsp;<span class="op" id="7424836">*</span><span class="ident" id="7424837">rleBuffer</span><span class="op" id="7424846">)</span>&nbsp;<span class="ident" id="7424848">ReadAt</span><span class="op" id="7424854">(</span><span class="ident" id="7424855">p</span>&nbsp;<span class="op" id="7424857">[</span><span class="op" id="7424858">]</span><span class="builtintype" id="7424859">byte</span><span class="op" id="7424863">,</span>&nbsp;<span class="ident" id="7424865">off</span>&nbsp;<span class="ident" id="7424869">int64</span><span class="op" id="7424874">)</span>&nbsp;<span class="op" id="7424876">(</span><span class="ident" id="7424877">n</span>&nbsp;<span class="builtintype" id="7424879">int</span><span class="op" id="7424882">,</span>&nbsp;<span class="ident" id="7424884">err</span>&nbsp;<span class="builtintype" id="7424888">error</span><span class="op" id="7424893">)</span>&nbsp;<span class="op" id="7424895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424898">if</span>&nbsp;<span class="builtinfunc" id="7424901">len</span><span class="op" id="7424904">(</span><span class="ident" id="7424905">p</span><span class="op" id="7424906">)</span>&nbsp;<span class="op" id="7424908">==</span>&nbsp;<span class="num" id="7424911">0</span>&nbsp;<span class="op" id="7424913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7424917">return</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7424925">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424928">skipParts</span>&nbsp;<span class="op" id="7424938">:=</span>&nbsp;<span class="ident" id="7424941">sort</span><span class="op" id="7424945">.</span><span class="ident" id="7424946">Search</span><span class="op" id="7424952">(</span><span class="builtinfunc" id="7424953">len</span><span class="op" id="7424956">(</span><span class="ident" id="7424957">r</span><span class="op" id="7424958">.</span><span class="ident" id="7424959">buf</span><span class="op" id="7424962">)</span><span class="op" id="7424963">,</span>&nbsp;<span class="keyword" id="7424965">func</span><span class="op" id="7424969">(</span><span class="ident" id="7424970">i</span>&nbsp;<span class="builtintype" id="7424972">int</span><span class="op" id="7424975">)</span>&nbsp;<span class="builtintype" id="7424977">bool</span>&nbsp;<span class="op" id="7424982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7424986">part</span>&nbsp;<span class="op" id="7424991">:=</span>&nbsp;<span class="op" id="7424994">&amp;</span><span class="ident" id="7424995">r</span><span class="op" id="7424996">.</span><span class="ident" id="7424997">buf</span><span class="op" id="7425000">[</span><span class="ident" id="7425001">i</span><span class="op" id="7425002">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425006">return</span>&nbsp;<span class="ident" id="7425013">part</span><span class="op" id="7425017">.</span><span class="ident" id="7425018">off</span><span class="op" id="7425021">+</span><span class="ident" id="7425022">part</span><span class="op" id="7425026">.</span><span class="ident" id="7425027">n</span>&nbsp;<span class="op" id="7425029">&gt;</span>&nbsp;<span class="ident" id="7425031">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425036">}</span><span class="op" id="7425037">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425040">parts</span>&nbsp;<span class="op" id="7425046">:=</span>&nbsp;<span class="ident" id="7425049">r</span><span class="op" id="7425050">.</span><span class="ident" id="7425051">buf</span><span class="op" id="7425054">[</span><span class="ident" id="7425055">skipParts</span><span class="op" id="7425064">:</span><span class="op" id="7425065">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425068">if</span>&nbsp;<span class="builtinfunc" id="7425071">len</span><span class="op" id="7425074">(</span><span class="ident" id="7425075">parts</span><span class="op" id="7425080">)</span>&nbsp;<span class="op" id="7425082">&gt;</span>&nbsp;<span class="num" id="7425084">0</span>&nbsp;<span class="op" id="7425086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425090">skipBytes</span>&nbsp;<span class="op" id="7425100">:=</span>&nbsp;<span class="ident" id="7425103">off</span>&nbsp;<span class="op" id="7425107">-</span>&nbsp;<span class="ident" id="7425109">parts</span><span class="op" id="7425114">[</span><span class="num" id="7425115">0</span><span class="op" id="7425116">]</span><span class="op" id="7425117">.</span><span class="ident" id="7425118">off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425124">for</span>&nbsp;<span class="builtinfunc" id="7425128">len</span><span class="op" id="7425131">(</span><span class="ident" id="7425132">parts</span><span class="op" id="7425137">)</span>&nbsp;<span class="op" id="7425139">&gt;</span>&nbsp;<span class="num" id="7425141">0</span>&nbsp;<span class="op" id="7425143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425148">part</span>&nbsp;<span class="op" id="7425153">:=</span>&nbsp;<span class="ident" id="7425156">parts</span><span class="op" id="7425161">[</span><span class="num" id="7425162">0</span><span class="op" id="7425163">]</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425168">for</span>&nbsp;<span class="ident" id="7425172">i</span>&nbsp;<span class="op" id="7425174">:=</span>&nbsp;<span class="ident" id="7425177">skipBytes</span><span class="op" id="7425186">;</span>&nbsp;<span class="ident" id="7425188">i</span>&nbsp;<span class="op" id="7425190">&lt;</span>&nbsp;<span class="ident" id="7425192">part</span><span class="op" id="7425196">.</span><span class="ident" id="7425197">n</span><span class="op" id="7425198">;</span>&nbsp;<span class="ident" id="7425200">i</span><span class="op" id="7425201">++</span>&nbsp;<span class="op" id="7425204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425210">if</span>&nbsp;<span class="ident" id="7425213">n</span>&nbsp;<span class="op" id="7425215">==</span>&nbsp;<span class="builtinfunc" id="7425218">len</span><span class="op" id="7425221">(</span><span class="ident" id="7425222">p</span><span class="op" id="7425223">)</span>&nbsp;<span class="op" id="7425225">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425232">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425243">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425249">p</span><span class="op" id="7425250">[</span><span class="ident" id="7425251">n</span><span class="op" id="7425252">]</span>&nbsp;<span class="op" id="7425254">=</span>&nbsp;<span class="ident" id="7425256">part</span><span class="op" id="7425260">.</span><span class="ident" id="7425261">b</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425267">n</span><span class="op" id="7425268">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425274">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425279">parts</span>&nbsp;<span class="op" id="7425285">=</span>&nbsp;<span class="ident" id="7425287">parts</span><span class="op" id="7425292">[</span><span class="num" id="7425293">1</span><span class="op" id="7425294">:</span><span class="op" id="7425295">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425300">skipBytes</span>&nbsp;<span class="op" id="7425310">=</span>&nbsp;<span class="num" id="7425312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425316">}</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425319">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425322">if</span>&nbsp;<span class="ident" id="7425325">n</span>&nbsp;<span class="op" id="7425327">!=</span>&nbsp;<span class="builtinfunc" id="7425330">len</span><span class="op" id="7425333">(</span><span class="ident" id="7425334">p</span><span class="op" id="7425335">)</span>&nbsp;<span class="op" id="7425337">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425341">err</span>&nbsp;<span class="op" id="7425345">=</span>&nbsp;<span class="ident" id="7425347">io</span><span class="op" id="7425349">.</span><span class="ident" id="7425350">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425368">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425371">return</span><br>
<span class="lineno">190</span><span class="op" id="7425378">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7425381">//&nbsp;Just&nbsp;testing&nbsp;the&nbsp;rleBuffer&nbsp;used&nbsp;in&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above.&nbsp;Not&nbsp;used&nbsp;by&nbsp;the&nbsp;zip&nbsp;code.</span><br>
<span class="lineno"></span><span class="keyword" id="7425467">func</span>&nbsp;<span class="ident" id="7425472">TestRLEBuffer</span><span class="op" id="7425485">(</span><span class="ident" id="7425486">t</span>&nbsp;<span class="op" id="7425488">*</span><span class="ident" id="7425489">testing</span><span class="op" id="7425496">.</span><span class="ident" id="7425497">T</span><span class="op" id="7425498">)</span>&nbsp;<span class="op" id="7425500">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425503">b</span>&nbsp;<span class="op" id="7425505">:=</span>&nbsp;<span class="builtinfunc" id="7425508">new</span><span class="op" id="7425511">(</span><span class="ident" id="7425512">rleBuffer</span><span class="op" id="7425521">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425524">var</span>&nbsp;<span class="ident" id="7425528">all</span>&nbsp;<span class="op" id="7425532">[</span><span class="op" id="7425533">]</span><span class="builtintype" id="7425534">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425540">writes</span>&nbsp;<span class="op" id="7425547">:=</span>&nbsp;<span class="op" id="7425550">[</span><span class="op" id="7425551">]</span><span class="builtintype" id="7425552">string</span><span class="op" id="7425558">{</span><span class="string" id="7425559">&#34;abcdeee&#34;</span><span class="op" id="7425568">,</span>&nbsp;<span class="string" id="7425570">&#34;eeeeeee&#34;</span><span class="op" id="7425579">,</span>&nbsp;<span class="string" id="7425581">&#34;eeeefghaaiii&#34;</span><span class="op" id="7425595">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425598">for</span>&nbsp;<span class="ident" id="7425602">_</span><span class="op" id="7425603">,</span>&nbsp;<span class="ident" id="7425605">w</span>&nbsp;<span class="op" id="7425607">:=</span>&nbsp;<span class="keyword" id="7425610">range</span>&nbsp;<span class="ident" id="7425616">writes</span>&nbsp;<span class="op" id="7425623">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425627">b</span><span class="op" id="7425628">.</span><span class="ident" id="7425629">Write</span><span class="op" id="7425634">(</span><span class="op" id="7425635">[</span><span class="op" id="7425636">]</span><span class="builtintype" id="7425637">byte</span><span class="op" id="7425641">(</span><span class="ident" id="7425642">w</span><span class="op" id="7425643">)</span><span class="op" id="7425644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425648">all</span>&nbsp;<span class="op" id="7425652">=</span>&nbsp;<span class="builtinfunc" id="7425654">append</span><span class="op" id="7425660">(</span><span class="ident" id="7425661">all</span><span class="op" id="7425664">,</span>&nbsp;<span class="ident" id="7425666">w</span><span class="op" id="7425667">...</span><span class="op" id="7425670">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425673">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425676">if</span>&nbsp;<span class="builtinfunc" id="7425679">len</span><span class="op" id="7425682">(</span><span class="ident" id="7425683">b</span><span class="op" id="7425684">.</span><span class="ident" id="7425685">buf</span><span class="op" id="7425688">)</span>&nbsp;<span class="op" id="7425690">!=</span>&nbsp;<span class="num" id="7425693">10</span>&nbsp;<span class="op" id="7425696">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425700">t</span><span class="op" id="7425701">.</span><span class="ident" id="7425702">Fatalf</span><span class="op" id="7425708">(</span><span class="string" id="7425709">&#34;len(b.buf)&nbsp;=&nbsp;%d;&nbsp;want&nbsp;10&#34;</span><span class="op" id="7425735">,</span>&nbsp;<span class="builtinfunc" id="7425737">len</span><span class="op" id="7425740">(</span><span class="ident" id="7425741">b</span><span class="op" id="7425742">.</span><span class="ident" id="7425743">buf</span><span class="op" id="7425746">)</span><span class="op" id="7425747">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7425750">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425754">for</span>&nbsp;<span class="ident" id="7425758">i</span>&nbsp;<span class="op" id="7425760">:=</span>&nbsp;<span class="num" id="7425763">0</span><span class="op" id="7425764">;</span>&nbsp;<span class="ident" id="7425766">i</span>&nbsp;<span class="op" id="7425768">&lt;</span>&nbsp;<span class="builtinfunc" id="7425770">len</span><span class="op" id="7425773">(</span><span class="ident" id="7425774">all</span><span class="op" id="7425777">)</span><span class="op" id="7425778">;</span>&nbsp;<span class="ident" id="7425780">i</span><span class="op" id="7425781">++</span>&nbsp;<span class="op" id="7425784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425788">for</span>&nbsp;<span class="ident" id="7425792">j</span>&nbsp;<span class="op" id="7425794">:=</span>&nbsp;<span class="num" id="7425797">0</span><span class="op" id="7425798">;</span>&nbsp;<span class="ident" id="7425800">j</span>&nbsp;<span class="op" id="7425802">&lt;</span>&nbsp;<span class="builtinfunc" id="7425804">len</span><span class="op" id="7425807">(</span><span class="ident" id="7425808">all</span><span class="op" id="7425811">)</span><span class="op" id="7425812">-</span><span class="ident" id="7425813">i</span><span class="op" id="7425814">;</span>&nbsp;<span class="ident" id="7425816">j</span><span class="op" id="7425817">++</span>&nbsp;<span class="op" id="7425820">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425825">buf</span>&nbsp;<span class="op" id="7425829">:=</span>&nbsp;<span class="builtinfunc" id="7425832">make</span><span class="op" id="7425836">(</span><span class="op" id="7425837">[</span><span class="op" id="7425838">]</span><span class="builtintype" id="7425839">byte</span><span class="op" id="7425843">,</span>&nbsp;<span class="ident" id="7425845">j</span><span class="op" id="7425846">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425851">n</span><span class="op" id="7425852">,</span>&nbsp;<span class="ident" id="7425854">err</span>&nbsp;<span class="op" id="7425858">:=</span>&nbsp;<span class="ident" id="7425861">b</span><span class="op" id="7425862">.</span><span class="ident" id="7425863">ReadAt</span><span class="op" id="7425869">(</span><span class="ident" id="7425870">buf</span><span class="op" id="7425873">,</span>&nbsp;<span class="ident" id="7425875">int64</span><span class="op" id="7425880">(</span><span class="ident" id="7425881">i</span><span class="op" id="7425882">)</span><span class="op" id="7425883">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7425888">if</span>&nbsp;<span class="ident" id="7425891">err</span>&nbsp;<span class="op" id="7425895">!=</span>&nbsp;<span class="builtintype" id="7425898">nil</span>&nbsp;<span class="op" id="7425902">||</span>&nbsp;<span class="ident" id="7425905">n</span>&nbsp;<span class="op" id="7425907">!=</span>&nbsp;<span class="builtinfunc" id="7425910">len</span><span class="op" id="7425913">(</span><span class="ident" id="7425914">buf</span><span class="op" id="7425917">)</span>&nbsp;<span class="op" id="7425919">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7425925">t</span><span class="op" id="7425926">.</span><span class="ident" id="7425927">Errorf</span><span class="op" id="7425933">(</span><span class="string" id="7425934">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%d,&nbsp;%v;&nbsp;want&nbsp;%d,&nbsp;nil&#34;</span><span class="op" id="7425973">,</span>&nbsp;<span class="ident" id="7425975">i</span><span class="op" id="7425976">,</span>&nbsp;<span class="ident" id="7425978">j</span><span class="op" id="7425979">,</span>&nbsp;<span class="ident" id="7425981">n</span><span class="op" id="7425982">,</span>&nbsp;<span class="ident" id="7425984">err</span><span class="op" id="7425987">,</span>&nbsp;<span class="builtinfunc" id="7425989">len</span><span class="op" id="7425992">(</span><span class="ident" id="7425993">buf</span><span class="op" id="7425996">)</span><span class="op" id="7425997">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426007">if</span>&nbsp;<span class="op" id="7426010">!</span><span class="ident" id="7426011">bytes</span><span class="op" id="7426016">.</span><span class="ident" id="7426017">Equal</span><span class="op" id="7426022">(</span><span class="ident" id="7426023">buf</span><span class="op" id="7426026">,</span>&nbsp;<span class="ident" id="7426028">all</span><span class="op" id="7426031">[</span><span class="ident" id="7426032">i</span><span class="op" id="7426033">:</span><span class="ident" id="7426034">i</span><span class="op" id="7426035">+</span><span class="ident" id="7426036">j</span><span class="op" id="7426037">]</span><span class="op" id="7426038">)</span>&nbsp;<span class="op" id="7426040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426046">t</span><span class="op" id="7426047">.</span><span class="ident" id="7426048">Errorf</span><span class="op" id="7426054">(</span><span class="string" id="7426055">&#34;ReadAt(%d,&nbsp;%d)&nbsp;=&nbsp;%q;&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7426085">,</span>&nbsp;<span class="ident" id="7426087">i</span><span class="op" id="7426088">,</span>&nbsp;<span class="ident" id="7426090">j</span><span class="op" id="7426091">,</span>&nbsp;<span class="ident" id="7426093">buf</span><span class="op" id="7426096">,</span>&nbsp;<span class="ident" id="7426098">all</span><span class="op" id="7426101">[</span><span class="ident" id="7426102">i</span><span class="op" id="7426103">:</span><span class="ident" id="7426104">i</span><span class="op" id="7426105">+</span><span class="ident" id="7426106">j</span><span class="op" id="7426107">]</span><span class="op" id="7426108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426113">}</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426117">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426120">}</span><br>
<span class="lineno"></span><span class="op" id="7426122">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7426125">//&nbsp;fakeHash32&nbsp;is&nbsp;a&nbsp;dummy&nbsp;Hash32&nbsp;that&nbsp;always&nbsp;returns&nbsp;0.</span><br>
<span class="lineno">220</span><span class="keyword" id="7426180">type</span>&nbsp;<span class="ident" id="7426185">fakeHash32</span>&nbsp;<span class="keyword" id="7426196">struct</span>&nbsp;<span class="op" id="7426203">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426206">hash</span><span class="op" id="7426210">.</span><span class="ident" id="7426211">Hash32</span><br>
<span class="lineno"></span><span class="op" id="7426218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7426221">func</span>&nbsp;<span class="op" id="7426226">(</span><span class="ident" id="7426227">fakeHash32</span><span class="op" id="7426237">)</span>&nbsp;<span class="ident" id="7426239">Write</span><span class="op" id="7426244">(</span><span class="ident" id="7426245">p</span>&nbsp;<span class="op" id="7426247">[</span><span class="op" id="7426248">]</span><span class="builtintype" id="7426249">byte</span><span class="op" id="7426253">)</span>&nbsp;<span class="op" id="7426255">(</span><span class="builtintype" id="7426256">int</span><span class="op" id="7426259">,</span>&nbsp;<span class="builtintype" id="7426261">error</span><span class="op" id="7426266">)</span>&nbsp;<span class="op" id="7426268">{</span>&nbsp;<span class="keyword" id="7426270">return</span>&nbsp;<span class="builtinfunc" id="7426277">len</span><span class="op" id="7426280">(</span><span class="ident" id="7426281">p</span><span class="op" id="7426282">)</span><span class="op" id="7426283">,</span>&nbsp;<span class="builtintype" id="7426285">nil</span>&nbsp;<span class="op" id="7426289">}</span><br>
<span class="lineno">225</span><span class="keyword" id="7426291">func</span>&nbsp;<span class="op" id="7426296">(</span><span class="ident" id="7426297">fakeHash32</span><span class="op" id="7426307">)</span>&nbsp;<span class="ident" id="7426309">Sum32</span><span class="op" id="7426314">(</span><span class="op" id="7426315">)</span>&nbsp;<span class="builtintype" id="7426317">uint32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426338">{</span>&nbsp;<span class="keyword" id="7426340">return</span>&nbsp;<span class="num" id="7426347">0</span>&nbsp;<span class="op" id="7426349">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7426352">func</span>&nbsp;<span class="ident" id="7426357">TestZip64</span><span class="op" id="7426366">(</span><span class="ident" id="7426367">t</span>&nbsp;<span class="op" id="7426369">*</span><span class="ident" id="7426370">testing</span><span class="op" id="7426377">.</span><span class="ident" id="7426378">T</span><span class="op" id="7426379">)</span>&nbsp;<span class="op" id="7426381">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426384">if</span>&nbsp;<span class="ident" id="7426387">testing</span><span class="op" id="7426394">.</span><span class="ident" id="7426395">Short</span><span class="op" id="7426400">(</span><span class="op" id="7426401">)</span>&nbsp;<span class="op" id="7426403">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426407">t</span><span class="op" id="7426408">.</span><span class="ident" id="7426409">Skip</span><span class="op" id="7426413">(</span><span class="string" id="7426414">&#34;slow&nbsp;test;&nbsp;skipping&#34;</span><span class="op" id="7426435">)</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426438">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426441">const</span>&nbsp;<span class="ident" id="7426447">size</span>&nbsp;<span class="op" id="7426452">=</span>&nbsp;<span class="num" id="7426454">1</span>&nbsp;<span class="op" id="7426456">&lt;&lt;</span>&nbsp;<span class="num" id="7426459">32</span>&nbsp;<span class="comment" id="7426462">//&nbsp;before&nbsp;the&nbsp;&#34;END\n&#34;&nbsp;part</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426490">testZip64</span><span class="op" id="7426499">(</span><span class="ident" id="7426500">t</span><span class="op" id="7426501">,</span>&nbsp;<span class="ident" id="7426503">size</span><span class="op" id="7426507">)</span><br>
<span class="lineno"></span><span class="op" id="7426509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">235</span><span class="keyword" id="7426512">func</span>&nbsp;<span class="ident" id="7426517">testZip64</span><span class="op" id="7426526">(</span><span class="ident" id="7426527">t</span>&nbsp;<span class="ident" id="7426529">testing</span><span class="op" id="7426536">.</span><span class="ident" id="7426537">TB</span><span class="op" id="7426539">,</span>&nbsp;<span class="ident" id="7426541">size</span>&nbsp;<span class="ident" id="7426546">int64</span><span class="op" id="7426551">)</span>&nbsp;<span class="op" id="7426553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426556">const</span>&nbsp;<span class="ident" id="7426562">chunkSize</span>&nbsp;<span class="op" id="7426572">=</span>&nbsp;<span class="num" id="7426574">1024</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426580">chunks</span>&nbsp;<span class="op" id="7426587">:=</span>&nbsp;<span class="builtintype" id="7426590">int</span><span class="op" id="7426593">(</span><span class="ident" id="7426594">size</span>&nbsp;<span class="op" id="7426599">/</span>&nbsp;<span class="ident" id="7426601">chunkSize</span><span class="op" id="7426610">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7426613">//&nbsp;write&nbsp;2^32&nbsp;bytes&nbsp;plus&nbsp;&#34;END\n&#34;&nbsp;to&nbsp;a&nbsp;zip&nbsp;file</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426661">buf</span>&nbsp;<span class="op" id="7426665">:=</span>&nbsp;<span class="builtinfunc" id="7426668">new</span><span class="op" id="7426671">(</span><span class="ident" id="7426672">rleBuffer</span><span class="op" id="7426681">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426684">w</span>&nbsp;<span class="op" id="7426686">:=</span>&nbsp;<span class="ident" id="7426689">NewWriter</span><span class="op" id="7426698">(</span><span class="ident" id="7426699">buf</span><span class="op" id="7426702">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426705">f</span><span class="op" id="7426706">,</span>&nbsp;<span class="ident" id="7426708">err</span>&nbsp;<span class="op" id="7426712">:=</span>&nbsp;<span class="ident" id="7426715">w</span><span class="op" id="7426716">.</span><span class="ident" id="7426717">CreateHeader</span><span class="op" id="7426729">(</span><span class="op" id="7426730">&amp;</span><span class="ident" id="7426731">FileHeader</span><span class="op" id="7426741">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426745">Name</span><span class="op" id="7426749">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7426753">&#34;huge.txt&#34;</span><span class="op" id="7426763">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426767">Method</span><span class="op" id="7426773">:</span>&nbsp;<span class="ident" id="7426775">Store</span><span class="op" id="7426780">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426783">}</span><span class="op" id="7426784">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426787">if</span>&nbsp;<span class="ident" id="7426790">err</span>&nbsp;<span class="op" id="7426794">!=</span>&nbsp;<span class="builtintype" id="7426797">nil</span>&nbsp;<span class="op" id="7426801">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426805">t</span><span class="op" id="7426806">.</span><span class="ident" id="7426807">Fatal</span><span class="op" id="7426812">(</span><span class="ident" id="7426813">err</span><span class="op" id="7426816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426819">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426822">f</span><span class="op" id="7426823">.</span><span class="op" id="7426824">(</span><span class="op" id="7426825">*</span><span class="ident" id="7426826">fileWriter</span><span class="op" id="7426836">)</span><span class="op" id="7426837">.</span><span class="ident" id="7426838">crc32</span>&nbsp;<span class="op" id="7426844">=</span>&nbsp;<span class="ident" id="7426846">fakeHash32</span><span class="op" id="7426856">{</span><span class="op" id="7426857">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426860">chunk</span>&nbsp;<span class="op" id="7426866">:=</span>&nbsp;<span class="builtinfunc" id="7426869">make</span><span class="op" id="7426873">(</span><span class="op" id="7426874">[</span><span class="op" id="7426875">]</span><span class="builtintype" id="7426876">byte</span><span class="op" id="7426880">,</span>&nbsp;<span class="ident" id="7426882">chunkSize</span><span class="op" id="7426891">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426894">for</span>&nbsp;<span class="ident" id="7426898">i</span>&nbsp;<span class="op" id="7426900">:=</span>&nbsp;<span class="keyword" id="7426903">range</span>&nbsp;<span class="ident" id="7426909">chunk</span>&nbsp;<span class="op" id="7426915">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426919">chunk</span><span class="op" id="7426924">[</span><span class="ident" id="7426925">i</span><span class="op" id="7426926">]</span>&nbsp;<span class="op" id="7426928">=</span>&nbsp;<span class="string" id="7426930">&#39;.&#39;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7426935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426938">for</span>&nbsp;<span class="ident" id="7426942">i</span>&nbsp;<span class="op" id="7426944">:=</span>&nbsp;<span class="num" id="7426947">0</span><span class="op" id="7426948">;</span>&nbsp;<span class="ident" id="7426950">i</span>&nbsp;<span class="op" id="7426952">&lt;</span>&nbsp;<span class="ident" id="7426954">chunks</span><span class="op" id="7426960">;</span>&nbsp;<span class="ident" id="7426962">i</span><span class="op" id="7426963">++</span>&nbsp;<span class="op" id="7426966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7426970">_</span><span class="op" id="7426971">,</span>&nbsp;<span class="ident" id="7426973">err</span>&nbsp;<span class="op" id="7426977">:=</span>&nbsp;<span class="ident" id="7426980">f</span><span class="op" id="7426981">.</span><span class="ident" id="7426982">Write</span><span class="op" id="7426987">(</span><span class="ident" id="7426988">chunk</span><span class="op" id="7426993">)</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7426997">if</span>&nbsp;<span class="ident" id="7427000">err</span>&nbsp;<span class="op" id="7427004">!=</span>&nbsp;<span class="builtintype" id="7427007">nil</span>&nbsp;<span class="op" id="7427011">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427016">t</span><span class="op" id="7427017">.</span><span class="ident" id="7427018">Fatal</span><span class="op" id="7427023">(</span><span class="string" id="7427024">&#34;write&nbsp;chunk:&#34;</span><span class="op" id="7427038">,</span>&nbsp;<span class="ident" id="7427040">err</span><span class="op" id="7427043">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427053">end</span>&nbsp;<span class="op" id="7427057">:=</span>&nbsp;<span class="op" id="7427060">[</span><span class="op" id="7427061">]</span><span class="builtintype" id="7427062">byte</span><span class="op" id="7427066">(</span><span class="string" id="7427067">&#34;END\n&#34;</span><span class="op" id="7427074">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427077">_</span><span class="op" id="7427078">,</span>&nbsp;<span class="ident" id="7427080">err</span>&nbsp;<span class="op" id="7427084">=</span>&nbsp;<span class="ident" id="7427086">f</span><span class="op" id="7427087">.</span><span class="ident" id="7427088">Write</span><span class="op" id="7427093">(</span><span class="ident" id="7427094">end</span><span class="op" id="7427097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427100">if</span>&nbsp;<span class="ident" id="7427103">err</span>&nbsp;<span class="op" id="7427107">!=</span>&nbsp;<span class="builtintype" id="7427110">nil</span>&nbsp;<span class="op" id="7427114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427118">t</span><span class="op" id="7427119">.</span><span class="ident" id="7427120">Fatal</span><span class="op" id="7427125">(</span><span class="string" id="7427126">&#34;write&nbsp;end:&#34;</span><span class="op" id="7427138">,</span>&nbsp;<span class="ident" id="7427140">err</span><span class="op" id="7427143">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427146">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427149">if</span>&nbsp;<span class="ident" id="7427152">err</span>&nbsp;<span class="op" id="7427156">:=</span>&nbsp;<span class="ident" id="7427159">w</span><span class="op" id="7427160">.</span><span class="ident" id="7427161">Close</span><span class="op" id="7427166">(</span><span class="op" id="7427167">)</span><span class="op" id="7427168">;</span>&nbsp;<span class="ident" id="7427170">err</span>&nbsp;<span class="op" id="7427174">!=</span>&nbsp;<span class="builtintype" id="7427177">nil</span>&nbsp;<span class="op" id="7427181">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427185">t</span><span class="op" id="7427186">.</span><span class="ident" id="7427187">Fatal</span><span class="op" id="7427192">(</span><span class="ident" id="7427193">err</span><span class="op" id="7427196">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427199">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="7427203">//&nbsp;read&nbsp;back&nbsp;zip&nbsp;file&nbsp;and&nbsp;check&nbsp;that&nbsp;we&nbsp;get&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427265">r</span><span class="op" id="7427266">,</span>&nbsp;<span class="ident" id="7427268">err</span>&nbsp;<span class="op" id="7427272">:=</span>&nbsp;<span class="ident" id="7427275">NewReader</span><span class="op" id="7427284">(</span><span class="ident" id="7427285">buf</span><span class="op" id="7427288">,</span>&nbsp;<span class="ident" id="7427290">int64</span><span class="op" id="7427295">(</span><span class="ident" id="7427296">buf</span><span class="op" id="7427299">.</span><span class="ident" id="7427300">Size</span><span class="op" id="7427304">(</span><span class="op" id="7427305">)</span><span class="op" id="7427306">)</span><span class="op" id="7427307">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427310">if</span>&nbsp;<span class="ident" id="7427313">err</span>&nbsp;<span class="op" id="7427317">!=</span>&nbsp;<span class="builtintype" id="7427320">nil</span>&nbsp;<span class="op" id="7427324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427328">t</span><span class="op" id="7427329">.</span><span class="ident" id="7427330">Fatal</span><span class="op" id="7427335">(</span><span class="string" id="7427336">&#34;reader:&#34;</span><span class="op" id="7427345">,</span>&nbsp;<span class="ident" id="7427347">err</span><span class="op" id="7427350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427353">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427356">f0</span>&nbsp;<span class="op" id="7427359">:=</span>&nbsp;<span class="ident" id="7427362">r</span><span class="op" id="7427363">.</span><span class="ident" id="7427364">File</span><span class="op" id="7427368">[</span><span class="num" id="7427369">0</span><span class="op" id="7427370">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427373">rc</span><span class="op" id="7427375">,</span>&nbsp;<span class="ident" id="7427377">err</span>&nbsp;<span class="op" id="7427381">:=</span>&nbsp;<span class="ident" id="7427384">f0</span><span class="op" id="7427386">.</span><span class="ident" id="7427387">Open</span><span class="op" id="7427391">(</span><span class="op" id="7427392">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427395">if</span>&nbsp;<span class="ident" id="7427398">err</span>&nbsp;<span class="op" id="7427402">!=</span>&nbsp;<span class="builtintype" id="7427405">nil</span>&nbsp;<span class="op" id="7427409">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427413">t</span><span class="op" id="7427414">.</span><span class="ident" id="7427415">Fatal</span><span class="op" id="7427420">(</span><span class="string" id="7427421">&#34;opening:&#34;</span><span class="op" id="7427431">,</span>&nbsp;<span class="ident" id="7427433">err</span><span class="op" id="7427436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427439">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427442">rc</span><span class="op" id="7427444">.</span><span class="op" id="7427445">(</span><span class="op" id="7427446">*</span><span class="ident" id="7427447">checksumReader</span><span class="op" id="7427461">)</span><span class="op" id="7427462">.</span><span class="ident" id="7427463">hash</span>&nbsp;<span class="op" id="7427468">=</span>&nbsp;<span class="ident" id="7427470">fakeHash32</span><span class="op" id="7427480">{</span><span class="op" id="7427481">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427484">for</span>&nbsp;<span class="ident" id="7427488">i</span>&nbsp;<span class="op" id="7427490">:=</span>&nbsp;<span class="num" id="7427493">0</span><span class="op" id="7427494">;</span>&nbsp;<span class="ident" id="7427496">i</span>&nbsp;<span class="op" id="7427498">&lt;</span>&nbsp;<span class="ident" id="7427500">chunks</span><span class="op" id="7427506">;</span>&nbsp;<span class="ident" id="7427508">i</span><span class="op" id="7427509">++</span>&nbsp;<span class="op" id="7427512">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427516">_</span><span class="op" id="7427517">,</span>&nbsp;<span class="ident" id="7427519">err</span>&nbsp;<span class="op" id="7427523">:=</span>&nbsp;<span class="ident" id="7427526">io</span><span class="op" id="7427528">.</span><span class="ident" id="7427529">ReadFull</span><span class="op" id="7427537">(</span><span class="ident" id="7427538">rc</span><span class="op" id="7427540">,</span>&nbsp;<span class="ident" id="7427542">chunk</span><span class="op" id="7427547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427551">if</span>&nbsp;<span class="ident" id="7427554">err</span>&nbsp;<span class="op" id="7427558">!=</span>&nbsp;<span class="builtintype" id="7427561">nil</span>&nbsp;<span class="op" id="7427565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427570">t</span><span class="op" id="7427571">.</span><span class="ident" id="7427572">Fatal</span><span class="op" id="7427577">(</span><span class="string" id="7427578">&#34;read:&#34;</span><span class="op" id="7427585">,</span>&nbsp;<span class="ident" id="7427587">err</span><span class="op" id="7427590">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427594">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427597">}</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427600">gotEnd</span><span class="op" id="7427606">,</span>&nbsp;<span class="ident" id="7427608">err</span>&nbsp;<span class="op" id="7427612">:=</span>&nbsp;<span class="ident" id="7427615">ioutil</span><span class="op" id="7427621">.</span><span class="ident" id="7427622">ReadAll</span><span class="op" id="7427629">(</span><span class="ident" id="7427630">rc</span><span class="op" id="7427632">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427635">if</span>&nbsp;<span class="ident" id="7427638">err</span>&nbsp;<span class="op" id="7427642">!=</span>&nbsp;<span class="builtintype" id="7427645">nil</span>&nbsp;<span class="op" id="7427649">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427653">t</span><span class="op" id="7427654">.</span><span class="ident" id="7427655">Fatal</span><span class="op" id="7427660">(</span><span class="string" id="7427661">&#34;read&nbsp;end:&#34;</span><span class="op" id="7427672">,</span>&nbsp;<span class="ident" id="7427674">err</span><span class="op" id="7427677">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427680">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427683">if</span>&nbsp;<span class="op" id="7427686">!</span><span class="ident" id="7427687">bytes</span><span class="op" id="7427692">.</span><span class="ident" id="7427693">Equal</span><span class="op" id="7427698">(</span><span class="ident" id="7427699">gotEnd</span><span class="op" id="7427705">,</span>&nbsp;<span class="ident" id="7427707">end</span><span class="op" id="7427710">)</span>&nbsp;<span class="op" id="7427712">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427716">t</span><span class="op" id="7427717">.</span><span class="ident" id="7427718">Errorf</span><span class="op" id="7427724">(</span><span class="string" id="7427725">&#34;End&nbsp;of&nbsp;zip64&nbsp;archive&nbsp;%q,&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7427759">,</span>&nbsp;<span class="ident" id="7427761">gotEnd</span><span class="op" id="7427767">,</span>&nbsp;<span class="ident" id="7427769">end</span><span class="op" id="7427772">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427775">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427778">err</span>&nbsp;<span class="op" id="7427782">=</span>&nbsp;<span class="ident" id="7427784">rc</span><span class="op" id="7427786">.</span><span class="ident" id="7427787">Close</span><span class="op" id="7427792">(</span><span class="op" id="7427793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427796">if</span>&nbsp;<span class="ident" id="7427799">err</span>&nbsp;<span class="op" id="7427803">!=</span>&nbsp;<span class="builtintype" id="7427806">nil</span>&nbsp;<span class="op" id="7427810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427814">t</span><span class="op" id="7427815">.</span><span class="ident" id="7427816">Fatal</span><span class="op" id="7427821">(</span><span class="string" id="7427822">&#34;closing:&#34;</span><span class="op" id="7427832">,</span>&nbsp;<span class="ident" id="7427834">err</span><span class="op" id="7427837">)</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427840">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427843">if</span>&nbsp;<span class="ident" id="7427846">size</span>&nbsp;<span class="op" id="7427851">==</span>&nbsp;<span class="num" id="7427854">1</span><span class="op" id="7427855">&lt;&lt;</span><span class="num" id="7427857">32</span>&nbsp;<span class="op" id="7427860">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427864">if</span>&nbsp;<span class="ident" id="7427867">got</span><span class="op" id="7427870">,</span>&nbsp;<span class="ident" id="7427872">want</span>&nbsp;<span class="op" id="7427877">:=</span>&nbsp;<span class="ident" id="7427880">f0</span><span class="op" id="7427882">.</span><span class="ident" id="7427883">UncompressedSize</span><span class="op" id="7427899">,</span>&nbsp;<span class="builtintype" id="7427901">uint32</span><span class="op" id="7427907">(</span><span class="ident" id="7427908">uint32max</span><span class="op" id="7427917">)</span><span class="op" id="7427918">;</span>&nbsp;<span class="ident" id="7427920">got</span>&nbsp;<span class="op" id="7427924">!=</span>&nbsp;<span class="ident" id="7427927">want</span>&nbsp;<span class="op" id="7427932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7427937">t</span><span class="op" id="7427938">.</span><span class="ident" id="7427939">Errorf</span><span class="op" id="7427945">(</span><span class="string" id="7427946">&#34;UncompressedSize&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7427976">,</span>&nbsp;<span class="ident" id="7427978">got</span><span class="op" id="7427981">,</span>&nbsp;<span class="ident" id="7427983">want</span><span class="op" id="7427987">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427991">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7427994">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7427998">if</span>&nbsp;<span class="ident" id="7428001">got</span><span class="op" id="7428004">,</span>&nbsp;<span class="ident" id="7428006">want</span>&nbsp;<span class="op" id="7428011">:=</span>&nbsp;<span class="ident" id="7428014">f0</span><span class="op" id="7428016">.</span><span class="ident" id="7428017">UncompressedSize64</span><span class="op" id="7428035">,</span>&nbsp;<span class="ident" id="7428037">uint64</span><span class="op" id="7428043">(</span><span class="ident" id="7428044">size</span><span class="op" id="7428048">)</span><span class="op" id="7428049">+</span><span class="ident" id="7428050">uint64</span><span class="op" id="7428056">(</span><span class="builtinfunc" id="7428057">len</span><span class="op" id="7428060">(</span><span class="ident" id="7428061">end</span><span class="op" id="7428064">)</span><span class="op" id="7428065">)</span><span class="op" id="7428066">;</span>&nbsp;<span class="ident" id="7428068">got</span>&nbsp;<span class="op" id="7428072">!=</span>&nbsp;<span class="ident" id="7428075">want</span>&nbsp;<span class="op" id="7428080">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428084">t</span><span class="op" id="7428085">.</span><span class="ident" id="7428086">Errorf</span><span class="op" id="7428092">(</span><span class="string" id="7428093">&#34;UncompressedSize64&nbsp;%d,&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7428125">,</span>&nbsp;<span class="ident" id="7428127">got</span><span class="op" id="7428130">,</span>&nbsp;<span class="ident" id="7428132">want</span><span class="op" id="7428136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428139">}</span><br>
<span class="lineno">305</span><span class="op" id="7428141">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7428144">func</span>&nbsp;<span class="ident" id="7428149">testInvalidHeader</span><span class="op" id="7428166">(</span><span class="ident" id="7428167">h</span>&nbsp;<span class="op" id="7428169">*</span><span class="ident" id="7428170">FileHeader</span><span class="op" id="7428180">,</span>&nbsp;<span class="ident" id="7428182">t</span>&nbsp;<span class="op" id="7428184">*</span><span class="ident" id="7428185">testing</span><span class="op" id="7428192">.</span><span class="ident" id="7428193">T</span><span class="op" id="7428194">)</span>&nbsp;<span class="op" id="7428196">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428199">var</span>&nbsp;<span class="ident" id="7428203">buf</span>&nbsp;<span class="ident" id="7428207">bytes</span><span class="op" id="7428212">.</span><span class="ident" id="7428213">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428221">z</span>&nbsp;<span class="op" id="7428223">:=</span>&nbsp;<span class="ident" id="7428226">NewWriter</span><span class="op" id="7428235">(</span><span class="op" id="7428236">&amp;</span><span class="ident" id="7428237">buf</span><span class="op" id="7428240">)</span><br>
<span class="lineno">310</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428244">f</span><span class="op" id="7428245">,</span>&nbsp;<span class="ident" id="7428247">err</span>&nbsp;<span class="op" id="7428251">:=</span>&nbsp;<span class="ident" id="7428254">z</span><span class="op" id="7428255">.</span><span class="ident" id="7428256">CreateHeader</span><span class="op" id="7428268">(</span><span class="ident" id="7428269">h</span><span class="op" id="7428270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428273">if</span>&nbsp;<span class="ident" id="7428276">err</span>&nbsp;<span class="op" id="7428280">!=</span>&nbsp;<span class="builtintype" id="7428283">nil</span>&nbsp;<span class="op" id="7428287">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428291">t</span><span class="op" id="7428292">.</span><span class="ident" id="7428293">Fatalf</span><span class="op" id="7428299">(</span><span class="string" id="7428300">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7428327">,</span>&nbsp;<span class="ident" id="7428329">err</span><span class="op" id="7428332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428335">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428338">if</span>&nbsp;<span class="ident" id="7428341">_</span><span class="op" id="7428342">,</span>&nbsp;<span class="ident" id="7428344">err</span>&nbsp;<span class="op" id="7428348">:=</span>&nbsp;<span class="ident" id="7428351">f</span><span class="op" id="7428352">.</span><span class="ident" id="7428353">Write</span><span class="op" id="7428358">(</span><span class="op" id="7428359">[</span><span class="op" id="7428360">]</span><span class="builtintype" id="7428361">byte</span><span class="op" id="7428365">(</span><span class="string" id="7428366">&#34;hi&#34;</span><span class="op" id="7428370">)</span><span class="op" id="7428371">)</span><span class="op" id="7428372">;</span>&nbsp;<span class="ident" id="7428374">err</span>&nbsp;<span class="op" id="7428378">!=</span>&nbsp;<span class="builtintype" id="7428381">nil</span>&nbsp;<span class="op" id="7428385">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428389">t</span><span class="op" id="7428390">.</span><span class="ident" id="7428391">Fatalf</span><span class="op" id="7428397">(</span><span class="string" id="7428398">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7428425">,</span>&nbsp;<span class="ident" id="7428427">err</span><span class="op" id="7428430">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428433">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428436">if</span>&nbsp;<span class="ident" id="7428439">err</span>&nbsp;<span class="op" id="7428443">:=</span>&nbsp;<span class="ident" id="7428446">z</span><span class="op" id="7428447">.</span><span class="ident" id="7428448">Close</span><span class="op" id="7428453">(</span><span class="op" id="7428454">)</span><span class="op" id="7428455">;</span>&nbsp;<span class="ident" id="7428457">err</span>&nbsp;<span class="op" id="7428461">!=</span>&nbsp;<span class="builtintype" id="7428464">nil</span>&nbsp;<span class="op" id="7428468">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428472">t</span><span class="op" id="7428473">.</span><span class="ident" id="7428474">Fatalf</span><span class="op" id="7428480">(</span><span class="string" id="7428481">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7428511">,</span>&nbsp;<span class="ident" id="7428513">err</span><span class="op" id="7428516">)</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428519">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428523">b</span>&nbsp;<span class="op" id="7428525">:=</span>&nbsp;<span class="ident" id="7428528">buf</span><span class="op" id="7428531">.</span><span class="ident" id="7428532">Bytes</span><span class="op" id="7428537">(</span><span class="op" id="7428538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428541">if</span>&nbsp;<span class="ident" id="7428544">_</span><span class="op" id="7428545">,</span>&nbsp;<span class="ident" id="7428547">err</span>&nbsp;<span class="op" id="7428551">=</span>&nbsp;<span class="ident" id="7428553">NewReader</span><span class="op" id="7428562">(</span><span class="ident" id="7428563">bytes</span><span class="op" id="7428568">.</span><span class="ident" id="7428569">NewReader</span><span class="op" id="7428578">(</span><span class="ident" id="7428579">b</span><span class="op" id="7428580">)</span><span class="op" id="7428581">,</span>&nbsp;<span class="ident" id="7428583">int64</span><span class="op" id="7428588">(</span><span class="builtinfunc" id="7428589">len</span><span class="op" id="7428592">(</span><span class="ident" id="7428593">b</span><span class="op" id="7428594">)</span><span class="op" id="7428595">)</span><span class="op" id="7428596">)</span><span class="op" id="7428597">;</span>&nbsp;<span class="ident" id="7428599">err</span>&nbsp;<span class="op" id="7428603">!=</span>&nbsp;<span class="ident" id="7428606">ErrFormat</span>&nbsp;<span class="op" id="7428616">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428620">t</span><span class="op" id="7428621">.</span><span class="ident" id="7428622">Fatalf</span><span class="op" id="7428628">(</span><span class="string" id="7428629">&#34;got&nbsp;%v,&nbsp;expected&nbsp;ErrFormat&#34;</span><span class="op" id="7428657">,</span>&nbsp;<span class="ident" id="7428659">err</span><span class="op" id="7428662">)</span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428665">}</span><br>
<span class="lineno"></span><span class="op" id="7428667">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7428670">func</span>&nbsp;<span class="ident" id="7428675">testValidHeader</span><span class="op" id="7428690">(</span><span class="ident" id="7428691">h</span>&nbsp;<span class="op" id="7428693">*</span><span class="ident" id="7428694">FileHeader</span><span class="op" id="7428704">,</span>&nbsp;<span class="ident" id="7428706">t</span>&nbsp;<span class="op" id="7428708">*</span><span class="ident" id="7428709">testing</span><span class="op" id="7428716">.</span><span class="ident" id="7428717">T</span><span class="op" id="7428718">)</span>&nbsp;<span class="op" id="7428720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428723">var</span>&nbsp;<span class="ident" id="7428727">buf</span>&nbsp;<span class="ident" id="7428731">bytes</span><span class="op" id="7428736">.</span><span class="ident" id="7428737">Buffer</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428745">z</span>&nbsp;<span class="op" id="7428747">:=</span>&nbsp;<span class="ident" id="7428750">NewWriter</span><span class="op" id="7428759">(</span><span class="op" id="7428760">&amp;</span><span class="ident" id="7428761">buf</span><span class="op" id="7428764">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428768">f</span><span class="op" id="7428769">,</span>&nbsp;<span class="ident" id="7428771">err</span>&nbsp;<span class="op" id="7428775">:=</span>&nbsp;<span class="ident" id="7428778">z</span><span class="op" id="7428779">.</span><span class="ident" id="7428780">CreateHeader</span><span class="op" id="7428792">(</span><span class="ident" id="7428793">h</span><span class="op" id="7428794">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428797">if</span>&nbsp;<span class="ident" id="7428800">err</span>&nbsp;<span class="op" id="7428804">!=</span>&nbsp;<span class="builtintype" id="7428807">nil</span>&nbsp;<span class="op" id="7428811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428815">t</span><span class="op" id="7428816">.</span><span class="ident" id="7428817">Fatalf</span><span class="op" id="7428823">(</span><span class="string" id="7428824">&#34;error&nbsp;creating&nbsp;header:&nbsp;%v&#34;</span><span class="op" id="7428851">,</span>&nbsp;<span class="ident" id="7428853">err</span><span class="op" id="7428856">)</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428859">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428862">if</span>&nbsp;<span class="ident" id="7428865">_</span><span class="op" id="7428866">,</span>&nbsp;<span class="ident" id="7428868">err</span>&nbsp;<span class="op" id="7428872">:=</span>&nbsp;<span class="ident" id="7428875">f</span><span class="op" id="7428876">.</span><span class="ident" id="7428877">Write</span><span class="op" id="7428882">(</span><span class="op" id="7428883">[</span><span class="op" id="7428884">]</span><span class="builtintype" id="7428885">byte</span><span class="op" id="7428889">(</span><span class="string" id="7428890">&#34;hi&#34;</span><span class="op" id="7428894">)</span><span class="op" id="7428895">)</span><span class="op" id="7428896">;</span>&nbsp;<span class="ident" id="7428898">err</span>&nbsp;<span class="op" id="7428902">!=</span>&nbsp;<span class="builtintype" id="7428905">nil</span>&nbsp;<span class="op" id="7428909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428913">t</span><span class="op" id="7428914">.</span><span class="ident" id="7428915">Fatalf</span><span class="op" id="7428921">(</span><span class="string" id="7428922">&#34;error&nbsp;writing&nbsp;content:&nbsp;%v&#34;</span><span class="op" id="7428949">,</span>&nbsp;<span class="ident" id="7428951">err</span><span class="op" id="7428954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7428957">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7428960">if</span>&nbsp;<span class="ident" id="7428963">err</span>&nbsp;<span class="op" id="7428967">:=</span>&nbsp;<span class="ident" id="7428970">z</span><span class="op" id="7428971">.</span><span class="ident" id="7428972">Close</span><span class="op" id="7428977">(</span><span class="op" id="7428978">)</span><span class="op" id="7428979">;</span>&nbsp;<span class="ident" id="7428981">err</span>&nbsp;<span class="op" id="7428985">!=</span>&nbsp;<span class="builtintype" id="7428988">nil</span>&nbsp;<span class="op" id="7428992">{</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7428996">t</span><span class="op" id="7428997">.</span><span class="ident" id="7428998">Fatalf</span><span class="op" id="7429004">(</span><span class="string" id="7429005">&#34;error&nbsp;closing&nbsp;zip&nbsp;writer:&nbsp;%v&#34;</span><span class="op" id="7429035">,</span>&nbsp;<span class="ident" id="7429037">err</span><span class="op" id="7429040">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7429043">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429047">b</span>&nbsp;<span class="op" id="7429049">:=</span>&nbsp;<span class="ident" id="7429052">buf</span><span class="op" id="7429055">.</span><span class="ident" id="7429056">Bytes</span><span class="op" id="7429061">(</span><span class="op" id="7429062">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7429065">if</span>&nbsp;<span class="ident" id="7429068">_</span><span class="op" id="7429069">,</span>&nbsp;<span class="ident" id="7429071">err</span>&nbsp;<span class="op" id="7429075">=</span>&nbsp;<span class="ident" id="7429077">NewReader</span><span class="op" id="7429086">(</span><span class="ident" id="7429087">bytes</span><span class="op" id="7429092">.</span><span class="ident" id="7429093">NewReader</span><span class="op" id="7429102">(</span><span class="ident" id="7429103">b</span><span class="op" id="7429104">)</span><span class="op" id="7429105">,</span>&nbsp;<span class="ident" id="7429107">int64</span><span class="op" id="7429112">(</span><span class="builtinfunc" id="7429113">len</span><span class="op" id="7429116">(</span><span class="ident" id="7429117">b</span><span class="op" id="7429118">)</span><span class="op" id="7429119">)</span><span class="op" id="7429120">)</span><span class="op" id="7429121">;</span>&nbsp;<span class="ident" id="7429123">err</span>&nbsp;<span class="op" id="7429127">!=</span>&nbsp;<span class="builtintype" id="7429130">nil</span>&nbsp;<span class="op" id="7429134">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429138">t</span><span class="op" id="7429139">.</span><span class="ident" id="7429140">Fatalf</span><span class="op" id="7429146">(</span><span class="string" id="7429147">&#34;got&nbsp;%v,&nbsp;expected&nbsp;nil&#34;</span><span class="op" id="7429169">,</span>&nbsp;<span class="ident" id="7429171">err</span><span class="op" id="7429174">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7429177">}</span><br>
<span class="lineno"></span><span class="op" id="7429179">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7429182">//&nbsp;Issue&nbsp;4302.</span><br>
<span class="lineno">350</span><span class="keyword" id="7429197">func</span>&nbsp;<span class="ident" id="7429202">TestHeaderInvalidTagAndSize</span><span class="op" id="7429229">(</span><span class="ident" id="7429230">t</span>&nbsp;<span class="op" id="7429232">*</span><span class="ident" id="7429233">testing</span><span class="op" id="7429240">.</span><span class="ident" id="7429241">T</span><span class="op" id="7429242">)</span>&nbsp;<span class="op" id="7429244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7429247">const</span>&nbsp;<span class="ident" id="7429253">timeFormat</span>&nbsp;<span class="op" id="7429264">=</span>&nbsp;<span class="string" id="7429266">&#34;20060102T150405.000.txt&#34;</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429294">ts</span>&nbsp;<span class="op" id="7429297">:=</span>&nbsp;<span class="ident" id="7429300">time</span><span class="op" id="7429304">.</span><span class="ident" id="7429305">Now</span><span class="op" id="7429308">(</span><span class="op" id="7429309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429312">filename</span>&nbsp;<span class="op" id="7429321">:=</span>&nbsp;<span class="ident" id="7429324">ts</span><span class="op" id="7429326">.</span><span class="ident" id="7429327">Format</span><span class="op" id="7429333">(</span><span class="ident" id="7429334">timeFormat</span><span class="op" id="7429344">)</span><br>
<span class="lineno">355</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429348">h</span>&nbsp;<span class="op" id="7429350">:=</span>&nbsp;<span class="ident" id="7429353">FileHeader</span><span class="op" id="7429363">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429367">Name</span><span class="op" id="7429371">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="7429375">filename</span><span class="op" id="7429383">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429387">Method</span><span class="op" id="7429393">:</span>&nbsp;<span class="ident" id="7429395">Deflate</span><span class="op" id="7429402">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429406">Extra</span><span class="op" id="7429411">:</span>&nbsp;&nbsp;<span class="op" id="7429414">[</span><span class="op" id="7429415">]</span><span class="builtintype" id="7429416">byte</span><span class="op" id="7429420">(</span><span class="ident" id="7429421">ts</span><span class="op" id="7429423">.</span><span class="ident" id="7429424">Format</span><span class="op" id="7429430">(</span><span class="ident" id="7429431">time</span><span class="op" id="7429435">.</span><span class="ident" id="7429436">RFC3339Nano</span><span class="op" id="7429447">)</span><span class="op" id="7429448">)</span><span class="op" id="7429449">,</span>&nbsp;<span class="comment" id="7429451">//&nbsp;missing&nbsp;tag&nbsp;and&nbsp;len</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7429475">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429478">h</span><span class="op" id="7429479">.</span><span class="ident" id="7429480">SetModTime</span><span class="op" id="7429490">(</span><span class="ident" id="7429491">ts</span><span class="op" id="7429493">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429497">testInvalidHeader</span><span class="op" id="7429514">(</span><span class="op" id="7429515">&amp;</span><span class="ident" id="7429516">h</span><span class="op" id="7429517">,</span>&nbsp;<span class="ident" id="7429519">t</span><span class="op" id="7429520">)</span><br>
<span class="lineno"></span><span class="op" id="7429522">}</span><br>
<span class="lineno">365</span><br>
<span class="lineno"></span><span class="keyword" id="7429525">func</span>&nbsp;<span class="ident" id="7429530">TestHeaderTooShort</span><span class="op" id="7429548">(</span><span class="ident" id="7429549">t</span>&nbsp;<span class="op" id="7429551">*</span><span class="ident" id="7429552">testing</span><span class="op" id="7429559">.</span><span class="ident" id="7429560">T</span><span class="op" id="7429561">)</span>&nbsp;<span class="op" id="7429563">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429566">h</span>&nbsp;<span class="op" id="7429568">:=</span>&nbsp;<span class="ident" id="7429571">FileHeader</span><span class="op" id="7429581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429585">Name</span><span class="op" id="7429589">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7429593">&#34;foo.txt&#34;</span><span class="op" id="7429602">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429606">Method</span><span class="op" id="7429612">:</span>&nbsp;<span class="ident" id="7429614">Deflate</span><span class="op" id="7429621">,</span><br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429625">Extra</span><span class="op" id="7429630">:</span>&nbsp;&nbsp;<span class="op" id="7429633">[</span><span class="op" id="7429634">]</span><span class="builtintype" id="7429635">byte</span><span class="op" id="7429639">{</span><span class="ident" id="7429640">zip64ExtraId</span><span class="op" id="7429652">}</span><span class="op" id="7429653">,</span>&nbsp;<span class="comment" id="7429655">//&nbsp;missing&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7429672">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429675">testInvalidHeader</span><span class="op" id="7429692">(</span><span class="op" id="7429693">&amp;</span><span class="ident" id="7429694">h</span><span class="op" id="7429695">,</span>&nbsp;<span class="ident" id="7429697">t</span><span class="op" id="7429698">)</span><br>
<span class="lineno"></span><span class="op" id="7429700">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">375</span><span class="comment" id="7429703">//&nbsp;Issue&nbsp;4393.&nbsp;It&nbsp;is&nbsp;valid&nbsp;to&nbsp;have&nbsp;an&nbsp;extra&nbsp;data&nbsp;header</span><br>
<span class="lineno"></span><span class="comment" id="7429759">//&nbsp;which&nbsp;contains&nbsp;no&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="7429786">func</span>&nbsp;<span class="ident" id="7429791">TestZeroLengthHeader</span><span class="op" id="7429811">(</span><span class="ident" id="7429812">t</span>&nbsp;<span class="op" id="7429814">*</span><span class="ident" id="7429815">testing</span><span class="op" id="7429822">.</span><span class="ident" id="7429823">T</span><span class="op" id="7429824">)</span>&nbsp;<span class="op" id="7429826">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429829">h</span>&nbsp;<span class="op" id="7429831">:=</span>&nbsp;<span class="ident" id="7429834">FileHeader</span><span class="op" id="7429844">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429848">Name</span><span class="op" id="7429852">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7429856">&#34;extadata.txt&#34;</span><span class="op" id="7429870">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429874">Method</span><span class="op" id="7429880">:</span>&nbsp;<span class="ident" id="7429882">Deflate</span><span class="op" id="7429889">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7429893">Extra</span><span class="op" id="7429898">:</span>&nbsp;<span class="op" id="7429900">[</span><span class="op" id="7429901">]</span><span class="builtintype" id="7429902">byte</span><span class="op" id="7429906">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7429911">85</span><span class="op" id="7429913">,</span>&nbsp;<span class="num" id="7429915">84</span><span class="op" id="7429917">,</span>&nbsp;<span class="num" id="7429919">5</span><span class="op" id="7429920">,</span>&nbsp;<span class="num" id="7429922">0</span><span class="op" id="7429923">,</span>&nbsp;<span class="num" id="7429925">3</span><span class="op" id="7429926">,</span>&nbsp;<span class="num" id="7429928">154</span><span class="op" id="7429931">,</span>&nbsp;<span class="num" id="7429933">144</span><span class="op" id="7429936">,</span>&nbsp;<span class="num" id="7429938">195</span><span class="op" id="7429941">,</span>&nbsp;<span class="num" id="7429943">77</span><span class="op" id="7429945">,</span>&nbsp;<span class="comment" id="7429947">//&nbsp;tag&nbsp;21589&nbsp;size&nbsp;5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="num" id="7429970">85</span><span class="op" id="7429972">,</span>&nbsp;<span class="num" id="7429974">120</span><span class="op" id="7429977">,</span>&nbsp;<span class="num" id="7429979">0</span><span class="op" id="7429980">,</span>&nbsp;<span class="num" id="7429982">0</span><span class="op" id="7429983">,</span>&nbsp;<span class="comment" id="7429985">//&nbsp;tag&nbsp;30805&nbsp;size&nbsp;0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430007">}</span><span class="op" id="7430008">,</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430014">testValidHeader</span><span class="op" id="7430029">(</span><span class="op" id="7430030">&amp;</span><span class="ident" id="7430031">h</span><span class="op" id="7430032">,</span>&nbsp;<span class="ident" id="7430034">t</span><span class="op" id="7430035">)</span><br>
<span class="lineno"></span><span class="op" id="7430037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7430040">//&nbsp;Just&nbsp;benchmarking&nbsp;how&nbsp;fast&nbsp;the&nbsp;Zip64&nbsp;test&nbsp;above&nbsp;is.&nbsp;Not&nbsp;related&nbsp;to</span><br>
<span class="lineno">390</span><span class="comment" id="7430110">//&nbsp;our&nbsp;zip&nbsp;performance,&nbsp;since&nbsp;the&nbsp;test&nbsp;above&nbsp;disabled&nbsp;CRC32&nbsp;and&nbsp;flate.</span><br>
<span class="lineno"></span><span class="keyword" id="7430181">func</span>&nbsp;<span class="ident" id="7430186">BenchmarkZip64Test</span><span class="op" id="7430204">(</span><span class="ident" id="7430205">b</span>&nbsp;<span class="op" id="7430207">*</span><span class="ident" id="7430208">testing</span><span class="op" id="7430215">.</span><span class="ident" id="7430216">B</span><span class="op" id="7430217">)</span>&nbsp;<span class="op" id="7430219">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="7430222">for</span>&nbsp;<span class="ident" id="7430226">i</span>&nbsp;<span class="op" id="7430228">:=</span>&nbsp;<span class="num" id="7430231">0</span><span class="op" id="7430232">;</span>&nbsp;<span class="ident" id="7430234">i</span>&nbsp;<span class="op" id="7430236">&lt;</span>&nbsp;<span class="ident" id="7430238">b</span><span class="op" id="7430239">.</span><span class="ident" id="7430240">N</span><span class="op" id="7430241">;</span>&nbsp;<span class="ident" id="7430243">i</span><span class="op" id="7430244">++</span>&nbsp;<span class="op" id="7430247">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="7430251">testZip64</span><span class="op" id="7430260">(</span><span class="ident" id="7430261">b</span><span class="op" id="7430262">,</span>&nbsp;<span class="num" id="7430264">1</span><span class="op" id="7430265">&lt;&lt;</span><span class="num" id="7430267">26</span><span class="op" id="7430269">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7430272">}</span><br>
<span class="lineno">395</span><span class="op" id="7430274">}</span>
</div>
</body>
</html>
