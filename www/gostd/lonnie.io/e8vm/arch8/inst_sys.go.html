<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="keyword" id="5057131">package</span>&nbsp;<span class="ident" id="5057139">arch8</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5057146">//&nbsp;InstSys&nbsp;exectues&nbsp;a&nbsp;system&nbsp;instruction</span><br>
<span class="lineno"></span><span class="keyword" id="5057187">type</span>&nbsp;<span class="ident" id="5057192">instSys</span>&nbsp;<span class="keyword" id="5057200">struct</span><span class="op" id="5057206">{</span><span class="op" id="5057207">}</span><br>
<span class="lineno">5</span><br>
<span class="lineno"></span><span class="comment" id="5057210">//&nbsp;I&nbsp;executes&nbsp;the&nbsp;system&nbsp;instruction.</span><br>
<span class="lineno"></span><span class="comment" id="5057248">//&nbsp;Returns&nbsp;any&nbsp;exception&nbsp;encountered.</span><br>
<span class="lineno"></span><span class="keyword" id="5057286">func</span>&nbsp;<span class="op" id="5057291">(</span><span class="ident" id="5057292">i</span>&nbsp;<span class="op" id="5057294">*</span><span class="ident" id="5057295">instSys</span><span class="op" id="5057302">)</span>&nbsp;<span class="ident" id="5057304">I</span><span class="op" id="5057305">(</span><span class="ident" id="5057306">cpu</span>&nbsp;<span class="op" id="5057310">*</span><span class="ident" id="5057311">cpu</span><span class="op" id="5057314">,</span>&nbsp;<span class="ident" id="5057316">in</span>&nbsp;<span class="builtintype" id="5057319">uint32</span><span class="op" id="5057325">)</span>&nbsp;<span class="op" id="5057327">*</span><span class="ident" id="5057328">Excep</span>&nbsp;<span class="op" id="5057334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057337">op</span>&nbsp;<span class="op" id="5057340">:=</span>&nbsp;<span class="op" id="5057343">(</span><span class="ident" id="5057344">in</span>&nbsp;<span class="op" id="5057347">&gt;&gt;</span>&nbsp;<span class="num" id="5057350">24</span><span class="op" id="5057352">)</span>&nbsp;<span class="op" id="5057354">&amp;</span>&nbsp;<span class="num" id="5057356">0xff</span>&nbsp;<span class="comment" id="5057361">//&nbsp;(32:24]</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057373">src</span>&nbsp;<span class="op" id="5057377">:=</span>&nbsp;<span class="op" id="5057380">(</span><span class="ident" id="5057381">in</span>&nbsp;<span class="op" id="5057384">&gt;&gt;</span>&nbsp;<span class="num" id="5057387">21</span><span class="op" id="5057389">)</span>&nbsp;<span class="op" id="5057391">&amp;</span>&nbsp;<span class="num" id="5057393">0x7</span>&nbsp;<span class="comment" id="5057397">//&nbsp;(24:21]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057409">s</span>&nbsp;<span class="op" id="5057411">:=</span>&nbsp;<span class="ident" id="5057414">cpu</span><span class="op" id="5057417">.</span><span class="ident" id="5057418">regs</span><span class="op" id="5057422">[</span><span class="ident" id="5057423">src</span><span class="op" id="5057426">]</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057430">switch</span>&nbsp;<span class="ident" id="5057437">op</span>&nbsp;<span class="op" id="5057440">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057443">case</span>&nbsp;<span class="num" id="5057448">64</span><span class="op" id="5057450">:</span>&nbsp;<span class="comment" id="5057452">//&nbsp;halt</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057462">return</span>&nbsp;<span class="ident" id="5057469">errHalt</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057478">case</span>&nbsp;<span class="num" id="5057483">65</span><span class="op" id="5057485">:</span>&nbsp;<span class="comment" id="5057487">//&nbsp;syscall</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057500">if</span>&nbsp;<span class="op" id="5057503">!</span><span class="ident" id="5057504">cpu</span><span class="op" id="5057507">.</span><span class="ident" id="5057508">UserMode</span><span class="op" id="5057516">(</span><span class="op" id="5057517">)</span>&nbsp;<span class="op" id="5057519">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057524">return</span>&nbsp;<span class="ident" id="5057531">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057548">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057552">return</span>&nbsp;<span class="ident" id="5057559">cpu</span><span class="op" id="5057562">.</span><span class="ident" id="5057563">Syscall</span><span class="op" id="5057570">(</span><span class="op" id="5057571">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057574">case</span>&nbsp;<span class="num" id="5057579">66</span><span class="op" id="5057581">:</span>&nbsp;<span class="comment" id="5057583">//&nbsp;usermod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057596">cpu</span><span class="op" id="5057599">.</span><span class="ident" id="5057600">ring</span>&nbsp;<span class="op" id="5057605">=</span>&nbsp;<span class="num" id="5057607">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057610">case</span>&nbsp;<span class="num" id="5057615">67</span><span class="op" id="5057617">:</span>&nbsp;<span class="comment" id="5057619">//&nbsp;vtable</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057631">if</span>&nbsp;<span class="ident" id="5057634">cpu</span><span class="op" id="5057637">.</span><span class="ident" id="5057638">UserMode</span><span class="op" id="5057646">(</span><span class="op" id="5057647">)</span>&nbsp;<span class="op" id="5057649">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057654">return</span>&nbsp;<span class="ident" id="5057661">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057678">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057682">cpu</span><span class="op" id="5057685">.</span><span class="ident" id="5057686">virtMem</span><span class="op" id="5057693">.</span><span class="ident" id="5057694">SetTable</span><span class="op" id="5057702">(</span><span class="ident" id="5057703">s</span><span class="op" id="5057704">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057707">case</span>&nbsp;<span class="num" id="5057712">68</span><span class="op" id="5057714">:</span>&nbsp;<span class="comment" id="5057716">//&nbsp;iret</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057726">if</span>&nbsp;<span class="ident" id="5057729">cpu</span><span class="op" id="5057732">.</span><span class="ident" id="5057733">UserMode</span><span class="op" id="5057741">(</span><span class="op" id="5057742">)</span>&nbsp;<span class="op" id="5057744">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057749">return</span>&nbsp;<span class="ident" id="5057756">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057773">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057777">return</span>&nbsp;<span class="ident" id="5057784">cpu</span><span class="op" id="5057787">.</span><span class="ident" id="5057788">Iret</span><span class="op" id="5057792">(</span><span class="op" id="5057793">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057796">case</span>&nbsp;<span class="num" id="5057801">69</span><span class="op" id="5057803">:</span>&nbsp;<span class="comment" id="5057805">//&nbsp;cpuid</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057816">s</span>&nbsp;<span class="op" id="5057818">=</span>&nbsp;<span class="builtintype" id="5057820">uint32</span><span class="op" id="5057826">(</span><span class="ident" id="5057827">cpu</span><span class="op" id="5057830">.</span><span class="ident" id="5057831">index</span><span class="op" id="5057836">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057839">default</span><span class="op" id="5057846">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057850">return</span>&nbsp;<span class="ident" id="5057857">errInvalidInst</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5057873">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5057877">cpu</span><span class="op" id="5057880">.</span><span class="ident" id="5057881">regs</span><span class="op" id="5057885">[</span><span class="ident" id="5057886">src</span><span class="op" id="5057889">]</span>&nbsp;<span class="op" id="5057891">=</span>&nbsp;<span class="ident" id="5057893">s</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5057897">return</span>&nbsp;<span class="ident" id="5057904">nil</span><br>
<span class="lineno"></span><span class="op" id="5057908">}</span>
</div>
</body>
</html>
