<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4035948">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4036003">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4036057">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="4036108">//go:generate&nbsp;go&nbsp;run&nbsp;gen.go&nbsp;-full&nbsp;-output&nbsp;md5block.go</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036163">//&nbsp;Package&nbsp;md5&nbsp;implements&nbsp;the&nbsp;MD5&nbsp;hash&nbsp;algorithm&nbsp;as&nbsp;defined&nbsp;in&nbsp;RFC&nbsp;1321.</span><br>
<span class="lineno"></span><span class="keyword" id="4036236">package</span>&nbsp;<span class="ident" id="4036244">md5</span><br>
<span class="lineno"></span><br>
<span class="lineno">10</span><span class="keyword" id="4036249">import</span>&nbsp;<span class="op" id="4036256">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4036259">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4036269">&#34;hash&#34;</span><br>
<span class="lineno"></span><span class="op" id="4036276">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="4036279">func</span>&nbsp;<span class="ident" id="4036284">init</span><span class="op" id="4036288">(</span><span class="op" id="4036289">)</span>&nbsp;<span class="op" id="4036291">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036294">crypto</span><span class="op" id="4036300">.</span><span class="ident" id="4036301">RegisterHash</span><span class="op" id="4036313">(</span><span class="ident" id="4036314">crypto</span><span class="op" id="4036320">.</span><span class="ident" id="4036321">MD5</span><span class="op" id="4036324">,</span>&nbsp;<span class="ident" id="4036326">New</span><span class="op" id="4036329">)</span><br>
<span class="lineno"></span><span class="op" id="4036331">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036334">//&nbsp;The&nbsp;size&nbsp;of&nbsp;an&nbsp;MD5&nbsp;checksum&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno">20</span><span class="keyword" id="4036375">const</span>&nbsp;<span class="ident" id="4036381">Size</span>&nbsp;<span class="op" id="4036386">=</span>&nbsp;<span class="num" id="4036388">16</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036392">//&nbsp;The&nbsp;blocksize&nbsp;of&nbsp;MD5&nbsp;in&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="keyword" id="4036426">const</span>&nbsp;<span class="ident" id="4036432">BlockSize</span>&nbsp;<span class="op" id="4036442">=</span>&nbsp;<span class="num" id="4036444">64</span><br>
<span class="lineno"></span><br>
<span class="lineno">25</span><span class="keyword" id="4036448">const</span>&nbsp;<span class="op" id="4036454">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036457">chunk</span>&nbsp;<span class="op" id="4036463">=</span>&nbsp;<span class="num" id="4036465">64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036469">init0</span>&nbsp;<span class="op" id="4036475">=</span>&nbsp;<span class="num" id="4036477">0x67452301</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036489">init1</span>&nbsp;<span class="op" id="4036495">=</span>&nbsp;<span class="num" id="4036497">0xEFCDAB89</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036509">init2</span>&nbsp;<span class="op" id="4036515">=</span>&nbsp;<span class="num" id="4036517">0x98BADCFE</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036529">init3</span>&nbsp;<span class="op" id="4036535">=</span>&nbsp;<span class="num" id="4036537">0x10325476</span><br>
<span class="lineno"></span><span class="op" id="4036548">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4036551">//&nbsp;digest&nbsp;represents&nbsp;the&nbsp;partial&nbsp;evaluation&nbsp;of&nbsp;a&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4036610">type</span>&nbsp;<span class="ident" id="4036615">digest</span>&nbsp;<span class="keyword" id="4036622">struct</span>&nbsp;<span class="op" id="4036629">{</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036632">s</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4036636">[</span><span class="num" id="4036637">4</span><span class="op" id="4036638">]</span><span class="builtintype" id="4036639">uint32</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036647">x</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4036651">[</span><span class="ident" id="4036652">chunk</span><span class="op" id="4036657">]</span><span class="builtintype" id="4036658">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036664">nx</span>&nbsp;&nbsp;<span class="builtintype" id="4036668">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4036673">len</span>&nbsp;<span class="ident" id="4036677">uint64</span><br>
<span class="lineno"></span><span class="op" id="4036684">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="keyword" id="4036687">func</span>&nbsp;<span class="op" id="4036692">(</span><span class="ident" id="4036693">d</span>&nbsp;<span class="op" id="4036695">*</span><span class="ident" id="4036696">digest</span><span class="op" id="4036702">)</span>&nbsp;<span class="ident" id="4036704">Reset</span><span class="op" id="4036709">(</span><span class="op" id="4036710">)</span>&nbsp;<span class="op" id="4036712">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036715">d</span><span class="op" id="4036716">.</span><span class="ident" id="4036717">s</span><span class="op" id="4036718">[</span><span class="num" id="4036719">0</span><span class="op" id="4036720">]</span>&nbsp;<span class="op" id="4036722">=</span>&nbsp;<span class="ident" id="4036724">init0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036731">d</span><span class="op" id="4036732">.</span><span class="ident" id="4036733">s</span><span class="op" id="4036734">[</span><span class="num" id="4036735">1</span><span class="op" id="4036736">]</span>&nbsp;<span class="op" id="4036738">=</span>&nbsp;<span class="ident" id="4036740">init1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036747">d</span><span class="op" id="4036748">.</span><span class="ident" id="4036749">s</span><span class="op" id="4036750">[</span><span class="num" id="4036751">2</span><span class="op" id="4036752">]</span>&nbsp;<span class="op" id="4036754">=</span>&nbsp;<span class="ident" id="4036756">init2</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036763">d</span><span class="op" id="4036764">.</span><span class="ident" id="4036765">s</span><span class="op" id="4036766">[</span><span class="num" id="4036767">3</span><span class="op" id="4036768">]</span>&nbsp;<span class="op" id="4036770">=</span>&nbsp;<span class="ident" id="4036772">init3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036779">d</span><span class="op" id="4036780">.</span><span class="ident" id="4036781">nx</span>&nbsp;<span class="op" id="4036784">=</span>&nbsp;<span class="num" id="4036786">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036789">d</span><span class="op" id="4036790">.</span><span class="builtinfunc" id="4036791">len</span>&nbsp;<span class="op" id="4036795">=</span>&nbsp;<span class="num" id="4036797">0</span><br>
<span class="lineno"></span><span class="op" id="4036799">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4036802">//&nbsp;New&nbsp;returns&nbsp;a&nbsp;new&nbsp;hash.Hash&nbsp;computing&nbsp;the&nbsp;MD5&nbsp;checksum.</span><br>
<span class="lineno"></span><span class="keyword" id="4036861">func</span>&nbsp;<span class="ident" id="4036866">New</span><span class="op" id="4036869">(</span><span class="op" id="4036870">)</span>&nbsp;<span class="ident" id="4036872">hash</span><span class="op" id="4036876">.</span><span class="ident" id="4036877">Hash</span>&nbsp;<span class="op" id="4036882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036885">d</span>&nbsp;<span class="op" id="4036887">:=</span>&nbsp;<span class="builtinfunc" id="4036890">new</span><span class="op" id="4036893">(</span><span class="ident" id="4036894">digest</span><span class="op" id="4036900">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4036903">d</span><span class="op" id="4036904">.</span><span class="ident" id="4036905">Reset</span><span class="op" id="4036910">(</span><span class="op" id="4036911">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4036914">return</span>&nbsp;<span class="ident" id="4036921">d</span><br>
<span class="lineno">55</span><span class="op" id="4036923">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4036926">func</span>&nbsp;<span class="op" id="4036931">(</span><span class="ident" id="4036932">d</span>&nbsp;<span class="op" id="4036934">*</span><span class="ident" id="4036935">digest</span><span class="op" id="4036941">)</span>&nbsp;<span class="ident" id="4036943">Size</span><span class="op" id="4036947">(</span><span class="op" id="4036948">)</span>&nbsp;<span class="builtintype" id="4036950">int</span>&nbsp;<span class="op" id="4036954">{</span>&nbsp;<span class="keyword" id="4036956">return</span>&nbsp;<span class="ident" id="4036963">Size</span>&nbsp;<span class="op" id="4036968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4036971">func</span>&nbsp;<span class="op" id="4036976">(</span><span class="ident" id="4036977">d</span>&nbsp;<span class="op" id="4036979">*</span><span class="ident" id="4036980">digest</span><span class="op" id="4036986">)</span>&nbsp;<span class="ident" id="4036988">BlockSize</span><span class="op" id="4036997">(</span><span class="op" id="4036998">)</span>&nbsp;<span class="builtintype" id="4037000">int</span>&nbsp;<span class="op" id="4037004">{</span>&nbsp;<span class="keyword" id="4037006">return</span>&nbsp;<span class="ident" id="4037013">BlockSize</span>&nbsp;<span class="op" id="4037023">}</span><br>
<span class="lineno">60</span><br>
<span class="lineno"></span><span class="keyword" id="4037026">func</span>&nbsp;<span class="op" id="4037031">(</span><span class="ident" id="4037032">d</span>&nbsp;<span class="op" id="4037034">*</span><span class="ident" id="4037035">digest</span><span class="op" id="4037041">)</span>&nbsp;<span class="ident" id="4037043">Write</span><span class="op" id="4037048">(</span><span class="ident" id="4037049">p</span>&nbsp;<span class="op" id="4037051">[</span><span class="op" id="4037052">]</span><span class="builtintype" id="4037053">byte</span><span class="op" id="4037057">)</span>&nbsp;<span class="op" id="4037059">(</span><span class="ident" id="4037060">nn</span>&nbsp;<span class="builtintype" id="4037063">int</span><span class="op" id="4037066">,</span>&nbsp;<span class="ident" id="4037068">err</span>&nbsp;<span class="builtintype" id="4037072">error</span><span class="op" id="4037077">)</span>&nbsp;<span class="op" id="4037079">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037082">nn</span>&nbsp;<span class="op" id="4037085">=</span>&nbsp;<span class="builtinfunc" id="4037087">len</span><span class="op" id="4037090">(</span><span class="ident" id="4037091">p</span><span class="op" id="4037092">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037095">d</span><span class="op" id="4037096">.</span><span class="builtinfunc" id="4037097">len</span>&nbsp;<span class="op" id="4037101">+=</span>&nbsp;<span class="ident" id="4037104">uint64</span><span class="op" id="4037110">(</span><span class="ident" id="4037111">nn</span><span class="op" id="4037113">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037116">if</span>&nbsp;<span class="ident" id="4037119">d</span><span class="op" id="4037120">.</span><span class="ident" id="4037121">nx</span>&nbsp;<span class="op" id="4037124">&gt;</span>&nbsp;<span class="num" id="4037126">0</span>&nbsp;<span class="op" id="4037128">{</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037132">n</span>&nbsp;<span class="op" id="4037134">:=</span>&nbsp;<span class="builtinfunc" id="4037137">len</span><span class="op" id="4037140">(</span><span class="ident" id="4037141">p</span><span class="op" id="4037142">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037146">if</span>&nbsp;<span class="ident" id="4037149">n</span>&nbsp;<span class="op" id="4037151">&gt;</span>&nbsp;<span class="ident" id="4037153">chunk</span><span class="op" id="4037158">-</span><span class="ident" id="4037159">d</span><span class="op" id="4037160">.</span><span class="ident" id="4037161">nx</span>&nbsp;<span class="op" id="4037164">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037169">n</span>&nbsp;<span class="op" id="4037171">=</span>&nbsp;<span class="ident" id="4037173">chunk</span>&nbsp;<span class="op" id="4037179">-</span>&nbsp;<span class="ident" id="4037181">d</span><span class="op" id="4037182">.</span><span class="ident" id="4037183">nx</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037188">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037192">for</span>&nbsp;<span class="ident" id="4037196">i</span>&nbsp;<span class="op" id="4037198">:=</span>&nbsp;<span class="num" id="4037201">0</span><span class="op" id="4037202">;</span>&nbsp;<span class="ident" id="4037204">i</span>&nbsp;<span class="op" id="4037206">&lt;</span>&nbsp;<span class="ident" id="4037208">n</span><span class="op" id="4037209">;</span>&nbsp;<span class="ident" id="4037211">i</span><span class="op" id="4037212">++</span>&nbsp;<span class="op" id="4037215">{</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037220">d</span><span class="op" id="4037221">.</span><span class="ident" id="4037222">x</span><span class="op" id="4037223">[</span><span class="ident" id="4037224">d</span><span class="op" id="4037225">.</span><span class="ident" id="4037226">nx</span><span class="op" id="4037228">+</span><span class="ident" id="4037229">i</span><span class="op" id="4037230">]</span>&nbsp;<span class="op" id="4037232">=</span>&nbsp;<span class="ident" id="4037234">p</span><span class="op" id="4037235">[</span><span class="ident" id="4037236">i</span><span class="op" id="4037237">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037245">d</span><span class="op" id="4037246">.</span><span class="ident" id="4037247">nx</span>&nbsp;<span class="op" id="4037250">+=</span>&nbsp;<span class="ident" id="4037253">n</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037257">if</span>&nbsp;<span class="ident" id="4037260">d</span><span class="op" id="4037261">.</span><span class="ident" id="4037262">nx</span>&nbsp;<span class="op" id="4037265">==</span>&nbsp;<span class="ident" id="4037268">chunk</span>&nbsp;<span class="op" id="4037274">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037279">block</span><span class="op" id="4037284">(</span><span class="ident" id="4037285">d</span><span class="op" id="4037286">,</span>&nbsp;<span class="ident" id="4037288">d</span><span class="op" id="4037289">.</span><span class="ident" id="4037290">x</span><span class="op" id="4037291">[</span><span class="num" id="4037292">0</span><span class="op" id="4037293">:</span><span class="ident" id="4037294">chunk</span><span class="op" id="4037299">]</span><span class="op" id="4037300">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037305">d</span><span class="op" id="4037306">.</span><span class="ident" id="4037307">nx</span>&nbsp;<span class="op" id="4037310">=</span>&nbsp;<span class="num" id="4037312">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037316">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037320">p</span>&nbsp;<span class="op" id="4037322">=</span>&nbsp;<span class="ident" id="4037324">p</span><span class="op" id="4037325">[</span><span class="ident" id="4037326">n</span><span class="op" id="4037327">:</span><span class="op" id="4037328">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037331">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037334">if</span>&nbsp;<span class="builtinfunc" id="4037337">len</span><span class="op" id="4037340">(</span><span class="ident" id="4037341">p</span><span class="op" id="4037342">)</span>&nbsp;<span class="op" id="4037344">&gt;=</span>&nbsp;<span class="ident" id="4037347">chunk</span>&nbsp;<span class="op" id="4037353">{</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037357">n</span>&nbsp;<span class="op" id="4037359">:=</span>&nbsp;<span class="builtinfunc" id="4037362">len</span><span class="op" id="4037365">(</span><span class="ident" id="4037366">p</span><span class="op" id="4037367">)</span>&nbsp;<span class="op" id="4037369">&amp;^</span>&nbsp;<span class="op" id="4037372">(</span><span class="ident" id="4037373">chunk</span>&nbsp;<span class="op" id="4037379">-</span>&nbsp;<span class="num" id="4037381">1</span><span class="op" id="4037382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037386">block</span><span class="op" id="4037391">(</span><span class="ident" id="4037392">d</span><span class="op" id="4037393">,</span>&nbsp;<span class="ident" id="4037395">p</span><span class="op" id="4037396">[</span><span class="op" id="4037397">:</span><span class="ident" id="4037398">n</span><span class="op" id="4037399">]</span><span class="op" id="4037400">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037404">p</span>&nbsp;<span class="op" id="4037406">=</span>&nbsp;<span class="ident" id="4037408">p</span><span class="op" id="4037409">[</span><span class="ident" id="4037410">n</span><span class="op" id="4037411">:</span><span class="op" id="4037412">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037415">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037418">if</span>&nbsp;<span class="builtinfunc" id="4037421">len</span><span class="op" id="4037424">(</span><span class="ident" id="4037425">p</span><span class="op" id="4037426">)</span>&nbsp;<span class="op" id="4037428">&gt;</span>&nbsp;<span class="num" id="4037430">0</span>&nbsp;<span class="op" id="4037432">{</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037436">d</span><span class="op" id="4037437">.</span><span class="ident" id="4037438">nx</span>&nbsp;<span class="op" id="4037441">=</span>&nbsp;<span class="builtinfunc" id="4037443">copy</span><span class="op" id="4037447">(</span><span class="ident" id="4037448">d</span><span class="op" id="4037449">.</span><span class="ident" id="4037450">x</span><span class="op" id="4037451">[</span><span class="op" id="4037452">:</span><span class="op" id="4037453">]</span><span class="op" id="4037454">,</span>&nbsp;<span class="ident" id="4037456">p</span><span class="op" id="4037457">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037460">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037463">return</span><br>
<span class="lineno"></span><span class="op" id="4037470">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">90</span><span class="keyword" id="4037473">func</span>&nbsp;<span class="op" id="4037478">(</span><span class="ident" id="4037479">d0</span>&nbsp;<span class="op" id="4037482">*</span><span class="ident" id="4037483">digest</span><span class="op" id="4037489">)</span>&nbsp;<span class="ident" id="4037491">Sum</span><span class="op" id="4037494">(</span><span class="ident" id="4037495">in</span>&nbsp;<span class="op" id="4037498">[</span><span class="op" id="4037499">]</span><span class="builtintype" id="4037500">byte</span><span class="op" id="4037504">)</span>&nbsp;<span class="op" id="4037506">[</span><span class="op" id="4037507">]</span><span class="builtintype" id="4037508">byte</span>&nbsp;<span class="op" id="4037513">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037516">//&nbsp;Make&nbsp;a&nbsp;copy&nbsp;of&nbsp;d0&nbsp;so&nbsp;that&nbsp;caller&nbsp;can&nbsp;keep&nbsp;writing&nbsp;and&nbsp;summing.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037583">d</span>&nbsp;<span class="op" id="4037585">:=</span>&nbsp;<span class="op" id="4037588">*</span><span class="ident" id="4037589">d0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037593">hash</span>&nbsp;<span class="op" id="4037598">:=</span>&nbsp;<span class="ident" id="4037601">d</span><span class="op" id="4037602">.</span><span class="ident" id="4037603">checkSum</span><span class="op" id="4037611">(</span><span class="op" id="4037612">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037615">return</span>&nbsp;<span class="builtinfunc" id="4037622">append</span><span class="op" id="4037628">(</span><span class="ident" id="4037629">in</span><span class="op" id="4037631">,</span>&nbsp;<span class="ident" id="4037633">hash</span><span class="op" id="4037637">[</span><span class="op" id="4037638">:</span><span class="op" id="4037639">]</span><span class="op" id="4037640">...</span><span class="op" id="4037643">)</span><br>
<span class="lineno">95</span><span class="op" id="4037645">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4037648">func</span>&nbsp;<span class="op" id="4037653">(</span><span class="ident" id="4037654">d</span>&nbsp;<span class="op" id="4037656">*</span><span class="ident" id="4037657">digest</span><span class="op" id="4037663">)</span>&nbsp;<span class="ident" id="4037665">checkSum</span><span class="op" id="4037673">(</span><span class="op" id="4037674">)</span>&nbsp;<span class="op" id="4037676">[</span><span class="ident" id="4037677">Size</span><span class="op" id="4037681">]</span><span class="builtintype" id="4037682">byte</span>&nbsp;<span class="op" id="4037687">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037690">//&nbsp;Padding.&nbsp;&nbsp;Add&nbsp;a&nbsp;1&nbsp;bit&nbsp;and&nbsp;0&nbsp;bits&nbsp;until&nbsp;56&nbsp;bytes&nbsp;mod&nbsp;64.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4037750">len</span>&nbsp;<span class="op" id="4037754">:=</span>&nbsp;<span class="ident" id="4037757">d</span><span class="op" id="4037758">.</span><span class="builtinfunc" id="4037759">len</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037764">var</span>&nbsp;<span class="ident" id="4037768">tmp</span>&nbsp;<span class="op" id="4037772">[</span><span class="num" id="4037773">64</span><span class="op" id="4037775">]</span><span class="builtintype" id="4037776">byte</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037782">tmp</span><span class="op" id="4037785">[</span><span class="num" id="4037786">0</span><span class="op" id="4037787">]</span>&nbsp;<span class="op" id="4037789">=</span>&nbsp;<span class="num" id="4037791">0x80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037797">if</span>&nbsp;<span class="builtinfunc" id="4037800">len</span><span class="op" id="4037803">%</span><span class="num" id="4037804">64</span>&nbsp;<span class="op" id="4037807">&lt;</span>&nbsp;<span class="num" id="4037809">56</span>&nbsp;<span class="op" id="4037812">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037816">d</span><span class="op" id="4037817">.</span><span class="ident" id="4037818">Write</span><span class="op" id="4037823">(</span><span class="ident" id="4037824">tmp</span><span class="op" id="4037827">[</span><span class="num" id="4037828">0</span>&nbsp;<span class="op" id="4037830">:</span>&nbsp;<span class="num" id="4037832">56</span><span class="op" id="4037834">-</span><span class="builtinfunc" id="4037835">len</span><span class="op" id="4037838">%</span><span class="num" id="4037839">64</span><span class="op" id="4037841">]</span><span class="op" id="4037842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037845">}</span>&nbsp;<span class="keyword" id="4037847">else</span>&nbsp;<span class="op" id="4037852">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037856">d</span><span class="op" id="4037857">.</span><span class="ident" id="4037858">Write</span><span class="op" id="4037863">(</span><span class="ident" id="4037864">tmp</span><span class="op" id="4037867">[</span><span class="num" id="4037868">0</span>&nbsp;<span class="op" id="4037870">:</span>&nbsp;<span class="num" id="4037872">64</span><span class="op" id="4037874">+</span><span class="num" id="4037875">56</span><span class="op" id="4037877">-</span><span class="builtinfunc" id="4037878">len</span><span class="op" id="4037881">%</span><span class="num" id="4037882">64</span><span class="op" id="4037884">]</span><span class="op" id="4037885">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037888">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4037892">//&nbsp;Length&nbsp;in&nbsp;bits.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4037912">len</span>&nbsp;<span class="op" id="4037916">&lt;&lt;=</span>&nbsp;<span class="num" id="4037920">3</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4037923">for</span>&nbsp;<span class="ident" id="4037927">i</span>&nbsp;<span class="op" id="4037929">:=</span>&nbsp;<span class="builtintype" id="4037932">uint</span><span class="op" id="4037936">(</span><span class="num" id="4037937">0</span><span class="op" id="4037938">)</span><span class="op" id="4037939">;</span>&nbsp;<span class="ident" id="4037941">i</span>&nbsp;<span class="op" id="4037943">&lt;</span>&nbsp;<span class="num" id="4037945">8</span><span class="op" id="4037946">;</span>&nbsp;<span class="ident" id="4037948">i</span><span class="op" id="4037949">++</span>&nbsp;<span class="op" id="4037952">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037956">tmp</span><span class="op" id="4037959">[</span><span class="ident" id="4037960">i</span><span class="op" id="4037961">]</span>&nbsp;<span class="op" id="4037963">=</span>&nbsp;<span class="builtintype" id="4037965">byte</span><span class="op" id="4037969">(</span><span class="builtinfunc" id="4037970">len</span>&nbsp;<span class="op" id="4037974">&gt;&gt;</span>&nbsp;<span class="op" id="4037977">(</span><span class="num" id="4037978">8</span>&nbsp;<span class="op" id="4037980">*</span>&nbsp;<span class="ident" id="4037982">i</span><span class="op" id="4037983">)</span><span class="op" id="4037984">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4037987">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4037990">d</span><span class="op" id="4037991">.</span><span class="ident" id="4037992">Write</span><span class="op" id="4037997">(</span><span class="ident" id="4037998">tmp</span><span class="op" id="4038001">[</span><span class="num" id="4038002">0</span><span class="op" id="4038003">:</span><span class="num" id="4038004">8</span><span class="op" id="4038005">]</span><span class="op" id="4038006">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038010">if</span>&nbsp;<span class="ident" id="4038013">d</span><span class="op" id="4038014">.</span><span class="ident" id="4038015">nx</span>&nbsp;<span class="op" id="4038018">!=</span>&nbsp;<span class="num" id="4038021">0</span>&nbsp;<span class="op" id="4038023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="4038027">panic</span><span class="op" id="4038032">(</span><span class="string" id="4038033">&#34;d.nx&nbsp;!=&nbsp;0&#34;</span><span class="op" id="4038044">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4038047">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038051">var</span>&nbsp;<span class="ident" id="4038055">digest</span>&nbsp;<span class="op" id="4038062">[</span><span class="ident" id="4038063">Size</span><span class="op" id="4038067">]</span><span class="builtintype" id="4038068">byte</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038074">for</span>&nbsp;<span class="ident" id="4038078">i</span><span class="op" id="4038079">,</span>&nbsp;<span class="ident" id="4038081">s</span>&nbsp;<span class="op" id="4038083">:=</span>&nbsp;<span class="keyword" id="4038086">range</span>&nbsp;<span class="ident" id="4038092">d</span><span class="op" id="4038093">.</span><span class="ident" id="4038094">s</span>&nbsp;<span class="op" id="4038096">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038100">digest</span><span class="op" id="4038106">[</span><span class="ident" id="4038107">i</span><span class="op" id="4038108">*</span><span class="num" id="4038109">4</span><span class="op" id="4038110">]</span>&nbsp;<span class="op" id="4038112">=</span>&nbsp;<span class="builtintype" id="4038114">byte</span><span class="op" id="4038118">(</span><span class="ident" id="4038119">s</span><span class="op" id="4038120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038124">digest</span><span class="op" id="4038130">[</span><span class="ident" id="4038131">i</span><span class="op" id="4038132">*</span><span class="num" id="4038133">4</span><span class="op" id="4038134">+</span><span class="num" id="4038135">1</span><span class="op" id="4038136">]</span>&nbsp;<span class="op" id="4038138">=</span>&nbsp;<span class="builtintype" id="4038140">byte</span><span class="op" id="4038144">(</span><span class="ident" id="4038145">s</span>&nbsp;<span class="op" id="4038147">&gt;&gt;</span>&nbsp;<span class="num" id="4038150">8</span><span class="op" id="4038151">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038155">digest</span><span class="op" id="4038161">[</span><span class="ident" id="4038162">i</span><span class="op" id="4038163">*</span><span class="num" id="4038164">4</span><span class="op" id="4038165">+</span><span class="num" id="4038166">2</span><span class="op" id="4038167">]</span>&nbsp;<span class="op" id="4038169">=</span>&nbsp;<span class="builtintype" id="4038171">byte</span><span class="op" id="4038175">(</span><span class="ident" id="4038176">s</span>&nbsp;<span class="op" id="4038178">&gt;&gt;</span>&nbsp;<span class="num" id="4038181">16</span><span class="op" id="4038183">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038187">digest</span><span class="op" id="4038193">[</span><span class="ident" id="4038194">i</span><span class="op" id="4038195">*</span><span class="num" id="4038196">4</span><span class="op" id="4038197">+</span><span class="num" id="4038198">3</span><span class="op" id="4038199">]</span>&nbsp;<span class="op" id="4038201">=</span>&nbsp;<span class="builtintype" id="4038203">byte</span><span class="op" id="4038207">(</span><span class="ident" id="4038208">s</span>&nbsp;<span class="op" id="4038210">&gt;&gt;</span>&nbsp;<span class="num" id="4038213">24</span><span class="op" id="4038215">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4038218">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038222">return</span>&nbsp;<span class="ident" id="4038229">digest</span><br>
<span class="lineno"></span><span class="op" id="4038236">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">130</span><span class="comment" id="4038239">//&nbsp;Sum&nbsp;returns&nbsp;the&nbsp;MD5&nbsp;checksum&nbsp;of&nbsp;the&nbsp;data.</span><br>
<span class="lineno"></span><span class="keyword" id="4038284">func</span>&nbsp;<span class="ident" id="4038289">Sum</span><span class="op" id="4038292">(</span><span class="ident" id="4038293">data</span>&nbsp;<span class="op" id="4038298">[</span><span class="op" id="4038299">]</span><span class="builtintype" id="4038300">byte</span><span class="op" id="4038304">)</span>&nbsp;<span class="op" id="4038306">[</span><span class="ident" id="4038307">Size</span><span class="op" id="4038311">]</span><span class="builtintype" id="4038312">byte</span>&nbsp;<span class="op" id="4038317">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038320">var</span>&nbsp;<span class="ident" id="4038324">d</span>&nbsp;<span class="ident" id="4038326">digest</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038334">d</span><span class="op" id="4038335">.</span><span class="ident" id="4038336">Reset</span><span class="op" id="4038341">(</span><span class="op" id="4038342">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4038345">d</span><span class="op" id="4038346">.</span><span class="ident" id="4038347">Write</span><span class="op" id="4038352">(</span><span class="ident" id="4038353">data</span><span class="op" id="4038357">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4038360">return</span>&nbsp;<span class="ident" id="4038367">d</span><span class="op" id="4038368">.</span><span class="ident" id="4038369">checkSum</span><span class="op" id="4038377">(</span><span class="op" id="4038378">)</span><br>
<span class="lineno"></span><span class="op" id="4038380">}</span>
</div>
</body>
</html>
