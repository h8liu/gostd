<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="4596408">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4596463">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4596517">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4596568">package</span>&nbsp;<span class="ident" id="4596576">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4596586">import</span>&nbsp;<span class="op" id="4596593">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596596">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596605">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596612">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4596623">&#34;unicode/utf8&#34;</span><br>
<span class="lineno"></span><span class="op" id="4596638">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596641">//&nbsp;htmlNospaceEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;unquoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno">15</span><span class="keyword" id="4596715">func</span>&nbsp;<span class="ident" id="4596720">htmlNospaceEscaper</span><span class="op" id="4596738">(</span><span class="ident" id="4596739">args</span>&nbsp;<span class="op" id="4596744">...</span><span class="keyword" id="4596747">interface</span><span class="op" id="4596756">{</span><span class="op" id="4596757">}</span><span class="op" id="4596758">)</span>&nbsp;<span class="builtintype" id="4596760">string</span>&nbsp;<span class="op" id="4596767">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4596770">s</span><span class="op" id="4596771">,</span>&nbsp;<span class="ident" id="4596773">t</span>&nbsp;<span class="op" id="4596775">:=</span>&nbsp;<span class="ident" id="4596778">stringify</span><span class="op" id="4596787">(</span><span class="ident" id="4596788">args</span><span class="op" id="4596792">...</span><span class="op" id="4596795">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596798">if</span>&nbsp;<span class="ident" id="4596801">t</span>&nbsp;<span class="op" id="4596803">==</span>&nbsp;<span class="ident" id="4596806">contentTypeHTML</span>&nbsp;<span class="op" id="4596822">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596826">return</span>&nbsp;<span class="ident" id="4596833">htmlReplacer</span><span class="op" id="4596845">(</span><span class="ident" id="4596846">stripTags</span><span class="op" id="4596855">(</span><span class="ident" id="4596856">s</span><span class="op" id="4596857">)</span><span class="op" id="4596858">,</span>&nbsp;<span class="ident" id="4596860">htmlNospaceNormReplacementTable</span><span class="op" id="4596891">,</span>&nbsp;<span class="builtintype" id="4596893">false</span><span class="op" id="4596898">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4596901">}</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4596904">return</span>&nbsp;<span class="ident" id="4596911">htmlReplacer</span><span class="op" id="4596923">(</span><span class="ident" id="4596924">s</span><span class="op" id="4596925">,</span>&nbsp;<span class="ident" id="4596927">htmlNospaceReplacementTable</span><span class="op" id="4596954">,</span>&nbsp;<span class="builtintype" id="4596956">false</span><span class="op" id="4596961">)</span><br>
<span class="lineno"></span><span class="op" id="4596963">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4596966">//&nbsp;attrEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;quoted&nbsp;attribute&nbsp;values.</span><br>
<span class="lineno"></span><span class="keyword" id="4597031">func</span>&nbsp;<span class="ident" id="4597036">attrEscaper</span><span class="op" id="4597047">(</span><span class="ident" id="4597048">args</span>&nbsp;<span class="op" id="4597053">...</span><span class="keyword" id="4597056">interface</span><span class="op" id="4597065">{</span><span class="op" id="4597066">}</span><span class="op" id="4597067">)</span>&nbsp;<span class="builtintype" id="4597069">string</span>&nbsp;<span class="op" id="4597076">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597079">s</span><span class="op" id="4597080">,</span>&nbsp;<span class="ident" id="4597082">t</span>&nbsp;<span class="op" id="4597084">:=</span>&nbsp;<span class="ident" id="4597087">stringify</span><span class="op" id="4597096">(</span><span class="ident" id="4597097">args</span><span class="op" id="4597101">...</span><span class="op" id="4597104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597107">if</span>&nbsp;<span class="ident" id="4597110">t</span>&nbsp;<span class="op" id="4597112">==</span>&nbsp;<span class="ident" id="4597115">contentTypeHTML</span>&nbsp;<span class="op" id="4597131">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597135">return</span>&nbsp;<span class="ident" id="4597142">htmlReplacer</span><span class="op" id="4597154">(</span><span class="ident" id="4597155">stripTags</span><span class="op" id="4597164">(</span><span class="ident" id="4597165">s</span><span class="op" id="4597166">)</span><span class="op" id="4597167">,</span>&nbsp;<span class="ident" id="4597169">htmlNormReplacementTable</span><span class="op" id="4597193">,</span>&nbsp;<span class="builtintype" id="4597195">true</span><span class="op" id="4597199">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597202">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597205">return</span>&nbsp;<span class="ident" id="4597212">htmlReplacer</span><span class="op" id="4597224">(</span><span class="ident" id="4597225">s</span><span class="op" id="4597226">,</span>&nbsp;<span class="ident" id="4597228">htmlReplacementTable</span><span class="op" id="4597248">,</span>&nbsp;<span class="builtintype" id="4597250">true</span><span class="op" id="4597254">)</span><br>
<span class="lineno">30</span><span class="op" id="4597256">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4597259">//&nbsp;rcdataEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;an&nbsp;RCDATA&nbsp;element&nbsp;body.</span><br>
<span class="lineno"></span><span class="keyword" id="4597325">func</span>&nbsp;<span class="ident" id="4597330">rcdataEscaper</span><span class="op" id="4597343">(</span><span class="ident" id="4597344">args</span>&nbsp;<span class="op" id="4597349">...</span><span class="keyword" id="4597352">interface</span><span class="op" id="4597361">{</span><span class="op" id="4597362">}</span><span class="op" id="4597363">)</span>&nbsp;<span class="builtintype" id="4597365">string</span>&nbsp;<span class="op" id="4597372">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597375">s</span><span class="op" id="4597376">,</span>&nbsp;<span class="ident" id="4597378">t</span>&nbsp;<span class="op" id="4597380">:=</span>&nbsp;<span class="ident" id="4597383">stringify</span><span class="op" id="4597392">(</span><span class="ident" id="4597393">args</span><span class="op" id="4597397">...</span><span class="op" id="4597400">)</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597403">if</span>&nbsp;<span class="ident" id="4597406">t</span>&nbsp;<span class="op" id="4597408">==</span>&nbsp;<span class="ident" id="4597411">contentTypeHTML</span>&nbsp;<span class="op" id="4597427">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597431">return</span>&nbsp;<span class="ident" id="4597438">htmlReplacer</span><span class="op" id="4597450">(</span><span class="ident" id="4597451">s</span><span class="op" id="4597452">,</span>&nbsp;<span class="ident" id="4597454">htmlNormReplacementTable</span><span class="op" id="4597478">,</span>&nbsp;<span class="builtintype" id="4597480">true</span><span class="op" id="4597484">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597487">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597490">return</span>&nbsp;<span class="ident" id="4597497">htmlReplacer</span><span class="op" id="4597509">(</span><span class="ident" id="4597510">s</span><span class="op" id="4597511">,</span>&nbsp;<span class="ident" id="4597513">htmlReplacementTable</span><span class="op" id="4597533">,</span>&nbsp;<span class="builtintype" id="4597535">true</span><span class="op" id="4597539">)</span><br>
<span class="lineno"></span><span class="op" id="4597541">}</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span><span class="comment" id="4597544">//&nbsp;htmlEscaper&nbsp;escapes&nbsp;for&nbsp;inclusion&nbsp;in&nbsp;HTML&nbsp;text.</span><br>
<span class="lineno"></span><span class="keyword" id="4597595">func</span>&nbsp;<span class="ident" id="4597600">htmlEscaper</span><span class="op" id="4597611">(</span><span class="ident" id="4597612">args</span>&nbsp;<span class="op" id="4597617">...</span><span class="keyword" id="4597620">interface</span><span class="op" id="4597629">{</span><span class="op" id="4597630">}</span><span class="op" id="4597631">)</span>&nbsp;<span class="builtintype" id="4597633">string</span>&nbsp;<span class="op" id="4597640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4597643">s</span><span class="op" id="4597644">,</span>&nbsp;<span class="ident" id="4597646">t</span>&nbsp;<span class="op" id="4597648">:=</span>&nbsp;<span class="ident" id="4597651">stringify</span><span class="op" id="4597660">(</span><span class="ident" id="4597661">args</span><span class="op" id="4597665">...</span><span class="op" id="4597668">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597671">if</span>&nbsp;<span class="ident" id="4597674">t</span>&nbsp;<span class="op" id="4597676">==</span>&nbsp;<span class="ident" id="4597679">contentTypeHTML</span>&nbsp;<span class="op" id="4597695">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597699">return</span>&nbsp;<span class="ident" id="4597706">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4597709">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4597712">return</span>&nbsp;<span class="ident" id="4597719">htmlReplacer</span><span class="op" id="4597731">(</span><span class="ident" id="4597732">s</span><span class="op" id="4597733">,</span>&nbsp;<span class="ident" id="4597735">htmlReplacementTable</span><span class="op" id="4597755">,</span>&nbsp;<span class="builtintype" id="4597757">true</span><span class="op" id="4597761">)</span><br>
<span class="lineno"></span><span class="op" id="4597763">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4597766">//&nbsp;htmlReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno"></span><span class="comment" id="4597833">//&nbsp;inside&nbsp;a&nbsp;quoted&nbsp;attribute&nbsp;value&nbsp;or&nbsp;in&nbsp;a&nbsp;text&nbsp;node.</span><br>
<span class="lineno"></span><span class="keyword" id="4597887">var</span>&nbsp;<span class="ident" id="4597891">htmlReplacementTable</span>&nbsp;<span class="op" id="4597912">=</span>&nbsp;<span class="op" id="4597914">[</span><span class="op" id="4597915">]</span><span class="builtintype" id="4597916">string</span><span class="op" id="4597922">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4597925">//&nbsp;http://www.w3.org/TR/html5/syntax.html#attribute-value-(unquoted)-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598001">//&nbsp;U+0000&nbsp;NULL&nbsp;Parse&nbsp;error.&nbsp;Append&nbsp;a&nbsp;U+FFFD&nbsp;REPLACEMENT</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598058">//&nbsp;CHARACTER&nbsp;character&nbsp;to&nbsp;the&nbsp;current&nbsp;attribute&#39;s&nbsp;value.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598116">//&nbsp;&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598122">//&nbsp;and&nbsp;similarly</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4598140">//&nbsp;http://www.w3.org/TR/html5/syntax.html#before-attribute-value-state</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4598212">0</span><span class="op" id="4598213">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4598218">&#34;\uFFFD&#34;</span><span class="op" id="4598226">,</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598229">&#39;&#34;&#39;</span><span class="op" id="4598232">:</span>&nbsp;&nbsp;<span class="string" id="4598235">&#34;&amp;#34;&#34;</span><span class="op" id="4598242">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598245">&#39;&amp;&#39;</span><span class="op" id="4598248">:</span>&nbsp;&nbsp;<span class="string" id="4598251">&#34;&amp;amp;&#34;</span><span class="op" id="4598258">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598261">&#39;\&#39;&#39;</span><span class="op" id="4598265">:</span>&nbsp;<span class="string" id="4598267">&#34;&amp;#39;&#34;</span><span class="op" id="4598274">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598277">&#39;+&#39;</span><span class="op" id="4598280">:</span>&nbsp;&nbsp;<span class="string" id="4598283">&#34;&amp;#43;&#34;</span><span class="op" id="4598290">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598293">&#39;&lt;&#39;</span><span class="op" id="4598296">:</span>&nbsp;&nbsp;<span class="string" id="4598299">&#34;&amp;lt;&#34;</span><span class="op" id="4598305">,</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598308">&#39;&gt;&#39;</span><span class="op" id="4598311">:</span>&nbsp;&nbsp;<span class="string" id="4598314">&#34;&amp;gt;&#34;</span><span class="op" id="4598320">,</span><br>
<span class="lineno"></span><span class="op" id="4598322">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4598325">//&nbsp;htmlNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlReplacementTable&nbsp;but&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to</span><br>
<span class="lineno"></span><span class="comment" id="4598401">//&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno">70</span><span class="keyword" id="4598443">var</span>&nbsp;<span class="ident" id="4598447">htmlNormReplacementTable</span>&nbsp;<span class="op" id="4598472">=</span>&nbsp;<span class="op" id="4598474">[</span><span class="op" id="4598475">]</span><span class="builtintype" id="4598476">string</span><span class="op" id="4598482">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4598485">0</span><span class="op" id="4598486">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4598491">&#34;\uFFFD&#34;</span><span class="op" id="4598499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598502">&#39;&#34;&#39;</span><span class="op" id="4598505">:</span>&nbsp;&nbsp;<span class="string" id="4598508">&#34;&amp;#34;&#34;</span><span class="op" id="4598515">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598518">&#39;\&#39;&#39;</span><span class="op" id="4598522">:</span>&nbsp;<span class="string" id="4598524">&#34;&amp;#39;&#34;</span><span class="op" id="4598531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598534">&#39;+&#39;</span><span class="op" id="4598537">:</span>&nbsp;&nbsp;<span class="string" id="4598540">&#34;&amp;#43;&#34;</span><span class="op" id="4598547">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598550">&#39;&lt;&#39;</span><span class="op" id="4598553">:</span>&nbsp;&nbsp;<span class="string" id="4598556">&#34;&amp;lt;&#34;</span><span class="op" id="4598562">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4598565">&#39;&gt;&#39;</span><span class="op" id="4598568">:</span>&nbsp;&nbsp;<span class="string" id="4598571">&#34;&amp;gt;&#34;</span><span class="op" id="4598577">,</span><br>
<span class="lineno"></span><span class="op" id="4598579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4598582">//&nbsp;htmlNospaceReplacementTable&nbsp;contains&nbsp;the&nbsp;runes&nbsp;that&nbsp;need&nbsp;to&nbsp;be&nbsp;escaped</span><br>
<span class="lineno">80</span><span class="comment" id="4598656">//&nbsp;inside&nbsp;an&nbsp;unquoted&nbsp;attribute&nbsp;value.</span><br>
<span class="lineno"></span><span class="comment" id="4598695">//&nbsp;The&nbsp;set&nbsp;of&nbsp;runes&nbsp;escaped&nbsp;is&nbsp;the&nbsp;union&nbsp;of&nbsp;the&nbsp;HTML&nbsp;specials&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="4598761">//&nbsp;those&nbsp;determined&nbsp;by&nbsp;running&nbsp;the&nbsp;JS&nbsp;below&nbsp;in&nbsp;browsers:</span><br>
<span class="lineno"></span><span class="comment" id="4598818">//&nbsp;&lt;div&nbsp;id=d&gt;&lt;/div&gt;</span><br>
<span class="lineno"></span><span class="comment" id="4598838">//&nbsp;&lt;script&gt;(function&nbsp;()&nbsp;{</span><br>
<span class="lineno">85</span><span class="comment" id="4598864">//&nbsp;var&nbsp;a&nbsp;=&nbsp;[],&nbsp;d&nbsp;=&nbsp;document.getElementById(&#34;d&#34;),&nbsp;i,&nbsp;c,&nbsp;s;</span><br>
<span class="lineno"></span><span class="comment" id="4598922">//&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;0x10000;&nbsp;++i)&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4598957">//&nbsp;&nbsp;&nbsp;c&nbsp;=&nbsp;String.fromCharCode(i);</span><br>
<span class="lineno"></span><span class="comment" id="4598990">//&nbsp;&nbsp;&nbsp;d.innerHTML&nbsp;=&nbsp;&#34;&lt;span&nbsp;title=&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c&nbsp;+&nbsp;&#34;&gt;&lt;/span&gt;&#34;</span><br>
<span class="lineno"></span><span class="comment" id="4599052">//&nbsp;&nbsp;&nbsp;s&nbsp;=&nbsp;d.getElementsByTagName(&#34;SPAN&#34;)[0];</span><br>
<span class="lineno">90</span><span class="comment" id="4599096">//&nbsp;&nbsp;&nbsp;if&nbsp;(!s&nbsp;||&nbsp;s.title&nbsp;!==&nbsp;c&nbsp;+&nbsp;&#34;lt&#34;&nbsp;+&nbsp;c)&nbsp;{&nbsp;a.push(i.toString(16));&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4599165">//&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4599170">//&nbsp;document.write(a.join(&#34;,&nbsp;&#34;));</span><br>
<span class="lineno"></span><span class="comment" id="4599203">//&nbsp;})()&lt;/script&gt;</span><br>
<span class="lineno"></span><span class="keyword" id="4599220">var</span>&nbsp;<span class="ident" id="4599224">htmlNospaceReplacementTable</span>&nbsp;<span class="op" id="4599252">=</span>&nbsp;<span class="op" id="4599254">[</span><span class="op" id="4599255">]</span><span class="builtintype" id="4599256">string</span><span class="op" id="4599262">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4599265">0</span><span class="op" id="4599266">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4599271">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4599281">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599284">&#39;\t&#39;</span><span class="op" id="4599288">:</span>&nbsp;<span class="string" id="4599290">&#34;&amp;#9;&#34;</span><span class="op" id="4599296">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599299">&#39;\n&#39;</span><span class="op" id="4599303">:</span>&nbsp;<span class="string" id="4599305">&#34;&amp;#10;&#34;</span><span class="op" id="4599312">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599315">&#39;\v&#39;</span><span class="op" id="4599319">:</span>&nbsp;<span class="string" id="4599321">&#34;&amp;#11;&#34;</span><span class="op" id="4599328">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599331">&#39;\f&#39;</span><span class="op" id="4599335">:</span>&nbsp;<span class="string" id="4599337">&#34;&amp;#12;&#34;</span><span class="op" id="4599344">,</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599347">&#39;\r&#39;</span><span class="op" id="4599351">:</span>&nbsp;<span class="string" id="4599353">&#34;&amp;#13;&#34;</span><span class="op" id="4599360">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599363">&#39;&nbsp;&#39;</span><span class="op" id="4599366">:</span>&nbsp;&nbsp;<span class="string" id="4599369">&#34;&amp;#32;&#34;</span><span class="op" id="4599376">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599379">&#39;&#34;&#39;</span><span class="op" id="4599382">:</span>&nbsp;&nbsp;<span class="string" id="4599385">&#34;&amp;#34;&#34;</span><span class="op" id="4599392">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599395">&#39;&amp;&#39;</span><span class="op" id="4599398">:</span>&nbsp;&nbsp;<span class="string" id="4599401">&#34;&amp;amp;&#34;</span><span class="op" id="4599408">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599411">&#39;\&#39;&#39;</span><span class="op" id="4599415">:</span>&nbsp;<span class="string" id="4599417">&#34;&amp;#39;&#34;</span><span class="op" id="4599424">,</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599427">&#39;+&#39;</span><span class="op" id="4599430">:</span>&nbsp;&nbsp;<span class="string" id="4599433">&#34;&amp;#43;&#34;</span><span class="op" id="4599440">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599443">&#39;&lt;&#39;</span><span class="op" id="4599446">:</span>&nbsp;&nbsp;<span class="string" id="4599449">&#34;&amp;lt;&#34;</span><span class="op" id="4599455">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599458">&#39;=&#39;</span><span class="op" id="4599461">:</span>&nbsp;&nbsp;<span class="string" id="4599464">&#34;&amp;#61;&#34;</span><span class="op" id="4599471">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599474">&#39;&gt;&#39;</span><span class="op" id="4599477">:</span>&nbsp;&nbsp;<span class="string" id="4599480">&#34;&amp;gt;&#34;</span><span class="op" id="4599486">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599489">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599545">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4599580">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599622">&#39;`&#39;</span><span class="op" id="4599625">:</span>&nbsp;<span class="string" id="4599627">&#34;&amp;#96;&#34;</span><span class="op" id="4599634">,</span><br>
<span class="lineno"></span><span class="op" id="4599636">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">115</span><span class="comment" id="4599639">//&nbsp;htmlNospaceNormReplacementTable&nbsp;is&nbsp;like&nbsp;htmlNospaceReplacementTable&nbsp;but</span><br>
<span class="lineno"></span><span class="comment" id="4599714">//&nbsp;without&nbsp;&#39;&amp;&#39;&nbsp;to&nbsp;avoid&nbsp;over-encoding&nbsp;existing&nbsp;entities.</span><br>
<span class="lineno"></span><span class="keyword" id="4599771">var</span>&nbsp;<span class="ident" id="4599775">htmlNospaceNormReplacementTable</span>&nbsp;<span class="op" id="4599807">=</span>&nbsp;<span class="op" id="4599809">[</span><span class="op" id="4599810">]</span><span class="builtintype" id="4599811">string</span><span class="op" id="4599817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="num" id="4599820">0</span><span class="op" id="4599821">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4599826">&#34;&amp;#xfffd;&#34;</span><span class="op" id="4599836">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599839">&#39;\t&#39;</span><span class="op" id="4599843">:</span>&nbsp;<span class="string" id="4599845">&#34;&amp;#9;&#34;</span><span class="op" id="4599851">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599854">&#39;\n&#39;</span><span class="op" id="4599858">:</span>&nbsp;<span class="string" id="4599860">&#34;&amp;#10;&#34;</span><span class="op" id="4599867">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599870">&#39;\v&#39;</span><span class="op" id="4599874">:</span>&nbsp;<span class="string" id="4599876">&#34;&amp;#11;&#34;</span><span class="op" id="4599883">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599886">&#39;\f&#39;</span><span class="op" id="4599890">:</span>&nbsp;<span class="string" id="4599892">&#34;&amp;#12;&#34;</span><span class="op" id="4599899">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599902">&#39;\r&#39;</span><span class="op" id="4599906">:</span>&nbsp;<span class="string" id="4599908">&#34;&amp;#13;&#34;</span><span class="op" id="4599915">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599918">&#39;&nbsp;&#39;</span><span class="op" id="4599921">:</span>&nbsp;&nbsp;<span class="string" id="4599924">&#34;&amp;#32;&#34;</span><span class="op" id="4599931">,</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599934">&#39;&#34;&#39;</span><span class="op" id="4599937">:</span>&nbsp;&nbsp;<span class="string" id="4599940">&#34;&amp;#34;&#34;</span><span class="op" id="4599947">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599950">&#39;\&#39;&#39;</span><span class="op" id="4599954">:</span>&nbsp;<span class="string" id="4599956">&#34;&amp;#39;&#34;</span><span class="op" id="4599963">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599966">&#39;+&#39;</span><span class="op" id="4599969">:</span>&nbsp;&nbsp;<span class="string" id="4599972">&#34;&amp;#43;&#34;</span><span class="op" id="4599979">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599982">&#39;&lt;&#39;</span><span class="op" id="4599985">:</span>&nbsp;&nbsp;<span class="string" id="4599988">&#34;&amp;lt;&#34;</span><span class="op" id="4599994">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4599997">&#39;=&#39;</span><span class="op" id="4600000">:</span>&nbsp;&nbsp;<span class="string" id="4600003">&#34;&amp;#61;&#34;</span><span class="op" id="4600010">,</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4600013">&#39;&gt;&#39;</span><span class="op" id="4600016">:</span>&nbsp;&nbsp;<span class="string" id="4600019">&#34;&amp;gt;&#34;</span><span class="op" id="4600025">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600028">//&nbsp;A&nbsp;parse&nbsp;error&nbsp;in&nbsp;the&nbsp;attribute&nbsp;value&nbsp;(unquoted)&nbsp;and</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600084">//&nbsp;before&nbsp;attribute&nbsp;value&nbsp;states.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600119">//&nbsp;Treated&nbsp;as&nbsp;a&nbsp;quoting&nbsp;character&nbsp;by&nbsp;IE.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="4600161">&#39;`&#39;</span><span class="op" id="4600164">:</span>&nbsp;<span class="string" id="4600166">&#34;&amp;#96;&#34;</span><span class="op" id="4600173">,</span><br>
<span class="lineno">135</span><span class="op" id="4600175">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4600178">//&nbsp;htmlReplacer&nbsp;returns&nbsp;s&nbsp;with&nbsp;runes&nbsp;replaced&nbsp;according&nbsp;to&nbsp;replacementTable</span><br>
<span class="lineno"></span><span class="comment" id="4600254">//&nbsp;and&nbsp;when&nbsp;badRunes&nbsp;is&nbsp;true,&nbsp;certain&nbsp;bad&nbsp;runes&nbsp;are&nbsp;allowed&nbsp;through&nbsp;unescaped.</span><br>
<span class="lineno"></span><span class="keyword" id="4600333">func</span>&nbsp;<span class="ident" id="4600338">htmlReplacer</span><span class="op" id="4600350">(</span><span class="ident" id="4600351">s</span>&nbsp;<span class="builtintype" id="4600353">string</span><span class="op" id="4600359">,</span>&nbsp;<span class="ident" id="4600361">replacementTable</span>&nbsp;<span class="op" id="4600378">[</span><span class="op" id="4600379">]</span><span class="builtintype" id="4600380">string</span><span class="op" id="4600386">,</span>&nbsp;<span class="ident" id="4600388">badRunes</span>&nbsp;<span class="builtintype" id="4600397">bool</span><span class="op" id="4600401">)</span>&nbsp;<span class="builtintype" id="4600403">string</span>&nbsp;<span class="op" id="4600410">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600413">written</span><span class="op" id="4600420">,</span>&nbsp;<span class="ident" id="4600422">b</span>&nbsp;<span class="op" id="4600424">:=</span>&nbsp;<span class="num" id="4600427">0</span><span class="op" id="4600428">,</span>&nbsp;<span class="builtinfunc" id="4600430">new</span><span class="op" id="4600433">(</span><span class="ident" id="4600434">bytes</span><span class="op" id="4600439">.</span><span class="ident" id="4600440">Buffer</span><span class="op" id="4600446">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600449">for</span>&nbsp;<span class="ident" id="4600453">i</span><span class="op" id="4600454">,</span>&nbsp;<span class="ident" id="4600456">r</span>&nbsp;<span class="op" id="4600458">:=</span>&nbsp;<span class="keyword" id="4600461">range</span>&nbsp;<span class="ident" id="4600467">s</span>&nbsp;<span class="op" id="4600469">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600473">if</span>&nbsp;<span class="builtintype" id="4600476">int</span><span class="op" id="4600479">(</span><span class="ident" id="4600480">r</span><span class="op" id="4600481">)</span>&nbsp;<span class="op" id="4600483">&lt;</span>&nbsp;<span class="builtinfunc" id="4600485">len</span><span class="op" id="4600488">(</span><span class="ident" id="4600489">replacementTable</span><span class="op" id="4600505">)</span>&nbsp;<span class="op" id="4600507">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600512">if</span>&nbsp;<span class="ident" id="4600515">repl</span>&nbsp;<span class="op" id="4600520">:=</span>&nbsp;<span class="ident" id="4600523">replacementTable</span><span class="op" id="4600539">[</span><span class="ident" id="4600540">r</span><span class="op" id="4600541">]</span><span class="op" id="4600542">;</span>&nbsp;<span class="builtinfunc" id="4600544">len</span><span class="op" id="4600547">(</span><span class="ident" id="4600548">repl</span><span class="op" id="4600552">)</span>&nbsp;<span class="op" id="4600554">!=</span>&nbsp;<span class="num" id="4600557">0</span>&nbsp;<span class="op" id="4600559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600565">b</span><span class="op" id="4600566">.</span><span class="ident" id="4600567">WriteString</span><span class="op" id="4600578">(</span><span class="ident" id="4600579">s</span><span class="op" id="4600580">[</span><span class="ident" id="4600581">written</span><span class="op" id="4600588">:</span><span class="ident" id="4600589">i</span><span class="op" id="4600590">]</span><span class="op" id="4600591">)</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600597">b</span><span class="op" id="4600598">.</span><span class="ident" id="4600599">WriteString</span><span class="op" id="4600610">(</span><span class="ident" id="4600611">repl</span><span class="op" id="4600615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600621">//&nbsp;Valid&nbsp;as&nbsp;long&nbsp;as&nbsp;replacementTable&nbsp;doesn&#39;t</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600670">//&nbsp;include&nbsp;anything&nbsp;above&nbsp;0x7f.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600706">written</span>&nbsp;<span class="op" id="4600714">=</span>&nbsp;<span class="ident" id="4600716">i</span>&nbsp;<span class="op" id="4600718">+</span>&nbsp;<span class="ident" id="4600720">utf8</span><span class="op" id="4600724">.</span><span class="ident" id="4600725">RuneLen</span><span class="op" id="4600732">(</span><span class="ident" id="4600733">r</span><span class="op" id="4600734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600739">}</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600743">}</span>&nbsp;<span class="keyword" id="4600745">else</span>&nbsp;<span class="keyword" id="4600750">if</span>&nbsp;<span class="ident" id="4600753">badRunes</span>&nbsp;<span class="op" id="4600762">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600767">//&nbsp;No-op.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4600780">//&nbsp;IE&nbsp;does&nbsp;not&nbsp;allow&nbsp;these&nbsp;ranges&nbsp;in&nbsp;unquoted&nbsp;attrs.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600835">}</span>&nbsp;<span class="keyword" id="4600837">else</span>&nbsp;<span class="keyword" id="4600842">if</span>&nbsp;<span class="num" id="4600845">0xfdd0</span>&nbsp;<span class="op" id="4600852">&lt;=</span>&nbsp;<span class="ident" id="4600855">r</span>&nbsp;<span class="op" id="4600857">&amp;&amp;</span>&nbsp;<span class="ident" id="4600860">r</span>&nbsp;<span class="op" id="4600862">&lt;=</span>&nbsp;<span class="num" id="4600865">0xfdef</span>&nbsp;<span class="op" id="4600872">||</span>&nbsp;<span class="num" id="4600875">0xfff0</span>&nbsp;<span class="op" id="4600882">&lt;=</span>&nbsp;<span class="ident" id="4600885">r</span>&nbsp;<span class="op" id="4600887">&amp;&amp;</span>&nbsp;<span class="ident" id="4600890">r</span>&nbsp;<span class="op" id="4600892">&lt;=</span>&nbsp;<span class="num" id="4600895">0xffff</span>&nbsp;<span class="op" id="4600902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600907">fmt</span><span class="op" id="4600910">.</span><span class="ident" id="4600911">Fprintf</span><span class="op" id="4600918">(</span><span class="ident" id="4600919">b</span><span class="op" id="4600920">,</span>&nbsp;<span class="string" id="4600922">&#34;%s&amp;#x%x;&#34;</span><span class="op" id="4600932">,</span>&nbsp;<span class="ident" id="4600934">s</span><span class="op" id="4600935">[</span><span class="ident" id="4600936">written</span><span class="op" id="4600943">:</span><span class="ident" id="4600944">i</span><span class="op" id="4600945">]</span><span class="op" id="4600946">,</span>&nbsp;<span class="ident" id="4600948">r</span><span class="op" id="4600949">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4600954">written</span>&nbsp;<span class="op" id="4600962">=</span>&nbsp;<span class="ident" id="4600964">i</span>&nbsp;<span class="op" id="4600966">+</span>&nbsp;<span class="ident" id="4600968">utf8</span><span class="op" id="4600972">.</span><span class="ident" id="4600973">RuneLen</span><span class="op" id="4600980">(</span><span class="ident" id="4600981">r</span><span class="op" id="4600982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600986">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4600989">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4600992">if</span>&nbsp;<span class="ident" id="4600995">written</span>&nbsp;<span class="op" id="4601003">==</span>&nbsp;<span class="num" id="4601006">0</span>&nbsp;<span class="op" id="4601008">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601012">return</span>&nbsp;<span class="ident" id="4601019">s</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601022">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601025">b</span><span class="op" id="4601026">.</span><span class="ident" id="4601027">WriteString</span><span class="op" id="4601038">(</span><span class="ident" id="4601039">s</span><span class="op" id="4601040">[</span><span class="ident" id="4601041">written</span><span class="op" id="4601048">:</span><span class="op" id="4601049">]</span><span class="op" id="4601050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601053">return</span>&nbsp;<span class="ident" id="4601060">b</span><span class="op" id="4601061">.</span><span class="ident" id="4601062">String</span><span class="op" id="4601068">(</span><span class="op" id="4601069">)</span><br>
<span class="lineno"></span><span class="op" id="4601071">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">165</span><span class="comment" id="4601074">//&nbsp;stripTags&nbsp;takes&nbsp;a&nbsp;snippet&nbsp;of&nbsp;HTML&nbsp;and&nbsp;returns&nbsp;only&nbsp;the&nbsp;text&nbsp;content.</span><br>
<span class="lineno"></span><span class="comment" id="4601146">//&nbsp;For&nbsp;example,&nbsp;`&lt;b&gt;&amp;iexcl;Hi!&lt;/b&gt;&nbsp;&lt;script&gt;...&lt;/script&gt;`&nbsp;-&gt;&nbsp;`&amp;iexcl;Hi!&nbsp;`.</span><br>
<span class="lineno"></span><span class="keyword" id="4601221">func</span>&nbsp;<span class="ident" id="4601226">stripTags</span><span class="op" id="4601235">(</span><span class="ident" id="4601236">html</span>&nbsp;<span class="builtintype" id="4601241">string</span><span class="op" id="4601247">)</span>&nbsp;<span class="builtintype" id="4601249">string</span>&nbsp;<span class="op" id="4601256">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601259">var</span>&nbsp;<span class="ident" id="4601263">b</span>&nbsp;<span class="ident" id="4601265">bytes</span><span class="op" id="4601270">.</span><span class="ident" id="4601271">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601279">s</span><span class="op" id="4601280">,</span>&nbsp;<span class="ident" id="4601282">c</span><span class="op" id="4601283">,</span>&nbsp;<span class="ident" id="4601285">i</span><span class="op" id="4601286">,</span>&nbsp;<span class="ident" id="4601288">allText</span>&nbsp;<span class="op" id="4601296">:=</span>&nbsp;<span class="op" id="4601299">[</span><span class="op" id="4601300">]</span><span class="builtintype" id="4601301">byte</span><span class="op" id="4601305">(</span><span class="ident" id="4601306">html</span><span class="op" id="4601310">)</span><span class="op" id="4601311">,</span>&nbsp;<span class="ident" id="4601313">context</span><span class="op" id="4601320">{</span><span class="op" id="4601321">}</span><span class="op" id="4601322">,</span>&nbsp;<span class="num" id="4601324">0</span><span class="op" id="4601325">,</span>&nbsp;<span class="builtintype" id="4601327">true</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601333">//&nbsp;Using&nbsp;the&nbsp;transition&nbsp;funcs&nbsp;helps&nbsp;us&nbsp;avoid&nbsp;mangling</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601388">//&nbsp;`&lt;div&nbsp;title=&#34;1&gt;2&#34;&gt;`&nbsp;or&nbsp;`I&nbsp;&lt;3&nbsp;Ponies!`.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601431">for</span>&nbsp;<span class="ident" id="4601435">i</span>&nbsp;<span class="op" id="4601437">!=</span>&nbsp;<span class="builtinfunc" id="4601440">len</span><span class="op" id="4601443">(</span><span class="ident" id="4601444">s</span><span class="op" id="4601445">)</span>&nbsp;<span class="op" id="4601447">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601451">if</span>&nbsp;<span class="ident" id="4601454">c</span><span class="op" id="4601455">.</span><span class="ident" id="4601456">delim</span>&nbsp;<span class="op" id="4601462">==</span>&nbsp;<span class="ident" id="4601465">delimNone</span>&nbsp;<span class="op" id="4601475">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601480">st</span>&nbsp;<span class="op" id="4601483">:=</span>&nbsp;<span class="ident" id="4601486">c</span><span class="op" id="4601487">.</span><span class="ident" id="4601488">state</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601497">//&nbsp;Use&nbsp;RCDATA&nbsp;instead&nbsp;of&nbsp;parsing&nbsp;into&nbsp;JS&nbsp;or&nbsp;CSS&nbsp;styles.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601556">if</span>&nbsp;<span class="ident" id="4601559">c</span><span class="op" id="4601560">.</span><span class="ident" id="4601561">element</span>&nbsp;<span class="op" id="4601569">!=</span>&nbsp;<span class="ident" id="4601572">elementNone</span>&nbsp;<span class="op" id="4601584">&amp;&amp;</span>&nbsp;<span class="op" id="4601587">!</span><span class="ident" id="4601588">isInTag</span><span class="op" id="4601595">(</span><span class="ident" id="4601596">st</span><span class="op" id="4601598">)</span>&nbsp;<span class="op" id="4601600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601606">st</span>&nbsp;<span class="op" id="4601609">=</span>&nbsp;<span class="ident" id="4601611">stateRCDATA</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601626">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601631">d</span><span class="op" id="4601632">,</span>&nbsp;<span class="ident" id="4601634">nread</span>&nbsp;<span class="op" id="4601640">:=</span>&nbsp;<span class="ident" id="4601643">transitionFunc</span><span class="op" id="4601657">[</span><span class="ident" id="4601658">st</span><span class="op" id="4601660">]</span><span class="op" id="4601661">(</span><span class="ident" id="4601662">c</span><span class="op" id="4601663">,</span>&nbsp;<span class="ident" id="4601665">s</span><span class="op" id="4601666">[</span><span class="ident" id="4601667">i</span><span class="op" id="4601668">:</span><span class="op" id="4601669">]</span><span class="op" id="4601670">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601675">i1</span>&nbsp;<span class="op" id="4601678">:=</span>&nbsp;<span class="ident" id="4601681">i</span>&nbsp;<span class="op" id="4601683">+</span>&nbsp;<span class="ident" id="4601685">nread</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601694">if</span>&nbsp;<span class="ident" id="4601697">c</span><span class="op" id="4601698">.</span><span class="ident" id="4601699">state</span>&nbsp;<span class="op" id="4601705">==</span>&nbsp;<span class="ident" id="4601708">stateText</span>&nbsp;<span class="op" id="4601718">||</span>&nbsp;<span class="ident" id="4601721">c</span><span class="op" id="4601722">.</span><span class="ident" id="4601723">state</span>&nbsp;<span class="op" id="4601729">==</span>&nbsp;<span class="ident" id="4601732">stateRCDATA</span>&nbsp;<span class="op" id="4601744">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4601750">//&nbsp;Emit&nbsp;text&nbsp;up&nbsp;to&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;tag&nbsp;or&nbsp;comment.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601806">j</span>&nbsp;<span class="op" id="4601808">:=</span>&nbsp;<span class="ident" id="4601811">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601818">if</span>&nbsp;<span class="ident" id="4601821">d</span><span class="op" id="4601822">.</span><span class="ident" id="4601823">state</span>&nbsp;<span class="op" id="4601829">!=</span>&nbsp;<span class="ident" id="4601832">c</span><span class="op" id="4601833">.</span><span class="ident" id="4601834">state</span>&nbsp;<span class="op" id="4601840">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601847">for</span>&nbsp;<span class="ident" id="4601851">j1</span>&nbsp;<span class="op" id="4601854">:=</span>&nbsp;<span class="ident" id="4601857">j</span>&nbsp;<span class="op" id="4601859">-</span>&nbsp;<span class="num" id="4601861">1</span><span class="op" id="4601862">;</span>&nbsp;<span class="ident" id="4601864">j1</span>&nbsp;<span class="op" id="4601867">&gt;=</span>&nbsp;<span class="ident" id="4601870">i</span><span class="op" id="4601871">;</span>&nbsp;<span class="ident" id="4601873">j1</span><span class="op" id="4601875">--</span>&nbsp;<span class="op" id="4601878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601886">if</span>&nbsp;<span class="ident" id="4601889">s</span><span class="op" id="4601890">[</span><span class="ident" id="4601891">j1</span><span class="op" id="4601893">]</span>&nbsp;<span class="op" id="4601895">==</span>&nbsp;<span class="string" id="4601898">&#39;&lt;&#39;</span>&nbsp;<span class="op" id="4601902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601911">j</span>&nbsp;<span class="op" id="4601913">=</span>&nbsp;<span class="ident" id="4601915">j1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4601925">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601937">}</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601944">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601950">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601956">b</span><span class="op" id="4601957">.</span><span class="ident" id="4601958">Write</span><span class="op" id="4601963">(</span><span class="ident" id="4601964">s</span><span class="op" id="4601965">[</span><span class="ident" id="4601966">i</span><span class="op" id="4601967">:</span><span class="ident" id="4601968">j</span><span class="op" id="4601969">]</span><span class="op" id="4601970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4601975">}</span>&nbsp;<span class="keyword" id="4601977">else</span>&nbsp;<span class="op" id="4601982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4601988">allText</span>&nbsp;<span class="op" id="4601996">=</span>&nbsp;<span class="builtintype" id="4601998">false</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602007">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602012">c</span><span class="op" id="4602013">,</span>&nbsp;<span class="ident" id="4602015">i</span>&nbsp;<span class="op" id="4602017">=</span>&nbsp;<span class="ident" id="4602019">d</span><span class="op" id="4602020">,</span>&nbsp;<span class="ident" id="4602022">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602028">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602039">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602043">i1</span>&nbsp;<span class="op" id="4602046">:=</span>&nbsp;<span class="ident" id="4602049">i</span>&nbsp;<span class="op" id="4602051">+</span>&nbsp;<span class="ident" id="4602053">bytes</span><span class="op" id="4602058">.</span><span class="ident" id="4602059">IndexAny</span><span class="op" id="4602067">(</span><span class="ident" id="4602068">s</span><span class="op" id="4602069">[</span><span class="ident" id="4602070">i</span><span class="op" id="4602071">:</span><span class="op" id="4602072">]</span><span class="op" id="4602073">,</span>&nbsp;<span class="ident" id="4602075">delimEnds</span><span class="op" id="4602084">[</span><span class="ident" id="4602085">c</span><span class="op" id="4602086">.</span><span class="ident" id="4602087">delim</span><span class="op" id="4602092">]</span><span class="op" id="4602093">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602097">if</span>&nbsp;<span class="ident" id="4602100">i1</span>&nbsp;<span class="op" id="4602103">&lt;</span>&nbsp;<span class="ident" id="4602105">i</span>&nbsp;<span class="op" id="4602107">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602112">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602120">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602124">if</span>&nbsp;<span class="ident" id="4602127">c</span><span class="op" id="4602128">.</span><span class="ident" id="4602129">delim</span>&nbsp;<span class="op" id="4602135">!=</span>&nbsp;<span class="ident" id="4602138">delimSpaceOrTagEnd</span>&nbsp;<span class="op" id="4602157">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602162">//&nbsp;Consume&nbsp;any&nbsp;quote.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602187">i1</span><span class="op" id="4602189">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602198">c</span><span class="op" id="4602199">,</span>&nbsp;<span class="ident" id="4602201">i</span>&nbsp;<span class="op" id="4602203">=</span>&nbsp;<span class="ident" id="4602205">context</span><span class="op" id="4602212">{</span><span class="ident" id="4602213">state</span><span class="op" id="4602218">:</span>&nbsp;<span class="ident" id="4602220">stateTag</span><span class="op" id="4602228">,</span>&nbsp;<span class="ident" id="4602230">element</span><span class="op" id="4602237">:</span>&nbsp;<span class="ident" id="4602239">c</span><span class="op" id="4602240">.</span><span class="ident" id="4602241">element</span><span class="op" id="4602248">}</span><span class="op" id="4602249">,</span>&nbsp;<span class="ident" id="4602251">i1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602255">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602258">if</span>&nbsp;<span class="ident" id="4602261">allText</span>&nbsp;<span class="op" id="4602269">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602273">return</span>&nbsp;<span class="ident" id="4602280">html</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602286">}</span>&nbsp;<span class="keyword" id="4602288">else</span>&nbsp;<span class="keyword" id="4602293">if</span>&nbsp;<span class="ident" id="4602296">c</span><span class="op" id="4602297">.</span><span class="ident" id="4602298">state</span>&nbsp;<span class="op" id="4602304">==</span>&nbsp;<span class="ident" id="4602307">stateText</span>&nbsp;<span class="op" id="4602317">||</span>&nbsp;<span class="ident" id="4602320">c</span><span class="op" id="4602321">.</span><span class="ident" id="4602322">state</span>&nbsp;<span class="op" id="4602328">==</span>&nbsp;<span class="ident" id="4602331">stateRCDATA</span>&nbsp;<span class="op" id="4602343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602347">b</span><span class="op" id="4602348">.</span><span class="ident" id="4602349">Write</span><span class="op" id="4602354">(</span><span class="ident" id="4602355">s</span><span class="op" id="4602356">[</span><span class="ident" id="4602357">i</span><span class="op" id="4602358">:</span><span class="op" id="4602359">]</span><span class="op" id="4602360">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602363">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602366">return</span>&nbsp;<span class="ident" id="4602373">b</span><span class="op" id="4602374">.</span><span class="ident" id="4602375">String</span><span class="op" id="4602381">(</span><span class="op" id="4602382">)</span><br>
<span class="lineno">215</span><span class="op" id="4602384">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4602387">//&nbsp;htmlNameFilter&nbsp;accepts&nbsp;valid&nbsp;parts&nbsp;of&nbsp;an&nbsp;HTML&nbsp;attribute&nbsp;or&nbsp;tag&nbsp;name&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4602461">//&nbsp;a&nbsp;known-safe&nbsp;HTML&nbsp;attribute.</span><br>
<span class="lineno"></span><span class="keyword" id="4602493">func</span>&nbsp;<span class="ident" id="4602498">htmlNameFilter</span><span class="op" id="4602512">(</span><span class="ident" id="4602513">args</span>&nbsp;<span class="op" id="4602518">...</span><span class="keyword" id="4602521">interface</span><span class="op" id="4602530">{</span><span class="op" id="4602531">}</span><span class="op" id="4602532">)</span>&nbsp;<span class="builtintype" id="4602534">string</span>&nbsp;<span class="op" id="4602541">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602544">s</span><span class="op" id="4602545">,</span>&nbsp;<span class="ident" id="4602547">t</span>&nbsp;<span class="op" id="4602549">:=</span>&nbsp;<span class="ident" id="4602552">stringify</span><span class="op" id="4602561">(</span><span class="ident" id="4602562">args</span><span class="op" id="4602566">...</span><span class="op" id="4602569">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602572">if</span>&nbsp;<span class="ident" id="4602575">t</span>&nbsp;<span class="op" id="4602577">==</span>&nbsp;<span class="ident" id="4602580">contentTypeHTMLAttr</span>&nbsp;<span class="op" id="4602600">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602604">return</span>&nbsp;<span class="ident" id="4602611">s</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602614">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602617">if</span>&nbsp;<span class="builtinfunc" id="4602620">len</span><span class="op" id="4602623">(</span><span class="ident" id="4602624">s</span><span class="op" id="4602625">)</span>&nbsp;<span class="op" id="4602627">==</span>&nbsp;<span class="num" id="4602630">0</span>&nbsp;<span class="op" id="4602632">{</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602636">//&nbsp;Avoid&nbsp;violation&nbsp;of&nbsp;structure&nbsp;preservation.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602684">//&nbsp;&lt;input&nbsp;checked&nbsp;{{.K}}={{.V}}&gt;.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602720">//&nbsp;Without&nbsp;this,&nbsp;if&nbsp;.K&nbsp;is&nbsp;empty&nbsp;then&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602778">//&nbsp;checked,&nbsp;but&nbsp;otherwise&nbsp;.V&nbsp;is&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;attribute</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602839">//&nbsp;named&nbsp;.K.</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602854">return</span>&nbsp;<span class="ident" id="4602861">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4602877">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="4602880">s</span>&nbsp;<span class="op" id="4602882">=</span>&nbsp;<span class="ident" id="4602884">strings</span><span class="op" id="4602891">.</span><span class="ident" id="4602892">ToLower</span><span class="op" id="4602899">(</span><span class="ident" id="4602900">s</span><span class="op" id="4602901">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4602904">if</span>&nbsp;<span class="ident" id="4602907">t</span>&nbsp;<span class="op" id="4602909">:=</span>&nbsp;<span class="ident" id="4602912">attrType</span><span class="op" id="4602920">(</span><span class="ident" id="4602921">s</span><span class="op" id="4602922">)</span><span class="op" id="4602923">;</span>&nbsp;<span class="ident" id="4602925">t</span>&nbsp;<span class="op" id="4602927">!=</span>&nbsp;<span class="ident" id="4602930">contentTypePlain</span>&nbsp;<span class="op" id="4602947">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4602951">//&nbsp;TODO:&nbsp;Split&nbsp;attr&nbsp;and&nbsp;element&nbsp;name&nbsp;part&nbsp;filters&nbsp;so&nbsp;we&nbsp;can&nbsp;whitelist</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="4603023">//&nbsp;attributes.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603040">return</span>&nbsp;<span class="ident" id="4603047">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603063">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603066">for</span>&nbsp;<span class="ident" id="4603070">_</span><span class="op" id="4603071">,</span>&nbsp;<span class="ident" id="4603073">r</span>&nbsp;<span class="op" id="4603075">:=</span>&nbsp;<span class="keyword" id="4603078">range</span>&nbsp;<span class="ident" id="4603084">s</span>&nbsp;<span class="op" id="4603086">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603090">switch</span>&nbsp;<span class="op" id="4603097">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603101">case</span>&nbsp;<span class="string" id="4603106">&#39;0&#39;</span>&nbsp;<span class="op" id="4603110">&lt;=</span>&nbsp;<span class="ident" id="4603113">r</span>&nbsp;<span class="op" id="4603115">&amp;&amp;</span>&nbsp;<span class="ident" id="4603118">r</span>&nbsp;<span class="op" id="4603120">&lt;=</span>&nbsp;<span class="string" id="4603123">&#39;9&#39;</span><span class="op" id="4603126">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603130">case</span>&nbsp;<span class="string" id="4603135">&#39;a&#39;</span>&nbsp;<span class="op" id="4603139">&lt;=</span>&nbsp;<span class="ident" id="4603142">r</span>&nbsp;<span class="op" id="4603144">&amp;&amp;</span>&nbsp;<span class="ident" id="4603147">r</span>&nbsp;<span class="op" id="4603149">&lt;=</span>&nbsp;<span class="string" id="4603152">&#39;z&#39;</span><span class="op" id="4603155">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603159">default</span><span class="op" id="4603166">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603171">return</span>&nbsp;<span class="ident" id="4603178">filterFailsafe</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603195">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="4603198">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603201">return</span>&nbsp;<span class="ident" id="4603208">s</span><br>
<span class="lineno"></span><span class="op" id="4603210">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4603213">//&nbsp;commentEscaper&nbsp;returns&nbsp;the&nbsp;empty&nbsp;string&nbsp;regardless&nbsp;of&nbsp;input.</span><br>
<span class="lineno">250</span><span class="comment" id="4603277">//&nbsp;Comment&nbsp;content&nbsp;does&nbsp;not&nbsp;correspond&nbsp;to&nbsp;any&nbsp;parsed&nbsp;structure&nbsp;or</span><br>
<span class="lineno"></span><span class="comment" id="4603343">//&nbsp;human-readable&nbsp;content,&nbsp;so&nbsp;the&nbsp;simplest&nbsp;and&nbsp;most&nbsp;secure&nbsp;policy&nbsp;is&nbsp;to&nbsp;drop</span><br>
<span class="lineno"></span><span class="comment" id="4603420">//&nbsp;content&nbsp;interpolated&nbsp;into&nbsp;comments.</span><br>
<span class="lineno"></span><span class="comment" id="4603459">//&nbsp;This&nbsp;approach&nbsp;is&nbsp;equally&nbsp;valid&nbsp;whether&nbsp;or&nbsp;not&nbsp;static&nbsp;comment&nbsp;content&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4603534">//&nbsp;removed&nbsp;from&nbsp;the&nbsp;template.</span><br>
<span class="lineno">255</span><span class="keyword" id="4603564">func</span>&nbsp;<span class="ident" id="4603569">commentEscaper</span><span class="op" id="4603583">(</span><span class="ident" id="4603584">args</span>&nbsp;<span class="op" id="4603589">...</span><span class="keyword" id="4603592">interface</span><span class="op" id="4603601">{</span><span class="op" id="4603602">}</span><span class="op" id="4603603">)</span>&nbsp;<span class="builtintype" id="4603605">string</span>&nbsp;<span class="op" id="4603612">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="4603615">return</span>&nbsp;<span class="string" id="4603622">&#34;&#34;</span><br>
<span class="lineno"></span><span class="op" id="4603625">}</span>
</div>
</body>
</html>
