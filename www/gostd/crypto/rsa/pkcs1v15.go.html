<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>crypto/rsa</h2>
<ul>
<li><a href="/gostd/crypto/rsa/pkcs1v15.go.html" class="current">pkcs1v15.go</a></li>
<li><a href="/gostd/crypto/rsa/pkcs1v15_test.go.html">pkcs1v15_test.go</a></li>
<li><a href="/gostd/crypto/rsa/pss.go.html">pss.go</a></li>
<li><a href="/gostd/crypto/rsa/pss_test.go.html">pss_test.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa.go.html">rsa.go</a></li>
<li><a href="/gostd/crypto/rsa/rsa_test.go.html">rsa_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="4724328">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="4724383">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="4724437">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="4724488">package</span>&nbsp;<span class="ident" id="4724496">rsa</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="4724501">import</span>&nbsp;<span class="op" id="4724508">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4724511">&#34;crypto&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4724521">&#34;crypto/subtle&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4724538">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4724548">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="4724554">&#34;math/big&#34;</span><br>
<span class="lineno"></span><span class="op" id="4724565">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="comment" id="4724568">//&nbsp;This&nbsp;file&nbsp;implements&nbsp;encryption&nbsp;and&nbsp;decryption&nbsp;using&nbsp;PKCS#1&nbsp;v1.5&nbsp;padding.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4724646">//&nbsp;EncryptPKCS1v15&nbsp;encrypts&nbsp;the&nbsp;given&nbsp;message&nbsp;with&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4724742">//&nbsp;The&nbsp;message&nbsp;must&nbsp;be&nbsp;no&nbsp;longer&nbsp;than&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;public&nbsp;modulus&nbsp;minus&nbsp;11&nbsp;bytes.</span><br>
<span class="lineno"></span><span class="comment" id="4724829">//&nbsp;WARNING:&nbsp;use&nbsp;of&nbsp;this&nbsp;function&nbsp;to&nbsp;encrypt&nbsp;plaintexts&nbsp;other&nbsp;than&nbsp;session&nbsp;keys</span><br>
<span class="lineno">20</span><span class="comment" id="4724908">//&nbsp;is&nbsp;dangerous.&nbsp;Use&nbsp;RSA&nbsp;OAEP&nbsp;in&nbsp;new&nbsp;protocols.</span><br>
<span class="lineno"></span><span class="keyword" id="4724956">func</span>&nbsp;<span class="ident" id="4724961">EncryptPKCS1v15</span><span class="op" id="4724976">(</span><span class="ident" id="4724977">rand</span>&nbsp;<span class="ident" id="4724982"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4724984">.</span><span class="ident" id="4724985"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4724991">,</span>&nbsp;<span class="ident" id="4724993">pub</span>&nbsp;<span class="op" id="4724997">*</span><span class="ident" id="4724998"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4725007">,</span>&nbsp;<span class="ident" id="4725009">msg</span>&nbsp;<span class="op" id="4725013">[</span><span class="op" id="4725014">]</span><span class="builtintype" id="4725015">byte</span><span class="op" id="4725019">)</span>&nbsp;<span class="op" id="4725021">(</span><span class="ident" id="4725022">out</span>&nbsp;<span class="op" id="4725026">[</span><span class="op" id="4725027">]</span><span class="builtintype" id="4725028">byte</span><span class="op" id="4725032">,</span>&nbsp;<span class="ident" id="4725034">err</span>&nbsp;<span class="builtintype" id="4725038">error</span><span class="op" id="4725043">)</span>&nbsp;<span class="op" id="4725045">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725048">if</span>&nbsp;<span class="ident" id="4725051">err</span>&nbsp;<span class="op" id="4725055">:=</span>&nbsp;<span class="ident" id="4725058"><a href="/gostd/crypto/rsa/rsa.go.html#4743527">checkPub</a></span><span class="op" id="4725066">(</span><span class="ident" id="4725067"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724993">pub</a></span><span class="op" id="4725070">)</span><span class="op" id="4725071">;</span>&nbsp;<span class="ident" id="4725073"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725051">err</a></span>&nbsp;<span class="op" id="4725077">!=</span>&nbsp;<span class="builtintype" id="4725080">nil</span>&nbsp;<span class="op" id="4725084">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725088">return</span>&nbsp;<span class="builtintype" id="4725095">nil</span><span class="op" id="4725098">,</span>&nbsp;<span class="ident" id="4725100"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725051">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4725105">}</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725108">k</span>&nbsp;<span class="op" id="4725110">:=</span>&nbsp;<span class="op" id="4725113">(</span><span class="ident" id="4725114"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724993">pub</a></span><span class="op" id="4725117">.</span><span class="ident" id="4725118"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4725119">.</span><span class="ident" id="4725120"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4725126">(</span><span class="op" id="4725127">)</span>&nbsp;<span class="op" id="4725129">+</span>&nbsp;<span class="num" id="4725131">7</span><span class="op" id="4725132">)</span>&nbsp;<span class="op" id="4725134">/</span>&nbsp;<span class="num" id="4725136">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725139">if</span>&nbsp;<span class="builtinfunc" id="4725142">len</span><span class="op" id="4725145">(</span><span class="ident" id="4725146"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725009">msg</a></span><span class="op" id="4725149">)</span>&nbsp;<span class="op" id="4725151">&gt;</span>&nbsp;<span class="ident" id="4725153"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725108">k</a></span><span class="op" id="4725154">-</span><span class="num" id="4725155">11</span>&nbsp;<span class="op" id="4725158">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725162"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725034">err</a></span>&nbsp;<span class="op" id="4725166">=</span>&nbsp;<span class="ident" id="4725168"><a href="/gostd/crypto/rsa/rsa.go.html#4750558">ErrMessageTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725188">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4725196">}</span><br>
<span class="lineno">30</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4725200">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x02&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;M</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725241">em</span>&nbsp;<span class="op" id="4725244">:=</span>&nbsp;<span class="builtinfunc" id="4725247">make</span><span class="op" id="4725251">(</span><span class="op" id="4725252">[</span><span class="op" id="4725253">]</span><span class="builtintype" id="4725254">byte</span><span class="op" id="4725258">,</span>&nbsp;<span class="ident" id="4725260"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725108">k</a></span><span class="op" id="4725261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725264"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725266">[</span><span class="num" id="4725267">1</span><span class="op" id="4725268">]</span>&nbsp;<span class="op" id="4725270">=</span>&nbsp;<span class="num" id="4725272">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725275">ps</span><span class="op" id="4725277">,</span>&nbsp;<span class="ident" id="4725279">mm</span>&nbsp;<span class="op" id="4725282">:=</span>&nbsp;<span class="ident" id="4725285"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725287">[</span><span class="num" id="4725288">2</span><span class="op" id="4725289">:</span><span class="builtinfunc" id="4725290">len</span><span class="op" id="4725293">(</span><span class="ident" id="4725294"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725296">)</span><span class="op" id="4725297">-</span><span class="builtinfunc" id="4725298">len</span><span class="op" id="4725301">(</span><span class="ident" id="4725302"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725009">msg</a></span><span class="op" id="4725305">)</span><span class="op" id="4725306">-</span><span class="num" id="4725307">1</span><span class="op" id="4725308">]</span><span class="op" id="4725309">,</span>&nbsp;<span class="ident" id="4725311"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725313">[</span><span class="builtinfunc" id="4725314">len</span><span class="op" id="4725317">(</span><span class="ident" id="4725318"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725320">)</span><span class="op" id="4725321">-</span><span class="builtinfunc" id="4725322">len</span><span class="op" id="4725325">(</span><span class="ident" id="4725326"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725009">msg</a></span><span class="op" id="4725329">)</span><span class="op" id="4725330">:</span><span class="op" id="4725331">]</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725334"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725034">err</a></span>&nbsp;<span class="op" id="4725338">=</span>&nbsp;<span class="ident" id="4725340"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729398">nonZeroRandomBytes</a></span><span class="op" id="4725358">(</span><span class="ident" id="4725359"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725275">ps</a></span><span class="op" id="4725361">,</span>&nbsp;<span class="ident" id="4725363"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724977">rand</a></span><span class="op" id="4725367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725370">if</span>&nbsp;<span class="ident" id="4725373"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725034">err</a></span>&nbsp;<span class="op" id="4725377">!=</span>&nbsp;<span class="builtintype" id="4725380">nil</span>&nbsp;<span class="op" id="4725384">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725388">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4725396">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725399"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725401">[</span><span class="builtinfunc" id="4725402">len</span><span class="op" id="4725405">(</span><span class="ident" id="4725406"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725408">)</span><span class="op" id="4725409">-</span><span class="builtinfunc" id="4725410">len</span><span class="op" id="4725413">(</span><span class="ident" id="4725414"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725009">msg</a></span><span class="op" id="4725417">)</span><span class="op" id="4725418">-</span><span class="num" id="4725419">1</span><span class="op" id="4725420">]</span>&nbsp;<span class="op" id="4725422">=</span>&nbsp;<span class="num" id="4725424">0</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4725427">copy</span><span class="op" id="4725431">(</span><span class="ident" id="4725432"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725279">mm</a></span><span class="op" id="4725434">,</span>&nbsp;<span class="ident" id="4725436"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725009">msg</a></span><span class="op" id="4725439">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725443">m</span>&nbsp;<span class="op" id="4725445">:=</span>&nbsp;<span class="builtinfunc" id="4725448">new</span><span class="op" id="4725451">(</span><span class="ident" id="4725452"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4725455">.</span><span class="ident" id="4725456"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4725459">)</span><span class="op" id="4725460">.</span><span class="ident" id="4725461"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4725469">(</span><span class="ident" id="4725470"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725472">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725475">c</span>&nbsp;<span class="op" id="4725477">:=</span>&nbsp;<span class="ident" id="4725480"><a href="/gostd/crypto/rsa/rsa.go.html#4750651">encrypt</a></span><span class="op" id="4725487">(</span><span class="builtinfunc" id="4725488">new</span><span class="op" id="4725491">(</span><span class="ident" id="4725492"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4725495">.</span><span class="ident" id="4725496"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4725499">)</span><span class="op" id="4725500">,</span>&nbsp;<span class="ident" id="4725502"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724993">pub</a></span><span class="op" id="4725505">,</span>&nbsp;<span class="ident" id="4725507"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725443">m</a></span><span class="op" id="4725508">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725512"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733795">copyWithLeftPad</a></span><span class="op" id="4725527">(</span><span class="ident" id="4725528"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><span class="op" id="4725530">,</span>&nbsp;<span class="ident" id="4725532"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725475">c</a></span><span class="op" id="4725533">.</span><span class="ident" id="4725534"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4725539">(</span><span class="op" id="4725540">)</span><span class="op" id="4725541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725544"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725022">out</a></span>&nbsp;<span class="op" id="4725548">=</span>&nbsp;<span class="ident" id="4725550"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725241">em</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725554">return</span><br>
<span class="lineno"></span><span class="op" id="4725561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">50</span><span class="comment" id="4725564">//&nbsp;DecryptPKCS1v15&nbsp;decrypts&nbsp;a&nbsp;plaintext&nbsp;using&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4725655">//&nbsp;If&nbsp;rand&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="keyword" id="4725733">func</span>&nbsp;<span class="ident" id="4725738">DecryptPKCS1v15</span><span class="op" id="4725753">(</span><span class="ident" id="4725754">rand</span>&nbsp;<span class="ident" id="4725759"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4725761">.</span><span class="ident" id="4725762"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4725768">,</span>&nbsp;<span class="ident" id="4725770">priv</span>&nbsp;<span class="op" id="4725775">*</span><span class="ident" id="4725776"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4725786">,</span>&nbsp;<span class="ident" id="4725788">ciphertext</span>&nbsp;<span class="op" id="4725799">[</span><span class="op" id="4725800">]</span><span class="builtintype" id="4725801">byte</span><span class="op" id="4725805">)</span>&nbsp;<span class="op" id="4725807">(</span><span class="ident" id="4725808">out</span>&nbsp;<span class="op" id="4725812">[</span><span class="op" id="4725813">]</span><span class="builtintype" id="4725814">byte</span><span class="op" id="4725818">,</span>&nbsp;<span class="ident" id="4725820">err</span>&nbsp;<span class="builtintype" id="4725824">error</span><span class="op" id="4725829">)</span>&nbsp;<span class="op" id="4725831">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725834">if</span>&nbsp;<span class="ident" id="4725837">err</span>&nbsp;<span class="op" id="4725841">:=</span>&nbsp;<span class="ident" id="4725844"><a href="/gostd/crypto/rsa/rsa.go.html#4743527">checkPub</a></span><span class="op" id="4725852">(</span><span class="op" id="4725853">&amp;</span><span class="ident" id="4725854"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725770">priv</a></span><span class="op" id="4725858">.</span><span class="ident" id="4725859"><a href="/gostd/crypto/rsa/rsa.go.html#4743795">PublicKey</a></span><span class="op" id="4725868">)</span><span class="op" id="4725869">;</span>&nbsp;<span class="ident" id="4725871"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725837">err</a></span>&nbsp;<span class="op" id="4725875">!=</span>&nbsp;<span class="builtintype" id="4725878">nil</span>&nbsp;<span class="op" id="4725882">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725886">return</span>&nbsp;<span class="builtintype" id="4725893">nil</span><span class="op" id="4725896">,</span>&nbsp;<span class="ident" id="4725898"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725837">err</a></span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4725903">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4725906">valid</span><span class="op" id="4725911">,</span>&nbsp;<span class="ident" id="4725913"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725808">out</a></span><span class="op" id="4725916">,</span>&nbsp;<span class="ident" id="4725918">index</span><span class="op" id="4725923">,</span>&nbsp;<span class="ident" id="4725925"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725820">err</a></span>&nbsp;<span class="op" id="4725929">:=</span>&nbsp;<span class="ident" id="4725932"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728083">decryptPKCS1v15</a></span><span class="op" id="4725947">(</span><span class="ident" id="4725948"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725754">rand</a></span><span class="op" id="4725952">,</span>&nbsp;<span class="ident" id="4725954"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725770">priv</a></span><span class="op" id="4725958">,</span>&nbsp;<span class="ident" id="4725960"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725788">ciphertext</a></span><span class="op" id="4725970">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725973">if</span>&nbsp;<span class="ident" id="4725976"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725820">err</a></span>&nbsp;<span class="op" id="4725980">!=</span>&nbsp;<span class="builtintype" id="4725983">nil</span>&nbsp;<span class="op" id="4725987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4725991">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4725999">}</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4726002">if</span>&nbsp;<span class="ident" id="4726005"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725906">valid</a></span>&nbsp;<span class="op" id="4726011">==</span>&nbsp;<span class="num" id="4726014">0</span>&nbsp;<span class="op" id="4726016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4726020">return</span>&nbsp;<span class="builtintype" id="4726027">nil</span><span class="op" id="4726030">,</span>&nbsp;<span class="ident" id="4726032"><a href="/gostd/crypto/rsa/rsa.go.html#4751957">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4726047">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4726050"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725808">out</a></span>&nbsp;<span class="op" id="4726054">=</span>&nbsp;<span class="ident" id="4726056"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725808">out</a></span><span class="op" id="4726059">[</span><span class="ident" id="4726060"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4725918">index</a></span><span class="op" id="4726065">:</span><span class="op" id="4726066">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4726069">return</span><br>
<span class="lineno">65</span><span class="op" id="4726076">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4726079">//&nbsp;DecryptPKCS1v15SessionKey&nbsp;decrypts&nbsp;a&nbsp;session&nbsp;key&nbsp;using&nbsp;RSA&nbsp;and&nbsp;the&nbsp;padding&nbsp;scheme&nbsp;from&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4726182">//&nbsp;If&nbsp;rand&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;uses&nbsp;RSA&nbsp;blinding&nbsp;to&nbsp;avoid&nbsp;timing&nbsp;side-channel&nbsp;attacks.</span><br>
<span class="lineno"></span><span class="comment" id="4726260">//&nbsp;It&nbsp;returns&nbsp;an&nbsp;error&nbsp;if&nbsp;the&nbsp;ciphertext&nbsp;is&nbsp;the&nbsp;wrong&nbsp;length&nbsp;or&nbsp;if&nbsp;the</span><br>
<span class="lineno">70</span><span class="comment" id="4726331">//&nbsp;ciphertext&nbsp;is&nbsp;greater&nbsp;than&nbsp;the&nbsp;public&nbsp;modulus.&nbsp;Otherwise,&nbsp;no&nbsp;error&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4726404">//&nbsp;returned.&nbsp;If&nbsp;the&nbsp;padding&nbsp;is&nbsp;valid,&nbsp;the&nbsp;resulting&nbsp;plaintext&nbsp;message&nbsp;is&nbsp;copied</span><br>
<span class="lineno"></span><span class="comment" id="4726484">//&nbsp;into&nbsp;key.&nbsp;Otherwise,&nbsp;key&nbsp;is&nbsp;unchanged.&nbsp;These&nbsp;alternatives&nbsp;occur&nbsp;in&nbsp;constant</span><br>
<span class="lineno"></span><span class="comment" id="4726563">//&nbsp;time.&nbsp;It&nbsp;is&nbsp;intended&nbsp;that&nbsp;the&nbsp;user&nbsp;of&nbsp;this&nbsp;function&nbsp;generate&nbsp;a&nbsp;random</span><br>
<span class="lineno"></span><span class="comment" id="4726636">//&nbsp;session&nbsp;key&nbsp;beforehand&nbsp;and&nbsp;continue&nbsp;the&nbsp;protocol&nbsp;with&nbsp;the&nbsp;resulting&nbsp;value.</span><br>
<span class="lineno">75</span><span class="comment" id="4726714">//&nbsp;This&nbsp;will&nbsp;remove&nbsp;any&nbsp;possibility&nbsp;that&nbsp;an&nbsp;attacker&nbsp;can&nbsp;learn&nbsp;any&nbsp;information</span><br>
<span class="lineno"></span><span class="comment" id="4726793">//&nbsp;about&nbsp;the&nbsp;plaintext.</span><br>
<span class="lineno"></span><span class="comment" id="4726817">//&nbsp;See&nbsp;``Chosen&nbsp;Ciphertext&nbsp;Attacks&nbsp;Against&nbsp;Protocols&nbsp;Based&nbsp;on&nbsp;the&nbsp;RSA</span><br>
<span class="lineno"></span><span class="comment" id="4726887">//&nbsp;Encryption&nbsp;Standard&nbsp;PKCS&nbsp;#1&#39;&#39;,&nbsp;Daniel&nbsp;Bleichenbacher,&nbsp;Advances&nbsp;in&nbsp;Cryptology</span><br>
<span class="lineno"></span><span class="comment" id="4726967">//&nbsp;(Crypto&nbsp;&#39;98).</span><br>
<span class="lineno">80</span><span class="keyword" id="4726984">func</span>&nbsp;<span class="ident" id="4726989">DecryptPKCS1v15SessionKey</span><span class="op" id="4727014">(</span><span class="ident" id="4727015">rand</span>&nbsp;<span class="ident" id="4727020"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4727022">.</span><span class="ident" id="4727023"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4727029">,</span>&nbsp;<span class="ident" id="4727031">priv</span>&nbsp;<span class="op" id="4727036">*</span><span class="ident" id="4727037"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4727047">,</span>&nbsp;<span class="ident" id="4727049">ciphertext</span>&nbsp;<span class="op" id="4727060">[</span><span class="op" id="4727061">]</span><span class="builtintype" id="4727062">byte</span><span class="op" id="4727066">,</span>&nbsp;<span class="ident" id="4727068">key</span>&nbsp;<span class="op" id="4727072">[</span><span class="op" id="4727073">]</span><span class="builtintype" id="4727074">byte</span><span class="op" id="4727078">)</span>&nbsp;<span class="op" id="4727080">(</span><span class="ident" id="4727081">err</span>&nbsp;<span class="builtintype" id="4727085">error</span><span class="op" id="4727090">)</span>&nbsp;<span class="op" id="4727092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727095">if</span>&nbsp;<span class="ident" id="4727098">err</span>&nbsp;<span class="op" id="4727102">:=</span>&nbsp;<span class="ident" id="4727105"><a href="/gostd/crypto/rsa/rsa.go.html#4743527">checkPub</a></span><span class="op" id="4727113">(</span><span class="op" id="4727114">&amp;</span><span class="ident" id="4727115"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727031">priv</a></span><span class="op" id="4727119">.</span><span class="ident" id="4727120"><a href="/gostd/crypto/rsa/rsa.go.html#4743795">PublicKey</a></span><span class="op" id="4727129">)</span><span class="op" id="4727130">;</span>&nbsp;<span class="ident" id="4727132"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727098">err</a></span>&nbsp;<span class="op" id="4727136">!=</span>&nbsp;<span class="builtintype" id="4727139">nil</span>&nbsp;<span class="op" id="4727143">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727147">return</span>&nbsp;<span class="ident" id="4727154"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727098">err</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4727159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4727162">k</span>&nbsp;<span class="op" id="4727164">:=</span>&nbsp;<span class="op" id="4727167">(</span><span class="ident" id="4727168"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727031">priv</a></span><span class="op" id="4727172">.</span><span class="ident" id="4727173"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4727174">.</span><span class="ident" id="4727175"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4727181">(</span><span class="op" id="4727182">)</span>&nbsp;<span class="op" id="4727184">+</span>&nbsp;<span class="num" id="4727186">7</span><span class="op" id="4727187">)</span>&nbsp;<span class="op" id="4727189">/</span>&nbsp;<span class="num" id="4727191">8</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727194">if</span>&nbsp;<span class="ident" id="4727197"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727162">k</a></span><span class="op" id="4727198">-</span><span class="op" id="4727199">(</span><span class="builtinfunc" id="4727200">len</span><span class="op" id="4727203">(</span><span class="ident" id="4727204"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727068">key</a></span><span class="op" id="4727207">)</span><span class="op" id="4727208">+</span><span class="num" id="4727209">3</span><span class="op" id="4727210">+</span><span class="num" id="4727211">8</span><span class="op" id="4727212">)</span>&nbsp;<span class="op" id="4727214">&lt;</span>&nbsp;<span class="num" id="4727216">0</span>&nbsp;<span class="op" id="4727218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727222">return</span>&nbsp;<span class="ident" id="4727229"><a href="/gostd/crypto/rsa/rsa.go.html#4751957">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4727244">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4727248">valid</span><span class="op" id="4727253">,</span>&nbsp;<span class="ident" id="4727255">em</span><span class="op" id="4727257">,</span>&nbsp;<span class="ident" id="4727259">index</span><span class="op" id="4727264">,</span>&nbsp;<span class="ident" id="4727266"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727081">err</a></span>&nbsp;<span class="op" id="4727270">:=</span>&nbsp;<span class="ident" id="4727273"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728083">decryptPKCS1v15</a></span><span class="op" id="4727288">(</span><span class="ident" id="4727289"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727015">rand</a></span><span class="op" id="4727293">,</span>&nbsp;<span class="ident" id="4727295"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727031">priv</a></span><span class="op" id="4727299">,</span>&nbsp;<span class="ident" id="4727301"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727049">ciphertext</a></span><span class="op" id="4727311">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727314">if</span>&nbsp;<span class="ident" id="4727317"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727081">err</a></span>&nbsp;<span class="op" id="4727321">!=</span>&nbsp;<span class="builtintype" id="4727324">nil</span>&nbsp;<span class="op" id="4727328">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727332">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4727340">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727344">if</span>&nbsp;<span class="builtinfunc" id="4727347">len</span><span class="op" id="4727350">(</span><span class="ident" id="4727351"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727255">em</a></span><span class="op" id="4727353">)</span>&nbsp;<span class="op" id="4727355">!=</span>&nbsp;<span class="ident" id="4727358"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727162">k</a></span>&nbsp;<span class="op" id="4727360">{</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4727364">//&nbsp;This&nbsp;should&nbsp;be&nbsp;impossible&nbsp;because&nbsp;decryptPKCS1v15&nbsp;always</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4727426">//&nbsp;returns&nbsp;the&nbsp;full&nbsp;slice.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727455">return</span>&nbsp;<span class="ident" id="4727462"><a href="/gostd/crypto/rsa/rsa.go.html#4751957">ErrDecryption</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4727477">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4727481"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727248">valid</a></span>&nbsp;<span class="op" id="4727487">&amp;=</span>&nbsp;<span class="ident" id="4727490"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4727496">.</span><span class="ident" id="4727497"><a href="/gostd/crypto/subtle/constant_time.go.html#4429162">ConstantTimeEq</a></span><span class="op" id="4727511">(</span><span class="builtintype" id="4727512">int32</span><span class="op" id="4727517">(</span><span class="builtinfunc" id="4727518">len</span><span class="op" id="4727521">(</span><span class="ident" id="4727522"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727255">em</a></span><span class="op" id="4727524">)</span><span class="op" id="4727525">-</span><span class="ident" id="4727526"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727259">index</a></span><span class="op" id="4727531">)</span><span class="op" id="4727532">,</span>&nbsp;<span class="builtintype" id="4727534">int32</span><span class="op" id="4727539">(</span><span class="builtinfunc" id="4727540">len</span><span class="op" id="4727543">(</span><span class="ident" id="4727544"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727068">key</a></span><span class="op" id="4727547">)</span><span class="op" id="4727548">)</span><span class="op" id="4727549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4727552"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4727558">.</span><span class="ident" id="4727559"><a href="/gostd/crypto/subtle/constant_time.go.html#4429485">ConstantTimeCopy</a></span><span class="op" id="4727575">(</span><span class="ident" id="4727576"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727248">valid</a></span><span class="op" id="4727581">,</span>&nbsp;<span class="ident" id="4727583"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727068">key</a></span><span class="op" id="4727586">,</span>&nbsp;<span class="ident" id="4727588"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727255">em</a></span><span class="op" id="4727590">[</span><span class="builtinfunc" id="4727591">len</span><span class="op" id="4727594">(</span><span class="ident" id="4727595"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727255">em</a></span><span class="op" id="4727597">)</span><span class="op" id="4727598">-</span><span class="builtinfunc" id="4727599">len</span><span class="op" id="4727602">(</span><span class="ident" id="4727603"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4727068">key</a></span><span class="op" id="4727606">)</span><span class="op" id="4727607">:</span><span class="op" id="4727608">]</span><span class="op" id="4727609">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4727612">return</span><br>
<span class="lineno"></span><span class="op" id="4727619">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span><span class="comment" id="4727622">//&nbsp;decryptPKCS1v15&nbsp;decrypts&nbsp;ciphertext&nbsp;using&nbsp;priv&nbsp;and&nbsp;blinds&nbsp;the&nbsp;operation&nbsp;if</span><br>
<span class="lineno"></span><span class="comment" id="4727700">//&nbsp;rand&nbsp;is&nbsp;not&nbsp;nil.&nbsp;It&nbsp;returns&nbsp;one&nbsp;or&nbsp;zero&nbsp;in&nbsp;valid&nbsp;that&nbsp;indicates&nbsp;whether&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4727779">//&nbsp;plaintext&nbsp;was&nbsp;correctly&nbsp;structured.&nbsp;In&nbsp;either&nbsp;case,&nbsp;the&nbsp;plaintext&nbsp;is</span><br>
<span class="lineno"></span><span class="comment" id="4727851">//&nbsp;returned&nbsp;in&nbsp;em&nbsp;so&nbsp;that&nbsp;it&nbsp;may&nbsp;be&nbsp;read&nbsp;independently&nbsp;of&nbsp;whether&nbsp;it&nbsp;was&nbsp;valid</span><br>
<span class="lineno"></span><span class="comment" id="4727930">//&nbsp;in&nbsp;order&nbsp;to&nbsp;maintain&nbsp;constant&nbsp;memory&nbsp;access&nbsp;patterns.&nbsp;If&nbsp;the&nbsp;plaintext&nbsp;was</span><br>
<span class="lineno">110</span><span class="comment" id="4728008">//&nbsp;valid&nbsp;then&nbsp;index&nbsp;contains&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;original&nbsp;message&nbsp;in&nbsp;em.</span><br>
<span class="lineno"></span><span class="keyword" id="4728078">func</span>&nbsp;<span class="ident" id="4728083">decryptPKCS1v15</span><span class="op" id="4728098">(</span><span class="ident" id="4728099">rand</span>&nbsp;<span class="ident" id="4728104"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4728106">.</span><span class="ident" id="4728107"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4728113">,</span>&nbsp;<span class="ident" id="4728115">priv</span>&nbsp;<span class="op" id="4728120">*</span><span class="ident" id="4728121"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4728131">,</span>&nbsp;<span class="ident" id="4728133">ciphertext</span>&nbsp;<span class="op" id="4728144">[</span><span class="op" id="4728145">]</span><span class="builtintype" id="4728146">byte</span><span class="op" id="4728150">)</span>&nbsp;<span class="op" id="4728152">(</span><span class="ident" id="4728153">valid</span>&nbsp;<span class="builtintype" id="4728159">int</span><span class="op" id="4728162">,</span>&nbsp;<span class="ident" id="4728164">em</span>&nbsp;<span class="op" id="4728167">[</span><span class="op" id="4728168">]</span><span class="builtintype" id="4728169">byte</span><span class="op" id="4728173">,</span>&nbsp;<span class="ident" id="4728175">index</span>&nbsp;<span class="builtintype" id="4728181">int</span><span class="op" id="4728184">,</span>&nbsp;<span class="ident" id="4728186">err</span>&nbsp;<span class="builtintype" id="4728190">error</span><span class="op" id="4728195">)</span>&nbsp;<span class="op" id="4728197">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728200">k</span>&nbsp;<span class="op" id="4728202">:=</span>&nbsp;<span class="op" id="4728205">(</span><span class="ident" id="4728206"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728115">priv</a></span><span class="op" id="4728210">.</span><span class="ident" id="4728211"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4728212">.</span><span class="ident" id="4728213"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4728219">(</span><span class="op" id="4728220">)</span>&nbsp;<span class="op" id="4728222">+</span>&nbsp;<span class="num" id="4728224">7</span><span class="op" id="4728225">)</span>&nbsp;<span class="op" id="4728227">/</span>&nbsp;<span class="num" id="4728229">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4728232">if</span>&nbsp;<span class="ident" id="4728235"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728200">k</a></span>&nbsp;<span class="op" id="4728237">&lt;</span>&nbsp;<span class="num" id="4728239">11</span>&nbsp;<span class="op" id="4728242">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728246"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728186">err</a></span>&nbsp;<span class="op" id="4728250">=</span>&nbsp;<span class="ident" id="4728252"><a href="/gostd/crypto/rsa/rsa.go.html#4751957">ErrDecryption</a></span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4728268">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4728276">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728280">c</span>&nbsp;<span class="op" id="4728282">:=</span>&nbsp;<span class="builtinfunc" id="4728285">new</span><span class="op" id="4728288">(</span><span class="ident" id="4728289"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4728292">.</span><span class="ident" id="4728293"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4728296">)</span><span class="op" id="4728297">.</span><span class="ident" id="4728298"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4728306">(</span><span class="ident" id="4728307"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728133">ciphertext</a></span><span class="op" id="4728317">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728320">m</span><span class="op" id="4728321">,</span>&nbsp;<span class="ident" id="4728323"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728186">err</a></span>&nbsp;<span class="op" id="4728327">:=</span>&nbsp;<span class="ident" id="4728330"><a href="/gostd/crypto/rsa/rsa.go.html#4753954">decrypt</a></span><span class="op" id="4728337">(</span><span class="ident" id="4728338"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728099">rand</a></span><span class="op" id="4728342">,</span>&nbsp;<span class="ident" id="4728344"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728115">priv</a></span><span class="op" id="4728348">,</span>&nbsp;<span class="ident" id="4728350"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728280">c</a></span><span class="op" id="4728351">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4728354">if</span>&nbsp;<span class="ident" id="4728357"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728186">err</a></span>&nbsp;<span class="op" id="4728361">!=</span>&nbsp;<span class="builtintype" id="4728364">nil</span>&nbsp;<span class="op" id="4728368">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4728372">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4728380">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728384"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span>&nbsp;<span class="op" id="4728387">=</span>&nbsp;<span class="ident" id="4728389"><a href="/gostd/crypto/rsa/rsa.go.html#4758084">leftPad</a></span><span class="op" id="4728396">(</span><span class="ident" id="4728397"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728320">m</a></span><span class="op" id="4728398">.</span><span class="ident" id="4728399"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4728404">(</span><span class="op" id="4728405">)</span><span class="op" id="4728406">,</span>&nbsp;<span class="ident" id="4728408"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728200">k</a></span><span class="op" id="4728409">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728412">firstByteIsZero</span>&nbsp;<span class="op" id="4728428">:=</span>&nbsp;<span class="ident" id="4728431"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4728437">.</span><span class="ident" id="4728438"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4728456">(</span><span class="ident" id="4728457"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span><span class="op" id="4728459">[</span><span class="num" id="4728460">0</span><span class="op" id="4728461">]</span><span class="op" id="4728462">,</span>&nbsp;<span class="num" id="4728464">0</span><span class="op" id="4728465">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728468">secondByteIsTwo</span>&nbsp;<span class="op" id="4728484">:=</span>&nbsp;<span class="ident" id="4728487"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4728493">.</span><span class="ident" id="4728494"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4728512">(</span><span class="ident" id="4728513"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span><span class="op" id="4728515">[</span><span class="num" id="4728516">1</span><span class="op" id="4728517">]</span><span class="op" id="4728518">,</span>&nbsp;<span class="num" id="4728520">2</span><span class="op" id="4728521">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4728525">//&nbsp;The&nbsp;remainder&nbsp;of&nbsp;the&nbsp;plaintext&nbsp;must&nbsp;be&nbsp;a&nbsp;string&nbsp;of&nbsp;non-zero&nbsp;random</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4728596">//&nbsp;octets,&nbsp;followed&nbsp;by&nbsp;a&nbsp;0,&nbsp;followed&nbsp;by&nbsp;the&nbsp;message.</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4728650">//&nbsp;&nbsp;&nbsp;lookingForIndex:&nbsp;1&nbsp;iff&nbsp;we&nbsp;are&nbsp;still&nbsp;looking&nbsp;for&nbsp;the&nbsp;zero.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4728714">//&nbsp;&nbsp;&nbsp;index:&nbsp;the&nbsp;offset&nbsp;of&nbsp;the&nbsp;first&nbsp;zero&nbsp;byte.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728762">lookingForIndex</span>&nbsp;<span class="op" id="4728778">:=</span>&nbsp;<span class="num" id="4728781">1</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4728785">for</span>&nbsp;<span class="ident" id="4728789">i</span>&nbsp;<span class="op" id="4728791">:=</span>&nbsp;<span class="num" id="4728794">2</span><span class="op" id="4728795">;</span>&nbsp;<span class="ident" id="4728797"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728789">i</a></span>&nbsp;<span class="op" id="4728799">&lt;</span>&nbsp;<span class="builtinfunc" id="4728801">len</span><span class="op" id="4728804">(</span><span class="ident" id="4728805"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span><span class="op" id="4728807">)</span><span class="op" id="4728808">;</span>&nbsp;<span class="ident" id="4728810"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728789">i</a></span><span class="op" id="4728811">++</span>&nbsp;<span class="op" id="4728814">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728818">equals0</span>&nbsp;<span class="op" id="4728826">:=</span>&nbsp;<span class="ident" id="4728829"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4728835">.</span><span class="ident" id="4728836"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4728854">(</span><span class="ident" id="4728855"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span><span class="op" id="4728857">[</span><span class="ident" id="4728858"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728789">i</a></span><span class="op" id="4728859">]</span><span class="op" id="4728860">,</span>&nbsp;<span class="num" id="4728862">0</span><span class="op" id="4728863">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728867"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span>&nbsp;<span class="op" id="4728873">=</span>&nbsp;<span class="ident" id="4728875"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4728881">.</span><span class="ident" id="4728882"><a href="/gostd/crypto/subtle/constant_time.go.html#4428861">ConstantTimeSelect</a></span><span class="op" id="4728900">(</span><span class="ident" id="4728901"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728762">lookingForIndex</a></span><span class="op" id="4728916">&amp;</span><span class="ident" id="4728917"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728818">equals0</a></span><span class="op" id="4728924">,</span>&nbsp;<span class="ident" id="4728926"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728789">i</a></span><span class="op" id="4728927">,</span>&nbsp;<span class="ident" id="4728929"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span><span class="op" id="4728934">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4728938"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728762">lookingForIndex</a></span>&nbsp;<span class="op" id="4728954">=</span>&nbsp;<span class="ident" id="4728956"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4728962">.</span><span class="ident" id="4728963"><a href="/gostd/crypto/subtle/constant_time.go.html#4428861">ConstantTimeSelect</a></span><span class="op" id="4728981">(</span><span class="ident" id="4728982"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728818">equals0</a></span><span class="op" id="4728989">,</span>&nbsp;<span class="num" id="4728991">0</span><span class="op" id="4728992">,</span>&nbsp;<span class="ident" id="4728994"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728762">lookingForIndex</a></span><span class="op" id="4729009">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4729012">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4729016">//&nbsp;The&nbsp;PS&nbsp;padding&nbsp;must&nbsp;be&nbsp;at&nbsp;least&nbsp;8&nbsp;bytes&nbsp;long,&nbsp;and&nbsp;it&nbsp;starts&nbsp;two</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4729084">//&nbsp;bytes&nbsp;into&nbsp;em.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729103">validPS</span>&nbsp;<span class="op" id="4729111">:=</span>&nbsp;<span class="ident" id="4729114"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4729120">.</span><span class="ident" id="4729121"><a href="/gostd/crypto/subtle/constant_time.go.html#4429851">ConstantTimeLessOrEq</a></span><span class="op" id="4729141">(</span><span class="num" id="4729142">2</span><span class="op" id="4729143">+</span><span class="num" id="4729144">8</span><span class="op" id="4729145">,</span>&nbsp;<span class="ident" id="4729147"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span><span class="op" id="4729152">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729156"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728153">valid</a></span>&nbsp;<span class="op" id="4729162">=</span>&nbsp;<span class="ident" id="4729164"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728412">firstByteIsZero</a></span>&nbsp;<span class="op" id="4729180">&amp;</span>&nbsp;<span class="ident" id="4729182"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728468">secondByteIsTwo</a></span>&nbsp;<span class="op" id="4729198">&amp;</span>&nbsp;<span class="op" id="4729200">(</span><span class="op" id="4729201">^</span><span class="ident" id="4729202"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728762">lookingForIndex</a></span>&nbsp;<span class="op" id="4729218">&amp;</span>&nbsp;<span class="num" id="4729220">1</span><span class="op" id="4729221">)</span>&nbsp;<span class="op" id="4729223">&amp;</span>&nbsp;<span class="ident" id="4729225"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729103">validPS</a></span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729234"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span>&nbsp;<span class="op" id="4729240">=</span>&nbsp;<span class="ident" id="4729242"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4729248">.</span><span class="ident" id="4729249"><a href="/gostd/crypto/subtle/constant_time.go.html#4428861">ConstantTimeSelect</a></span><span class="op" id="4729267">(</span><span class="ident" id="4729268"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728153">valid</a></span><span class="op" id="4729273">,</span>&nbsp;<span class="ident" id="4729275"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span><span class="op" id="4729280">+</span><span class="num" id="4729281">1</span><span class="op" id="4729282">,</span>&nbsp;<span class="num" id="4729284">0</span><span class="op" id="4729285">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729288">return</span>&nbsp;<span class="ident" id="4729295"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728153">valid</a></span><span class="op" id="4729300">,</span>&nbsp;<span class="ident" id="4729302"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728164">em</a></span><span class="op" id="4729304">,</span>&nbsp;<span class="ident" id="4729306"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4728175">index</a></span><span class="op" id="4729311">,</span>&nbsp;<span class="builtintype" id="4729313">nil</span><br>
<span class="lineno"></span><span class="op" id="4729317">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4729320">//&nbsp;nonZeroRandomBytes&nbsp;fills&nbsp;the&nbsp;given&nbsp;slice&nbsp;with&nbsp;non-zero&nbsp;random&nbsp;octets.</span><br>
<span class="lineno">150</span><span class="keyword" id="4729393">func</span>&nbsp;<span class="ident" id="4729398">nonZeroRandomBytes</span><span class="op" id="4729416">(</span><span class="ident" id="4729417">s</span>&nbsp;<span class="op" id="4729419">[</span><span class="op" id="4729420">]</span><span class="builtintype" id="4729421">byte</span><span class="op" id="4729425">,</span>&nbsp;<span class="ident" id="4729427">rand</span>&nbsp;<span class="ident" id="4729432"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4729434">.</span><span class="ident" id="4729435"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4729441">)</span>&nbsp;<span class="op" id="4729443">(</span><span class="ident" id="4729444">err</span>&nbsp;<span class="builtintype" id="4729448">error</span><span class="op" id="4729453">)</span>&nbsp;<span class="op" id="4729455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729458">_</span><span class="op" id="4729459">,</span>&nbsp;<span class="ident" id="4729461"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729444">err</a></span>&nbsp;<span class="op" id="4729465">=</span>&nbsp;<span class="ident" id="4729467"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4729469">.</span><span class="ident" id="4729470"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4729478">(</span><span class="ident" id="4729479"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729427">rand</a></span><span class="op" id="4729483">,</span>&nbsp;<span class="ident" id="4729485"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729417">s</a></span><span class="op" id="4729486">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729489">if</span>&nbsp;<span class="ident" id="4729492"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729444">err</a></span>&nbsp;<span class="op" id="4729496">!=</span>&nbsp;<span class="builtintype" id="4729499">nil</span>&nbsp;<span class="op" id="4729503">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729507">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4729515">}</span><br>
<span class="lineno">155</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729519">for</span>&nbsp;<span class="ident" id="4729523">i</span>&nbsp;<span class="op" id="4729525">:=</span>&nbsp;<span class="num" id="4729528">0</span><span class="op" id="4729529">;</span>&nbsp;<span class="ident" id="4729531"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span>&nbsp;<span class="op" id="4729533">&lt;</span>&nbsp;<span class="builtinfunc" id="4729535">len</span><span class="op" id="4729538">(</span><span class="ident" id="4729539"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729417">s</a></span><span class="op" id="4729540">)</span><span class="op" id="4729541">;</span>&nbsp;<span class="ident" id="4729543"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span><span class="op" id="4729544">++</span>&nbsp;<span class="op" id="4729547">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729551">for</span>&nbsp;<span class="ident" id="4729555"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729417">s</a></span><span class="op" id="4729556">[</span><span class="ident" id="4729557"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span><span class="op" id="4729558">]</span>&nbsp;<span class="op" id="4729560">==</span>&nbsp;<span class="num" id="4729563">0</span>&nbsp;<span class="op" id="4729565">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729570">_</span><span class="op" id="4729571">,</span>&nbsp;<span class="ident" id="4729573"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729444">err</a></span>&nbsp;<span class="op" id="4729577">=</span>&nbsp;<span class="ident" id="4729579"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4729581">.</span><span class="ident" id="4729582"><a href="/gostd/io/io.go.html#1429706">ReadFull</a></span><span class="op" id="4729590">(</span><span class="ident" id="4729591"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729427">rand</a></span><span class="op" id="4729595">,</span>&nbsp;<span class="ident" id="4729597"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729417">s</a></span><span class="op" id="4729598">[</span><span class="ident" id="4729599"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span><span class="op" id="4729600">:</span><span class="ident" id="4729601"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span><span class="op" id="4729602">+</span><span class="num" id="4729603">1</span><span class="op" id="4729604">]</span><span class="op" id="4729605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729610">if</span>&nbsp;<span class="ident" id="4729613"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729444">err</a></span>&nbsp;<span class="op" id="4729617">!=</span>&nbsp;<span class="builtintype" id="4729620">nil</span>&nbsp;<span class="op" id="4729624">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729630">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4729640">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4729645">//&nbsp;In&nbsp;tests,&nbsp;the&nbsp;PRNG&nbsp;may&nbsp;return&nbsp;all&nbsp;zeros&nbsp;so&nbsp;we&nbsp;do</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4729700">//&nbsp;this&nbsp;to&nbsp;break&nbsp;the&nbsp;loop.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4729730"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729417">s</a></span><span class="op" id="4729731">[</span><span class="ident" id="4729732"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4729523">i</a></span><span class="op" id="4729733">]</span>&nbsp;<span class="op" id="4729735">^=</span>&nbsp;<span class="num" id="4729738">0x42</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4729745">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4729748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4729752">return</span><br>
<span class="lineno"></span><span class="op" id="4729759">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="comment" id="4729762">//&nbsp;These&nbsp;are&nbsp;ASN1&nbsp;DER&nbsp;structures:</span><br>
<span class="lineno"></span><span class="comment" id="4729796">//&nbsp;&nbsp;&nbsp;DigestInfo&nbsp;::=&nbsp;SEQUENCE&nbsp;{</span><br>
<span class="lineno"></span><span class="comment" id="4729827">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digestAlgorithm&nbsp;AlgorithmIdentifier,</span><br>
<span class="lineno"></span><span class="comment" id="4729871">//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;digest&nbsp;OCTET&nbsp;STRING</span><br>
<span class="lineno">175</span><span class="comment" id="4729898">//&nbsp;&nbsp;&nbsp;}</span><br>
<span class="lineno"></span><span class="comment" id="4729905">//&nbsp;For&nbsp;performance,&nbsp;we&nbsp;don&#39;t&nbsp;use&nbsp;the&nbsp;generic&nbsp;ASN1&nbsp;encoder.&nbsp;Rather,&nbsp;we</span><br>
<span class="lineno"></span><span class="comment" id="4729975">//&nbsp;precompute&nbsp;a&nbsp;prefix&nbsp;of&nbsp;the&nbsp;digest&nbsp;value&nbsp;that&nbsp;makes&nbsp;a&nbsp;valid&nbsp;ASN1&nbsp;DER&nbsp;string</span><br>
<span class="lineno"></span><span class="comment" id="4730053">//&nbsp;with&nbsp;the&nbsp;correct&nbsp;contents.</span><br>
<span class="lineno"></span><span class="keyword" id="4730083">var</span>&nbsp;<span class="ident" id="4730087">hashPrefixes</span>&nbsp;<span class="op" id="4730100">=</span>&nbsp;<span class="keyword" id="4730102">map</span><span class="op" id="4730105">[</span><span class="ident" id="4730106"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730112">.</span><span class="ident" id="4730113"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4730117">]</span><span class="op" id="4730118">[</span><span class="op" id="4730119">]</span><span class="builtintype" id="4730120">byte</span><span class="op" id="4730124">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730127"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730133">.</span><span class="ident" id="4730134"><a href="/gostd/crypto/crypto.go.html#3010261">MD5</a></span><span class="op" id="4730137">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730145">{</span><span class="num" id="4730146">0x30</span><span class="op" id="4730150">,</span>&nbsp;<span class="num" id="4730152">0x20</span><span class="op" id="4730156">,</span>&nbsp;<span class="num" id="4730158">0x30</span><span class="op" id="4730162">,</span>&nbsp;<span class="num" id="4730164">0x0c</span><span class="op" id="4730168">,</span>&nbsp;<span class="num" id="4730170">0x06</span><span class="op" id="4730174">,</span>&nbsp;<span class="num" id="4730176">0x08</span><span class="op" id="4730180">,</span>&nbsp;<span class="num" id="4730182">0x2a</span><span class="op" id="4730186">,</span>&nbsp;<span class="num" id="4730188">0x86</span><span class="op" id="4730192">,</span>&nbsp;<span class="num" id="4730194">0x48</span><span class="op" id="4730198">,</span>&nbsp;<span class="num" id="4730200">0x86</span><span class="op" id="4730204">,</span>&nbsp;<span class="num" id="4730206">0xf7</span><span class="op" id="4730210">,</span>&nbsp;<span class="num" id="4730212">0x0d</span><span class="op" id="4730216">,</span>&nbsp;<span class="num" id="4730218">0x02</span><span class="op" id="4730222">,</span>&nbsp;<span class="num" id="4730224">0x05</span><span class="op" id="4730228">,</span>&nbsp;<span class="num" id="4730230">0x05</span><span class="op" id="4730234">,</span>&nbsp;<span class="num" id="4730236">0x00</span><span class="op" id="4730240">,</span>&nbsp;<span class="num" id="4730242">0x04</span><span class="op" id="4730246">,</span>&nbsp;<span class="num" id="4730248">0x10</span><span class="op" id="4730252">}</span><span class="op" id="4730253">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730256"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730262">.</span><span class="ident" id="4730263"><a href="/gostd/crypto/crypto.go.html#3010309">SHA1</a></span><span class="op" id="4730267">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730274">{</span><span class="num" id="4730275">0x30</span><span class="op" id="4730279">,</span>&nbsp;<span class="num" id="4730281">0x21</span><span class="op" id="4730285">,</span>&nbsp;<span class="num" id="4730287">0x30</span><span class="op" id="4730291">,</span>&nbsp;<span class="num" id="4730293">0x09</span><span class="op" id="4730297">,</span>&nbsp;<span class="num" id="4730299">0x06</span><span class="op" id="4730303">,</span>&nbsp;<span class="num" id="4730305">0x05</span><span class="op" id="4730309">,</span>&nbsp;<span class="num" id="4730311">0x2b</span><span class="op" id="4730315">,</span>&nbsp;<span class="num" id="4730317">0x0e</span><span class="op" id="4730321">,</span>&nbsp;<span class="num" id="4730323">0x03</span><span class="op" id="4730327">,</span>&nbsp;<span class="num" id="4730329">0x02</span><span class="op" id="4730333">,</span>&nbsp;<span class="num" id="4730335">0x1a</span><span class="op" id="4730339">,</span>&nbsp;<span class="num" id="4730341">0x05</span><span class="op" id="4730345">,</span>&nbsp;<span class="num" id="4730347">0x00</span><span class="op" id="4730351">,</span>&nbsp;<span class="num" id="4730353">0x04</span><span class="op" id="4730357">,</span>&nbsp;<span class="num" id="4730359">0x14</span><span class="op" id="4730363">}</span><span class="op" id="4730364">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730367"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730373">.</span><span class="ident" id="4730374"><a href="/gostd/crypto/crypto.go.html#3010358">SHA224</a></span><span class="op" id="4730380">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730385">{</span><span class="num" id="4730386">0x30</span><span class="op" id="4730390">,</span>&nbsp;<span class="num" id="4730392">0x2d</span><span class="op" id="4730396">,</span>&nbsp;<span class="num" id="4730398">0x30</span><span class="op" id="4730402">,</span>&nbsp;<span class="num" id="4730404">0x0d</span><span class="op" id="4730408">,</span>&nbsp;<span class="num" id="4730410">0x06</span><span class="op" id="4730414">,</span>&nbsp;<span class="num" id="4730416">0x09</span><span class="op" id="4730420">,</span>&nbsp;<span class="num" id="4730422">0x60</span><span class="op" id="4730426">,</span>&nbsp;<span class="num" id="4730428">0x86</span><span class="op" id="4730432">,</span>&nbsp;<span class="num" id="4730434">0x48</span><span class="op" id="4730438">,</span>&nbsp;<span class="num" id="4730440">0x01</span><span class="op" id="4730444">,</span>&nbsp;<span class="num" id="4730446">0x65</span><span class="op" id="4730450">,</span>&nbsp;<span class="num" id="4730452">0x03</span><span class="op" id="4730456">,</span>&nbsp;<span class="num" id="4730458">0x04</span><span class="op" id="4730462">,</span>&nbsp;<span class="num" id="4730464">0x02</span><span class="op" id="4730468">,</span>&nbsp;<span class="num" id="4730470">0x04</span><span class="op" id="4730474">,</span>&nbsp;<span class="num" id="4730476">0x05</span><span class="op" id="4730480">,</span>&nbsp;<span class="num" id="4730482">0x00</span><span class="op" id="4730486">,</span>&nbsp;<span class="num" id="4730488">0x04</span><span class="op" id="4730492">,</span>&nbsp;<span class="num" id="4730494">0x1c</span><span class="op" id="4730498">}</span><span class="op" id="4730499">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730502"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730508">.</span><span class="ident" id="4730509"><a href="/gostd/crypto/crypto.go.html#3010409">SHA256</a></span><span class="op" id="4730515">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730520">{</span><span class="num" id="4730521">0x30</span><span class="op" id="4730525">,</span>&nbsp;<span class="num" id="4730527">0x31</span><span class="op" id="4730531">,</span>&nbsp;<span class="num" id="4730533">0x30</span><span class="op" id="4730537">,</span>&nbsp;<span class="num" id="4730539">0x0d</span><span class="op" id="4730543">,</span>&nbsp;<span class="num" id="4730545">0x06</span><span class="op" id="4730549">,</span>&nbsp;<span class="num" id="4730551">0x09</span><span class="op" id="4730555">,</span>&nbsp;<span class="num" id="4730557">0x60</span><span class="op" id="4730561">,</span>&nbsp;<span class="num" id="4730563">0x86</span><span class="op" id="4730567">,</span>&nbsp;<span class="num" id="4730569">0x48</span><span class="op" id="4730573">,</span>&nbsp;<span class="num" id="4730575">0x01</span><span class="op" id="4730579">,</span>&nbsp;<span class="num" id="4730581">0x65</span><span class="op" id="4730585">,</span>&nbsp;<span class="num" id="4730587">0x03</span><span class="op" id="4730591">,</span>&nbsp;<span class="num" id="4730593">0x04</span><span class="op" id="4730597">,</span>&nbsp;<span class="num" id="4730599">0x02</span><span class="op" id="4730603">,</span>&nbsp;<span class="num" id="4730605">0x01</span><span class="op" id="4730609">,</span>&nbsp;<span class="num" id="4730611">0x05</span><span class="op" id="4730615">,</span>&nbsp;<span class="num" id="4730617">0x00</span><span class="op" id="4730621">,</span>&nbsp;<span class="num" id="4730623">0x04</span><span class="op" id="4730627">,</span>&nbsp;<span class="num" id="4730629">0x20</span><span class="op" id="4730633">}</span><span class="op" id="4730634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730637"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730643">.</span><span class="ident" id="4730644"><a href="/gostd/crypto/crypto.go.html#3010460">SHA384</a></span><span class="op" id="4730650">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730655">{</span><span class="num" id="4730656">0x30</span><span class="op" id="4730660">,</span>&nbsp;<span class="num" id="4730662">0x41</span><span class="op" id="4730666">,</span>&nbsp;<span class="num" id="4730668">0x30</span><span class="op" id="4730672">,</span>&nbsp;<span class="num" id="4730674">0x0d</span><span class="op" id="4730678">,</span>&nbsp;<span class="num" id="4730680">0x06</span><span class="op" id="4730684">,</span>&nbsp;<span class="num" id="4730686">0x09</span><span class="op" id="4730690">,</span>&nbsp;<span class="num" id="4730692">0x60</span><span class="op" id="4730696">,</span>&nbsp;<span class="num" id="4730698">0x86</span><span class="op" id="4730702">,</span>&nbsp;<span class="num" id="4730704">0x48</span><span class="op" id="4730708">,</span>&nbsp;<span class="num" id="4730710">0x01</span><span class="op" id="4730714">,</span>&nbsp;<span class="num" id="4730716">0x65</span><span class="op" id="4730720">,</span>&nbsp;<span class="num" id="4730722">0x03</span><span class="op" id="4730726">,</span>&nbsp;<span class="num" id="4730728">0x04</span><span class="op" id="4730732">,</span>&nbsp;<span class="num" id="4730734">0x02</span><span class="op" id="4730738">,</span>&nbsp;<span class="num" id="4730740">0x02</span><span class="op" id="4730744">,</span>&nbsp;<span class="num" id="4730746">0x05</span><span class="op" id="4730750">,</span>&nbsp;<span class="num" id="4730752">0x00</span><span class="op" id="4730756">,</span>&nbsp;<span class="num" id="4730758">0x04</span><span class="op" id="4730762">,</span>&nbsp;<span class="num" id="4730764">0x30</span><span class="op" id="4730768">}</span><span class="op" id="4730769">,</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730772"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730778">.</span><span class="ident" id="4730779"><a href="/gostd/crypto/crypto.go.html#3010511">SHA512</a></span><span class="op" id="4730785">:</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4730790">{</span><span class="num" id="4730791">0x30</span><span class="op" id="4730795">,</span>&nbsp;<span class="num" id="4730797">0x51</span><span class="op" id="4730801">,</span>&nbsp;<span class="num" id="4730803">0x30</span><span class="op" id="4730807">,</span>&nbsp;<span class="num" id="4730809">0x0d</span><span class="op" id="4730813">,</span>&nbsp;<span class="num" id="4730815">0x06</span><span class="op" id="4730819">,</span>&nbsp;<span class="num" id="4730821">0x09</span><span class="op" id="4730825">,</span>&nbsp;<span class="num" id="4730827">0x60</span><span class="op" id="4730831">,</span>&nbsp;<span class="num" id="4730833">0x86</span><span class="op" id="4730837">,</span>&nbsp;<span class="num" id="4730839">0x48</span><span class="op" id="4730843">,</span>&nbsp;<span class="num" id="4730845">0x01</span><span class="op" id="4730849">,</span>&nbsp;<span class="num" id="4730851">0x65</span><span class="op" id="4730855">,</span>&nbsp;<span class="num" id="4730857">0x03</span><span class="op" id="4730861">,</span>&nbsp;<span class="num" id="4730863">0x04</span><span class="op" id="4730867">,</span>&nbsp;<span class="num" id="4730869">0x02</span><span class="op" id="4730873">,</span>&nbsp;<span class="num" id="4730875">0x03</span><span class="op" id="4730879">,</span>&nbsp;<span class="num" id="4730881">0x05</span><span class="op" id="4730885">,</span>&nbsp;<span class="num" id="4730887">0x00</span><span class="op" id="4730891">,</span>&nbsp;<span class="num" id="4730893">0x04</span><span class="op" id="4730897">,</span>&nbsp;<span class="num" id="4730899">0x40</span><span class="op" id="4730903">}</span><span class="op" id="4730904">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730907"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730913">.</span><span class="ident" id="4730914"><a href="/gostd/crypto/crypto.go.html#3010562">MD5SHA1</a></span><span class="op" id="4730921">:</span>&nbsp;&nbsp;&nbsp;<span class="op" id="4730925">{</span><span class="op" id="4730926">}</span><span class="op" id="4730927">,</span>&nbsp;<span class="comment" id="4730929">//&nbsp;A&nbsp;special&nbsp;TLS&nbsp;case&nbsp;which&nbsp;doesn&#39;t&nbsp;use&nbsp;an&nbsp;ASN1&nbsp;prefix.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4730986"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4730992">.</span><span class="ident" id="4730993"><a href="/gostd/crypto/crypto.go.html#3010637">RIPEMD160</a></span><span class="op" id="4731002">:</span>&nbsp;<span class="op" id="4731004">{</span><span class="num" id="4731005">0x30</span><span class="op" id="4731009">,</span>&nbsp;<span class="num" id="4731011">0x20</span><span class="op" id="4731015">,</span>&nbsp;<span class="num" id="4731017">0x30</span><span class="op" id="4731021">,</span>&nbsp;<span class="num" id="4731023">0x08</span><span class="op" id="4731027">,</span>&nbsp;<span class="num" id="4731029">0x06</span><span class="op" id="4731033">,</span>&nbsp;<span class="num" id="4731035">0x06</span><span class="op" id="4731039">,</span>&nbsp;<span class="num" id="4731041">0x28</span><span class="op" id="4731045">,</span>&nbsp;<span class="num" id="4731047">0xcf</span><span class="op" id="4731051">,</span>&nbsp;<span class="num" id="4731053">0x06</span><span class="op" id="4731057">,</span>&nbsp;<span class="num" id="4731059">0x03</span><span class="op" id="4731063">,</span>&nbsp;<span class="num" id="4731065">0x00</span><span class="op" id="4731069">,</span>&nbsp;<span class="num" id="4731071">0x31</span><span class="op" id="4731075">,</span>&nbsp;<span class="num" id="4731077">0x04</span><span class="op" id="4731081">,</span>&nbsp;<span class="num" id="4731083">0x14</span><span class="op" id="4731087">}</span><span class="op" id="4731088">,</span><br>
<span class="lineno"></span><span class="op" id="4731090">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="comment" id="4731093">//&nbsp;SignPKCS1v15&nbsp;calculates&nbsp;the&nbsp;signature&nbsp;of&nbsp;hashed&nbsp;using&nbsp;RSASSA-PKCS1-V1_5-SIGN&nbsp;from&nbsp;RSA&nbsp;PKCS#1&nbsp;v1.5.</span><br>
<span class="lineno"></span><span class="comment" id="4731195">//&nbsp;Note&nbsp;that&nbsp;hashed&nbsp;must&nbsp;be&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="4731273">//&nbsp;given&nbsp;hash&nbsp;function.&nbsp;If&nbsp;hash&nbsp;is&nbsp;zero,&nbsp;hashed&nbsp;is&nbsp;signed&nbsp;directly.&nbsp;This&nbsp;isn&#39;t</span><br>
<span class="lineno"></span><span class="comment" id="4731352">//&nbsp;advisable&nbsp;except&nbsp;for&nbsp;interoperability.</span><br>
<span class="lineno"></span><span class="keyword" id="4731394">func</span>&nbsp;<span class="ident" id="4731399">SignPKCS1v15</span><span class="op" id="4731411">(</span><span class="ident" id="4731412">rand</span>&nbsp;<span class="ident" id="4731417"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724548">io</a></span><span class="op" id="4731419">.</span><span class="ident" id="4731420"><a href="/gostd/io/io.go.html#1421823">Reader</a></span><span class="op" id="4731426">,</span>&nbsp;<span class="ident" id="4731428">priv</span>&nbsp;<span class="op" id="4731433">*</span><span class="ident" id="4731434"><a href="/gostd/crypto/rsa/rsa.go.html#4743774">PrivateKey</a></span><span class="op" id="4731444">,</span>&nbsp;<span class="ident" id="4731446">hash</span>&nbsp;<span class="ident" id="4731451"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4731457">.</span><span class="ident" id="4731458"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4731462">,</span>&nbsp;<span class="ident" id="4731464">hashed</span>&nbsp;<span class="op" id="4731471">[</span><span class="op" id="4731472">]</span><span class="builtintype" id="4731473">byte</span><span class="op" id="4731477">)</span>&nbsp;<span class="op" id="4731479">(</span><span class="ident" id="4731480">s</span>&nbsp;<span class="op" id="4731482">[</span><span class="op" id="4731483">]</span><span class="builtintype" id="4731484">byte</span><span class="op" id="4731488">,</span>&nbsp;<span class="ident" id="4731490">err</span>&nbsp;<span class="builtintype" id="4731494">error</span><span class="op" id="4731499">)</span>&nbsp;<span class="op" id="4731501">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731504">hashLen</span><span class="op" id="4731511">,</span>&nbsp;<span class="ident" id="4731513">prefix</span><span class="op" id="4731519">,</span>&nbsp;<span class="ident" id="4731521"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731490">err</a></span>&nbsp;<span class="op" id="4731525">:=</span>&nbsp;<span class="ident" id="4731528"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733230">pkcs1v15HashInfo</a></span><span class="op" id="4731544">(</span><span class="ident" id="4731545"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731446">hash</a></span><span class="op" id="4731549">,</span>&nbsp;<span class="builtinfunc" id="4731551">len</span><span class="op" id="4731554">(</span><span class="ident" id="4731555"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731464">hashed</a></span><span class="op" id="4731561">)</span><span class="op" id="4731562">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731565">if</span>&nbsp;<span class="ident" id="4731568"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731490">err</a></span>&nbsp;<span class="op" id="4731572">!=</span>&nbsp;<span class="builtintype" id="4731575">nil</span>&nbsp;<span class="op" id="4731579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731583">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731591">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731595">tLen</span>&nbsp;<span class="op" id="4731600">:=</span>&nbsp;<span class="builtinfunc" id="4731603">len</span><span class="op" id="4731606">(</span><span class="ident" id="4731607"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731513">prefix</a></span><span class="op" id="4731613">)</span>&nbsp;<span class="op" id="4731615">+</span>&nbsp;<span class="ident" id="4731617"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731504">hashLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731626">k</span>&nbsp;<span class="op" id="4731628">:=</span>&nbsp;<span class="op" id="4731631">(</span><span class="ident" id="4731632"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731428">priv</a></span><span class="op" id="4731636">.</span><span class="ident" id="4731637"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4731638">.</span><span class="ident" id="4731639"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4731645">(</span><span class="op" id="4731646">)</span>&nbsp;<span class="op" id="4731648">+</span>&nbsp;<span class="num" id="4731650">7</span><span class="op" id="4731651">)</span>&nbsp;<span class="op" id="4731653">/</span>&nbsp;<span class="num" id="4731655">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731658">if</span>&nbsp;<span class="ident" id="4731661"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span>&nbsp;<span class="op" id="4731663">&lt;</span>&nbsp;<span class="ident" id="4731665"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731595">tLen</a></span><span class="op" id="4731669">+</span><span class="num" id="4731670">11</span>&nbsp;<span class="op" id="4731673">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731677">return</span>&nbsp;<span class="builtintype" id="4731684">nil</span><span class="op" id="4731687">,</span>&nbsp;<span class="ident" id="4731689"><a href="/gostd/crypto/rsa/rsa.go.html#4750558">ErrMessageTooLong</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731708">}</span><br>
<span class="lineno">205</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4731712">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x01&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731753">em</span>&nbsp;<span class="op" id="4731756">:=</span>&nbsp;<span class="builtinfunc" id="4731759">make</span><span class="op" id="4731763">(</span><span class="op" id="4731764">[</span><span class="op" id="4731765">]</span><span class="builtintype" id="4731766">byte</span><span class="op" id="4731770">,</span>&nbsp;<span class="ident" id="4731772"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731773">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731776"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4731778">[</span><span class="num" id="4731779">1</span><span class="op" id="4731780">]</span>&nbsp;<span class="op" id="4731782">=</span>&nbsp;<span class="num" id="4731784">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731787">for</span>&nbsp;<span class="ident" id="4731791">i</span>&nbsp;<span class="op" id="4731793">:=</span>&nbsp;<span class="num" id="4731796">2</span><span class="op" id="4731797">;</span>&nbsp;<span class="ident" id="4731799"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731791">i</a></span>&nbsp;<span class="op" id="4731801">&lt;</span>&nbsp;<span class="ident" id="4731803"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731804">-</span><span class="ident" id="4731805"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731595">tLen</a></span><span class="op" id="4731809">-</span><span class="num" id="4731810">1</span><span class="op" id="4731811">;</span>&nbsp;<span class="ident" id="4731813"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731791">i</a></span><span class="op" id="4731814">++</span>&nbsp;<span class="op" id="4731817">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731821"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4731823">[</span><span class="ident" id="4731824"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731791">i</a></span><span class="op" id="4731825">]</span>&nbsp;<span class="op" id="4731827">=</span>&nbsp;<span class="num" id="4731829">0xff</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731835">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4731838">copy</span><span class="op" id="4731842">(</span><span class="ident" id="4731843"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4731845">[</span><span class="ident" id="4731846"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731847">-</span><span class="ident" id="4731848"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731595">tLen</a></span><span class="op" id="4731852">:</span><span class="ident" id="4731853"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731854">-</span><span class="ident" id="4731855"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731504">hashLen</a></span><span class="op" id="4731862">]</span><span class="op" id="4731863">,</span>&nbsp;<span class="ident" id="4731865"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731513">prefix</a></span><span class="op" id="4731871">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4731874">copy</span><span class="op" id="4731878">(</span><span class="ident" id="4731879"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4731881">[</span><span class="ident" id="4731882"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731883">-</span><span class="ident" id="4731884"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731504">hashLen</a></span><span class="op" id="4731891">:</span><span class="ident" id="4731892"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731626">k</a></span><span class="op" id="4731893">]</span><span class="op" id="4731894">,</span>&nbsp;<span class="ident" id="4731896"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731464">hashed</a></span><span class="op" id="4731902">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731906">m</span>&nbsp;<span class="op" id="4731908">:=</span>&nbsp;<span class="builtinfunc" id="4731911">new</span><span class="op" id="4731914">(</span><span class="ident" id="4731915"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4731918">.</span><span class="ident" id="4731919"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4731922">)</span><span class="op" id="4731923">.</span><span class="ident" id="4731924"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4731932">(</span><span class="ident" id="4731933"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4731935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4731938">c</span><span class="op" id="4731939">,</span>&nbsp;<span class="ident" id="4731941"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731490">err</a></span>&nbsp;<span class="op" id="4731945">:=</span>&nbsp;<span class="ident" id="4731948"><a href="/gostd/crypto/rsa/rsa.go.html#4753954">decrypt</a></span><span class="op" id="4731955">(</span><span class="ident" id="4731956"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731412">rand</a></span><span class="op" id="4731960">,</span>&nbsp;<span class="ident" id="4731962"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731428">priv</a></span><span class="op" id="4731966">,</span>&nbsp;<span class="ident" id="4731968"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731906">m</a></span><span class="op" id="4731969">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731972">if</span>&nbsp;<span class="ident" id="4731975"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731490">err</a></span>&nbsp;<span class="op" id="4731979">!=</span>&nbsp;<span class="builtintype" id="4731982">nil</span>&nbsp;<span class="op" id="4731986">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4731990">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4731998">}</span><br>
<span class="lineno">220</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732002"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733795">copyWithLeftPad</a></span><span class="op" id="4732017">(</span><span class="ident" id="4732018"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><span class="op" id="4732020">,</span>&nbsp;<span class="ident" id="4732022"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731938">c</a></span><span class="op" id="4732023">.</span><span class="ident" id="4732024"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4732029">(</span><span class="op" id="4732030">)</span><span class="op" id="4732031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732034"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731480">s</a></span>&nbsp;<span class="op" id="4732036">=</span>&nbsp;<span class="ident" id="4732038"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4731753">em</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732042">return</span><br>
<span class="lineno"></span><span class="op" id="4732049">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="comment" id="4732052">//&nbsp;VerifyPKCS1v15&nbsp;verifies&nbsp;an&nbsp;RSA&nbsp;PKCS#1&nbsp;v1.5&nbsp;signature.</span><br>
<span class="lineno"></span><span class="comment" id="4732109">//&nbsp;hashed&nbsp;is&nbsp;the&nbsp;result&nbsp;of&nbsp;hashing&nbsp;the&nbsp;input&nbsp;message&nbsp;using&nbsp;the&nbsp;given&nbsp;hash</span><br>
<span class="lineno"></span><span class="comment" id="4732183">//&nbsp;function&nbsp;and&nbsp;sig&nbsp;is&nbsp;the&nbsp;signature.&nbsp;A&nbsp;valid&nbsp;signature&nbsp;is&nbsp;indicated&nbsp;by</span><br>
<span class="lineno"></span><span class="comment" id="4732255">//&nbsp;returning&nbsp;a&nbsp;nil&nbsp;error.&nbsp;If&nbsp;hash&nbsp;is&nbsp;zero&nbsp;then&nbsp;hashed&nbsp;is&nbsp;used&nbsp;directly.&nbsp;This</span><br>
<span class="lineno">230</span><span class="comment" id="4732332">//&nbsp;isn&#39;t&nbsp;advisable&nbsp;except&nbsp;for&nbsp;interoperability.</span><br>
<span class="lineno"></span><span class="keyword" id="4732380">func</span>&nbsp;<span class="ident" id="4732385">VerifyPKCS1v15</span><span class="op" id="4732399">(</span><span class="ident" id="4732400">pub</span>&nbsp;<span class="op" id="4732404">*</span><span class="ident" id="4732405"><a href="/gostd/crypto/rsa/rsa.go.html#4742943">PublicKey</a></span><span class="op" id="4732414">,</span>&nbsp;<span class="ident" id="4732416">hash</span>&nbsp;<span class="ident" id="4732421"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4732427">.</span><span class="ident" id="4732428"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4732432">,</span>&nbsp;<span class="ident" id="4732434">hashed</span>&nbsp;<span class="op" id="4732441">[</span><span class="op" id="4732442">]</span><span class="builtintype" id="4732443">byte</span><span class="op" id="4732447">,</span>&nbsp;<span class="ident" id="4732449">sig</span>&nbsp;<span class="op" id="4732453">[</span><span class="op" id="4732454">]</span><span class="builtintype" id="4732455">byte</span><span class="op" id="4732459">)</span>&nbsp;<span class="op" id="4732461">(</span><span class="ident" id="4732462">err</span>&nbsp;<span class="builtintype" id="4732466">error</span><span class="op" id="4732471">)</span>&nbsp;<span class="op" id="4732473">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732476">hashLen</span><span class="op" id="4732483">,</span>&nbsp;<span class="ident" id="4732485">prefix</span><span class="op" id="4732491">,</span>&nbsp;<span class="ident" id="4732493"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732462">err</a></span>&nbsp;<span class="op" id="4732497">:=</span>&nbsp;<span class="ident" id="4732500"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733230">pkcs1v15HashInfo</a></span><span class="op" id="4732516">(</span><span class="ident" id="4732517"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732416">hash</a></span><span class="op" id="4732521">,</span>&nbsp;<span class="builtinfunc" id="4732523">len</span><span class="op" id="4732526">(</span><span class="ident" id="4732527"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732434">hashed</a></span><span class="op" id="4732533">)</span><span class="op" id="4732534">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732537">if</span>&nbsp;<span class="ident" id="4732540"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732462">err</a></span>&nbsp;<span class="op" id="4732544">!=</span>&nbsp;<span class="builtintype" id="4732547">nil</span>&nbsp;<span class="op" id="4732551">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732555">return</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732563">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732567">tLen</span>&nbsp;<span class="op" id="4732572">:=</span>&nbsp;<span class="builtinfunc" id="4732575">len</span><span class="op" id="4732578">(</span><span class="ident" id="4732579"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732485">prefix</a></span><span class="op" id="4732585">)</span>&nbsp;<span class="op" id="4732587">+</span>&nbsp;<span class="ident" id="4732589"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732476">hashLen</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732598">k</span>&nbsp;<span class="op" id="4732600">:=</span>&nbsp;<span class="op" id="4732603">(</span><span class="ident" id="4732604"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732400">pub</a></span><span class="op" id="4732607">.</span><span class="ident" id="4732608"><a href="/gostd/crypto/rsa/rsa.go.html#4742963">N</a></span><span class="op" id="4732609">.</span><span class="ident" id="4732610"><a href="/gostd/math/big/int.go.html#2050389">BitLen</a></span><span class="op" id="4732616">(</span><span class="op" id="4732617">)</span>&nbsp;<span class="op" id="4732619">+</span>&nbsp;<span class="num" id="4732621">7</span><span class="op" id="4732622">)</span>&nbsp;<span class="op" id="4732624">/</span>&nbsp;<span class="num" id="4732626">8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732629">if</span>&nbsp;<span class="ident" id="4732632"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span>&nbsp;<span class="op" id="4732634">&lt;</span>&nbsp;<span class="ident" id="4732636"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732567">tLen</a></span><span class="op" id="4732640">+</span><span class="num" id="4732641">11</span>&nbsp;<span class="op" id="4732644">{</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732648"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732462">err</a></span>&nbsp;<span class="op" id="4732652">=</span>&nbsp;<span class="ident" id="4732654"><a href="/gostd/crypto/rsa/rsa.go.html#4752139">ErrVerification</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4732672">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4732680">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732684">c</span>&nbsp;<span class="op" id="4732686">:=</span>&nbsp;<span class="builtinfunc" id="4732689">new</span><span class="op" id="4732692">(</span><span class="ident" id="4732693"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4732696">.</span><span class="ident" id="4732697"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4732700">)</span><span class="op" id="4732701">.</span><span class="ident" id="4732702"><a href="/gostd/math/big/int.go.html#2050026">SetBytes</a></span><span class="op" id="4732710">(</span><span class="ident" id="4732711"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732449">sig</a></span><span class="op" id="4732714">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732717">m</span>&nbsp;<span class="op" id="4732719">:=</span>&nbsp;<span class="ident" id="4732722"><a href="/gostd/crypto/rsa/rsa.go.html#4750651">encrypt</a></span><span class="op" id="4732729">(</span><span class="builtinfunc" id="4732730">new</span><span class="op" id="4732733">(</span><span class="ident" id="4732734"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724554">big</a></span><span class="op" id="4732737">.</span><span class="ident" id="4732738"><a href="/gostd/math/big/int.go.html#2035985">Int</a></span><span class="op" id="4732741">)</span><span class="op" id="4732742">,</span>&nbsp;<span class="ident" id="4732744"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732400">pub</a></span><span class="op" id="4732747">,</span>&nbsp;<span class="ident" id="4732749"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732684">c</a></span><span class="op" id="4732750">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732753">em</span>&nbsp;<span class="op" id="4732756">:=</span>&nbsp;<span class="ident" id="4732759"><a href="/gostd/crypto/rsa/rsa.go.html#4758084">leftPad</a></span><span class="op" id="4732766">(</span><span class="ident" id="4732767"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732717">m</a></span><span class="op" id="4732768">.</span><span class="ident" id="4732769"><a href="/gostd/math/big/int.go.html#2050194">Bytes</a></span><span class="op" id="4732774">(</span><span class="op" id="4732775">)</span><span class="op" id="4732776">,</span>&nbsp;<span class="ident" id="4732778"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4732779">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4732782">//&nbsp;EM&nbsp;=&nbsp;0x00&nbsp;||&nbsp;0x01&nbsp;||&nbsp;PS&nbsp;||&nbsp;0x00&nbsp;||&nbsp;T</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732824">ok</span>&nbsp;<span class="op" id="4732827">:=</span>&nbsp;<span class="ident" id="4732830"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4732836">.</span><span class="ident" id="4732837"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4732855">(</span><span class="ident" id="4732856"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4732858">[</span><span class="num" id="4732859">0</span><span class="op" id="4732860">]</span><span class="op" id="4732861">,</span>&nbsp;<span class="num" id="4732863">0</span><span class="op" id="4732864">)</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732867"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4732870">&amp;=</span>&nbsp;<span class="ident" id="4732873"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4732879">.</span><span class="ident" id="4732880"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4732898">(</span><span class="ident" id="4732899"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4732901">[</span><span class="num" id="4732902">1</span><span class="op" id="4732903">]</span><span class="op" id="4732904">,</span>&nbsp;<span class="num" id="4732906">1</span><span class="op" id="4732907">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732910"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4732913">&amp;=</span>&nbsp;<span class="ident" id="4732916"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4732922">.</span><span class="ident" id="4732923"><a href="/gostd/crypto/subtle/constant_time.go.html#4428560">ConstantTimeCompare</a></span><span class="op" id="4732942">(</span><span class="ident" id="4732943"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4732945">[</span><span class="ident" id="4732946"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4732947">-</span><span class="ident" id="4732948"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732476">hashLen</a></span><span class="op" id="4732955">:</span><span class="ident" id="4732956"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4732957">]</span><span class="op" id="4732958">,</span>&nbsp;<span class="ident" id="4732960"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732434">hashed</a></span><span class="op" id="4732966">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4732969"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4732972">&amp;=</span>&nbsp;<span class="ident" id="4732975"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4732981">.</span><span class="ident" id="4732982"><a href="/gostd/crypto/subtle/constant_time.go.html#4428560">ConstantTimeCompare</a></span><span class="op" id="4733001">(</span><span class="ident" id="4733002"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4733004">[</span><span class="ident" id="4733005"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4733006">-</span><span class="ident" id="4733007"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732567">tLen</a></span><span class="op" id="4733011">:</span><span class="ident" id="4733012"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4733013">-</span><span class="ident" id="4733014"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732476">hashLen</a></span><span class="op" id="4733021">]</span><span class="op" id="4733022">,</span>&nbsp;<span class="ident" id="4733024"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732485">prefix</a></span><span class="op" id="4733030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733033"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4733036">&amp;=</span>&nbsp;<span class="ident" id="4733039"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4733045">.</span><span class="ident" id="4733046"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4733064">(</span><span class="ident" id="4733065"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4733067">[</span><span class="ident" id="4733068"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4733069">-</span><span class="ident" id="4733070"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732567">tLen</a></span><span class="op" id="4733074">-</span><span class="num" id="4733075">1</span><span class="op" id="4733076">]</span><span class="op" id="4733077">,</span>&nbsp;<span class="num" id="4733079">0</span><span class="op" id="4733080">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733084">for</span>&nbsp;<span class="ident" id="4733088">i</span>&nbsp;<span class="op" id="4733090">:=</span>&nbsp;<span class="num" id="4733093">2</span><span class="op" id="4733094">;</span>&nbsp;<span class="ident" id="4733096"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733088">i</a></span>&nbsp;<span class="op" id="4733098">&lt;</span>&nbsp;<span class="ident" id="4733100"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732598">k</a></span><span class="op" id="4733101">-</span><span class="ident" id="4733102"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732567">tLen</a></span><span class="op" id="4733106">-</span><span class="num" id="4733107">1</span><span class="op" id="4733108">;</span>&nbsp;<span class="ident" id="4733110"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733088">i</a></span><span class="op" id="4733111">++</span>&nbsp;<span class="op" id="4733114">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733118"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4733121">&amp;=</span>&nbsp;<span class="ident" id="4733124"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724521">subtle</a></span><span class="op" id="4733130">.</span><span class="ident" id="4733131"><a href="/gostd/crypto/subtle/constant_time.go.html#4428992">ConstantTimeByteEq</a></span><span class="op" id="4733149">(</span><span class="ident" id="4733150"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732753">em</a></span><span class="op" id="4733152">[</span><span class="ident" id="4733153"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733088">i</a></span><span class="op" id="4733154">]</span><span class="op" id="4733155">,</span>&nbsp;<span class="num" id="4733157">0xff</span><span class="op" id="4733161">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733164">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733168">if</span>&nbsp;<span class="ident" id="4733171"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4732824">ok</a></span>&nbsp;<span class="op" id="4733174">!=</span>&nbsp;<span class="num" id="4733177">1</span>&nbsp;<span class="op" id="4733179">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733183">return</span>&nbsp;<span class="ident" id="4733190"><a href="/gostd/crypto/rsa/rsa.go.html#4752139">ErrVerification</a></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733207">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733211">return</span>&nbsp;<span class="builtintype" id="4733218">nil</span><br>
<span class="lineno"></span><span class="op" id="4733222">}</span><br>
<span class="lineno">265</span><br>
<span class="lineno"></span><span class="keyword" id="4733225">func</span>&nbsp;<span class="ident" id="4733230">pkcs1v15HashInfo</span><span class="op" id="4733246">(</span><span class="ident" id="4733247">hash</span>&nbsp;<span class="ident" id="4733252"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724511">crypto</a></span><span class="op" id="4733258">.</span><span class="ident" id="4733259"><a href="/gostd/crypto/crypto.go.html#3010057">Hash</a></span><span class="op" id="4733263">,</span>&nbsp;<span class="ident" id="4733265">inLen</span>&nbsp;<span class="builtintype" id="4733271">int</span><span class="op" id="4733274">)</span>&nbsp;<span class="op" id="4733276">(</span><span class="ident" id="4733277">hashLen</span>&nbsp;<span class="builtintype" id="4733285">int</span><span class="op" id="4733288">,</span>&nbsp;<span class="ident" id="4733290">prefix</span>&nbsp;<span class="op" id="4733297">[</span><span class="op" id="4733298">]</span><span class="builtintype" id="4733299">byte</span><span class="op" id="4733303">,</span>&nbsp;<span class="ident" id="4733305">err</span>&nbsp;<span class="builtintype" id="4733309">error</span><span class="op" id="4733314">)</span>&nbsp;<span class="op" id="4733316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4733319">//&nbsp;Special&nbsp;case:&nbsp;crypto.Hash(0)&nbsp;is&nbsp;used&nbsp;to&nbsp;indicate&nbsp;that&nbsp;the&nbsp;data&nbsp;is</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="4733389">//&nbsp;signed&nbsp;directly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733410">if</span>&nbsp;<span class="ident" id="4733413"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733247">hash</a></span>&nbsp;<span class="op" id="4733418">==</span>&nbsp;<span class="num" id="4733421">0</span>&nbsp;<span class="op" id="4733423">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733427">return</span>&nbsp;<span class="ident" id="4733434"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733265">inLen</a></span><span class="op" id="4733439">,</span>&nbsp;<span class="builtintype" id="4733441">nil</span><span class="op" id="4733444">,</span>&nbsp;<span class="builtintype" id="4733446">nil</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733451">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733455"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733277">hashLen</a></span>&nbsp;<span class="op" id="4733463">=</span>&nbsp;<span class="ident" id="4733465"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733247">hash</a></span><span class="op" id="4733469">.</span><span class="ident" id="4733470"><a href="/gostd/crypto/crypto.go.html#3011393">Size</a></span><span class="op" id="4733474">(</span><span class="op" id="4733475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733478">if</span>&nbsp;<span class="ident" id="4733481"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733265">inLen</a></span>&nbsp;<span class="op" id="4733487">!=</span>&nbsp;<span class="ident" id="4733490"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733277">hashLen</a></span>&nbsp;<span class="op" id="4733498">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733502">return</span>&nbsp;<span class="num" id="4733509">0</span><span class="op" id="4733510">,</span>&nbsp;<span class="builtintype" id="4733512">nil</span><span class="op" id="4733515">,</span>&nbsp;<span class="ident" id="4733517"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724538">errors</a></span><span class="op" id="4733523">.</span><span class="ident" id="4733524"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4733527">(</span><span class="string" id="4733528">&#34;crypto/rsa:&nbsp;input&nbsp;must&nbsp;be&nbsp;hashed&nbsp;message&#34;</span><span class="op" id="4733570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733576"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733290">prefix</a></span><span class="op" id="4733582">,</span>&nbsp;<span class="ident" id="4733584">ok</span>&nbsp;<span class="op" id="4733587">:=</span>&nbsp;<span class="ident" id="4733590"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4730087">hashPrefixes</a></span><span class="op" id="4733602">[</span><span class="ident" id="4733603"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733247">hash</a></span><span class="op" id="4733607">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733610">if</span>&nbsp;<span class="op" id="4733613">!</span><span class="ident" id="4733614"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733584">ok</a></span>&nbsp;<span class="op" id="4733617">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733621">return</span>&nbsp;<span class="num" id="4733628">0</span><span class="op" id="4733629">,</span>&nbsp;<span class="builtintype" id="4733631">nil</span><span class="op" id="4733634">,</span>&nbsp;<span class="ident" id="4733636"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4724538">errors</a></span><span class="op" id="4733642">.</span><span class="ident" id="4733643"><a href="/gostd/errors/errors.go.html#1418493">New</a></span><span class="op" id="4733646">(</span><span class="string" id="4733647">&#34;crypto/rsa:&nbsp;unsupported&nbsp;hash&nbsp;function&#34;</span><span class="op" id="4733686">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733689">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733692">return</span><br>
<span class="lineno"></span><span class="op" id="4733699">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="4733702">//&nbsp;copyWithLeftPad&nbsp;copies&nbsp;src&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;dest,&nbsp;padding&nbsp;with&nbsp;zero&nbsp;bytes&nbsp;as</span><br>
<span class="lineno">285</span><span class="comment" id="4733779">//&nbsp;needed.</span><br>
<span class="lineno"></span><span class="keyword" id="4733790">func</span>&nbsp;<span class="ident" id="4733795">copyWithLeftPad</span><span class="op" id="4733810">(</span><span class="ident" id="4733811">dest</span><span class="op" id="4733815">,</span>&nbsp;<span class="ident" id="4733817">src</span>&nbsp;<span class="op" id="4733821">[</span><span class="op" id="4733822">]</span><span class="builtintype" id="4733823">byte</span><span class="op" id="4733827">)</span>&nbsp;<span class="op" id="4733829">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733832">numPaddingBytes</span>&nbsp;<span class="op" id="4733848">:=</span>&nbsp;<span class="builtinfunc" id="4733851">len</span><span class="op" id="4733854">(</span><span class="ident" id="4733855"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733811">dest</a></span><span class="op" id="4733859">)</span>&nbsp;<span class="op" id="4733861">-</span>&nbsp;<span class="builtinfunc" id="4733863">len</span><span class="op" id="4733866">(</span><span class="ident" id="4733867"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733817">src</a></span><span class="op" id="4733870">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="4733873">for</span>&nbsp;<span class="ident" id="4733877">i</span>&nbsp;<span class="op" id="4733879">:=</span>&nbsp;<span class="num" id="4733882">0</span><span class="op" id="4733883">;</span>&nbsp;<span class="ident" id="4733885"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733877">i</a></span>&nbsp;<span class="op" id="4733887">&lt;</span>&nbsp;<span class="ident" id="4733889"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733832">numPaddingBytes</a></span><span class="op" id="4733904">;</span>&nbsp;<span class="ident" id="4733906"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733877">i</a></span><span class="op" id="4733907">++</span>&nbsp;<span class="op" id="4733910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="4733914"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733811">dest</a></span><span class="op" id="4733918">[</span><span class="ident" id="4733919"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733877">i</a></span><span class="op" id="4733920">]</span>&nbsp;<span class="op" id="4733922">=</span>&nbsp;<span class="num" id="4733924">0</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="4733927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="4733930">copy</span><span class="op" id="4733934">(</span><span class="ident" id="4733935"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733811">dest</a></span><span class="op" id="4733939">[</span><span class="ident" id="4733940"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733832">numPaddingBytes</a></span><span class="op" id="4733955">:</span><span class="op" id="4733956">]</span><span class="op" id="4733957">,</span>&nbsp;<span class="ident" id="4733959"><a href="/gostd/crypto/rsa/pkcs1v15.go.html#4733817">src</a></span><span class="op" id="4733962">)</span><br>
<span class="lineno"></span><span class="op" id="4733964">}</span>
</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-19116218-3', 'auto');
  ga('send', 'pageview');
</script>
</body>
</html>
