<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>go/printer</h2>
<ul>
<li><a href="/gostd/go/printer/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/go/printer/nodes.go.html">nodes.go</a></li>
<li><a href="/gostd/go/printer/performance_test.go.html">performance_test.go</a></li>
<li><a href="/gostd/go/printer/printer.go.html">printer.go</a></li>
<li><a href="/gostd/go/printer/printer_test.go.html" class="current">printer_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="8454496">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="8454551">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="8454605">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="8454656">package</span>&nbsp;<span class="ident" id="8454664">printer</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454673">import</span>&nbsp;<span class="op" id="8454680">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454683">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454692">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454702">&#34;flag&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454710">&#34;fmt&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454717">&#34;go/ast&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454727">&#34;go/parser&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454740">&#34;go/token&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454752">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454765">&#34;path/filepath&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454782">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8454793">&#34;time&#34;</span><br>
<span class="lineno"></span><span class="op" id="8454800">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="8454803">const</span>&nbsp;<span class="op" id="8454809">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454812">dataDir</span>&nbsp;&nbsp;<span class="op" id="8454821">=</span>&nbsp;<span class="string" id="8454823">&#34;testdata&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454835">tabwidth</span>&nbsp;<span class="op" id="8454844">=</span>&nbsp;<span class="num" id="8454846">8</span><br>
<span class="lineno"></span><span class="op" id="8454848">)</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="8454851">var</span>&nbsp;<span class="ident" id="8454855">update</span>&nbsp;<span class="op" id="8454862">=</span>&nbsp;<span class="ident" id="8454864">flag</span><span class="op" id="8454868">.</span><span class="ident" id="8454869">Bool</span><span class="op" id="8454873">(</span><span class="string" id="8454874">&#34;update&#34;</span><span class="op" id="8454882">,</span>&nbsp;<span class="builtintype" id="8454884">false</span><span class="op" id="8454889">,</span>&nbsp;<span class="string" id="8454891">&#34;update&nbsp;golden&nbsp;files&#34;</span><span class="op" id="8454912">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454915">var</span>&nbsp;<span class="ident" id="8454919">fset</span>&nbsp;<span class="op" id="8454924">=</span>&nbsp;<span class="ident" id="8454926">token</span><span class="op" id="8454931">.</span><span class="ident" id="8454932">NewFileSet</span><span class="op" id="8454942">(</span><span class="op" id="8454943">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">30</span><span class="keyword" id="8454946">type</span>&nbsp;<span class="ident" id="8454951">checkMode</span>&nbsp;<span class="builtintype" id="8454961">uint</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8454967">const</span>&nbsp;<span class="op" id="8454973">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8454976">export</span>&nbsp;<span class="ident" id="8454983">checkMode</span>&nbsp;<span class="op" id="8454993">=</span>&nbsp;<span class="num" id="8454995">1</span>&nbsp;<span class="op" id="8454997">&lt;&lt;</span>&nbsp;<span class="ident" id="8455000">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455006">rawFormat</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455017">idempotent</span><br>
<span class="lineno"></span><span class="op" id="8455028">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8455031">//&nbsp;format&nbsp;parses&nbsp;src,&nbsp;prints&nbsp;the&nbsp;corresponding&nbsp;AST,&nbsp;verifies&nbsp;the&nbsp;resulting</span><br>
<span class="lineno"></span><span class="comment" id="8455106">//&nbsp;src&nbsp;is&nbsp;syntactically&nbsp;correct,&nbsp;and&nbsp;returns&nbsp;the&nbsp;resulting&nbsp;src&nbsp;or&nbsp;an&nbsp;error</span><br>
<span class="lineno">40</span><span class="comment" id="8455181">//&nbsp;if&nbsp;any.</span><br>
<span class="lineno"></span><span class="keyword" id="8455192">func</span>&nbsp;<span class="ident" id="8455197">format</span><span class="op" id="8455203">(</span><span class="ident" id="8455204">src</span>&nbsp;<span class="op" id="8455208">[</span><span class="op" id="8455209">]</span><span class="builtintype" id="8455210">byte</span><span class="op" id="8455214">,</span>&nbsp;<span class="ident" id="8455216">mode</span>&nbsp;<span class="ident" id="8455221">checkMode</span><span class="op" id="8455230">)</span>&nbsp;<span class="op" id="8455232">(</span><span class="op" id="8455233">[</span><span class="op" id="8455234">]</span><span class="builtintype" id="8455235">byte</span><span class="op" id="8455239">,</span>&nbsp;<span class="builtintype" id="8455241">error</span><span class="op" id="8455246">)</span>&nbsp;<span class="op" id="8455248">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455251">//&nbsp;parse&nbsp;src</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455265">f</span><span class="op" id="8455266">,</span>&nbsp;<span class="ident" id="8455268">err</span>&nbsp;<span class="op" id="8455272">:=</span>&nbsp;<span class="ident" id="8455275">parser</span><span class="op" id="8455281">.</span><span class="ident" id="8455282">ParseFile</span><span class="op" id="8455291">(</span><span class="ident" id="8455292">fset</span><span class="op" id="8455296">,</span>&nbsp;<span class="string" id="8455298">&#34;&#34;</span><span class="op" id="8455300">,</span>&nbsp;<span class="ident" id="8455302">src</span><span class="op" id="8455305">,</span>&nbsp;<span class="ident" id="8455307">parser</span><span class="op" id="8455313">.</span><span class="ident" id="8455314">ParseComments</span><span class="op" id="8455327">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455330">if</span>&nbsp;<span class="ident" id="8455333">err</span>&nbsp;<span class="op" id="8455337">!=</span>&nbsp;<span class="builtintype" id="8455340">nil</span>&nbsp;<span class="op" id="8455344">{</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455348">return</span>&nbsp;<span class="builtintype" id="8455355">nil</span><span class="op" id="8455358">,</span>&nbsp;<span class="ident" id="8455360">fmt</span><span class="op" id="8455363">.</span><span class="ident" id="8455364">Errorf</span><span class="op" id="8455370">(</span><span class="string" id="8455371">&#34;parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8455386">,</span>&nbsp;<span class="ident" id="8455388">err</span><span class="op" id="8455391">,</span>&nbsp;<span class="ident" id="8455393">src</span><span class="op" id="8455396">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455399">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455403">//&nbsp;filter&nbsp;exports&nbsp;if&nbsp;necessary</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455435">if</span>&nbsp;<span class="ident" id="8455438">mode</span><span class="op" id="8455442">&amp;</span><span class="ident" id="8455443">export</span>&nbsp;<span class="op" id="8455450">!=</span>&nbsp;<span class="num" id="8455453">0</span>&nbsp;<span class="op" id="8455455">{</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455459">ast</span><span class="op" id="8455462">.</span><span class="ident" id="8455463">FileExports</span><span class="op" id="8455474">(</span><span class="ident" id="8455475">f</span><span class="op" id="8455476">)</span>&nbsp;<span class="comment" id="8455478">//&nbsp;ignore&nbsp;result</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455497">f</span><span class="op" id="8455498">.</span><span class="ident" id="8455499">Comments</span>&nbsp;<span class="op" id="8455508">=</span>&nbsp;<span class="builtintype" id="8455510">nil</span>&nbsp;&nbsp;&nbsp;<span class="comment" id="8455516">//&nbsp;don&#39;t&nbsp;print&nbsp;comments&nbsp;that&nbsp;are&nbsp;not&nbsp;in&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455561">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455565">//&nbsp;determine&nbsp;printer&nbsp;configuration</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455601">cfg</span>&nbsp;<span class="op" id="8455605">:=</span>&nbsp;<span class="ident" id="8455608">Config</span><span class="op" id="8455614">{</span><span class="ident" id="8455615">Tabwidth</span><span class="op" id="8455623">:</span>&nbsp;<span class="ident" id="8455625">tabwidth</span><span class="op" id="8455633">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455636">if</span>&nbsp;<span class="ident" id="8455639">mode</span><span class="op" id="8455643">&amp;</span><span class="ident" id="8455644">rawFormat</span>&nbsp;<span class="op" id="8455654">!=</span>&nbsp;<span class="num" id="8455657">0</span>&nbsp;<span class="op" id="8455659">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455663">cfg</span><span class="op" id="8455666">.</span><span class="ident" id="8455667">Mode</span>&nbsp;<span class="op" id="8455672">|=</span>&nbsp;<span class="ident" id="8455675">RawFormat</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455686">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455690">//&nbsp;print&nbsp;AST</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455704">var</span>&nbsp;<span class="ident" id="8455708">buf</span>&nbsp;<span class="ident" id="8455712">bytes</span><span class="op" id="8455717">.</span><span class="ident" id="8455718">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455726">if</span>&nbsp;<span class="ident" id="8455729">err</span>&nbsp;<span class="op" id="8455733">:=</span>&nbsp;<span class="ident" id="8455736">cfg</span><span class="op" id="8455739">.</span><span class="ident" id="8455740">Fprint</span><span class="op" id="8455746">(</span><span class="op" id="8455747">&amp;</span><span class="ident" id="8455748">buf</span><span class="op" id="8455751">,</span>&nbsp;<span class="ident" id="8455753">fset</span><span class="op" id="8455757">,</span>&nbsp;<span class="ident" id="8455759">f</span><span class="op" id="8455760">)</span><span class="op" id="8455761">;</span>&nbsp;<span class="ident" id="8455763">err</span>&nbsp;<span class="op" id="8455767">!=</span>&nbsp;<span class="builtintype" id="8455770">nil</span>&nbsp;<span class="op" id="8455774">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455778">return</span>&nbsp;<span class="builtintype" id="8455785">nil</span><span class="op" id="8455788">,</span>&nbsp;<span class="ident" id="8455790">fmt</span><span class="op" id="8455793">.</span><span class="ident" id="8455794">Errorf</span><span class="op" id="8455800">(</span><span class="string" id="8455801">&#34;print:&nbsp;%s&#34;</span><span class="op" id="8455812">,</span>&nbsp;<span class="ident" id="8455814">err</span><span class="op" id="8455817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8455820">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8455824">//&nbsp;make&nbsp;sure&nbsp;formatted&nbsp;output&nbsp;is&nbsp;syntactically&nbsp;correct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8455880">res</span>&nbsp;<span class="op" id="8455884">:=</span>&nbsp;<span class="ident" id="8455887">buf</span><span class="op" id="8455890">.</span><span class="ident" id="8455891">Bytes</span><span class="op" id="8455896">(</span><span class="op" id="8455897">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455900">if</span>&nbsp;<span class="ident" id="8455903">_</span><span class="op" id="8455904">,</span>&nbsp;<span class="ident" id="8455906">err</span>&nbsp;<span class="op" id="8455910">:=</span>&nbsp;<span class="ident" id="8455913">parser</span><span class="op" id="8455919">.</span><span class="ident" id="8455920">ParseFile</span><span class="op" id="8455929">(</span><span class="ident" id="8455930">fset</span><span class="op" id="8455934">,</span>&nbsp;<span class="string" id="8455936">&#34;&#34;</span><span class="op" id="8455938">,</span>&nbsp;<span class="ident" id="8455940">res</span><span class="op" id="8455943">,</span>&nbsp;<span class="num" id="8455945">0</span><span class="op" id="8455946">)</span><span class="op" id="8455947">;</span>&nbsp;<span class="ident" id="8455949">err</span>&nbsp;<span class="op" id="8455953">!=</span>&nbsp;<span class="builtintype" id="8455956">nil</span>&nbsp;<span class="op" id="8455960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8455964">return</span>&nbsp;<span class="builtintype" id="8455971">nil</span><span class="op" id="8455974">,</span>&nbsp;<span class="ident" id="8455976">fmt</span><span class="op" id="8455979">.</span><span class="ident" id="8455980">Errorf</span><span class="op" id="8455986">(</span><span class="string" id="8455987">&#34;re-parse:&nbsp;%s\n%s&#34;</span><span class="op" id="8456005">,</span>&nbsp;<span class="ident" id="8456007">err</span><span class="op" id="8456010">,</span>&nbsp;<span class="ident" id="8456012">buf</span><span class="op" id="8456015">.</span><span class="ident" id="8456016">Bytes</span><span class="op" id="8456021">(</span><span class="op" id="8456022">)</span><span class="op" id="8456023">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456026">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456030">return</span>&nbsp;<span class="ident" id="8456037">res</span><span class="op" id="8456040">,</span>&nbsp;<span class="builtintype" id="8456042">nil</span><br>
<span class="lineno"></span><span class="op" id="8456046">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span><span class="comment" id="8456049">//&nbsp;lineAt&nbsp;returns&nbsp;the&nbsp;line&nbsp;in&nbsp;text&nbsp;starting&nbsp;at&nbsp;offset&nbsp;offs.</span><br>
<span class="lineno"></span><span class="keyword" id="8456109">func</span>&nbsp;<span class="ident" id="8456114">lineAt</span><span class="op" id="8456120">(</span><span class="ident" id="8456121">text</span>&nbsp;<span class="op" id="8456126">[</span><span class="op" id="8456127">]</span><span class="builtintype" id="8456128">byte</span><span class="op" id="8456132">,</span>&nbsp;<span class="ident" id="8456134">offs</span>&nbsp;<span class="builtintype" id="8456139">int</span><span class="op" id="8456142">)</span>&nbsp;<span class="op" id="8456144">[</span><span class="op" id="8456145">]</span><span class="builtintype" id="8456146">byte</span>&nbsp;<span class="op" id="8456151">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456154">i</span>&nbsp;<span class="op" id="8456156">:=</span>&nbsp;<span class="ident" id="8456159">offs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456165">for</span>&nbsp;<span class="ident" id="8456169">i</span>&nbsp;<span class="op" id="8456171">&lt;</span>&nbsp;<span class="builtinfunc" id="8456173">len</span><span class="op" id="8456176">(</span><span class="ident" id="8456177">text</span><span class="op" id="8456181">)</span>&nbsp;<span class="op" id="8456183">&amp;&amp;</span>&nbsp;<span class="ident" id="8456186">text</span><span class="op" id="8456190">[</span><span class="ident" id="8456191">i</span><span class="op" id="8456192">]</span>&nbsp;<span class="op" id="8456194">!=</span>&nbsp;<span class="string" id="8456197">&#39;\n&#39;</span>&nbsp;<span class="op" id="8456202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456206">i</span><span class="op" id="8456207">++</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456214">return</span>&nbsp;<span class="ident" id="8456221">text</span><span class="op" id="8456225">[</span><span class="ident" id="8456226">offs</span><span class="op" id="8456230">:</span><span class="ident" id="8456231">i</span><span class="op" id="8456232">]</span><br>
<span class="lineno"></span><span class="op" id="8456234">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8456237">//&nbsp;diff&nbsp;compares&nbsp;a&nbsp;and&nbsp;b.</span><br>
<span class="lineno">85</span><span class="keyword" id="8456263">func</span>&nbsp;<span class="ident" id="8456268">diff</span><span class="op" id="8456272">(</span><span class="ident" id="8456273">aname</span><span class="op" id="8456278">,</span>&nbsp;<span class="ident" id="8456280">bname</span>&nbsp;<span class="builtintype" id="8456286">string</span><span class="op" id="8456292">,</span>&nbsp;<span class="ident" id="8456294">a</span><span class="op" id="8456295">,</span>&nbsp;<span class="ident" id="8456297">b</span>&nbsp;<span class="op" id="8456299">[</span><span class="op" id="8456300">]</span><span class="builtintype" id="8456301">byte</span><span class="op" id="8456305">)</span>&nbsp;<span class="builtintype" id="8456307">error</span>&nbsp;<span class="op" id="8456313">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456316">var</span>&nbsp;<span class="ident" id="8456320">buf</span>&nbsp;<span class="ident" id="8456324">bytes</span><span class="op" id="8456329">.</span><span class="ident" id="8456330">Buffer</span>&nbsp;<span class="comment" id="8456337">//&nbsp;holding&nbsp;long&nbsp;error&nbsp;message</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8456369">//&nbsp;compare&nbsp;lengths</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456389">if</span>&nbsp;<span class="builtinfunc" id="8456392">len</span><span class="op" id="8456395">(</span><span class="ident" id="8456396">a</span><span class="op" id="8456397">)</span>&nbsp;<span class="op" id="8456399">!=</span>&nbsp;<span class="builtinfunc" id="8456402">len</span><span class="op" id="8456405">(</span><span class="ident" id="8456406">b</span><span class="op" id="8456407">)</span>&nbsp;<span class="op" id="8456409">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456413">fmt</span><span class="op" id="8456416">.</span><span class="ident" id="8456417">Fprintf</span><span class="op" id="8456424">(</span><span class="op" id="8456425">&amp;</span><span class="ident" id="8456426">buf</span><span class="op" id="8456429">,</span>&nbsp;<span class="string" id="8456431">&#34;\nlength&nbsp;changed:&nbsp;len(%s)&nbsp;=&nbsp;%d,&nbsp;len(%s)&nbsp;=&nbsp;%d&#34;</span><span class="op" id="8456477">,</span>&nbsp;<span class="ident" id="8456479">aname</span><span class="op" id="8456484">,</span>&nbsp;<span class="builtinfunc" id="8456486">len</span><span class="op" id="8456489">(</span><span class="ident" id="8456490">a</span><span class="op" id="8456491">)</span><span class="op" id="8456492">,</span>&nbsp;<span class="ident" id="8456494">bname</span><span class="op" id="8456499">,</span>&nbsp;<span class="builtinfunc" id="8456501">len</span><span class="op" id="8456504">(</span><span class="ident" id="8456505">b</span><span class="op" id="8456506">)</span><span class="op" id="8456507">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456510">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8456514">//&nbsp;compare&nbsp;contents</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456535">line</span>&nbsp;<span class="op" id="8456540">:=</span>&nbsp;<span class="num" id="8456543">1</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456546">offs</span>&nbsp;<span class="op" id="8456551">:=</span>&nbsp;<span class="num" id="8456554">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456557">for</span>&nbsp;<span class="ident" id="8456561">i</span>&nbsp;<span class="op" id="8456563">:=</span>&nbsp;<span class="num" id="8456566">0</span><span class="op" id="8456567">;</span>&nbsp;<span class="ident" id="8456569">i</span>&nbsp;<span class="op" id="8456571">&lt;</span>&nbsp;<span class="builtinfunc" id="8456573">len</span><span class="op" id="8456576">(</span><span class="ident" id="8456577">a</span><span class="op" id="8456578">)</span>&nbsp;<span class="op" id="8456580">&amp;&amp;</span>&nbsp;<span class="ident" id="8456583">i</span>&nbsp;<span class="op" id="8456585">&lt;</span>&nbsp;<span class="builtinfunc" id="8456587">len</span><span class="op" id="8456590">(</span><span class="ident" id="8456591">b</span><span class="op" id="8456592">)</span><span class="op" id="8456593">;</span>&nbsp;<span class="ident" id="8456595">i</span><span class="op" id="8456596">++</span>&nbsp;<span class="op" id="8456599">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456603">ch</span>&nbsp;<span class="op" id="8456606">:=</span>&nbsp;<span class="ident" id="8456609">a</span><span class="op" id="8456610">[</span><span class="ident" id="8456611">i</span><span class="op" id="8456612">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456616">if</span>&nbsp;<span class="ident" id="8456619">ch</span>&nbsp;<span class="op" id="8456622">!=</span>&nbsp;<span class="ident" id="8456625">b</span><span class="op" id="8456626">[</span><span class="ident" id="8456627">i</span><span class="op" id="8456628">]</span>&nbsp;<span class="op" id="8456630">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456635">fmt</span><span class="op" id="8456638">.</span><span class="ident" id="8456639">Fprintf</span><span class="op" id="8456646">(</span><span class="op" id="8456647">&amp;</span><span class="ident" id="8456648">buf</span><span class="op" id="8456651">,</span>&nbsp;<span class="string" id="8456653">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8456669">,</span>&nbsp;<span class="ident" id="8456671">aname</span><span class="op" id="8456676">,</span>&nbsp;<span class="ident" id="8456678">line</span><span class="op" id="8456682">,</span>&nbsp;<span class="ident" id="8456684">i</span><span class="op" id="8456685">-</span><span class="ident" id="8456686">offs</span><span class="op" id="8456690">+</span><span class="num" id="8456691">1</span><span class="op" id="8456692">,</span>&nbsp;<span class="ident" id="8456694">lineAt</span><span class="op" id="8456700">(</span><span class="ident" id="8456701">a</span><span class="op" id="8456702">,</span>&nbsp;<span class="ident" id="8456704">offs</span><span class="op" id="8456708">)</span><span class="op" id="8456709">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456714">fmt</span><span class="op" id="8456717">.</span><span class="ident" id="8456718">Fprintf</span><span class="op" id="8456725">(</span><span class="op" id="8456726">&amp;</span><span class="ident" id="8456727">buf</span><span class="op" id="8456730">,</span>&nbsp;<span class="string" id="8456732">&#34;\n%s:%d:%d:&nbsp;%s&#34;</span><span class="op" id="8456748">,</span>&nbsp;<span class="ident" id="8456750">bname</span><span class="op" id="8456755">,</span>&nbsp;<span class="ident" id="8456757">line</span><span class="op" id="8456761">,</span>&nbsp;<span class="ident" id="8456763">i</span><span class="op" id="8456764">-</span><span class="ident" id="8456765">offs</span><span class="op" id="8456769">+</span><span class="num" id="8456770">1</span><span class="op" id="8456771">,</span>&nbsp;<span class="ident" id="8456773">lineAt</span><span class="op" id="8456779">(</span><span class="ident" id="8456780">b</span><span class="op" id="8456781">,</span>&nbsp;<span class="ident" id="8456783">offs</span><span class="op" id="8456787">)</span><span class="op" id="8456788">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456793">fmt</span><span class="op" id="8456796">.</span><span class="ident" id="8456797">Fprintf</span><span class="op" id="8456804">(</span><span class="op" id="8456805">&amp;</span><span class="ident" id="8456806">buf</span><span class="op" id="8456809">,</span>&nbsp;<span class="string" id="8456811">&#34;\n\n&#34;</span><span class="op" id="8456817">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456822">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456830">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456834">if</span>&nbsp;<span class="ident" id="8456837">ch</span>&nbsp;<span class="op" id="8456840">==</span>&nbsp;<span class="string" id="8456843">&#39;\n&#39;</span>&nbsp;<span class="op" id="8456848">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456853">line</span><span class="op" id="8456857">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8456863">offs</span>&nbsp;<span class="op" id="8456868">=</span>&nbsp;<span class="ident" id="8456870">i</span>&nbsp;<span class="op" id="8456872">+</span>&nbsp;<span class="num" id="8456874">1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456878">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456885">if</span>&nbsp;<span class="ident" id="8456888">buf</span><span class="op" id="8456891">.</span><span class="ident" id="8456892">Len</span><span class="op" id="8456895">(</span><span class="op" id="8456896">)</span>&nbsp;<span class="op" id="8456898">&gt;</span>&nbsp;<span class="num" id="8456900">0</span>&nbsp;<span class="op" id="8456902">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456906">return</span>&nbsp;<span class="ident" id="8456913">errors</span><span class="op" id="8456919">.</span><span class="ident" id="8456920">New</span><span class="op" id="8456923">(</span><span class="ident" id="8456924">buf</span><span class="op" id="8456927">.</span><span class="ident" id="8456928">String</span><span class="op" id="8456934">(</span><span class="op" id="8456935">)</span><span class="op" id="8456936">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8456939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8456942">return</span>&nbsp;<span class="builtintype" id="8456949">nil</span><br>
<span class="lineno"></span><span class="op" id="8456953">}</span><br>
<span class="lineno">115</span><br>
<span class="lineno"></span><span class="keyword" id="8456956">func</span>&nbsp;<span class="ident" id="8456961">runcheck</span><span class="op" id="8456969">(</span><span class="ident" id="8456970">t</span>&nbsp;<span class="op" id="8456972">*</span><span class="ident" id="8456973">testing</span><span class="op" id="8456980">.</span><span class="ident" id="8456981">T</span><span class="op" id="8456982">,</span>&nbsp;<span class="ident" id="8456984">source</span><span class="op" id="8456990">,</span>&nbsp;<span class="ident" id="8456992">golden</span>&nbsp;<span class="builtintype" id="8456999">string</span><span class="op" id="8457005">,</span>&nbsp;<span class="ident" id="8457007">mode</span>&nbsp;<span class="ident" id="8457012">checkMode</span><span class="op" id="8457021">)</span>&nbsp;<span class="op" id="8457023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457026">src</span><span class="op" id="8457029">,</span>&nbsp;<span class="ident" id="8457031">err</span>&nbsp;<span class="op" id="8457035">:=</span>&nbsp;<span class="ident" id="8457038">ioutil</span><span class="op" id="8457044">.</span><span class="ident" id="8457045">ReadFile</span><span class="op" id="8457053">(</span><span class="ident" id="8457054">source</span><span class="op" id="8457060">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457063">if</span>&nbsp;<span class="ident" id="8457066">err</span>&nbsp;<span class="op" id="8457070">!=</span>&nbsp;<span class="builtintype" id="8457073">nil</span>&nbsp;<span class="op" id="8457077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457081">t</span><span class="op" id="8457082">.</span><span class="ident" id="8457083">Error</span><span class="op" id="8457088">(</span><span class="ident" id="8457089">err</span><span class="op" id="8457092">)</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457096">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457104">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457108">res</span><span class="op" id="8457111">,</span>&nbsp;<span class="ident" id="8457113">err</span>&nbsp;<span class="op" id="8457117">:=</span>&nbsp;<span class="ident" id="8457120">format</span><span class="op" id="8457126">(</span><span class="ident" id="8457127">src</span><span class="op" id="8457130">,</span>&nbsp;<span class="ident" id="8457132">mode</span><span class="op" id="8457136">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457139">if</span>&nbsp;<span class="ident" id="8457142">err</span>&nbsp;<span class="op" id="8457146">!=</span>&nbsp;<span class="builtintype" id="8457149">nil</span>&nbsp;<span class="op" id="8457153">{</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457157">t</span><span class="op" id="8457158">.</span><span class="ident" id="8457159">Error</span><span class="op" id="8457164">(</span><span class="ident" id="8457165">err</span><span class="op" id="8457168">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457172">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457180">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457184">//&nbsp;update&nbsp;golden&nbsp;files&nbsp;if&nbsp;necessary</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457221">if</span>&nbsp;<span class="op" id="8457224">*</span><span class="ident" id="8457225">update</span>&nbsp;<span class="op" id="8457232">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457236">if</span>&nbsp;<span class="ident" id="8457239">err</span>&nbsp;<span class="op" id="8457243">:=</span>&nbsp;<span class="ident" id="8457246">ioutil</span><span class="op" id="8457252">.</span><span class="ident" id="8457253">WriteFile</span><span class="op" id="8457262">(</span><span class="ident" id="8457263">golden</span><span class="op" id="8457269">,</span>&nbsp;<span class="ident" id="8457271">res</span><span class="op" id="8457274">,</span>&nbsp;<span class="num" id="8457276">0644</span><span class="op" id="8457280">)</span><span class="op" id="8457281">;</span>&nbsp;<span class="ident" id="8457283">err</span>&nbsp;<span class="op" id="8457287">!=</span>&nbsp;<span class="builtintype" id="8457290">nil</span>&nbsp;<span class="op" id="8457294">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457299">t</span><span class="op" id="8457300">.</span><span class="ident" id="8457301">Error</span><span class="op" id="8457306">(</span><span class="ident" id="8457307">err</span><span class="op" id="8457310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457314">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457318">return</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457330">//&nbsp;get&nbsp;golden</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457345">gld</span><span class="op" id="8457348">,</span>&nbsp;<span class="ident" id="8457350">err</span>&nbsp;<span class="op" id="8457354">:=</span>&nbsp;<span class="ident" id="8457357">ioutil</span><span class="op" id="8457363">.</span><span class="ident" id="8457364">ReadFile</span><span class="op" id="8457372">(</span><span class="ident" id="8457373">golden</span><span class="op" id="8457379">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457382">if</span>&nbsp;<span class="ident" id="8457385">err</span>&nbsp;<span class="op" id="8457389">!=</span>&nbsp;<span class="builtintype" id="8457392">nil</span>&nbsp;<span class="op" id="8457396">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457400">t</span><span class="op" id="8457401">.</span><span class="ident" id="8457402">Error</span><span class="op" id="8457407">(</span><span class="ident" id="8457408">err</span><span class="op" id="8457411">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457415">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457423">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457427">//&nbsp;formatted&nbsp;source&nbsp;and&nbsp;golden&nbsp;must&nbsp;be&nbsp;the&nbsp;same</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457476">if</span>&nbsp;<span class="ident" id="8457479">err</span>&nbsp;<span class="op" id="8457483">:=</span>&nbsp;<span class="ident" id="8457486">diff</span><span class="op" id="8457490">(</span><span class="ident" id="8457491">source</span><span class="op" id="8457497">,</span>&nbsp;<span class="ident" id="8457499">golden</span><span class="op" id="8457505">,</span>&nbsp;<span class="ident" id="8457507">res</span><span class="op" id="8457510">,</span>&nbsp;<span class="ident" id="8457512">gld</span><span class="op" id="8457515">)</span><span class="op" id="8457516">;</span>&nbsp;<span class="ident" id="8457518">err</span>&nbsp;<span class="op" id="8457522">!=</span>&nbsp;<span class="builtintype" id="8457525">nil</span>&nbsp;<span class="op" id="8457529">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457533">t</span><span class="op" id="8457534">.</span><span class="ident" id="8457535">Error</span><span class="op" id="8457540">(</span><span class="ident" id="8457541">err</span><span class="op" id="8457544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457548">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457560">if</span>&nbsp;<span class="ident" id="8457563">mode</span><span class="op" id="8457567">&amp;</span><span class="ident" id="8457568">idempotent</span>&nbsp;<span class="op" id="8457579">!=</span>&nbsp;<span class="num" id="8457582">0</span>&nbsp;<span class="op" id="8457584">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457588">//&nbsp;formatting&nbsp;golden&nbsp;must&nbsp;be&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457630">//&nbsp;(This&nbsp;is&nbsp;very&nbsp;difficult&nbsp;to&nbsp;achieve&nbsp;in&nbsp;general&nbsp;and&nbsp;for&nbsp;now</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457693">//&nbsp;it&nbsp;is&nbsp;only&nbsp;checked&nbsp;for&nbsp;files&nbsp;explicitly&nbsp;marked&nbsp;as&nbsp;such.)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457755">res</span><span class="op" id="8457758">,</span>&nbsp;<span class="ident" id="8457760">err</span>&nbsp;<span class="op" id="8457764">=</span>&nbsp;<span class="ident" id="8457766">format</span><span class="op" id="8457772">(</span><span class="ident" id="8457773">gld</span><span class="op" id="8457776">,</span>&nbsp;<span class="ident" id="8457778">mode</span><span class="op" id="8457782">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8457786">if</span>&nbsp;<span class="ident" id="8457789">err</span>&nbsp;<span class="op" id="8457793">:=</span>&nbsp;<span class="ident" id="8457796">diff</span><span class="op" id="8457800">(</span><span class="ident" id="8457801">golden</span><span class="op" id="8457807">,</span>&nbsp;<span class="ident" id="8457809">fmt</span><span class="op" id="8457812">.</span><span class="ident" id="8457813">Sprintf</span><span class="op" id="8457820">(</span><span class="string" id="8457821">&#34;format(%s)&#34;</span><span class="op" id="8457833">,</span>&nbsp;<span class="ident" id="8457835">golden</span><span class="op" id="8457841">)</span><span class="op" id="8457842">,</span>&nbsp;<span class="ident" id="8457844">gld</span><span class="op" id="8457847">,</span>&nbsp;<span class="ident" id="8457849">res</span><span class="op" id="8457852">)</span><span class="op" id="8457853">;</span>&nbsp;<span class="ident" id="8457855">err</span>&nbsp;<span class="op" id="8457859">!=</span>&nbsp;<span class="builtintype" id="8457862">nil</span>&nbsp;<span class="op" id="8457866">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8457871">t</span><span class="op" id="8457872">.</span><span class="ident" id="8457873">Errorf</span><span class="op" id="8457879">(</span><span class="string" id="8457880">&#34;golden&nbsp;is&nbsp;not&nbsp;idempotent:&nbsp;%s&#34;</span><span class="op" id="8457910">,</span>&nbsp;<span class="ident" id="8457912">err</span><span class="op" id="8457915">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457919">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8457922">}</span><br>
<span class="lineno"></span><span class="op" id="8457924">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="keyword" id="8457927">func</span>&nbsp;<span class="ident" id="8457932">check</span><span class="op" id="8457937">(</span><span class="ident" id="8457938">t</span>&nbsp;<span class="op" id="8457940">*</span><span class="ident" id="8457941">testing</span><span class="op" id="8457948">.</span><span class="ident" id="8457949">T</span><span class="op" id="8457950">,</span>&nbsp;<span class="ident" id="8457952">source</span><span class="op" id="8457958">,</span>&nbsp;<span class="ident" id="8457960">golden</span>&nbsp;<span class="builtintype" id="8457967">string</span><span class="op" id="8457973">,</span>&nbsp;<span class="ident" id="8457975">mode</span>&nbsp;<span class="ident" id="8457980">checkMode</span><span class="op" id="8457989">)</span>&nbsp;<span class="op" id="8457991">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8457994">//&nbsp;run&nbsp;the&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458011">cc</span>&nbsp;<span class="op" id="8458014">:=</span>&nbsp;<span class="builtinfunc" id="8458017">make</span><span class="op" id="8458021">(</span><span class="keyword" id="8458022">chan</span>&nbsp;<span class="builtintype" id="8458027">int</span><span class="op" id="8458030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458033">go</span>&nbsp;<span class="keyword" id="8458036">func</span><span class="op" id="8458040">(</span><span class="op" id="8458041">)</span>&nbsp;<span class="op" id="8458043">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458047">runcheck</span><span class="op" id="8458055">(</span><span class="ident" id="8458056">t</span><span class="op" id="8458057">,</span>&nbsp;<span class="ident" id="8458059">source</span><span class="op" id="8458065">,</span>&nbsp;<span class="ident" id="8458067">golden</span><span class="op" id="8458073">,</span>&nbsp;<span class="ident" id="8458075">mode</span><span class="op" id="8458079">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458083">cc</span>&nbsp;<span class="op" id="8458086">&lt;-</span>&nbsp;<span class="num" id="8458089">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458092">}</span><span class="op" id="8458093">(</span><span class="op" id="8458094">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8458098">//&nbsp;wait&nbsp;with&nbsp;timeout</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458120">select</span>&nbsp;<span class="op" id="8458127">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458130">case</span>&nbsp;<span class="op" id="8458135">&lt;-</span><span class="ident" id="8458137">time</span><span class="op" id="8458141">.</span><span class="ident" id="8458142">After</span><span class="op" id="8458147">(</span><span class="num" id="8458148">10</span>&nbsp;<span class="op" id="8458151">*</span>&nbsp;<span class="ident" id="8458153">time</span><span class="op" id="8458157">.</span><span class="ident" id="8458158">Second</span><span class="op" id="8458164">)</span><span class="op" id="8458165">:</span>&nbsp;<span class="comment" id="8458167">//&nbsp;plenty&nbsp;of&nbsp;a&nbsp;safety&nbsp;margin,&nbsp;even&nbsp;for&nbsp;very&nbsp;slow&nbsp;machines</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8458227">//&nbsp;test&nbsp;running&nbsp;past&nbsp;time&nbsp;out</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458259">t</span><span class="op" id="8458260">.</span><span class="ident" id="8458261">Errorf</span><span class="op" id="8458267">(</span><span class="string" id="8458268">&#34;%s:&nbsp;running&nbsp;too&nbsp;slowly&#34;</span><span class="op" id="8458292">,</span>&nbsp;<span class="ident" id="8458294">source</span><span class="op" id="8458300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8458303">case</span>&nbsp;<span class="op" id="8458308">&lt;-</span><span class="ident" id="8458310">cc</span><span class="op" id="8458312">:</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8458316">//&nbsp;test&nbsp;finished&nbsp;within&nbsp;allotted&nbsp;time&nbsp;margin</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458362">}</span><br>
<span class="lineno"></span><span class="op" id="8458364">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8458367">type</span>&nbsp;<span class="ident" id="8458372">entry</span>&nbsp;<span class="keyword" id="8458378">struct</span>&nbsp;<span class="op" id="8458385">{</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458388">source</span><span class="op" id="8458394">,</span>&nbsp;<span class="ident" id="8458396">golden</span>&nbsp;<span class="builtintype" id="8458403">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458411">mode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8458426">checkMode</span><br>
<span class="lineno"></span><span class="op" id="8458436">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8458439">//&nbsp;Use&nbsp;go&nbsp;test&nbsp;-update&nbsp;to&nbsp;create/update&nbsp;the&nbsp;respective&nbsp;golden&nbsp;files.</span><br>
<span class="lineno">185</span><span class="keyword" id="8458508">var</span>&nbsp;<span class="ident" id="8458512">data</span>&nbsp;<span class="op" id="8458517">=</span>&nbsp;<span class="op" id="8458519">[</span><span class="op" id="8458520">]</span><span class="ident" id="8458521">entry</span><span class="op" id="8458526">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458529">{</span><span class="string" id="8458530">&#34;empty.input&#34;</span><span class="op" id="8458543">,</span>&nbsp;<span class="string" id="8458545">&#34;empty.golden&#34;</span><span class="op" id="8458559">,</span>&nbsp;<span class="ident" id="8458561">idempotent</span><span class="op" id="8458571">}</span><span class="op" id="8458572">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458575">{</span><span class="string" id="8458576">&#34;comments.input&#34;</span><span class="op" id="8458592">,</span>&nbsp;<span class="string" id="8458594">&#34;comments.golden&#34;</span><span class="op" id="8458611">,</span>&nbsp;<span class="num" id="8458613">0</span><span class="op" id="8458614">}</span><span class="op" id="8458615">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458618">{</span><span class="string" id="8458619">&#34;comments.input&#34;</span><span class="op" id="8458635">,</span>&nbsp;<span class="string" id="8458637">&#34;comments.x&#34;</span><span class="op" id="8458649">,</span>&nbsp;<span class="ident" id="8458651">export</span><span class="op" id="8458657">}</span><span class="op" id="8458658">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458661">{</span><span class="string" id="8458662">&#34;comments2.input&#34;</span><span class="op" id="8458679">,</span>&nbsp;<span class="string" id="8458681">&#34;comments2.golden&#34;</span><span class="op" id="8458699">,</span>&nbsp;<span class="ident" id="8458701">idempotent</span><span class="op" id="8458711">}</span><span class="op" id="8458712">,</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458715">{</span><span class="string" id="8458716">&#34;linebreaks.input&#34;</span><span class="op" id="8458734">,</span>&nbsp;<span class="string" id="8458736">&#34;linebreaks.golden&#34;</span><span class="op" id="8458755">,</span>&nbsp;<span class="ident" id="8458757">idempotent</span><span class="op" id="8458767">}</span><span class="op" id="8458768">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458771">{</span><span class="string" id="8458772">&#34;expressions.input&#34;</span><span class="op" id="8458791">,</span>&nbsp;<span class="string" id="8458793">&#34;expressions.golden&#34;</span><span class="op" id="8458813">,</span>&nbsp;<span class="ident" id="8458815">idempotent</span><span class="op" id="8458825">}</span><span class="op" id="8458826">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458829">{</span><span class="string" id="8458830">&#34;expressions.input&#34;</span><span class="op" id="8458849">,</span>&nbsp;<span class="string" id="8458851">&#34;expressions.raw&#34;</span><span class="op" id="8458868">,</span>&nbsp;<span class="ident" id="8458870">rawFormat</span>&nbsp;<span class="op" id="8458880">|</span>&nbsp;<span class="ident" id="8458882">idempotent</span><span class="op" id="8458892">}</span><span class="op" id="8458893">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458896">{</span><span class="string" id="8458897">&#34;declarations.input&#34;</span><span class="op" id="8458917">,</span>&nbsp;<span class="string" id="8458919">&#34;declarations.golden&#34;</span><span class="op" id="8458940">,</span>&nbsp;<span class="num" id="8458942">0</span><span class="op" id="8458943">}</span><span class="op" id="8458944">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458947">{</span><span class="string" id="8458948">&#34;statements.input&#34;</span><span class="op" id="8458966">,</span>&nbsp;<span class="string" id="8458968">&#34;statements.golden&#34;</span><span class="op" id="8458987">,</span>&nbsp;<span class="num" id="8458989">0</span><span class="op" id="8458990">}</span><span class="op" id="8458991">,</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8458994">{</span><span class="string" id="8458995">&#34;slow.input&#34;</span><span class="op" id="8459007">,</span>&nbsp;<span class="string" id="8459009">&#34;slow.golden&#34;</span><span class="op" id="8459022">,</span>&nbsp;<span class="ident" id="8459024">idempotent</span><span class="op" id="8459034">}</span><span class="op" id="8459035">,</span><br>
<span class="lineno"></span><span class="op" id="8459037">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8459040">func</span>&nbsp;<span class="ident" id="8459045">TestFiles</span><span class="op" id="8459054">(</span><span class="ident" id="8459055">t</span>&nbsp;<span class="op" id="8459057">*</span><span class="ident" id="8459058">testing</span><span class="op" id="8459065">.</span><span class="ident" id="8459066">T</span><span class="op" id="8459067">)</span>&nbsp;<span class="op" id="8459069">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459072">for</span>&nbsp;<span class="ident" id="8459076">_</span><span class="op" id="8459077">,</span>&nbsp;<span class="ident" id="8459079">e</span>&nbsp;<span class="op" id="8459081">:=</span>&nbsp;<span class="keyword" id="8459084">range</span>&nbsp;<span class="ident" id="8459090">data</span>&nbsp;<span class="op" id="8459095">{</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459099">source</span>&nbsp;<span class="op" id="8459106">:=</span>&nbsp;<span class="ident" id="8459109">filepath</span><span class="op" id="8459117">.</span><span class="ident" id="8459118">Join</span><span class="op" id="8459122">(</span><span class="ident" id="8459123">dataDir</span><span class="op" id="8459130">,</span>&nbsp;<span class="ident" id="8459132">e</span><span class="op" id="8459133">.</span><span class="ident" id="8459134">source</span><span class="op" id="8459140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459144">golden</span>&nbsp;<span class="op" id="8459151">:=</span>&nbsp;<span class="ident" id="8459154">filepath</span><span class="op" id="8459162">.</span><span class="ident" id="8459163">Join</span><span class="op" id="8459167">(</span><span class="ident" id="8459168">dataDir</span><span class="op" id="8459175">,</span>&nbsp;<span class="ident" id="8459177">e</span><span class="op" id="8459178">.</span><span class="ident" id="8459179">golden</span><span class="op" id="8459185">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459189">check</span><span class="op" id="8459194">(</span><span class="ident" id="8459195">t</span><span class="op" id="8459196">,</span>&nbsp;<span class="ident" id="8459198">source</span><span class="op" id="8459204">,</span>&nbsp;<span class="ident" id="8459206">golden</span><span class="op" id="8459212">,</span>&nbsp;<span class="ident" id="8459214">e</span><span class="op" id="8459215">.</span><span class="ident" id="8459216">mode</span><span class="op" id="8459220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8459224">//&nbsp;TODO(gri)&nbsp;check&nbsp;that&nbsp;golden&nbsp;is&nbsp;idempotent</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8459271">//check(t,&nbsp;golden,&nbsp;golden,&nbsp;e.mode)</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459307">}</span><br>
<span class="lineno"></span><span class="op" id="8459309">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8459312">//&nbsp;TestLineComments,&nbsp;using&nbsp;a&nbsp;simple&nbsp;test&nbsp;case,&nbsp;checks&nbsp;that&nbsp;consecutive&nbsp;line</span><br>
<span class="lineno"></span><span class="comment" id="8459388">//&nbsp;comments&nbsp;are&nbsp;properly&nbsp;terminated&nbsp;with&nbsp;a&nbsp;newline&nbsp;even&nbsp;if&nbsp;the&nbsp;AST&nbsp;position</span><br>
<span class="lineno">210</span><span class="comment" id="8459464">//&nbsp;information&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="comment" id="8459493">//</span><br>
<span class="lineno"></span><span class="keyword" id="8459496">func</span>&nbsp;<span class="ident" id="8459501">TestLineComments</span><span class="op" id="8459517">(</span><span class="ident" id="8459518">t</span>&nbsp;<span class="op" id="8459520">*</span><span class="ident" id="8459521">testing</span><span class="op" id="8459528">.</span><span class="ident" id="8459529">T</span><span class="op" id="8459530">)</span>&nbsp;<span class="op" id="8459532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459535">const</span>&nbsp;<span class="ident" id="8459541">src</span>&nbsp;<span class="op" id="8459545">=</span>&nbsp;<span class="string" id="8459547">`//&nbsp;comment&nbsp;1<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;2<br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;comment&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;package&nbsp;main<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459608">fset</span>&nbsp;<span class="op" id="8459613">:=</span>&nbsp;<span class="ident" id="8459616">token</span><span class="op" id="8459621">.</span><span class="ident" id="8459622">NewFileSet</span><span class="op" id="8459632">(</span><span class="op" id="8459633">)</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459636">f</span><span class="op" id="8459637">,</span>&nbsp;<span class="ident" id="8459639">err</span>&nbsp;<span class="op" id="8459643">:=</span>&nbsp;<span class="ident" id="8459646">parser</span><span class="op" id="8459652">.</span><span class="ident" id="8459653">ParseFile</span><span class="op" id="8459662">(</span><span class="ident" id="8459663">fset</span><span class="op" id="8459667">,</span>&nbsp;<span class="string" id="8459669">&#34;&#34;</span><span class="op" id="8459671">,</span>&nbsp;<span class="ident" id="8459673">src</span><span class="op" id="8459676">,</span>&nbsp;<span class="ident" id="8459678">parser</span><span class="op" id="8459684">.</span><span class="ident" id="8459685">ParseComments</span><span class="op" id="8459698">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459701">if</span>&nbsp;<span class="ident" id="8459704">err</span>&nbsp;<span class="op" id="8459708">!=</span>&nbsp;<span class="builtintype" id="8459711">nil</span>&nbsp;<span class="op" id="8459715">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8459719">panic</span><span class="op" id="8459724">(</span><span class="ident" id="8459725">err</span><span class="op" id="8459728">)</span>&nbsp;<span class="comment" id="8459730">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459748">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459752">var</span>&nbsp;<span class="ident" id="8459756">buf</span>&nbsp;<span class="ident" id="8459760">bytes</span><span class="op" id="8459765">.</span><span class="ident" id="8459766">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459774">fset</span>&nbsp;<span class="op" id="8459779">=</span>&nbsp;<span class="ident" id="8459781">token</span><span class="op" id="8459786">.</span><span class="ident" id="8459787">NewFileSet</span><span class="op" id="8459797">(</span><span class="op" id="8459798">)</span>&nbsp;<span class="comment" id="8459800">//&nbsp;use&nbsp;the&nbsp;wrong&nbsp;file&nbsp;set</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459827">Fprint</span><span class="op" id="8459833">(</span><span class="op" id="8459834">&amp;</span><span class="ident" id="8459835">buf</span><span class="op" id="8459838">,</span>&nbsp;<span class="ident" id="8459840">fset</span><span class="op" id="8459844">,</span>&nbsp;<span class="ident" id="8459846">f</span><span class="op" id="8459847">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459851">nlines</span>&nbsp;<span class="op" id="8459858">:=</span>&nbsp;<span class="num" id="8459861">0</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459864">for</span>&nbsp;<span class="ident" id="8459868">_</span><span class="op" id="8459869">,</span>&nbsp;<span class="ident" id="8459871">ch</span>&nbsp;<span class="op" id="8459874">:=</span>&nbsp;<span class="keyword" id="8459877">range</span>&nbsp;<span class="ident" id="8459883">buf</span><span class="op" id="8459886">.</span><span class="ident" id="8459887">Bytes</span><span class="op" id="8459892">(</span><span class="op" id="8459893">)</span>&nbsp;<span class="op" id="8459895">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459899">if</span>&nbsp;<span class="ident" id="8459902">ch</span>&nbsp;<span class="op" id="8459905">==</span>&nbsp;<span class="string" id="8459908">&#39;\n&#39;</span>&nbsp;<span class="op" id="8459913">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459918">nlines</span><span class="op" id="8459924">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459929">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8459932">}</span><br>
<span class="lineno">235</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459936">const</span>&nbsp;<span class="ident" id="8459942">expected</span>&nbsp;<span class="op" id="8459951">=</span>&nbsp;<span class="num" id="8459953">3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8459956">if</span>&nbsp;<span class="ident" id="8459959">nlines</span>&nbsp;<span class="op" id="8459966">&lt;</span>&nbsp;<span class="ident" id="8459968">expected</span>&nbsp;<span class="op" id="8459977">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8459981">t</span><span class="op" id="8459982">.</span><span class="ident" id="8459983">Errorf</span><span class="op" id="8459989">(</span><span class="string" id="8459990">&#34;got&nbsp;%d,&nbsp;expected&nbsp;%d\n&#34;</span><span class="op" id="8460013">,</span>&nbsp;<span class="ident" id="8460015">nlines</span><span class="op" id="8460021">,</span>&nbsp;<span class="ident" id="8460023">expected</span><span class="op" id="8460031">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460035">t</span><span class="op" id="8460036">.</span><span class="ident" id="8460037">Errorf</span><span class="op" id="8460043">(</span><span class="string" id="8460044">&#34;result:\n%s&#34;</span><span class="op" id="8460057">,</span>&nbsp;<span class="ident" id="8460059">buf</span><span class="op" id="8460062">.</span><span class="ident" id="8460063">Bytes</span><span class="op" id="8460068">(</span><span class="op" id="8460069">)</span><span class="op" id="8460070">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460073">}</span><br>
<span class="lineno"></span><span class="op" id="8460075">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8460078">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;can&nbsp;be&nbsp;invoked&nbsp;during&nbsp;initialization.</span><br>
<span class="lineno"></span><span class="keyword" id="8460143">func</span>&nbsp;<span class="ident" id="8460148">init</span><span class="op" id="8460152">(</span><span class="op" id="8460153">)</span>&nbsp;<span class="op" id="8460155">{</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460158">const</span>&nbsp;<span class="ident" id="8460164">name</span>&nbsp;<span class="op" id="8460169">=</span>&nbsp;<span class="string" id="8460171">&#34;foobar&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460181">var</span>&nbsp;<span class="ident" id="8460185">buf</span>&nbsp;<span class="ident" id="8460189">bytes</span><span class="op" id="8460194">.</span><span class="ident" id="8460195">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460203">if</span>&nbsp;<span class="ident" id="8460206">err</span>&nbsp;<span class="op" id="8460210">:=</span>&nbsp;<span class="ident" id="8460213">Fprint</span><span class="op" id="8460219">(</span><span class="op" id="8460220">&amp;</span><span class="ident" id="8460221">buf</span><span class="op" id="8460224">,</span>&nbsp;<span class="ident" id="8460226">fset</span><span class="op" id="8460230">,</span>&nbsp;<span class="op" id="8460232">&amp;</span><span class="ident" id="8460233">ast</span><span class="op" id="8460236">.</span><span class="ident" id="8460237">Ident</span><span class="op" id="8460242">{</span><span class="ident" id="8460243">Name</span><span class="op" id="8460247">:</span>&nbsp;<span class="ident" id="8460249">name</span><span class="op" id="8460253">}</span><span class="op" id="8460254">)</span><span class="op" id="8460255">;</span>&nbsp;<span class="ident" id="8460257">err</span>&nbsp;<span class="op" id="8460261">!=</span>&nbsp;<span class="builtintype" id="8460264">nil</span>&nbsp;<span class="op" id="8460268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8460272">panic</span><span class="op" id="8460277">(</span><span class="ident" id="8460278">err</span><span class="op" id="8460281">)</span>&nbsp;<span class="comment" id="8460283">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460301">}</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8460304">//&nbsp;in&nbsp;debug&nbsp;mode,&nbsp;the&nbsp;result&nbsp;contains&nbsp;additional&nbsp;information;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8460367">//&nbsp;ignore&nbsp;it</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460381">if</span>&nbsp;<span class="ident" id="8460384">s</span>&nbsp;<span class="op" id="8460386">:=</span>&nbsp;<span class="ident" id="8460389">buf</span><span class="op" id="8460392">.</span><span class="ident" id="8460393">String</span><span class="op" id="8460399">(</span><span class="op" id="8460400">)</span><span class="op" id="8460401">;</span>&nbsp;<span class="op" id="8460403">!</span><span class="ident" id="8460404">debug</span>&nbsp;<span class="op" id="8460410">&amp;&amp;</span>&nbsp;<span class="ident" id="8460413">s</span>&nbsp;<span class="op" id="8460415">!=</span>&nbsp;<span class="ident" id="8460418">name</span>&nbsp;<span class="op" id="8460423">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8460427">panic</span><span class="op" id="8460432">(</span><span class="string" id="8460433">&#34;got&nbsp;&#34;</span>&nbsp;<span class="op" id="8460440">+</span>&nbsp;<span class="ident" id="8460442">s</span>&nbsp;<span class="op" id="8460444">+</span>&nbsp;<span class="string" id="8460446">&#34;,&nbsp;want&nbsp;&#34;</span>&nbsp;<span class="op" id="8460456">+</span>&nbsp;<span class="ident" id="8460458">name</span><span class="op" id="8460462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460465">}</span><br>
<span class="lineno">255</span><span class="op" id="8460467">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8460470">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;doesn&#39;t&nbsp;crash&nbsp;if&nbsp;the&nbsp;AST&nbsp;contains&nbsp;BadXXX&nbsp;nodes.</span><br>
<span class="lineno"></span><span class="keyword" id="8460545">func</span>&nbsp;<span class="ident" id="8460550">TestBadNodes</span><span class="op" id="8460562">(</span><span class="ident" id="8460563">t</span>&nbsp;<span class="op" id="8460565">*</span><span class="ident" id="8460566">testing</span><span class="op" id="8460573">.</span><span class="ident" id="8460574">T</span><span class="op" id="8460575">)</span>&nbsp;<span class="op" id="8460577">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460580">const</span>&nbsp;<span class="ident" id="8460586">src</span>&nbsp;<span class="op" id="8460590">=</span>&nbsp;<span class="string" id="8460592">&#34;package&nbsp;p\n(&#34;</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460608">const</span>&nbsp;<span class="ident" id="8460614">res</span>&nbsp;<span class="op" id="8460618">=</span>&nbsp;<span class="string" id="8460620">&#34;package&nbsp;p\nBadDecl\n&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460644">f</span><span class="op" id="8460645">,</span>&nbsp;<span class="ident" id="8460647">err</span>&nbsp;<span class="op" id="8460651">:=</span>&nbsp;<span class="ident" id="8460654">parser</span><span class="op" id="8460660">.</span><span class="ident" id="8460661">ParseFile</span><span class="op" id="8460670">(</span><span class="ident" id="8460671">fset</span><span class="op" id="8460675">,</span>&nbsp;<span class="string" id="8460677">&#34;&#34;</span><span class="op" id="8460679">,</span>&nbsp;<span class="ident" id="8460681">src</span><span class="op" id="8460684">,</span>&nbsp;<span class="ident" id="8460686">parser</span><span class="op" id="8460692">.</span><span class="ident" id="8460693">ParseComments</span><span class="op" id="8460706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460709">if</span>&nbsp;<span class="ident" id="8460712">err</span>&nbsp;<span class="op" id="8460716">==</span>&nbsp;<span class="builtintype" id="8460719">nil</span>&nbsp;<span class="op" id="8460723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460727">t</span><span class="op" id="8460728">.</span><span class="ident" id="8460729">Error</span><span class="op" id="8460734">(</span><span class="string" id="8460735">&#34;expected&nbsp;illegal&nbsp;program&#34;</span><span class="op" id="8460761">)</span>&nbsp;<span class="comment" id="8460763">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460781">}</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460784">var</span>&nbsp;<span class="ident" id="8460788">buf</span>&nbsp;<span class="ident" id="8460792">bytes</span><span class="op" id="8460797">.</span><span class="ident" id="8460798">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460806">Fprint</span><span class="op" id="8460812">(</span><span class="op" id="8460813">&amp;</span><span class="ident" id="8460814">buf</span><span class="op" id="8460817">,</span>&nbsp;<span class="ident" id="8460819">fset</span><span class="op" id="8460823">,</span>&nbsp;<span class="ident" id="8460825">f</span><span class="op" id="8460826">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8460829">if</span>&nbsp;<span class="ident" id="8460832">buf</span><span class="op" id="8460835">.</span><span class="ident" id="8460836">String</span><span class="op" id="8460842">(</span><span class="op" id="8460843">)</span>&nbsp;<span class="op" id="8460845">!=</span>&nbsp;<span class="ident" id="8460848">res</span>&nbsp;<span class="op" id="8460852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8460856">t</span><span class="op" id="8460857">.</span><span class="ident" id="8460858">Errorf</span><span class="op" id="8460864">(</span><span class="string" id="8460865">&#34;got&nbsp;%q,&nbsp;expected&nbsp;%q&#34;</span><span class="op" id="8460886">,</span>&nbsp;<span class="ident" id="8460888">buf</span><span class="op" id="8460891">.</span><span class="ident" id="8460892">String</span><span class="op" id="8460898">(</span><span class="op" id="8460899">)</span><span class="op" id="8460900">,</span>&nbsp;<span class="ident" id="8460902">res</span><span class="op" id="8460905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8460908">}</span><br>
<span class="lineno">270</span><span class="op" id="8460910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8460913">//&nbsp;testComment&nbsp;verifies&nbsp;that&nbsp;f&nbsp;can&nbsp;be&nbsp;parsed&nbsp;again&nbsp;after&nbsp;printing&nbsp;it</span><br>
<span class="lineno"></span><span class="comment" id="8460982">//&nbsp;with&nbsp;its&nbsp;first&nbsp;comment&nbsp;set&nbsp;to&nbsp;comment&nbsp;at&nbsp;any&nbsp;possible&nbsp;source&nbsp;offset.</span><br>
<span class="lineno"></span><span class="keyword" id="8461054">func</span>&nbsp;<span class="ident" id="8461059">testComment</span><span class="op" id="8461070">(</span><span class="ident" id="8461071">t</span>&nbsp;<span class="op" id="8461073">*</span><span class="ident" id="8461074">testing</span><span class="op" id="8461081">.</span><span class="ident" id="8461082">T</span><span class="op" id="8461083">,</span>&nbsp;<span class="ident" id="8461085">f</span>&nbsp;<span class="op" id="8461087">*</span><span class="ident" id="8461088">ast</span><span class="op" id="8461091">.</span><span class="ident" id="8461092">File</span><span class="op" id="8461096">,</span>&nbsp;<span class="ident" id="8461098">srclen</span>&nbsp;<span class="builtintype" id="8461105">int</span><span class="op" id="8461108">,</span>&nbsp;<span class="ident" id="8461110">comment</span>&nbsp;<span class="op" id="8461118">*</span><span class="ident" id="8461119">ast</span><span class="op" id="8461122">.</span><span class="ident" id="8461123">Comment</span><span class="op" id="8461130">)</span>&nbsp;<span class="op" id="8461132">{</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8461135">f</span><span class="op" id="8461136">.</span><span class="ident" id="8461137">Comments</span><span class="op" id="8461145">[</span><span class="num" id="8461146">0</span><span class="op" id="8461147">]</span><span class="op" id="8461148">.</span><span class="ident" id="8461149">List</span><span class="op" id="8461153">[</span><span class="num" id="8461154">0</span><span class="op" id="8461155">]</span>&nbsp;<span class="op" id="8461157">=</span>&nbsp;<span class="ident" id="8461159">comment</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8461168">var</span>&nbsp;<span class="ident" id="8461172">buf</span>&nbsp;<span class="ident" id="8461176">bytes</span><span class="op" id="8461181">.</span><span class="ident" id="8461182">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8461190">for</span>&nbsp;<span class="ident" id="8461194">offs</span>&nbsp;<span class="op" id="8461199">:=</span>&nbsp;<span class="num" id="8461202">0</span><span class="op" id="8461203">;</span>&nbsp;<span class="ident" id="8461205">offs</span>&nbsp;<span class="op" id="8461210">&lt;=</span>&nbsp;<span class="ident" id="8461213">srclen</span><span class="op" id="8461219">;</span>&nbsp;<span class="ident" id="8461221">offs</span><span class="op" id="8461225">++</span>&nbsp;<span class="op" id="8461228">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8461232">buf</span><span class="op" id="8461235">.</span><span class="ident" id="8461236">Reset</span><span class="op" id="8461241">(</span><span class="op" id="8461242">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8461246">//&nbsp;Printing&nbsp;f&nbsp;should&nbsp;result&nbsp;in&nbsp;a&nbsp;correct&nbsp;program&nbsp;no</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8461300">//&nbsp;matter&nbsp;what&nbsp;the&nbsp;(incorrect)&nbsp;comment&nbsp;position&nbsp;is.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8461354">if</span>&nbsp;<span class="ident" id="8461357">err</span>&nbsp;<span class="op" id="8461361">:=</span>&nbsp;<span class="ident" id="8461364">Fprint</span><span class="op" id="8461370">(</span><span class="op" id="8461371">&amp;</span><span class="ident" id="8461372">buf</span><span class="op" id="8461375">,</span>&nbsp;<span class="ident" id="8461377">fset</span><span class="op" id="8461381">,</span>&nbsp;<span class="ident" id="8461383">f</span><span class="op" id="8461384">)</span><span class="op" id="8461385">;</span>&nbsp;<span class="ident" id="8461387">err</span>&nbsp;<span class="op" id="8461391">!=</span>&nbsp;<span class="builtintype" id="8461394">nil</span>&nbsp;<span class="op" id="8461398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8461403">t</span><span class="op" id="8461404">.</span><span class="ident" id="8461405">Error</span><span class="op" id="8461410">(</span><span class="ident" id="8461411">err</span><span class="op" id="8461414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8461418">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8461422">if</span>&nbsp;<span class="ident" id="8461425">_</span><span class="op" id="8461426">,</span>&nbsp;<span class="ident" id="8461428">err</span>&nbsp;<span class="op" id="8461432">:=</span>&nbsp;<span class="ident" id="8461435">parser</span><span class="op" id="8461441">.</span><span class="ident" id="8461442">ParseFile</span><span class="op" id="8461451">(</span><span class="ident" id="8461452">fset</span><span class="op" id="8461456">,</span>&nbsp;<span class="string" id="8461458">&#34;&#34;</span><span class="op" id="8461460">,</span>&nbsp;<span class="ident" id="8461462">buf</span><span class="op" id="8461465">.</span><span class="ident" id="8461466">Bytes</span><span class="op" id="8461471">(</span><span class="op" id="8461472">)</span><span class="op" id="8461473">,</span>&nbsp;<span class="num" id="8461475">0</span><span class="op" id="8461476">)</span><span class="op" id="8461477">;</span>&nbsp;<span class="ident" id="8461479">err</span>&nbsp;<span class="op" id="8461483">!=</span>&nbsp;<span class="builtintype" id="8461486">nil</span>&nbsp;<span class="op" id="8461490">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8461495">t</span><span class="op" id="8461496">.</span><span class="ident" id="8461497">Fatalf</span><span class="op" id="8461503">(</span><span class="string" id="8461504">&#34;incorrect&nbsp;program&nbsp;for&nbsp;pos&nbsp;=&nbsp;%d:\n%s&#34;</span><span class="op" id="8461541">,</span>&nbsp;<span class="ident" id="8461543">comment</span><span class="op" id="8461550">.</span><span class="ident" id="8461551">Slash</span><span class="op" id="8461556">,</span>&nbsp;<span class="ident" id="8461558">buf</span><span class="op" id="8461561">.</span><span class="ident" id="8461562">String</span><span class="op" id="8461568">(</span><span class="op" id="8461569">)</span><span class="op" id="8461570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8461574">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8461578">//&nbsp;Position&nbsp;information&nbsp;is&nbsp;just&nbsp;an&nbsp;offset.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8461623">//&nbsp;Move&nbsp;comment&nbsp;one&nbsp;byte&nbsp;down&nbsp;in&nbsp;the&nbsp;source.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8461670">comment</span><span class="op" id="8461677">.</span><span class="ident" id="8461678">Slash</span><span class="op" id="8461683">++</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8461687">}</span><br>
<span class="lineno"></span><span class="op" id="8461689">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8461692">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;printer&nbsp;produces&nbsp;a&nbsp;correct&nbsp;program</span><br>
<span class="lineno"></span><span class="comment" id="8461746">//&nbsp;even&nbsp;if&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;comments&nbsp;introducing&nbsp;newlines</span><br>
<span class="lineno">295</span><span class="comment" id="8461815">//&nbsp;is&nbsp;incorrect.</span><br>
<span class="lineno"></span><span class="keyword" id="8461832">func</span>&nbsp;<span class="ident" id="8461837">TestBadComments</span><span class="op" id="8461852">(</span><span class="ident" id="8461853">t</span>&nbsp;<span class="op" id="8461855">*</span><span class="ident" id="8461856">testing</span><span class="op" id="8461863">.</span><span class="ident" id="8461864">T</span><span class="op" id="8461865">)</span>&nbsp;<span class="op" id="8461867">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8461870">const</span>&nbsp;<span class="ident" id="8461876">src</span>&nbsp;<span class="op" id="8461880">=</span>&nbsp;<span class="string" id="8461882">`<br>
<span class="lineno"></span>//&nbsp;first&nbsp;comment&nbsp;-&nbsp;text&nbsp;and&nbsp;position&nbsp;changed&nbsp;by&nbsp;test<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">300</span>import&nbsp;&#34;fmt&#34;<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14&nbsp;//&nbsp;rough&nbsp;circle<br>
<span class="lineno"></span>var&nbsp;(<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int&nbsp;=&nbsp;1,&nbsp;2,&nbsp;3<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;u,&nbsp;v&nbsp;float64<br>
<span class="lineno">305</span>)<br>
<span class="lineno"></span>func&nbsp;fibo(n&nbsp;int)&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;n&nbsp;&lt;&nbsp;2&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;n&nbsp;/*&nbsp;seed&nbsp;values&nbsp;*/<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;fibo(n-1)&nbsp;+&nbsp;fibo(n-2)<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462136">f</span><span class="op" id="8462137">,</span>&nbsp;<span class="ident" id="8462139">err</span>&nbsp;<span class="op" id="8462143">:=</span>&nbsp;<span class="ident" id="8462146">parser</span><span class="op" id="8462152">.</span><span class="ident" id="8462153">ParseFile</span><span class="op" id="8462162">(</span><span class="ident" id="8462163">fset</span><span class="op" id="8462167">,</span>&nbsp;<span class="string" id="8462169">&#34;&#34;</span><span class="op" id="8462171">,</span>&nbsp;<span class="ident" id="8462173">src</span><span class="op" id="8462176">,</span>&nbsp;<span class="ident" id="8462178">parser</span><span class="op" id="8462184">.</span><span class="ident" id="8462185">ParseComments</span><span class="op" id="8462198">)</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8462201">if</span>&nbsp;<span class="ident" id="8462204">err</span>&nbsp;<span class="op" id="8462208">!=</span>&nbsp;<span class="builtintype" id="8462211">nil</span>&nbsp;<span class="op" id="8462215">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462219">t</span><span class="op" id="8462220">.</span><span class="ident" id="8462221">Error</span><span class="op" id="8462226">(</span><span class="ident" id="8462227">err</span><span class="op" id="8462230">)</span>&nbsp;<span class="comment" id="8462232">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8462250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462254">comment</span>&nbsp;<span class="op" id="8462262">:=</span>&nbsp;<span class="ident" id="8462265">f</span><span class="op" id="8462266">.</span><span class="ident" id="8462267">Comments</span><span class="op" id="8462275">[</span><span class="num" id="8462276">0</span><span class="op" id="8462277">]</span><span class="op" id="8462278">.</span><span class="ident" id="8462279">List</span><span class="op" id="8462283">[</span><span class="num" id="8462284">0</span><span class="op" id="8462285">]</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462288">pos</span>&nbsp;<span class="op" id="8462292">:=</span>&nbsp;<span class="ident" id="8462295">comment</span><span class="op" id="8462302">.</span><span class="ident" id="8462303">Pos</span><span class="op" id="8462306">(</span><span class="op" id="8462307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8462310">if</span>&nbsp;<span class="ident" id="8462313">fset</span><span class="op" id="8462317">.</span><span class="ident" id="8462318">Position</span><span class="op" id="8462326">(</span><span class="ident" id="8462327">pos</span><span class="op" id="8462330">)</span><span class="op" id="8462331">.</span><span class="ident" id="8462332">Offset</span>&nbsp;<span class="op" id="8462339">!=</span>&nbsp;<span class="num" id="8462342">1</span>&nbsp;<span class="op" id="8462344">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462348">t</span><span class="op" id="8462349">.</span><span class="ident" id="8462350">Error</span><span class="op" id="8462355">(</span><span class="string" id="8462356">&#34;expected&nbsp;offset&nbsp;1&#34;</span><span class="op" id="8462375">)</span>&nbsp;<span class="comment" id="8462377">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8462395">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462399">testComment</span><span class="op" id="8462410">(</span><span class="ident" id="8462411">t</span><span class="op" id="8462412">,</span>&nbsp;<span class="ident" id="8462414">f</span><span class="op" id="8462415">,</span>&nbsp;<span class="builtinfunc" id="8462417">len</span><span class="op" id="8462420">(</span><span class="ident" id="8462421">src</span><span class="op" id="8462424">)</span><span class="op" id="8462425">,</span>&nbsp;<span class="op" id="8462427">&amp;</span><span class="ident" id="8462428">ast</span><span class="op" id="8462431">.</span><span class="ident" id="8462432">Comment</span><span class="op" id="8462439">{</span><span class="ident" id="8462440">Slash</span><span class="op" id="8462445">:</span>&nbsp;<span class="ident" id="8462447">pos</span><span class="op" id="8462450">,</span>&nbsp;<span class="ident" id="8462452">Text</span><span class="op" id="8462456">:</span>&nbsp;<span class="string" id="8462458">&#34;//-style&nbsp;comment&#34;</span><span class="op" id="8462476">}</span><span class="op" id="8462477">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462480">testComment</span><span class="op" id="8462491">(</span><span class="ident" id="8462492">t</span><span class="op" id="8462493">,</span>&nbsp;<span class="ident" id="8462495">f</span><span class="op" id="8462496">,</span>&nbsp;<span class="builtinfunc" id="8462498">len</span><span class="op" id="8462501">(</span><span class="ident" id="8462502">src</span><span class="op" id="8462505">)</span><span class="op" id="8462506">,</span>&nbsp;<span class="op" id="8462508">&amp;</span><span class="ident" id="8462509">ast</span><span class="op" id="8462512">.</span><span class="ident" id="8462513">Comment</span><span class="op" id="8462520">{</span><span class="ident" id="8462521">Slash</span><span class="op" id="8462526">:</span>&nbsp;<span class="ident" id="8462528">pos</span><span class="op" id="8462531">,</span>&nbsp;<span class="ident" id="8462533">Text</span><span class="op" id="8462537">:</span>&nbsp;<span class="string" id="8462539">&#34;/*-style&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8462560">}</span><span class="op" id="8462561">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462564">testComment</span><span class="op" id="8462575">(</span><span class="ident" id="8462576">t</span><span class="op" id="8462577">,</span>&nbsp;<span class="ident" id="8462579">f</span><span class="op" id="8462580">,</span>&nbsp;<span class="builtinfunc" id="8462582">len</span><span class="op" id="8462585">(</span><span class="ident" id="8462586">src</span><span class="op" id="8462589">)</span><span class="op" id="8462590">,</span>&nbsp;<span class="op" id="8462592">&amp;</span><span class="ident" id="8462593">ast</span><span class="op" id="8462596">.</span><span class="ident" id="8462597">Comment</span><span class="op" id="8462604">{</span><span class="ident" id="8462605">Slash</span><span class="op" id="8462610">:</span>&nbsp;<span class="ident" id="8462612">pos</span><span class="op" id="8462615">,</span>&nbsp;<span class="ident" id="8462617">Text</span><span class="op" id="8462621">:</span>&nbsp;<span class="string" id="8462623">&#34;/*-style&nbsp;\n&nbsp;comment&nbsp;*/&#34;</span><span class="op" id="8462647">}</span><span class="op" id="8462648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462651">testComment</span><span class="op" id="8462662">(</span><span class="ident" id="8462663">t</span><span class="op" id="8462664">,</span>&nbsp;<span class="ident" id="8462666">f</span><span class="op" id="8462667">,</span>&nbsp;<span class="builtinfunc" id="8462669">len</span><span class="op" id="8462672">(</span><span class="ident" id="8462673">src</span><span class="op" id="8462676">)</span><span class="op" id="8462677">,</span>&nbsp;<span class="op" id="8462679">&amp;</span><span class="ident" id="8462680">ast</span><span class="op" id="8462683">.</span><span class="ident" id="8462684">Comment</span><span class="op" id="8462691">{</span><span class="ident" id="8462692">Slash</span><span class="op" id="8462697">:</span>&nbsp;<span class="ident" id="8462699">pos</span><span class="op" id="8462702">,</span>&nbsp;<span class="ident" id="8462704">Text</span><span class="op" id="8462708">:</span>&nbsp;<span class="string" id="8462710">&#34;/*-style&nbsp;comment&nbsp;\n\n\n&nbsp;*/&#34;</span><span class="op" id="8462738">}</span><span class="op" id="8462739">)</span><br>
<span class="lineno"></span><span class="op" id="8462741">}</span><br>
<span class="lineno">330</span><br>
<span class="lineno"></span><span class="keyword" id="8462744">type</span>&nbsp;<span class="ident" id="8462749">visitor</span>&nbsp;<span class="keyword" id="8462757">chan</span>&nbsp;<span class="op" id="8462762">*</span><span class="ident" id="8462763">ast</span><span class="op" id="8462766">.</span><span class="ident" id="8462767">Ident</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8462774">func</span>&nbsp;<span class="op" id="8462779">(</span><span class="ident" id="8462780">v</span>&nbsp;<span class="ident" id="8462782">visitor</span><span class="op" id="8462789">)</span>&nbsp;<span class="ident" id="8462791">Visit</span><span class="op" id="8462796">(</span><span class="ident" id="8462797">n</span>&nbsp;<span class="ident" id="8462799">ast</span><span class="op" id="8462802">.</span><span class="ident" id="8462803">Node</span><span class="op" id="8462807">)</span>&nbsp;<span class="op" id="8462809">(</span><span class="ident" id="8462810">w</span>&nbsp;<span class="ident" id="8462812">ast</span><span class="op" id="8462815">.</span><span class="ident" id="8462816">Visitor</span><span class="op" id="8462823">)</span>&nbsp;<span class="op" id="8462825">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8462828">if</span>&nbsp;<span class="ident" id="8462831">ident</span><span class="op" id="8462836">,</span>&nbsp;<span class="ident" id="8462838">ok</span>&nbsp;<span class="op" id="8462841">:=</span>&nbsp;<span class="ident" id="8462844">n</span><span class="op" id="8462845">.</span><span class="op" id="8462846">(</span><span class="op" id="8462847">*</span><span class="ident" id="8462848">ast</span><span class="op" id="8462851">.</span><span class="ident" id="8462852">Ident</span><span class="op" id="8462857">)</span><span class="op" id="8462858">;</span>&nbsp;<span class="ident" id="8462860">ok</span>&nbsp;<span class="op" id="8462863">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8462867">v</span>&nbsp;<span class="op" id="8462869">&lt;-</span>&nbsp;<span class="ident" id="8462872">ident</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8462879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8462882">return</span>&nbsp;<span class="ident" id="8462889">v</span><br>
<span class="lineno"></span><span class="op" id="8462891">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">340</span><span class="comment" id="8462894">//&nbsp;idents&nbsp;is&nbsp;an&nbsp;iterator&nbsp;that&nbsp;returns&nbsp;all&nbsp;idents&nbsp;in&nbsp;f&nbsp;via&nbsp;the&nbsp;result&nbsp;channel.</span><br>
<span class="lineno"></span><span class="keyword" id="8462972">func</span>&nbsp;<span class="ident" id="8462977">idents</span><span class="op" id="8462983">(</span><span class="ident" id="8462984">f</span>&nbsp;<span class="op" id="8462986">*</span><span class="ident" id="8462987">ast</span><span class="op" id="8462990">.</span><span class="ident" id="8462991">File</span><span class="op" id="8462995">)</span>&nbsp;<span class="op" id="8462997">&lt;-</span><span class="keyword" id="8462999">chan</span>&nbsp;<span class="op" id="8463004">*</span><span class="ident" id="8463005">ast</span><span class="op" id="8463008">.</span><span class="ident" id="8463009">Ident</span>&nbsp;<span class="op" id="8463015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463018">v</span>&nbsp;<span class="op" id="8463020">:=</span>&nbsp;<span class="builtinfunc" id="8463023">make</span><span class="op" id="8463027">(</span><span class="ident" id="8463028">visitor</span><span class="op" id="8463035">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463038">go</span>&nbsp;<span class="keyword" id="8463041">func</span><span class="op" id="8463045">(</span><span class="op" id="8463046">)</span>&nbsp;<span class="op" id="8463048">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463052">ast</span><span class="op" id="8463055">.</span><span class="ident" id="8463056">Walk</span><span class="op" id="8463060">(</span><span class="ident" id="8463061">v</span><span class="op" id="8463062">,</span>&nbsp;<span class="ident" id="8463064">f</span><span class="op" id="8463065">)</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8463069">close</span><span class="op" id="8463074">(</span><span class="ident" id="8463075">v</span><span class="op" id="8463076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8463079">}</span><span class="op" id="8463080">(</span><span class="op" id="8463081">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463084">return</span>&nbsp;<span class="ident" id="8463091">v</span><br>
<span class="lineno"></span><span class="op" id="8463093">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">350</span><span class="comment" id="8463096">//&nbsp;identCount&nbsp;returns&nbsp;the&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;found&nbsp;in&nbsp;f.</span><br>
<span class="lineno"></span><span class="keyword" id="8463156">func</span>&nbsp;<span class="ident" id="8463161">identCount</span><span class="op" id="8463171">(</span><span class="ident" id="8463172">f</span>&nbsp;<span class="op" id="8463174">*</span><span class="ident" id="8463175">ast</span><span class="op" id="8463178">.</span><span class="ident" id="8463179">File</span><span class="op" id="8463183">)</span>&nbsp;<span class="builtintype" id="8463185">int</span>&nbsp;<span class="op" id="8463189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463192">n</span>&nbsp;<span class="op" id="8463194">:=</span>&nbsp;<span class="num" id="8463197">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463200">for</span>&nbsp;<span class="keyword" id="8463204">range</span>&nbsp;<span class="ident" id="8463210">idents</span><span class="op" id="8463216">(</span><span class="ident" id="8463217">f</span><span class="op" id="8463218">)</span>&nbsp;<span class="op" id="8463220">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463224">n</span><span class="op" id="8463225">++</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8463229">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463232">return</span>&nbsp;<span class="ident" id="8463239">n</span><br>
<span class="lineno"></span><span class="op" id="8463241">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8463244">//&nbsp;Verify&nbsp;that&nbsp;the&nbsp;SourcePos&nbsp;mode&nbsp;emits&nbsp;correct&nbsp;//line&nbsp;comments</span><br>
<span class="lineno">360</span><span class="comment" id="8463308">//&nbsp;by&nbsp;testing&nbsp;that&nbsp;position&nbsp;information&nbsp;for&nbsp;matching&nbsp;identifiers</span><br>
<span class="lineno"></span><span class="comment" id="8463373">//&nbsp;is&nbsp;maintained.</span><br>
<span class="lineno"></span><span class="keyword" id="8463391">func</span>&nbsp;<span class="ident" id="8463396">TestSourcePos</span><span class="op" id="8463409">(</span><span class="ident" id="8463410">t</span>&nbsp;<span class="op" id="8463412">*</span><span class="ident" id="8463413">testing</span><span class="op" id="8463420">.</span><span class="ident" id="8463421">T</span><span class="op" id="8463422">)</span>&nbsp;<span class="op" id="8463424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463427">const</span>&nbsp;<span class="ident" id="8463433">src</span>&nbsp;<span class="op" id="8463437">=</span>&nbsp;<span class="string" id="8463439">`<br>
<span class="lineno"></span>package&nbsp;p<br>
<span class="lineno">365</span>import&nbsp;(&nbsp;&#34;go/printer&#34;;&nbsp;&#34;math&#34;&nbsp;)<br>
<span class="lineno"></span>const&nbsp;pi&nbsp;=&nbsp;3.14;&nbsp;var&nbsp;x&nbsp;=&nbsp;0<br>
<span class="lineno"></span>type&nbsp;t&nbsp;struct{&nbsp;x,&nbsp;y,&nbsp;z&nbsp;int;&nbsp;u,&nbsp;v,&nbsp;w&nbsp;float32&nbsp;}<br>
<span class="lineno"></span>func&nbsp;(t&nbsp;*t)&nbsp;foo(a,&nbsp;b,&nbsp;c&nbsp;int)&nbsp;int&nbsp;{<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;a*t.x&nbsp;+&nbsp;b*t.y&nbsp;+<br>
<span class="lineno">370</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;two&nbsp;extra&nbsp;lines&nbsp;here<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c*t.z<br>
<span class="lineno"></span>}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8463664">//&nbsp;parse&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463683">f1</span><span class="op" id="8463685">,</span>&nbsp;<span class="ident" id="8463687">err</span>&nbsp;<span class="op" id="8463691">:=</span>&nbsp;<span class="ident" id="8463694">parser</span><span class="op" id="8463700">.</span><span class="ident" id="8463701">ParseFile</span><span class="op" id="8463710">(</span><span class="ident" id="8463711">fset</span><span class="op" id="8463715">,</span>&nbsp;<span class="string" id="8463717">&#34;src&#34;</span><span class="op" id="8463722">,</span>&nbsp;<span class="ident" id="8463724">src</span><span class="op" id="8463727">,</span>&nbsp;<span class="ident" id="8463729">parser</span><span class="op" id="8463735">.</span><span class="ident" id="8463736">ParseComments</span><span class="op" id="8463749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463752">if</span>&nbsp;<span class="ident" id="8463755">err</span>&nbsp;<span class="op" id="8463759">!=</span>&nbsp;<span class="builtintype" id="8463762">nil</span>&nbsp;<span class="op" id="8463766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463770">t</span><span class="op" id="8463771">.</span><span class="ident" id="8463772">Fatal</span><span class="op" id="8463777">(</span><span class="ident" id="8463778">err</span><span class="op" id="8463781">)</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8463784">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8463788">//&nbsp;pretty-print&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463814">var</span>&nbsp;<span class="ident" id="8463818">buf</span>&nbsp;<span class="ident" id="8463822">bytes</span><span class="op" id="8463827">.</span><span class="ident" id="8463828">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463836">err</span>&nbsp;<span class="op" id="8463840">=</span>&nbsp;<span class="op" id="8463842">(</span><span class="op" id="8463843">&amp;</span><span class="ident" id="8463844">Config</span><span class="op" id="8463850">{</span><span class="ident" id="8463851">Mode</span><span class="op" id="8463855">:</span>&nbsp;<span class="ident" id="8463857">UseSpaces</span>&nbsp;<span class="op" id="8463867">|</span>&nbsp;<span class="ident" id="8463869">SourcePos</span><span class="op" id="8463878">,</span>&nbsp;<span class="ident" id="8463880">Tabwidth</span><span class="op" id="8463888">:</span>&nbsp;<span class="num" id="8463890">8</span><span class="op" id="8463891">}</span><span class="op" id="8463892">)</span><span class="op" id="8463893">.</span><span class="ident" id="8463894">Fprint</span><span class="op" id="8463900">(</span><span class="op" id="8463901">&amp;</span><span class="ident" id="8463902">buf</span><span class="op" id="8463905">,</span>&nbsp;<span class="ident" id="8463907">fset</span><span class="op" id="8463911">,</span>&nbsp;<span class="ident" id="8463913">f1</span><span class="op" id="8463915">)</span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8463918">if</span>&nbsp;<span class="ident" id="8463921">err</span>&nbsp;<span class="op" id="8463925">!=</span>&nbsp;<span class="builtintype" id="8463928">nil</span>&nbsp;<span class="op" id="8463932">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8463936">t</span><span class="op" id="8463937">.</span><span class="ident" id="8463938">Fatal</span><span class="op" id="8463943">(</span><span class="ident" id="8463944">err</span><span class="op" id="8463947">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8463950">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8463954">//&nbsp;parse&nbsp;pretty&nbsp;printed&nbsp;original</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8463988">//&nbsp;(//line&nbsp;comments&nbsp;must&nbsp;be&nbsp;interpreted&nbsp;even&nbsp;w/o&nbsp;parser.ParseComments&nbsp;set)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464064">f2</span><span class="op" id="8464066">,</span>&nbsp;<span class="ident" id="8464068">err</span>&nbsp;<span class="op" id="8464072">:=</span>&nbsp;<span class="ident" id="8464075">parser</span><span class="op" id="8464081">.</span><span class="ident" id="8464082">ParseFile</span><span class="op" id="8464091">(</span><span class="ident" id="8464092">fset</span><span class="op" id="8464096">,</span>&nbsp;<span class="string" id="8464098">&#34;&#34;</span><span class="op" id="8464100">,</span>&nbsp;<span class="ident" id="8464102">buf</span><span class="op" id="8464105">.</span><span class="ident" id="8464106">Bytes</span><span class="op" id="8464111">(</span><span class="op" id="8464112">)</span><span class="op" id="8464113">,</span>&nbsp;<span class="num" id="8464115">0</span><span class="op" id="8464116">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464119">if</span>&nbsp;<span class="ident" id="8464122">err</span>&nbsp;<span class="op" id="8464126">!=</span>&nbsp;<span class="builtintype" id="8464129">nil</span>&nbsp;<span class="op" id="8464133">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464137">t</span><span class="op" id="8464138">.</span><span class="ident" id="8464139">Fatalf</span><span class="op" id="8464145">(</span><span class="string" id="8464146">&#34;%s\n%s&#34;</span><span class="op" id="8464154">,</span>&nbsp;<span class="ident" id="8464156">err</span><span class="op" id="8464159">,</span>&nbsp;<span class="ident" id="8464161">buf</span><span class="op" id="8464164">.</span><span class="ident" id="8464165">Bytes</span><span class="op" id="8464170">(</span><span class="op" id="8464171">)</span><span class="op" id="8464172">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464175">}</span><br>
<span class="lineno">395</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8464179">//&nbsp;At&nbsp;this&nbsp;point&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;identifiers&nbsp;in&nbsp;f2&nbsp;should</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8464250">//&nbsp;match&nbsp;the&nbsp;position&nbsp;information&nbsp;of&nbsp;corresponding&nbsp;identifiers&nbsp;in&nbsp;f1.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8464322">//&nbsp;number&nbsp;of&nbsp;identifiers&nbsp;must&nbsp;be&nbsp;&gt;&nbsp;0&nbsp;(test&nbsp;should&nbsp;run)&nbsp;and&nbsp;must&nbsp;match</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464393">n1</span>&nbsp;<span class="op" id="8464396">:=</span>&nbsp;<span class="ident" id="8464399">identCount</span><span class="op" id="8464409">(</span><span class="ident" id="8464410">f1</span><span class="op" id="8464412">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464415">n2</span>&nbsp;<span class="op" id="8464418">:=</span>&nbsp;<span class="ident" id="8464421">identCount</span><span class="op" id="8464431">(</span><span class="ident" id="8464432">f2</span><span class="op" id="8464434">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464437">if</span>&nbsp;<span class="ident" id="8464440">n1</span>&nbsp;<span class="op" id="8464443">==</span>&nbsp;<span class="num" id="8464446">0</span>&nbsp;<span class="op" id="8464448">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464452">t</span><span class="op" id="8464453">.</span><span class="ident" id="8464454">Fatal</span><span class="op" id="8464459">(</span><span class="string" id="8464460">&#34;got&nbsp;no&nbsp;idents&#34;</span><span class="op" id="8464475">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464478">}</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464481">if</span>&nbsp;<span class="ident" id="8464484">n2</span>&nbsp;<span class="op" id="8464487">!=</span>&nbsp;<span class="ident" id="8464490">n1</span>&nbsp;<span class="op" id="8464493">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464497">t</span><span class="op" id="8464498">.</span><span class="ident" id="8464499">Errorf</span><span class="op" id="8464505">(</span><span class="string" id="8464506">&#34;got&nbsp;%d&nbsp;idents;&nbsp;want&nbsp;%d&#34;</span><span class="op" id="8464530">,</span>&nbsp;<span class="ident" id="8464532">n2</span><span class="op" id="8464534">,</span>&nbsp;<span class="ident" id="8464536">n1</span><span class="op" id="8464538">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464541">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8464545">//&nbsp;verify&nbsp;that&nbsp;all&nbsp;identifiers&nbsp;have&nbsp;correct&nbsp;line&nbsp;information</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464607">i2range</span>&nbsp;<span class="op" id="8464615">:=</span>&nbsp;<span class="ident" id="8464618">idents</span><span class="op" id="8464624">(</span><span class="ident" id="8464625">f2</span><span class="op" id="8464627">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464630">for</span>&nbsp;<span class="ident" id="8464634">i1</span>&nbsp;<span class="op" id="8464637">:=</span>&nbsp;<span class="keyword" id="8464640">range</span>&nbsp;<span class="ident" id="8464646">idents</span><span class="op" id="8464652">(</span><span class="ident" id="8464653">f1</span><span class="op" id="8464655">)</span>&nbsp;<span class="op" id="8464657">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464661">i2</span>&nbsp;<span class="op" id="8464664">:=</span>&nbsp;<span class="op" id="8464667">&lt;-</span><span class="ident" id="8464669">i2range</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464680">if</span>&nbsp;<span class="ident" id="8464683">i2</span><span class="op" id="8464685">.</span><span class="ident" id="8464686">Name</span>&nbsp;<span class="op" id="8464691">!=</span>&nbsp;<span class="ident" id="8464694">i1</span><span class="op" id="8464696">.</span><span class="ident" id="8464697">Name</span>&nbsp;<span class="op" id="8464702">{</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464707">t</span><span class="op" id="8464708">.</span><span class="ident" id="8464709">Errorf</span><span class="op" id="8464715">(</span><span class="string" id="8464716">&#34;got&nbsp;ident&nbsp;%s;&nbsp;want&nbsp;%s&#34;</span><span class="op" id="8464739">,</span>&nbsp;<span class="ident" id="8464741">i2</span><span class="op" id="8464743">.</span><span class="ident" id="8464744">Name</span><span class="op" id="8464748">,</span>&nbsp;<span class="ident" id="8464750">i1</span><span class="op" id="8464752">.</span><span class="ident" id="8464753">Name</span><span class="op" id="8464757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464761">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464766">l1</span>&nbsp;<span class="op" id="8464769">:=</span>&nbsp;<span class="ident" id="8464772">fset</span><span class="op" id="8464776">.</span><span class="ident" id="8464777">Position</span><span class="op" id="8464785">(</span><span class="ident" id="8464786">i1</span><span class="op" id="8464788">.</span><span class="ident" id="8464789">Pos</span><span class="op" id="8464792">(</span><span class="op" id="8464793">)</span><span class="op" id="8464794">)</span><span class="op" id="8464795">.</span><span class="ident" id="8464796">Line</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464803">l2</span>&nbsp;<span class="op" id="8464806">:=</span>&nbsp;<span class="ident" id="8464809">fset</span><span class="op" id="8464813">.</span><span class="ident" id="8464814">Position</span><span class="op" id="8464822">(</span><span class="ident" id="8464823">i2</span><span class="op" id="8464825">.</span><span class="ident" id="8464826">Pos</span><span class="op" id="8464829">(</span><span class="op" id="8464830">)</span><span class="op" id="8464831">)</span><span class="op" id="8464832">.</span><span class="ident" id="8464833">Line</span><br>
<span class="lineno">420</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464840">if</span>&nbsp;<span class="ident" id="8464843">l2</span>&nbsp;<span class="op" id="8464846">!=</span>&nbsp;<span class="ident" id="8464849">l1</span>&nbsp;<span class="op" id="8464852">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464857">t</span><span class="op" id="8464858">.</span><span class="ident" id="8464859">Errorf</span><span class="op" id="8464865">(</span><span class="string" id="8464866">&#34;got&nbsp;line&nbsp;%d;&nbsp;want&nbsp;%d&nbsp;for&nbsp;%s&#34;</span><span class="op" id="8464895">,</span>&nbsp;<span class="ident" id="8464897">l2</span><span class="op" id="8464899">,</span>&nbsp;<span class="ident" id="8464901">l1</span><span class="op" id="8464903">,</span>&nbsp;<span class="ident" id="8464905">i1</span><span class="op" id="8464907">.</span><span class="ident" id="8464908">Name</span><span class="op" id="8464912">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464916">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464919">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8464923">if</span>&nbsp;<span class="ident" id="8464926">t</span><span class="op" id="8464927">.</span><span class="ident" id="8464928">Failed</span><span class="op" id="8464934">(</span><span class="op" id="8464935">)</span>&nbsp;<span class="op" id="8464937">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8464941">t</span><span class="op" id="8464942">.</span><span class="ident" id="8464943">Logf</span><span class="op" id="8464947">(</span><span class="string" id="8464948">&#34;\n%s&#34;</span><span class="op" id="8464954">,</span>&nbsp;<span class="ident" id="8464956">buf</span><span class="op" id="8464959">.</span><span class="ident" id="8464960">Bytes</span><span class="op" id="8464965">(</span><span class="op" id="8464966">)</span><span class="op" id="8464967">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8464970">}</span><br>
<span class="lineno"></span><span class="op" id="8464972">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">430</span><span class="keyword" id="8464975">var</span>&nbsp;<span class="ident" id="8464979">decls</span>&nbsp;<span class="op" id="8464985">=</span>&nbsp;<span class="op" id="8464987">[</span><span class="op" id="8464988">]</span><span class="builtintype" id="8464989">string</span><span class="op" id="8464995">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8464998">`import&nbsp;&#34;fmt&#34;`</span><span class="op" id="8465012">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8465015">&#34;const&nbsp;pi&nbsp;=&nbsp;3.1415\nconst&nbsp;e&nbsp;=&nbsp;2.71828\n\nvar&nbsp;x&nbsp;=&nbsp;pi&#34;</span><span class="op" id="8465067">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8465070">&#34;func&nbsp;sum(x,&nbsp;y&nbsp;int)&nbsp;int\t{&nbsp;return&nbsp;x&nbsp;+&nbsp;y&nbsp;}&#34;</span><span class="op" id="8465112">,</span><br>
<span class="lineno"></span><span class="op" id="8465114">}</span><br>
<span class="lineno">435</span><br>
<span class="lineno"></span><span class="keyword" id="8465117">func</span>&nbsp;<span class="ident" id="8465122">TestDeclLists</span><span class="op" id="8465135">(</span><span class="ident" id="8465136">t</span>&nbsp;<span class="op" id="8465138">*</span><span class="ident" id="8465139">testing</span><span class="op" id="8465146">.</span><span class="ident" id="8465147">T</span><span class="op" id="8465148">)</span>&nbsp;<span class="op" id="8465150">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465153">for</span>&nbsp;<span class="ident" id="8465157">_</span><span class="op" id="8465158">,</span>&nbsp;<span class="ident" id="8465160">src</span>&nbsp;<span class="op" id="8465164">:=</span>&nbsp;<span class="keyword" id="8465167">range</span>&nbsp;<span class="ident" id="8465173">decls</span>&nbsp;<span class="op" id="8465179">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465183">file</span><span class="op" id="8465187">,</span>&nbsp;<span class="ident" id="8465189">err</span>&nbsp;<span class="op" id="8465193">:=</span>&nbsp;<span class="ident" id="8465196">parser</span><span class="op" id="8465202">.</span><span class="ident" id="8465203">ParseFile</span><span class="op" id="8465212">(</span><span class="ident" id="8465213">fset</span><span class="op" id="8465217">,</span>&nbsp;<span class="string" id="8465219">&#34;&#34;</span><span class="op" id="8465221">,</span>&nbsp;<span class="string" id="8465223">&#34;package&nbsp;p;&#34;</span><span class="op" id="8465235">+</span><span class="ident" id="8465236">src</span><span class="op" id="8465239">,</span>&nbsp;<span class="ident" id="8465241">parser</span><span class="op" id="8465247">.</span><span class="ident" id="8465248">ParseComments</span><span class="op" id="8465261">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465265">if</span>&nbsp;<span class="ident" id="8465268">err</span>&nbsp;<span class="op" id="8465272">!=</span>&nbsp;<span class="builtintype" id="8465275">nil</span>&nbsp;<span class="op" id="8465279">{</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8465284">panic</span><span class="op" id="8465289">(</span><span class="ident" id="8465290">err</span><span class="op" id="8465293">)</span>&nbsp;<span class="comment" id="8465295">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8465314">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465319">var</span>&nbsp;<span class="ident" id="8465323">buf</span>&nbsp;<span class="ident" id="8465327">bytes</span><span class="op" id="8465332">.</span><span class="ident" id="8465333">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465342">err</span>&nbsp;<span class="op" id="8465346">=</span>&nbsp;<span class="ident" id="8465348">Fprint</span><span class="op" id="8465354">(</span><span class="op" id="8465355">&amp;</span><span class="ident" id="8465356">buf</span><span class="op" id="8465359">,</span>&nbsp;<span class="ident" id="8465361">fset</span><span class="op" id="8465365">,</span>&nbsp;<span class="ident" id="8465367">file</span><span class="op" id="8465371">.</span><span class="ident" id="8465372">Decls</span><span class="op" id="8465377">)</span>&nbsp;<span class="comment" id="8465379">//&nbsp;only&nbsp;print&nbsp;declarations</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465408">if</span>&nbsp;<span class="ident" id="8465411">err</span>&nbsp;<span class="op" id="8465415">!=</span>&nbsp;<span class="builtintype" id="8465418">nil</span>&nbsp;<span class="op" id="8465422">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8465427">panic</span><span class="op" id="8465432">(</span><span class="ident" id="8465433">err</span><span class="op" id="8465436">)</span>&nbsp;<span class="comment" id="8465438">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8465457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465462">out</span>&nbsp;<span class="op" id="8465466">:=</span>&nbsp;<span class="ident" id="8465469">buf</span><span class="op" id="8465472">.</span><span class="ident" id="8465473">String</span><span class="op" id="8465479">(</span><span class="op" id="8465480">)</span><br>
<span class="lineno">450</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465484">if</span>&nbsp;<span class="ident" id="8465487">out</span>&nbsp;<span class="op" id="8465491">!=</span>&nbsp;<span class="ident" id="8465494">src</span>&nbsp;<span class="op" id="8465498">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465503">t</span><span class="op" id="8465504">.</span><span class="ident" id="8465505">Errorf</span><span class="op" id="8465511">(</span><span class="string" id="8465512">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8465536">,</span>&nbsp;<span class="ident" id="8465538">out</span><span class="op" id="8465541">,</span>&nbsp;<span class="ident" id="8465543">src</span><span class="op" id="8465546">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8465550">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8465553">}</span><br>
<span class="lineno"></span><span class="op" id="8465555">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="8465558">var</span>&nbsp;<span class="ident" id="8465562">stmts</span>&nbsp;<span class="op" id="8465568">=</span>&nbsp;<span class="op" id="8465570">[</span><span class="op" id="8465571">]</span><span class="builtintype" id="8465572">string</span><span class="op" id="8465578">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8465581">&#34;i&nbsp;:=&nbsp;0&#34;</span><span class="op" id="8465589">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8465592">&#34;select&nbsp;{}\nvar&nbsp;a,&nbsp;b&nbsp;=&nbsp;1,&nbsp;2\nreturn&nbsp;a&nbsp;+&nbsp;b&#34;</span><span class="op" id="8465634">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="string" id="8465637">&#34;go&nbsp;f()\ndefer&nbsp;func()&nbsp;{}()&#34;</span><span class="op" id="8465664">,</span><br>
<span class="lineno">460</span><span class="op" id="8465666">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8465669">func</span>&nbsp;<span class="ident" id="8465674">TestStmtLists</span><span class="op" id="8465687">(</span><span class="ident" id="8465688">t</span>&nbsp;<span class="op" id="8465690">*</span><span class="ident" id="8465691">testing</span><span class="op" id="8465698">.</span><span class="ident" id="8465699">T</span><span class="op" id="8465700">)</span>&nbsp;<span class="op" id="8465702">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465705">for</span>&nbsp;<span class="ident" id="8465709">_</span><span class="op" id="8465710">,</span>&nbsp;<span class="ident" id="8465712">src</span>&nbsp;<span class="op" id="8465716">:=</span>&nbsp;<span class="keyword" id="8465719">range</span>&nbsp;<span class="ident" id="8465725">stmts</span>&nbsp;<span class="op" id="8465731">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465735">file</span><span class="op" id="8465739">,</span>&nbsp;<span class="ident" id="8465741">err</span>&nbsp;<span class="op" id="8465745">:=</span>&nbsp;<span class="ident" id="8465748">parser</span><span class="op" id="8465754">.</span><span class="ident" id="8465755">ParseFile</span><span class="op" id="8465764">(</span><span class="ident" id="8465765">fset</span><span class="op" id="8465769">,</span>&nbsp;<span class="string" id="8465771">&#34;&#34;</span><span class="op" id="8465773">,</span>&nbsp;<span class="string" id="8465775">&#34;package&nbsp;p;&nbsp;func&nbsp;_()&nbsp;{&#34;</span><span class="op" id="8465798">+</span><span class="ident" id="8465799">src</span><span class="op" id="8465802">+</span><span class="string" id="8465803">&#34;}&#34;</span><span class="op" id="8465806">,</span>&nbsp;<span class="ident" id="8465808">parser</span><span class="op" id="8465814">.</span><span class="ident" id="8465815">ParseComments</span><span class="op" id="8465828">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465832">if</span>&nbsp;<span class="ident" id="8465835">err</span>&nbsp;<span class="op" id="8465839">!=</span>&nbsp;<span class="builtintype" id="8465842">nil</span>&nbsp;<span class="op" id="8465846">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8465851">panic</span><span class="op" id="8465856">(</span><span class="ident" id="8465857">err</span><span class="op" id="8465860">)</span>&nbsp;<span class="comment" id="8465862">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8465881">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8465886">var</span>&nbsp;<span class="ident" id="8465890">buf</span>&nbsp;<span class="ident" id="8465894">bytes</span><span class="op" id="8465899">.</span><span class="ident" id="8465900">Buffer</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8465909">err</span>&nbsp;<span class="op" id="8465913">=</span>&nbsp;<span class="ident" id="8465915">Fprint</span><span class="op" id="8465921">(</span><span class="op" id="8465922">&amp;</span><span class="ident" id="8465923">buf</span><span class="op" id="8465926">,</span>&nbsp;<span class="ident" id="8465928">fset</span><span class="op" id="8465932">,</span>&nbsp;<span class="ident" id="8465934">file</span><span class="op" id="8465938">.</span><span class="ident" id="8465939">Decls</span><span class="op" id="8465944">[</span><span class="num" id="8465945">0</span><span class="op" id="8465946">]</span><span class="op" id="8465947">.</span><span class="op" id="8465948">(</span><span class="op" id="8465949">*</span><span class="ident" id="8465950">ast</span><span class="op" id="8465953">.</span><span class="ident" id="8465954">FuncDecl</span><span class="op" id="8465962">)</span><span class="op" id="8465963">.</span><span class="ident" id="8465964">Body</span><span class="op" id="8465968">.</span><span class="ident" id="8465969">List</span><span class="op" id="8465973">)</span>&nbsp;<span class="comment" id="8465975">//&nbsp;only&nbsp;print&nbsp;statements</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466002">if</span>&nbsp;<span class="ident" id="8466005">err</span>&nbsp;<span class="op" id="8466009">!=</span>&nbsp;<span class="builtintype" id="8466012">nil</span>&nbsp;<span class="op" id="8466016">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8466021">panic</span><span class="op" id="8466026">(</span><span class="ident" id="8466027">err</span><span class="op" id="8466030">)</span>&nbsp;<span class="comment" id="8466032">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466051">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466056">out</span>&nbsp;<span class="op" id="8466060">:=</span>&nbsp;<span class="ident" id="8466063">buf</span><span class="op" id="8466066">.</span><span class="ident" id="8466067">String</span><span class="op" id="8466073">(</span><span class="op" id="8466074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466078">if</span>&nbsp;<span class="ident" id="8466081">out</span>&nbsp;<span class="op" id="8466085">!=</span>&nbsp;<span class="ident" id="8466088">src</span>&nbsp;<span class="op" id="8466092">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466097">t</span><span class="op" id="8466098">.</span><span class="ident" id="8466099">Errorf</span><span class="op" id="8466105">(</span><span class="string" id="8466106">&#34;\ngot&nbsp;:&nbsp;%q\nwant:&nbsp;%q\n&#34;</span><span class="op" id="8466130">,</span>&nbsp;<span class="ident" id="8466132">out</span><span class="op" id="8466135">,</span>&nbsp;<span class="ident" id="8466137">src</span><span class="op" id="8466140">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466144">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466147">}</span><br>
<span class="lineno">480</span><span class="op" id="8466149">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="8466152">func</span>&nbsp;<span class="ident" id="8466157">TestBaseIndent</span><span class="op" id="8466171">(</span><span class="ident" id="8466172">t</span>&nbsp;<span class="op" id="8466174">*</span><span class="ident" id="8466175">testing</span><span class="op" id="8466182">.</span><span class="ident" id="8466183">T</span><span class="op" id="8466184">)</span>&nbsp;<span class="op" id="8466186">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8466189">//&nbsp;The&nbsp;testfile&nbsp;must&nbsp;not&nbsp;contain&nbsp;multi-line&nbsp;raw&nbsp;strings&nbsp;since&nbsp;those</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8466258">//&nbsp;are&nbsp;not&nbsp;indented&nbsp;(because&nbsp;their&nbsp;values&nbsp;must&nbsp;not&nbsp;change)&nbsp;and&nbsp;make</span><br>
<span class="lineno">485</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8466327">//&nbsp;this&nbsp;test&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466347">const</span>&nbsp;<span class="ident" id="8466353">filename</span>&nbsp;<span class="op" id="8466362">=</span>&nbsp;<span class="string" id="8466364">&#34;printer.go&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466378">src</span><span class="op" id="8466381">,</span>&nbsp;<span class="ident" id="8466383">err</span>&nbsp;<span class="op" id="8466387">:=</span>&nbsp;<span class="ident" id="8466390">ioutil</span><span class="op" id="8466396">.</span><span class="ident" id="8466397">ReadFile</span><span class="op" id="8466405">(</span><span class="ident" id="8466406">filename</span><span class="op" id="8466414">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466417">if</span>&nbsp;<span class="ident" id="8466420">err</span>&nbsp;<span class="op" id="8466424">!=</span>&nbsp;<span class="builtintype" id="8466427">nil</span>&nbsp;<span class="op" id="8466431">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8466435">panic</span><span class="op" id="8466440">(</span><span class="ident" id="8466441">err</span><span class="op" id="8466444">)</span>&nbsp;<span class="comment" id="8466446">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">490</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466464">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466468">file</span><span class="op" id="8466472">,</span>&nbsp;<span class="ident" id="8466474">err</span>&nbsp;<span class="op" id="8466478">:=</span>&nbsp;<span class="ident" id="8466481">parser</span><span class="op" id="8466487">.</span><span class="ident" id="8466488">ParseFile</span><span class="op" id="8466497">(</span><span class="ident" id="8466498">fset</span><span class="op" id="8466502">,</span>&nbsp;<span class="ident" id="8466504">filename</span><span class="op" id="8466512">,</span>&nbsp;<span class="ident" id="8466514">src</span><span class="op" id="8466517">,</span>&nbsp;<span class="num" id="8466519">0</span><span class="op" id="8466520">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466523">if</span>&nbsp;<span class="ident" id="8466526">err</span>&nbsp;<span class="op" id="8466530">!=</span>&nbsp;<span class="builtintype" id="8466533">nil</span>&nbsp;<span class="op" id="8466537">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtinfunc" id="8466541">panic</span><span class="op" id="8466546">(</span><span class="ident" id="8466547">err</span><span class="op" id="8466550">)</span>&nbsp;<span class="comment" id="8466552">//&nbsp;error&nbsp;in&nbsp;test</span><br>
<span class="lineno">495</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466570">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466574">var</span>&nbsp;<span class="ident" id="8466578">buf</span>&nbsp;<span class="ident" id="8466582">bytes</span><span class="op" id="8466587">.</span><span class="ident" id="8466588">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466596">for</span>&nbsp;<span class="ident" id="8466600">indent</span>&nbsp;<span class="op" id="8466607">:=</span>&nbsp;<span class="num" id="8466610">0</span><span class="op" id="8466611">;</span>&nbsp;<span class="ident" id="8466613">indent</span>&nbsp;<span class="op" id="8466620">&lt;</span>&nbsp;<span class="num" id="8466622">4</span><span class="op" id="8466623">;</span>&nbsp;<span class="ident" id="8466625">indent</span><span class="op" id="8466631">++</span>&nbsp;<span class="op" id="8466634">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466638">buf</span><span class="op" id="8466641">.</span><span class="ident" id="8466642">Reset</span><span class="op" id="8466647">(</span><span class="op" id="8466648">)</span><br>
<span class="lineno">500</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466652">(</span><span class="op" id="8466653">&amp;</span><span class="ident" id="8466654">Config</span><span class="op" id="8466660">{</span><span class="ident" id="8466661">Tabwidth</span><span class="op" id="8466669">:</span>&nbsp;<span class="ident" id="8466671">tabwidth</span><span class="op" id="8466679">,</span>&nbsp;<span class="ident" id="8466681">Indent</span><span class="op" id="8466687">:</span>&nbsp;<span class="ident" id="8466689">indent</span><span class="op" id="8466695">}</span><span class="op" id="8466696">)</span><span class="op" id="8466697">.</span><span class="ident" id="8466698">Fprint</span><span class="op" id="8466704">(</span><span class="op" id="8466705">&amp;</span><span class="ident" id="8466706">buf</span><span class="op" id="8466709">,</span>&nbsp;<span class="ident" id="8466711">fset</span><span class="op" id="8466715">,</span>&nbsp;<span class="ident" id="8466717">file</span><span class="op" id="8466721">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8466725">//&nbsp;all&nbsp;code&nbsp;must&nbsp;be&nbsp;indented&nbsp;by&nbsp;at&nbsp;least&nbsp;&#39;indent&#39;&nbsp;tabs</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466782">lines</span>&nbsp;<span class="op" id="8466788">:=</span>&nbsp;<span class="ident" id="8466791">bytes</span><span class="op" id="8466796">.</span><span class="ident" id="8466797">Split</span><span class="op" id="8466802">(</span><span class="ident" id="8466803">buf</span><span class="op" id="8466806">.</span><span class="ident" id="8466807">Bytes</span><span class="op" id="8466812">(</span><span class="op" id="8466813">)</span><span class="op" id="8466814">,</span>&nbsp;<span class="op" id="8466816">[</span><span class="op" id="8466817">]</span><span class="builtintype" id="8466818">byte</span><span class="op" id="8466822">{</span><span class="string" id="8466823">&#39;\n&#39;</span><span class="op" id="8466827">}</span><span class="op" id="8466828">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466832">for</span>&nbsp;<span class="ident" id="8466836">i</span><span class="op" id="8466837">,</span>&nbsp;<span class="ident" id="8466839">line</span>&nbsp;<span class="op" id="8466844">:=</span>&nbsp;<span class="keyword" id="8466847">range</span>&nbsp;<span class="ident" id="8466853">lines</span>&nbsp;<span class="op" id="8466859">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466864">if</span>&nbsp;<span class="builtinfunc" id="8466867">len</span><span class="op" id="8466870">(</span><span class="ident" id="8466871">line</span><span class="op" id="8466875">)</span>&nbsp;<span class="op" id="8466877">==</span>&nbsp;<span class="num" id="8466880">0</span>&nbsp;<span class="op" id="8466882">{</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466888">continue</span>&nbsp;<span class="comment" id="8466897">//&nbsp;empty&nbsp;lines&nbsp;don&#39;t&nbsp;have&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8466938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8466943">n</span>&nbsp;<span class="op" id="8466945">:=</span>&nbsp;<span class="num" id="8466948">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466953">for</span>&nbsp;<span class="ident" id="8466957">j</span><span class="op" id="8466958">,</span>&nbsp;<span class="ident" id="8466960">b</span>&nbsp;<span class="op" id="8466962">:=</span>&nbsp;<span class="keyword" id="8466965">range</span>&nbsp;<span class="ident" id="8466971">line</span>&nbsp;<span class="op" id="8466976">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8466982">if</span>&nbsp;<span class="ident" id="8466985">b</span>&nbsp;<span class="op" id="8466987">!=</span>&nbsp;<span class="string" id="8466990">&#39;\t&#39;</span>&nbsp;<span class="op" id="8466995">{</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="8467002">//&nbsp;end&nbsp;of&nbsp;indentation</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467029">n</span>&nbsp;<span class="op" id="8467031">=</span>&nbsp;<span class="ident" id="8467033">j</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467040">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467050">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467055">}</span><br>
<span class="lineno">515</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467060">if</span>&nbsp;<span class="ident" id="8467063">n</span>&nbsp;<span class="op" id="8467065">&lt;</span>&nbsp;<span class="ident" id="8467067">indent</span>&nbsp;<span class="op" id="8467074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467080">t</span><span class="op" id="8467081">.</span><span class="ident" id="8467082">Errorf</span><span class="op" id="8467088">(</span><span class="string" id="8467089">&#34;line&nbsp;%d:&nbsp;got&nbsp;only&nbsp;%d&nbsp;tabs;&nbsp;want&nbsp;at&nbsp;least&nbsp;%d:&nbsp;%q&#34;</span><span class="op" id="8467138">,</span>&nbsp;<span class="ident" id="8467140">i</span><span class="op" id="8467141">,</span>&nbsp;<span class="ident" id="8467143">n</span><span class="op" id="8467144">,</span>&nbsp;<span class="ident" id="8467146">indent</span><span class="op" id="8467152">,</span>&nbsp;<span class="ident" id="8467154">line</span><span class="op" id="8467158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467167">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467170">}</span><br>
<span class="lineno">520</span><span class="op" id="8467172">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="8467175">//&nbsp;TestFuncType&nbsp;tests&nbsp;that&nbsp;an&nbsp;ast.FuncType&nbsp;with&nbsp;a&nbsp;nil&nbsp;Params&nbsp;field</span><br>
<span class="lineno"></span><span class="comment" id="8467242">//&nbsp;can&nbsp;be&nbsp;printed&nbsp;(per&nbsp;go/ast&nbsp;specification).&nbsp;Test&nbsp;case&nbsp;for&nbsp;issue&nbsp;3870.</span><br>
<span class="lineno"></span><span class="keyword" id="8467314">func</span>&nbsp;<span class="ident" id="8467319">TestFuncType</span><span class="op" id="8467331">(</span><span class="ident" id="8467332">t</span>&nbsp;<span class="op" id="8467334">*</span><span class="ident" id="8467335">testing</span><span class="op" id="8467342">.</span><span class="ident" id="8467343">T</span><span class="op" id="8467344">)</span>&nbsp;<span class="op" id="8467346">{</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467349">src</span>&nbsp;<span class="op" id="8467353">:=</span>&nbsp;<span class="op" id="8467356">&amp;</span><span class="ident" id="8467357">ast</span><span class="op" id="8467360">.</span><span class="ident" id="8467361">File</span><span class="op" id="8467365">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467369">Name</span><span class="op" id="8467373">:</span>&nbsp;<span class="op" id="8467375">&amp;</span><span class="ident" id="8467376">ast</span><span class="op" id="8467379">.</span><span class="ident" id="8467380">Ident</span><span class="op" id="8467385">{</span><span class="ident" id="8467386">Name</span><span class="op" id="8467390">:</span>&nbsp;<span class="string" id="8467392">&#34;p&#34;</span><span class="op" id="8467395">}</span><span class="op" id="8467396">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467400">Decls</span><span class="op" id="8467405">:</span>&nbsp;<span class="op" id="8467407">[</span><span class="op" id="8467408">]</span><span class="ident" id="8467409">ast</span><span class="op" id="8467412">.</span><span class="ident" id="8467413">Decl</span><span class="op" id="8467417">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467422">&amp;</span><span class="ident" id="8467423">ast</span><span class="op" id="8467426">.</span><span class="ident" id="8467427">FuncDecl</span><span class="op" id="8467435">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467441">Name</span><span class="op" id="8467445">:</span>&nbsp;<span class="op" id="8467447">&amp;</span><span class="ident" id="8467448">ast</span><span class="op" id="8467451">.</span><span class="ident" id="8467452">Ident</span><span class="op" id="8467457">{</span><span class="ident" id="8467458">Name</span><span class="op" id="8467462">:</span>&nbsp;<span class="string" id="8467464">&#34;f&#34;</span><span class="op" id="8467467">}</span><span class="op" id="8467468">,</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467474">Type</span><span class="op" id="8467478">:</span>&nbsp;<span class="op" id="8467480">&amp;</span><span class="ident" id="8467481">ast</span><span class="op" id="8467484">.</span><span class="ident" id="8467485">FuncType</span><span class="op" id="8467493">{</span><span class="op" id="8467494">}</span><span class="op" id="8467495">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467500">}</span><span class="op" id="8467501">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467505">}</span><span class="op" id="8467506">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467509">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467513">var</span>&nbsp;<span class="ident" id="8467517">buf</span>&nbsp;<span class="ident" id="8467521">bytes</span><span class="op" id="8467526">.</span><span class="ident" id="8467527">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467535">if</span>&nbsp;<span class="ident" id="8467538">err</span>&nbsp;<span class="op" id="8467542">:=</span>&nbsp;<span class="ident" id="8467545">Fprint</span><span class="op" id="8467551">(</span><span class="op" id="8467552">&amp;</span><span class="ident" id="8467553">buf</span><span class="op" id="8467556">,</span>&nbsp;<span class="ident" id="8467558">fset</span><span class="op" id="8467562">,</span>&nbsp;<span class="ident" id="8467564">src</span><span class="op" id="8467567">)</span><span class="op" id="8467568">;</span>&nbsp;<span class="ident" id="8467570">err</span>&nbsp;<span class="op" id="8467574">!=</span>&nbsp;<span class="builtintype" id="8467577">nil</span>&nbsp;<span class="op" id="8467581">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467585">t</span><span class="op" id="8467586">.</span><span class="ident" id="8467587">Fatal</span><span class="op" id="8467592">(</span><span class="ident" id="8467593">err</span><span class="op" id="8467596">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467599">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467602">got</span>&nbsp;<span class="op" id="8467606">:=</span>&nbsp;<span class="ident" id="8467609">buf</span><span class="op" id="8467612">.</span><span class="ident" id="8467613">String</span><span class="op" id="8467619">(</span><span class="op" id="8467620">)</span><br>
<span class="lineno">540</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467624">const</span>&nbsp;<span class="ident" id="8467630">want</span>&nbsp;<span class="op" id="8467635">=</span>&nbsp;<span class="string" id="8467637">`package&nbsp;p<br>
<span class="lineno"></span><br>
<span class="lineno"></span>func&nbsp;f()<br>
<span class="lineno"></span>`</span><br>
<span class="lineno">545</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467662">if</span>&nbsp;<span class="ident" id="8467665">got</span>&nbsp;<span class="op" id="8467669">!=</span>&nbsp;<span class="ident" id="8467672">want</span>&nbsp;<span class="op" id="8467677">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467681">t</span><span class="op" id="8467682">.</span><span class="ident" id="8467683">Fatalf</span><span class="op" id="8467689">(</span><span class="string" id="8467690">&#34;got:\n%s\nwant:\n%s\n&#34;</span><span class="op" id="8467713">,</span>&nbsp;<span class="ident" id="8467715">got</span><span class="op" id="8467718">,</span>&nbsp;<span class="ident" id="8467720">want</span><span class="op" id="8467724">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467727">}</span><br>
<span class="lineno"></span><span class="op" id="8467729">}</span><br>
<span class="lineno">550</span><br>
<span class="lineno"></span><span class="comment" id="8467732">//&nbsp;TextX&nbsp;is&nbsp;a&nbsp;skeleton&nbsp;test&nbsp;that&nbsp;can&nbsp;be&nbsp;filled&nbsp;in&nbsp;for&nbsp;debugging&nbsp;one-off&nbsp;cases.</span><br>
<span class="lineno"></span><span class="comment" id="8467811">//&nbsp;Do&nbsp;not&nbsp;remove.</span><br>
<span class="lineno"></span><span class="keyword" id="8467829">func</span>&nbsp;<span class="ident" id="8467834">TestX</span><span class="op" id="8467839">(</span><span class="ident" id="8467840">t</span>&nbsp;<span class="op" id="8467842">*</span><span class="ident" id="8467843">testing</span><span class="op" id="8467850">.</span><span class="ident" id="8467851">T</span><span class="op" id="8467852">)</span>&nbsp;<span class="op" id="8467854">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467857">const</span>&nbsp;<span class="ident" id="8467863">src</span>&nbsp;<span class="op" id="8467867">=</span>&nbsp;<span class="string" id="8467869">`<br>
<span class="lineno">555</span>package&nbsp;p<br>
<span class="lineno"></span>func&nbsp;_()&nbsp;{}<br>
<span class="lineno"></span>`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467896">_</span><span class="op" id="8467897">,</span>&nbsp;<span class="ident" id="8467899">err</span>&nbsp;<span class="op" id="8467903">:=</span>&nbsp;<span class="ident" id="8467906">format</span><span class="op" id="8467912">(</span><span class="op" id="8467913">[</span><span class="op" id="8467914">]</span><span class="builtintype" id="8467915">byte</span><span class="op" id="8467919">(</span><span class="ident" id="8467920">src</span><span class="op" id="8467923">)</span><span class="op" id="8467924">,</span>&nbsp;<span class="num" id="8467926">0</span><span class="op" id="8467927">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="8467930">if</span>&nbsp;<span class="ident" id="8467933">err</span>&nbsp;<span class="op" id="8467937">!=</span>&nbsp;<span class="builtintype" id="8467940">nil</span>&nbsp;<span class="op" id="8467944">{</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="8467948">t</span><span class="op" id="8467949">.</span><span class="ident" id="8467950">Error</span><span class="op" id="8467955">(</span><span class="ident" id="8467956">err</span><span class="op" id="8467959">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="8467962">}</span><br>
<span class="lineno"></span><span class="op" id="8467964">}</span>
</div>
</body>
</html>
