<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>net/rpc</h2>
<ul>
<li><a href="/gostd/net/rpc/client.go.html">client.go</a></li>
<li><a href="/gostd/net/rpc/client_test.go.html">client_test.go</a></li>
<li><a href="/gostd/net/rpc/debug.go.html">debug.go</a></li>
<li><a href="/gostd/net/rpc/server.go.html">server.go</a></li>
<li><a href="/gostd/net/rpc/server_test.go.html">server_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5366060">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5366115">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5366169">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5366220">package</span>&nbsp;<span class="ident" id="5366228">rpc</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366233">import</span>&nbsp;<span class="op" id="5366240">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366243">&#34;bufio&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366252">&#34;encoding/gob&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366268">&#34;errors&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366278">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366284">&#34;log&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366291">&#34;net&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366298">&#34;net/http&#34;</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5366310">&#34;sync&#34;</span><br>
<span class="lineno"></span><span class="op" id="5366317">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366320">//&nbsp;ServerError&nbsp;represents&nbsp;an&nbsp;error&nbsp;that&nbsp;has&nbsp;been&nbsp;returned&nbsp;from</span><br>
<span class="lineno"></span><span class="comment" id="5366383">//&nbsp;the&nbsp;remote&nbsp;side&nbsp;of&nbsp;the&nbsp;RPC&nbsp;connection.</span><br>
<span class="lineno">20</span><span class="keyword" id="5366425">type</span>&nbsp;<span class="ident" id="5366430">ServerError</span>&nbsp;<span class="builtintype" id="5366442">string</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5366450">func</span>&nbsp;<span class="op" id="5366455">(</span><span class="ident" id="5366456">e</span>&nbsp;<span class="ident" id="5366458">ServerError</span><span class="op" id="5366469">)</span>&nbsp;<span class="ident" id="5366471">Error</span><span class="op" id="5366476">(</span><span class="op" id="5366477">)</span>&nbsp;<span class="builtintype" id="5366479">string</span>&nbsp;<span class="op" id="5366486">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5366489">return</span>&nbsp;<span class="builtintype" id="5366496">string</span><span class="op" id="5366502">(</span><span class="ident" id="5366503">e</span><span class="op" id="5366504">)</span><br>
<span class="lineno"></span><span class="op" id="5366506">}</span><br>
<span class="lineno">25</span><br>
<span class="lineno"></span><span class="keyword" id="5366509">var</span>&nbsp;<span class="ident" id="5366513">ErrShutdown</span>&nbsp;<span class="op" id="5366525">=</span>&nbsp;<span class="ident" id="5366527">errors</span><span class="op" id="5366533">.</span><span class="ident" id="5366534">New</span><span class="op" id="5366537">(</span><span class="string" id="5366538">&#34;connection&nbsp;is&nbsp;shut&nbsp;down&#34;</span><span class="op" id="5366563">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366566">//&nbsp;Call&nbsp;represents&nbsp;an&nbsp;active&nbsp;RPC.</span><br>
<span class="lineno"></span><span class="keyword" id="5366600">type</span>&nbsp;<span class="ident" id="5366605">Call</span>&nbsp;<span class="keyword" id="5366610">struct</span>&nbsp;<span class="op" id="5366617">{</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366620">ServiceMethod</span>&nbsp;<span class="builtintype" id="5366634">string</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5366646">//&nbsp;The&nbsp;name&nbsp;of&nbsp;the&nbsp;service&nbsp;and&nbsp;method&nbsp;to&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366694">Args</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366708">interface</span><span class="op" id="5366717">{</span><span class="op" id="5366718">}</span>&nbsp;<span class="comment" id="5366720">//&nbsp;The&nbsp;argument&nbsp;to&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366764">Reply</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366778">interface</span><span class="op" id="5366787">{</span><span class="op" id="5366788">}</span>&nbsp;<span class="comment" id="5366790">//&nbsp;The&nbsp;reply&nbsp;from&nbsp;the&nbsp;function&nbsp;(*struct).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366833">Error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5366847">error</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment" id="5366859">//&nbsp;After&nbsp;completion,&nbsp;the&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5366899">Done</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword" id="5366913">chan</span>&nbsp;<span class="op" id="5366918">*</span><span class="ident" id="5366919">Call</span>&nbsp;&nbsp;<span class="comment" id="5366925">//&nbsp;Strobes&nbsp;when&nbsp;call&nbsp;is&nbsp;complete.</span><br>
<span class="lineno">35</span><span class="op" id="5366959">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5366962">//&nbsp;Client&nbsp;represents&nbsp;an&nbsp;RPC&nbsp;Client.</span><br>
<span class="lineno"></span><span class="comment" id="5366998">//&nbsp;There&nbsp;may&nbsp;be&nbsp;multiple&nbsp;outstanding&nbsp;Calls&nbsp;associated</span><br>
<span class="lineno"></span><span class="comment" id="5367052">//&nbsp;with&nbsp;a&nbsp;single&nbsp;Client,&nbsp;and&nbsp;a&nbsp;Client&nbsp;may&nbsp;be&nbsp;used&nbsp;by</span><br>
<span class="lineno">40</span><span class="comment" id="5367105">//&nbsp;multiple&nbsp;goroutines&nbsp;simultaneously.</span><br>
<span class="lineno"></span><span class="keyword" id="5367144">type</span>&nbsp;<span class="ident" id="5367149">Client</span>&nbsp;<span class="keyword" id="5367156">struct</span>&nbsp;<span class="op" id="5367163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367166">codec</span>&nbsp;<span class="ident" id="5367172">ClientCodec</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367186">reqMutex</span>&nbsp;<span class="ident" id="5367195">sync</span><span class="op" id="5367199">.</span><span class="ident" id="5367200">Mutex</span>&nbsp;<span class="comment" id="5367206">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367229">request</span>&nbsp;&nbsp;<span class="ident" id="5367238">Request</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367248">mutex</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367257">sync</span><span class="op" id="5367261">.</span><span class="ident" id="5367262">Mutex</span>&nbsp;<span class="comment" id="5367268">//&nbsp;protects&nbsp;following</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367291">seq</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5367300">uint64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367308">pending</span>&nbsp;&nbsp;<span class="keyword" id="5367317">map</span><span class="op" id="5367320">[</span><span class="ident" id="5367321">uint64</span><span class="op" id="5367327">]</span><span class="op" id="5367328">*</span><span class="ident" id="5367329">Call</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367335">closing</span>&nbsp;&nbsp;<span class="builtintype" id="5367344">bool</span>&nbsp;<span class="comment" id="5367349">//&nbsp;user&nbsp;has&nbsp;called&nbsp;Close</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367375">shutdown</span>&nbsp;<span class="builtintype" id="5367384">bool</span>&nbsp;<span class="comment" id="5367389">//&nbsp;server&nbsp;has&nbsp;told&nbsp;us&nbsp;to&nbsp;stop</span><br>
<span class="lineno"></span><span class="op" id="5367419">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5367422">//&nbsp;A&nbsp;ClientCodec&nbsp;implements&nbsp;writing&nbsp;of&nbsp;RPC&nbsp;requests&nbsp;and</span><br>
<span class="lineno">55</span><span class="comment" id="5367478">//&nbsp;reading&nbsp;of&nbsp;RPC&nbsp;responses&nbsp;for&nbsp;the&nbsp;client&nbsp;side&nbsp;of&nbsp;an&nbsp;RPC&nbsp;session.</span><br>
<span class="lineno"></span><span class="comment" id="5367545">//&nbsp;The&nbsp;client&nbsp;calls&nbsp;WriteRequest&nbsp;to&nbsp;write&nbsp;a&nbsp;request&nbsp;to&nbsp;the&nbsp;connection</span><br>
<span class="lineno"></span><span class="comment" id="5367615">//&nbsp;and&nbsp;calls&nbsp;ReadResponseHeader&nbsp;and&nbsp;ReadResponseBody&nbsp;in&nbsp;pairs</span><br>
<span class="lineno"></span><span class="comment" id="5367677">//&nbsp;to&nbsp;read&nbsp;responses.&nbsp;&nbsp;The&nbsp;client&nbsp;calls&nbsp;Close&nbsp;when&nbsp;finished&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5367746">//&nbsp;connection.&nbsp;ReadResponseBody&nbsp;may&nbsp;be&nbsp;called&nbsp;with&nbsp;a&nbsp;nil</span><br>
<span class="lineno">60</span><span class="comment" id="5367803">//&nbsp;argument&nbsp;to&nbsp;force&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;response&nbsp;to&nbsp;be&nbsp;read&nbsp;and&nbsp;then</span><br>
<span class="lineno"></span><span class="comment" id="5367869">//&nbsp;discarded.</span><br>
<span class="lineno"></span><span class="keyword" id="5367883">type</span>&nbsp;<span class="ident" id="5367888">ClientCodec</span>&nbsp;<span class="keyword" id="5367900">interface</span>&nbsp;<span class="op" id="5367910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5367913">//&nbsp;WriteRequest&nbsp;must&nbsp;be&nbsp;safe&nbsp;for&nbsp;concurrent&nbsp;use&nbsp;by&nbsp;multiple&nbsp;goroutines.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5367986">WriteRequest</span><span class="op" id="5367998">(</span><span class="op" id="5367999">*</span><span class="ident" id="5368000">Request</span><span class="op" id="5368007">,</span>&nbsp;<span class="keyword" id="5368009">interface</span><span class="op" id="5368018">{</span><span class="op" id="5368019">}</span><span class="op" id="5368020">)</span>&nbsp;<span class="builtintype" id="5368022">error</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368029">ReadResponseHeader</span><span class="op" id="5368047">(</span><span class="op" id="5368048">*</span><span class="ident" id="5368049">Response</span><span class="op" id="5368057">)</span>&nbsp;<span class="builtintype" id="5368059">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368066">ReadResponseBody</span><span class="op" id="5368082">(</span><span class="keyword" id="5368083">interface</span><span class="op" id="5368092">{</span><span class="op" id="5368093">}</span><span class="op" id="5368094">)</span>&nbsp;<span class="builtintype" id="5368096">error</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368104">Close</span><span class="op" id="5368109">(</span><span class="op" id="5368110">)</span>&nbsp;<span class="builtintype" id="5368112">error</span><br>
<span class="lineno"></span><span class="op" id="5368118">}</span><br>
<span class="lineno">70</span><br>
<span class="lineno"></span><span class="keyword" id="5368121">func</span>&nbsp;<span class="op" id="5368126">(</span><span class="ident" id="5368127">client</span>&nbsp;<span class="op" id="5368134">*</span><span class="ident" id="5368135">Client</span><span class="op" id="5368141">)</span>&nbsp;<span class="ident" id="5368143">send</span><span class="op" id="5368147">(</span><span class="ident" id="5368148">call</span>&nbsp;<span class="op" id="5368153">*</span><span class="ident" id="5368154">Call</span><span class="op" id="5368158">)</span>&nbsp;<span class="op" id="5368160">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368163">client</span><span class="op" id="5368169">.</span><span class="ident" id="5368170">reqMutex</span><span class="op" id="5368178">.</span><span class="ident" id="5368179">Lock</span><span class="op" id="5368183">(</span><span class="op" id="5368184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368187">defer</span>&nbsp;<span class="ident" id="5368193">client</span><span class="op" id="5368199">.</span><span class="ident" id="5368200">reqMutex</span><span class="op" id="5368208">.</span><span class="ident" id="5368209">Unlock</span><span class="op" id="5368215">(</span><span class="op" id="5368216">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5368220">//&nbsp;Register&nbsp;this&nbsp;call.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368244">client</span><span class="op" id="5368250">.</span><span class="ident" id="5368251">mutex</span><span class="op" id="5368256">.</span><span class="ident" id="5368257">Lock</span><span class="op" id="5368261">(</span><span class="op" id="5368262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368265">if</span>&nbsp;<span class="ident" id="5368268">client</span><span class="op" id="5368274">.</span><span class="ident" id="5368275">shutdown</span>&nbsp;<span class="op" id="5368284">||</span>&nbsp;<span class="ident" id="5368287">client</span><span class="op" id="5368293">.</span><span class="ident" id="5368294">closing</span>&nbsp;<span class="op" id="5368302">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368306">call</span><span class="op" id="5368310">.</span><span class="ident" id="5368311">Error</span>&nbsp;<span class="op" id="5368317">=</span>&nbsp;<span class="ident" id="5368319">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368333">client</span><span class="op" id="5368339">.</span><span class="ident" id="5368340">mutex</span><span class="op" id="5368345">.</span><span class="ident" id="5368346">Unlock</span><span class="op" id="5368352">(</span><span class="op" id="5368353">)</span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368357">call</span><span class="op" id="5368361">.</span><span class="ident" id="5368362">done</span><span class="op" id="5368366">(</span><span class="op" id="5368367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368371">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5368379">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368382">seq</span>&nbsp;<span class="op" id="5368386">:=</span>&nbsp;<span class="ident" id="5368389">client</span><span class="op" id="5368395">.</span><span class="ident" id="5368396">seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368401">client</span><span class="op" id="5368407">.</span><span class="ident" id="5368408">seq</span><span class="op" id="5368411">++</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368415">client</span><span class="op" id="5368421">.</span><span class="ident" id="5368422">pending</span><span class="op" id="5368429">[</span><span class="ident" id="5368430">seq</span><span class="op" id="5368433">]</span>&nbsp;<span class="op" id="5368435">=</span>&nbsp;<span class="ident" id="5368437">call</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368443">client</span><span class="op" id="5368449">.</span><span class="ident" id="5368450">mutex</span><span class="op" id="5368455">.</span><span class="ident" id="5368456">Unlock</span><span class="op" id="5368462">(</span><span class="op" id="5368463">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5368467">//&nbsp;Encode&nbsp;and&nbsp;send&nbsp;the&nbsp;request.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368500">client</span><span class="op" id="5368506">.</span><span class="ident" id="5368507">request</span><span class="op" id="5368514">.</span><span class="ident" id="5368515">Seq</span>&nbsp;<span class="op" id="5368519">=</span>&nbsp;<span class="ident" id="5368521">seq</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368526">client</span><span class="op" id="5368532">.</span><span class="ident" id="5368533">request</span><span class="op" id="5368540">.</span><span class="ident" id="5368541">ServiceMethod</span>&nbsp;<span class="op" id="5368555">=</span>&nbsp;<span class="ident" id="5368557">call</span><span class="op" id="5368561">.</span><span class="ident" id="5368562">ServiceMethod</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368577">err</span>&nbsp;<span class="op" id="5368581">:=</span>&nbsp;<span class="ident" id="5368584">client</span><span class="op" id="5368590">.</span><span class="ident" id="5368591">codec</span><span class="op" id="5368596">.</span><span class="ident" id="5368597">WriteRequest</span><span class="op" id="5368609">(</span><span class="op" id="5368610">&amp;</span><span class="ident" id="5368611">client</span><span class="op" id="5368617">.</span><span class="ident" id="5368618">request</span><span class="op" id="5368625">,</span>&nbsp;<span class="ident" id="5368627">call</span><span class="op" id="5368631">.</span><span class="ident" id="5368632">Args</span><span class="op" id="5368636">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368639">if</span>&nbsp;<span class="ident" id="5368642">err</span>&nbsp;<span class="op" id="5368646">!=</span>&nbsp;<span class="ident" id="5368649">nil</span>&nbsp;<span class="op" id="5368653">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368657">client</span><span class="op" id="5368663">.</span><span class="ident" id="5368664">mutex</span><span class="op" id="5368669">.</span><span class="ident" id="5368670">Lock</span><span class="op" id="5368674">(</span><span class="op" id="5368675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368679">call</span>&nbsp;<span class="op" id="5368684">=</span>&nbsp;<span class="ident" id="5368686">client</span><span class="op" id="5368692">.</span><span class="ident" id="5368693">pending</span><span class="op" id="5368700">[</span><span class="ident" id="5368701">seq</span><span class="op" id="5368704">]</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5368708">delete</span><span class="op" id="5368714">(</span><span class="ident" id="5368715">client</span><span class="op" id="5368721">.</span><span class="ident" id="5368722">pending</span><span class="op" id="5368729">,</span>&nbsp;<span class="ident" id="5368731">seq</span><span class="op" id="5368734">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368738">client</span><span class="op" id="5368744">.</span><span class="ident" id="5368745">mutex</span><span class="op" id="5368750">.</span><span class="ident" id="5368751">Unlock</span><span class="op" id="5368757">(</span><span class="op" id="5368758">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368762">if</span>&nbsp;<span class="ident" id="5368765">call</span>&nbsp;<span class="op" id="5368770">!=</span>&nbsp;<span class="ident" id="5368773">nil</span>&nbsp;<span class="op" id="5368777">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368782">call</span><span class="op" id="5368786">.</span><span class="ident" id="5368787">Error</span>&nbsp;<span class="op" id="5368793">=</span>&nbsp;<span class="ident" id="5368795">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368802">call</span><span class="op" id="5368806">.</span><span class="ident" id="5368807">done</span><span class="op" id="5368811">(</span><span class="op" id="5368812">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5368816">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5368819">}</span><br>
<span class="lineno"></span><span class="op" id="5368821">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5368824">func</span>&nbsp;<span class="op" id="5368829">(</span><span class="ident" id="5368830">client</span>&nbsp;<span class="op" id="5368837">*</span><span class="ident" id="5368838">Client</span><span class="op" id="5368844">)</span>&nbsp;<span class="ident" id="5368846">input</span><span class="op" id="5368851">(</span><span class="op" id="5368852">)</span>&nbsp;<span class="op" id="5368854">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368857">var</span>&nbsp;<span class="ident" id="5368861">err</span>&nbsp;<span class="builtintype" id="5368865">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368872">var</span>&nbsp;<span class="ident" id="5368876">response</span>&nbsp;<span class="ident" id="5368885">Response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368895">for</span>&nbsp;<span class="ident" id="5368899">err</span>&nbsp;<span class="op" id="5368903">==</span>&nbsp;<span class="ident" id="5368906">nil</span>&nbsp;<span class="op" id="5368910">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368914">response</span>&nbsp;<span class="op" id="5368923">=</span>&nbsp;<span class="ident" id="5368925">Response</span><span class="op" id="5368933">{</span><span class="op" id="5368934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5368938">err</span>&nbsp;<span class="op" id="5368942">=</span>&nbsp;<span class="ident" id="5368944">client</span><span class="op" id="5368950">.</span><span class="ident" id="5368951">codec</span><span class="op" id="5368956">.</span><span class="ident" id="5368957">ReadResponseHeader</span><span class="op" id="5368975">(</span><span class="op" id="5368976">&amp;</span><span class="ident" id="5368977">response</span><span class="op" id="5368985">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5368989">if</span>&nbsp;<span class="ident" id="5368992">err</span>&nbsp;<span class="op" id="5368996">!=</span>&nbsp;<span class="ident" id="5368999">nil</span>&nbsp;<span class="op" id="5369003">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369008">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5369016">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369020">seq</span>&nbsp;<span class="op" id="5369024">:=</span>&nbsp;<span class="ident" id="5369027">response</span><span class="op" id="5369035">.</span><span class="ident" id="5369036">Seq</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369042">client</span><span class="op" id="5369048">.</span><span class="ident" id="5369049">mutex</span><span class="op" id="5369054">.</span><span class="ident" id="5369055">Lock</span><span class="op" id="5369059">(</span><span class="op" id="5369060">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369064">call</span>&nbsp;<span class="op" id="5369069">:=</span>&nbsp;<span class="ident" id="5369072">client</span><span class="op" id="5369078">.</span><span class="ident" id="5369079">pending</span><span class="op" id="5369086">[</span><span class="ident" id="5369087">seq</span><span class="op" id="5369090">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5369094">delete</span><span class="op" id="5369100">(</span><span class="ident" id="5369101">client</span><span class="op" id="5369107">.</span><span class="ident" id="5369108">pending</span><span class="op" id="5369115">,</span>&nbsp;<span class="ident" id="5369117">seq</span><span class="op" id="5369120">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369124">client</span><span class="op" id="5369130">.</span><span class="ident" id="5369131">mutex</span><span class="op" id="5369136">.</span><span class="ident" id="5369137">Unlock</span><span class="op" id="5369143">(</span><span class="op" id="5369144">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369149">switch</span>&nbsp;<span class="op" id="5369156">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369160">case</span>&nbsp;<span class="ident" id="5369165">call</span>&nbsp;<span class="op" id="5369170">==</span>&nbsp;<span class="ident" id="5369173">nil</span><span class="op" id="5369176">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369181">//&nbsp;We&#39;ve&nbsp;got&nbsp;no&nbsp;pending&nbsp;call.&nbsp;That&nbsp;usually&nbsp;means&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369238">//&nbsp;WriteRequest&nbsp;partially&nbsp;failed,&nbsp;and&nbsp;call&nbsp;was&nbsp;already</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369296">//&nbsp;removed;&nbsp;response&nbsp;is&nbsp;a&nbsp;server&nbsp;telling&nbsp;us&nbsp;about&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369352">//&nbsp;error&nbsp;reading&nbsp;request&nbsp;body.&nbsp;We&nbsp;should&nbsp;still&nbsp;attempt</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369410">//&nbsp;to&nbsp;read&nbsp;error&nbsp;body,&nbsp;but&nbsp;there&#39;s&nbsp;no&nbsp;one&nbsp;to&nbsp;give&nbsp;it&nbsp;to.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369470">err</span>&nbsp;<span class="op" id="5369474">=</span>&nbsp;<span class="ident" id="5369476">client</span><span class="op" id="5369482">.</span><span class="ident" id="5369483">codec</span><span class="op" id="5369488">.</span><span class="ident" id="5369489">ReadResponseBody</span><span class="op" id="5369505">(</span><span class="ident" id="5369506">nil</span><span class="op" id="5369509">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369514">if</span>&nbsp;<span class="ident" id="5369517">err</span>&nbsp;<span class="op" id="5369521">!=</span>&nbsp;<span class="ident" id="5369524">nil</span>&nbsp;<span class="op" id="5369528">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369534">err</span>&nbsp;<span class="op" id="5369538">=</span>&nbsp;<span class="ident" id="5369540">errors</span><span class="op" id="5369546">.</span><span class="ident" id="5369547">New</span><span class="op" id="5369550">(</span><span class="string" id="5369551">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5369574">+</span>&nbsp;<span class="ident" id="5369576">err</span><span class="op" id="5369579">.</span><span class="ident" id="5369580">Error</span><span class="op" id="5369585">(</span><span class="op" id="5369586">)</span><span class="op" id="5369587">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5369592">}</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369596">case</span>&nbsp;<span class="ident" id="5369601">response</span><span class="op" id="5369609">.</span><span class="ident" id="5369610">Error</span>&nbsp;<span class="op" id="5369616">!=</span>&nbsp;<span class="string" id="5369619">&#34;&#34;</span><span class="op" id="5369621">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369626">//&nbsp;We&#39;ve&nbsp;got&nbsp;an&nbsp;error&nbsp;response.&nbsp;Give&nbsp;this&nbsp;to&nbsp;the&nbsp;request;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369687">//&nbsp;any&nbsp;subsequent&nbsp;requests&nbsp;will&nbsp;get&nbsp;the&nbsp;ReadResponseBody</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5369747">//&nbsp;error&nbsp;if&nbsp;there&nbsp;is&nbsp;one.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369776">call</span><span class="op" id="5369780">.</span><span class="ident" id="5369781">Error</span>&nbsp;<span class="op" id="5369787">=</span>&nbsp;<span class="ident" id="5369789">ServerError</span><span class="op" id="5369800">(</span><span class="ident" id="5369801">response</span><span class="op" id="5369809">.</span><span class="ident" id="5369810">Error</span><span class="op" id="5369815">)</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369820">err</span>&nbsp;<span class="op" id="5369824">=</span>&nbsp;<span class="ident" id="5369826">client</span><span class="op" id="5369832">.</span><span class="ident" id="5369833">codec</span><span class="op" id="5369838">.</span><span class="ident" id="5369839">ReadResponseBody</span><span class="op" id="5369855">(</span><span class="ident" id="5369856">nil</span><span class="op" id="5369859">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369864">if</span>&nbsp;<span class="ident" id="5369867">err</span>&nbsp;<span class="op" id="5369871">!=</span>&nbsp;<span class="ident" id="5369874">nil</span>&nbsp;<span class="op" id="5369878">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369884">err</span>&nbsp;<span class="op" id="5369888">=</span>&nbsp;<span class="ident" id="5369890">errors</span><span class="op" id="5369896">.</span><span class="ident" id="5369897">New</span><span class="op" id="5369900">(</span><span class="string" id="5369901">&#34;reading&nbsp;error&nbsp;body:&nbsp;&#34;</span>&nbsp;<span class="op" id="5369924">+</span>&nbsp;<span class="ident" id="5369926">err</span><span class="op" id="5369929">.</span><span class="ident" id="5369930">Error</span><span class="op" id="5369935">(</span><span class="op" id="5369936">)</span><span class="op" id="5369937">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5369942">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369947">call</span><span class="op" id="5369951">.</span><span class="ident" id="5369952">done</span><span class="op" id="5369956">(</span><span class="op" id="5369957">)</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5369961">default</span><span class="op" id="5369968">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5369973">err</span>&nbsp;<span class="op" id="5369977">=</span>&nbsp;<span class="ident" id="5369979">client</span><span class="op" id="5369985">.</span><span class="ident" id="5369986">codec</span><span class="op" id="5369991">.</span><span class="ident" id="5369992">ReadResponseBody</span><span class="op" id="5370008">(</span><span class="ident" id="5370009">call</span><span class="op" id="5370013">.</span><span class="ident" id="5370014">Reply</span><span class="op" id="5370019">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370024">if</span>&nbsp;<span class="ident" id="5370027">err</span>&nbsp;<span class="op" id="5370031">!=</span>&nbsp;<span class="ident" id="5370034">nil</span>&nbsp;<span class="op" id="5370038">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370044">call</span><span class="op" id="5370048">.</span><span class="ident" id="5370049">Error</span>&nbsp;<span class="op" id="5370055">=</span>&nbsp;<span class="ident" id="5370057">errors</span><span class="op" id="5370063">.</span><span class="ident" id="5370064">New</span><span class="op" id="5370067">(</span><span class="string" id="5370068">&#34;reading&nbsp;body&nbsp;&#34;</span>&nbsp;<span class="op" id="5370084">+</span>&nbsp;<span class="ident" id="5370086">err</span><span class="op" id="5370089">.</span><span class="ident" id="5370090">Error</span><span class="op" id="5370095">(</span><span class="op" id="5370096">)</span><span class="op" id="5370097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370102">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370107">call</span><span class="op" id="5370111">.</span><span class="ident" id="5370112">done</span><span class="op" id="5370116">(</span><span class="op" id="5370117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370121">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370124">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5370127">//&nbsp;Terminate&nbsp;pending&nbsp;calls.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370156">client</span><span class="op" id="5370162">.</span><span class="ident" id="5370163">reqMutex</span><span class="op" id="5370171">.</span><span class="ident" id="5370172">Lock</span><span class="op" id="5370176">(</span><span class="op" id="5370177">)</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370180">client</span><span class="op" id="5370186">.</span><span class="ident" id="5370187">mutex</span><span class="op" id="5370192">.</span><span class="ident" id="5370193">Lock</span><span class="op" id="5370197">(</span><span class="op" id="5370198">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370201">client</span><span class="op" id="5370207">.</span><span class="ident" id="5370208">shutdown</span>&nbsp;<span class="op" id="5370217">=</span>&nbsp;<span class="builtintype" id="5370219">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370225">closing</span>&nbsp;<span class="op" id="5370233">:=</span>&nbsp;<span class="ident" id="5370236">client</span><span class="op" id="5370242">.</span><span class="ident" id="5370243">closing</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370252">if</span>&nbsp;<span class="ident" id="5370255">err</span>&nbsp;<span class="op" id="5370259">==</span>&nbsp;<span class="ident" id="5370262">io</span><span class="op" id="5370264">.</span><span class="ident" id="5370265">EOF</span>&nbsp;<span class="op" id="5370269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370273">if</span>&nbsp;<span class="ident" id="5370276">closing</span>&nbsp;<span class="op" id="5370284">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370289">err</span>&nbsp;<span class="op" id="5370293">=</span>&nbsp;<span class="ident" id="5370295">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370309">}</span>&nbsp;<span class="keyword" id="5370311">else</span>&nbsp;<span class="op" id="5370316">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370321">err</span>&nbsp;<span class="op" id="5370325">=</span>&nbsp;<span class="ident" id="5370327">io</span><span class="op" id="5370329">.</span><span class="ident" id="5370330">ErrUnexpectedEOF</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370349">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370352">}</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370355">for</span>&nbsp;<span class="ident" id="5370359">_</span><span class="op" id="5370360">,</span>&nbsp;<span class="ident" id="5370362">call</span>&nbsp;<span class="op" id="5370367">:=</span>&nbsp;<span class="keyword" id="5370370">range</span>&nbsp;<span class="ident" id="5370376">client</span><span class="op" id="5370382">.</span><span class="ident" id="5370383">pending</span>&nbsp;<span class="op" id="5370391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370395">call</span><span class="op" id="5370399">.</span><span class="ident" id="5370400">Error</span>&nbsp;<span class="op" id="5370406">=</span>&nbsp;<span class="ident" id="5370408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370414">call</span><span class="op" id="5370418">.</span><span class="ident" id="5370419">done</span><span class="op" id="5370423">(</span><span class="op" id="5370424">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370430">client</span><span class="op" id="5370436">.</span><span class="ident" id="5370437">mutex</span><span class="op" id="5370442">.</span><span class="ident" id="5370443">Unlock</span><span class="op" id="5370449">(</span><span class="op" id="5370450">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370453">client</span><span class="op" id="5370459">.</span><span class="ident" id="5370460">reqMutex</span><span class="op" id="5370468">.</span><span class="ident" id="5370469">Unlock</span><span class="op" id="5370475">(</span><span class="op" id="5370476">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370479">if</span>&nbsp;<span class="ident" id="5370482">debugLog</span>&nbsp;<span class="op" id="5370491">&amp;&amp;</span>&nbsp;<span class="ident" id="5370494">err</span>&nbsp;<span class="op" id="5370498">!=</span>&nbsp;<span class="ident" id="5370501">io</span><span class="op" id="5370503">.</span><span class="ident" id="5370504">EOF</span>&nbsp;<span class="op" id="5370508">&amp;&amp;</span>&nbsp;<span class="op" id="5370511">!</span><span class="ident" id="5370512">closing</span>&nbsp;<span class="op" id="5370520">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370524">log</span><span class="op" id="5370527">.</span><span class="ident" id="5370528">Println</span><span class="op" id="5370535">(</span><span class="string" id="5370536">&#34;rpc:&nbsp;client&nbsp;protocol&nbsp;error:&#34;</span><span class="op" id="5370565">,</span>&nbsp;<span class="ident" id="5370567">err</span><span class="op" id="5370570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370573">}</span><br>
<span class="lineno"></span><span class="op" id="5370575">}</span><br>
<span class="lineno">170</span><br>
<span class="lineno"></span><span class="keyword" id="5370578">func</span>&nbsp;<span class="op" id="5370583">(</span><span class="ident" id="5370584">call</span>&nbsp;<span class="op" id="5370589">*</span><span class="ident" id="5370590">Call</span><span class="op" id="5370594">)</span>&nbsp;<span class="ident" id="5370596">done</span><span class="op" id="5370600">(</span><span class="op" id="5370601">)</span>&nbsp;<span class="op" id="5370603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370606">select</span>&nbsp;<span class="op" id="5370613">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370616">case</span>&nbsp;<span class="ident" id="5370621">call</span><span class="op" id="5370625">.</span><span class="ident" id="5370626">Done</span>&nbsp;<span class="op" id="5370631">&lt;-</span>&nbsp;<span class="ident" id="5370634">call</span><span class="op" id="5370638">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5370642">//&nbsp;ok</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370649">default</span><span class="op" id="5370656">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5370660">//&nbsp;We&nbsp;don&#39;t&nbsp;want&nbsp;to&nbsp;block&nbsp;here.&nbsp;&nbsp;It&nbsp;is&nbsp;the&nbsp;caller&#39;s&nbsp;responsibility&nbsp;to&nbsp;make</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5370737">//&nbsp;sure&nbsp;the&nbsp;channel&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;space.&nbsp;See&nbsp;comment&nbsp;in&nbsp;Go().</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5370805">if</span>&nbsp;<span class="ident" id="5370808">debugLog</span>&nbsp;<span class="op" id="5370817">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5370822">log</span><span class="op" id="5370825">.</span><span class="ident" id="5370826">Println</span><span class="op" id="5370833">(</span><span class="string" id="5370834">&#34;rpc:&nbsp;discarding&nbsp;Call&nbsp;reply&nbsp;due&nbsp;to&nbsp;insufficient&nbsp;Done&nbsp;chan&nbsp;capacity&#34;</span><span class="op" id="5370901">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370905">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5370908">}</span><br>
<span class="lineno"></span><span class="op" id="5370910">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5370913">//&nbsp;NewClient&nbsp;returns&nbsp;a&nbsp;new&nbsp;Client&nbsp;to&nbsp;handle&nbsp;requests&nbsp;to&nbsp;the</span><br>
<span class="lineno">185</span><span class="comment" id="5370973">//&nbsp;set&nbsp;of&nbsp;services&nbsp;at&nbsp;the&nbsp;other&nbsp;end&nbsp;of&nbsp;the&nbsp;connection.</span><br>
<span class="lineno"></span><span class="comment" id="5371028">//&nbsp;It&nbsp;adds&nbsp;a&nbsp;buffer&nbsp;to&nbsp;the&nbsp;write&nbsp;side&nbsp;of&nbsp;the&nbsp;connection&nbsp;so</span><br>
<span class="lineno"></span><span class="comment" id="5371087">//&nbsp;the&nbsp;header&nbsp;and&nbsp;payload&nbsp;are&nbsp;sent&nbsp;as&nbsp;a&nbsp;unit.</span><br>
<span class="lineno"></span><span class="keyword" id="5371133">func</span>&nbsp;<span class="ident" id="5371138">NewClient</span><span class="op" id="5371147">(</span><span class="ident" id="5371148">conn</span>&nbsp;<span class="ident" id="5371153">io</span><span class="op" id="5371155">.</span><span class="ident" id="5371156">ReadWriteCloser</span><span class="op" id="5371171">)</span>&nbsp;<span class="op" id="5371173">*</span><span class="ident" id="5371174">Client</span>&nbsp;<span class="op" id="5371181">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371184">encBuf</span>&nbsp;<span class="op" id="5371191">:=</span>&nbsp;<span class="ident" id="5371194">bufio</span><span class="op" id="5371199">.</span><span class="ident" id="5371200">NewWriter</span><span class="op" id="5371209">(</span><span class="ident" id="5371210">conn</span><span class="op" id="5371214">)</span><br>
<span class="lineno">190</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371217">client</span>&nbsp;<span class="op" id="5371224">:=</span>&nbsp;<span class="op" id="5371227">&amp;</span><span class="ident" id="5371228">gobClientCodec</span><span class="op" id="5371242">{</span><span class="ident" id="5371243">conn</span><span class="op" id="5371247">,</span>&nbsp;<span class="ident" id="5371249">gob</span><span class="op" id="5371252">.</span><span class="ident" id="5371253">NewDecoder</span><span class="op" id="5371263">(</span><span class="ident" id="5371264">conn</span><span class="op" id="5371268">)</span><span class="op" id="5371269">,</span>&nbsp;<span class="ident" id="5371271">gob</span><span class="op" id="5371274">.</span><span class="ident" id="5371275">NewEncoder</span><span class="op" id="5371285">(</span><span class="ident" id="5371286">encBuf</span><span class="op" id="5371292">)</span><span class="op" id="5371293">,</span>&nbsp;<span class="ident" id="5371295">encBuf</span><span class="op" id="5371301">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371304">return</span>&nbsp;<span class="ident" id="5371311">NewClientWithCodec</span><span class="op" id="5371329">(</span><span class="ident" id="5371330">client</span><span class="op" id="5371336">)</span><br>
<span class="lineno"></span><span class="op" id="5371338">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5371341">//&nbsp;NewClientWithCodec&nbsp;is&nbsp;like&nbsp;NewClient&nbsp;but&nbsp;uses&nbsp;the&nbsp;specified</span><br>
<span class="lineno">195</span><span class="comment" id="5371404">//&nbsp;codec&nbsp;to&nbsp;encode&nbsp;requests&nbsp;and&nbsp;decode&nbsp;responses.</span><br>
<span class="lineno"></span><span class="keyword" id="5371454">func</span>&nbsp;<span class="ident" id="5371459">NewClientWithCodec</span><span class="op" id="5371477">(</span><span class="ident" id="5371478">codec</span>&nbsp;<span class="ident" id="5371484">ClientCodec</span><span class="op" id="5371495">)</span>&nbsp;<span class="op" id="5371497">*</span><span class="ident" id="5371498">Client</span>&nbsp;<span class="op" id="5371505">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371508">client</span>&nbsp;<span class="op" id="5371515">:=</span>&nbsp;<span class="op" id="5371518">&amp;</span><span class="ident" id="5371519">Client</span><span class="op" id="5371525">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371529">codec</span><span class="op" id="5371534">:</span>&nbsp;&nbsp;&nbsp;<span class="ident" id="5371538">codec</span><span class="op" id="5371543">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371547">pending</span><span class="op" id="5371554">:</span>&nbsp;<span class="builtinfunc" id="5371556">make</span><span class="op" id="5371560">(</span><span class="keyword" id="5371561">map</span><span class="op" id="5371564">[</span><span class="ident" id="5371565">uint64</span><span class="op" id="5371571">]</span><span class="op" id="5371572">*</span><span class="ident" id="5371573">Call</span><span class="op" id="5371577">)</span><span class="op" id="5371578">,</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5371581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371584">go</span>&nbsp;<span class="ident" id="5371587">client</span><span class="op" id="5371593">.</span><span class="ident" id="5371594">input</span><span class="op" id="5371599">(</span><span class="op" id="5371600">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371603">return</span>&nbsp;<span class="ident" id="5371610">client</span><br>
<span class="lineno"></span><span class="op" id="5371617">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="keyword" id="5371620">type</span>&nbsp;<span class="ident" id="5371625">gobClientCodec</span>&nbsp;<span class="keyword" id="5371640">struct</span>&nbsp;<span class="op" id="5371647">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371650">rwc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5371657">io</span><span class="op" id="5371659">.</span><span class="ident" id="5371660">ReadWriteCloser</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371677">dec</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371684">*</span><span class="ident" id="5371685">gob</span><span class="op" id="5371688">.</span><span class="ident" id="5371689">Decoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371698">enc</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5371705">*</span><span class="ident" id="5371706">gob</span><span class="op" id="5371709">.</span><span class="ident" id="5371710">Encoder</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5371719">encBuf</span>&nbsp;<span class="op" id="5371726">*</span><span class="ident" id="5371727">bufio</span><span class="op" id="5371732">.</span><span class="ident" id="5371733">Writer</span><br>
<span class="lineno">210</span><span class="op" id="5371740">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5371743">func</span>&nbsp;<span class="op" id="5371748">(</span><span class="ident" id="5371749">c</span>&nbsp;<span class="op" id="5371751">*</span><span class="ident" id="5371752">gobClientCodec</span><span class="op" id="5371766">)</span>&nbsp;<span class="ident" id="5371768">WriteRequest</span><span class="op" id="5371780">(</span><span class="ident" id="5371781">r</span>&nbsp;<span class="op" id="5371783">*</span><span class="ident" id="5371784">Request</span><span class="op" id="5371791">,</span>&nbsp;<span class="ident" id="5371793">body</span>&nbsp;<span class="keyword" id="5371798">interface</span><span class="op" id="5371807">{</span><span class="op" id="5371808">}</span><span class="op" id="5371809">)</span>&nbsp;<span class="op" id="5371811">(</span><span class="ident" id="5371812">err</span>&nbsp;<span class="builtintype" id="5371816">error</span><span class="op" id="5371821">)</span>&nbsp;<span class="op" id="5371823">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371826">if</span>&nbsp;<span class="ident" id="5371829">err</span>&nbsp;<span class="op" id="5371833">=</span>&nbsp;<span class="ident" id="5371835">c</span><span class="op" id="5371836">.</span><span class="ident" id="5371837">enc</span><span class="op" id="5371840">.</span><span class="ident" id="5371841">Encode</span><span class="op" id="5371847">(</span><span class="ident" id="5371848">r</span><span class="op" id="5371849">)</span><span class="op" id="5371850">;</span>&nbsp;<span class="ident" id="5371852">err</span>&nbsp;<span class="op" id="5371856">!=</span>&nbsp;<span class="ident" id="5371859">nil</span>&nbsp;<span class="op" id="5371863">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371867">return</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5371875">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371878">if</span>&nbsp;<span class="ident" id="5371881">err</span>&nbsp;<span class="op" id="5371885">=</span>&nbsp;<span class="ident" id="5371887">c</span><span class="op" id="5371888">.</span><span class="ident" id="5371889">enc</span><span class="op" id="5371892">.</span><span class="ident" id="5371893">Encode</span><span class="op" id="5371899">(</span><span class="ident" id="5371900">body</span><span class="op" id="5371904">)</span><span class="op" id="5371905">;</span>&nbsp;<span class="ident" id="5371907">err</span>&nbsp;<span class="op" id="5371911">!=</span>&nbsp;<span class="ident" id="5371914">nil</span>&nbsp;<span class="op" id="5371918">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371922">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5371930">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5371933">return</span>&nbsp;<span class="ident" id="5371940">c</span><span class="op" id="5371941">.</span><span class="ident" id="5371942">encBuf</span><span class="op" id="5371948">.</span><span class="ident" id="5371949">Flush</span><span class="op" id="5371954">(</span><span class="op" id="5371955">)</span><br>
<span class="lineno">220</span><span class="op" id="5371957">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5371960">func</span>&nbsp;<span class="op" id="5371965">(</span><span class="ident" id="5371966">c</span>&nbsp;<span class="op" id="5371968">*</span><span class="ident" id="5371969">gobClientCodec</span><span class="op" id="5371983">)</span>&nbsp;<span class="ident" id="5371985">ReadResponseHeader</span><span class="op" id="5372003">(</span><span class="ident" id="5372004">r</span>&nbsp;<span class="op" id="5372006">*</span><span class="ident" id="5372007">Response</span><span class="op" id="5372015">)</span>&nbsp;<span class="builtintype" id="5372017">error</span>&nbsp;<span class="op" id="5372023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372026">return</span>&nbsp;<span class="ident" id="5372033">c</span><span class="op" id="5372034">.</span><span class="ident" id="5372035">dec</span><span class="op" id="5372038">.</span><span class="ident" id="5372039">Decode</span><span class="op" id="5372045">(</span><span class="ident" id="5372046">r</span><span class="op" id="5372047">)</span><br>
<span class="lineno"></span><span class="op" id="5372049">}</span><br>
<span class="lineno">225</span><br>
<span class="lineno"></span><span class="keyword" id="5372052">func</span>&nbsp;<span class="op" id="5372057">(</span><span class="ident" id="5372058">c</span>&nbsp;<span class="op" id="5372060">*</span><span class="ident" id="5372061">gobClientCodec</span><span class="op" id="5372075">)</span>&nbsp;<span class="ident" id="5372077">ReadResponseBody</span><span class="op" id="5372093">(</span><span class="ident" id="5372094">body</span>&nbsp;<span class="keyword" id="5372099">interface</span><span class="op" id="5372108">{</span><span class="op" id="5372109">}</span><span class="op" id="5372110">)</span>&nbsp;<span class="builtintype" id="5372112">error</span>&nbsp;<span class="op" id="5372118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372121">return</span>&nbsp;<span class="ident" id="5372128">c</span><span class="op" id="5372129">.</span><span class="ident" id="5372130">dec</span><span class="op" id="5372133">.</span><span class="ident" id="5372134">Decode</span><span class="op" id="5372140">(</span><span class="ident" id="5372141">body</span><span class="op" id="5372145">)</span><br>
<span class="lineno"></span><span class="op" id="5372147">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">230</span><span class="keyword" id="5372150">func</span>&nbsp;<span class="op" id="5372155">(</span><span class="ident" id="5372156">c</span>&nbsp;<span class="op" id="5372158">*</span><span class="ident" id="5372159">gobClientCodec</span><span class="op" id="5372173">)</span>&nbsp;<span class="ident" id="5372175">Close</span><span class="op" id="5372180">(</span><span class="op" id="5372181">)</span>&nbsp;<span class="builtintype" id="5372183">error</span>&nbsp;<span class="op" id="5372189">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372192">return</span>&nbsp;<span class="ident" id="5372199">c</span><span class="op" id="5372200">.</span><span class="ident" id="5372201">rwc</span><span class="op" id="5372204">.</span><span class="ident" id="5372205">Close</span><span class="op" id="5372210">(</span><span class="op" id="5372211">)</span><br>
<span class="lineno"></span><span class="op" id="5372213">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5372216">//&nbsp;DialHTTP&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address</span><br>
<span class="lineno">235</span><span class="comment" id="5372292">//&nbsp;listening&nbsp;on&nbsp;the&nbsp;default&nbsp;HTTP&nbsp;RPC&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5372335">func</span>&nbsp;<span class="ident" id="5372340">DialHTTP</span><span class="op" id="5372348">(</span><span class="ident" id="5372349">network</span><span class="op" id="5372356">,</span>&nbsp;<span class="ident" id="5372358">address</span>&nbsp;<span class="builtintype" id="5372366">string</span><span class="op" id="5372372">)</span>&nbsp;<span class="op" id="5372374">(</span><span class="op" id="5372375">*</span><span class="ident" id="5372376">Client</span><span class="op" id="5372382">,</span>&nbsp;<span class="builtintype" id="5372384">error</span><span class="op" id="5372389">)</span>&nbsp;<span class="op" id="5372391">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372394">return</span>&nbsp;<span class="ident" id="5372401">DialHTTPPath</span><span class="op" id="5372413">(</span><span class="ident" id="5372414">network</span><span class="op" id="5372421">,</span>&nbsp;<span class="ident" id="5372423">address</span><span class="op" id="5372430">,</span>&nbsp;<span class="ident" id="5372432">DefaultRPCPath</span><span class="op" id="5372446">)</span><br>
<span class="lineno"></span><span class="op" id="5372448">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="comment" id="5372451">//&nbsp;DialHTTPPath&nbsp;connects&nbsp;to&nbsp;an&nbsp;HTTP&nbsp;RPC&nbsp;server</span><br>
<span class="lineno"></span><span class="comment" id="5372498">//&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address&nbsp;and&nbsp;path.</span><br>
<span class="lineno"></span><span class="keyword" id="5372544">func</span>&nbsp;<span class="ident" id="5372549">DialHTTPPath</span><span class="op" id="5372561">(</span><span class="ident" id="5372562">network</span><span class="op" id="5372569">,</span>&nbsp;<span class="ident" id="5372571">address</span><span class="op" id="5372578">,</span>&nbsp;<span class="ident" id="5372580">path</span>&nbsp;<span class="builtintype" id="5372585">string</span><span class="op" id="5372591">)</span>&nbsp;<span class="op" id="5372593">(</span><span class="op" id="5372594">*</span><span class="ident" id="5372595">Client</span><span class="op" id="5372601">,</span>&nbsp;<span class="builtintype" id="5372603">error</span><span class="op" id="5372608">)</span>&nbsp;<span class="op" id="5372610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372613">var</span>&nbsp;<span class="ident" id="5372617">err</span>&nbsp;<span class="builtintype" id="5372621">error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5372628">conn</span><span class="op" id="5372632">,</span>&nbsp;<span class="ident" id="5372634">err</span>&nbsp;<span class="op" id="5372638">:=</span>&nbsp;<span class="ident" id="5372641">net</span><span class="op" id="5372644">.</span><span class="ident" id="5372645">Dial</span><span class="op" id="5372649">(</span><span class="ident" id="5372650">network</span><span class="op" id="5372657">,</span>&nbsp;<span class="ident" id="5372659">address</span><span class="op" id="5372666">)</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372669">if</span>&nbsp;<span class="ident" id="5372672">err</span>&nbsp;<span class="op" id="5372676">!=</span>&nbsp;<span class="ident" id="5372679">nil</span>&nbsp;<span class="op" id="5372683">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372687">return</span>&nbsp;<span class="ident" id="5372694">nil</span><span class="op" id="5372697">,</span>&nbsp;<span class="ident" id="5372699">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5372704">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5372707">io</span><span class="op" id="5372709">.</span><span class="ident" id="5372710">WriteString</span><span class="op" id="5372721">(</span><span class="ident" id="5372722">conn</span><span class="op" id="5372726">,</span>&nbsp;<span class="string" id="5372728">&#34;CONNECT&nbsp;&#34;</span><span class="op" id="5372738">+</span><span class="ident" id="5372739">path</span><span class="op" id="5372743">+</span><span class="string" id="5372744">&#34;&nbsp;HTTP/1.0\n\n&#34;</span><span class="op" id="5372759">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5372763">//&nbsp;Require&nbsp;successful&nbsp;HTTP&nbsp;response</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5372800">//&nbsp;before&nbsp;switching&nbsp;to&nbsp;RPC&nbsp;protocol.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5372838">resp</span><span class="op" id="5372842">,</span>&nbsp;<span class="ident" id="5372844">err</span>&nbsp;<span class="op" id="5372848">:=</span>&nbsp;<span class="ident" id="5372851">http</span><span class="op" id="5372855">.</span><span class="ident" id="5372856">ReadResponse</span><span class="op" id="5372868">(</span><span class="ident" id="5372869">bufio</span><span class="op" id="5372874">.</span><span class="ident" id="5372875">NewReader</span><span class="op" id="5372884">(</span><span class="ident" id="5372885">conn</span><span class="op" id="5372889">)</span><span class="op" id="5372890">,</span>&nbsp;<span class="op" id="5372892">&amp;</span><span class="ident" id="5372893">http</span><span class="op" id="5372897">.</span><span class="ident" id="5372898">Request</span><span class="op" id="5372905">{</span><span class="ident" id="5372906">Method</span><span class="op" id="5372912">:</span>&nbsp;<span class="string" id="5372914">&#34;CONNECT&#34;</span><span class="op" id="5372923">}</span><span class="op" id="5372924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372927">if</span>&nbsp;<span class="ident" id="5372930">err</span>&nbsp;<span class="op" id="5372934">==</span>&nbsp;<span class="ident" id="5372937">nil</span>&nbsp;<span class="op" id="5372941">&amp;&amp;</span>&nbsp;<span class="ident" id="5372944">resp</span><span class="op" id="5372948">.</span><span class="ident" id="5372949">Status</span>&nbsp;<span class="op" id="5372956">==</span>&nbsp;<span class="ident" id="5372959">connected</span>&nbsp;<span class="op" id="5372969">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5372973">return</span>&nbsp;<span class="ident" id="5372980">NewClient</span><span class="op" id="5372989">(</span><span class="ident" id="5372990">conn</span><span class="op" id="5372994">)</span><span class="op" id="5372995">,</span>&nbsp;<span class="ident" id="5372997">nil</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5373002">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373005">if</span>&nbsp;<span class="ident" id="5373008">err</span>&nbsp;<span class="op" id="5373012">==</span>&nbsp;<span class="ident" id="5373015">nil</span>&nbsp;<span class="op" id="5373019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373023">err</span>&nbsp;<span class="op" id="5373027">=</span>&nbsp;<span class="ident" id="5373029">errors</span><span class="op" id="5373035">.</span><span class="ident" id="5373036">New</span><span class="op" id="5373039">(</span><span class="string" id="5373040">&#34;unexpected&nbsp;HTTP&nbsp;response:&nbsp;&#34;</span>&nbsp;<span class="op" id="5373069">+</span>&nbsp;<span class="ident" id="5373071">resp</span><span class="op" id="5373075">.</span><span class="ident" id="5373076">Status</span><span class="op" id="5373082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5373085">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373088">conn</span><span class="op" id="5373092">.</span><span class="ident" id="5373093">Close</span><span class="op" id="5373098">(</span><span class="op" id="5373099">)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373102">return</span>&nbsp;<span class="ident" id="5373109">nil</span><span class="op" id="5373112">,</span>&nbsp;<span class="op" id="5373114">&amp;</span><span class="ident" id="5373115">net</span><span class="op" id="5373118">.</span><span class="ident" id="5373119">OpError</span><span class="op" id="5373126">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373130">Op</span><span class="op" id="5373132">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="5373136">&#34;dial-http&#34;</span><span class="op" id="5373147">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373151">Net</span><span class="op" id="5373154">:</span>&nbsp;&nbsp;<span class="ident" id="5373157">network</span>&nbsp;<span class="op" id="5373165">+</span>&nbsp;<span class="string" id="5373167">&#34;&nbsp;&#34;</span>&nbsp;<span class="op" id="5373171">+</span>&nbsp;<span class="ident" id="5373173">address</span><span class="op" id="5373180">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373184">Addr</span><span class="op" id="5373188">:</span>&nbsp;<span class="ident" id="5373190">nil</span><span class="op" id="5373193">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373197">Err</span><span class="op" id="5373200">:</span>&nbsp;&nbsp;<span class="ident" id="5373203">err</span><span class="op" id="5373206">,</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5373209">}</span><br>
<span class="lineno"></span><span class="op" id="5373211">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5373214">//&nbsp;Dial&nbsp;connects&nbsp;to&nbsp;an&nbsp;RPC&nbsp;server&nbsp;at&nbsp;the&nbsp;specified&nbsp;network&nbsp;address.</span><br>
<span class="lineno"></span><span class="keyword" id="5373282">func</span>&nbsp;<span class="ident" id="5373287">Dial</span><span class="op" id="5373291">(</span><span class="ident" id="5373292">network</span><span class="op" id="5373299">,</span>&nbsp;<span class="ident" id="5373301">address</span>&nbsp;<span class="builtintype" id="5373309">string</span><span class="op" id="5373315">)</span>&nbsp;<span class="op" id="5373317">(</span><span class="op" id="5373318">*</span><span class="ident" id="5373319">Client</span><span class="op" id="5373325">,</span>&nbsp;<span class="builtintype" id="5373327">error</span><span class="op" id="5373332">)</span>&nbsp;<span class="op" id="5373334">{</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373337">conn</span><span class="op" id="5373341">,</span>&nbsp;<span class="ident" id="5373343">err</span>&nbsp;<span class="op" id="5373347">:=</span>&nbsp;<span class="ident" id="5373350">net</span><span class="op" id="5373353">.</span><span class="ident" id="5373354">Dial</span><span class="op" id="5373358">(</span><span class="ident" id="5373359">network</span><span class="op" id="5373366">,</span>&nbsp;<span class="ident" id="5373368">address</span><span class="op" id="5373375">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373378">if</span>&nbsp;<span class="ident" id="5373381">err</span>&nbsp;<span class="op" id="5373385">!=</span>&nbsp;<span class="ident" id="5373388">nil</span>&nbsp;<span class="op" id="5373392">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373396">return</span>&nbsp;<span class="ident" id="5373403">nil</span><span class="op" id="5373406">,</span>&nbsp;<span class="ident" id="5373408">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5373413">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373416">return</span>&nbsp;<span class="ident" id="5373423">NewClient</span><span class="op" id="5373432">(</span><span class="ident" id="5373433">conn</span><span class="op" id="5373437">)</span><span class="op" id="5373438">,</span>&nbsp;<span class="ident" id="5373440">nil</span><br>
<span class="lineno">275</span><span class="op" id="5373444">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5373447">func</span>&nbsp;<span class="op" id="5373452">(</span><span class="ident" id="5373453">client</span>&nbsp;<span class="op" id="5373460">*</span><span class="ident" id="5373461">Client</span><span class="op" id="5373467">)</span>&nbsp;<span class="ident" id="5373469">Close</span><span class="op" id="5373474">(</span><span class="op" id="5373475">)</span>&nbsp;<span class="builtintype" id="5373477">error</span>&nbsp;<span class="op" id="5373483">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373486">client</span><span class="op" id="5373492">.</span><span class="ident" id="5373493">mutex</span><span class="op" id="5373498">.</span><span class="ident" id="5373499">Lock</span><span class="op" id="5373503">(</span><span class="op" id="5373504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373507">if</span>&nbsp;<span class="ident" id="5373510">client</span><span class="op" id="5373516">.</span><span class="ident" id="5373517">closing</span>&nbsp;<span class="op" id="5373525">{</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373529">client</span><span class="op" id="5373535">.</span><span class="ident" id="5373536">mutex</span><span class="op" id="5373541">.</span><span class="ident" id="5373542">Unlock</span><span class="op" id="5373548">(</span><span class="op" id="5373549">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373553">return</span>&nbsp;<span class="ident" id="5373560">ErrShutdown</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5373573">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373576">client</span><span class="op" id="5373582">.</span><span class="ident" id="5373583">closing</span>&nbsp;<span class="op" id="5373591">=</span>&nbsp;<span class="builtintype" id="5373593">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5373599">client</span><span class="op" id="5373605">.</span><span class="ident" id="5373606">mutex</span><span class="op" id="5373611">.</span><span class="ident" id="5373612">Unlock</span><span class="op" id="5373618">(</span><span class="op" id="5373619">)</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5373622">return</span>&nbsp;<span class="ident" id="5373629">client</span><span class="op" id="5373635">.</span><span class="ident" id="5373636">codec</span><span class="op" id="5373641">.</span><span class="ident" id="5373642">Close</span><span class="op" id="5373647">(</span><span class="op" id="5373648">)</span><br>
<span class="lineno"></span><span class="op" id="5373650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5373653">//&nbsp;Go&nbsp;invokes&nbsp;the&nbsp;function&nbsp;asynchronously.&nbsp;&nbsp;It&nbsp;returns&nbsp;the&nbsp;Call&nbsp;structure&nbsp;representing</span><br>
<span class="lineno"></span><span class="comment" id="5373740">//&nbsp;the&nbsp;invocation.&nbsp;&nbsp;The&nbsp;done&nbsp;channel&nbsp;will&nbsp;signal&nbsp;when&nbsp;the&nbsp;call&nbsp;is&nbsp;complete&nbsp;by&nbsp;returning</span><br>
<span class="lineno">290</span><span class="comment" id="5373828">//&nbsp;the&nbsp;same&nbsp;Call&nbsp;object.&nbsp;&nbsp;If&nbsp;done&nbsp;is&nbsp;nil,&nbsp;Go&nbsp;will&nbsp;allocate&nbsp;a&nbsp;new&nbsp;channel.</span><br>
<span class="lineno"></span><span class="comment" id="5373902">//&nbsp;If&nbsp;non-nil,&nbsp;done&nbsp;must&nbsp;be&nbsp;buffered&nbsp;or&nbsp;Go&nbsp;will&nbsp;deliberately&nbsp;crash.</span><br>
<span class="lineno"></span><span class="keyword" id="5373970">func</span>&nbsp;<span class="op" id="5373975">(</span><span class="ident" id="5373976">client</span>&nbsp;<span class="op" id="5373983">*</span><span class="ident" id="5373984">Client</span><span class="op" id="5373990">)</span>&nbsp;<span class="ident" id="5373992">Go</span><span class="op" id="5373994">(</span><span class="ident" id="5373995">serviceMethod</span>&nbsp;<span class="builtintype" id="5374009">string</span><span class="op" id="5374015">,</span>&nbsp;<span class="ident" id="5374017">args</span>&nbsp;<span class="keyword" id="5374022">interface</span><span class="op" id="5374031">{</span><span class="op" id="5374032">}</span><span class="op" id="5374033">,</span>&nbsp;<span class="ident" id="5374035">reply</span>&nbsp;<span class="keyword" id="5374041">interface</span><span class="op" id="5374050">{</span><span class="op" id="5374051">}</span><span class="op" id="5374052">,</span>&nbsp;<span class="ident" id="5374054">done</span>&nbsp;<span class="keyword" id="5374059">chan</span>&nbsp;<span class="op" id="5374064">*</span><span class="ident" id="5374065">Call</span><span class="op" id="5374069">)</span>&nbsp;<span class="op" id="5374071">*</span><span class="ident" id="5374072">Call</span>&nbsp;<span class="op" id="5374077">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374080">call</span>&nbsp;<span class="op" id="5374085">:=</span>&nbsp;<span class="builtinfunc" id="5374088">new</span><span class="op" id="5374091">(</span><span class="ident" id="5374092">Call</span><span class="op" id="5374096">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374099">call</span><span class="op" id="5374103">.</span><span class="ident" id="5374104">ServiceMethod</span>&nbsp;<span class="op" id="5374118">=</span>&nbsp;<span class="ident" id="5374120">serviceMethod</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374135">call</span><span class="op" id="5374139">.</span><span class="ident" id="5374140">Args</span>&nbsp;<span class="op" id="5374145">=</span>&nbsp;<span class="ident" id="5374147">args</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374153">call</span><span class="op" id="5374157">.</span><span class="ident" id="5374158">Reply</span>&nbsp;<span class="op" id="5374164">=</span>&nbsp;<span class="ident" id="5374166">reply</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5374173">if</span>&nbsp;<span class="ident" id="5374176">done</span>&nbsp;<span class="op" id="5374181">==</span>&nbsp;<span class="ident" id="5374184">nil</span>&nbsp;<span class="op" id="5374188">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374192">done</span>&nbsp;<span class="op" id="5374197">=</span>&nbsp;<span class="builtinfunc" id="5374199">make</span><span class="op" id="5374203">(</span><span class="keyword" id="5374204">chan</span>&nbsp;<span class="op" id="5374209">*</span><span class="ident" id="5374210">Call</span><span class="op" id="5374214">,</span>&nbsp;<span class="num" id="5374216">10</span><span class="op" id="5374218">)</span>&nbsp;<span class="comment" id="5374220">//&nbsp;buffered.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5374234">}</span>&nbsp;<span class="keyword" id="5374236">else</span>&nbsp;<span class="op" id="5374241">{</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5374245">//&nbsp;If&nbsp;caller&nbsp;passes&nbsp;done&nbsp;!=&nbsp;nil,&nbsp;it&nbsp;must&nbsp;arrange&nbsp;that</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5374301">//&nbsp;done&nbsp;has&nbsp;enough&nbsp;buffer&nbsp;for&nbsp;the&nbsp;number&nbsp;of&nbsp;simultaneous</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5374360">//&nbsp;RPCs&nbsp;that&nbsp;will&nbsp;be&nbsp;using&nbsp;that&nbsp;channel.&nbsp;&nbsp;If&nbsp;the&nbsp;channel</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5374419">//&nbsp;is&nbsp;totally&nbsp;unbuffered,&nbsp;it&#39;s&nbsp;best&nbsp;not&nbsp;to&nbsp;run&nbsp;at&nbsp;all.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5374476">if</span>&nbsp;<span class="builtinfunc" id="5374479">cap</span><span class="op" id="5374482">(</span><span class="ident" id="5374483">done</span><span class="op" id="5374487">)</span>&nbsp;<span class="op" id="5374489">==</span>&nbsp;<span class="num" id="5374492">0</span>&nbsp;<span class="op" id="5374494">{</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374499">log</span><span class="op" id="5374502">.</span><span class="ident" id="5374503">Panic</span><span class="op" id="5374508">(</span><span class="string" id="5374509">&#34;rpc:&nbsp;done&nbsp;channel&nbsp;is&nbsp;unbuffered&#34;</span><span class="op" id="5374542">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5374546">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5374549">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374552">call</span><span class="op" id="5374556">.</span><span class="ident" id="5374557">Done</span>&nbsp;<span class="op" id="5374562">=</span>&nbsp;<span class="ident" id="5374564">done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374570">client</span><span class="op" id="5374576">.</span><span class="ident" id="5374577">send</span><span class="op" id="5374581">(</span><span class="ident" id="5374582">call</span><span class="op" id="5374586">)</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5374589">return</span>&nbsp;<span class="ident" id="5374596">call</span><br>
<span class="lineno"></span><span class="op" id="5374601">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5374604">//&nbsp;Call&nbsp;invokes&nbsp;the&nbsp;named&nbsp;function,&nbsp;waits&nbsp;for&nbsp;it&nbsp;to&nbsp;complete,&nbsp;and&nbsp;returns&nbsp;its&nbsp;error&nbsp;status.</span><br>
<span class="lineno"></span><span class="keyword" id="5374696">func</span>&nbsp;<span class="op" id="5374701">(</span><span class="ident" id="5374702">client</span>&nbsp;<span class="op" id="5374709">*</span><span class="ident" id="5374710">Client</span><span class="op" id="5374716">)</span>&nbsp;<span class="ident" id="5374718">Call</span><span class="op" id="5374722">(</span><span class="ident" id="5374723">serviceMethod</span>&nbsp;<span class="builtintype" id="5374737">string</span><span class="op" id="5374743">,</span>&nbsp;<span class="ident" id="5374745">args</span>&nbsp;<span class="keyword" id="5374750">interface</span><span class="op" id="5374759">{</span><span class="op" id="5374760">}</span><span class="op" id="5374761">,</span>&nbsp;<span class="ident" id="5374763">reply</span>&nbsp;<span class="keyword" id="5374769">interface</span><span class="op" id="5374778">{</span><span class="op" id="5374779">}</span><span class="op" id="5374780">)</span>&nbsp;<span class="builtintype" id="5374782">error</span>&nbsp;<span class="op" id="5374788">{</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5374791">call</span>&nbsp;<span class="op" id="5374796">:=</span>&nbsp;<span class="op" id="5374799">&lt;-</span><span class="ident" id="5374801">client</span><span class="op" id="5374807">.</span><span class="ident" id="5374808">Go</span><span class="op" id="5374810">(</span><span class="ident" id="5374811">serviceMethod</span><span class="op" id="5374824">,</span>&nbsp;<span class="ident" id="5374826">args</span><span class="op" id="5374830">,</span>&nbsp;<span class="ident" id="5374832">reply</span><span class="op" id="5374837">,</span>&nbsp;<span class="builtinfunc" id="5374839">make</span><span class="op" id="5374843">(</span><span class="keyword" id="5374844">chan</span>&nbsp;<span class="op" id="5374849">*</span><span class="ident" id="5374850">Call</span><span class="op" id="5374854">,</span>&nbsp;<span class="num" id="5374856">1</span><span class="op" id="5374857">)</span><span class="op" id="5374858">)</span><span class="op" id="5374859">.</span><span class="ident" id="5374860">Done</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5374866">return</span>&nbsp;<span class="ident" id="5374873">call</span><span class="op" id="5374877">.</span><span class="ident" id="5374878">Error</span><br>
<span class="lineno"></span><span class="op" id="5374884">}</span>
</div>
</body>
</html>
