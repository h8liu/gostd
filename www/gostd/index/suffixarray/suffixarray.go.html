<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="code">
<span class="lineno">1</span><span class="comment" id="5851495">//&nbsp;Copyright&nbsp;2010&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5851550">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5851604">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="comment" id="5851655">//&nbsp;Package&nbsp;suffixarray&nbsp;implements&nbsp;substring&nbsp;search&nbsp;in&nbsp;logarithmic&nbsp;time&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="5851732">//&nbsp;an&nbsp;in-memory&nbsp;suffix&nbsp;array.</span><br>
<span class="lineno"></span><span class="comment" id="5851762">//</span><br>
<span class="lineno"></span><span class="comment" id="5851765">//&nbsp;Example&nbsp;use:</span><br>
<span class="lineno"></span><span class="comment" id="5851781">//</span><br>
<span class="lineno">10</span><span class="comment" id="5851784">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;create&nbsp;index&nbsp;for&nbsp;some&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5851817">//&nbsp;&nbsp;&nbsp;&nbspindex&nbsp;:=&nbsp;suffixarray.New(data)</span><br>
<span class="lineno"></span><span class="comment" id="5851851">//</span><br>
<span class="lineno"></span><span class="comment" id="5851854">//&nbsp;&nbsp;&nbsp;&nbsp//&nbsp;lookup&nbsp;byte&nbsp;slice&nbsp;s</span><br>
<span class="lineno"></span><span class="comment" id="5851880">//&nbsp;&nbsp;&nbsp;&nbspoffsets1&nbsp;:=&nbsp;index.Lookup(s,&nbsp;-1)&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;all&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno">15</span><span class="comment" id="5851965">//&nbsp;&nbsp;&nbsp;&nbspoffsets2&nbsp;:=&nbsp;index.Lookup(s,&nbsp;3)&nbsp;&nbsp;//&nbsp;the&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;3&nbsp;indices&nbsp;where&nbsp;s&nbsp;occurs&nbsp;in&nbsp;data</span><br>
<span class="lineno"></span><span class="comment" id="5852056">//</span><br>
<span class="lineno"></span><span class="keyword" id="5852059">package</span>&nbsp;<span class="ident" id="5852067">suffixarray</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5852080">import</span>&nbsp;<span class="op" id="5852087">(</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852090">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852099">&#34;encoding/binary&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852118">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852124">&#34;regexp&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5852134">&#34;sort&#34;</span><br>
<span class="lineno">25</span><span class="op" id="5852141">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852144">//&nbsp;Index&nbsp;implements&nbsp;a&nbsp;suffix&nbsp;array&nbsp;for&nbsp;fast&nbsp;substring&nbsp;search.</span><br>
<span class="lineno"></span><span class="keyword" id="5852206">type</span>&nbsp;<span class="ident" id="5852211">Index</span>&nbsp;<span class="keyword" id="5852217">struct</span>&nbsp;<span class="op" id="5852224">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852227">data</span>&nbsp;<span class="op" id="5852232">[</span><span class="op" id="5852233">]</span><span class="builtintype" id="5852234">byte</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852240">sa</span>&nbsp;&nbsp;&nbsp;<span class="op" id="5852245">[</span><span class="op" id="5852246">]</span><span class="builtintype" id="5852247">int</span>&nbsp;<span class="comment" id="5852251">//&nbsp;suffix&nbsp;array&nbsp;for&nbsp;data;&nbsp;len(sa)&nbsp;==&nbsp;len(data)</span><br>
<span class="lineno"></span><span class="op" id="5852298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852301">//&nbsp;New&nbsp;creates&nbsp;a&nbsp;new&nbsp;Index&nbsp;for&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5852338">//&nbsp;Index&nbsp;creation&nbsp;time&nbsp;is&nbsp;O(N*log(N))&nbsp;for&nbsp;N&nbsp;=&nbsp;len(data).</span><br>
<span class="lineno">35</span><span class="keyword" id="5852395">func</span>&nbsp;<span class="ident" id="5852400">New</span><span class="op" id="5852403">(</span><span class="ident" id="5852404">data</span>&nbsp;<span class="op" id="5852409">[</span><span class="op" id="5852410">]</span><span class="builtintype" id="5852411">byte</span><span class="op" id="5852415">)</span>&nbsp;<span class="op" id="5852417">*</span><span class="ident" id="5852418">Index</span>&nbsp;<span class="op" id="5852424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852427">return</span>&nbsp;<span class="op" id="5852434">&amp;</span><span class="ident" id="5852435">Index</span><span class="op" id="5852440">{</span><span class="ident" id="5852441">data</span><span class="op" id="5852445">,</span>&nbsp;<span class="ident" id="5852447">qsufsort</span><span class="op" id="5852455">(</span><span class="ident" id="5852456">data</span><span class="op" id="5852460">)</span><span class="op" id="5852461">}</span><br>
<span class="lineno"></span><span class="op" id="5852463">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852466">//&nbsp;writeInt&nbsp;writes&nbsp;an&nbsp;int&nbsp;x&nbsp;to&nbsp;w&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">40</span><span class="keyword" id="5852530">func</span>&nbsp;<span class="ident" id="5852535">writeInt</span><span class="op" id="5852543">(</span><span class="ident" id="5852544">w</span>&nbsp;<span class="ident" id="5852546">io</span><span class="op" id="5852548">.</span><span class="ident" id="5852549">Writer</span><span class="op" id="5852555">,</span>&nbsp;<span class="ident" id="5852557">buf</span>&nbsp;<span class="op" id="5852561">[</span><span class="op" id="5852562">]</span><span class="builtintype" id="5852563">byte</span><span class="op" id="5852567">,</span>&nbsp;<span class="ident" id="5852569">x</span>&nbsp;<span class="builtintype" id="5852571">int</span><span class="op" id="5852574">)</span>&nbsp;<span class="builtintype" id="5852576">error</span>&nbsp;<span class="op" id="5852582">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852585">binary</span><span class="op" id="5852591">.</span><span class="ident" id="5852592">PutVarint</span><span class="op" id="5852601">(</span><span class="ident" id="5852602">buf</span><span class="op" id="5852605">,</span>&nbsp;<span class="ident" id="5852607">int64</span><span class="op" id="5852612">(</span><span class="ident" id="5852613">x</span><span class="op" id="5852614">)</span><span class="op" id="5852615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852618">_</span><span class="op" id="5852619">,</span>&nbsp;<span class="ident" id="5852621">err</span>&nbsp;<span class="op" id="5852625">:=</span>&nbsp;<span class="ident" id="5852628">w</span><span class="op" id="5852629">.</span><span class="ident" id="5852630">Write</span><span class="op" id="5852635">(</span><span class="ident" id="5852636">buf</span><span class="op" id="5852639">[</span><span class="num" id="5852640">0</span><span class="op" id="5852641">:</span><span class="ident" id="5852642">binary</span><span class="op" id="5852648">.</span><span class="ident" id="5852649">MaxVarintLen64</span><span class="op" id="5852663">]</span><span class="op" id="5852664">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852667">return</span>&nbsp;<span class="ident" id="5852674">err</span><br>
<span class="lineno"></span><span class="op" id="5852678">}</span><br>
<span class="lineno">45</span><br>
<span class="lineno"></span><span class="comment" id="5852681">//&nbsp;readInt&nbsp;reads&nbsp;an&nbsp;int&nbsp;x&nbsp;from&nbsp;r&nbsp;using&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read&nbsp;and&nbsp;returns&nbsp;x.</span><br>
<span class="lineno"></span><span class="keyword" id="5852758">func</span>&nbsp;<span class="ident" id="5852763">readInt</span><span class="op" id="5852770">(</span><span class="ident" id="5852771">r</span>&nbsp;<span class="ident" id="5852773">io</span><span class="op" id="5852775">.</span><span class="ident" id="5852776">Reader</span><span class="op" id="5852782">,</span>&nbsp;<span class="ident" id="5852784">buf</span>&nbsp;<span class="op" id="5852788">[</span><span class="op" id="5852789">]</span><span class="builtintype" id="5852790">byte</span><span class="op" id="5852794">)</span>&nbsp;<span class="op" id="5852796">(</span><span class="builtintype" id="5852797">int</span><span class="op" id="5852800">,</span>&nbsp;<span class="builtintype" id="5852802">error</span><span class="op" id="5852807">)</span>&nbsp;<span class="op" id="5852809">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852812">_</span><span class="op" id="5852813">,</span>&nbsp;<span class="ident" id="5852815">err</span>&nbsp;<span class="op" id="5852819">:=</span>&nbsp;<span class="ident" id="5852822">io</span><span class="op" id="5852824">.</span><span class="ident" id="5852825">ReadFull</span><span class="op" id="5852833">(</span><span class="ident" id="5852834">r</span><span class="op" id="5852835">,</span>&nbsp;<span class="ident" id="5852837">buf</span><span class="op" id="5852840">[</span><span class="num" id="5852841">0</span><span class="op" id="5852842">:</span><span class="ident" id="5852843">binary</span><span class="op" id="5852849">.</span><span class="ident" id="5852850">MaxVarintLen64</span><span class="op" id="5852864">]</span><span class="op" id="5852865">)</span>&nbsp;<span class="comment" id="5852867">//&nbsp;ok&nbsp;to&nbsp;continue&nbsp;with&nbsp;error</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5852897">x</span><span class="op" id="5852898">,</span>&nbsp;<span class="ident" id="5852900">_</span>&nbsp;<span class="op" id="5852902">:=</span>&nbsp;<span class="ident" id="5852905">binary</span><span class="op" id="5852911">.</span><span class="ident" id="5852912">Varint</span><span class="op" id="5852918">(</span><span class="ident" id="5852919">buf</span><span class="op" id="5852922">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5852925">return</span>&nbsp;<span class="builtintype" id="5852932">int</span><span class="op" id="5852935">(</span><span class="ident" id="5852936">x</span><span class="op" id="5852937">)</span><span class="op" id="5852938">,</span>&nbsp;<span class="ident" id="5852940">err</span><br>
<span class="lineno"></span><span class="op" id="5852944">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5852947">//&nbsp;writeSlice&nbsp;writes&nbsp;data[:n]&nbsp;to&nbsp;w&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5852997">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;write.</span><br>
<span class="lineno">55</span><span class="keyword" id="5853033">func</span>&nbsp;<span class="ident" id="5853038">writeSlice</span><span class="op" id="5853048">(</span><span class="ident" id="5853049">w</span>&nbsp;<span class="ident" id="5853051">io</span><span class="op" id="5853053">.</span><span class="ident" id="5853054">Writer</span><span class="op" id="5853060">,</span>&nbsp;<span class="ident" id="5853062">buf</span>&nbsp;<span class="op" id="5853066">[</span><span class="op" id="5853067">]</span><span class="builtintype" id="5853068">byte</span><span class="op" id="5853072">,</span>&nbsp;<span class="ident" id="5853074">data</span>&nbsp;<span class="op" id="5853079">[</span><span class="op" id="5853080">]</span><span class="builtintype" id="5853081">int</span><span class="op" id="5853084">)</span>&nbsp;<span class="op" id="5853086">(</span><span class="ident" id="5853087">n</span>&nbsp;<span class="builtintype" id="5853089">int</span><span class="op" id="5853092">,</span>&nbsp;<span class="ident" id="5853094">err</span>&nbsp;<span class="builtintype" id="5853098">error</span><span class="op" id="5853103">)</span>&nbsp;<span class="op" id="5853105">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853108">//&nbsp;encode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;fit&nbsp;into&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853152">p</span>&nbsp;<span class="op" id="5853154">:=</span>&nbsp;<span class="ident" id="5853157">binary</span><span class="op" id="5853163">.</span><span class="ident" id="5853164">MaxVarintLen64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853180">for</span>&nbsp;<span class="op" id="5853184">;</span>&nbsp;<span class="ident" id="5853186">n</span>&nbsp;<span class="op" id="5853188">&lt;</span>&nbsp;<span class="builtinfunc" id="5853190">len</span><span class="op" id="5853193">(</span><span class="ident" id="5853194">data</span><span class="op" id="5853198">)</span>&nbsp;<span class="op" id="5853200">&amp;&amp;</span>&nbsp;<span class="ident" id="5853203">p</span><span class="op" id="5853204">+</span><span class="ident" id="5853205">binary</span><span class="op" id="5853211">.</span><span class="ident" id="5853212">MaxVarintLen64</span>&nbsp;<span class="op" id="5853227">&lt;=</span>&nbsp;<span class="builtinfunc" id="5853230">len</span><span class="op" id="5853233">(</span><span class="ident" id="5853234">buf</span><span class="op" id="5853237">)</span><span class="op" id="5853238">;</span>&nbsp;<span class="ident" id="5853240">n</span><span class="op" id="5853241">++</span>&nbsp;<span class="op" id="5853244">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853248">p</span>&nbsp;<span class="op" id="5853250">+=</span>&nbsp;<span class="ident" id="5853253">binary</span><span class="op" id="5853259">.</span><span class="ident" id="5853260">PutUvarint</span><span class="op" id="5853270">(</span><span class="ident" id="5853271">buf</span><span class="op" id="5853274">[</span><span class="ident" id="5853275">p</span><span class="op" id="5853276">:</span><span class="op" id="5853277">]</span><span class="op" id="5853278">,</span>&nbsp;<span class="ident" id="5853280">uint64</span><span class="op" id="5853286">(</span><span class="ident" id="5853287">data</span><span class="op" id="5853291">[</span><span class="ident" id="5853292">n</span><span class="op" id="5853293">]</span><span class="op" id="5853294">)</span><span class="op" id="5853295">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853298">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853302">//&nbsp;update&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853325">binary</span><span class="op" id="5853331">.</span><span class="ident" id="5853332">PutVarint</span><span class="op" id="5853341">(</span><span class="ident" id="5853342">buf</span><span class="op" id="5853345">,</span>&nbsp;<span class="ident" id="5853347">int64</span><span class="op" id="5853352">(</span><span class="ident" id="5853353">p</span><span class="op" id="5853354">)</span><span class="op" id="5853355">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853359">//&nbsp;write&nbsp;buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853376">_</span><span class="op" id="5853377">,</span>&nbsp;<span class="ident" id="5853379">err</span>&nbsp;<span class="op" id="5853383">=</span>&nbsp;<span class="ident" id="5853385">w</span><span class="op" id="5853386">.</span><span class="ident" id="5853387">Write</span><span class="op" id="5853392">(</span><span class="ident" id="5853393">buf</span><span class="op" id="5853396">[</span><span class="num" id="5853397">0</span><span class="op" id="5853398">:</span><span class="ident" id="5853399">p</span><span class="op" id="5853400">]</span><span class="op" id="5853401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853404">return</span><br>
<span class="lineno"></span><span class="op" id="5853411">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">70</span><span class="comment" id="5853414">//&nbsp;readSlice&nbsp;reads&nbsp;data[:n]&nbsp;from&nbsp;r&nbsp;and&nbsp;returns&nbsp;n.</span><br>
<span class="lineno"></span><span class="comment" id="5853464">//&nbsp;It&nbsp;uses&nbsp;buf&nbsp;to&nbsp;buffer&nbsp;the&nbsp;read.</span><br>
<span class="lineno"></span><span class="keyword" id="5853499">func</span>&nbsp;<span class="ident" id="5853504">readSlice</span><span class="op" id="5853513">(</span><span class="ident" id="5853514">r</span>&nbsp;<span class="ident" id="5853516">io</span><span class="op" id="5853518">.</span><span class="ident" id="5853519">Reader</span><span class="op" id="5853525">,</span>&nbsp;<span class="ident" id="5853527">buf</span>&nbsp;<span class="op" id="5853531">[</span><span class="op" id="5853532">]</span><span class="builtintype" id="5853533">byte</span><span class="op" id="5853537">,</span>&nbsp;<span class="ident" id="5853539">data</span>&nbsp;<span class="op" id="5853544">[</span><span class="op" id="5853545">]</span><span class="builtintype" id="5853546">int</span><span class="op" id="5853549">)</span>&nbsp;<span class="op" id="5853551">(</span><span class="ident" id="5853552">n</span>&nbsp;<span class="builtintype" id="5853554">int</span><span class="op" id="5853557">,</span>&nbsp;<span class="ident" id="5853559">err</span>&nbsp;<span class="builtintype" id="5853563">error</span><span class="op" id="5853568">)</span>&nbsp;<span class="op" id="5853570">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853573">//&nbsp;read&nbsp;buffer&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853594">var</span>&nbsp;<span class="ident" id="5853598">size</span>&nbsp;<span class="builtintype" id="5853603">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853608">size</span><span class="op" id="5853612">,</span>&nbsp;<span class="ident" id="5853614">err</span>&nbsp;<span class="op" id="5853618">=</span>&nbsp;<span class="ident" id="5853620">readInt</span><span class="op" id="5853627">(</span><span class="ident" id="5853628">r</span><span class="op" id="5853629">,</span>&nbsp;<span class="ident" id="5853631">buf</span><span class="op" id="5853634">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853637">if</span>&nbsp;<span class="ident" id="5853640">err</span>&nbsp;<span class="op" id="5853644">!=</span>&nbsp;<span class="ident" id="5853647">nil</span>&nbsp;<span class="op" id="5853651">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853655">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853663">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">80</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853667">//&nbsp;read&nbsp;buffer&nbsp;w/o&nbsp;the&nbsp;size</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853696">if</span>&nbsp;<span class="ident" id="5853699">_</span><span class="op" id="5853700">,</span>&nbsp;<span class="ident" id="5853702">err</span>&nbsp;<span class="op" id="5853706">=</span>&nbsp;<span class="ident" id="5853708">io</span><span class="op" id="5853710">.</span><span class="ident" id="5853711">ReadFull</span><span class="op" id="5853719">(</span><span class="ident" id="5853720">r</span><span class="op" id="5853721">,</span>&nbsp;<span class="ident" id="5853723">buf</span><span class="op" id="5853726">[</span><span class="ident" id="5853727">binary</span><span class="op" id="5853733">.</span><span class="ident" id="5853734">MaxVarintLen64</span><span class="op" id="5853748">:</span><span class="ident" id="5853749">size</span><span class="op" id="5853753">]</span><span class="op" id="5853754">)</span><span class="op" id="5853755">;</span>&nbsp;<span class="ident" id="5853757">err</span>&nbsp;<span class="op" id="5853761">!=</span>&nbsp;<span class="ident" id="5853764">nil</span>&nbsp;<span class="op" id="5853768">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853772">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853780">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5853784">//&nbsp;decode&nbsp;as&nbsp;many&nbsp;elements&nbsp;as&nbsp;present&nbsp;in&nbsp;buf</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853830">for</span>&nbsp;<span class="ident" id="5853834">p</span>&nbsp;<span class="op" id="5853836">:=</span>&nbsp;<span class="ident" id="5853839">binary</span><span class="op" id="5853845">.</span><span class="ident" id="5853846">MaxVarintLen64</span><span class="op" id="5853860">;</span>&nbsp;<span class="ident" id="5853862">p</span>&nbsp;<span class="op" id="5853864">&lt;</span>&nbsp;<span class="ident" id="5853866">size</span><span class="op" id="5853870">;</span>&nbsp;<span class="ident" id="5853872">n</span><span class="op" id="5853873">++</span>&nbsp;<span class="op" id="5853876">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853880">x</span><span class="op" id="5853881">,</span>&nbsp;<span class="ident" id="5853883">w</span>&nbsp;<span class="op" id="5853885">:=</span>&nbsp;<span class="ident" id="5853888">binary</span><span class="op" id="5853894">.</span><span class="ident" id="5853895">Uvarint</span><span class="op" id="5853902">(</span><span class="ident" id="5853903">buf</span><span class="op" id="5853906">[</span><span class="ident" id="5853907">p</span><span class="op" id="5853908">:</span><span class="op" id="5853909">]</span><span class="op" id="5853910">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853914">data</span><span class="op" id="5853918">[</span><span class="ident" id="5853919">n</span><span class="op" id="5853920">]</span>&nbsp;<span class="op" id="5853922">=</span>&nbsp;<span class="builtintype" id="5853924">int</span><span class="op" id="5853927">(</span><span class="ident" id="5853928">x</span><span class="op" id="5853929">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5853933">p</span>&nbsp;<span class="op" id="5853935">+=</span>&nbsp;<span class="ident" id="5853938">w</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5853941">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5853945">return</span><br>
<span class="lineno"></span><span class="op" id="5853952">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">95</span><span class="keyword" id="5853955">const</span>&nbsp;<span class="ident" id="5853961">bufSize</span>&nbsp;<span class="op" id="5853969">=</span>&nbsp;<span class="num" id="5853971">16</span>&nbsp;<span class="op" id="5853974">&lt;&lt;</span>&nbsp;<span class="num" id="5853977">10</span>&nbsp;<span class="comment" id="5853980">//&nbsp;reasonable&nbsp;for&nbsp;BenchmarkSaveRestore</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5854020">//&nbsp;Read&nbsp;reads&nbsp;the&nbsp;index&nbsp;from&nbsp;r&nbsp;into&nbsp;x;&nbsp;x&nbsp;must&nbsp;not&nbsp;be&nbsp;nil.</span><br>
<span class="lineno"></span><span class="keyword" id="5854078">func</span>&nbsp;<span class="op" id="5854083">(</span><span class="ident" id="5854084">x</span>&nbsp;<span class="op" id="5854086">*</span><span class="ident" id="5854087">Index</span><span class="op" id="5854092">)</span>&nbsp;<span class="ident" id="5854094">Read</span><span class="op" id="5854098">(</span><span class="ident" id="5854099">r</span>&nbsp;<span class="ident" id="5854101">io</span><span class="op" id="5854103">.</span><span class="ident" id="5854104">Reader</span><span class="op" id="5854110">)</span>&nbsp;<span class="builtintype" id="5854112">error</span>&nbsp;<span class="op" id="5854118">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854121">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;reads</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854146">buf</span>&nbsp;<span class="op" id="5854150">:=</span>&nbsp;<span class="builtinfunc" id="5854153">make</span><span class="op" id="5854157">(</span><span class="op" id="5854158">[</span><span class="op" id="5854159">]</span><span class="builtintype" id="5854160">byte</span><span class="op" id="5854164">,</span>&nbsp;<span class="ident" id="5854166">bufSize</span><span class="op" id="5854173">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854177">//&nbsp;read&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854193">n</span><span class="op" id="5854194">,</span>&nbsp;<span class="ident" id="5854196">err</span>&nbsp;<span class="op" id="5854200">:=</span>&nbsp;<span class="ident" id="5854203">readInt</span><span class="op" id="5854210">(</span><span class="ident" id="5854211">r</span><span class="op" id="5854212">,</span>&nbsp;<span class="ident" id="5854214">buf</span><span class="op" id="5854217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854220">if</span>&nbsp;<span class="ident" id="5854223">err</span>&nbsp;<span class="op" id="5854227">!=</span>&nbsp;<span class="ident" id="5854230">nil</span>&nbsp;<span class="op" id="5854234">{</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854238">return</span>&nbsp;<span class="ident" id="5854245">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854250">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854254">//&nbsp;allocate&nbsp;space</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854273">if</span>&nbsp;<span class="num" id="5854276">2</span><span class="op" id="5854277">*</span><span class="ident" id="5854278">n</span>&nbsp;<span class="op" id="5854280">&lt;</span>&nbsp;<span class="builtinfunc" id="5854282">cap</span><span class="op" id="5854285">(</span><span class="ident" id="5854286">x</span><span class="op" id="5854287">.</span><span class="ident" id="5854288">data</span><span class="op" id="5854292">)</span>&nbsp;<span class="op" id="5854294">||</span>&nbsp;<span class="builtinfunc" id="5854297">cap</span><span class="op" id="5854300">(</span><span class="ident" id="5854301">x</span><span class="op" id="5854302">.</span><span class="ident" id="5854303">data</span><span class="op" id="5854307">)</span>&nbsp;<span class="op" id="5854309">&lt;</span>&nbsp;<span class="ident" id="5854311">n</span>&nbsp;<span class="op" id="5854313">{</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854317">//&nbsp;new&nbsp;data&nbsp;is&nbsp;significantly&nbsp;smaller&nbsp;or&nbsp;larger&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854371">//&nbsp;existing&nbsp;buffers&nbsp;-&nbsp;allocate&nbsp;new&nbsp;ones</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854413">x</span><span class="op" id="5854414">.</span><span class="ident" id="5854415">data</span>&nbsp;<span class="op" id="5854420">=</span>&nbsp;<span class="builtinfunc" id="5854422">make</span><span class="op" id="5854426">(</span><span class="op" id="5854427">[</span><span class="op" id="5854428">]</span><span class="builtintype" id="5854429">byte</span><span class="op" id="5854433">,</span>&nbsp;<span class="ident" id="5854435">n</span><span class="op" id="5854436">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854440">x</span><span class="op" id="5854441">.</span><span class="ident" id="5854442">sa</span>&nbsp;<span class="op" id="5854445">=</span>&nbsp;<span class="builtinfunc" id="5854447">make</span><span class="op" id="5854451">(</span><span class="op" id="5854452">[</span><span class="op" id="5854453">]</span><span class="builtintype" id="5854454">int</span><span class="op" id="5854457">,</span>&nbsp;<span class="ident" id="5854459">n</span><span class="op" id="5854460">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854463">}</span>&nbsp;<span class="keyword" id="5854465">else</span>&nbsp;<span class="op" id="5854470">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854474">//&nbsp;re-use&nbsp;existing&nbsp;buffers</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854503">x</span><span class="op" id="5854504">.</span><span class="ident" id="5854505">data</span>&nbsp;<span class="op" id="5854510">=</span>&nbsp;<span class="ident" id="5854512">x</span><span class="op" id="5854513">.</span><span class="ident" id="5854514">data</span><span class="op" id="5854518">[</span><span class="num" id="5854519">0</span><span class="op" id="5854520">:</span><span class="ident" id="5854521">n</span><span class="op" id="5854522">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854526">x</span><span class="op" id="5854527">.</span><span class="ident" id="5854528">sa</span>&nbsp;<span class="op" id="5854531">=</span>&nbsp;<span class="ident" id="5854533">x</span><span class="op" id="5854534">.</span><span class="ident" id="5854535">sa</span><span class="op" id="5854537">[</span><span class="num" id="5854538">0</span><span class="op" id="5854539">:</span><span class="ident" id="5854540">n</span><span class="op" id="5854541">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854544">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854548">//&nbsp;read&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854562">if</span>&nbsp;<span class="ident" id="5854565">_</span><span class="op" id="5854566">,</span>&nbsp;<span class="ident" id="5854568">err</span>&nbsp;<span class="op" id="5854572">:=</span>&nbsp;<span class="ident" id="5854575">io</span><span class="op" id="5854577">.</span><span class="ident" id="5854578">ReadFull</span><span class="op" id="5854586">(</span><span class="ident" id="5854587">r</span><span class="op" id="5854588">,</span>&nbsp;<span class="ident" id="5854590">x</span><span class="op" id="5854591">.</span><span class="ident" id="5854592">data</span><span class="op" id="5854596">)</span><span class="op" id="5854597">;</span>&nbsp;<span class="ident" id="5854599">err</span>&nbsp;<span class="op" id="5854603">!=</span>&nbsp;<span class="ident" id="5854606">nil</span>&nbsp;<span class="op" id="5854610">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854614">return</span>&nbsp;<span class="ident" id="5854621">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854626">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854630">//&nbsp;read&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854645">for</span>&nbsp;<span class="ident" id="5854649">sa</span>&nbsp;<span class="op" id="5854652">:=</span>&nbsp;<span class="ident" id="5854655">x</span><span class="op" id="5854656">.</span><span class="ident" id="5854657">sa</span><span class="op" id="5854659">;</span>&nbsp;<span class="builtinfunc" id="5854661">len</span><span class="op" id="5854664">(</span><span class="ident" id="5854665">sa</span><span class="op" id="5854667">)</span>&nbsp;<span class="op" id="5854669">&gt;</span>&nbsp;<span class="num" id="5854671">0</span><span class="op" id="5854672">;</span>&nbsp;<span class="op" id="5854674">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854678">n</span><span class="op" id="5854679">,</span>&nbsp;<span class="ident" id="5854681">err</span>&nbsp;<span class="op" id="5854685">:=</span>&nbsp;<span class="ident" id="5854688">readSlice</span><span class="op" id="5854697">(</span><span class="ident" id="5854698">r</span><span class="op" id="5854699">,</span>&nbsp;<span class="ident" id="5854701">buf</span><span class="op" id="5854704">,</span>&nbsp;<span class="ident" id="5854706">sa</span><span class="op" id="5854708">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854712">if</span>&nbsp;<span class="ident" id="5854715">err</span>&nbsp;<span class="op" id="5854719">!=</span>&nbsp;<span class="ident" id="5854722">nil</span>&nbsp;<span class="op" id="5854726">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854731">return</span>&nbsp;<span class="ident" id="5854738">err</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854744">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854748">sa</span>&nbsp;<span class="op" id="5854751">=</span>&nbsp;<span class="ident" id="5854753">sa</span><span class="op" id="5854755">[</span><span class="ident" id="5854756">n</span><span class="op" id="5854757">:</span><span class="op" id="5854758">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854761">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854764">return</span>&nbsp;<span class="ident" id="5854771">nil</span><br>
<span class="lineno"></span><span class="op" id="5854775">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span><span class="comment" id="5854778">//&nbsp;Write&nbsp;writes&nbsp;the&nbsp;index&nbsp;x&nbsp;to&nbsp;w.</span><br>
<span class="lineno"></span><span class="keyword" id="5854812">func</span>&nbsp;<span class="op" id="5854817">(</span><span class="ident" id="5854818">x</span>&nbsp;<span class="op" id="5854820">*</span><span class="ident" id="5854821">Index</span><span class="op" id="5854826">)</span>&nbsp;<span class="ident" id="5854828">Write</span><span class="op" id="5854833">(</span><span class="ident" id="5854834">w</span>&nbsp;<span class="ident" id="5854836">io</span><span class="op" id="5854838">.</span><span class="ident" id="5854839">Writer</span><span class="op" id="5854845">)</span>&nbsp;<span class="builtintype" id="5854847">error</span>&nbsp;<span class="op" id="5854853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854856">//&nbsp;buffer&nbsp;for&nbsp;all&nbsp;writes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5854882">buf</span>&nbsp;<span class="op" id="5854886">:=</span>&nbsp;<span class="builtinfunc" id="5854889">make</span><span class="op" id="5854893">(</span><span class="op" id="5854894">[</span><span class="op" id="5854895">]</span><span class="builtintype" id="5854896">byte</span><span class="op" id="5854900">,</span>&nbsp;<span class="ident" id="5854902">bufSize</span><span class="op" id="5854909">)</span><br>
<span class="lineno">140</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5854913">//&nbsp;write&nbsp;length</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854930">if</span>&nbsp;<span class="ident" id="5854933">err</span>&nbsp;<span class="op" id="5854937">:=</span>&nbsp;<span class="ident" id="5854940">writeInt</span><span class="op" id="5854948">(</span><span class="ident" id="5854949">w</span><span class="op" id="5854950">,</span>&nbsp;<span class="ident" id="5854952">buf</span><span class="op" id="5854955">,</span>&nbsp;<span class="builtinfunc" id="5854957">len</span><span class="op" id="5854960">(</span><span class="ident" id="5854961">x</span><span class="op" id="5854962">.</span><span class="ident" id="5854963">data</span><span class="op" id="5854967">)</span><span class="op" id="5854968">)</span><span class="op" id="5854969">;</span>&nbsp;<span class="ident" id="5854971">err</span>&nbsp;<span class="op" id="5854975">!=</span>&nbsp;<span class="ident" id="5854978">nil</span>&nbsp;<span class="op" id="5854982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5854986">return</span>&nbsp;<span class="ident" id="5854993">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5854998">}</span><br>
<span class="lineno">145</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855002">//&nbsp;write&nbsp;data</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855017">if</span>&nbsp;<span class="ident" id="5855020">_</span><span class="op" id="5855021">,</span>&nbsp;<span class="ident" id="5855023">err</span>&nbsp;<span class="op" id="5855027">:=</span>&nbsp;<span class="ident" id="5855030">w</span><span class="op" id="5855031">.</span><span class="ident" id="5855032">Write</span><span class="op" id="5855037">(</span><span class="ident" id="5855038">x</span><span class="op" id="5855039">.</span><span class="ident" id="5855040">data</span><span class="op" id="5855044">)</span><span class="op" id="5855045">;</span>&nbsp;<span class="ident" id="5855047">err</span>&nbsp;<span class="op" id="5855051">!=</span>&nbsp;<span class="ident" id="5855054">nil</span>&nbsp;<span class="op" id="5855058">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855062">return</span>&nbsp;<span class="ident" id="5855069">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855074">}</span><br>
<span class="lineno">150</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855078">//&nbsp;write&nbsp;index</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855094">for</span>&nbsp;<span class="ident" id="5855098">sa</span>&nbsp;<span class="op" id="5855101">:=</span>&nbsp;<span class="ident" id="5855104">x</span><span class="op" id="5855105">.</span><span class="ident" id="5855106">sa</span><span class="op" id="5855108">;</span>&nbsp;<span class="builtinfunc" id="5855110">len</span><span class="op" id="5855113">(</span><span class="ident" id="5855114">sa</span><span class="op" id="5855116">)</span>&nbsp;<span class="op" id="5855118">&gt;</span>&nbsp;<span class="num" id="5855120">0</span><span class="op" id="5855121">;</span>&nbsp;<span class="op" id="5855123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855127">n</span><span class="op" id="5855128">,</span>&nbsp;<span class="ident" id="5855130">err</span>&nbsp;<span class="op" id="5855134">:=</span>&nbsp;<span class="ident" id="5855137">writeSlice</span><span class="op" id="5855147">(</span><span class="ident" id="5855148">w</span><span class="op" id="5855149">,</span>&nbsp;<span class="ident" id="5855151">buf</span><span class="op" id="5855154">,</span>&nbsp;<span class="ident" id="5855156">sa</span><span class="op" id="5855158">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855162">if</span>&nbsp;<span class="ident" id="5855165">err</span>&nbsp;<span class="op" id="5855169">!=</span>&nbsp;<span class="ident" id="5855172">nil</span>&nbsp;<span class="op" id="5855176">{</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855181">return</span>&nbsp;<span class="ident" id="5855188">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855194">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855198">sa</span>&nbsp;<span class="op" id="5855201">=</span>&nbsp;<span class="ident" id="5855203">sa</span><span class="op" id="5855205">[</span><span class="ident" id="5855206">n</span><span class="op" id="5855207">:</span><span class="op" id="5855208">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5855211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855214">return</span>&nbsp;<span class="ident" id="5855221">nil</span><br>
<span class="lineno">160</span><span class="op" id="5855225">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855228">//&nbsp;Bytes&nbsp;returns&nbsp;the&nbsp;data&nbsp;over&nbsp;which&nbsp;the&nbsp;index&nbsp;was&nbsp;created.</span><br>
<span class="lineno"></span><span class="comment" id="5855288">//&nbsp;It&nbsp;must&nbsp;not&nbsp;be&nbsp;modified.</span><br>
<span class="lineno"></span><span class="comment" id="5855316">//</span><br>
<span class="lineno">165</span><span class="keyword" id="5855319">func</span>&nbsp;<span class="op" id="5855324">(</span><span class="ident" id="5855325">x</span>&nbsp;<span class="op" id="5855327">*</span><span class="ident" id="5855328">Index</span><span class="op" id="5855333">)</span>&nbsp;<span class="ident" id="5855335">Bytes</span><span class="op" id="5855340">(</span><span class="op" id="5855341">)</span>&nbsp;<span class="op" id="5855343">[</span><span class="op" id="5855344">]</span><span class="builtintype" id="5855345">byte</span>&nbsp;<span class="op" id="5855350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855353">return</span>&nbsp;<span class="ident" id="5855360">x</span><span class="op" id="5855361">.</span><span class="ident" id="5855362">data</span><br>
<span class="lineno"></span><span class="op" id="5855367">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5855370">func</span>&nbsp;<span class="op" id="5855375">(</span><span class="ident" id="5855376">x</span>&nbsp;<span class="op" id="5855378">*</span><span class="ident" id="5855379">Index</span><span class="op" id="5855384">)</span>&nbsp;<span class="ident" id="5855386">at</span><span class="op" id="5855388">(</span><span class="ident" id="5855389">i</span>&nbsp;<span class="builtintype" id="5855391">int</span><span class="op" id="5855394">)</span>&nbsp;<span class="op" id="5855396">[</span><span class="op" id="5855397">]</span><span class="builtintype" id="5855398">byte</span>&nbsp;<span class="op" id="5855403">{</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855406">return</span>&nbsp;<span class="ident" id="5855413">x</span><span class="op" id="5855414">.</span><span class="ident" id="5855415">data</span><span class="op" id="5855419">[</span><span class="ident" id="5855420">x</span><span class="op" id="5855421">.</span><span class="ident" id="5855422">sa</span><span class="op" id="5855424">[</span><span class="ident" id="5855425">i</span><span class="op" id="5855426">]</span><span class="op" id="5855427">:</span><span class="op" id="5855428">]</span><br>
<span class="lineno"></span><span class="op" id="5855430">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855433">//&nbsp;lookupAll&nbsp;returns&nbsp;a&nbsp;slice&nbsp;into&nbsp;the&nbsp;matching&nbsp;region&nbsp;of&nbsp;the&nbsp;index.</span><br>
<span class="lineno"></span><span class="comment" id="5855501">//&nbsp;The&nbsp;runtime&nbsp;is&nbsp;O(log(N)*len(s)).</span><br>
<span class="lineno">175</span><span class="keyword" id="5855537">func</span>&nbsp;<span class="op" id="5855542">(</span><span class="ident" id="5855543">x</span>&nbsp;<span class="op" id="5855545">*</span><span class="ident" id="5855546">Index</span><span class="op" id="5855551">)</span>&nbsp;<span class="ident" id="5855553">lookupAll</span><span class="op" id="5855562">(</span><span class="ident" id="5855563">s</span>&nbsp;<span class="op" id="5855565">[</span><span class="op" id="5855566">]</span><span class="builtintype" id="5855567">byte</span><span class="op" id="5855571">)</span>&nbsp;<span class="op" id="5855573">[</span><span class="op" id="5855574">]</span><span class="builtintype" id="5855575">int</span>&nbsp;<span class="op" id="5855579">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855582">//&nbsp;find&nbsp;matching&nbsp;suffix&nbsp;index&nbsp;range&nbsp;[i:j]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855625">//&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;where&nbsp;s&nbsp;would&nbsp;be&nbsp;the&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855678">i</span>&nbsp;<span class="op" id="5855680">:=</span>&nbsp;<span class="ident" id="5855683">sort</span><span class="op" id="5855687">.</span><span class="ident" id="5855688">Search</span><span class="op" id="5855694">(</span><span class="builtinfunc" id="5855695">len</span><span class="op" id="5855698">(</span><span class="ident" id="5855699">x</span><span class="op" id="5855700">.</span><span class="ident" id="5855701">sa</span><span class="op" id="5855703">)</span><span class="op" id="5855704">,</span>&nbsp;<span class="keyword" id="5855706">func</span><span class="op" id="5855710">(</span><span class="ident" id="5855711">i</span>&nbsp;<span class="builtintype" id="5855713">int</span><span class="op" id="5855716">)</span>&nbsp;<span class="builtintype" id="5855718">bool</span>&nbsp;<span class="op" id="5855723">{</span>&nbsp;<span class="keyword" id="5855725">return</span>&nbsp;<span class="ident" id="5855732">bytes</span><span class="op" id="5855737">.</span><span class="ident" id="5855738">Compare</span><span class="op" id="5855745">(</span><span class="ident" id="5855746">x</span><span class="op" id="5855747">.</span><span class="ident" id="5855748">at</span><span class="op" id="5855750">(</span><span class="ident" id="5855751">i</span><span class="op" id="5855752">)</span><span class="op" id="5855753">,</span>&nbsp;<span class="ident" id="5855755">s</span><span class="op" id="5855756">)</span>&nbsp;<span class="op" id="5855758">&gt;=</span>&nbsp;<span class="num" id="5855761">0</span>&nbsp;<span class="op" id="5855763">}</span><span class="op" id="5855764">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5855767">//&nbsp;starting&nbsp;at&nbsp;i,&nbsp;find&nbsp;the&nbsp;first&nbsp;index&nbsp;at&nbsp;which&nbsp;s&nbsp;is&nbsp;not&nbsp;a&nbsp;prefix</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5855834">j</span>&nbsp;<span class="op" id="5855836">:=</span>&nbsp;<span class="ident" id="5855839">i</span>&nbsp;<span class="op" id="5855841">+</span>&nbsp;<span class="ident" id="5855843">sort</span><span class="op" id="5855847">.</span><span class="ident" id="5855848">Search</span><span class="op" id="5855854">(</span><span class="builtinfunc" id="5855855">len</span><span class="op" id="5855858">(</span><span class="ident" id="5855859">x</span><span class="op" id="5855860">.</span><span class="ident" id="5855861">sa</span><span class="op" id="5855863">)</span><span class="op" id="5855864">-</span><span class="ident" id="5855865">i</span><span class="op" id="5855866">,</span>&nbsp;<span class="keyword" id="5855868">func</span><span class="op" id="5855872">(</span><span class="ident" id="5855873">j</span>&nbsp;<span class="builtintype" id="5855875">int</span><span class="op" id="5855878">)</span>&nbsp;<span class="builtintype" id="5855880">bool</span>&nbsp;<span class="op" id="5855885">{</span>&nbsp;<span class="keyword" id="5855887">return</span>&nbsp;<span class="op" id="5855894">!</span><span class="ident" id="5855895">bytes</span><span class="op" id="5855900">.</span><span class="ident" id="5855901">HasPrefix</span><span class="op" id="5855910">(</span><span class="ident" id="5855911">x</span><span class="op" id="5855912">.</span><span class="ident" id="5855913">at</span><span class="op" id="5855915">(</span><span class="ident" id="5855916">j</span><span class="op" id="5855917">+</span><span class="ident" id="5855918">i</span><span class="op" id="5855919">)</span><span class="op" id="5855920">,</span>&nbsp;<span class="ident" id="5855922">s</span><span class="op" id="5855923">)</span>&nbsp;<span class="op" id="5855925">}</span><span class="op" id="5855926">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5855929">return</span>&nbsp;<span class="ident" id="5855936">x</span><span class="op" id="5855937">.</span><span class="ident" id="5855938">sa</span><span class="op" id="5855940">[</span><span class="ident" id="5855941">i</span><span class="op" id="5855942">:</span><span class="ident" id="5855943">j</span><span class="op" id="5855944">]</span><br>
<span class="lineno"></span><span class="op" id="5855946">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5855949">//&nbsp;Lookup&nbsp;returns&nbsp;an&nbsp;unsorted&nbsp;list&nbsp;of&nbsp;at&nbsp;most&nbsp;n&nbsp;indices&nbsp;where&nbsp;the&nbsp;byte&nbsp;string&nbsp;s</span><br>
<span class="lineno">185</span><span class="comment" id="5856029">//&nbsp;occurs&nbsp;in&nbsp;the&nbsp;indexed&nbsp;data.&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;occurrences&nbsp;are&nbsp;returned.</span><br>
<span class="lineno"></span><span class="comment" id="5856100">//&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;s&nbsp;is&nbsp;empty,&nbsp;s&nbsp;is&nbsp;not&nbsp;found,&nbsp;or&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5856163">//&nbsp;Lookup&nbsp;time&nbsp;is&nbsp;O(log(N)*len(s)&nbsp;+&nbsp;len(result))&nbsp;where&nbsp;N&nbsp;is&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5856227">//&nbsp;size&nbsp;of&nbsp;the&nbsp;indexed&nbsp;data.</span><br>
<span class="lineno"></span><span class="comment" id="5856256">//</span><br>
<span class="lineno">190</span><span class="keyword" id="5856259">func</span>&nbsp;<span class="op" id="5856264">(</span><span class="ident" id="5856265">x</span>&nbsp;<span class="op" id="5856267">*</span><span class="ident" id="5856268">Index</span><span class="op" id="5856273">)</span>&nbsp;<span class="ident" id="5856275">Lookup</span><span class="op" id="5856281">(</span><span class="ident" id="5856282">s</span>&nbsp;<span class="op" id="5856284">[</span><span class="op" id="5856285">]</span><span class="builtintype" id="5856286">byte</span><span class="op" id="5856290">,</span>&nbsp;<span class="ident" id="5856292">n</span>&nbsp;<span class="builtintype" id="5856294">int</span><span class="op" id="5856297">)</span>&nbsp;<span class="op" id="5856299">(</span><span class="ident" id="5856300">result</span>&nbsp;<span class="op" id="5856307">[</span><span class="op" id="5856308">]</span><span class="builtintype" id="5856309">int</span><span class="op" id="5856312">)</span>&nbsp;<span class="op" id="5856314">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856317">if</span>&nbsp;<span class="builtinfunc" id="5856320">len</span><span class="op" id="5856323">(</span><span class="ident" id="5856324">s</span><span class="op" id="5856325">)</span>&nbsp;<span class="op" id="5856327">&gt;</span>&nbsp;<span class="num" id="5856329">0</span>&nbsp;<span class="op" id="5856331">&amp;&amp;</span>&nbsp;<span class="ident" id="5856334">n</span>&nbsp;<span class="op" id="5856336">!=</span>&nbsp;<span class="num" id="5856339">0</span>&nbsp;<span class="op" id="5856341">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856345">matches</span>&nbsp;<span class="op" id="5856353">:=</span>&nbsp;<span class="ident" id="5856356">x</span><span class="op" id="5856357">.</span><span class="ident" id="5856358">lookupAll</span><span class="op" id="5856367">(</span><span class="ident" id="5856368">s</span><span class="op" id="5856369">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856373">if</span>&nbsp;<span class="ident" id="5856376">n</span>&nbsp;<span class="op" id="5856378">&lt;</span>&nbsp;<span class="num" id="5856380">0</span>&nbsp;<span class="op" id="5856382">||</span>&nbsp;<span class="builtinfunc" id="5856385">len</span><span class="op" id="5856388">(</span><span class="ident" id="5856389">matches</span><span class="op" id="5856396">)</span>&nbsp;<span class="op" id="5856398">&lt;</span>&nbsp;<span class="ident" id="5856400">n</span>&nbsp;<span class="op" id="5856402">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856407">n</span>&nbsp;<span class="op" id="5856409">=</span>&nbsp;<span class="builtinfunc" id="5856411">len</span><span class="op" id="5856414">(</span><span class="ident" id="5856415">matches</span><span class="op" id="5856422">)</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856430">//&nbsp;0&nbsp;&lt;=&nbsp;n&nbsp;&lt;=&nbsp;len(matches)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856458">if</span>&nbsp;<span class="ident" id="5856461">n</span>&nbsp;<span class="op" id="5856463">&gt;</span>&nbsp;<span class="num" id="5856465">0</span>&nbsp;<span class="op" id="5856467">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5856472">result</span>&nbsp;<span class="op" id="5856479">=</span>&nbsp;<span class="builtinfunc" id="5856481">make</span><span class="op" id="5856485">(</span><span class="op" id="5856486">[</span><span class="op" id="5856487">]</span><span class="builtintype" id="5856488">int</span><span class="op" id="5856491">,</span>&nbsp;<span class="ident" id="5856493">n</span><span class="op" id="5856494">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="5856499">copy</span><span class="op" id="5856503">(</span><span class="ident" id="5856504">result</span><span class="op" id="5856510">,</span>&nbsp;<span class="ident" id="5856512">matches</span><span class="op" id="5856519">)</span><br>
<span class="lineno">200</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856523">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5856526">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5856529">return</span><br>
<span class="lineno"></span><span class="op" id="5856536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">205</span><span class="comment" id="5856539">//&nbsp;FindAllIndex&nbsp;returns&nbsp;a&nbsp;sorted&nbsp;list&nbsp;of&nbsp;non-overlapping&nbsp;matches&nbsp;of&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="5856611">//&nbsp;regular&nbsp;expression&nbsp;r,&nbsp;where&nbsp;a&nbsp;match&nbsp;is&nbsp;a&nbsp;pair&nbsp;of&nbsp;indices&nbsp;specifying</span><br>
<span class="lineno"></span><span class="comment" id="5856682">//&nbsp;the&nbsp;matched&nbsp;slice&nbsp;of&nbsp;x.Bytes().&nbsp;If&nbsp;n&nbsp;&lt;&nbsp;0,&nbsp;all&nbsp;matches&nbsp;are&nbsp;returned</span><br>
<span class="lineno"></span><span class="comment" id="5856752">//&nbsp;in&nbsp;successive&nbsp;order.&nbsp;Otherwise,&nbsp;at&nbsp;most&nbsp;n&nbsp;matches&nbsp;are&nbsp;returned&nbsp;and</span><br>
<span class="lineno"></span><span class="comment" id="5856822">//&nbsp;they&nbsp;may&nbsp;not&nbsp;be&nbsp;successive.&nbsp;The&nbsp;result&nbsp;is&nbsp;nil&nbsp;if&nbsp;there&nbsp;are&nbsp;no&nbsp;matches,</span><br>
<span class="lineno">210</span><span class="comment" id="5856896">//&nbsp;or&nbsp;if&nbsp;n&nbsp;==&nbsp;0.</span><br>
<span class="lineno"></span><span class="comment" id="5856913">//</span><br>
<span class="lineno"></span><span class="keyword" id="5856916">func</span>&nbsp;<span class="op" id="5856921">(</span><span class="ident" id="5856922">x</span>&nbsp;<span class="op" id="5856924">*</span><span class="ident" id="5856925">Index</span><span class="op" id="5856930">)</span>&nbsp;<span class="ident" id="5856932">FindAllIndex</span><span class="op" id="5856944">(</span><span class="ident" id="5856945">r</span>&nbsp;<span class="op" id="5856947">*</span><span class="ident" id="5856948">regexp</span><span class="op" id="5856954">.</span><span class="ident" id="5856955">Regexp</span><span class="op" id="5856961">,</span>&nbsp;<span class="ident" id="5856963">n</span>&nbsp;<span class="builtintype" id="5856965">int</span><span class="op" id="5856968">)</span>&nbsp;<span class="op" id="5856970">(</span><span class="ident" id="5856971">result</span>&nbsp;<span class="op" id="5856978">[</span><span class="op" id="5856979">]</span><span class="op" id="5856980">[</span><span class="op" id="5856981">]</span><span class="builtintype" id="5856982">int</span><span class="op" id="5856985">)</span>&nbsp;<span class="op" id="5856987">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5856990">//&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix&nbsp;is&nbsp;used&nbsp;to&nbsp;determine&nbsp;possible</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857051">//&nbsp;match&nbsp;start&nbsp;indices&nbsp;with&nbsp;Lookup</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857087">prefix</span><span class="op" id="5857093">,</span>&nbsp;<span class="ident" id="5857095">complete</span>&nbsp;<span class="op" id="5857104">:=</span>&nbsp;<span class="ident" id="5857107">r</span><span class="op" id="5857108">.</span><span class="ident" id="5857109">LiteralPrefix</span><span class="op" id="5857122">(</span><span class="op" id="5857123">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857126">lit</span>&nbsp;<span class="op" id="5857130">:=</span>&nbsp;<span class="op" id="5857133">[</span><span class="op" id="5857134">]</span><span class="builtintype" id="5857135">byte</span><span class="op" id="5857139">(</span><span class="ident" id="5857140">prefix</span><span class="op" id="5857146">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857150">//&nbsp;worst-case&nbsp;scenario:&nbsp;no&nbsp;literal&nbsp;prefix</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857193">if</span>&nbsp;<span class="ident" id="5857196">prefix</span>&nbsp;<span class="op" id="5857203">==</span>&nbsp;<span class="string" id="5857206">&#34;&#34;</span>&nbsp;<span class="op" id="5857209">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857213">return</span>&nbsp;<span class="ident" id="5857220">r</span><span class="op" id="5857221">.</span><span class="ident" id="5857222">FindAllIndex</span><span class="op" id="5857234">(</span><span class="ident" id="5857235">x</span><span class="op" id="5857236">.</span><span class="ident" id="5857237">data</span><span class="op" id="5857241">,</span>&nbsp;<span class="ident" id="5857243">n</span><span class="op" id="5857244">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857251">//&nbsp;if&nbsp;regexp&nbsp;is&nbsp;a&nbsp;literal&nbsp;just&nbsp;use&nbsp;Lookup&nbsp;and&nbsp;convert&nbsp;its</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857310">//&nbsp;result&nbsp;into&nbsp;match&nbsp;pairs</span><br>
<span class="lineno">225</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857338">if</span>&nbsp;<span class="ident" id="5857341">complete</span>&nbsp;<span class="op" id="5857350">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857354">//&nbsp;Lookup&nbsp;returns&nbsp;indices&nbsp;that&nbsp;may&nbsp;belong&nbsp;to&nbsp;overlapping&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857422">//&nbsp;After&nbsp;eliminating&nbsp;them,&nbsp;we&nbsp;may&nbsp;end&nbsp;up&nbsp;with&nbsp;fewer&nbsp;than&nbsp;n&nbsp;matches.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857492">//&nbsp;If&nbsp;we&nbsp;don&#39;t&nbsp;have&nbsp;enough&nbsp;at&nbsp;the&nbsp;end,&nbsp;redo&nbsp;the&nbsp;search&nbsp;with&nbsp;an</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857557">//&nbsp;increased&nbsp;value&nbsp;n1,&nbsp;but&nbsp;only&nbsp;if&nbsp;Lookup&nbsp;returned&nbsp;all&nbsp;the&nbsp;requested</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857628">//&nbsp;indices&nbsp;in&nbsp;the&nbsp;first&nbsp;place&nbsp;(if&nbsp;it&nbsp;returned&nbsp;fewer&nbsp;than&nbsp;that&nbsp;then</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5857697">//&nbsp;there&nbsp;cannot&nbsp;be&nbsp;more).</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857725">for</span>&nbsp;<span class="ident" id="5857729">n1</span>&nbsp;<span class="op" id="5857732">:=</span>&nbsp;<span class="ident" id="5857735">n</span><span class="op" id="5857736">;</span>&nbsp;<span class="op" id="5857738">;</span>&nbsp;<span class="ident" id="5857740">n1</span>&nbsp;<span class="op" id="5857743">+=</span>&nbsp;<span class="num" id="5857746">2</span>&nbsp;<span class="op" id="5857748">*</span>&nbsp;<span class="op" id="5857750">(</span><span class="ident" id="5857751">n</span>&nbsp;<span class="op" id="5857753">-</span>&nbsp;<span class="builtinfunc" id="5857755">len</span><span class="op" id="5857758">(</span><span class="ident" id="5857759">result</span><span class="op" id="5857765">)</span><span class="op" id="5857766">)</span>&nbsp;<span class="comment" id="5857768">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5857786">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857791">indices</span>&nbsp;<span class="op" id="5857799">:=</span>&nbsp;<span class="ident" id="5857802">x</span><span class="op" id="5857803">.</span><span class="ident" id="5857804">Lookup</span><span class="op" id="5857810">(</span><span class="ident" id="5857811">lit</span><span class="op" id="5857814">,</span>&nbsp;<span class="ident" id="5857816">n1</span><span class="op" id="5857818">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857823">if</span>&nbsp;<span class="builtinfunc" id="5857826">len</span><span class="op" id="5857829">(</span><span class="ident" id="5857830">indices</span><span class="op" id="5857837">)</span>&nbsp;<span class="op" id="5857839">==</span>&nbsp;<span class="num" id="5857842">0</span>&nbsp;<span class="op" id="5857844">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857850">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5857860">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857865">sort</span><span class="op" id="5857869">.</span><span class="ident" id="5857870">Ints</span><span class="op" id="5857874">(</span><span class="ident" id="5857875">indices</span><span class="op" id="5857882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857887">pairs</span>&nbsp;<span class="op" id="5857893">:=</span>&nbsp;<span class="builtinfunc" id="5857896">make</span><span class="op" id="5857900">(</span><span class="op" id="5857901">[</span><span class="op" id="5857902">]</span><span class="builtintype" id="5857903">int</span><span class="op" id="5857906">,</span>&nbsp;<span class="num" id="5857908">2</span><span class="op" id="5857909">*</span><span class="builtinfunc" id="5857910">len</span><span class="op" id="5857913">(</span><span class="ident" id="5857914">indices</span><span class="op" id="5857921">)</span><span class="op" id="5857922">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857927">result</span>&nbsp;<span class="op" id="5857934">=</span>&nbsp;<span class="builtinfunc" id="5857936">make</span><span class="op" id="5857940">(</span><span class="op" id="5857941">[</span><span class="op" id="5857942">]</span><span class="op" id="5857943">[</span><span class="op" id="5857944">]</span><span class="builtintype" id="5857945">int</span><span class="op" id="5857948">,</span>&nbsp;<span class="builtinfunc" id="5857950">len</span><span class="op" id="5857953">(</span><span class="ident" id="5857954">indices</span><span class="op" id="5857961">)</span><span class="op" id="5857962">)</span><br>
<span class="lineno">240</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857967">count</span>&nbsp;<span class="op" id="5857973">:=</span>&nbsp;<span class="num" id="5857976">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5857981">prev</span>&nbsp;<span class="op" id="5857986">:=</span>&nbsp;<span class="num" id="5857989">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5857994">for</span>&nbsp;<span class="ident" id="5857998">_</span><span class="op" id="5857999">,</span>&nbsp;<span class="ident" id="5858001">i</span>&nbsp;<span class="op" id="5858003">:=</span>&nbsp;<span class="keyword" id="5858006">range</span>&nbsp;<span class="ident" id="5858012">indices</span>&nbsp;<span class="op" id="5858020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858026">if</span>&nbsp;<span class="ident" id="5858029">count</span>&nbsp;<span class="op" id="5858035">==</span>&nbsp;<span class="ident" id="5858038">n</span>&nbsp;<span class="op" id="5858040">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858047">break</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858057">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858063">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858116">if</span>&nbsp;<span class="ident" id="5858119">prev</span>&nbsp;<span class="op" id="5858124">&lt;=</span>&nbsp;<span class="ident" id="5858127">i</span>&nbsp;<span class="op" id="5858129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858136">j</span>&nbsp;<span class="op" id="5858138">:=</span>&nbsp;<span class="num" id="5858141">2</span>&nbsp;<span class="op" id="5858143">*</span>&nbsp;<span class="ident" id="5858145">count</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858156">pairs</span><span class="op" id="5858161">[</span><span class="ident" id="5858162">j</span><span class="op" id="5858163">+</span><span class="num" id="5858164">0</span><span class="op" id="5858165">]</span>&nbsp;<span class="op" id="5858167">=</span>&nbsp;<span class="ident" id="5858169">i</span><br>
<span class="lineno">250</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858176">pairs</span><span class="op" id="5858181">[</span><span class="ident" id="5858182">j</span><span class="op" id="5858183">+</span><span class="num" id="5858184">1</span><span class="op" id="5858185">]</span>&nbsp;<span class="op" id="5858187">=</span>&nbsp;<span class="ident" id="5858189">i</span>&nbsp;<span class="op" id="5858191">+</span>&nbsp;<span class="builtinfunc" id="5858193">len</span><span class="op" id="5858196">(</span><span class="ident" id="5858197">lit</span><span class="op" id="5858200">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858207">result</span><span class="op" id="5858213">[</span><span class="ident" id="5858214">count</span><span class="op" id="5858219">]</span>&nbsp;<span class="op" id="5858221">=</span>&nbsp;<span class="ident" id="5858223">pairs</span><span class="op" id="5858228">[</span><span class="ident" id="5858229">j</span>&nbsp;<span class="op" id="5858231">:</span>&nbsp;<span class="ident" id="5858233">j</span><span class="op" id="5858234">+</span><span class="num" id="5858235">2</span><span class="op" id="5858236">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858243">count</span><span class="op" id="5858248">++</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858256">prev</span>&nbsp;<span class="op" id="5858261">=</span>&nbsp;<span class="ident" id="5858263">i</span>&nbsp;<span class="op" id="5858265">+</span>&nbsp;<span class="builtinfunc" id="5858267">len</span><span class="op" id="5858270">(</span><span class="ident" id="5858271">lit</span><span class="op" id="5858274">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858280">}</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858285">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858290">result</span>&nbsp;<span class="op" id="5858297">=</span>&nbsp;<span class="ident" id="5858299">result</span><span class="op" id="5858305">[</span><span class="num" id="5858306">0</span><span class="op" id="5858307">:</span><span class="ident" id="5858308">count</span><span class="op" id="5858313">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858318">if</span>&nbsp;<span class="builtinfunc" id="5858321">len</span><span class="op" id="5858324">(</span><span class="ident" id="5858325">result</span><span class="op" id="5858331">)</span>&nbsp;<span class="op" id="5858333">&gt;=</span>&nbsp;<span class="ident" id="5858336">n</span>&nbsp;<span class="op" id="5858338">||</span>&nbsp;<span class="builtinfunc" id="5858341">len</span><span class="op" id="5858344">(</span><span class="ident" id="5858345">indices</span><span class="op" id="5858352">)</span>&nbsp;<span class="op" id="5858354">!=</span>&nbsp;<span class="ident" id="5858357">n1</span>&nbsp;<span class="op" id="5858360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858366">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858425">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858459">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858468">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858472">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858476">if</span>&nbsp;<span class="builtinfunc" id="5858479">len</span><span class="op" id="5858482">(</span><span class="ident" id="5858483">result</span><span class="op" id="5858489">)</span>&nbsp;<span class="op" id="5858491">==</span>&nbsp;<span class="num" id="5858494">0</span>&nbsp;<span class="op" id="5858496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858501">result</span>&nbsp;<span class="op" id="5858508">=</span>&nbsp;<span class="ident" id="5858510">nil</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858516">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858520">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5858528">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858532">//&nbsp;regexp&nbsp;has&nbsp;a&nbsp;non-empty&nbsp;literal&nbsp;prefix;&nbsp;Lookup(lit)&nbsp;computes</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858596">//&nbsp;the&nbsp;indices&nbsp;of&nbsp;possible&nbsp;complete&nbsp;matches;&nbsp;use&nbsp;these&nbsp;as&nbsp;starting</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858664">//&nbsp;points&nbsp;for&nbsp;anchored&nbsp;searches</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858697">//&nbsp;(regexp&nbsp;&#34;^&#34;&nbsp;matches&nbsp;beginning&nbsp;of&nbsp;input,&nbsp;not&nbsp;beginning&nbsp;of&nbsp;line)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858764">r</span>&nbsp;<span class="op" id="5858766">=</span>&nbsp;<span class="ident" id="5858768">regexp</span><span class="op" id="5858774">.</span><span class="ident" id="5858775">MustCompile</span><span class="op" id="5858786">(</span><span class="string" id="5858787">&#34;^&#34;</span>&nbsp;<span class="op" id="5858791">+</span>&nbsp;<span class="ident" id="5858793">r</span><span class="op" id="5858794">.</span><span class="ident" id="5858795">String</span><span class="op" id="5858801">(</span><span class="op" id="5858802">)</span><span class="op" id="5858803">)</span>&nbsp;<span class="comment" id="5858805">//&nbsp;compiles&nbsp;because&nbsp;r&nbsp;compiled</span><br>
<span class="lineno"></span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5858838">//&nbsp;same&nbsp;comment&nbsp;about&nbsp;Lookup&nbsp;applies&nbsp;here&nbsp;as&nbsp;in&nbsp;the&nbsp;loop&nbsp;above</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858902">for</span>&nbsp;<span class="ident" id="5858906">n1</span>&nbsp;<span class="op" id="5858909">:=</span>&nbsp;<span class="ident" id="5858912">n</span><span class="op" id="5858913">;</span>&nbsp;<span class="op" id="5858915">;</span>&nbsp;<span class="ident" id="5858917">n1</span>&nbsp;<span class="op" id="5858920">+=</span>&nbsp;<span class="num" id="5858923">2</span>&nbsp;<span class="op" id="5858925">*</span>&nbsp;<span class="op" id="5858927">(</span><span class="ident" id="5858928">n</span>&nbsp;<span class="op" id="5858930">-</span>&nbsp;<span class="builtinfunc" id="5858932">len</span><span class="op" id="5858935">(</span><span class="ident" id="5858936">result</span><span class="op" id="5858942">)</span><span class="op" id="5858943">)</span>&nbsp;<span class="comment" id="5858945">/*&nbsp;overflow&nbsp;ok&nbsp;*/</span>&nbsp;<span class="op" id="5858963">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5858967">indices</span>&nbsp;<span class="op" id="5858975">:=</span>&nbsp;<span class="ident" id="5858978">x</span><span class="op" id="5858979">.</span><span class="ident" id="5858980">Lookup</span><span class="op" id="5858986">(</span><span class="ident" id="5858987">lit</span><span class="op" id="5858990">,</span>&nbsp;<span class="ident" id="5858992">n1</span><span class="op" id="5858994">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5858998">if</span>&nbsp;<span class="builtinfunc" id="5859001">len</span><span class="op" id="5859004">(</span><span class="ident" id="5859005">indices</span><span class="op" id="5859012">)</span>&nbsp;<span class="op" id="5859014">==</span>&nbsp;<span class="num" id="5859017">0</span>&nbsp;<span class="op" id="5859019">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859024">return</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859037">sort</span><span class="op" id="5859041">.</span><span class="ident" id="5859042">Ints</span><span class="op" id="5859046">(</span><span class="ident" id="5859047">indices</span><span class="op" id="5859054">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859058">result</span>&nbsp;<span class="op" id="5859065">=</span>&nbsp;<span class="ident" id="5859067">result</span><span class="op" id="5859073">[</span><span class="num" id="5859074">0</span><span class="op" id="5859075">:</span><span class="num" id="5859076">0</span><span class="op" id="5859077">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859081">prev</span>&nbsp;<span class="op" id="5859086">:=</span>&nbsp;<span class="num" id="5859089">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859093">for</span>&nbsp;<span class="ident" id="5859097">_</span><span class="op" id="5859098">,</span>&nbsp;<span class="ident" id="5859100">i</span>&nbsp;<span class="op" id="5859102">:=</span>&nbsp;<span class="keyword" id="5859105">range</span>&nbsp;<span class="ident" id="5859111">indices</span>&nbsp;<span class="op" id="5859119">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859124">if</span>&nbsp;<span class="builtinfunc" id="5859127">len</span><span class="op" id="5859130">(</span><span class="ident" id="5859131">result</span><span class="op" id="5859137">)</span>&nbsp;<span class="op" id="5859139">==</span>&nbsp;<span class="ident" id="5859142">n</span>&nbsp;<span class="op" id="5859144">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859150">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859159">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859164">m</span>&nbsp;<span class="op" id="5859166">:=</span>&nbsp;<span class="ident" id="5859169">r</span><span class="op" id="5859170">.</span><span class="ident" id="5859171">FindIndex</span><span class="op" id="5859180">(</span><span class="ident" id="5859181">x</span><span class="op" id="5859182">.</span><span class="ident" id="5859183">data</span><span class="op" id="5859187">[</span><span class="ident" id="5859188">i</span><span class="op" id="5859189">:</span><span class="op" id="5859190">]</span><span class="op" id="5859191">)</span>&nbsp;<span class="comment" id="5859193">//&nbsp;anchored&nbsp;search&nbsp;-&nbsp;will&nbsp;not&nbsp;run&nbsp;off</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859234">//&nbsp;ignore&nbsp;indices&nbsp;leading&nbsp;to&nbsp;overlapping&nbsp;matches</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859286">if</span>&nbsp;<span class="ident" id="5859289">m</span>&nbsp;<span class="op" id="5859291">!=</span>&nbsp;<span class="ident" id="5859294">nil</span>&nbsp;<span class="op" id="5859298">&amp;&amp;</span>&nbsp;<span class="ident" id="5859301">prev</span>&nbsp;<span class="op" id="5859306">&lt;=</span>&nbsp;<span class="ident" id="5859309">i</span>&nbsp;<span class="op" id="5859311">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859317">m</span><span class="op" id="5859318">[</span><span class="num" id="5859319">0</span><span class="op" id="5859320">]</span>&nbsp;<span class="op" id="5859322">=</span>&nbsp;<span class="ident" id="5859324">i</span>&nbsp;<span class="comment" id="5859326">//&nbsp;correct&nbsp;m</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859343">m</span><span class="op" id="5859344">[</span><span class="num" id="5859345">1</span><span class="op" id="5859346">]</span>&nbsp;<span class="op" id="5859348">+=</span>&nbsp;<span class="ident" id="5859351">i</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859357">result</span>&nbsp;<span class="op" id="5859364">=</span>&nbsp;<span class="builtinfunc" id="5859366">append</span><span class="op" id="5859372">(</span><span class="ident" id="5859373">result</span><span class="op" id="5859379">,</span>&nbsp;<span class="ident" id="5859381">m</span><span class="op" id="5859382">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859388">prev</span>&nbsp;<span class="op" id="5859393">=</span>&nbsp;<span class="ident" id="5859395">m</span><span class="op" id="5859396">[</span><span class="num" id="5859397">1</span><span class="op" id="5859398">]</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859403">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859407">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859411">if</span>&nbsp;<span class="builtinfunc" id="5859414">len</span><span class="op" id="5859417">(</span><span class="ident" id="5859418">result</span><span class="op" id="5859424">)</span>&nbsp;<span class="op" id="5859426">&gt;=</span>&nbsp;<span class="ident" id="5859429">n</span>&nbsp;<span class="op" id="5859431">||</span>&nbsp;<span class="builtinfunc" id="5859434">len</span><span class="op" id="5859437">(</span><span class="ident" id="5859438">indices</span><span class="op" id="5859445">)</span>&nbsp;<span class="op" id="5859447">!=</span>&nbsp;<span class="ident" id="5859450">n1</span>&nbsp;<span class="op" id="5859453">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859458">//&nbsp;found&nbsp;all&nbsp;matches&nbsp;or&nbsp;there&#39;s&nbsp;no&nbsp;chance&nbsp;to&nbsp;find&nbsp;more</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5859516">//&nbsp;(n&nbsp;and&nbsp;n1&nbsp;can&nbsp;be&nbsp;negative)</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859549">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859557">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859560">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859563">if</span>&nbsp;<span class="builtinfunc" id="5859566">len</span><span class="op" id="5859569">(</span><span class="ident" id="5859570">result</span><span class="op" id="5859576">)</span>&nbsp;<span class="op" id="5859578">==</span>&nbsp;<span class="num" id="5859581">0</span>&nbsp;<span class="op" id="5859583">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5859587">result</span>&nbsp;<span class="op" id="5859594">=</span>&nbsp;<span class="ident" id="5859596">nil</span><br>
<span class="lineno">305</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5859601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5859604">return</span><br>
<span class="lineno"></span><span class="op" id="5859611">}</span>
</div>
</body>
</html>
