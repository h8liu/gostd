<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>encoding/gob</h2>
<ul>
<li><a href="/gostd/encoding/gob/codec_test.go.html">codec_test.go</a></li>
<li><a href="/gostd/encoding/gob/dec_helpers.go.html">dec_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/decode.go.html">decode.go</a></li>
<li><a href="/gostd/encoding/gob/decoder.go.html">decoder.go</a></li>
<li><a href="/gostd/encoding/gob/doc.go.html">doc.go</a></li>
<li><a href="/gostd/encoding/gob/enc_helpers.go.html">enc_helpers.go</a></li>
<li><a href="/gostd/encoding/gob/encode.go.html">encode.go</a></li>
<li><a href="/gostd/encoding/gob/encoder.go.html">encoder.go</a></li>
<li><a href="/gostd/encoding/gob/encoder_test.go.html">encoder_test.go</a></li>
<li><a href="/gostd/encoding/gob/error.go.html">error.go</a></li>
<li><a href="/gostd/encoding/gob/example_encdec_test.go.html">example_encdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_interface_test.go.html">example_interface_test.go</a></li>
<li><a href="/gostd/encoding/gob/example_test.go.html">example_test.go</a></li>
<li><a href="/gostd/encoding/gob/gobencdec_test.go.html">gobencdec_test.go</a></li>
<li><a href="/gostd/encoding/gob/timing_test.go.html">timing_test.go</a></li>
<li><a href="/gostd/encoding/gob/type.go.html">type.go</a></li>
<li><a href="/gostd/encoding/gob/type_test.go.html">type_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7685383">//&nbsp;Copyright&nbsp;2009&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7685438">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7685492">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7685543">package</span>&nbsp;<span class="ident" id="7685551">gob</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7685556">import</span>&nbsp;<span class="op" id="7685563">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685566">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685575">&#34;fmt&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685582">&#34;io&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685588">&#34;reflect&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685599">&#34;strings&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7685610">&#34;testing&#34;</span><br>
<span class="lineno"></span><span class="op" id="7685620">)</span><br>
<span class="lineno">15</span><br>
<span class="lineno"></span><span class="comment" id="7685623">//&nbsp;Test&nbsp;basic&nbsp;operations&nbsp;in&nbsp;a&nbsp;safe&nbsp;manner.</span><br>
<span class="lineno"></span><span class="keyword" id="7685666">func</span>&nbsp;<span class="ident" id="7685671">TestBasicEncoderDecoder</span><span class="op" id="7685694">(</span><span class="ident" id="7685695">t</span>&nbsp;<span class="op" id="7685697">*</span><span class="ident" id="7685698">testing</span><span class="op" id="7685705">.</span><span class="ident" id="7685706">T</span><span class="op" id="7685707">)</span>&nbsp;<span class="op" id="7685709">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7685712">var</span>&nbsp;<span class="ident" id="7685716">values</span>&nbsp;<span class="op" id="7685723">=</span>&nbsp;<span class="op" id="7685725">[</span><span class="op" id="7685726">]</span><span class="keyword" id="7685727">interface</span><span class="op" id="7685736">{</span><span class="op" id="7685737">}</span><span class="op" id="7685738">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685742">true</span><span class="op" id="7685746">,</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685750">int</span><span class="op" id="7685753">(</span><span class="num" id="7685754">123</span><span class="op" id="7685757">)</span><span class="op" id="7685758">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685762">int8</span><span class="op" id="7685766">(</span><span class="num" id="7685767">123</span><span class="op" id="7685770">)</span><span class="op" id="7685771">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685775">int16</span><span class="op" id="7685780">(</span><span class="op" id="7685781">-</span><span class="num" id="7685782">12345</span><span class="op" id="7685787">)</span><span class="op" id="7685788">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685792">int32</span><span class="op" id="7685797">(</span><span class="num" id="7685798">123456</span><span class="op" id="7685804">)</span><span class="op" id="7685805">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685809">int64</span><span class="op" id="7685814">(</span><span class="op" id="7685815">-</span><span class="num" id="7685816">1234567</span><span class="op" id="7685823">)</span><span class="op" id="7685824">,</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685828">uint</span><span class="op" id="7685832">(</span><span class="num" id="7685833">123</span><span class="op" id="7685836">)</span><span class="op" id="7685837">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685841">uint8</span><span class="op" id="7685846">(</span><span class="num" id="7685847">123</span><span class="op" id="7685850">)</span><span class="op" id="7685851">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685855">uint16</span><span class="op" id="7685861">(</span><span class="num" id="7685862">12345</span><span class="op" id="7685867">)</span><span class="op" id="7685868">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685872">uint32</span><span class="op" id="7685878">(</span><span class="num" id="7685879">123456</span><span class="op" id="7685885">)</span><span class="op" id="7685886">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7685890">uint64</span><span class="op" id="7685896">(</span><span class="num" id="7685897">1234567</span><span class="op" id="7685904">)</span><span class="op" id="7685905">,</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685909">uintptr</span><span class="op" id="7685916">(</span><span class="num" id="7685917">12345678</span><span class="op" id="7685925">)</span><span class="op" id="7685926">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685930">float32</span><span class="op" id="7685937">(</span><span class="num" id="7685938">1.2345</span><span class="op" id="7685944">)</span><span class="op" id="7685945">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685949">float64</span><span class="op" id="7685956">(</span><span class="num" id="7685957">1.2345678</span><span class="op" id="7685966">)</span><span class="op" id="7685967">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7685971">complex64</span><span class="op" id="7685980">(</span><span class="num" id="7685981">1.2345</span>&nbsp;<span class="op" id="7685988">+</span>&nbsp;<span class="num" id="7685990">2.3456i</span><span class="op" id="7685997">)</span><span class="op" id="7685998">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7686002">complex128</span><span class="op" id="7686012">(</span><span class="num" id="7686013">1.2345678</span>&nbsp;<span class="op" id="7686023">+</span>&nbsp;<span class="num" id="7686025">2.3456789i</span><span class="op" id="7686035">)</span><span class="op" id="7686036">,</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686040">[</span><span class="op" id="7686041">]</span><span class="builtintype" id="7686042">byte</span><span class="op" id="7686046">(</span><span class="string" id="7686047">&#34;hello&#34;</span><span class="op" id="7686054">)</span><span class="op" id="7686055">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="builtintype" id="7686059">string</span><span class="op" id="7686065">(</span><span class="string" id="7686066">&#34;hello&#34;</span><span class="op" id="7686073">)</span><span class="op" id="7686074">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686077">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686080">for</span>&nbsp;<span class="ident" id="7686084">_</span><span class="op" id="7686085">,</span>&nbsp;<span class="ident" id="7686087">value</span>&nbsp;<span class="op" id="7686093">:=</span>&nbsp;<span class="keyword" id="7686096">range</span>&nbsp;<span class="ident" id="7686102">values</span>&nbsp;<span class="op" id="7686109">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686113">b</span>&nbsp;<span class="op" id="7686115">:=</span>&nbsp;<span class="builtinfunc" id="7686118">new</span><span class="op" id="7686121">(</span><span class="ident" id="7686122">bytes</span><span class="op" id="7686127">.</span><span class="ident" id="7686128">Buffer</span><span class="op" id="7686134">)</span><br>
<span class="lineno">40</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686138">enc</span>&nbsp;<span class="op" id="7686142">:=</span>&nbsp;<span class="ident" id="7686145">NewEncoder</span><span class="op" id="7686155">(</span><span class="ident" id="7686156">b</span><span class="op" id="7686157">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686161">err</span>&nbsp;<span class="op" id="7686165">:=</span>&nbsp;<span class="ident" id="7686168">enc</span><span class="op" id="7686171">.</span><span class="ident" id="7686172">Encode</span><span class="op" id="7686178">(</span><span class="ident" id="7686179">value</span><span class="op" id="7686184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686188">if</span>&nbsp;<span class="ident" id="7686191">err</span>&nbsp;<span class="op" id="7686195">!=</span>&nbsp;<span class="ident" id="7686198">nil</span>&nbsp;<span class="op" id="7686202">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686207">t</span><span class="op" id="7686208">.</span><span class="ident" id="7686209">Error</span><span class="op" id="7686214">(</span><span class="string" id="7686215">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7686230">,</span>&nbsp;<span class="ident" id="7686232">err</span><span class="op" id="7686235">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686239">}</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686243">dec</span>&nbsp;<span class="op" id="7686247">:=</span>&nbsp;<span class="ident" id="7686250">NewDecoder</span><span class="op" id="7686260">(</span><span class="ident" id="7686261">b</span><span class="op" id="7686262">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686266">result</span>&nbsp;<span class="op" id="7686273">:=</span>&nbsp;<span class="ident" id="7686276">reflect</span><span class="op" id="7686283">.</span><span class="ident" id="7686284">New</span><span class="op" id="7686287">(</span><span class="ident" id="7686288">reflect</span><span class="op" id="7686295">.</span><span class="ident" id="7686296">TypeOf</span><span class="op" id="7686302">(</span><span class="ident" id="7686303">value</span><span class="op" id="7686308">)</span><span class="op" id="7686309">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686313">err</span>&nbsp;<span class="op" id="7686317">=</span>&nbsp;<span class="ident" id="7686319">dec</span><span class="op" id="7686322">.</span><span class="ident" id="7686323">Decode</span><span class="op" id="7686329">(</span><span class="ident" id="7686330">result</span><span class="op" id="7686336">.</span><span class="ident" id="7686337">Interface</span><span class="op" id="7686346">(</span><span class="op" id="7686347">)</span><span class="op" id="7686348">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686352">if</span>&nbsp;<span class="ident" id="7686355">err</span>&nbsp;<span class="op" id="7686359">!=</span>&nbsp;<span class="ident" id="7686362">nil</span>&nbsp;<span class="op" id="7686366">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686371">t</span><span class="op" id="7686372">.</span><span class="ident" id="7686373">Fatalf</span><span class="op" id="7686379">(</span><span class="string" id="7686380">&#34;error&nbsp;decoding&nbsp;%T:&nbsp;%v:&#34;</span><span class="op" id="7686404">,</span>&nbsp;<span class="ident" id="7686406">reflect</span><span class="op" id="7686413">.</span><span class="ident" id="7686414">TypeOf</span><span class="op" id="7686420">(</span><span class="ident" id="7686421">value</span><span class="op" id="7686426">)</span><span class="op" id="7686427">,</span>&nbsp;<span class="ident" id="7686429">err</span><span class="op" id="7686432">)</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686436">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7686440">if</span>&nbsp;<span class="op" id="7686443">!</span><span class="ident" id="7686444">reflect</span><span class="op" id="7686451">.</span><span class="ident" id="7686452">DeepEqual</span><span class="op" id="7686461">(</span><span class="ident" id="7686462">value</span><span class="op" id="7686467">,</span>&nbsp;<span class="ident" id="7686469">result</span><span class="op" id="7686475">.</span><span class="ident" id="7686476">Elem</span><span class="op" id="7686480">(</span><span class="op" id="7686481">)</span><span class="op" id="7686482">.</span><span class="ident" id="7686483">Interface</span><span class="op" id="7686492">(</span><span class="op" id="7686493">)</span><span class="op" id="7686494">)</span>&nbsp;<span class="op" id="7686496">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686501">t</span><span class="op" id="7686502">.</span><span class="ident" id="7686503">Fatalf</span><span class="op" id="7686509">(</span><span class="string" id="7686510">&#34;%T:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7686534">,</span>&nbsp;<span class="ident" id="7686536">value</span><span class="op" id="7686541">,</span>&nbsp;<span class="ident" id="7686543">value</span><span class="op" id="7686548">,</span>&nbsp;<span class="ident" id="7686550">result</span><span class="op" id="7686556">.</span><span class="ident" id="7686557">Elem</span><span class="op" id="7686561">(</span><span class="op" id="7686562">)</span><span class="op" id="7686563">.</span><span class="ident" id="7686564">Interface</span><span class="op" id="7686573">(</span><span class="op" id="7686574">)</span><span class="op" id="7686575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686579">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7686582">}</span><br>
<span class="lineno">55</span><span class="op" id="7686584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686587">type</span>&nbsp;<span class="ident" id="7686592">ET0</span>&nbsp;<span class="keyword" id="7686596">struct</span>&nbsp;<span class="op" id="7686603">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686606">A</span>&nbsp;<span class="builtintype" id="7686608">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686613">B</span>&nbsp;<span class="builtintype" id="7686615">string</span><br>
<span class="lineno">60</span><span class="op" id="7686622">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7686625">type</span>&nbsp;<span class="ident" id="7686630">ET2</span>&nbsp;<span class="keyword" id="7686634">struct</span>&nbsp;<span class="op" id="7686641">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686644">X</span>&nbsp;<span class="builtintype" id="7686646">string</span><br>
<span class="lineno"></span><span class="op" id="7686653">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="7686656">type</span>&nbsp;<span class="ident" id="7686661">ET1</span>&nbsp;<span class="keyword" id="7686665">struct</span>&nbsp;<span class="op" id="7686672">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686675">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7686680">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686685">Et2</span>&nbsp;&nbsp;<span class="op" id="7686690">*</span><span class="ident" id="7686691">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686696">Next</span>&nbsp;<span class="op" id="7686701">*</span><span class="ident" id="7686702">ET1</span><br>
<span class="lineno">70</span><span class="op" id="7686706">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7686709">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;name&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno"></span><span class="keyword" id="7686759">type</span>&nbsp;<span class="ident" id="7686764">ET3</span>&nbsp;<span class="keyword" id="7686768">struct</span>&nbsp;<span class="op" id="7686775">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686778">A</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7686792">int</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686797">Et2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="7686811">*</span><span class="ident" id="7686812">ET2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686817">DifferentNext</span>&nbsp;<span class="op" id="7686831">*</span><span class="ident" id="7686832">ET1</span><br>
<span class="lineno"></span><span class="op" id="7686836">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7686839">//&nbsp;Like&nbsp;ET1&nbsp;but&nbsp;with&nbsp;a&nbsp;different&nbsp;type&nbsp;for&nbsp;a&nbsp;field</span><br>
<span class="lineno">80</span><span class="keyword" id="7686889">type</span>&nbsp;<span class="ident" id="7686894">ET4</span>&nbsp;<span class="keyword" id="7686898">struct</span>&nbsp;<span class="op" id="7686905">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686908">A</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7686913">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686918">Et2</span>&nbsp;&nbsp;<span class="builtintype" id="7686923">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686932">Next</span>&nbsp;<span class="builtintype" id="7686937">int</span><br>
<span class="lineno"></span><span class="op" id="7686941">}</span><br>
<span class="lineno">85</span><br>
<span class="lineno"></span><span class="keyword" id="7686944">func</span>&nbsp;<span class="ident" id="7686949">TestEncoderDecoder</span><span class="op" id="7686967">(</span><span class="ident" id="7686968">t</span>&nbsp;<span class="op" id="7686970">*</span><span class="ident" id="7686971">testing</span><span class="op" id="7686978">.</span><span class="ident" id="7686979">T</span><span class="op" id="7686980">)</span>&nbsp;<span class="op" id="7686982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7686985">b</span>&nbsp;<span class="op" id="7686987">:=</span>&nbsp;<span class="builtinfunc" id="7686990">new</span><span class="op" id="7686993">(</span><span class="ident" id="7686994">bytes</span><span class="op" id="7686999">.</span><span class="ident" id="7687000">Buffer</span><span class="op" id="7687006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687009">enc</span>&nbsp;<span class="op" id="7687013">:=</span>&nbsp;<span class="ident" id="7687016">NewEncoder</span><span class="op" id="7687026">(</span><span class="ident" id="7687027">b</span><span class="op" id="7687028">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687031">et0</span>&nbsp;<span class="op" id="7687035">:=</span>&nbsp;<span class="builtinfunc" id="7687038">new</span><span class="op" id="7687041">(</span><span class="ident" id="7687042">ET0</span><span class="op" id="7687045">)</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687048">et0</span><span class="op" id="7687051">.</span><span class="ident" id="7687052">A</span>&nbsp;<span class="op" id="7687054">=</span>&nbsp;<span class="num" id="7687056">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687059">et0</span><span class="op" id="7687062">.</span><span class="ident" id="7687063">B</span>&nbsp;<span class="op" id="7687065">=</span>&nbsp;<span class="string" id="7687067">&#34;gobs&nbsp;of&nbsp;fun&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687082">err</span>&nbsp;<span class="op" id="7687086">:=</span>&nbsp;<span class="ident" id="7687089">enc</span><span class="op" id="7687092">.</span><span class="ident" id="7687093">Encode</span><span class="op" id="7687099">(</span><span class="ident" id="7687100">et0</span><span class="op" id="7687103">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687106">if</span>&nbsp;<span class="ident" id="7687109">err</span>&nbsp;<span class="op" id="7687113">!=</span>&nbsp;<span class="ident" id="7687116">nil</span>&nbsp;<span class="op" id="7687120">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687124">t</span><span class="op" id="7687125">.</span><span class="ident" id="7687126">Error</span><span class="op" id="7687131">(</span><span class="string" id="7687132">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7687147">,</span>&nbsp;<span class="ident" id="7687149">err</span><span class="op" id="7687152">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687155">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687158">//fmt.Printf(&#34;%&nbsp;x&nbsp;%q\n&#34;,&nbsp;b,&nbsp;b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687190">//Debug(b)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687202">dec</span>&nbsp;<span class="op" id="7687206">:=</span>&nbsp;<span class="ident" id="7687209">NewDecoder</span><span class="op" id="7687219">(</span><span class="ident" id="7687220">b</span><span class="op" id="7687221">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687224">newEt0</span>&nbsp;<span class="op" id="7687231">:=</span>&nbsp;<span class="builtinfunc" id="7687234">new</span><span class="op" id="7687237">(</span><span class="ident" id="7687238">ET0</span><span class="op" id="7687241">)</span><br>
<span class="lineno">100</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687244">err</span>&nbsp;<span class="op" id="7687248">=</span>&nbsp;<span class="ident" id="7687250">dec</span><span class="op" id="7687253">.</span><span class="ident" id="7687254">Decode</span><span class="op" id="7687260">(</span><span class="ident" id="7687261">newEt0</span><span class="op" id="7687267">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687270">if</span>&nbsp;<span class="ident" id="7687273">err</span>&nbsp;<span class="op" id="7687277">!=</span>&nbsp;<span class="ident" id="7687280">nil</span>&nbsp;<span class="op" id="7687284">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687288">t</span><span class="op" id="7687289">.</span><span class="ident" id="7687290">Fatal</span><span class="op" id="7687295">(</span><span class="string" id="7687296">&#34;error&nbsp;decoding&nbsp;ET0:&#34;</span><span class="op" id="7687317">,</span>&nbsp;<span class="ident" id="7687319">err</span><span class="op" id="7687322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687325">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687329">if</span>&nbsp;<span class="op" id="7687332">!</span><span class="ident" id="7687333">reflect</span><span class="op" id="7687340">.</span><span class="ident" id="7687341">DeepEqual</span><span class="op" id="7687350">(</span><span class="ident" id="7687351">et0</span><span class="op" id="7687354">,</span>&nbsp;<span class="ident" id="7687356">newEt0</span><span class="op" id="7687362">)</span>&nbsp;<span class="op" id="7687364">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687368">t</span><span class="op" id="7687369">.</span><span class="ident" id="7687370">Fatalf</span><span class="op" id="7687376">(</span><span class="string" id="7687377">&#34;invalid&nbsp;data&nbsp;for&nbsp;et0:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7687422">,</span>&nbsp;<span class="op" id="7687424">*</span><span class="ident" id="7687425">et0</span><span class="op" id="7687428">,</span>&nbsp;<span class="op" id="7687430">*</span><span class="ident" id="7687431">newEt0</span><span class="op" id="7687437">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687440">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687443">if</span>&nbsp;<span class="ident" id="7687446">b</span><span class="op" id="7687447">.</span><span class="ident" id="7687448">Len</span><span class="op" id="7687451">(</span><span class="op" id="7687452">)</span>&nbsp;<span class="op" id="7687454">!=</span>&nbsp;<span class="num" id="7687457">0</span>&nbsp;<span class="op" id="7687459">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687463">t</span><span class="op" id="7687464">.</span><span class="ident" id="7687465">Error</span><span class="op" id="7687470">(</span><span class="string" id="7687471">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7687484">,</span>&nbsp;<span class="ident" id="7687486">b</span><span class="op" id="7687487">.</span><span class="ident" id="7687488">Len</span><span class="op" id="7687491">(</span><span class="op" id="7687492">)</span><span class="op" id="7687493">,</span>&nbsp;<span class="string" id="7687495">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7687507">)</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687510">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7687513">//&nbsp;&nbsp;&nbsp;&nbspt.FailNow()</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687530">b</span>&nbsp;<span class="op" id="7687532">=</span>&nbsp;<span class="builtinfunc" id="7687534">new</span><span class="op" id="7687537">(</span><span class="ident" id="7687538">bytes</span><span class="op" id="7687543">.</span><span class="ident" id="7687544">Buffer</span><span class="op" id="7687550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687553">enc</span>&nbsp;<span class="op" id="7687557">=</span>&nbsp;<span class="ident" id="7687559">NewEncoder</span><span class="op" id="7687569">(</span><span class="ident" id="7687570">b</span><span class="op" id="7687571">)</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687574">et1</span>&nbsp;<span class="op" id="7687578">:=</span>&nbsp;<span class="builtinfunc" id="7687581">new</span><span class="op" id="7687584">(</span><span class="ident" id="7687585">ET1</span><span class="op" id="7687588">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687591">et1</span><span class="op" id="7687594">.</span><span class="ident" id="7687595">A</span>&nbsp;<span class="op" id="7687597">=</span>&nbsp;<span class="num" id="7687599">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687602">et1</span><span class="op" id="7687605">.</span><span class="ident" id="7687606">Et2</span>&nbsp;<span class="op" id="7687610">=</span>&nbsp;<span class="builtinfunc" id="7687612">new</span><span class="op" id="7687615">(</span><span class="ident" id="7687616">ET2</span><span class="op" id="7687619">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687622">err</span>&nbsp;<span class="op" id="7687626">=</span>&nbsp;<span class="ident" id="7687628">enc</span><span class="op" id="7687631">.</span><span class="ident" id="7687632">Encode</span><span class="op" id="7687638">(</span><span class="ident" id="7687639">et1</span><span class="op" id="7687642">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687645">if</span>&nbsp;<span class="ident" id="7687648">err</span>&nbsp;<span class="op" id="7687652">!=</span>&nbsp;<span class="ident" id="7687655">nil</span>&nbsp;<span class="op" id="7687659">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687663">t</span><span class="op" id="7687664">.</span><span class="ident" id="7687665">Error</span><span class="op" id="7687670">(</span><span class="string" id="7687671">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7687686">,</span>&nbsp;<span class="ident" id="7687688">err</span><span class="op" id="7687691">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687697">dec</span>&nbsp;<span class="op" id="7687701">=</span>&nbsp;<span class="ident" id="7687703">NewDecoder</span><span class="op" id="7687713">(</span><span class="ident" id="7687714">b</span><span class="op" id="7687715">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687718">newEt1</span>&nbsp;<span class="op" id="7687725">:=</span>&nbsp;<span class="builtinfunc" id="7687728">new</span><span class="op" id="7687731">(</span><span class="ident" id="7687732">ET1</span><span class="op" id="7687735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687738">err</span>&nbsp;<span class="op" id="7687742">=</span>&nbsp;<span class="ident" id="7687744">dec</span><span class="op" id="7687747">.</span><span class="ident" id="7687748">Decode</span><span class="op" id="7687754">(</span><span class="ident" id="7687755">newEt1</span><span class="op" id="7687761">)</span><br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687764">if</span>&nbsp;<span class="ident" id="7687767">err</span>&nbsp;<span class="op" id="7687771">!=</span>&nbsp;<span class="ident" id="7687774">nil</span>&nbsp;<span class="op" id="7687778">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687782">t</span><span class="op" id="7687783">.</span><span class="ident" id="7687784">Fatal</span><span class="op" id="7687789">(</span><span class="string" id="7687790">&#34;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7687811">,</span>&nbsp;<span class="ident" id="7687813">err</span><span class="op" id="7687816">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687819">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687823">if</span>&nbsp;<span class="op" id="7687826">!</span><span class="ident" id="7687827">reflect</span><span class="op" id="7687834">.</span><span class="ident" id="7687835">DeepEqual</span><span class="op" id="7687844">(</span><span class="ident" id="7687845">et1</span><span class="op" id="7687848">,</span>&nbsp;<span class="ident" id="7687850">newEt1</span><span class="op" id="7687856">)</span>&nbsp;<span class="op" id="7687858">{</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687862">t</span><span class="op" id="7687863">.</span><span class="ident" id="7687864">Fatalf</span><span class="op" id="7687870">(</span><span class="string" id="7687871">&#34;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7687916">,</span>&nbsp;<span class="op" id="7687918">*</span><span class="ident" id="7687919">et1</span><span class="op" id="7687922">,</span>&nbsp;<span class="op" id="7687924">*</span><span class="ident" id="7687925">newEt1</span><span class="op" id="7687931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7687934">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7687937">if</span>&nbsp;<span class="ident" id="7687940">b</span><span class="op" id="7687941">.</span><span class="ident" id="7687942">Len</span><span class="op" id="7687945">(</span><span class="op" id="7687946">)</span>&nbsp;<span class="op" id="7687948">!=</span>&nbsp;<span class="num" id="7687951">0</span>&nbsp;<span class="op" id="7687953">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7687957">t</span><span class="op" id="7687958">.</span><span class="ident" id="7687959">Error</span><span class="op" id="7687964">(</span><span class="string" id="7687965">&#34;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7687978">,</span>&nbsp;<span class="ident" id="7687980">b</span><span class="op" id="7687981">.</span><span class="ident" id="7687982">Len</span><span class="op" id="7687985">(</span><span class="op" id="7687986">)</span><span class="op" id="7687987">,</span>&nbsp;<span class="string" id="7687989">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7688001">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688004">}</span><br>
<span class="lineno">135</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688008">enc</span><span class="op" id="7688011">.</span><span class="ident" id="7688012">Encode</span><span class="op" id="7688018">(</span><span class="ident" id="7688019">et1</span><span class="op" id="7688022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688025">newEt1</span>&nbsp;<span class="op" id="7688032">=</span>&nbsp;<span class="builtinfunc" id="7688034">new</span><span class="op" id="7688037">(</span><span class="ident" id="7688038">ET1</span><span class="op" id="7688041">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688044">err</span>&nbsp;<span class="op" id="7688048">=</span>&nbsp;<span class="ident" id="7688050">dec</span><span class="op" id="7688053">.</span><span class="ident" id="7688054">Decode</span><span class="op" id="7688060">(</span><span class="ident" id="7688061">newEt1</span><span class="op" id="7688067">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688070">if</span>&nbsp;<span class="ident" id="7688073">err</span>&nbsp;<span class="op" id="7688077">!=</span>&nbsp;<span class="ident" id="7688080">nil</span>&nbsp;<span class="op" id="7688084">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688088">t</span><span class="op" id="7688089">.</span><span class="ident" id="7688090">Fatal</span><span class="op" id="7688095">(</span><span class="string" id="7688096">&#34;round&nbsp;2:&nbsp;error&nbsp;decoding&nbsp;ET1:&#34;</span><span class="op" id="7688126">,</span>&nbsp;<span class="ident" id="7688128">err</span><span class="op" id="7688131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688137">if</span>&nbsp;<span class="op" id="7688140">!</span><span class="ident" id="7688141">reflect</span><span class="op" id="7688148">.</span><span class="ident" id="7688149">DeepEqual</span><span class="op" id="7688158">(</span><span class="ident" id="7688159">et1</span><span class="op" id="7688162">,</span>&nbsp;<span class="ident" id="7688164">newEt1</span><span class="op" id="7688170">)</span>&nbsp;<span class="op" id="7688172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688176">t</span><span class="op" id="7688177">.</span><span class="ident" id="7688178">Fatalf</span><span class="op" id="7688184">(</span><span class="string" id="7688185">&#34;round&nbsp;2:&nbsp;invalid&nbsp;data&nbsp;for&nbsp;et1:&nbsp;expected&nbsp;%+v;&nbsp;got&nbsp;%+v&#34;</span><span class="op" id="7688239">,</span>&nbsp;<span class="op" id="7688241">*</span><span class="ident" id="7688242">et1</span><span class="op" id="7688245">,</span>&nbsp;<span class="op" id="7688247">*</span><span class="ident" id="7688248">newEt1</span><span class="op" id="7688254">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688257">}</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688260">if</span>&nbsp;<span class="ident" id="7688263">b</span><span class="op" id="7688264">.</span><span class="ident" id="7688265">Len</span><span class="op" id="7688268">(</span><span class="op" id="7688269">)</span>&nbsp;<span class="op" id="7688271">!=</span>&nbsp;<span class="num" id="7688274">0</span>&nbsp;<span class="op" id="7688276">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688280">t</span><span class="op" id="7688281">.</span><span class="ident" id="7688282">Error</span><span class="op" id="7688287">(</span><span class="string" id="7688288">&#34;round&nbsp;2:&nbsp;not&nbsp;at&nbsp;eof;&#34;</span><span class="op" id="7688310">,</span>&nbsp;<span class="ident" id="7688312">b</span><span class="op" id="7688313">.</span><span class="ident" id="7688314">Len</span><span class="op" id="7688317">(</span><span class="op" id="7688318">)</span><span class="op" id="7688319">,</span>&nbsp;<span class="string" id="7688321">&#34;bytes&nbsp;left&#34;</span><span class="op" id="7688333">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688336">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7688340">//&nbsp;Now&nbsp;test&nbsp;with&nbsp;a&nbsp;running&nbsp;encoder/decoder&nbsp;pair&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;type&nbsp;mismatch.</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688424">err</span>&nbsp;<span class="op" id="7688428">=</span>&nbsp;<span class="ident" id="7688430">enc</span><span class="op" id="7688433">.</span><span class="ident" id="7688434">Encode</span><span class="op" id="7688440">(</span><span class="ident" id="7688441">et1</span><span class="op" id="7688444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688447">if</span>&nbsp;<span class="ident" id="7688450">err</span>&nbsp;<span class="op" id="7688454">!=</span>&nbsp;<span class="ident" id="7688457">nil</span>&nbsp;<span class="op" id="7688461">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688465">t</span><span class="op" id="7688466">.</span><span class="ident" id="7688467">Error</span><span class="op" id="7688472">(</span><span class="string" id="7688473">&#34;round&nbsp;3:&nbsp;encoder&nbsp;fail:&#34;</span><span class="op" id="7688497">,</span>&nbsp;<span class="ident" id="7688499">err</span><span class="op" id="7688502">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688505">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688508">newEt2</span>&nbsp;<span class="op" id="7688515">:=</span>&nbsp;<span class="builtinfunc" id="7688518">new</span><span class="op" id="7688521">(</span><span class="ident" id="7688522">ET2</span><span class="op" id="7688525">)</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688528">err</span>&nbsp;<span class="op" id="7688532">=</span>&nbsp;<span class="ident" id="7688534">dec</span><span class="op" id="7688537">.</span><span class="ident" id="7688538">Decode</span><span class="op" id="7688544">(</span><span class="ident" id="7688545">newEt2</span><span class="op" id="7688551">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688554">if</span>&nbsp;<span class="ident" id="7688557">err</span>&nbsp;<span class="op" id="7688561">==</span>&nbsp;<span class="ident" id="7688564">nil</span>&nbsp;<span class="op" id="7688568">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688572">t</span><span class="op" id="7688573">.</span><span class="ident" id="7688574">Fatal</span><span class="op" id="7688579">(</span><span class="string" id="7688580">&#34;round&nbsp;3:&nbsp;expected&nbsp;`bad&nbsp;type&#39;&nbsp;error&nbsp;decoding&nbsp;ET2&#34;</span><span class="op" id="7688629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7688632">}</span><br>
<span class="lineno"></span><span class="op" id="7688634">}</span><br>
<span class="lineno">160</span><br>
<span class="lineno"></span><span class="comment" id="7688637">//&nbsp;Run&nbsp;one&nbsp;value&nbsp;through&nbsp;the&nbsp;encoder/decoder,&nbsp;but&nbsp;use&nbsp;the&nbsp;wrong&nbsp;type.</span><br>
<span class="lineno"></span><span class="comment" id="7688707">//&nbsp;Input&nbsp;is&nbsp;always&nbsp;an&nbsp;ET1;&nbsp;we&nbsp;compare&nbsp;it&nbsp;to&nbsp;whatever&nbsp;is&nbsp;under&nbsp;&#39;e&#39;.</span><br>
<span class="lineno"></span><span class="keyword" id="7688774">func</span>&nbsp;<span class="ident" id="7688779">badTypeCheck</span><span class="op" id="7688791">(</span><span class="ident" id="7688792">e</span>&nbsp;<span class="keyword" id="7688794">interface</span><span class="op" id="7688803">{</span><span class="op" id="7688804">}</span><span class="op" id="7688805">,</span>&nbsp;<span class="ident" id="7688807">shouldFail</span>&nbsp;<span class="builtintype" id="7688818">bool</span><span class="op" id="7688822">,</span>&nbsp;<span class="ident" id="7688824">msg</span>&nbsp;<span class="builtintype" id="7688828">string</span><span class="op" id="7688834">,</span>&nbsp;<span class="ident" id="7688836">t</span>&nbsp;<span class="op" id="7688838">*</span><span class="ident" id="7688839">testing</span><span class="op" id="7688846">.</span><span class="ident" id="7688847">T</span><span class="op" id="7688848">)</span>&nbsp;<span class="op" id="7688850">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688853">b</span>&nbsp;<span class="op" id="7688855">:=</span>&nbsp;<span class="builtinfunc" id="7688858">new</span><span class="op" id="7688861">(</span><span class="ident" id="7688862">bytes</span><span class="op" id="7688867">.</span><span class="ident" id="7688868">Buffer</span><span class="op" id="7688874">)</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688877">enc</span>&nbsp;<span class="op" id="7688881">:=</span>&nbsp;<span class="ident" id="7688884">NewEncoder</span><span class="op" id="7688894">(</span><span class="ident" id="7688895">b</span><span class="op" id="7688896">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688899">et1</span>&nbsp;<span class="op" id="7688903">:=</span>&nbsp;<span class="builtinfunc" id="7688906">new</span><span class="op" id="7688909">(</span><span class="ident" id="7688910">ET1</span><span class="op" id="7688913">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688916">et1</span><span class="op" id="7688919">.</span><span class="ident" id="7688920">A</span>&nbsp;<span class="op" id="7688922">=</span>&nbsp;<span class="num" id="7688924">7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688927">et1</span><span class="op" id="7688930">.</span><span class="ident" id="7688931">Et2</span>&nbsp;<span class="op" id="7688935">=</span>&nbsp;<span class="builtinfunc" id="7688937">new</span><span class="op" id="7688940">(</span><span class="ident" id="7688941">ET2</span><span class="op" id="7688944">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688947">err</span>&nbsp;<span class="op" id="7688951">:=</span>&nbsp;<span class="ident" id="7688954">enc</span><span class="op" id="7688957">.</span><span class="ident" id="7688958">Encode</span><span class="op" id="7688964">(</span><span class="ident" id="7688965">et1</span><span class="op" id="7688968">)</span><br>
<span class="lineno">170</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7688971">if</span>&nbsp;<span class="ident" id="7688974">err</span>&nbsp;<span class="op" id="7688978">!=</span>&nbsp;<span class="ident" id="7688981">nil</span>&nbsp;<span class="op" id="7688985">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7688989">t</span><span class="op" id="7688990">.</span><span class="ident" id="7688991">Error</span><span class="op" id="7688996">(</span><span class="string" id="7688997">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7689012">,</span>&nbsp;<span class="ident" id="7689014">err</span><span class="op" id="7689017">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689020">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689023">dec</span>&nbsp;<span class="op" id="7689027">:=</span>&nbsp;<span class="ident" id="7689030">NewDecoder</span><span class="op" id="7689040">(</span><span class="ident" id="7689041">b</span><span class="op" id="7689042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689045">err</span>&nbsp;<span class="op" id="7689049">=</span>&nbsp;<span class="ident" id="7689051">dec</span><span class="op" id="7689054">.</span><span class="ident" id="7689055">Decode</span><span class="op" id="7689061">(</span><span class="ident" id="7689062">e</span><span class="op" id="7689063">)</span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689066">if</span>&nbsp;<span class="ident" id="7689069">shouldFail</span>&nbsp;<span class="op" id="7689080">&amp;&amp;</span>&nbsp;<span class="ident" id="7689083">err</span>&nbsp;<span class="op" id="7689087">==</span>&nbsp;<span class="ident" id="7689090">nil</span>&nbsp;<span class="op" id="7689094">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689098">t</span><span class="op" id="7689099">.</span><span class="ident" id="7689100">Error</span><span class="op" id="7689105">(</span><span class="string" id="7689106">&#34;expected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7689126">,</span>&nbsp;<span class="ident" id="7689128">msg</span><span class="op" id="7689131">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689134">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689137">if</span>&nbsp;<span class="op" id="7689140">!</span><span class="ident" id="7689141">shouldFail</span>&nbsp;<span class="op" id="7689152">&amp;&amp;</span>&nbsp;<span class="ident" id="7689155">err</span>&nbsp;<span class="op" id="7689159">!=</span>&nbsp;<span class="ident" id="7689162">nil</span>&nbsp;<span class="op" id="7689166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689170">t</span><span class="op" id="7689171">.</span><span class="ident" id="7689172">Error</span><span class="op" id="7689177">(</span><span class="string" id="7689178">&#34;unexpected&nbsp;error&nbsp;for&#34;</span><span class="op" id="7689200">,</span>&nbsp;<span class="ident" id="7689202">msg</span><span class="op" id="7689205">,</span>&nbsp;<span class="ident" id="7689207">err</span><span class="op" id="7689210">)</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689213">}</span><br>
<span class="lineno"></span><span class="op" id="7689215">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7689218">//&nbsp;Test&nbsp;that&nbsp;we&nbsp;recognize&nbsp;a&nbsp;bad&nbsp;type&nbsp;the&nbsp;first&nbsp;time.</span><br>
<span class="lineno"></span><span class="keyword" id="7689271">func</span>&nbsp;<span class="ident" id="7689276">TestWrongTypeDecoder</span><span class="op" id="7689296">(</span><span class="ident" id="7689297">t</span>&nbsp;<span class="op" id="7689299">*</span><span class="ident" id="7689300">testing</span><span class="op" id="7689307">.</span><span class="ident" id="7689308">T</span><span class="op" id="7689309">)</span>&nbsp;<span class="op" id="7689311">{</span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689314">badTypeCheck</span><span class="op" id="7689326">(</span><span class="builtinfunc" id="7689327">new</span><span class="op" id="7689330">(</span><span class="ident" id="7689331">ET2</span><span class="op" id="7689334">)</span><span class="op" id="7689335">,</span>&nbsp;<span class="builtintype" id="7689337">true</span><span class="op" id="7689341">,</span>&nbsp;<span class="string" id="7689343">&#34;no&nbsp;fields&nbsp;in&nbsp;common&#34;</span><span class="op" id="7689364">,</span>&nbsp;<span class="ident" id="7689366">t</span><span class="op" id="7689367">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689370">badTypeCheck</span><span class="op" id="7689382">(</span><span class="builtinfunc" id="7689383">new</span><span class="op" id="7689386">(</span><span class="ident" id="7689387">ET3</span><span class="op" id="7689390">)</span><span class="op" id="7689391">,</span>&nbsp;<span class="builtintype" id="7689393">false</span><span class="op" id="7689398">,</span>&nbsp;<span class="string" id="7689400">&#34;different&nbsp;name&nbsp;of&nbsp;field&#34;</span><span class="op" id="7689425">,</span>&nbsp;<span class="ident" id="7689427">t</span><span class="op" id="7689428">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689431">badTypeCheck</span><span class="op" id="7689443">(</span><span class="builtinfunc" id="7689444">new</span><span class="op" id="7689447">(</span><span class="ident" id="7689448">ET4</span><span class="op" id="7689451">)</span><span class="op" id="7689452">,</span>&nbsp;<span class="builtintype" id="7689454">true</span><span class="op" id="7689458">,</span>&nbsp;<span class="string" id="7689460">&#34;different&nbsp;type&nbsp;of&nbsp;field&#34;</span><span class="op" id="7689485">,</span>&nbsp;<span class="ident" id="7689487">t</span><span class="op" id="7689488">)</span><br>
<span class="lineno"></span><span class="op" id="7689490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">190</span><span class="keyword" id="7689493">func</span>&nbsp;<span class="ident" id="7689498">corruptDataCheck</span><span class="op" id="7689514">(</span><span class="ident" id="7689515">s</span>&nbsp;<span class="builtintype" id="7689517">string</span><span class="op" id="7689523">,</span>&nbsp;<span class="ident" id="7689525">err</span>&nbsp;<span class="builtintype" id="7689529">error</span><span class="op" id="7689534">,</span>&nbsp;<span class="ident" id="7689536">t</span>&nbsp;<span class="op" id="7689538">*</span><span class="ident" id="7689539">testing</span><span class="op" id="7689546">.</span><span class="ident" id="7689547">T</span><span class="op" id="7689548">)</span>&nbsp;<span class="op" id="7689550">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689553">b</span>&nbsp;<span class="op" id="7689555">:=</span>&nbsp;<span class="ident" id="7689558">bytes</span><span class="op" id="7689563">.</span><span class="ident" id="7689564">NewBufferString</span><span class="op" id="7689579">(</span><span class="ident" id="7689580">s</span><span class="op" id="7689581">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689584">dec</span>&nbsp;<span class="op" id="7689588">:=</span>&nbsp;<span class="ident" id="7689591">NewDecoder</span><span class="op" id="7689601">(</span><span class="ident" id="7689602">b</span><span class="op" id="7689603">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689606">err1</span>&nbsp;<span class="op" id="7689611">:=</span>&nbsp;<span class="ident" id="7689614">dec</span><span class="op" id="7689617">.</span><span class="ident" id="7689618">Decode</span><span class="op" id="7689624">(</span><span class="builtinfunc" id="7689625">new</span><span class="op" id="7689628">(</span><span class="ident" id="7689629">ET2</span><span class="op" id="7689632">)</span><span class="op" id="7689633">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7689636">if</span>&nbsp;<span class="ident" id="7689639">err1</span>&nbsp;<span class="op" id="7689644">!=</span>&nbsp;<span class="ident" id="7689647">err</span>&nbsp;<span class="op" id="7689651">{</span><br>
<span class="lineno">195</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689655">t</span><span class="op" id="7689656">.</span><span class="ident" id="7689657">Errorf</span><span class="op" id="7689663">(</span><span class="string" id="7689664">&#34;from&nbsp;%q&nbsp;expected&nbsp;error&nbsp;%s;&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7689699">,</span>&nbsp;<span class="ident" id="7689701">s</span><span class="op" id="7689702">,</span>&nbsp;<span class="ident" id="7689704">err</span><span class="op" id="7689707">,</span>&nbsp;<span class="ident" id="7689709">err1</span><span class="op" id="7689713">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7689716">}</span><br>
<span class="lineno"></span><span class="op" id="7689718">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7689721">//&nbsp;Check&nbsp;that&nbsp;we&nbsp;survive&nbsp;bad&nbsp;data.</span><br>
<span class="lineno">200</span><span class="keyword" id="7689756">func</span>&nbsp;<span class="ident" id="7689761">TestBadData</span><span class="op" id="7689772">(</span><span class="ident" id="7689773">t</span>&nbsp;<span class="op" id="7689775">*</span><span class="ident" id="7689776">testing</span><span class="op" id="7689783">.</span><span class="ident" id="7689784">T</span><span class="op" id="7689785">)</span>&nbsp;<span class="op" id="7689787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689790">corruptDataCheck</span><span class="op" id="7689806">(</span><span class="string" id="7689807">&#34;&#34;</span><span class="op" id="7689809">,</span>&nbsp;<span class="ident" id="7689811">io</span><span class="op" id="7689813">.</span><span class="ident" id="7689814">EOF</span><span class="op" id="7689817">,</span>&nbsp;<span class="ident" id="7689819">t</span><span class="op" id="7689820">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689823">corruptDataCheck</span><span class="op" id="7689839">(</span><span class="string" id="7689840">&#34;\x7Fhi&#34;</span><span class="op" id="7689848">,</span>&nbsp;<span class="ident" id="7689850">io</span><span class="op" id="7689852">.</span><span class="ident" id="7689853">ErrUnexpectedEOF</span><span class="op" id="7689869">,</span>&nbsp;<span class="ident" id="7689871">t</span><span class="op" id="7689872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689875">corruptDataCheck</span><span class="op" id="7689891">(</span><span class="string" id="7689892">&#34;\x03now&nbsp;is&nbsp;the&nbsp;time&nbsp;for&nbsp;all&nbsp;good&nbsp;men&#34;</span><span class="op" id="7689930">,</span>&nbsp;<span class="ident" id="7689932">errBadType</span><span class="op" id="7689942">,</span>&nbsp;<span class="ident" id="7689944">t</span><span class="op" id="7689945">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7689948">//&nbsp;issue&nbsp;6323.</span><br>
<span class="lineno">205</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7689964">corruptDataCheck</span><span class="op" id="7689980">(</span><span class="string" id="7689981">&#34;\x04\x24foo&#34;</span><span class="op" id="7689994">,</span>&nbsp;<span class="ident" id="7689996">errRange</span><span class="op" id="7690004">,</span>&nbsp;<span class="ident" id="7690006">t</span><span class="op" id="7690007">)</span><br>
<span class="lineno"></span><span class="op" id="7690009">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7690012">//&nbsp;Types&nbsp;not&nbsp;supported&nbsp;at&nbsp;top&nbsp;level&nbsp;by&nbsp;the&nbsp;Encoder.</span><br>
<span class="lineno"></span><span class="keyword" id="7690064">var</span>&nbsp;<span class="ident" id="7690068">unsupportedValues</span>&nbsp;<span class="op" id="7690086">=</span>&nbsp;<span class="op" id="7690088">[</span><span class="op" id="7690089">]</span><span class="keyword" id="7690090">interface</span><span class="op" id="7690099">{</span><span class="op" id="7690100">}</span><span class="op" id="7690101">{</span><br>
<span class="lineno">210</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="builtinfunc" id="7690104">make</span><span class="op" id="7690108">(</span><span class="keyword" id="7690109">chan</span>&nbsp;<span class="builtintype" id="7690114">int</span><span class="op" id="7690117">)</span><span class="op" id="7690118">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690121">func</span><span class="op" id="7690125">(</span><span class="ident" id="7690126">a</span>&nbsp;<span class="builtintype" id="7690128">int</span><span class="op" id="7690131">)</span>&nbsp;<span class="builtintype" id="7690133">bool</span>&nbsp;<span class="op" id="7690138">{</span>&nbsp;<span class="keyword" id="7690140">return</span>&nbsp;<span class="builtintype" id="7690147">true</span>&nbsp;<span class="op" id="7690152">}</span><span class="op" id="7690153">,</span><br>
<span class="lineno"></span><span class="op" id="7690155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7690158">func</span>&nbsp;<span class="ident" id="7690163">TestUnsupported</span><span class="op" id="7690178">(</span><span class="ident" id="7690179">t</span>&nbsp;<span class="op" id="7690181">*</span><span class="ident" id="7690182">testing</span><span class="op" id="7690189">.</span><span class="ident" id="7690190">T</span><span class="op" id="7690191">)</span>&nbsp;<span class="op" id="7690193">{</span><br>
<span class="lineno">215</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690196">var</span>&nbsp;<span class="ident" id="7690200">b</span>&nbsp;<span class="ident" id="7690202">bytes</span><span class="op" id="7690207">.</span><span class="ident" id="7690208">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690216">enc</span>&nbsp;<span class="op" id="7690220">:=</span>&nbsp;<span class="ident" id="7690223">NewEncoder</span><span class="op" id="7690233">(</span><span class="op" id="7690234">&amp;</span><span class="ident" id="7690235">b</span><span class="op" id="7690236">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690239">for</span>&nbsp;<span class="ident" id="7690243">_</span><span class="op" id="7690244">,</span>&nbsp;<span class="ident" id="7690246">v</span>&nbsp;<span class="op" id="7690248">:=</span>&nbsp;<span class="keyword" id="7690251">range</span>&nbsp;<span class="ident" id="7690257">unsupportedValues</span>&nbsp;<span class="op" id="7690275">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690279">err</span>&nbsp;<span class="op" id="7690283">:=</span>&nbsp;<span class="ident" id="7690286">enc</span><span class="op" id="7690289">.</span><span class="ident" id="7690290">Encode</span><span class="op" id="7690296">(</span><span class="ident" id="7690297">v</span><span class="op" id="7690298">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690302">if</span>&nbsp;<span class="ident" id="7690305">err</span>&nbsp;<span class="op" id="7690309">==</span>&nbsp;<span class="ident" id="7690312">nil</span>&nbsp;<span class="op" id="7690316">{</span><br>
<span class="lineno">220</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690321">t</span><span class="op" id="7690322">.</span><span class="ident" id="7690323">Errorf</span><span class="op" id="7690329">(</span><span class="string" id="7690330">&#34;expected&nbsp;error&nbsp;for&nbsp;%T;&nbsp;got&nbsp;none&#34;</span><span class="op" id="7690363">,</span>&nbsp;<span class="ident" id="7690365">v</span><span class="op" id="7690366">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690370">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690373">}</span><br>
<span class="lineno"></span><span class="op" id="7690375">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">225</span><span class="keyword" id="7690378">func</span>&nbsp;<span class="ident" id="7690383">encAndDec</span><span class="op" id="7690392">(</span><span class="ident" id="7690393">in</span><span class="op" id="7690395">,</span>&nbsp;<span class="ident" id="7690397">out</span>&nbsp;<span class="keyword" id="7690401">interface</span><span class="op" id="7690410">{</span><span class="op" id="7690411">}</span><span class="op" id="7690412">)</span>&nbsp;<span class="builtintype" id="7690414">error</span>&nbsp;<span class="op" id="7690420">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690423">b</span>&nbsp;<span class="op" id="7690425">:=</span>&nbsp;<span class="builtinfunc" id="7690428">new</span><span class="op" id="7690431">(</span><span class="ident" id="7690432">bytes</span><span class="op" id="7690437">.</span><span class="ident" id="7690438">Buffer</span><span class="op" id="7690444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690447">enc</span>&nbsp;<span class="op" id="7690451">:=</span>&nbsp;<span class="ident" id="7690454">NewEncoder</span><span class="op" id="7690464">(</span><span class="ident" id="7690465">b</span><span class="op" id="7690466">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690469">err</span>&nbsp;<span class="op" id="7690473">:=</span>&nbsp;<span class="ident" id="7690476">enc</span><span class="op" id="7690479">.</span><span class="ident" id="7690480">Encode</span><span class="op" id="7690486">(</span><span class="ident" id="7690487">in</span><span class="op" id="7690489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690492">if</span>&nbsp;<span class="ident" id="7690495">err</span>&nbsp;<span class="op" id="7690499">!=</span>&nbsp;<span class="ident" id="7690502">nil</span>&nbsp;<span class="op" id="7690506">{</span><br>
<span class="lineno">230</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690510">return</span>&nbsp;<span class="ident" id="7690517">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690522">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690525">dec</span>&nbsp;<span class="op" id="7690529">:=</span>&nbsp;<span class="ident" id="7690532">NewDecoder</span><span class="op" id="7690542">(</span><span class="ident" id="7690543">b</span><span class="op" id="7690544">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690547">err</span>&nbsp;<span class="op" id="7690551">=</span>&nbsp;<span class="ident" id="7690553">dec</span><span class="op" id="7690556">.</span><span class="ident" id="7690557">Decode</span><span class="op" id="7690563">(</span><span class="ident" id="7690564">out</span><span class="op" id="7690567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690570">if</span>&nbsp;<span class="ident" id="7690573">err</span>&nbsp;<span class="op" id="7690577">!=</span>&nbsp;<span class="ident" id="7690580">nil</span>&nbsp;<span class="op" id="7690584">{</span><br>
<span class="lineno">235</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690588">return</span>&nbsp;<span class="ident" id="7690595">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690600">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690603">return</span>&nbsp;<span class="ident" id="7690610">nil</span><br>
<span class="lineno"></span><span class="op" id="7690614">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">240</span><span class="keyword" id="7690617">func</span>&nbsp;<span class="ident" id="7690622">TestTypeToPtrType</span><span class="op" id="7690639">(</span><span class="ident" id="7690640">t</span>&nbsp;<span class="op" id="7690642">*</span><span class="ident" id="7690643">testing</span><span class="op" id="7690650">.</span><span class="ident" id="7690651">T</span><span class="op" id="7690652">)</span>&nbsp;<span class="op" id="7690654">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7690657">//&nbsp;Encode&nbsp;a&nbsp;T,&nbsp;decode&nbsp;a&nbsp;*T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690685">type</span>&nbsp;<span class="ident" id="7690690">Type0</span>&nbsp;<span class="keyword" id="7690696">struct</span>&nbsp;<span class="op" id="7690703">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690707">A</span>&nbsp;<span class="builtintype" id="7690709">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690714">}</span><br>
<span class="lineno">245</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690717">t0</span>&nbsp;<span class="op" id="7690720">:=</span>&nbsp;<span class="ident" id="7690723">Type0</span><span class="op" id="7690728">{</span><span class="num" id="7690729">7</span><span class="op" id="7690730">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690733">t0p</span>&nbsp;<span class="op" id="7690737">:=</span>&nbsp;<span class="builtinfunc" id="7690740">new</span><span class="op" id="7690743">(</span><span class="ident" id="7690744">Type0</span><span class="op" id="7690749">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690752">if</span>&nbsp;<span class="ident" id="7690755">err</span>&nbsp;<span class="op" id="7690759">:=</span>&nbsp;<span class="ident" id="7690762">encAndDec</span><span class="op" id="7690771">(</span><span class="ident" id="7690772">t0</span><span class="op" id="7690774">,</span>&nbsp;<span class="ident" id="7690776">t0p</span><span class="op" id="7690779">)</span><span class="op" id="7690780">;</span>&nbsp;<span class="ident" id="7690782">err</span>&nbsp;<span class="op" id="7690786">!=</span>&nbsp;<span class="ident" id="7690789">nil</span>&nbsp;<span class="op" id="7690793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690797">t</span><span class="op" id="7690798">.</span><span class="ident" id="7690799">Error</span><span class="op" id="7690804">(</span><span class="ident" id="7690805">err</span><span class="op" id="7690808">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690811">}</span><br>
<span class="lineno">250</span><span class="op" id="7690813">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7690816">func</span>&nbsp;<span class="ident" id="7690821">TestPtrTypeToType</span><span class="op" id="7690838">(</span><span class="ident" id="7690839">t</span>&nbsp;<span class="op" id="7690841">*</span><span class="ident" id="7690842">testing</span><span class="op" id="7690849">.</span><span class="ident" id="7690850">T</span><span class="op" id="7690851">)</span>&nbsp;<span class="op" id="7690853">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7690856">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690884">type</span>&nbsp;<span class="ident" id="7690889">Type1</span>&nbsp;<span class="keyword" id="7690895">struct</span>&nbsp;<span class="op" id="7690902">{</span><br>
<span class="lineno">255</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690906">A</span>&nbsp;<span class="builtintype" id="7690908">uint</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7690914">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690917">t1p</span>&nbsp;<span class="op" id="7690921">:=</span>&nbsp;<span class="op" id="7690924">&amp;</span><span class="ident" id="7690925">Type1</span><span class="op" id="7690930">{</span><span class="num" id="7690931">17</span><span class="op" id="7690933">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690936">var</span>&nbsp;<span class="ident" id="7690940">t1</span>&nbsp;<span class="ident" id="7690943">Type1</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7690950">if</span>&nbsp;<span class="ident" id="7690953">err</span>&nbsp;<span class="op" id="7690957">:=</span>&nbsp;<span class="ident" id="7690960">encAndDec</span><span class="op" id="7690969">(</span><span class="ident" id="7690970">t1</span><span class="op" id="7690972">,</span>&nbsp;<span class="ident" id="7690974">t1p</span><span class="op" id="7690977">)</span><span class="op" id="7690978">;</span>&nbsp;<span class="ident" id="7690980">err</span>&nbsp;<span class="op" id="7690984">!=</span>&nbsp;<span class="ident" id="7690987">nil</span>&nbsp;<span class="op" id="7690991">{</span><br>
<span class="lineno">260</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7690995">t</span><span class="op" id="7690996">.</span><span class="ident" id="7690997">Error</span><span class="op" id="7691002">(</span><span class="ident" id="7691003">err</span><span class="op" id="7691006">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691009">}</span><br>
<span class="lineno"></span><span class="op" id="7691011">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7691014">func</span>&nbsp;<span class="ident" id="7691019">TestTypeToPtrPtrPtrPtrType</span><span class="op" id="7691045">(</span><span class="ident" id="7691046">t</span>&nbsp;<span class="op" id="7691048">*</span><span class="ident" id="7691049">testing</span><span class="op" id="7691056">.</span><span class="ident" id="7691057">T</span><span class="op" id="7691058">)</span>&nbsp;<span class="op" id="7691060">{</span><br>
<span class="lineno">265</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691063">type</span>&nbsp;<span class="ident" id="7691068">Type2</span>&nbsp;<span class="keyword" id="7691074">struct</span>&nbsp;<span class="op" id="7691081">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691085">A</span>&nbsp;<span class="op" id="7691087">*</span><span class="op" id="7691088">*</span><span class="op" id="7691089">*</span><span class="op" id="7691090">*</span><span class="builtintype" id="7691091">float64</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691100">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691103">t2</span>&nbsp;<span class="op" id="7691106">:=</span>&nbsp;<span class="ident" id="7691109">Type2</span><span class="op" id="7691114">{</span><span class="op" id="7691115">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691118">t2</span><span class="op" id="7691120">.</span><span class="ident" id="7691121">A</span>&nbsp;<span class="op" id="7691123">=</span>&nbsp;<span class="builtinfunc" id="7691125">new</span><span class="op" id="7691128">(</span><span class="op" id="7691129">*</span><span class="op" id="7691130">*</span><span class="op" id="7691131">*</span><span class="builtintype" id="7691132">float64</span><span class="op" id="7691139">)</span><br>
<span class="lineno">270</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691142">*</span><span class="ident" id="7691143">t2</span><span class="op" id="7691145">.</span><span class="ident" id="7691146">A</span>&nbsp;<span class="op" id="7691148">=</span>&nbsp;<span class="builtinfunc" id="7691150">new</span><span class="op" id="7691153">(</span><span class="op" id="7691154">*</span><span class="op" id="7691155">*</span><span class="builtintype" id="7691156">float64</span><span class="op" id="7691163">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691166">*</span><span class="op" id="7691167">*</span><span class="ident" id="7691168">t2</span><span class="op" id="7691170">.</span><span class="ident" id="7691171">A</span>&nbsp;<span class="op" id="7691173">=</span>&nbsp;<span class="builtinfunc" id="7691175">new</span><span class="op" id="7691178">(</span><span class="op" id="7691179">*</span><span class="builtintype" id="7691180">float64</span><span class="op" id="7691187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691190">*</span><span class="op" id="7691191">*</span><span class="op" id="7691192">*</span><span class="ident" id="7691193">t2</span><span class="op" id="7691195">.</span><span class="ident" id="7691196">A</span>&nbsp;<span class="op" id="7691198">=</span>&nbsp;<span class="builtinfunc" id="7691200">new</span><span class="op" id="7691203">(</span><span class="builtintype" id="7691204">float64</span><span class="op" id="7691211">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691214">*</span><span class="op" id="7691215">*</span><span class="op" id="7691216">*</span><span class="op" id="7691217">*</span><span class="ident" id="7691218">t2</span><span class="op" id="7691220">.</span><span class="ident" id="7691221">A</span>&nbsp;<span class="op" id="7691223">=</span>&nbsp;<span class="num" id="7691225">27.4</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691231">t2pppp</span>&nbsp;<span class="op" id="7691238">:=</span>&nbsp;<span class="builtinfunc" id="7691241">new</span><span class="op" id="7691244">(</span><span class="op" id="7691245">*</span><span class="op" id="7691246">*</span><span class="op" id="7691247">*</span><span class="ident" id="7691248">Type2</span><span class="op" id="7691253">)</span><br>
<span class="lineno">275</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691256">if</span>&nbsp;<span class="ident" id="7691259">err</span>&nbsp;<span class="op" id="7691263">:=</span>&nbsp;<span class="ident" id="7691266">encAndDec</span><span class="op" id="7691275">(</span><span class="ident" id="7691276">t2</span><span class="op" id="7691278">,</span>&nbsp;<span class="ident" id="7691280">t2pppp</span><span class="op" id="7691286">)</span><span class="op" id="7691287">;</span>&nbsp;<span class="ident" id="7691289">err</span>&nbsp;<span class="op" id="7691293">!=</span>&nbsp;<span class="ident" id="7691296">nil</span>&nbsp;<span class="op" id="7691300">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691304">t</span><span class="op" id="7691305">.</span><span class="ident" id="7691306">Fatal</span><span class="op" id="7691311">(</span><span class="ident" id="7691312">err</span><span class="op" id="7691315">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691318">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691321">if</span>&nbsp;<span class="op" id="7691324">*</span><span class="op" id="7691325">*</span><span class="op" id="7691326">*</span><span class="op" id="7691327">*</span><span class="op" id="7691328">(</span><span class="op" id="7691329">*</span><span class="op" id="7691330">*</span><span class="op" id="7691331">*</span><span class="op" id="7691332">*</span><span class="ident" id="7691333">t2pppp</span><span class="op" id="7691339">)</span><span class="op" id="7691340">.</span><span class="ident" id="7691341">A</span>&nbsp;<span class="op" id="7691343">!=</span>&nbsp;<span class="op" id="7691346">*</span><span class="op" id="7691347">*</span><span class="op" id="7691348">*</span><span class="op" id="7691349">*</span><span class="ident" id="7691350">t2</span><span class="op" id="7691352">.</span><span class="ident" id="7691353">A</span>&nbsp;<span class="op" id="7691355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691359">t</span><span class="op" id="7691360">.</span><span class="ident" id="7691361">Errorf</span><span class="op" id="7691367">(</span><span class="string" id="7691368">&#34;wrong&nbsp;value&nbsp;after&nbsp;decode:&nbsp;%g&nbsp;not&nbsp;%g&#34;</span><span class="op" id="7691405">,</span>&nbsp;<span class="op" id="7691407">*</span><span class="op" id="7691408">*</span><span class="op" id="7691409">*</span><span class="op" id="7691410">*</span><span class="op" id="7691411">(</span><span class="op" id="7691412">*</span><span class="op" id="7691413">*</span><span class="op" id="7691414">*</span><span class="op" id="7691415">*</span><span class="ident" id="7691416">t2pppp</span><span class="op" id="7691422">)</span><span class="op" id="7691423">.</span><span class="ident" id="7691424">A</span><span class="op" id="7691425">,</span>&nbsp;<span class="op" id="7691427">*</span><span class="op" id="7691428">*</span><span class="op" id="7691429">*</span><span class="op" id="7691430">*</span><span class="ident" id="7691431">t2</span><span class="op" id="7691433">.</span><span class="ident" id="7691434">A</span><span class="op" id="7691435">)</span><br>
<span class="lineno">280</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691438">}</span><br>
<span class="lineno"></span><span class="op" id="7691440">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7691443">func</span>&nbsp;<span class="ident" id="7691448">TestSlice</span><span class="op" id="7691457">(</span><span class="ident" id="7691458">t</span>&nbsp;<span class="op" id="7691460">*</span><span class="ident" id="7691461">testing</span><span class="op" id="7691468">.</span><span class="ident" id="7691469">T</span><span class="op" id="7691470">)</span>&nbsp;<span class="op" id="7691472">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691475">type</span>&nbsp;<span class="ident" id="7691480">Type3</span>&nbsp;<span class="keyword" id="7691486">struct</span>&nbsp;<span class="op" id="7691493">{</span><br>
<span class="lineno">285</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691497">A</span>&nbsp;<span class="op" id="7691499">[</span><span class="op" id="7691500">]</span><span class="builtintype" id="7691501">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691509">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691512">t3p</span>&nbsp;<span class="op" id="7691516">:=</span>&nbsp;<span class="op" id="7691519">&amp;</span><span class="ident" id="7691520">Type3</span><span class="op" id="7691525">{</span><span class="op" id="7691526">[</span><span class="op" id="7691527">]</span><span class="builtintype" id="7691528">string</span><span class="op" id="7691534">{</span><span class="string" id="7691535">&#34;hello&#34;</span><span class="op" id="7691542">,</span>&nbsp;<span class="string" id="7691544">&#34;world&#34;</span><span class="op" id="7691551">}</span><span class="op" id="7691552">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691555">var</span>&nbsp;<span class="ident" id="7691559">t3</span>&nbsp;<span class="ident" id="7691562">Type3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691569">if</span>&nbsp;<span class="ident" id="7691572">err</span>&nbsp;<span class="op" id="7691576">:=</span>&nbsp;<span class="ident" id="7691579">encAndDec</span><span class="op" id="7691588">(</span><span class="ident" id="7691589">t3</span><span class="op" id="7691591">,</span>&nbsp;<span class="ident" id="7691593">t3p</span><span class="op" id="7691596">)</span><span class="op" id="7691597">;</span>&nbsp;<span class="ident" id="7691599">err</span>&nbsp;<span class="op" id="7691603">!=</span>&nbsp;<span class="ident" id="7691606">nil</span>&nbsp;<span class="op" id="7691610">{</span><br>
<span class="lineno">290</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691614">t</span><span class="op" id="7691615">.</span><span class="ident" id="7691616">Error</span><span class="op" id="7691621">(</span><span class="ident" id="7691622">err</span><span class="op" id="7691625">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691628">}</span><br>
<span class="lineno"></span><span class="op" id="7691630">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7691633">func</span>&nbsp;<span class="ident" id="7691638">TestValueError</span><span class="op" id="7691652">(</span><span class="ident" id="7691653">t</span>&nbsp;<span class="op" id="7691655">*</span><span class="ident" id="7691656">testing</span><span class="op" id="7691663">.</span><span class="ident" id="7691664">T</span><span class="op" id="7691665">)</span>&nbsp;<span class="op" id="7691667">{</span><br>
<span class="lineno">295</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7691670">//&nbsp;Encode&nbsp;a&nbsp;*T,&nbsp;decode&nbsp;a&nbsp;T</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691698">type</span>&nbsp;<span class="ident" id="7691703">Type4</span>&nbsp;<span class="keyword" id="7691709">struct</span>&nbsp;<span class="op" id="7691716">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691720">A</span>&nbsp;<span class="builtintype" id="7691722">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691727">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691730">t4p</span>&nbsp;<span class="op" id="7691734">:=</span>&nbsp;<span class="op" id="7691737">&amp;</span><span class="ident" id="7691738">Type4</span><span class="op" id="7691743">{</span><span class="num" id="7691744">3</span><span class="op" id="7691745">}</span><br>
<span class="lineno">300</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691748">var</span>&nbsp;<span class="ident" id="7691752">t4</span>&nbsp;<span class="ident" id="7691755">Type4</span>&nbsp;<span class="comment" id="7691761">//&nbsp;note:&nbsp;not&nbsp;a&nbsp;pointer.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691786">if</span>&nbsp;<span class="ident" id="7691789">err</span>&nbsp;<span class="op" id="7691793">:=</span>&nbsp;<span class="ident" id="7691796">encAndDec</span><span class="op" id="7691805">(</span><span class="ident" id="7691806">t4p</span><span class="op" id="7691809">,</span>&nbsp;<span class="ident" id="7691811">t4</span><span class="op" id="7691813">)</span><span class="op" id="7691814">;</span>&nbsp;<span class="ident" id="7691816">err</span>&nbsp;<span class="op" id="7691820">==</span>&nbsp;<span class="ident" id="7691823">nil</span>&nbsp;<span class="op" id="7691827">||</span>&nbsp;<span class="ident" id="7691830">strings</span><span class="op" id="7691837">.</span><span class="ident" id="7691838">Index</span><span class="op" id="7691843">(</span><span class="ident" id="7691844">err</span><span class="op" id="7691847">.</span><span class="ident" id="7691848">Error</span><span class="op" id="7691853">(</span><span class="op" id="7691854">)</span><span class="op" id="7691855">,</span>&nbsp;<span class="string" id="7691857">&#34;pointer&#34;</span><span class="op" id="7691866">)</span>&nbsp;<span class="op" id="7691868">&lt;</span>&nbsp;<span class="num" id="7691870">0</span>&nbsp;<span class="op" id="7691872">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691876">t</span><span class="op" id="7691877">.</span><span class="ident" id="7691878">Error</span><span class="op" id="7691883">(</span><span class="string" id="7691884">&#34;expected&nbsp;error&nbsp;about&nbsp;pointer;&nbsp;got&#34;</span><span class="op" id="7691919">,</span>&nbsp;<span class="ident" id="7691921">err</span><span class="op" id="7691924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7691927">}</span><br>
<span class="lineno"></span><span class="op" id="7691929">}</span><br>
<span class="lineno">305</span><br>
<span class="lineno"></span><span class="keyword" id="7691932">func</span>&nbsp;<span class="ident" id="7691937">TestArray</span><span class="op" id="7691946">(</span><span class="ident" id="7691947">t</span>&nbsp;<span class="op" id="7691949">*</span><span class="ident" id="7691950">testing</span><span class="op" id="7691957">.</span><span class="ident" id="7691958">T</span><span class="op" id="7691959">)</span>&nbsp;<span class="op" id="7691961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7691964">type</span>&nbsp;<span class="ident" id="7691969">Type5</span>&nbsp;<span class="keyword" id="7691975">struct</span>&nbsp;<span class="op" id="7691982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7691986">A</span>&nbsp;<span class="op" id="7691988">[</span><span class="num" id="7691989">3</span><span class="op" id="7691990">]</span><span class="builtintype" id="7691991">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692000">B</span>&nbsp;<span class="op" id="7692002">[</span><span class="num" id="7692003">3</span><span class="op" id="7692004">]</span><span class="builtintype" id="7692005">byte</span><br>
<span class="lineno">310</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692011">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692014">type</span>&nbsp;<span class="ident" id="7692019">Type6</span>&nbsp;<span class="keyword" id="7692025">struct</span>&nbsp;<span class="op" id="7692032">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692036">A</span>&nbsp;<span class="op" id="7692038">[</span><span class="num" id="7692039">2</span><span class="op" id="7692040">]</span><span class="builtintype" id="7692041">string</span>&nbsp;<span class="comment" id="7692048">//&nbsp;can&#39;t&nbsp;hold&nbsp;t5.a</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692068">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692071">t5</span>&nbsp;<span class="op" id="7692074">:=</span>&nbsp;<span class="ident" id="7692077">Type5</span><span class="op" id="7692082">{</span><span class="op" id="7692083">[</span><span class="num" id="7692084">3</span><span class="op" id="7692085">]</span><span class="builtintype" id="7692086">string</span><span class="op" id="7692092">{</span><span class="string" id="7692093">&#34;hello&#34;</span><span class="op" id="7692100">,</span>&nbsp;<span class="string" id="7692102">&#34;,&#34;</span><span class="op" id="7692105">,</span>&nbsp;<span class="string" id="7692107">&#34;world&#34;</span><span class="op" id="7692114">}</span><span class="op" id="7692115">,</span>&nbsp;<span class="op" id="7692117">[</span><span class="num" id="7692118">3</span><span class="op" id="7692119">]</span><span class="builtintype" id="7692120">byte</span><span class="op" id="7692124">{</span><span class="num" id="7692125">1</span><span class="op" id="7692126">,</span>&nbsp;<span class="num" id="7692128">2</span><span class="op" id="7692129">,</span>&nbsp;<span class="num" id="7692131">3</span><span class="op" id="7692132">}</span><span class="op" id="7692133">}</span><br>
<span class="lineno">315</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692136">var</span>&nbsp;<span class="ident" id="7692140">t5p</span>&nbsp;<span class="ident" id="7692144">Type5</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692151">if</span>&nbsp;<span class="ident" id="7692154">err</span>&nbsp;<span class="op" id="7692158">:=</span>&nbsp;<span class="ident" id="7692161">encAndDec</span><span class="op" id="7692170">(</span><span class="ident" id="7692171">t5</span><span class="op" id="7692173">,</span>&nbsp;<span class="op" id="7692175">&amp;</span><span class="ident" id="7692176">t5p</span><span class="op" id="7692179">)</span><span class="op" id="7692180">;</span>&nbsp;<span class="ident" id="7692182">err</span>&nbsp;<span class="op" id="7692186">!=</span>&nbsp;<span class="ident" id="7692189">nil</span>&nbsp;<span class="op" id="7692193">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692197">t</span><span class="op" id="7692198">.</span><span class="ident" id="7692199">Error</span><span class="op" id="7692204">(</span><span class="ident" id="7692205">err</span><span class="op" id="7692208">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692211">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692214">var</span>&nbsp;<span class="ident" id="7692218">t6</span>&nbsp;<span class="ident" id="7692221">Type6</span><br>
<span class="lineno">320</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692228">if</span>&nbsp;<span class="ident" id="7692231">err</span>&nbsp;<span class="op" id="7692235">:=</span>&nbsp;<span class="ident" id="7692238">encAndDec</span><span class="op" id="7692247">(</span><span class="ident" id="7692248">t5</span><span class="op" id="7692250">,</span>&nbsp;<span class="op" id="7692252">&amp;</span><span class="ident" id="7692253">t6</span><span class="op" id="7692255">)</span><span class="op" id="7692256">;</span>&nbsp;<span class="ident" id="7692258">err</span>&nbsp;<span class="op" id="7692262">==</span>&nbsp;<span class="ident" id="7692265">nil</span>&nbsp;<span class="op" id="7692269">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692273">t</span><span class="op" id="7692274">.</span><span class="ident" id="7692275">Error</span><span class="op" id="7692280">(</span><span class="string" id="7692281">&#34;should&nbsp;fail&nbsp;with&nbsp;mismatched&nbsp;array&nbsp;sizes&#34;</span><span class="op" id="7692322">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692325">}</span><br>
<span class="lineno"></span><span class="op" id="7692327">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">325</span><span class="keyword" id="7692330">func</span>&nbsp;<span class="ident" id="7692335">TestRecursiveMapType</span><span class="op" id="7692355">(</span><span class="ident" id="7692356">t</span>&nbsp;<span class="op" id="7692358">*</span><span class="ident" id="7692359">testing</span><span class="op" id="7692366">.</span><span class="ident" id="7692367">T</span><span class="op" id="7692368">)</span>&nbsp;<span class="op" id="7692370">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692373">type</span>&nbsp;<span class="ident" id="7692378">recursiveMap</span>&nbsp;<span class="keyword" id="7692391">map</span><span class="op" id="7692394">[</span><span class="builtintype" id="7692395">string</span><span class="op" id="7692401">]</span><span class="ident" id="7692402">recursiveMap</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692416">r1</span>&nbsp;<span class="op" id="7692419">:=</span>&nbsp;<span class="ident" id="7692422">recursiveMap</span><span class="op" id="7692434">{</span><span class="string" id="7692435">&#34;A&#34;</span><span class="op" id="7692438">:</span>&nbsp;<span class="ident" id="7692440">recursiveMap</span><span class="op" id="7692452">{</span><span class="string" id="7692453">&#34;B&#34;</span><span class="op" id="7692456">:</span>&nbsp;<span class="ident" id="7692458">nil</span><span class="op" id="7692461">,</span>&nbsp;<span class="string" id="7692463">&#34;C&#34;</span><span class="op" id="7692466">:</span>&nbsp;<span class="ident" id="7692468">nil</span><span class="op" id="7692471">}</span><span class="op" id="7692472">,</span>&nbsp;<span class="string" id="7692474">&#34;D&#34;</span><span class="op" id="7692477">:</span>&nbsp;<span class="ident" id="7692479">nil</span><span class="op" id="7692482">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692485">r2</span>&nbsp;<span class="op" id="7692488">:=</span>&nbsp;<span class="builtinfunc" id="7692491">make</span><span class="op" id="7692495">(</span><span class="ident" id="7692496">recursiveMap</span><span class="op" id="7692508">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692511">if</span>&nbsp;<span class="ident" id="7692514">err</span>&nbsp;<span class="op" id="7692518">:=</span>&nbsp;<span class="ident" id="7692521">encAndDec</span><span class="op" id="7692530">(</span><span class="ident" id="7692531">r1</span><span class="op" id="7692533">,</span>&nbsp;<span class="op" id="7692535">&amp;</span><span class="ident" id="7692536">r2</span><span class="op" id="7692538">)</span><span class="op" id="7692539">;</span>&nbsp;<span class="ident" id="7692541">err</span>&nbsp;<span class="op" id="7692545">!=</span>&nbsp;<span class="ident" id="7692548">nil</span>&nbsp;<span class="op" id="7692552">{</span><br>
<span class="lineno">330</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692556">t</span><span class="op" id="7692557">.</span><span class="ident" id="7692558">Error</span><span class="op" id="7692563">(</span><span class="ident" id="7692564">err</span><span class="op" id="7692567">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692570">}</span><br>
<span class="lineno"></span><span class="op" id="7692572">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7692575">func</span>&nbsp;<span class="ident" id="7692580">TestRecursiveSliceType</span><span class="op" id="7692602">(</span><span class="ident" id="7692603">t</span>&nbsp;<span class="op" id="7692605">*</span><span class="ident" id="7692606">testing</span><span class="op" id="7692613">.</span><span class="ident" id="7692614">T</span><span class="op" id="7692615">)</span>&nbsp;<span class="op" id="7692617">{</span><br>
<span class="lineno">335</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692620">type</span>&nbsp;<span class="ident" id="7692625">recursiveSlice</span>&nbsp;<span class="op" id="7692640">[</span><span class="op" id="7692641">]</span><span class="ident" id="7692642">recursiveSlice</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692658">r1</span>&nbsp;<span class="op" id="7692661">:=</span>&nbsp;<span class="ident" id="7692664">recursiveSlice</span><span class="op" id="7692678">{</span><span class="num" id="7692679">0</span><span class="op" id="7692680">:</span>&nbsp;<span class="ident" id="7692682">recursiveSlice</span><span class="op" id="7692696">{</span><span class="num" id="7692697">0</span><span class="op" id="7692698">:</span>&nbsp;<span class="ident" id="7692700">nil</span><span class="op" id="7692703">}</span><span class="op" id="7692704">,</span>&nbsp;<span class="num" id="7692706">1</span><span class="op" id="7692707">:</span>&nbsp;<span class="ident" id="7692709">nil</span><span class="op" id="7692712">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692715">r2</span>&nbsp;<span class="op" id="7692718">:=</span>&nbsp;<span class="builtinfunc" id="7692721">make</span><span class="op" id="7692725">(</span><span class="ident" id="7692726">recursiveSlice</span><span class="op" id="7692740">,</span>&nbsp;<span class="num" id="7692742">0</span><span class="op" id="7692743">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692746">if</span>&nbsp;<span class="ident" id="7692749">err</span>&nbsp;<span class="op" id="7692753">:=</span>&nbsp;<span class="ident" id="7692756">encAndDec</span><span class="op" id="7692765">(</span><span class="ident" id="7692766">r1</span><span class="op" id="7692768">,</span>&nbsp;<span class="op" id="7692770">&amp;</span><span class="ident" id="7692771">r2</span><span class="op" id="7692773">)</span><span class="op" id="7692774">;</span>&nbsp;<span class="ident" id="7692776">err</span>&nbsp;<span class="op" id="7692780">!=</span>&nbsp;<span class="ident" id="7692783">nil</span>&nbsp;<span class="op" id="7692787">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692791">t</span><span class="op" id="7692792">.</span><span class="ident" id="7692793">Error</span><span class="op" id="7692798">(</span><span class="ident" id="7692799">err</span><span class="op" id="7692802">)</span><br>
<span class="lineno">340</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692805">}</span><br>
<span class="lineno"></span><span class="op" id="7692807">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7692810">//&nbsp;Regression&nbsp;test&nbsp;for&nbsp;bug:&nbsp;must&nbsp;send&nbsp;zero&nbsp;values&nbsp;inside&nbsp;arrays</span><br>
<span class="lineno"></span><span class="keyword" id="7692874">func</span>&nbsp;<span class="ident" id="7692879">TestDefaultsInArray</span><span class="op" id="7692898">(</span><span class="ident" id="7692899">t</span>&nbsp;<span class="op" id="7692901">*</span><span class="ident" id="7692902">testing</span><span class="op" id="7692909">.</span><span class="ident" id="7692910">T</span><span class="op" id="7692911">)</span>&nbsp;<span class="op" id="7692913">{</span><br>
<span class="lineno">345</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7692916">type</span>&nbsp;<span class="ident" id="7692921">Type7</span>&nbsp;<span class="keyword" id="7692927">struct</span>&nbsp;<span class="op" id="7692934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692938">B</span>&nbsp;<span class="op" id="7692940">[</span><span class="op" id="7692941">]</span><span class="builtintype" id="7692942">bool</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692949">I</span>&nbsp;<span class="op" id="7692951">[</span><span class="op" id="7692952">]</span><span class="builtintype" id="7692953">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692959">S</span>&nbsp;<span class="op" id="7692961">[</span><span class="op" id="7692962">]</span><span class="builtintype" id="7692963">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692972">F</span>&nbsp;<span class="op" id="7692974">[</span><span class="op" id="7692975">]</span><span class="builtintype" id="7692976">float64</span><br>
<span class="lineno">350</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7692985">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7692988">t7</span>&nbsp;<span class="op" id="7692991">:=</span>&nbsp;<span class="ident" id="7692994">Type7</span><span class="op" id="7692999">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693003">[</span><span class="op" id="7693004">]</span><span class="builtintype" id="7693005">bool</span><span class="op" id="7693009">{</span><span class="builtintype" id="7693010">false</span><span class="op" id="7693015">,</span>&nbsp;<span class="builtintype" id="7693017">false</span><span class="op" id="7693022">,</span>&nbsp;<span class="builtintype" id="7693024">true</span><span class="op" id="7693028">}</span><span class="op" id="7693029">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693033">[</span><span class="op" id="7693034">]</span><span class="builtintype" id="7693035">int</span><span class="op" id="7693038">{</span><span class="num" id="7693039">0</span><span class="op" id="7693040">,</span>&nbsp;<span class="num" id="7693042">0</span><span class="op" id="7693043">,</span>&nbsp;<span class="num" id="7693045">1</span><span class="op" id="7693046">}</span><span class="op" id="7693047">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693051">[</span><span class="op" id="7693052">]</span><span class="builtintype" id="7693053">string</span><span class="op" id="7693059">{</span><span class="string" id="7693060">&#34;hi&#34;</span><span class="op" id="7693064">,</span>&nbsp;<span class="string" id="7693066">&#34;&#34;</span><span class="op" id="7693068">,</span>&nbsp;<span class="string" id="7693070">&#34;there&#34;</span><span class="op" id="7693077">}</span><span class="op" id="7693078">,</span><br>
<span class="lineno">355</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693082">[</span><span class="op" id="7693083">]</span><span class="builtintype" id="7693084">float64</span><span class="op" id="7693091">{</span><span class="num" id="7693092">0</span><span class="op" id="7693093">,</span>&nbsp;<span class="num" id="7693095">0</span><span class="op" id="7693096">,</span>&nbsp;<span class="num" id="7693098">1</span><span class="op" id="7693099">}</span><span class="op" id="7693100">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693103">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693106">var</span>&nbsp;<span class="ident" id="7693110">t7p</span>&nbsp;<span class="ident" id="7693114">Type7</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693121">if</span>&nbsp;<span class="ident" id="7693124">err</span>&nbsp;<span class="op" id="7693128">:=</span>&nbsp;<span class="ident" id="7693131">encAndDec</span><span class="op" id="7693140">(</span><span class="ident" id="7693141">t7</span><span class="op" id="7693143">,</span>&nbsp;<span class="op" id="7693145">&amp;</span><span class="ident" id="7693146">t7p</span><span class="op" id="7693149">)</span><span class="op" id="7693150">;</span>&nbsp;<span class="ident" id="7693152">err</span>&nbsp;<span class="op" id="7693156">!=</span>&nbsp;<span class="ident" id="7693159">nil</span>&nbsp;<span class="op" id="7693163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693167">t</span><span class="op" id="7693168">.</span><span class="ident" id="7693169">Error</span><span class="op" id="7693174">(</span><span class="ident" id="7693175">err</span><span class="op" id="7693178">)</span><br>
<span class="lineno">360</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693181">}</span><br>
<span class="lineno"></span><span class="op" id="7693183">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7693186">var</span>&nbsp;<span class="ident" id="7693190">testInt</span>&nbsp;<span class="builtintype" id="7693198">int</span><br>
<span class="lineno"></span><span class="keyword" id="7693202">var</span>&nbsp;<span class="ident" id="7693206">testFloat32</span>&nbsp;<span class="builtintype" id="7693218">float32</span><br>
<span class="lineno">365</span><span class="keyword" id="7693226">var</span>&nbsp;<span class="ident" id="7693230">testString</span>&nbsp;<span class="builtintype" id="7693241">string</span><br>
<span class="lineno"></span><span class="keyword" id="7693248">var</span>&nbsp;<span class="ident" id="7693252">testSlice</span>&nbsp;<span class="op" id="7693262">[</span><span class="op" id="7693263">]</span><span class="builtintype" id="7693264">string</span><br>
<span class="lineno"></span><span class="keyword" id="7693271">var</span>&nbsp;<span class="ident" id="7693275">testMap</span>&nbsp;<span class="keyword" id="7693283">map</span><span class="op" id="7693286">[</span><span class="builtintype" id="7693287">string</span><span class="op" id="7693293">]</span><span class="builtintype" id="7693294">int</span><br>
<span class="lineno"></span><span class="keyword" id="7693298">var</span>&nbsp;<span class="ident" id="7693302">testArray</span>&nbsp;<span class="op" id="7693312">[</span><span class="num" id="7693313">7</span><span class="op" id="7693314">]</span><span class="builtintype" id="7693315">int</span><br>
<span class="lineno"></span><br>
<span class="lineno">370</span><span class="keyword" id="7693320">type</span>&nbsp;<span class="ident" id="7693325">SingleTest</span>&nbsp;<span class="keyword" id="7693336">struct</span>&nbsp;<span class="op" id="7693343">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693346">in</span>&nbsp;&nbsp;<span class="keyword" id="7693350">interface</span><span class="op" id="7693359">{</span><span class="op" id="7693360">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693363">out</span>&nbsp;<span class="keyword" id="7693367">interface</span><span class="op" id="7693376">{</span><span class="op" id="7693377">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693380">err</span>&nbsp;<span class="builtintype" id="7693384">string</span><br>
<span class="lineno"></span><span class="op" id="7693391">}</span><br>
<span class="lineno">375</span><br>
<span class="lineno"></span><span class="keyword" id="7693394">var</span>&nbsp;<span class="ident" id="7693398">singleTests</span>&nbsp;<span class="op" id="7693410">=</span>&nbsp;<span class="op" id="7693412">[</span><span class="op" id="7693413">]</span><span class="ident" id="7693414">SingleTest</span><span class="op" id="7693424">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693427">{</span><span class="num" id="7693428">17</span><span class="op" id="7693430">,</span>&nbsp;<span class="op" id="7693432">&amp;</span><span class="ident" id="7693433">testInt</span><span class="op" id="7693440">,</span>&nbsp;<span class="string" id="7693442">&#34;&#34;</span><span class="op" id="7693444">}</span><span class="op" id="7693445">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693448">{</span><span class="builtintype" id="7693449">float32</span><span class="op" id="7693456">(</span><span class="num" id="7693457">17.5</span><span class="op" id="7693461">)</span><span class="op" id="7693462">,</span>&nbsp;<span class="op" id="7693464">&amp;</span><span class="ident" id="7693465">testFloat32</span><span class="op" id="7693476">,</span>&nbsp;<span class="string" id="7693478">&#34;&#34;</span><span class="op" id="7693480">}</span><span class="op" id="7693481">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693484">{</span><span class="string" id="7693485">&#34;bike&nbsp;shed&#34;</span><span class="op" id="7693496">,</span>&nbsp;<span class="op" id="7693498">&amp;</span><span class="ident" id="7693499">testString</span><span class="op" id="7693509">,</span>&nbsp;<span class="string" id="7693511">&#34;&#34;</span><span class="op" id="7693513">}</span><span class="op" id="7693514">,</span><br>
<span class="lineno">380</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693517">{</span><span class="op" id="7693518">[</span><span class="op" id="7693519">]</span><span class="builtintype" id="7693520">string</span><span class="op" id="7693526">{</span><span class="string" id="7693527">&#34;bike&#34;</span><span class="op" id="7693533">,</span>&nbsp;<span class="string" id="7693535">&#34;shed&#34;</span><span class="op" id="7693541">,</span>&nbsp;<span class="string" id="7693543">&#34;paint&#34;</span><span class="op" id="7693550">,</span>&nbsp;<span class="string" id="7693552">&#34;color&#34;</span><span class="op" id="7693559">}</span><span class="op" id="7693560">,</span>&nbsp;<span class="op" id="7693562">&amp;</span><span class="ident" id="7693563">testSlice</span><span class="op" id="7693572">,</span>&nbsp;<span class="string" id="7693574">&#34;&#34;</span><span class="op" id="7693576">}</span><span class="op" id="7693577">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693580">{</span><span class="keyword" id="7693581">map</span><span class="op" id="7693584">[</span><span class="builtintype" id="7693585">string</span><span class="op" id="7693591">]</span><span class="builtintype" id="7693592">int</span><span class="op" id="7693595">{</span><span class="string" id="7693596">&#34;seven&#34;</span><span class="op" id="7693603">:</span>&nbsp;<span class="num" id="7693605">7</span><span class="op" id="7693606">,</span>&nbsp;<span class="string" id="7693608">&#34;twelve&#34;</span><span class="op" id="7693616">:</span>&nbsp;<span class="num" id="7693618">12</span><span class="op" id="7693620">}</span><span class="op" id="7693621">,</span>&nbsp;<span class="op" id="7693623">&amp;</span><span class="ident" id="7693624">testMap</span><span class="op" id="7693631">,</span>&nbsp;<span class="string" id="7693633">&#34;&#34;</span><span class="op" id="7693635">}</span><span class="op" id="7693636">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693639">{</span><span class="op" id="7693640">[</span><span class="num" id="7693641">7</span><span class="op" id="7693642">]</span><span class="builtintype" id="7693643">int</span><span class="op" id="7693646">{</span><span class="num" id="7693647">4</span><span class="op" id="7693648">,</span>&nbsp;<span class="num" id="7693650">55</span><span class="op" id="7693652">,</span>&nbsp;<span class="num" id="7693654">0</span><span class="op" id="7693655">,</span>&nbsp;<span class="num" id="7693657">0</span><span class="op" id="7693658">,</span>&nbsp;<span class="num" id="7693660">0</span><span class="op" id="7693661">,</span>&nbsp;<span class="num" id="7693663">0</span><span class="op" id="7693664">,</span>&nbsp;<span class="num" id="7693666">0</span><span class="op" id="7693667">}</span><span class="op" id="7693668">,</span>&nbsp;<span class="op" id="7693670">&amp;</span><span class="ident" id="7693671">testArray</span><span class="op" id="7693680">,</span>&nbsp;<span class="string" id="7693682">&#34;&#34;</span><span class="op" id="7693684">}</span><span class="op" id="7693685">,</span>&nbsp;<span class="comment" id="7693687">//&nbsp;case&nbsp;that&nbsp;once&nbsp;triggered&nbsp;a&nbsp;bug</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693722">{</span><span class="op" id="7693723">[</span><span class="num" id="7693724">7</span><span class="op" id="7693725">]</span><span class="builtintype" id="7693726">int</span><span class="op" id="7693729">{</span><span class="num" id="7693730">4</span><span class="op" id="7693731">,</span>&nbsp;<span class="num" id="7693733">55</span><span class="op" id="7693735">,</span>&nbsp;<span class="num" id="7693737">1</span><span class="op" id="7693738">,</span>&nbsp;<span class="num" id="7693740">44</span><span class="op" id="7693742">,</span>&nbsp;<span class="num" id="7693744">22</span><span class="op" id="7693746">,</span>&nbsp;<span class="num" id="7693748">66</span><span class="op" id="7693750">,</span>&nbsp;<span class="num" id="7693752">1234</span><span class="op" id="7693756">}</span><span class="op" id="7693757">,</span>&nbsp;<span class="op" id="7693759">&amp;</span><span class="ident" id="7693760">testArray</span><span class="op" id="7693769">,</span>&nbsp;<span class="string" id="7693771">&#34;&#34;</span><span class="op" id="7693773">}</span><span class="op" id="7693774">,</span><br>
<span class="lineno"></span><br>
<span class="lineno">385</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7693778">//&nbsp;Decode&nbsp;errors</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7693796">{</span><span class="num" id="7693797">172</span><span class="op" id="7693800">,</span>&nbsp;<span class="op" id="7693802">&amp;</span><span class="ident" id="7693803">testFloat32</span><span class="op" id="7693814">,</span>&nbsp;<span class="string" id="7693816">&#34;type&#34;</span><span class="op" id="7693822">}</span><span class="op" id="7693823">,</span><br>
<span class="lineno"></span><span class="op" id="7693825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7693828">func</span>&nbsp;<span class="ident" id="7693833">TestSingletons</span><span class="op" id="7693847">(</span><span class="ident" id="7693848">t</span>&nbsp;<span class="op" id="7693850">*</span><span class="ident" id="7693851">testing</span><span class="op" id="7693858">.</span><span class="ident" id="7693859">T</span><span class="op" id="7693860">)</span>&nbsp;<span class="op" id="7693862">{</span><br>
<span class="lineno">390</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693865">b</span>&nbsp;<span class="op" id="7693867">:=</span>&nbsp;<span class="builtinfunc" id="7693870">new</span><span class="op" id="7693873">(</span><span class="ident" id="7693874">bytes</span><span class="op" id="7693879">.</span><span class="ident" id="7693880">Buffer</span><span class="op" id="7693886">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693889">enc</span>&nbsp;<span class="op" id="7693893">:=</span>&nbsp;<span class="ident" id="7693896">NewEncoder</span><span class="op" id="7693906">(</span><span class="ident" id="7693907">b</span><span class="op" id="7693908">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693911">dec</span>&nbsp;<span class="op" id="7693915">:=</span>&nbsp;<span class="ident" id="7693918">NewDecoder</span><span class="op" id="7693928">(</span><span class="ident" id="7693929">b</span><span class="op" id="7693930">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7693933">for</span>&nbsp;<span class="ident" id="7693937">_</span><span class="op" id="7693938">,</span>&nbsp;<span class="ident" id="7693940">test</span>&nbsp;<span class="op" id="7693945">:=</span>&nbsp;<span class="keyword" id="7693948">range</span>&nbsp;<span class="ident" id="7693954">singleTests</span>&nbsp;<span class="op" id="7693966">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693970">b</span><span class="op" id="7693971">.</span><span class="ident" id="7693972">Reset</span><span class="op" id="7693977">(</span><span class="op" id="7693978">)</span><br>
<span class="lineno">395</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7693982">err</span>&nbsp;<span class="op" id="7693986">:=</span>&nbsp;<span class="ident" id="7693989">enc</span><span class="op" id="7693992">.</span><span class="ident" id="7693993">Encode</span><span class="op" id="7693999">(</span><span class="ident" id="7694000">test</span><span class="op" id="7694004">.</span><span class="ident" id="7694005">in</span><span class="op" id="7694007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694011">if</span>&nbsp;<span class="ident" id="7694014">err</span>&nbsp;<span class="op" id="7694018">!=</span>&nbsp;<span class="ident" id="7694021">nil</span>&nbsp;<span class="op" id="7694025">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694030">t</span><span class="op" id="7694031">.</span><span class="ident" id="7694032">Errorf</span><span class="op" id="7694038">(</span><span class="string" id="7694039">&#34;error&nbsp;encoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7694062">,</span>&nbsp;<span class="ident" id="7694064">test</span><span class="op" id="7694068">.</span><span class="ident" id="7694069">in</span><span class="op" id="7694071">,</span>&nbsp;<span class="ident" id="7694073">err</span><span class="op" id="7694076">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694081">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694092">}</span><br>
<span class="lineno">400</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694096">err</span>&nbsp;<span class="op" id="7694100">=</span>&nbsp;<span class="ident" id="7694102">dec</span><span class="op" id="7694105">.</span><span class="ident" id="7694106">Decode</span><span class="op" id="7694112">(</span><span class="ident" id="7694113">test</span><span class="op" id="7694117">.</span><span class="ident" id="7694118">out</span><span class="op" id="7694121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694125">switch</span>&nbsp;<span class="op" id="7694132">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694136">case</span>&nbsp;<span class="ident" id="7694141">err</span>&nbsp;<span class="op" id="7694145">!=</span>&nbsp;<span class="ident" id="7694148">nil</span>&nbsp;<span class="op" id="7694152">&amp;&amp;</span>&nbsp;<span class="ident" id="7694155">test</span><span class="op" id="7694159">.</span><span class="ident" id="7694160">err</span>&nbsp;<span class="op" id="7694164">==</span>&nbsp;<span class="string" id="7694167">&#34;&#34;</span><span class="op" id="7694169">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694174">t</span><span class="op" id="7694175">.</span><span class="ident" id="7694176">Errorf</span><span class="op" id="7694182">(</span><span class="string" id="7694183">&#34;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7694206">,</span>&nbsp;<span class="ident" id="7694208">test</span><span class="op" id="7694212">.</span><span class="ident" id="7694213">in</span><span class="op" id="7694215">,</span>&nbsp;<span class="ident" id="7694217">err</span><span class="op" id="7694220">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694225">continue</span><br>
<span class="lineno">405</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694236">case</span>&nbsp;<span class="ident" id="7694241">err</span>&nbsp;<span class="op" id="7694245">==</span>&nbsp;<span class="ident" id="7694248">nil</span>&nbsp;<span class="op" id="7694252">&amp;&amp;</span>&nbsp;<span class="ident" id="7694255">test</span><span class="op" id="7694259">.</span><span class="ident" id="7694260">err</span>&nbsp;<span class="op" id="7694264">!=</span>&nbsp;<span class="string" id="7694267">&#34;&#34;</span><span class="op" id="7694269">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694274">t</span><span class="op" id="7694275">.</span><span class="ident" id="7694276">Errorf</span><span class="op" id="7694282">(</span><span class="string" id="7694283">&#34;expected&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;%s&#34;</span><span class="op" id="7694315">,</span>&nbsp;<span class="ident" id="7694317">test</span><span class="op" id="7694321">.</span><span class="ident" id="7694322">in</span><span class="op" id="7694324">,</span>&nbsp;<span class="ident" id="7694326">test</span><span class="op" id="7694330">.</span><span class="ident" id="7694331">err</span><span class="op" id="7694334">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694339">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694350">case</span>&nbsp;<span class="ident" id="7694355">err</span>&nbsp;<span class="op" id="7694359">!=</span>&nbsp;<span class="ident" id="7694362">nil</span>&nbsp;<span class="op" id="7694366">&amp;&amp;</span>&nbsp;<span class="ident" id="7694369">test</span><span class="op" id="7694373">.</span><span class="ident" id="7694374">err</span>&nbsp;<span class="op" id="7694378">!=</span>&nbsp;<span class="string" id="7694381">&#34;&#34;</span><span class="op" id="7694383">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694388">if</span>&nbsp;<span class="ident" id="7694391">strings</span><span class="op" id="7694398">.</span><span class="ident" id="7694399">Index</span><span class="op" id="7694404">(</span><span class="ident" id="7694405">err</span><span class="op" id="7694408">.</span><span class="ident" id="7694409">Error</span><span class="op" id="7694414">(</span><span class="op" id="7694415">)</span><span class="op" id="7694416">,</span>&nbsp;<span class="ident" id="7694418">test</span><span class="op" id="7694422">.</span><span class="ident" id="7694423">err</span><span class="op" id="7694426">)</span>&nbsp;<span class="op" id="7694428">&lt;</span>&nbsp;<span class="num" id="7694430">0</span>&nbsp;<span class="op" id="7694432">{</span><br>
<span class="lineno">410</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694438">t</span><span class="op" id="7694439">.</span><span class="ident" id="7694440">Errorf</span><span class="op" id="7694446">(</span><span class="string" id="7694447">&#34;wrong&nbsp;error&nbsp;decoding&nbsp;%v:&nbsp;wanted&nbsp;%s,&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7694491">,</span>&nbsp;<span class="ident" id="7694493">test</span><span class="op" id="7694497">.</span><span class="ident" id="7694498">in</span><span class="op" id="7694500">,</span>&nbsp;<span class="ident" id="7694502">test</span><span class="op" id="7694506">.</span><span class="ident" id="7694507">err</span><span class="op" id="7694510">,</span>&nbsp;<span class="ident" id="7694512">err</span><span class="op" id="7694515">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694520">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694525">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694536">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7694540">//&nbsp;Get&nbsp;rid&nbsp;of&nbsp;the&nbsp;pointer&nbsp;in&nbsp;the&nbsp;rhs</span><br>
<span class="lineno">415</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694579">val</span>&nbsp;<span class="op" id="7694583">:=</span>&nbsp;<span class="ident" id="7694586">reflect</span><span class="op" id="7694593">.</span><span class="ident" id="7694594">ValueOf</span><span class="op" id="7694601">(</span><span class="ident" id="7694602">test</span><span class="op" id="7694606">.</span><span class="ident" id="7694607">out</span><span class="op" id="7694610">)</span><span class="op" id="7694611">.</span><span class="ident" id="7694612">Elem</span><span class="op" id="7694616">(</span><span class="op" id="7694617">)</span><span class="op" id="7694618">.</span><span class="ident" id="7694619">Interface</span><span class="op" id="7694628">(</span><span class="op" id="7694629">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694633">if</span>&nbsp;<span class="op" id="7694636">!</span><span class="ident" id="7694637">reflect</span><span class="op" id="7694644">.</span><span class="ident" id="7694645">DeepEqual</span><span class="op" id="7694654">(</span><span class="ident" id="7694655">test</span><span class="op" id="7694659">.</span><span class="ident" id="7694660">in</span><span class="op" id="7694662">,</span>&nbsp;<span class="ident" id="7694664">val</span><span class="op" id="7694667">)</span>&nbsp;<span class="op" id="7694669">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694674">t</span><span class="op" id="7694675">.</span><span class="ident" id="7694676">Errorf</span><span class="op" id="7694682">(</span><span class="string" id="7694683">&#34;decoding&nbsp;singleton:&nbsp;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7694723">,</span>&nbsp;<span class="ident" id="7694725">test</span><span class="op" id="7694729">.</span><span class="ident" id="7694730">in</span><span class="op" id="7694732">,</span>&nbsp;<span class="ident" id="7694734">val</span><span class="op" id="7694737">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694741">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694744">}</span><br>
<span class="lineno">420</span><span class="op" id="7694746">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7694749">func</span>&nbsp;<span class="ident" id="7694754">TestStructNonStruct</span><span class="op" id="7694773">(</span><span class="ident" id="7694774">t</span>&nbsp;<span class="op" id="7694776">*</span><span class="ident" id="7694777">testing</span><span class="op" id="7694784">.</span><span class="ident" id="7694785">T</span><span class="op" id="7694786">)</span>&nbsp;<span class="op" id="7694788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694791">type</span>&nbsp;<span class="ident" id="7694796">Struct</span>&nbsp;<span class="keyword" id="7694803">struct</span>&nbsp;<span class="op" id="7694810">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694814">A</span>&nbsp;<span class="builtintype" id="7694816">string</span><br>
<span class="lineno">425</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694824">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694827">type</span>&nbsp;<span class="ident" id="7694832">NonStruct</span>&nbsp;<span class="builtintype" id="7694842">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694850">s</span>&nbsp;<span class="op" id="7694852">:=</span>&nbsp;<span class="ident" id="7694855">Struct</span><span class="op" id="7694861">{</span><span class="string" id="7694862">&#34;hello&#34;</span><span class="op" id="7694869">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694872">var</span>&nbsp;<span class="ident" id="7694876">sp</span>&nbsp;<span class="ident" id="7694879">Struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694887">if</span>&nbsp;<span class="ident" id="7694890">err</span>&nbsp;<span class="op" id="7694894">:=</span>&nbsp;<span class="ident" id="7694897">encAndDec</span><span class="op" id="7694906">(</span><span class="ident" id="7694907">s</span><span class="op" id="7694908">,</span>&nbsp;<span class="op" id="7694910">&amp;</span><span class="ident" id="7694911">sp</span><span class="op" id="7694913">)</span><span class="op" id="7694914">;</span>&nbsp;<span class="ident" id="7694916">err</span>&nbsp;<span class="op" id="7694920">!=</span>&nbsp;<span class="ident" id="7694923">nil</span>&nbsp;<span class="op" id="7694927">{</span><br>
<span class="lineno">430</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7694931">t</span><span class="op" id="7694932">.</span><span class="ident" id="7694933">Error</span><span class="op" id="7694938">(</span><span class="ident" id="7694939">err</span><span class="op" id="7694942">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7694945">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694948">var</span>&nbsp;<span class="ident" id="7694952">ns</span>&nbsp;<span class="ident" id="7694955">NonStruct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7694966">if</span>&nbsp;<span class="ident" id="7694969">err</span>&nbsp;<span class="op" id="7694973">:=</span>&nbsp;<span class="ident" id="7694976">encAndDec</span><span class="op" id="7694985">(</span><span class="ident" id="7694986">s</span><span class="op" id="7694987">,</span>&nbsp;<span class="op" id="7694989">&amp;</span><span class="ident" id="7694990">ns</span><span class="op" id="7694992">)</span><span class="op" id="7694993">;</span>&nbsp;<span class="ident" id="7694995">err</span>&nbsp;<span class="op" id="7694999">==</span>&nbsp;<span class="ident" id="7695002">nil</span>&nbsp;<span class="op" id="7695006">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695010">t</span><span class="op" id="7695011">.</span><span class="ident" id="7695012">Error</span><span class="op" id="7695017">(</span><span class="string" id="7695018">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;struct/non-struct&#34;</span><span class="op" id="7695058">)</span><br>
<span class="lineno">435</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695061">}</span>&nbsp;<span class="keyword" id="7695063">else</span>&nbsp;<span class="keyword" id="7695068">if</span>&nbsp;<span class="ident" id="7695071">strings</span><span class="op" id="7695078">.</span><span class="ident" id="7695079">Index</span><span class="op" id="7695084">(</span><span class="ident" id="7695085">err</span><span class="op" id="7695088">.</span><span class="ident" id="7695089">Error</span><span class="op" id="7695094">(</span><span class="op" id="7695095">)</span><span class="op" id="7695096">,</span>&nbsp;<span class="string" id="7695098">&#34;type&#34;</span><span class="op" id="7695104">)</span>&nbsp;<span class="op" id="7695106">&lt;</span>&nbsp;<span class="num" id="7695108">0</span>&nbsp;<span class="op" id="7695110">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695114">t</span><span class="op" id="7695115">.</span><span class="ident" id="7695116">Error</span><span class="op" id="7695121">(</span><span class="string" id="7695122">&#34;for&nbsp;struct/non-struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7695170">,</span>&nbsp;<span class="ident" id="7695172">err</span><span class="op" id="7695175">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7695181">//&nbsp;Now&nbsp;try&nbsp;the&nbsp;other&nbsp;way</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695207">var</span>&nbsp;<span class="ident" id="7695211">nsp</span>&nbsp;<span class="ident" id="7695215">NonStruct</span><br>
<span class="lineno">440</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695226">if</span>&nbsp;<span class="ident" id="7695229">err</span>&nbsp;<span class="op" id="7695233">:=</span>&nbsp;<span class="ident" id="7695236">encAndDec</span><span class="op" id="7695245">(</span><span class="ident" id="7695246">ns</span><span class="op" id="7695248">,</span>&nbsp;<span class="op" id="7695250">&amp;</span><span class="ident" id="7695251">nsp</span><span class="op" id="7695254">)</span><span class="op" id="7695255">;</span>&nbsp;<span class="ident" id="7695257">err</span>&nbsp;<span class="op" id="7695261">!=</span>&nbsp;<span class="ident" id="7695264">nil</span>&nbsp;<span class="op" id="7695268">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695272">t</span><span class="op" id="7695273">.</span><span class="ident" id="7695274">Error</span><span class="op" id="7695279">(</span><span class="ident" id="7695280">err</span><span class="op" id="7695283">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695286">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695289">if</span>&nbsp;<span class="ident" id="7695292">err</span>&nbsp;<span class="op" id="7695296">:=</span>&nbsp;<span class="ident" id="7695299">encAndDec</span><span class="op" id="7695308">(</span><span class="ident" id="7695309">ns</span><span class="op" id="7695311">,</span>&nbsp;<span class="op" id="7695313">&amp;</span><span class="ident" id="7695314">s</span><span class="op" id="7695315">)</span><span class="op" id="7695316">;</span>&nbsp;<span class="ident" id="7695318">err</span>&nbsp;<span class="op" id="7695322">==</span>&nbsp;<span class="ident" id="7695325">nil</span>&nbsp;<span class="op" id="7695329">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695333">t</span><span class="op" id="7695334">.</span><span class="ident" id="7695335">Error</span><span class="op" id="7695340">(</span><span class="string" id="7695341">&#34;should&nbsp;get&nbsp;error&nbsp;for&nbsp;non-struct/struct&#34;</span><span class="op" id="7695381">)</span><br>
<span class="lineno">445</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695384">}</span>&nbsp;<span class="keyword" id="7695386">else</span>&nbsp;<span class="keyword" id="7695391">if</span>&nbsp;<span class="ident" id="7695394">strings</span><span class="op" id="7695401">.</span><span class="ident" id="7695402">Index</span><span class="op" id="7695407">(</span><span class="ident" id="7695408">err</span><span class="op" id="7695411">.</span><span class="ident" id="7695412">Error</span><span class="op" id="7695417">(</span><span class="op" id="7695418">)</span><span class="op" id="7695419">,</span>&nbsp;<span class="string" id="7695421">&#34;type&#34;</span><span class="op" id="7695427">)</span>&nbsp;<span class="op" id="7695429">&lt;</span>&nbsp;<span class="num" id="7695431">0</span>&nbsp;<span class="op" id="7695433">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695437">t</span><span class="op" id="7695438">.</span><span class="ident" id="7695439">Error</span><span class="op" id="7695444">(</span><span class="string" id="7695445">&#34;for&nbsp;non-struct/struct&nbsp;expected&nbsp;type&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7695493">,</span>&nbsp;<span class="ident" id="7695495">err</span><span class="op" id="7695498">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7695501">}</span><br>
<span class="lineno"></span><span class="op" id="7695503">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">450</span><span class="keyword" id="7695506">type</span>&nbsp;<span class="ident" id="7695511">interfaceIndirectTestI</span>&nbsp;<span class="keyword" id="7695534">interface</span>&nbsp;<span class="op" id="7695544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695547">F</span><span class="op" id="7695548">(</span><span class="op" id="7695549">)</span>&nbsp;<span class="builtintype" id="7695551">bool</span><br>
<span class="lineno"></span><span class="op" id="7695556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7695559">type</span>&nbsp;<span class="ident" id="7695564">interfaceIndirectTestT</span>&nbsp;<span class="keyword" id="7695587">struct</span><span class="op" id="7695593">{</span><span class="op" id="7695594">}</span><br>
<span class="lineno">455</span><br>
<span class="lineno"></span><span class="keyword" id="7695597">func</span>&nbsp;<span class="op" id="7695602">(</span><span class="ident" id="7695603">this</span>&nbsp;<span class="op" id="7695608">*</span><span class="ident" id="7695609">interfaceIndirectTestT</span><span class="op" id="7695631">)</span>&nbsp;<span class="ident" id="7695633">F</span><span class="op" id="7695634">(</span><span class="op" id="7695635">)</span>&nbsp;<span class="builtintype" id="7695637">bool</span>&nbsp;<span class="op" id="7695642">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7695645">return</span>&nbsp;<span class="builtintype" id="7695652">true</span><br>
<span class="lineno"></span><span class="op" id="7695657">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">460</span><span class="comment" id="7695660">//&nbsp;A&nbsp;version&nbsp;of&nbsp;a&nbsp;bug&nbsp;reported&nbsp;on&nbsp;golang-nuts.&nbsp;&nbsp;Also&nbsp;tests&nbsp;top-level</span><br>
<span class="lineno"></span><span class="comment" id="7695729">//&nbsp;slice&nbsp;of&nbsp;interfaces.&nbsp;&nbsp;The&nbsp;issue&nbsp;was&nbsp;registering&nbsp;*T&nbsp;caused&nbsp;T&nbsp;to&nbsp;be</span><br>
<span class="lineno"></span><span class="comment" id="7695798">//&nbsp;stored&nbsp;as&nbsp;the&nbsp;concrete&nbsp;type.</span><br>
<span class="lineno"></span><span class="keyword" id="7695830">func</span>&nbsp;<span class="ident" id="7695835">TestInterfaceIndirect</span><span class="op" id="7695856">(</span><span class="ident" id="7695857">t</span>&nbsp;<span class="op" id="7695859">*</span><span class="ident" id="7695860">testing</span><span class="op" id="7695867">.</span><span class="ident" id="7695868">T</span><span class="op" id="7695869">)</span>&nbsp;<span class="op" id="7695871">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695874">Register</span><span class="op" id="7695882">(</span><span class="op" id="7695883">&amp;</span><span class="ident" id="7695884">interfaceIndirectTestT</span><span class="op" id="7695906">{</span><span class="op" id="7695907">}</span><span class="op" id="7695908">)</span><br>
<span class="lineno">465</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695911">b</span>&nbsp;<span class="op" id="7695913">:=</span>&nbsp;<span class="builtinfunc" id="7695916">new</span><span class="op" id="7695919">(</span><span class="ident" id="7695920">bytes</span><span class="op" id="7695925">.</span><span class="ident" id="7695926">Buffer</span><span class="op" id="7695932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695935">w</span>&nbsp;<span class="op" id="7695937">:=</span>&nbsp;<span class="op" id="7695940">[</span><span class="op" id="7695941">]</span><span class="ident" id="7695942">interfaceIndirectTestI</span><span class="op" id="7695964">{</span><span class="op" id="7695965">&amp;</span><span class="ident" id="7695966">interfaceIndirectTestT</span><span class="op" id="7695988">{</span><span class="op" id="7695989">}</span><span class="op" id="7695990">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7695993">err</span>&nbsp;<span class="op" id="7695997">:=</span>&nbsp;<span class="ident" id="7696000">NewEncoder</span><span class="op" id="7696010">(</span><span class="ident" id="7696011">b</span><span class="op" id="7696012">)</span><span class="op" id="7696013">.</span><span class="ident" id="7696014">Encode</span><span class="op" id="7696020">(</span><span class="ident" id="7696021">w</span><span class="op" id="7696022">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696025">if</span>&nbsp;<span class="ident" id="7696028">err</span>&nbsp;<span class="op" id="7696032">!=</span>&nbsp;<span class="ident" id="7696035">nil</span>&nbsp;<span class="op" id="7696039">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696043">t</span><span class="op" id="7696044">.</span><span class="ident" id="7696045">Fatal</span><span class="op" id="7696050">(</span><span class="string" id="7696051">&#34;encode&nbsp;error:&#34;</span><span class="op" id="7696066">,</span>&nbsp;<span class="ident" id="7696068">err</span><span class="op" id="7696071">)</span><br>
<span class="lineno">470</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696074">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696078">var</span>&nbsp;<span class="ident" id="7696082">r</span>&nbsp;<span class="op" id="7696084">[</span><span class="op" id="7696085">]</span><span class="ident" id="7696086">interfaceIndirectTestI</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696110">err</span>&nbsp;<span class="op" id="7696114">=</span>&nbsp;<span class="ident" id="7696116">NewDecoder</span><span class="op" id="7696126">(</span><span class="ident" id="7696127">b</span><span class="op" id="7696128">)</span><span class="op" id="7696129">.</span><span class="ident" id="7696130">Decode</span><span class="op" id="7696136">(</span><span class="op" id="7696137">&amp;</span><span class="ident" id="7696138">r</span><span class="op" id="7696139">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7696142">if</span>&nbsp;<span class="ident" id="7696145">err</span>&nbsp;<span class="op" id="7696149">!=</span>&nbsp;<span class="ident" id="7696152">nil</span>&nbsp;<span class="op" id="7696156">{</span><br>
<span class="lineno">475</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696160">t</span><span class="op" id="7696161">.</span><span class="ident" id="7696162">Fatal</span><span class="op" id="7696167">(</span><span class="string" id="7696168">&#34;decode&nbsp;error:&#34;</span><span class="op" id="7696183">,</span>&nbsp;<span class="ident" id="7696185">err</span><span class="op" id="7696188">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696191">}</span><br>
<span class="lineno"></span><span class="op" id="7696193">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7696196">//&nbsp;Now&nbsp;follow&nbsp;various&nbsp;tests&nbsp;that&nbsp;decode&nbsp;into&nbsp;things&nbsp;that&nbsp;can&#39;t&nbsp;represent&nbsp;the</span><br>
<span class="lineno">480</span><span class="comment" id="7696273">//&nbsp;encoded&nbsp;value,&nbsp;all&nbsp;of&nbsp;which&nbsp;should&nbsp;be&nbsp;legal.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7696322">//&nbsp;Also,&nbsp;when&nbsp;the&nbsp;ignored&nbsp;object&nbsp;contains&nbsp;an&nbsp;interface&nbsp;value,&nbsp;it&nbsp;may&nbsp;define</span><br>
<span class="lineno"></span><span class="comment" id="7696398">//&nbsp;types.&nbsp;Make&nbsp;sure&nbsp;that&nbsp;skipping&nbsp;the&nbsp;value&nbsp;still&nbsp;defines&nbsp;the&nbsp;types&nbsp;by&nbsp;using</span><br>
<span class="lineno"></span><span class="comment" id="7696475">//&nbsp;the&nbsp;encoder/decoder&nbsp;pair&nbsp;to&nbsp;send&nbsp;a&nbsp;value&nbsp;afterwards.&nbsp;&nbsp;If&nbsp;an&nbsp;interface</span><br>
<span class="lineno">485</span><span class="comment" id="7696548">//&nbsp;is&nbsp;sent,&nbsp;its&nbsp;type&nbsp;in&nbsp;the&nbsp;test&nbsp;is&nbsp;always&nbsp;NewType0,&nbsp;so&nbsp;this&nbsp;checks&nbsp;that&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7696625">//&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;don&#39;t&nbsp;skew&nbsp;with&nbsp;respect&nbsp;to&nbsp;type&nbsp;definitions.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696694">type</span>&nbsp;<span class="ident" id="7696699">Struct0</span>&nbsp;<span class="keyword" id="7696707">struct</span>&nbsp;<span class="op" id="7696714">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696717">I</span>&nbsp;<span class="keyword" id="7696719">interface</span><span class="op" id="7696728">{</span><span class="op" id="7696729">}</span><br>
<span class="lineno">490</span><span class="op" id="7696731">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7696734">type</span>&nbsp;<span class="ident" id="7696739">NewType0</span>&nbsp;<span class="keyword" id="7696748">struct</span>&nbsp;<span class="op" id="7696755">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696758">S</span>&nbsp;<span class="builtintype" id="7696760">string</span><br>
<span class="lineno"></span><span class="op" id="7696767">}</span><br>
<span class="lineno">495</span><br>
<span class="lineno"></span><span class="keyword" id="7696770">type</span>&nbsp;<span class="ident" id="7696775">ignoreTest</span>&nbsp;<span class="keyword" id="7696786">struct</span>&nbsp;<span class="op" id="7696793">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7696796">in</span><span class="op" id="7696798">,</span>&nbsp;<span class="ident" id="7696800">out</span>&nbsp;<span class="keyword" id="7696804">interface</span><span class="op" id="7696813">{</span><span class="op" id="7696814">}</span><br>
<span class="lineno"></span><span class="op" id="7696816">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">500</span><span class="keyword" id="7696819">var</span>&nbsp;<span class="ident" id="7696823">ignoreTests</span>&nbsp;<span class="op" id="7696835">=</span>&nbsp;<span class="op" id="7696837">[</span><span class="op" id="7696838">]</span><span class="ident" id="7696839">ignoreTest</span><span class="op" id="7696849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696852">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;an&nbsp;empty&nbsp;struct</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696898">{</span><span class="op" id="7696899">&amp;</span><span class="keyword" id="7696900">struct</span><span class="op" id="7696906">{</span>&nbsp;<span class="ident" id="7696908">A</span>&nbsp;<span class="builtintype" id="7696910">int</span>&nbsp;<span class="op" id="7696914">}</span><span class="op" id="7696915">{</span><span class="num" id="7696916">23</span><span class="op" id="7696918">}</span><span class="op" id="7696919">,</span>&nbsp;<span class="op" id="7696921">&amp;</span><span class="keyword" id="7696922">struct</span><span class="op" id="7696928">{</span><span class="op" id="7696929">}</span><span class="op" id="7696930">{</span><span class="op" id="7696931">}</span><span class="op" id="7696932">}</span><span class="op" id="7696933">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7696936">//&nbsp;Decode&nbsp;normal&nbsp;struct&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7696973">{</span><span class="op" id="7696974">&amp;</span><span class="keyword" id="7696975">struct</span><span class="op" id="7696981">{</span>&nbsp;<span class="ident" id="7696983">A</span>&nbsp;<span class="builtintype" id="7696985">int</span>&nbsp;<span class="op" id="7696989">}</span><span class="op" id="7696990">{</span><span class="num" id="7696991">23</span><span class="op" id="7696993">}</span><span class="op" id="7696994">,</span>&nbsp;<span class="ident" id="7696996">nil</span><span class="op" id="7696999">}</span><span class="op" id="7697000">,</span><br>
<span class="lineno">505</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697003">//&nbsp;Decode&nbsp;singleton&nbsp;string&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697043">{</span><span class="string" id="7697044">&#34;hello,&nbsp;world&#34;</span><span class="op" id="7697058">,</span>&nbsp;<span class="ident" id="7697060">nil</span><span class="op" id="7697063">}</span><span class="op" id="7697064">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697067">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697106">{</span><span class="op" id="7697107">[</span><span class="op" id="7697108">]</span><span class="builtintype" id="7697109">int</span><span class="op" id="7697112">{</span><span class="num" id="7697113">1</span><span class="op" id="7697114">,</span>&nbsp;<span class="num" id="7697116">2</span><span class="op" id="7697117">,</span>&nbsp;<span class="num" id="7697119">3</span><span class="op" id="7697120">,</span>&nbsp;<span class="num" id="7697122">4</span><span class="op" id="7697123">}</span><span class="op" id="7697124">,</span>&nbsp;<span class="ident" id="7697126">nil</span><span class="op" id="7697129">}</span><span class="op" id="7697130">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697133">//&nbsp;Decode&nbsp;struct&nbsp;containing&nbsp;an&nbsp;interface&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno">510</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697187">{</span><span class="op" id="7697188">&amp;</span><span class="ident" id="7697189">Struct0</span><span class="op" id="7697196">{</span><span class="op" id="7697197">&amp;</span><span class="ident" id="7697198">NewType0</span><span class="op" id="7697206">{</span><span class="string" id="7697207">&#34;value0&#34;</span><span class="op" id="7697215">}</span><span class="op" id="7697216">}</span><span class="op" id="7697217">,</span>&nbsp;<span class="ident" id="7697219">nil</span><span class="op" id="7697222">}</span><span class="op" id="7697223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697226">//&nbsp;Decode&nbsp;singleton&nbsp;slice&nbsp;of&nbsp;interfaces&nbsp;into&nbsp;a&nbsp;nil.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697279">{</span><span class="op" id="7697280">[</span><span class="op" id="7697281">]</span><span class="keyword" id="7697282">interface</span><span class="op" id="7697291">{</span><span class="op" id="7697292">}</span><span class="op" id="7697293">{</span><span class="string" id="7697294">&#34;hi&#34;</span><span class="op" id="7697298">,</span>&nbsp;<span class="op" id="7697300">&amp;</span><span class="ident" id="7697301">NewType0</span><span class="op" id="7697309">{</span><span class="string" id="7697310">&#34;value1&#34;</span><span class="op" id="7697318">}</span><span class="op" id="7697319">,</span>&nbsp;<span class="num" id="7697321">23</span><span class="op" id="7697323">}</span><span class="op" id="7697324">,</span>&nbsp;<span class="ident" id="7697326">nil</span><span class="op" id="7697329">}</span><span class="op" id="7697330">,</span><br>
<span class="lineno"></span><span class="op" id="7697332">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">515</span><span class="keyword" id="7697335">func</span>&nbsp;<span class="ident" id="7697340">TestDecodeIntoNothing</span><span class="op" id="7697361">(</span><span class="ident" id="7697362">t</span>&nbsp;<span class="op" id="7697364">*</span><span class="ident" id="7697365">testing</span><span class="op" id="7697372">.</span><span class="ident" id="7697373">T</span><span class="op" id="7697374">)</span>&nbsp;<span class="op" id="7697376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697379">Register</span><span class="op" id="7697387">(</span><span class="builtinfunc" id="7697388">new</span><span class="op" id="7697391">(</span><span class="ident" id="7697392">NewType0</span><span class="op" id="7697400">)</span><span class="op" id="7697401">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697404">for</span>&nbsp;<span class="ident" id="7697408">i</span><span class="op" id="7697409">,</span>&nbsp;<span class="ident" id="7697411">test</span>&nbsp;<span class="op" id="7697416">:=</span>&nbsp;<span class="keyword" id="7697419">range</span>&nbsp;<span class="ident" id="7697425">ignoreTests</span>&nbsp;<span class="op" id="7697437">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697441">b</span>&nbsp;<span class="op" id="7697443">:=</span>&nbsp;<span class="builtinfunc" id="7697446">new</span><span class="op" id="7697449">(</span><span class="ident" id="7697450">bytes</span><span class="op" id="7697455">.</span><span class="ident" id="7697456">Buffer</span><span class="op" id="7697462">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697466">enc</span>&nbsp;<span class="op" id="7697470">:=</span>&nbsp;<span class="ident" id="7697473">NewEncoder</span><span class="op" id="7697483">(</span><span class="ident" id="7697484">b</span><span class="op" id="7697485">)</span><br>
<span class="lineno">520</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697489">err</span>&nbsp;<span class="op" id="7697493">:=</span>&nbsp;<span class="ident" id="7697496">enc</span><span class="op" id="7697499">.</span><span class="ident" id="7697500">Encode</span><span class="op" id="7697506">(</span><span class="ident" id="7697507">test</span><span class="op" id="7697511">.</span><span class="ident" id="7697512">in</span><span class="op" id="7697514">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697518">if</span>&nbsp;<span class="ident" id="7697521">err</span>&nbsp;<span class="op" id="7697525">!=</span>&nbsp;<span class="ident" id="7697528">nil</span>&nbsp;<span class="op" id="7697532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697537">t</span><span class="op" id="7697538">.</span><span class="ident" id="7697539">Errorf</span><span class="op" id="7697545">(</span><span class="string" id="7697546">&#34;%d:&nbsp;encode&nbsp;error&nbsp;%s:&#34;</span><span class="op" id="7697568">,</span>&nbsp;<span class="ident" id="7697570">i</span><span class="op" id="7697571">,</span>&nbsp;<span class="ident" id="7697573">err</span><span class="op" id="7697576">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697581">continue</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697592">}</span><br>
<span class="lineno">525</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697596">dec</span>&nbsp;<span class="op" id="7697600">:=</span>&nbsp;<span class="ident" id="7697603">NewDecoder</span><span class="op" id="7697613">(</span><span class="ident" id="7697614">b</span><span class="op" id="7697615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697619">err</span>&nbsp;<span class="op" id="7697623">=</span>&nbsp;<span class="ident" id="7697625">dec</span><span class="op" id="7697628">.</span><span class="ident" id="7697629">Decode</span><span class="op" id="7697635">(</span><span class="ident" id="7697636">test</span><span class="op" id="7697640">.</span><span class="ident" id="7697641">out</span><span class="op" id="7697644">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697648">if</span>&nbsp;<span class="ident" id="7697651">err</span>&nbsp;<span class="op" id="7697655">!=</span>&nbsp;<span class="ident" id="7697658">nil</span>&nbsp;<span class="op" id="7697662">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697667">t</span><span class="op" id="7697668">.</span><span class="ident" id="7697669">Errorf</span><span class="op" id="7697675">(</span><span class="string" id="7697676">&#34;%d:&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7697698">,</span>&nbsp;<span class="ident" id="7697700">i</span><span class="op" id="7697701">,</span>&nbsp;<span class="ident" id="7697703">err</span><span class="op" id="7697706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697711">continue</span><br>
<span class="lineno">530</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697722">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7697726">//&nbsp;Now&nbsp;see&nbsp;if&nbsp;the&nbsp;encoder&nbsp;and&nbsp;decoder&nbsp;are&nbsp;in&nbsp;a&nbsp;consistent&nbsp;state.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697793">str</span>&nbsp;<span class="op" id="7697797">:=</span>&nbsp;<span class="ident" id="7697800">fmt</span><span class="op" id="7697803">.</span><span class="ident" id="7697804">Sprintf</span><span class="op" id="7697811">(</span><span class="string" id="7697812">&#34;Value&nbsp;%d&#34;</span><span class="op" id="7697822">,</span>&nbsp;<span class="ident" id="7697824">i</span><span class="op" id="7697825">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697829">err</span>&nbsp;<span class="op" id="7697833">=</span>&nbsp;<span class="ident" id="7697835">enc</span><span class="op" id="7697838">.</span><span class="ident" id="7697839">Encode</span><span class="op" id="7697845">(</span><span class="op" id="7697846">&amp;</span><span class="ident" id="7697847">NewType0</span><span class="op" id="7697855">{</span><span class="ident" id="7697856">str</span><span class="op" id="7697859">}</span><span class="op" id="7697860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697864">if</span>&nbsp;<span class="ident" id="7697867">err</span>&nbsp;<span class="op" id="7697871">!=</span>&nbsp;<span class="ident" id="7697874">nil</span>&nbsp;<span class="op" id="7697878">{</span><br>
<span class="lineno">535</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697883">t</span><span class="op" id="7697884">.</span><span class="ident" id="7697885">Fatalf</span><span class="op" id="7697891">(</span><span class="string" id="7697892">&#34;%d:&nbsp;NewType0&nbsp;encode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7697923">,</span>&nbsp;<span class="ident" id="7697925">i</span><span class="op" id="7697926">,</span>&nbsp;<span class="ident" id="7697928">err</span><span class="op" id="7697931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7697935">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697939">ns</span>&nbsp;<span class="op" id="7697942">:=</span>&nbsp;<span class="builtinfunc" id="7697945">new</span><span class="op" id="7697948">(</span><span class="ident" id="7697949">NewType0</span><span class="op" id="7697957">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7697961">err</span>&nbsp;<span class="op" id="7697965">=</span>&nbsp;<span class="ident" id="7697967">dec</span><span class="op" id="7697970">.</span><span class="ident" id="7697971">Decode</span><span class="op" id="7697977">(</span><span class="ident" id="7697978">ns</span><span class="op" id="7697980">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7697984">if</span>&nbsp;<span class="ident" id="7697987">err</span>&nbsp;<span class="op" id="7697991">!=</span>&nbsp;<span class="ident" id="7697994">nil</span>&nbsp;<span class="op" id="7697998">{</span><br>
<span class="lineno">540</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698003">t</span><span class="op" id="7698004">.</span><span class="ident" id="7698005">Fatalf</span><span class="op" id="7698011">(</span><span class="string" id="7698012">&#34;%d:&nbsp;NewType0&nbsp;decode&nbsp;error:&nbsp;%s&#34;</span><span class="op" id="7698043">,</span>&nbsp;<span class="ident" id="7698045">i</span><span class="op" id="7698046">,</span>&nbsp;<span class="ident" id="7698048">err</span><span class="op" id="7698051">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698055">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698059">if</span>&nbsp;<span class="ident" id="7698062">ns</span><span class="op" id="7698064">.</span><span class="ident" id="7698065">S</span>&nbsp;<span class="op" id="7698067">!=</span>&nbsp;<span class="ident" id="7698070">str</span>&nbsp;<span class="op" id="7698074">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698079">t</span><span class="op" id="7698080">.</span><span class="ident" id="7698081">Fatalf</span><span class="op" id="7698087">(</span><span class="string" id="7698088">&#34;%d:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7698112">,</span>&nbsp;<span class="ident" id="7698114">i</span><span class="op" id="7698115">,</span>&nbsp;<span class="ident" id="7698117">str</span><span class="op" id="7698120">,</span>&nbsp;<span class="ident" id="7698122">ns</span><span class="op" id="7698124">.</span><span class="ident" id="7698125">S</span><span class="op" id="7698126">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698130">}</span><br>
<span class="lineno">545</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698133">}</span><br>
<span class="lineno"></span><span class="op" id="7698135">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7698138">//&nbsp;Another&nbsp;bug&nbsp;from&nbsp;golang-nuts,&nbsp;involving&nbsp;nested&nbsp;interfaces.</span><br>
<span class="lineno"></span><span class="keyword" id="7698200">type</span>&nbsp;<span class="ident" id="7698205">Bug0Outer</span>&nbsp;<span class="keyword" id="7698215">struct</span>&nbsp;<span class="op" id="7698222">{</span><br>
<span class="lineno">550</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698225">Bug0Field</span>&nbsp;<span class="keyword" id="7698235">interface</span><span class="op" id="7698244">{</span><span class="op" id="7698245">}</span><br>
<span class="lineno"></span><span class="op" id="7698247">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7698250">type</span>&nbsp;<span class="ident" id="7698255">Bug0Inner</span>&nbsp;<span class="keyword" id="7698265">struct</span>&nbsp;<span class="op" id="7698272">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698275">A</span>&nbsp;<span class="builtintype" id="7698277">int</span><br>
<span class="lineno">555</span><span class="op" id="7698281">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7698284">func</span>&nbsp;<span class="ident" id="7698289">TestNestedInterfaces</span><span class="op" id="7698309">(</span><span class="ident" id="7698310">t</span>&nbsp;<span class="op" id="7698312">*</span><span class="ident" id="7698313">testing</span><span class="op" id="7698320">.</span><span class="ident" id="7698321">T</span><span class="op" id="7698322">)</span>&nbsp;<span class="op" id="7698324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698327">var</span>&nbsp;<span class="ident" id="7698331">buf</span>&nbsp;<span class="ident" id="7698335">bytes</span><span class="op" id="7698340">.</span><span class="ident" id="7698341">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698349">e</span>&nbsp;<span class="op" id="7698351">:=</span>&nbsp;<span class="ident" id="7698354">NewEncoder</span><span class="op" id="7698364">(</span><span class="op" id="7698365">&amp;</span><span class="ident" id="7698366">buf</span><span class="op" id="7698369">)</span><br>
<span class="lineno">560</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698372">d</span>&nbsp;<span class="op" id="7698374">:=</span>&nbsp;<span class="ident" id="7698377">NewDecoder</span><span class="op" id="7698387">(</span><span class="op" id="7698388">&amp;</span><span class="ident" id="7698389">buf</span><span class="op" id="7698392">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698395">Register</span><span class="op" id="7698403">(</span><span class="builtinfunc" id="7698404">new</span><span class="op" id="7698407">(</span><span class="ident" id="7698408">Bug0Outer</span><span class="op" id="7698417">)</span><span class="op" id="7698418">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698421">Register</span><span class="op" id="7698429">(</span><span class="builtinfunc" id="7698430">new</span><span class="op" id="7698433">(</span><span class="ident" id="7698434">Bug0Inner</span><span class="op" id="7698443">)</span><span class="op" id="7698444">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698447">f</span>&nbsp;<span class="op" id="7698449">:=</span>&nbsp;<span class="op" id="7698452">&amp;</span><span class="ident" id="7698453">Bug0Outer</span><span class="op" id="7698462">{</span><span class="op" id="7698463">&amp;</span><span class="ident" id="7698464">Bug0Outer</span><span class="op" id="7698473">{</span><span class="op" id="7698474">&amp;</span><span class="ident" id="7698475">Bug0Inner</span><span class="op" id="7698484">{</span><span class="num" id="7698485">7</span><span class="op" id="7698486">}</span><span class="op" id="7698487">}</span><span class="op" id="7698488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698491">var</span>&nbsp;<span class="ident" id="7698495">v</span>&nbsp;<span class="keyword" id="7698497">interface</span><span class="op" id="7698506">{</span><span class="op" id="7698507">}</span>&nbsp;<span class="op" id="7698509">=</span>&nbsp;<span class="ident" id="7698511">f</span><br>
<span class="lineno">565</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698514">err</span>&nbsp;<span class="op" id="7698518">:=</span>&nbsp;<span class="ident" id="7698521">e</span><span class="op" id="7698522">.</span><span class="ident" id="7698523">Encode</span><span class="op" id="7698529">(</span><span class="op" id="7698530">&amp;</span><span class="ident" id="7698531">v</span><span class="op" id="7698532">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698535">if</span>&nbsp;<span class="ident" id="7698538">err</span>&nbsp;<span class="op" id="7698542">!=</span>&nbsp;<span class="ident" id="7698545">nil</span>&nbsp;<span class="op" id="7698549">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698553">t</span><span class="op" id="7698554">.</span><span class="ident" id="7698555">Fatal</span><span class="op" id="7698560">(</span><span class="string" id="7698561">&#34;Encode:&#34;</span><span class="op" id="7698570">,</span>&nbsp;<span class="ident" id="7698572">err</span><span class="op" id="7698575">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698578">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698581">err</span>&nbsp;<span class="op" id="7698585">=</span>&nbsp;<span class="ident" id="7698587">d</span><span class="op" id="7698588">.</span><span class="ident" id="7698589">Decode</span><span class="op" id="7698595">(</span><span class="op" id="7698596">&amp;</span><span class="ident" id="7698597">v</span><span class="op" id="7698598">)</span><br>
<span class="lineno">570</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698601">if</span>&nbsp;<span class="ident" id="7698604">err</span>&nbsp;<span class="op" id="7698608">!=</span>&nbsp;<span class="ident" id="7698611">nil</span>&nbsp;<span class="op" id="7698615">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698619">t</span><span class="op" id="7698620">.</span><span class="ident" id="7698621">Fatal</span><span class="op" id="7698626">(</span><span class="string" id="7698627">&#34;Decode:&#34;</span><span class="op" id="7698636">,</span>&nbsp;<span class="ident" id="7698638">err</span><span class="op" id="7698641">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698644">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7698647">//&nbsp;Make&nbsp;sure&nbsp;it&nbsp;decoded&nbsp;correctly.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698683">outer1</span><span class="op" id="7698689">,</span>&nbsp;<span class="ident" id="7698691">ok</span>&nbsp;<span class="op" id="7698694">:=</span>&nbsp;<span class="ident" id="7698697">v</span><span class="op" id="7698698">.</span><span class="op" id="7698699">(</span><span class="op" id="7698700">*</span><span class="ident" id="7698701">Bug0Outer</span><span class="op" id="7698710">)</span><br>
<span class="lineno">575</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698713">if</span>&nbsp;<span class="op" id="7698716">!</span><span class="ident" id="7698717">ok</span>&nbsp;<span class="op" id="7698720">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698724">t</span><span class="op" id="7698725">.</span><span class="ident" id="7698726">Fatalf</span><span class="op" id="7698732">(</span><span class="string" id="7698733">&#34;v&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7698754">,</span>&nbsp;<span class="ident" id="7698756">v</span><span class="op" id="7698757">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698760">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698763">outer2</span><span class="op" id="7698769">,</span>&nbsp;<span class="ident" id="7698771">ok</span>&nbsp;<span class="op" id="7698774">:=</span>&nbsp;<span class="ident" id="7698777">outer1</span><span class="op" id="7698783">.</span><span class="ident" id="7698784">Bug0Field</span><span class="op" id="7698793">.</span><span class="op" id="7698794">(</span><span class="op" id="7698795">*</span><span class="ident" id="7698796">Bug0Outer</span><span class="op" id="7698805">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698808">if</span>&nbsp;<span class="op" id="7698811">!</span><span class="ident" id="7698812">ok</span>&nbsp;<span class="op" id="7698815">{</span><br>
<span class="lineno">580</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698819">t</span><span class="op" id="7698820">.</span><span class="ident" id="7698821">Fatalf</span><span class="op" id="7698827">(</span><span class="string" id="7698828">&#34;v.Bug0Field&nbsp;not&nbsp;Bug0Outer:&nbsp;%T&#34;</span><span class="op" id="7698859">,</span>&nbsp;<span class="ident" id="7698861">outer1</span><span class="op" id="7698867">.</span><span class="ident" id="7698868">Bug0Field</span><span class="op" id="7698877">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7698880">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698883">inner</span><span class="op" id="7698888">,</span>&nbsp;<span class="ident" id="7698890">ok</span>&nbsp;<span class="op" id="7698893">:=</span>&nbsp;<span class="ident" id="7698896">outer2</span><span class="op" id="7698902">.</span><span class="ident" id="7698903">Bug0Field</span><span class="op" id="7698912">.</span><span class="op" id="7698913">(</span><span class="op" id="7698914">*</span><span class="ident" id="7698915">Bug0Inner</span><span class="op" id="7698924">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7698927">if</span>&nbsp;<span class="op" id="7698930">!</span><span class="ident" id="7698931">ok</span>&nbsp;<span class="op" id="7698934">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7698938">t</span><span class="op" id="7698939">.</span><span class="ident" id="7698940">Fatalf</span><span class="op" id="7698946">(</span><span class="string" id="7698947">&#34;v.Bug0Field.Bug0Field&nbsp;not&nbsp;Bug0Inner:&nbsp;%T&#34;</span><span class="op" id="7698988">,</span>&nbsp;<span class="ident" id="7698990">outer2</span><span class="op" id="7698996">.</span><span class="ident" id="7698997">Bug0Field</span><span class="op" id="7699006">)</span><br>
<span class="lineno">585</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699009">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699012">if</span>&nbsp;<span class="ident" id="7699015">inner</span><span class="op" id="7699020">.</span><span class="ident" id="7699021">A</span>&nbsp;<span class="op" id="7699023">!=</span>&nbsp;<span class="num" id="7699026">7</span>&nbsp;<span class="op" id="7699028">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699032">t</span><span class="op" id="7699033">.</span><span class="ident" id="7699034">Fatalf</span><span class="op" id="7699040">(</span><span class="string" id="7699041">&#34;final&nbsp;value&nbsp;%d;&nbsp;expected&nbsp;%d&#34;</span><span class="op" id="7699070">,</span>&nbsp;<span class="ident" id="7699072">inner</span><span class="op" id="7699077">.</span><span class="ident" id="7699078">A</span><span class="op" id="7699079">,</span>&nbsp;<span class="num" id="7699081">7</span><span class="op" id="7699082">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699085">}</span><br>
<span class="lineno"></span><span class="op" id="7699087">}</span><br>
<span class="lineno">590</span><br>
<span class="lineno"></span><span class="comment" id="7699090">//&nbsp;The&nbsp;bugs&nbsp;keep&nbsp;coming.&nbsp;We&nbsp;forgot&nbsp;to&nbsp;send&nbsp;map&nbsp;subtypes&nbsp;before&nbsp;the&nbsp;map.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7699163">type</span>&nbsp;<span class="ident" id="7699168">Bug1Elem</span>&nbsp;<span class="keyword" id="7699177">struct</span>&nbsp;<span class="op" id="7699184">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699187">Name</span>&nbsp;<span class="builtintype" id="7699192">string</span><br>
<span class="lineno">595</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699200">Id</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7699205">int</span><br>
<span class="lineno"></span><span class="op" id="7699209">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7699212">type</span>&nbsp;<span class="ident" id="7699217">Bug1StructMap</span>&nbsp;<span class="keyword" id="7699231">map</span><span class="op" id="7699234">[</span><span class="builtintype" id="7699235">string</span><span class="op" id="7699241">]</span><span class="ident" id="7699242">Bug1Elem</span><br>
<span class="lineno"></span><br>
<span class="lineno">600</span><span class="keyword" id="7699252">func</span>&nbsp;<span class="ident" id="7699257">bug1EncDec</span><span class="op" id="7699267">(</span><span class="ident" id="7699268">in</span>&nbsp;<span class="ident" id="7699271">Bug1StructMap</span><span class="op" id="7699284">,</span>&nbsp;<span class="ident" id="7699286">out</span>&nbsp;<span class="op" id="7699290">*</span><span class="ident" id="7699291">Bug1StructMap</span><span class="op" id="7699304">)</span>&nbsp;<span class="builtintype" id="7699306">error</span>&nbsp;<span class="op" id="7699312">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699315">return</span>&nbsp;<span class="ident" id="7699322">nil</span><br>
<span class="lineno"></span><span class="op" id="7699326">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7699329">func</span>&nbsp;<span class="ident" id="7699334">TestMapBug1</span><span class="op" id="7699345">(</span><span class="ident" id="7699346">t</span>&nbsp;<span class="op" id="7699348">*</span><span class="ident" id="7699349">testing</span><span class="op" id="7699356">.</span><span class="ident" id="7699357">T</span><span class="op" id="7699358">)</span>&nbsp;<span class="op" id="7699360">{</span><br>
<span class="lineno">605</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699363">in</span>&nbsp;<span class="op" id="7699366">:=</span>&nbsp;<span class="builtinfunc" id="7699369">make</span><span class="op" id="7699373">(</span><span class="ident" id="7699374">Bug1StructMap</span><span class="op" id="7699387">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699390">in</span><span class="op" id="7699392">[</span><span class="string" id="7699393">&#34;val1&#34;</span><span class="op" id="7699399">]</span>&nbsp;<span class="op" id="7699401">=</span>&nbsp;<span class="ident" id="7699403">Bug1Elem</span><span class="op" id="7699411">{</span><span class="string" id="7699412">&#34;elem1&#34;</span><span class="op" id="7699419">,</span>&nbsp;<span class="num" id="7699421">1</span><span class="op" id="7699422">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699425">in</span><span class="op" id="7699427">[</span><span class="string" id="7699428">&#34;val2&#34;</span><span class="op" id="7699434">]</span>&nbsp;<span class="op" id="7699436">=</span>&nbsp;<span class="ident" id="7699438">Bug1Elem</span><span class="op" id="7699446">{</span><span class="string" id="7699447">&#34;elem2&#34;</span><span class="op" id="7699454">,</span>&nbsp;<span class="num" id="7699456">2</span><span class="op" id="7699457">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699461">b</span>&nbsp;<span class="op" id="7699463">:=</span>&nbsp;<span class="builtinfunc" id="7699466">new</span><span class="op" id="7699469">(</span><span class="ident" id="7699470">bytes</span><span class="op" id="7699475">.</span><span class="ident" id="7699476">Buffer</span><span class="op" id="7699482">)</span><br>
<span class="lineno">610</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699485">enc</span>&nbsp;<span class="op" id="7699489">:=</span>&nbsp;<span class="ident" id="7699492">NewEncoder</span><span class="op" id="7699502">(</span><span class="ident" id="7699503">b</span><span class="op" id="7699504">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699507">err</span>&nbsp;<span class="op" id="7699511">:=</span>&nbsp;<span class="ident" id="7699514">enc</span><span class="op" id="7699517">.</span><span class="ident" id="7699518">Encode</span><span class="op" id="7699524">(</span><span class="ident" id="7699525">in</span><span class="op" id="7699527">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699530">if</span>&nbsp;<span class="ident" id="7699533">err</span>&nbsp;<span class="op" id="7699537">!=</span>&nbsp;<span class="ident" id="7699540">nil</span>&nbsp;<span class="op" id="7699544">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699548">t</span><span class="op" id="7699549">.</span><span class="ident" id="7699550">Fatal</span><span class="op" id="7699555">(</span><span class="string" id="7699556">&#34;encode:&#34;</span><span class="op" id="7699565">,</span>&nbsp;<span class="ident" id="7699567">err</span><span class="op" id="7699570">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699573">}</span><br>
<span class="lineno">615</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699576">dec</span>&nbsp;<span class="op" id="7699580">:=</span>&nbsp;<span class="ident" id="7699583">NewDecoder</span><span class="op" id="7699593">(</span><span class="ident" id="7699594">b</span><span class="op" id="7699595">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699598">out</span>&nbsp;<span class="op" id="7699602">:=</span>&nbsp;<span class="builtinfunc" id="7699605">make</span><span class="op" id="7699609">(</span><span class="ident" id="7699610">Bug1StructMap</span><span class="op" id="7699623">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699626">err</span>&nbsp;<span class="op" id="7699630">=</span>&nbsp;<span class="ident" id="7699632">dec</span><span class="op" id="7699635">.</span><span class="ident" id="7699636">Decode</span><span class="op" id="7699642">(</span><span class="op" id="7699643">&amp;</span><span class="ident" id="7699644">out</span><span class="op" id="7699647">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699650">if</span>&nbsp;<span class="ident" id="7699653">err</span>&nbsp;<span class="op" id="7699657">!=</span>&nbsp;<span class="ident" id="7699660">nil</span>&nbsp;<span class="op" id="7699664">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699668">t</span><span class="op" id="7699669">.</span><span class="ident" id="7699670">Fatal</span><span class="op" id="7699675">(</span><span class="string" id="7699676">&#34;decode:&#34;</span><span class="op" id="7699685">,</span>&nbsp;<span class="ident" id="7699687">err</span><span class="op" id="7699690">)</span><br>
<span class="lineno">620</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699693">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7699696">if</span>&nbsp;<span class="op" id="7699699">!</span><span class="ident" id="7699700">reflect</span><span class="op" id="7699707">.</span><span class="ident" id="7699708">DeepEqual</span><span class="op" id="7699717">(</span><span class="ident" id="7699718">in</span><span class="op" id="7699720">,</span>&nbsp;<span class="ident" id="7699722">out</span><span class="op" id="7699725">)</span>&nbsp;<span class="op" id="7699727">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699731">t</span><span class="op" id="7699732">.</span><span class="ident" id="7699733">Errorf</span><span class="op" id="7699739">(</span><span class="string" id="7699740">&#34;mismatch:&nbsp;%v&nbsp;%v&#34;</span><span class="op" id="7699757">,</span>&nbsp;<span class="ident" id="7699759">in</span><span class="op" id="7699761">,</span>&nbsp;<span class="ident" id="7699763">out</span><span class="op" id="7699766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7699769">}</span><br>
<span class="lineno"></span><span class="op" id="7699771">}</span><br>
<span class="lineno">625</span><br>
<span class="lineno"></span><span class="keyword" id="7699774">func</span>&nbsp;<span class="ident" id="7699779">TestGobMapInterfaceEncode</span><span class="op" id="7699804">(</span><span class="ident" id="7699805">t</span>&nbsp;<span class="op" id="7699807">*</span><span class="ident" id="7699808">testing</span><span class="op" id="7699815">.</span><span class="ident" id="7699816">T</span><span class="op" id="7699817">)</span>&nbsp;<span class="op" id="7699819">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7699822">m</span>&nbsp;<span class="op" id="7699824">:=</span>&nbsp;<span class="keyword" id="7699827">map</span><span class="op" id="7699830">[</span><span class="builtintype" id="7699831">string</span><span class="op" id="7699837">]</span><span class="keyword" id="7699838">interface</span><span class="op" id="7699847">{</span><span class="op" id="7699848">}</span><span class="op" id="7699849">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699853">&#34;up&#34;</span><span class="op" id="7699857">:</span>&nbsp;<span class="builtintype" id="7699859">uintptr</span><span class="op" id="7699866">(</span><span class="num" id="7699867">0</span><span class="op" id="7699868">)</span><span class="op" id="7699869">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699873">&#34;i0&#34;</span><span class="op" id="7699877">:</span>&nbsp;<span class="op" id="7699879">[</span><span class="op" id="7699880">]</span><span class="builtintype" id="7699881">int</span><span class="op" id="7699884">{</span><span class="op" id="7699885">-</span><span class="num" id="7699886">1</span><span class="op" id="7699887">}</span><span class="op" id="7699888">,</span><br>
<span class="lineno">630</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699892">&#34;i1&#34;</span><span class="op" id="7699896">:</span>&nbsp;<span class="op" id="7699898">[</span><span class="op" id="7699899">]</span><span class="builtintype" id="7699900">int8</span><span class="op" id="7699904">{</span><span class="op" id="7699905">-</span><span class="num" id="7699906">1</span><span class="op" id="7699907">}</span><span class="op" id="7699908">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699912">&#34;i2&#34;</span><span class="op" id="7699916">:</span>&nbsp;<span class="op" id="7699918">[</span><span class="op" id="7699919">]</span><span class="builtintype" id="7699920">int16</span><span class="op" id="7699925">{</span><span class="op" id="7699926">-</span><span class="num" id="7699927">1</span><span class="op" id="7699928">}</span><span class="op" id="7699929">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699933">&#34;i3&#34;</span><span class="op" id="7699937">:</span>&nbsp;<span class="op" id="7699939">[</span><span class="op" id="7699940">]</span><span class="builtintype" id="7699941">int32</span><span class="op" id="7699946">{</span><span class="op" id="7699947">-</span><span class="num" id="7699948">1</span><span class="op" id="7699949">}</span><span class="op" id="7699950">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699954">&#34;i4&#34;</span><span class="op" id="7699958">:</span>&nbsp;<span class="op" id="7699960">[</span><span class="op" id="7699961">]</span><span class="ident" id="7699962">int64</span><span class="op" id="7699967">{</span><span class="op" id="7699968">-</span><span class="num" id="7699969">1</span><span class="op" id="7699970">}</span><span class="op" id="7699971">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699975">&#34;u0&#34;</span><span class="op" id="7699979">:</span>&nbsp;<span class="op" id="7699981">[</span><span class="op" id="7699982">]</span><span class="builtintype" id="7699983">uint</span><span class="op" id="7699987">{</span><span class="num" id="7699988">1</span><span class="op" id="7699989">}</span><span class="op" id="7699990">,</span><br>
<span class="lineno">635</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7699994">&#34;u1&#34;</span><span class="op" id="7699998">:</span>&nbsp;<span class="op" id="7700000">[</span><span class="op" id="7700001">]</span><span class="builtintype" id="7700002">uint8</span><span class="op" id="7700007">{</span><span class="num" id="7700008">1</span><span class="op" id="7700009">}</span><span class="op" id="7700010">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700014">&#34;u2&#34;</span><span class="op" id="7700018">:</span>&nbsp;<span class="op" id="7700020">[</span><span class="op" id="7700021">]</span><span class="builtintype" id="7700022">uint16</span><span class="op" id="7700028">{</span><span class="num" id="7700029">1</span><span class="op" id="7700030">}</span><span class="op" id="7700031">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700035">&#34;u3&#34;</span><span class="op" id="7700039">:</span>&nbsp;<span class="op" id="7700041">[</span><span class="op" id="7700042">]</span><span class="builtintype" id="7700043">uint32</span><span class="op" id="7700049">{</span><span class="num" id="7700050">1</span><span class="op" id="7700051">}</span><span class="op" id="7700052">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700056">&#34;u4&#34;</span><span class="op" id="7700060">:</span>&nbsp;<span class="op" id="7700062">[</span><span class="op" id="7700063">]</span><span class="ident" id="7700064">uint64</span><span class="op" id="7700070">{</span><span class="num" id="7700071">1</span><span class="op" id="7700072">}</span><span class="op" id="7700073">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700077">&#34;f0&#34;</span><span class="op" id="7700081">:</span>&nbsp;<span class="op" id="7700083">[</span><span class="op" id="7700084">]</span><span class="builtintype" id="7700085">float32</span><span class="op" id="7700092">{</span><span class="num" id="7700093">1</span><span class="op" id="7700094">}</span><span class="op" id="7700095">,</span><br>
<span class="lineno">640</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700099">&#34;f1&#34;</span><span class="op" id="7700103">:</span>&nbsp;<span class="op" id="7700105">[</span><span class="op" id="7700106">]</span><span class="builtintype" id="7700107">float64</span><span class="op" id="7700114">{</span><span class="num" id="7700115">1</span><span class="op" id="7700116">}</span><span class="op" id="7700117">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700121">&#34;c0&#34;</span><span class="op" id="7700125">:</span>&nbsp;<span class="op" id="7700127">[</span><span class="op" id="7700128">]</span><span class="builtintype" id="7700129">complex64</span><span class="op" id="7700138">{</span><span class="builtinfunc" id="7700139">complex</span><span class="op" id="7700146">(</span><span class="num" id="7700147">2</span><span class="op" id="7700148">,</span>&nbsp;<span class="op" id="7700150">-</span><span class="num" id="7700151">2</span><span class="op" id="7700152">)</span><span class="op" id="7700153">}</span><span class="op" id="7700154">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700158">&#34;c1&#34;</span><span class="op" id="7700162">:</span>&nbsp;<span class="op" id="7700164">[</span><span class="op" id="7700165">]</span><span class="builtintype" id="7700166">complex128</span><span class="op" id="7700176">{</span><span class="builtinfunc" id="7700177">complex</span><span class="op" id="7700184">(</span><span class="num" id="7700185">2</span><span class="op" id="7700186">,</span>&nbsp;<span class="builtintype" id="7700188">float64</span><span class="op" id="7700195">(</span><span class="op" id="7700196">-</span><span class="num" id="7700197">2</span><span class="op" id="7700198">)</span><span class="op" id="7700199">)</span><span class="op" id="7700200">}</span><span class="op" id="7700201">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700205">&#34;us&#34;</span><span class="op" id="7700209">:</span>&nbsp;<span class="op" id="7700211">[</span><span class="op" id="7700212">]</span><span class="builtintype" id="7700213">uintptr</span><span class="op" id="7700220">{</span><span class="num" id="7700221">0</span><span class="op" id="7700222">}</span><span class="op" id="7700223">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700227">&#34;bo&#34;</span><span class="op" id="7700231">:</span>&nbsp;<span class="op" id="7700233">[</span><span class="op" id="7700234">]</span><span class="builtintype" id="7700235">bool</span><span class="op" id="7700239">{</span><span class="builtintype" id="7700240">false</span><span class="op" id="7700245">}</span><span class="op" id="7700246">,</span><br>
<span class="lineno">645</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7700250">&#34;st&#34;</span><span class="op" id="7700254">:</span>&nbsp;<span class="op" id="7700256">[</span><span class="op" id="7700257">]</span><span class="builtintype" id="7700258">string</span><span class="op" id="7700264">{</span><span class="string" id="7700265">&#34;s&#34;</span><span class="op" id="7700268">}</span><span class="op" id="7700269">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700272">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700275">enc</span>&nbsp;<span class="op" id="7700279">:=</span>&nbsp;<span class="ident" id="7700282">NewEncoder</span><span class="op" id="7700292">(</span><span class="builtinfunc" id="7700293">new</span><span class="op" id="7700296">(</span><span class="ident" id="7700297">bytes</span><span class="op" id="7700302">.</span><span class="ident" id="7700303">Buffer</span><span class="op" id="7700309">)</span><span class="op" id="7700310">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700313">err</span>&nbsp;<span class="op" id="7700317">:=</span>&nbsp;<span class="ident" id="7700320">enc</span><span class="op" id="7700323">.</span><span class="ident" id="7700324">Encode</span><span class="op" id="7700330">(</span><span class="ident" id="7700331">m</span><span class="op" id="7700332">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700335">if</span>&nbsp;<span class="ident" id="7700338">err</span>&nbsp;<span class="op" id="7700342">!=</span>&nbsp;<span class="ident" id="7700345">nil</span>&nbsp;<span class="op" id="7700349">{</span><br>
<span class="lineno">650</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700353">t</span><span class="op" id="7700354">.</span><span class="ident" id="7700355">Errorf</span><span class="op" id="7700361">(</span><span class="string" id="7700362">&#34;encode&nbsp;map:&nbsp;%s&#34;</span><span class="op" id="7700378">,</span>&nbsp;<span class="ident" id="7700380">err</span><span class="op" id="7700383">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700386">}</span><br>
<span class="lineno"></span><span class="op" id="7700388">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7700391">func</span>&nbsp;<span class="ident" id="7700396">TestSliceReusesMemory</span><span class="op" id="7700417">(</span><span class="ident" id="7700418">t</span>&nbsp;<span class="op" id="7700420">*</span><span class="ident" id="7700421">testing</span><span class="op" id="7700428">.</span><span class="ident" id="7700429">T</span><span class="op" id="7700430">)</span>&nbsp;<span class="op" id="7700432">{</span><br>
<span class="lineno">655</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700435">buf</span>&nbsp;<span class="op" id="7700439">:=</span>&nbsp;<span class="builtinfunc" id="7700442">new</span><span class="op" id="7700445">(</span><span class="ident" id="7700446">bytes</span><span class="op" id="7700451">.</span><span class="ident" id="7700452">Buffer</span><span class="op" id="7700458">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7700461">//&nbsp;Bytes</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700471">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700475">x</span>&nbsp;<span class="op" id="7700477">:=</span>&nbsp;<span class="op" id="7700480">[</span><span class="op" id="7700481">]</span><span class="builtintype" id="7700482">byte</span><span class="op" id="7700486">(</span><span class="string" id="7700487">&#34;abcd&#34;</span><span class="op" id="7700493">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700497">enc</span>&nbsp;<span class="op" id="7700501">:=</span>&nbsp;<span class="ident" id="7700504">NewEncoder</span><span class="op" id="7700514">(</span><span class="ident" id="7700515">buf</span><span class="op" id="7700518">)</span><br>
<span class="lineno">660</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700522">err</span>&nbsp;<span class="op" id="7700526">:=</span>&nbsp;<span class="ident" id="7700529">enc</span><span class="op" id="7700532">.</span><span class="ident" id="7700533">Encode</span><span class="op" id="7700539">(</span><span class="ident" id="7700540">x</span><span class="op" id="7700541">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700545">if</span>&nbsp;<span class="ident" id="7700548">err</span>&nbsp;<span class="op" id="7700552">!=</span>&nbsp;<span class="ident" id="7700555">nil</span>&nbsp;<span class="op" id="7700559">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700564">t</span><span class="op" id="7700565">.</span><span class="ident" id="7700566">Errorf</span><span class="op" id="7700572">(</span><span class="string" id="7700573">&#34;bytes:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7700592">,</span>&nbsp;<span class="ident" id="7700594">err</span><span class="op" id="7700597">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700601">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7700605">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno">665</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700646">y</span>&nbsp;<span class="op" id="7700648">:=</span>&nbsp;<span class="op" id="7700651">[</span><span class="op" id="7700652">]</span><span class="builtintype" id="7700653">byte</span><span class="op" id="7700657">(</span><span class="string" id="7700658">&#34;ABCDE&#34;</span><span class="op" id="7700665">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700669">addr</span>&nbsp;<span class="op" id="7700674">:=</span>&nbsp;<span class="op" id="7700677">&amp;</span><span class="ident" id="7700678">y</span><span class="op" id="7700679">[</span><span class="num" id="7700680">0</span><span class="op" id="7700681">]</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700685">dec</span>&nbsp;<span class="op" id="7700689">:=</span>&nbsp;<span class="ident" id="7700692">NewDecoder</span><span class="op" id="7700702">(</span><span class="ident" id="7700703">buf</span><span class="op" id="7700706">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700710">err</span>&nbsp;<span class="op" id="7700714">=</span>&nbsp;<span class="ident" id="7700716">dec</span><span class="op" id="7700719">.</span><span class="ident" id="7700720">Decode</span><span class="op" id="7700726">(</span><span class="op" id="7700727">&amp;</span><span class="ident" id="7700728">y</span><span class="op" id="7700729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700733">if</span>&nbsp;<span class="ident" id="7700736">err</span>&nbsp;<span class="op" id="7700740">!=</span>&nbsp;<span class="ident" id="7700743">nil</span>&nbsp;<span class="op" id="7700747">{</span><br>
<span class="lineno">670</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700752">t</span><span class="op" id="7700753">.</span><span class="ident" id="7700754">Fatal</span><span class="op" id="7700759">(</span><span class="string" id="7700760">&#34;bytes:&nbsp;decode:&#34;</span><span class="op" id="7700776">,</span>&nbsp;<span class="ident" id="7700778">err</span><span class="op" id="7700781">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700785">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700789">if</span>&nbsp;<span class="op" id="7700792">!</span><span class="ident" id="7700793">bytes</span><span class="op" id="7700798">.</span><span class="ident" id="7700799">Equal</span><span class="op" id="7700804">(</span><span class="ident" id="7700805">x</span><span class="op" id="7700806">,</span>&nbsp;<span class="ident" id="7700808">y</span><span class="op" id="7700809">)</span>&nbsp;<span class="op" id="7700811">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700816">t</span><span class="op" id="7700817">.</span><span class="ident" id="7700818">Errorf</span><span class="op" id="7700824">(</span><span class="string" id="7700825">&#34;bytes:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7700854">,</span>&nbsp;<span class="ident" id="7700856">x</span><span class="op" id="7700857">,</span>&nbsp;<span class="ident" id="7700859">y</span><span class="op" id="7700860">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700864">}</span><br>
<span class="lineno">675</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7700868">if</span>&nbsp;<span class="ident" id="7700871">addr</span>&nbsp;<span class="op" id="7700876">!=</span>&nbsp;<span class="op" id="7700879">&amp;</span><span class="ident" id="7700880">y</span><span class="op" id="7700881">[</span><span class="num" id="7700882">0</span><span class="op" id="7700883">]</span>&nbsp;<span class="op" id="7700885">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700890">t</span><span class="op" id="7700891">.</span><span class="ident" id="7700892">Errorf</span><span class="op" id="7700898">(</span><span class="string" id="7700899">&#34;bytes:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7700932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700936">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700939">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7700942">//&nbsp;general&nbsp;slice</span><br>
<span class="lineno">680</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7700960">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700964">x</span>&nbsp;<span class="op" id="7700966">:=</span>&nbsp;<span class="op" id="7700969">[</span><span class="op" id="7700970">]</span><span class="builtintype" id="7700971">rune</span><span class="op" id="7700975">(</span><span class="string" id="7700976">&#34;abcd&#34;</span><span class="op" id="7700982">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7700986">enc</span>&nbsp;<span class="op" id="7700990">:=</span>&nbsp;<span class="ident" id="7700993">NewEncoder</span><span class="op" id="7701003">(</span><span class="ident" id="7701004">buf</span><span class="op" id="7701007">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701011">err</span>&nbsp;<span class="op" id="7701015">:=</span>&nbsp;<span class="ident" id="7701018">enc</span><span class="op" id="7701021">.</span><span class="ident" id="7701022">Encode</span><span class="op" id="7701028">(</span><span class="ident" id="7701029">x</span><span class="op" id="7701030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701034">if</span>&nbsp;<span class="ident" id="7701037">err</span>&nbsp;<span class="op" id="7701041">!=</span>&nbsp;<span class="ident" id="7701044">nil</span>&nbsp;<span class="op" id="7701048">{</span><br>
<span class="lineno">685</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701053">t</span><span class="op" id="7701054">.</span><span class="ident" id="7701055">Errorf</span><span class="op" id="7701061">(</span><span class="string" id="7701062">&#34;ints:&nbsp;encode:&nbsp;%s&#34;</span><span class="op" id="7701080">,</span>&nbsp;<span class="ident" id="7701082">err</span><span class="op" id="7701085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701089">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7701093">//&nbsp;Decode&nbsp;into&nbsp;y,&nbsp;which&nbsp;is&nbsp;big&nbsp;enough.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701134">y</span>&nbsp;<span class="op" id="7701136">:=</span>&nbsp;<span class="op" id="7701139">[</span><span class="op" id="7701140">]</span><span class="builtintype" id="7701141">rune</span><span class="op" id="7701145">(</span><span class="string" id="7701146">&#34;ABCDE&#34;</span><span class="op" id="7701153">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701157">addr</span>&nbsp;<span class="op" id="7701162">:=</span>&nbsp;<span class="op" id="7701165">&amp;</span><span class="ident" id="7701166">y</span><span class="op" id="7701167">[</span><span class="num" id="7701168">0</span><span class="op" id="7701169">]</span><br>
<span class="lineno">690</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701173">dec</span>&nbsp;<span class="op" id="7701177">:=</span>&nbsp;<span class="ident" id="7701180">NewDecoder</span><span class="op" id="7701190">(</span><span class="ident" id="7701191">buf</span><span class="op" id="7701194">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701198">err</span>&nbsp;<span class="op" id="7701202">=</span>&nbsp;<span class="ident" id="7701204">dec</span><span class="op" id="7701207">.</span><span class="ident" id="7701208">Decode</span><span class="op" id="7701214">(</span><span class="op" id="7701215">&amp;</span><span class="ident" id="7701216">y</span><span class="op" id="7701217">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701221">if</span>&nbsp;<span class="ident" id="7701224">err</span>&nbsp;<span class="op" id="7701228">!=</span>&nbsp;<span class="ident" id="7701231">nil</span>&nbsp;<span class="op" id="7701235">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701240">t</span><span class="op" id="7701241">.</span><span class="ident" id="7701242">Fatal</span><span class="op" id="7701247">(</span><span class="string" id="7701248">&#34;ints:&nbsp;decode:&#34;</span><span class="op" id="7701263">,</span>&nbsp;<span class="ident" id="7701265">err</span><span class="op" id="7701268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701272">}</span><br>
<span class="lineno">695</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701276">if</span>&nbsp;<span class="op" id="7701279">!</span><span class="ident" id="7701280">reflect</span><span class="op" id="7701287">.</span><span class="ident" id="7701288">DeepEqual</span><span class="op" id="7701297">(</span><span class="ident" id="7701298">x</span><span class="op" id="7701299">,</span>&nbsp;<span class="ident" id="7701301">y</span><span class="op" id="7701302">)</span>&nbsp;<span class="op" id="7701304">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701309">t</span><span class="op" id="7701310">.</span><span class="ident" id="7701311">Errorf</span><span class="op" id="7701317">(</span><span class="string" id="7701318">&#34;ints:&nbsp;expected&nbsp;%q&nbsp;got&nbsp;%q\n&#34;</span><span class="op" id="7701346">,</span>&nbsp;<span class="ident" id="7701348">x</span><span class="op" id="7701349">,</span>&nbsp;<span class="ident" id="7701351">y</span><span class="op" id="7701352">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701356">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701360">if</span>&nbsp;<span class="ident" id="7701363">addr</span>&nbsp;<span class="op" id="7701368">!=</span>&nbsp;<span class="op" id="7701371">&amp;</span><span class="ident" id="7701372">y</span><span class="op" id="7701373">[</span><span class="num" id="7701374">0</span><span class="op" id="7701375">]</span>&nbsp;<span class="op" id="7701377">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701382">t</span><span class="op" id="7701383">.</span><span class="ident" id="7701384">Errorf</span><span class="op" id="7701390">(</span><span class="string" id="7701391">&#34;ints:&nbsp;unnecessary&nbsp;reallocation&#34;</span><span class="op" id="7701423">)</span><br>
<span class="lineno">700</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701427">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701430">}</span><br>
<span class="lineno"></span><span class="op" id="7701432">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7701435">//&nbsp;Used&nbsp;to&nbsp;crash:&nbsp;negative&nbsp;count&nbsp;in&nbsp;recvMessage.</span><br>
<span class="lineno">705</span><span class="keyword" id="7701484">func</span>&nbsp;<span class="ident" id="7701489">TestBadCount</span><span class="op" id="7701501">(</span><span class="ident" id="7701502">t</span>&nbsp;<span class="op" id="7701504">*</span><span class="ident" id="7701505">testing</span><span class="op" id="7701512">.</span><span class="ident" id="7701513">T</span><span class="op" id="7701514">)</span>&nbsp;<span class="op" id="7701516">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701519">b</span>&nbsp;<span class="op" id="7701521">:=</span>&nbsp;<span class="op" id="7701524">[</span><span class="op" id="7701525">]</span><span class="builtintype" id="7701526">byte</span><span class="op" id="7701530">{</span><span class="num" id="7701531">0xfb</span><span class="op" id="7701535">,</span>&nbsp;<span class="num" id="7701537">0xa5</span><span class="op" id="7701541">,</span>&nbsp;<span class="num" id="7701543">0x82</span><span class="op" id="7701547">,</span>&nbsp;<span class="num" id="7701549">0x2f</span><span class="op" id="7701553">,</span>&nbsp;<span class="num" id="7701555">0xca</span><span class="op" id="7701559">,</span>&nbsp;<span class="num" id="7701561">0x1</span><span class="op" id="7701564">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7701567">if</span>&nbsp;<span class="ident" id="7701570">err</span>&nbsp;<span class="op" id="7701574">:=</span>&nbsp;<span class="ident" id="7701577">NewDecoder</span><span class="op" id="7701587">(</span><span class="ident" id="7701588">bytes</span><span class="op" id="7701593">.</span><span class="ident" id="7701594">NewReader</span><span class="op" id="7701603">(</span><span class="ident" id="7701604">b</span><span class="op" id="7701605">)</span><span class="op" id="7701606">)</span><span class="op" id="7701607">.</span><span class="ident" id="7701608">Decode</span><span class="op" id="7701614">(</span><span class="ident" id="7701615">nil</span><span class="op" id="7701618">)</span><span class="op" id="7701619">;</span>&nbsp;<span class="ident" id="7701621">err</span>&nbsp;<span class="op" id="7701625">==</span>&nbsp;<span class="ident" id="7701628">nil</span>&nbsp;<span class="op" id="7701632">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701636">t</span><span class="op" id="7701637">.</span><span class="ident" id="7701638">Error</span><span class="op" id="7701643">(</span><span class="string" id="7701644">&#34;expected&nbsp;error&nbsp;from&nbsp;bad&nbsp;count&#34;</span><span class="op" id="7701675">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701678">}</span>&nbsp;<span class="keyword" id="7701680">else</span>&nbsp;<span class="keyword" id="7701685">if</span>&nbsp;<span class="ident" id="7701688">err</span><span class="op" id="7701691">.</span><span class="ident" id="7701692">Error</span><span class="op" id="7701697">(</span><span class="op" id="7701698">)</span>&nbsp;<span class="op" id="7701700">!=</span>&nbsp;<span class="ident" id="7701703">errBadCount</span><span class="op" id="7701714">.</span><span class="ident" id="7701715">Error</span><span class="op" id="7701720">(</span><span class="op" id="7701721">)</span>&nbsp;<span class="op" id="7701723">{</span><br>
<span class="lineno">710</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701727">t</span><span class="op" id="7701728">.</span><span class="ident" id="7701729">Error</span><span class="op" id="7701734">(</span><span class="string" id="7701735">&#34;expected&nbsp;bad&nbsp;count&nbsp;error;&nbsp;got&#34;</span><span class="op" id="7701766">,</span>&nbsp;<span class="ident" id="7701768">err</span><span class="op" id="7701771">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7701774">}</span><br>
<span class="lineno"></span><span class="op" id="7701776">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7701779">//&nbsp;Verify&nbsp;that&nbsp;sequential&nbsp;Decoders&nbsp;built&nbsp;on&nbsp;a&nbsp;single&nbsp;input&nbsp;will</span><br>
<span class="lineno">715</span><span class="comment" id="7701843">//&nbsp;succeed&nbsp;if&nbsp;the&nbsp;input&nbsp;implements&nbsp;ReadByte&nbsp;and&nbsp;there&nbsp;is&nbsp;no</span><br>
<span class="lineno"></span><span class="comment" id="7701903">//&nbsp;type&nbsp;information&nbsp;in&nbsp;the&nbsp;stream.</span><br>
<span class="lineno"></span><span class="keyword" id="7701938">func</span>&nbsp;<span class="ident" id="7701943">TestSequentialDecoder</span><span class="op" id="7701964">(</span><span class="ident" id="7701965">t</span>&nbsp;<span class="op" id="7701967">*</span><span class="ident" id="7701968">testing</span><span class="op" id="7701975">.</span><span class="ident" id="7701976">T</span><span class="op" id="7701977">)</span>&nbsp;<span class="op" id="7701979">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7701982">b</span>&nbsp;<span class="op" id="7701984">:=</span>&nbsp;<span class="builtinfunc" id="7701987">new</span><span class="op" id="7701990">(</span><span class="ident" id="7701991">bytes</span><span class="op" id="7701996">.</span><span class="ident" id="7701997">Buffer</span><span class="op" id="7702003">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702006">enc</span>&nbsp;<span class="op" id="7702010">:=</span>&nbsp;<span class="ident" id="7702013">NewEncoder</span><span class="op" id="7702023">(</span><span class="ident" id="7702024">b</span><span class="op" id="7702025">)</span><br>
<span class="lineno">720</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702028">const</span>&nbsp;<span class="ident" id="7702034">count</span>&nbsp;<span class="op" id="7702040">=</span>&nbsp;<span class="num" id="7702042">10</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702046">for</span>&nbsp;<span class="ident" id="7702050">i</span>&nbsp;<span class="op" id="7702052">:=</span>&nbsp;<span class="num" id="7702055">0</span><span class="op" id="7702056">;</span>&nbsp;<span class="ident" id="7702058">i</span>&nbsp;<span class="op" id="7702060">&lt;</span>&nbsp;<span class="ident" id="7702062">count</span><span class="op" id="7702067">;</span>&nbsp;<span class="ident" id="7702069">i</span><span class="op" id="7702070">++</span>&nbsp;<span class="op" id="7702073">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702077">s</span>&nbsp;<span class="op" id="7702079">:=</span>&nbsp;<span class="ident" id="7702082">fmt</span><span class="op" id="7702085">.</span><span class="ident" id="7702086">Sprintf</span><span class="op" id="7702093">(</span><span class="string" id="7702094">&#34;%d&#34;</span><span class="op" id="7702098">,</span>&nbsp;<span class="ident" id="7702100">i</span><span class="op" id="7702101">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702105">if</span>&nbsp;<span class="ident" id="7702108">err</span>&nbsp;<span class="op" id="7702112">:=</span>&nbsp;<span class="ident" id="7702115">enc</span><span class="op" id="7702118">.</span><span class="ident" id="7702119">Encode</span><span class="op" id="7702125">(</span><span class="ident" id="7702126">s</span><span class="op" id="7702127">)</span><span class="op" id="7702128">;</span>&nbsp;<span class="ident" id="7702130">err</span>&nbsp;<span class="op" id="7702134">!=</span>&nbsp;<span class="ident" id="7702137">nil</span>&nbsp;<span class="op" id="7702141">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702146">t</span><span class="op" id="7702147">.</span><span class="ident" id="7702148">Error</span><span class="op" id="7702153">(</span><span class="string" id="7702154">&#34;encoder&nbsp;fail:&#34;</span><span class="op" id="7702169">,</span>&nbsp;<span class="ident" id="7702171">err</span><span class="op" id="7702174">)</span><br>
<span class="lineno">725</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702178">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702181">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702184">for</span>&nbsp;<span class="ident" id="7702188">i</span>&nbsp;<span class="op" id="7702190">:=</span>&nbsp;<span class="num" id="7702193">0</span><span class="op" id="7702194">;</span>&nbsp;<span class="ident" id="7702196">i</span>&nbsp;<span class="op" id="7702198">&lt;</span>&nbsp;<span class="ident" id="7702200">count</span><span class="op" id="7702205">;</span>&nbsp;<span class="ident" id="7702207">i</span><span class="op" id="7702208">++</span>&nbsp;<span class="op" id="7702211">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702215">dec</span>&nbsp;<span class="op" id="7702219">:=</span>&nbsp;<span class="ident" id="7702222">NewDecoder</span><span class="op" id="7702232">(</span><span class="ident" id="7702233">b</span><span class="op" id="7702234">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702238">var</span>&nbsp;<span class="ident" id="7702242">s</span>&nbsp;<span class="builtintype" id="7702244">string</span><br>
<span class="lineno">730</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702253">if</span>&nbsp;<span class="ident" id="7702256">err</span>&nbsp;<span class="op" id="7702260">:=</span>&nbsp;<span class="ident" id="7702263">dec</span><span class="op" id="7702266">.</span><span class="ident" id="7702267">Decode</span><span class="op" id="7702273">(</span><span class="op" id="7702274">&amp;</span><span class="ident" id="7702275">s</span><span class="op" id="7702276">)</span><span class="op" id="7702277">;</span>&nbsp;<span class="ident" id="7702279">err</span>&nbsp;<span class="op" id="7702283">!=</span>&nbsp;<span class="ident" id="7702286">nil</span>&nbsp;<span class="op" id="7702290">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702295">t</span><span class="op" id="7702296">.</span><span class="ident" id="7702297">Fatal</span><span class="op" id="7702302">(</span><span class="string" id="7702303">&#34;decoder&nbsp;fail:&#34;</span><span class="op" id="7702318">,</span>&nbsp;<span class="ident" id="7702320">err</span><span class="op" id="7702323">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702327">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702331">if</span>&nbsp;<span class="ident" id="7702334">s</span>&nbsp;<span class="op" id="7702336">!=</span>&nbsp;<span class="ident" id="7702339">fmt</span><span class="op" id="7702342">.</span><span class="ident" id="7702343">Sprintf</span><span class="op" id="7702350">(</span><span class="string" id="7702351">&#34;%d&#34;</span><span class="op" id="7702355">,</span>&nbsp;<span class="ident" id="7702357">i</span><span class="op" id="7702358">)</span>&nbsp;<span class="op" id="7702360">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702365">t</span><span class="op" id="7702366">.</span><span class="ident" id="7702367">Fatalf</span><span class="op" id="7702373">(</span><span class="string" id="7702374">&#34;decode&nbsp;expected&nbsp;%d&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7702401">,</span>&nbsp;<span class="ident" id="7702403">i</span><span class="op" id="7702404">,</span>&nbsp;<span class="ident" id="7702406">s</span><span class="op" id="7702407">)</span><br>
<span class="lineno">735</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702411">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702414">}</span><br>
<span class="lineno"></span><span class="op" id="7702416">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7702419">//&nbsp;Should&nbsp;be&nbsp;able&nbsp;to&nbsp;have&nbsp;unrepresentable&nbsp;fields&nbsp;(chan,&nbsp;func,&nbsp;*chan&nbsp;etc.);&nbsp;we&nbsp;just&nbsp;ignore&nbsp;them.</span><br>
<span class="lineno">740</span><span class="keyword" id="7702515">type</span>&nbsp;<span class="ident" id="7702520">Bug2</span>&nbsp;<span class="keyword" id="7702525">struct</span>&nbsp;<span class="op" id="7702532">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702535">A</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7702539">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702544">C</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7702548">chan</span>&nbsp;<span class="builtintype" id="7702553">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702558">CP</span>&nbsp;&nbsp;<span class="op" id="7702562">*</span><span class="keyword" id="7702563">chan</span>&nbsp;<span class="builtintype" id="7702568">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702573">F</span>&nbsp;&nbsp;&nbsp;<span class="keyword" id="7702577">func</span><span class="op" id="7702581">(</span><span class="op" id="7702582">)</span><br>
<span class="lineno">745</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702585">FPP</span>&nbsp;<span class="op" id="7702589">*</span><span class="op" id="7702590">*</span><span class="keyword" id="7702591">func</span><span class="op" id="7702595">(</span><span class="op" id="7702596">)</span><br>
<span class="lineno"></span><span class="op" id="7702598">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7702601">func</span>&nbsp;<span class="ident" id="7702606">TestChanFuncIgnored</span><span class="op" id="7702625">(</span><span class="ident" id="7702626">t</span>&nbsp;<span class="op" id="7702628">*</span><span class="ident" id="7702629">testing</span><span class="op" id="7702636">.</span><span class="ident" id="7702637">T</span><span class="op" id="7702638">)</span>&nbsp;<span class="op" id="7702640">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702643">c</span>&nbsp;<span class="op" id="7702645">:=</span>&nbsp;<span class="builtinfunc" id="7702648">make</span><span class="op" id="7702652">(</span><span class="keyword" id="7702653">chan</span>&nbsp;<span class="builtintype" id="7702658">int</span><span class="op" id="7702661">)</span><br>
<span class="lineno">750</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702664">f</span>&nbsp;<span class="op" id="7702666">:=</span>&nbsp;<span class="keyword" id="7702669">func</span><span class="op" id="7702673">(</span><span class="op" id="7702674">)</span>&nbsp;<span class="op" id="7702676">{</span><span class="op" id="7702677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702680">fp</span>&nbsp;<span class="op" id="7702683">:=</span>&nbsp;<span class="op" id="7702686">&amp;</span><span class="ident" id="7702687">f</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702690">b0</span>&nbsp;<span class="op" id="7702693">:=</span>&nbsp;<span class="ident" id="7702696">Bug2</span><span class="op" id="7702700">{</span><span class="num" id="7702701">23</span><span class="op" id="7702703">,</span>&nbsp;<span class="ident" id="7702705">c</span><span class="op" id="7702706">,</span>&nbsp;<span class="op" id="7702708">&amp;</span><span class="ident" id="7702709">c</span><span class="op" id="7702710">,</span>&nbsp;<span class="ident" id="7702712">f</span><span class="op" id="7702713">,</span>&nbsp;<span class="op" id="7702715">&amp;</span><span class="ident" id="7702716">fp</span><span class="op" id="7702718">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702721">var</span>&nbsp;<span class="ident" id="7702725">buf</span>&nbsp;<span class="ident" id="7702729">bytes</span><span class="op" id="7702734">.</span><span class="ident" id="7702735">Buffer</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702743">enc</span>&nbsp;<span class="op" id="7702747">:=</span>&nbsp;<span class="ident" id="7702750">NewEncoder</span><span class="op" id="7702760">(</span><span class="op" id="7702761">&amp;</span><span class="ident" id="7702762">buf</span><span class="op" id="7702765">)</span><br>
<span class="lineno">755</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702768">if</span>&nbsp;<span class="ident" id="7702771">err</span>&nbsp;<span class="op" id="7702775">:=</span>&nbsp;<span class="ident" id="7702778">enc</span><span class="op" id="7702781">.</span><span class="ident" id="7702782">Encode</span><span class="op" id="7702788">(</span><span class="ident" id="7702789">b0</span><span class="op" id="7702791">)</span><span class="op" id="7702792">;</span>&nbsp;<span class="ident" id="7702794">err</span>&nbsp;<span class="op" id="7702798">!=</span>&nbsp;<span class="ident" id="7702801">nil</span>&nbsp;<span class="op" id="7702805">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702809">t</span><span class="op" id="7702810">.</span><span class="ident" id="7702811">Fatal</span><span class="op" id="7702816">(</span><span class="string" id="7702817">&#34;error&nbsp;encoding:&#34;</span><span class="op" id="7702834">,</span>&nbsp;<span class="ident" id="7702836">err</span><span class="op" id="7702839">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702842">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702845">var</span>&nbsp;<span class="ident" id="7702849">b1</span>&nbsp;<span class="ident" id="7702852">Bug2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702858">err</span>&nbsp;<span class="op" id="7702862">:=</span>&nbsp;<span class="ident" id="7702865">NewDecoder</span><span class="op" id="7702875">(</span><span class="op" id="7702876">&amp;</span><span class="ident" id="7702877">buf</span><span class="op" id="7702880">)</span><span class="op" id="7702881">.</span><span class="ident" id="7702882">Decode</span><span class="op" id="7702888">(</span><span class="op" id="7702889">&amp;</span><span class="ident" id="7702890">b1</span><span class="op" id="7702892">)</span><br>
<span class="lineno">760</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702895">if</span>&nbsp;<span class="ident" id="7702898">err</span>&nbsp;<span class="op" id="7702902">!=</span>&nbsp;<span class="ident" id="7702905">nil</span>&nbsp;<span class="op" id="7702909">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702913">t</span><span class="op" id="7702914">.</span><span class="ident" id="7702915">Fatal</span><span class="op" id="7702920">(</span><span class="string" id="7702921">&#34;decode:&#34;</span><span class="op" id="7702930">,</span>&nbsp;<span class="ident" id="7702932">err</span><span class="op" id="7702935">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7702938">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7702941">if</span>&nbsp;<span class="ident" id="7702944">b1</span><span class="op" id="7702946">.</span><span class="ident" id="7702947">A</span>&nbsp;<span class="op" id="7702949">!=</span>&nbsp;<span class="ident" id="7702952">b0</span><span class="op" id="7702954">.</span><span class="ident" id="7702955">A</span>&nbsp;<span class="op" id="7702957">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7702961">t</span><span class="op" id="7702962">.</span><span class="ident" id="7702963">Fatalf</span><span class="op" id="7702969">(</span><span class="string" id="7702970">&#34;got&nbsp;%d&nbsp;want&nbsp;%d&#34;</span><span class="op" id="7702986">,</span>&nbsp;<span class="ident" id="7702988">b1</span><span class="op" id="7702990">.</span><span class="ident" id="7702991">A</span><span class="op" id="7702992">,</span>&nbsp;<span class="ident" id="7702994">b0</span><span class="op" id="7702996">.</span><span class="ident" id="7702997">A</span><span class="op" id="7702998">)</span><br>
<span class="lineno">765</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703001">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703004">if</span>&nbsp;<span class="ident" id="7703007">b1</span><span class="op" id="7703009">.</span><span class="ident" id="7703010">C</span>&nbsp;<span class="op" id="7703012">!=</span>&nbsp;<span class="ident" id="7703015">nil</span>&nbsp;<span class="op" id="7703019">||</span>&nbsp;<span class="ident" id="7703022">b1</span><span class="op" id="7703024">.</span><span class="ident" id="7703025">CP</span>&nbsp;<span class="op" id="7703028">!=</span>&nbsp;<span class="ident" id="7703031">nil</span>&nbsp;<span class="op" id="7703035">||</span>&nbsp;<span class="ident" id="7703038">b1</span><span class="op" id="7703040">.</span><span class="ident" id="7703041">F</span>&nbsp;<span class="op" id="7703043">!=</span>&nbsp;<span class="ident" id="7703046">nil</span>&nbsp;<span class="op" id="7703050">||</span>&nbsp;<span class="ident" id="7703053">b1</span><span class="op" id="7703055">.</span><span class="ident" id="7703056">FPP</span>&nbsp;<span class="op" id="7703060">!=</span>&nbsp;<span class="ident" id="7703063">nil</span>&nbsp;<span class="op" id="7703067">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703071">t</span><span class="op" id="7703072">.</span><span class="ident" id="7703073">Fatal</span><span class="op" id="7703078">(</span><span class="string" id="7703079">&#34;unexpected&nbsp;value&nbsp;for&nbsp;chan&nbsp;or&nbsp;func&#34;</span><span class="op" id="7703114">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703117">}</span><br>
<span class="lineno"></span><span class="op" id="7703119">}</span><br>
<span class="lineno">770</span><br>
<span class="lineno"></span><span class="keyword" id="7703122">func</span>&nbsp;<span class="ident" id="7703127">TestSliceIncompatibility</span><span class="op" id="7703151">(</span><span class="ident" id="7703152">t</span>&nbsp;<span class="op" id="7703154">*</span><span class="ident" id="7703155">testing</span><span class="op" id="7703162">.</span><span class="ident" id="7703163">T</span><span class="op" id="7703164">)</span>&nbsp;<span class="op" id="7703166">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703169">var</span>&nbsp;<span class="ident" id="7703173">in</span>&nbsp;<span class="op" id="7703176">=</span>&nbsp;<span class="op" id="7703178">[</span><span class="op" id="7703179">]</span><span class="builtintype" id="7703180">byte</span><span class="op" id="7703184">{</span><span class="num" id="7703185">1</span><span class="op" id="7703186">,</span>&nbsp;<span class="num" id="7703188">2</span><span class="op" id="7703189">,</span>&nbsp;<span class="num" id="7703191">3</span><span class="op" id="7703192">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703195">var</span>&nbsp;<span class="ident" id="7703199">out</span>&nbsp;<span class="op" id="7703203">[</span><span class="op" id="7703204">]</span><span class="builtintype" id="7703205">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703210">if</span>&nbsp;<span class="ident" id="7703213">err</span>&nbsp;<span class="op" id="7703217">:=</span>&nbsp;<span class="ident" id="7703220">encAndDec</span><span class="op" id="7703229">(</span><span class="ident" id="7703230">in</span><span class="op" id="7703232">,</span>&nbsp;<span class="op" id="7703234">&amp;</span><span class="ident" id="7703235">out</span><span class="op" id="7703238">)</span><span class="op" id="7703239">;</span>&nbsp;<span class="ident" id="7703241">err</span>&nbsp;<span class="op" id="7703245">==</span>&nbsp;<span class="ident" id="7703248">nil</span>&nbsp;<span class="op" id="7703252">{</span><br>
<span class="lineno">775</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703256">t</span><span class="op" id="7703257">.</span><span class="ident" id="7703258">Error</span><span class="op" id="7703263">(</span><span class="string" id="7703264">&#34;expected&nbsp;compatibility&nbsp;error&#34;</span><span class="op" id="7703294">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703297">}</span><br>
<span class="lineno"></span><span class="op" id="7703299">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7703302">//&nbsp;Mutually&nbsp;recursive&nbsp;slices&nbsp;of&nbsp;structs&nbsp;caused&nbsp;problems.</span><br>
<span class="lineno">780</span><span class="keyword" id="7703359">type</span>&nbsp;<span class="ident" id="7703364">Bug3</span>&nbsp;<span class="keyword" id="7703369">struct</span>&nbsp;<span class="op" id="7703376">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703379">Num</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7703388">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703393">Children</span>&nbsp;<span class="op" id="7703402">[</span><span class="op" id="7703403">]</span><span class="op" id="7703404">*</span><span class="ident" id="7703405">Bug3</span><br>
<span class="lineno"></span><span class="op" id="7703410">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">785</span><span class="keyword" id="7703413">func</span>&nbsp;<span class="ident" id="7703418">TestGobPtrSlices</span><span class="op" id="7703434">(</span><span class="ident" id="7703435">t</span>&nbsp;<span class="op" id="7703437">*</span><span class="ident" id="7703438">testing</span><span class="op" id="7703445">.</span><span class="ident" id="7703446">T</span><span class="op" id="7703447">)</span>&nbsp;<span class="op" id="7703449">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703452">in</span>&nbsp;<span class="op" id="7703455">:=</span>&nbsp;<span class="op" id="7703458">[</span><span class="op" id="7703459">]</span><span class="op" id="7703460">*</span><span class="ident" id="7703461">Bug3</span><span class="op" id="7703465">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703469">{</span><span class="num" id="7703470">1</span><span class="op" id="7703471">,</span>&nbsp;<span class="ident" id="7703473">nil</span><span class="op" id="7703476">}</span><span class="op" id="7703477">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703481">{</span><span class="num" id="7703482">2</span><span class="op" id="7703483">,</span>&nbsp;<span class="ident" id="7703485">nil</span><span class="op" id="7703488">}</span><span class="op" id="7703489">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703492">}</span><br>
<span class="lineno">790</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703495">b</span>&nbsp;<span class="op" id="7703497">:=</span>&nbsp;<span class="builtinfunc" id="7703500">new</span><span class="op" id="7703503">(</span><span class="ident" id="7703504">bytes</span><span class="op" id="7703509">.</span><span class="ident" id="7703510">Buffer</span><span class="op" id="7703516">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703519">err</span>&nbsp;<span class="op" id="7703523">:=</span>&nbsp;<span class="ident" id="7703526">NewEncoder</span><span class="op" id="7703536">(</span><span class="ident" id="7703537">b</span><span class="op" id="7703538">)</span><span class="op" id="7703539">.</span><span class="ident" id="7703540">Encode</span><span class="op" id="7703546">(</span><span class="op" id="7703547">&amp;</span><span class="ident" id="7703548">in</span><span class="op" id="7703550">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703553">if</span>&nbsp;<span class="ident" id="7703556">err</span>&nbsp;<span class="op" id="7703560">!=</span>&nbsp;<span class="ident" id="7703563">nil</span>&nbsp;<span class="op" id="7703567">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703571">t</span><span class="op" id="7703572">.</span><span class="ident" id="7703573">Fatal</span><span class="op" id="7703578">(</span><span class="string" id="7703579">&#34;encode:&#34;</span><span class="op" id="7703588">,</span>&nbsp;<span class="ident" id="7703590">err</span><span class="op" id="7703593">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703596">}</span><br>
<span class="lineno">795</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703600">var</span>&nbsp;<span class="ident" id="7703604">out</span>&nbsp;<span class="op" id="7703608">[</span><span class="op" id="7703609">]</span><span class="op" id="7703610">*</span><span class="ident" id="7703611">Bug3</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703617">err</span>&nbsp;<span class="op" id="7703621">=</span>&nbsp;<span class="ident" id="7703623">NewDecoder</span><span class="op" id="7703633">(</span><span class="ident" id="7703634">b</span><span class="op" id="7703635">)</span><span class="op" id="7703636">.</span><span class="ident" id="7703637">Decode</span><span class="op" id="7703643">(</span><span class="op" id="7703644">&amp;</span><span class="ident" id="7703645">out</span><span class="op" id="7703648">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703651">if</span>&nbsp;<span class="ident" id="7703654">err</span>&nbsp;<span class="op" id="7703658">!=</span>&nbsp;<span class="ident" id="7703661">nil</span>&nbsp;<span class="op" id="7703665">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703669">t</span><span class="op" id="7703670">.</span><span class="ident" id="7703671">Fatal</span><span class="op" id="7703676">(</span><span class="string" id="7703677">&#34;decode:&#34;</span><span class="op" id="7703686">,</span>&nbsp;<span class="ident" id="7703688">err</span><span class="op" id="7703691">)</span><br>
<span class="lineno">800</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703694">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7703697">if</span>&nbsp;<span class="op" id="7703700">!</span><span class="ident" id="7703701">reflect</span><span class="op" id="7703708">.</span><span class="ident" id="7703709">DeepEqual</span><span class="op" id="7703718">(</span><span class="ident" id="7703719">in</span><span class="op" id="7703721">,</span>&nbsp;<span class="ident" id="7703723">out</span><span class="op" id="7703726">)</span>&nbsp;<span class="op" id="7703728">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703732">t</span><span class="op" id="7703733">.</span><span class="ident" id="7703734">Fatalf</span><span class="op" id="7703740">(</span><span class="string" id="7703741">&#34;got&nbsp;%v;&nbsp;wanted&nbsp;%v&#34;</span><span class="op" id="7703760">,</span>&nbsp;<span class="ident" id="7703762">out</span><span class="op" id="7703765">,</span>&nbsp;<span class="ident" id="7703767">in</span><span class="op" id="7703769">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7703772">}</span><br>
<span class="lineno"></span><span class="op" id="7703774">}</span><br>
<span class="lineno">805</span><br>
<span class="lineno"></span><span class="comment" id="7703777">//&nbsp;getDecEnginePtr&nbsp;cached&nbsp;engine&nbsp;for&nbsp;ut.base&nbsp;instead&nbsp;of&nbsp;ut.user&nbsp;so&nbsp;we&nbsp;passed</span><br>
<span class="lineno"></span><span class="comment" id="7703854">//&nbsp;a&nbsp;*map&nbsp;and&nbsp;then&nbsp;tried&nbsp;to&nbsp;reuse&nbsp;its&nbsp;engine&nbsp;to&nbsp;decode&nbsp;the&nbsp;inner&nbsp;map.</span><br>
<span class="lineno"></span><span class="keyword" id="7703924">func</span>&nbsp;<span class="ident" id="7703929">TestPtrToMapOfMap</span><span class="op" id="7703946">(</span><span class="ident" id="7703947">t</span>&nbsp;<span class="op" id="7703949">*</span><span class="ident" id="7703950">testing</span><span class="op" id="7703957">.</span><span class="ident" id="7703958">T</span><span class="op" id="7703959">)</span>&nbsp;<span class="op" id="7703961">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7703964">Register</span><span class="op" id="7703972">(</span><span class="builtinfunc" id="7703973">make</span><span class="op" id="7703977">(</span><span class="keyword" id="7703978">map</span><span class="op" id="7703981">[</span><span class="builtintype" id="7703982">string</span><span class="op" id="7703988">]</span><span class="keyword" id="7703989">interface</span><span class="op" id="7703998">{</span><span class="op" id="7703999">}</span><span class="op" id="7704000">)</span><span class="op" id="7704001">)</span><br>
<span class="lineno">810</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704004">subdata</span>&nbsp;<span class="op" id="7704012">:=</span>&nbsp;<span class="builtinfunc" id="7704015">make</span><span class="op" id="7704019">(</span><span class="keyword" id="7704020">map</span><span class="op" id="7704023">[</span><span class="builtintype" id="7704024">string</span><span class="op" id="7704030">]</span><span class="keyword" id="7704031">interface</span><span class="op" id="7704040">{</span><span class="op" id="7704041">}</span><span class="op" id="7704042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704045">subdata</span><span class="op" id="7704052">[</span><span class="string" id="7704053">&#34;bar&#34;</span><span class="op" id="7704058">]</span>&nbsp;<span class="op" id="7704060">=</span>&nbsp;<span class="string" id="7704062">&#34;baz&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704069">data</span>&nbsp;<span class="op" id="7704074">:=</span>&nbsp;<span class="builtinfunc" id="7704077">make</span><span class="op" id="7704081">(</span><span class="keyword" id="7704082">map</span><span class="op" id="7704085">[</span><span class="builtintype" id="7704086">string</span><span class="op" id="7704092">]</span><span class="keyword" id="7704093">interface</span><span class="op" id="7704102">{</span><span class="op" id="7704103">}</span><span class="op" id="7704104">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704107">data</span><span class="op" id="7704111">[</span><span class="string" id="7704112">&#34;foo&#34;</span><span class="op" id="7704117">]</span>&nbsp;<span class="op" id="7704119">=</span>&nbsp;<span class="ident" id="7704121">subdata</span><br>
<span class="lineno"></span><br>
<span class="lineno">815</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704131">b</span>&nbsp;<span class="op" id="7704133">:=</span>&nbsp;<span class="builtinfunc" id="7704136">new</span><span class="op" id="7704139">(</span><span class="ident" id="7704140">bytes</span><span class="op" id="7704145">.</span><span class="ident" id="7704146">Buffer</span><span class="op" id="7704152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704155">err</span>&nbsp;<span class="op" id="7704159">:=</span>&nbsp;<span class="ident" id="7704162">NewEncoder</span><span class="op" id="7704172">(</span><span class="ident" id="7704173">b</span><span class="op" id="7704174">)</span><span class="op" id="7704175">.</span><span class="ident" id="7704176">Encode</span><span class="op" id="7704182">(</span><span class="ident" id="7704183">data</span><span class="op" id="7704187">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704190">if</span>&nbsp;<span class="ident" id="7704193">err</span>&nbsp;<span class="op" id="7704197">!=</span>&nbsp;<span class="ident" id="7704200">nil</span>&nbsp;<span class="op" id="7704204">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704208">t</span><span class="op" id="7704209">.</span><span class="ident" id="7704210">Fatal</span><span class="op" id="7704215">(</span><span class="string" id="7704216">&#34;encode:&#34;</span><span class="op" id="7704225">,</span>&nbsp;<span class="ident" id="7704227">err</span><span class="op" id="7704230">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704233">}</span><br>
<span class="lineno">820</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704236">var</span>&nbsp;<span class="ident" id="7704240">newData</span>&nbsp;<span class="keyword" id="7704248">map</span><span class="op" id="7704251">[</span><span class="builtintype" id="7704252">string</span><span class="op" id="7704258">]</span><span class="keyword" id="7704259">interface</span><span class="op" id="7704268">{</span><span class="op" id="7704269">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704272">err</span>&nbsp;<span class="op" id="7704276">=</span>&nbsp;<span class="ident" id="7704278">NewDecoder</span><span class="op" id="7704288">(</span><span class="ident" id="7704289">b</span><span class="op" id="7704290">)</span><span class="op" id="7704291">.</span><span class="ident" id="7704292">Decode</span><span class="op" id="7704298">(</span><span class="op" id="7704299">&amp;</span><span class="ident" id="7704300">newData</span><span class="op" id="7704307">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704310">if</span>&nbsp;<span class="ident" id="7704313">err</span>&nbsp;<span class="op" id="7704317">!=</span>&nbsp;<span class="ident" id="7704320">nil</span>&nbsp;<span class="op" id="7704324">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704328">t</span><span class="op" id="7704329">.</span><span class="ident" id="7704330">Fatal</span><span class="op" id="7704335">(</span><span class="string" id="7704336">&#34;decode:&#34;</span><span class="op" id="7704345">,</span>&nbsp;<span class="ident" id="7704347">err</span><span class="op" id="7704350">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704353">}</span><br>
<span class="lineno">825</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704356">if</span>&nbsp;<span class="op" id="7704359">!</span><span class="ident" id="7704360">reflect</span><span class="op" id="7704367">.</span><span class="ident" id="7704368">DeepEqual</span><span class="op" id="7704377">(</span><span class="ident" id="7704378">data</span><span class="op" id="7704382">,</span>&nbsp;<span class="ident" id="7704384">newData</span><span class="op" id="7704391">)</span>&nbsp;<span class="op" id="7704393">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704397">t</span><span class="op" id="7704398">.</span><span class="ident" id="7704399">Fatalf</span><span class="op" id="7704405">(</span><span class="string" id="7704406">&#34;expected&nbsp;%v&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7704426">,</span>&nbsp;<span class="ident" id="7704428">data</span><span class="op" id="7704432">,</span>&nbsp;<span class="ident" id="7704434">newData</span><span class="op" id="7704441">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704444">}</span><br>
<span class="lineno"></span><span class="op" id="7704446">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">830</span><span class="comment" id="7704449">//&nbsp;A&nbsp;top-level&nbsp;nil&nbsp;pointer&nbsp;generates&nbsp;a&nbsp;panic&nbsp;with&nbsp;a&nbsp;helpful&nbsp;string-valued&nbsp;message.</span><br>
<span class="lineno"></span><span class="keyword" id="7704532">func</span>&nbsp;<span class="ident" id="7704537">TestTopLevelNilPointer</span><span class="op" id="7704559">(</span><span class="ident" id="7704560">t</span>&nbsp;<span class="op" id="7704562">*</span><span class="ident" id="7704563">testing</span><span class="op" id="7704570">.</span><span class="ident" id="7704571">T</span><span class="op" id="7704572">)</span>&nbsp;<span class="op" id="7704574">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704577">errMsg</span>&nbsp;<span class="op" id="7704584">:=</span>&nbsp;<span class="ident" id="7704587">topLevelNilPanic</span><span class="op" id="7704603">(</span><span class="ident" id="7704604">t</span><span class="op" id="7704605">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704608">if</span>&nbsp;<span class="ident" id="7704611">errMsg</span>&nbsp;<span class="op" id="7704618">==</span>&nbsp;<span class="string" id="7704621">&#34;&#34;</span>&nbsp;<span class="op" id="7704624">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704628">t</span><span class="op" id="7704629">.</span><span class="ident" id="7704630">Fatal</span><span class="op" id="7704635">(</span><span class="string" id="7704636">&#34;top-level&nbsp;nil&nbsp;pointer&nbsp;did&nbsp;not&nbsp;panic&#34;</span><span class="op" id="7704673">)</span><br>
<span class="lineno">835</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704676">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704679">if</span>&nbsp;<span class="op" id="7704682">!</span><span class="ident" id="7704683">strings</span><span class="op" id="7704690">.</span><span class="ident" id="7704691">Contains</span><span class="op" id="7704699">(</span><span class="ident" id="7704700">errMsg</span><span class="op" id="7704706">,</span>&nbsp;<span class="string" id="7704708">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7704721">)</span>&nbsp;<span class="op" id="7704723">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704727">t</span><span class="op" id="7704728">.</span><span class="ident" id="7704729">Fatal</span><span class="op" id="7704734">(</span><span class="string" id="7704735">&#34;expected&nbsp;nil&nbsp;pointer&nbsp;error,&nbsp;got:&#34;</span><span class="op" id="7704769">,</span>&nbsp;<span class="ident" id="7704771">errMsg</span><span class="op" id="7704777">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704780">}</span><br>
<span class="lineno"></span><span class="op" id="7704782">}</span><br>
<span class="lineno">840</span><br>
<span class="lineno"></span><span class="keyword" id="7704785">func</span>&nbsp;<span class="ident" id="7704790">topLevelNilPanic</span><span class="op" id="7704806">(</span><span class="ident" id="7704807">t</span>&nbsp;<span class="op" id="7704809">*</span><span class="ident" id="7704810">testing</span><span class="op" id="7704817">.</span><span class="ident" id="7704818">T</span><span class="op" id="7704819">)</span>&nbsp;<span class="op" id="7704821">(</span><span class="ident" id="7704822">panicErr</span>&nbsp;<span class="builtintype" id="7704831">string</span><span class="op" id="7704837">)</span>&nbsp;<span class="op" id="7704839">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704842">defer</span>&nbsp;<span class="keyword" id="7704848">func</span><span class="op" id="7704852">(</span><span class="op" id="7704853">)</span>&nbsp;<span class="op" id="7704855">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704859">e</span>&nbsp;<span class="op" id="7704861">:=</span>&nbsp;<span class="builtinfunc" id="7704864">recover</span><span class="op" id="7704871">(</span><span class="op" id="7704872">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704876">if</span>&nbsp;<span class="ident" id="7704879">err</span><span class="op" id="7704882">,</span>&nbsp;<span class="ident" id="7704884">ok</span>&nbsp;<span class="op" id="7704887">:=</span>&nbsp;<span class="ident" id="7704890">e</span><span class="op" id="7704891">.</span><span class="op" id="7704892">(</span><span class="builtintype" id="7704893">string</span><span class="op" id="7704899">)</span><span class="op" id="7704900">;</span>&nbsp;<span class="ident" id="7704902">ok</span>&nbsp;<span class="op" id="7704905">{</span><br>
<span class="lineno">845</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704910">panicErr</span>&nbsp;<span class="op" id="7704919">=</span>&nbsp;<span class="ident" id="7704921">err</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704927">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7704930">}</span><span class="op" id="7704931">(</span><span class="op" id="7704932">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704935">var</span>&nbsp;<span class="ident" id="7704939">ip</span>&nbsp;<span class="op" id="7704942">*</span><span class="builtintype" id="7704943">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7704948">buf</span>&nbsp;<span class="op" id="7704952">:=</span>&nbsp;<span class="builtinfunc" id="7704955">new</span><span class="op" id="7704958">(</span><span class="ident" id="7704959">bytes</span><span class="op" id="7704964">.</span><span class="ident" id="7704965">Buffer</span><span class="op" id="7704971">)</span><br>
<span class="lineno">850</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7704974">if</span>&nbsp;<span class="ident" id="7704977">err</span>&nbsp;<span class="op" id="7704981">:=</span>&nbsp;<span class="ident" id="7704984">NewEncoder</span><span class="op" id="7704994">(</span><span class="ident" id="7704995">buf</span><span class="op" id="7704998">)</span><span class="op" id="7704999">.</span><span class="ident" id="7705000">Encode</span><span class="op" id="7705006">(</span><span class="ident" id="7705007">ip</span><span class="op" id="7705009">)</span><span class="op" id="7705010">;</span>&nbsp;<span class="ident" id="7705012">err</span>&nbsp;<span class="op" id="7705016">!=</span>&nbsp;<span class="ident" id="7705019">nil</span>&nbsp;<span class="op" id="7705023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705027">t</span><span class="op" id="7705028">.</span><span class="ident" id="7705029">Fatal</span><span class="op" id="7705034">(</span><span class="string" id="7705035">&#34;error&nbsp;in&nbsp;encode:&#34;</span><span class="op" id="7705053">,</span>&nbsp;<span class="ident" id="7705055">err</span><span class="op" id="7705058">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705061">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705064">return</span><br>
<span class="lineno"></span><span class="op" id="7705071">}</span><br>
<span class="lineno">855</span><br>
<span class="lineno"></span><span class="keyword" id="7705074">func</span>&nbsp;<span class="ident" id="7705079">TestNilPointerInsideInterface</span><span class="op" id="7705108">(</span><span class="ident" id="7705109">t</span>&nbsp;<span class="op" id="7705111">*</span><span class="ident" id="7705112">testing</span><span class="op" id="7705119">.</span><span class="ident" id="7705120">T</span><span class="op" id="7705121">)</span>&nbsp;<span class="op" id="7705123">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705126">var</span>&nbsp;<span class="ident" id="7705130">ip</span>&nbsp;<span class="op" id="7705133">*</span><span class="builtintype" id="7705134">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705139">si</span>&nbsp;<span class="op" id="7705142">:=</span>&nbsp;<span class="keyword" id="7705145">struct</span>&nbsp;<span class="op" id="7705152">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705156">I</span>&nbsp;<span class="keyword" id="7705158">interface</span><span class="op" id="7705167">{</span><span class="op" id="7705168">}</span><br>
<span class="lineno">860</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705171">}</span><span class="op" id="7705172">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705176">I</span><span class="op" id="7705177">:</span>&nbsp;<span class="ident" id="7705179">ip</span><span class="op" id="7705181">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705184">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705187">buf</span>&nbsp;<span class="op" id="7705191">:=</span>&nbsp;<span class="builtinfunc" id="7705194">new</span><span class="op" id="7705197">(</span><span class="ident" id="7705198">bytes</span><span class="op" id="7705203">.</span><span class="ident" id="7705204">Buffer</span><span class="op" id="7705210">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705213">err</span>&nbsp;<span class="op" id="7705217">:=</span>&nbsp;<span class="ident" id="7705220">NewEncoder</span><span class="op" id="7705230">(</span><span class="ident" id="7705231">buf</span><span class="op" id="7705234">)</span><span class="op" id="7705235">.</span><span class="ident" id="7705236">Encode</span><span class="op" id="7705242">(</span><span class="ident" id="7705243">si</span><span class="op" id="7705245">)</span><br>
<span class="lineno">865</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705248">if</span>&nbsp;<span class="ident" id="7705251">err</span>&nbsp;<span class="op" id="7705255">==</span>&nbsp;<span class="ident" id="7705258">nil</span>&nbsp;<span class="op" id="7705262">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705266">t</span><span class="op" id="7705267">.</span><span class="ident" id="7705268">Fatal</span><span class="op" id="7705273">(</span><span class="string" id="7705274">&#34;expected&nbsp;error,&nbsp;got&nbsp;none&#34;</span><span class="op" id="7705300">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705303">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705306">errMsg</span>&nbsp;<span class="op" id="7705313">:=</span>&nbsp;<span class="ident" id="7705316">err</span><span class="op" id="7705319">.</span><span class="ident" id="7705320">Error</span><span class="op" id="7705325">(</span><span class="op" id="7705326">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705329">if</span>&nbsp;<span class="op" id="7705332">!</span><span class="ident" id="7705333">strings</span><span class="op" id="7705340">.</span><span class="ident" id="7705341">Contains</span><span class="op" id="7705349">(</span><span class="ident" id="7705350">errMsg</span><span class="op" id="7705356">,</span>&nbsp;<span class="string" id="7705358">&#34;nil&nbsp;pointer&#34;</span><span class="op" id="7705371">)</span>&nbsp;<span class="op" id="7705373">||</span>&nbsp;<span class="op" id="7705376">!</span><span class="ident" id="7705377">strings</span><span class="op" id="7705384">.</span><span class="ident" id="7705385">Contains</span><span class="op" id="7705393">(</span><span class="ident" id="7705394">errMsg</span><span class="op" id="7705400">,</span>&nbsp;<span class="string" id="7705402">&#34;interface&#34;</span><span class="op" id="7705413">)</span>&nbsp;<span class="op" id="7705415">{</span><br>
<span class="lineno">870</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705419">t</span><span class="op" id="7705420">.</span><span class="ident" id="7705421">Fatal</span><span class="op" id="7705426">(</span><span class="string" id="7705427">&#34;expected&nbsp;error&nbsp;about&nbsp;nil&nbsp;pointer&nbsp;and&nbsp;interface,&nbsp;got:&#34;</span><span class="op" id="7705481">,</span>&nbsp;<span class="ident" id="7705483">errMsg</span><span class="op" id="7705489">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705492">}</span><br>
<span class="lineno"></span><span class="op" id="7705494">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7705497">type</span>&nbsp;<span class="ident" id="7705502">Bug4Public</span>&nbsp;<span class="keyword" id="7705513">struct</span>&nbsp;<span class="op" id="7705520">{</span><br>
<span class="lineno">875</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705523">Name</span>&nbsp;&nbsp;&nbsp;<span class="builtintype" id="7705530">string</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705538">Secret</span>&nbsp;<span class="ident" id="7705545">Bug4Secret</span><br>
<span class="lineno"></span><span class="op" id="7705556">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7705559">type</span>&nbsp;<span class="ident" id="7705564">Bug4Secret</span>&nbsp;<span class="keyword" id="7705575">struct</span>&nbsp;<span class="op" id="7705582">{</span><br>
<span class="lineno">880</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705585">a</span>&nbsp;<span class="builtintype" id="7705587">int</span>&nbsp;<span class="comment" id="7705591">//&nbsp;error:&nbsp;no&nbsp;exported&nbsp;fields.</span><br>
<span class="lineno"></span><span class="op" id="7705621">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7705624">//&nbsp;Test&nbsp;that&nbsp;a&nbsp;failed&nbsp;compilation&nbsp;doesn&#39;t&nbsp;leave&nbsp;around&nbsp;an&nbsp;executable&nbsp;encoder.</span><br>
<span class="lineno"></span><span class="comment" id="7705702">//&nbsp;Issue&nbsp;3273.</span><br>
<span class="lineno">885</span><span class="keyword" id="7705717">func</span>&nbsp;<span class="ident" id="7705722">TestMutipleEncodingsOfBadType</span><span class="op" id="7705751">(</span><span class="ident" id="7705752">t</span>&nbsp;<span class="op" id="7705754">*</span><span class="ident" id="7705755">testing</span><span class="op" id="7705762">.</span><span class="ident" id="7705763">T</span><span class="op" id="7705764">)</span>&nbsp;<span class="op" id="7705766">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705769">x</span>&nbsp;<span class="op" id="7705771">:=</span>&nbsp;<span class="ident" id="7705774">Bug4Public</span><span class="op" id="7705784">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705788">Name</span><span class="op" id="7705792">:</span>&nbsp;&nbsp;&nbsp;<span class="string" id="7705796">&#34;name&#34;</span><span class="op" id="7705802">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705806">Secret</span><span class="op" id="7705812">:</span>&nbsp;<span class="ident" id="7705814">Bug4Secret</span><span class="op" id="7705824">{</span><span class="num" id="7705825">1</span><span class="op" id="7705826">}</span><span class="op" id="7705827">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705830">}</span><br>
<span class="lineno">890</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705833">buf</span>&nbsp;<span class="op" id="7705837">:=</span>&nbsp;<span class="builtinfunc" id="7705840">new</span><span class="op" id="7705843">(</span><span class="ident" id="7705844">bytes</span><span class="op" id="7705849">.</span><span class="ident" id="7705850">Buffer</span><span class="op" id="7705856">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705859">enc</span>&nbsp;<span class="op" id="7705863">:=</span>&nbsp;<span class="ident" id="7705866">NewEncoder</span><span class="op" id="7705876">(</span><span class="ident" id="7705877">buf</span><span class="op" id="7705880">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705883">err</span>&nbsp;<span class="op" id="7705887">:=</span>&nbsp;<span class="ident" id="7705890">enc</span><span class="op" id="7705893">.</span><span class="ident" id="7705894">Encode</span><span class="op" id="7705900">(</span><span class="ident" id="7705901">x</span><span class="op" id="7705902">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7705905">if</span>&nbsp;<span class="ident" id="7705908">err</span>&nbsp;<span class="op" id="7705912">==</span>&nbsp;<span class="ident" id="7705915">nil</span>&nbsp;<span class="op" id="7705919">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705923">t</span><span class="op" id="7705924">.</span><span class="ident" id="7705925">Fatal</span><span class="op" id="7705930">(</span><span class="string" id="7705931">&#34;first&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7705963">)</span><br>
<span class="lineno">895</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7705966">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705969">buf</span><span class="op" id="7705972">.</span><span class="ident" id="7705973">Reset</span><span class="op" id="7705978">(</span><span class="op" id="7705979">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7705982">enc</span>&nbsp;<span class="op" id="7705986">=</span>&nbsp;<span class="ident" id="7705988">NewEncoder</span><span class="op" id="7705998">(</span><span class="ident" id="7705999">buf</span><span class="op" id="7706002">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706005">err</span>&nbsp;<span class="op" id="7706009">=</span>&nbsp;<span class="ident" id="7706011">enc</span><span class="op" id="7706014">.</span><span class="ident" id="7706015">Encode</span><span class="op" id="7706021">(</span><span class="ident" id="7706022">x</span><span class="op" id="7706023">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706026">if</span>&nbsp;<span class="ident" id="7706029">err</span>&nbsp;<span class="op" id="7706033">==</span>&nbsp;<span class="ident" id="7706036">nil</span>&nbsp;<span class="op" id="7706040">{</span><br>
<span class="lineno">900</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706044">t</span><span class="op" id="7706045">.</span><span class="ident" id="7706046">Fatal</span><span class="op" id="7706051">(</span><span class="string" id="7706052">&#34;second&nbsp;encoding:&nbsp;expected&nbsp;error&#34;</span><span class="op" id="7706085">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706088">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706091">if</span>&nbsp;<span class="op" id="7706094">!</span><span class="ident" id="7706095">strings</span><span class="op" id="7706102">.</span><span class="ident" id="7706103">Contains</span><span class="op" id="7706111">(</span><span class="ident" id="7706112">err</span><span class="op" id="7706115">.</span><span class="ident" id="7706116">Error</span><span class="op" id="7706121">(</span><span class="op" id="7706122">)</span><span class="op" id="7706123">,</span>&nbsp;<span class="string" id="7706125">&#34;no&nbsp;exported&nbsp;fields&#34;</span><span class="op" id="7706145">)</span>&nbsp;<span class="op" id="7706147">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706151">t</span><span class="op" id="7706152">.</span><span class="ident" id="7706153">Errorf</span><span class="op" id="7706159">(</span><span class="string" id="7706160">&#34;expected&nbsp;error&nbsp;about&nbsp;no&nbsp;exported&nbsp;fields;&nbsp;got&nbsp;%v&#34;</span><span class="op" id="7706209">,</span>&nbsp;<span class="ident" id="7706211">err</span><span class="op" id="7706214">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706217">}</span><br>
<span class="lineno">905</span><span class="op" id="7706219">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7706222">//&nbsp;There&nbsp;was&nbsp;an&nbsp;error&nbsp;check&nbsp;comparing&nbsp;the&nbsp;length&nbsp;of&nbsp;the&nbsp;input&nbsp;with&nbsp;the</span><br>
<span class="lineno"></span><span class="comment" id="7706293">//&nbsp;length&nbsp;of&nbsp;the&nbsp;slice&nbsp;being&nbsp;decoded.&nbsp;It&nbsp;was&nbsp;wrong&nbsp;because&nbsp;the&nbsp;next</span><br>
<span class="lineno"></span><span class="comment" id="7706361">//&nbsp;thing&nbsp;in&nbsp;the&nbsp;input&nbsp;might&nbsp;be&nbsp;a&nbsp;type&nbsp;definition,&nbsp;which&nbsp;would&nbsp;lead&nbsp;to</span><br>
<span class="lineno">910</span><span class="comment" id="7706431">//&nbsp;an&nbsp;incorrect&nbsp;length&nbsp;check.&nbsp;&nbsp;This&nbsp;test&nbsp;reproduces&nbsp;the&nbsp;corner&nbsp;case.</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7706501">type</span>&nbsp;<span class="ident" id="7706506">Z</span>&nbsp;<span class="keyword" id="7706508">struct</span>&nbsp;<span class="op" id="7706515">{</span><br>
<span class="lineno"></span><span class="op" id="7706517">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">915</span><span class="keyword" id="7706520">func</span>&nbsp;<span class="ident" id="7706525">Test29ElementSlice</span><span class="op" id="7706543">(</span><span class="ident" id="7706544">t</span>&nbsp;<span class="op" id="7706546">*</span><span class="ident" id="7706547">testing</span><span class="op" id="7706554">.</span><span class="ident" id="7706555">T</span><span class="op" id="7706556">)</span>&nbsp;<span class="op" id="7706558">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706561">Register</span><span class="op" id="7706569">(</span><span class="ident" id="7706570">Z</span><span class="op" id="7706571">{</span><span class="op" id="7706572">}</span><span class="op" id="7706573">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706576">src</span>&nbsp;<span class="op" id="7706580">:=</span>&nbsp;<span class="builtinfunc" id="7706583">make</span><span class="op" id="7706587">(</span><span class="op" id="7706588">[</span><span class="op" id="7706589">]</span><span class="keyword" id="7706590">interface</span><span class="op" id="7706599">{</span><span class="op" id="7706600">}</span><span class="op" id="7706601">,</span>&nbsp;<span class="num" id="7706603">100</span><span class="op" id="7706606">)</span>&nbsp;<span class="comment" id="7706608">//&nbsp;Size&nbsp;needs&nbsp;to&nbsp;be&nbsp;bigger&nbsp;than&nbsp;size&nbsp;of&nbsp;type&nbsp;definition.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706666">for</span>&nbsp;<span class="ident" id="7706670">i</span>&nbsp;<span class="op" id="7706672">:=</span>&nbsp;<span class="keyword" id="7706675">range</span>&nbsp;<span class="ident" id="7706681">src</span>&nbsp;<span class="op" id="7706685">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706689">src</span><span class="op" id="7706692">[</span><span class="ident" id="7706693">i</span><span class="op" id="7706694">]</span>&nbsp;<span class="op" id="7706696">=</span>&nbsp;<span class="ident" id="7706698">Z</span><span class="op" id="7706699">{</span><span class="op" id="7706700">}</span><br>
<span class="lineno">920</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706703">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706706">buf</span>&nbsp;<span class="op" id="7706710">:=</span>&nbsp;<span class="builtinfunc" id="7706713">new</span><span class="op" id="7706716">(</span><span class="ident" id="7706717">bytes</span><span class="op" id="7706722">.</span><span class="ident" id="7706723">Buffer</span><span class="op" id="7706729">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706732">err</span>&nbsp;<span class="op" id="7706736">:=</span>&nbsp;<span class="ident" id="7706739">NewEncoder</span><span class="op" id="7706749">(</span><span class="ident" id="7706750">buf</span><span class="op" id="7706753">)</span><span class="op" id="7706754">.</span><span class="ident" id="7706755">Encode</span><span class="op" id="7706761">(</span><span class="ident" id="7706762">src</span><span class="op" id="7706765">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706768">if</span>&nbsp;<span class="ident" id="7706771">err</span>&nbsp;<span class="op" id="7706775">!=</span>&nbsp;<span class="ident" id="7706778">nil</span>&nbsp;<span class="op" id="7706782">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706786">t</span><span class="op" id="7706787">.</span><span class="ident" id="7706788">Fatalf</span><span class="op" id="7706794">(</span><span class="string" id="7706795">&#34;encode:&nbsp;%v&#34;</span><span class="op" id="7706807">,</span>&nbsp;<span class="ident" id="7706809">err</span><span class="op" id="7706812">)</span><br>
<span class="lineno">925</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706816">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706824">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706828">var</span>&nbsp;<span class="ident" id="7706832">dst</span>&nbsp;<span class="op" id="7706836">[</span><span class="op" id="7706837">]</span><span class="keyword" id="7706838">interface</span><span class="op" id="7706847">{</span><span class="op" id="7706848">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706851">err</span>&nbsp;<span class="op" id="7706855">=</span>&nbsp;<span class="ident" id="7706857">NewDecoder</span><span class="op" id="7706867">(</span><span class="ident" id="7706868">buf</span><span class="op" id="7706871">)</span><span class="op" id="7706872">.</span><span class="ident" id="7706873">Decode</span><span class="op" id="7706879">(</span><span class="op" id="7706880">&amp;</span><span class="ident" id="7706881">dst</span><span class="op" id="7706884">)</span><br>
<span class="lineno">930</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706887">if</span>&nbsp;<span class="ident" id="7706890">err</span>&nbsp;<span class="op" id="7706894">!=</span>&nbsp;<span class="ident" id="7706897">nil</span>&nbsp;<span class="op" id="7706901">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7706905">t</span><span class="op" id="7706906">.</span><span class="ident" id="7706907">Errorf</span><span class="op" id="7706913">(</span><span class="string" id="7706914">&#34;decode:&nbsp;%v&#34;</span><span class="op" id="7706926">,</span>&nbsp;<span class="ident" id="7706928">err</span><span class="op" id="7706931">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7706935">return</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7706943">}</span><br>
<span class="lineno"></span><span class="op" id="7706945">}</span><br>
<span class="lineno">935</span><br>
<span class="lineno"></span><span class="comment" id="7706948">//&nbsp;Don&#39;t&nbsp;crash,&nbsp;just&nbsp;give&nbsp;error&nbsp;when&nbsp;allocating&nbsp;a&nbsp;huge&nbsp;slice.</span><br>
<span class="lineno"></span><span class="comment" id="7707010">//&nbsp;Issue&nbsp;8084.</span><br>
<span class="lineno"></span><span class="keyword" id="7707025">func</span>&nbsp;<span class="ident" id="7707030">TestErrorForHugeSlice</span><span class="op" id="7707051">(</span><span class="ident" id="7707052">t</span>&nbsp;<span class="op" id="7707054">*</span><span class="ident" id="7707055">testing</span><span class="op" id="7707062">.</span><span class="ident" id="7707063">T</span><span class="op" id="7707064">)</span>&nbsp;<span class="op" id="7707066">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7707069">//&nbsp;Encode&nbsp;an&nbsp;int&nbsp;slice.</span><br>
<span class="lineno">940</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707094">buf</span>&nbsp;<span class="op" id="7707098">:=</span>&nbsp;<span class="builtinfunc" id="7707101">new</span><span class="op" id="7707104">(</span><span class="ident" id="7707105">bytes</span><span class="op" id="7707110">.</span><span class="ident" id="7707111">Buffer</span><span class="op" id="7707117">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707120">slice</span>&nbsp;<span class="op" id="7707126">:=</span>&nbsp;<span class="op" id="7707129">[</span><span class="op" id="7707130">]</span><span class="builtintype" id="7707131">int</span><span class="op" id="7707134">{</span><span class="num" id="7707135">1</span><span class="op" id="7707136">,</span>&nbsp;<span class="num" id="7707138">1</span><span class="op" id="7707139">,</span>&nbsp;<span class="num" id="7707141">1</span><span class="op" id="7707142">,</span>&nbsp;<span class="num" id="7707144">1</span><span class="op" id="7707145">,</span>&nbsp;<span class="num" id="7707147">1</span><span class="op" id="7707148">,</span>&nbsp;<span class="num" id="7707150">1</span><span class="op" id="7707151">,</span>&nbsp;<span class="num" id="7707153">1</span><span class="op" id="7707154">,</span>&nbsp;<span class="num" id="7707156">1</span><span class="op" id="7707157">,</span>&nbsp;<span class="num" id="7707159">1</span><span class="op" id="7707160">,</span>&nbsp;<span class="num" id="7707162">1</span><span class="op" id="7707163">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707166">err</span>&nbsp;<span class="op" id="7707170">:=</span>&nbsp;<span class="ident" id="7707173">NewEncoder</span><span class="op" id="7707183">(</span><span class="ident" id="7707184">buf</span><span class="op" id="7707187">)</span><span class="op" id="7707188">.</span><span class="ident" id="7707189">Encode</span><span class="op" id="7707195">(</span><span class="ident" id="7707196">slice</span><span class="op" id="7707201">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707204">if</span>&nbsp;<span class="ident" id="7707207">err</span>&nbsp;<span class="op" id="7707211">!=</span>&nbsp;<span class="ident" id="7707214">nil</span>&nbsp;<span class="op" id="7707218">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707222">t</span><span class="op" id="7707223">.</span><span class="ident" id="7707224">Fatal</span><span class="op" id="7707229">(</span><span class="string" id="7707230">&#34;encode:&#34;</span><span class="op" id="7707239">,</span>&nbsp;<span class="ident" id="7707241">err</span><span class="op" id="7707244">)</span><br>
<span class="lineno">945</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707247">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7707250">//&nbsp;Reach&nbsp;into&nbsp;the&nbsp;buffer&nbsp;and&nbsp;smash&nbsp;the&nbsp;count&nbsp;to&nbsp;make&nbsp;the&nbsp;encoded&nbsp;slice&nbsp;very&nbsp;long.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707333">buf</span><span class="op" id="7707336">.</span><span class="ident" id="7707337">Bytes</span><span class="op" id="7707342">(</span><span class="op" id="7707343">)</span><span class="op" id="7707344">[</span><span class="ident" id="7707345">buf</span><span class="op" id="7707348">.</span><span class="ident" id="7707349">Len</span><span class="op" id="7707352">(</span><span class="op" id="7707353">)</span><span class="op" id="7707354">-</span><span class="builtinfunc" id="7707355">len</span><span class="op" id="7707358">(</span><span class="ident" id="7707359">slice</span><span class="op" id="7707364">)</span><span class="op" id="7707365">-</span><span class="num" id="7707366">1</span><span class="op" id="7707367">]</span>&nbsp;<span class="op" id="7707369">=</span>&nbsp;<span class="num" id="7707371">0xfa</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7707377">//&nbsp;Decode&nbsp;and&nbsp;see&nbsp;error.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707403">err</span>&nbsp;<span class="op" id="7707407">=</span>&nbsp;<span class="ident" id="7707409">NewDecoder</span><span class="op" id="7707419">(</span><span class="ident" id="7707420">buf</span><span class="op" id="7707423">)</span><span class="op" id="7707424">.</span><span class="ident" id="7707425">Decode</span><span class="op" id="7707431">(</span><span class="op" id="7707432">&amp;</span><span class="ident" id="7707433">slice</span><span class="op" id="7707438">)</span><br>
<span class="lineno">950</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707441">if</span>&nbsp;<span class="ident" id="7707444">err</span>&nbsp;<span class="op" id="7707448">==</span>&nbsp;<span class="ident" id="7707451">nil</span>&nbsp;<span class="op" id="7707455">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707459">t</span><span class="op" id="7707460">.</span><span class="ident" id="7707461">Fatal</span><span class="op" id="7707466">(</span><span class="string" id="7707467">&#34;decode:&nbsp;no&nbsp;error&#34;</span><span class="op" id="7707485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707488">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7707491">if</span>&nbsp;<span class="op" id="7707494">!</span><span class="ident" id="7707495">strings</span><span class="op" id="7707502">.</span><span class="ident" id="7707503">Contains</span><span class="op" id="7707511">(</span><span class="ident" id="7707512">err</span><span class="op" id="7707515">.</span><span class="ident" id="7707516">Error</span><span class="op" id="7707521">(</span><span class="op" id="7707522">)</span><span class="op" id="7707523">,</span>&nbsp;<span class="string" id="7707525">&#34;slice&nbsp;too&nbsp;big&#34;</span><span class="op" id="7707540">)</span>&nbsp;<span class="op" id="7707542">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7707546">t</span><span class="op" id="7707547">.</span><span class="ident" id="7707548">Fatal</span><span class="op" id="7707553">(</span><span class="string" id="7707554">&#34;decode:&nbsp;expected&nbsp;slice&nbsp;too&nbsp;big&nbsp;error,&nbsp;got&nbsp;%s&#34;</span><span class="op" id="7707600">,</span>&nbsp;<span class="ident" id="7707602">err</span><span class="op" id="7707605">.</span><span class="ident" id="7707606">Error</span><span class="op" id="7707611">(</span><span class="op" id="7707612">)</span><span class="op" id="7707613">)</span><br>
<span class="lineno">955</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7707616">}</span><br>
<span class="lineno"></span><span class="op" id="7707618">}</span>
</div>
</body>
</html>
