<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/style.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>html/template</h2>
<ul>
<li><a href="/gostd/html/template/attr.go.html">attr.go</a></li>
<li><a href="/gostd/html/template/clone_test.go.html">clone_test.go</a></li>
<li><a href="/gostd/html/template/content.go.html">content.go</a></li>
<li><a href="/gostd/html/template/content_test.go.html">content_test.go</a></li>
<li><a href="/gostd/html/template/context.go.html">context.go</a></li>
<li><a href="/gostd/html/template/css.go.html">css.go</a></li>
<li><a href="/gostd/html/template/css_test.go.html">css_test.go</a></li>
<li><a href="/gostd/html/template/doc.go.html">doc.go</a></li>
<li><a href="/gostd/html/template/error.go.html">error.go</a></li>
<li><a href="/gostd/html/template/escape.go.html">escape.go</a></li>
<li><a href="/gostd/html/template/escape_test.go.html">escape_test.go</a></li>
<li><a href="/gostd/html/template/html.go.html">html.go</a></li>
<li><a href="/gostd/html/template/html_test.go.html">html_test.go</a></li>
<li><a href="/gostd/html/template/js.go.html">js.go</a></li>
<li><a href="/gostd/html/template/js_test.go.html">js_test.go</a></li>
<li><a href="/gostd/html/template/template.go.html">template.go</a></li>
<li><a href="/gostd/html/template/transition.go.html">transition.go</a></li>
<li><a href="/gostd/html/template/url.go.html">url.go</a></li>
<li><a href="/gostd/html/template/url_test.go.html">url_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="7092496">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="7092551">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="7092605">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="7092656">package</span>&nbsp;<span class="ident" id="7092664">template</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7092674">import</span>&nbsp;<span class="op" id="7092681">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7092684">&#34;bytes&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7092693">&#34;errors&#34;</span><br>
<span class="lineno">10</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7092703">&#34;io/ioutil&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7092716">&#34;testing&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="7092727">&#34;text/template/parse&#34;</span><br>
<span class="lineno"></span><span class="op" id="7092749">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">15</span><span class="keyword" id="7092752">func</span>&nbsp;<span class="ident" id="7092757">TestAddParseTree</span><span class="op" id="7092773">(</span><span class="ident" id="7092774">t</span>&nbsp;<span class="op" id="7092776">*</span><span class="ident" id="7092777">testing</span><span class="op" id="7092784">.</span><span class="ident" id="7092785">T</span><span class="op" id="7092786">)</span>&nbsp;<span class="op" id="7092788">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092791">root</span>&nbsp;<span class="op" id="7092796">:=</span>&nbsp;<span class="ident" id="7092799">Must</span><span class="op" id="7092803">(</span><span class="ident" id="7092804">New</span><span class="op" id="7092807">(</span><span class="string" id="7092808">&#34;root&#34;</span><span class="op" id="7092814">)</span><span class="op" id="7092815">.</span><span class="ident" id="7092816">Parse</span><span class="op" id="7092821">(</span><span class="string" id="7092822">`{{define&nbsp;&#34;a&#34;}}&nbsp;{{.}}&nbsp;{{template&nbsp;&#34;b&#34;}}&nbsp;{{.}}&nbsp;&#34;&gt;&lt;/a&gt;{{end}}`</span><span class="op" id="7092881">)</span><span class="op" id="7092882">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092885">tree</span><span class="op" id="7092889">,</span>&nbsp;<span class="ident" id="7092891">err</span>&nbsp;<span class="op" id="7092895">:=</span>&nbsp;<span class="ident" id="7092898">parse</span><span class="op" id="7092903">.</span><span class="ident" id="7092904">Parse</span><span class="op" id="7092909">(</span><span class="string" id="7092910">&#34;t&#34;</span><span class="op" id="7092913">,</span>&nbsp;<span class="string" id="7092915">`{{define&nbsp;&#34;b&#34;}}&lt;a&nbsp;href=&#34;{{end}}`</span><span class="op" id="7092947">,</span>&nbsp;<span class="string" id="7092949">&#34;&#34;</span><span class="op" id="7092951">,</span>&nbsp;<span class="string" id="7092953">&#34;&#34;</span><span class="op" id="7092955">,</span>&nbsp;<span class="ident" id="7092957">nil</span><span class="op" id="7092960">,</span>&nbsp;<span class="ident" id="7092962">nil</span><span class="op" id="7092965">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7092968">if</span>&nbsp;<span class="ident" id="7092971">err</span>&nbsp;<span class="op" id="7092975">!=</span>&nbsp;<span class="ident" id="7092978">nil</span>&nbsp;<span class="op" id="7092982">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7092986">t</span><span class="op" id="7092987">.</span><span class="ident" id="7092988">Fatal</span><span class="op" id="7092993">(</span><span class="ident" id="7092994">err</span><span class="op" id="7092997">)</span><br>
<span class="lineno">20</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093000">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093003">added</span>&nbsp;<span class="op" id="7093009">:=</span>&nbsp;<span class="ident" id="7093012">Must</span><span class="op" id="7093016">(</span><span class="ident" id="7093017">root</span><span class="op" id="7093021">.</span><span class="ident" id="7093022">AddParseTree</span><span class="op" id="7093034">(</span><span class="string" id="7093035">&#34;b&#34;</span><span class="op" id="7093038">,</span>&nbsp;<span class="ident" id="7093040">tree</span><span class="op" id="7093044">[</span><span class="string" id="7093045">&#34;b&#34;</span><span class="op" id="7093048">]</span><span class="op" id="7093049">)</span><span class="op" id="7093050">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093053">b</span>&nbsp;<span class="op" id="7093055">:=</span>&nbsp;<span class="builtinfunc" id="7093058">new</span><span class="op" id="7093061">(</span><span class="ident" id="7093062">bytes</span><span class="op" id="7093067">.</span><span class="ident" id="7093068">Buffer</span><span class="op" id="7093074">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093077">err</span>&nbsp;<span class="op" id="7093081">=</span>&nbsp;<span class="ident" id="7093083">added</span><span class="op" id="7093088">.</span><span class="ident" id="7093089">ExecuteTemplate</span><span class="op" id="7093104">(</span><span class="ident" id="7093105">b</span><span class="op" id="7093106">,</span>&nbsp;<span class="string" id="7093108">&#34;a&#34;</span><span class="op" id="7093111">,</span>&nbsp;<span class="string" id="7093113">&#34;1&gt;0&#34;</span><span class="op" id="7093118">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093121">if</span>&nbsp;<span class="ident" id="7093124">err</span>&nbsp;<span class="op" id="7093128">!=</span>&nbsp;<span class="ident" id="7093131">nil</span>&nbsp;<span class="op" id="7093135">{</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093139">t</span><span class="op" id="7093140">.</span><span class="ident" id="7093141">Fatal</span><span class="op" id="7093146">(</span><span class="ident" id="7093147">err</span><span class="op" id="7093150">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093153">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093156">if</span>&nbsp;<span class="ident" id="7093159">got</span><span class="op" id="7093162">,</span>&nbsp;<span class="ident" id="7093164">want</span>&nbsp;<span class="op" id="7093169">:=</span>&nbsp;<span class="ident" id="7093172">b</span><span class="op" id="7093173">.</span><span class="ident" id="7093174">String</span><span class="op" id="7093180">(</span><span class="op" id="7093181">)</span><span class="op" id="7093182">,</span>&nbsp;<span class="string" id="7093184">`&nbsp;1&amp;gt;0&nbsp;&lt;a&nbsp;href=&#34;&nbsp;1%3e0&nbsp;&#34;&gt;&lt;/a&gt;`</span><span class="op" id="7093216">;</span>&nbsp;<span class="ident" id="7093218">got</span>&nbsp;<span class="op" id="7093222">!=</span>&nbsp;<span class="ident" id="7093225">want</span>&nbsp;<span class="op" id="7093230">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093234">t</span><span class="op" id="7093235">.</span><span class="ident" id="7093236">Errorf</span><span class="op" id="7093242">(</span><span class="string" id="7093243">&#34;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7093259">,</span>&nbsp;<span class="ident" id="7093261">got</span><span class="op" id="7093264">,</span>&nbsp;<span class="ident" id="7093266">want</span><span class="op" id="7093270">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7093273">}</span><br>
<span class="lineno">30</span><span class="op" id="7093275">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7093278">func</span>&nbsp;<span class="ident" id="7093283">TestClone</span><span class="op" id="7093292">(</span><span class="ident" id="7093293">t</span>&nbsp;<span class="op" id="7093295">*</span><span class="ident" id="7093296">testing</span><span class="op" id="7093303">.</span><span class="ident" id="7093304">T</span><span class="op" id="7093305">)</span>&nbsp;<span class="op" id="7093307">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093310">//&nbsp;The&nbsp;{{.}}&nbsp;will&nbsp;be&nbsp;executed&nbsp;with&nbsp;data&nbsp;&#34;&lt;i&gt;*/&#34;&nbsp;in&nbsp;different&nbsp;contexts.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093382">//&nbsp;In&nbsp;the&nbsp;t0&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;text&nbsp;context.</span><br>
<span class="lineno">35</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093436">//&nbsp;In&nbsp;the&nbsp;t1&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;URL&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093489">//&nbsp;In&nbsp;the&nbsp;t2&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;JavaScript&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093549">//&nbsp;In&nbsp;the&nbsp;t3&nbsp;template,&nbsp;it&nbsp;will&nbsp;be&nbsp;in&nbsp;a&nbsp;CSS&nbsp;context.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093602">const</span>&nbsp;<span class="ident" id="7093608">tmpl</span>&nbsp;<span class="op" id="7093613">=</span>&nbsp;<span class="string" id="7093615">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093681">b</span>&nbsp;<span class="op" id="7093683">:=</span>&nbsp;<span class="builtinfunc" id="7093686">new</span><span class="op" id="7093689">(</span><span class="ident" id="7093690">bytes</span><span class="op" id="7093695">.</span><span class="ident" id="7093696">Buffer</span><span class="op" id="7093702">)</span><br>
<span class="lineno">40</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093706">//&nbsp;Create&nbsp;an&nbsp;incomplete&nbsp;template&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093744">t0</span>&nbsp;<span class="op" id="7093747">:=</span>&nbsp;<span class="ident" id="7093750">Must</span><span class="op" id="7093754">(</span><span class="ident" id="7093755">New</span><span class="op" id="7093758">(</span><span class="string" id="7093759">&#34;t0&#34;</span><span class="op" id="7093763">)</span><span class="op" id="7093764">.</span><span class="ident" id="7093765">Parse</span><span class="op" id="7093770">(</span><span class="ident" id="7093771">tmpl</span><span class="op" id="7093775">)</span><span class="op" id="7093776">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093780">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t1.</span><br>
<span class="lineno">45</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093800">t1</span>&nbsp;<span class="op" id="7093803">:=</span>&nbsp;<span class="ident" id="7093806">Must</span><span class="op" id="7093810">(</span><span class="ident" id="7093811">t0</span><span class="op" id="7093813">.</span><span class="ident" id="7093814">Clone</span><span class="op" id="7093819">(</span><span class="op" id="7093820">)</span><span class="op" id="7093821">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093824">Must</span><span class="op" id="7093828">(</span><span class="ident" id="7093829">t1</span><span class="op" id="7093831">.</span><span class="ident" id="7093832">Parse</span><span class="op" id="7093837">(</span><span class="string" id="7093838">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}`</span><span class="op" id="7093874">)</span><span class="op" id="7093875">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093878">Must</span><span class="op" id="7093882">(</span><span class="ident" id="7093883">t1</span><span class="op" id="7093885">.</span><span class="ident" id="7093886">Parse</span><span class="op" id="7093891">(</span><span class="string" id="7093892">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><span class="op" id="7093925">)</span><span class="op" id="7093926">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7093930">//&nbsp;Execute&nbsp;t1.</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7093946">b</span><span class="op" id="7093947">.</span><span class="ident" id="7093948">Reset</span><span class="op" id="7093953">(</span><span class="op" id="7093954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7093957">if</span>&nbsp;<span class="ident" id="7093960">err</span>&nbsp;<span class="op" id="7093964">:=</span>&nbsp;<span class="ident" id="7093967">t1</span><span class="op" id="7093969">.</span><span class="ident" id="7093970">ExecuteTemplate</span><span class="op" id="7093985">(</span><span class="ident" id="7093986">b</span><span class="op" id="7093987">,</span>&nbsp;<span class="string" id="7093989">&#34;a&#34;</span><span class="op" id="7093992">,</span>&nbsp;<span class="string" id="7093994">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7094001">)</span><span class="op" id="7094002">;</span>&nbsp;<span class="ident" id="7094004">err</span>&nbsp;<span class="op" id="7094008">!=</span>&nbsp;<span class="ident" id="7094011">nil</span>&nbsp;<span class="op" id="7094015">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094019">t</span><span class="op" id="7094020">.</span><span class="ident" id="7094021">Fatal</span><span class="op" id="7094026">(</span><span class="ident" id="7094027">err</span><span class="op" id="7094030">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094033">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094036">if</span>&nbsp;<span class="ident" id="7094039">got</span><span class="op" id="7094042">,</span>&nbsp;<span class="ident" id="7094044">want</span>&nbsp;<span class="op" id="7094049">:=</span>&nbsp;<span class="ident" id="7094052">b</span><span class="op" id="7094053">.</span><span class="ident" id="7094054">String</span><span class="op" id="7094060">(</span><span class="op" id="7094061">)</span><span class="op" id="7094062">,</span>&nbsp;<span class="string" id="7094064">`&nbsp;&lt;a&nbsp;href=&#34;&nbsp;%3ci%3e*/&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;`</span><span class="op" id="7094094">;</span>&nbsp;<span class="ident" id="7094096">got</span>&nbsp;<span class="op" id="7094100">!=</span>&nbsp;<span class="ident" id="7094103">want</span>&nbsp;<span class="op" id="7094108">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094112">t</span><span class="op" id="7094113">.</span><span class="ident" id="7094114">Errorf</span><span class="op" id="7094120">(</span><span class="string" id="7094121">&#34;t1:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7094141">,</span>&nbsp;<span class="ident" id="7094143">got</span><span class="op" id="7094146">,</span>&nbsp;<span class="ident" id="7094148">want</span><span class="op" id="7094152">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094155">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094159">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094179">t2</span>&nbsp;<span class="op" id="7094182">:=</span>&nbsp;<span class="ident" id="7094185">Must</span><span class="op" id="7094189">(</span><span class="ident" id="7094190">t0</span><span class="op" id="7094192">.</span><span class="ident" id="7094193">Clone</span><span class="op" id="7094198">(</span><span class="op" id="7094199">)</span><span class="op" id="7094200">)</span><br>
<span class="lineno">60</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094203">Must</span><span class="op" id="7094207">(</span><span class="ident" id="7094208">t2</span><span class="op" id="7094210">.</span><span class="ident" id="7094211">Parse</span><span class="op" id="7094216">(</span><span class="string" id="7094217">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;{{end}}`</span><span class="op" id="7094267">)</span><span class="op" id="7094268">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094271">Must</span><span class="op" id="7094275">(</span><span class="ident" id="7094276">t2</span><span class="op" id="7094278">.</span><span class="ident" id="7094279">Parse</span><span class="op" id="7094284">(</span><span class="string" id="7094285">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;{{end}}`</span><span class="op" id="7094318">)</span><span class="op" id="7094319">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094323">//&nbsp;Execute&nbsp;t2.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094339">b</span><span class="op" id="7094340">.</span><span class="ident" id="7094341">Reset</span><span class="op" id="7094346">(</span><span class="op" id="7094347">)</span><br>
<span class="lineno">65</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094350">if</span>&nbsp;<span class="ident" id="7094353">err</span>&nbsp;<span class="op" id="7094357">:=</span>&nbsp;<span class="ident" id="7094360">t2</span><span class="op" id="7094362">.</span><span class="ident" id="7094363">ExecuteTemplate</span><span class="op" id="7094378">(</span><span class="ident" id="7094379">b</span><span class="op" id="7094380">,</span>&nbsp;<span class="string" id="7094382">&#34;a&#34;</span><span class="op" id="7094385">,</span>&nbsp;<span class="string" id="7094387">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7094394">)</span><span class="op" id="7094395">;</span>&nbsp;<span class="ident" id="7094397">err</span>&nbsp;<span class="op" id="7094401">!=</span>&nbsp;<span class="ident" id="7094404">nil</span>&nbsp;<span class="op" id="7094408">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094412">t</span><span class="op" id="7094413">.</span><span class="ident" id="7094414">Fatal</span><span class="op" id="7094419">(</span><span class="ident" id="7094420">err</span><span class="op" id="7094423">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094426">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094429">if</span>&nbsp;<span class="ident" id="7094432">got</span><span class="op" id="7094435">,</span>&nbsp;<span class="ident" id="7094437">want</span>&nbsp;<span class="op" id="7094442">:=</span>&nbsp;<span class="ident" id="7094445">b</span><span class="op" id="7094446">.</span><span class="ident" id="7094447">String</span><span class="op" id="7094453">(</span><span class="op" id="7094454">)</span><span class="op" id="7094455">,</span>&nbsp;<span class="string" id="7094457">`&nbsp;&lt;p&nbsp;onclick=&#34;javascript:&nbsp;&amp;#34;\u003ci\u003e*/&amp;#34;&nbsp;&#34;&gt;&lt;/p&gt;&nbsp;`</span><span class="op" id="7094517">;</span>&nbsp;<span class="ident" id="7094519">got</span>&nbsp;<span class="op" id="7094523">!=</span>&nbsp;<span class="ident" id="7094526">want</span>&nbsp;<span class="op" id="7094531">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094535">t</span><span class="op" id="7094536">.</span><span class="ident" id="7094537">Errorf</span><span class="op" id="7094543">(</span><span class="string" id="7094544">&#34;t2:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7094564">,</span>&nbsp;<span class="ident" id="7094566">got</span><span class="op" id="7094569">,</span>&nbsp;<span class="ident" id="7094571">want</span><span class="op" id="7094575">)</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7094578">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094582">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t3,&nbsp;but&nbsp;do&nbsp;not&nbsp;execute&nbsp;t3&nbsp;yet.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094629">t3</span>&nbsp;<span class="op" id="7094632">:=</span>&nbsp;<span class="ident" id="7094635">Must</span><span class="op" id="7094639">(</span><span class="ident" id="7094640">t0</span><span class="op" id="7094642">.</span><span class="ident" id="7094643">Clone</span><span class="op" id="7094648">(</span><span class="op" id="7094649">)</span><span class="op" id="7094650">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094653">Must</span><span class="op" id="7094657">(</span><span class="ident" id="7094658">t3</span><span class="op" id="7094660">.</span><span class="ident" id="7094661">Parse</span><span class="op" id="7094666">(</span><span class="string" id="7094667">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;style&gt;&nbsp;{{end}}`</span><span class="op" id="7094701">)</span><span class="op" id="7094702">)</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094705">Must</span><span class="op" id="7094709">(</span><span class="ident" id="7094710">t3</span><span class="op" id="7094712">.</span><span class="ident" id="7094713">Parse</span><span class="op" id="7094718">(</span><span class="string" id="7094719">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;&lt;/style&gt;&nbsp;{{end}}`</span><span class="op" id="7094754">)</span><span class="op" id="7094755">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094759">//&nbsp;Complete&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094776">Must</span><span class="op" id="7094780">(</span><span class="ident" id="7094781">t0</span><span class="op" id="7094783">.</span><span class="ident" id="7094784">Parse</span><span class="op" id="7094789">(</span><span class="string" id="7094790">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;(&nbsp;{{end}}`</span><span class="op" id="7094818">)</span><span class="op" id="7094819">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094822">Must</span><span class="op" id="7094826">(</span><span class="ident" id="7094827">t0</span><span class="op" id="7094829">.</span><span class="ident" id="7094830">Parse</span><span class="op" id="7094835">(</span><span class="string" id="7094836">`{{define&nbsp;&#34;rhs&#34;}}&nbsp;)&nbsp;{{end}}`</span><span class="op" id="7094864">)</span><span class="op" id="7094865">)</span><br>
<span class="lineno">80</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7094869">//&nbsp;Clone&nbsp;t0&nbsp;as&nbsp;t4.&nbsp;Redefining&nbsp;the&nbsp;&#34;lhs&#34;&nbsp;template&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7094932">t4</span>&nbsp;<span class="op" id="7094935">:=</span>&nbsp;<span class="ident" id="7094938">Must</span><span class="op" id="7094942">(</span><span class="ident" id="7094943">t0</span><span class="op" id="7094945">.</span><span class="ident" id="7094946">Clone</span><span class="op" id="7094951">(</span><span class="op" id="7094952">)</span><span class="op" id="7094953">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7094956">if</span>&nbsp;<span class="ident" id="7094959">_</span><span class="op" id="7094960">,</span>&nbsp;<span class="ident" id="7094962">err</span>&nbsp;<span class="op" id="7094966">:=</span>&nbsp;<span class="ident" id="7094969">t4</span><span class="op" id="7094971">.</span><span class="ident" id="7094972">Parse</span><span class="op" id="7094977">(</span><span class="string" id="7094978">`{{define&nbsp;&#34;lhs&#34;}}&nbsp;FAIL&nbsp;{{end}}`</span><span class="op" id="7095009">)</span><span class="op" id="7095010">;</span>&nbsp;<span class="ident" id="7095012">err</span>&nbsp;<span class="op" id="7095016">==</span>&nbsp;<span class="ident" id="7095019">nil</span>&nbsp;<span class="op" id="7095023">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095027">t</span><span class="op" id="7095028">.</span><span class="ident" id="7095029">Error</span><span class="op" id="7095034">(</span><span class="string" id="7095035">`redefine&nbsp;&#34;lhs&#34;:&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7095077">)</span><br>
<span class="lineno">85</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095080">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095084">//&nbsp;Execute&nbsp;t0.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095100">b</span><span class="op" id="7095101">.</span><span class="ident" id="7095102">Reset</span><span class="op" id="7095107">(</span><span class="op" id="7095108">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095111">if</span>&nbsp;<span class="ident" id="7095114">err</span>&nbsp;<span class="op" id="7095118">:=</span>&nbsp;<span class="ident" id="7095121">t0</span><span class="op" id="7095123">.</span><span class="ident" id="7095124">ExecuteTemplate</span><span class="op" id="7095139">(</span><span class="ident" id="7095140">b</span><span class="op" id="7095141">,</span>&nbsp;<span class="string" id="7095143">&#34;a&#34;</span><span class="op" id="7095146">,</span>&nbsp;<span class="string" id="7095148">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7095155">)</span><span class="op" id="7095156">;</span>&nbsp;<span class="ident" id="7095158">err</span>&nbsp;<span class="op" id="7095162">!=</span>&nbsp;<span class="ident" id="7095165">nil</span>&nbsp;<span class="op" id="7095169">{</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095173">t</span><span class="op" id="7095174">.</span><span class="ident" id="7095175">Fatal</span><span class="op" id="7095180">(</span><span class="ident" id="7095181">err</span><span class="op" id="7095184">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095187">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095190">if</span>&nbsp;<span class="ident" id="7095193">got</span><span class="op" id="7095196">,</span>&nbsp;<span class="ident" id="7095198">want</span>&nbsp;<span class="op" id="7095203">:=</span>&nbsp;<span class="ident" id="7095206">b</span><span class="op" id="7095207">.</span><span class="ident" id="7095208">String</span><span class="op" id="7095214">(</span><span class="op" id="7095215">)</span><span class="op" id="7095216">,</span>&nbsp;<span class="string" id="7095218">`&nbsp;(&nbsp;&amp;lt;i&amp;gt;*/&nbsp;)&nbsp;`</span><span class="op" id="7095237">;</span>&nbsp;<span class="ident" id="7095239">got</span>&nbsp;<span class="op" id="7095243">!=</span>&nbsp;<span class="ident" id="7095246">want</span>&nbsp;<span class="op" id="7095251">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095255">t</span><span class="op" id="7095256">.</span><span class="ident" id="7095257">Errorf</span><span class="op" id="7095263">(</span><span class="string" id="7095264">&#34;t0:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095284">,</span>&nbsp;<span class="ident" id="7095286">got</span><span class="op" id="7095289">,</span>&nbsp;<span class="ident" id="7095291">want</span><span class="op" id="7095295">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095298">}</span><br>
<span class="lineno">95</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095302">//&nbsp;Clone&nbsp;t0.&nbsp;This&nbsp;should&nbsp;fail,&nbsp;as&nbsp;t0&nbsp;has&nbsp;already&nbsp;executed.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095362">if</span>&nbsp;<span class="ident" id="7095365">_</span><span class="op" id="7095366">,</span>&nbsp;<span class="ident" id="7095368">err</span>&nbsp;<span class="op" id="7095372">:=</span>&nbsp;<span class="ident" id="7095375">t0</span><span class="op" id="7095377">.</span><span class="ident" id="7095378">Clone</span><span class="op" id="7095383">(</span><span class="op" id="7095384">)</span><span class="op" id="7095385">;</span>&nbsp;<span class="ident" id="7095387">err</span>&nbsp;<span class="op" id="7095391">==</span>&nbsp;<span class="ident" id="7095394">nil</span>&nbsp;<span class="op" id="7095398">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095402">t</span><span class="op" id="7095403">.</span><span class="ident" id="7095404">Error</span><span class="op" id="7095409">(</span><span class="string" id="7095410">`t0.Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7095448">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095451">}</span><br>
<span class="lineno">100</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095455">//&nbsp;Similarly,&nbsp;cloning&nbsp;sub-templates&nbsp;should&nbsp;fail.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095505">if</span>&nbsp;<span class="ident" id="7095508">_</span><span class="op" id="7095509">,</span>&nbsp;<span class="ident" id="7095511">err</span>&nbsp;<span class="op" id="7095515">:=</span>&nbsp;<span class="ident" id="7095518">t0</span><span class="op" id="7095520">.</span><span class="ident" id="7095521">Lookup</span><span class="op" id="7095527">(</span><span class="string" id="7095528">&#34;a&#34;</span><span class="op" id="7095531">)</span><span class="op" id="7095532">.</span><span class="ident" id="7095533">Clone</span><span class="op" id="7095538">(</span><span class="op" id="7095539">)</span><span class="op" id="7095540">;</span>&nbsp;<span class="ident" id="7095542">err</span>&nbsp;<span class="op" id="7095546">==</span>&nbsp;<span class="ident" id="7095549">nil</span>&nbsp;<span class="op" id="7095553">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095557">t</span><span class="op" id="7095558">.</span><span class="ident" id="7095559">Error</span><span class="op" id="7095564">(</span><span class="string" id="7095565">`t0.Lookup(&#34;a&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7095615">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095618">}</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095621">if</span>&nbsp;<span class="ident" id="7095624">_</span><span class="op" id="7095625">,</span>&nbsp;<span class="ident" id="7095627">err</span>&nbsp;<span class="op" id="7095631">:=</span>&nbsp;<span class="ident" id="7095634">t0</span><span class="op" id="7095636">.</span><span class="ident" id="7095637">Lookup</span><span class="op" id="7095643">(</span><span class="string" id="7095644">&#34;lhs&#34;</span><span class="op" id="7095649">)</span><span class="op" id="7095650">.</span><span class="ident" id="7095651">Clone</span><span class="op" id="7095656">(</span><span class="op" id="7095657">)</span><span class="op" id="7095658">;</span>&nbsp;<span class="ident" id="7095660">err</span>&nbsp;<span class="op" id="7095664">==</span>&nbsp;<span class="ident" id="7095667">nil</span>&nbsp;<span class="op" id="7095671">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095675">t</span><span class="op" id="7095676">.</span><span class="ident" id="7095677">Error</span><span class="op" id="7095682">(</span><span class="string" id="7095683">`t0.Lookup(&#34;lhs&#34;).Clone():&nbsp;got&nbsp;nil&nbsp;err&nbsp;want&nbsp;non-nil`</span><span class="op" id="7095735">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095738">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7095742">//&nbsp;Execute&nbsp;t3.</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095758">b</span><span class="op" id="7095759">.</span><span class="ident" id="7095760">Reset</span><span class="op" id="7095765">(</span><span class="op" id="7095766">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095769">if</span>&nbsp;<span class="ident" id="7095772">err</span>&nbsp;<span class="op" id="7095776">:=</span>&nbsp;<span class="ident" id="7095779">t3</span><span class="op" id="7095781">.</span><span class="ident" id="7095782">ExecuteTemplate</span><span class="op" id="7095797">(</span><span class="ident" id="7095798">b</span><span class="op" id="7095799">,</span>&nbsp;<span class="string" id="7095801">&#34;a&#34;</span><span class="op" id="7095804">,</span>&nbsp;<span class="string" id="7095806">&#34;&lt;i&gt;*/&#34;</span><span class="op" id="7095813">)</span><span class="op" id="7095814">;</span>&nbsp;<span class="ident" id="7095816">err</span>&nbsp;<span class="op" id="7095820">!=</span>&nbsp;<span class="ident" id="7095823">nil</span>&nbsp;<span class="op" id="7095827">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095831">t</span><span class="op" id="7095832">.</span><span class="ident" id="7095833">Fatal</span><span class="op" id="7095838">(</span><span class="ident" id="7095839">err</span><span class="op" id="7095842">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095845">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7095848">if</span>&nbsp;<span class="ident" id="7095851">got</span><span class="op" id="7095854">,</span>&nbsp;<span class="ident" id="7095856">want</span>&nbsp;<span class="op" id="7095861">:=</span>&nbsp;<span class="ident" id="7095864">b</span><span class="op" id="7095865">.</span><span class="ident" id="7095866">String</span><span class="op" id="7095872">(</span><span class="op" id="7095873">)</span><span class="op" id="7095874">,</span>&nbsp;<span class="string" id="7095876">`&nbsp;&lt;style&gt;&nbsp;ZgotmplZ&nbsp;&lt;/style&gt;&nbsp;`</span><span class="op" id="7095905">;</span>&nbsp;<span class="ident" id="7095907">got</span>&nbsp;<span class="op" id="7095911">!=</span>&nbsp;<span class="ident" id="7095914">want</span>&nbsp;<span class="op" id="7095919">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7095923">t</span><span class="op" id="7095924">.</span><span class="ident" id="7095925">Errorf</span><span class="op" id="7095931">(</span><span class="string" id="7095932">&#34;t3:&nbsp;got&nbsp;%q&nbsp;want&nbsp;%q&#34;</span><span class="op" id="7095952">,</span>&nbsp;<span class="ident" id="7095954">got</span><span class="op" id="7095957">,</span>&nbsp;<span class="ident" id="7095959">want</span><span class="op" id="7095963">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7095966">}</span><br>
<span class="lineno"></span><span class="op" id="7095968">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="7095971">func</span>&nbsp;<span class="ident" id="7095976">TestTemplates</span><span class="op" id="7095989">(</span><span class="ident" id="7095990">t</span>&nbsp;<span class="op" id="7095992">*</span><span class="ident" id="7095993">testing</span><span class="op" id="7096000">.</span><span class="ident" id="7096001">T</span><span class="op" id="7096002">)</span>&nbsp;<span class="op" id="7096004">{</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096007">names</span>&nbsp;<span class="op" id="7096013">:=</span>&nbsp;<span class="op" id="7096016">[</span><span class="op" id="7096017">]</span><span class="builtintype" id="7096018">string</span><span class="op" id="7096024">{</span><span class="string" id="7096025">&#34;t0&#34;</span><span class="op" id="7096029">,</span>&nbsp;<span class="string" id="7096031">&#34;a&#34;</span><span class="op" id="7096034">,</span>&nbsp;<span class="string" id="7096036">&#34;lhs&#34;</span><span class="op" id="7096041">,</span>&nbsp;<span class="string" id="7096043">&#34;rhs&#34;</span><span class="op" id="7096048">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7096051">//&nbsp;Some&nbsp;template&nbsp;definitions&nbsp;borrowed&nbsp;from&nbsp;TestClone.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096106">const</span>&nbsp;<span class="ident" id="7096112">tmpl</span>&nbsp;<span class="op" id="7096117">=</span>&nbsp;<span class="string" id="7096119">`<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;lhs&#34;}}{{.}}{{template&nbsp;&#34;rhs&#34;}}{{end}}<br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;lhs&#34;}}&nbsp;&lt;a&nbsp;href=&#34;&nbsp;{{end}}<br>
<span class="lineno">125</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp{{define&nbsp;&#34;rhs&#34;}}&nbsp;&#34;&gt;&lt;/a&gt;&nbsp;{{end}}`</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096259">t0</span>&nbsp;<span class="op" id="7096262">:=</span>&nbsp;<span class="ident" id="7096265">Must</span><span class="op" id="7096269">(</span><span class="ident" id="7096270">New</span><span class="op" id="7096273">(</span><span class="string" id="7096274">&#34;t0&#34;</span><span class="op" id="7096278">)</span><span class="op" id="7096279">.</span><span class="ident" id="7096280">Parse</span><span class="op" id="7096285">(</span><span class="ident" id="7096286">tmpl</span><span class="op" id="7096290">)</span><span class="op" id="7096291">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096294">templates</span>&nbsp;<span class="op" id="7096304">:=</span>&nbsp;<span class="ident" id="7096307">t0</span><span class="op" id="7096309">.</span><span class="ident" id="7096310">Templates</span><span class="op" id="7096319">(</span><span class="op" id="7096320">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096323">if</span>&nbsp;<span class="builtinfunc" id="7096326">len</span><span class="op" id="7096329">(</span><span class="ident" id="7096330">templates</span><span class="op" id="7096339">)</span>&nbsp;<span class="op" id="7096341">!=</span>&nbsp;<span class="builtinfunc" id="7096344">len</span><span class="op" id="7096347">(</span><span class="ident" id="7096348">names</span><span class="op" id="7096353">)</span>&nbsp;<span class="op" id="7096355">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096359">t</span><span class="op" id="7096360">.</span><span class="ident" id="7096361">Errorf</span><span class="op" id="7096367">(</span><span class="string" id="7096368">&#34;expected&nbsp;%d&nbsp;templates;&nbsp;got&nbsp;%d&#34;</span><span class="op" id="7096399">,</span>&nbsp;<span class="builtinfunc" id="7096401">len</span><span class="op" id="7096404">(</span><span class="ident" id="7096405">names</span><span class="op" id="7096410">)</span><span class="op" id="7096411">,</span>&nbsp;<span class="builtinfunc" id="7096413">len</span><span class="op" id="7096416">(</span><span class="ident" id="7096417">templates</span><span class="op" id="7096426">)</span><span class="op" id="7096427">)</span><br>
<span class="lineno">130</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096430">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096433">for</span>&nbsp;<span class="ident" id="7096437">_</span><span class="op" id="7096438">,</span>&nbsp;<span class="ident" id="7096440">name</span>&nbsp;<span class="op" id="7096445">:=</span>&nbsp;<span class="keyword" id="7096448">range</span>&nbsp;<span class="ident" id="7096454">names</span>&nbsp;<span class="op" id="7096460">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096464">found</span>&nbsp;<span class="op" id="7096470">:=</span>&nbsp;<span class="builtintype" id="7096473">false</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096481">for</span>&nbsp;<span class="ident" id="7096485">_</span><span class="op" id="7096486">,</span>&nbsp;<span class="ident" id="7096488">tmpl</span>&nbsp;<span class="op" id="7096493">:=</span>&nbsp;<span class="keyword" id="7096496">range</span>&nbsp;<span class="ident" id="7096502">templates</span>&nbsp;<span class="op" id="7096512">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096517">if</span>&nbsp;<span class="ident" id="7096520">name</span>&nbsp;<span class="op" id="7096525">==</span>&nbsp;<span class="ident" id="7096528">tmpl</span><span class="op" id="7096532">.</span><span class="ident" id="7096533">text</span><span class="op" id="7096537">.</span><span class="ident" id="7096538">Name</span><span class="op" id="7096542">(</span><span class="op" id="7096543">)</span>&nbsp;<span class="op" id="7096545">{</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096551">found</span>&nbsp;<span class="op" id="7096557">=</span>&nbsp;<span class="builtintype" id="7096559">true</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096568">break</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096577">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096581">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7096585">if</span>&nbsp;<span class="op" id="7096588">!</span><span class="ident" id="7096589">found</span>&nbsp;<span class="op" id="7096595">{</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096600">t</span><span class="op" id="7096601">.</span><span class="ident" id="7096602">Error</span><span class="op" id="7096607">(</span><span class="string" id="7096608">&#34;could&nbsp;not&nbsp;find&nbsp;template&#34;</span><span class="op" id="7096633">,</span>&nbsp;<span class="ident" id="7096635">name</span><span class="op" id="7096639">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096643">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7096646">}</span><br>
<span class="lineno"></span><span class="op" id="7096648">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">145</span><span class="comment" id="7096651">//&nbsp;This&nbsp;used&nbsp;to&nbsp;crash;&nbsp;http://golang.org/issue/3281</span><br>
<span class="lineno"></span><span class="keyword" id="7096703">func</span>&nbsp;<span class="ident" id="7096708">TestCloneCrash</span><span class="op" id="7096722">(</span><span class="ident" id="7096723">t</span>&nbsp;<span class="op" id="7096725">*</span><span class="ident" id="7096726">testing</span><span class="op" id="7096733">.</span><span class="ident" id="7096734">T</span><span class="op" id="7096735">)</span>&nbsp;<span class="op" id="7096737">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096740">t1</span>&nbsp;<span class="op" id="7096743">:=</span>&nbsp;<span class="ident" id="7096746">New</span><span class="op" id="7096749">(</span><span class="string" id="7096750">&#34;all&#34;</span><span class="op" id="7096755">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096758">Must</span><span class="op" id="7096762">(</span><span class="ident" id="7096763">t1</span><span class="op" id="7096765">.</span><span class="ident" id="7096766">New</span><span class="op" id="7096769">(</span><span class="string" id="7096770">&#34;t1&#34;</span><span class="op" id="7096774">)</span><span class="op" id="7096775">.</span><span class="ident" id="7096776">Parse</span><span class="op" id="7096781">(</span><span class="string" id="7096782">`{{define&nbsp;&#34;foo&#34;}}foo{{end}}`</span><span class="op" id="7096810">)</span><span class="op" id="7096811">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7096814">t1</span><span class="op" id="7096816">.</span><span class="ident" id="7096817">Clone</span><span class="op" id="7096822">(</span><span class="op" id="7096823">)</span><br>
<span class="lineno">150</span><span class="op" id="7096825">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7096828">//&nbsp;Ensure&nbsp;that&nbsp;this&nbsp;guarantee&nbsp;from&nbsp;the&nbsp;docs&nbsp;is&nbsp;upheld:</span><br>
<span class="lineno"></span><span class="comment" id="7096883">//&nbsp;&#34;Further&nbsp;calls&nbsp;to&nbsp;Parse&nbsp;in&nbsp;the&nbsp;copy&nbsp;will&nbsp;add&nbsp;templates</span><br>
<span class="lineno"></span><span class="comment" id="7096941">//&nbsp;to&nbsp;the&nbsp;copy&nbsp;but&nbsp;not&nbsp;to&nbsp;the&nbsp;original.&#34;</span><br>
<span class="lineno">155</span><span class="keyword" id="7096982">func</span>&nbsp;<span class="ident" id="7096987">TestCloneThenParse</span><span class="op" id="7097005">(</span><span class="ident" id="7097006">t</span>&nbsp;<span class="op" id="7097008">*</span><span class="ident" id="7097009">testing</span><span class="op" id="7097016">.</span><span class="ident" id="7097017">T</span><span class="op" id="7097018">)</span>&nbsp;<span class="op" id="7097020">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097023">t0</span>&nbsp;<span class="op" id="7097026">:=</span>&nbsp;<span class="ident" id="7097029">Must</span><span class="op" id="7097033">(</span><span class="ident" id="7097034">New</span><span class="op" id="7097037">(</span><span class="string" id="7097038">&#34;t0&#34;</span><span class="op" id="7097042">)</span><span class="op" id="7097043">.</span><span class="ident" id="7097044">Parse</span><span class="op" id="7097049">(</span><span class="string" id="7097050">`{{define&nbsp;&#34;a&#34;}}{{template&nbsp;&#34;embedded&#34;}}{{end}}`</span><span class="op" id="7097096">)</span><span class="op" id="7097097">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097100">t1</span>&nbsp;<span class="op" id="7097103">:=</span>&nbsp;<span class="ident" id="7097106">Must</span><span class="op" id="7097110">(</span><span class="ident" id="7097111">t0</span><span class="op" id="7097113">.</span><span class="ident" id="7097114">Clone</span><span class="op" id="7097119">(</span><span class="op" id="7097120">)</span><span class="op" id="7097121">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097124">Must</span><span class="op" id="7097128">(</span><span class="ident" id="7097129">t1</span><span class="op" id="7097131">.</span><span class="ident" id="7097132">Parse</span><span class="op" id="7097137">(</span><span class="string" id="7097138">`{{define&nbsp;&#34;embedded&#34;}}t1{{end}}`</span><span class="op" id="7097170">)</span><span class="op" id="7097171">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097174">if</span>&nbsp;<span class="builtinfunc" id="7097177">len</span><span class="op" id="7097180">(</span><span class="ident" id="7097181">t0</span><span class="op" id="7097183">.</span><span class="ident" id="7097184">Templates</span><span class="op" id="7097193">(</span><span class="op" id="7097194">)</span><span class="op" id="7097195">)</span><span class="op" id="7097196">+</span><span class="num" id="7097197">1</span>&nbsp;<span class="op" id="7097199">!=</span>&nbsp;<span class="builtinfunc" id="7097202">len</span><span class="op" id="7097205">(</span><span class="ident" id="7097206">t1</span><span class="op" id="7097208">.</span><span class="ident" id="7097209">Templates</span><span class="op" id="7097218">(</span><span class="op" id="7097219">)</span><span class="op" id="7097220">)</span>&nbsp;<span class="op" id="7097222">{</span><br>
<span class="lineno">160</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097226">t</span><span class="op" id="7097227">.</span><span class="ident" id="7097228">Error</span><span class="op" id="7097233">(</span><span class="string" id="7097234">&#34;adding&nbsp;a&nbsp;template&nbsp;to&nbsp;a&nbsp;clone&nbsp;added&nbsp;it&nbsp;to&nbsp;the&nbsp;original&#34;</span><span class="op" id="7097289">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097292">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097295">//&nbsp;double&nbsp;check&nbsp;that&nbsp;the&nbsp;embedded&nbsp;template&nbsp;isn&#39;t&nbsp;available&nbsp;in&nbsp;the&nbsp;original</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097371">err</span>&nbsp;<span class="op" id="7097375">:=</span>&nbsp;<span class="ident" id="7097378">t0</span><span class="op" id="7097380">.</span><span class="ident" id="7097381">ExecuteTemplate</span><span class="op" id="7097396">(</span><span class="ident" id="7097397">ioutil</span><span class="op" id="7097403">.</span><span class="ident" id="7097404">Discard</span><span class="op" id="7097411">,</span>&nbsp;<span class="string" id="7097413">&#34;a&#34;</span><span class="op" id="7097416">,</span>&nbsp;<span class="ident" id="7097418">nil</span><span class="op" id="7097421">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097424">if</span>&nbsp;<span class="ident" id="7097427">err</span>&nbsp;<span class="op" id="7097431">==</span>&nbsp;<span class="ident" id="7097434">nil</span>&nbsp;<span class="op" id="7097438">{</span><br>
<span class="lineno">165</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097442">t</span><span class="op" id="7097443">.</span><span class="ident" id="7097444">Error</span><span class="op" id="7097449">(</span><span class="string" id="7097450">&#34;expected&nbsp;&#39;no&nbsp;such&nbsp;template&#39;&nbsp;error&#34;</span><span class="op" id="7097485">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097488">}</span><br>
<span class="lineno"></span><span class="op" id="7097490">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="7097493">//&nbsp;https://code.google.com/p/go/issues/detail?id=5980</span><br>
<span class="lineno">170</span><span class="keyword" id="7097547">func</span>&nbsp;<span class="ident" id="7097552">TestFuncMapWorksAfterClone</span><span class="op" id="7097578">(</span><span class="ident" id="7097579">t</span>&nbsp;<span class="op" id="7097581">*</span><span class="ident" id="7097582">testing</span><span class="op" id="7097589">.</span><span class="ident" id="7097590">T</span><span class="op" id="7097591">)</span>&nbsp;<span class="op" id="7097593">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097596">funcs</span>&nbsp;<span class="op" id="7097602">:=</span>&nbsp;<span class="ident" id="7097605">FuncMap</span><span class="op" id="7097612">{</span><span class="string" id="7097613">&#34;customFunc&#34;</span><span class="op" id="7097625">:</span>&nbsp;<span class="keyword" id="7097627">func</span><span class="op" id="7097631">(</span><span class="op" id="7097632">)</span>&nbsp;<span class="op" id="7097634">(</span><span class="builtintype" id="7097635">string</span><span class="op" id="7097641">,</span>&nbsp;<span class="builtintype" id="7097643">error</span><span class="op" id="7097648">)</span>&nbsp;<span class="op" id="7097650">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7097654">return</span>&nbsp;<span class="string" id="7097661">&#34;&#34;</span><span class="op" id="7097663">,</span>&nbsp;<span class="ident" id="7097665">errors</span><span class="op" id="7097671">.</span><span class="ident" id="7097672">New</span><span class="op" id="7097675">(</span><span class="string" id="7097676">&#34;issue5980&#34;</span><span class="op" id="7097687">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7097690">}</span><span class="op" id="7097691">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">175</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097695">//&nbsp;get&nbsp;the&nbsp;expected&nbsp;error&nbsp;output&nbsp;(no&nbsp;clone)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097740">uncloned</span>&nbsp;<span class="op" id="7097749">:=</span>&nbsp;<span class="ident" id="7097752">Must</span><span class="op" id="7097756">(</span><span class="ident" id="7097757">New</span><span class="op" id="7097760">(</span><span class="string" id="7097761">&#34;&#34;</span><span class="op" id="7097763">)</span><span class="op" id="7097764">.</span><span class="ident" id="7097765">Funcs</span><span class="op" id="7097770">(</span><span class="ident" id="7097771">funcs</span><span class="op" id="7097776">)</span><span class="op" id="7097777">.</span><span class="ident" id="7097778">Parse</span><span class="op" id="7097783">(</span><span class="string" id="7097784">&#34;{{customFunc}}&#34;</span><span class="op" id="7097800">)</span><span class="op" id="7097801">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097804">wantErr</span>&nbsp;<span class="op" id="7097812">:=</span>&nbsp;<span class="ident" id="7097815">uncloned</span><span class="op" id="7097823">.</span><span class="ident" id="7097824">Execute</span><span class="op" id="7097831">(</span><span class="ident" id="7097832">ioutil</span><span class="op" id="7097838">.</span><span class="ident" id="7097839">Discard</span><span class="op" id="7097846">,</span>&nbsp;<span class="ident" id="7097848">nil</span><span class="op" id="7097851">)</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097855">//&nbsp;toClone&nbsp;must&nbsp;be&nbsp;the&nbsp;same&nbsp;as&nbsp;uncloned.&nbsp;It&nbsp;has&nbsp;to&nbsp;be&nbsp;recreated&nbsp;from&nbsp;scratch,</span><br>
<span class="lineno">180</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="7097934">//&nbsp;since&nbsp;cloning&nbsp;cannot&nbsp;occur&nbsp;after&nbsp;execution.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7097982">toClone</span>&nbsp;<span class="op" id="7097990">:=</span>&nbsp;<span class="ident" id="7097993">Must</span><span class="op" id="7097997">(</span><span class="ident" id="7097998">New</span><span class="op" id="7098001">(</span><span class="string" id="7098002">&#34;&#34;</span><span class="op" id="7098004">)</span><span class="op" id="7098005">.</span><span class="ident" id="7098006">Funcs</span><span class="op" id="7098011">(</span><span class="ident" id="7098012">funcs</span><span class="op" id="7098017">)</span><span class="op" id="7098018">.</span><span class="ident" id="7098019">Parse</span><span class="op" id="7098024">(</span><span class="string" id="7098025">&#34;{{customFunc}}&#34;</span><span class="op" id="7098041">)</span><span class="op" id="7098042">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098045">cloned</span>&nbsp;<span class="op" id="7098052">:=</span>&nbsp;<span class="ident" id="7098055">Must</span><span class="op" id="7098059">(</span><span class="ident" id="7098060">toClone</span><span class="op" id="7098067">.</span><span class="ident" id="7098068">Clone</span><span class="op" id="7098073">(</span><span class="op" id="7098074">)</span><span class="op" id="7098075">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098078">gotErr</span>&nbsp;<span class="op" id="7098085">:=</span>&nbsp;<span class="ident" id="7098088">cloned</span><span class="op" id="7098094">.</span><span class="ident" id="7098095">Execute</span><span class="op" id="7098102">(</span><span class="ident" id="7098103">ioutil</span><span class="op" id="7098109">.</span><span class="ident" id="7098110">Discard</span><span class="op" id="7098117">,</span>&nbsp;<span class="ident" id="7098119">nil</span><span class="op" id="7098122">)</span><br>
<span class="lineno"></span><br>
<span class="lineno">185</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="7098126">if</span>&nbsp;<span class="ident" id="7098129">wantErr</span><span class="op" id="7098136">.</span><span class="ident" id="7098137">Error</span><span class="op" id="7098142">(</span><span class="op" id="7098143">)</span>&nbsp;<span class="op" id="7098145">!=</span>&nbsp;<span class="ident" id="7098148">gotErr</span><span class="op" id="7098154">.</span><span class="ident" id="7098155">Error</span><span class="op" id="7098160">(</span><span class="op" id="7098161">)</span>&nbsp;<span class="op" id="7098163">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="7098167">t</span><span class="op" id="7098168">.</span><span class="ident" id="7098169">Errorf</span><span class="op" id="7098175">(</span><span class="string" id="7098176">&#34;clone&nbsp;error&nbsp;message&nbsp;mismatch&nbsp;want&nbsp;%q&nbsp;got&nbsp;%q&#34;</span><span class="op" id="7098221">,</span>&nbsp;<span class="ident" id="7098223">wantErr</span><span class="op" id="7098230">,</span>&nbsp;<span class="ident" id="7098232">gotErr</span><span class="op" id="7098238">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="7098241">}</span><br>
<span class="lineno"></span><span class="op" id="7098243">}</span>
</div>
</body>
</html>
