<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Go standard library</title>
	<link rel="stylesheet" type="text/css" href="/gostd.css">
</head>

<body>

<div class="pkgnavi">
<h1><a href="/gostd/index.html">Go Standard Library</a></h1>
<h2>image</h2>
<ul>
<li><a href="/gostd/image/decode_example_test.go.html">decode_example_test.go</a></li>
<li><a href="/gostd/image/decode_test.go.html">decode_test.go</a></li>
<li><a href="/gostd/image/format.go.html">format.go</a></li>
<li><a href="/gostd/image/geom.go.html">geom.go</a></li>
<li><a href="/gostd/image/image.go.html">image.go</a></li>
<li><a href="/gostd/image/image_test.go.html">image_test.go</a></li>
<li><a href="/gostd/image/names.go.html">names.go</a></li>
<li><a href="/gostd/image/ycbcr.go.html" class="current">ycbcr.go</a></li>
<li><a href="/gostd/image/ycbcr_test.go.html">ycbcr_test.go</a></li>
</ul>
</div>
<div class="code">
<span class="lineno">1</span><span class="comment" id="5518919">//&nbsp;Copyright&nbsp;2011&nbsp;The&nbsp;Go&nbsp;Authors.&nbsp;All&nbsp;rights&nbsp;reserved.</span><br>
<span class="lineno"></span><span class="comment" id="5518974">//&nbsp;Use&nbsp;of&nbsp;this&nbsp;source&nbsp;code&nbsp;is&nbsp;governed&nbsp;by&nbsp;a&nbsp;BSD-style</span><br>
<span class="lineno"></span><span class="comment" id="5519028">//&nbsp;license&nbsp;that&nbsp;can&nbsp;be&nbsp;found&nbsp;in&nbsp;the&nbsp;LICENSE&nbsp;file.</span><br>
<span class="lineno"></span><br>
<span class="lineno">5</span><span class="keyword" id="5519079">package</span>&nbsp;<span class="ident" id="5519087">image</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5519094">import</span>&nbsp;<span class="op" id="5519101">(</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="string" id="5519104">&#34;image/color&#34;</span><br>
<span class="lineno"></span><span class="op" id="5519118">)</span><br>
<span class="lineno">10</span><br>
<span class="lineno"></span><span class="comment" id="5519121">//&nbsp;YCbCrSubsampleRatio&nbsp;is&nbsp;the&nbsp;chroma&nbsp;subsample&nbsp;ratio&nbsp;used&nbsp;in&nbsp;a&nbsp;YCbCr&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5519197">type</span>&nbsp;<span class="ident" id="5519202">YCbCrSubsampleRatio</span>&nbsp;<span class="builtintype" id="5519222">int</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5519227">const</span>&nbsp;<span class="op" id="5519233">(</span><br>
<span class="lineno">15</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519236">YCbCrSubsampleRatio444</span>&nbsp;<span class="ident" id="5519259">YCbCrSubsampleRatio</span>&nbsp;<span class="op" id="5519279">=</span>&nbsp;<span class="ident" id="5519281">iota</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519287">YCbCrSubsampleRatio422</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519311">YCbCrSubsampleRatio420</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5519335">YCbCrSubsampleRatio440</span><br>
<span class="lineno"></span><span class="op" id="5519358">)</span><br>
<span class="lineno">20</span><br>
<span class="lineno"></span><span class="keyword" id="5519361">func</span>&nbsp;<span class="op" id="5519366">(</span><span class="ident" id="5519367">s</span>&nbsp;<span class="ident" id="5519369">YCbCrSubsampleRatio</span><span class="op" id="5519388">)</span>&nbsp;<span class="ident" id="5519390">String</span><span class="op" id="5519396">(</span><span class="op" id="5519397">)</span>&nbsp;<span class="builtintype" id="5519399">string</span>&nbsp;<span class="op" id="5519406">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519409">switch</span>&nbsp;<span class="ident" id="5519416">s</span>&nbsp;<span class="op" id="5519418">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519421">case</span>&nbsp;<span class="ident" id="5519426">YCbCrSubsampleRatio444</span><span class="op" id="5519448">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519452">return</span>&nbsp;<span class="string" id="5519459">&#34;YCbCrSubsampleRatio444&#34;</span><br>
<span class="lineno">25</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519485">case</span>&nbsp;<span class="ident" id="5519490">YCbCrSubsampleRatio422</span><span class="op" id="5519512">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519516">return</span>&nbsp;<span class="string" id="5519523">&#34;YCbCrSubsampleRatio422&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519549">case</span>&nbsp;<span class="ident" id="5519554">YCbCrSubsampleRatio420</span><span class="op" id="5519576">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519580">return</span>&nbsp;<span class="string" id="5519587">&#34;YCbCrSubsampleRatio420&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519613">case</span>&nbsp;<span class="ident" id="5519618">YCbCrSubsampleRatio440</span><span class="op" id="5519640">:</span><br>
<span class="lineno">30</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519644">return</span>&nbsp;<span class="string" id="5519651">&#34;YCbCrSubsampleRatio440&#34;</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5519677">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5519680">return</span>&nbsp;<span class="string" id="5519687">&#34;YCbCrSubsampleRatioUnknown&#34;</span><br>
<span class="lineno"></span><span class="op" id="5519716">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">35</span><span class="comment" id="5519719">//&nbsp;YCbCr&nbsp;is&nbsp;an&nbsp;in-memory&nbsp;image&nbsp;of&nbsp;Y&#39;CbCr&nbsp;colors.&nbsp;There&nbsp;is&nbsp;one&nbsp;Y&nbsp;sample&nbsp;per</span><br>
<span class="lineno"></span><span class="comment" id="5519794">//&nbsp;pixel,&nbsp;but&nbsp;each&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;sample&nbsp;can&nbsp;span&nbsp;one&nbsp;or&nbsp;more&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5519859">//&nbsp;YStride&nbsp;is&nbsp;the&nbsp;Y&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels.</span><br>
<span class="lineno"></span><span class="comment" id="5519933">//&nbsp;CStride&nbsp;is&nbsp;the&nbsp;Cb&nbsp;and&nbsp;Cr&nbsp;slice&nbsp;index&nbsp;delta&nbsp;between&nbsp;vertically&nbsp;adjacent&nbsp;pixels</span><br>
<span class="lineno"></span><span class="comment" id="5520014">//&nbsp;that&nbsp;map&nbsp;to&nbsp;separate&nbsp;chroma&nbsp;samples.</span><br>
<span class="lineno">40</span><span class="comment" id="5520054">//&nbsp;It&nbsp;is&nbsp;not&nbsp;an&nbsp;absolute&nbsp;requirement,&nbsp;but&nbsp;YStride&nbsp;and&nbsp;len(Y)&nbsp;are&nbsp;typically</span><br>
<span class="lineno"></span><span class="comment" id="5520129">//&nbsp;multiples&nbsp;of&nbsp;8,&nbsp;and:</span><br>
<span class="lineno"></span><span class="comment" id="5520153">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:4,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/1.</span><br>
<span class="lineno"></span><span class="comment" id="5520223">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:2,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="comment" id="5520293">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:2:0,&nbsp;CStride&nbsp;==&nbsp;YStride/2&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/4.</span><br>
<span class="lineno">45</span><span class="comment" id="5520363">//&nbsp;&nbsp;&nbsp;&nbspFor&nbsp;4:4:0,&nbsp;CStride&nbsp;==&nbsp;YStride/1&nbsp;&amp;&amp;&nbsp;len(Cb)&nbsp;==&nbsp;len(Cr)&nbsp;==&nbsp;len(Y)/2.</span><br>
<span class="lineno"></span><span class="keyword" id="5520433">type</span>&nbsp;<span class="ident" id="5520438">YCbCr</span>&nbsp;<span class="keyword" id="5520444">struct</span>&nbsp;<span class="op" id="5520451">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520454">Y</span><span class="op" id="5520455">,</span>&nbsp;<span class="ident" id="5520457">Cb</span><span class="op" id="5520459">,</span>&nbsp;<span class="ident" id="5520461">Cr</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="op" id="5520469">[</span><span class="op" id="5520470">]</span><span class="builtintype" id="5520471">uint8</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520478">YStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520493">int</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520498">CStride</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="builtintype" id="5520513">int</span><br>
<span class="lineno">50</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520518">SubsampleRatio</span>&nbsp;<span class="ident" id="5520533">YCbCrSubsampleRatio</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520554">Rect</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5520569">Rectangle</span><br>
<span class="lineno"></span><span class="op" id="5520579">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520582">func</span>&nbsp;<span class="op" id="5520587">(</span><span class="ident" id="5520588">p</span>&nbsp;<span class="op" id="5520590">*</span><span class="ident" id="5520591">YCbCr</span><span class="op" id="5520596">)</span>&nbsp;<span class="ident" id="5520598">ColorModel</span><span class="op" id="5520608">(</span><span class="op" id="5520609">)</span>&nbsp;<span class="ident" id="5520611">color</span><span class="op" id="5520616">.</span><span class="ident" id="5520617">Model</span>&nbsp;<span class="op" id="5520623">{</span><br>
<span class="lineno">55</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520626">return</span>&nbsp;<span class="ident" id="5520633">color</span><span class="op" id="5520638">.</span><span class="ident" id="5520639">YCbCrModel</span><br>
<span class="lineno"></span><span class="op" id="5520650">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520653">func</span>&nbsp;<span class="op" id="5520658">(</span><span class="ident" id="5520659">p</span>&nbsp;<span class="op" id="5520661">*</span><span class="ident" id="5520662">YCbCr</span><span class="op" id="5520667">)</span>&nbsp;<span class="ident" id="5520669">Bounds</span><span class="op" id="5520675">(</span><span class="op" id="5520676">)</span>&nbsp;<span class="ident" id="5520678">Rectangle</span>&nbsp;<span class="op" id="5520688">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520691">return</span>&nbsp;<span class="ident" id="5520698">p</span><span class="op" id="5520699">.</span><span class="ident" id="5520700">Rect</span><br>
<span class="lineno">60</span><span class="op" id="5520705">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="keyword" id="5520708">func</span>&nbsp;<span class="op" id="5520713">(</span><span class="ident" id="5520714">p</span>&nbsp;<span class="op" id="5520716">*</span><span class="ident" id="5520717">YCbCr</span><span class="op" id="5520722">)</span>&nbsp;<span class="ident" id="5520724">At</span><span class="op" id="5520726">(</span><span class="ident" id="5520727">x</span><span class="op" id="5520728">,</span>&nbsp;<span class="ident" id="5520730">y</span>&nbsp;<span class="builtintype" id="5520732">int</span><span class="op" id="5520735">)</span>&nbsp;<span class="ident" id="5520737">color</span><span class="op" id="5520742">.</span><span class="ident" id="5520743">Color</span>&nbsp;<span class="op" id="5520749">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520752">return</span>&nbsp;<span class="ident" id="5520759">p</span><span class="op" id="5520760">.</span><span class="ident" id="5520761">YCbCrAt</span><span class="op" id="5520768">(</span><span class="ident" id="5520769">x</span><span class="op" id="5520770">,</span>&nbsp;<span class="ident" id="5520772">y</span><span class="op" id="5520773">)</span><br>
<span class="lineno"></span><span class="op" id="5520775">}</span><br>
<span class="lineno">65</span><br>
<span class="lineno"></span><span class="keyword" id="5520778">func</span>&nbsp;<span class="op" id="5520783">(</span><span class="ident" id="5520784">p</span>&nbsp;<span class="op" id="5520786">*</span><span class="ident" id="5520787">YCbCr</span><span class="op" id="5520792">)</span>&nbsp;<span class="ident" id="5520794">YCbCrAt</span><span class="op" id="5520801">(</span><span class="ident" id="5520802">x</span><span class="op" id="5520803">,</span>&nbsp;<span class="ident" id="5520805">y</span>&nbsp;<span class="builtintype" id="5520807">int</span><span class="op" id="5520810">)</span>&nbsp;<span class="ident" id="5520812">color</span><span class="op" id="5520817">.</span><span class="ident" id="5520818">YCbCr</span>&nbsp;<span class="op" id="5520824">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520827">if</span>&nbsp;<span class="op" id="5520830">!</span><span class="op" id="5520831">(</span><span class="ident" id="5520832">Point</span><span class="op" id="5520837">{</span><span class="ident" id="5520838">x</span><span class="op" id="5520839">,</span>&nbsp;<span class="ident" id="5520841">y</span><span class="op" id="5520842">}</span><span class="op" id="5520843">.</span><span class="ident" id="5520844">In</span><span class="op" id="5520846">(</span><span class="ident" id="5520847">p</span><span class="op" id="5520848">.</span><span class="ident" id="5520849">Rect</span><span class="op" id="5520853">)</span><span class="op" id="5520854">)</span>&nbsp;<span class="op" id="5520856">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520860">return</span>&nbsp;<span class="ident" id="5520867">color</span><span class="op" id="5520872">.</span><span class="ident" id="5520873">YCbCr</span><span class="op" id="5520878">{</span><span class="op" id="5520879">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520882">}</span><br>
<span class="lineno">70</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520885">yi</span>&nbsp;<span class="op" id="5520888">:=</span>&nbsp;<span class="ident" id="5520891">p</span><span class="op" id="5520892">.</span><span class="ident" id="5520893">YOffset</span><span class="op" id="5520900">(</span><span class="ident" id="5520901">x</span><span class="op" id="5520902">,</span>&nbsp;<span class="ident" id="5520904">y</span><span class="op" id="5520905">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520908">ci</span>&nbsp;<span class="op" id="5520911">:=</span>&nbsp;<span class="ident" id="5520914">p</span><span class="op" id="5520915">.</span><span class="ident" id="5520916">COffset</span><span class="op" id="5520923">(</span><span class="ident" id="5520924">x</span><span class="op" id="5520925">,</span>&nbsp;<span class="ident" id="5520927">y</span><span class="op" id="5520928">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5520931">return</span>&nbsp;<span class="ident" id="5520938">color</span><span class="op" id="5520943">.</span><span class="ident" id="5520944">YCbCr</span><span class="op" id="5520949">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520953">p</span><span class="op" id="5520954">.</span><span class="ident" id="5520955">Y</span><span class="op" id="5520956">[</span><span class="ident" id="5520957">yi</span><span class="op" id="5520959">]</span><span class="op" id="5520960">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520964">p</span><span class="op" id="5520965">.</span><span class="ident" id="5520966">Cb</span><span class="op" id="5520968">[</span><span class="ident" id="5520969">ci</span><span class="op" id="5520971">]</span><span class="op" id="5520972">,</span><br>
<span class="lineno">75</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5520976">p</span><span class="op" id="5520977">.</span><span class="ident" id="5520978">Cr</span><span class="op" id="5520980">[</span><span class="ident" id="5520981">ci</span><span class="op" id="5520983">]</span><span class="op" id="5520984">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5520987">}</span><br>
<span class="lineno"></span><span class="op" id="5520989">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5520992">//&nbsp;YOffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Y&nbsp;that&nbsp;corresponds&nbsp;to</span><br>
<span class="lineno">80</span><span class="comment" id="5521067">//&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5521091">func</span>&nbsp;<span class="op" id="5521096">(</span><span class="ident" id="5521097">p</span>&nbsp;<span class="op" id="5521099">*</span><span class="ident" id="5521100">YCbCr</span><span class="op" id="5521105">)</span>&nbsp;<span class="ident" id="5521107">YOffset</span><span class="op" id="5521114">(</span><span class="ident" id="5521115">x</span><span class="op" id="5521116">,</span>&nbsp;<span class="ident" id="5521118">y</span>&nbsp;<span class="builtintype" id="5521120">int</span><span class="op" id="5521123">)</span>&nbsp;<span class="builtintype" id="5521125">int</span>&nbsp;<span class="op" id="5521129">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521132">return</span>&nbsp;<span class="op" id="5521139">(</span><span class="ident" id="5521140">y</span><span class="op" id="5521141">-</span><span class="ident" id="5521142">p</span><span class="op" id="5521143">.</span><span class="ident" id="5521144">Rect</span><span class="op" id="5521148">.</span><span class="ident" id="5521149">Min</span><span class="op" id="5521152">.</span><span class="ident" id="5521153">Y</span><span class="op" id="5521154">)</span><span class="op" id="5521155">*</span><span class="ident" id="5521156">p</span><span class="op" id="5521157">.</span><span class="ident" id="5521158">YStride</span>&nbsp;<span class="op" id="5521166">+</span>&nbsp;<span class="op" id="5521168">(</span><span class="ident" id="5521169">x</span>&nbsp;<span class="op" id="5521171">-</span>&nbsp;<span class="ident" id="5521173">p</span><span class="op" id="5521174">.</span><span class="ident" id="5521175">Rect</span><span class="op" id="5521179">.</span><span class="ident" id="5521180">Min</span><span class="op" id="5521183">.</span><span class="ident" id="5521184">X</span><span class="op" id="5521185">)</span><br>
<span class="lineno"></span><span class="op" id="5521187">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">85</span><span class="comment" id="5521190">//&nbsp;COffset&nbsp;returns&nbsp;the&nbsp;index&nbsp;of&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;Cb&nbsp;or&nbsp;Cr&nbsp;that&nbsp;corresponds</span><br>
<span class="lineno"></span><span class="comment" id="5521269">//&nbsp;to&nbsp;the&nbsp;pixel&nbsp;at&nbsp;(x,&nbsp;y).</span><br>
<span class="lineno"></span><span class="keyword" id="5521296">func</span>&nbsp;<span class="op" id="5521301">(</span><span class="ident" id="5521302">p</span>&nbsp;<span class="op" id="5521304">*</span><span class="ident" id="5521305">YCbCr</span><span class="op" id="5521310">)</span>&nbsp;<span class="ident" id="5521312">COffset</span><span class="op" id="5521319">(</span><span class="ident" id="5521320">x</span><span class="op" id="5521321">,</span>&nbsp;<span class="ident" id="5521323">y</span>&nbsp;<span class="builtintype" id="5521325">int</span><span class="op" id="5521328">)</span>&nbsp;<span class="builtintype" id="5521330">int</span>&nbsp;<span class="op" id="5521334">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521337">switch</span>&nbsp;<span class="ident" id="5521344">p</span><span class="op" id="5521345">.</span><span class="ident" id="5521346">SubsampleRatio</span>&nbsp;<span class="op" id="5521361">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521364">case</span>&nbsp;<span class="ident" id="5521369">YCbCrSubsampleRatio422</span><span class="op" id="5521391">:</span><br>
<span class="lineno">90</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521395">return</span>&nbsp;<span class="op" id="5521402">(</span><span class="ident" id="5521403">y</span><span class="op" id="5521404">-</span><span class="ident" id="5521405">p</span><span class="op" id="5521406">.</span><span class="ident" id="5521407">Rect</span><span class="op" id="5521411">.</span><span class="ident" id="5521412">Min</span><span class="op" id="5521415">.</span><span class="ident" id="5521416">Y</span><span class="op" id="5521417">)</span><span class="op" id="5521418">*</span><span class="ident" id="5521419">p</span><span class="op" id="5521420">.</span><span class="ident" id="5521421">CStride</span>&nbsp;<span class="op" id="5521429">+</span>&nbsp;<span class="op" id="5521431">(</span><span class="ident" id="5521432">x</span><span class="op" id="5521433">/</span><span class="num" id="5521434">2</span>&nbsp;<span class="op" id="5521436">-</span>&nbsp;<span class="ident" id="5521438">p</span><span class="op" id="5521439">.</span><span class="ident" id="5521440">Rect</span><span class="op" id="5521444">.</span><span class="ident" id="5521445">Min</span><span class="op" id="5521448">.</span><span class="ident" id="5521449">X</span><span class="op" id="5521450">/</span><span class="num" id="5521451">2</span><span class="op" id="5521452">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521455">case</span>&nbsp;<span class="ident" id="5521460">YCbCrSubsampleRatio420</span><span class="op" id="5521482">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521486">return</span>&nbsp;<span class="op" id="5521493">(</span><span class="ident" id="5521494">y</span><span class="op" id="5521495">/</span><span class="num" id="5521496">2</span><span class="op" id="5521497">-</span><span class="ident" id="5521498">p</span><span class="op" id="5521499">.</span><span class="ident" id="5521500">Rect</span><span class="op" id="5521504">.</span><span class="ident" id="5521505">Min</span><span class="op" id="5521508">.</span><span class="ident" id="5521509">Y</span><span class="op" id="5521510">/</span><span class="num" id="5521511">2</span><span class="op" id="5521512">)</span><span class="op" id="5521513">*</span><span class="ident" id="5521514">p</span><span class="op" id="5521515">.</span><span class="ident" id="5521516">CStride</span>&nbsp;<span class="op" id="5521524">+</span>&nbsp;<span class="op" id="5521526">(</span><span class="ident" id="5521527">x</span><span class="op" id="5521528">/</span><span class="num" id="5521529">2</span>&nbsp;<span class="op" id="5521531">-</span>&nbsp;<span class="ident" id="5521533">p</span><span class="op" id="5521534">.</span><span class="ident" id="5521535">Rect</span><span class="op" id="5521539">.</span><span class="ident" id="5521540">Min</span><span class="op" id="5521543">.</span><span class="ident" id="5521544">X</span><span class="op" id="5521545">/</span><span class="num" id="5521546">2</span><span class="op" id="5521547">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521550">case</span>&nbsp;<span class="ident" id="5521555">YCbCrSubsampleRatio440</span><span class="op" id="5521577">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521581">return</span>&nbsp;<span class="op" id="5521588">(</span><span class="ident" id="5521589">y</span><span class="op" id="5521590">/</span><span class="num" id="5521591">2</span><span class="op" id="5521592">-</span><span class="ident" id="5521593">p</span><span class="op" id="5521594">.</span><span class="ident" id="5521595">Rect</span><span class="op" id="5521599">.</span><span class="ident" id="5521600">Min</span><span class="op" id="5521603">.</span><span class="ident" id="5521604">Y</span><span class="op" id="5521605">/</span><span class="num" id="5521606">2</span><span class="op" id="5521607">)</span><span class="op" id="5521608">*</span><span class="ident" id="5521609">p</span><span class="op" id="5521610">.</span><span class="ident" id="5521611">CStride</span>&nbsp;<span class="op" id="5521619">+</span>&nbsp;<span class="op" id="5521621">(</span><span class="ident" id="5521622">x</span>&nbsp;<span class="op" id="5521624">-</span>&nbsp;<span class="ident" id="5521626">p</span><span class="op" id="5521627">.</span><span class="ident" id="5521628">Rect</span><span class="op" id="5521632">.</span><span class="ident" id="5521633">Min</span><span class="op" id="5521636">.</span><span class="ident" id="5521637">X</span><span class="op" id="5521638">)</span><br>
<span class="lineno">95</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5521641">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521644">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5521678">return</span>&nbsp;<span class="op" id="5521685">(</span><span class="ident" id="5521686">y</span><span class="op" id="5521687">-</span><span class="ident" id="5521688">p</span><span class="op" id="5521689">.</span><span class="ident" id="5521690">Rect</span><span class="op" id="5521694">.</span><span class="ident" id="5521695">Min</span><span class="op" id="5521698">.</span><span class="ident" id="5521699">Y</span><span class="op" id="5521700">)</span><span class="op" id="5521701">*</span><span class="ident" id="5521702">p</span><span class="op" id="5521703">.</span><span class="ident" id="5521704">CStride</span>&nbsp;<span class="op" id="5521712">+</span>&nbsp;<span class="op" id="5521714">(</span><span class="ident" id="5521715">x</span>&nbsp;<span class="op" id="5521717">-</span>&nbsp;<span class="ident" id="5521719">p</span><span class="op" id="5521720">.</span><span class="ident" id="5521721">Rect</span><span class="op" id="5521725">.</span><span class="ident" id="5521726">Min</span><span class="op" id="5521729">.</span><span class="ident" id="5521730">X</span><span class="op" id="5521731">)</span><br>
<span class="lineno"></span><span class="op" id="5521733">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">100</span><span class="comment" id="5521736">//&nbsp;SubImage&nbsp;returns&nbsp;an&nbsp;image&nbsp;representing&nbsp;the&nbsp;portion&nbsp;of&nbsp;the&nbsp;image&nbsp;p&nbsp;visible</span><br>
<span class="lineno"></span><span class="comment" id="5521813">//&nbsp;through&nbsp;r.&nbsp;The&nbsp;returned&nbsp;value&nbsp;shares&nbsp;pixels&nbsp;with&nbsp;the&nbsp;original&nbsp;image.</span><br>
<span class="lineno"></span><span class="keyword" id="5521885">func</span>&nbsp;<span class="op" id="5521890">(</span><span class="ident" id="5521891">p</span>&nbsp;<span class="op" id="5521893">*</span><span class="ident" id="5521894">YCbCr</span><span class="op" id="5521899">)</span>&nbsp;<span class="ident" id="5521901">SubImage</span><span class="op" id="5521909">(</span><span class="ident" id="5521910">r</span>&nbsp;<span class="ident" id="5521912">Rectangle</span><span class="op" id="5521921">)</span>&nbsp;<span class="ident" id="5521923">Image</span>&nbsp;<span class="op" id="5521929">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5521932">r</span>&nbsp;<span class="op" id="5521934">=</span>&nbsp;<span class="ident" id="5521936">r</span><span class="op" id="5521937">.</span><span class="ident" id="5521938">Intersect</span><span class="op" id="5521947">(</span><span class="ident" id="5521948">p</span><span class="op" id="5521949">.</span><span class="ident" id="5521950">Rect</span><span class="op" id="5521954">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5521957">//&nbsp;If&nbsp;r1&nbsp;and&nbsp;r2&nbsp;are&nbsp;Rectangles,&nbsp;r1.Intersect(r2)&nbsp;is&nbsp;not&nbsp;guaranteed&nbsp;to&nbsp;be&nbsp;inside</span><br>
<span class="lineno">105</span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522038">//&nbsp;either&nbsp;r1&nbsp;or&nbsp;r2&nbsp;if&nbsp;the&nbsp;intersection&nbsp;is&nbsp;empty.&nbsp;Without&nbsp;explicitly&nbsp;checking&nbsp;for</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5522120">//&nbsp;this,&nbsp;the&nbsp;Pix[i:]&nbsp;expression&nbsp;below&nbsp;can&nbsp;panic.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522170">if</span>&nbsp;<span class="ident" id="5522173">r</span><span class="op" id="5522174">.</span><span class="ident" id="5522175">Empty</span><span class="op" id="5522180">(</span><span class="op" id="5522181">)</span>&nbsp;<span class="op" id="5522183">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522187">return</span>&nbsp;<span class="op" id="5522194">&amp;</span><span class="ident" id="5522195">YCbCr</span><span class="op" id="5522200">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522205">SubsampleRatio</span><span class="op" id="5522219">:</span>&nbsp;<span class="ident" id="5522221">p</span><span class="op" id="5522222">.</span><span class="ident" id="5522223">SubsampleRatio</span><span class="op" id="5522237">,</span><br>
<span class="lineno">110</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522241">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522244">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522247">yi</span>&nbsp;<span class="op" id="5522250">:=</span>&nbsp;<span class="ident" id="5522253">p</span><span class="op" id="5522254">.</span><span class="ident" id="5522255">YOffset</span><span class="op" id="5522262">(</span><span class="ident" id="5522263">r</span><span class="op" id="5522264">.</span><span class="ident" id="5522265">Min</span><span class="op" id="5522268">.</span><span class="ident" id="5522269">X</span><span class="op" id="5522270">,</span>&nbsp;<span class="ident" id="5522272">r</span><span class="op" id="5522273">.</span><span class="ident" id="5522274">Min</span><span class="op" id="5522277">.</span><span class="ident" id="5522278">Y</span><span class="op" id="5522279">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522282">ci</span>&nbsp;<span class="op" id="5522285">:=</span>&nbsp;<span class="ident" id="5522288">p</span><span class="op" id="5522289">.</span><span class="ident" id="5522290">COffset</span><span class="op" id="5522297">(</span><span class="ident" id="5522298">r</span><span class="op" id="5522299">.</span><span class="ident" id="5522300">Min</span><span class="op" id="5522303">.</span><span class="ident" id="5522304">X</span><span class="op" id="5522305">,</span>&nbsp;<span class="ident" id="5522307">r</span><span class="op" id="5522308">.</span><span class="ident" id="5522309">Min</span><span class="op" id="5522312">.</span><span class="ident" id="5522313">Y</span><span class="op" id="5522314">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522317">return</span>&nbsp;<span class="op" id="5522324">&amp;</span><span class="ident" id="5522325">YCbCr</span><span class="op" id="5522330">{</span><br>
<span class="lineno">115</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522334">Y</span><span class="op" id="5522335">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522350">p</span><span class="op" id="5522351">.</span><span class="ident" id="5522352">Y</span><span class="op" id="5522353">[</span><span class="ident" id="5522354">yi</span><span class="op" id="5522356">:</span><span class="op" id="5522357">]</span><span class="op" id="5522358">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522362">Cb</span><span class="op" id="5522364">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522378">p</span><span class="op" id="5522379">.</span><span class="ident" id="5522380">Cb</span><span class="op" id="5522382">[</span><span class="ident" id="5522383">ci</span><span class="op" id="5522385">:</span><span class="op" id="5522386">]</span><span class="op" id="5522387">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522391">Cr</span><span class="op" id="5522393">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522407">p</span><span class="op" id="5522408">.</span><span class="ident" id="5522409">Cr</span><span class="op" id="5522411">[</span><span class="ident" id="5522412">ci</span><span class="op" id="5522414">:</span><span class="op" id="5522415">]</span><span class="op" id="5522416">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522420">SubsampleRatio</span><span class="op" id="5522434">:</span>&nbsp;<span class="ident" id="5522436">p</span><span class="op" id="5522437">.</span><span class="ident" id="5522438">SubsampleRatio</span><span class="op" id="5522452">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522456">YStride</span><span class="op" id="5522463">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522472">p</span><span class="op" id="5522473">.</span><span class="ident" id="5522474">YStride</span><span class="op" id="5522481">,</span><br>
<span class="lineno">120</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522485">CStride</span><span class="op" id="5522492">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522501">p</span><span class="op" id="5522502">.</span><span class="ident" id="5522503">CStride</span><span class="op" id="5522510">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522514">Rect</span><span class="op" id="5522518">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5522530">r</span><span class="op" id="5522531">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5522534">}</span><br>
<span class="lineno"></span><span class="op" id="5522536">}</span><br>
<span class="lineno"></span><br>
<span class="lineno">125</span><span class="keyword" id="5522539">func</span>&nbsp;<span class="op" id="5522544">(</span><span class="ident" id="5522545">p</span>&nbsp;<span class="op" id="5522547">*</span><span class="ident" id="5522548">YCbCr</span><span class="op" id="5522553">)</span>&nbsp;<span class="ident" id="5522555">Opaque</span><span class="op" id="5522561">(</span><span class="op" id="5522562">)</span>&nbsp;<span class="builtintype" id="5522564">bool</span>&nbsp;<span class="op" id="5522569">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522572">return</span>&nbsp;<span class="builtintype" id="5522579">true</span><br>
<span class="lineno"></span><span class="op" id="5522584">}</span><br>
<span class="lineno"></span><br>
<span class="lineno"></span><span class="comment" id="5522587">//&nbsp;NewYCbCr&nbsp;returns&nbsp;a&nbsp;new&nbsp;YCbCr&nbsp;with&nbsp;the&nbsp;given&nbsp;bounds&nbsp;and&nbsp;subsample&nbsp;ratio.</span><br>
<span class="lineno">130</span><span class="keyword" id="5522662">func</span>&nbsp;<span class="ident" id="5522667">NewYCbCr</span><span class="op" id="5522675">(</span><span class="ident" id="5522676">r</span>&nbsp;<span class="ident" id="5522678">Rectangle</span><span class="op" id="5522687">,</span>&nbsp;<span class="ident" id="5522689">subsampleRatio</span>&nbsp;<span class="ident" id="5522704">YCbCrSubsampleRatio</span><span class="op" id="5522723">)</span>&nbsp;<span class="op" id="5522725">*</span><span class="ident" id="5522726">YCbCr</span>&nbsp;<span class="op" id="5522732">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522735">w</span><span class="op" id="5522736">,</span>&nbsp;<span class="ident" id="5522738">h</span><span class="op" id="5522739">,</span>&nbsp;<span class="ident" id="5522741">cw</span><span class="op" id="5522743">,</span>&nbsp;<span class="ident" id="5522745">ch</span>&nbsp;<span class="op" id="5522748">:=</span>&nbsp;<span class="ident" id="5522751">r</span><span class="op" id="5522752">.</span><span class="ident" id="5522753">Dx</span><span class="op" id="5522755">(</span><span class="op" id="5522756">)</span><span class="op" id="5522757">,</span>&nbsp;<span class="ident" id="5522759">r</span><span class="op" id="5522760">.</span><span class="ident" id="5522761">Dy</span><span class="op" id="5522763">(</span><span class="op" id="5522764">)</span><span class="op" id="5522765">,</span>&nbsp;<span class="num" id="5522767">0</span><span class="op" id="5522768">,</span>&nbsp;<span class="num" id="5522770">0</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522773">switch</span>&nbsp;<span class="ident" id="5522780">subsampleRatio</span>&nbsp;<span class="op" id="5522795">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522798">case</span>&nbsp;<span class="ident" id="5522803">YCbCrSubsampleRatio422</span><span class="op" id="5522825">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522829">cw</span>&nbsp;<span class="op" id="5522832">=</span>&nbsp;<span class="op" id="5522834">(</span><span class="ident" id="5522835">r</span><span class="op" id="5522836">.</span><span class="ident" id="5522837">Max</span><span class="op" id="5522840">.</span><span class="ident" id="5522841">X</span><span class="op" id="5522842">+</span><span class="num" id="5522843">1</span><span class="op" id="5522844">)</span><span class="op" id="5522845">/</span><span class="num" id="5522846">2</span>&nbsp;<span class="op" id="5522848">-</span>&nbsp;<span class="ident" id="5522850">r</span><span class="op" id="5522851">.</span><span class="ident" id="5522852">Min</span><span class="op" id="5522855">.</span><span class="ident" id="5522856">X</span><span class="op" id="5522857">/</span><span class="num" id="5522858">2</span><br>
<span class="lineno">135</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522862">ch</span>&nbsp;<span class="op" id="5522865">=</span>&nbsp;<span class="ident" id="5522867">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522870">case</span>&nbsp;<span class="ident" id="5522875">YCbCrSubsampleRatio420</span><span class="op" id="5522897">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522901">cw</span>&nbsp;<span class="op" id="5522904">=</span>&nbsp;<span class="op" id="5522906">(</span><span class="ident" id="5522907">r</span><span class="op" id="5522908">.</span><span class="ident" id="5522909">Max</span><span class="op" id="5522912">.</span><span class="ident" id="5522913">X</span><span class="op" id="5522914">+</span><span class="num" id="5522915">1</span><span class="op" id="5522916">)</span><span class="op" id="5522917">/</span><span class="num" id="5522918">2</span>&nbsp;<span class="op" id="5522920">-</span>&nbsp;<span class="ident" id="5522922">r</span><span class="op" id="5522923">.</span><span class="ident" id="5522924">Min</span><span class="op" id="5522927">.</span><span class="ident" id="5522928">X</span><span class="op" id="5522929">/</span><span class="num" id="5522930">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522934">ch</span>&nbsp;<span class="op" id="5522937">=</span>&nbsp;<span class="op" id="5522939">(</span><span class="ident" id="5522940">r</span><span class="op" id="5522941">.</span><span class="ident" id="5522942">Max</span><span class="op" id="5522945">.</span><span class="ident" id="5522946">Y</span><span class="op" id="5522947">+</span><span class="num" id="5522948">1</span><span class="op" id="5522949">)</span><span class="op" id="5522950">/</span><span class="num" id="5522951">2</span>&nbsp;<span class="op" id="5522953">-</span>&nbsp;<span class="ident" id="5522955">r</span><span class="op" id="5522956">.</span><span class="ident" id="5522957">Min</span><span class="op" id="5522960">.</span><span class="ident" id="5522961">Y</span><span class="op" id="5522962">/</span><span class="num" id="5522963">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5522966">case</span>&nbsp;<span class="ident" id="5522971">YCbCrSubsampleRatio440</span><span class="op" id="5522993">:</span><br>
<span class="lineno">140</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5522997">cw</span>&nbsp;<span class="op" id="5523000">=</span>&nbsp;<span class="ident" id="5523002">w</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523006">ch</span>&nbsp;<span class="op" id="5523009">=</span>&nbsp;<span class="op" id="5523011">(</span><span class="ident" id="5523012">r</span><span class="op" id="5523013">.</span><span class="ident" id="5523014">Max</span><span class="op" id="5523017">.</span><span class="ident" id="5523018">Y</span><span class="op" id="5523019">+</span><span class="num" id="5523020">1</span><span class="op" id="5523021">)</span><span class="op" id="5523022">/</span><span class="num" id="5523023">2</span>&nbsp;<span class="op" id="5523025">-</span>&nbsp;<span class="ident" id="5523027">r</span><span class="op" id="5523028">.</span><span class="ident" id="5523029">Min</span><span class="op" id="5523032">.</span><span class="ident" id="5523033">Y</span><span class="op" id="5523034">/</span><span class="num" id="5523035">2</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523038">default</span><span class="op" id="5523045">:</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="comment" id="5523049">//&nbsp;Default&nbsp;to&nbsp;4:4:4&nbsp;subsampling.</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523084">cw</span>&nbsp;<span class="op" id="5523087">=</span>&nbsp;<span class="ident" id="5523089">w</span><br>
<span class="lineno">145</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523093">ch</span>&nbsp;<span class="op" id="5523096">=</span>&nbsp;<span class="ident" id="5523098">h</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523101">}</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523104">b</span>&nbsp;<span class="op" id="5523106">:=</span>&nbsp;<span class="builtinfunc" id="5523109">make</span><span class="op" id="5523113">(</span><span class="op" id="5523114">[</span><span class="op" id="5523115">]</span><span class="builtintype" id="5523116">byte</span><span class="op" id="5523120">,</span>&nbsp;<span class="ident" id="5523122">w</span><span class="op" id="5523123">*</span><span class="ident" id="5523124">h</span><span class="op" id="5523125">+</span><span class="num" id="5523126">2</span><span class="op" id="5523127">*</span><span class="ident" id="5523128">cw</span><span class="op" id="5523130">*</span><span class="ident" id="5523131">ch</span><span class="op" id="5523133">)</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="keyword" id="5523136">return</span>&nbsp;<span class="op" id="5523143">&amp;</span><span class="ident" id="5523144">YCbCr</span><span class="op" id="5523149">{</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523153">Y</span><span class="op" id="5523154">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523169">b</span><span class="op" id="5523170">[</span><span class="op" id="5523171">:</span><span class="ident" id="5523172">w</span><span class="op" id="5523173">*</span><span class="ident" id="5523174">h</span><span class="op" id="5523175">]</span><span class="op" id="5523176">,</span><br>
<span class="lineno">150</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523180">Cb</span><span class="op" id="5523182">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523196">b</span><span class="op" id="5523197">[</span><span class="ident" id="5523198">w</span><span class="op" id="5523199">*</span><span class="ident" id="5523200">h</span><span class="op" id="5523201">+</span><span class="num" id="5523202">0</span><span class="op" id="5523203">*</span><span class="ident" id="5523204">cw</span><span class="op" id="5523206">*</span><span class="ident" id="5523207">ch</span>&nbsp;<span class="op" id="5523210">:</span>&nbsp;<span class="ident" id="5523212">w</span><span class="op" id="5523213">*</span><span class="ident" id="5523214">h</span><span class="op" id="5523215">+</span><span class="num" id="5523216">1</span><span class="op" id="5523217">*</span><span class="ident" id="5523218">cw</span><span class="op" id="5523220">*</span><span class="ident" id="5523221">ch</span><span class="op" id="5523223">]</span><span class="op" id="5523224">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523228">Cr</span><span class="op" id="5523230">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523244">b</span><span class="op" id="5523245">[</span><span class="ident" id="5523246">w</span><span class="op" id="5523247">*</span><span class="ident" id="5523248">h</span><span class="op" id="5523249">+</span><span class="num" id="5523250">1</span><span class="op" id="5523251">*</span><span class="ident" id="5523252">cw</span><span class="op" id="5523254">*</span><span class="ident" id="5523255">ch</span>&nbsp;<span class="op" id="5523258">:</span>&nbsp;<span class="ident" id="5523260">w</span><span class="op" id="5523261">*</span><span class="ident" id="5523262">h</span><span class="op" id="5523263">+</span><span class="num" id="5523264">2</span><span class="op" id="5523265">*</span><span class="ident" id="5523266">cw</span><span class="op" id="5523268">*</span><span class="ident" id="5523269">ch</span><span class="op" id="5523271">]</span><span class="op" id="5523272">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523276">SubsampleRatio</span><span class="op" id="5523290">:</span>&nbsp;<span class="ident" id="5523292">subsampleRatio</span><span class="op" id="5523306">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523310">YStride</span><span class="op" id="5523317">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523326">w</span><span class="op" id="5523327">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523331">CStride</span><span class="op" id="5523338">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523347">cw</span><span class="op" id="5523349">,</span><br>
<span class="lineno">155</span>&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp<span class="ident" id="5523353">Rect</span><span class="op" id="5523357">:</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ident" id="5523369">r</span><span class="op" id="5523370">,</span><br>
<span class="lineno"></span>&nbsp;&nbsp;&nbsp;&nbsp<span class="op" id="5523373">}</span><br>
<span class="lineno"></span><span class="op" id="5523375">}</span>
</div>
</body>
</html>
